multiline_comment|/*&n; * drivers/pci/pci.c&n; *&n; * PCI services that are built on top of the BIOS32 service.&n; *&n; * Copyright 1993, 1994, 1995 Drew Eckhardt, Frederic Potter,&n; *&t;David Mosberger-Tang&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/page.h&gt;
DECL|variable|pci_root
r_struct
id|pci_bus
id|pci_root
suffix:semicolon
DECL|variable|pci_devices
r_struct
id|pci_dev
op_star
id|pci_devices
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n; * The bridge_id field is an offset of an item into the array&n; * BRIDGE_MAPPING_TYPE. 0xff indicates that the device is not a PCI&n; * bridge, or that we don&squot;t know for the moment how to configure it.&n; * I&squot;m trying to do my best so that the kernel stays small.  Different&n; * chipset can have same optimization structure. i486 and pentium&n; * chipsets from the same manufacturer usually have the same&n; * structure.&n; */
DECL|macro|DEVICE
mdefine_line|#define DEVICE(vid,did,name) &bslash;&n;  {PCI_VENDOR_ID_##vid, PCI_DEVICE_ID_##did, (name), 0xff}
DECL|macro|BRIDGE
mdefine_line|#define BRIDGE(vid,did,name,bridge) &bslash;&n;  {PCI_VENDOR_ID_##vid, PCI_DEVICE_ID_##did, (name), (bridge)}
DECL|variable|dev_info
r_struct
id|pci_dev_info
id|dev_info
(braket
)braket
op_assign
(brace
id|DEVICE
c_func
(paren
id|NCR
comma
id|NCR_53C810
comma
l_string|&quot;53c810&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|NCR
comma
id|NCR_53C815
comma
l_string|&quot;53c815&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|NCR
comma
id|NCR_53C820
comma
l_string|&quot;53c820&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|NCR
comma
id|NCR_53C825
comma
l_string|&quot;53c825&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ADAPTEC
comma
id|ADAPTEC_2940
comma
l_string|&quot;2940&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ADAPTEC
comma
id|ADAPTEC_294x
comma
l_string|&quot;294x&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ADAPTEC
comma
id|ADAPTEC_7850
comma
l_string|&quot;AIC-7850&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DPT
comma
id|DPT
comma
l_string|&quot;SmartCache/Raid&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_864_1
comma
l_string|&quot;Vision 864-P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_864_2
comma
l_string|&quot;Vision 864-P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_868
comma
l_string|&quot;Vision 868&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_928
comma
l_string|&quot;Vision 928-P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_964_1
comma
l_string|&quot;Vision 964-P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_964_2
comma
l_string|&quot;Vision 964-P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_811
comma
l_string|&quot;Trio32/Trio64&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|S3
comma
id|S3_968
comma
l_string|&quot;Vision 968&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|OPTI
comma
id|OPTI_82C822
comma
l_string|&quot;82C822&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|OPTI
comma
id|OPTI_82C621
comma
l_string|&quot;82C621&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|OPTI
comma
id|OPTI_82C557
comma
l_string|&quot;82C557&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|OPTI
comma
id|OPTI_82C558
comma
l_string|&quot;82C558&quot;
)paren
comma
id|BRIDGE
c_func
(paren
id|UMC
comma
id|UMC_UM8881F
comma
l_string|&quot;UM8881F&quot;
comma
l_int|0x02
)paren
comma
id|BRIDGE
c_func
(paren
id|UMC
comma
id|UMC_UM8891A
comma
l_string|&quot;UM8891A&quot;
comma
l_int|0x01
)paren
comma
id|DEVICE
c_func
(paren
id|UMC
comma
id|UMC_UM8886F
comma
l_string|&quot;UM8886F&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|UMC
comma
id|UMC_UM8886A
comma
l_string|&quot;UM8886A&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|UMC
comma
id|UMC_UM8673F
comma
l_string|&quot;UM8673F&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DEC
comma
id|DEC_TULIP
comma
l_string|&quot;DC21040&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DEC
comma
id|DEC_TULIP_FAST
comma
l_string|&quot;DC21140&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DEC
comma
id|DEC_TULIP_PLUS
comma
l_string|&quot;DC21041&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DEC
comma
id|DEC_FDDI
comma
l_string|&quot;DEFPA&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|DEC
comma
id|DEC_BRD
comma
l_string|&quot;DC21050&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|MATROX
comma
id|MATROX_MGA_2
comma
l_string|&quot;Atlas PX2085&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|MATROX
comma
id|MATROX_MGA_IMP
comma
l_string|&quot;MGA Impression&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82378
comma
l_string|&quot;82378IB&quot;
)paren
comma
id|BRIDGE
c_func
(paren
id|INTEL
comma
id|INTEL_82424
comma
l_string|&quot;82424ZX Saturn&quot;
comma
l_int|0x00
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82375
comma
l_string|&quot;82375EB&quot;
)paren
comma
id|BRIDGE
c_func
(paren
id|INTEL
comma
id|INTEL_82434
comma
l_string|&quot;82434LX Mercury/Neptune&quot;
comma
l_int|0x00
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82430
comma
l_string|&quot;82430ZX Aries&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82437
comma
l_string|&quot;82437 Triton&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82371
comma
l_string|&quot;82471 Triton&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_82438
comma
l_string|&quot;82438&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|INTEL
comma
id|INTEL_7116
comma
l_string|&quot;SAA7116&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SMC
comma
id|SMC_37C665
comma
l_string|&quot;FDC 37C665&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ATI
comma
id|ATI_M32
comma
l_string|&quot;Mach 32&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ATI
comma
id|ATI_M64
comma
l_string|&quot;Mach 64&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|WEITEK
comma
id|WEITEK_P9000
comma
l_string|&quot;P9000&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|WEITEK
comma
id|WEITEK_P9100
comma
l_string|&quot;P9100&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CIRRUS
comma
id|CIRRUS_5430
comma
l_string|&quot;GD 5430&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CIRRUS
comma
id|CIRRUS_5434_4
comma
l_string|&quot;GD 5434&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CIRRUS
comma
id|CIRRUS_5434_8
comma
l_string|&quot;GD 5434&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CIRRUS
comma
id|CIRRUS_6729
comma
l_string|&quot;CL 6729&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CIRRUS
comma
id|CIRRUS_7542
comma
l_string|&quot;CL 7542&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|BUSLOGIC
comma
id|BUSLOGIC_946C
comma
l_string|&quot;946C&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|BUSLOGIC
comma
id|BUSLOGIC_946C_2
comma
l_string|&quot;946C&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|N9
comma
id|N9_I128
comma
l_string|&quot;Imagine 128&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AI
comma
id|AI_M1435
comma
l_string|&quot;M1435&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AL
comma
id|AL_M1445
comma
l_string|&quot;M1445&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AL
comma
id|AL_M1449
comma
l_string|&quot;M1449&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AL
comma
id|AL_M1451
comma
l_string|&quot;M1451&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AL
comma
id|AL_M4803
comma
l_string|&quot;M4803&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TSENG
comma
id|TSENG_W32P_2
comma
l_string|&quot;ET4000W32P&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TSENG
comma
id|TSENG_W32P_b
comma
l_string|&quot;ET4000W32P rev B&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TSENG
comma
id|TSENG_W32P_c
comma
l_string|&quot;ET4000W32P rev C&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TSENG
comma
id|TSENG_W32P_d
comma
l_string|&quot;ET4000W32P rev D&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CMD
comma
id|CMD_640
comma
l_string|&quot;640A&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VISION
comma
id|VISION_QD8500
comma
l_string|&quot;QD-8500&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VISION
comma
id|VISION_QD8580
comma
l_string|&quot;QD-8580&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AMD
comma
id|AMD_LANCE
comma
l_string|&quot;79C970&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|AMD
comma
id|AMD_SCSI
comma
l_string|&quot;53C974&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VLSI
comma
id|VLSI_82C593
comma
l_string|&quot;82C593-FC1&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VLSI
comma
id|VLSI_82C592
comma
l_string|&quot;82C592-FC1&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ADL
comma
id|ADL_2301
comma
l_string|&quot;2301&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SYMPHONY
comma
id|SYMPHONY_101
comma
l_string|&quot;82C101&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TRIDENT
comma
id|TRIDENT_9420
comma
l_string|&quot;TG 9420&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|TRIDENT
comma
id|TRIDENT_9440
comma
l_string|&quot;TG 9440&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CONTAQ
comma
id|CONTAQ_82C599
comma
l_string|&quot;82C599&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|NS
comma
id|NS_87410
comma
l_string|&quot;87410&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VIA
comma
id|VIA_82C505
comma
l_string|&quot;VT 82C505&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VIA
comma
id|VIA_82C576
comma
l_string|&quot;VT 82C576 3V&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VIA
comma
id|VIA_82C561
comma
l_string|&quot;VT 82C561&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SI
comma
id|SI_496
comma
l_string|&quot;85C496&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SI
comma
id|SI_501
comma
l_string|&quot;85C501&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SI
comma
id|SI_503
comma
l_string|&quot;85C503&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|SI
comma
id|SI_601
comma
l_string|&quot;85C601&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|LEADTEK
comma
id|LEADTEK_805
comma
l_string|&quot;S3 805&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|IMS
comma
id|IMS_8849
comma
l_string|&quot;8849&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ZEINET
comma
id|ZEINET_1221
comma
l_string|&quot;1221&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|EF
comma
id|EF_ATM
comma
l_string|&quot;155P-MF1&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|HER
comma
id|HER_STING
comma
l_string|&quot;Stingray&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|ATRONICS
comma
id|ATRONICS_2015
comma
l_string|&quot;IDE-2015PL&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|CT
comma
id|CT_65545
comma
l_string|&quot;65545&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|FD
comma
id|FD_36C70
comma
l_string|&quot;TMC-18C30&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|WINBOND
comma
id|WINBOND_83769
comma
l_string|&quot;W83769F&quot;
)paren
comma
id|DEVICE
c_func
(paren
l_int|3
id|COM
comma
l_int|3
id|COM_3C590
comma
l_string|&quot;3C590 10bT&quot;
)paren
comma
id|DEVICE
c_func
(paren
l_int|3
id|COM
comma
l_int|3
id|COM_3C595TX
comma
l_string|&quot;3C595 100bTX&quot;
)paren
comma
id|DEVICE
c_func
(paren
l_int|3
id|COM
comma
l_int|3
id|COM_3C595T4
comma
l_string|&quot;3C595 100bT4&quot;
)paren
comma
id|DEVICE
c_func
(paren
l_int|3
id|COM
comma
l_int|3
id|COM_3C595MII
comma
l_string|&quot;3C595 100b-MII&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|PROMISE
comma
id|PROMISE_5300
comma
l_string|&quot;DC5030&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|QLOGIC
comma
id|QLOGIC_ISP1020
comma
l_string|&quot;ISP1020&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|QLOGIC
comma
id|QLOGIC_ISP1022
comma
l_string|&quot;ISP1022&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|X
comma
id|X_AGX016
comma
l_string|&quot;ITT AGX016&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|VORTEX
comma
id|VORTEX_GDT
comma
l_string|&quot;GDT 6000b&quot;
)paren
comma
id|DEVICE
c_func
(paren
id|HP
comma
id|HP_J2585A
comma
l_string|&quot;J2585A&quot;
)paren
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PCI_OPTIMIZE
multiline_comment|/*&n; * An item of this structure has the following meaning:&n; * for each optimization, the register address, the mask&n; * and value to write to turn it on.&n; * There are 5 optimizations for the moment:&n; * Cache L2 write back best than write through&n; * Posted Write for CPU to PCI enable&n; * Posted Write for CPU to MEMORY enable&n; * Posted Write for PCI to MEMORY enable&n; * PCI Burst enable&n; *&n; * Half of the bios I&squot;ve meet don&squot;t allow you to turn that on, and you&n; * can gain more than 15% on graphic accesses using those&n; * optimizations...&n; */
DECL|struct|optimization_type
r_struct
id|optimization_type
(brace
DECL|member|type
r_const
r_char
op_star
id|type
suffix:semicolon
DECL|member|off
r_const
r_char
op_star
id|off
suffix:semicolon
DECL|member|on
r_const
r_char
op_star
id|on
suffix:semicolon
DECL|variable|bridge_optimization
)brace
id|bridge_optimization
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Cache L2&quot;
comma
l_string|&quot;write trough&quot;
comma
l_string|&quot;write back&quot;
)brace
comma
(brace
l_string|&quot;CPU-PCI posted write&quot;
comma
l_string|&quot;off&quot;
comma
l_string|&quot;on&quot;
)brace
comma
(brace
l_string|&quot;CPU-Memory posted write&quot;
comma
l_string|&quot;off&quot;
comma
l_string|&quot;on&quot;
)brace
comma
(brace
l_string|&quot;PCI-Memory posted write&quot;
comma
l_string|&quot;off&quot;
comma
l_string|&quot;on&quot;
)brace
comma
(brace
l_string|&quot;PCI burst&quot;
comma
l_string|&quot;off&quot;
comma
l_string|&quot;on&quot;
)brace
)brace
suffix:semicolon
DECL|macro|NUM_OPTIMIZATIONS
mdefine_line|#define NUM_OPTIMIZATIONS &bslash;&n;&t;(sizeof(bridge_optimization) / sizeof(bridge_optimization[0]))
DECL|struct|bridge_mapping_type
r_struct
id|bridge_mapping_type
(brace
DECL|member|addr
r_int
r_char
id|addr
suffix:semicolon
multiline_comment|/* config space address */
DECL|member|mask
r_int
r_char
id|mask
suffix:semicolon
DECL|member|value
r_int
r_char
id|value
suffix:semicolon
DECL|variable|bridge_mapping
)brace
id|bridge_mapping
(braket
)braket
op_assign
(brace
multiline_comment|/*&n;&t; * Intel Neptune/Mercury/Saturn:&n;&t; *&t;If the internal cache is write back,&n;&t; *&t;the L2 cache must be write through!&n;&t; *&t;I&squot;ve to check out how to control that&n;&t; *&t;for the moment, we won&squot;t touch the cache&n;&t; */
(brace
l_int|0x0
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x53
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x53
comma
l_int|0x01
comma
l_int|0x01
)brace
comma
(brace
l_int|0x54
comma
l_int|0x01
comma
l_int|0x01
)brace
comma
(brace
l_int|0x54
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
multiline_comment|/*&n;&t; * UMC 8891A Pentium chipset:&n;&t; *&t;Why did you think UMC was cheaper ??&n;&t; */
(brace
l_int|0x50
comma
l_int|0x10
comma
l_int|0x00
)brace
comma
(brace
l_int|0x51
comma
l_int|0x40
comma
l_int|0x40
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
multiline_comment|/*&n;&t; * UMC UM8881F&n;&t; *&t;This is a dummy entry for my tests.&n;&t; *&t;I have this chipset and no docs....&n;&t; */
(brace
l_int|0x0
comma
l_int|0x1
comma
l_int|0x1
)brace
comma
(brace
l_int|0x0
comma
l_int|0x2
comma
l_int|0x0
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PCI_OPTIMIZE */
multiline_comment|/*&n; * If performance ever becomes important, device_info[] could be&n; * sorted by key and this could be replaced by a binary search.&n; */
DECL|function|pci_lookup_dev
r_struct
id|pci_dev_info
op_star
id|pci_lookup_dev
c_func
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|dev_info
)paren
op_div
r_sizeof
(paren
id|dev_info
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|dev_info
(braket
id|i
)braket
dot
id|vendor
op_eq
id|vendor
op_logical_and
id|dev_info
(braket
id|i
)braket
dot
id|device
op_eq
id|dev
)paren
(brace
r_return
op_amp
id|dev_info
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pci_strbioserr
r_const
r_char
op_star
id|pci_strbioserr
(paren
r_int
id|error
)paren
(brace
r_switch
c_cond
(paren
id|error
)paren
(brace
r_case
id|PCIBIOS_SUCCESSFUL
suffix:colon
r_return
l_string|&quot;SUCCESSFUL&quot;
suffix:semicolon
r_case
id|PCIBIOS_FUNC_NOT_SUPPORTED
suffix:colon
r_return
l_string|&quot;FUNC_NOT_SUPPORTED&quot;
suffix:semicolon
r_case
id|PCIBIOS_BAD_VENDOR_ID
suffix:colon
r_return
l_string|&quot;SUCCESSFUL&quot;
suffix:semicolon
r_case
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:colon
r_return
l_string|&quot;DEVICE_NOT_FOUND&quot;
suffix:semicolon
r_case
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:colon
r_return
l_string|&quot;BAD_REGISTER_NUMBER&quot;
suffix:semicolon
r_case
id|PCIBIOS_SET_FAILED
suffix:colon
r_return
l_string|&quot;SET_FAILED&quot;
suffix:semicolon
r_case
id|PCIBIOS_BUFFER_TOO_SMALL
suffix:colon
r_return
l_string|&quot;BUFFER_TOO_SMALL&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;Unknown error status&quot;
suffix:semicolon
)brace
)brace
DECL|function|pci_strclass
r_const
r_char
op_star
id|pci_strclass
(paren
r_int
r_int
r_class
)paren
(brace
r_switch
c_cond
(paren
r_class
op_rshift
l_int|8
)paren
(brace
r_case
id|PCI_CLASS_NOT_DEFINED
suffix:colon
r_return
l_string|&quot;Non-VGA device&quot;
suffix:semicolon
r_case
id|PCI_CLASS_NOT_DEFINED_VGA
suffix:colon
r_return
l_string|&quot;VGA compatible device&quot;
suffix:semicolon
r_case
id|PCI_CLASS_STORAGE_SCSI
suffix:colon
r_return
l_string|&quot;SCSI storage controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_STORAGE_IDE
suffix:colon
r_return
l_string|&quot;IDE controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_STORAGE_FLOPPY
suffix:colon
r_return
l_string|&quot;Floppy disk controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_STORAGE_IPI
suffix:colon
r_return
l_string|&quot;IPI bus controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_STORAGE_OTHER
suffix:colon
r_return
l_string|&quot;Unknown mass storage controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_NETWORK_ETHERNET
suffix:colon
r_return
l_string|&quot;Ethernet controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_NETWORK_TOKEN_RING
suffix:colon
r_return
l_string|&quot;Token ring network controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_NETWORK_FDDI
suffix:colon
r_return
l_string|&quot;FDDI network controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_NETWORK_OTHER
suffix:colon
r_return
l_string|&quot;Network controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_DISPLAY_VGA
suffix:colon
r_return
l_string|&quot;VGA compatible controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_DISPLAY_XGA
suffix:colon
r_return
l_string|&quot;XGA compatible controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_DISPLAY_OTHER
suffix:colon
r_return
l_string|&quot;Display controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MULTIMEDIA_VIDEO
suffix:colon
r_return
l_string|&quot;Multimedia video controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MULTIMEDIA_AUDIO
suffix:colon
r_return
l_string|&quot;Multimedia audio controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MULTIMEDIA_OTHER
suffix:colon
r_return
l_string|&quot;Multimedia controller&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MEMORY_RAM
suffix:colon
r_return
l_string|&quot;RAM memory&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MEMORY_FLASH
suffix:colon
r_return
l_string|&quot;FLASH memory&quot;
suffix:semicolon
r_case
id|PCI_CLASS_MEMORY_OTHER
suffix:colon
r_return
l_string|&quot;Memory&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_HOST
suffix:colon
r_return
l_string|&quot;Host bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_ISA
suffix:colon
r_return
l_string|&quot;ISA bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_EISA
suffix:colon
r_return
l_string|&quot;EISA bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_MC
suffix:colon
r_return
l_string|&quot;MicroChannel bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_PCI
suffix:colon
r_return
l_string|&quot;PCI bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_PCMCIA
suffix:colon
r_return
l_string|&quot;PCMCIA bridge&quot;
suffix:semicolon
r_case
id|PCI_CLASS_BRIDGE_OTHER
suffix:colon
r_return
l_string|&quot;Bridge&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;Unknown class&quot;
suffix:semicolon
)brace
)brace
DECL|function|pci_strvendor
r_const
r_char
op_star
id|pci_strvendor
c_func
(paren
r_int
r_int
id|vendor
)paren
(brace
r_switch
c_cond
(paren
id|vendor
)paren
(brace
r_case
id|PCI_VENDOR_ID_NCR
suffix:colon
r_return
l_string|&quot;NCR&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ADAPTEC
suffix:colon
r_return
l_string|&quot;Adaptec&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_DPT
suffix:colon
r_return
l_string|&quot;DPT&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_S3
suffix:colon
r_return
l_string|&quot;S3 Inc.&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_OPTI
suffix:colon
r_return
l_string|&quot;OPTI&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_UMC
suffix:colon
r_return
l_string|&quot;UMC&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_DEC
suffix:colon
r_return
l_string|&quot;DEC&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_MATROX
suffix:colon
r_return
l_string|&quot;Matrox&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_INTEL
suffix:colon
r_return
l_string|&quot;Intel&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_SMC
suffix:colon
r_return
l_string|&quot;SMC&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ATI
suffix:colon
r_return
l_string|&quot;ATI&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_WEITEK
suffix:colon
r_return
l_string|&quot;Weitek&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_CIRRUS
suffix:colon
r_return
l_string|&quot;Cirrus Logic&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_BUSLOGIC
suffix:colon
r_return
l_string|&quot;Bus Logic&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_N9
suffix:colon
r_return
l_string|&quot;Number Nine&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_AI
suffix:colon
r_return
l_string|&quot;Acer Incorporated&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_AL
suffix:colon
r_return
l_string|&quot;Acer Labs&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_TSENG
suffix:colon
r_return
l_string|&quot;Tseng&squot;Lab&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_CMD
suffix:colon
r_return
l_string|&quot;CMD&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_VISION
suffix:colon
r_return
l_string|&quot;Vision&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_AMD
suffix:colon
r_return
l_string|&quot;AMD&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_VLSI
suffix:colon
r_return
l_string|&quot;VLSI&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ADL
suffix:colon
r_return
l_string|&quot;Advance Logic&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_SYMPHONY
suffix:colon
r_return
l_string|&quot;Symphony&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_TRIDENT
suffix:colon
r_return
l_string|&quot;Trident&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_CONTAQ
suffix:colon
r_return
l_string|&quot;Contaq&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_NS
suffix:colon
r_return
l_string|&quot;NS&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_VIA
suffix:colon
r_return
l_string|&quot;VIA Technologies&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_SI
suffix:colon
r_return
l_string|&quot;Silicon Integrated Systems&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_LEADTEK
suffix:colon
r_return
l_string|&quot;Leadtek Research&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_IMS
suffix:colon
r_return
l_string|&quot;IMS&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ZEINET
suffix:colon
r_return
l_string|&quot;ZeiNet&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_EF
suffix:colon
r_return
l_string|&quot;Efficient Networks&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_HER
suffix:colon
r_return
l_string|&quot;Hercules&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ATRONICS
suffix:colon
r_return
l_string|&quot;Atronics&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_CT
suffix:colon
r_return
l_string|&quot;Chips &amp; Technologies&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_FD
suffix:colon
r_return
l_string|&quot;Future Domain&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_WINBOND
suffix:colon
r_return
l_string|&quot;Winbond&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_3COM
suffix:colon
r_return
l_string|&quot;3Com&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_PROMISE
suffix:colon
r_return
l_string|&quot;Promise Technology&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_QLOGIC
suffix:colon
r_return
l_string|&quot;Q Logic&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_X
suffix:colon
r_return
l_string|&quot;X TECHNOLOGY&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_ACC
suffix:colon
r_return
l_string|&quot;ACC MICROELECTRONICS&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_VORTEX
suffix:colon
r_return
l_string|&quot;VORTEX&quot;
suffix:semicolon
r_case
id|PCI_VENDOR_ID_HP
suffix:colon
r_return
l_string|&quot;Hewlett Packard&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;Unknown vendor&quot;
suffix:semicolon
)brace
)brace
DECL|function|pci_strdev
r_const
r_char
op_star
id|pci_strdev
c_func
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
)paren
(brace
r_struct
id|pci_dev_info
op_star
id|info
suffix:semicolon
id|info
op_assign
id|pci_lookup_dev
c_func
(paren
id|vendor
comma
id|device
)paren
suffix:semicolon
r_return
id|info
ques
c_cond
id|info-&gt;name
suffix:colon
l_string|&quot;Unknown device&quot;
suffix:semicolon
)brace
multiline_comment|/*&n; * Turn on/off PCI bridge optimization. This should allow benchmarking.&n; */
DECL|function|burst_bridge
r_static
r_void
id|burst_bridge
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|devfn
comma
r_int
r_char
id|pos
comma
r_int
id|turn_on
)paren
(brace
macro_line|#ifdef CONFIG_PCI_OPTIMIZE
r_struct
id|bridge_mapping_type
op_star
id|bmap
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pos
op_mul_assign
id|NUM_OPTIMIZATIONS
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI bridge optimization.&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_OPTIMIZATIONS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    %s: &quot;
comma
id|bridge_optimization
(braket
id|i
)braket
dot
id|type
)paren
suffix:semicolon
id|bmap
op_assign
op_amp
id|bridge_mapping
(braket
id|pos
op_plus
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bmap-&gt;addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Not supported.&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|pcibios_read_config_byte
c_func
(paren
id|bus
comma
id|devfn
comma
id|bmap-&gt;addr
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|bmap-&gt;mask
)paren
op_eq
id|bmap-&gt;value
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s.&quot;
comma
id|bridge_optimization
(braket
id|i
)braket
dot
id|on
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|turn_on
)paren
(brace
id|pcibios_write_config_byte
c_func
(paren
id|bus
comma
id|devfn
comma
id|bmap-&gt;addr
comma
(paren
id|val
op_or
id|bmap-&gt;mask
)paren
op_minus
id|bmap-&gt;value
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Changed!  Now %s.&quot;
comma
id|bridge_optimization
(braket
id|i
)braket
dot
id|off
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s.&quot;
comma
id|bridge_optimization
(braket
id|i
)braket
dot
id|off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|turn_on
)paren
(brace
id|pcibios_write_config_byte
c_func
(paren
id|bus
comma
id|devfn
comma
id|bmap-&gt;addr
comma
(paren
id|val
op_amp
(paren
l_int|0xff
op_minus
id|bmap-&gt;mask
)paren
)paren
op_plus
id|bmap-&gt;value
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Changed!  Now %s.&quot;
comma
id|bridge_optimization
(braket
id|i
)braket
dot
id|on
)paren
suffix:semicolon
)brace
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI_OPTIMIZE */
)brace
multiline_comment|/*&n; * Convert some of the configuration space registers of the device at&n; * address (bus,devfn) into a string (possibly several lines each).&n; * The configuration string is stored starting at buf[len].  If the&n; * string would exceed the size of the buffer (SIZE), 0 is returned.&n; */
DECL|function|sprint_dev_config
r_static
r_int
id|sprint_dev_config
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|base
suffix:semicolon
r_int
r_int
id|l
comma
id|class_rev
comma
id|bus
comma
id|devfn
suffix:semicolon
r_int
r_int
id|vendor
comma
id|device
comma
id|status
suffix:semicolon
r_int
r_char
id|bist
comma
id|latency
comma
id|min_gnt
comma
id|max_lat
suffix:semicolon
r_int
id|reg
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|str
suffix:semicolon
id|bus
op_assign
id|dev-&gt;bus-&gt;number
suffix:semicolon
id|devfn
op_assign
id|dev-&gt;devfn
suffix:semicolon
id|pcibios_read_config_dword
c_func
(paren
id|bus
comma
id|devfn
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|class_rev
)paren
suffix:semicolon
id|pcibios_read_config_word
(paren
id|bus
comma
id|devfn
comma
id|PCI_VENDOR_ID
comma
op_amp
id|vendor
)paren
suffix:semicolon
id|pcibios_read_config_word
(paren
id|bus
comma
id|devfn
comma
id|PCI_DEVICE_ID
comma
op_amp
id|device
)paren
suffix:semicolon
id|pcibios_read_config_word
(paren
id|bus
comma
id|devfn
comma
id|PCI_STATUS
comma
op_amp
id|status
)paren
suffix:semicolon
id|pcibios_read_config_byte
(paren
id|bus
comma
id|devfn
comma
id|PCI_BIST
comma
op_amp
id|bist
)paren
suffix:semicolon
id|pcibios_read_config_byte
(paren
id|bus
comma
id|devfn
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|latency
)paren
suffix:semicolon
id|pcibios_read_config_byte
(paren
id|bus
comma
id|devfn
comma
id|PCI_MIN_GNT
comma
op_amp
id|min_gnt
)paren
suffix:semicolon
id|pcibios_read_config_byte
(paren
id|bus
comma
id|devfn
comma
id|PCI_MAX_LAT
comma
op_amp
id|max_lat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_plus
l_int|80
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;  Bus %2d, device %3d, function %2d:&bslash;n&quot;
comma
id|bus
comma
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
comma
id|PCI_FUNC
c_func
(paren
id|devfn
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_plus
l_int|80
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    %s: %s %s (rev %d).&bslash;n      &quot;
comma
id|pci_strclass
c_func
(paren
id|class_rev
op_rshift
l_int|8
)paren
comma
id|pci_strvendor
c_func
(paren
id|vendor
)paren
comma
id|pci_strdev
c_func
(paren
id|vendor
comma
id|device
)paren
comma
id|class_rev
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_lookup_dev
c_func
(paren
id|vendor
comma
id|device
)paren
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Vendor id=%x. Device id=%x.&bslash;n      &quot;
comma
id|vendor
comma
id|device
)paren
suffix:semicolon
)brace
id|str
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* to keep gcc shut... */
r_switch
c_cond
(paren
id|status
op_amp
id|PCI_STATUS_DEVSEL_MASK
)paren
(brace
r_case
id|PCI_STATUS_DEVSEL_FAST
suffix:colon
id|str
op_assign
l_string|&quot;Fast devsel.  &quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_STATUS_DEVSEL_MEDIUM
suffix:colon
id|str
op_assign
l_string|&quot;Medium devsel.  &quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_STATUS_DEVSEL_SLOW
suffix:colon
id|str
op_assign
l_string|&quot;Slow devsel.  &quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_plus
id|strlen
c_func
(paren
id|str
)paren
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PCI_STATUS_FAST_BACK
)paren
(brace
DECL|macro|fast_b2b_capable
macro_line|#&t;&t;define fast_b2b_capable&t;&quot;Fast back-to-back capable.  &quot;
r_if
c_cond
(paren
id|len
op_plus
id|strlen
c_func
(paren
id|fast_b2b_capable
)paren
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
id|fast_b2b_capable
)paren
suffix:semicolon
DECL|macro|fast_b2b_capable
macro_line|#&t;&t;undef fast_b2b_capable
)brace
r_if
c_cond
(paren
id|bist
op_amp
id|PCI_BIST_CAPABLE
)paren
(brace
DECL|macro|BIST_capable
macro_line|#&t;&t;define BIST_capable&t;&quot;BIST capable.  &quot;
r_if
c_cond
(paren
id|len
op_plus
id|strlen
c_func
(paren
id|BIST_capable
)paren
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
id|BIST_capable
)paren
suffix:semicolon
DECL|macro|BIST_capable
macro_line|#&t;&t;undef BIST_capable
)brace
r_if
c_cond
(paren
id|dev-&gt;irq
)paren
(brace
r_if
c_cond
(paren
id|len
op_plus
l_int|40
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;IRQ %d.  &quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;master
)paren
(brace
r_if
c_cond
(paren
id|len
op_plus
l_int|80
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Master Capable.  &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|latency
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Latency=%d.  &quot;
comma
id|latency
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;No bursts.  &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|min_gnt
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Min Gnt=%d.&quot;
comma
id|min_gnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|max_lat
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Max Lat=%d.&quot;
comma
id|max_lat
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|reg
op_assign
id|PCI_BASE_ADDRESS_0
suffix:semicolon
id|reg
op_le
id|PCI_BASE_ADDRESS_5
suffix:semicolon
id|reg
op_add_assign
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|len
op_plus
l_int|40
OG
id|size
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pcibios_read_config_dword
c_func
(paren
id|bus
comma
id|devfn
comma
id|reg
comma
op_amp
id|l
)paren
suffix:semicolon
id|base
op_assign
id|l
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|base
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n      I/O at 0x%lx.&quot;
comma
id|base
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
)paren
suffix:semicolon
)brace
r_else
(brace
r_const
r_char
op_star
id|pref
comma
op_star
id|type
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_if
c_cond
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_MEM_PREFETCH
)paren
(brace
id|pref
op_assign
l_string|&quot;P&quot;
suffix:semicolon
)brace
r_else
(brace
id|pref
op_assign
l_string|&quot;Non-p&quot;
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_MEM_TYPE_MASK
)paren
(brace
r_case
id|PCI_BASE_ADDRESS_MEM_TYPE_32
suffix:colon
id|type
op_assign
l_string|&quot;32 bit&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_BASE_ADDRESS_MEM_TYPE_1M
suffix:colon
id|type
op_assign
l_string|&quot;20 bit&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_BASE_ADDRESS_MEM_TYPE_64
suffix:colon
id|type
op_assign
l_string|&quot;64 bit&quot;
suffix:semicolon
multiline_comment|/* read top 32 bit address of base addr: */
id|reg
op_add_assign
l_int|4
suffix:semicolon
id|pcibios_read_config_dword
c_func
(paren
id|bus
comma
id|devfn
comma
id|reg
comma
op_amp
id|l
)paren
suffix:semicolon
id|base
op_or_assign
(paren
(paren
id|u64
)paren
id|l
)paren
op_lshift
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n      %srefetchable %s memory at &quot;
l_string|&quot;0x%lx.&quot;
comma
id|pref
comma
id|type
comma
id|base
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
)paren
suffix:semicolon
)brace
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * Return list of PCI devices as a character string for /proc/pci.&n; * BUF is a buffer that is PAGE_SIZE bytes long.&n; */
DECL|function|get_pci_list
r_int
id|get_pci_list
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
r_int
id|nprinted
comma
id|len
comma
id|size
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
DECL|macro|MSG
macro_line|#&t;define MSG &quot;&bslash;nwarning: page-size limit reached!&bslash;n&quot;
multiline_comment|/* reserve same for truncation warning message: */
id|size
op_assign
id|PAGE_SIZE
op_minus
(paren
id|strlen
c_func
(paren
id|MSG
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;PCI devices found:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|pci_devices
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
id|nprinted
op_assign
id|sprint_dev_config
c_func
(paren
id|dev
comma
id|buf
op_plus
id|len
comma
id|size
op_minus
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nprinted
OL
l_int|0
)paren
(brace
r_return
id|len
op_plus
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
id|MSG
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|nprinted
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * pci_malloc() returns initialized memory of size SIZE.  Can be&n; * used only while pci_init() is active.&n; */
DECL|function|pci_malloc
r_static
r_void
op_star
id|pci_malloc
c_func
(paren
r_int
id|size
comma
r_int
r_int
op_star
id|mem_startp
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;...pci_malloc(size=%ld,mem=%p)&quot;
comma
id|size
comma
op_star
id|mem_startp
)paren
suffix:semicolon
macro_line|#endif
id|mem
op_assign
(paren
r_void
op_star
)paren
op_star
id|mem_startp
suffix:semicolon
op_star
id|mem_startp
op_add_assign
(paren
id|size
op_plus
r_sizeof
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
r_sizeof
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|mem
suffix:semicolon
)brace
DECL|function|scan_bus
r_static
r_int
r_int
id|scan_bus
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
op_star
id|mem_startp
)paren
(brace
r_int
r_int
id|devfn
comma
id|l
comma
id|max
suffix:semicolon
r_int
r_char
id|cmd
comma
id|tmp
comma
id|hdr_type
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev_info
op_star
id|info
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_struct
id|pci_bus
op_star
id|child
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;...scan_bus(busno=%d,mem=%p)&bslash;n&quot;
comma
id|bus-&gt;number
comma
op_star
id|mem_startp
)paren
suffix:semicolon
macro_line|#endif
id|max
op_assign
id|bus-&gt;secondary
suffix:semicolon
r_for
c_loop
(paren
id|devfn
op_assign
l_int|0
suffix:semicolon
id|devfn
OL
l_int|0xff
suffix:semicolon
op_increment
id|devfn
)paren
(brace
r_if
c_cond
(paren
id|PCI_FUNC
c_func
(paren
id|devfn
)paren
op_eq
l_int|0
)paren
(brace
id|pcibios_read_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_HEADER_TYPE
comma
op_amp
id|hdr_type
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|hdr_type
op_amp
l_int|0x80
)paren
)paren
(brace
multiline_comment|/* not a multi-function device */
r_continue
suffix:semicolon
)brace
id|pcibios_read_config_dword
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_VENDOR_ID
comma
op_amp
id|l
)paren
suffix:semicolon
multiline_comment|/* some broken boards return 0 if a slot is empty: */
r_if
c_cond
(paren
id|l
op_eq
l_int|0xffffffff
op_logical_or
id|l
op_eq
l_int|0x00000000
)paren
(brace
id|hdr_type
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dev
op_assign
id|pci_malloc
c_func
(paren
r_sizeof
(paren
op_star
id|dev
)paren
comma
id|mem_startp
)paren
suffix:semicolon
id|dev-&gt;bus
op_assign
id|bus
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Put it into the simple chain of devices on this&n;&t;&t; * bus.  It is used to find devices once everything is&n;&t;&t; * set up.&n;&t;&t; */
id|dev-&gt;next
op_assign
id|pci_devices
suffix:semicolon
id|pci_devices
op_assign
id|dev
suffix:semicolon
id|dev-&gt;devfn
op_assign
id|devfn
suffix:semicolon
id|dev-&gt;vendor
op_assign
id|l
op_amp
l_int|0xffff
suffix:semicolon
id|dev-&gt;device
op_assign
(paren
id|l
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Check to see if we now about this device and report&n;&t;&t; * a message at boot time.  This is the only way to&n;&t;&t; * learn about new hardware...&n;&t;&t; */
id|info
op_assign
id|pci_lookup_dev
c_func
(paren
id|dev-&gt;vendor
comma
id|dev-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Warning : Unknown PCI device.  Please read include/linux/pci.h &bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Some BIOS&squot; are lazy. Let&squot;s do their job: */
r_if
c_cond
(paren
id|info-&gt;bridge_type
op_ne
l_int|0xff
)paren
(brace
id|burst_bridge
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|info-&gt;bridge_type
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* non-destructively determine if device can be a master: */
id|pcibios_read_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|pcibios_write_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_COMMAND
comma
id|cmd
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
id|pcibios_read_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_COMMAND
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|dev-&gt;master
op_assign
(paren
(paren
id|tmp
op_amp
id|PCI_COMMAND_MASTER
)paren
op_ne
l_int|0
)paren
suffix:semicolon
id|pcibios_write_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
multiline_comment|/* read irq level (may be changed during pcibios_fixup()): */
id|pcibios_read_config_byte
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_INTERRUPT_LINE
comma
op_amp
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* check to see if this device is a PCI-PCI bridge: */
id|pcibios_read_config_dword
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|l
)paren
suffix:semicolon
id|l
op_assign
id|l
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* upper 3 bytes */
id|dev
op_member_access_from_pointer
r_class
op_assign
id|l
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Now insert it into the list of devices held&n;&t;&t; * by the parent bus.&n;&t;&t; */
id|dev-&gt;sibling
op_assign
id|bus-&gt;devices
suffix:semicolon
id|bus-&gt;devices
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
op_eq
id|PCI_CLASS_BRIDGE_PCI
)paren
(brace
r_int
r_int
id|buses
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Insert it into the tree of buses.&n;&t;&t;&t; */
id|child
op_assign
id|pci_malloc
c_func
(paren
r_sizeof
(paren
op_star
id|child
)paren
comma
id|mem_startp
)paren
suffix:semicolon
id|child-&gt;next
op_assign
id|bus-&gt;children
suffix:semicolon
id|bus-&gt;children
op_assign
id|child
suffix:semicolon
id|child-&gt;self
op_assign
id|dev
suffix:semicolon
id|child-&gt;parent
op_assign
id|bus
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Set up the primary, secondary and subordinate&n;&t;&t;&t; * bus numbers.&n;&t;&t;&t; */
id|child-&gt;number
op_assign
id|child-&gt;secondary
op_assign
op_increment
id|max
suffix:semicolon
id|child-&gt;primary
op_assign
id|bus-&gt;secondary
suffix:semicolon
id|child-&gt;subordinate
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Clear all status bits and turn off memory,&n;&t;&t;&t; * I/O and master enables.&n;&t;&t;&t; */
id|pcibios_write_config_word
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_COMMAND
comma
l_int|0x0000
)paren
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|PCI_STATUS
comma
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Configure the bus numbers for this bridge:&n;&t;&t;&t; */
id|pcibios_read_config_dword
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
l_int|0x18
comma
op_amp
id|buses
)paren
suffix:semicolon
id|buses
op_and_assign
l_int|0xff000000
suffix:semicolon
id|buses
op_or_assign
(paren
(paren
(paren
r_int
r_int
)paren
(paren
id|child-&gt;primary
)paren
op_lshift
l_int|0
)paren
op_or
(paren
(paren
r_int
r_int
)paren
(paren
id|child-&gt;secondary
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
r_int
r_int
)paren
(paren
id|child-&gt;subordinate
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|pcibios_write_config_dword
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
l_int|0x18
comma
id|buses
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Now we can scan all subordinate buses:&n;&t;&t;&t; */
id|max
op_assign
id|scan_bus
c_func
(paren
id|child
comma
id|mem_startp
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Set the subordinate bus number to its real&n;&t;&t;&t; * value:&n;&t;&t;&t; */
id|child-&gt;subordinate
op_assign
id|max
suffix:semicolon
id|buses
op_assign
(paren
id|buses
op_amp
l_int|0xff00ffff
)paren
op_or
(paren
(paren
r_int
r_int
)paren
(paren
id|child-&gt;subordinate
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|pcibios_write_config_dword
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
l_int|0x18
comma
id|buses
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * We&squot;ve scanned the bus and so we know all about what&squot;s on&n;&t; * the other side of any bridges that may be on this bus plus&n;&t; * any devices.&n;&t; *&n;&t; * Return how far we&squot;ve got finding sub-buses.&n;&t; */
r_return
id|max
suffix:semicolon
)brace
DECL|function|pci_init
r_int
r_int
id|pci_init
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
id|mem_start
op_assign
id|pcibios_init
c_func
(paren
id|mem_start
comma
id|mem_end
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pci_init: no BIOS32 detected&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|mem_start
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Probing PCI hardware.&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pci_root
comma
l_int|0
comma
r_sizeof
(paren
id|pci_root
)paren
)paren
suffix:semicolon
id|pci_root.subordinate
op_assign
id|scan_bus
c_func
(paren
op_amp
id|pci_root
comma
op_amp
id|mem_start
)paren
suffix:semicolon
multiline_comment|/* give BIOS a chance to apply platform specific fixes: */
id|mem_start
op_assign
id|pcibios_fixup
c_func
(paren
id|mem_start
comma
id|mem_end
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
(brace
r_int
id|len
op_assign
id|get_pci_list
c_func
(paren
id|mem_start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
(paren
(paren
r_char
op_star
)paren
id|mem_start
)paren
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|mem_start
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|mem_start
suffix:semicolon
)brace
eof
