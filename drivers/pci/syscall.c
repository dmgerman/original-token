multiline_comment|/*&n; *&t;pci_syscall.c&n; *&n; * For architectures where we want to allow direct access&n; * to the PCI config stuff - it would probably be preferable&n; * on PCs too, but there people just do it by hand with the&n; * magic northbridge registers..&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
id|asmlinkage
r_int
DECL|function|sys_pciconfig_read
id|sys_pciconfig_read
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_void
op_star
id|buf
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|u8
id|byte
suffix:semicolon
id|u16
id|word
suffix:semicolon
id|u32
id|dword
suffix:semicolon
r_int
id|err
comma
id|cfg_ret
suffix:semicolon
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_goto
id|error
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
comma
id|dfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|error
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|cfg_ret
op_assign
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|off
comma
op_amp
id|byte
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|cfg_ret
op_assign
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|off
comma
op_amp
id|word
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|cfg_ret
op_assign
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|off
comma
op_amp
id|dword
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|cfg_ret
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|err
op_assign
id|put_user
c_func
(paren
id|byte
comma
(paren
r_int
r_char
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|err
op_assign
id|put_user
c_func
(paren
id|word
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|err
op_assign
id|put_user
c_func
(paren
id|dword
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|err
suffix:semicolon
id|error
suffix:colon
multiline_comment|/* ??? XFree86 doesn&squot;t even check the return value.  They&n;&t;   just look for 0xffffffff in the output, since that&squot;s what&n;&t;   they get instead of a machine check on x86.  */
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|put_user
c_func
(paren
op_minus
l_int|1
comma
(paren
r_int
r_char
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|put_user
c_func
(paren
op_minus
l_int|1
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|put_user
c_func
(paren
op_minus
l_int|1
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|asmlinkage
r_int
DECL|function|sys_pciconfig_write
id|sys_pciconfig_write
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_void
op_star
id|buf
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|u8
id|byte
suffix:semicolon
id|u16
id|word
suffix:semicolon
id|u32
id|dword
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
comma
id|dfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|byte
comma
(paren
id|u8
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|err
op_assign
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|off
comma
id|byte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|word
comma
(paren
id|u16
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|err
op_assign
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|off
comma
id|word
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|dword
comma
(paren
id|u32
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|err
op_assign
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|off
comma
id|dword
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
eof
