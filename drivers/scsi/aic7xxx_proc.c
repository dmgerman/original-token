multiline_comment|/*+M*************************************************************************&n; * Adaptec AIC7xxx device driver proc support for Linux.&n; *&n; * Copyright (c) 1995, 1996 Dean W. Gehnert&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * ----------------------------------------------------------------&n; *  o Modified from the EATA-DMA /proc support.&n; *  o Additional support for device block statistics provided by&n; *    Matthew Jacob.&n; *  o Correction of overflow by Heinz Mauelshagen&n; *  o Adittional corrections by Doug Ledford&n; *&n; *  Dean W. Gehnert, deang@teleport.com, 05/01/96&n; *&n; *  $Id: aic7xxx_proc.c,v 4.1 1997/06/97 08:23:42 deang Exp $&n; *-M*************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
DECL|macro|BLS
mdefine_line|#define&t;BLS&t;(&amp;aic7xxx_buffer[size])
DECL|macro|HDRB
mdefine_line|#define HDRB &bslash;&n;&quot;             &lt; 2K      2K+     4K+     8K+    16K+    32K+    64K+   128K+&quot;
macro_line|#ifdef PROC_DEBUG
r_extern
r_int
id|vsprintf
c_func
(paren
r_char
op_star
comma
r_const
r_char
op_star
comma
id|va_list
)paren
suffix:semicolon
r_static
r_void
DECL|function|proc_debug
id|proc_debug
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|ap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|buf
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
macro_line|#else /* PROC_DEBUG */
DECL|macro|proc_debug
macro_line|#  define proc_debug(fmt, args...)
macro_line|#endif /* PROC_DEBUG */
DECL|variable|aic7xxx_buffer_size
r_static
r_int
id|aic7xxx_buffer_size
op_assign
l_int|0
suffix:semicolon
DECL|variable|aic7xxx_buffer
r_static
r_char
op_star
id|aic7xxx_buffer
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*+F*************************************************************************&n; * Function:&n; *   aic7xxx_set_info&n; *&n; * Description:&n; *   Set parameters for the driver from the /proc filesystem.&n; *-F*************************************************************************/
r_int
DECL|function|aic7xxx_set_info
id|aic7xxx_set_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_struct
id|Scsi_Host
op_star
id|HBAptr
)paren
(brace
id|proc_debug
c_func
(paren
l_string|&quot;aic7xxx_set_info(): %s&bslash;n&quot;
comma
id|buffer
)paren
suffix:semicolon
r_return
(paren
op_minus
id|ENOSYS
)paren
suffix:semicolon
multiline_comment|/* Currently this is a no-op */
)brace
multiline_comment|/*+F*************************************************************************&n; * Function:&n; *   aic7xxx_proc_info&n; *&n; * Description:&n; *   Return information to handle /proc support for the driver.&n; *-F*************************************************************************/
r_int
DECL|function|aic7xxx_proc_info
id|aic7xxx_proc_info
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|hostno
comma
r_int
id|inout
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|HBAptr
suffix:semicolon
r_struct
id|aic7xxx_host
op_star
id|p
suffix:semicolon
r_int
id|size
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|i
suffix:semicolon
r_struct
id|aic7xxx_xferstats
op_star
id|sp
suffix:semicolon
r_int
r_char
id|target
suffix:semicolon
id|HBAptr
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|first_aic7xxx
suffix:semicolon
id|p-&gt;host-&gt;host_no
op_ne
id|hostno
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Can&squot;t find adapter for host number %d&bslash;n&quot;
comma
id|hostno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|length
)paren
(brace
r_return
(paren
id|size
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|length
)paren
suffix:semicolon
)brace
)brace
id|HBAptr
op_assign
id|p-&gt;host
suffix:semicolon
r_if
c_cond
(paren
id|inout
op_eq
id|TRUE
)paren
multiline_comment|/* Has data been written to the file? */
(brace
r_return
(paren
id|aic7xxx_set_info
c_func
(paren
id|buffer
comma
id|length
comma
id|HBAptr
)paren
)paren
suffix:semicolon
)brace
id|p
op_assign
(paren
r_struct
id|aic7xxx_host
op_star
)paren
id|HBAptr-&gt;hostdata
suffix:semicolon
multiline_comment|/*&n;   * It takes roughly 1K of space to hold all relevant card info, not&n;   * counting any proc stats, so we start out with a 1.5k buffer size and&n;   * if proc_stats is defined, then we sweep the stats structure to see&n;   * how many drives we will be printing out for and add 384 bytes per&n;   * device with active stats.&n;   *&n;   * Hmmmm...that 1.5k seems to keep growing as items get added so they&n;   * can be easily viewed for debugging purposes.  So, we bumped that&n;   * 1.5k to 4k so we can quit having to bump it all the time.&n;   */
id|size
op_assign
l_int|4096
suffix:semicolon
r_for
c_loop
(paren
id|target
op_assign
l_int|0
suffix:semicolon
id|target
OL
id|MAX_TARGETS
suffix:semicolon
id|target
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;dev_flags
(braket
id|target
)braket
op_amp
id|DEVICE_PRESENT
)paren
macro_line|#ifdef AIC7XXX_PROC_STATS
id|size
op_add_assign
l_int|512
suffix:semicolon
macro_line|#else
id|size
op_add_assign
l_int|256
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|aic7xxx_buffer_size
op_ne
id|size
)paren
(brace
r_if
c_cond
(paren
id|aic7xxx_buffer
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|aic7xxx_buffer
)paren
suffix:semicolon
id|aic7xxx_buffer_size
op_assign
l_int|0
suffix:semicolon
)brace
id|aic7xxx_buffer
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aic7xxx_buffer
op_eq
l_int|NULL
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;AIC7xxx - kmalloc error at line %d&bslash;n&quot;
comma
id|__LINE__
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
id|aic7xxx_buffer_size
op_assign
id|size
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Adaptec AIC7xxx driver version: &quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%s/&quot;
comma
id|AIC7XXX_C_VERSION
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%s&quot;
comma
id|AIC7XXX_H_VERSION
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Compile Options:&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_AIC7XXX_TCQ_ON_BY_DEFAULT
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  TCQ Enabled By Default : Enabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  TCQ Enabled By Default : Disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef AIC7XXX_PROC_STATS
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  AIC7XXX_PROC_STATS     : Enabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  AIC7XXX_PROC_STATS     : Disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Adapter Configuration:&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;           SCSI Adapter: %s&bslash;n&quot;
comma
id|board_names
(braket
id|p-&gt;board_name_index
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|AHC_TWIN
)paren
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                         Twin Channel Controller &quot;
)paren
suffix:semicolon
r_else
(brace
r_char
op_star
id|channel
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_char
op_star
id|ultra
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_char
op_star
id|wide
op_assign
l_string|&quot;Narrow &quot;
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|AHC_MULTI_CHANNEL
)paren
(brace
id|channel
op_assign
l_string|&quot; Channel A&quot;
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
(paren
id|AHC_CHNLB
op_or
id|AHC_CHNLC
)paren
)paren
id|channel
op_assign
(paren
id|p-&gt;flags
op_amp
id|AHC_CHNLB
)paren
ques
c_cond
l_string|&quot; Channel B&quot;
suffix:colon
l_string|&quot; Channel C&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|AHC_WIDE
)paren
id|wide
op_assign
l_string|&quot;Wide &quot;
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|AHC_ULTRA3
)paren
(brace
r_switch
c_cond
(paren
id|p-&gt;chip
op_amp
id|AHC_CHIPID_MASK
)paren
(brace
r_case
id|AHC_AIC7892
suffix:colon
r_case
id|AHC_AIC7899
suffix:colon
id|ultra
op_assign
l_string|&quot;Ultra-160/m LVD/SE &quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ultra
op_assign
l_string|&quot;Ultra-3 LVD/SE &quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|AHC_ULTRA2
)paren
id|ultra
op_assign
l_string|&quot;Ultra-2 LVD/SE &quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|AHC_ULTRA
)paren
id|ultra
op_assign
l_string|&quot;Ultra &quot;
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                           %s%sController%s &quot;
comma
id|ultra
comma
id|wide
comma
id|channel
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|p-&gt;chip
op_amp
op_complement
id|AHC_CHIPID_MASK
)paren
(brace
r_case
id|AHC_VL
suffix:colon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;at VLB slot %d&bslash;n&quot;
comma
id|p-&gt;pci_device_fn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_EISA
suffix:colon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;at EISA slot %d&bslash;n&quot;
comma
id|p-&gt;pci_device_fn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;at PCI %d/%d/%d&bslash;n&quot;
comma
id|p-&gt;pci_bus
comma
id|PCI_SLOT
c_func
(paren
id|p-&gt;pci_device_fn
)paren
comma
id|PCI_FUNC
c_func
(paren
id|p-&gt;pci_device_fn
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;maddr
)paren
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;    Programmed I/O Base: %lx&bslash;n&quot;
comma
id|p-&gt;base
)paren
suffix:semicolon
)brace
r_else
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;    PCI MMAPed I/O Base: 0x%lx&bslash;n&quot;
comma
id|p-&gt;mbase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|p-&gt;chip
op_amp
(paren
id|AHC_VL
op_or
id|AHC_EISA
)paren
)paren
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;    BIOS Memory Address: 0x%08x&bslash;n&quot;
comma
id|p-&gt;bios_address
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot; Adapter SEEPROM Config: %s&bslash;n&quot;
comma
(paren
id|p-&gt;flags
op_amp
id|AHC_SEEPROM_FOUND
)paren
ques
c_cond
l_string|&quot;SEEPROM found and used.&quot;
suffix:colon
(paren
(paren
id|p-&gt;flags
op_amp
id|AHC_USEDEFAULTS
)paren
ques
c_cond
l_string|&quot;SEEPROM not found, using defaults.&quot;
suffix:colon
l_string|&quot;SEEPROM not found, using leftover BIOS values.&quot;
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;      Adaptec SCSI BIOS: %s&bslash;n&quot;
comma
(paren
id|p-&gt;flags
op_amp
id|AHC_BIOS_ENABLED
)paren
ques
c_cond
l_string|&quot;Enabled&quot;
suffix:colon
l_string|&quot;Disabled&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                    IRQ: %d&bslash;n&quot;
comma
id|HBAptr-&gt;irq
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                   SCBs: Active %d, Max Active %d,&bslash;n&quot;
comma
id|p-&gt;activescbs
comma
id|p-&gt;max_activescbs
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                         Allocated %d, HW %d, &quot;
l_string|&quot;Page %d&bslash;n&quot;
comma
id|p-&gt;scb_data-&gt;numscbs
comma
id|p-&gt;scb_data-&gt;maxhscbs
comma
id|p-&gt;scb_data-&gt;maxscbs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|AHC_EXTERNAL_SRAM
)paren
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                         Using External SCB SRAM&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;             Interrupts: %ld&quot;
comma
id|p-&gt;isr_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;chip
op_amp
id|AHC_EISA
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot; %s&bslash;n&quot;
comma
(paren
id|p-&gt;pause
op_amp
id|IRQMS
)paren
ques
c_cond
l_string|&quot;(Level Sensitive)&quot;
suffix:colon
l_string|&quot;(Edge Triggered)&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;      BIOS Control Word: 0x%04x&bslash;n&quot;
comma
id|p-&gt;bios_control
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;   Adapter Control Word: 0x%04x&bslash;n&quot;
comma
id|p-&gt;adapter_control
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;   Extended Translation: %sabled&bslash;n&quot;
comma
(paren
id|p-&gt;flags
op_amp
id|AHC_EXTEND_TRANS_A
)paren
ques
c_cond
l_string|&quot;En&quot;
suffix:colon
l_string|&quot;Dis&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Disconnect Enable Flags: 0x%04x&bslash;n&quot;
comma
id|p-&gt;discenable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;features
op_amp
(paren
id|AHC_ULTRA
op_or
id|AHC_ULTRA2
)paren
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;     Ultra Enable Flags: 0x%04x&bslash;n&quot;
comma
id|p-&gt;ultraenb
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot; Tag Queue Enable Flags: 0x%04x&bslash;n&quot;
comma
id|p-&gt;tagenable
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Ordered Queue Tag Flags: 0x%04x&bslash;n&quot;
comma
id|p-&gt;orderedtag
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Default Tag Queue Depth: %d&bslash;n&quot;
comma
id|AIC7XXX_CMDS_PER_DEVICE
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;    Tagged Queue By Device array for aic7xxx host &quot;
l_string|&quot;instance %d:&bslash;n&quot;
comma
id|p-&gt;instance
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;      {&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|MAX_TARGETS
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%d,&quot;
comma
id|aic7xxx_tag_info
(braket
id|p-&gt;instance
)braket
dot
id|tag_commands
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%d}&bslash;n&quot;
comma
id|aic7xxx_tag_info
(braket
id|p-&gt;instance
)braket
dot
id|tag_commands
(braket
id|i
)braket
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;    Actual queue depth per device for aic7xxx host &quot;
l_string|&quot;instance %d:&bslash;n&quot;
comma
id|p-&gt;instance
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;      {&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|MAX_TARGETS
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%d,&quot;
comma
id|p-&gt;dev_max_queue_depth
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%d}&bslash;n&quot;
comma
id|p-&gt;dev_max_queue_depth
(braket
id|i
)braket
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Statistics:&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|target
op_assign
l_int|0
suffix:semicolon
id|target
OL
id|MAX_TARGETS
suffix:semicolon
id|target
op_increment
)paren
(brace
id|sp
op_assign
op_amp
id|p-&gt;stats
(braket
id|target
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;dev_flags
(braket
id|target
)braket
op_amp
id|DEVICE_PRESENT
)paren
op_eq
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|AHC_TWIN
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;(scsi%d:%d:%d:%d)&bslash;n&quot;
comma
id|p-&gt;host_no
comma
(paren
id|target
op_rshift
l_int|3
)paren
comma
(paren
id|target
op_amp
l_int|0x7
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;(scsi%d:%d:%d:%d)&bslash;n&quot;
comma
id|p-&gt;host_no
comma
l_int|0
comma
id|target
comma
l_int|0
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  Device using %s/%s&quot;
comma
(paren
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_width
op_eq
id|MSG_EXT_WDTR_BUS_16_BIT
)paren
ques
c_cond
l_string|&quot;Wide&quot;
suffix:colon
l_string|&quot;Narrow&quot;
comma
(paren
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_offset
op_ne
l_int|0
)paren
ques
c_cond
l_string|&quot;Sync transfers at &quot;
suffix:colon
l_string|&quot;Async transfers.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_offset
op_ne
l_int|0
)paren
(brace
r_struct
id|aic7xxx_syncrate
op_star
id|sync_rate
suffix:semicolon
r_int
r_char
id|options
op_assign
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_options
suffix:semicolon
r_int
id|period
op_assign
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_period
suffix:semicolon
r_int
id|rate
op_assign
(paren
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_width
op_eq
id|MSG_EXT_WDTR_BUS_16_BIT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|sync_rate
op_assign
id|aic7xxx_find_syncrate
c_func
(paren
id|p
comma
op_amp
id|period
comma
l_int|0
comma
op_amp
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sync_rate
op_ne
l_int|NULL
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%s MByte/sec, offset %d&bslash;n&quot;
comma
id|sync_rate-&gt;rate
(braket
id|rate
)braket
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_offset
)paren
suffix:semicolon
)brace
r_else
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;3.3 MByte/sec, offset %d&bslash;n&quot;
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_offset
)paren
suffix:semicolon
)brace
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  Transinfo settings: &quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;current(%d/%d/%d/%d), &quot;
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_period
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_offset
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_width
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|cur_options
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;goal(%d/%d/%d/%d), &quot;
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|goal_period
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|goal_offset
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|goal_width
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|goal_options
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;user(%d/%d/%d/%d)&bslash;n&quot;
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|user_period
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|user_offset
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|user_width
comma
id|p-&gt;transinfo
(braket
id|target
)braket
dot
id|user_options
)paren
suffix:semicolon
macro_line|#ifdef AIC7XXX_PROC_STATS
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  Total transfers %ld (%ld reads and %ld writes)&bslash;n&quot;
comma
id|sp-&gt;r_total
op_plus
id|sp-&gt;w_total
comma
id|sp-&gt;r_total
comma
id|sp-&gt;w_total
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|HDRB
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;   Reads:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMBER
c_func
(paren
id|sp-&gt;r_bins
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot; %7ld&quot;
comma
id|sp-&gt;r_bins
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  Writes:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMBER
c_func
(paren
id|sp-&gt;w_bins
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot; %7ld&quot;
comma
id|sp-&gt;w_bins
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;  Total transfers %ld (%ld reads and %ld writes)&bslash;n&quot;
comma
id|sp-&gt;r_total
op_plus
id|sp-&gt;w_total
comma
id|sp-&gt;r_total
comma
id|sp-&gt;w_total
)paren
suffix:semicolon
macro_line|#endif /* AIC7XXX_PROC_STATS */
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_ge
id|aic7xxx_buffer_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;aic7xxx: Overflow in aic7xxx_proc.c&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
OG
id|size
op_minus
l_int|1
)paren
(brace
id|kfree
c_func
(paren
id|aic7xxx_buffer
)paren
suffix:semicolon
id|aic7xxx_buffer
op_assign
l_int|NULL
suffix:semicolon
id|aic7xxx_buffer_size
op_assign
id|length
op_assign
l_int|0
suffix:semicolon
op_star
id|start
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
op_star
id|start
op_assign
id|buffer
suffix:semicolon
id|length
op_assign
id|MIN
c_func
(paren
id|length
comma
id|size
op_minus
id|offset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
op_amp
id|aic7xxx_buffer
(braket
id|offset
)braket
comma
id|length
)paren
suffix:semicolon
)brace
r_return
(paren
id|length
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-indent-level: 2&n; * c-brace-imaginary-offset: 0&n; * c-brace-offset: -2&n; * c-argdecl-indent: 2&n; * c-label-offset: -2&n; * c-continued-statement-offset: 2&n; * c-continued-brace-offset: 0&n; * indent-tabs-mode: nil&n; * tab-width: 8&n; * End:&n; */
eof
