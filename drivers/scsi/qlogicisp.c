multiline_comment|/*&n; * QLogic ISP1020 Intelligent SCSI Processor Driver (PCI)&n; * Written by Erik H. Moe, ehm@cris.com&n; * Copyright 1995, Erik H. Moe&n; * Copyright 1996, 1997  Michael A. Griffith &lt;grif@acm.org&gt;&n; * Copyright 2000, Jayson C. Vantuyl &lt;vantuyl@csc.smsu.edu&gt;&n; *             and Bryon W. Roche    &lt;bryon@csc.smsu.edu&gt;&n; *&n; * 64-bit addressing added by Kanoj Sarcar &lt;kanoj@sgi.com&gt;&n; * &t;&t;&t;   and Leo Dagum    &lt;dagum@sgi.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2, or (at your option) any&n; * later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; */
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &quot;sd.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;qlogicisp.h&quot;
multiline_comment|/* Configuration section *****************************************************/
multiline_comment|/* Set the following macro to 1 to reload the ISP1020&squot;s firmware.  This is&n;   the latest firmware provided by QLogic.  This may be an earlier/later&n;   revision than supplied by your board. */
DECL|macro|RELOAD_FIRMWARE
mdefine_line|#define RELOAD_FIRMWARE&t;&t;1
multiline_comment|/* Set the following macro to 1 to reload the ISP1020&squot;s defaults from nvram.&n;   If you are not sure of your settings, leave this alone, the driver will&n;   use a set of &squot;safe&squot; defaults */
DECL|macro|USE_NVRAM_DEFAULTS
mdefine_line|#define USE_NVRAM_DEFAULTS&t;0
multiline_comment|/*  Macros used for debugging */
DECL|macro|DEBUG_ISP1020
mdefine_line|#define DEBUG_ISP1020&t;&t;0
DECL|macro|DEBUG_ISP1020_INTR
mdefine_line|#define DEBUG_ISP1020_INTR&t;0
DECL|macro|DEBUG_ISP1020_SETUP
mdefine_line|#define DEBUG_ISP1020_SETUP&t;0
DECL|macro|TRACE_ISP
mdefine_line|#define TRACE_ISP&t;&t;0
DECL|macro|DEFAULT_LOOP_COUNT
mdefine_line|#define DEFAULT_LOOP_COUNT&t;1000000
DECL|macro|LinuxVersionCode
mdefine_line|#define LinuxVersionCode(v, p, s) (((v)&lt;&lt;16)+((p)&lt;&lt;8)+(s))
multiline_comment|/* End Configuration section *************************************************/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#if TRACE_ISP
DECL|macro|TRACE_BUF_LEN
macro_line|# define TRACE_BUF_LEN&t;(32*1024)
r_struct
(brace
DECL|member|next
id|u_long
id|next
suffix:semicolon
r_struct
(brace
DECL|member|time
id|u_long
id|time
suffix:semicolon
DECL|member|index
id|u_int
id|index
suffix:semicolon
DECL|member|addr
id|u_int
id|addr
suffix:semicolon
DECL|member|name
id|u_char
op_star
id|name
suffix:semicolon
DECL|member|buf
)brace
id|buf
(braket
id|TRACE_BUF_LEN
)braket
suffix:semicolon
DECL|variable|trace
)brace
id|trace
suffix:semicolon
DECL|macro|TRACE
mdefine_line|#define TRACE(w, i, a)&t;&t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned long flags;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;save_flags(flags);&t;&t;&t;&t;&t;&bslash;&n;&t;cli();&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;trace.buf[trace.next].name  = (w);&t;&t;&t;&bslash;&n;&t;trace.buf[trace.next].time  = jiffies;&t;&t;&t;&bslash;&n;&t;trace.buf[trace.next].index = (i);&t;&t;&t;&bslash;&n;&t;trace.buf[trace.next].addr  = (long) (a);&t;&t;&bslash;&n;&t;trace.next = (trace.next + 1) &amp; (TRACE_BUF_LEN - 1);&t;&bslash;&n;&t;restore_flags(flags);&t;&t;&t;&t;&t;&bslash;&n;}
macro_line|#else
DECL|macro|TRACE
macro_line|# define TRACE(w, i, a)
macro_line|#endif
macro_line|#if DEBUG_ISP1020
DECL|macro|ENTER
mdefine_line|#define ENTER(x)&t;printk(&quot;isp1020 : entering %s()&bslash;n&quot;, x);
DECL|macro|LEAVE
mdefine_line|#define LEAVE(x)&t;printk(&quot;isp1020 : leaving %s()&bslash;n&quot;, x);
DECL|macro|DEBUG
mdefine_line|#define DEBUG(x)&t;x
macro_line|#else
DECL|macro|ENTER
mdefine_line|#define ENTER(x)
DECL|macro|LEAVE
mdefine_line|#define LEAVE(x)
DECL|macro|DEBUG
mdefine_line|#define DEBUG(x)
macro_line|#endif /* DEBUG_ISP1020 */
macro_line|#if DEBUG_ISP1020_INTR
DECL|macro|ENTER_INTR
mdefine_line|#define ENTER_INTR(x)&t;printk(&quot;isp1020 : entering %s()&bslash;n&quot;, x);
DECL|macro|LEAVE_INTR
mdefine_line|#define LEAVE_INTR(x)&t;printk(&quot;isp1020 : leaving %s()&bslash;n&quot;, x);
DECL|macro|DEBUG_INTR
mdefine_line|#define DEBUG_INTR(x)&t;x
macro_line|#else
DECL|macro|ENTER_INTR
mdefine_line|#define ENTER_INTR(x)
DECL|macro|LEAVE_INTR
mdefine_line|#define LEAVE_INTR(x)
DECL|macro|DEBUG_INTR
mdefine_line|#define DEBUG_INTR(x)
macro_line|#endif /* DEBUG ISP1020_INTR */
DECL|macro|ISP1020_REV_ID
mdefine_line|#define ISP1020_REV_ID&t;1
DECL|macro|MAX_TARGETS
mdefine_line|#define MAX_TARGETS&t;16
DECL|macro|MAX_LUNS
mdefine_line|#define MAX_LUNS&t;8
multiline_comment|/* host configuration and control registers */
DECL|macro|HOST_HCCR
mdefine_line|#define HOST_HCCR&t;0xc0&t;/* host command and control */
multiline_comment|/* pci bus interface registers */
DECL|macro|PCI_ID_LOW
mdefine_line|#define PCI_ID_LOW&t;0x00&t;/* vendor id */
DECL|macro|PCI_ID_HIGH
mdefine_line|#define PCI_ID_HIGH&t;0x02&t;/* device id */
DECL|macro|ISP_CFG0
mdefine_line|#define ISP_CFG0&t;0x04&t;/* configuration register #0 */
DECL|macro|ISP_CFG0_HWMSK
mdefine_line|#define  ISP_CFG0_HWMSK  0x000f&t;/* Hardware revision mask */
DECL|macro|ISP_CFG0_1020
mdefine_line|#define  ISP_CFG0_1020&t; 0x0001 /* ISP1020 */
DECL|macro|ISP_CFG0_1020A
mdefine_line|#define  ISP_CFG0_1020A&t; 0x0002 /* ISP1020A */
DECL|macro|ISP_CFG0_1040
mdefine_line|#define  ISP_CFG0_1040&t; 0x0003 /* ISP1040 */
DECL|macro|ISP_CFG0_1040A
mdefine_line|#define  ISP_CFG0_1040A&t; 0x0004 /* ISP1040A */
DECL|macro|ISP_CFG0_1040B
mdefine_line|#define  ISP_CFG0_1040B&t; 0x0005 /* ISP1040B */
DECL|macro|ISP_CFG0_1040C
mdefine_line|#define  ISP_CFG0_1040C&t; 0x0006 /* ISP1040C */
DECL|macro|ISP_CFG1
mdefine_line|#define ISP_CFG1&t;0x06&t;/* configuration register #1 */
DECL|macro|ISP_CFG1_F128
mdefine_line|#define  ISP_CFG1_F128&t; 0x0040&t;/* 128-byte FIFO threshold */
DECL|macro|ISP_CFG1_F64
mdefine_line|#define  ISP_CFG1_F64&t; 0x0030&t;/* 128-byte FIFO threshold */
DECL|macro|ISP_CFG1_F32
mdefine_line|#define  ISP_CFG1_F32&t; 0x0020&t;/* 128-byte FIFO threshold */
DECL|macro|ISP_CFG1_F16
mdefine_line|#define  ISP_CFG1_F16&t; 0x0010&t;/* 128-byte FIFO threshold */
DECL|macro|ISP_CFG1_BENAB
mdefine_line|#define  ISP_CFG1_BENAB&t; 0x0004&t;/* Global Bus burst enable */
DECL|macro|ISP_CFG1_SXP
mdefine_line|#define  ISP_CFG1_SXP&t; 0x0001&t;/* SXP register select */
DECL|macro|PCI_INTF_CTL
mdefine_line|#define PCI_INTF_CTL&t;0x08&t;/* pci interface control */
DECL|macro|PCI_INTF_STS
mdefine_line|#define PCI_INTF_STS&t;0x0a&t;/* pci interface status */
DECL|macro|PCI_SEMAPHORE
mdefine_line|#define PCI_SEMAPHORE&t;0x0c&t;/* pci semaphore */
DECL|macro|PCI_NVRAM
mdefine_line|#define PCI_NVRAM&t;0x0e&t;/* pci nvram interface */
DECL|macro|CDMA_CONF
mdefine_line|#define CDMA_CONF&t;0x20&t;/* Command DMA Config */
DECL|macro|DDMA_CONF
mdefine_line|#define DDMA_CONF&t;0x40&t;/* Data DMA Config */
DECL|macro|DMA_CONF_SENAB
mdefine_line|#define  DMA_CONF_SENAB&t; 0x0008&t;/* SXP to DMA Data enable */
DECL|macro|DMA_CONF_RIRQ
mdefine_line|#define  DMA_CONF_RIRQ&t; 0x0004&t;/* RISC interrupt enable */
DECL|macro|DMA_CONF_BENAB
mdefine_line|#define  DMA_CONF_BENAB&t; 0x0002&t;/* Bus burst enable */
DECL|macro|DMA_CONF_DIR
mdefine_line|#define  DMA_CONF_DIR&t; 0x0001&t;/* DMA direction (0=fifo-&gt;host 1=host-&gt;fifo) */
multiline_comment|/* mailbox registers */
DECL|macro|MBOX0
mdefine_line|#define MBOX0&t;&t;0x70&t;/* mailbox 0 */
DECL|macro|MBOX1
mdefine_line|#define MBOX1&t;&t;0x72&t;/* mailbox 1 */
DECL|macro|MBOX2
mdefine_line|#define MBOX2&t;&t;0x74&t;/* mailbox 2 */
DECL|macro|MBOX3
mdefine_line|#define MBOX3&t;&t;0x76&t;/* mailbox 3 */
DECL|macro|MBOX4
mdefine_line|#define MBOX4&t;&t;0x78&t;/* mailbox 4 */
DECL|macro|MBOX5
mdefine_line|#define MBOX5&t;&t;0x7a&t;/* mailbox 5 */
DECL|macro|MBOX6
mdefine_line|#define MBOX6           0x7c    /* mailbox 6 */
DECL|macro|MBOX7
mdefine_line|#define MBOX7           0x7e    /* mailbox 7 */
multiline_comment|/* mailbox command complete status codes */
DECL|macro|MBOX_COMMAND_COMPLETE
mdefine_line|#define MBOX_COMMAND_COMPLETE&t;&t;0x4000
DECL|macro|INVALID_COMMAND
mdefine_line|#define INVALID_COMMAND&t;&t;&t;0x4001
DECL|macro|HOST_INTERFACE_ERROR
mdefine_line|#define HOST_INTERFACE_ERROR&t;&t;0x4002
DECL|macro|TEST_FAILED
mdefine_line|#define TEST_FAILED&t;&t;&t;0x4003
DECL|macro|COMMAND_ERROR
mdefine_line|#define COMMAND_ERROR&t;&t;&t;0x4005
DECL|macro|COMMAND_PARAM_ERROR
mdefine_line|#define COMMAND_PARAM_ERROR&t;&t;0x4006
multiline_comment|/* async event status codes */
DECL|macro|ASYNC_SCSI_BUS_RESET
mdefine_line|#define ASYNC_SCSI_BUS_RESET&t;&t;0x8001
DECL|macro|SYSTEM_ERROR
mdefine_line|#define SYSTEM_ERROR&t;&t;&t;0x8002
DECL|macro|REQUEST_TRANSFER_ERROR
mdefine_line|#define REQUEST_TRANSFER_ERROR&t;&t;0x8003
DECL|macro|RESPONSE_TRANSFER_ERROR
mdefine_line|#define RESPONSE_TRANSFER_ERROR&t;&t;0x8004
DECL|macro|REQUEST_QUEUE_WAKEUP
mdefine_line|#define REQUEST_QUEUE_WAKEUP&t;&t;0x8005
DECL|macro|EXECUTION_TIMEOUT_RESET
mdefine_line|#define EXECUTION_TIMEOUT_RESET&t;&t;0x8006
macro_line|#ifdef CONFIG_QL_ISP_A64
DECL|macro|IOCB_SEGS
mdefine_line|#define IOCB_SEGS                       2
DECL|macro|CONTINUATION_SEGS
mdefine_line|#define CONTINUATION_SEGS               5
DECL|macro|MAX_CONTINUATION_ENTRIES
mdefine_line|#define MAX_CONTINUATION_ENTRIES        254
macro_line|#else
DECL|macro|IOCB_SEGS
mdefine_line|#define IOCB_SEGS                       4
DECL|macro|CONTINUATION_SEGS
mdefine_line|#define CONTINUATION_SEGS               7
macro_line|#endif /* CONFIG_QL_ISP_A64 */
DECL|struct|Entry_header
r_struct
id|Entry_header
(brace
DECL|member|entry_type
id|u_char
id|entry_type
suffix:semicolon
DECL|member|entry_cnt
id|u_char
id|entry_cnt
suffix:semicolon
DECL|member|sys_def_1
id|u_char
id|sys_def_1
suffix:semicolon
DECL|member|flags
id|u_char
id|flags
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* entry header type commands */
macro_line|#ifdef CONFIG_QL_ISP_A64
DECL|macro|ENTRY_COMMAND
mdefine_line|#define ENTRY_COMMAND           9
DECL|macro|ENTRY_CONTINUATION
mdefine_line|#define ENTRY_CONTINUATION      0xa
macro_line|#else
DECL|macro|ENTRY_COMMAND
mdefine_line|#define ENTRY_COMMAND&t;&t;1
DECL|macro|ENTRY_CONTINUATION
mdefine_line|#define ENTRY_CONTINUATION&t;2
macro_line|#endif /* CONFIG_QL_ISP_A64 */
DECL|macro|ENTRY_STATUS
mdefine_line|#define ENTRY_STATUS&t;&t;3
DECL|macro|ENTRY_MARKER
mdefine_line|#define ENTRY_MARKER&t;&t;4
DECL|macro|ENTRY_EXTENDED_COMMAND
mdefine_line|#define ENTRY_EXTENDED_COMMAND&t;5
multiline_comment|/* entry header flag definitions */
DECL|macro|EFLAG_CONTINUATION
mdefine_line|#define EFLAG_CONTINUATION&t;1
DECL|macro|EFLAG_BUSY
mdefine_line|#define EFLAG_BUSY&t;&t;2
DECL|macro|EFLAG_BAD_HEADER
mdefine_line|#define EFLAG_BAD_HEADER&t;4
DECL|macro|EFLAG_BAD_PAYLOAD
mdefine_line|#define EFLAG_BAD_PAYLOAD&t;8
DECL|struct|dataseg
r_struct
id|dataseg
(brace
DECL|member|d_base
id|u_int
id|d_base
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
DECL|member|d_base_hi
id|u_int
id|d_base_hi
suffix:semicolon
macro_line|#endif
DECL|member|d_count
id|u_int
id|d_count
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|Command_Entry
r_struct
id|Command_Entry
(brace
DECL|member|hdr
r_struct
id|Entry_header
id|hdr
suffix:semicolon
DECL|member|handle
id|u_int
id|handle
suffix:semicolon
DECL|member|target_lun
id|u_char
id|target_lun
suffix:semicolon
DECL|member|target_id
id|u_char
id|target_id
suffix:semicolon
DECL|member|cdb_length
id|u_short
id|cdb_length
suffix:semicolon
DECL|member|control_flags
id|u_short
id|control_flags
suffix:semicolon
DECL|member|rsvd
id|u_short
id|rsvd
suffix:semicolon
DECL|member|time_out
id|u_short
id|time_out
suffix:semicolon
DECL|member|segment_cnt
id|u_short
id|segment_cnt
suffix:semicolon
DECL|member|cdb
id|u_char
id|cdb
(braket
l_int|12
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
DECL|member|rsvd1
id|u_int
id|rsvd1
suffix:semicolon
DECL|member|rsvd2
id|u_int
id|rsvd2
suffix:semicolon
macro_line|#endif
DECL|member|dataseg
r_struct
id|dataseg
id|dataseg
(braket
id|IOCB_SEGS
)braket
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* command entry control flag definitions */
DECL|macro|CFLAG_NODISC
mdefine_line|#define CFLAG_NODISC&t;&t;0x01
DECL|macro|CFLAG_HEAD_TAG
mdefine_line|#define CFLAG_HEAD_TAG&t;&t;0x02
DECL|macro|CFLAG_ORDERED_TAG
mdefine_line|#define CFLAG_ORDERED_TAG&t;0x04
DECL|macro|CFLAG_SIMPLE_TAG
mdefine_line|#define CFLAG_SIMPLE_TAG&t;0x08
DECL|macro|CFLAG_TAR_RTN
mdefine_line|#define CFLAG_TAR_RTN&t;&t;0x10
DECL|macro|CFLAG_READ
mdefine_line|#define CFLAG_READ&t;&t;0x20
DECL|macro|CFLAG_WRITE
mdefine_line|#define CFLAG_WRITE&t;&t;0x40
DECL|struct|Ext_Command_Entry
r_struct
id|Ext_Command_Entry
(brace
DECL|member|hdr
r_struct
id|Entry_header
id|hdr
suffix:semicolon
DECL|member|handle
id|u_int
id|handle
suffix:semicolon
DECL|member|target_lun
id|u_char
id|target_lun
suffix:semicolon
DECL|member|target_id
id|u_char
id|target_id
suffix:semicolon
DECL|member|cdb_length
id|u_short
id|cdb_length
suffix:semicolon
DECL|member|control_flags
id|u_short
id|control_flags
suffix:semicolon
DECL|member|rsvd
id|u_short
id|rsvd
suffix:semicolon
DECL|member|time_out
id|u_short
id|time_out
suffix:semicolon
DECL|member|segment_cnt
id|u_short
id|segment_cnt
suffix:semicolon
DECL|member|cdb
id|u_char
id|cdb
(braket
l_int|44
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|Continuation_Entry
r_struct
id|Continuation_Entry
(brace
DECL|member|hdr
r_struct
id|Entry_header
id|hdr
suffix:semicolon
macro_line|#ifndef CONFIG_QL_ISP_A64
DECL|member|reserved
id|u_int
id|reserved
suffix:semicolon
macro_line|#endif
DECL|member|dataseg
r_struct
id|dataseg
id|dataseg
(braket
id|CONTINUATION_SEGS
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|Marker_Entry
r_struct
id|Marker_Entry
(brace
DECL|member|hdr
r_struct
id|Entry_header
id|hdr
suffix:semicolon
DECL|member|reserved
id|u_int
id|reserved
suffix:semicolon
DECL|member|target_lun
id|u_char
id|target_lun
suffix:semicolon
DECL|member|target_id
id|u_char
id|target_id
suffix:semicolon
DECL|member|modifier
id|u_char
id|modifier
suffix:semicolon
DECL|member|rsvd
id|u_char
id|rsvd
suffix:semicolon
DECL|member|rsvds
id|u_char
id|rsvds
(braket
l_int|52
)braket
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* marker entry modifier definitions */
DECL|macro|SYNC_DEVICE
mdefine_line|#define SYNC_DEVICE&t;0
DECL|macro|SYNC_TARGET
mdefine_line|#define SYNC_TARGET&t;1
DECL|macro|SYNC_ALL
mdefine_line|#define SYNC_ALL&t;2
DECL|struct|Status_Entry
r_struct
id|Status_Entry
(brace
DECL|member|hdr
r_struct
id|Entry_header
id|hdr
suffix:semicolon
DECL|member|handle
id|u_int
id|handle
suffix:semicolon
DECL|member|scsi_status
id|u_short
id|scsi_status
suffix:semicolon
DECL|member|completion_status
id|u_short
id|completion_status
suffix:semicolon
DECL|member|state_flags
id|u_short
id|state_flags
suffix:semicolon
DECL|member|status_flags
id|u_short
id|status_flags
suffix:semicolon
DECL|member|time
id|u_short
id|time
suffix:semicolon
DECL|member|req_sense_len
id|u_short
id|req_sense_len
suffix:semicolon
DECL|member|residual
id|u_int
id|residual
suffix:semicolon
DECL|member|rsvd
id|u_char
id|rsvd
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|req_sense_data
id|u_char
id|req_sense_data
(braket
l_int|32
)braket
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* status entry completion status definitions */
DECL|macro|CS_COMPLETE
mdefine_line|#define CS_COMPLETE&t;&t;&t;0x0000
DECL|macro|CS_INCOMPLETE
mdefine_line|#define CS_INCOMPLETE&t;&t;&t;0x0001
DECL|macro|CS_DMA_ERROR
mdefine_line|#define CS_DMA_ERROR&t;&t;&t;0x0002
DECL|macro|CS_TRANSPORT_ERROR
mdefine_line|#define CS_TRANSPORT_ERROR&t;&t;0x0003
DECL|macro|CS_RESET_OCCURRED
mdefine_line|#define CS_RESET_OCCURRED&t;&t;0x0004
DECL|macro|CS_ABORTED
mdefine_line|#define CS_ABORTED&t;&t;&t;0x0005
DECL|macro|CS_TIMEOUT
mdefine_line|#define CS_TIMEOUT&t;&t;&t;0x0006
DECL|macro|CS_DATA_OVERRUN
mdefine_line|#define CS_DATA_OVERRUN&t;&t;&t;0x0007
DECL|macro|CS_COMMAND_OVERRUN
mdefine_line|#define CS_COMMAND_OVERRUN&t;&t;0x0008
DECL|macro|CS_STATUS_OVERRUN
mdefine_line|#define CS_STATUS_OVERRUN&t;&t;0x0009
DECL|macro|CS_BAD_MESSAGE
mdefine_line|#define CS_BAD_MESSAGE&t;&t;&t;0x000a
DECL|macro|CS_NO_MESSAGE_OUT
mdefine_line|#define CS_NO_MESSAGE_OUT&t;&t;0x000b
DECL|macro|CS_EXT_ID_FAILED
mdefine_line|#define CS_EXT_ID_FAILED&t;&t;0x000c
DECL|macro|CS_IDE_MSG_FAILED
mdefine_line|#define CS_IDE_MSG_FAILED&t;&t;0x000d
DECL|macro|CS_ABORT_MSG_FAILED
mdefine_line|#define CS_ABORT_MSG_FAILED&t;&t;0x000e
DECL|macro|CS_REJECT_MSG_FAILED
mdefine_line|#define CS_REJECT_MSG_FAILED&t;&t;0x000f
DECL|macro|CS_NOP_MSG_FAILED
mdefine_line|#define CS_NOP_MSG_FAILED&t;&t;0x0010
DECL|macro|CS_PARITY_ERROR_MSG_FAILED
mdefine_line|#define CS_PARITY_ERROR_MSG_FAILED&t;0x0011
DECL|macro|CS_DEVICE_RESET_MSG_FAILED
mdefine_line|#define CS_DEVICE_RESET_MSG_FAILED&t;0x0012
DECL|macro|CS_ID_MSG_FAILED
mdefine_line|#define CS_ID_MSG_FAILED&t;&t;0x0013
DECL|macro|CS_UNEXP_BUS_FREE
mdefine_line|#define CS_UNEXP_BUS_FREE&t;&t;0x0014
DECL|macro|CS_DATA_UNDERRUN
mdefine_line|#define CS_DATA_UNDERRUN&t;&t;0x0015
multiline_comment|/* status entry state flag definitions */
DECL|macro|SF_GOT_BUS
mdefine_line|#define SF_GOT_BUS&t;&t;&t;0x0100
DECL|macro|SF_GOT_TARGET
mdefine_line|#define SF_GOT_TARGET&t;&t;&t;0x0200
DECL|macro|SF_SENT_CDB
mdefine_line|#define SF_SENT_CDB&t;&t;&t;0x0400
DECL|macro|SF_TRANSFERRED_DATA
mdefine_line|#define SF_TRANSFERRED_DATA&t;&t;0x0800
DECL|macro|SF_GOT_STATUS
mdefine_line|#define SF_GOT_STATUS&t;&t;&t;0x1000
DECL|macro|SF_GOT_SENSE
mdefine_line|#define SF_GOT_SENSE&t;&t;&t;0x2000
multiline_comment|/* status entry status flag definitions */
DECL|macro|STF_DISCONNECT
mdefine_line|#define STF_DISCONNECT&t;&t;&t;0x0001
DECL|macro|STF_SYNCHRONOUS
mdefine_line|#define STF_SYNCHRONOUS&t;&t;&t;0x0002
DECL|macro|STF_PARITY_ERROR
mdefine_line|#define STF_PARITY_ERROR&t;&t;0x0004
DECL|macro|STF_BUS_RESET
mdefine_line|#define STF_BUS_RESET&t;&t;&t;0x0008
DECL|macro|STF_DEVICE_RESET
mdefine_line|#define STF_DEVICE_RESET&t;&t;0x0010
DECL|macro|STF_ABORTED
mdefine_line|#define STF_ABORTED&t;&t;&t;0x0020
DECL|macro|STF_TIMEOUT
mdefine_line|#define STF_TIMEOUT&t;&t;&t;0x0040
DECL|macro|STF_NEGOTIATION
mdefine_line|#define STF_NEGOTIATION&t;&t;&t;0x0080
multiline_comment|/* interface control commands */
DECL|macro|ISP_RESET
mdefine_line|#define ISP_RESET&t;&t;&t;0x0001
DECL|macro|ISP_EN_INT
mdefine_line|#define ISP_EN_INT&t;&t;&t;0x0002
DECL|macro|ISP_EN_RISC
mdefine_line|#define ISP_EN_RISC&t;&t;&t;0x0004
multiline_comment|/* host control commands */
DECL|macro|HCCR_NOP
mdefine_line|#define HCCR_NOP&t;&t;&t;0x0000
DECL|macro|HCCR_RESET
mdefine_line|#define HCCR_RESET&t;&t;&t;0x1000
DECL|macro|HCCR_PAUSE
mdefine_line|#define HCCR_PAUSE&t;&t;&t;0x2000
DECL|macro|HCCR_RELEASE
mdefine_line|#define HCCR_RELEASE&t;&t;&t;0x3000
DECL|macro|HCCR_SINGLE_STEP
mdefine_line|#define HCCR_SINGLE_STEP&t;&t;0x4000
DECL|macro|HCCR_SET_HOST_INTR
mdefine_line|#define HCCR_SET_HOST_INTR&t;&t;0x5000
DECL|macro|HCCR_CLEAR_HOST_INTR
mdefine_line|#define HCCR_CLEAR_HOST_INTR&t;&t;0x6000
DECL|macro|HCCR_CLEAR_RISC_INTR
mdefine_line|#define HCCR_CLEAR_RISC_INTR&t;&t;0x7000
DECL|macro|HCCR_BP_ENABLE
mdefine_line|#define HCCR_BP_ENABLE&t;&t;&t;0x8000
DECL|macro|HCCR_BIOS_DISABLE
mdefine_line|#define HCCR_BIOS_DISABLE&t;&t;0x9000
DECL|macro|HCCR_TEST_MODE
mdefine_line|#define HCCR_TEST_MODE&t;&t;&t;0xf000
DECL|macro|RISC_BUSY
mdefine_line|#define RISC_BUSY&t;&t;&t;0x0004
multiline_comment|/* mailbox commands */
DECL|macro|MBOX_NO_OP
mdefine_line|#define MBOX_NO_OP&t;&t;&t;0x0000
DECL|macro|MBOX_LOAD_RAM
mdefine_line|#define MBOX_LOAD_RAM&t;&t;&t;0x0001
DECL|macro|MBOX_EXEC_FIRMWARE
mdefine_line|#define MBOX_EXEC_FIRMWARE&t;&t;0x0002
DECL|macro|MBOX_DUMP_RAM
mdefine_line|#define MBOX_DUMP_RAM&t;&t;&t;0x0003
DECL|macro|MBOX_WRITE_RAM_WORD
mdefine_line|#define MBOX_WRITE_RAM_WORD&t;&t;0x0004
DECL|macro|MBOX_READ_RAM_WORD
mdefine_line|#define MBOX_READ_RAM_WORD&t;&t;0x0005
DECL|macro|MBOX_MAILBOX_REG_TEST
mdefine_line|#define MBOX_MAILBOX_REG_TEST&t;&t;0x0006
DECL|macro|MBOX_VERIFY_CHECKSUM
mdefine_line|#define MBOX_VERIFY_CHECKSUM&t;&t;0x0007
DECL|macro|MBOX_ABOUT_FIRMWARE
mdefine_line|#define MBOX_ABOUT_FIRMWARE&t;&t;0x0008
DECL|macro|MBOX_CHECK_FIRMWARE
mdefine_line|#define MBOX_CHECK_FIRMWARE&t;&t;0x000e
DECL|macro|MBOX_INIT_REQ_QUEUE
mdefine_line|#define MBOX_INIT_REQ_QUEUE&t;&t;0x0010
DECL|macro|MBOX_INIT_RES_QUEUE
mdefine_line|#define MBOX_INIT_RES_QUEUE&t;&t;0x0011
DECL|macro|MBOX_EXECUTE_IOCB
mdefine_line|#define MBOX_EXECUTE_IOCB&t;&t;0x0012
DECL|macro|MBOX_WAKE_UP
mdefine_line|#define MBOX_WAKE_UP&t;&t;&t;0x0013
DECL|macro|MBOX_STOP_FIRMWARE
mdefine_line|#define MBOX_STOP_FIRMWARE&t;&t;0x0014
DECL|macro|MBOX_ABORT
mdefine_line|#define MBOX_ABORT&t;&t;&t;0x0015
DECL|macro|MBOX_ABORT_DEVICE
mdefine_line|#define MBOX_ABORT_DEVICE&t;&t;0x0016
DECL|macro|MBOX_ABORT_TARGET
mdefine_line|#define MBOX_ABORT_TARGET&t;&t;0x0017
DECL|macro|MBOX_BUS_RESET
mdefine_line|#define MBOX_BUS_RESET&t;&t;&t;0x0018
DECL|macro|MBOX_STOP_QUEUE
mdefine_line|#define MBOX_STOP_QUEUE&t;&t;&t;0x0019
DECL|macro|MBOX_START_QUEUE
mdefine_line|#define MBOX_START_QUEUE&t;&t;0x001a
DECL|macro|MBOX_SINGLE_STEP_QUEUE
mdefine_line|#define MBOX_SINGLE_STEP_QUEUE&t;&t;0x001b
DECL|macro|MBOX_ABORT_QUEUE
mdefine_line|#define MBOX_ABORT_QUEUE&t;&t;0x001c
DECL|macro|MBOX_GET_DEV_QUEUE_STATUS
mdefine_line|#define MBOX_GET_DEV_QUEUE_STATUS&t;0x001d
DECL|macro|MBOX_GET_FIRMWARE_STATUS
mdefine_line|#define MBOX_GET_FIRMWARE_STATUS&t;0x001f
DECL|macro|MBOX_GET_INIT_SCSI_ID
mdefine_line|#define MBOX_GET_INIT_SCSI_ID&t;&t;0x0020
DECL|macro|MBOX_GET_SELECT_TIMEOUT
mdefine_line|#define MBOX_GET_SELECT_TIMEOUT&t;&t;0x0021
DECL|macro|MBOX_GET_RETRY_COUNT
mdefine_line|#define MBOX_GET_RETRY_COUNT&t;&t;0x0022
DECL|macro|MBOX_GET_TAG_AGE_LIMIT
mdefine_line|#define MBOX_GET_TAG_AGE_LIMIT&t;&t;0x0023
DECL|macro|MBOX_GET_CLOCK_RATE
mdefine_line|#define MBOX_GET_CLOCK_RATE&t;&t;0x0024
DECL|macro|MBOX_GET_ACT_NEG_STATE
mdefine_line|#define MBOX_GET_ACT_NEG_STATE&t;&t;0x0025
DECL|macro|MBOX_GET_ASYNC_DATA_SETUP_TIME
mdefine_line|#define MBOX_GET_ASYNC_DATA_SETUP_TIME&t;0x0026
DECL|macro|MBOX_GET_PCI_PARAMS
mdefine_line|#define MBOX_GET_PCI_PARAMS&t;&t;0x0027
DECL|macro|MBOX_GET_TARGET_PARAMS
mdefine_line|#define MBOX_GET_TARGET_PARAMS&t;&t;0x0028
DECL|macro|MBOX_GET_DEV_QUEUE_PARAMS
mdefine_line|#define MBOX_GET_DEV_QUEUE_PARAMS&t;0x0029
DECL|macro|MBOX_SET_INIT_SCSI_ID
mdefine_line|#define MBOX_SET_INIT_SCSI_ID&t;&t;0x0030
DECL|macro|MBOX_SET_SELECT_TIMEOUT
mdefine_line|#define MBOX_SET_SELECT_TIMEOUT&t;&t;0x0031
DECL|macro|MBOX_SET_RETRY_COUNT
mdefine_line|#define MBOX_SET_RETRY_COUNT&t;&t;0x0032
DECL|macro|MBOX_SET_TAG_AGE_LIMIT
mdefine_line|#define MBOX_SET_TAG_AGE_LIMIT&t;&t;0x0033
DECL|macro|MBOX_SET_CLOCK_RATE
mdefine_line|#define MBOX_SET_CLOCK_RATE&t;&t;0x0034
DECL|macro|MBOX_SET_ACTIVE_NEG_STATE
mdefine_line|#define MBOX_SET_ACTIVE_NEG_STATE&t;0x0035
DECL|macro|MBOX_SET_ASYNC_DATA_SETUP_TIME
mdefine_line|#define MBOX_SET_ASYNC_DATA_SETUP_TIME&t;0x0036
DECL|macro|MBOX_SET_PCI_CONTROL_PARAMS
mdefine_line|#define MBOX_SET_PCI_CONTROL_PARAMS&t;0x0037
DECL|macro|MBOX_SET_TARGET_PARAMS
mdefine_line|#define MBOX_SET_TARGET_PARAMS&t;&t;0x0038
DECL|macro|MBOX_SET_DEV_QUEUE_PARAMS
mdefine_line|#define MBOX_SET_DEV_QUEUE_PARAMS&t;0x0039
DECL|macro|MBOX_RETURN_BIOS_BLOCK_ADDR
mdefine_line|#define MBOX_RETURN_BIOS_BLOCK_ADDR&t;0x0040
DECL|macro|MBOX_WRITE_FOUR_RAM_WORDS
mdefine_line|#define MBOX_WRITE_FOUR_RAM_WORDS&t;0x0041
DECL|macro|MBOX_EXEC_BIOS_IOCB
mdefine_line|#define MBOX_EXEC_BIOS_IOCB&t;&t;0x0042
macro_line|#ifdef CONFIG_QL_ISP_A64
DECL|macro|MBOX_CMD_INIT_REQUEST_QUEUE_64
mdefine_line|#define MBOX_CMD_INIT_REQUEST_QUEUE_64      0x0052
DECL|macro|MBOX_CMD_INIT_RESPONSE_QUEUE_64
mdefine_line|#define MBOX_CMD_INIT_RESPONSE_QUEUE_64     0x0053
macro_line|#endif /* CONFIG_QL_ISP_A64 */
macro_line|#include &quot;qlogicisp_asm.c&quot;
DECL|macro|PACKB
mdefine_line|#define PACKB(a, b)&t;&t;&t;(((a)&lt;&lt;4)|(b))
DECL|variable|mbox_param
r_static
r_const
id|u_char
id|mbox_param
(braket
)braket
op_assign
(brace
id|PACKB
c_func
(paren
l_int|1
comma
l_int|1
)paren
comma
multiline_comment|/* MBOX_NO_OP */
id|PACKB
c_func
(paren
l_int|5
comma
l_int|5
)paren
comma
multiline_comment|/* MBOX_LOAD_RAM */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|0
)paren
comma
multiline_comment|/* MBOX_EXEC_FIRMWARE */
id|PACKB
c_func
(paren
l_int|5
comma
l_int|5
)paren
comma
multiline_comment|/* MBOX_DUMP_RAM */
id|PACKB
c_func
(paren
l_int|3
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_WRITE_RAM_WORD */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_READ_RAM_WORD */
id|PACKB
c_func
(paren
l_int|6
comma
l_int|6
)paren
comma
multiline_comment|/* MBOX_MAILBOX_REG_TEST */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_VERIFY_CHECKSUM&t;*/
id|PACKB
c_func
(paren
l_int|1
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_ABOUT_FIRMWARE */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0009 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x000a */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x000b */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x000c */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x000d */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_CHECK_FIRMWARE */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x000f */
id|PACKB
c_func
(paren
l_int|5
comma
l_int|5
)paren
comma
multiline_comment|/* MBOX_INIT_REQ_QUEUE */
id|PACKB
c_func
(paren
l_int|6
comma
l_int|6
)paren
comma
multiline_comment|/* MBOX_INIT_RES_QUEUE */
id|PACKB
c_func
(paren
l_int|4
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_EXECUTE_IOCB */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_WAKE_UP&t;*/
id|PACKB
c_func
(paren
l_int|1
comma
l_int|6
)paren
comma
multiline_comment|/* MBOX_STOP_FIRMWARE */
id|PACKB
c_func
(paren
l_int|4
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_ABORT */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_ABORT_DEVICE */
id|PACKB
c_func
(paren
l_int|3
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_ABORT_TARGET */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_BUS_RESET */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_STOP_QUEUE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_START_QUEUE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_SINGLE_STEP_QUEUE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_ABORT_QUEUE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_GET_DEV_QUEUE_STATUS */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x001e */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_GET_FIRMWARE_STATUS */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_INIT_SCSI_ID */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_SELECT_TIMEOUT */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_GET_RETRY_COUNT&t;*/
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_TAG_AGE_LIMIT */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_CLOCK_RATE */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_ACT_NEG_STATE */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_GET_ASYNC_DATA_SETUP_TIME */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_GET_PCI_PARAMS */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_GET_TARGET_PARAMS */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_GET_DEV_QUEUE_PARAMS */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002a */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002b */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002c */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002d */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002e */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x002f */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_INIT_SCSI_ID */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_SELECT_TIMEOUT */
id|PACKB
c_func
(paren
l_int|3
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_SET_RETRY_COUNT&t;*/
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_TAG_AGE_LIMIT */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_CLOCK_RATE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_ACTIVE_NEG_STATE */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_SET_ASYNC_DATA_SETUP_TIME */
id|PACKB
c_func
(paren
l_int|3
comma
l_int|3
)paren
comma
multiline_comment|/* MBOX_SET_PCI_CONTROL_PARAMS */
id|PACKB
c_func
(paren
l_int|4
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_SET_TARGET_PARAMS */
id|PACKB
c_func
(paren
l_int|4
comma
l_int|4
)paren
comma
multiline_comment|/* MBOX_SET_DEV_QUEUE_PARAMS */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003a */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003b */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003c */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003d */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003e */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x003f */
id|PACKB
c_func
(paren
l_int|1
comma
l_int|2
)paren
comma
multiline_comment|/* MBOX_RETURN_BIOS_BLOCK_ADDR */
id|PACKB
c_func
(paren
l_int|6
comma
l_int|1
)paren
comma
multiline_comment|/* MBOX_WRITE_FOUR_RAM_WORDS */
id|PACKB
c_func
(paren
l_int|2
comma
l_int|3
)paren
multiline_comment|/* MBOX_EXEC_BIOS_IOCB */
macro_line|#ifdef CONFIG_QL_ISP_A64
comma
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0043 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0044 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0045 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0046 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0047 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0048 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0049 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004a */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004b */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004c */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004d */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004e */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x004f */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0050 */
id|PACKB
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* 0x0051 */
id|PACKB
c_func
(paren
l_int|8
comma
l_int|8
)paren
comma
multiline_comment|/* MBOX_CMD_INIT_REQUEST_QUEUE_64 (0x0052) */
id|PACKB
c_func
(paren
l_int|8
comma
l_int|8
)paren
multiline_comment|/* MBOX_CMD_INIT_RESPONSE_QUEUE_64 (0x0053) */
macro_line|#endif /* CONFIG_QL_ISP_A64 */
)brace
suffix:semicolon
DECL|macro|MAX_MBOX_COMMAND
mdefine_line|#define MAX_MBOX_COMMAND&t;(sizeof(mbox_param)/sizeof(u_short))
DECL|struct|host_param
r_struct
id|host_param
(brace
DECL|member|fifo_threshold
id|u_short
id|fifo_threshold
suffix:semicolon
DECL|member|host_adapter_enable
id|u_short
id|host_adapter_enable
suffix:semicolon
DECL|member|initiator_scsi_id
id|u_short
id|initiator_scsi_id
suffix:semicolon
DECL|member|bus_reset_delay
id|u_short
id|bus_reset_delay
suffix:semicolon
DECL|member|retry_count
id|u_short
id|retry_count
suffix:semicolon
DECL|member|retry_delay
id|u_short
id|retry_delay
suffix:semicolon
DECL|member|async_data_setup_time
id|u_short
id|async_data_setup_time
suffix:semicolon
DECL|member|req_ack_active_negation
id|u_short
id|req_ack_active_negation
suffix:semicolon
DECL|member|data_line_active_negation
id|u_short
id|data_line_active_negation
suffix:semicolon
DECL|member|data_dma_burst_enable
id|u_short
id|data_dma_burst_enable
suffix:semicolon
DECL|member|command_dma_burst_enable
id|u_short
id|command_dma_burst_enable
suffix:semicolon
DECL|member|tag_aging
id|u_short
id|tag_aging
suffix:semicolon
DECL|member|selection_timeout
id|u_short
id|selection_timeout
suffix:semicolon
DECL|member|max_queue_depth
id|u_short
id|max_queue_depth
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Device Flags:&n; *&n; * Bit  Name&n; * ---------&n; *  7   Disconnect Privilege&n; *  6   Parity Checking&n; *  5   Wide Data Transfers&n; *  4   Synchronous Data Transfers&n; *  3   Tagged Queuing&n; *  2   Automatic Request Sense&n; *  1   Stop Queue on Check Condition&n; *  0   Renegotiate on Error&n; */
DECL|struct|dev_param
r_struct
id|dev_param
(brace
DECL|member|device_flags
id|u_short
id|device_flags
suffix:semicolon
DECL|member|execution_throttle
id|u_short
id|execution_throttle
suffix:semicolon
DECL|member|synchronous_period
id|u_short
id|synchronous_period
suffix:semicolon
DECL|member|synchronous_offset
id|u_short
id|synchronous_offset
suffix:semicolon
DECL|member|device_enable
id|u_short
id|device_enable
suffix:semicolon
DECL|member|reserved
id|u_short
id|reserved
suffix:semicolon
multiline_comment|/* pad */
)brace
suffix:semicolon
multiline_comment|/*&n; * The result queue can be quite a bit smaller since continuation entries&n; * do not show up there:&n; */
DECL|macro|RES_QUEUE_LEN
mdefine_line|#define RES_QUEUE_LEN&t;&t;((QLOGICISP_REQ_QUEUE_LEN + 1) / 8 - 1)
DECL|macro|QUEUE_ENTRY_LEN
mdefine_line|#define QUEUE_ENTRY_LEN&t;&t;64
DECL|macro|QSIZE
mdefine_line|#define QSIZE(entries)  (((entries) + 1) * QUEUE_ENTRY_LEN)
DECL|struct|isp_queue_entry
r_struct
id|isp_queue_entry
(brace
DECL|member|__opaque
r_char
id|__opaque
(braket
id|QUEUE_ENTRY_LEN
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|isp1020_hostdata
r_struct
id|isp1020_hostdata
(brace
DECL|member|memaddr
id|u_long
id|memaddr
suffix:semicolon
DECL|member|revision
id|u_char
id|revision
suffix:semicolon
DECL|member|host_param
r_struct
id|host_param
id|host_param
suffix:semicolon
DECL|member|dev_param
r_struct
id|dev_param
id|dev_param
(braket
id|MAX_TARGETS
)braket
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|res_cpu
r_struct
id|isp_queue_entry
op_star
id|res_cpu
suffix:semicolon
multiline_comment|/* CPU-side address of response queue. */
DECL|member|req_cpu
r_struct
id|isp_queue_entry
op_star
id|req_cpu
suffix:semicolon
multiline_comment|/* CPU-size address of request queue. */
multiline_comment|/* result and request queues (shared with isp1020): */
DECL|member|req_in_ptr
id|u_int
id|req_in_ptr
suffix:semicolon
multiline_comment|/* index of next request slot */
DECL|member|res_out_ptr
id|u_int
id|res_out_ptr
suffix:semicolon
multiline_comment|/* index of next result slot */
multiline_comment|/* this is here so the queues are nicely aligned */
DECL|member|send_marker
r_int
id|send_marker
suffix:semicolon
multiline_comment|/* do we need to send a marker? */
multiline_comment|/* The cmd-&gt;handle has a fixed size, and is only 32-bits.  We&n;&t; * need to take care to handle 64-bit systems correctly thus what&n;&t; * we actually place in cmd-&gt;handle is an index to the following&n;&t; * table.  Kudos to Matt Jacob for the technique.  -DaveM&n;&t; */
DECL|member|cmd_slots
id|Scsi_Cmnd
op_star
id|cmd_slots
(braket
id|QLOGICISP_REQ_QUEUE_LEN
op_plus
l_int|1
)braket
suffix:semicolon
DECL|member|res_dma
id|dma_addr_t
id|res_dma
suffix:semicolon
multiline_comment|/* PCI side view of response queue */
DECL|member|req_dma
id|dma_addr_t
id|req_dma
suffix:semicolon
multiline_comment|/* PCI side view of request queue */
)brace
suffix:semicolon
multiline_comment|/* queue length&squot;s _must_ be power of two: */
DECL|macro|QUEUE_DEPTH
mdefine_line|#define QUEUE_DEPTH(in, out, ql)&t;((in - out) &amp; (ql))
DECL|macro|REQ_QUEUE_DEPTH
mdefine_line|#define REQ_QUEUE_DEPTH(in, out)&t;QUEUE_DEPTH(in, out, &t;&t;     &bslash;&n;&t;&t;&t;&t;&t;&t;    QLOGICISP_REQ_QUEUE_LEN)
DECL|macro|RES_QUEUE_DEPTH
mdefine_line|#define RES_QUEUE_DEPTH(in, out)&t;QUEUE_DEPTH(in, out, RES_QUEUE_LEN)
r_static
r_void
id|isp1020_enable_irqs
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_void
id|isp1020_disable_irqs
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_init
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_reset_hardware
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_set_defaults
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_load_parameters
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_mbox_command
c_func
(paren
r_struct
id|Scsi_Host
op_star
comma
id|u_short
(braket
)braket
)paren
suffix:semicolon
r_static
r_int
id|isp1020_return_status
c_func
(paren
r_struct
id|Status_Entry
op_star
)paren
suffix:semicolon
r_static
r_void
id|isp1020_intr_handler
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_static
r_void
id|do_isp1020_intr_handler
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
macro_line|#if USE_NVRAM_DEFAULTS
r_static
r_int
id|isp1020_get_defaults
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
r_int
id|isp1020_verify_nvram
c_func
(paren
r_struct
id|Scsi_Host
op_star
)paren
suffix:semicolon
r_static
id|u_short
id|isp1020_read_nvram_word
c_func
(paren
r_struct
id|Scsi_Host
op_star
comma
id|u_short
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if DEBUG_ISP1020
r_static
r_void
id|isp1020_print_scsi_cmd
c_func
(paren
id|Scsi_Cmnd
op_star
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if DEBUG_ISP1020_INTR
r_static
r_void
id|isp1020_print_status_entry
c_func
(paren
r_struct
id|Status_Entry
op_star
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* memaddr should be used to determine if memmapped port i/o is being used&n; * non-null memaddr == mmap&squot;d&n; * JV 7-Jan-2000&n; */
DECL|function|isp_inw
r_static
r_inline
id|u_short
id|isp_inw
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
comma
r_int
id|offset
)paren
(brace
r_struct
id|isp1020_hostdata
op_star
id|h
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;memaddr
)paren
r_return
id|readw
c_func
(paren
id|h-&gt;memaddr
op_plus
id|offset
)paren
suffix:semicolon
r_else
r_return
id|inw
c_func
(paren
id|host-&gt;io_port
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|isp_outw
r_static
r_inline
r_void
id|isp_outw
c_func
(paren
id|u_short
id|val
comma
r_struct
id|Scsi_Host
op_star
id|host
comma
r_int
id|offset
)paren
(brace
r_struct
id|isp1020_hostdata
op_star
id|h
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;memaddr
)paren
id|writew
c_func
(paren
id|val
comma
id|h-&gt;memaddr
op_plus
id|offset
)paren
suffix:semicolon
r_else
id|outw
c_func
(paren
id|val
comma
id|host-&gt;io_port
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|isp1020_enable_irqs
r_static
r_inline
r_void
id|isp1020_enable_irqs
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
id|isp_outw
c_func
(paren
id|ISP_EN_INT
op_or
id|ISP_EN_RISC
comma
id|host
comma
id|PCI_INTF_CTL
)paren
suffix:semicolon
)brace
DECL|function|isp1020_disable_irqs
r_static
r_inline
r_void
id|isp1020_disable_irqs
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_INTF_CTL
)paren
suffix:semicolon
)brace
DECL|function|isp1020_detect
r_int
id|isp1020_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|tmpt
)paren
(brace
r_int
id|hosts
op_assign
l_int|0
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_detect&quot;
)paren
suffix:semicolon
id|tmpt-&gt;proc_name
op_assign
l_string|&quot;isp1020&quot;
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : PCI not present&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_QLOGIC
comma
id|PCI_DEVICE_ID_QLOGIC_ISP1020
comma
id|pdev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_continue
suffix:semicolon
id|host
op_assign
id|scsi_register
c_func
(paren
id|tmpt
comma
r_sizeof
(paren
r_struct
id|isp1020_hostdata
)paren
)paren
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|memset
c_func
(paren
id|hostdata
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|isp1020_hostdata
)paren
)paren
suffix:semicolon
id|hostdata-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
r_if
c_cond
(paren
id|isp1020_init
c_func
(paren
id|host
)paren
)paren
r_goto
id|fail_and_unregister
suffix:semicolon
r_if
c_cond
(paren
id|isp1020_reset_hardware
c_func
(paren
id|host
)paren
macro_line|#if USE_NVRAM_DEFAULTS
op_logical_or
id|isp1020_get_defaults
c_func
(paren
id|host
)paren
macro_line|#else
op_logical_or
id|isp1020_set_defaults
c_func
(paren
id|host
)paren
macro_line|#endif /* USE_NVRAM_DEFAULTS */
op_logical_or
id|isp1020_load_parameters
c_func
(paren
id|host
)paren
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hostdata-&gt;memaddr
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|host-&gt;io_port
comma
l_int|0xff
)paren
suffix:semicolon
r_goto
id|fail_and_unregister
suffix:semicolon
)brace
id|host-&gt;this_id
op_assign
id|hostdata-&gt;host_param.initiator_scsi_id
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|host-&gt;irq
comma
id|do_isp1020_intr_handler
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;qlogicisp&quot;
comma
id|host
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : interrupt %d already in use&bslash;n&quot;
comma
id|host-&gt;irq
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hostdata-&gt;memaddr
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|host-&gt;io_port
comma
l_int|0xff
)paren
suffix:semicolon
r_goto
id|fail_and_unregister
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_SEMAPHORE
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_CLEAR_RISC_INTR
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|isp1020_enable_irqs
c_func
(paren
id|host
)paren
suffix:semicolon
id|hosts
op_increment
suffix:semicolon
r_continue
suffix:semicolon
id|fail_and_unregister
suffix:colon
r_if
c_cond
(paren
id|hostdata-&gt;res_cpu
)paren
id|pci_free_consistent
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|QSIZE
c_func
(paren
id|RES_QUEUE_LEN
)paren
comma
id|hostdata-&gt;res_cpu
comma
id|hostdata-&gt;res_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hostdata-&gt;req_cpu
)paren
id|pci_free_consistent
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|QSIZE
c_func
(paren
id|QLOGICISP_REQ_QUEUE_LEN
)paren
comma
id|hostdata-&gt;req_cpu
comma
id|hostdata-&gt;req_dma
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|host
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_detect&quot;
)paren
suffix:semicolon
r_return
id|hosts
suffix:semicolon
)brace
DECL|function|isp1020_release
r_int
id|isp1020_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_release&quot;
)paren
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_INTF_CTL
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|host-&gt;irq
comma
id|host
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hostdata-&gt;memaddr
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|host-&gt;io_port
comma
l_int|0xff
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_release&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isp1020_info
r_const
r_char
op_star
id|isp1020_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_info&quot;
)paren
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;QLogic ISP1020 SCSI on PCI bus %02x device %02x irq %d %s base 0x%lx&quot;
comma
id|hostdata-&gt;pci_dev-&gt;bus-&gt;number
comma
id|hostdata-&gt;pci_dev-&gt;devfn
comma
id|host-&gt;irq
comma
(paren
id|hostdata-&gt;memaddr
ques
c_cond
l_string|&quot;MEM&quot;
suffix:colon
l_string|&quot;I/O&quot;
)paren
comma
(paren
id|hostdata-&gt;memaddr
ques
c_cond
id|hostdata-&gt;memaddr
suffix:colon
id|host-&gt;io_port
)paren
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_info&quot;
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
multiline_comment|/*&n; * The middle SCSI layer ensures that queuecommand never gets invoked&n; * concurrently with itself or the interrupt handler (though the&n; * interrupt handler may call this routine as part of&n; * request-completion handling).&n; */
DECL|function|isp1020_queuecommand
r_int
id|isp1020_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|Cmnd
comma
r_void
(paren
op_star
id|done
)paren
(paren
id|Scsi_Cmnd
op_star
)paren
)paren
(brace
r_int
id|i
comma
id|n
comma
id|num_free
suffix:semicolon
id|u_int
id|in_ptr
comma
id|out_ptr
suffix:semicolon
r_struct
id|dataseg
op_star
id|ds
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sg
suffix:semicolon
r_struct
id|Command_Entry
op_star
id|cmd
suffix:semicolon
r_struct
id|Continuation_Entry
op_star
id|cont
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
id|dma_addr_t
id|dma_addr
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_queuecommand&quot;
)paren
suffix:semicolon
id|host
op_assign
id|Cmnd-&gt;host
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|Cmnd-&gt;scsi_done
op_assign
id|done
suffix:semicolon
id|DEBUG
c_func
(paren
id|isp1020_print_scsi_cmd
c_func
(paren
id|Cmnd
)paren
)paren
suffix:semicolon
id|out_ptr
op_assign
id|isp_inw
c_func
(paren
id|host
comma
op_plus
id|MBOX4
)paren
suffix:semicolon
id|in_ptr
op_assign
id|hostdata-&gt;req_in_ptr
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : request queue depth %d&bslash;n&quot;
comma
id|REQ_QUEUE_DEPTH
c_func
(paren
id|in_ptr
comma
id|out_ptr
)paren
)paren
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|Command_Entry
op_star
)paren
op_amp
id|hostdata-&gt;req_cpu
(braket
id|in_ptr
)braket
suffix:semicolon
id|in_ptr
op_assign
(paren
id|in_ptr
op_plus
l_int|1
)paren
op_amp
id|QLOGICISP_REQ_QUEUE_LEN
suffix:semicolon
r_if
c_cond
(paren
id|in_ptr
op_eq
id|out_ptr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : request queue overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hostdata-&gt;send_marker
)paren
(brace
r_struct
id|Marker_Entry
op_star
id|marker
suffix:semicolon
id|TRACE
c_func
(paren
l_string|&quot;queue marker&quot;
comma
id|in_ptr
comma
l_int|0
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : adding marker entry&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|marker
op_assign
(paren
r_struct
id|Marker_Entry
op_star
)paren
id|cmd
suffix:semicolon
id|memset
c_func
(paren
id|marker
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|Marker_Entry
)paren
)paren
suffix:semicolon
id|marker-&gt;hdr.entry_type
op_assign
id|ENTRY_MARKER
suffix:semicolon
id|marker-&gt;hdr.entry_cnt
op_assign
l_int|1
suffix:semicolon
id|marker-&gt;modifier
op_assign
id|SYNC_ALL
suffix:semicolon
id|hostdata-&gt;send_marker
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|in_ptr
op_plus
l_int|1
)paren
op_amp
id|QLOGICISP_REQ_QUEUE_LEN
)paren
op_eq
id|out_ptr
)paren
(brace
id|isp_outw
c_func
(paren
id|in_ptr
comma
id|host
comma
id|MBOX4
)paren
suffix:semicolon
id|hostdata-&gt;req_in_ptr
op_assign
id|in_ptr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : request queue overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|cmd
op_assign
(paren
r_struct
id|Command_Entry
op_star
)paren
op_amp
id|hostdata-&gt;req_cpu
(braket
id|in_ptr
)braket
suffix:semicolon
id|in_ptr
op_assign
(paren
id|in_ptr
op_plus
l_int|1
)paren
op_amp
id|QLOGICISP_REQ_QUEUE_LEN
suffix:semicolon
)brace
id|TRACE
c_func
(paren
l_string|&quot;queue command&quot;
comma
id|in_ptr
comma
id|Cmnd
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|Command_Entry
)paren
)paren
suffix:semicolon
id|cmd-&gt;hdr.entry_type
op_assign
id|ENTRY_COMMAND
suffix:semicolon
id|cmd-&gt;hdr.entry_cnt
op_assign
l_int|1
suffix:semicolon
id|cmd-&gt;target_lun
op_assign
id|Cmnd-&gt;lun
suffix:semicolon
id|cmd-&gt;target_id
op_assign
id|Cmnd-&gt;target
suffix:semicolon
id|cmd-&gt;cdb_length
op_assign
id|cpu_to_le16
c_func
(paren
id|Cmnd-&gt;cmd_len
)paren
suffix:semicolon
id|cmd-&gt;control_flags
op_assign
id|cpu_to_le16
c_func
(paren
id|CFLAG_READ
op_or
id|CFLAG_WRITE
)paren
suffix:semicolon
id|cmd-&gt;time_out
op_assign
id|cpu_to_le16
c_func
(paren
l_int|30
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd-&gt;cdb
comma
id|Cmnd-&gt;cmnd
comma
id|Cmnd-&gt;cmd_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
(brace
r_int
id|sg_count
suffix:semicolon
id|sg
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|Cmnd-&gt;request_buffer
suffix:semicolon
id|ds
op_assign
id|cmd-&gt;dataseg
suffix:semicolon
id|sg_count
op_assign
id|pci_map_sg
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|sg
comma
id|Cmnd-&gt;use_sg
comma
id|scsi_to_pci_dma_dir
c_func
(paren
id|Cmnd-&gt;sc_data_direction
)paren
)paren
suffix:semicolon
id|cmd-&gt;segment_cnt
op_assign
id|cpu_to_le16
c_func
(paren
id|sg_count
)paren
suffix:semicolon
multiline_comment|/* fill in first four sg entries: */
id|n
op_assign
id|sg_count
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|IOCB_SEGS
)paren
id|n
op_assign
id|IOCB_SEGS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dma_addr
op_assign
id|sg_dma_address
c_func
(paren
id|sg
)paren
suffix:semicolon
id|ds
(braket
id|i
)braket
dot
id|d_base
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|dma_addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|ds
(braket
id|i
)braket
dot
id|d_base_hi
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
(paren
id|dma_addr
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QL_ISP_A64 */
id|ds
(braket
id|i
)braket
dot
id|d_count
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
op_increment
id|sg
suffix:semicolon
)brace
id|sg_count
op_sub_assign
id|IOCB_SEGS
suffix:semicolon
r_while
c_loop
(paren
id|sg_count
OG
l_int|0
)paren
(brace
op_increment
id|cmd-&gt;hdr.entry_cnt
suffix:semicolon
id|cont
op_assign
(paren
r_struct
id|Continuation_Entry
op_star
)paren
op_amp
id|hostdata-&gt;req_cpu
(braket
id|in_ptr
)braket
suffix:semicolon
id|in_ptr
op_assign
(paren
id|in_ptr
op_plus
l_int|1
)paren
op_amp
id|QLOGICISP_REQ_QUEUE_LEN
suffix:semicolon
r_if
c_cond
(paren
id|in_ptr
op_eq
id|out_ptr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;isp1020: unexpected request queue &quot;
l_string|&quot;overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|TRACE
c_func
(paren
l_string|&quot;queue continuation&quot;
comma
id|in_ptr
comma
l_int|0
)paren
suffix:semicolon
id|cont-&gt;hdr.entry_type
op_assign
id|ENTRY_CONTINUATION
suffix:semicolon
id|cont-&gt;hdr.entry_cnt
op_assign
l_int|0
suffix:semicolon
id|cont-&gt;hdr.sys_def_1
op_assign
l_int|0
suffix:semicolon
id|cont-&gt;hdr.flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifndef CONFIG_QL_ISP_A64
id|cont-&gt;reserved
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|ds
op_assign
id|cont-&gt;dataseg
suffix:semicolon
id|n
op_assign
id|sg_count
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|CONTINUATION_SEGS
)paren
id|n
op_assign
id|CONTINUATION_SEGS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dma_addr
op_assign
id|sg_dma_address
c_func
(paren
id|sg
)paren
suffix:semicolon
id|ds
(braket
id|i
)braket
dot
id|d_base
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|dma_addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|ds
(braket
id|i
)braket
dot
id|d_base_hi
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
(paren
id|dma_addr
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QL_ISP_A64 */
id|ds
(braket
id|i
)braket
dot
id|d_count
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
op_increment
id|sg
suffix:semicolon
)brace
id|sg_count
op_sub_assign
id|n
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
)paren
(brace
multiline_comment|/*Cmnd-&gt;SCp.ptr = (char *)(unsigned long)*/
id|dma_addr
op_assign
id|pci_map_single
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|Cmnd-&gt;request_buffer
comma
id|Cmnd-&gt;request_bufflen
comma
id|scsi_to_pci_dma_dir
c_func
(paren
id|Cmnd-&gt;sc_data_direction
)paren
)paren
suffix:semicolon
id|Cmnd-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
(paren
r_int
r_int
)paren
id|dma_addr
suffix:semicolon
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_base
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|dma_addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_base_hi
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
(paren
id|dma_addr
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QL_ISP_A64 */
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_count
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|Cmnd-&gt;request_bufflen
)paren
suffix:semicolon
id|cmd-&gt;segment_cnt
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_base
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_base_hi
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_QL_ISP_A64 */
id|cmd-&gt;dataseg
(braket
l_int|0
)braket
dot
id|d_count
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;segment_cnt
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Shouldn&squot;t this be 0? */
)brace
multiline_comment|/* Committed, record Scsi_Cmd so we can find it later. */
id|cmd-&gt;handle
op_assign
id|in_ptr
suffix:semicolon
id|hostdata-&gt;cmd_slots
(braket
id|in_ptr
)braket
op_assign
id|Cmnd
suffix:semicolon
id|isp_outw
c_func
(paren
id|in_ptr
comma
id|host
comma
id|MBOX4
)paren
suffix:semicolon
id|hostdata-&gt;req_in_ptr
op_assign
id|in_ptr
suffix:semicolon
id|num_free
op_assign
id|QLOGICISP_REQ_QUEUE_LEN
op_minus
id|REQ_QUEUE_DEPTH
c_func
(paren
id|in_ptr
comma
id|out_ptr
)paren
suffix:semicolon
id|host-&gt;can_queue
op_assign
id|host-&gt;host_busy
op_plus
id|num_free
suffix:semicolon
id|host-&gt;sg_tablesize
op_assign
id|QLOGICISP_MAX_SG
c_func
(paren
id|num_free
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_queuecommand&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|ASYNC_EVENT_INTERRUPT
mdefine_line|#define ASYNC_EVENT_INTERRUPT&t;0x01
DECL|function|do_isp1020_intr_handler
r_void
id|do_isp1020_intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
id|isp1020_intr_handler
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|isp1020_intr_handler
r_void
id|isp1020_intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|Scsi_Cmnd
op_star
id|Cmnd
suffix:semicolon
r_struct
id|Status_Entry
op_star
id|sts
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|dev_id
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
id|u_int
id|in_ptr
comma
id|out_ptr
suffix:semicolon
id|u_short
id|status
suffix:semicolon
id|ENTER_INTR
c_func
(paren
l_string|&quot;isp1020_intr_handler&quot;
)paren
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : interrupt on line %d&bslash;n&quot;
comma
id|irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|PCI_INTF_STS
)paren
op_amp
l_int|0x04
)paren
)paren
(brace
multiline_comment|/* spurious interrupts can happen legally */
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp: got spurious interrupt&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|in_ptr
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX5
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_CLEAR_RISC_INTR
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|PCI_SEMAPHORE
)paren
op_amp
id|ASYNC_EVENT_INTERRUPT
)paren
)paren
(brace
id|status
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX0
)paren
suffix:semicolon
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox completion status: %x&bslash;n&quot;
comma
id|status
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|status
)paren
(brace
r_case
id|ASYNC_SCSI_BUS_RESET
suffix:colon
r_case
id|EXECUTION_TIMEOUT_RESET
suffix:colon
id|hostdata-&gt;send_marker
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVALID_COMMAND
suffix:colon
r_case
id|HOST_INTERFACE_ERROR
suffix:colon
r_case
id|COMMAND_ERROR
suffix:colon
r_case
id|COMMAND_PARAM_ERROR
suffix:colon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : bad mailbox return status&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_SEMAPHORE
)paren
suffix:semicolon
)brace
id|out_ptr
op_assign
id|hostdata-&gt;res_out_ptr
suffix:semicolon
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : response queue update&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : response queue depth %d&bslash;n&quot;
comma
id|QUEUE_DEPTH
c_func
(paren
id|in_ptr
comma
id|out_ptr
comma
id|RES_QUEUE_LEN
)paren
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|out_ptr
op_ne
id|in_ptr
)paren
(brace
id|u_int
id|cmd_slot
suffix:semicolon
id|sts
op_assign
(paren
r_struct
id|Status_Entry
op_star
)paren
op_amp
id|hostdata-&gt;res_cpu
(braket
id|out_ptr
)braket
suffix:semicolon
id|out_ptr
op_assign
(paren
id|out_ptr
op_plus
l_int|1
)paren
op_amp
id|RES_QUEUE_LEN
suffix:semicolon
id|cmd_slot
op_assign
id|sts-&gt;handle
suffix:semicolon
id|Cmnd
op_assign
id|hostdata-&gt;cmd_slots
(braket
id|cmd_slot
)braket
suffix:semicolon
id|hostdata-&gt;cmd_slots
(braket
id|cmd_slot
)braket
op_assign
l_int|NULL
suffix:semicolon
id|TRACE
c_func
(paren
l_string|&quot;done&quot;
comma
id|out_ptr
comma
id|Cmnd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;completion_status
)paren
op_eq
id|CS_RESET_OCCURRED
op_logical_or
id|le16_to_cpu
c_func
(paren
id|sts-&gt;completion_status
)paren
op_eq
id|CS_ABORTED
op_logical_or
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;status_flags
)paren
op_amp
id|STF_BUS_RESET
)paren
)paren
id|hostdata-&gt;send_marker
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_GOT_SENSE
)paren
id|memcpy
c_func
(paren
id|Cmnd-&gt;sense_buffer
comma
id|sts-&gt;req_sense_data
comma
r_sizeof
(paren
id|Cmnd-&gt;sense_buffer
)paren
)paren
suffix:semicolon
id|DEBUG_INTR
c_func
(paren
id|isp1020_print_status_entry
c_func
(paren
id|sts
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sts-&gt;hdr.entry_type
op_eq
id|ENTRY_STATUS
)paren
id|Cmnd-&gt;result
op_assign
id|isp1020_return_status
c_func
(paren
id|sts
)paren
suffix:semicolon
r_else
id|Cmnd-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
id|pci_unmap_sg
c_func
(paren
id|hostdata-&gt;pci_dev
comma
(paren
r_struct
id|scatterlist
op_star
)paren
id|Cmnd-&gt;buffer
comma
id|Cmnd-&gt;use_sg
comma
id|scsi_to_pci_dma_dir
c_func
(paren
id|Cmnd-&gt;sc_data_direction
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
)paren
id|pci_unmap_single
c_func
(paren
id|hostdata-&gt;pci_dev
comma
macro_line|#ifdef CONFIG_QL_ISP_A64
(paren
id|dma_addr_t
)paren
(paren
(paren
r_int
)paren
id|Cmnd-&gt;SCp.ptr
)paren
comma
macro_line|#else
(paren
id|u32
)paren
(paren
(paren
r_int
)paren
id|Cmnd-&gt;SCp.ptr
)paren
comma
macro_line|#endif
id|Cmnd-&gt;request_bufflen
comma
id|scsi_to_pci_dma_dir
c_func
(paren
id|Cmnd-&gt;sc_data_direction
)paren
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|out_ptr
comma
id|host
comma
id|MBOX5
)paren
suffix:semicolon
(paren
op_star
id|Cmnd-&gt;scsi_done
)paren
(paren
id|Cmnd
)paren
suffix:semicolon
)brace
id|hostdata-&gt;res_out_ptr
op_assign
id|out_ptr
suffix:semicolon
id|LEAVE_INTR
c_func
(paren
l_string|&quot;isp1020_intr_handler&quot;
)paren
suffix:semicolon
)brace
DECL|function|isp1020_return_status
r_static
r_int
id|isp1020_return_status
c_func
(paren
r_struct
id|Status_Entry
op_star
id|sts
)paren
(brace
r_int
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
macro_line|#if DEBUG_ISP1020_INTR
r_static
r_char
op_star
id|reason
(braket
)braket
op_assign
(brace
l_string|&quot;DID_OK&quot;
comma
l_string|&quot;DID_NO_CONNECT&quot;
comma
l_string|&quot;DID_BUS_BUSY&quot;
comma
l_string|&quot;DID_TIME_OUT&quot;
comma
l_string|&quot;DID_BAD_TARGET&quot;
comma
l_string|&quot;DID_ABORT&quot;
comma
l_string|&quot;DID_PARITY&quot;
comma
l_string|&quot;DID_ERROR&quot;
comma
l_string|&quot;DID_RESET&quot;
comma
l_string|&quot;DID_BAD_INTR&quot;
)brace
suffix:semicolon
macro_line|#endif /* DEBUG_ISP1020_INTR */
id|ENTER
c_func
(paren
l_string|&quot;isp1020_return_status&quot;
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : completion status = 0x%04x&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|sts-&gt;completion_status
)paren
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;completion_status
)paren
)paren
(brace
r_case
id|CS_COMPLETE
suffix:colon
id|host_status
op_assign
id|DID_OK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_INCOMPLETE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_GOT_BUS
)paren
)paren
id|host_status
op_assign
id|DID_NO_CONNECT
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_GOT_TARGET
)paren
)paren
id|host_status
op_assign
id|DID_BAD_TARGET
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_SENT_CDB
)paren
)paren
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_TRANSFERRED_DATA
)paren
)paren
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_GOT_STATUS
)paren
)paren
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;state_flags
)paren
op_amp
id|SF_GOT_SENSE
)paren
)paren
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_DMA_ERROR
suffix:colon
r_case
id|CS_TRANSPORT_ERROR
suffix:colon
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_RESET_OCCURRED
suffix:colon
id|host_status
op_assign
id|DID_RESET
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_ABORTED
suffix:colon
id|host_status
op_assign
id|DID_ABORT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_TIMEOUT
suffix:colon
id|host_status
op_assign
id|DID_TIME_OUT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_DATA_OVERRUN
suffix:colon
r_case
id|CS_COMMAND_OVERRUN
suffix:colon
r_case
id|CS_STATUS_OVERRUN
suffix:colon
r_case
id|CS_BAD_MESSAGE
suffix:colon
r_case
id|CS_NO_MESSAGE_OUT
suffix:colon
r_case
id|CS_EXT_ID_FAILED
suffix:colon
r_case
id|CS_IDE_MSG_FAILED
suffix:colon
r_case
id|CS_ABORT_MSG_FAILED
suffix:colon
r_case
id|CS_NOP_MSG_FAILED
suffix:colon
r_case
id|CS_PARITY_ERROR_MSG_FAILED
suffix:colon
r_case
id|CS_DEVICE_RESET_MSG_FAILED
suffix:colon
r_case
id|CS_ID_MSG_FAILED
suffix:colon
r_case
id|CS_UNEXP_BUS_FREE
suffix:colon
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_DATA_UNDERRUN
suffix:colon
id|host_status
op_assign
id|DID_OK
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : unknown completion status 0x%04x&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|sts-&gt;completion_status
)paren
)paren
suffix:semicolon
id|host_status
op_assign
id|DID_ERROR
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DEBUG_INTR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : host status (%s) scsi status %x&bslash;n&quot;
comma
id|reason
(braket
id|host_status
)braket
comma
id|le16_to_cpu
c_func
(paren
id|sts-&gt;scsi_status
)paren
)paren
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_return_status&quot;
)paren
suffix:semicolon
r_return
(paren
id|le16_to_cpu
c_func
(paren
id|sts-&gt;scsi_status
)paren
op_amp
id|STATUS_MASK
)paren
op_or
(paren
id|host_status
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|isp1020_abort
r_int
id|isp1020_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|Cmnd
)paren
(brace
id|u_short
id|param
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
r_int
id|return_status
op_assign
id|SCSI_ABORT_SUCCESS
suffix:semicolon
id|u_int
id|cmd_cookie
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_abort&quot;
)paren
suffix:semicolon
id|host
op_assign
id|Cmnd-&gt;host
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QLOGICISP_REQ_QUEUE_LEN
op_plus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|hostdata-&gt;cmd_slots
(braket
id|i
)braket
op_eq
id|Cmnd
)paren
r_break
suffix:semicolon
id|cmd_cookie
op_assign
id|i
suffix:semicolon
id|isp1020_disable_irqs
c_func
(paren
id|host
)paren
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_ABORT
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
(paren
(paren
(paren
id|u_short
)paren
id|Cmnd-&gt;target
)paren
op_lshift
l_int|8
)paren
op_or
id|Cmnd-&gt;lun
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|cmd_cookie
op_rshift
l_int|16
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
id|cmd_cookie
op_amp
l_int|0xffff
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : scsi abort failure: %x&bslash;n&quot;
comma
id|param
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|return_status
op_assign
id|SCSI_ABORT_ERROR
suffix:semicolon
)brace
id|isp1020_enable_irqs
c_func
(paren
id|host
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_abort&quot;
)paren
suffix:semicolon
r_return
id|return_status
suffix:semicolon
)brace
DECL|function|isp1020_reset
r_int
id|isp1020_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|Cmnd
comma
r_int
r_int
id|reset_flags
)paren
(brace
id|u_short
id|param
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
r_int
id|return_status
op_assign
id|SCSI_RESET_SUCCESS
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_reset&quot;
)paren
suffix:semicolon
id|host
op_assign
id|Cmnd-&gt;host
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_BUS_RESET
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.bus_reset_delay
suffix:semicolon
id|isp1020_disable_irqs
c_func
(paren
id|host
)paren
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : scsi bus reset failure: %x&bslash;n&quot;
comma
id|param
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|return_status
op_assign
id|SCSI_RESET_ERROR
suffix:semicolon
)brace
id|isp1020_enable_irqs
c_func
(paren
id|host
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_reset&quot;
)paren
suffix:semicolon
r_return
id|return_status
suffix:semicolon
suffix:semicolon
)brace
DECL|function|isp1020_biosparam
r_int
id|isp1020_biosparam
c_func
(paren
id|Disk
op_star
id|disk
comma
id|kdev_t
id|n
comma
r_int
id|ip
(braket
)braket
)paren
(brace
r_int
id|size
op_assign
id|disk-&gt;capacity
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_biosparam&quot;
)paren
suffix:semicolon
id|ip
(braket
l_int|0
)braket
op_assign
l_int|64
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
l_int|32
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|size
op_rshift
l_int|11
suffix:semicolon
r_if
c_cond
(paren
id|ip
(braket
l_int|2
)braket
OG
l_int|1024
)paren
(brace
id|ip
(braket
l_int|0
)braket
op_assign
l_int|255
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
l_int|63
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|size
op_div
(paren
id|ip
(braket
l_int|0
)braket
op_star
id|ip
(braket
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|ip
(braket
l_int|2
)braket
OG
l_int|1023
)paren
id|ip
(braket
l_int|2
)braket
op_assign
l_int|1023
suffix:semicolon
macro_line|#endif&t;&t;&t;
)brace
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_biosparam&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isp1020_reset_hardware
r_static
r_int
id|isp1020_reset_hardware
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
id|u_short
id|param
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|loop_count
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_reset_hardware&quot;
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|ISP_RESET
comma
id|host
comma
id|PCI_INTF_CTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_RESET
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_RELEASE
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_BIOS_DISABLE
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|loop_count
op_assign
id|DEFAULT_LOOP_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|loop_count
op_logical_and
id|isp_inw
c_func
(paren
id|host
comma
id|HOST_HCCR
)paren
op_eq
id|RISC_BUSY
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loop_count
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp: reset_hardware loop timeout&bslash;n&quot;
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
l_int|0
comma
id|host
comma
id|ISP_CFG1
)paren
suffix:semicolon
macro_line|#if DEBUG_ISP1020
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 0 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX0
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 1 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX1
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 2 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX2
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 3 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX3
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 4 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX4
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : mbox 5 0x%04x &bslash;n&quot;
comma
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX5
)paren
)paren
suffix:semicolon
macro_line|#endif /* DEBUG_ISP1020 */
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_NO_OP
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : NOP test failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : loading risc ram&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#if RELOAD_FIRMWARE
r_for
c_loop
(paren
id|loop_count
op_assign
l_int|0
suffix:semicolon
id|loop_count
OL
id|risc_code_length01
suffix:semicolon
id|loop_count
op_increment
)paren
(brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_WRITE_RAM_WORD
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|risc_code_addr01
op_plus
id|loop_count
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|risc_code01
(braket
id|loop_count
)braket
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : firmware load failure at %d&bslash;n&quot;
comma
id|loop_count
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* RELOAD_FIRMWARE */
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : verifying checksum&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_VERIFY_CHECKSUM
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|risc_code_addr01
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : ram checksum failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : executing firmware&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_EXEC_FIRMWARE
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|risc_code_addr01
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_ABOUT_FIRMWARE
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : about firmware failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : firmware major revision %d&bslash;n&quot;
comma
id|param
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : firmware minor revision %d&bslash;n&quot;
comma
id|param
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_reset_hardware&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isp1020_init
r_static
r_int
id|isp1020_init
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|sh
)paren
(brace
id|u_long
id|io_base
comma
id|mem_base
comma
id|io_flags
comma
id|mem_flags
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
suffix:semicolon
id|u_char
id|revision
suffix:semicolon
id|u_int
id|irq
suffix:semicolon
id|u_short
id|command
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_init&quot;
)paren
suffix:semicolon
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|sh-&gt;hostdata
suffix:semicolon
id|pdev
op_assign
id|hostdata-&gt;pci_dev
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
op_logical_or
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : error reading PCI configuration&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|io_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mem_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|io_flags
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mem_flags
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_ne
id|PCI_VENDOR_ID_QLOGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : 0x%04x is not QLogic vendor ID&bslash;n&quot;
comma
id|pdev-&gt;vendor
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdev-&gt;device
op_ne
id|PCI_DEVICE_ID_QLOGIC_ISP1020
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : 0x%04x does not match ISP1020 device id&bslash;n&quot;
comma
id|pdev-&gt;device
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef __alpha__
multiline_comment|/* Force ALPHA to use bus I/O and not bus MEM.&n;&t;   This is to avoid having to use HAE_MEM registers,&n;&t;   which is broken on some platforms and with SMP.  */
id|command
op_and_assign
op_complement
id|PCI_COMMAND_MEMORY
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|command
op_amp
id|PCI_COMMAND_MASTER
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : bus mastering is disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|sh-&gt;io_port
op_assign
id|io_base
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|sh-&gt;io_port
comma
l_int|0xff
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : i/o region 0x%lx-0x%lx already &quot;
l_string|&quot;in use&bslash;n&quot;
comma
id|sh-&gt;io_port
comma
id|sh-&gt;io_port
op_plus
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|sh-&gt;io_port
comma
l_int|0xff
comma
l_string|&quot;qlogicisp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|command
op_amp
id|PCI_COMMAND_MEMORY
)paren
op_logical_and
(paren
(paren
id|mem_flags
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|mem_base
op_assign
(paren
id|u_long
)paren
id|ioremap
c_func
(paren
id|mem_base
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|hostdata-&gt;memaddr
op_assign
id|mem_base
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|command
op_amp
id|PCI_COMMAND_IO
op_logical_and
(paren
id|io_flags
op_amp
l_int|3
)paren
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : i/o mapping is disabled&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|sh-&gt;io_port
comma
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|hostdata-&gt;memaddr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero to signify no i/o mapping */
id|mem_base
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|revision
op_ne
id|ISP1020_REV_ID
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : new isp1020 revision ID (%d)&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isp_inw
c_func
(paren
id|sh
comma
id|PCI_ID_LOW
)paren
op_ne
id|PCI_VENDOR_ID_QLOGIC
op_logical_or
id|isp_inw
c_func
(paren
id|sh
comma
id|PCI_ID_HIGH
)paren
op_ne
id|PCI_DEVICE_ID_QLOGIC_ISP1020
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : can&squot;t decode %s address space 0x%lx&bslash;n&quot;
comma
(paren
id|io_base
ques
c_cond
l_string|&quot;I/O&quot;
suffix:colon
l_string|&quot;MEM&quot;
)paren
comma
(paren
id|io_base
ques
c_cond
id|io_base
suffix:colon
id|mem_base
)paren
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hostdata-&gt;memaddr
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|sh-&gt;io_port
comma
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|hostdata-&gt;revision
op_assign
id|revision
suffix:semicolon
id|sh-&gt;irq
op_assign
id|irq
suffix:semicolon
id|sh-&gt;max_id
op_assign
id|MAX_TARGETS
suffix:semicolon
id|sh-&gt;max_lun
op_assign
id|MAX_LUNS
suffix:semicolon
id|hostdata-&gt;res_cpu
op_assign
id|pci_alloc_consistent
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|QSIZE
c_func
(paren
id|RES_QUEUE_LEN
)paren
comma
op_amp
id|hostdata-&gt;res_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hostdata-&gt;res_cpu
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : can&squot;t allocate response queue&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|hostdata-&gt;req_cpu
op_assign
id|pci_alloc_consistent
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|QSIZE
c_func
(paren
id|QLOGICISP_REQ_QUEUE_LEN
)paren
comma
op_amp
id|hostdata-&gt;req_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hostdata-&gt;req_cpu
op_eq
l_int|NULL
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|hostdata-&gt;pci_dev
comma
id|QSIZE
c_func
(paren
id|RES_QUEUE_LEN
)paren
comma
id|hostdata-&gt;res_cpu
comma
id|hostdata-&gt;res_dma
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : can&squot;t allocate request queue&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_init&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if USE_NVRAM_DEFAULTS
DECL|function|isp1020_get_defaults
r_static
r_int
id|isp1020_get_defaults
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_short
id|value
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_get_defaults&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isp1020_verify_nvram
c_func
(paren
id|host
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;qlogicisp : nvram checksum failure&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : attempting to use default parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|isp1020_set_defaults
c_func
(paren
id|host
)paren
suffix:semicolon
)brace
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|2
)paren
suffix:semicolon
id|hostdata-&gt;host_param.fifo_threshold
op_assign
(paren
id|value
op_rshift
l_int|8
)paren
op_amp
l_int|0x03
suffix:semicolon
id|hostdata-&gt;host_param.host_adapter_enable
op_assign
(paren
id|value
op_rshift
l_int|11
)paren
op_amp
l_int|0x01
suffix:semicolon
id|hostdata-&gt;host_param.initiator_scsi_id
op_assign
(paren
id|value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|3
)paren
suffix:semicolon
id|hostdata-&gt;host_param.bus_reset_delay
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|hostdata-&gt;host_param.retry_count
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|4
)paren
suffix:semicolon
id|hostdata-&gt;host_param.retry_delay
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|hostdata-&gt;host_param.async_data_setup_time
op_assign
(paren
id|value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|hostdata-&gt;host_param.req_ack_active_negation
op_assign
(paren
id|value
op_rshift
l_int|12
)paren
op_amp
l_int|0x01
suffix:semicolon
id|hostdata-&gt;host_param.data_line_active_negation
op_assign
(paren
id|value
op_rshift
l_int|13
)paren
op_amp
l_int|0x01
suffix:semicolon
id|hostdata-&gt;host_param.data_dma_burst_enable
op_assign
(paren
id|value
op_rshift
l_int|14
)paren
op_amp
l_int|0x01
suffix:semicolon
id|hostdata-&gt;host_param.command_dma_burst_enable
op_assign
(paren
id|value
op_rshift
l_int|15
)paren
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|5
)paren
suffix:semicolon
id|hostdata-&gt;host_param.tag_aging
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|6
)paren
suffix:semicolon
id|hostdata-&gt;host_param.selection_timeout
op_assign
id|value
op_amp
l_int|0xffff
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|7
)paren
suffix:semicolon
id|hostdata-&gt;host_param.max_queue_depth
op_assign
id|value
op_amp
l_int|0xffff
suffix:semicolon
macro_line|#if DEBUG_ISP1020_SETUP
id|printk
c_func
(paren
l_string|&quot;qlogicisp : fifo threshold=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.fifo_threshold
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : initiator scsi id=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.initiator_scsi_id
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : bus reset delay=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.bus_reset_delay
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : retry count=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.retry_count
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : retry delay=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.retry_delay
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : async data setup time=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.async_data_setup_time
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : req/ack active negation=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.req_ack_active_negation
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : data line active negation=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.data_line_active_negation
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : data DMA burst enable=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.data_dma_burst_enable
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : command DMA burst enable=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.command_dma_burst_enable
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : tag age limit=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.tag_aging
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : selection timeout limit=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.selection_timeout
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : max queue depth=%d&bslash;n&quot;
comma
id|hostdata-&gt;host_param.max_queue_depth
)paren
suffix:semicolon
macro_line|#endif /* DEBUG_ISP1020_SETUP */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_TARGETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|14
op_plus
id|i
op_star
l_int|3
)paren
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_flags
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|execution_throttle
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
l_int|15
op_plus
id|i
op_star
l_int|3
)paren
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_period
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_offset
op_assign
(paren
id|value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_enable
op_assign
(paren
id|value
op_rshift
l_int|12
)paren
op_amp
l_int|0x01
suffix:semicolon
macro_line|#if DEBUG_ISP1020_SETUP
id|printk
c_func
(paren
l_string|&quot;qlogicisp : target 0x%02x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp :     device flags=0x%02x&bslash;n&quot;
comma
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp :     execution throttle=%d&bslash;n&quot;
comma
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|execution_throttle
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp :     synchronous period=%d&bslash;n&quot;
comma
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_period
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp :     synchronous offset=%d&bslash;n&quot;
comma
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_offset
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp :     device enable=%d&bslash;n&quot;
comma
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_enable
)paren
suffix:semicolon
macro_line|#endif /* DEBUG_ISP1020_SETUP */
)brace
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_get_defaults&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|ISP1020_NVRAM_LEN
mdefine_line|#define ISP1020_NVRAM_LEN&t;0x40
DECL|macro|ISP1020_NVRAM_SIG1
mdefine_line|#define ISP1020_NVRAM_SIG1&t;0x5349
DECL|macro|ISP1020_NVRAM_SIG2
mdefine_line|#define ISP1020_NVRAM_SIG2&t;0x2050
DECL|function|isp1020_verify_nvram
r_static
r_int
id|isp1020_verify_nvram
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_short
id|value
suffix:semicolon
id|u_char
id|checksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISP1020_NVRAM_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|isp1020_read_nvram_word
c_func
(paren
id|host
comma
id|i
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|value
op_ne
id|ISP1020_NVRAM_SIG1
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|value
op_ne
id|ISP1020_NVRAM_SIG2
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0xff
)paren
op_ne
l_int|0x02
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|checksum
op_add_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|checksum
op_add_assign
id|value
op_rshift
l_int|8
suffix:semicolon
)brace
r_return
(paren
id|checksum
op_eq
l_int|0
)paren
suffix:semicolon
)brace
DECL|macro|NVRAM_DELAY
mdefine_line|#define NVRAM_DELAY() udelay(2) /* 2 microsecond delay */
DECL|function|isp1020_read_nvram_word
id|u_short
id|isp1020_read_nvram_word
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
comma
id|u_short
id|byte
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_short
id|value
comma
id|output
comma
id|input
suffix:semicolon
id|byte
op_and_assign
l_int|0x3f
suffix:semicolon
id|byte
op_or_assign
l_int|0x0180
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|output
op_assign
(paren
(paren
id|byte
op_rshift
id|i
)paren
op_amp
l_int|0x1
)paren
ques
c_cond
l_int|0x4
suffix:colon
l_int|0x0
suffix:semicolon
id|isp_outw
c_func
(paren
id|output
op_or
l_int|0x2
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|output
op_or
l_int|0x3
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|output
op_or
l_int|0x2
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0xf
comma
id|value
op_assign
l_int|0
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|value
op_lshift_assign
l_int|1
suffix:semicolon
id|isp_outw
c_func
(paren
l_int|0x3
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
id|input
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
l_int|0x2
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input
op_amp
l_int|0x8
)paren
id|value
op_or_assign
l_int|1
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_NVRAM
)paren
suffix:semicolon
id|NVRAM_DELAY
c_func
(paren
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
macro_line|#endif /* USE_NVRAM_DEFAULTS */
DECL|function|isp1020_set_defaults
r_static
r_int
id|isp1020_set_defaults
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_struct
id|isp1020_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_set_defaults&quot;
)paren
suffix:semicolon
id|hostdata-&gt;host_param.fifo_threshold
op_assign
l_int|2
suffix:semicolon
id|hostdata-&gt;host_param.host_adapter_enable
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.initiator_scsi_id
op_assign
l_int|7
suffix:semicolon
id|hostdata-&gt;host_param.bus_reset_delay
op_assign
l_int|3
suffix:semicolon
id|hostdata-&gt;host_param.retry_count
op_assign
l_int|0
suffix:semicolon
id|hostdata-&gt;host_param.retry_delay
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.async_data_setup_time
op_assign
l_int|6
suffix:semicolon
id|hostdata-&gt;host_param.req_ack_active_negation
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.data_line_active_negation
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.data_dma_burst_enable
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.command_dma_burst_enable
op_assign
l_int|1
suffix:semicolon
id|hostdata-&gt;host_param.tag_aging
op_assign
l_int|8
suffix:semicolon
id|hostdata-&gt;host_param.selection_timeout
op_assign
l_int|250
suffix:semicolon
id|hostdata-&gt;host_param.max_queue_depth
op_assign
l_int|256
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_TARGETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_flags
op_assign
l_int|0xfd
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|execution_throttle
op_assign
l_int|16
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_period
op_assign
l_int|25
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_offset
op_assign
l_int|12
suffix:semicolon
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_enable
op_assign
l_int|1
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_set_defaults&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isp1020_load_parameters
r_static
r_int
id|isp1020_load_parameters
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_int
id|i
comma
id|k
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|u_long
id|queue_addr
suffix:semicolon
id|u_short
id|param
(braket
l_int|8
)braket
suffix:semicolon
macro_line|#else
id|u_int
id|queue_addr
suffix:semicolon
id|u_short
id|param
(braket
l_int|6
)braket
suffix:semicolon
macro_line|#endif
id|u_short
id|isp_cfg1
comma
id|hwrev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|isp1020_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|isp1020_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;isp1020_load_parameters&quot;
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|hwrev
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|ISP_CFG0
)paren
op_amp
id|ISP_CFG0_HWMSK
suffix:semicolon
id|isp_cfg1
op_assign
id|ISP_CFG1_F64
op_or
id|ISP_CFG1_BENAB
suffix:semicolon
r_if
c_cond
(paren
id|hwrev
op_eq
id|ISP_CFG0_1040A
)paren
(brace
multiline_comment|/* Busted fifo, says mjacob. */
id|isp_cfg1
op_and_assign
id|ISP_CFG1_BENAB
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|ISP_CFG1
)paren
op_or
id|isp_cfg1
comma
id|host
comma
id|ISP_CFG1
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|CDMA_CONF
)paren
op_or
id|DMA_CONF_BENAB
comma
id|host
comma
id|CDMA_CONF
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|DDMA_CONF
)paren
op_or
id|DMA_CONF_BENAB
comma
id|host
comma
id|DDMA_CONF
)paren
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_INIT_SCSI_ID
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.initiator_scsi_id
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set initiator id failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_RETRY_COUNT
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.retry_count
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|hostdata-&gt;host_param.retry_delay
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set retry count failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_ASYNC_DATA_SETUP_TIME
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.async_data_setup_time
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : async data setup time failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_ACTIVE_NEG_STATE
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
(paren
id|hostdata-&gt;host_param.req_ack_active_negation
op_lshift
l_int|4
)paren
op_or
(paren
id|hostdata-&gt;host_param.data_line_active_negation
op_lshift
l_int|5
)paren
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set active negation state failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_PCI_CONTROL_PARAMS
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.data_dma_burst_enable
op_lshift
l_int|1
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|hostdata-&gt;host_param.command_dma_burst_enable
op_lshift
l_int|1
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set pci control parameter failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_TAG_AGE_LIMIT
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.tag_aging
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set tag age limit failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_SELECT_TIMEOUT
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|hostdata-&gt;host_param.selection_timeout
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set selection timeout failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_TARGETS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_enable
)paren
r_continue
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_TARGET_PARAMS
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|i
op_lshift
l_int|8
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|device_flags
op_lshift
l_int|8
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
(paren
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_offset
op_lshift
l_int|8
)paren
op_or
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|synchronous_period
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set target parameter failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|MAX_LUNS
suffix:semicolon
id|k
op_increment
)paren
(brace
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_SET_DEV_QUEUE_PARAMS
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
(paren
id|i
op_lshift
l_int|8
)paren
op_or
id|k
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|hostdata-&gt;host_param.max_queue_depth
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
id|hostdata-&gt;dev_param
(braket
id|i
)braket
dot
id|execution_throttle
suffix:semicolon
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set device queue &quot;
l_string|&quot;parameter failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
id|queue_addr
op_assign
id|hostdata-&gt;res_dma
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_CMD_INIT_RESPONSE_QUEUE_64
suffix:semicolon
macro_line|#else
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_INIT_RES_QUEUE
suffix:semicolon
macro_line|#endif
id|param
(braket
l_int|1
)braket
op_assign
id|RES_QUEUE_LEN
op_plus
l_int|1
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|16
)paren
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|param
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|param
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|param
(braket
l_int|6
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|48
)paren
suffix:semicolon
id|param
(braket
l_int|7
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|32
)paren
suffix:semicolon
macro_line|#endif
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set response queue failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|queue_addr
op_assign
id|hostdata-&gt;req_dma
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_CMD_INIT_REQUEST_QUEUE_64
suffix:semicolon
macro_line|#else
id|param
(braket
l_int|0
)braket
op_assign
id|MBOX_INIT_REQ_QUEUE
suffix:semicolon
macro_line|#endif
id|param
(braket
l_int|1
)braket
op_assign
id|QLOGICISP_REQ_QUEUE_LEN
op_plus
l_int|1
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|16
)paren
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|param
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QL_ISP_A64
id|param
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|param
(braket
l_int|6
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|48
)paren
suffix:semicolon
id|param
(braket
l_int|7
)braket
op_assign
(paren
id|u_short
)paren
(paren
id|queue_addr
op_rshift
l_int|32
)paren
suffix:semicolon
macro_line|#endif
id|isp1020_mbox_command
c_func
(paren
id|host
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
(braket
l_int|0
)braket
op_ne
id|MBOX_COMMAND_COMPLETE
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : set request queue failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;isp1020_load_parameters&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * currently, this is only called during initialization or abort/reset,&n; * at which times interrupts are disabled, so polling is OK, I guess...&n; */
DECL|function|isp1020_mbox_command
r_static
r_int
id|isp1020_mbox_command
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
comma
id|u_short
id|param
(braket
)braket
)paren
(brace
r_int
id|loop_count
suffix:semicolon
r_if
c_cond
(paren
id|mbox_param
(braket
id|param
(braket
l_int|0
)braket
)braket
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|loop_count
op_assign
id|DEFAULT_LOOP_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|loop_count
op_logical_and
id|isp_inw
c_func
(paren
id|host
comma
id|HOST_HCCR
)paren
op_amp
l_int|0x0080
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loop_count
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp: mbox_command loop timeout #1&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mbox_param
(braket
id|param
(braket
l_int|0
)braket
)braket
op_rshift
l_int|4
)paren
(brace
r_case
l_int|8
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|7
)braket
comma
id|host
comma
id|MBOX7
)paren
suffix:semicolon
r_case
l_int|7
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|6
)braket
comma
id|host
comma
id|MBOX6
)paren
suffix:semicolon
r_case
l_int|6
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|5
)braket
comma
id|host
comma
id|MBOX5
)paren
suffix:semicolon
r_case
l_int|5
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|4
)braket
comma
id|host
comma
id|MBOX4
)paren
suffix:semicolon
r_case
l_int|4
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|3
)braket
comma
id|host
comma
id|MBOX3
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|2
)braket
comma
id|host
comma
id|MBOX2
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|1
)braket
comma
id|host
comma
id|MBOX1
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
id|isp_outw
c_func
(paren
id|param
(braket
l_int|0
)braket
comma
id|host
comma
id|MBOX0
)paren
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_SEMAPHORE
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_CLEAR_RISC_INTR
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_SET_HOST_INTR
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
id|loop_count
op_assign
id|DEFAULT_LOOP_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|loop_count
op_logical_and
op_logical_neg
(paren
id|isp_inw
c_func
(paren
id|host
comma
id|PCI_INTF_STS
)paren
op_amp
l_int|0x04
)paren
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loop_count
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp: mbox_command loop timeout #2&bslash;n&quot;
)paren
suffix:semicolon
id|loop_count
op_assign
id|DEFAULT_LOOP_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|loop_count
op_logical_and
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX0
)paren
op_eq
l_int|0x04
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loop_count
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp: mbox_command loop timeout #3&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mbox_param
(braket
id|param
(braket
l_int|0
)braket
)braket
op_amp
l_int|0xf
)paren
(brace
r_case
l_int|8
suffix:colon
id|param
(braket
l_int|7
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX7
)paren
suffix:semicolon
r_case
l_int|7
suffix:colon
id|param
(braket
l_int|6
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX6
)paren
suffix:semicolon
r_case
l_int|6
suffix:colon
id|param
(braket
l_int|5
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX5
)paren
suffix:semicolon
r_case
l_int|5
suffix:colon
id|param
(braket
l_int|4
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX4
)paren
suffix:semicolon
r_case
l_int|4
suffix:colon
id|param
(braket
l_int|3
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX3
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
id|param
(braket
l_int|2
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX2
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
id|param
(braket
l_int|1
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX1
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
id|param
(braket
l_int|0
)braket
op_assign
id|isp_inw
c_func
(paren
id|host
comma
id|MBOX0
)paren
suffix:semicolon
)brace
id|isp_outw
c_func
(paren
l_int|0x0
comma
id|host
comma
id|PCI_SEMAPHORE
)paren
suffix:semicolon
id|isp_outw
c_func
(paren
id|HCCR_CLEAR_RISC_INTR
comma
id|host
comma
id|HOST_HCCR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if DEBUG_ISP1020_INTR
DECL|function|isp1020_print_status_entry
r_void
id|isp1020_print_status_entry
c_func
(paren
r_struct
id|Status_Entry
op_star
id|status
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : entry count = 0x%02x, type = 0x%02x, flags = 0x%02x&bslash;n&quot;
comma
id|status-&gt;hdr.entry_cnt
comma
id|status-&gt;hdr.entry_type
comma
id|status-&gt;hdr.flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : scsi status = 0x%04x, completion status = 0x%04x&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;scsi_status
)paren
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;completion_status
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : state flags = 0x%04x, status flags = 0x%04x&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;state_flags
)paren
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;status_flags
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : time = 0x%04x, request sense length = 0x%04x&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;time
)paren
comma
id|le16_to_cpu
c_func
(paren
id|status-&gt;req_sense_len
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : residual transfer length = 0x%08x&bslash;n&quot;
comma
id|le32_to_cpu
c_func
(paren
id|status-&gt;residual
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|le16_to_cpu
c_func
(paren
id|status-&gt;req_sense_len
)paren
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;qlogicisp : sense data = 0x%02x&bslash;n&quot;
comma
id|status-&gt;req_sense_data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* DEBUG_ISP1020_INTR */
macro_line|#if DEBUG_ISP1020
DECL|function|isp1020_print_scsi_cmd
r_void
id|isp1020_print_scsi_cmd
c_func
(paren
id|Scsi_Cmnd
op_star
id|cmd
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : target = 0x%02x, lun = 0x%02x, cmd_len = 0x%02x&bslash;n&quot;
comma
id|cmd-&gt;target
comma
id|cmd-&gt;lun
comma
id|cmd-&gt;cmd_len
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qlogicisp : command = &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cmd-&gt;cmd_len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;0x%02x &quot;
comma
id|cmd-&gt;cmnd
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* DEBUG_ISP1020 */
DECL|variable|driver_template
r_static
id|Scsi_Host_Template
id|driver_template
op_assign
id|QLOGICISP
suffix:semicolon
macro_line|#include &quot;scsi_module.c&quot;
eof
