multiline_comment|/*&n; * sgiwd93.c: SGI WD93 scsi driver.&n; *&n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; *&t;&t; 1999 Andrew R. Baker (andrewb@uab.edu)&n; *&t;&t;      - Support for 2nd SCSI controller on Indigo2&n; * &n; * (In all truth, Jed Schimmel wrote all this code.)&n; *&n; * $Id: sgiwd93.c,v 1.19 2000/02/04 07:40:47 ralf Exp $&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/sgialib.h&gt;
macro_line|#include &lt;asm/sgi/sgi.h&gt;
macro_line|#include &lt;asm/sgi/sgimc.h&gt;
macro_line|#include &lt;asm/sgi/sgihpc.h&gt;
macro_line|#include &lt;asm/sgi/sgint23.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;wd33c93.h&quot;
macro_line|#include &quot;sgiwd93.h&quot;
macro_line|#include &lt;linux/stat.h&gt;
DECL|struct|hpc_chunk
r_struct
id|hpc_chunk
(brace
DECL|member|desc
r_struct
id|hpc_dma_desc
id|desc
suffix:semicolon
DECL|member|padding
r_int
r_int
id|padding
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|sgiwd93_host
r_struct
id|Scsi_Host
op_star
id|sgiwd93_host
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|sgiwd93_host1
r_struct
id|Scsi_Host
op_star
id|sgiwd93_host1
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Wuff wuff, wuff, wd33c93.c, wuff wuff, object oriented, bow wow. */
DECL|function|write_wd33c93_count
r_static
r_inline
r_void
id|write_wd33c93_count
c_func
(paren
id|wd33c93_regs
op_star
id|regp
comma
r_int
r_int
id|value
)paren
(brace
id|regp-&gt;SASR
op_assign
id|WD_TRANSFER_COUNT_MSB
suffix:semicolon
id|regp-&gt;SCMD
op_assign
(paren
(paren
id|value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|regp-&gt;SCMD
op_assign
(paren
(paren
id|value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|regp-&gt;SCMD
op_assign
(paren
(paren
id|value
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|read_wd33c93_count
r_static
r_inline
r_int
r_int
id|read_wd33c93_count
c_func
(paren
id|wd33c93_regs
op_star
id|regp
)paren
(brace
r_int
r_int
id|value
suffix:semicolon
id|regp-&gt;SASR
op_assign
id|WD_TRANSFER_COUNT_MSB
suffix:semicolon
id|value
op_assign
(paren
(paren
id|regp-&gt;SCMD
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|value
op_or_assign
(paren
(paren
id|regp-&gt;SCMD
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|value
op_or_assign
(paren
(paren
id|regp-&gt;SCMD
op_amp
l_int|0xff
)paren
op_lshift
l_int|0
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* XXX woof! */
DECL|function|sgiwd93_intr
r_static
r_void
id|sgiwd93_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
id|wd33c93_intr
c_func
(paren
(paren
r_struct
id|Scsi_Host
op_star
)paren
id|dev_id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|macro|DEBUG_DMA
macro_line|#undef DEBUG_DMA
r_static
r_inline
DECL|function|fill_hpc_entries
r_void
id|fill_hpc_entries
(paren
r_struct
id|hpc_chunk
op_star
op_star
id|hcp
comma
r_char
op_star
id|addr
comma
r_int
r_int
id|len
)paren
(brace
r_int
r_int
id|physaddr
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
comma
id|len
)paren
suffix:semicolon
id|physaddr
op_assign
id|PHYSADDR
c_func
(paren
id|addr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
multiline_comment|/*&n;&t;&t; * even cntinfo could be up to 16383, without&n;&t;&t; * magic only 8192 works correctly&n;&t;&t; */
id|count
op_assign
id|len
OG
l_int|8192
ques
c_cond
l_int|8192
suffix:colon
id|len
suffix:semicolon
(paren
op_star
id|hcp
)paren
op_member_access_from_pointer
id|desc.pbuf
op_assign
id|physaddr
suffix:semicolon
(paren
op_star
id|hcp
)paren
op_member_access_from_pointer
id|desc.cntinfo
op_assign
id|count
suffix:semicolon
(paren
op_star
id|hcp
)paren
op_increment
suffix:semicolon
id|len
op_sub_assign
id|count
suffix:semicolon
id|physaddr
op_add_assign
id|count
suffix:semicolon
)brace
)brace
DECL|function|dma_setup
r_static
r_int
id|dma_setup
c_func
(paren
id|Scsi_Cmnd
op_star
id|cmd
comma
r_int
id|datainp
)paren
(brace
r_struct
id|WD33C93_hostdata
op_star
id|hdata
op_assign
(paren
r_struct
id|WD33C93_hostdata
op_star
)paren
id|cmd-&gt;host-&gt;hostdata
suffix:semicolon
id|wd33c93_regs
op_star
id|regp
op_assign
id|hdata-&gt;regp
suffix:semicolon
r_struct
id|hpc3_scsiregs
op_star
id|hregs
op_assign
(paren
r_struct
id|hpc3_scsiregs
op_star
)paren
id|cmd-&gt;host-&gt;base
suffix:semicolon
r_struct
id|hpc_chunk
op_star
id|hcp
op_assign
(paren
r_struct
id|hpc_chunk
op_star
)paren
id|hdata-&gt;dma_bounce_buffer
suffix:semicolon
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;dma_setup: datainp&lt;%d&gt; hcp&lt;%p&gt; &quot;
comma
id|datainp
comma
id|hcp
)paren
suffix:semicolon
macro_line|#endif
id|hdata-&gt;dma_dir
op_assign
id|datainp
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;SCp.buffers_residual
)paren
(brace
r_struct
id|scatterlist
op_star
id|slp
op_assign
id|cmd-&gt;SCp.buffer
suffix:semicolon
r_int
id|i
comma
id|totlen
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;SCLIST&lt;&quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|cmd-&gt;SCp.buffers_residual
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;[%p,%d]&quot;
comma
id|slp
(braket
id|i
)braket
dot
id|address
comma
id|slp
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
macro_line|#endif
id|fill_hpc_entries
(paren
op_amp
id|hcp
comma
id|slp
(braket
id|i
)braket
dot
id|address
comma
id|slp
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
id|totlen
op_add_assign
id|slp
(braket
id|i
)braket
dot
id|length
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;&gt;tlen&lt;%d&gt;&quot;
comma
id|totlen
)paren
suffix:semicolon
macro_line|#endif
id|hdata-&gt;dma_bounce_len
op_assign
id|totlen
suffix:semicolon
multiline_comment|/* a trick... */
id|write_wd33c93_count
c_func
(paren
id|regp
comma
id|totlen
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Non-scattered dma. */
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;ONEBUF&lt;%p,%d&gt;&quot;
comma
id|cmd-&gt;SCp.ptr
comma
id|cmd-&gt;SCp.this_residual
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t;&t; * wd33c93 shouldn&squot;t pass us bogus dma_setups, but&n;&t;&t; * it does:-( The other wd33c93 drivers deal with&n;&t;&t; * it the same way (which isn&squot;t that obvious).&n;&t;&t; * IMHO a better fix would be, not to do these&n;&t;&t; * dma setups in the first place&n;&t;&t; */
r_if
c_cond
(paren
id|cmd-&gt;SCp.ptr
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|fill_hpc_entries
(paren
op_amp
id|hcp
comma
id|cmd-&gt;SCp.ptr
comma
id|cmd-&gt;SCp.this_residual
)paren
suffix:semicolon
id|write_wd33c93_count
c_func
(paren
id|regp
comma
id|cmd-&gt;SCp.this_residual
)paren
suffix:semicolon
)brace
multiline_comment|/* To make sure, if we trip an HPC bug, that we transfer&n;&t; * every single byte, we tag on an extra zero length dma&n;&t; * descriptor at the end of the chain.&n;&t; */
id|hcp-&gt;desc.pbuf
op_assign
l_int|0
suffix:semicolon
id|hcp-&gt;desc.cntinfo
op_assign
(paren
id|HPCDMA_EOX
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot; HPCGO&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Start up the HPC. */
id|hregs-&gt;ndptr
op_assign
id|PHYSADDR
c_func
(paren
id|hdata-&gt;dma_bounce_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|datainp
)paren
(brace
id|hregs-&gt;ctrl
op_assign
(paren
id|HPC3_SCTRL_ACTIVE
)paren
suffix:semicolon
)brace
r_else
id|hregs-&gt;ctrl
op_assign
(paren
id|HPC3_SCTRL_ACTIVE
op_or
id|HPC3_SCTRL_DIR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dma_stop
r_static
r_void
id|dma_stop
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|instance
comma
id|Scsi_Cmnd
op_star
id|SCpnt
comma
r_int
id|status
)paren
(brace
r_struct
id|WD33C93_hostdata
op_star
id|hdata
op_assign
(paren
r_struct
id|WD33C93_hostdata
op_star
)paren
id|instance-&gt;hostdata
suffix:semicolon
id|wd33c93_regs
op_star
id|regp
op_assign
id|hdata-&gt;regp
suffix:semicolon
r_struct
id|hpc3_scsiregs
op_star
id|hregs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|SCpnt
)paren
r_return
suffix:semicolon
id|hregs
op_assign
(paren
r_struct
id|hpc3_scsiregs
op_star
)paren
id|SCpnt-&gt;host-&gt;base
suffix:semicolon
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;dma_stop: status&lt;%d&gt; &quot;
comma
id|status
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* First stop the HPC and flush it&squot;s FIFO. */
r_if
c_cond
(paren
id|hdata-&gt;dma_dir
)paren
(brace
id|hregs-&gt;ctrl
op_or_assign
id|HPC3_SCTRL_FLUSH
suffix:semicolon
r_while
c_loop
(paren
id|hregs-&gt;ctrl
op_amp
id|HPC3_SCTRL_ACTIVE
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|hregs-&gt;ctrl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* See how far we got and update scatterlist state if necessary. */
r_if
c_cond
(paren
id|SCpnt-&gt;SCp.buffers_residual
)paren
(brace
r_struct
id|scatterlist
op_star
id|slp
op_assign
id|SCpnt-&gt;SCp.buffer
suffix:semicolon
r_int
id|totlen
comma
id|wd93_residual
comma
id|transferred
comma
id|i
suffix:semicolon
multiline_comment|/* Yep, we were doing the scatterlist thang. */
id|totlen
op_assign
id|hdata-&gt;dma_bounce_len
suffix:semicolon
id|wd93_residual
op_assign
id|read_wd33c93_count
c_func
(paren
id|regp
)paren
suffix:semicolon
id|transferred
op_assign
id|totlen
op_minus
id|wd93_residual
suffix:semicolon
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;tlen&lt;%d&gt;resid&lt;%d&gt;transf&lt;%d&gt; &quot;
comma
id|totlen
comma
id|wd93_residual
comma
id|transferred
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Avoid long winded partial-transfer search for common case. */
r_if
c_cond
(paren
id|transferred
op_ne
id|totlen
)paren
(brace
multiline_comment|/* This is the nut case. */
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;Jed was here...&quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|SCpnt-&gt;SCp.buffers_residual
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|slp
(braket
id|i
)braket
dot
id|length
op_ge
id|transferred
)paren
(brace
r_break
suffix:semicolon
)brace
id|transferred
op_sub_assign
id|slp
(braket
id|i
)braket
dot
id|length
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* This is the common case. */
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;did it all...&quot;
)paren
suffix:semicolon
macro_line|#endif
id|i
op_assign
id|SCpnt-&gt;SCp.buffers_residual
suffix:semicolon
)brace
id|SCpnt-&gt;SCp.buffer
op_assign
op_amp
id|slp
(braket
id|i
)braket
suffix:semicolon
id|SCpnt-&gt;SCp.buffers_residual
op_assign
id|SCpnt-&gt;SCp.buffers_residual
op_minus
id|i
suffix:semicolon
id|SCpnt-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
id|slp
(braket
id|i
)braket
dot
id|address
suffix:semicolon
id|SCpnt-&gt;SCp.this_residual
op_assign
id|slp
(braket
id|i
)braket
dot
id|length
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_DMA
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|sgiwd93_reset
r_void
id|sgiwd93_reset
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_struct
id|hpc3_scsiregs
op_star
id|hregs
op_assign
(paren
r_struct
id|hpc3_scsiregs
op_star
)paren
id|base
suffix:semicolon
id|hregs-&gt;ctrl
op_assign
id|HPC3_SCTRL_CRESET
suffix:semicolon
id|udelay
(paren
l_int|50
)paren
suffix:semicolon
id|hregs-&gt;ctrl
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|init_hpc_chain
r_static
r_inline
r_void
id|init_hpc_chain
c_func
(paren
id|uchar
op_star
id|buf
)paren
(brace
r_struct
id|hpc_chunk
op_star
id|hcp
op_assign
(paren
r_struct
id|hpc_chunk
op_star
)paren
id|buf
suffix:semicolon
r_int
r_int
id|start
comma
id|end
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|buf
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|PAGE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|hcp-&gt;desc.pnext
op_assign
id|PHYSADDR
c_func
(paren
(paren
id|hcp
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|hcp-&gt;desc.cntinfo
op_assign
id|HPCDMA_EOX
suffix:semicolon
id|hcp
op_increment
suffix:semicolon
id|start
op_add_assign
r_sizeof
(paren
r_struct
id|hpc_chunk
)paren
suffix:semicolon
)brace
suffix:semicolon
id|hcp
op_decrement
suffix:semicolon
id|hcp-&gt;desc.pnext
op_assign
id|PHYSADDR
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
DECL|function|sgiwd93_detect
r_int
id|__init
id|sgiwd93_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|SGIblows
)paren
(brace
r_static
r_int
r_char
id|called
op_assign
l_int|0
suffix:semicolon
r_struct
id|hpc3_scsiregs
op_star
id|hregs
op_assign
op_amp
id|hpc3c0-&gt;scsi_chan0
suffix:semicolon
r_struct
id|hpc3_scsiregs
op_star
id|hregs1
op_assign
op_amp
id|hpc3c0-&gt;scsi_chan1
suffix:semicolon
r_struct
id|WD33C93_hostdata
op_star
id|hdata
suffix:semicolon
r_struct
id|WD33C93_hostdata
op_star
id|hdata1
suffix:semicolon
id|uchar
op_star
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|called
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Should bitch on the console about this... */
id|SGIblows-&gt;proc_name
op_assign
l_string|&quot;SGIWD93&quot;
suffix:semicolon
id|sgiwd93_host
op_assign
id|scsi_register
c_func
(paren
id|SGIblows
comma
r_sizeof
(paren
r_struct
id|WD33C93_hostdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sgiwd93_host
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|sgiwd93_host-&gt;base
op_assign
(paren
r_int
r_int
)paren
id|hregs
suffix:semicolon
id|sgiwd93_host-&gt;irq
op_assign
id|SGI_WD93_0_IRQ
suffix:semicolon
id|buf
op_assign
(paren
id|uchar
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
id|init_hpc_chain
c_func
(paren
id|buf
)paren
suffix:semicolon
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
comma
id|PAGE_SIZE
)paren
suffix:semicolon
multiline_comment|/* HPC_SCSI_REG0 | 0x03 | KSEG1 */
id|wd33c93_init
c_func
(paren
id|sgiwd93_host
comma
(paren
id|wd33c93_regs
op_star
)paren
l_int|0xbfbc0003
comma
id|dma_setup
comma
id|dma_stop
comma
id|WD33C93_FS_16_20
)paren
suffix:semicolon
id|hdata
op_assign
(paren
r_struct
id|WD33C93_hostdata
op_star
)paren
id|sgiwd93_host-&gt;hostdata
suffix:semicolon
id|hdata-&gt;no_sync
op_assign
l_int|0
suffix:semicolon
id|hdata-&gt;dma_bounce_buffer
op_assign
(paren
id|uchar
op_star
)paren
(paren
id|KSEG1ADDR
c_func
(paren
id|buf
)paren
)paren
suffix:semicolon
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|SGI_WD93_0_IRQ
comma
id|sgiwd93_intr
comma
l_int|0
comma
l_string|&quot;SGI WD93&quot;
comma
(paren
r_void
op_star
)paren
id|sgiwd93_host
)paren
suffix:semicolon
multiline_comment|/* set up second controller on the Indigo2 */
r_if
c_cond
(paren
op_logical_neg
id|sgi_guiness
)paren
(brace
id|sgiwd93_host1
op_assign
id|scsi_register
c_func
(paren
id|SGIblows
comma
r_sizeof
(paren
r_struct
id|WD33C93_hostdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sgiwd93_host1
op_ne
l_int|NULL
)paren
(brace
id|sgiwd93_host1-&gt;base
op_assign
(paren
r_int
r_int
)paren
id|hregs1
suffix:semicolon
id|sgiwd93_host1-&gt;irq
op_assign
id|SGI_WD93_1_IRQ
suffix:semicolon
id|buf
op_assign
(paren
id|uchar
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
id|init_hpc_chain
c_func
(paren
id|buf
)paren
suffix:semicolon
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
comma
id|PAGE_SIZE
)paren
suffix:semicolon
multiline_comment|/* HPC_SCSI_REG1 | 0x03 | KSEG1 */
id|wd33c93_init
c_func
(paren
id|sgiwd93_host1
comma
(paren
id|wd33c93_regs
op_star
)paren
l_int|0xbfbc8003
comma
id|dma_setup
comma
id|dma_stop
comma
id|WD33C93_FS_16_20
)paren
suffix:semicolon
id|hdata1
op_assign
(paren
r_struct
id|WD33C93_hostdata
op_star
)paren
id|sgiwd93_host1-&gt;hostdata
suffix:semicolon
id|hdata1-&gt;no_sync
op_assign
l_int|0
suffix:semicolon
id|hdata1-&gt;dma_bounce_buffer
op_assign
(paren
id|uchar
op_star
)paren
(paren
id|KSEG1ADDR
c_func
(paren
id|buf
)paren
)paren
suffix:semicolon
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|SGI_WD93_1_IRQ
comma
id|sgiwd93_intr
comma
l_int|0
comma
l_string|&quot;SGI WD93&quot;
comma
(paren
r_void
op_star
)paren
id|sgiwd93_host1
)paren
suffix:semicolon
)brace
)brace
id|called
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Found one. */
)brace
DECL|macro|HOSTS_C
mdefine_line|#define HOSTS_C
macro_line|#include &quot;sgiwd93.h&quot;
DECL|variable|driver_template
r_static
id|Scsi_Host_Template
id|driver_template
op_assign
id|SGIWD93_SCSI
suffix:semicolon
macro_line|#include &quot;scsi_module.c&quot;
DECL|function|sgiwd93_release
r_int
id|sgiwd93_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|instance
)paren
(brace
macro_line|#ifdef MODULE
id|free_irq
c_func
(paren
id|SGI_WD93_0_IRQ
comma
id|sgiwd93_intr
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|KSEG0ADDR
c_func
(paren
id|hdata-&gt;dma_bounce_buffer
)paren
)paren
suffix:semicolon
id|wd33c93_release
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_guiness
)paren
(brace
id|free_irq
c_func
(paren
id|SGI_WD93_1_IRQ
comma
id|sgiwd93_intr
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|KSEG0ADDR
c_func
(paren
id|hdata1-&gt;dma_bounce_buffer
)paren
)paren
suffix:semicolon
id|wd33c93_release
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
eof
