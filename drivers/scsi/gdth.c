multiline_comment|/************************************************************************&n; * GDT ISA/EISA/PCI Disk Array Controller driver for Linux              *&n; *                                                                      *&n; * gdth.c                                                               *&n; * Copyright (C) 1995-97 ICP vortex Computersysteme GmbH, Achim Leubner *&n; *                                                                      *&n; * &lt;achim@vortex.de&gt;                                                    *&n; *                                                                      *&n; * This program is free software; you can redistribute it and/or modify *&n; * it under the terms of the GNU General Public License as published    *&n; * by the Free Software Foundation; either version 2 of the License,    *&n; * or (at your option) any later version.                               *&n; *                                                                      *&n; * This program is distributed in the hope that it will be useful,      *&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of       *&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the         *&n; * GNU General Public License for more details.                         *&n; *                                                                      *&n; * You should have received a copy of the GNU General Public License    *&n; * along with this kernel; if not, write to the Free Software           *&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.            *&n; *                                                                      *&n; * Tested with Linux 1.2.13, ..., 2.1.61                                *&n; *                                                                      *&n; * $Log: gdth.c,v $&n; * Revision 1.3  1998/02/25 23:52:32  ecd&n; * Final round of PCI device driver patches by Martin Mares.&n; *&n; * I could not verify each and every change to the drivers locally,&n; * please consult linux/Documentation/pci.txt to understand changes&n; * made in case patching should be necessary.&n; *&n; * Revision 1.2  1997/11/12 23:58:51  davem&n; * Merge to 2.1.63 to get the Ingo P5 bugfix.&n; * I did not touch the sound changes at all, Alan&n; * please look into that stuff as it is your&n; * territory.&n; *&n; * Revision 1.10  1997/10/31 12:29:57  achim&n; * Read heads/sectors from host drive&n; *&n; * Revision 1.9  1997/09/04 10:07:25  achim&n; * IO-mapping with virt_to_bus(), readb(), writeb(), ...&n; * register_reboot_notifier() to get a notify on shutdown used&n; *&n; * Revision 1.8  1997/04/02 12:14:30  achim&n; * Version 1.00 (see gdth.h), tested with kernel 2.0.29&n; *&n; * Revision 1.7  1997/03/12 13:33:37  achim&n; * gdth_reset() changed, new async. events&n; *&n; * Revision 1.6  1997/03/04 14:01:11  achim&n; * Shutdown routine gdth_halt() implemented&n; *&n; * Revision 1.5  1997/02/21 09:08:36  achim&n; * New controller included (RP, RP1, RP2 series)&n; * IOCTL interface implemented&n; *&n; * Revision 1.4  1996/07/05 12:48:55  achim&n; * Function gdth_bios_param() implemented&n; * New constant GDTH_MAXC_P_L inserted&n; * GDT_WRITE_THR, GDT_EXT_INFO implemented&n; * Function gdth_reset() changed&n; *&n; * Revision 1.3  1996/05/10 09:04:41  achim&n; * Small changes for Linux 1.2.13&n; *&n; * Revision 1.2  1996/05/09 12:45:27  achim&n; * Loadable module support implemented&n; * /proc support corrections made&n; *&n; * Revision 1.1  1996/04/11 07:35:57  achim&n; * Initial revision&n; *&n; *&n; * $Id: gdth.c,v 1.4 1998/04/15 14:35:26 mj Exp $ &n; ************************************************************************/
macro_line|#ifdef MODULE
macro_line|#include &lt;linux/module.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#else
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/spinlock.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#else
macro_line|#include &quot;../block/blk.h&quot;
macro_line|#endif
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;sd.h&quot;
macro_line|#include &quot;gdth.h&quot;
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|do_gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
macro_line|#else
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|gdth_sync_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
comma
id|unchar
id|index
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
suffix:semicolon
r_static
r_int
id|gdth_async_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
)paren
suffix:semicolon
r_static
r_void
id|gdth_putq
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|priority
)paren
suffix:semicolon
r_static
r_void
id|gdth_next
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_fill_raw_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
suffix:semicolon
r_static
r_int
id|gdth_special_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
suffix:semicolon
r_static
id|gdth_evt_str
op_star
id|gdth_store_event
c_func
(paren
id|ushort
id|source
comma
id|ushort
id|idx
comma
id|gdth_evt_data
op_star
id|evt
)paren
suffix:semicolon
r_static
r_int
id|gdth_read_event
c_func
(paren
r_int
id|handle
comma
id|gdth_evt_str
op_star
id|estr
)paren
suffix:semicolon
r_static
r_void
id|gdth_readapp_event
c_func
(paren
id|unchar
id|application
comma
id|gdth_evt_str
op_star
id|estr
)paren
suffix:semicolon
r_static
r_void
id|gdth_clear_events
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|gdth_copy_internal_data
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_char
op_star
id|buffer
comma
id|ushort
id|count
)paren
suffix:semicolon
r_static
r_int
id|gdth_internal_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
comma
id|ulong
op_star
id|flags
)paren
suffix:semicolon
r_static
r_int
id|gdth_fill_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|ushort
id|hdrive
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_eisa
c_func
(paren
id|ushort
id|eisa_adr
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_isa
c_func
(paren
id|ulong
id|bios_adr
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_pci
c_func
(paren
id|ushort
id|device_id
comma
id|ushort
id|index
comma
id|gdth_pci_str
op_star
id|pcistr
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_eisa
c_func
(paren
id|ushort
id|eisa_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_isa
c_func
(paren
id|ulong
id|bios_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_void
id|gdth_enable_int
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_get_status
c_func
(paren
id|unchar
op_star
id|pIStatus
comma
r_int
id|irq
)paren
suffix:semicolon
r_static
r_int
id|gdth_test_busy
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_get_cmd_index
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_void
id|gdth_release_event
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_wait
c_func
(paren
r_int
id|hanum
comma
r_int
id|index
comma
id|ulong
id|time
)paren
suffix:semicolon
r_static
r_int
id|gdth_internal_cmd
c_func
(paren
r_int
id|hanum
comma
id|unchar
id|service
comma
id|ushort
id|opcode
comma
id|ulong
id|p1
comma
id|ulong
id|p2
comma
id|ulong
id|p3
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_drives
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_void
op_star
id|gdth_mmap
c_func
(paren
id|ulong
id|paddr
comma
id|ulong
id|size
)paren
suffix:semicolon
r_static
r_void
id|gdth_munmap
c_func
(paren
r_void
op_star
id|addr
)paren
suffix:semicolon
r_static
r_const
r_char
op_star
id|gdth_ctr_name
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
r_static
r_int
id|gdth_halt
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
id|ulong
id|event
comma
r_void
op_star
id|buf
)paren
suffix:semicolon
macro_line|#else
r_void
id|gdth_halt
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DEBUG_GDTH
DECL|variable|DebugState
r_static
id|unchar
id|DebugState
op_assign
id|DEBUG_GDTH
suffix:semicolon
r_extern
r_int
id|sys_syslog
c_func
(paren
r_int
comma
r_char
op_star
comma
r_int
)paren
suffix:semicolon
DECL|macro|LOGEN
mdefine_line|#define LOGEN           sys_syslog(7,NULL,0);
DECL|macro|WAITSEC
mdefine_line|#define WAITSEC(a)      mdelay((a)*1000)
macro_line|#ifdef SLOWMOTION_GDTH
DECL|macro|SLOWM
mdefine_line|#define SLOWM   WAITSEC(2)  
DECL|macro|INIT_RETRIES
macro_line|#undef  INIT_RETRIES
DECL|macro|INIT_TIMEOUT
macro_line|#undef  INIT_TIMEOUT
DECL|macro|POLL_TIMEOUT
macro_line|#undef  POLL_TIMEOUT
DECL|macro|INIT_RETRIES
mdefine_line|#define INIT_RETRIES    15
DECL|macro|INIT_TIMEOUT
mdefine_line|#define INIT_TIMEOUT    150
DECL|macro|POLL_TIMEOUT
mdefine_line|#define POLL_TIMEOUT    150
macro_line|#else
DECL|macro|SLOWM
mdefine_line|#define SLOWM
macro_line|#endif
macro_line|#ifdef __SERIAL__
DECL|macro|MAX_SERBUF
mdefine_line|#define MAX_SERBUF 160
r_static
r_void
id|ser_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ser_puts
c_func
(paren
r_char
op_star
id|str
)paren
suffix:semicolon
r_static
r_void
id|ser_putc
c_func
(paren
r_char
id|c
)paren
suffix:semicolon
r_static
r_int
id|ser_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
suffix:semicolon
DECL|variable|strbuf
r_static
r_char
id|strbuf
(braket
id|MAX_SERBUF
op_plus
l_int|1
)braket
suffix:semicolon
macro_line|#ifdef __COM2__
DECL|macro|COM_BASE
mdefine_line|#define COM_BASE 0x2f8
macro_line|#else
DECL|macro|COM_BASE
mdefine_line|#define COM_BASE 0x3f8
macro_line|#endif
DECL|function|ser_init
r_static
r_void
id|ser_init
c_func
(paren
)paren
(brace
r_int
id|port
op_assign
id|COM_BASE
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
comma
id|port
op_plus
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 19200 Baud, if 9600: outb(12,port) */
id|outb
c_func
(paren
l_int|6
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|3
comma
id|port
op_plus
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;    ser_putc(&squot;I&squot;);&n;    ser_putc(&squot; &squot;);&n;    */
)brace
DECL|function|ser_puts
r_static
r_void
id|ser_puts
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|ptr
suffix:semicolon
id|ser_init
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|str
suffix:semicolon
op_star
id|ptr
suffix:semicolon
op_increment
id|ptr
)paren
id|ser_putc
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|ser_putc
r_static
r_void
id|ser_putc
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|port
op_assign
id|COM_BASE
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|port
op_plus
l_int|5
)paren
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
id|c
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|0x0a
)paren
(brace
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|port
op_plus
l_int|5
)paren
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0d
comma
id|port
)paren
suffix:semicolon
)brace
)brace
DECL|function|ser_printk
r_static
r_int
id|ser_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
c_func
(paren
id|strbuf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|ser_puts
c_func
(paren
id|strbuf
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|macro|TRACE
mdefine_line|#define TRACE(a)    {if (DebugState==1) {ser_printk a; SLOWM}}
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)   {if (DebugState==1 || DebugState==2) {ser_printk a; SLOWM}}
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)   {if (DebugState!=0) {ser_printk a; SLOWM}}
macro_line|#else /* !__SERIAL__ */
DECL|macro|TRACE
mdefine_line|#define TRACE(a)    {if (DebugState==1) {LOGEN;printk a; SLOWM}}
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)   {if (DebugState==1 || DebugState==2) {LOGEN;printk a; SLOWM}}
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)   {if (DebugState!=0) {LOGEN;printk a; SLOWM}}
macro_line|#endif
macro_line|#else /* !DEBUG */
DECL|macro|TRACE
mdefine_line|#define TRACE(a)
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)
macro_line|#endif
macro_line|#ifdef GDTH_STATISTICS
DECL|variable|max_rq
DECL|variable|max_index
DECL|variable|max_sg
r_static
id|ulong
id|max_rq
op_assign
l_int|0
comma
id|max_index
op_assign
l_int|0
comma
id|max_sg
op_assign
l_int|0
suffix:semicolon
DECL|variable|act_ints
DECL|variable|act_ios
DECL|variable|act_stats
DECL|variable|act_rq
r_static
id|ulong
id|act_ints
op_assign
l_int|0
comma
id|act_ios
op_assign
l_int|0
comma
id|act_stats
op_assign
l_int|0
comma
id|act_rq
op_assign
l_int|0
suffix:semicolon
DECL|macro|GDTH_TIMER
mdefine_line|#define GDTH_TIMER      31                      /* see linux/timer.h ! */
macro_line|#endif
DECL|macro|PTR2USHORT
mdefine_line|#define PTR2USHORT(a)   (ushort)(ulong)(a)
DECL|macro|JIFFYWAIT
mdefine_line|#define JIFFYWAIT(a)    {ulong gdtjf;gdtjf=jiffies+(a);while(gdtjf&gt;jiffies);}
DECL|macro|GDTOFFSOF
mdefine_line|#define GDTOFFSOF(a,b)  (size_t)&amp;(((a*)0)-&gt;b)   
DECL|macro|INDEX_OK
mdefine_line|#define INDEX_OK(i,t)   ((i)&lt;sizeof(t)/sizeof((t)[0]))
DECL|macro|NUMDATA
mdefine_line|#define NUMDATA(a)      ( (gdth_num_str  *)((a)-&gt;hostdata))
DECL|macro|HADATA
mdefine_line|#define HADATA(a)       (&amp;((gdth_ext_str *)((a)-&gt;hostdata))-&gt;haext)
DECL|macro|CMDDATA
mdefine_line|#define CMDDATA(a)      (&amp;((gdth_ext_str *)((a)-&gt;hostdata))-&gt;cmdext)
DECL|macro|DMADATA
mdefine_line|#define DMADATA(a)      (&amp;((gdth_ext_str *)((a)-&gt;hostdata))-&gt;dmaext)
macro_line|#if LINUX_VERSION_CODE &lt; 0x010300
DECL|function|gdth_mmap
r_static
r_void
op_star
id|gdth_mmap
c_func
(paren
id|ulong
id|paddr
comma
id|ulong
id|size
)paren
(brace
r_if
c_cond
(paren
id|paddr
op_ge
id|high_memory
)paren
r_return
l_int|NULL
suffix:semicolon
r_else
r_return
(paren
r_void
op_star
)paren
id|paddr
suffix:semicolon
)brace
DECL|function|gdth_munmap
r_static
r_void
id|gdth_munmap
c_func
(paren
r_void
op_star
id|addr
)paren
(brace
)brace
DECL|function|virt_to_phys
r_inline
id|ulong
id|virt_to_phys
c_func
(paren
r_volatile
r_void
op_star
id|addr
)paren
(brace
r_return
(paren
id|ulong
)paren
id|addr
suffix:semicolon
)brace
DECL|function|phys_to_virt
r_inline
r_void
op_star
id|phys_to_virt
c_func
(paren
id|ulong
id|addr
)paren
(brace
r_return
(paren
r_void
op_star
)paren
id|addr
suffix:semicolon
)brace
DECL|macro|virt_to_bus
mdefine_line|#define virt_to_bus&t;&t;virt_to_phys
DECL|macro|bus_to_virt
mdefine_line|#define bus_to_virt&t;&t;phys_to_virt
DECL|macro|readb
mdefine_line|#define readb(addr)&t;&t;(*(volatile unchar *)(addr))
DECL|macro|readw
mdefine_line|#define readw(addr)&t;&t;(*(volatile ushort *)(addr))
DECL|macro|readl
mdefine_line|#define readl(addr)&t;&t;(*(volatile ulong *)(addr))
DECL|macro|writeb
mdefine_line|#define writeb(b,addr)&t;&t;(*(volatile unchar *)(addr) = (b))
DECL|macro|writew
mdefine_line|#define writew(b,addr)&t;&t;(*(volatile ushort *)(addr) = (b))
DECL|macro|writel
mdefine_line|#define writel(b,addr)&t;&t;(*(volatile ulong *)(addr) = (b))
DECL|macro|memset_io
mdefine_line|#define memset_io(a,b,c)&t;memset((void *)(a),(b),(c))
DECL|macro|memcpy_fromio
mdefine_line|#define memcpy_fromio(a,b,c)&t;memcpy((a),(void *)(b),(c))
DECL|macro|memcpy_toio
mdefine_line|#define memcpy_toio(a,b,c)&t;memcpy((void *)(a),(b),(c))
macro_line|#elif LINUX_VERSION_CODE &lt; 0x020100
DECL|variable|remapped
r_static
r_int
id|remapped
op_assign
id|FALSE
suffix:semicolon
DECL|function|gdth_mmap
r_static
r_void
op_star
id|gdth_mmap
c_func
(paren
id|ulong
id|paddr
comma
id|ulong
id|size
)paren
(brace
r_if
c_cond
(paren
id|paddr
op_ge
id|high_memory
)paren
(brace
id|remapped
op_assign
id|TRUE
suffix:semicolon
r_return
id|vremap
c_func
(paren
id|paddr
comma
id|size
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
r_void
op_star
)paren
id|paddr
suffix:semicolon
)brace
)brace
DECL|function|gdth_munmap
r_static
r_void
id|gdth_munmap
c_func
(paren
r_void
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
id|remapped
)paren
id|vfree
c_func
(paren
id|addr
)paren
suffix:semicolon
id|remapped
op_assign
id|FALSE
suffix:semicolon
)brace
macro_line|#else
DECL|function|gdth_mmap
r_static
r_void
op_star
id|gdth_mmap
c_func
(paren
id|ulong
id|paddr
comma
id|ulong
id|size
)paren
(brace
r_return
id|ioremap
c_func
(paren
id|paddr
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|gdth_munmap
r_static
r_void
id|gdth_munmap
c_func
(paren
r_void
op_star
id|addr
)paren
(brace
r_return
id|iounmap
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|gdth_drq_tab
r_static
id|unchar
id|gdth_drq_tab
(braket
l_int|4
)braket
op_assign
(brace
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|7
)brace
suffix:semicolon
multiline_comment|/* DRQ table */
DECL|variable|gdth_irq_tab
r_static
id|unchar
id|gdth_irq_tab
(braket
l_int|6
)braket
op_assign
(brace
l_int|0
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|14
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* IRQ table */
DECL|variable|gdth_polling
r_static
id|unchar
id|gdth_polling
suffix:semicolon
multiline_comment|/* polling if TRUE */
DECL|variable|gdth_from_wait
r_static
id|unchar
id|gdth_from_wait
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* gdth_wait() */
DECL|variable|wait_index
DECL|variable|wait_hanum
r_static
r_int
id|wait_index
comma
id|wait_hanum
suffix:semicolon
multiline_comment|/* gdth_wait() */
DECL|variable|gdth_ctr_count
r_static
r_int
id|gdth_ctr_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* controller count */
DECL|variable|gdth_ctr_vcount
r_static
r_int
id|gdth_ctr_vcount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* virt. ctr. count */
DECL|variable|gdth_ctr_tab
r_static
r_struct
id|Scsi_Host
op_star
id|gdth_ctr_tab
(braket
id|MAXHA
)braket
suffix:semicolon
multiline_comment|/* controller table */
DECL|variable|gdth_ctr_vtab
r_static
r_struct
id|Scsi_Host
op_star
id|gdth_ctr_vtab
(braket
id|MAXHA
op_star
id|MAXBUS
)braket
suffix:semicolon
multiline_comment|/* virt. ctr. table */
DECL|variable|gdth_write_through
r_static
id|unchar
id|gdth_write_through
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* write through */
DECL|variable|gdth_ioctl_tab
r_static
r_char
op_star
id|gdth_ioctl_tab
(braket
l_int|4
)braket
(braket
id|MAXHA
)braket
suffix:semicolon
multiline_comment|/* ioctl buffer */
DECL|variable|ebuffer
r_static
id|gdth_evt_str
id|ebuffer
(braket
id|MAX_EVENTS
)braket
suffix:semicolon
multiline_comment|/* event buffer */
DECL|variable|elastidx
r_static
r_int
id|elastidx
suffix:semicolon
DECL|variable|eoldidx
r_static
r_int
id|eoldidx
suffix:semicolon
r_static
r_struct
(brace
DECL|member|cmnd
id|Scsi_Cmnd
op_star
id|cmnd
suffix:semicolon
multiline_comment|/* pending request */
DECL|member|service
id|ushort
id|service
suffix:semicolon
multiline_comment|/* service */
DECL|variable|gdth_cmd_tab
)brace
id|gdth_cmd_tab
(braket
id|GDTH_MAXCMDS
)braket
(braket
id|MAXHA
)braket
suffix:semicolon
multiline_comment|/* table of pend. requests */
DECL|macro|DIN
mdefine_line|#define DIN     1                               /* IN data direction */
DECL|macro|DOU
mdefine_line|#define DOU     2                               /* OUT data direction */
DECL|macro|DNO
mdefine_line|#define DNO     DIN                             /* no data transfer */
DECL|macro|DUN
mdefine_line|#define DUN     DIN                             /* unknown data direction */
DECL|variable|gdth_direction_tab
r_static
id|unchar
id|gdth_direction_tab
(braket
l_int|0x100
)braket
op_assign
(brace
id|DNO
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DUN
comma
id|DOU
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DOU
comma
id|DNO
comma
id|DNO
comma
id|DOU
comma
id|DNO
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DOU
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DOU
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DNO
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DNO
comma
id|DUN
comma
id|DNO
comma
id|DNO
comma
id|DNO
comma
id|DUN
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DNO
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DUN
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
)brace
suffix:semicolon
multiline_comment|/* LILO params: gdth=&lt;IRQ&gt;&n; *&n; * Where: &lt;IRQ&gt; is any of the valid IRQs for EISA controllers (10,11,12,14)&n; * Sets the IRQ of the GDT3000/3020 EISA controller to this value,&n; * if the IRQ can not automat. detect (controller BIOS disabled)&n; * See gdth_init_eisa() &n; *&n; * You can use the command line gdth=0 to disable the driver &n; */
DECL|variable|irqs
r_static
id|unchar
id|irqs
(braket
id|MAXHA
)braket
op_assign
(brace
l_int|0xff
)brace
suffix:semicolon
DECL|variable|disable_gdth_scan
r_static
id|unchar
id|disable_gdth_scan
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* /proc support */
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
macro_line|#include &lt;linux/stat.h&gt; 
DECL|variable|proc_scsi_gdth
r_struct
id|proc_dir_entry
id|proc_scsi_gdth
op_assign
(brace
id|PROC_SCSI_GDTH
comma
l_int|4
comma
l_string|&quot;gdth&quot;
comma
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
l_int|2
)brace
suffix:semicolon
macro_line|#include &quot;gdth_proc.h&quot;
macro_line|#include &quot;gdth_proc.c&quot;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
multiline_comment|/* notifier block to get a notify on system shutdown/halt/reboot */
DECL|variable|gdth_notifier
r_static
r_struct
id|notifier_block
id|gdth_notifier
op_assign
(brace
id|gdth_halt
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* controller search and initialization functions */
DECL|function|gdth_search_eisa
r_static
r_int
id|gdth_search_eisa
c_func
(paren
id|ushort
id|eisa_adr
)paren
(brace
id|ulong
id|id
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_eisa() adr. %x&bslash;n&quot;
comma
id|eisa_adr
)paren
)paren
suffix:semicolon
id|id
op_assign
id|inl
c_func
(paren
id|eisa_adr
op_plus
id|ID0REG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|GDT3A_ID
op_logical_or
id|id
op_eq
id|GDT3B_ID
)paren
(brace
multiline_comment|/* GDT3000A or GDT3000B */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EISAREG
)paren
op_amp
l_int|8
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* not EISA configured */
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
id|GDT3_ID
)paren
multiline_comment|/* GDT3000 */
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_search_isa
r_static
r_int
id|gdth_search_isa
c_func
(paren
id|ulong
id|bios_adr
)paren
(brace
r_void
op_star
id|addr
suffix:semicolon
id|ulong
id|id
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_isa() bios adr. %lx&bslash;n&quot;
comma
id|bios_adr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
op_assign
id|gdth_mmap
c_func
(paren
id|bios_adr
op_plus
id|BIOS_ID_OFFS
comma
r_sizeof
(paren
id|ulong
)paren
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|id
op_assign
id|readl
c_func
(paren
id|addr
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|GDT2_ID
)paren
multiline_comment|/* GDT2000 */
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_search_pci
r_static
r_int
id|gdth_search_pci
c_func
(paren
id|ushort
id|device_id
comma
id|ushort
id|index
comma
id|gdth_pci_str
op_star
id|pcistr
)paren
(brace
r_int
id|error
suffix:semicolon
id|ulong
id|base0
comma
id|base1
comma
id|base2
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_pci() device_id %d, index %d&bslash;n&quot;
comma
id|device_id
comma
id|index
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pcibios_find_device
c_func
(paren
id|PCI_VENDOR_ID_VORTEX
comma
id|device_id
comma
id|index
comma
op_amp
id|pcistr-&gt;bus
comma
op_amp
id|pcistr-&gt;device_fn
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* GDT PCI controller found, now read resources from config space */
macro_line|#if LINUX_VERSION_CODE &gt;= 0x20155
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|pci_find_slot
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
)paren
suffix:semicolon
id|base0
op_assign
id|pdev-&gt;base_address
(braket
l_int|0
)braket
suffix:semicolon
id|base1
op_assign
id|pdev-&gt;base_address
(braket
l_int|1
)braket
suffix:semicolon
id|base2
op_assign
id|pdev-&gt;base_address
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|pcibios_read_config_dword
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_ROM_ADDRESS
comma
(paren
r_int
op_star
)paren
op_amp
id|pcistr-&gt;bios
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: error %d reading configuration space&quot;
comma
id|error
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pcistr-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
)brace
macro_line|#else
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
mdefine_line|#define GDTH_BASEP      (int *)
macro_line|#else
mdefine_line|#define GDTH_BASEP
macro_line|#endif
r_if
c_cond
(paren
(paren
id|error
op_assign
id|pcibios_read_config_dword
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_BASE_ADDRESS_0
comma
id|GDTH_BASEP
op_amp
id|base0
)paren
)paren
op_logical_or
(paren
id|error
op_assign
id|pcibios_read_config_dword
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_BASE_ADDRESS_1
comma
id|GDTH_BASEP
op_amp
id|base1
)paren
)paren
op_logical_or
(paren
id|error
op_assign
id|pcibios_read_config_dword
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_BASE_ADDRESS_2
comma
id|GDTH_BASEP
op_amp
id|base2
)paren
)paren
op_logical_or
(paren
id|error
op_assign
id|pcibios_read_config_dword
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_ROM_ADDRESS
comma
id|GDTH_BASEP
op_amp
id|pcistr-&gt;bios
)paren
)paren
op_logical_or
(paren
id|error
op_assign
id|pcibios_read_config_byte
c_func
(paren
id|pcistr-&gt;bus
comma
id|pcistr-&gt;device_fn
comma
id|PCI_INTERRUPT_LINE
comma
op_amp
id|pcistr-&gt;irq
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: error %d reading configuration space&quot;
comma
id|error
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|pcistr-&gt;device_id
op_assign
id|device_id
suffix:semicolon
r_if
c_cond
(paren
id|device_id
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6000B
op_logical_or
multiline_comment|/* GDT6000 or GDT6000B */
id|device_id
op_ge
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
)paren
(brace
multiline_comment|/* MPR */
r_if
c_cond
(paren
(paren
id|base0
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|pcistr-&gt;dpmem
op_assign
id|base0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GDT6110, GDT6120, .. */
r_if
c_cond
(paren
(paren
id|base0
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
op_logical_or
(paren
id|base2
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
op_logical_or
(paren
id|base1
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|pcistr-&gt;dpmem
op_assign
id|base2
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
id|pcistr-&gt;io_mm
op_assign
id|base0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
id|pcistr-&gt;io
op_assign
id|base1
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_init_eisa
r_static
r_int
id|gdth_init_eisa
c_func
(paren
id|ushort
id|eisa_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
(brace
id|ulong
id|retries
comma
id|id
suffix:semicolon
id|unchar
id|prot_ver
comma
id|eisacf
comma
id|i
comma
id|irq_found
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_eisa() adr. %x&bslash;n&quot;
comma
id|eisa_adr
)paren
)paren
suffix:semicolon
multiline_comment|/* disable board interrupts, deinitialize services */
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|eisa_adr
op_plus
id|EDENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|eisa_adr
op_plus
id|EINTENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|LDOORREG
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EDOORREG
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;wait for DEINIT: retries=%ld&bslash;n&quot;
comma
id|retries
)paren
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;bmic
op_assign
id|eisa_adr
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
(paren
id|ulong
)paren
id|eisa_adr
op_rshift
l_int|12
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|4
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* detect IRQ */
r_if
c_cond
(paren
(paren
id|id
op_assign
id|inl
c_func
(paren
id|eisa_adr
op_plus
id|ID0REG
)paren
)paren
op_eq
id|GDT3_ID
)paren
(brace
id|ha-&gt;type
op_assign
id|GDT_EISA
suffix:semicolon
id|ha-&gt;stype
op_assign
id|id
suffix:semicolon
id|outl
c_func
(paren
l_int|1
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xfe
comma
id|eisa_adr
op_plus
id|LDOORREG
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EDOORREG
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (get IRQ failed)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|ha-&gt;irq
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;GDT3000/3020: IRQ=%d&bslash;n&quot;
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
multiline_comment|/* check the result */
r_if
c_cond
(paren
id|ha-&gt;irq
op_eq
l_int|0
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Unknown IRQ, check IRQ table from cmd line !&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|irq_found
op_assign
id|FALSE
suffix:semicolon
id|i
OL
id|MAXHA
op_logical_and
id|irqs
(braket
id|i
)braket
op_ne
l_int|0xff
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|irqs
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
id|irq_found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|irq_found
)paren
(brace
id|ha-&gt;irq
op_assign
id|irqs
(braket
id|i
)braket
suffix:semicolon
id|irqs
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Can not detect controller IRQ,&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Use IRQ setting from command line (IRQ = %d)&bslash;n&quot;
comma
id|ha-&gt;irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (unknown IRQ), Enable&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;the controller BIOS or use command line parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|eisacf
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EISAREG
)paren
op_amp
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|eisacf
OG
l_int|4
)paren
multiline_comment|/* level triggered */
id|eisacf
op_sub_assign
l_int|4
suffix:semicolon
id|ha-&gt;irq
op_assign
id|gdth_irq_tab
(braket
id|eisacf
)braket
suffix:semicolon
id|ha-&gt;type
op_assign
id|GDT_EISA
suffix:semicolon
id|ha-&gt;stype
op_assign
id|id
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_init_isa
r_static
r_int
id|gdth_init_isa
c_func
(paren
id|ulong
id|bios_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
(brace
r_register
id|gdt2_dpram_str
op_star
id|dp2_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|unchar
id|irq_drq
comma
id|prot_ver
suffix:semicolon
id|ulong
id|retries
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_isa() bios adr. %lx&bslash;n&quot;
comma
id|bios_adr
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|gdth_mmap
c_func
(paren
id|bios_adr
comma
r_sizeof
(paren
id|gdt2_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp2_ptr
op_assign
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.memlock
)paren
suffix:semicolon
multiline_comment|/* switch off write protection */
multiline_comment|/* reset interface area */
id|memset_io
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|dp2_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp2_ptr-&gt;u
)paren
)paren
suffix:semicolon
multiline_comment|/* disable board interrupts, read DRQ and IRQ */
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;io.irqen
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|irq_drq
op_assign
id|readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;io.rq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|irq_drq
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|irq_drq
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|ha-&gt;drq
op_assign
id|gdth_drq_tab
(braket
id|i
)braket
suffix:semicolon
id|irq_drq
op_assign
id|readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;io.rq
)paren
op_rshift
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|irq_drq
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|irq_drq
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|ha-&gt;irq
op_assign
id|gdth_irq_tab
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* deinitialize services */
id|writel
c_func
(paren
id|bios_adr
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_ISA
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp2_ptr-&gt;u
)paren
suffix:semicolon
id|ha-&gt;stype
op_assign
id|GDT2_ID
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
id|bios_adr
op_rshift
l_int|4
suffix:semicolon
multiline_comment|/* special request to controller BIOS */
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_init_pci
r_static
r_int
id|gdth_init_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|gdth_ha_str
op_star
id|ha
)paren
(brace
r_register
id|gdt6_dpram_str
op_star
id|dp6_ptr
suffix:semicolon
r_register
id|gdt6c_dpram_str
op_star
id|dp6c_ptr
suffix:semicolon
r_register
id|gdt6m_dpram_str
op_star
id|dp6m_ptr
suffix:semicolon
id|ulong
id|retries
suffix:semicolon
id|unchar
id|prot_ver
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_pci()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
(paren
id|pcistr-&gt;bus
op_lshift
l_int|8
)paren
op_or
(paren
id|pcistr-&gt;device_fn
op_amp
l_int|0xf8
)paren
suffix:semicolon
id|ha-&gt;stype
op_assign
(paren
id|ulong
)paren
id|pcistr-&gt;device_id
suffix:semicolon
id|ha-&gt;irq
op_assign
id|pcistr-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;stype
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6000B
)paren
(brace
multiline_comment|/* GDT6000 or GDT6000B */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci() dpmem %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|gdth_mmap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6_ptr
op_assign
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
multiline_comment|/* reset interface area */
id|memset_io
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|dp6_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, deinit services */
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;io.irqen
)paren
suffix:semicolon
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCI
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;stype
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6555
)paren
(brace
multiline_comment|/* GDT6110, GDT6120, .. */
id|ha-&gt;plx
op_assign
(paren
id|gdt6c_plx_regs
op_star
)paren
id|pcistr-&gt;io
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_new() dpmem %lx io %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
(paren
id|ulong
)paren
id|ha-&gt;plx
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|gdth_mmap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6c_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6c_ptr
op_assign
(paren
id|gdt6c_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
multiline_comment|/* reset interface area */
id|memset_io
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|dp6c_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6c_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, deinit services */
id|outb
c_func
(paren
l_int|0x00
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;control1
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6c_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCINEW
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6c_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* MPR */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_mpr() dpmem %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|gdth_mmap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6m_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6m_ptr
op_assign
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
multiline_comment|/* reset interface area */
id|memset_io
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|dp6m_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6m_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, deinit services */
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
op_or
l_int|4
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6m_ptr-&gt;i960r.ldoor_reg
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCIMPR
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6m_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6m_ptr-&gt;i960r.ldoor_reg
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|gdth_munmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* controller protocol functions */
DECL|function|gdth_enable_int
r_static
r_void
id|gdth_enable_int
c_func
(paren
r_int
id|hanum
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|gdt2_dpram_str
op_star
id|dp2_ptr
suffix:semicolon
id|gdt6_dpram_str
op_star
id|dp6_ptr
suffix:semicolon
id|gdt6m_dpram_str
op_star
id|dp6m_ptr
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_enable_int() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|ha-&gt;bmic
op_plus
id|EINTENABREG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.irqen
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6_ptr-&gt;io.irqen
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x03
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;control1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
op_amp
op_complement
l_int|4
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_get_status
r_static
r_int
id|gdth_get_status
c_func
(paren
id|unchar
op_star
id|pIStatus
comma
r_int
id|irq
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|i
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_get_status() irq %d ctr_count %d&bslash;n&quot;
comma
id|irq
comma
id|gdth_ctr_count
)paren
)paren
suffix:semicolon
op_star
id|pIStatus
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gdth_ctr_count
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;irq
op_ne
(paren
id|unchar
)paren
id|irq
)paren
multiline_comment|/* check IRQ */
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
op_star
id|pIStatus
op_assign
id|inb
c_func
(paren
(paren
id|ushort
)paren
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
op_star
id|pIStatus
op_assign
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Cmd_Index
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
op_star
id|pIStatus
op_assign
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Cmd_Index
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
op_star
id|pIStatus
op_assign
id|inb
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
op_star
id|pIStatus
op_assign
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.edoor_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pIStatus
)paren
r_return
id|i
suffix:semicolon
multiline_comment|/* board found */
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_test_busy
r_static
r_int
id|gdth_test_busy
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
r_int
id|gdtsema0
op_assign
l_int|0
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_test_busy() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|inb
c_func
(paren
id|ha-&gt;bmic
op_plus
id|SEMA0REG
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|inb
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema0_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.sema0_reg
)paren
suffix:semicolon
r_return
(paren
id|gdtsema0
op_amp
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|gdth_get_cmd_index
r_static
r_int
id|gdth_get_cmd_index
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|i
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_get_cmd_index() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gdth_cmd_tab
(braket
id|i
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_eq
id|UNUSED_CMND
)paren
(brace
id|gdth_cmd_tab
(braket
id|i
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_assign
id|ha-&gt;pccb-&gt;RequestBuffer
suffix:semicolon
id|gdth_cmd_tab
(braket
id|i
)braket
(braket
id|hanum
)braket
dot
id|service
op_assign
id|ha-&gt;pccb-&gt;Service
suffix:semicolon
id|ha-&gt;pccb-&gt;CommandIndex
op_assign
(paren
id|ulong
)paren
id|i
op_plus
l_int|2
suffix:semicolon
r_return
(paren
id|i
op_plus
l_int|2
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_set_sema0
r_static
r_void
id|gdth_set_sema0
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_set_sema0() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
id|outb
c_func
(paren
l_int|1
comma
id|ha-&gt;bmic
op_plus
id|SEMA0REG
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
id|writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema0_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
id|writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.sema0_reg
)paren
suffix:semicolon
)brace
DECL|function|gdth_copy_command
r_static
r_void
id|gdth_copy_command
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmd_ptr
suffix:semicolon
r_register
id|gdt6m_dpram_str
op_star
id|dp6m_ptr
suffix:semicolon
r_register
id|gdt6c_dpram_str
op_star
id|dp6c_ptr
suffix:semicolon
id|gdt6_dpram_str
op_star
id|dp6_ptr
suffix:semicolon
id|gdt2_dpram_str
op_star
id|dp2_ptr
suffix:semicolon
id|ushort
id|cp_count
comma
id|dp_offset
comma
id|cmd_no
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_copy_command() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cp_count
op_assign
id|ha-&gt;cmd_len
suffix:semicolon
id|dp_offset
op_assign
id|ha-&gt;cmd_offs_dpmem
suffix:semicolon
id|cmd_no
op_assign
id|ha-&gt;cmd_cnt
suffix:semicolon
id|cmd_ptr
op_assign
id|ha-&gt;pccb
suffix:semicolon
op_increment
id|ha-&gt;cmd_cnt
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
r_return
suffix:semicolon
multiline_comment|/* no DPMEM, no copy */
multiline_comment|/* set cpcount dword aligned */
r_if
c_cond
(paren
id|cp_count
op_amp
l_int|3
)paren
id|cp_count
op_add_assign
(paren
l_int|4
op_minus
(paren
id|cp_count
op_amp
l_int|3
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_add_assign
id|cp_count
suffix:semicolon
multiline_comment|/* set offset and service, copy command to DPMEM */
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp2_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp2_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|dp6c_ptr
op_assign
(paren
id|gdt6c_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6c_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6c_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
id|writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6m_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6m_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_release_event
r_static
r_void
id|gdth_release_event
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
id|ulong
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|j
)paren
(brace
r_if
c_cond
(paren
id|gdth_cmd_tab
(braket
id|j
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_ne
id|UNUSED_CMND
)paren
op_increment
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|max_index
OL
id|i
)paren
(brace
id|max_index
op_assign
id|i
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_index = %d&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_release_event() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pccb-&gt;OpCode
op_eq
id|GDT_INIT
)paren
id|ha-&gt;pccb-&gt;Service
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
id|outb
c_func
(paren
id|ha-&gt;pccb-&gt;Service
comma
id|ha-&gt;bmic
op_plus
id|LDOORREG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pccb-&gt;OpCode
op_eq
id|GDT_INIT
)paren
multiline_comment|/* store DMA buffer */
id|outl
c_func
(paren
(paren
id|ulong
)paren
id|ha-&gt;pccb
comma
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|writeb
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|io.event
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
id|writeb
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|io.event
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
id|writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.ldoor_reg
)paren
suffix:semicolon
)brace
DECL|function|gdth_wait
r_static
r_int
id|gdth_wait
c_func
(paren
r_int
id|hanum
comma
r_int
id|index
comma
id|ulong
id|time
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|answer_found
op_assign
id|FALSE
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_wait() hanum %d index %d time %ld&bslash;n&quot;
comma
id|hanum
comma
id|index
comma
id|time
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* no wait required */
id|gdth_from_wait
op_assign
id|TRUE
suffix:semicolon
r_do
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346
id|gdth_interrupt
c_func
(paren
(paren
r_int
)paren
id|ha-&gt;irq
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|gdth_interrupt
c_func
(paren
(paren
r_int
)paren
id|ha-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|wait_hanum
op_eq
id|hanum
op_logical_and
id|wait_index
op_eq
id|index
)paren
(brace
id|answer_found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|time
)paren
suffix:semicolon
id|gdth_from_wait
op_assign
id|FALSE
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|answer_found
)paren
suffix:semicolon
)brace
DECL|function|gdth_internal_cmd
r_static
r_int
id|gdth_internal_cmd
c_func
(paren
r_int
id|hanum
comma
id|unchar
id|service
comma
id|ushort
id|opcode
comma
id|ulong
id|p1
comma
id|ulong
id|p2
comma
id|ulong
id|p3
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmd_ptr
suffix:semicolon
r_int
id|retries
comma
id|index
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_internal_cmd() service %d opcode %d&bslash;n&quot;
comma
id|service
comma
id|opcode
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmd_ptr
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|cmd_ptr
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
multiline_comment|/* make command  */
r_for
c_loop
(paren
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
suffix:semicolon
)paren
(brace
id|cmd_ptr-&gt;Service
op_assign
id|service
suffix:semicolon
id|cmd_ptr-&gt;RequestBuffer
op_assign
id|INTERNAL_CMND
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmd_ptr-&gt;OpCode
op_assign
id|opcode
suffix:semicolon
id|cmd_ptr-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|CACHESERVICE
)paren
(brace
r_if
c_cond
(paren
id|opcode
op_eq
id|GDT_IOCTL
)paren
(brace
id|cmd_ptr-&gt;u.ioctl.subfunc
op_assign
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.channel
op_assign
id|p2
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.param_size
op_assign
(paren
id|ushort
)paren
id|p3
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.p_param
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pscratch
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmd_ptr-&gt;u.cache.DeviceNo
op_assign
(paren
id|ushort
)paren
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.cache.BlockNo
op_assign
id|p2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|service
op_eq
id|SCSIRAWSERVICE
)paren
(brace
id|cmd_ptr-&gt;u.raw.direction
op_assign
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.raw.bus
op_assign
(paren
id|unchar
)paren
id|p2
suffix:semicolon
id|cmd_ptr-&gt;u.raw.target
op_assign
(paren
id|unchar
)paren
id|p3
suffix:semicolon
id|cmd_ptr-&gt;u.raw.lun
op_assign
l_int|0
suffix:semicolon
)brace
id|ha-&gt;cmd_len
op_assign
r_sizeof
(paren
id|gdth_cmd_str
)paren
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|JIFFYWAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_wait
c_func
(paren
id|hanum
comma
id|index
comma
id|INIT_TIMEOUT
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error (timeout service %d)&bslash;n&quot;
comma
id|service
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;status
op_ne
id|S_BSY
op_logical_or
op_decrement
id|retries
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
id|ha-&gt;status
op_ne
id|S_OK
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* search for devices */
DECL|function|gdth_search_drives
r_static
r_int
id|gdth_search_drives
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ushort
id|cdev_cnt
comma
id|i
suffix:semicolon
id|unchar
id|b
comma
id|t
comma
id|pos_found
suffix:semicolon
id|ulong
id|drv_cyls
comma
id|drv_hds
comma
id|drv_secs
suffix:semicolon
id|ulong
id|bus_no
suffix:semicolon
id|gdth_getch_str
op_star
id|chn
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
multiline_comment|/* initialize controller services, at first: screen service */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCREENSERVICE
comma
id|GDT_INIT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error screen service (code %d)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): SCREENSERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize cache service */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_INIT
comma
id|LINUX_OS
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error cache service (code %d)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): CACHESERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cdev_cnt
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
multiline_comment|/* mount all cache devices */
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_MOUNT
comma
l_int|0xffff
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): mountall CACHESERVICE OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize cache service after mountall */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_INIT
comma
id|LINUX_OS
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error cache service (code %d)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() CACHES. init. after mountall&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cdev_cnt
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
multiline_comment|/* detect number of SCSI buses */
id|chn
op_assign
(paren
id|gdth_getch_str
op_star
)paren
id|DMADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|MAXBUS
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
id|chn-&gt;channel_no
op_assign
id|bus_no
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|SCSI_CHAN_CNT
op_or
id|L_CTRL_PATTERN
comma
id|IO_CHANNEL
op_or
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_getch_str
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|bus_no
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Error detecting SCSI channel count (0x%x)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chn-&gt;siop_id
OL
id|MAXID
)paren
id|ha-&gt;id
(braket
id|bus_no
)braket
(braket
id|chn-&gt;siop_id
)braket
dot
id|type
op_assign
id|SIOP_DTYP
suffix:semicolon
)brace
id|ha-&gt;bus_cnt
op_assign
(paren
id|unchar
)paren
id|bus_no
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() %d SCSI channels&bslash;n&quot;
comma
id|ha-&gt;bus_cnt
)paren
)paren
suffix:semicolon
multiline_comment|/* read cache configuration */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|CACHE_INFO
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_cinfo_str
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error cache service (code %d)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;cpar
op_assign
(paren
(paren
id|gdth_cinfo_str
op_star
)paren
id|DMADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
)paren
op_member_access_from_pointer
id|cpar
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() cinfo: vs %lx sta %d str %d dw %d b %d&bslash;n&quot;
comma
id|ha-&gt;cpar.version
comma
id|ha-&gt;cpar.state
comma
id|ha-&gt;cpar.strategy
comma
id|ha-&gt;cpar.write_back
comma
id|ha-&gt;cpar.block_size
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize raw service */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_INIT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error raw service (code %d)&bslash;n&quot;
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): RAWSERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* set/get features raw service (scatter/gather) */
id|ha-&gt;raw_feat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_SET_FEAT
comma
id|SCATTER_GATHER
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): set features RAWSERVICE OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_GET_FEAT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr(): get feat RAWSERVICE %ld&bslash;n&quot;
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;raw_feat
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
)brace
multiline_comment|/* set/get features cache service (equal to raw service) */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_SET_FEAT
comma
l_int|0
comma
id|SCATTER_GATHER
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): set features CACHESERVICE OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_GET_FEAT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr(): get feat CACHESERV. %ld&bslash;n&quot;
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;cache_feat
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
)brace
multiline_comment|/* scanning for raw devices */
r_for
c_loop
(paren
id|b
op_assign
l_int|0
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|b
)paren
(brace
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|MAXID
suffix:semicolon
op_increment
id|t
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() rawd. bus %d id %d&bslash;n&quot;
comma
id|b
comma
id|t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|type
op_ne
id|SIOP_DTYP
op_logical_and
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_INFO
comma
l_int|0
comma
id|b
comma
id|t
)paren
)paren
(brace
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|type
op_assign
id|RAW_DTYP
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* scanning for cache devices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cdev_cnt
op_logical_and
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() cachedev. %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_INFO
comma
id|i
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
multiline_comment|/* dynamic relation between host drive number and Bus/ID */
multiline_comment|/* search free position */
id|pos_found
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|b
op_assign
l_int|0
comma
id|t
op_assign
l_int|0
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|b
)paren
(brace
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|MAXID
suffix:semicolon
op_increment
id|t
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|type
op_eq
id|EMPTY_DTYP
)paren
(brace
id|pos_found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pos_found
)paren
r_break
suffix:semicolon
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() drive %d free pos at bus/id %d/%d&bslash;n&quot;
comma
id|i
comma
id|b
comma
id|t
)paren
)paren
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|type
op_assign
id|CACHE_DTYP
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_assign
id|ha-&gt;info
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|hostdrive
op_assign
id|i
suffix:semicolon
multiline_comment|/* evaluate mapping (sectors per head, heads per cylinder) */
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_and_assign
op_complement
id|SECS32
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;info2
op_eq
l_int|0
)paren
(brace
id|drv_cyls
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_div
id|HEADS
op_div
id|SECS
suffix:semicolon
r_if
c_cond
(paren
id|drv_cyls
op_le
id|MAXCYLS
)paren
(brace
id|drv_hds
op_assign
id|HEADS
suffix:semicolon
id|drv_secs
op_assign
id|SECS
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* too high for 64*32 */
id|drv_cyls
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_div
id|MEDHEADS
op_div
id|MEDSECS
suffix:semicolon
r_if
c_cond
(paren
id|drv_cyls
op_le
id|MAXCYLS
)paren
(brace
id|drv_hds
op_assign
id|MEDHEADS
suffix:semicolon
id|drv_secs
op_assign
id|MEDSECS
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* too high for 127*63 */
id|drv_cyls
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_div
id|BIGHEADS
op_div
id|BIGSECS
suffix:semicolon
id|drv_hds
op_assign
id|BIGHEADS
suffix:semicolon
id|drv_secs
op_assign
id|BIGSECS
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|drv_hds
op_assign
id|ha-&gt;info2
op_amp
l_int|0xff
suffix:semicolon
id|drv_secs
op_assign
(paren
id|ha-&gt;info2
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|drv_cyls
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_div
id|drv_hds
op_div
id|drv_secs
suffix:semicolon
)brace
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|heads
op_assign
(paren
id|unchar
)paren
id|drv_hds
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|secs
op_assign
(paren
id|unchar
)paren
id|drv_secs
suffix:semicolon
multiline_comment|/* round size */
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_assign
id|drv_cyls
op_star
id|drv_hds
op_star
id|drv_secs
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cdr. %d size %ld hds %ld scs %ld&bslash;n&quot;
comma
id|i
comma
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
comma
id|drv_hds
comma
id|drv_secs
)paren
)paren
suffix:semicolon
multiline_comment|/* get informations about device */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_DEVTYPE
comma
id|i
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cache drive %d devtype %ld&bslash;n&quot;
comma
id|i
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
)brace
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* command queueing/sending functions */
DECL|function|gdth_putq
r_static
r_void
id|gdth_putq
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|priority
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|pscp
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_putq() priority %d&bslash;n&quot;
comma
id|priority
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|scp-&gt;SCp.this_residual
op_assign
(paren
r_int
)paren
id|priority
suffix:semicolon
id|gdth_update_timeout
c_func
(paren
id|scp
comma
id|scp-&gt;timeout
op_star
l_int|6
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|b
op_assign
id|scp-&gt;channel
suffix:semicolon
macro_line|#else
id|b
op_assign
id|NUMDATA
c_func
(paren
id|nscp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:semicolon
macro_line|#endif
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
r_if
c_cond
(paren
id|priority
op_ge
id|DEFAULT_PRI
op_logical_and
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|lock
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_putq(): locked IO -&gt; update_timeout()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|scp-&gt;SCp.buffers_residual
op_assign
id|gdth_update_timeout
c_func
(paren
id|scp
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;req_first
op_eq
l_int|NULL
)paren
(brace
id|ha-&gt;req_first
op_assign
id|scp
suffix:semicolon
multiline_comment|/* queue was empty */
id|scp-&gt;SCp.ptr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* queue not empty */
id|pscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
multiline_comment|/* priority: 0-highest,..,0xff-lowest */
r_while
c_loop
(paren
id|nscp
op_logical_and
(paren
id|unchar
)paren
id|nscp-&gt;SCp.this_residual
op_le
id|priority
)paren
(brace
id|pscp
op_assign
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
)brace
id|pscp-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
id|scp
suffix:semicolon
id|scp-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
id|nscp
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
id|flags
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|nscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
op_increment
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|max_rq
OL
id|flags
)paren
(brace
id|max_rq
op_assign
id|flags
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_rq = %d&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|max_rq
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|gdth_next
r_static
r_void
id|gdth_next
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|pscp
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|unchar
id|b
comma
id|t
comma
id|next_cmd
comma
id|firsttime
suffix:semicolon
id|ushort
id|hdrive
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_next() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|next_cmd
op_assign
id|firsttime
op_assign
id|TRUE
suffix:semicolon
id|cmd_index
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|nscp
op_assign
id|pscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
(brace
r_if
c_cond
(paren
id|nscp
op_ne
id|pscp
op_logical_and
id|nscp
op_ne
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
)paren
id|pscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|b
op_assign
id|nscp-&gt;channel
suffix:semicolon
macro_line|#else
id|b
op_assign
id|NUMDATA
c_func
(paren
id|nscp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:semicolon
macro_line|#endif
id|t
op_assign
id|nscp-&gt;target
suffix:semicolon
r_if
c_cond
(paren
id|nscp-&gt;SCp.this_residual
OL
id|DEFAULT_PRI
op_logical_or
op_logical_neg
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|lock
)paren
(brace
r_if
c_cond
(paren
id|firsttime
)paren
(brace
r_if
c_cond
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
(brace
multiline_comment|/* controller busy ? */
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_next() controller %d busy !&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|firsttime
op_assign
id|FALSE
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
r_if
c_cond
(paren
id|nscp-&gt;done
op_eq
id|gdth_scsi_done
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_special_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|b
)paren
)paren
)paren
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|type
op_ne
id|CACHE_DTYP
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_raw_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|b
)paren
)paren
)paren
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
(brace
id|hdrive
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|hostdrive
suffix:semicolon
r_switch
c_cond
(paren
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
r_case
id|INQUIRY
suffix:colon
r_case
id|REQUEST_SENSE
suffix:colon
r_case
id|READ_CAPACITY
suffix:colon
r_case
id|VERIFY
suffix:colon
r_case
id|START_STOP
suffix:colon
r_case
id|MODE_SENSE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
id|gdth_internal_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|b
comma
op_amp
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALLOW_MEDIUM_REMOVAL
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
op_amp
l_int|1
)paren
op_logical_and
op_logical_neg
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Prevent r. nonremov. drive-&gt;do nothing&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|nscp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
op_assign
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Prevent/allow r. %d rem. drive %d&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|hdrive
)paren
)paren
)paren
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|READ_6
suffix:colon
r_case
id|WRITE_6
suffix:colon
r_case
id|READ_10
suffix:colon
r_case
id|WRITE_10
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|hdrive
)paren
)paren
)paren
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: Unknown SCSI command 0x%x to cache service !&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|nscp-&gt;result
op_assign
id|DID_ABORT
op_lshift
l_int|16
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|next_cmd
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nscp
op_eq
id|ha-&gt;req_first
)paren
id|ha-&gt;req_first
op_assign
id|pscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
suffix:semicolon
r_else
id|pscp-&gt;SCp.ptr
op_assign
id|nscp-&gt;SCp.ptr
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_wait
c_func
(paren
id|hanum
comma
id|cmd_index
comma
id|POLL_TIMEOUT
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;GDT: Controller %d: Command %d timed out !&bslash;n&quot;
comma
id|hanum
comma
id|cmd_index
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_copy_internal_data
r_static
r_void
id|gdth_copy_internal_data
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_char
op_star
id|buffer
comma
id|ushort
id|count
)paren
(brace
id|ushort
id|cpcount
comma
id|i
suffix:semicolon
id|ushort
id|cpsum
comma
id|cpnow
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|cpcount
op_assign
id|count
op_le
(paren
id|ushort
)paren
id|scp-&gt;bufflen
ques
c_cond
id|count
suffix:colon
(paren
id|ushort
)paren
id|scp-&gt;bufflen
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cpsum
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cpnow
op_assign
(paren
id|ushort
)paren
id|sl-&gt;length
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;copy_internal() now %d sum %d count %d %d&bslash;n&quot;
comma
id|cpnow
comma
id|cpsum
comma
id|cpcount
comma
(paren
id|ushort
)paren
id|scp-&gt;bufflen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_plus
id|cpnow
OG
id|cpcount
)paren
id|cpnow
op_assign
id|cpcount
op_minus
id|cpsum
suffix:semicolon
id|cpsum
op_add_assign
id|cpnow
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|sl-&gt;address
comma
id|buffer
comma
id|cpnow
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_eq
id|cpcount
)paren
r_break
suffix:semicolon
id|buffer
op_add_assign
id|cpnow
suffix:semicolon
)brace
)brace
r_else
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;copy_internal() count %d&bslash;n&quot;
comma
id|cpcount
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|scp-&gt;request_buffer
comma
id|buffer
comma
id|cpcount
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_internal_cache_cmd
r_static
r_int
id|gdth_internal_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
comma
id|ulong
op_star
id|flags
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ushort
id|hdrive
suffix:semicolon
id|unchar
id|t
suffix:semicolon
id|gdth_inq_data
id|inq
suffix:semicolon
id|gdth_rdcap_data
id|rdc
suffix:semicolon
id|gdth_sense_data
id|sd
suffix:semicolon
id|gdth_modep_data
id|mpd
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
id|hdrive
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|hostdrive
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_internal_cache_cmd() cmd 0x%x hdrive %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|hdrive
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;lun
op_ne
l_int|0
)paren
id|scp-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
r_else
(brace
r_switch
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
r_case
id|VERIFY
suffix:colon
r_case
id|START_STOP
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Test/Verify/Start hdrive %d&bslash;n&quot;
comma
id|hdrive
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INQUIRY
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Inquiry hdrive %d devtype %d&bslash;n&quot;
comma
id|hdrive
comma
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
)paren
)paren
suffix:semicolon
id|inq.type_qual
op_assign
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|4
)paren
ques
c_cond
id|TYPE_ROM
suffix:colon
id|TYPE_DISK
suffix:semicolon
multiline_comment|/* you can here set all disks to removable, if you want to do&n;               a flush using the ALLOW_MEDIUM_REMOVAL command */
id|inq.modif_rmb
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
suffix:semicolon
id|inq.version
op_assign
l_int|2
suffix:semicolon
id|inq.resp_aenc
op_assign
l_int|2
suffix:semicolon
id|inq.add_length
op_assign
l_int|32
suffix:semicolon
id|strcpy
c_func
(paren
id|inq.vendor
comma
l_string|&quot;ICP    &quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|inq.product
comma
l_string|&quot;Host Drive  #%02d&quot;
comma
id|hdrive
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|inq.revision
comma
l_string|&quot;   &quot;
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|inq
comma
r_sizeof
(paren
id|gdth_inq_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REQUEST_SENSE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Request sense hdrive %d&bslash;n&quot;
comma
id|hdrive
)paren
)paren
suffix:semicolon
id|sd.errorcode
op_assign
l_int|0x70
suffix:semicolon
id|sd.segno
op_assign
l_int|0x00
suffix:semicolon
id|sd.key
op_assign
id|NO_SENSE
suffix:semicolon
id|sd.info
op_assign
l_int|0
suffix:semicolon
id|sd.add_length
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|sd
comma
r_sizeof
(paren
id|gdth_sense_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Mode sense hdrive %d&bslash;n&quot;
comma
id|hdrive
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|mpd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_modep_data
)paren
)paren
suffix:semicolon
id|mpd.hd.data_length
op_assign
r_sizeof
(paren
id|gdth_modep_data
)paren
suffix:semicolon
id|mpd.hd.dev_par
op_assign
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|2
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
suffix:semicolon
id|mpd.hd.bd_length
op_assign
r_sizeof
(paren
id|mpd.bd
)paren
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|0
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x00ff0000
)paren
op_rshift
l_int|16
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|1
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|2
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|mpd
comma
r_sizeof
(paren
id|gdth_modep_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_CAPACITY
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Read capacity hdrive %d&bslash;n&quot;
comma
id|hdrive
)paren
)paren
suffix:semicolon
id|rdc.last_block_no
op_assign
id|ntohl
c_func
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|size
op_minus
l_int|1
)paren
suffix:semicolon
id|rdc.block_length
op_assign
id|ntohl
c_func
(paren
id|SECTOR_SIZE
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|rdc
comma
r_sizeof
(paren
id|gdth_rdcap_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Internal cache cmd 0x%x unknown&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|scp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
op_star
id|flags
)paren
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
id|save_flags
c_func
(paren
op_star
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_fill_cache_cmd
r_static
r_int
id|gdth_fill_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|ushort
id|hdrive
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|ushort
id|i
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_fill_cache_cmd() cmd 0x%x cmdsize %d hdrive %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|scp-&gt;cmd_len
comma
id|hdrive
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* fill command */
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|ALLOW_MEDIUM_REMOVAL
)paren
(brace
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|4
)braket
op_amp
l_int|1
)paren
multiline_comment|/* prevent ? */
id|cmdp-&gt;OpCode
op_assign
id|GDT_MOUNT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|3
)braket
op_amp
l_int|1
)paren
multiline_comment|/* removable drive ? */
id|cmdp-&gt;OpCode
op_assign
id|GDT_UNMOUNT
suffix:semicolon
r_else
id|cmdp-&gt;OpCode
op_assign
id|GDT_FLUSH
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_6
op_logical_or
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_10
)paren
(brace
r_if
c_cond
(paren
id|gdth_write_through
)paren
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE_THR
suffix:semicolon
r_else
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
)brace
)brace
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.cache.DeviceNo
op_assign
id|hdrive
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|ALLOW_MEDIUM_REMOVAL
)paren
(brace
id|cmdp-&gt;u.cache.BlockNo
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|scp-&gt;cmd_len
op_ne
l_int|6
)paren
(brace
id|cmdp-&gt;u.cache.BlockNo
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ulong
op_star
)paren
op_amp
id|scp-&gt;cmnd
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|cmdp-&gt;u.cache.BlockCnt
op_assign
(paren
id|ulong
)paren
id|ntohs
c_func
(paren
op_star
(paren
id|ushort
op_star
)paren
op_amp
id|scp-&gt;cmnd
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache.BlockNo
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ulong
op_star
)paren
op_amp
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
op_amp
l_int|0x001fffffUL
suffix:semicolon
id|cmdp-&gt;u.cache.BlockCnt
op_assign
id|scp-&gt;cmnd
(braket
l_int|4
)braket
op_eq
l_int|0
ques
c_cond
l_int|0x100
suffix:colon
id|scp-&gt;cmnd
(braket
l_int|4
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
op_minus
l_int|1UL
suffix:semicolon
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong
)paren
id|sl-&gt;length
suffix:semicolon
)brace
id|cmdp-&gt;u.cache.sg_canz
op_assign
(paren
id|ulong
)paren
id|i
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
r_if
c_cond
(paren
id|max_sg
OL
(paren
id|ulong
)paren
id|i
)paren
(brace
id|max_sg
op_assign
(paren
id|ulong
)paren
id|i
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_sg = %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|i
OL
id|GDTH_MAXSG
)paren
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
op_minus
l_int|1UL
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: addr. %lx sganz %lx sgptr0 %lx sglen0 %lx&bslash;n&quot;
comma
id|cmdp-&gt;u.cache.DestAddr
comma
id|cmdp-&gt;u.cache.sg_canz
comma
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: cmd %d blockno. %ld, blockcnt %ld&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.cache.BlockNo
comma
id|cmdp-&gt;u.cache.BlockCnt
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size, check space */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.cache.sg_canz
op_star
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_fill_cache() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
DECL|function|gdth_fill_raw_cmd
r_static
r_int
id|gdth_fill_raw_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|ushort
id|i
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|unchar
id|t
comma
id|l
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
id|l
op_assign
id|scp-&gt;lun
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_fill_raw_cmd() cmd 0x%x bus %d ID %d LUN %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|b
comma
id|t
comma
id|l
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCSIRAWSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* fill command */
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
multiline_comment|/* always */
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.raw.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.mdisc_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.mcon_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.clen
op_assign
id|scp-&gt;cmd_len
suffix:semicolon
id|cmdp-&gt;u.raw.target
op_assign
id|t
suffix:semicolon
id|cmdp-&gt;u.raw.lun
op_assign
id|l
suffix:semicolon
id|cmdp-&gt;u.raw.bus
op_assign
id|b
suffix:semicolon
id|cmdp-&gt;u.raw.priority
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.link_p
op_assign
l_int|NULL
suffix:semicolon
id|cmdp-&gt;u.raw.sdlen
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw.sense_len
op_assign
l_int|16
suffix:semicolon
id|cmdp-&gt;u.raw.sense_data
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;sense_buffer
)paren
suffix:semicolon
id|cmdp-&gt;u.raw.direction
op_assign
id|gdth_direction_tab
(braket
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)braket
op_eq
id|DOU
ques
c_cond
id|DATA_OUT
suffix:colon
id|DATA_IN
suffix:semicolon
id|memcpy
c_func
(paren
id|cmdp-&gt;u.raw.cmd
comma
id|scp-&gt;cmnd
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
op_minus
l_int|1UL
suffix:semicolon
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong
)paren
id|sl-&gt;length
suffix:semicolon
)brace
id|cmdp-&gt;u.raw.sg_ranz
op_assign
(paren
id|ulong
)paren
id|i
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
r_if
c_cond
(paren
id|max_sg
OL
(paren
id|ulong
)paren
id|i
)paren
(brace
id|max_sg
op_assign
(paren
id|ulong
)paren
id|i
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_sg = %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|i
OL
id|GDTH_MAXSG
)paren
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
op_minus
l_int|1UL
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;raw cmd: addr. %lx sganz %lx sgptr0 %lx sglen0 %lx&bslash;n&quot;
comma
id|cmdp-&gt;u.raw.sdata
comma
id|cmdp-&gt;u.raw.sg_ranz
comma
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size, check space */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.raw.sg_ranz
op_star
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_fill_raw() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
DECL|function|gdth_special_cmd
r_static
r_int
id|gdth_special_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_special_cmd(): &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|cmdp
comma
id|scp-&gt;request_buffer
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* evaluate command size, check space */
r_if
c_cond
(paren
id|cmdp-&gt;OpCode
op_eq
id|GDT_IOCTL
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;IOCTL&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.ioctl.p_param
)paren
op_plus
r_sizeof
(paren
id|ulong
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmdp-&gt;Service
op_eq
id|CACHESERVICE
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache command %d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmdp-&gt;Service
op_eq
id|SCSIRAWSERVICE
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;raw command %d/%d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.raw.cmd
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_special_cmd() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
multiline_comment|/* Controller event handling functions */
DECL|function|gdth_store_event
r_static
id|gdth_evt_str
op_star
id|gdth_store_event
c_func
(paren
id|ushort
id|source
comma
id|ushort
id|idx
comma
id|gdth_evt_data
op_star
id|evt
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_struct
id|timeval
id|tv
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_store_event() source %d idx %d&bslash;n&quot;
comma
id|source
comma
id|idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|source
op_eq
l_int|0
)paren
multiline_comment|/* no source -&gt; no event */
r_return
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_source
op_eq
id|source
op_logical_and
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_idx
op_eq
id|idx
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_data.eu
comma
(paren
r_char
op_star
)paren
op_amp
id|evt-&gt;eu
comma
id|evt-&gt;size
)paren
)paren
(brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|elastidx
)braket
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|e-&gt;last_stamp
op_assign
id|tv.tv_sec
suffix:semicolon
op_increment
id|e-&gt;same_count
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_source
op_ne
l_int|0
)paren
(brace
multiline_comment|/* entry not free ? */
op_increment
id|elastidx
suffix:semicolon
r_if
c_cond
(paren
id|elastidx
op_eq
id|MAX_EVENTS
)paren
id|elastidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|elastidx
op_eq
id|eoldidx
)paren
(brace
multiline_comment|/* reached mark ? */
op_increment
id|eoldidx
suffix:semicolon
r_if
c_cond
(paren
id|eoldidx
op_eq
id|MAX_EVENTS
)paren
id|eoldidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|elastidx
)braket
suffix:semicolon
id|e-&gt;event_source
op_assign
id|source
suffix:semicolon
id|e-&gt;event_idx
op_assign
id|idx
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|e-&gt;first_stamp
op_assign
id|e-&gt;last_stamp
op_assign
id|tv.tv_sec
suffix:semicolon
id|e-&gt;same_count
op_assign
l_int|1
suffix:semicolon
id|e-&gt;event_data
op_assign
op_star
id|evt
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|e
suffix:semicolon
)brace
DECL|function|gdth_read_event
r_static
r_int
id|gdth_read_event
c_func
(paren
r_int
id|handle
comma
id|gdth_evt_str
op_star
id|estr
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
r_int
id|eindex
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_read_event() handle %d&bslash;n&quot;
comma
id|handle
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handle
op_eq
op_minus
l_int|1
)paren
id|eindex
op_assign
id|eoldidx
suffix:semicolon
r_else
id|eindex
op_assign
id|handle
suffix:semicolon
id|estr-&gt;event_source
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|eindex
op_ge
id|MAX_EVENTS
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|eindex
suffix:semicolon
)brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|eindex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;event_source
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|eindex
op_ne
id|elastidx
)paren
(brace
r_if
c_cond
(paren
op_increment
id|eindex
op_eq
id|MAX_EVENTS
)paren
id|eindex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|eindex
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|estr
comma
id|e
comma
r_sizeof
(paren
id|gdth_evt_str
)paren
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|eindex
suffix:semicolon
)brace
DECL|function|gdth_readapp_event
r_static
r_void
id|gdth_readapp_event
c_func
(paren
id|unchar
id|application
comma
id|gdth_evt_str
op_star
id|estr
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
r_int
id|eindex
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|unchar
id|found
op_assign
id|FALSE
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_readapp_event() app. %d&bslash;n&quot;
comma
id|application
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|eindex
op_assign
id|eoldidx
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|eindex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;event_source
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|e-&gt;application
op_amp
id|application
)paren
op_eq
l_int|0
)paren
(brace
id|e-&gt;application
op_or_assign
id|application
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eindex
op_eq
id|elastidx
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|eindex
op_eq
id|MAX_EVENTS
)paren
id|eindex
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
id|memcpy
c_func
(paren
id|estr
comma
id|e
comma
r_sizeof
(paren
id|gdth_evt_str
)paren
)paren
suffix:semicolon
r_else
id|estr-&gt;event_source
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_clear_events
r_static
r_void
id|gdth_clear_events
c_func
(paren
)paren
(brace
id|ulong
id|flags
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_clear_events()&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|eoldidx
op_assign
id|elastidx
op_assign
l_int|0
suffix:semicolon
id|ebuffer
(braket
l_int|0
)braket
dot
id|event_source
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* SCSI interface functions */
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346
DECL|function|do_gdth_interrupt
r_static
r_void
id|do_gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
id|gdth_interrupt
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_interrupt
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
macro_line|#else
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
macro_line|#endif
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdt6m_dpram_str
op_star
id|dp6m_ptr
suffix:semicolon
id|gdt6_dpram_str
op_star
id|dp6_ptr
suffix:semicolon
id|gdt2_dpram_str
op_star
id|dp2_ptr
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
r_int
id|hanum
suffix:semicolon
id|unchar
id|IStatus
suffix:semicolon
id|ushort
id|CmdStatus
comma
id|Service
op_assign
l_int|0
suffix:semicolon
id|ulong
id|InfoBytes
comma
id|InfoBytes2
op_assign
l_int|0
suffix:semicolon
id|gdth_evt_data
id|dvr
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() IRQ %d&bslash;n&quot;
comma
id|irq
)paren
)paren
suffix:semicolon
multiline_comment|/* if polling and not from gdth_wait() -&gt; return */
r_if
c_cond
(paren
id|gdth_polling
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_from_wait
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
id|wait_index
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* search controller */
r_if
c_cond
(paren
(paren
id|hanum
op_assign
id|gdth_get_status
c_func
(paren
op_amp
id|IStatus
comma
id|irq
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/*&n;        TRACE2((&quot;gdth_interrupt(): Spurious interrupt received&bslash;n&quot;));&n;        */
r_return
suffix:semicolon
)brace
macro_line|#ifdef GDTH_STATISTICS
op_increment
id|act_ints
suffix:semicolon
macro_line|#endif
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|CmdStatus
op_assign
id|inw
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
multiline_comment|/* async. event ? */
id|Service
op_assign
id|inw
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|10
)paren
suffix:semicolon
id|InfoBytes2
op_assign
id|inl
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|4
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* no error */
id|CmdStatus
op_assign
id|S_OK
suffix:semicolon
id|InfoBytes
op_assign
id|inl
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
multiline_comment|/* init. -&gt; more info */
id|InfoBytes2
op_assign
id|inl
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|outb
c_func
(paren
l_int|0x00
comma
id|ha-&gt;bmic
op_plus
id|SEMA1REG
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
(paren
id|gdt2_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|CmdStatus
op_assign
id|readw
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
multiline_comment|/* async. event ? */
id|Service
op_assign
id|readw
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Service
)paren
suffix:semicolon
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* no error */
id|CmdStatus
op_assign
id|S_OK
suffix:semicolon
id|InfoBytes
op_assign
id|readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
multiline_comment|/* init. -&gt; more info */
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
multiline_comment|/* reset command index */
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.Sema1
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
(paren
id|gdt6_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|CmdStatus
op_assign
id|readw
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
multiline_comment|/* async. event ? */
id|Service
op_assign
id|readw
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Service
)paren
suffix:semicolon
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* no error */
id|CmdStatus
op_assign
id|S_OK
suffix:semicolon
id|InfoBytes
op_assign
id|readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
multiline_comment|/* init. -&gt; more info */
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
multiline_comment|/* reset command index */
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.Sema1
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|CmdStatus
op_assign
id|inw
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;status
)paren
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
multiline_comment|/* async. event ? */
id|Service
op_assign
id|inw
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;service
)paren
)paren
suffix:semicolon
id|InfoBytes2
op_assign
id|inl
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;info
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
id|CmdStatus
op_assign
id|S_OK
suffix:semicolon
id|InfoBytes
op_assign
id|inl
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;info
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
multiline_comment|/* init. -&gt; more info */
id|InfoBytes2
op_assign
id|inl
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;info
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema1_reg
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
(paren
id|gdt6m_dpram_str
op_star
)paren
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|CmdStatus
op_assign
id|readw
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
multiline_comment|/* async. event ? */
id|Service
op_assign
id|readw
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.service
)paren
suffix:semicolon
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.info
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* no error */
id|CmdStatus
op_assign
id|S_OK
suffix:semicolon
id|InfoBytes
op_assign
id|readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.info
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
)paren
multiline_comment|/* init. -&gt; more info */
id|InfoBytes2
op_assign
id|readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;i960r.sema1_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() unknown controller type&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() index %d stat %d info %ld&bslash;n&quot;
comma
id|IStatus
comma
id|CmdStatus
comma
id|InfoBytes
)paren
)paren
suffix:semicolon
id|ha-&gt;status
op_assign
id|CmdStatus
suffix:semicolon
id|ha-&gt;info
op_assign
id|InfoBytes
suffix:semicolon
id|ha-&gt;info2
op_assign
id|InfoBytes2
suffix:semicolon
r_if
c_cond
(paren
id|gdth_from_wait
)paren
(brace
id|wait_hanum
op_assign
id|hanum
suffix:semicolon
id|wait_index
op_assign
(paren
r_int
)paren
id|IStatus
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() async. event&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_async_event
c_func
(paren
id|hanum
comma
id|Service
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|IStatus
op_eq
id|SPEZINDEX
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Service unknown or not initialized !&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|dvr.size
op_assign
r_sizeof
(paren
id|dvr.eu.driver
)paren
suffix:semicolon
id|dvr.eu.driver.ionode
op_assign
id|hanum
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ES_DRIVER
comma
l_int|4
comma
op_amp
id|dvr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|scp
op_assign
id|gdth_cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|cmnd
suffix:semicolon
id|Service
op_assign
id|gdth_cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|service
suffix:semicolon
id|gdth_cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_if
c_cond
(paren
id|scp
op_eq
id|UNUSED_CMND
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() index to unused command (%d)&bslash;n&quot;
comma
id|IStatus
)paren
)paren
suffix:semicolon
id|dvr.size
op_assign
r_sizeof
(paren
id|dvr.eu.driver
)paren
suffix:semicolon
id|dvr.eu.driver.ionode
op_assign
id|hanum
suffix:semicolon
id|dvr.eu.driver.index
op_assign
id|IStatus
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ES_DRIVER
comma
l_int|1
comma
op_amp
id|dvr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scp
op_eq
id|INTERNAL_CMND
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() answer to internal command&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() sync. status&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_sync_event
c_func
(paren
id|hanum
comma
id|Service
comma
id|IStatus
comma
id|scp
)paren
suffix:semicolon
)brace
id|gdth_next
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
DECL|function|gdth_sync_event
r_static
r_int
id|gdth_sync_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
comma
id|unchar
id|index
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_msg_str
op_star
id|msg
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_char
id|c
op_assign
l_char|&squot;&bslash;r&squot;
suffix:semicolon
id|ushort
id|i
suffix:semicolon
id|gdth_evt_data
id|dvr
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_sync_event() scp %lx serv %d status %d&bslash;n&quot;
comma
(paren
id|ulong
)paren
id|scp
comma
id|service
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|SCREENSERVICE
)paren
(brace
id|msg
op_assign
(paren
id|gdth_msg_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;len: %ld, answer: %d, ext: %d, alen: %ld&bslash;n&quot;
comma
id|msg-&gt;msg_len
comma
id|msg-&gt;msg_answer
comma
id|msg-&gt;msg_ext
comma
id|msg-&gt;msg_alen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_len
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|msg-&gt;msg_answer
op_logical_and
id|msg-&gt;msg_ext
)paren
)paren
(brace
id|msg-&gt;msg_text
(braket
id|msg-&gt;msg_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|msg-&gt;msg_text
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;msg_ext
op_logical_and
op_logical_neg
id|msg-&gt;msg_answer
)paren
(brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.msg_handle
op_assign
id|msg-&gt;msg_handle
suffix:semicolon
id|cmdp-&gt;u.screen.msg_addr
op_assign
(paren
id|ulong
)paren
id|msg
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;msg_answer
op_logical_and
id|msg-&gt;msg_alen
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|msg-&gt;msg_alen
op_logical_and
id|i
OL
id|MSGLEN
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* getchar() ?? */
multiline_comment|/* .. */
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;r&squot;
)paren
r_break
suffix:semicolon
id|msg-&gt;msg_text
(braket
id|i
)braket
op_assign
id|c
suffix:semicolon
)brace
id|msg-&gt;msg_alen
op_sub_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ne
l_char|&squot;&bslash;r&squot;
op_logical_and
id|msg-&gt;msg_alen
op_ne
l_int|0
)paren
(brace
id|msg-&gt;msg_answer
op_assign
l_int|1
suffix:semicolon
id|msg-&gt;msg_ext
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|msg-&gt;msg_ext
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;msg_answer
op_assign
l_int|0
suffix:semicolon
)brace
id|msg-&gt;msg_len
op_assign
id|i
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.msg_handle
op_assign
id|msg-&gt;msg_handle
suffix:semicolon
id|cmdp-&gt;u.screen.msg_addr
op_assign
(paren
id|ulong
)paren
id|msg
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;SCp.Message
op_assign
(paren
r_int
)paren
id|ha-&gt;status
suffix:semicolon
multiline_comment|/* cache or raw service */
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|S_OK
)paren
(brace
id|scp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|S_BSY
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Controller busy -&gt; retry !&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_putq
c_func
(paren
id|hanum
comma
id|scp
comma
id|DEFAULT_PRI
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|service
op_eq
id|CACHESERVICE
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|scp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|NOT_READY
suffix:semicolon
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;done
op_ne
id|gdth_scsi_done
)paren
(brace
id|dvr.size
op_assign
r_sizeof
(paren
id|dvr.eu.sync
)paren
suffix:semicolon
id|dvr.eu.sync.ionode
op_assign
id|hanum
suffix:semicolon
id|dvr.eu.sync.service
op_assign
id|service
suffix:semicolon
id|dvr.eu.sync.status
op_assign
id|ha-&gt;status
suffix:semicolon
id|dvr.eu.sync.info
op_assign
id|ha-&gt;info
suffix:semicolon
id|dvr.eu.sync.hostdrive
op_assign
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|ha-&gt;id
(braket
id|scp-&gt;channel
)braket
(braket
id|scp-&gt;target
)braket
dot
id|hostdrive
suffix:semicolon
macro_line|#else
id|ha-&gt;id
(braket
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
)braket
(braket
id|scp-&gt;target
)braket
dot
id|hostdrive
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;status
op_ge
l_int|0x8000
)paren
id|gdth_store_event
c_func
(paren
id|ES_SYNC
comma
l_int|0
comma
op_amp
id|dvr
)paren
suffix:semicolon
r_else
id|gdth_store_event
c_func
(paren
id|ES_SYNC
comma
id|service
comma
op_amp
id|dvr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;status
op_ne
id|S_RAW_SCSI
op_logical_or
id|ha-&gt;status
op_eq
id|S_RAW_ILL
)paren
(brace
id|scp-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
id|ha-&gt;info
suffix:semicolon
)brace
)brace
)brace
id|scp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|async_cache_tab
r_static
r_char
op_star
id|async_cache_tab
(braket
)braket
op_assign
(brace
multiline_comment|/* 0*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;002&bslash;002&bslash;004&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, service %u, async. status %u/%lu unknown&quot;
comma
multiline_comment|/* 1*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;002&bslash;002&bslash;004&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, service %u, async. status %u/%lu unknown&quot;
comma
multiline_comment|/* 2*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu not ready&quot;
comma
multiline_comment|/* 3*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu: REASSIGN not successful and/or data error on reassigned blocks. Drive may crash in the future and should be replaced&quot;
comma
multiline_comment|/* 4*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, mirror update on Host Drive %lu failed&quot;
comma
multiline_comment|/* 5*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu failed&quot;
comma
multiline_comment|/* 6*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu: REASSIGN not successful and/or data error on reassigned blocks. Drive may crash in the future and should be replaced&quot;
comma
multiline_comment|/* 7*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu write protected&quot;
comma
multiline_comment|/* 8*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, media changed in Host Drive %lu&quot;
comma
multiline_comment|/* 9*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu is offline&quot;
comma
multiline_comment|/*10*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, media change of Mirror Drive %lu&quot;
comma
multiline_comment|/*11*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu is write protected&quot;
comma
multiline_comment|/*12*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, general error on Host Drive %lu. Please check the devices of this drive!&quot;
comma
multiline_comment|/*13*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Cache Drive %u failed&quot;
comma
multiline_comment|/*14*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: FAIL state entered&quot;
comma
multiline_comment|/*15*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: error&quot;
comma
multiline_comment|/*16*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: failed drive replaced by Cache Drive %u&quot;
comma
multiline_comment|/*17*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity build failed&quot;
comma
multiline_comment|/*18*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild failed&quot;
comma
multiline_comment|/*19*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Test of Hot Fix %u failed&quot;
comma
multiline_comment|/*20*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive build finished successfully&quot;
comma
multiline_comment|/*21*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild finished successfully&quot;
comma
multiline_comment|/*22*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Hot Fix %u activated&quot;
comma
multiline_comment|/*23*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host Drive %u: processing of i/o aborted due to serious drive error&quot;
comma
multiline_comment|/*24*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, mirror update on Cache Drive %u completed&quot;
comma
multiline_comment|/*25*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, mirror update on Cache Drive %lu failed&quot;
comma
multiline_comment|/*26*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild started&quot;
comma
multiline_comment|/*27*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;012&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u: SHELF OK detected&quot;
comma
multiline_comment|/*28*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;012&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u: SHELF not OK detected&quot;
comma
multiline_comment|/*29*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug started&quot;
comma
multiline_comment|/*30*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: new disk detected&quot;
comma
multiline_comment|/*31*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: old disk detected&quot;
comma
multiline_comment|/*32*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: plugging an active disk is illegal&quot;
comma
multiline_comment|/*33*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: illegal device detected&quot;
comma
multiline_comment|/*34*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: insufficient disk capacity (%lu MB required)&quot;
comma
multiline_comment|/*35*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: disk write protected&quot;
comma
multiline_comment|/*36*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: disk not available&quot;
comma
multiline_comment|/*37*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Fault bus %u: swap detected (%lu)&quot;
comma
multiline_comment|/*38*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug finished successfully&quot;
comma
multiline_comment|/*39*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug aborted due to user Hot Plug&quot;
comma
multiline_comment|/*40*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug aborted&quot;
comma
multiline_comment|/*41*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug for Hot Fix started&quot;
comma
multiline_comment|/*42*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive build started&quot;
comma
multiline_comment|/*43*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, DRAM parity error detected&quot;
comma
multiline_comment|/*44*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: update started&quot;
comma
multiline_comment|/*45*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: Hot Fix %u activated&quot;
comma
multiline_comment|/*46*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: no matching Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*47*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*48*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: no matching Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*49*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*50*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, SCSI bus %u, ID %u: IGNORE_WIDE_RESIDUE message received&quot;
comma
multiline_comment|/*51*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand started&quot;
comma
multiline_comment|/*52*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand finished successfully&quot;
comma
multiline_comment|/*53*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand failed&quot;
comma
multiline_comment|/*54*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, CPU temperature critical&quot;
comma
multiline_comment|/*55*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, CPU temperature OK&quot;
comma
multiline_comment|/*56*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host drive %lu created&quot;
comma
multiline_comment|/*57*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand restarted&quot;
comma
multiline_comment|/*58*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand stopped&quot;
comma
)brace
suffix:semicolon
DECL|function|gdth_async_event
r_static
r_int
id|gdth_async_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
)paren
(brace
id|gdth_stackframe
id|stack
suffix:semicolon
id|gdth_evt_data
id|dvr
suffix:semicolon
r_char
op_star
id|f
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_msg_str
op_star
id|msg
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|msg
op_assign
(paren
id|gdth_msg_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_async_event() ha %d serv %d&bslash;n&quot;
comma
id|hanum
comma
id|service
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|SCREENSERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|MSG_REQUEST
)paren
(brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.msg_handle
op_assign
id|MSG_INV_HANDLE
suffix:semicolon
id|cmdp-&gt;u.screen.msg_addr
op_assign
(paren
id|ulong
)paren
id|msg
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
id|printk
c_func
(paren
l_string|&quot;[EISA slot %d] &quot;
comma
(paren
id|ushort
)paren
id|ha-&gt;brd_phys
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|printk
c_func
(paren
l_string|&quot;[DPMEM 0x%4X] &quot;
comma
(paren
id|ushort
)paren
id|ha-&gt;brd_phys
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;[PCI %d/%d] &quot;
comma
(paren
id|ushort
)paren
(paren
id|ha-&gt;brd_phys
op_rshift
l_int|8
)paren
comma
(paren
id|ushort
)paren
(paren
(paren
id|ha-&gt;brd_phys
op_rshift
l_int|3
)paren
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|dvr.size
op_assign
r_sizeof
(paren
id|dvr.eu.async
)paren
suffix:semicolon
id|dvr.eu.async.ionode
op_assign
id|hanum
suffix:semicolon
id|dvr.eu.async.service
op_assign
id|service
suffix:semicolon
id|dvr.eu.async.status
op_assign
id|ha-&gt;status
suffix:semicolon
id|dvr.eu.async.info
op_assign
id|ha-&gt;info
suffix:semicolon
op_star
(paren
id|ulong
op_star
)paren
id|dvr.eu.async.scsi_coord
op_assign
id|ha-&gt;info2
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ES_ASYNC
comma
id|service
comma
op_amp
id|dvr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|CACHESERVICE
op_logical_and
id|INDEX_OK
c_func
(paren
id|ha-&gt;status
comma
id|async_cache_tab
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;GDT: Async. event cache service, event no.: %d&bslash;n&quot;
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
id|f
op_assign
id|async_cache_tab
(braket
id|ha-&gt;status
)braket
suffix:semicolon
multiline_comment|/* i: parameter to push, j: stack element to fill */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|f
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_switch
c_cond
(paren
id|f
(braket
id|i
op_plus
l_int|1
)braket
)paren
(brace
r_case
l_int|4
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|ulong
op_star
)paren
op_amp
id|dvr.eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|ushort
op_star
)paren
op_amp
id|dvr.eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|unchar
op_star
)paren
op_amp
id|dvr.eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
op_amp
id|f
(braket
id|f
(braket
l_int|0
)braket
)braket
comma
id|stack
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Unknown async. event service %d event no. %d&bslash;n&quot;
comma
id|service
comma
id|ha-&gt;status
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef GDTH_STATISTICS
DECL|function|gdth_timeout
r_void
id|gdth_timeout
c_func
(paren
r_void
)paren
(brace
id|ulong
id|flags
comma
id|i
suffix:semicolon
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|hanum
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|act_stats
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|gdth_cmd_tab
(braket
id|i
)braket
(braket
id|hanum
)braket
dot
id|cmnd
op_ne
id|UNUSED_CMND
)paren
op_increment
id|act_stats
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|act_rq
op_assign
l_int|0
comma
id|nscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
op_increment
id|act_rq
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_to(): ints %ld, ios %ld, act_stats %ld, act_rq %ld&bslash;n&quot;
comma
id|act_ints
comma
id|act_ios
comma
id|act_stats
comma
id|act_rq
)paren
)paren
suffix:semicolon
id|act_ints
op_assign
id|act_ios
op_assign
l_int|0
suffix:semicolon
id|timer_table
(braket
id|GDTH_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
l_int|30
op_star
id|HZ
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|GDTH_TIMER
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|gdth_detect
r_int
id|gdth_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|shtp
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shp
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ulong
id|isa_bios
suffix:semicolon
id|ushort
id|eisa_slot
comma
id|device_id
comma
id|index
suffix:semicolon
id|gdth_pci_str
id|pcistr
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|hanum
suffix:semicolon
id|unchar
id|b
suffix:semicolon
macro_line|#ifdef DEBUG_GDTH
id|printk
c_func
(paren
l_string|&quot;GDT: This driver contains debugging information !! Trace level = %d&bslash;n&quot;
comma
id|DebugState
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;     Destination of debugging information: &quot;
)paren
suffix:semicolon
macro_line|#ifdef __SERIAL__
macro_line|#ifdef __COM2__
id|printk
c_func
(paren
l_string|&quot;Serial port COM2&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;Serial port COM1&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;Console&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|WAITSEC
c_func
(paren
l_int|3
)paren
suffix:semicolon
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_detect()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disable_gdth_scan
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Controller driver disabled from command line !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* initializations */
id|gdth_polling
op_assign
id|TRUE
suffix:semicolon
id|b
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXHA
suffix:semicolon
op_increment
id|j
)paren
id|gdth_cmd_tab
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
op_increment
id|i
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXHA
suffix:semicolon
op_increment
id|j
)paren
id|gdth_ioctl_tab
(braket
id|i
)braket
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
id|gdth_clear_events
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* scanning for controllers, at first: ISA controller */
r_for
c_loop
(paren
id|isa_bios
op_assign
l_int|0xc8000UL
suffix:semicolon
id|isa_bios
op_le
l_int|0xd8000UL
suffix:semicolon
id|isa_bios
op_add_assign
l_int|0x8000UL
)paren
(brace
r_if
c_cond
(paren
id|gdth_search_isa
c_func
(paren
id|isa_bios
)paren
)paren
(brace
multiline_comment|/* controller found */
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_isa
c_func
(paren
id|isa_bios
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-ISA HA at BIOS 0x%05lX IRQ %u DRQ %u&bslash;n&quot;
comma
id|isa_bios
comma
id|ha-&gt;irq
comma
id|ha-&gt;drq
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|do_gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
comma
l_int|NULL
)paren
)paren
macro_line|#else
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
)paren
)paren
macro_line|#endif
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|ha-&gt;drq
comma
l_string|&quot;gdth&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Unable to allocate DMA channel&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|free_irq
c_func
(paren
id|ha-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|set_dma_mode
c_func
(paren
id|ha-&gt;drq
comma
id|DMA_MODE_CASCADE
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
id|ha-&gt;drq
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|1
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
id|ha-&gt;drq
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
l_int|0
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;pscratch
op_assign
id|DMADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXBUS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXID
suffix:semicolon
op_increment
id|j
)paren
(brace
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|type
op_assign
id|EMPTY_DTYP
suffix:semicolon
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|lock
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Error during device scan&bslash;n&quot;
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|free_irq
c_func
(paren
id|ha-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|shp-&gt;max_id
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_lun
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|ha-&gt;bus_cnt
op_minus
l_int|1
suffix:semicolon
macro_line|#else
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|1
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
id|ha-&gt;drq
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
)brace
macro_line|#endif
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* scanning for EISA controllers */
r_for
c_loop
(paren
id|eisa_slot
op_assign
l_int|0x1000
suffix:semicolon
id|eisa_slot
op_le
l_int|0x8000
suffix:semicolon
id|eisa_slot
op_add_assign
l_int|0x1000
)paren
(brace
r_if
c_cond
(paren
id|gdth_search_eisa
c_func
(paren
id|eisa_slot
)paren
)paren
(brace
multiline_comment|/* controller found */
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_eisa
c_func
(paren
id|eisa_slot
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-EISA HA at Slot %d IRQ %u&bslash;n&quot;
comma
id|eisa_slot
op_rshift
l_int|12
comma
id|ha-&gt;irq
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|do_gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
comma
l_int|NULL
)paren
)paren
macro_line|#else
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
)paren
)paren
macro_line|#endif
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
l_int|0
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;EISA detect Bus 0: shp %lx hanum %d&bslash;n&quot;
comma
(paren
id|ulong
)paren
id|shp
comma
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
)paren
)paren
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;pscratch
op_assign
id|DMADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXBUS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXID
suffix:semicolon
op_increment
id|j
)paren
(brace
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|type
op_assign
id|EMPTY_DTYP
suffix:semicolon
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|lock
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Error during device scan&bslash;n&quot;
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|free_irq
c_func
(paren
id|ha-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|shp-&gt;max_id
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_lun
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|ha-&gt;bus_cnt
op_minus
l_int|1
suffix:semicolon
macro_line|#else
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;EISA detect Bus %d: shp %lx hanum %d&bslash;n&quot;
comma
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
comma
(paren
id|ulong
)paren
id|shp
comma
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* scanning for PCI controllers */
r_for
c_loop
(paren
id|device_id
op_assign
l_int|0
suffix:semicolon
id|device_id
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6x21RP2
suffix:semicolon
op_increment
id|device_id
)paren
(brace
r_if
c_cond
(paren
id|device_id
OG
id|PCI_DEVICE_ID_VORTEX_GDT6555
op_logical_and
id|device_id
OL
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
op_increment
id|index
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_search_pci
c_func
(paren
id|device_id
comma
id|index
comma
op_amp
id|pcistr
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* next device_id */
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_pci
c_func
(paren
op_amp
id|pcistr
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-PCI HA at %d/%d IRQ %u&bslash;n&quot;
comma
id|pcistr.bus
comma
id|pcistr.device_fn
op_rshift
l_int|3
comma
id|ha-&gt;irq
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|do_gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
comma
l_int|NULL
)paren
)paren
macro_line|#else
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
)paren
)paren
macro_line|#endif
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
l_int|0
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;pscratch
op_assign
id|DMADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXBUS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXID
suffix:semicolon
op_increment
id|j
)paren
(brace
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|type
op_assign
id|EMPTY_DTYP
suffix:semicolon
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|lock
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Error during device scan&bslash;n&quot;
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346 
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|free_irq
c_func
(paren
id|ha-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020000
id|shp-&gt;max_id
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_lun
op_assign
l_int|8
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|ha-&gt;bus_cnt
op_minus
l_int|1
suffix:semicolon
macro_line|#else
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|i
)braket
dot
id|type
op_eq
id|SIOP_DTYP
)paren
(brace
id|shp-&gt;this_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
)brace
macro_line|#endif
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_detect() %d controller detected&bslash;n&quot;
comma
id|gdth_ctr_count
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_count
OG
l_int|0
)paren
(brace
macro_line|#ifdef GDTH_STATISTICS
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_detect(): Initializing timer !&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|timer_table
(braket
id|GDTH_TIMER
)braket
dot
id|fn
op_assign
id|gdth_timeout
suffix:semicolon
id|timer_table
(braket
id|GDTH_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|GDTH_TIMER
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
id|register_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
macro_line|#endif
)brace
id|gdth_polling
op_assign
id|FALSE
suffix:semicolon
r_return
id|gdth_ctr_vcount
suffix:semicolon
)brace
DECL|function|gdth_release
r_int
id|gdth_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shp
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_release()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|shp-&gt;irq
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346
id|free_irq
c_func
(paren
id|shp-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|free_irq
c_func
(paren
id|shp-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|shp-&gt;dma_channel
op_ne
l_int|0xff
)paren
(brace
id|free_dma
c_func
(paren
id|shp-&gt;dma_channel
)paren
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_ctr_name
r_static
r_const
r_char
op_star
id|gdth_ctr_name
c_func
(paren
r_int
id|hanum
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_ctr_name()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|GDT3_ID
suffix:colon
r_return
l_string|&quot;GDT3000/3020 (EISA)&quot;
suffix:semicolon
r_case
id|GDT3A_ID
suffix:colon
r_return
l_string|&quot;GDT3000A/3020A/3050A (EISA)&quot;
suffix:semicolon
r_case
id|GDT3B_ID
suffix:colon
r_return
l_string|&quot;GDT3000B/3010A (EISA)&quot;
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
r_return
l_string|&quot;GDT2000/2020 (ISA)&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|PCI_DEVICE_ID_VORTEX_GDT60x0
suffix:colon
r_return
l_string|&quot;GDT6000/6020/6050 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6000B
suffix:colon
r_return
l_string|&quot;GDT6000B/6010 (PCI)&quot;
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x10
suffix:colon
r_return
l_string|&quot;GDT6110/6510 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x20
suffix:colon
r_return
l_string|&quot;GDT6120/6520 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6530
suffix:colon
r_return
l_string|&quot;GDT6530 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6550
suffix:colon
r_return
l_string|&quot;GDT6550 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x17
suffix:colon
r_return
l_string|&quot;GDT6117/6517 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x27
suffix:colon
r_return
l_string|&quot;GDT6127/6527 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6537
suffix:colon
r_return
l_string|&quot;GDT6537 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6557
suffix:colon
r_return
l_string|&quot;GDT6557/6557-ECC (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x15
suffix:colon
r_return
l_string|&quot;GDT6115/6515 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x25
suffix:colon
r_return
l_string|&quot;GDT6125/6525 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6535
suffix:colon
r_return
l_string|&quot;GDT6535 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6555
suffix:colon
r_return
l_string|&quot;GDT6555/6555-ECC (PCI)&quot;
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
suffix:colon
r_return
l_string|&quot;GDT6117RP/GDT6517RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x27RP
suffix:colon
r_return
l_string|&quot;GDT6127RP/GDT6527RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6537RP
suffix:colon
r_return
l_string|&quot;GDT6537RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6557RP
suffix:colon
r_return
l_string|&quot;GDT6557RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x11RP
suffix:colon
r_return
l_string|&quot;GDT6111RP/GDT6511RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x21RP
suffix:colon
r_return
l_string|&quot;GDT6121RP/GDT6521RP (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP1
suffix:colon
r_return
l_string|&quot;GDT6117RP1/GDT6517RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x27RP1
suffix:colon
r_return
l_string|&quot;GDT6127RP1/GDT6527RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6537RP1
suffix:colon
r_return
l_string|&quot;GDT6537RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6557RP1
suffix:colon
r_return
l_string|&quot;GDT6557RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x11RP1
suffix:colon
r_return
l_string|&quot;GDT6111RP1/GDT6511RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x21RP1
suffix:colon
r_return
l_string|&quot;GDT6121RP1/GDT6521RP1 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP2
suffix:colon
r_return
l_string|&quot;GDT6117RP2/GDT6517RP2 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x27RP2
suffix:colon
r_return
l_string|&quot;GDT6127RP2/GDT6527RP2 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6537RP2
suffix:colon
r_return
l_string|&quot;GDT6537RP2 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6557RP2
suffix:colon
r_return
l_string|&quot;GDT6557RP2 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x11RP2
suffix:colon
r_return
l_string|&quot;GDT6111RP2/GDT6511RP2 (PCI)&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6x21RP2
suffix:colon
r_return
l_string|&quot;GDT6121RP2/GDT6521RP2 (PCI)&quot;
suffix:semicolon
)brace
)brace
r_return
l_string|&quot;&quot;
suffix:semicolon
)brace
DECL|function|gdth_info
r_const
r_char
op_star
id|gdth_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shp
)paren
(brace
r_int
id|hanum
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_info()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
r_return
(paren
id|gdth_ctr_name
c_func
(paren
id|hanum
)paren
)paren
suffix:semicolon
)brace
DECL|function|gdth_abort
r_int
id|gdth_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_abort() reason %d&bslash;n&quot;
comma
id|scp-&gt;abort_reason
)paren
)paren
suffix:semicolon
r_return
id|SCSI_ABORT_SNOOZE
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010346
DECL|function|gdth_reset
r_int
id|gdth_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_int
r_int
id|reset_flags
)paren
macro_line|#else
r_int
id|gdth_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
macro_line|#endif
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_reset()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|SCSI_RESET_PUNT
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
DECL|function|gdth_bios_param
r_int
id|gdth_bios_param
c_func
(paren
id|Disk
op_star
id|disk
comma
id|kdev_t
id|dev
comma
r_int
op_star
id|ip
)paren
macro_line|#else
r_int
id|gdth_bios_param
c_func
(paren
id|Disk
op_star
id|disk
comma
r_int
id|dev
comma
r_int
op_star
id|ip
)paren
macro_line|#endif
(brace
id|unchar
id|b
comma
id|t
suffix:semicolon
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|disk-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|b
op_assign
id|disk-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|disk-&gt;device-&gt;id
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_bios_param() ha %d bus %d target %d&bslash;n&quot;
comma
id|hanum
comma
id|b
comma
id|t
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|ip
(braket
l_int|0
)braket
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|heads
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
id|ha-&gt;id
(braket
id|b
)braket
(braket
id|t
)braket
dot
id|secs
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|disk-&gt;capacity
op_div
id|ip
(braket
l_int|0
)braket
op_div
id|ip
(braket
l_int|1
)braket
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_bios_param(): %d heads, %d secs, %d cyls&bslash;n&quot;
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|internal_done
r_static
r_void
id|internal_done
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|scp-&gt;SCp.sent_command
op_increment
suffix:semicolon
)brace
DECL|function|gdth_command
r_int
id|gdth_command
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_command()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|scp-&gt;SCp.sent_command
op_assign
l_int|0
suffix:semicolon
id|gdth_queuecommand
c_func
(paren
id|scp
comma
id|internal_done
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|scp-&gt;SCp.sent_command
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_return
id|scp-&gt;result
suffix:semicolon
)brace
DECL|function|gdth_queuecommand
r_int
id|gdth_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_void
(paren
op_star
id|done
)paren
(paren
id|Scsi_Cmnd
op_star
)paren
)paren
(brace
r_int
id|hanum
suffix:semicolon
r_int
id|priority
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_queuecommand() cmd 0x%x id %d lun %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|scp-&gt;target
comma
id|scp-&gt;lun
)paren
)paren
suffix:semicolon
id|scp-&gt;scsi_done
op_assign
(paren
r_void
op_star
)paren
id|done
suffix:semicolon
id|scp-&gt;SCp.have_data_in
op_assign
l_int|0
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
op_increment
id|act_ios
suffix:semicolon
macro_line|#endif
id|priority
op_assign
id|DEFAULT_PRI
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x010300
r_if
c_cond
(paren
id|scp-&gt;done
op_eq
id|gdth_scsi_done
)paren
id|priority
op_assign
id|scp-&gt;SCp.this_residual
suffix:semicolon
macro_line|#endif
id|gdth_putq
c_func
(paren
id|hanum
comma
id|scp
comma
id|priority
)paren
suffix:semicolon
id|gdth_next
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* shutdown routine */
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
DECL|function|gdth_halt
r_static
r_int
id|gdth_halt
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
id|ulong
id|event
comma
r_void
op_star
id|buf
)paren
macro_line|#else
r_void
id|gdth_halt
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
r_int
id|hanum
comma
id|i
comma
id|j
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|Scsi_Cmnd
id|scp
suffix:semicolon
id|Scsi_Device
id|sdev
suffix:semicolon
id|gdth_cmd_str
id|gdtcmd
suffix:semicolon
r_char
id|cmnd
(braket
l_int|12
)braket
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt() event %d&bslash;n&quot;
comma
id|event
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|event
op_ne
id|SYS_RESTART
op_logical_and
id|event
op_ne
id|SYS_HALT
op_logical_and
id|event
op_ne
id|SYS_POWER_OFF
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
macro_line|#else
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt()&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;GDT: Flushing all host drives .. &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hanum
op_assign
l_int|0
suffix:semicolon
id|hanum
OL
id|gdth_ctr_count
suffix:semicolon
op_increment
id|hanum
)paren
(brace
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|sdev.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|sdev.id
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|scp.target
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|sdev
suffix:semicolon
id|scp.use_sg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* flush */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXBUS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXID
suffix:semicolon
op_increment
id|j
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|type
op_eq
id|CACHE_DTYP
)paren
(brace
id|gdtcmd.BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_FLUSH
suffix:semicolon
id|gdtcmd.u.cache.DeviceNo
op_assign
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|hostdrive
suffix:semicolon
id|gdtcmd.u.cache.BlockNo
op_assign
l_int|1
suffix:semicolon
id|gdtcmd.u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt(): flush ha %d drive %d&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;id
(braket
id|i
)braket
(braket
id|j
)braket
dot
id|hostdrive
)paren
)paren
suffix:semicolon
(brace
r_struct
id|semaphore
id|sem
op_assign
id|MUTEX_LOCKED
suffix:semicolon
id|scp.request.rq_status
op_assign
id|RQ_SCSI_BUSY
suffix:semicolon
id|scp.request.sem
op_assign
op_amp
id|sem
suffix:semicolon
id|scsi_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmnd
comma
op_amp
id|gdtcmd
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
comma
id|gdth_scsi_done
comma
l_int|30
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* controller reset */
id|gdtcmd.BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_RESET
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt(): reset controller %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
(brace
r_struct
id|semaphore
id|sem
op_assign
id|MUTEX_LOCKED
suffix:semicolon
id|scp.request.rq_status
op_assign
id|RQ_SCSI_BUSY
suffix:semicolon
id|scp.request.sem
op_assign
op_amp
id|sem
suffix:semicolon
id|scsi_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmnd
comma
op_amp
id|gdtcmd
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
comma
id|gdth_scsi_done
comma
l_int|10
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
id|timer_active
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|GDTH_TIMER
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= 0x020100
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* called from init/main.c */
DECL|function|gdth_setup
r_void
id|gdth_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
r_static
r_int
id|setup_idx
op_assign
l_int|0
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_setup() str %s ints[0] %d ints[1] %d&bslash;n&quot;
comma
id|str
ques
c_cond
id|str
suffix:colon
l_string|&quot;NULL&quot;
comma
id|ints
(braket
l_int|0
)braket
comma
id|ints
(braket
l_int|0
)braket
ques
c_cond
id|ints
(braket
l_int|1
)braket
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setup_idx
op_ge
id|MAXHA
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: gdth_setup() called too many times. Bad LILO params ?&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Illegal command line !&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Usage: gdth=&lt;IRQ&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Where: &lt;IRQ&gt;: valid EISA controller IRQ (10,11,12,14)&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;              or 0 to disable controller driver&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|1
)braket
op_eq
l_int|10
op_logical_or
id|ints
(braket
l_int|1
)braket
op_eq
l_int|11
op_logical_or
id|ints
(braket
l_int|1
)braket
op_eq
l_int|12
op_logical_or
id|ints
(braket
l_int|1
)braket
op_eq
l_int|14
)paren
(brace
id|irqs
(braket
id|setup_idx
op_increment
)braket
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|irqs
(braket
id|setup_idx
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
(brace
id|disable_gdth_scan
op_assign
id|TRUE
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;GDT: Invalid IRQ (%d) specified&bslash;n&quot;
comma
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|driver_template
id|Scsi_Host_Template
id|driver_template
op_assign
id|GDTH
suffix:semicolon
macro_line|#include &quot;scsi_module.c&quot;
macro_line|#endif
eof
