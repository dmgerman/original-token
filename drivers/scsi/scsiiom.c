multiline_comment|/***********************************************************************&n; *&t;FILE NAME : SCSIIOM.C&t;&t;&t;&t;&t;       *&n; *&t;     BY   : C.L. Huang,    ching@tekram.com.tw&t;&t;       *&n; *&t;Description: Device Driver for Tekram DC-390 (T) PCI SCSI      *&n; *&t;&t;     Bus Master Host Adapter&t;&t;&t;       *&n; ***********************************************************************/
r_static
id|USHORT
DECL|function|DC390_StartSCSI
id|DC390_StartSCSI
c_func
(paren
id|PACB
id|pACB
comma
id|PDCB
id|pDCB
comma
id|PSRB
id|pSRB
)paren
(brace
id|USHORT
id|ioport
comma
id|rc
suffix:semicolon
id|UCHAR
id|bval
comma
id|bval1
comma
id|i
comma
id|cnt
suffix:semicolon
id|PUCHAR
id|ptr
suffix:semicolon
id|ULONG
id|wlval
suffix:semicolon
id|pSRB-&gt;TagNumber
op_assign
l_int|31
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;UnitSCSIID
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Scsi_Dest_ID
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;SyncPeriod
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Period
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;SyncOffset
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Offset
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR1
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg1
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR3
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg3
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR4
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg4
)paren
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
multiline_comment|/* Flush FIFO */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|pSRB-&gt;ScsiPhase
op_assign
id|SCSI_NOP0
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;IdentifyMsg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pDCB-&gt;SyncMode
op_amp
id|EN_ATN_STOP
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|INQUIRY
)paren
op_logical_or
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|REQUEST_SENSE
)paren
op_logical_or
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
)paren
(brace
id|bval
op_and_assign
l_int|0xBF
suffix:semicolon
multiline_comment|/* NO disconnection */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval1
op_assign
id|SELECT_W_ATN
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|SYNC_ENABLE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pDCB-&gt;IdentifyMsg
op_amp
l_int|7
)paren
op_logical_or
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_ne
id|INQUIRY
)paren
)paren
(brace
id|bval1
op_assign
id|SEL_W_ATN_STOP
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_MSGOUT
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|EN_TAG_QUEUING
)paren
(brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
id|MSG_SIMPLE_QTAG
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|wlval
op_assign
l_int|1
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|wlval
op_amp
id|pDCB-&gt;TagMask
)paren
(brace
id|wlval
op_assign
id|wlval
op_lshift
l_int|1
suffix:semicolon
id|bval
op_increment
suffix:semicolon
)brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pDCB-&gt;TagMask
op_or_assign
id|wlval
suffix:semicolon
id|pSRB-&gt;TagNumber
op_assign
id|bval
suffix:semicolon
id|bval1
op_assign
id|SEL_W_ATN2
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval1
op_assign
id|SELECT_W_ATN
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
(brace
id|bval
op_assign
id|REQUEST_SENSE
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;IdentifyMsg
op_lshift
l_int|5
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
r_sizeof
(paren
id|pSRB-&gt;pcmd-&gt;sense_buffer
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
)brace
r_else
(brace
id|cnt
op_assign
id|pSRB-&gt;ScsiCmdLen
suffix:semicolon
id|ptr
op_assign
(paren
id|PUCHAR
)paren
id|pSRB-&gt;CmdBlock
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bval
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
multiline_comment|/* ATN_STOP */
(brace
r_if
c_cond
(paren
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|INQUIRY
)paren
op_logical_or
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|REQUEST_SENSE
)paren
op_logical_or
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
)paren
(brace
id|bval
op_and_assign
l_int|0xBF
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval1
op_assign
id|SELECT_W_ATN
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|SYNC_ENABLE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pDCB-&gt;IdentifyMsg
op_amp
l_int|7
)paren
op_logical_or
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_ne
id|INQUIRY
)paren
)paren
(brace
id|bval1
op_assign
id|SEL_W_ATN_STOP
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_MSGOUT
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|EN_TAG_QUEUING
)paren
(brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pSRB-&gt;MsgOutBuf
(braket
l_int|0
)braket
op_assign
id|MSG_SIMPLE_QTAG
suffix:semicolon
id|wlval
op_assign
l_int|1
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|wlval
op_amp
id|pDCB-&gt;TagMask
)paren
(brace
id|wlval
op_assign
id|wlval
op_lshift
l_int|1
suffix:semicolon
id|bval
op_increment
suffix:semicolon
)brace
id|pDCB-&gt;TagMask
op_or_assign
id|wlval
suffix:semicolon
id|pSRB-&gt;TagNumber
op_assign
id|bval
suffix:semicolon
id|pSRB-&gt;MsgOutBuf
(braket
l_int|1
)braket
op_assign
id|bval
suffix:semicolon
id|pSRB-&gt;MsgCnt
op_assign
l_int|2
suffix:semicolon
id|bval1
op_assign
id|SEL_W_ATN_STOP
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pSRB-&gt;MsgOutBuf
(braket
l_int|0
)braket
op_assign
id|MSG_NOP
suffix:semicolon
id|pSRB-&gt;MsgCnt
op_assign
l_int|1
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_START_
suffix:semicolon
id|bval1
op_assign
id|SEL_W_ATN_STOP
suffix:semicolon
)brace
)brace
)brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Scsi_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bval
op_amp
id|INTERRUPT
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_READY
suffix:semicolon
id|pDCB-&gt;TagMask
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pSRB-&gt;TagNumber
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|pSRB-&gt;ScsiPhase
op_assign
id|SCSI_NOP1
suffix:semicolon
id|pACB-&gt;pActiveDCB
op_assign
id|pDCB
suffix:semicolon
id|pDCB-&gt;pActiveSRB
op_assign
id|pSRB
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval1
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_Interrupt
id|DC390_Interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|PACB
id|pACB
suffix:semicolon
id|PDCB
id|pDCB
suffix:semicolon
id|PSRB
id|pSRB
suffix:semicolon
id|USHORT
id|ioport
op_assign
l_int|0
suffix:semicolon
id|USHORT
id|phase
comma
id|i
suffix:semicolon
r_void
(paren
op_star
id|stateV
)paren
(paren
id|PACB
comma
id|PSRB
comma
id|PUCHAR
)paren
suffix:semicolon
id|UCHAR
id|istate
op_assign
l_int|0
suffix:semicolon
id|UCHAR
id|sstatus
op_assign
l_int|0
comma
id|istatus
suffix:semicolon
id|pACB
op_assign
id|pACB_start
suffix:semicolon
r_if
c_cond
(paren
id|pACB
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapterCnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pACB-&gt;IRQLevel
op_eq
(paren
id|UCHAR
)paren
id|irq
)paren
(brace
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|sstatus
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Scsi_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sstatus
op_amp
id|INTERRUPT
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
id|pACB
op_assign
id|pACB-&gt;pNextACB
suffix:semicolon
)brace
r_else
(brace
id|pACB
op_assign
id|pACB-&gt;pNextACB
suffix:semicolon
)brace
)brace
macro_line|#ifdef DC390_DEBUG1
id|printk
c_func
(paren
l_string|&quot;sstatus=%2x,&quot;
comma
id|sstatus
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pACB
op_eq
(paren
id|PACB
)paren
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DC390: Spurious interrupt detected!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|istate
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Intern_State
)paren
suffix:semicolon
id|istatus
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|INT_Status
)paren
suffix:semicolon
macro_line|#ifdef DC390_DEBUG1
id|printk
c_func
(paren
l_string|&quot;Istatus=%2x,&quot;
comma
id|istatus
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|istatus
op_amp
id|DISCONNECTED
)paren
(brace
id|DC390_Disconnect
c_func
(paren
id|pACB
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|istatus
op_amp
id|RESELECTED
)paren
(brace
id|DC390_Reselect
c_func
(paren
id|pACB
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|istatus
op_amp
id|INVALID_CMD
)paren
(brace
id|DC390_InvalidCmd
c_func
(paren
id|pACB
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|istatus
op_amp
id|SCSI_RESET
)paren
(brace
id|DC390_ScsiRstDetect
c_func
(paren
id|pACB
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|istatus
op_amp
(paren
id|SUCCESSFUL_OP
op_plus
id|SERVICE_REQUEST
)paren
)paren
(brace
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
id|pSRB
op_assign
id|pDCB-&gt;pActiveSRB
suffix:semicolon
r_if
c_cond
(paren
id|pDCB
)paren
(brace
r_if
c_cond
(paren
id|pDCB-&gt;DCBFlag
op_amp
id|ABORT_DEV_
)paren
(brace
id|EnableMsgOut
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
)brace
id|phase
op_assign
(paren
id|USHORT
)paren
id|pSRB-&gt;ScsiPhase
suffix:semicolon
id|stateV
op_assign
(paren
r_void
op_star
)paren
id|DC390_phase0
(braket
id|phase
)braket
suffix:semicolon
id|stateV
c_func
(paren
id|pACB
comma
id|pSRB
comma
op_amp
id|sstatus
)paren
suffix:semicolon
id|pSRB-&gt;ScsiPhase
op_assign
id|sstatus
op_amp
l_int|7
suffix:semicolon
id|phase
op_assign
(paren
id|USHORT
)paren
id|sstatus
op_amp
l_int|7
suffix:semicolon
id|stateV
op_assign
(paren
r_void
op_star
)paren
id|DC390_phase1
(braket
id|phase
)braket
suffix:semicolon
id|stateV
c_func
(paren
id|pACB
comma
id|pSRB
comma
op_amp
id|sstatus
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|do_DC390_Interrupt
id|do_DC390_Interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
id|DC390_Interrupt
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_DataOut_0
id|DC390_DataOut_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|sstatus
comma
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|PSGL
id|psgl
suffix:semicolon
id|ULONG
id|ResidCnt
comma
id|xferCnt
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|sstatus
op_assign
op_star
id|psstatus
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_XFERPAD
)paren
)paren
(brace
r_if
c_cond
(paren
id|sstatus
op_amp
id|PARITY_ERR
)paren
(brace
id|pSRB-&gt;SRBStatus
op_or_assign
id|PARITY_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sstatus
op_amp
id|COUNT_2_ZERO
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|DMA_Status
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|bval
op_amp
id|DMA_XFER_DONE
)paren
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|DMA_Status
)paren
suffix:semicolon
)brace
id|pSRB-&gt;TotalXferredLen
op_add_assign
id|pSRB-&gt;SGToBeXferLen
suffix:semicolon
id|pSRB-&gt;SGIndex
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SGIndex
OL
id|pSRB-&gt;SGcount
)paren
(brace
id|pSRB-&gt;pSegmentList
op_increment
suffix:semicolon
id|psgl
op_assign
id|pSRB-&gt;pSegmentList
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_assign
id|virt_to_phys
c_func
(paren
id|psgl-&gt;address
)paren
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
(paren
id|ULONG
)paren
id|psgl-&gt;length
suffix:semicolon
)brace
r_else
id|pSRB-&gt;SGToBeXferLen
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Current_Fifo
)paren
suffix:semicolon
id|bval
op_and_assign
l_int|0x1f
suffix:semicolon
id|ResidCnt
op_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_High
)paren
suffix:semicolon
id|ResidCnt
op_assign
id|ResidCnt
op_lshift
l_int|8
suffix:semicolon
id|ResidCnt
op_or_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_Mid
)paren
suffix:semicolon
id|ResidCnt
op_assign
id|ResidCnt
op_lshift
l_int|8
suffix:semicolon
id|ResidCnt
op_or_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_Low
)paren
suffix:semicolon
id|ResidCnt
op_add_assign
(paren
id|ULONG
)paren
id|bval
suffix:semicolon
id|xferCnt
op_assign
id|pSRB-&gt;SGToBeXferLen
op_minus
id|ResidCnt
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_add_assign
id|xferCnt
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_add_assign
id|xferCnt
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
id|ResidCnt
suffix:semicolon
)brace
)brace
id|bval
op_assign
id|WRITE_DIRECTION
op_plus
id|DMA_IDLE_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_DataIn_0
id|DC390_DataIn_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|sstatus
comma
id|bval
suffix:semicolon
id|USHORT
id|i
comma
id|ioport
comma
id|residual
suffix:semicolon
id|PSGL
id|psgl
suffix:semicolon
id|ULONG
id|ResidCnt
comma
id|xferCnt
suffix:semicolon
id|PUCHAR
id|ptr
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|sstatus
op_assign
op_star
id|psstatus
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_XFERPAD
)paren
)paren
(brace
r_if
c_cond
(paren
id|sstatus
op_amp
id|PARITY_ERR
)paren
(brace
id|pSRB-&gt;SRBStatus
op_or_assign
id|PARITY_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sstatus
op_amp
id|COUNT_2_ZERO
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|DMA_Status
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|bval
op_amp
id|DMA_XFER_DONE
)paren
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|DMA_Status
)paren
suffix:semicolon
)brace
id|bval
op_assign
id|READ_DIRECTION
op_plus
id|DMA_IDLE_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_add_assign
id|pSRB-&gt;SGToBeXferLen
suffix:semicolon
id|pSRB-&gt;SGIndex
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SGIndex
OL
id|pSRB-&gt;SGcount
)paren
(brace
id|pSRB-&gt;pSegmentList
op_increment
suffix:semicolon
id|psgl
op_assign
id|pSRB-&gt;pSegmentList
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_assign
id|virt_to_phys
c_func
(paren
id|psgl-&gt;address
)paren
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
(paren
id|ULONG
)paren
id|psgl-&gt;length
suffix:semicolon
)brace
r_else
id|pSRB-&gt;SGToBeXferLen
op_assign
l_int|0
suffix:semicolon
)brace
r_else
multiline_comment|/* phase changed */
(brace
id|residual
op_assign
l_int|0
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Current_Fifo
)paren
suffix:semicolon
r_while
c_loop
(paren
id|bval
op_amp
l_int|0x1f
)paren
(brace
r_if
c_cond
(paren
(paren
id|bval
op_amp
l_int|0x1f
)paren
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Current_Fifo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bval
op_amp
l_int|0x1f
)paren
)paren
(brace
r_goto
id|din_1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_eq
l_int|0x0ff
)paren
(brace
id|residual
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* ;1 residual byte */
r_goto
id|din_1
suffix:semicolon
)brace
)brace
)brace
r_else
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|Current_Fifo
)paren
suffix:semicolon
)brace
id|din_1
suffix:colon
id|bval
op_assign
id|READ_DIRECTION
op_plus
id|DMA_BLAST_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x8000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|DMA_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bval
op_amp
id|BLAST_COMPLETE
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|bval
op_assign
id|READ_DIRECTION
op_plus
id|DMA_IDLE_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
id|ResidCnt
op_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_High
)paren
suffix:semicolon
id|ResidCnt
op_assign
id|ResidCnt
op_lshift
l_int|8
suffix:semicolon
id|ResidCnt
op_or_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_Mid
)paren
suffix:semicolon
id|ResidCnt
op_assign
id|ResidCnt
op_lshift
l_int|8
suffix:semicolon
id|ResidCnt
op_or_assign
(paren
id|ULONG
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|CtcReg_Low
)paren
suffix:semicolon
id|xferCnt
op_assign
id|pSRB-&gt;SGToBeXferLen
op_minus
id|ResidCnt
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_add_assign
id|xferCnt
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_add_assign
id|xferCnt
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
id|ResidCnt
suffix:semicolon
r_if
c_cond
(paren
id|residual
)paren
(brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
multiline_comment|/* get residual byte */
id|ptr
op_assign
(paren
id|PUCHAR
)paren
id|phys_to_virt
c_func
(paren
id|pSRB-&gt;SGPhysAddr
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|bval
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_increment
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_increment
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_void
DECL|function|DC390_Command_0
id|DC390_Command_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
)brace
r_static
r_void
DECL|function|DC390_Status_0
id|DC390_Status_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
id|bval
suffix:semicolon
id|bval
op_increment
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
multiline_comment|/* get message */
id|pSRB-&gt;EndMessage
op_assign
id|bval
suffix:semicolon
op_star
id|psstatus
op_assign
id|SCSI_NOP0
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_COMPLETED
suffix:semicolon
id|bval
op_assign
id|MSG_ACCEPTED_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_MsgOut_0
id|DC390_MsgOut_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
(paren
id|SRB_UNEXPECT_RESEL
op_plus
id|SRB_ABORT_SENT
)paren
)paren
(brace
op_star
id|psstatus
op_assign
id|SCSI_NOP0
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|DC390_MsgIn_0
id|DC390_MsgIn_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
comma
id|wval
comma
id|wval1
suffix:semicolon
id|PDCB
id|pDCB
suffix:semicolon
id|PSRB
id|psrb
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_MSGIN_MULTI
)paren
)paren
(brace
r_if
c_cond
(paren
id|bval
op_eq
id|MSG_DISCONNECT
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_DISCONNECT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bval
op_eq
id|MSG_SAVE_PTR
)paren
(brace
r_goto
id|min6
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bval
op_eq
id|MSG_EXTENDED
)paren
op_logical_or
(paren
(paren
id|bval
op_ge
id|MSG_SIMPLE_QTAG
)paren
op_logical_and
(paren
id|bval
op_le
id|MSG_ORDER_QTAG
)paren
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_or_assign
id|SRB_MSGIN_MULTI
suffix:semicolon
id|pSRB-&gt;MsgInBuf
(braket
l_int|0
)braket
op_assign
id|bval
suffix:semicolon
id|pSRB-&gt;MsgCnt
op_assign
l_int|1
suffix:semicolon
id|pSRB-&gt;pMsgPtr
op_assign
op_amp
id|pSRB-&gt;MsgInBuf
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bval
op_eq
id|MSG_REJECT_
)paren
(brace
id|bval
op_assign
id|RESET_ATN_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
id|DO_SYNC_NEGO
)paren
(brace
r_goto
id|set_async
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|bval
op_eq
id|MSG_RESTORE_PTR
)paren
(brace
r_goto
id|min6
suffix:semicolon
)brace
r_else
r_goto
id|min6
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* minx: */
op_star
id|pSRB-&gt;pMsgPtr
op_assign
id|bval
suffix:semicolon
id|pSRB-&gt;MsgCnt
op_increment
suffix:semicolon
id|pSRB-&gt;pMsgPtr
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|0
)braket
op_ge
id|MSG_SIMPLE_QTAG
)paren
op_logical_and
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|0
)braket
op_le
id|MSG_ORDER_QTAG
)paren
)paren
(brace
r_if
c_cond
(paren
id|pSRB-&gt;MsgCnt
op_eq
l_int|2
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
l_int|0
suffix:semicolon
id|bval
op_assign
id|pSRB-&gt;MsgInBuf
(braket
l_int|1
)braket
suffix:semicolon
id|pSRB
op_assign
id|pDCB-&gt;pGoingSRB
suffix:semicolon
id|psrb
op_assign
id|pDCB-&gt;pGoingLast
suffix:semicolon
r_if
c_cond
(paren
id|pSRB
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|pSRB-&gt;TagNumber
op_ne
id|bval
)paren
(brace
r_if
c_cond
(paren
id|pSRB
op_eq
id|psrb
)paren
(brace
r_goto
id|mingx0
suffix:semicolon
)brace
id|pSRB
op_assign
id|pSRB-&gt;pNextSRB
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pDCB-&gt;DCBFlag
op_amp
id|ABORT_DEV_
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_ABORT_SENT
suffix:semicolon
id|EnableMsgOut
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_DISCONNECT
)paren
)paren
(brace
r_goto
id|mingx0
suffix:semicolon
)brace
id|pDCB-&gt;pActiveSRB
op_assign
id|pSRB
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_DATA_XFER
suffix:semicolon
)brace
r_else
(brace
id|mingx0
suffix:colon
id|pSRB
op_assign
id|pACB-&gt;pTmpSRB
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_UNEXPECT_RESEL
suffix:semicolon
id|pDCB-&gt;pActiveSRB
op_assign
id|pSRB
suffix:semicolon
id|pSRB-&gt;MsgOutBuf
(braket
l_int|0
)braket
op_assign
id|MSG_ABORT_TAG
suffix:semicolon
id|EnableMsgOut2
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|0
)braket
op_eq
id|MSG_EXTENDED
)paren
op_logical_and
(paren
id|pSRB-&gt;MsgCnt
op_eq
l_int|5
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_and_assign
op_complement
(paren
id|SRB_MSGIN_MULTI
op_plus
id|DO_SYNC_NEGO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|1
)braket
op_ne
l_int|3
)paren
op_logical_or
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|2
)braket
op_ne
l_int|1
)paren
)paren
(brace
multiline_comment|/* reject_msg: */
id|pSRB-&gt;MsgCnt
op_assign
l_int|1
suffix:semicolon
id|pSRB-&gt;MsgInBuf
(braket
l_int|0
)braket
op_assign
id|MSG_REJECT_
suffix:semicolon
id|bval
op_assign
id|SET_ATN_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|3
)braket
)paren
op_logical_or
op_logical_neg
(paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|4
)braket
)paren
)paren
(brace
id|set_async
suffix:colon
id|pDCB
op_assign
id|pSRB-&gt;pSRBDCB
suffix:semicolon
id|pDCB-&gt;SyncMode
op_and_assign
op_complement
(paren
id|SYNC_ENABLE
op_plus
id|SYNC_NEGO_DONE
)paren
suffix:semicolon
id|pDCB-&gt;SyncPeriod
op_assign
l_int|0
suffix:semicolon
id|pDCB-&gt;SyncOffset
op_assign
l_int|0
suffix:semicolon
id|pDCB-&gt;CtrlR3
op_assign
id|FAST_CLK
suffix:semicolon
multiline_comment|/* ;non_fast */
id|pDCB-&gt;CtrlR4
op_and_assign
l_int|0x3f
suffix:semicolon
id|pDCB-&gt;CtrlR4
op_or_assign
id|EATER_25NS
suffix:semicolon
multiline_comment|/* ; 25ns glitch eater */
r_goto
id|re_prog
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* set_sync: */
id|pDCB
op_assign
id|pSRB-&gt;pSRBDCB
suffix:semicolon
id|pDCB-&gt;SyncMode
op_or_assign
id|SYNC_ENABLE
op_plus
id|SYNC_NEGO_DONE
suffix:semicolon
id|pDCB-&gt;SyncOffset
op_and_assign
l_int|0x0f0
suffix:semicolon
id|pDCB-&gt;SyncOffset
op_or_assign
id|pSRB-&gt;MsgInBuf
(braket
l_int|4
)braket
suffix:semicolon
id|pDCB-&gt;NegoPeriod
op_assign
id|pSRB-&gt;MsgInBuf
(braket
l_int|3
)braket
suffix:semicolon
id|wval
op_assign
(paren
id|USHORT
)paren
id|pSRB-&gt;MsgInBuf
(braket
l_int|3
)braket
suffix:semicolon
id|wval
op_assign
id|wval
op_lshift
l_int|2
suffix:semicolon
id|wval
op_decrement
suffix:semicolon
id|wval1
op_assign
id|wval
op_div
l_int|25
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wval1
op_star
l_int|25
)paren
op_ne
id|wval
)paren
(brace
id|wval1
op_increment
suffix:semicolon
)brace
id|bval
op_assign
id|FAST_CLK
op_plus
id|FAST_SCSI
suffix:semicolon
id|pDCB-&gt;CtrlR4
op_and_assign
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|wval1
op_ge
l_int|8
)paren
(brace
id|wval1
op_decrement
suffix:semicolon
id|bval
op_assign
id|FAST_CLK
suffix:semicolon
multiline_comment|/* ;fast clock/normal scsi */
id|pDCB-&gt;CtrlR4
op_or_assign
id|EATER_25NS
suffix:semicolon
multiline_comment|/* ;25 ns glitch eater */
)brace
id|pDCB-&gt;CtrlR3
op_assign
id|bval
suffix:semicolon
id|pDCB-&gt;SyncPeriod
op_assign
(paren
id|UCHAR
)paren
id|wval1
suffix:semicolon
id|re_prog
suffix:colon
id|bval
op_assign
id|pDCB-&gt;SyncPeriod
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Period
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;SyncOffset
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Offset
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR3
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg3
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR4
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg4
)paren
suffix:semicolon
id|SetXferRate
c_func
(paren
id|pACB
comma
id|pDCB
)paren
suffix:semicolon
)brace
)brace
)brace
id|min6
suffix:colon
op_star
id|psstatus
op_assign
id|SCSI_NOP0
suffix:semicolon
id|bval
op_assign
id|MSG_ACCEPTED_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DataIO_Comm
id|DataIO_Comm
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|UCHAR
id|ioDir
)paren
(brace
id|PSGL
id|psgl
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|ULONG
id|lval
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SGIndex
OL
id|pSRB-&gt;SGcount
)paren
(brace
id|bval
op_assign
id|DMA_IDLE_CMD
op_or
id|ioDir
suffix:semicolon
multiline_comment|/* ;+EN_DMA_INT */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pSRB-&gt;SGToBeXferLen
)paren
(brace
id|psgl
op_assign
id|pSRB-&gt;pSegmentList
suffix:semicolon
id|pSRB-&gt;SGPhysAddr
op_assign
id|virt_to_phys
c_func
(paren
id|psgl-&gt;address
)paren
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
(paren
id|ULONG
)paren
id|psgl-&gt;length
suffix:semicolon
)brace
id|lval
op_assign
id|pSRB-&gt;SGToBeXferLen
suffix:semicolon
id|bval
op_assign
(paren
id|UCHAR
)paren
id|lval
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_Low
)paren
suffix:semicolon
id|lval
op_assign
id|lval
op_rshift
l_int|8
suffix:semicolon
id|bval
op_assign
(paren
id|UCHAR
)paren
id|lval
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_Mid
)paren
suffix:semicolon
id|lval
op_assign
id|lval
op_rshift
l_int|8
suffix:semicolon
id|bval
op_assign
(paren
id|UCHAR
)paren
id|lval
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_High
)paren
suffix:semicolon
id|lval
op_assign
id|pSRB-&gt;SGToBeXferLen
suffix:semicolon
id|outl
c_func
(paren
id|lval
comma
id|ioport
op_plus
id|DMA_XferCnt
)paren
suffix:semicolon
id|lval
op_assign
id|pSRB-&gt;SGPhysAddr
suffix:semicolon
id|outl
c_func
(paren
id|lval
comma
id|ioport
op_plus
id|DMA_XferAddr
)paren
suffix:semicolon
id|bval
op_assign
id|DMA_COMMAND
op_plus
id|INFO_XFER_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_DATA_XFER
suffix:semicolon
id|bval
op_assign
id|DMA_IDLE_CMD
op_or
id|ioDir
suffix:semicolon
multiline_comment|/* ;+EN_DMA_INT */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
id|bval
op_assign
id|DMA_START_CMD
op_or
id|ioDir
suffix:semicolon
multiline_comment|/* ;+EN_DMA_INT */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* xfer pad */
(brace
r_if
c_cond
(paren
id|pSRB-&gt;SGcount
)paren
(brace
id|pSRB-&gt;AdaptStatus
op_assign
id|H_OVER_UNDER_RUN
suffix:semicolon
id|pSRB-&gt;SRBStatus
op_or_assign
id|OVER_RUN
suffix:semicolon
)brace
id|bval
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_Low
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_Mid
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtcReg_High
)paren
suffix:semicolon
id|pSRB-&gt;SRBState
op_or_assign
id|SRB_XFERPAD
suffix:semicolon
id|bval
op_assign
id|DMA_COMMAND
op_plus
id|XFER_PAD_BYTE
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
multiline_comment|/*&n;&t;bval = DMA_IDLE_CMD | ioDir;&t;;+EN_DMA_INT&n;&t;outb(bval, ioport+DMA_Cmd);&n;&t;bval = DMA_START_CMD | ioDir;&t;;+EN_DMA_INT&n;&t;outb(bval, ioport+DMA_Cmd);&n;*/
)brace
)brace
r_static
r_void
DECL|function|DC390_DataOutPhase
id|DC390_DataOutPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|ioDir
suffix:semicolon
id|ioDir
op_assign
id|WRITE_DIRECTION
suffix:semicolon
id|DataIO_Comm
c_func
(paren
id|pACB
comma
id|pSRB
comma
id|ioDir
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_DataInPhase
id|DC390_DataInPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|ioDir
suffix:semicolon
id|ioDir
op_assign
id|READ_DIRECTION
suffix:semicolon
id|DataIO_Comm
c_func
(paren
id|pACB
comma
id|pSRB
comma
id|ioDir
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_CommandPhase
id|DC390_CommandPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|PDCB
id|pDCB
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
id|PUCHAR
id|ptr
suffix:semicolon
id|USHORT
id|ioport
comma
id|i
comma
id|cnt
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|RESET_ATN_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
)paren
(brace
id|cnt
op_assign
(paren
id|USHORT
)paren
id|pSRB-&gt;ScsiCmdLen
suffix:semicolon
id|ptr
op_assign
(paren
id|PUCHAR
)paren
id|pSRB-&gt;CmdBlock
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
op_star
id|ptr
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|bval
op_assign
id|REQUEST_SENSE
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;IdentifyMsg
op_lshift
l_int|5
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
r_sizeof
(paren
id|pSRB-&gt;pcmd-&gt;sense_buffer
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
)brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_COMMAND
suffix:semicolon
id|bval
op_assign
id|INFO_XFER_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_StatusPhase
id|DC390_StatusPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_STATUS
suffix:semicolon
id|bval
op_assign
id|INITIATOR_CMD_CMPLTE
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_MsgOutPhase
id|DC390_MsgOutPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
comma
id|i
comma
id|cnt
suffix:semicolon
id|PUCHAR
id|ptr
suffix:semicolon
id|PDCB
id|pDCB
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_MSGOUT
)paren
)paren
(brace
id|cnt
op_assign
id|pSRB-&gt;MsgCnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
)paren
(brace
id|ptr
op_assign
(paren
id|PUCHAR
)paren
id|pSRB-&gt;MsgOutBuf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
op_star
id|ptr
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
)brace
id|pSRB-&gt;MsgCnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pDCB-&gt;DCBFlag
op_amp
id|ABORT_DEV_
)paren
op_logical_and
(paren
id|pSRB-&gt;MsgOutBuf
(braket
l_int|0
)braket
op_eq
id|MSG_ABORT
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_ABORT_SENT
suffix:semicolon
)brace
)brace
r_else
(brace
id|bval
op_assign
id|MSG_ABORT
suffix:semicolon
multiline_comment|/* ??? MSG_NOP */
r_if
c_cond
(paren
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|INQUIRY
)paren
op_logical_or
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|REQUEST_SENSE
)paren
op_logical_or
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
)paren
(brace
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|SYNC_ENABLE
)paren
(brace
r_goto
id|mop1
suffix:semicolon
)brace
)brace
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
)brace
id|bval
op_assign
id|INFO_XFER_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_else
(brace
id|mop1
suffix:colon
id|bval
op_assign
id|MSG_EXTENDED
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|3
suffix:semicolon
multiline_comment|/*    ;length of extended msg */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*    ; sync nego */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;NegoPeriod
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|bval
op_assign
id|SYNC_NEGO_OFFSET
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
id|pSRB-&gt;SRBState
op_or_assign
id|DO_SYNC_NEGO
suffix:semicolon
id|bval
op_assign
id|INFO_XFER_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|DC390_MsgInPhase
id|DC390_MsgInPhase
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_MSGIN
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_and_assign
id|SRB_DISCONNECT
suffix:semicolon
id|pSRB-&gt;SRBState
op_or_assign
id|SRB_MSGIN
suffix:semicolon
)brace
id|bval
op_assign
id|INFO_XFER_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_Nop_0
id|DC390_Nop_0
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
)brace
r_static
r_void
DECL|function|DC390_Nop_1
id|DC390_Nop_1
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
comma
id|PUCHAR
id|psstatus
)paren
(brace
)brace
r_static
r_void
DECL|function|SetXferRate
id|SetXferRate
c_func
(paren
id|PACB
id|pACB
comma
id|PDCB
id|pDCB
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|cnt
comma
id|i
suffix:semicolon
id|PDCB
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pDCB-&gt;IdentifyMsg
op_amp
l_int|0x07
)paren
)paren
(brace
r_if
c_cond
(paren
id|pACB-&gt;scan_devices
)paren
(brace
id|CurrSyncOffset
op_assign
id|pDCB-&gt;SyncOffset
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
id|cnt
op_assign
id|pACB-&gt;DeviceCnt
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;UnitSCSIID
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ptr-&gt;UnitSCSIID
op_eq
id|bval
)paren
(brace
id|ptr-&gt;SyncPeriod
op_assign
id|pDCB-&gt;SyncPeriod
suffix:semicolon
id|ptr-&gt;SyncOffset
op_assign
id|pDCB-&gt;SyncOffset
suffix:semicolon
id|ptr-&gt;CtrlR3
op_assign
id|pDCB-&gt;CtrlR3
suffix:semicolon
id|ptr-&gt;CtrlR4
op_assign
id|pDCB-&gt;CtrlR4
suffix:semicolon
id|ptr-&gt;SyncMode
op_assign
id|pDCB-&gt;SyncMode
suffix:semicolon
)brace
id|ptr
op_assign
id|ptr-&gt;pNextDCB
suffix:semicolon
)brace
)brace
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_Disconnect
id|DC390_Disconnect
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|PDCB
id|pDCB
suffix:semicolon
id|PSRB
id|pSRB
comma
id|psrb
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|USHORT
id|ioport
comma
id|i
comma
id|cnt
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
macro_line|#ifdef DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;DISC,&quot;
)paren
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pDCB
)paren
(brace
macro_line|#ifdef DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;ACB:%08lx-&gt;ActiveDCB:%08lx !,&quot;
comma
(paren
id|ULONG
)paren
id|pACB
comma
(paren
id|ULONG
)paren
id|pDCB
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pSRB
op_assign
id|pDCB-&gt;pActiveSRB
suffix:semicolon
id|pACB-&gt;pActiveDCB
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;ScsiPhase
op_assign
id|SCSI_NOP0
suffix:semicolon
id|bval
op_assign
id|EN_SEL_RESEL
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_UNEXPECT_RESEL
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
l_int|0
suffix:semicolon
id|DoWaitingSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_ABORT_SENT
)paren
(brace
id|pDCB-&gt;TagMask
op_assign
l_int|0
suffix:semicolon
id|pDCB-&gt;DCBFlag
op_assign
l_int|0
suffix:semicolon
id|cnt
op_assign
id|pDCB-&gt;GoingSRBCnt
suffix:semicolon
id|pDCB-&gt;GoingSRBCnt
op_assign
l_int|0
suffix:semicolon
id|pSRB
op_assign
id|pDCB-&gt;pGoingSRB
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|psrb
op_assign
id|pSRB-&gt;pNextSRB
suffix:semicolon
id|pSRB-&gt;pNextSRB
op_assign
id|pACB-&gt;pFreeSRB
suffix:semicolon
id|pACB-&gt;pFreeSRB
op_assign
id|pSRB
suffix:semicolon
id|pSRB
op_assign
id|psrb
suffix:semicolon
)brace
id|pDCB-&gt;pGoingSRB
op_assign
l_int|0
suffix:semicolon
id|DoWaitingSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|pSRB-&gt;SRBState
op_amp
(paren
id|SRB_START_
op_plus
id|SRB_MSGOUT
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
(paren
id|SRB_DISCONNECT
op_plus
id|SRB_COMPLETED
)paren
)paren
)paren
(brace
multiline_comment|/* Selection time out */
r_if
c_cond
(paren
op_logical_neg
(paren
id|pACB-&gt;scan_devices
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_READY
suffix:semicolon
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_else
(brace
id|pSRB-&gt;TargetStatus
op_assign
id|SCSI_STAT_SEL_TIMEOUT
suffix:semicolon
r_goto
id|disc1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_DISCONNECT
)paren
(brace
id|DoWaitingSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_COMPLETED
)paren
(brace
id|disc1
suffix:colon
r_if
c_cond
(paren
id|pDCB-&gt;MaxCommand
OG
l_int|1
)paren
(brace
id|bval
op_assign
id|pSRB-&gt;TagNumber
suffix:semicolon
id|pDCB-&gt;TagMask
op_and_assign
(paren
op_complement
(paren
l_int|1
op_lshift
id|bval
)paren
)paren
suffix:semicolon
multiline_comment|/* free tag mask */
)brace
id|pDCB-&gt;pActiveSRB
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_FREE
suffix:semicolon
id|SRBdone
c_func
(paren
id|pACB
comma
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_Reselect
id|DC390_Reselect
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|PDCB
id|pDCB
comma
id|pdcb
suffix:semicolon
id|PSRB
id|pSRB
suffix:semicolon
id|USHORT
id|ioport
comma
id|wval
suffix:semicolon
id|UCHAR
id|bval
comma
id|bval1
suffix:semicolon
macro_line|#ifdef DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;RSEL,&quot;
)paren
suffix:semicolon
macro_line|#endif
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pActiveDCB
suffix:semicolon
r_if
c_cond
(paren
id|pDCB
)paren
(brace
multiline_comment|/* Arbitration lost but Reselection win */
id|pSRB
op_assign
id|pDCB-&gt;pActiveSRB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pACB-&gt;scan_devices
)paren
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_READY
suffix:semicolon
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
)brace
id|bval
op_assign
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
suffix:semicolon
multiline_comment|/* get ID */
id|bval
op_assign
id|bval
op_xor
id|pACB-&gt;HostID_Bit
suffix:semicolon
id|wval
op_assign
l_int|0
suffix:semicolon
id|bval1
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bval
op_amp
id|bval1
)paren
)paren
(brace
id|bval1
op_assign
id|bval1
op_lshift
l_int|1
suffix:semicolon
id|wval
op_increment
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
id|wval
op_or_assign
(paren
(paren
id|USHORT
)paren
id|inb
c_func
(paren
id|ioport
op_plus
id|ScsiFifo
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|8
suffix:semicolon
multiline_comment|/* get LUN */
id|pDCB
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
id|pdcb
op_assign
id|pDCB
suffix:semicolon
r_while
c_loop
(paren
id|wval
op_ne
op_star
(paren
(paren
id|PUSHORT
)paren
op_amp
id|pDCB-&gt;UnitSCSIID
)paren
)paren
(brace
id|pDCB
op_assign
id|pDCB-&gt;pNextDCB
suffix:semicolon
r_if
c_cond
(paren
id|pDCB
op_eq
id|pdcb
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
id|pACB-&gt;pActiveDCB
op_assign
id|pDCB
suffix:semicolon
r_if
c_cond
(paren
id|pDCB-&gt;SyncMode
op_amp
id|EN_TAG_QUEUING
)paren
(brace
id|pSRB
op_assign
id|pACB-&gt;pTmpSRB
suffix:semicolon
id|pDCB-&gt;pActiveSRB
op_assign
id|pSRB
suffix:semicolon
)brace
r_else
(brace
id|pSRB
op_assign
id|pDCB-&gt;pActiveSRB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pSRB
op_logical_or
op_logical_neg
(paren
id|pSRB-&gt;SRBState
op_amp
id|SRB_DISCONNECT
)paren
)paren
(brace
id|pSRB
op_assign
id|pACB-&gt;pTmpSRB
suffix:semicolon
id|pSRB-&gt;SRBState
op_assign
id|SRB_UNEXPECT_RESEL
suffix:semicolon
id|pDCB-&gt;pActiveSRB
op_assign
id|pSRB
suffix:semicolon
id|EnableMsgOut
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|pDCB-&gt;DCBFlag
op_amp
id|ABORT_DEV_
)paren
(brace
id|pSRB-&gt;SRBState
op_assign
id|SRB_ABORT_SENT
suffix:semicolon
id|EnableMsgOut
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_else
id|pSRB-&gt;SRBState
op_assign
id|SRB_DATA_XFER
suffix:semicolon
)brace
)brace
id|pSRB-&gt;ScsiPhase
op_assign
id|SCSI_NOP0
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;UnitSCSIID
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Scsi_Dest_ID
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;SyncPeriod
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Period
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;SyncOffset
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|Sync_Offset
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR1
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg1
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR3
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg3
)paren
suffix:semicolon
id|bval
op_assign
id|pDCB-&gt;CtrlR4
suffix:semicolon
multiline_comment|/* ; Glitch eater */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|CtrlReg4
)paren
suffix:semicolon
id|bval
op_assign
id|MSG_ACCEPTED_CMD
suffix:semicolon
multiline_comment|/* ;to rls the /ACK signal */
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SRBdone
id|SRBdone
c_func
(paren
id|PACB
id|pACB
comma
id|PDCB
id|pDCB
comma
id|PSRB
id|pSRB
)paren
(brace
id|PSRB
id|psrb
suffix:semicolon
id|UCHAR
id|bval
comma
id|bval1
comma
id|i
comma
id|j
comma
id|status
suffix:semicolon
id|PSCSICMD
id|pcmd
suffix:semicolon
id|PSCSI_INQDATA
id|ptr
suffix:semicolon
id|USHORT
id|disable_tag
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|PSGL
id|ptr2
suffix:semicolon
id|ULONG
id|swlval
suffix:semicolon
id|pcmd
op_assign
id|pSRB-&gt;pcmd
suffix:semicolon
id|status
op_assign
id|pSRB-&gt;TargetStatus
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SRBFlag
op_amp
id|AUTO_REQSENSE
)paren
(brace
id|pSRB-&gt;SRBFlag
op_and_assign
op_complement
id|AUTO_REQSENSE
suffix:semicolon
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
id|SCSI_STAT_CHECKCOND
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|SCSI_STAT_CHECKCOND
)paren
(brace
id|pcmd-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
r_goto
id|ckc_e
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pSRB-&gt;RetryCnt
op_eq
l_int|0
)paren
(brace
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
)paren
)paren
op_assign
id|pSRB-&gt;Segment0
(braket
l_int|0
)braket
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_assign
id|pSRB-&gt;Segment1
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSRB-&gt;TotalXferredLen
)paren
op_logical_and
(paren
id|pSRB-&gt;TotalXferredLen
op_ge
id|pcmd-&gt;underflow
)paren
)paren
(brace
id|pcmd-&gt;result
op_or_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
r_else
id|pcmd-&gt;result
op_assign
(paren
id|DRIVER_SENSE
op_lshift
l_int|24
)paren
op_or
(paren
id|DRIVER_OK
op_lshift
l_int|16
)paren
op_or
id|SCSI_STAT_CHECKCOND
suffix:semicolon
macro_line|#ifdef DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;Cmd=%2x,Result=%8x,XferL=%8x,&quot;
comma
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
comma
(paren
id|UINT
)paren
id|pcmd-&gt;result
comma
(paren
id|UINT
)paren
id|pSRB-&gt;TotalXferredLen
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|ckc_e
suffix:semicolon
)brace
r_else
(brace
id|pSRB-&gt;RetryCnt
op_decrement
suffix:semicolon
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
)paren
)paren
op_assign
id|pSRB-&gt;Segment0
(braket
l_int|0
)braket
suffix:semicolon
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|pSRB-&gt;Segment0
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|TEST_UNIT_READY
)paren
(brace
id|pcmd-&gt;result
op_assign
(paren
id|DRIVER_SENSE
op_lshift
l_int|24
)paren
op_or
(paren
id|DRIVER_OK
op_lshift
l_int|16
)paren
op_or
id|SCSI_STAT_CHECKCOND
suffix:semicolon
r_goto
id|ckc_e
suffix:semicolon
)brace
id|pcmd-&gt;result
op_or_assign
(paren
id|DRIVER_SENSE
op_lshift
l_int|24
)paren
suffix:semicolon
id|pSRB-&gt;SGcount
op_assign
(paren
id|UCHAR
)paren
id|pSRB-&gt;Segment1
(braket
l_int|0
)braket
suffix:semicolon
id|pSRB-&gt;ScsiCmdLen
op_assign
(paren
id|UCHAR
)paren
(paren
id|pSRB-&gt;Segment1
(braket
l_int|0
)braket
op_rshift
l_int|8
)paren
suffix:semicolon
id|pSRB-&gt;SGIndex
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pcmd-&gt;use_sg
)paren
(brace
id|pSRB-&gt;pSegmentList
op_assign
(paren
id|PSGL
)paren
id|pcmd-&gt;request_buffer
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcmd-&gt;request_buffer
)paren
(brace
id|pSRB-&gt;pSegmentList
op_assign
(paren
id|PSGL
)paren
op_amp
id|pSRB-&gt;Segmentx
suffix:semicolon
id|pSRB-&gt;Segmentx.address
op_assign
(paren
id|PUCHAR
)paren
id|pcmd-&gt;request_buffer
suffix:semicolon
id|pSRB-&gt;Segmentx.length
op_assign
id|pcmd-&gt;request_bufflen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DC390_StartSCSI
c_func
(paren
id|pACB
comma
id|pDCB
comma
id|pSRB
)paren
)paren
(brace
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
id|SCSI_STAT_CHECKCOND
)paren
(brace
r_if
c_cond
(paren
(paren
id|pSRB-&gt;SGIndex
OL
id|pSRB-&gt;SGcount
)paren
op_logical_and
(paren
id|pSRB-&gt;SGcount
)paren
op_logical_and
(paren
id|pSRB-&gt;SGToBeXferLen
)paren
)paren
(brace
id|bval
op_assign
id|pSRB-&gt;SGcount
suffix:semicolon
id|swlval
op_assign
l_int|0
suffix:semicolon
id|ptr2
op_assign
id|pSRB-&gt;pSegmentList
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|pSRB-&gt;SGIndex
suffix:semicolon
id|i
OL
id|bval
suffix:semicolon
id|i
op_increment
)paren
(brace
id|swlval
op_add_assign
id|ptr2-&gt;length
suffix:semicolon
id|ptr2
op_increment
suffix:semicolon
)brace
macro_line|#ifdef&t;DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;XferredLen=%8x,NotXferLen=%8x,&quot;
comma
(paren
id|UINT
)paren
id|pSRB-&gt;TotalXferredLen
comma
(paren
id|UINT
)paren
id|swlval
)paren
suffix:semicolon
macro_line|#endif
)brace
id|RequestSense
c_func
(paren
id|pACB
comma
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_eq
id|SCSI_STAT_QUEUEFULL
)paren
(brace
id|bval
op_assign
(paren
id|UCHAR
)paren
id|pDCB-&gt;GoingSRBCnt
suffix:semicolon
id|bval
op_decrement
suffix:semicolon
id|pDCB-&gt;MaxCommand
op_assign
id|bval
suffix:semicolon
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_eq
id|SCSI_STAT_SEL_TIMEOUT
)paren
(brace
id|pSRB-&gt;AdaptStatus
op_assign
id|H_SEL_TIMEOUT
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|pcmd-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;RetryCnt
)paren
(brace
id|pSRB-&gt;RetryCnt
op_decrement
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;SGIndex
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pcmd-&gt;use_sg
)paren
(brace
id|pSRB-&gt;pSegmentList
op_assign
(paren
id|PSGL
)paren
id|pcmd-&gt;request_buffer
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcmd-&gt;request_buffer
)paren
(brace
id|pSRB-&gt;pSegmentList
op_assign
(paren
id|PSGL
)paren
op_amp
id|pSRB-&gt;Segmentx
suffix:semicolon
id|pSRB-&gt;Segmentx.address
op_assign
(paren
id|PUCHAR
)paren
id|pcmd-&gt;request_buffer
suffix:semicolon
id|pSRB-&gt;Segmentx.length
op_assign
id|pcmd-&gt;request_bufflen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DC390_StartSCSI
c_func
(paren
id|pACB
comma
id|pDCB
comma
id|pSRB
)paren
)paren
(brace
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_else
(brace
id|pcmd-&gt;result
op_or_assign
(paren
id|DID_ERROR
op_lshift
l_int|16
)paren
op_or
(paren
id|ULONG
)paren
(paren
id|pSRB-&gt;EndMessage
op_lshift
l_int|8
)paren
op_or
(paren
id|ULONG
)paren
id|status
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|status
op_assign
id|pSRB-&gt;AdaptStatus
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|H_OVER_UNDER_RUN
)paren
(brace
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|pcmd-&gt;result
op_or_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|pSRB-&gt;EndMessage
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;SRBStatus
op_amp
id|PARITY_ERROR
)paren
(brace
id|pcmd-&gt;result
op_or_assign
(paren
id|DID_PARITY
op_lshift
l_int|16
)paren
op_or
(paren
id|pSRB-&gt;EndMessage
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* No error */
(brace
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|pcmd-&gt;result
op_or_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
)brace
id|ckc_e
suffix:colon
r_if
c_cond
(paren
id|pACB-&gt;scan_devices
)paren
(brace
r_if
c_cond
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|TEST_UNIT_READY
)paren
(brace
r_if
c_cond
(paren
id|pcmd-&gt;result
op_ne
(paren
id|DID_OK
op_lshift
l_int|16
)paren
)paren
(brace
r_if
c_cond
(paren
id|pcmd-&gt;result
op_amp
id|SCSI_STAT_CHECKCOND
)paren
(brace
r_goto
id|RTN_OK
suffix:semicolon
)brace
r_else
(brace
id|pACB-&gt;DCBmap
(braket
id|pcmd-&gt;target
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pcmd-&gt;lun
)paren
suffix:semicolon
id|pPrevDCB-&gt;pNextDCB
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pcmd-&gt;target
op_eq
id|pACB-&gt;max_id
)paren
op_logical_and
(paren
(paren
id|pcmd-&gt;lun
op_eq
l_int|0
)paren
op_logical_or
(paren
id|pcmd-&gt;lun
op_eq
id|pACB-&gt;max_lun
)paren
)paren
)paren
(brace
id|pACB-&gt;scan_devices
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|RTN_OK
suffix:colon
id|pPrevDCB-&gt;pNextDCB
op_assign
id|pDCB
suffix:semicolon
id|pDCB-&gt;pNextDCB
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pcmd-&gt;target
op_eq
id|pACB-&gt;max_id
)paren
op_logical_and
(paren
id|pcmd-&gt;lun
op_eq
id|pACB-&gt;max_lun
)paren
)paren
(brace
id|pACB-&gt;scan_devices
op_assign
id|END_SCAN
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
op_eq
id|INQUIRY
)paren
(brace
r_if
c_cond
(paren
(paren
id|pcmd-&gt;target
op_eq
id|pACB-&gt;max_id
)paren
op_logical_and
(paren
id|pcmd-&gt;lun
op_eq
id|pACB-&gt;max_lun
)paren
)paren
(brace
id|pACB-&gt;scan_devices
op_assign
l_int|0
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|PSCSI_INQDATA
)paren
(paren
id|pcmd-&gt;request_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmd-&gt;use_sg
)paren
(brace
id|ptr
op_assign
(paren
id|PSCSI_INQDATA
)paren
(paren
(paren
(paren
id|PSGL
)paren
id|ptr
)paren
op_member_access_from_pointer
id|address
)paren
suffix:semicolon
)brace
id|bval1
op_assign
id|ptr-&gt;DevType
op_amp
id|SCSI_DEVTYPE
suffix:semicolon
r_if
c_cond
(paren
id|bval1
op_eq
id|SCSI_NODEV
)paren
(brace
id|pACB-&gt;DCBmap
(braket
id|pcmd-&gt;target
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pcmd-&gt;lun
)paren
suffix:semicolon
id|pPrevDCB-&gt;pNextDCB
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
)brace
r_else
(brace
id|pACB-&gt;DeviceCnt
op_increment
suffix:semicolon
id|pPrevDCB
op_assign
id|pDCB
suffix:semicolon
id|pACB-&gt;pDCB_free
op_assign
(paren
id|PDCB
)paren
(paren
(paren
id|ULONG
)paren
(paren
id|pACB-&gt;pDCB_free
)paren
op_plus
r_sizeof
(paren
id|DC390_DCB
)paren
)paren
suffix:semicolon
id|pDCB-&gt;DevType
op_assign
id|bval1
suffix:semicolon
r_if
c_cond
(paren
id|bval1
op_eq
id|TYPE_DISK
op_logical_or
id|bval1
op_eq
id|TYPE_MOD
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
(paren
id|ptr-&gt;Vers
op_amp
l_int|0x07
)paren
op_ge
l_int|2
)paren
op_logical_or
(paren
(paren
id|ptr-&gt;RDF
op_amp
l_int|0x0F
)paren
op_eq
l_int|2
)paren
)paren
op_logical_and
(paren
id|ptr-&gt;Flags
op_amp
id|SCSI_INQ_CMDQUEUE
)paren
op_logical_and
(paren
id|pDCB-&gt;DevMode
op_amp
id|TAG_QUEUING_
)paren
op_logical_and
(paren
id|pDCB-&gt;DevMode
op_amp
id|EN_DISCONNECT_
)paren
)paren
(brace
id|disable_tag
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BADDEVCNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|28
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|PUCHAR
)paren
id|ptr
)paren
(braket
l_int|8
op_plus
id|j
)braket
op_ne
id|baddevname1
(braket
id|i
)braket
(braket
id|j
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|28
)paren
(brace
id|disable_tag
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|disable_tag
)paren
(brace
id|pDCB-&gt;MaxCommand
op_assign
id|pACB-&gt;TagMaxNum
suffix:semicolon
id|pDCB-&gt;SyncMode
op_or_assign
id|EN_TAG_QUEUING
suffix:semicolon
id|pDCB-&gt;TagMask
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|pDCB-&gt;SyncMode
op_or_assign
id|EN_ATN_STOP
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*  ReleaseSRB( pDCB, pSRB ); */
r_if
c_cond
(paren
id|pSRB
op_eq
id|pDCB-&gt;pGoingSRB
)paren
(brace
id|pDCB-&gt;pGoingSRB
op_assign
id|pSRB-&gt;pNextSRB
suffix:semicolon
)brace
r_else
(brace
id|psrb
op_assign
id|pDCB-&gt;pGoingSRB
suffix:semicolon
r_while
c_loop
(paren
id|psrb-&gt;pNextSRB
op_ne
id|pSRB
)paren
(brace
id|psrb
op_assign
id|psrb-&gt;pNextSRB
suffix:semicolon
)brace
id|psrb-&gt;pNextSRB
op_assign
id|pSRB-&gt;pNextSRB
suffix:semicolon
r_if
c_cond
(paren
id|pSRB
op_eq
id|pDCB-&gt;pGoingLast
)paren
(brace
id|pDCB-&gt;pGoingLast
op_assign
id|psrb
suffix:semicolon
)brace
)brace
id|pSRB-&gt;pNextSRB
op_assign
id|pACB-&gt;pFreeSRB
suffix:semicolon
id|pACB-&gt;pFreeSRB
op_assign
id|pSRB
suffix:semicolon
id|pDCB-&gt;GoingSRBCnt
op_decrement
suffix:semicolon
id|DoWaitingSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/*  Notify cmd done */
id|pcmd
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|pcmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pDCB-&gt;QIORBCnt
)paren
(brace
id|DoNextCmd
c_func
(paren
id|pACB
comma
id|pDCB
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|DoingSRB_Done
id|DoingSRB_Done
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|PDCB
id|pDCB
comma
id|pdcb
suffix:semicolon
id|PSRB
id|psrb
comma
id|psrb2
suffix:semicolon
id|USHORT
id|cnt
comma
id|i
suffix:semicolon
id|PSCSICMD
id|pcmd
suffix:semicolon
id|pDCB
op_assign
id|pACB-&gt;pLinkDCB
suffix:semicolon
id|pdcb
op_assign
id|pDCB
suffix:semicolon
r_do
(brace
id|cnt
op_assign
id|pdcb-&gt;GoingSRBCnt
suffix:semicolon
id|psrb
op_assign
id|pdcb-&gt;pGoingSRB
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|psrb2
op_assign
id|psrb-&gt;pNextSRB
suffix:semicolon
id|pcmd
op_assign
id|psrb-&gt;pcmd
suffix:semicolon
id|pcmd-&gt;result
op_assign
id|DID_RESET
op_lshift
l_int|16
suffix:semicolon
multiline_comment|/*&t;    ReleaseSRB( pDCB, pSRB ); */
id|psrb-&gt;pNextSRB
op_assign
id|pACB-&gt;pFreeSRB
suffix:semicolon
id|pACB-&gt;pFreeSRB
op_assign
id|psrb
suffix:semicolon
id|pcmd
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|pcmd
)paren
suffix:semicolon
id|psrb
op_assign
id|psrb2
suffix:semicolon
)brace
id|pdcb-&gt;GoingSRBCnt
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|pdcb-&gt;pGoingSRB
op_assign
l_int|NULL
suffix:semicolon
id|pdcb-&gt;TagMask
op_assign
l_int|0
suffix:semicolon
id|pdcb
op_assign
id|pdcb-&gt;pNextDCB
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pdcb
op_ne
id|pDCB
)paren
(brace
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|DC390_ResetSCSIBus
id|DC390_ResetSCSIBus
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|USHORT
id|ioport
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|pACB-&gt;ACBFlag
op_or_assign
id|RESET_DEV
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|DMA_IDLE_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
id|bval
op_assign
id|RST_SCSI_BUS_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_ScsiRstDetect
id|DC390_ScsiRstDetect
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|ULONG
id|wlval
comma
id|flags
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
macro_line|#ifdef DC390_DEBUG0
id|printk
c_func
(paren
l_string|&quot;RST_DETEC&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* delay a second */
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|DMA_IDLE_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|DMA_Cmd
)paren
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pACB-&gt;ACBFlag
op_amp
id|RESET_DEV
)paren
(brace
id|pACB-&gt;ACBFlag
op_or_assign
id|RESET_DONE
suffix:semicolon
)brace
r_else
(brace
id|pACB-&gt;ACBFlag
op_or_assign
id|RESET_DETECT
suffix:semicolon
id|ResetDevParam
c_func
(paren
id|pACB
)paren
suffix:semicolon
multiline_comment|/*&t;DoingSRB_Done( pACB ); ???? */
id|RecoverSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
id|pACB-&gt;pActiveDCB
op_assign
l_int|NULL
suffix:semicolon
id|pACB-&gt;ACBFlag
op_assign
l_int|0
suffix:semicolon
id|DoWaitingSRB
c_func
(paren
id|pACB
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|RequestSense
id|RequestSense
c_func
(paren
id|PACB
id|pACB
comma
id|PDCB
id|pDCB
comma
id|PSRB
id|pSRB
)paren
(brace
id|PSCSICMD
id|pcmd
suffix:semicolon
id|pSRB-&gt;SRBFlag
op_or_assign
id|AUTO_REQSENSE
suffix:semicolon
id|pSRB-&gt;Segment0
(braket
l_int|0
)braket
op_assign
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|pSRB-&gt;Segment0
(braket
l_int|1
)braket
op_assign
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|4
)braket
)paren
)paren
suffix:semicolon
id|pSRB-&gt;Segment1
(braket
l_int|0
)braket
op_assign
(paren
id|ULONG
)paren
(paren
(paren
id|pSRB-&gt;ScsiCmdLen
op_lshift
l_int|8
)paren
op_plus
id|pSRB-&gt;SGcount
)paren
suffix:semicolon
id|pSRB-&gt;Segment1
(braket
l_int|1
)braket
op_assign
id|pSRB-&gt;TotalXferredLen
suffix:semicolon
id|pSRB-&gt;AdaptStatus
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|pcmd
op_assign
id|pSRB-&gt;pcmd
suffix:semicolon
id|pSRB-&gt;Segmentx.address
op_assign
(paren
id|PUCHAR
)paren
op_amp
(paren
id|pcmd-&gt;sense_buffer
)paren
suffix:semicolon
id|pSRB-&gt;Segmentx.length
op_assign
r_sizeof
(paren
id|pcmd-&gt;sense_buffer
)paren
suffix:semicolon
id|pSRB-&gt;pSegmentList
op_assign
op_amp
id|pSRB-&gt;Segmentx
suffix:semicolon
id|pSRB-&gt;SGcount
op_assign
l_int|1
suffix:semicolon
id|pSRB-&gt;SGIndex
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
id|PULONG
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|0
)braket
)paren
)paren
op_assign
l_int|0x00000003
suffix:semicolon
id|pSRB-&gt;CmdBlock
(braket
l_int|1
)braket
op_assign
id|pDCB-&gt;IdentifyMsg
op_lshift
l_int|5
suffix:semicolon
op_star
(paren
(paren
id|PUSHORT
)paren
op_amp
(paren
id|pSRB-&gt;CmdBlock
(braket
l_int|4
)braket
)paren
)paren
op_assign
r_sizeof
(paren
id|pcmd-&gt;sense_buffer
)paren
suffix:semicolon
id|pSRB-&gt;ScsiCmdLen
op_assign
l_int|6
suffix:semicolon
id|pSRB-&gt;TotalXferredLen
op_assign
l_int|0
suffix:semicolon
id|pSRB-&gt;SGToBeXferLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|DC390_StartSCSI
c_func
(paren
id|pACB
comma
id|pDCB
comma
id|pSRB
)paren
)paren
(brace
id|RewaitSRB
c_func
(paren
id|pDCB
comma
id|pSRB
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|EnableMsgOut2
id|EnableMsgOut2
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
)paren
(brace
id|USHORT
id|ioport
suffix:semicolon
id|UCHAR
id|bval
suffix:semicolon
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|pSRB-&gt;MsgCnt
op_assign
l_int|1
suffix:semicolon
id|bval
op_assign
id|SET_ATN_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ioport
op_plus
id|ScsiCmd
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|EnableMsgOut
id|EnableMsgOut
c_func
(paren
id|PACB
id|pACB
comma
id|PSRB
id|pSRB
)paren
(brace
id|pSRB-&gt;MsgOutBuf
(braket
l_int|0
)braket
op_assign
id|MSG_ABORT
suffix:semicolon
id|EnableMsgOut2
c_func
(paren
id|pACB
comma
id|pSRB
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|DC390_InvalidCmd
id|DC390_InvalidCmd
c_func
(paren
id|PACB
id|pACB
)paren
(brace
id|UCHAR
id|bval
suffix:semicolon
id|USHORT
id|ioport
suffix:semicolon
id|PSRB
id|pSRB
suffix:semicolon
id|pSRB
op_assign
id|pACB-&gt;pActiveDCB-&gt;pActiveSRB
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;SRBState
op_amp
(paren
id|SRB_START_
op_plus
id|SRB_MSGOUT
)paren
)paren
(brace
id|ioport
op_assign
id|pACB-&gt;IOPortBase
suffix:semicolon
id|bval
op_assign
id|CLEAR_FIFO_CMD
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
(paren
id|ioport
op_plus
id|ScsiCmd
)paren
)paren
suffix:semicolon
)brace
)brace
eof
