multiline_comment|/* $Id: atp870u.c,v 1.0 1997/05/07 15:22:00 root Exp root $&n; *  linux/kernel/atp870u.c&n; *&n; *  Copyright (C) 1997&t;Wu Ching Chen&n; *  2.1.x update (C) 1998  Krzysztof G. Baranowski&n; *&n; * Marcelo Tosatti &lt;marcelo@conectiva.com.br&gt; : SMP fixes&n; *&n; * Wu Ching Chen : NULL pointer fixes  2000/06/02&n; *&t;&t;   support atp876 chip&n; *&t;&t;   enable 32 bit fifo transfer&n; *&t;&t;   support cdrom &amp; remove device run ultra speed&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;atp870u.h&quot;
macro_line|#include&lt;linux/stat.h&gt;
r_void
id|mydlyu
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; *   static const char RCSid[] = &quot;$Header: /usr/src/linux/kernel/blk_drv/scsi/RCS/atp870u.c,v 1.0 1997/05/07 15:22:00 root Exp root $&quot;;&n; */
DECL|variable|admaxu
r_static
r_int
r_char
id|admaxu
op_assign
l_int|1
suffix:semicolon
DECL|variable|sync_idu
r_static
r_int
r_int
r_int
id|sync_idu
suffix:semicolon
DECL|variable|irqnumu
r_static
r_int
r_int
id|irqnumu
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|struct|atp_unit
r_struct
id|atp_unit
(brace
DECL|member|ioport
r_int
r_int
id|ioport
suffix:semicolon
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
DECL|member|pciport
r_int
r_int
id|pciport
suffix:semicolon
DECL|member|last_cmd
r_int
r_char
id|last_cmd
suffix:semicolon
DECL|member|in_snd
r_int
r_char
id|in_snd
suffix:semicolon
DECL|member|in_int
r_int
r_char
id|in_int
suffix:semicolon
DECL|member|quhdu
r_int
r_char
id|quhdu
suffix:semicolon
DECL|member|quendu
r_int
r_char
id|quendu
suffix:semicolon
DECL|member|scam_on
r_int
r_char
id|scam_on
suffix:semicolon
DECL|member|global_map
r_int
r_char
id|global_map
suffix:semicolon
DECL|member|chip_veru
r_int
r_char
id|chip_veru
suffix:semicolon
DECL|member|host_idu
r_int
r_char
id|host_idu
suffix:semicolon
DECL|member|working
r_int
id|working
suffix:semicolon
DECL|member|wide_idu
r_int
r_int
id|wide_idu
suffix:semicolon
DECL|member|active_idu
r_int
r_int
id|active_idu
suffix:semicolon
DECL|member|ultra_map
r_int
r_int
id|ultra_map
suffix:semicolon
DECL|member|ata_cdbu
r_int
r_char
id|ata_cdbu
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|querequ
id|Scsi_Cmnd
op_star
id|querequ
(braket
id|qcnt
)braket
suffix:semicolon
DECL|struct|atp_id
r_struct
id|atp_id
(brace
DECL|member|dirctu
r_int
r_char
id|dirctu
suffix:semicolon
DECL|member|devspu
r_int
r_char
id|devspu
suffix:semicolon
DECL|member|devtypeu
r_int
r_char
id|devtypeu
suffix:semicolon
DECL|member|prdaddru
r_int
r_int
id|prdaddru
suffix:semicolon
DECL|member|tran_lenu
r_int
r_int
id|tran_lenu
suffix:semicolon
DECL|member|last_lenu
r_int
r_int
id|last_lenu
suffix:semicolon
DECL|member|prd_posu
r_int
r_char
op_star
id|prd_posu
suffix:semicolon
DECL|member|prd_tableu
r_int
r_char
op_star
id|prd_tableu
suffix:semicolon
DECL|member|curr_req
id|Scsi_Cmnd
op_star
id|curr_req
suffix:semicolon
DECL|member|id
)brace
id|id
(braket
l_int|16
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|atp_host
r_static
r_struct
id|Scsi_Host
op_star
id|atp_host
(braket
l_int|2
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|atp_unit
r_static
r_struct
id|atp_unit
id|atp_unit
(braket
l_int|2
)braket
suffix:semicolon
DECL|function|atp870u_intr_handle
r_static
r_void
id|atp870u_intr_handle
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
r_int
id|tmpcip
comma
id|id
suffix:semicolon
r_int
r_char
id|i
comma
id|j
comma
id|h
comma
id|target_id
comma
id|lun
suffix:semicolon
r_int
r_char
op_star
id|prd
suffix:semicolon
id|Scsi_Cmnd
op_star
id|workrequ
suffix:semicolon
r_int
r_int
id|workportu
comma
id|tmport
suffix:semicolon
r_int
r_int
id|adrcntu
comma
id|k
suffix:semicolon
r_int
id|errstus
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
l_int|2
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
id|irqnumu
(braket
id|h
)braket
)paren
(brace
r_goto
id|irq_numok
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
id|irq_numok
suffix:colon
id|dev-&gt;in_int
op_assign
l_int|1
suffix:semicolon
id|workportu
op_assign
id|dev-&gt;ioport
suffix:semicolon
id|tmport
op_assign
id|workportu
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;working
op_ne
l_int|0
)paren
(brace
id|tmport
op_add_assign
l_int|0x1f
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmpcip
op_assign
id|dev-&gt;pciport
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmpcip
)paren
op_amp
l_int|0x08
)paren
op_ne
l_int|0
)paren
(brace
id|tmpcip
op_add_assign
l_int|0x2
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|1000
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmpcip
)paren
op_amp
l_int|0x08
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|stop_dma
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmpcip
)paren
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|stop_dma
suffix:semicolon
)brace
)brace
)brace
id|stop_dma
suffix:colon
id|tmpcip
op_assign
id|dev-&gt;pciport
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmpcip
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x40
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;last_cmd
op_amp
l_int|0x40
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;last_cmd
op_assign
l_int|0xff
suffix:semicolon
)brace
)brace
r_else
id|dev-&gt;last_cmd
op_or_assign
l_int|0x40
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x02
suffix:semicolon
id|target_id
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Remap wide devices onto id numbers&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|target_id
op_amp
l_int|0x40
)paren
op_ne
l_int|0
)paren
(brace
id|target_id
op_assign
(paren
id|target_id
op_amp
l_int|0x07
)paren
op_or
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|target_id
op_and_assign
l_int|0x07
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x85
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;Flip wide&n;&t;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;wide_idu
op_ne
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1b
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0x01
)paren
(brace
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t;&t; *&t;Issue more commands&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
id|dev-&gt;quhdu
op_ne
id|dev-&gt;quendu
)paren
op_logical_or
(paren
id|dev-&gt;last_cmd
op_ne
l_int|0xff
)paren
)paren
op_logical_and
(paren
id|dev-&gt;in_snd
op_eq
l_int|0
)paren
)paren
(brace
id|send_s870
c_func
(paren
id|h
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; *&t;Done&n;&t;&t;&t; */
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x21
)paren
(brace
id|tmport
op_sub_assign
l_int|0x05
suffix:semicolon
id|adrcntu
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|2
)braket
op_assign
id|inb
c_func
(paren
id|tmport
op_increment
)paren
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|tmport
op_increment
)paren
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|0
)braket
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|k
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
suffix:semicolon
id|k
op_sub_assign
id|adrcntu
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|tran_lenu
op_assign
id|k
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
op_assign
id|adrcntu
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x41
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x08
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_eq
l_int|0x80
)paren
op_logical_or
(paren
id|i
op_eq
l_int|0x8f
)paren
)paren
(brace
id|lun
op_assign
l_int|0
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x07
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x44
op_logical_or
id|i
op_eq
l_int|0x80
)paren
(brace
id|tmport
op_add_assign
l_int|0x0d
suffix:semicolon
id|lun
op_assign
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x07
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x41
)paren
(brace
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|adrcntu
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|2
)braket
op_assign
id|inb
c_func
(paren
id|tmport
op_increment
)paren
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|tmport
op_increment
)paren
suffix:semicolon
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|adrcntu
)paren
(braket
l_int|0
)braket
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|k
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
suffix:semicolon
id|k
op_sub_assign
id|adrcntu
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|tran_lenu
op_assign
id|k
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
op_assign
id|adrcntu
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
l_int|0x46
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0x00
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x45
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
id|target_id
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Remap wide identifiers&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|target_id
op_amp
l_int|0x10
)paren
op_ne
l_int|0
)paren
(brace
id|target_id
op_assign
(paren
id|target_id
op_amp
l_int|0x07
)paren
op_or
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|target_id
op_and_assign
l_int|0x07
suffix:semicolon
)brace
id|workrequ
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|curr_req
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x0f
suffix:semicolon
id|outb
c_func
(paren
id|lun
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|adrcntu
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|tran_lenu
suffix:semicolon
id|k
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|k
)paren
(braket
l_int|2
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|k
)paren
(braket
l_int|1
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|k
)paren
(braket
l_int|0
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
multiline_comment|/* Remap wide */
id|j
op_assign
id|target_id
suffix:semicolon
r_if
c_cond
(paren
id|target_id
OG
l_int|7
)paren
(brace
id|j
op_assign
(paren
id|j
op_amp
l_int|0x07
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
multiline_comment|/* Add direction */
id|j
op_or_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
suffix:semicolon
id|outb
c_func
(paren
id|j
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
comma
id|tmport
)paren
suffix:semicolon
multiline_comment|/* enable 32 bit fifo transfer */
id|tmport
op_assign
id|workportu
op_plus
l_int|0x3a
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x08
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x28
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x0a
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x2a
)paren
)paren
(brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xf3
)paren
op_or
l_int|0x08
)paren
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xf3
)paren
comma
id|tmport
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1b
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|id
op_assign
l_int|1
suffix:semicolon
id|id
op_assign
id|id
op_lshift
id|target_id
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Is this a wide device&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|id
op_amp
id|dev-&gt;wide_idu
)paren
op_ne
l_int|0
)paren
(brace
id|j
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
id|j
)paren
(brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|last_lenu
op_eq
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|prd
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_posu
suffix:semicolon
r_while
c_loop
(paren
id|adrcntu
op_ne
l_int|0
)paren
(brace
id|id
op_assign
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
l_int|0
)paren
(brace
id|k
op_assign
l_int|0x10000
suffix:semicolon
)brace
r_else
(brace
id|k
op_assign
id|id
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
OG
id|adrcntu
)paren
(brace
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
l_int|2
)braket
op_assign
(paren
r_int
r_int
r_int
)paren
(paren
id|k
op_minus
id|adrcntu
)paren
suffix:semicolon
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
l_int|0
)braket
op_add_assign
id|adrcntu
suffix:semicolon
id|adrcntu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_posu
op_assign
id|prd
suffix:semicolon
)brace
r_else
(brace
id|adrcntu
op_sub_assign
id|k
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
op_add_assign
l_int|0x08
suffix:semicolon
id|prd
op_add_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|adrcntu
op_eq
l_int|0
)paren
(brace
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_posu
op_assign
id|prd
suffix:semicolon
)brace
)brace
)brace
id|tmpcip
op_assign
id|dev-&gt;pciport
op_plus
l_int|0x04
suffix:semicolon
id|outl
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_sub_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
id|tmpcip
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_sub_assign
l_int|0x02
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x18
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Check transfer direction&n;&t;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_ne
l_int|0
)paren
(brace
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmpcip
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x09
comma
id|tmpcip
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *&t;Current scsi request on this target&n;&t;&t; */
id|workrequ
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|curr_req
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0x42
)paren
(brace
id|errstus
op_assign
l_int|0x02
suffix:semicolon
id|workrequ-&gt;result
op_assign
id|errstus
suffix:semicolon
r_goto
id|go_42
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x16
)paren
(brace
id|errstus
op_assign
l_int|0
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|errstus
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|workrequ-&gt;result
op_assign
id|errstus
suffix:semicolon
id|go_42
suffix:colon
multiline_comment|/*&n;&t;&t;&t; *&t;Complete the command&n;&t;&t;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
(paren
op_star
id|workrequ-&gt;scsi_done
)paren
(paren
id|workrequ
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|io_request_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Clear it off the queue&n;&t;&t;&t; */
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|curr_req
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;working
op_decrement
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Take it back wide&n;&t;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;wide_idu
op_ne
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1b
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0x01
)paren
(brace
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t;&t; *&t;If there is stuff to send and nothing going then send it&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
id|dev-&gt;last_cmd
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|dev-&gt;quhdu
op_ne
id|dev-&gt;quendu
)paren
)paren
op_logical_and
(paren
id|dev-&gt;in_snd
op_eq
l_int|0
)paren
)paren
(brace
id|send_s870
c_func
(paren
id|h
)paren
suffix:semicolon
)brace
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x4f
)paren
(brace
id|i
op_assign
l_int|0x89
suffix:semicolon
)brace
id|i
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0x09
)paren
(brace
id|tmpcip
op_assign
id|tmpcip
op_plus
l_int|4
suffix:semicolon
id|outl
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
id|tmpcip
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x41
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0x00
suffix:semicolon
id|tmport
op_add_assign
l_int|0x08
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x09
comma
id|tmpcip
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x08
)paren
(brace
id|tmpcip
op_assign
id|tmpcip
op_plus
l_int|4
suffix:semicolon
id|outl
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
id|tmpcip
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x41
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x05
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_or
l_int|0x20
)paren
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0x20
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmpcip
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmport
op_sub_assign
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0x0a
)paren
(brace
id|outb
c_func
(paren
l_int|0x30
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
l_int|0x46
comma
id|tmport
)paren
suffix:semicolon
)brace
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0x00
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
singleline_comment|//&t;&t;tmport = workportu + 0x17;
singleline_comment|//&t;&t;inb(tmport);
singleline_comment|//&t;&t;dev-&gt;working = 0;
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|function|atp870u_queuecommand
r_int
id|atp870u_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|req_p
comma
r_void
(paren
op_star
id|done
)paren
(paren
id|Scsi_Cmnd
op_star
)paren
)paren
(brace
r_int
r_char
id|i
comma
id|h
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
r_int
id|m
suffix:semicolon
r_int
r_int
id|tmport
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|admaxu
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|req_p-&gt;host
op_eq
id|atp_host
(braket
id|h
)braket
)paren
(brace
r_goto
id|host_ok
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|host_ok
suffix:colon
r_if
c_cond
(paren
id|req_p-&gt;channel
op_ne
l_int|0
)paren
(brace
id|req_p-&gt;result
op_assign
l_int|0x00040000
suffix:semicolon
id|done
c_func
(paren
id|req_p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|h
)braket
suffix:semicolon
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_assign
id|m
op_lshift
id|req_p-&gt;target
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Fake a timeout for missing targets&n;&t; */
r_if
c_cond
(paren
(paren
id|m
op_amp
id|dev-&gt;active_idu
)paren
op_eq
l_int|0
)paren
(brace
id|req_p-&gt;result
op_assign
l_int|0x00040000
suffix:semicolon
id|done
c_func
(paren
id|req_p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|done
)paren
(brace
id|req_p-&gt;scsi_done
op_assign
id|done
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;atp870u_queuecommand: done can&squot;t be NULL&bslash;n&quot;
)paren
suffix:semicolon
id|req_p-&gt;result
op_assign
l_int|0
suffix:semicolon
id|done
c_func
(paren
id|req_p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Count new command&n;&t; */
id|dev-&gt;quendu
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;quendu
op_ge
id|qcnt
)paren
(brace
id|dev-&gt;quendu
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Check queue state&n;&t; */
id|wait_que_empty
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;quhdu
op_eq
id|dev-&gt;quendu
)paren
(brace
r_goto
id|wait_que_empty
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;querequ
(braket
id|dev-&gt;quendu
)braket
op_assign
id|req_p
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;quendu
op_eq
l_int|0
)paren
(brace
id|i
op_assign
id|qcnt
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
id|dev-&gt;quendu
op_minus
l_int|1
suffix:semicolon
)brace
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x1c
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dev-&gt;in_int
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dev-&gt;in_snd
op_eq
l_int|0
)paren
)paren
(brace
id|send_s870
c_func
(paren
id|h
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mydlyu
r_void
id|mydlyu
c_func
(paren
r_int
r_int
id|dlycnt
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dlycnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|inb
c_func
(paren
l_int|0x80
)paren
suffix:semicolon
)brace
)brace
DECL|function|send_s870
r_void
id|send_s870
c_func
(paren
r_int
r_char
id|h
)paren
(brace
r_int
r_int
id|tmport
suffix:semicolon
id|Scsi_Cmnd
op_star
id|workrequ
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
r_char
id|j
comma
id|target_id
suffix:semicolon
r_int
r_char
op_star
id|prd
suffix:semicolon
r_int
r_int
r_int
id|tmpcip
comma
id|w
suffix:semicolon
r_int
r_int
id|l
comma
id|bttl
suffix:semicolon
r_int
r_int
id|workportu
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sgpnt
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|h
)braket
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;in_snd
op_ne
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dev-&gt;in_snd
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;last_cmd
op_ne
l_int|0xff
)paren
op_logical_and
(paren
(paren
id|dev-&gt;last_cmd
op_amp
l_int|0x40
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|dev-&gt;last_cmd
op_and_assign
l_int|0x0f
suffix:semicolon
id|workrequ
op_assign
id|dev-&gt;id
(braket
id|dev-&gt;last_cmd
)braket
dot
id|curr_req
suffix:semicolon
r_if
c_cond
(paren
id|workrequ
op_ne
l_int|NULL
)paren
multiline_comment|/* check NULL pointer */
(brace
r_goto
id|cmd_subp
suffix:semicolon
)brace
id|dev-&gt;last_cmd
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;quhdu
op_eq
id|dev-&gt;quendu
)paren
(brace
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dev-&gt;working
op_increment
suffix:semicolon
id|j
op_assign
id|dev-&gt;quhdu
suffix:semicolon
id|dev-&gt;quhdu
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;quhdu
op_ge
id|qcnt
)paren
(brace
id|dev-&gt;quhdu
op_assign
l_int|0
suffix:semicolon
)brace
id|workrequ
op_assign
id|dev-&gt;querequ
(braket
id|dev-&gt;quhdu
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;id
(braket
id|workrequ-&gt;target
)braket
dot
id|curr_req
op_eq
l_int|0
)paren
(brace
id|dev-&gt;id
(braket
id|workrequ-&gt;target
)braket
dot
id|curr_req
op_assign
id|workrequ
suffix:semicolon
id|dev-&gt;last_cmd
op_assign
id|workrequ-&gt;target
suffix:semicolon
r_goto
id|cmd_subp
suffix:semicolon
)brace
id|dev-&gt;quhdu
op_assign
id|j
suffix:semicolon
id|dev-&gt;working
op_decrement
suffix:semicolon
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
id|cmd_subp
suffix:colon
id|workportu
op_assign
id|dev-&gt;ioport
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xb0
)paren
op_ne
l_int|0
)paren
(brace
r_goto
id|abortsnd
suffix:semicolon
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1c
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|oktosend
suffix:semicolon
)brace
id|abortsnd
suffix:colon
id|dev-&gt;last_cmd
op_or_assign
l_int|0x40
suffix:semicolon
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
id|oktosend
suffix:colon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
comma
op_amp
id|workrequ-&gt;cmnd
(braket
l_int|0
)braket
comma
id|workrequ-&gt;cmd_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|READ_CAPACITY
)paren
(brace
r_if
c_cond
(paren
id|workrequ-&gt;request_bufflen
OG
l_int|8
)paren
(brace
id|workrequ-&gt;request_bufflen
op_assign
l_int|0x08
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
(brace
id|workrequ-&gt;request_bufflen
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Why limit this ????&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|INQUIRY
)paren
(brace
r_if
c_cond
(paren
id|workrequ-&gt;request_bufflen
OG
l_int|0x24
)paren
(brace
id|workrequ-&gt;request_bufflen
op_assign
l_int|0x24
suffix:semicolon
id|dev-&gt;ata_cdbu
(braket
l_int|4
)braket
op_assign
l_int|0x24
suffix:semicolon
)brace
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1b
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|target_id
op_assign
id|workrequ-&gt;target
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Wide ?&n;&t; */
id|w
op_assign
l_int|1
suffix:semicolon
id|w
op_assign
id|w
op_lshift
id|target_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|w
op_amp
id|dev-&gt;wide_idu
)paren
op_ne
l_int|0
)paren
(brace
id|j
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
id|j
)paren
(brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Write the command&n;&t; */
id|tmport
op_assign
id|workportu
suffix:semicolon
id|outb
c_func
(paren
id|workrequ-&gt;cmd_len
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x2c
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xcf
comma
id|tmport
op_increment
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|workrequ-&gt;cmd_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|dev-&gt;ata_cdbu
(braket
id|i
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x0f
suffix:semicolon
id|outb
c_func
(paren
id|workrequ-&gt;lun
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Write the target&n;&t; */
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Figure out the transfer size&n;&t; */
r_if
c_cond
(paren
id|workrequ-&gt;use_sg
)paren
(brace
id|l
op_assign
l_int|0
suffix:semicolon
id|sgpnt
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|workrequ-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|workrequ-&gt;use_sg
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sgpnt
(braket
id|i
)braket
dot
id|length
op_eq
l_int|0
op_logical_or
id|workrequ-&gt;use_sg
OG
id|ATP870U_SCATTER
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Foooooooood fight!&quot;
)paren
suffix:semicolon
)brace
id|l
op_add_assign
id|sgpnt
(braket
id|i
)braket
dot
id|length
suffix:semicolon
)brace
)brace
r_else
(brace
id|l
op_assign
id|workrequ-&gt;request_bufflen
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Write transfer size&n;&t; */
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
(paren
(paren
r_int
r_char
op_star
)paren
(paren
op_amp
id|l
)paren
)paren
(braket
l_int|2
)braket
)paren
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
(paren
(paren
r_int
r_char
op_star
)paren
(paren
op_amp
id|l
)paren
)paren
(braket
l_int|1
)braket
)paren
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
(paren
(paren
r_int
r_char
op_star
)paren
(paren
op_amp
id|l
)paren
)paren
(braket
l_int|0
)braket
)paren
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|j
op_assign
id|target_id
suffix:semicolon
id|dev-&gt;id
(braket
id|j
)braket
dot
id|last_lenu
op_assign
id|l
suffix:semicolon
id|dev-&gt;id
(braket
id|j
)braket
dot
id|tran_lenu
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Flip the wide bits&n;&t; */
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x08
)paren
op_ne
l_int|0
)paren
(brace
id|j
op_assign
(paren
id|j
op_amp
l_int|0x07
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Check transfer direction&n;&t; */
r_if
c_cond
(paren
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_6
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_10
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_12
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|MODE_SELECT
)paren
)paren
(brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|j
op_or
l_int|0x20
)paren
comma
id|tmport
op_increment
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|j
comma
id|tmport
op_increment
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_or
l_int|0x80
)paren
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1c
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|l
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_eq
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;last_cmd
op_or_assign
l_int|0x40
suffix:semicolon
)brace
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmpcip
op_assign
id|dev-&gt;pciport
suffix:semicolon
id|prd
op_assign
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_tableu
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_posu
op_assign
id|prd
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now write the request list. Either as scatter/gather or as&n;&t; *&t;a linear chain.&n;&t; */
r_if
c_cond
(paren
id|workrequ-&gt;use_sg
)paren
(brace
id|sgpnt
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|workrequ-&gt;request_buffer
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|workrequ-&gt;use_sg
suffix:semicolon
id|j
op_increment
)paren
(brace
(paren
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_rshift
l_int|1
)braket
)paren
op_assign
id|virt_to_bus
c_func
(paren
id|sgpnt
(braket
id|j
)braket
dot
id|address
)paren
suffix:semicolon
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|2
)braket
)paren
op_assign
id|sgpnt
(braket
id|j
)braket
dot
id|length
suffix:semicolon
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|3
)braket
)paren
op_assign
l_int|0
suffix:semicolon
id|i
op_add_assign
l_int|0x04
suffix:semicolon
)brace
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_minus
l_int|1
)braket
)paren
op_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; *&t;For a linear request write a chain of blocks&n;&t;&t; */
id|bttl
op_assign
id|virt_to_bus
c_func
(paren
id|workrequ-&gt;request_buffer
)paren
suffix:semicolon
id|l
op_assign
id|workrequ-&gt;request_bufflen
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|l
OG
l_int|0x10000
)paren
(brace
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|3
)braket
)paren
op_assign
l_int|0x0000
suffix:semicolon
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|2
)braket
)paren
op_assign
l_int|0x0000
suffix:semicolon
(paren
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_rshift
l_int|1
)braket
)paren
op_assign
id|bttl
suffix:semicolon
id|l
op_sub_assign
l_int|0x10000
suffix:semicolon
id|bttl
op_add_assign
l_int|0x10000
suffix:semicolon
id|i
op_add_assign
l_int|0x04
suffix:semicolon
)brace
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|3
)braket
)paren
op_assign
l_int|0x8000
suffix:semicolon
(paren
r_int
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_plus
l_int|2
)braket
)paren
op_assign
id|l
suffix:semicolon
(paren
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|prd
)paren
)paren
(braket
id|i
op_rshift
l_int|1
)braket
)paren
op_assign
id|bttl
suffix:semicolon
)brace
id|tmpcip
op_assign
id|tmpcip
op_plus
l_int|4
suffix:semicolon
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
op_assign
id|virt_to_bus
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prd_tableu
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|prdaddru
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
id|tmpcip
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmpcip
)paren
suffix:semicolon
id|tmpcip
op_assign
id|tmpcip
op_minus
l_int|2
suffix:semicolon
id|tmport
op_assign
id|workportu
op_plus
l_int|0x3a
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x08
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x28
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x0a
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
l_int|0x2a
)paren
)paren
(brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xf3
)paren
op_or
l_int|0x08
)paren
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xf3
)paren
comma
id|tmport
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x1c
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_6
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_10
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|WRITE_12
)paren
op_logical_or
(paren
id|dev-&gt;ata_cdbu
(braket
l_int|0
)braket
op_eq
id|MODE_SELECT
)paren
)paren
(brace
id|dev-&gt;id
(braket
id|target_id
)braket
dot
id|dirctu
op_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_eq
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmpcip
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;last_cmd
op_or_assign
l_int|0x40
suffix:semicolon
)brace
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_eq
l_int|0
)paren
(brace
id|tmport
op_assign
id|workportu
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x09
comma
id|tmpcip
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;last_cmd
op_or_assign
l_int|0x40
suffix:semicolon
)brace
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|internal_done
r_static
r_void
id|internal_done
c_func
(paren
id|Scsi_Cmnd
op_star
id|SCpnt
)paren
(brace
id|SCpnt-&gt;SCp.Status
op_increment
suffix:semicolon
)brace
DECL|function|atp870u_command
r_int
id|atp870u_command
c_func
(paren
id|Scsi_Cmnd
op_star
id|SCpnt
)paren
(brace
id|atp870u_queuecommand
c_func
(paren
id|SCpnt
comma
id|internal_done
)paren
suffix:semicolon
id|SCpnt-&gt;SCp.Status
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|SCpnt-&gt;SCp.Status
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_return
id|SCpnt-&gt;result
suffix:semicolon
)brace
DECL|function|fun_scam
r_int
r_char
id|fun_scam
c_func
(paren
r_struct
id|atp_unit
op_star
id|dev
comma
r_int
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|tmport
suffix:semicolon
r_int
r_int
r_int
id|i
comma
id|k
suffix:semicolon
r_int
r_char
id|j
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x1c
suffix:semicolon
id|outw
c_func
(paren
op_star
id|val
comma
id|tmport
)paren
suffix:semicolon
id|FUN_D7
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* stable &gt;= bus settle delay(400 ns)  */
id|k
op_assign
id|inw
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|j
op_assign
(paren
r_int
r_char
)paren
(paren
id|k
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|k
op_amp
l_int|0x8000
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* DB7 all release?    */
r_goto
id|FUN_D7
suffix:semicolon
)brace
)brace
op_star
id|val
op_or_assign
l_int|0x4000
suffix:semicolon
multiline_comment|/* assert DB6&t;&t;*/
id|outw
c_func
(paren
op_star
id|val
comma
id|tmport
)paren
suffix:semicolon
op_star
id|val
op_and_assign
l_int|0xdfff
suffix:semicolon
multiline_comment|/* assert DB5&t;&t;*/
id|outw
c_func
(paren
op_star
id|val
comma
id|tmport
)paren
suffix:semicolon
id|FUN_D5
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* stable &gt;= bus settle delay(400 ns) */
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x2000
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* DB5 all release?&t;  */
r_goto
id|FUN_D5
suffix:semicolon
)brace
)brace
op_star
id|val
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* no DB4-0, assert DB7    */
op_star
id|val
op_and_assign
l_int|0xe0ff
suffix:semicolon
id|outw
c_func
(paren
op_star
id|val
comma
id|tmport
)paren
suffix:semicolon
op_star
id|val
op_and_assign
l_int|0xbfff
suffix:semicolon
multiline_comment|/* release DB6&t;&t;   */
id|outw
c_func
(paren
op_star
id|val
comma
id|tmport
)paren
suffix:semicolon
id|FUN_D6
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* stable &gt;= bus settle delay(400 ns)  */
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x4000
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* DB6 all release?  */
r_goto
id|FUN_D6
suffix:semicolon
)brace
)brace
r_return
id|j
suffix:semicolon
)brace
DECL|function|tscam
r_void
id|tscam
c_func
(paren
r_int
r_char
id|host
)paren
(brace
r_int
r_int
id|tmport
suffix:semicolon
r_int
r_char
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
r_int
r_int
r_int
id|m
comma
id|assignid_map
comma
id|val
suffix:semicolon
r_int
r_char
id|mbuf
(braket
l_int|33
)braket
comma
id|quintet
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|host
)braket
suffix:semicolon
r_static
r_int
r_char
id|g2q_tab
(braket
l_int|8
)braket
op_assign
(brace
l_int|0x38
comma
l_int|0x31
comma
l_int|0x32
comma
l_int|0x2b
comma
l_int|0x34
comma
l_int|0x2d
comma
l_int|0x2e
comma
l_int|0x27
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mydlyu
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|1
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x7f
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x11
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;scam_on
op_amp
l_int|0x40
)paren
op_eq
l_int|0
)paren
(brace
r_return
suffix:semicolon
)brace
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_lshift_assign
id|dev-&gt;host_idu
suffix:semicolon
id|j
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
OL
l_int|4
)paren
(brace
id|m
op_or_assign
l_int|0xff00
suffix:semicolon
id|j
op_assign
l_int|8
suffix:semicolon
)brace
id|assignid_map
op_assign
id|m
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0x02
comma
id|tmport
op_increment
)paren
suffix:semicolon
multiline_comment|/* 2*2=4ms,3EH 2/32*3E=3.9ms */
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_assign
id|m
op_lshift
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|assignid_map
)paren
op_ne
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x0f
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|7
)paren
(brace
id|k
op_assign
(paren
id|i
op_amp
l_int|0x07
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
r_else
(brace
id|k
op_assign
id|i
suffix:semicolon
)brace
id|outb
c_func
(paren
id|k
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x1b
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
op_eq
l_int|4
)paren
(brace
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
)brace
id|wait_rdyok
suffix:colon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x09
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|k
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
op_ne
l_int|0x16
)paren
(brace
r_if
c_cond
(paren
(paren
id|k
op_eq
l_int|0x85
)paren
op_logical_or
(paren
id|k
op_eq
l_int|0x42
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x41
comma
id|tmport
)paren
suffix:semicolon
r_goto
id|wait_rdyok
suffix:semicolon
)brace
id|assignid_map
op_or_assign
id|m
suffix:semicolon
)brace
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0x7f
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x1b
suffix:semicolon
id|outb
c_func
(paren
l_int|0x02
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
l_int|0x80
)paren
suffix:semicolon
id|val
op_assign
l_int|0x0080
suffix:semicolon
multiline_comment|/* bsy&t;*/
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x1c
suffix:semicolon
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x0040
suffix:semicolon
multiline_comment|/* sel&t;*/
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x0004
suffix:semicolon
multiline_comment|/* msg&t;*/
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* 2 deskew delay(45ns*2=90ns) */
id|val
op_and_assign
l_int|0x007f
suffix:semicolon
multiline_comment|/* no bsy  */
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|mydlyu
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* recommanded SCAM selection response time */
id|mydlyu
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x00fb
suffix:semicolon
multiline_comment|/* after 1ms no msg */
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|wait_nomsg
suffix:colon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x04
)paren
op_ne
l_int|0
)paren
(brace
r_goto
id|wait_nomsg
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|1
comma
l_int|0x80
)paren
suffix:semicolon
id|mydlyu
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|0x30000
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* bsy ? */
r_goto
id|wait_io
suffix:semicolon
)brace
)brace
r_goto
id|TCM_SYNC
suffix:semicolon
id|wait_io
suffix:colon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|0x30000
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x81
)paren
op_eq
l_int|0x0081
)paren
(brace
r_goto
id|wait_io1
suffix:semicolon
)brace
)brace
r_goto
id|TCM_SYNC
suffix:semicolon
id|wait_io1
suffix:colon
id|inb
c_func
(paren
l_int|0x80
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x8003
suffix:semicolon
multiline_comment|/* io,cd,db7  */
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x80
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x00bf
suffix:semicolon
multiline_comment|/* no sel     */
id|outw
c_func
(paren
id|val
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|2
comma
l_int|0x80
)paren
suffix:semicolon
id|TCM_SYNC
suffix:colon
id|mydlyu
c_func
(paren
l_int|0x800
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
(brace
multiline_comment|/* bsy ? */
id|outw
c_func
(paren
l_int|0
comma
id|tmport
op_decrement
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
op_plus
l_int|0x15
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
l_int|0x09
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|val
op_and_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* synchronization  */
id|val
op_or_assign
l_int|0x3f00
suffix:semicolon
id|fun_scam
c_func
(paren
id|dev
comma
op_amp
id|val
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|3
comma
l_int|0x80
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* isolation&t;    */
id|val
op_or_assign
l_int|0x2000
suffix:semicolon
id|fun_scam
c_func
(paren
id|dev
comma
op_amp
id|val
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|4
comma
l_int|0x80
)paren
suffix:semicolon
id|i
op_assign
l_int|8
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|TCM_ID
suffix:colon
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x2000
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|TCM_ID
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|5
comma
l_int|0x80
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* get ID_STRING */
id|val
op_or_assign
l_int|0x2000
suffix:semicolon
id|k
op_assign
id|fun_scam
c_func
(paren
id|dev
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|k
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|TCM_5
suffix:semicolon
)brace
id|mbuf
(braket
id|j
)braket
op_lshift_assign
l_int|0x01
suffix:semicolon
id|mbuf
(braket
id|j
)braket
op_and_assign
l_int|0xfe
suffix:semicolon
r_if
c_cond
(paren
(paren
id|k
op_amp
l_int|0x02
)paren
op_ne
l_int|0
)paren
(brace
id|mbuf
(braket
id|j
)braket
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|i
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
(brace
r_goto
id|TCM_ID
suffix:semicolon
)brace
id|j
op_increment
suffix:semicolon
id|i
op_assign
l_int|8
suffix:semicolon
r_goto
id|TCM_ID
suffix:semicolon
id|TCM_5
suffix:colon
multiline_comment|/* isolation complete..  */
multiline_comment|/*    mbuf[32]=0;&n;&t;printk(&quot; &bslash;n%x %x %x %s&bslash;n &quot;,assignid_map,mbuf[0],mbuf[1],&amp;mbuf[2]); */
id|i
op_assign
l_int|15
suffix:semicolon
id|j
op_assign
id|mbuf
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x20
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* bit5=1:ID upto 7&t; */
id|i
op_assign
l_int|7
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x06
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* IDvalid?&t;&t;*/
r_goto
id|G2Q5
suffix:semicolon
)brace
id|k
op_assign
id|mbuf
(braket
l_int|1
)braket
suffix:semicolon
id|small_id
suffix:colon
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_lshift_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|assignid_map
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|G2Q_QUIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
OG
l_int|0
)paren
(brace
id|k
op_decrement
suffix:semicolon
r_goto
id|small_id
suffix:semicolon
)brace
id|G2Q5
suffix:colon
multiline_comment|/* srch from max acceptable ID#  */
id|k
op_assign
id|i
suffix:semicolon
multiline_comment|/* max acceptable ID#&t;&t; */
id|G2Q_LP
suffix:colon
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_lshift_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|assignid_map
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|G2Q_QUIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
OG
l_int|0
)paren
(brace
id|k
op_decrement
suffix:semicolon
r_goto
id|G2Q_LP
suffix:semicolon
)brace
id|G2Q_QUIN
suffix:colon
multiline_comment|/* k=binID#,&t;   */
id|assignid_map
op_or_assign
id|m
suffix:semicolon
r_if
c_cond
(paren
id|k
OL
l_int|8
)paren
(brace
id|quintet
(braket
l_int|0
)braket
op_assign
l_int|0x38
suffix:semicolon
multiline_comment|/* 1st dft ID&lt;8    */
)brace
r_else
(brace
id|quintet
(braket
l_int|0
)braket
op_assign
l_int|0x31
suffix:semicolon
multiline_comment|/* 1st&t;ID&gt;=8&t;   */
)brace
id|k
op_and_assign
l_int|0x07
suffix:semicolon
id|quintet
(braket
l_int|1
)braket
op_assign
id|g2q_tab
(braket
id|k
)braket
suffix:semicolon
id|val
op_and_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* AssignID 1stQuintet,AH=001xxxxx  */
id|m
op_assign
id|quintet
(braket
l_int|0
)braket
op_lshift
l_int|8
suffix:semicolon
id|val
op_or_assign
id|m
suffix:semicolon
id|fun_scam
c_func
(paren
id|dev
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* AssignID 2ndQuintet,AH=001xxxxx */
id|m
op_assign
id|quintet
(braket
l_int|1
)braket
op_lshift
l_int|8
suffix:semicolon
id|val
op_or_assign
id|m
suffix:semicolon
id|fun_scam
c_func
(paren
id|dev
comma
op_amp
id|val
)paren
suffix:semicolon
r_goto
id|TCM_SYNC
suffix:semicolon
)brace
DECL|function|is870
r_void
id|is870
c_func
(paren
r_int
r_int
id|host
comma
r_int
r_int
id|wkport
)paren
(brace
r_int
r_int
id|tmport
suffix:semicolon
r_int
r_char
id|i
comma
id|j
comma
id|k
comma
id|rmb
comma
id|n
suffix:semicolon
r_int
r_int
r_int
id|m
suffix:semicolon
r_static
r_int
r_char
id|mbuf
(braket
l_int|512
)braket
suffix:semicolon
r_static
r_int
r_char
id|satn
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|6
comma
l_int|6
)brace
suffix:semicolon
r_static
r_int
r_char
id|inqd
(braket
l_int|9
)braket
op_assign
(brace
l_int|0x12
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x24
comma
l_int|0
comma
l_int|0
comma
l_int|0x24
comma
l_int|6
)brace
suffix:semicolon
r_static
r_int
r_char
id|synn
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x80
comma
l_int|1
comma
l_int|3
comma
l_int|1
comma
l_int|0x19
comma
l_int|0x0e
)brace
suffix:semicolon
r_static
r_int
r_char
id|synu
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x80
comma
l_int|1
comma
l_int|3
comma
l_int|1
comma
l_int|0x0c
comma
l_int|0x0e
)brace
suffix:semicolon
r_static
r_int
r_char
id|synw
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x80
comma
l_int|1
comma
l_int|3
comma
l_int|1
comma
l_int|0x0c
comma
l_int|0x07
)brace
suffix:semicolon
r_static
r_int
r_char
id|wide
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x80
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|1
comma
l_int|0
)brace
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|host
)braket
suffix:semicolon
id|sync_idu
op_assign
l_int|0
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x3a
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_or
l_int|0x10
)paren
comma
id|tmport
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;chip_veru
op_ne
l_int|4
)paren
op_logical_and
(paren
id|i
OG
l_int|7
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_assign
id|m
op_lshift
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|dev-&gt;active_idu
)paren
op_ne
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|dev-&gt;host_idu
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;         ID: %2d  Host Adapter&bslash;n&quot;
comma
id|dev-&gt;host_idu
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x1b
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
op_eq
l_int|4
)paren
(brace
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|1
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x7f
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|0
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|1
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|2
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|3
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|4
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|5
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|6
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|7
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|j
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x08
)paren
op_ne
l_int|0
)paren
(brace
id|j
op_assign
(paren
id|j
op_amp
l_int|0x07
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|8
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x11
)paren
op_logical_and
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
suffix:semicolon
id|dev-&gt;active_idu
op_or_assign
id|m
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x30
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
id|phase_cmd
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ne
l_int|0x16
)paren
(brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x41
comma
id|tmport
)paren
suffix:semicolon
r_goto
id|phase_cmd
suffix:semicolon
)brace
id|sel_ok
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|3
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|0
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|1
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|2
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|3
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|4
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|5
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|6
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|7
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
id|inqd
(braket
l_int|8
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x11
)paren
op_logical_and
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x1b
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
op_eq
l_int|4
)paren
(brace
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|rd_inq_data
suffix:colon
id|k
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|k
op_amp
l_int|0x01
)paren
op_ne
l_int|0
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|mbuf
(braket
id|j
op_increment
)braket
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
r_goto
id|rd_inq_data
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|k
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|rd_inq_data
suffix:semicolon
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x16
)paren
(brace
r_goto
id|inq_ok
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x46
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x16
)paren
(brace
r_goto
id|sel_ok
suffix:semicolon
)brace
id|inq_ok
suffix:colon
id|mbuf
(braket
l_int|36
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;         ID: %2d  %s&bslash;n&quot;
comma
id|i
comma
op_amp
id|mbuf
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devtypeu
op_assign
id|mbuf
(braket
l_int|0
)braket
suffix:semicolon
id|rmb
op_assign
id|mbuf
(braket
l_int|1
)braket
suffix:semicolon
id|n
op_assign
id|mbuf
(braket
l_int|7
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
op_ne
l_int|4
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mbuf
(braket
l_int|7
)braket
op_amp
l_int|0x60
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;global_map
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x1b
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|3
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|0
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|1
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|2
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|3
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|4
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|5
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|6
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|7
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|8
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x11
)paren
op_logical_and
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
suffix:semicolon
id|try_wide
suffix:colon
id|j
op_assign
l_int|0
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0x05
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
id|wide
(braket
id|j
op_increment
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
)brace
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|widep_in
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|widep_cmd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|try_wide
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|widep_out
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
)brace
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|widep_in
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|widep_cmd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|widep_out
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|widep_in
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
id|widep_in1
suffix:colon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x01
)paren
op_ne
l_int|0
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|mbuf
(braket
id|k
op_increment
)braket
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
r_goto
id|widep_in1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
(brace
r_goto
id|widep_in1
suffix:semicolon
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|widep_in
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|widep_cmd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|widep_out
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|widep_cmd
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x30
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ne
l_int|0x16
)paren
(brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x4e
)paren
(brace
r_goto
id|widep_out
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|0
)braket
op_ne
l_int|0x01
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|1
)braket
op_ne
l_int|0x02
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|2
)braket
op_ne
l_int|0x03
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|3
)braket
op_ne
l_int|0x01
)paren
(brace
r_goto
id|not_wide
suffix:semicolon
)brace
id|m
op_assign
l_int|1
suffix:semicolon
id|m
op_assign
id|m
op_lshift
id|i
suffix:semicolon
id|dev-&gt;wide_idu
op_or_assign
id|m
suffix:semicolon
id|not_wide
suffix:colon
r_if
c_cond
(paren
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devtypeu
op_eq
l_int|0x00
)paren
op_logical_or
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devtypeu
op_eq
l_int|0x07
)paren
op_logical_or
(paren
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devtypeu
op_eq
l_int|0x05
)paren
op_logical_and
(paren
(paren
id|n
op_amp
l_int|0x10
)paren
op_ne
l_int|0
)paren
)paren
)paren
(brace
r_goto
id|set_sync
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|set_sync
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x1b
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|dev-&gt;wide_idu
)paren
op_ne
l_int|0
)paren
(brace
id|j
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|outb
c_func
(paren
id|j
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|3
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|0
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|1
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|2
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|3
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|4
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|5
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|6
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|7
)braket
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|outb
c_func
(paren
id|satn
(braket
l_int|8
)braket
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x11
)paren
op_logical_and
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_ne
l_int|0x8e
)paren
suffix:semicolon
id|try_sync
suffix:colon
id|j
op_assign
l_int|0
suffix:semicolon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_amp
id|dev-&gt;wide_idu
)paren
op_ne
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|synw
(braket
id|j
op_increment
)braket
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|m
op_amp
id|dev-&gt;ultra_map
)paren
op_ne
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|synu
(braket
id|j
op_increment
)braket
comma
id|tmport
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|synn
(braket
id|j
op_increment
)braket
comma
id|tmport
)paren
suffix:semicolon
)brace
)brace
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
)brace
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|phase_ins
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|phase_cmds
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|try_sync
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|phase_outs
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0x00
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
)brace
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x85
)paren
(brace
r_goto
id|tar_dcons
suffix:semicolon
)brace
id|j
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|phase_ins
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|phase_cmds
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|phase_outs
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|phase_ins
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
id|phase_ins1
suffix:colon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x01
)paren
op_ne
l_int|0x00
)paren
(brace
id|tmport
op_sub_assign
l_int|0x06
suffix:semicolon
id|mbuf
(braket
id|k
op_increment
)braket
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x06
suffix:semicolon
r_goto
id|phase_ins1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
(brace
r_goto
id|phase_ins1
suffix:semicolon
)brace
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x85
)paren
(brace
r_goto
id|tar_dcons
suffix:semicolon
)brace
id|j
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0f
)paren
(brace
r_goto
id|phase_ins
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0a
)paren
(brace
r_goto
id|phase_cmds
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0x0e
)paren
(brace
r_goto
id|phase_outs
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|phase_cmds
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
l_int|0x30
comma
id|tmport
)paren
suffix:semicolon
id|tar_dcons
suffix:colon
id|tmport
op_assign
id|wkport
op_plus
l_int|0x14
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x04
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|j
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ne
l_int|0x16
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|0
)braket
op_ne
l_int|0x01
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|1
)braket
op_ne
l_int|0x03
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|4
)braket
op_eq
l_int|0x00
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|3
)braket
OG
l_int|0x64
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|4
)braket
OG
l_int|0x0c
)paren
(brace
id|mbuf
(braket
l_int|4
)braket
op_assign
l_int|0x0c
suffix:semicolon
)brace
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
op_assign
id|mbuf
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mbuf
(braket
l_int|3
)braket
OL
l_int|0x0d
)paren
op_logical_and
(paren
id|rmb
op_eq
l_int|0
)paren
)paren
(brace
id|j
op_assign
l_int|0xa0
suffix:semicolon
r_goto
id|set_syn_ok
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|3
)braket
OL
l_int|0x1a
)paren
(brace
id|j
op_assign
l_int|0x20
suffix:semicolon
r_goto
id|set_syn_ok
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|3
)braket
OL
l_int|0x33
)paren
(brace
id|j
op_assign
l_int|0x40
suffix:semicolon
r_goto
id|set_syn_ok
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mbuf
(braket
l_int|3
)braket
OL
l_int|0x4c
)paren
(brace
id|j
op_assign
l_int|0x50
suffix:semicolon
r_goto
id|set_syn_ok
suffix:semicolon
)brace
id|j
op_assign
l_int|0x60
suffix:semicolon
id|set_syn_ok
suffix:colon
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
op_assign
(paren
id|dev-&gt;id
(braket
id|i
)braket
dot
id|devspu
op_amp
l_int|0x0f
)paren
op_or
id|j
suffix:semicolon
)brace
id|tmport
op_assign
id|wkport
op_plus
l_int|0x3a
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xef
)paren
comma
id|tmport
)paren
suffix:semicolon
)brace
multiline_comment|/* return non-zero on detection */
DECL|function|atp870u_detect
r_int
id|atp870u_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|tpnt
)paren
(brace
r_int
r_char
id|irq
comma
id|h
comma
id|k
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|base_io
comma
id|error
comma
id|tmport
suffix:semicolon
r_int
r_int
id|index
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
(braket
l_int|3
)braket
suffix:semicolon
r_int
r_char
id|chip_ver
(braket
l_int|3
)braket
comma
id|host_id
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|shpnt
op_assign
l_int|NULL
suffix:semicolon
r_int
id|tmpcnt
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_static
r_int
r_int
id|devid
(braket
l_int|8
)braket
op_assign
(brace
l_int|0x8002
comma
l_int|0x8010
comma
l_int|0x8020
comma
l_int|0x8030
comma
l_int|0x8040
comma
l_int|0x8050
comma
l_int|0x8060
comma
l_int|0
)brace
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;aec671x_detect: &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;   NO PCI SUPPORT.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|tpnt-&gt;proc_name
op_assign
l_string|&quot;atp870u&quot;
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
l_int|2
suffix:semicolon
id|h
op_increment
)paren
(brace
r_struct
id|atp_unit
op_star
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|h
)braket
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|16
suffix:semicolon
id|k
op_increment
)paren
(brace
id|dev-&gt;id
(braket
id|k
)braket
dot
id|prd_tableu
op_assign
id|kmalloc
c_func
(paren
l_int|1024
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|dev-&gt;id
(braket
id|k
)braket
dot
id|devspu
op_assign
l_int|0x20
suffix:semicolon
id|dev-&gt;id
(braket
id|k
)braket
dot
id|devtypeu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;id
(braket
id|k
)braket
dot
id|curr_req
op_assign
l_int|NULL
suffix:semicolon
)brace
id|dev-&gt;active_idu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;wide_idu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;host_idu
op_assign
l_int|0x07
suffix:semicolon
id|dev-&gt;quhdu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;quendu
op_assign
l_int|0
suffix:semicolon
id|pdev
(braket
id|h
)braket
op_assign
l_int|NULL
suffix:semicolon
id|pdev
(braket
l_int|2
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;chip_veru
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;last_cmd
op_assign
l_int|0xff
suffix:semicolon
id|dev-&gt;in_snd
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;in_int
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|qcnt
suffix:semicolon
id|k
op_increment
)paren
(brace
id|dev-&gt;querequ
(braket
id|k
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|16
suffix:semicolon
id|k
op_increment
)paren
(brace
id|dev-&gt;id
(braket
id|k
)braket
dot
id|curr_req
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|h
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|devid
(braket
id|h
)braket
op_ne
l_int|0
)paren
(brace
id|pdev
(braket
l_int|2
)braket
op_assign
id|pci_find_device
c_func
(paren
l_int|0x1191
comma
id|devid
(braket
id|h
)braket
comma
id|pdev
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev
(braket
l_int|2
)braket
op_eq
l_int|NULL
op_logical_or
id|pci_enable_device
c_func
(paren
id|pdev
(braket
l_int|2
)braket
)paren
)paren
(brace
id|h
op_increment
suffix:semicolon
id|index
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|chip_ver
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devid
(braket
id|h
)braket
op_eq
l_int|0x8002
)paren
(brace
id|error
op_assign
id|pci_read_config_byte
c_func
(paren
id|pdev
(braket
l_int|2
)braket
comma
l_int|0x08
comma
op_amp
id|chip_ver
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip_ver
(braket
l_int|2
)braket
OL
l_int|2
)paren
(brace
r_goto
id|nxt_devfn
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|devid
(braket
id|h
)braket
op_eq
l_int|0x8010
op_logical_or
id|devid
(braket
id|h
)braket
op_eq
l_int|0x8050
)paren
(brace
id|chip_ver
(braket
l_int|2
)braket
op_assign
l_int|0x04
suffix:semicolon
)brace
id|pdev
(braket
id|tmpcnt
)braket
op_assign
id|pdev
(braket
l_int|2
)braket
suffix:semicolon
id|chip_ver
(braket
id|tmpcnt
)braket
op_assign
id|chip_ver
(braket
l_int|2
)braket
suffix:semicolon
id|tmpcnt
op_increment
suffix:semicolon
id|nxt_devfn
suffix:colon
id|index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
l_int|3
)paren
(brace
id|index
op_assign
l_int|0
suffix:semicolon
id|h
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmpcnt
OG
l_int|1
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
l_int|2
suffix:semicolon
id|h
op_increment
)paren
(brace
r_struct
id|atp_unit
op_star
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pdev
(braket
id|h
)braket
op_eq
l_int|NULL
)paren
(brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* Found an atp870u/w. */
id|base_io
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
(braket
id|h
)braket
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pdev
(braket
id|h
)braket
op_member_access_from_pointer
id|irq
suffix:semicolon
id|error
op_assign
id|pci_read_config_byte
c_func
(paren
id|pdev
(braket
id|h
)braket
comma
l_int|0x49
comma
op_amp
id|host_id
)paren
suffix:semicolon
id|base_io
op_and_assign
l_int|0xfffffff8
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|base_io
comma
l_int|0x40
)paren
op_ne
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;   ACARD AEC-671X PCI Ultra/W SCSI-3 Host Adapter: %d    IO:%x, IRQ:%d.&bslash;n&quot;
comma
id|h
comma
id|base_io
comma
id|irq
)paren
suffix:semicolon
id|dev-&gt;ioport
op_assign
id|base_io
suffix:semicolon
id|dev-&gt;pciport
op_assign
id|base_io
op_plus
l_int|0x20
suffix:semicolon
id|irqnumu
(braket
id|h
)braket
op_assign
id|irq
suffix:semicolon
id|host_id
op_and_assign
l_int|0x07
suffix:semicolon
id|dev-&gt;host_idu
op_assign
id|host_id
suffix:semicolon
id|dev-&gt;chip_veru
op_assign
id|chip_ver
(braket
id|h
)braket
suffix:semicolon
id|tmport
op_assign
id|base_io
op_plus
l_int|0x22
suffix:semicolon
id|dev-&gt;scam_on
op_assign
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x0b
suffix:semicolon
id|dev-&gt;global_map
op_assign
id|inb
c_func
(paren
id|tmport
op_increment
)paren
suffix:semicolon
id|dev-&gt;ultra_map
op_assign
id|inw
c_func
(paren
id|tmport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ultra_map
op_eq
l_int|0
)paren
(brace
id|dev-&gt;scam_on
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;global_map
op_assign
l_int|0x20
suffix:semicolon
id|dev-&gt;ultra_map
op_assign
l_int|0xffff
suffix:semicolon
)brace
id|shpnt
op_assign
id|scsi_register
c_func
(paren
id|tpnt
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shpnt
op_eq
l_int|NULL
)paren
(brace
r_return
id|count
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|atp870u_intr_handle
comma
id|SA_SHIRQ
comma
l_string|&quot;atp870u&quot;
comma
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate IRQ for Acard controller.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|unregister
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip_ver
(braket
id|h
)braket
OG
l_int|0x07
)paren
multiline_comment|/* check if atp876 chip   */
(brace
multiline_comment|/* then enable terminator */
id|tmport
op_assign
id|base_io
op_plus
l_int|0x3e
suffix:semicolon
id|outb
c_func
(paren
l_int|0x30
comma
id|tmport
)paren
suffix:semicolon
)brace
id|tmport
op_assign
id|base_io
op_plus
l_int|0x3a
suffix:semicolon
id|k
op_assign
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xf3
)paren
op_or
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
id|k
comma
id|tmport
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|k
op_amp
l_int|0xdf
)paren
comma
id|tmport
)paren
suffix:semicolon
id|mydlyu
c_func
(paren
l_int|0x8000
)paren
suffix:semicolon
id|outb
c_func
(paren
id|k
comma
id|tmport
)paren
suffix:semicolon
id|mydlyu
c_func
(paren
l_int|0x8000
)paren
suffix:semicolon
id|tmport
op_assign
id|base_io
suffix:semicolon
id|outb
c_func
(paren
(paren
id|host_id
op_or
l_int|0x08
)paren
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x18
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x07
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|tmport
op_sub_assign
l_int|0x08
suffix:semicolon
id|inb
c_func
(paren
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|base_io
op_plus
l_int|1
suffix:semicolon
id|outb
c_func
(paren
l_int|8
comma
id|tmport
op_increment
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x7f
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_assign
id|base_io
op_plus
l_int|0x11
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|tmport
)paren
suffix:semicolon
id|tscam
c_func
(paren
id|h
)paren
suffix:semicolon
id|is870
c_func
(paren
id|h
comma
id|base_io
)paren
suffix:semicolon
id|tmport
op_assign
id|base_io
op_plus
l_int|0x3a
suffix:semicolon
id|outb
c_func
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_amp
l_int|0xef
)paren
comma
id|tmport
)paren
suffix:semicolon
id|tmport
op_increment
suffix:semicolon
id|outb
c_func
(paren
(paren
id|inb
c_func
(paren
id|tmport
)paren
op_or
l_int|0x20
)paren
comma
id|tmport
)paren
suffix:semicolon
id|atp_host
(braket
id|h
)braket
op_assign
id|shpnt
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;chip_veru
op_eq
l_int|4
)paren
(brace
id|shpnt-&gt;max_id
op_assign
l_int|16
suffix:semicolon
)brace
id|shpnt-&gt;this_id
op_assign
id|host_id
suffix:semicolon
id|shpnt-&gt;unique_id
op_assign
id|base_io
suffix:semicolon
id|shpnt-&gt;io_port
op_assign
id|base_io
suffix:semicolon
id|shpnt-&gt;n_io_port
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* Number of bytes of I/O space used */
id|shpnt-&gt;irq
op_assign
id|irq
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|base_io
comma
l_int|0x40
comma
l_string|&quot;atp870u&quot;
)paren
suffix:semicolon
multiline_comment|/* Register the IO ports that we use */
id|count
op_increment
suffix:semicolon
id|index
op_increment
suffix:semicolon
r_continue
suffix:semicolon
id|unregister
suffix:colon
id|scsi_unregister
c_func
(paren
id|shpnt
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|index
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* The abort command does not leave the device in a clean state where&n;   it is available to be used again.  Until this gets worked out, we will&n;   leave it commented out.  */
DECL|function|atp870u_abort
r_int
id|atp870u_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|SCpnt
)paren
(brace
r_int
r_char
id|h
comma
id|j
suffix:semicolon
r_int
r_int
id|tmport
suffix:semicolon
r_struct
id|atp_unit
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|admaxu
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SCpnt-&gt;host
op_eq
id|atp_host
(braket
id|h
)braket
)paren
(brace
r_goto
id|find_adp
suffix:semicolon
)brace
)brace
id|panic
c_func
(paren
l_string|&quot;Abort host not found !&quot;
)paren
suffix:semicolon
id|find_adp
suffix:colon
id|dev
op_assign
op_amp
id|atp_unit
(braket
id|h
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;working=%x last_cmd=%x &quot;
comma
id|dev-&gt;working
comma
id|dev-&gt;last_cmd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; quhdu=%x quendu=%x &quot;
comma
id|dev-&gt;quhdu
comma
id|dev-&gt;quendu
)paren
suffix:semicolon
id|tmport
op_assign
id|dev-&gt;ioport
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|0x17
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; r%2x=%2x&quot;
comma
id|j
comma
id|inb
c_func
(paren
id|tmport
op_increment
)paren
)paren
suffix:semicolon
)brace
id|tmport
op_add_assign
l_int|0x05
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; r1c=%2x&quot;
comma
id|inb
c_func
(paren
id|tmport
)paren
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x03
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; r1f=%2x in_snd=%2x &quot;
comma
id|inb
c_func
(paren
id|tmport
)paren
comma
id|dev-&gt;in_snd
)paren
suffix:semicolon
id|tmport
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; r20=%2x&quot;
comma
id|inb
c_func
(paren
id|tmport
)paren
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x02
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; r22=%2x&quot;
comma
id|inb
c_func
(paren
id|tmport
)paren
)paren
suffix:semicolon
id|tmport
op_add_assign
l_int|0x18
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; r3a=%2x &bslash;n&quot;
comma
id|inb
c_func
(paren
id|tmport
)paren
)paren
suffix:semicolon
r_return
(paren
id|SCSI_ABORT_SNOOZE
)paren
suffix:semicolon
)brace
DECL|function|atp870u_reset
r_int
id|atp870u_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|SCpnt
comma
r_int
r_int
id|reset_flags
)paren
(brace
r_int
r_char
id|h
suffix:semicolon
multiline_comment|/*&n;&t; * See if a bus reset was suggested.&n;&t; */
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|admaxu
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SCpnt-&gt;host
op_eq
id|atp_host
(braket
id|h
)braket
)paren
(brace
r_goto
id|find_host
suffix:semicolon
)brace
)brace
id|panic
c_func
(paren
l_string|&quot;Reset bus host not found !&quot;
)paren
suffix:semicolon
id|find_host
suffix:colon
multiline_comment|/*&t;SCpnt-&gt;result = 0x00080000;&n;&t;SCpnt-&gt;scsi_done(SCpnt);&n;&t;dev-&gt;working=0;&n;&t;dev-&gt;quhdu=0;&n;&t;dev-&gt;quendu=0;&n;&t;return (SCSI_RESET_SUCCESS | SCSI_RESET_BUS_RESET);  */
r_return
(paren
id|SCSI_RESET_SNOOZE
)paren
suffix:semicolon
)brace
DECL|function|atp870u_info
r_const
r_char
op_star
id|atp870u_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|notused
)paren
(brace
r_static
r_char
id|buffer
(braket
l_int|128
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|buffer
comma
l_string|&quot;ACARD AEC-6710/6712 PCI Ultra/W SCSI-3 Adapter Driver V2.1+ac &quot;
)paren
suffix:semicolon
r_return
id|buffer
suffix:semicolon
)brace
DECL|function|atp870u_set_info
r_int
id|atp870u_set_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_struct
id|Scsi_Host
op_star
id|HBAptr
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* Currently this is a no-op */
)brace
DECL|macro|BLS
mdefine_line|#define BLS buffer + len + size
DECL|function|atp870u_proc_info
r_int
id|atp870u_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|hostno
comma
r_int
id|inout
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|HBAptr
suffix:semicolon
r_static
id|u8
id|buff
(braket
l_int|512
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|size
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|HBAptr
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|HBAptr
op_assign
id|atp_host
(braket
id|i
)braket
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|HBAptr-&gt;host_no
op_eq
id|hostno
)paren
(brace
r_break
suffix:semicolon
)brace
id|HBAptr
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|HBAptr
op_eq
l_int|NULL
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Can&squot;t find adapter for host number %d&bslash;n&quot;
comma
id|hostno
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_goto
id|stop_output
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inout
op_eq
id|TRUE
)paren
(brace
multiline_comment|/* Has data been written to the file? */
r_return
(paren
id|atp870u_set_info
c_func
(paren
id|buffer
comma
id|length
comma
id|HBAptr
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
op_eq
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|buff
comma
l_int|0
comma
r_sizeof
(paren
id|buff
)paren
)paren
suffix:semicolon
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;ACARD AEC-671X Driver Version: 2.1+ac&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;Adapter Configuration:&bslash;n&quot;
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;               Base IO: %#.4lx&bslash;n&quot;
comma
id|HBAptr-&gt;io_port
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|BLS
comma
l_string|&quot;                   IRQ: %d&bslash;n&quot;
comma
id|HBAptr-&gt;irq
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|stop_output
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start slop */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
multiline_comment|/* Ending slop */
)brace
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
macro_line|#include &quot;sd.h&quot;
DECL|function|atp870u_biosparam
r_int
id|atp870u_biosparam
c_func
(paren
id|Scsi_Disk
op_star
id|disk
comma
id|kdev_t
id|dev
comma
r_int
op_star
id|ip
)paren
(brace
r_int
id|heads
comma
id|sectors
comma
id|cylinders
suffix:semicolon
id|heads
op_assign
l_int|64
suffix:semicolon
id|sectors
op_assign
l_int|32
suffix:semicolon
id|cylinders
op_assign
id|disk-&gt;capacity
op_div
(paren
id|heads
op_star
id|sectors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cylinders
OG
l_int|1024
)paren
(brace
id|heads
op_assign
l_int|255
suffix:semicolon
id|sectors
op_assign
l_int|63
suffix:semicolon
id|cylinders
op_assign
id|disk-&gt;capacity
op_div
(paren
id|heads
op_star
id|sectors
)paren
suffix:semicolon
)brace
id|ip
(braket
l_int|0
)braket
op_assign
id|heads
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
id|sectors
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|cylinders
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atp870u_release
r_int
id|atp870u_release
(paren
r_struct
id|Scsi_Host
op_star
id|pshost
)paren
(brace
r_int
id|h
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|admaxu
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pshost
op_eq
id|atp_host
(braket
id|h
)braket
)paren
(brace
r_int
id|k
suffix:semicolon
id|free_irq
(paren
id|pshost-&gt;irq
comma
op_amp
id|atp_unit
(braket
id|h
)braket
)paren
suffix:semicolon
id|release_region
(paren
id|pshost-&gt;io_port
comma
id|pshost-&gt;n_io_port
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|pshost
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|16
suffix:semicolon
id|k
op_increment
)paren
(brace
id|kfree
c_func
(paren
id|atp_unit
(braket
id|h
)braket
dot
id|id
(braket
id|k
)braket
dot
id|prd_tableu
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|panic
c_func
(paren
l_string|&quot;atp870u: bad scsi host passed.&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|driver_template
r_static
id|Scsi_Host_Template
id|driver_template
op_assign
id|ATP870U
suffix:semicolon
macro_line|#include &quot;scsi_module.c&quot;
eof
