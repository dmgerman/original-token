multiline_comment|/*&n;&n;  FlashPoint.c -- FlashPoint SCCB Manager for Linux&n;&n;  This file contains the FlashPoint SCCB Manager from BusLogic&squot;s FlashPoint&n;  Driver Developer&squot;s Kit, with minor modifications by Leonard N. Zubkoff for&n;  Linux compatibility.  It was provided by BusLogic in the form of 16 separate&n;  source files, which would have unnecessarily cluttered the scsi directory, so&n;  the individual files have been combined into this single file.&n;&n;  Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n;&n;  This file is available under both the GNU General Public License&n;  and a BSD-style copyright; see LICENSE.FlashPoint for details.&n;&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#ifndef CONFIG_SCSI_OMIT_FLASHPOINT
DECL|macro|UNIX
mdefine_line|#define UNIX
DECL|macro|FW_TYPE
mdefine_line|#define FW_TYPE&t;&t;_SCCB_MGR_
DECL|macro|MAX_CARDS
mdefine_line|#define MAX_CARDS&t;8
DECL|macro|BUSTYPE_PCI
macro_line|#undef BUSTYPE_PCI
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(port)&t;&t;inb(port)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(port)&t;&t;inw(port)
DECL|macro|OS_InPortLong
mdefine_line|#define OS_InPortLong(port)&t;&t;inl(port)
DECL|macro|OS_OutPortByte
mdefine_line|#define OS_OutPortByte(port, value)&t;outb(value, port)
DECL|macro|OS_OutPortWord
mdefine_line|#define OS_OutPortWord(port, value)&t;outw(value, port)
DECL|macro|OS_OutPortLong
mdefine_line|#define OS_OutPortLong(port, value)&t;outl(value, port)
DECL|macro|OS_Lock
mdefine_line|#define OS_Lock(x)
DECL|macro|OS_UnLock
mdefine_line|#define OS_UnLock(x)
multiline_comment|/*&n;  Define name replacements for compatibility with the Linux BusLogic Driver.&n;*/
DECL|macro|SccbMgr_sense_adapter
mdefine_line|#define SccbMgr_sense_adapter&t;&t;FlashPoint_ProbeHostAdapter
DECL|macro|SccbMgr_config_adapter
mdefine_line|#define SccbMgr_config_adapter&t;&t;FlashPoint_HardwareResetHostAdapter
DECL|macro|SccbMgr_unload_card
mdefine_line|#define SccbMgr_unload_card&t;&t;FlashPoint_ReleaseHostAdapter
DECL|macro|SccbMgr_start_sccb
mdefine_line|#define SccbMgr_start_sccb&t;&t;FlashPoint_StartCCB
DECL|macro|SccbMgr_abort_sccb
mdefine_line|#define SccbMgr_abort_sccb&t;&t;FlashPoint_AbortCCB
DECL|macro|SccbMgr_my_int
mdefine_line|#define SccbMgr_my_int&t;&t;&t;FlashPoint_InterruptPending
DECL|macro|SccbMgr_isr
mdefine_line|#define SccbMgr_isr&t;&t;&t;FlashPoint_HandleInterrupt
multiline_comment|/*&n;  Define name replacements to avoid kernel namespace pollution.&n;*/
DECL|macro|BL_Card
mdefine_line|#define BL_Card&t;&t;&t;&t;FPT_BL_Card
DECL|macro|BusMasterInit
mdefine_line|#define BusMasterInit&t;&t;&t;FPT_BusMasterInit
DECL|macro|CalcCrc16
mdefine_line|#define CalcCrc16&t;&t;&t;FPT_CalcCrc16
DECL|macro|CalcLrc
mdefine_line|#define CalcLrc&t;&t;&t;&t;FPT_CalcLrc
DECL|macro|ChkIfChipInitialized
mdefine_line|#define ChkIfChipInitialized&t;&t;FPT_ChkIfChipInitialized
DECL|macro|DiagBusMaster
mdefine_line|#define DiagBusMaster&t;&t;&t;FPT_DiagBusMaster
DECL|macro|DiagEEPROM
mdefine_line|#define DiagEEPROM&t;&t;&t;FPT_DiagEEPROM
DECL|macro|DiagXbow
mdefine_line|#define DiagXbow&t;&t;&t;FPT_DiagXbow
DECL|macro|GetTarLun
mdefine_line|#define GetTarLun&t;&t;&t;FPT_GetTarLun
DECL|macro|RNVRamData
mdefine_line|#define RNVRamData&t;&t;&t;FPT_RNVRamData
DECL|macro|RdStack
mdefine_line|#define RdStack&t;&t;&t;&t;FPT_RdStack
DECL|macro|SccbMgrTableInitAll
mdefine_line|#define SccbMgrTableInitAll&t;&t;FPT_SccbMgrTableInitAll
DECL|macro|SccbMgrTableInitCard
mdefine_line|#define SccbMgrTableInitCard&t;&t;FPT_SccbMgrTableInitCard
DECL|macro|SccbMgrTableInitTarget
mdefine_line|#define SccbMgrTableInitTarget&t;&t;FPT_SccbMgrTableInitTarget
DECL|macro|SccbMgr_bad_isr
mdefine_line|#define SccbMgr_bad_isr&t;&t;&t;FPT_SccbMgr_bad_isr
DECL|macro|SccbMgr_scsi_reset
mdefine_line|#define SccbMgr_scsi_reset&t;&t;FPT_SccbMgr_scsi_reset
DECL|macro|SccbMgr_timer_expired
mdefine_line|#define SccbMgr_timer_expired&t;&t;FPT_SccbMgr_timer_expired
DECL|macro|SendMsg
mdefine_line|#define SendMsg&t;&t;&t;&t;FPT_SendMsg
DECL|macro|Wait
mdefine_line|#define Wait&t;&t;&t;&t;FPT_Wait
DECL|macro|Wait1Second
mdefine_line|#define Wait1Second&t;&t;&t;FPT_Wait1Second
DECL|macro|WrStack
mdefine_line|#define WrStack&t;&t;&t;&t;FPT_WrStack
DECL|macro|XbowInit
mdefine_line|#define XbowInit&t;&t;&t;FPT_XbowInit
DECL|macro|autoCmdCmplt
mdefine_line|#define autoCmdCmplt&t;&t;&t;FPT_autoCmdCmplt
DECL|macro|autoLoadDefaultMap
mdefine_line|#define autoLoadDefaultMap&t;&t;FPT_autoLoadDefaultMap
DECL|macro|busMstrDataXferStart
mdefine_line|#define busMstrDataXferStart&t;&t;FPT_busMstrDataXferStart
DECL|macro|busMstrSGDataXferStart
mdefine_line|#define busMstrSGDataXferStart&t;&t;FPT_busMstrSGDataXferStart
DECL|macro|busMstrTimeOut
mdefine_line|#define busMstrTimeOut&t;&t;&t;FPT_busMstrTimeOut
DECL|macro|dataXferProcessor
mdefine_line|#define dataXferProcessor&t;&t;FPT_dataXferProcessor
DECL|macro|default_intena
mdefine_line|#define default_intena&t;&t;&t;FPT_default_intena
DECL|macro|hostDataXferAbort
mdefine_line|#define hostDataXferAbort&t;&t;FPT_hostDataXferAbort
DECL|macro|hostDataXferRestart
mdefine_line|#define hostDataXferRestart&t;&t;FPT_hostDataXferRestart
DECL|macro|inisci
mdefine_line|#define inisci&t;&t;&t;&t;FPT_inisci
DECL|macro|mbCards
mdefine_line|#define mbCards&t;&t;&t;&t;FPT_mbCards
DECL|macro|nvRamInfo
mdefine_line|#define nvRamInfo&t;&t;&t;FPT_nvRamInfo
DECL|macro|phaseBusFree
mdefine_line|#define phaseBusFree&t;&t;&t;FPT_phaseBusFree
DECL|macro|phaseChkFifo
mdefine_line|#define phaseChkFifo&t;&t;&t;FPT_phaseChkFifo
DECL|macro|phaseCommand
mdefine_line|#define phaseCommand&t;&t;&t;FPT_phaseCommand
DECL|macro|phaseDataIn
mdefine_line|#define phaseDataIn&t;&t;&t;FPT_phaseDataIn
DECL|macro|phaseDataOut
mdefine_line|#define phaseDataOut&t;&t;&t;FPT_phaseDataOut
DECL|macro|phaseDecode
mdefine_line|#define phaseDecode&t;&t;&t;FPT_phaseDecode
DECL|macro|phaseIllegal
mdefine_line|#define phaseIllegal&t;&t;&t;FPT_phaseIllegal
DECL|macro|phaseMsgIn
mdefine_line|#define phaseMsgIn&t;&t;&t;FPT_phaseMsgIn
DECL|macro|phaseMsgOut
mdefine_line|#define phaseMsgOut&t;&t;&t;FPT_phaseMsgOut
DECL|macro|phaseStatus
mdefine_line|#define phaseStatus&t;&t;&t;FPT_phaseStatus
DECL|macro|queueAddSccb
mdefine_line|#define queueAddSccb&t;&t;&t;FPT_queueAddSccb
DECL|macro|queueCmdComplete
mdefine_line|#define queueCmdComplete&t;&t;FPT_queueCmdComplete
DECL|macro|queueDisconnect
mdefine_line|#define queueDisconnect&t;&t;&t;FPT_queueDisconnect
DECL|macro|queueFindSccb
mdefine_line|#define queueFindSccb&t;&t;&t;FPT_queueFindSccb
DECL|macro|queueFlushSccb
mdefine_line|#define queueFlushSccb&t;&t;&t;FPT_queueFlushSccb
DECL|macro|queueFlushTargSccb
mdefine_line|#define queueFlushTargSccb&t;&t;FPT_queueFlushTargSccb
DECL|macro|queueSearchSelect
mdefine_line|#define queueSearchSelect&t;&t;FPT_queueSearchSelect
DECL|macro|queueSelectFail
mdefine_line|#define queueSelectFail&t;&t;&t;FPT_queueSelectFail
DECL|macro|s_PhaseTbl
mdefine_line|#define s_PhaseTbl&t;&t;&t;FPT_s_PhaseTbl
DECL|macro|scamHAString
mdefine_line|#define scamHAString&t;&t;&t;FPT_scamHAString
DECL|macro|scamInfo
mdefine_line|#define scamInfo&t;&t;&t;FPT_scamInfo
DECL|macro|scarb
mdefine_line|#define scarb&t;&t;&t;&t;FPT_scarb
DECL|macro|scasid
mdefine_line|#define scasid&t;&t;&t;&t;FPT_scasid
DECL|macro|scbusf
mdefine_line|#define scbusf&t;&t;&t;&t;FPT_scbusf
DECL|macro|sccbMgrTbl
mdefine_line|#define sccbMgrTbl&t;&t;&t;FPT_sccbMgrTbl
DECL|macro|schkdd
mdefine_line|#define schkdd&t;&t;&t;&t;FPT_schkdd
DECL|macro|scini
mdefine_line|#define scini&t;&t;&t;&t;FPT_scini
DECL|macro|sciso
mdefine_line|#define sciso&t;&t;&t;&t;FPT_sciso
DECL|macro|scmachid
mdefine_line|#define scmachid&t;&t;&t;FPT_scmachid
DECL|macro|scsavdi
mdefine_line|#define scsavdi&t;&t;&t;&t;FPT_scsavdi
DECL|macro|scsel
mdefine_line|#define scsel&t;&t;&t;&t;FPT_scsel
DECL|macro|scsell
mdefine_line|#define scsell&t;&t;&t;&t;FPT_scsell
DECL|macro|scsendi
mdefine_line|#define scsendi&t;&t;&t;&t;FPT_scsendi
DECL|macro|scvalq
mdefine_line|#define scvalq&t;&t;&t;&t;FPT_scvalq
DECL|macro|scwirod
mdefine_line|#define scwirod&t;&t;&t;&t;FPT_scwirod
DECL|macro|scwiros
mdefine_line|#define scwiros&t;&t;&t;&t;FPT_scwiros
DECL|macro|scwtsel
mdefine_line|#define scwtsel&t;&t;&t;&t;FPT_scwtsel
DECL|macro|scxferc
mdefine_line|#define scxferc&t;&t;&t;&t;FPT_scxferc
DECL|macro|sdecm
mdefine_line|#define sdecm&t;&t;&t;&t;FPT_sdecm
DECL|macro|sfm
mdefine_line|#define sfm&t;&t;&t;&t;FPT_sfm
DECL|macro|shandem
mdefine_line|#define shandem&t;&t;&t;&t;FPT_shandem
DECL|macro|sinits
mdefine_line|#define sinits&t;&t;&t;&t;FPT_sinits
DECL|macro|sisyncn
mdefine_line|#define sisyncn&t;&t;&t;&t;FPT_sisyncn
DECL|macro|sisyncr
mdefine_line|#define sisyncr&t;&t;&t;&t;FPT_sisyncr
DECL|macro|siwidn
mdefine_line|#define siwidn&t;&t;&t;&t;FPT_siwidn
DECL|macro|siwidr
mdefine_line|#define siwidr&t;&t;&t;&t;FPT_siwidr
DECL|macro|sres
mdefine_line|#define sres&t;&t;&t;&t;FPT_sres
DECL|macro|sresb
mdefine_line|#define sresb&t;&t;&t;&t;FPT_sresb
DECL|macro|ssel
mdefine_line|#define ssel&t;&t;&t;&t;FPT_ssel
DECL|macro|ssenss
mdefine_line|#define ssenss&t;&t;&t;&t;FPT_ssenss
DECL|macro|sssyncv
mdefine_line|#define sssyncv&t;&t;&t;&t;FPT_sssyncv
DECL|macro|stsyncn
mdefine_line|#define stsyncn&t;&t;&t;&t;FPT_stsyncn
DECL|macro|stwidn
mdefine_line|#define stwidn&t;&t;&t;&t;FPT_stwidn
DECL|macro|sxfrp
mdefine_line|#define sxfrp&t;&t;&t;&t;FPT_sxfrp
DECL|macro|utilEERead
mdefine_line|#define utilEERead&t;&t;&t;FPT_utilEERead
DECL|macro|utilEEReadOrg
mdefine_line|#define utilEEReadOrg&t;&t;&t;FPT_utilEEReadOrg
DECL|macro|utilEESendCmdAddr
mdefine_line|#define utilEESendCmdAddr&t;&t;FPT_utilEESendCmdAddr
DECL|macro|utilEEWrite
mdefine_line|#define utilEEWrite&t;&t;&t;FPT_utilEEWrite
DECL|macro|utilEEWriteOnOff
mdefine_line|#define utilEEWriteOnOff&t;&t;FPT_utilEEWriteOnOff
DECL|macro|utilUpdateResidual
mdefine_line|#define utilUpdateResidual&t;&t;FPT_utilUpdateResidual
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   globals.h  $&n; *&n; *   Description:  Common shared global defines.&n; *&n; *   $Date: 1996/09/04 01:26:13 $&n; *&n; *   $Revision: 1.11 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __GLOBALS_H__
DECL|macro|__GLOBALS_H__
mdefine_line|#define __GLOBALS_H__
DECL|macro|_UCB_MGR_
mdefine_line|#define _UCB_MGR_  1
DECL|macro|_SCCB_MGR_
mdefine_line|#define _SCCB_MGR_ 2
multiline_comment|/*#include &lt;osflags.h&gt;*/
DECL|macro|MAX_CDBLEN
mdefine_line|#define MAX_CDBLEN  12
DECL|macro|SCAM_LEV_2
mdefine_line|#define SCAM_LEV_2&t;1
DECL|macro|CRCMASK
mdefine_line|#define CRCMASK&t;0xA001
multiline_comment|/*  In your osflags.h file, please ENSURE that only ONE OS FLAG &n;    is on at a time !!! Also, please make sure you turn set the &n; &t; variable FW_TYPE to either _UCB_MGR_ or _SCCB_MGR_  !!! */
macro_line|#if defined(DOS) || defined(WIN95_16) || defined(OS2) || defined(OTHER_16)
DECL|macro|COMPILER_16_BIT
mdefine_line|#define       COMPILER_16_BIT 1
macro_line|#elif defined(NETWARE) || defined(NT) || defined(WIN95_32) || defined(UNIX) || defined(OTHER_32) || defined(SOLARIS_REAL_MODE)
DECL|macro|COMPILER_32_BIT
mdefine_line|#define       COMPILER_32_BIT 1
macro_line|#endif
DECL|macro|BL_VENDOR_ID
mdefine_line|#define     BL_VENDOR_ID      0x104B
DECL|macro|FP_DEVICE_ID
mdefine_line|#define     FP_DEVICE_ID      0x8130
DECL|macro|MM_DEVICE_ID
mdefine_line|#define     MM_DEVICE_ID      0x1040
macro_line|#ifndef FALSE
DECL|macro|FALSE
mdefine_line|#define FALSE           0
macro_line|#endif
macro_line|#ifndef TRUE
DECL|macro|TRUE
mdefine_line|#define TRUE            (!(FALSE))
macro_line|#endif
macro_line|#ifndef NULL
DECL|macro|NULL
mdefine_line|#define NULL            0
macro_line|#endif
DECL|macro|FAILURE
mdefine_line|#define FAILURE         0xFFFFFFFFL
DECL|typedef|UCHAR
r_typedef
r_int
r_char
id|UCHAR
suffix:semicolon
DECL|typedef|USHORT
r_typedef
r_int
r_int
id|USHORT
suffix:semicolon
DECL|typedef|UINT
r_typedef
r_int
r_int
id|UINT
suffix:semicolon
DECL|typedef|ULONG
r_typedef
r_int
r_int
id|ULONG
suffix:semicolon
DECL|typedef|PUCHAR
r_typedef
r_int
r_char
op_star
id|PUCHAR
suffix:semicolon
DECL|typedef|PUSHORT
r_typedef
r_int
r_int
op_star
id|PUSHORT
suffix:semicolon
DECL|typedef|PULONG
r_typedef
r_int
r_int
op_star
id|PULONG
suffix:semicolon
DECL|typedef|PVOID
r_typedef
r_void
op_star
id|PVOID
suffix:semicolon
macro_line|#if defined(COMPILER_16_BIT)
DECL|typedef|uchar_ptr
r_typedef
r_int
r_char
id|far
op_star
id|uchar_ptr
suffix:semicolon
DECL|typedef|ushort_ptr
r_typedef
r_int
r_int
id|far
op_star
id|ushort_ptr
suffix:semicolon
DECL|typedef|ulong_ptr
r_typedef
r_int
r_int
id|far
op_star
id|ulong_ptr
suffix:semicolon
macro_line|#endif  /* 16_BIT_COMPILER */
macro_line|#if defined(COMPILER_32_BIT)
DECL|typedef|uchar_ptr
r_typedef
r_int
r_char
op_star
id|uchar_ptr
suffix:semicolon
DECL|typedef|ushort_ptr
r_typedef
r_int
r_int
op_star
id|ushort_ptr
suffix:semicolon
DECL|typedef|ulong_ptr
r_typedef
r_int
r_int
op_star
id|ulong_ptr
suffix:semicolon
macro_line|#endif  /* 32_BIT_COMPILER */
multiline_comment|/*&t; &t;&t;&t;NEW TYPE DEFINITIONS (shared with Mylex North)&n;&n;**  Use following type defines to avoid confusion in 16 and 32-bit&n;**  environments.  Avoid using &squot;int&squot; as it denotes 16 bits in 16-bit&n;**  environment and 32 in 32-bit environments.&n;&n;*/
DECL|macro|s08bits
mdefine_line|#define s08bits&t;char
DECL|macro|s16bits
mdefine_line|#define s16bits &t;short
DECL|macro|s32bits
mdefine_line|#define s32bits&t;long
DECL|macro|u08bits
mdefine_line|#define u08bits&t;unsigned s08bits
DECL|macro|u16bits
mdefine_line|#define u16bits&t;unsigned s16bits
DECL|macro|u32bits
mdefine_line|#define u32bits&t;unsigned s32bits
macro_line|#if defined(COMPILER_16_BIT)
DECL|typedef|pu08bits
r_typedef
id|u08bits
id|far
op_star
id|pu08bits
suffix:semicolon
DECL|typedef|pu16bits
r_typedef
id|u16bits
id|far
op_star
id|pu16bits
suffix:semicolon
DECL|typedef|pu32bits
r_typedef
id|u32bits
id|far
op_star
id|pu32bits
suffix:semicolon
macro_line|#endif&t;/* COMPILER_16_BIT */
macro_line|#if defined(COMPILER_32_BIT)
DECL|typedef|pu08bits
r_typedef
id|u08bits
op_star
id|pu08bits
suffix:semicolon
DECL|typedef|pu16bits
r_typedef
id|u16bits
op_star
id|pu16bits
suffix:semicolon
DECL|typedef|pu32bits
r_typedef
id|u32bits
op_star
id|pu32bits
suffix:semicolon
macro_line|#endif&t;/* COMPILER_32_BIT */
DECL|macro|BIT
mdefine_line|#define BIT(x)          ((UCHAR)(1&lt;&lt;(x)))    /* single-bit mask in bit position x */
DECL|macro|BITW
mdefine_line|#define BITW(x)          ((USHORT)(1&lt;&lt;(x)))  /* single-bit mask in bit position x */
macro_line|#if defined(DOS)
multiline_comment|/*#include &lt;dos.h&gt;*/
DECL|macro|inportb
macro_line|#undef inportb          /* undefine for Borland Lib */
DECL|macro|inport
macro_line|#undef inport           /* they may have define I/O function in LIB */
DECL|macro|outportb
macro_line|#undef outportb
DECL|macro|outport
macro_line|#undef outport
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(ioport) &t;&t;inportb(ioport)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(ioport) &t;&t;inport(ioport)
DECL|macro|OS_InPortLong
mdefine_line|#define OS_InPortLong(ioport)&t;&t;&t;inportq(ioport, val)
DECL|macro|OS_OutPortByte
mdefine_line|#define OS_OutPortByte(ioport, val) outportb(ioport, val)
DECL|macro|OS_OutPortWord
mdefine_line|#define OS_OutPortWord(ioport, val)&t;outport(ioport, val)
DECL|macro|OS_OutPortLong
mdefine_line|#define OS_OutPortLong(ioport)&t;&t;outportq(ioport, val)
macro_line|#endif&t;/* DOS */
macro_line|#if defined(NETWARE) || defined(OTHER_32) ||  defined(OTHER_16)
r_extern
id|u08bits
id|OS_InPortByte
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
id|u16bits
id|OS_InPortWord
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
id|u32bits
id|OS_InPortLong
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
id|OS_InPortByteBuffer
c_func
(paren
id|u32bits
id|ioport
comma
id|pu08bits
id|buffer
comma
id|u32bits
id|count
)paren
suffix:semicolon
r_extern
id|OS_InPortWordBuffer
c_func
(paren
id|u32bits
id|ioport
comma
id|pu16bits
id|buffer
comma
id|u32bits
id|count
)paren
suffix:semicolon
r_extern
id|OS_OutPortByte
c_func
(paren
id|u32bits
id|ioport
comma
id|u08bits
id|val
)paren
suffix:semicolon
r_extern
id|OS_OutPortWord
c_func
(paren
id|u32bits
id|ioport
comma
id|u16bits
id|val
)paren
suffix:semicolon
r_extern
id|OS_OutPortLong
c_func
(paren
id|u32bits
id|ioport
comma
id|u32bits
id|val
)paren
suffix:semicolon
r_extern
id|OS_OutPortByteBuffer
c_func
(paren
id|u32bits
id|ioport
comma
id|pu08bits
id|buffer
comma
id|u32bits
id|count
)paren
suffix:semicolon
r_extern
id|OS_OutPortWordBuffer
c_func
(paren
id|u32bits
id|ioport
comma
id|pu16bits
id|buffer
comma
id|u32bits
id|count
)paren
suffix:semicolon
macro_line|#endif&t;/* NETWARE || OTHER_32 || OTHER_16 */
macro_line|#if defined (NT) || defined(WIN95_32) || defined(WIN95_16)
macro_line|#if defined(NT)
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
id|u08bits
id|ScsiPortReadPortUchar
c_func
(paren
id|pu08bits
id|ioport
)paren
suffix:semicolon
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
id|u16bits
id|ScsiPortReadPortUshort
c_func
(paren
id|pu16bits
id|ioport
)paren
suffix:semicolon
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
id|u32bits
id|ScsiPortReadPortUlong
c_func
(paren
id|pu32bits
id|ioport
)paren
suffix:semicolon
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
r_void
id|ScsiPortWritePortUchar
c_func
(paren
id|pu08bits
id|ioport
comma
id|u08bits
id|val
)paren
suffix:semicolon
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
r_void
id|ScsiPortWritePortUshort
c_func
(paren
id|pu16bits
id|port
comma
id|u16bits
id|val
)paren
suffix:semicolon
r_extern
id|__declspec
c_func
(paren
id|dllimport
)paren
r_void
id|ScsiPortWritePortUlong
c_func
(paren
id|pu32bits
id|port
comma
id|u32bits
id|val
)paren
suffix:semicolon
macro_line|#else
r_extern
id|u08bits
id|ScsiPortReadPortUchar
c_func
(paren
id|pu08bits
id|ioport
)paren
suffix:semicolon
r_extern
id|u16bits
id|ScsiPortReadPortUshort
c_func
(paren
id|pu16bits
id|ioport
)paren
suffix:semicolon
r_extern
id|u32bits
id|ScsiPortReadPortUlong
c_func
(paren
id|pu32bits
id|ioport
)paren
suffix:semicolon
r_extern
r_void
id|ScsiPortWritePortUchar
c_func
(paren
id|pu08bits
id|ioport
comma
id|u08bits
id|val
)paren
suffix:semicolon
r_extern
r_void
id|ScsiPortWritePortUshort
c_func
(paren
id|pu16bits
id|port
comma
id|u16bits
id|val
)paren
suffix:semicolon
r_extern
r_void
id|ScsiPortWritePortUlong
c_func
(paren
id|pu32bits
id|port
comma
id|u32bits
id|val
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(ioport) ScsiPortReadPortUchar((pu08bits) ioport)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(ioport) ScsiPortReadPortUshort((pu16bits) ioport)
DECL|macro|OS_InPortLong
mdefine_line|#define OS_InPortLong(ioport) ScsiPortReadPortUlong((pu32bits) ioport)
DECL|macro|OS_OutPortByte
mdefine_line|#define OS_OutPortByte(ioport, val) ScsiPortWritePortUchar((pu08bits) ioport, (u08bits) val)
DECL|macro|OS_OutPortWord
mdefine_line|#define OS_OutPortWord(ioport, val) ScsiPortWritePortUshort((pu16bits) ioport, (u16bits) val)
DECL|macro|OS_OutPortLong
mdefine_line|#define OS_OutPortLong(ioport, val) ScsiPortWritePortUlong((pu32bits) ioport, (u32bits) val)
DECL|macro|OS_OutPortByteBuffer
mdefine_line|#define OS_OutPortByteBuffer(ioport, buffer, count) &bslash;&n;&t;&t;ScsiPortWritePortBufferUchar((pu08bits)&amp;port, (pu08bits) buffer, (u32bits) count)
DECL|macro|OS_OutPortWordBuffer
mdefine_line|#define OS_OutPortWordBuffer(ioport, buffer, count) &bslash;&n;&t;&t;ScsiPortWritePortBufferUshort((pu16bits)&amp;port, (pu16bits) buffer, (u32bits) count)
DECL|macro|OS_Lock
mdefine_line|#define OS_Lock(x)
DECL|macro|OS_UnLock
mdefine_line|#define OS_UnLock(x)
macro_line|#endif /* NT || WIN95_32 || WIN95_16 */
macro_line|#if defined (UNIX) &amp;&amp; !defined(OS_InPortByte)
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(ioport)    inb((u16bits)ioport)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(ioport)    inw((u16bits)ioport)
DECL|macro|OS_InPortLong
mdefine_line|#define OS_InPortLong(ioport)    inl((u16bits)ioport)
DECL|macro|OS_OutPortByte
mdefine_line|#define OS_OutPortByte(ioport,val)  outb((u16bits)ioport, (u08bits)val)
DECL|macro|OS_OutPortWord
mdefine_line|#define OS_OutPortWord(ioport,val)  outw((u16bits)ioport, (u16bits)val)
DECL|macro|OS_OutPortLong
mdefine_line|#define OS_OutPortLong(ioport,val)  outl((u16bits)ioport, (u32bits)val)
DECL|macro|OS_Lock
mdefine_line|#define OS_Lock(x)
DECL|macro|OS_UnLock
mdefine_line|#define OS_UnLock(x)
macro_line|#endif /* UNIX */
macro_line|#if defined(OS2)
r_extern
id|u08bits
id|inb
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
id|u16bits
id|inw
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
r_void
id|outb
c_func
(paren
id|u32bits
id|ioport
comma
id|u08bits
id|val
)paren
suffix:semicolon
r_extern
r_void
id|outw
c_func
(paren
id|u32bits
id|ioport
comma
id|u16bits
id|val
)paren
suffix:semicolon
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(ioport)&t;&t;&t;inb(ioport)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(ioport)&t;&t;&t;inw(ioport)
DECL|macro|OS_OutPortByte
mdefine_line|#define OS_OutPortByte(ioport, val)&t;outb(ioport, val)
DECL|macro|OS_OutPortWord
mdefine_line|#define OS_OutPortWord(ioport, val)&t;outw(ioport, val)
r_extern
id|u32bits
id|OS_InPortLong
c_func
(paren
id|u32bits
id|ioport
)paren
suffix:semicolon
r_extern
r_void
id|OS_OutPortLong
c_func
(paren
id|u32bits
id|ioport
comma
id|u32bits
id|val
)paren
suffix:semicolon
DECL|macro|OS_Lock
mdefine_line|#define OS_Lock(x)
DECL|macro|OS_UnLock
mdefine_line|#define OS_UnLock(x)
macro_line|#endif /* OS2 */
macro_line|#if defined(SOLARIS_REAL_MODE)
r_extern
r_int
r_char
id|inb
c_func
(paren
r_int
r_int
id|ioport
)paren
suffix:semicolon
r_extern
r_int
r_int
id|inw
c_func
(paren
r_int
r_int
id|ioport
)paren
suffix:semicolon
DECL|macro|OS_InPortByte
mdefine_line|#define OS_InPortByte(ioport)    inb(ioport)
DECL|macro|OS_InPortWord
mdefine_line|#define OS_InPortWord(ioport)    inw(ioport)
r_extern
r_void
id|OS_OutPortByte
c_func
(paren
r_int
r_int
id|ioport
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_extern
r_void
id|OS_OutPortWord
c_func
(paren
r_int
r_int
id|ioport
comma
r_int
r_int
id|val
)paren
suffix:semicolon
r_extern
r_int
r_int
id|OS_InPortLong
c_func
(paren
r_int
r_int
id|ioport
)paren
suffix:semicolon
r_extern
r_void
id|OS_OutPortLong
c_func
(paren
r_int
r_int
id|ioport
comma
r_int
r_int
id|val
)paren
suffix:semicolon
DECL|macro|OS_Lock
mdefine_line|#define OS_Lock(x)
DECL|macro|OS_UnLock
mdefine_line|#define OS_UnLock(x)
macro_line|#endif  /* SOLARIS_REAL_MODE */
macro_line|#endif  /* __GLOBALS_H__ */
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   sccbmgr.h  $&n; *&n; *   Description:  Common shared SCCB Interface defines and SCCB &n; *&t;&t;&t;&t;&t;&t; Manager specifics defines.&n; *&n; *   $Date: 1996/10/24 23:09:33 $&n; *&n; *   $Revision: 1.14 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __SCCB_H__
DECL|macro|__SCCB_H__
mdefine_line|#define __SCCB_H__
multiline_comment|/*#include &lt;osflags.h&gt;*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if defined(BUGBUG)
DECL|macro|debug_size
mdefine_line|#define debug_size 32
macro_line|#endif
macro_line|#if defined(DOS)
DECL|typedef|PSCCB
r_typedef
r_struct
id|_SCCB
id|near
op_star
id|PSCCB
suffix:semicolon
macro_line|#if (FW_TYPE == _SCCB_MGR_)
DECL|typedef|CALL_BK_FN
r_typedef
r_void
(paren
op_star
id|CALL_BK_FN
)paren
(paren
id|PSCCB
)paren
suffix:semicolon
macro_line|#endif
macro_line|#elif defined(OS2)
DECL|typedef|PSCCB
r_typedef
r_struct
id|_SCCB
id|far
op_star
id|PSCCB
suffix:semicolon
macro_line|#if (FW_TYPE == _SCCB_MGR_)
DECL|typedef|CALL_BK_FN
r_typedef
r_void
(paren
id|far
op_star
id|CALL_BK_FN
)paren
(paren
id|PSCCB
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
DECL|typedef|PSCCB
r_typedef
r_struct
id|_SCCB
op_star
id|PSCCB
suffix:semicolon
macro_line|#if (FW_TYPE == _SCCB_MGR_)
DECL|typedef|CALL_BK_FN
r_typedef
r_void
(paren
op_star
id|CALL_BK_FN
)paren
(paren
id|PSCCB
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|struct|SCCBMgr_info
r_typedef
r_struct
id|SCCBMgr_info
(brace
DECL|member|si_baseaddr
id|ULONG
id|si_baseaddr
suffix:semicolon
DECL|member|si_present
id|UCHAR
id|si_present
suffix:semicolon
DECL|member|si_intvect
id|UCHAR
id|si_intvect
suffix:semicolon
DECL|member|si_id
id|UCHAR
id|si_id
suffix:semicolon
DECL|member|si_lun
id|UCHAR
id|si_lun
suffix:semicolon
DECL|member|si_fw_revision
id|USHORT
id|si_fw_revision
suffix:semicolon
DECL|member|si_per_targ_init_sync
id|USHORT
id|si_per_targ_init_sync
suffix:semicolon
DECL|member|si_per_targ_fast_nego
id|USHORT
id|si_per_targ_fast_nego
suffix:semicolon
DECL|member|si_per_targ_ultra_nego
id|USHORT
id|si_per_targ_ultra_nego
suffix:semicolon
DECL|member|si_per_targ_no_disc
id|USHORT
id|si_per_targ_no_disc
suffix:semicolon
DECL|member|si_per_targ_wide_nego
id|USHORT
id|si_per_targ_wide_nego
suffix:semicolon
DECL|member|si_flags
id|USHORT
id|si_flags
suffix:semicolon
DECL|member|si_card_family
id|UCHAR
id|si_card_family
suffix:semicolon
DECL|member|si_bustype
id|UCHAR
id|si_bustype
suffix:semicolon
DECL|member|si_card_model
id|UCHAR
id|si_card_model
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|si_relative_cardnum
id|UCHAR
id|si_relative_cardnum
suffix:semicolon
DECL|member|si_reserved
id|UCHAR
id|si_reserved
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|si_OS_reserved
id|ULONG
id|si_OS_reserved
suffix:semicolon
DECL|member|si_XlatInfo
id|UCHAR
id|si_XlatInfo
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|si_reserved2
id|ULONG
id|si_reserved2
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|si_secondary_range
id|ULONG
id|si_secondary_range
suffix:semicolon
DECL|typedef|SCCBMGR_INFO
)brace
id|SCCBMGR_INFO
suffix:semicolon
macro_line|#if defined(DOS)
DECL|typedef|PSCCBMGR_INFO
r_typedef
id|SCCBMGR_INFO
op_star
id|PSCCBMGR_INFO
suffix:semicolon
macro_line|#else
macro_line|#if defined (COMPILER_16_BIT)
DECL|typedef|PSCCBMGR_INFO
r_typedef
id|SCCBMGR_INFO
id|far
op_star
id|PSCCBMGR_INFO
suffix:semicolon
macro_line|#else
DECL|typedef|PSCCBMGR_INFO
r_typedef
id|SCCBMGR_INFO
op_star
id|PSCCBMGR_INFO
suffix:semicolon
macro_line|#endif
macro_line|#endif 
singleline_comment|// defined(DOS)
macro_line|#if (FW_TYPE==_SCCB_MGR_)
DECL|macro|SCSI_PARITY_ENA
mdefine_line|#define SCSI_PARITY_ENA&t;&t;  0x0001
DECL|macro|LOW_BYTE_TERM
mdefine_line|#define LOW_BYTE_TERM&t;&t;  0x0010
DECL|macro|HIGH_BYTE_TERM
mdefine_line|#define HIGH_BYTE_TERM&t;&t;  0x0020
DECL|macro|BUSTYPE_PCI
mdefine_line|#define BUSTYPE_PCI&t;  0x3
macro_line|#endif
DECL|macro|SUPPORT_16TAR_32LUN
mdefine_line|#define SUPPORT_16TAR_32LUN&t;  0x0002
DECL|macro|SOFT_RESET
mdefine_line|#define SOFT_RESET&t;&t;  0x0004
DECL|macro|EXTENDED_TRANSLATION
mdefine_line|#define EXTENDED_TRANSLATION&t;  0x0008
DECL|macro|POST_ALL_UNDERRRUNS
mdefine_line|#define POST_ALL_UNDERRRUNS&t;  0x0040
DECL|macro|FLAG_SCAM_ENABLED
mdefine_line|#define FLAG_SCAM_ENABLED&t;  0x0080
DECL|macro|FLAG_SCAM_LEVEL2
mdefine_line|#define FLAG_SCAM_LEVEL2&t;  0x0100
DECL|macro|HARPOON_FAMILY
mdefine_line|#define HARPOON_FAMILY        0x02
DECL|macro|ISA_BUS_CARD
mdefine_line|#define ISA_BUS_CARD          0x01
DECL|macro|EISA_BUS_CARD
mdefine_line|#define EISA_BUS_CARD         0x02
DECL|macro|PCI_BUS_CARD
mdefine_line|#define PCI_BUS_CARD          0x03
DECL|macro|VESA_BUS_CARD
mdefine_line|#define VESA_BUS_CARD         0x04
multiline_comment|/* SCCB struc used for both SCCB and UCB manager compiles! &n; * The UCB Manager treats the SCCB as it&squot;s &squot;native hardware structure&squot; &n; */
macro_line|#pragma pack(1)
DECL|struct|_SCCB
r_typedef
r_struct
id|_SCCB
(brace
DECL|member|OperationCode
id|UCHAR
id|OperationCode
suffix:semicolon
DECL|member|ControlByte
id|UCHAR
id|ControlByte
suffix:semicolon
DECL|member|CdbLength
id|UCHAR
id|CdbLength
suffix:semicolon
DECL|member|RequestSenseLength
id|UCHAR
id|RequestSenseLength
suffix:semicolon
DECL|member|DataLength
id|ULONG
id|DataLength
suffix:semicolon
DECL|member|DataPointer
id|ULONG
id|DataPointer
suffix:semicolon
DECL|member|CcbRes
id|UCHAR
id|CcbRes
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|HostStatus
id|UCHAR
id|HostStatus
suffix:semicolon
DECL|member|TargetStatus
id|UCHAR
id|TargetStatus
suffix:semicolon
DECL|member|TargID
id|UCHAR
id|TargID
suffix:semicolon
DECL|member|Lun
id|UCHAR
id|Lun
suffix:semicolon
DECL|member|Cdb
id|UCHAR
id|Cdb
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|CcbRes1
id|UCHAR
id|CcbRes1
suffix:semicolon
DECL|member|Reserved1
id|UCHAR
id|Reserved1
suffix:semicolon
DECL|member|Reserved2
id|ULONG
id|Reserved2
suffix:semicolon
DECL|member|SensePointer
id|ULONG
id|SensePointer
suffix:semicolon
DECL|member|SccbCallback
id|CALL_BK_FN
id|SccbCallback
suffix:semicolon
multiline_comment|/* VOID (*SccbCallback)(); */
DECL|member|SccbIOPort
id|ULONG
id|SccbIOPort
suffix:semicolon
multiline_comment|/* Identifies board base port */
DECL|member|SccbStatus
id|UCHAR
id|SccbStatus
suffix:semicolon
DECL|member|SCCBRes2
id|UCHAR
id|SCCBRes2
suffix:semicolon
DECL|member|SccbOSFlags
id|USHORT
id|SccbOSFlags
suffix:semicolon
DECL|member|Sccb_XferCnt
id|ULONG
id|Sccb_XferCnt
suffix:semicolon
multiline_comment|/* actual transfer count */
DECL|member|Sccb_ATC
id|ULONG
id|Sccb_ATC
suffix:semicolon
DECL|member|SccbVirtDataPtr
id|ULONG
id|SccbVirtDataPtr
suffix:semicolon
multiline_comment|/* virtual addr for OS/2 */
DECL|member|Sccb_res1
id|ULONG
id|Sccb_res1
suffix:semicolon
DECL|member|Sccb_MGRFlags
id|USHORT
id|Sccb_MGRFlags
suffix:semicolon
DECL|member|Sccb_sgseg
id|USHORT
id|Sccb_sgseg
suffix:semicolon
DECL|member|Sccb_scsimsg
id|UCHAR
id|Sccb_scsimsg
suffix:semicolon
multiline_comment|/* identify msg for selection */
DECL|member|Sccb_tag
id|UCHAR
id|Sccb_tag
suffix:semicolon
DECL|member|Sccb_scsistat
id|UCHAR
id|Sccb_scsistat
suffix:semicolon
DECL|member|Sccb_idmsg
id|UCHAR
id|Sccb_idmsg
suffix:semicolon
multiline_comment|/* image of last msg in */
DECL|member|Sccb_forwardlink
id|PSCCB
id|Sccb_forwardlink
suffix:semicolon
DECL|member|Sccb_backlink
id|PSCCB
id|Sccb_backlink
suffix:semicolon
DECL|member|Sccb_savedATC
id|ULONG
id|Sccb_savedATC
suffix:semicolon
DECL|member|Save_Cdb
id|UCHAR
id|Save_Cdb
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|Save_CdbLen
id|UCHAR
id|Save_CdbLen
suffix:semicolon
DECL|member|Sccb_XferState
id|UCHAR
id|Sccb_XferState
suffix:semicolon
DECL|member|Sccb_SGoffset
id|ULONG
id|Sccb_SGoffset
suffix:semicolon
macro_line|#if (FW_TYPE == _UCB_MGR_)
DECL|member|Sccb_ucb_ptr
id|PUCB
id|Sccb_ucb_ptr
suffix:semicolon
macro_line|#endif
DECL|typedef|SCCB
)brace
id|SCCB
suffix:semicolon
DECL|macro|SCCB_SIZE
mdefine_line|#define SCCB_SIZE sizeof(SCCB)
macro_line|#pragma pack()
DECL|macro|SCSI_INITIATOR_COMMAND
mdefine_line|#define SCSI_INITIATOR_COMMAND    0x00
DECL|macro|TARGET_MODE_COMMAND
mdefine_line|#define TARGET_MODE_COMMAND       0x01
DECL|macro|SCATTER_GATHER_COMMAND
mdefine_line|#define SCATTER_GATHER_COMMAND    0x02
DECL|macro|RESIDUAL_COMMAND
mdefine_line|#define RESIDUAL_COMMAND          0x03
DECL|macro|RESIDUAL_SG_COMMAND
mdefine_line|#define RESIDUAL_SG_COMMAND       0x04
DECL|macro|RESET_COMMAND
mdefine_line|#define RESET_COMMAND             0x81
DECL|macro|F_USE_CMD_Q
mdefine_line|#define F_USE_CMD_Q              0x20     /*Inidcates TAGGED command. */
DECL|macro|TAG_TYPE_MASK
mdefine_line|#define TAG_TYPE_MASK            0xC0     /*Type of tag msg to send. */
DECL|macro|TAG_Q_MASK
mdefine_line|#define TAG_Q_MASK               0xE0
DECL|macro|SCCB_DATA_XFER_OUT
mdefine_line|#define SCCB_DATA_XFER_OUT       0x10     /* Write */
DECL|macro|SCCB_DATA_XFER_IN
mdefine_line|#define SCCB_DATA_XFER_IN        0x08     /* Read */
DECL|macro|FOURTEEN_BYTES
mdefine_line|#define FOURTEEN_BYTES           0x00     /* Request Sense Buffer size */
DECL|macro|NO_AUTO_REQUEST_SENSE
mdefine_line|#define NO_AUTO_REQUEST_SENSE    0x01     /* No Request Sense Buffer */
DECL|macro|BUS_FREE_ST
mdefine_line|#define BUS_FREE_ST     0       
DECL|macro|SELECT_ST
mdefine_line|#define SELECT_ST       1
DECL|macro|SELECT_BDR_ST
mdefine_line|#define SELECT_BDR_ST   2     /* Select w&bslash; Bus Device Reset */
DECL|macro|SELECT_SN_ST
mdefine_line|#define SELECT_SN_ST    3     /* Select w&bslash; Sync Nego */
DECL|macro|SELECT_WN_ST
mdefine_line|#define SELECT_WN_ST    4     /* Select w&bslash; Wide Data Nego */
DECL|macro|SELECT_Q_ST
mdefine_line|#define SELECT_Q_ST     5     /* Select w&bslash; Tagged Q&squot;ing */
DECL|macro|COMMAND_ST
mdefine_line|#define COMMAND_ST      6
DECL|macro|DATA_OUT_ST
mdefine_line|#define DATA_OUT_ST     7
DECL|macro|DATA_IN_ST
mdefine_line|#define DATA_IN_ST      8
DECL|macro|DISCONNECT_ST
mdefine_line|#define DISCONNECT_ST   9
DECL|macro|STATUS_ST
mdefine_line|#define STATUS_ST       10
DECL|macro|ABORT_ST
mdefine_line|#define ABORT_ST        11
DECL|macro|MESSAGE_ST
mdefine_line|#define MESSAGE_ST      12
DECL|macro|F_HOST_XFER_DIR
mdefine_line|#define F_HOST_XFER_DIR                0x01
DECL|macro|F_ALL_XFERRED
mdefine_line|#define F_ALL_XFERRED                  0x02
DECL|macro|F_SG_XFER
mdefine_line|#define F_SG_XFER                      0x04
DECL|macro|F_AUTO_SENSE
mdefine_line|#define F_AUTO_SENSE                   0x08
DECL|macro|F_ODD_BALL_CNT
mdefine_line|#define F_ODD_BALL_CNT                 0x10
DECL|macro|F_NO_DATA_YET
mdefine_line|#define F_NO_DATA_YET                  0x80
DECL|macro|F_STATUSLOADED
mdefine_line|#define F_STATUSLOADED                 0x01
DECL|macro|F_MSGLOADED
mdefine_line|#define F_MSGLOADED                    0x02
DECL|macro|F_DEV_SELECTED
mdefine_line|#define F_DEV_SELECTED                 0x04
DECL|macro|SCCB_COMPLETE
mdefine_line|#define SCCB_COMPLETE               0x00  /* SCCB completed without error */
DECL|macro|SCCB_DATA_UNDER_RUN
mdefine_line|#define SCCB_DATA_UNDER_RUN         0x0C
DECL|macro|SCCB_SELECTION_TIMEOUT
mdefine_line|#define SCCB_SELECTION_TIMEOUT      0x11  /* Set SCSI selection timed out */
DECL|macro|SCCB_DATA_OVER_RUN
mdefine_line|#define SCCB_DATA_OVER_RUN          0x12
DECL|macro|SCCB_UNEXPECTED_BUS_FREE
mdefine_line|#define SCCB_UNEXPECTED_BUS_FREE    0x13  /* Target dropped SCSI BSY */
DECL|macro|SCCB_PHASE_SEQUENCE_FAIL
mdefine_line|#define SCCB_PHASE_SEQUENCE_FAIL    0x14  /* Target bus phase sequence failure */
DECL|macro|SCCB_INVALID_OP_CODE
mdefine_line|#define SCCB_INVALID_OP_CODE        0x16  /* SCCB invalid operation code */
DECL|macro|SCCB_INVALID_SCCB
mdefine_line|#define SCCB_INVALID_SCCB           0x1A  /* Invalid SCCB - bad parameter */
DECL|macro|SCCB_GROSS_FW_ERR
mdefine_line|#define SCCB_GROSS_FW_ERR           0x27  /* Major problem! */
DECL|macro|SCCB_BM_ERR
mdefine_line|#define SCCB_BM_ERR                 0x30  /* BusMaster error. */
DECL|macro|SCCB_PARITY_ERR
mdefine_line|#define SCCB_PARITY_ERR             0x34  /* SCSI parity error */
macro_line|#if (FW_TYPE==_UCB_MGR_)  
DECL|macro|HBA_AUTO_SENSE_FAIL
mdefine_line|#define  HBA_AUTO_SENSE_FAIL        0x1B  
DECL|macro|HBA_TQ_REJECTED
mdefine_line|#define  HBA_TQ_REJECTED            0x1C  
DECL|macro|HBA_UNSUPORTED_MSG
mdefine_line|#define  HBA_UNSUPORTED_MSG         0x1D  
DECL|macro|HBA_HW_ERROR
mdefine_line|#define  HBA_HW_ERROR               0x20  
DECL|macro|HBA_ATN_NOT_RESPONDED
mdefine_line|#define  HBA_ATN_NOT_RESPONDED      0x21  
DECL|macro|HBA_SCSI_RESET_BY_ADAPTER
mdefine_line|#define  HBA_SCSI_RESET_BY_ADAPTER  0x22
DECL|macro|HBA_SCSI_RESET_BY_TARGET
mdefine_line|#define  HBA_SCSI_RESET_BY_TARGET   0x23
DECL|macro|HBA_WRONG_CONNECTION
mdefine_line|#define  HBA_WRONG_CONNECTION       0x24
DECL|macro|HBA_BUS_DEVICE_RESET
mdefine_line|#define  HBA_BUS_DEVICE_RESET       0x25
DECL|macro|HBA_ABORT_QUEUE
mdefine_line|#define  HBA_ABORT_QUEUE            0x26
macro_line|#else 
singleline_comment|// these are not defined in BUDI/UCB
DECL|macro|SCCB_INVALID_DIRECTION
mdefine_line|#define SCCB_INVALID_DIRECTION      0x18  /* Invalid target direction */
DECL|macro|SCCB_DUPLICATE_SCCB
mdefine_line|#define SCCB_DUPLICATE_SCCB         0x19  /* Duplicate SCCB */
DECL|macro|SCCB_SCSI_RST
mdefine_line|#define SCCB_SCSI_RST               0x35  /* SCSI RESET detected. */
macro_line|#endif 
singleline_comment|// (FW_TYPE==_UCB_MGR_)  
DECL|macro|SCCB_IN_PROCESS
mdefine_line|#define SCCB_IN_PROCESS            0x00
DECL|macro|SCCB_SUCCESS
mdefine_line|#define SCCB_SUCCESS               0x01
DECL|macro|SCCB_ABORT
mdefine_line|#define SCCB_ABORT                 0x02
DECL|macro|SCCB_NOT_FOUND
mdefine_line|#define SCCB_NOT_FOUND             0x03
DECL|macro|SCCB_ERROR
mdefine_line|#define SCCB_ERROR                 0x04
DECL|macro|SCCB_INVALID
mdefine_line|#define SCCB_INVALID               0x05
DECL|macro|SCCB_SIZE
mdefine_line|#define SCCB_SIZE sizeof(SCCB)
macro_line|#if (FW_TYPE == _UCB_MGR_)
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
suffix:semicolon
id|s32bits
id|SccbMgr_abort_sccb
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
suffix:semicolon
id|u08bits
id|SccbMgr_my_int
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
id|s32bits
id|SccbMgr_isr
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_unload_card
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_restore_foreign_state
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_restore_native_state
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_save_foreign_state
c_func
(paren
id|PADAPTER_INFO
id|pAdapterInfo
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if (FW_TYPE == _SCCB_MGR_)
macro_line|#if defined (DOS)
r_int
id|SccbMgr_sense_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
id|USHORT
id|SccbMgr_config_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|USHORT
id|pCurrCard
comma
id|PSCCB
id|p_SCCB
)paren
suffix:semicolon
r_int
id|SccbMgr_abort_sccb
c_func
(paren
id|USHORT
id|pCurrCard
comma
id|PSCCB
id|p_SCCB
)paren
suffix:semicolon
id|UCHAR
id|SccbMgr_my_int
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
r_int
id|SccbMgr_isr
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
id|USHORT
id|SccbMgr_status
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_unload_card
c_func
(paren
id|USHORT
id|pCurrCard
)paren
suffix:semicolon
macro_line|#else    
singleline_comment|//non-DOS
r_int
id|SccbMgr_sense_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
id|ULONG
id|SccbMgr_config_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|ULONG
id|pCurrCard
comma
id|PSCCB
id|p_SCCB
)paren
suffix:semicolon
r_int
id|SccbMgr_abort_sccb
c_func
(paren
id|ULONG
id|pCurrCard
comma
id|PSCCB
id|p_SCCB
)paren
suffix:semicolon
id|UCHAR
id|SccbMgr_my_int
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_int
id|SccbMgr_isr
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_enable_int
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_disable_int
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
r_void
id|SccbMgr_unload_card
c_func
(paren
id|ULONG
id|pCurrCard
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif  
singleline_comment|// (FW_TYPE == _SCCB_MGR_)
macro_line|#endif  /* __SCCB_H__ */
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   blx30.h  $&n; *&n; *   Description: This module contains SCCB/UCB Manager implementation&n; *                specific stuff.&n; *&n; *   $Date: 1996/11/13 18:34:22 $&n; *&n; *   $Revision: 1.10 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __blx30_H__
DECL|macro|__blx30_H__
mdefine_line|#define __blx30_H__
multiline_comment|/*#include &lt;globals.h&gt;*/
DECL|macro|ORION_FW_REV
mdefine_line|#define  ORION_FW_REV      3110
DECL|macro|HARP_REVD
mdefine_line|#define HARP_REVD    1
macro_line|#if defined(DOS)
DECL|macro|QUEUE_DEPTH
mdefine_line|#define QUEUE_DEPTH     8+1            /*1 for Normal disconnect 0 for Q&squot;ing. */
macro_line|#else
DECL|macro|QUEUE_DEPTH
mdefine_line|#define QUEUE_DEPTH     254+1            /*1 for Normal disconnect 32 for Q&squot;ing. */
macro_line|#endif   
singleline_comment|// defined(DOS)
DECL|macro|MAX_MB_CARDS
mdefine_line|#define&t;MAX_MB_CARDS&t;4&t;&t;&t;&t;&t;/* Max. no of cards suppoerted on Mother Board */
DECL|macro|WIDE_SCSI
mdefine_line|#define WIDE_SCSI       1
macro_line|#if defined(WIDE_SCSI)
macro_line|#if defined(DOS)
DECL|macro|MAX_SCSI_TAR
mdefine_line|#define MAX_SCSI_TAR    16
DECL|macro|MAX_LUN
mdefine_line|#define MAX_LUN         8
DECL|macro|LUN_MASK
mdefine_line|#define LUN_MASK&t;&t;&t;0x07
macro_line|#else
DECL|macro|MAX_SCSI_TAR
mdefine_line|#define MAX_SCSI_TAR    16
DECL|macro|MAX_LUN
mdefine_line|#define MAX_LUN         32
DECL|macro|LUN_MASK
mdefine_line|#define LUN_MASK&t;&t;&t;0x1f
macro_line|#endif
macro_line|#else
DECL|macro|MAX_SCSI_TAR
mdefine_line|#define MAX_SCSI_TAR    8
DECL|macro|MAX_LUN
mdefine_line|#define MAX_LUN         8
DECL|macro|LUN_MASK
mdefine_line|#define LUN_MASK&t;&t;&t;0x07
macro_line|#endif 
macro_line|#if defined(HARP_REVA)
DECL|macro|SG_BUF_CNT
mdefine_line|#define SG_BUF_CNT      15             /*Number of prefetched elements. */
macro_line|#else
DECL|macro|SG_BUF_CNT
mdefine_line|#define SG_BUF_CNT      16             /*Number of prefetched elements. */
macro_line|#endif
DECL|macro|SG_ELEMENT_SIZE
mdefine_line|#define SG_ELEMENT_SIZE 8              /*Eight byte per element. */
DECL|macro|SG_LOCAL_MASK
mdefine_line|#define SG_LOCAL_MASK   0x00000000L
DECL|macro|SG_ELEMENT_MASK
mdefine_line|#define SG_ELEMENT_MASK 0xFFFFFFFFL
macro_line|#if (FW_TYPE == _UCB_MGR_)
DECL|macro|OPC_DECODE_NORMAL
mdefine_line|#define OPC_DECODE_NORMAL       0x0f7f
macro_line|#endif   
singleline_comment|// _UCB_MGR_
macro_line|#if defined(DOS)
multiline_comment|/*#include &lt;dos.h&gt;*/
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)          (OS_InPortByte(ioport))
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)         (OS_InPortWord(ioport))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val)      (OS_OutPortByte(ioport,val))
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)     (OS_OutPortWord(ioport,val))
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(port,offset,data)  asm{db 66h;         &bslash;&n;                                       push ax;             &bslash;&n;                                       mov dx,port;         &bslash;&n;                                       add dx, offset;      &bslash;&n;                                       db 66h;              &bslash;&n;                                       in ax,dx;            &bslash;&n;                                       db 66h;              &bslash;&n;                                       mov word ptr data,ax;&bslash;&n;                                       db 66h;              &bslash;&n;                                       pop ax}
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(port,offset,data) asm{db 66h;          &bslash;&n;                                       push ax;             &bslash;&n;                                       mov dx,port;         &bslash;&n;                                       add dx, offset;      &bslash;&n;                                       db 66h;              &bslash;&n;                                       mov ax,word ptr data;&bslash;&n;                                       db 66h;              &bslash;&n;                                       out dx,ax;           &bslash;&n;                                       db 66h;              &bslash;&n;                                       pop ax}
macro_line|#endif&t;/* DOS */
macro_line|#if defined(NETWARE) || defined(OTHER_32) ||  defined(OTHER_16)
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)     OS_InPortByte((unsigned long)ioport)
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)    OS_InPortWord((unsigned long)ioport)
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(ioport,offset,data) (data = OS_InPortLong(ioport + offset))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val) OS_OutPortByte((ULONG)ioport,(UCHAR) val)
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)  OS_OutPortWord((ULONG)ioport,(USHORT)val)
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(ioport,offset,data)  OS_OutPortLong((ioport + offset), data)
macro_line|#endif&t;/* NETWARE || OTHER_32 || OTHER_16 */
macro_line|#if defined(NT) || defined(WIN95_32) || defined(WIN95_16)
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)          OS_InPortByte((ULONG)ioport)
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)         OS_InPortWord((ULONG)ioport)
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(ioport,offset,data) (data = OS_InPortLong((ULONG)(ioport + offset)))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val)      OS_OutPortByte((ULONG)ioport,(UCHAR) val)
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)     OS_OutPortWord((ULONG)ioport,(USHORT)val)
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(ioport,offset,data)  OS_OutPortLong((ULONG)(ioport + offset), data)
macro_line|#endif /* NT || WIN95_32 || WIN95_16 */
macro_line|#if defined (UNIX)
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)          OS_InPortByte((u32bits)ioport)
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)         OS_InPortWord((u32bits)ioport)
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(ioport,offset,data) (data = OS_InPortLong((u32bits)(ioport + offset)))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val)      OS_OutPortByte((u32bits)ioport,(u08bits) val)
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)       OS_OutPortWord((u32bits)ioport,(u16bits)val)
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(ioport,offset,data)  OS_OutPortLong((u32bits)(ioport + offset), data)
macro_line|#endif /* UNIX */
macro_line|#if defined(OS2)
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)          OS_InPortByte((unsigned long)ioport)
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)         OS_InPortWord((unsigned long)ioport)
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(ioport,offset,data) (data = OS_InPortLong((ULONG)(ioport + offset)))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val)      OS_OutPortByte((ULONG)ioport,(UCHAR) val)
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)       OS_OutPortWord((ULONG)ioport,(USHORT)val)
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(ioport,offset,data)  OS_OutPortLong(((ULONG)(ioport + offset)), data)
macro_line|#endif /* OS2 */
macro_line|#if defined(SOLARIS_REAL_MODE)
DECL|macro|RD_HARPOON
mdefine_line|#define RD_HARPOON(ioport)          OS_InPortByte((unsigned long)ioport)
DECL|macro|RDW_HARPOON
mdefine_line|#define RDW_HARPOON(ioport)         OS_InPortWord((unsigned long)ioport)
DECL|macro|RD_HARP32
mdefine_line|#define RD_HARP32(ioport,offset,data) (data = OS_InPortLong((ULONG)(ioport + offset)))
DECL|macro|WR_HARPOON
mdefine_line|#define WR_HARPOON(ioport,val)      OS_OutPortByte((ULONG)ioport,(UCHAR) val)
DECL|macro|WRW_HARPOON
mdefine_line|#define WRW_HARPOON(ioport,val)       OS_OutPortWord((ULONG)ioport,(USHORT)val)
DECL|macro|WR_HARP32
mdefine_line|#define WR_HARP32(ioport,offset,data)  OS_OutPortLong((ULONG)(ioport + offset), (ULONG)data)
macro_line|#endif  /* SOLARIS_REAL_MODE */
macro_line|#endif  /* __BLX30_H__ */
multiline_comment|/*----------------------------------------------------------------------&n; * &n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   target.h  $&n; *&n; *   Description:  Definitions for Target related structures&n; *&n; *   $Date: 1996/12/11 22:06:20 $&n; *&n; *   $Revision: 1.9 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __TARGET__
DECL|macro|__TARGET__
mdefine_line|#define __TARGET__
multiline_comment|/*#include &lt;globals.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
DECL|macro|TAR_SYNC_MASK
mdefine_line|#define  TAR_SYNC_MASK     (BIT(7)+BIT(6))
DECL|macro|SYNC_UNKNOWN
mdefine_line|#define  SYNC_UNKNOWN      0x00
DECL|macro|SYNC_TRYING
mdefine_line|#define  SYNC_TRYING               BIT(6)
DECL|macro|SYNC_SUPPORTED
mdefine_line|#define  SYNC_SUPPORTED    (BIT(7)+BIT(6))
DECL|macro|TAR_WIDE_MASK
mdefine_line|#define  TAR_WIDE_MASK     (BIT(5)+BIT(4))
DECL|macro|WIDE_DISABLED
mdefine_line|#define  WIDE_DISABLED     0x00
DECL|macro|WIDE_ENABLED
mdefine_line|#define  WIDE_ENABLED              BIT(4)
DECL|macro|WIDE_NEGOCIATED
mdefine_line|#define  WIDE_NEGOCIATED   BIT(5)
DECL|macro|TAR_TAG_Q_MASK
mdefine_line|#define  TAR_TAG_Q_MASK    (BIT(3)+BIT(2))
DECL|macro|TAG_Q_UNKNOWN
mdefine_line|#define  TAG_Q_UNKNOWN     0x00
DECL|macro|TAG_Q_TRYING
mdefine_line|#define  TAG_Q_TRYING              BIT(2)
DECL|macro|TAG_Q_REJECT
mdefine_line|#define  TAG_Q_REJECT      BIT(3)
DECL|macro|TAG_Q_SUPPORTED
mdefine_line|#define  TAG_Q_SUPPORTED   (BIT(3)+BIT(2))
DECL|macro|TAR_ALLOW_DISC
mdefine_line|#define  TAR_ALLOW_DISC    BIT(0)
DECL|macro|EE_SYNC_MASK
mdefine_line|#define  EE_SYNC_MASK      (BIT(0)+BIT(1))
DECL|macro|EE_SYNC_ASYNC
mdefine_line|#define  EE_SYNC_ASYNC     0x00
DECL|macro|EE_SYNC_5MB
mdefine_line|#define  EE_SYNC_5MB       BIT(0)
DECL|macro|EE_SYNC_10MB
mdefine_line|#define  EE_SYNC_10MB      BIT(1)
DECL|macro|EE_SYNC_20MB
mdefine_line|#define  EE_SYNC_20MB      (BIT(0)+BIT(1))
DECL|macro|EE_ALLOW_DISC
mdefine_line|#define  EE_ALLOW_DISC     BIT(6)
DECL|macro|EE_WIDE_SCSI
mdefine_line|#define  EE_WIDE_SCSI      BIT(7)
macro_line|#if defined(DOS)
DECL|typedef|PSCCBMgr_tar_info
r_typedef
r_struct
id|SCCBMgr_tar_info
id|near
op_star
id|PSCCBMgr_tar_info
suffix:semicolon
macro_line|#elif defined(OS2)
DECL|typedef|PSCCBMgr_tar_info
r_typedef
r_struct
id|SCCBMgr_tar_info
id|far
op_star
id|PSCCBMgr_tar_info
suffix:semicolon
macro_line|#else
DECL|typedef|PSCCBMgr_tar_info
r_typedef
r_struct
id|SCCBMgr_tar_info
op_star
id|PSCCBMgr_tar_info
suffix:semicolon
macro_line|#endif
DECL|struct|SCCBMgr_tar_info
r_typedef
r_struct
id|SCCBMgr_tar_info
(brace
DECL|member|TarSelQ_Head
id|PSCCB
id|TarSelQ_Head
suffix:semicolon
DECL|member|TarSelQ_Tail
id|PSCCB
id|TarSelQ_Tail
suffix:semicolon
DECL|member|TarLUN_CA
id|UCHAR
id|TarLUN_CA
suffix:semicolon
multiline_comment|/*Contingent Allgiance */
DECL|member|TarTagQ_Cnt
id|UCHAR
id|TarTagQ_Cnt
suffix:semicolon
DECL|member|TarSelQ_Cnt
id|UCHAR
id|TarSelQ_Cnt
suffix:semicolon
DECL|member|TarStatus
id|UCHAR
id|TarStatus
suffix:semicolon
DECL|member|TarEEValue
id|UCHAR
id|TarEEValue
suffix:semicolon
DECL|member|TarSyncCtrl
id|UCHAR
id|TarSyncCtrl
suffix:semicolon
DECL|member|TarReserved
id|UCHAR
id|TarReserved
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* for alignment */
DECL|member|LunDiscQ_Idx
id|UCHAR
id|LunDiscQ_Idx
(braket
id|MAX_LUN
)braket
suffix:semicolon
DECL|member|TarLUNBusy
id|UCHAR
id|TarLUNBusy
(braket
id|MAX_LUN
)braket
suffix:semicolon
DECL|typedef|SCCBMGR_TAR_INFO
)brace
id|SCCBMGR_TAR_INFO
suffix:semicolon
DECL|struct|NVRAMInfo
r_typedef
r_struct
id|NVRAMInfo
(brace
DECL|member|niModel
id|UCHAR
id|niModel
suffix:semicolon
multiline_comment|/* Model No. of card */
DECL|member|niCardNo
id|UCHAR
id|niCardNo
suffix:semicolon
multiline_comment|/* Card no. */
macro_line|#if defined(DOS)
DECL|member|niBaseAddr
id|USHORT
id|niBaseAddr
suffix:semicolon
multiline_comment|/* Port Address of card */
macro_line|#else
DECL|member|niBaseAddr
id|ULONG
id|niBaseAddr
suffix:semicolon
multiline_comment|/* Port Address of card */
macro_line|#endif
DECL|member|niSysConf
id|UCHAR
id|niSysConf
suffix:semicolon
multiline_comment|/* Adapter Configuration byte - Byte 16 of eeprom map */
DECL|member|niScsiConf
id|UCHAR
id|niScsiConf
suffix:semicolon
multiline_comment|/* SCSI Configuration byte - Byte 17 of eeprom map */
DECL|member|niScamConf
id|UCHAR
id|niScamConf
suffix:semicolon
multiline_comment|/* SCAM Configuration byte - Byte 20 of eeprom map */
DECL|member|niAdapId
id|UCHAR
id|niAdapId
suffix:semicolon
multiline_comment|/* Host Adapter ID - Byte 24 of eerpom map */
DECL|member|niSyncTbl
id|UCHAR
id|niSyncTbl
(braket
id|MAX_SCSI_TAR
op_div
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Sync/Wide byte of targets */
DECL|member|niScamTbl
id|UCHAR
id|niScamTbl
(braket
id|MAX_SCSI_TAR
)braket
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* Compressed Scam name string of Targets */
DECL|typedef|NVRAMINFO
)brace
id|NVRAMINFO
suffix:semicolon
macro_line|#if defined(DOS)
DECL|typedef|PNVRamInfo
r_typedef
id|NVRAMINFO
id|near
op_star
id|PNVRamInfo
suffix:semicolon
macro_line|#elif defined (OS2)
DECL|typedef|PNVRamInfo
r_typedef
id|NVRAMINFO
id|far
op_star
id|PNVRamInfo
suffix:semicolon
macro_line|#else
DECL|typedef|PNVRamInfo
r_typedef
id|NVRAMINFO
op_star
id|PNVRamInfo
suffix:semicolon
macro_line|#endif
DECL|macro|MODEL_LT
mdefine_line|#define&t;MODEL_LT&t;&t;1
DECL|macro|MODEL_DL
mdefine_line|#define&t;MODEL_DL&t;&t;2
DECL|macro|MODEL_LW
mdefine_line|#define&t;MODEL_LW&t;&t;3
DECL|macro|MODEL_DW
mdefine_line|#define&t;MODEL_DW&t;&t;4
DECL|struct|SCCBcard
r_typedef
r_struct
id|SCCBcard
(brace
DECL|member|currentSCCB
id|PSCCB
id|currentSCCB
suffix:semicolon
macro_line|#if (FW_TYPE==_SCCB_MGR_)
DECL|member|cardInfo
id|PSCCBMGR_INFO
id|cardInfo
suffix:semicolon
macro_line|#else
DECL|member|cardInfo
id|PADAPTER_INFO
id|cardInfo
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
DECL|member|ioPort
id|USHORT
id|ioPort
suffix:semicolon
macro_line|#else
DECL|member|ioPort
id|ULONG
id|ioPort
suffix:semicolon
macro_line|#endif
DECL|member|cmdCounter
id|USHORT
id|cmdCounter
suffix:semicolon
DECL|member|discQCount
id|UCHAR
id|discQCount
suffix:semicolon
DECL|member|tagQ_Lst
id|UCHAR
id|tagQ_Lst
suffix:semicolon
DECL|member|cardIndex
id|UCHAR
id|cardIndex
suffix:semicolon
DECL|member|scanIndex
id|UCHAR
id|scanIndex
suffix:semicolon
DECL|member|globalFlags
id|UCHAR
id|globalFlags
suffix:semicolon
DECL|member|ourId
id|UCHAR
id|ourId
suffix:semicolon
DECL|member|pNvRamInfo
id|PNVRamInfo
id|pNvRamInfo
suffix:semicolon
DECL|member|discQ_Tbl
id|PSCCB
id|discQ_Tbl
(braket
id|QUEUE_DEPTH
)braket
suffix:semicolon
DECL|typedef|SCCBCARD
)brace
id|SCCBCARD
suffix:semicolon
macro_line|#if defined(DOS)
DECL|typedef|PSCCBcard
r_typedef
r_struct
id|SCCBcard
id|near
op_star
id|PSCCBcard
suffix:semicolon
macro_line|#elif defined (OS2)
DECL|typedef|PSCCBcard
r_typedef
r_struct
id|SCCBcard
id|far
op_star
id|PSCCBcard
suffix:semicolon
macro_line|#else
DECL|typedef|PSCCBcard
r_typedef
r_struct
id|SCCBcard
op_star
id|PSCCBcard
suffix:semicolon
macro_line|#endif
DECL|macro|F_TAG_STARTED
mdefine_line|#define F_TAG_STARTED&t;&t;0x01
DECL|macro|F_CONLUN_IO
mdefine_line|#define F_CONLUN_IO&t;&t;&t;0x02
DECL|macro|F_DO_RENEGO
mdefine_line|#define F_DO_RENEGO&t;&t;&t;0x04
DECL|macro|F_NO_FILTER
mdefine_line|#define F_NO_FILTER&t;&t;&t;0x08
DECL|macro|F_GREEN_PC
mdefine_line|#define F_GREEN_PC&t;&t;&t;0x10
DECL|macro|F_HOST_XFER_ACT
mdefine_line|#define F_HOST_XFER_ACT&t;&t;0x20
DECL|macro|F_NEW_SCCB_CMD
mdefine_line|#define F_NEW_SCCB_CMD&t;&t;0x40
DECL|macro|F_UPDATE_EEPROM
mdefine_line|#define F_UPDATE_EEPROM&t;&t;0x80
DECL|macro|ID_STRING_LENGTH
mdefine_line|#define  ID_STRING_LENGTH  32
DECL|macro|TYPE_CODE0
mdefine_line|#define  TYPE_CODE0        0x63           /*Level2 Mstr (bits 7-6),  */
DECL|macro|TYPE_CODE1
mdefine_line|#define  TYPE_CODE1        00             /*No ID yet */
DECL|macro|SLV_TYPE_CODE0
mdefine_line|#define  SLV_TYPE_CODE0    0xA3           /*Priority Bit set (bits 7-6),  */
DECL|macro|ASSIGN_ID
mdefine_line|#define  ASSIGN_ID   0x00
DECL|macro|SET_P_FLAG
mdefine_line|#define  SET_P_FLAG  0x01
DECL|macro|CFG_CMPLT
mdefine_line|#define  CFG_CMPLT   0x03
DECL|macro|DOM_MSTR
mdefine_line|#define  DOM_MSTR    0x0F
DECL|macro|SYNC_PTRN
mdefine_line|#define  SYNC_PTRN   0x1F
DECL|macro|ID_0_7
mdefine_line|#define  ID_0_7      0x18
DECL|macro|ID_8_F
mdefine_line|#define  ID_8_F      0x11
DECL|macro|ID_10_17
mdefine_line|#define  ID_10_17    0x12
DECL|macro|ID_18_1F
mdefine_line|#define  ID_18_1F    0x0B
DECL|macro|MISC_CODE
mdefine_line|#define  MISC_CODE   0x14
DECL|macro|CLR_P_FLAG
mdefine_line|#define  CLR_P_FLAG  0x18
DECL|macro|LOCATE_ON
mdefine_line|#define  LOCATE_ON   0x12
DECL|macro|LOCATE_OFF
mdefine_line|#define  LOCATE_OFF  0x0B
DECL|macro|LVL_1_MST
mdefine_line|#define  LVL_1_MST   0x00
DECL|macro|LVL_2_MST
mdefine_line|#define  LVL_2_MST   0x40
DECL|macro|DOM_LVL_2
mdefine_line|#define  DOM_LVL_2   0xC0
DECL|macro|INIT_SELTD
mdefine_line|#define  INIT_SELTD  0x01
DECL|macro|LEVEL2_TAR
mdefine_line|#define  LEVEL2_TAR  0x02
DECL|enum|scam_id_st
DECL|enumerator|ID0
DECL|enumerator|ID1
DECL|enumerator|ID2
DECL|enumerator|ID3
DECL|enumerator|ID4
DECL|enumerator|ID5
DECL|enumerator|ID6
DECL|enumerator|ID7
DECL|enumerator|ID8
DECL|enumerator|ID9
DECL|enumerator|ID10
DECL|enumerator|ID11
DECL|enumerator|ID12
r_enum
id|scam_id_st
(brace
id|ID0
comma
id|ID1
comma
id|ID2
comma
id|ID3
comma
id|ID4
comma
id|ID5
comma
id|ID6
comma
id|ID7
comma
id|ID8
comma
id|ID9
comma
id|ID10
comma
id|ID11
comma
id|ID12
comma
DECL|enumerator|ID13
DECL|enumerator|ID14
DECL|enumerator|ID15
DECL|enumerator|ID_UNUSED
DECL|enumerator|ID_UNASSIGNED
DECL|enumerator|ID_ASSIGNED
DECL|enumerator|LEGACY
id|ID13
comma
id|ID14
comma
id|ID15
comma
id|ID_UNUSED
comma
id|ID_UNASSIGNED
comma
id|ID_ASSIGNED
comma
id|LEGACY
comma
DECL|enumerator|CLR_PRIORITY
DECL|enumerator|NO_ID_AVAIL
id|CLR_PRIORITY
comma
id|NO_ID_AVAIL
)brace
suffix:semicolon
DECL|struct|SCCBscam_info
r_typedef
r_struct
id|SCCBscam_info
(brace
DECL|member|id_string
id|UCHAR
id|id_string
(braket
id|ID_STRING_LENGTH
)braket
suffix:semicolon
DECL|member|state
r_enum
id|scam_id_st
id|state
suffix:semicolon
DECL|typedef|SCCBSCAM_INFO
DECL|typedef|PSCCBSCAM_INFO
)brace
id|SCCBSCAM_INFO
comma
op_star
id|PSCCBSCAM_INFO
suffix:semicolon
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   scsi2.h  $&n; *&n; *   Description:  Register definitions for HARPOON ASIC.&n; *&n; *   $Date: 1996/11/13 18:32:57 $&n; *&n; *   $Revision: 1.4 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __SCSI_H__
DECL|macro|__SCSI_H__
mdefine_line|#define __SCSI_H__
DECL|macro|SCSI_TEST_UNIT_READY
mdefine_line|#define  SCSI_TEST_UNIT_READY    0x00
DECL|macro|SCSI_REZERO_UNIT
mdefine_line|#define  SCSI_REZERO_UNIT        0x01
DECL|macro|SCSI_REQUEST_SENSE
mdefine_line|#define  SCSI_REQUEST_SENSE      0x03
DECL|macro|SCSI_FORMAT_UNIT
mdefine_line|#define  SCSI_FORMAT_UNIT        0x04
DECL|macro|SCSI_REASSIGN
mdefine_line|#define  SCSI_REASSIGN           0x07
DECL|macro|SCSI_READ
mdefine_line|#define  SCSI_READ               0x08
DECL|macro|SCSI_WRITE
mdefine_line|#define  SCSI_WRITE              0x0A
DECL|macro|SCSI_SEEK
mdefine_line|#define  SCSI_SEEK               0x0B
DECL|macro|SCSI_INQUIRY
mdefine_line|#define  SCSI_INQUIRY            0x12
DECL|macro|SCSI_MODE_SELECT
mdefine_line|#define  SCSI_MODE_SELECT        0x15
DECL|macro|SCSI_RESERVE_UNIT
mdefine_line|#define  SCSI_RESERVE_UNIT       0x16
DECL|macro|SCSI_RELEASE_UNIT
mdefine_line|#define  SCSI_RELEASE_UNIT       0x17
DECL|macro|SCSI_MODE_SENSE
mdefine_line|#define  SCSI_MODE_SENSE         0x1A
DECL|macro|SCSI_START_STOP_UNIT
mdefine_line|#define  SCSI_START_STOP_UNIT    0x1B
DECL|macro|SCSI_SEND_DIAGNOSTIC
mdefine_line|#define  SCSI_SEND_DIAGNOSTIC    0x1D
DECL|macro|SCSI_READ_CAPACITY
mdefine_line|#define  SCSI_READ_CAPACITY      0x25
DECL|macro|SCSI_READ_EXTENDED
mdefine_line|#define  SCSI_READ_EXTENDED      0x28
DECL|macro|SCSI_WRITE_EXTENDED
mdefine_line|#define  SCSI_WRITE_EXTENDED     0x2A
DECL|macro|SCSI_SEEK_EXTENDED
mdefine_line|#define  SCSI_SEEK_EXTENDED      0x2B
DECL|macro|SCSI_WRITE_AND_VERIFY
mdefine_line|#define  SCSI_WRITE_AND_VERIFY   0x2E
DECL|macro|SCSI_VERIFY
mdefine_line|#define  SCSI_VERIFY             0x2F
DECL|macro|SCSI_READ_DEFECT_DATA
mdefine_line|#define  SCSI_READ_DEFECT_DATA   0x37
DECL|macro|SCSI_WRITE_BUFFER
mdefine_line|#define  SCSI_WRITE_BUFFER       0x3B
DECL|macro|SCSI_READ_BUFFER
mdefine_line|#define  SCSI_READ_BUFFER        0x3C
DECL|macro|SCSI_RECV_DIAGNOSTIC
mdefine_line|#define  SCSI_RECV_DIAGNOSTIC    0x1C
DECL|macro|SCSI_READ_LONG
mdefine_line|#define  SCSI_READ_LONG          0x3E
DECL|macro|SCSI_WRITE_LONG
mdefine_line|#define  SCSI_WRITE_LONG         0x3F
DECL|macro|SCSI_LAST_SCSI_CMND
mdefine_line|#define  SCSI_LAST_SCSI_CMND     SCSI_WRITE_LONG
DECL|macro|SCSI_INVALID_CMND
mdefine_line|#define  SCSI_INVALID_CMND       0xFF
DECL|macro|SSGOOD
mdefine_line|#define  SSGOOD                  0x00
DECL|macro|SSCHECK
mdefine_line|#define  SSCHECK                 0x02
DECL|macro|SSCOND_MET
mdefine_line|#define  SSCOND_MET              0x04
DECL|macro|SSBUSY
mdefine_line|#define  SSBUSY                  0x08
DECL|macro|SSRESERVATION_CONFLICT
mdefine_line|#define  SSRESERVATION_CONFLICT  0x18
DECL|macro|SSCMD_TERM
mdefine_line|#define  SSCMD_TERM              0x22
DECL|macro|SSQ_FULL
mdefine_line|#define  SSQ_FULL                0x28
DECL|macro|SKNO_SEN
mdefine_line|#define  SKNO_SEN                0x00
DECL|macro|SKRECOV_ERR
mdefine_line|#define  SKRECOV_ERR             0x01
DECL|macro|SKNOT_RDY
mdefine_line|#define  SKNOT_RDY               0x02
DECL|macro|SKMED_ERR
mdefine_line|#define  SKMED_ERR               0x03
DECL|macro|SKHW_ERR
mdefine_line|#define  SKHW_ERR                0x04
DECL|macro|SKILL_REQ
mdefine_line|#define  SKILL_REQ               0x05
DECL|macro|SKUNIT_ATTN
mdefine_line|#define  SKUNIT_ATTN             0x06
DECL|macro|SKDATA_PROTECT
mdefine_line|#define  SKDATA_PROTECT          0x07
DECL|macro|SKBLNK_CHK
mdefine_line|#define  SKBLNK_CHK              0x08
DECL|macro|SKCPY_ABORT
mdefine_line|#define  SKCPY_ABORT             0x0A
DECL|macro|SKABORT_CMD
mdefine_line|#define  SKABORT_CMD             0x0B
DECL|macro|SKEQUAL
mdefine_line|#define  SKEQUAL                 0x0C
DECL|macro|SKVOL_OVF
mdefine_line|#define  SKVOL_OVF               0x0D
DECL|macro|SKMIS_CMP
mdefine_line|#define  SKMIS_CMP               0x0E
DECL|macro|SMCMD_COMP
mdefine_line|#define  SMCMD_COMP              0x00
DECL|macro|SMEXT
mdefine_line|#define  SMEXT                   0x01
DECL|macro|SMSAVE_DATA_PTR
mdefine_line|#define  SMSAVE_DATA_PTR         0x02
DECL|macro|SMREST_DATA_PTR
mdefine_line|#define  SMREST_DATA_PTR         0x03
DECL|macro|SMDISC
mdefine_line|#define  SMDISC                  0x04
DECL|macro|SMINIT_DETEC_ERR
mdefine_line|#define  SMINIT_DETEC_ERR        0x05
DECL|macro|SMABORT
mdefine_line|#define  SMABORT                 0x06
DECL|macro|SMREJECT
mdefine_line|#define  SMREJECT                0x07
DECL|macro|SMNO_OP
mdefine_line|#define  SMNO_OP                 0x08
DECL|macro|SMPARITY
mdefine_line|#define  SMPARITY                0x09
DECL|macro|SMDEV_RESET
mdefine_line|#define  SMDEV_RESET             0x0C
DECL|macro|SMABORT_TAG
mdefine_line|#define&t;SMABORT_TAG&t;&t;&t;&t;&t;0x0D
DECL|macro|SMINIT_RECOVERY
mdefine_line|#define&t;SMINIT_RECOVERY&t;&t;&t;0x0F
DECL|macro|SMREL_RECOVERY
mdefine_line|#define&t;SMREL_RECOVERY&t;&t;&t;&t;0x10
DECL|macro|SMIDENT
mdefine_line|#define  SMIDENT                 0x80
DECL|macro|DISC_PRIV
mdefine_line|#define  DISC_PRIV               0x40
DECL|macro|SMSYNC
mdefine_line|#define  SMSYNC                  0x01
DECL|macro|SM10MBS
mdefine_line|#define  SM10MBS                 0x19     /* 100ns           */
DECL|macro|SM5MBS
mdefine_line|#define  SM5MBS                  0x32     /* 200ns           */
DECL|macro|SMOFFSET
mdefine_line|#define  SMOFFSET                0x0F     /* Maxoffset value */
DECL|macro|SMWDTR
mdefine_line|#define  SMWDTR                  0x03
DECL|macro|SM8BIT
mdefine_line|#define  SM8BIT                  0x00
DECL|macro|SM16BIT
mdefine_line|#define  SM16BIT                 0x01
DECL|macro|SM32BIT
mdefine_line|#define  SM32BIT                 0x02
DECL|macro|SMIGNORWR
mdefine_line|#define  SMIGNORWR               0x23     /* Ignore Wide Residue */
DECL|macro|ARBITRATION_DELAY
mdefine_line|#define  ARBITRATION_DELAY       0x01     /* 2.4us using a 40Mhz clock */
DECL|macro|BUS_SETTLE_DELAY
mdefine_line|#define  BUS_SETTLE_DELAY        0x01     /* 400ns */
DECL|macro|BUS_CLEAR_DELAY
mdefine_line|#define  BUS_CLEAR_DELAY         0x01     /* 800ns */
DECL|macro|SPHASE_TO
mdefine_line|#define  SPHASE_TO               0x0A  /* 10 second timeout waiting for */
DECL|macro|SCMD_TO
mdefine_line|#define  SCMD_TO                 0x0F  /* Overall command timeout */
DECL|macro|SIX_BYTE_CMD
mdefine_line|#define  SIX_BYTE_CMD            0x06
DECL|macro|TEN_BYTE_CMD
mdefine_line|#define  TEN_BYTE_CMD            0x0A
DECL|macro|TWELVE_BYTE_CMD
mdefine_line|#define  TWELVE_BYTE_CMD         0x0C
DECL|macro|ASYNC
mdefine_line|#define  ASYNC                   0x00
DECL|macro|PERI25NS
mdefine_line|#define  PERI25NS                0x06  /* 25/4ns to next clock for xbow. */
DECL|macro|SYNC10MBS
mdefine_line|#define  SYNC10MBS               0x19
DECL|macro|SYNC5MBS
mdefine_line|#define  SYNC5MBS                0x32
DECL|macro|MAX_OFFSET
mdefine_line|#define  MAX_OFFSET              0x0F  /* Maxbyteoffset for Sync Xfers */
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------------&n; *  &n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   eeprom.h  $&n; *&n; *   Description:  Definitions for EEPROM related structures&n; *&n; *   $Date: 1996/11/13 18:28:39 $&n; *&n; *   $Revision: 1.4 $&n; *&n; *----------------------------------------------------------------------*/
macro_line|#ifndef __EEPROM__
DECL|macro|__EEPROM__
mdefine_line|#define __EEPROM__
multiline_comment|/*#include &lt;globals.h&gt;*/
DECL|macro|EEPROM_WD_CNT
mdefine_line|#define  EEPROM_WD_CNT     256
DECL|macro|EEPROM_CHECK_SUM
mdefine_line|#define  EEPROM_CHECK_SUM  0
DECL|macro|FW_SIGNATURE
mdefine_line|#define  FW_SIGNATURE      2
DECL|macro|MODEL_NUMB_0
mdefine_line|#define  MODEL_NUMB_0      4
DECL|macro|MODEL_NUMB_1
mdefine_line|#define  MODEL_NUMB_1      5
DECL|macro|MODEL_NUMB_2
mdefine_line|#define  MODEL_NUMB_2      6
DECL|macro|MODEL_NUMB_3
mdefine_line|#define  MODEL_NUMB_3      7
DECL|macro|MODEL_NUMB_4
mdefine_line|#define  MODEL_NUMB_4      8
DECL|macro|MODEL_NUMB_5
mdefine_line|#define  MODEL_NUMB_5      9
DECL|macro|IO_BASE_ADDR
mdefine_line|#define  IO_BASE_ADDR      10
DECL|macro|IRQ_NUMBER
mdefine_line|#define  IRQ_NUMBER        12
DECL|macro|PCI_INT_PIN
mdefine_line|#define  PCI_INT_PIN       13
DECL|macro|BUS_DELAY
mdefine_line|#define  BUS_DELAY         14       /*On time in byte 14 off delay in 15 */
DECL|macro|SYSTEM_CONFIG
mdefine_line|#define  SYSTEM_CONFIG     16
DECL|macro|SCSI_CONFIG
mdefine_line|#define  SCSI_CONFIG       17
DECL|macro|BIOS_CONFIG
mdefine_line|#define  BIOS_CONFIG       18
DECL|macro|SPIN_UP_DELAY
mdefine_line|#define  SPIN_UP_DELAY     19
DECL|macro|SCAM_CONFIG
mdefine_line|#define  SCAM_CONFIG       20
DECL|macro|ADAPTER_SCSI_ID
mdefine_line|#define  ADAPTER_SCSI_ID   24
DECL|macro|IGNORE_B_SCAN
mdefine_line|#define  IGNORE_B_SCAN     32
DECL|macro|SEND_START_ENA
mdefine_line|#define  SEND_START_ENA    34
DECL|macro|DEVICE_ENABLE
mdefine_line|#define  DEVICE_ENABLE     36
DECL|macro|SYNC_RATE_TBL
mdefine_line|#define  SYNC_RATE_TBL     38
DECL|macro|SYNC_RATE_TBL01
mdefine_line|#define  SYNC_RATE_TBL01   38
DECL|macro|SYNC_RATE_TBL23
mdefine_line|#define  SYNC_RATE_TBL23   40
DECL|macro|SYNC_RATE_TBL45
mdefine_line|#define  SYNC_RATE_TBL45   42
DECL|macro|SYNC_RATE_TBL67
mdefine_line|#define  SYNC_RATE_TBL67   44
DECL|macro|SYNC_RATE_TBL89
mdefine_line|#define  SYNC_RATE_TBL89   46
DECL|macro|SYNC_RATE_TBLab
mdefine_line|#define  SYNC_RATE_TBLab   48
DECL|macro|SYNC_RATE_TBLcd
mdefine_line|#define  SYNC_RATE_TBLcd   50
DECL|macro|SYNC_RATE_TBLef
mdefine_line|#define  SYNC_RATE_TBLef   52
DECL|macro|EE_SCAMBASE
mdefine_line|#define  EE_SCAMBASE      256 
DECL|macro|DOM_MASTER
mdefine_line|#define  DOM_MASTER     (BIT(0) + BIT(1))
DECL|macro|SCAM_ENABLED
mdefine_line|#define  SCAM_ENABLED   BIT(2)
DECL|macro|SCAM_LEVEL2
mdefine_line|#define  SCAM_LEVEL2    BIT(3)
DECL|macro|RENEGO_ENA
mdefine_line|#define&t;RENEGO_ENA&t;&t;BITW(10)
DECL|macro|CONNIO_ENA
mdefine_line|#define&t;CONNIO_ENA&t;&t;BITW(11)
DECL|macro|GREEN_PC_ENA
mdefine_line|#define  GREEN_PC_ENA   BITW(12)
DECL|macro|AUTO_RATE_00
mdefine_line|#define  AUTO_RATE_00   00
DECL|macro|AUTO_RATE_05
mdefine_line|#define  AUTO_RATE_05   01
DECL|macro|AUTO_RATE_10
mdefine_line|#define  AUTO_RATE_10   02
DECL|macro|AUTO_RATE_20
mdefine_line|#define  AUTO_RATE_20   03
DECL|macro|WIDE_NEGO_BIT
mdefine_line|#define  WIDE_NEGO_BIT     BIT(7)
DECL|macro|DISC_ENABLE_BIT
mdefine_line|#define  DISC_ENABLE_BIT   BIT(6)
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   harpoon.h  $&n; *&n; *   Description:  Register definitions for HARPOON ASIC.&n; *&n; *   $Date: 1997/07/09 21:44:36 $&n; *&n; *   $Revision: 1.9 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#ifndef __HARPOON__
DECL|macro|__HARPOON__
mdefine_line|#define __HARPOON__
DECL|macro|hp_vendor_id_0
mdefine_line|#define  hp_vendor_id_0       0x00&t;&t;/* LSB */
DECL|macro|ORION_VEND_0
mdefine_line|#define  ORION_VEND_0   0x4B
DECL|macro|hp_vendor_id_1
mdefine_line|#define  hp_vendor_id_1       0x01&t;&t;/* MSB */
DECL|macro|ORION_VEND_1
mdefine_line|#define  ORION_VEND_1   0x10
DECL|macro|hp_device_id_0
mdefine_line|#define  hp_device_id_0       0x02&t;&t;/* LSB */
DECL|macro|ORION_DEV_0
mdefine_line|#define  ORION_DEV_0    0x30 
DECL|macro|hp_device_id_1
mdefine_line|#define  hp_device_id_1       0x03&t;&t;/* MSB */
DECL|macro|ORION_DEV_1
mdefine_line|#define  ORION_DEV_1    0x81 
multiline_comment|/* Sub Vendor ID and Sub Device ID only available in&n;&t;&t;Harpoon Version 2 and higher */
DECL|macro|hp_sub_vendor_id_0
mdefine_line|#define  hp_sub_vendor_id_0   0x04&t;&t;/* LSB */
DECL|macro|hp_sub_vendor_id_1
mdefine_line|#define  hp_sub_vendor_id_1   0x05&t;&t;/* MSB */
DECL|macro|hp_sub_device_id_0
mdefine_line|#define  hp_sub_device_id_0   0x06&t;&t;/* LSB */
DECL|macro|hp_sub_device_id_1
mdefine_line|#define  hp_sub_device_id_1   0x07&t;&t;/* MSB */
DECL|macro|hp_dual_addr_lo
mdefine_line|#define  hp_dual_addr_lo      0x08
DECL|macro|hp_dual_addr_lmi
mdefine_line|#define  hp_dual_addr_lmi     0x09
DECL|macro|hp_dual_addr_hmi
mdefine_line|#define  hp_dual_addr_hmi     0x0A
DECL|macro|hp_dual_addr_hi
mdefine_line|#define  hp_dual_addr_hi      0x0B
DECL|macro|hp_semaphore
mdefine_line|#define  hp_semaphore         0x0C
DECL|macro|SCCB_MGR_ACTIVE
mdefine_line|#define SCCB_MGR_ACTIVE    BIT(0)
DECL|macro|TICKLE_ME
mdefine_line|#define TICKLE_ME          BIT(1)
DECL|macro|SCCB_MGR_PRESENT
mdefine_line|#define SCCB_MGR_PRESENT   BIT(3)
DECL|macro|BIOS_IN_USE
mdefine_line|#define BIOS_IN_USE        BIT(4)
DECL|macro|hp_user_defined_D
mdefine_line|#define  hp_user_defined_D    0x0D
DECL|macro|hp_reserved_E
mdefine_line|#define  hp_reserved_E        0x0E
DECL|macro|hp_sys_ctrl
mdefine_line|#define  hp_sys_ctrl          0x0F
DECL|macro|STOP_CLK
mdefine_line|#define  STOP_CLK          BIT(0)      /*Turn off BusMaster Clock */
DECL|macro|DRVR_RST
mdefine_line|#define  DRVR_RST          BIT(1)      /*Firmware Reset to 80C15 chip */
DECL|macro|HALT_MACH
mdefine_line|#define  HALT_MACH         BIT(3)      /*Halt State Machine      */
DECL|macro|HARD_ABORT
mdefine_line|#define  HARD_ABORT        BIT(4)      /*Hard Abort              */
DECL|macro|DIAG_MODE
mdefine_line|#define  DIAG_MODE         BIT(5)      /*Diagnostic Mode         */
DECL|macro|BM_ABORT_TMOUT
mdefine_line|#define  BM_ABORT_TMOUT    0x50        /*Halt State machine time out */
DECL|macro|hp_sys_cfg
mdefine_line|#define  hp_sys_cfg           0x10
DECL|macro|DONT_RST_FIFO
mdefine_line|#define  DONT_RST_FIFO     BIT(7)      /*Don&squot;t reset FIFO      */
DECL|macro|hp_host_ctrl0
mdefine_line|#define  hp_host_ctrl0        0x11
DECL|macro|DUAL_ADDR_MODE
mdefine_line|#define  DUAL_ADDR_MODE    BIT(0)   /*Enable 64-bit addresses */
DECL|macro|IO_MEM_SPACE
mdefine_line|#define  IO_MEM_SPACE      BIT(1)   /*I/O Memory Space    */
DECL|macro|RESOURCE_LOCK
mdefine_line|#define  RESOURCE_LOCK     BIT(2)   /*Enable Resource Lock */
DECL|macro|IGNOR_ACCESS_ERR
mdefine_line|#define  IGNOR_ACCESS_ERR  BIT(3)   /*Ignore Access Error */
DECL|macro|HOST_INT_EDGE
mdefine_line|#define  HOST_INT_EDGE     BIT(4)   /*Host interrupt level/edge mode sel */
DECL|macro|SIX_CLOCKS
mdefine_line|#define  SIX_CLOCKS        BIT(5)   /*6 Clocks between Strobe   */
DECL|macro|DMA_EVEN_PARITY
mdefine_line|#define  DMA_EVEN_PARITY   BIT(6)   /*Enable DMA Enen Parity */
multiline_comment|/*&n;      #define  BURST_MODE        BIT(0)&n;*/
DECL|macro|hp_reserved_12
mdefine_line|#define  hp_reserved_12       0x12
DECL|macro|hp_host_blk_cnt
mdefine_line|#define  hp_host_blk_cnt      0x13
DECL|macro|XFER_BLK1
mdefine_line|#define  XFER_BLK1         0x00     /*     0 0 0  1 byte per block*/
DECL|macro|XFER_BLK2
mdefine_line|#define  XFER_BLK2         0x01     /*     0 0 1  2 byte per block*/
DECL|macro|XFER_BLK4
mdefine_line|#define  XFER_BLK4         0x02     /*     0 1 0  4 byte per block*/
DECL|macro|XFER_BLK8
mdefine_line|#define  XFER_BLK8         0x03     /*     0 1 1  8 byte per block*/
DECL|macro|XFER_BLK16
mdefine_line|#define  XFER_BLK16        0x04     /*     1 0 0 16 byte per block*/
DECL|macro|XFER_BLK32
mdefine_line|#define  XFER_BLK32        0x05     /*     1 0 1 32 byte per block*/
DECL|macro|XFER_BLK64
mdefine_line|#define  XFER_BLK64        0x06     /*     1 1 0 64 byte per block*/
DECL|macro|BM_THRESHOLD
mdefine_line|#define  BM_THRESHOLD      0x40     /* PCI mode can only xfer 16 bytes*/
DECL|macro|hp_reserved_14
mdefine_line|#define  hp_reserved_14       0x14
DECL|macro|hp_reserved_15
mdefine_line|#define  hp_reserved_15       0x15
DECL|macro|hp_reserved_16
mdefine_line|#define  hp_reserved_16       0x16
DECL|macro|hp_int_mask
mdefine_line|#define  hp_int_mask          0x17
DECL|macro|INT_CMD_COMPL
mdefine_line|#define  INT_CMD_COMPL     BIT(0)   /* DMA command complete   */
DECL|macro|INT_EXT_STATUS
mdefine_line|#define  INT_EXT_STATUS    BIT(1)   /* Extended Status Set    */
DECL|macro|INT_SCSI
mdefine_line|#define  INT_SCSI          BIT(2)   /* Scsi block interrupt   */
DECL|macro|INT_FIFO_RDY
mdefine_line|#define  INT_FIFO_RDY      BIT(4)   /* FIFO data ready        */
DECL|macro|hp_xfer_cnt_lo
mdefine_line|#define  hp_xfer_cnt_lo       0x18
DECL|macro|hp_xfer_cnt_mi
mdefine_line|#define  hp_xfer_cnt_mi       0x19
DECL|macro|hp_xfer_cnt_hi
mdefine_line|#define  hp_xfer_cnt_hi       0x1A
DECL|macro|hp_xfer_cmd
mdefine_line|#define  hp_xfer_cmd          0x1B
DECL|macro|XFER_HOST_DMA
mdefine_line|#define  XFER_HOST_DMA     0x00     /*     0 0 0 Transfer Host -&gt; DMA */
DECL|macro|XFER_DMA_HOST
mdefine_line|#define  XFER_DMA_HOST     0x01     /*     0 0 1 Transfer DMA  -&gt; Host */
DECL|macro|XFER_HOST_MPU
mdefine_line|#define  XFER_HOST_MPU     0x02     /*     0 1 0 Transfer Host -&gt; MPU  */
DECL|macro|XFER_MPU_HOST
mdefine_line|#define  XFER_MPU_HOST     0x03     /*     0 1 1 Transfer MPU  -&gt; Host */
DECL|macro|XFER_DMA_MPU
mdefine_line|#define  XFER_DMA_MPU      0x04     /*     1 0 0 Transfer DMA  -&gt; MPU  */
DECL|macro|XFER_MPU_DMA
mdefine_line|#define  XFER_MPU_DMA      0x05     /*     1 0 1 Transfer MPU  -&gt; DMA  */
DECL|macro|SET_SEMAPHORE
mdefine_line|#define  SET_SEMAPHORE     0x06     /*     1 1 0 Set Semaphore         */
DECL|macro|XFER_NOP
mdefine_line|#define  XFER_NOP          0x07     /*     1 1 1 Transfer NOP          */
DECL|macro|XFER_MB_MPU
mdefine_line|#define  XFER_MB_MPU       0x06     /*     1 1 0 Transfer MB -&gt; MPU */
DECL|macro|XFER_MB_DMA
mdefine_line|#define  XFER_MB_DMA       0x07     /*     1 1 1 Transfer MB -&gt; DMA */
DECL|macro|XFER_HOST_AUTO
mdefine_line|#define  XFER_HOST_AUTO    0x00     /*     0 0 Auto Transfer Size   */
DECL|macro|XFER_HOST_8BIT
mdefine_line|#define  XFER_HOST_8BIT    0x08     /*     0 1 8 BIT Transfer Size  */
DECL|macro|XFER_HOST_16BIT
mdefine_line|#define  XFER_HOST_16BIT   0x10     /*     1 0 16 BIT Transfer Size */
DECL|macro|XFER_HOST_32BIT
mdefine_line|#define  XFER_HOST_32BIT   0x18     /*     1 1 32 BIT Transfer Size */
DECL|macro|XFER_DMA_8BIT
mdefine_line|#define  XFER_DMA_8BIT     0x20     /*     0 1 8 BIT  Transfer Size */
DECL|macro|XFER_DMA_16BIT
mdefine_line|#define  XFER_DMA_16BIT    0x40     /*     1 0 16 BIT Transfer Size */
DECL|macro|DISABLE_INT
mdefine_line|#define  DISABLE_INT       BIT(7)   /*Do not interrupt at end of cmd. */
DECL|macro|HOST_WRT_CMD
mdefine_line|#define  HOST_WRT_CMD      ((DISABLE_INT + XFER_HOST_DMA + XFER_HOST_AUTO + XFER_DMA_8BIT))
DECL|macro|HOST_RD_CMD
mdefine_line|#define  HOST_RD_CMD       ((DISABLE_INT + XFER_DMA_HOST + XFER_HOST_AUTO + XFER_DMA_8BIT))
DECL|macro|WIDE_HOST_WRT_CMD
mdefine_line|#define  WIDE_HOST_WRT_CMD ((DISABLE_INT + XFER_HOST_DMA + XFER_HOST_AUTO + XFER_DMA_16BIT))
DECL|macro|WIDE_HOST_RD_CMD
mdefine_line|#define  WIDE_HOST_RD_CMD  ((DISABLE_INT + XFER_DMA_HOST + XFER_HOST_AUTO + XFER_DMA_16BIT))
DECL|macro|hp_host_addr_lo
mdefine_line|#define  hp_host_addr_lo      0x1C
DECL|macro|hp_host_addr_lmi
mdefine_line|#define  hp_host_addr_lmi     0x1D
DECL|macro|hp_host_addr_hmi
mdefine_line|#define  hp_host_addr_hmi     0x1E
DECL|macro|hp_host_addr_hi
mdefine_line|#define  hp_host_addr_hi      0x1F
DECL|macro|hp_pio_data
mdefine_line|#define  hp_pio_data          0x20
DECL|macro|hp_reserved_21
mdefine_line|#define  hp_reserved_21       0x21
DECL|macro|hp_ee_ctrl
mdefine_line|#define  hp_ee_ctrl           0x22
DECL|macro|EXT_ARB_ACK
mdefine_line|#define  EXT_ARB_ACK       BIT(7)
DECL|macro|SCSI_TERM_ENA_H
mdefine_line|#define  SCSI_TERM_ENA_H   BIT(6)   /* SCSI high byte terminator */
DECL|macro|SEE_MS
mdefine_line|#define  SEE_MS            BIT(5)
DECL|macro|SEE_CS
mdefine_line|#define  SEE_CS            BIT(3)
DECL|macro|SEE_CLK
mdefine_line|#define  SEE_CLK           BIT(2)
DECL|macro|SEE_DO
mdefine_line|#define  SEE_DO            BIT(1)
DECL|macro|SEE_DI
mdefine_line|#define  SEE_DI            BIT(0)
DECL|macro|EE_READ
mdefine_line|#define  EE_READ           0x06
DECL|macro|EE_WRITE
mdefine_line|#define  EE_WRITE          0x05
DECL|macro|EWEN
mdefine_line|#define  EWEN              0x04
DECL|macro|EWEN_ADDR
mdefine_line|#define  EWEN_ADDR         0x03C0
DECL|macro|EWDS
mdefine_line|#define  EWDS              0x04
DECL|macro|EWDS_ADDR
mdefine_line|#define  EWDS_ADDR         0x0000
DECL|macro|hp_brdctl
mdefine_line|#define  hp_brdctl            0x23
DECL|macro|DAT_7
mdefine_line|#define  DAT_7             BIT(7)
DECL|macro|DAT_6
mdefine_line|#define  DAT_6             BIT(6)
DECL|macro|DAT_5
mdefine_line|#define  DAT_5             BIT(5)
DECL|macro|BRD_STB
mdefine_line|#define  BRD_STB           BIT(4)
DECL|macro|BRD_CS
mdefine_line|#define  BRD_CS            BIT(3)
DECL|macro|BRD_WR
mdefine_line|#define  BRD_WR            BIT(2)
DECL|macro|hp_reserved_24
mdefine_line|#define  hp_reserved_24       0x24
DECL|macro|hp_reserved_25
mdefine_line|#define  hp_reserved_25       0x25
DECL|macro|hp_bm_ctrl
mdefine_line|#define  hp_bm_ctrl           0x26
DECL|macro|SCSI_TERM_ENA_L
mdefine_line|#define  SCSI_TERM_ENA_L   BIT(0)   /*Enable/Disable external terminators */
DECL|macro|FLUSH_XFER_CNTR
mdefine_line|#define  FLUSH_XFER_CNTR   BIT(1)   /*Flush transfer counter */
DECL|macro|BM_XFER_MIN_8
mdefine_line|#define  BM_XFER_MIN_8     BIT(2)   /*Enable bus master transfer of 9 */
DECL|macro|BIOS_ENA
mdefine_line|#define  BIOS_ENA          BIT(3)   /*Enable BIOS/FLASH Enable */
DECL|macro|FORCE1_XFER
mdefine_line|#define  FORCE1_XFER       BIT(5)   /*Always xfer one byte in byte mode */
DECL|macro|FAST_SINGLE
mdefine_line|#define  FAST_SINGLE       BIT(6)   /*?? */
DECL|macro|BMCTRL_DEFAULT
mdefine_line|#define  BMCTRL_DEFAULT    (FORCE1_XFER|FAST_SINGLE|SCSI_TERM_ENA_L)
DECL|macro|hp_reserved_27
mdefine_line|#define  hp_reserved_27       0x27
DECL|macro|hp_sg_addr
mdefine_line|#define  hp_sg_addr           0x28
DECL|macro|hp_page_ctrl
mdefine_line|#define  hp_page_ctrl         0x29
DECL|macro|SCATTER_EN
mdefine_line|#define  SCATTER_EN        BIT(0)   
DECL|macro|SGRAM_ARAM
mdefine_line|#define  SGRAM_ARAM        BIT(1)   
DECL|macro|BIOS_SHADOW
mdefine_line|#define  BIOS_SHADOW       BIT(2)   
DECL|macro|G_INT_DISABLE
mdefine_line|#define  G_INT_DISABLE     BIT(3)   /* Enable/Disable all Interrupts */
DECL|macro|NARROW_SCSI_CARD
mdefine_line|#define  NARROW_SCSI_CARD  BIT(4)   /* NARROW/WIDE SCSI config pin */
DECL|macro|hp_reserved_2A
mdefine_line|#define  hp_reserved_2A       0x2A
DECL|macro|hp_pci_cmd_cfg
mdefine_line|#define  hp_pci_cmd_cfg       0x2B
DECL|macro|IO_SPACE_ENA
mdefine_line|#define  IO_SPACE_ENA      BIT(0)   /*enable I/O space */
DECL|macro|MEM_SPACE_ENA
mdefine_line|#define  MEM_SPACE_ENA     BIT(1)   /*enable memory space */
DECL|macro|BUS_MSTR_ENA
mdefine_line|#define  BUS_MSTR_ENA      BIT(2)   /*enable bus master operation */
DECL|macro|MEM_WI_ENA
mdefine_line|#define  MEM_WI_ENA        BIT(4)   /*enable Write and Invalidate */
DECL|macro|PAR_ERR_RESP
mdefine_line|#define  PAR_ERR_RESP      BIT(6)   /*enable parity error responce. */
DECL|macro|hp_reserved_2C
mdefine_line|#define  hp_reserved_2C       0x2C
DECL|macro|hp_pci_stat_cfg
mdefine_line|#define  hp_pci_stat_cfg      0x2D
DECL|macro|DATA_PARITY_ERR
mdefine_line|#define  DATA_PARITY_ERR   BIT(0)   
DECL|macro|REC_TARGET_ABORT
mdefine_line|#define  REC_TARGET_ABORT  BIT(4)   /*received Target abort */
DECL|macro|REC_MASTER_ABORT
mdefine_line|#define  REC_MASTER_ABORT  BIT(5)   /*received Master abort */
DECL|macro|SIG_SYSTEM_ERR
mdefine_line|#define  SIG_SYSTEM_ERR    BIT(6)   
DECL|macro|DETECTED_PAR_ERR
mdefine_line|#define  DETECTED_PAR_ERR  BIT(7)   
DECL|macro|hp_reserved_2E
mdefine_line|#define  hp_reserved_2E       0x2E
DECL|macro|hp_sys_status
mdefine_line|#define  hp_sys_status        0x2F
DECL|macro|SLV_DATA_RDY
mdefine_line|#define  SLV_DATA_RDY      BIT(0)   /*Slave data ready */
DECL|macro|XFER_CNT_ZERO
mdefine_line|#define  XFER_CNT_ZERO     BIT(1)   /*Transfer counter = 0 */
DECL|macro|BM_FIFO_EMPTY
mdefine_line|#define  BM_FIFO_EMPTY     BIT(2)   /*FIFO empty */
DECL|macro|BM_FIFO_FULL
mdefine_line|#define  BM_FIFO_FULL      BIT(3)   /*FIFO full */
DECL|macro|HOST_OP_DONE
mdefine_line|#define  HOST_OP_DONE      BIT(4)   /*host operation done */
DECL|macro|DMA_OP_DONE
mdefine_line|#define  DMA_OP_DONE       BIT(5)   /*DMA operation done */
DECL|macro|SLV_OP_DONE
mdefine_line|#define  SLV_OP_DONE       BIT(6)   /*Slave operation done */
DECL|macro|PWR_ON_FLAG
mdefine_line|#define  PWR_ON_FLAG       BIT(7)   /*Power on flag */
DECL|macro|hp_reserved_30
mdefine_line|#define  hp_reserved_30       0x30
DECL|macro|hp_host_status0
mdefine_line|#define  hp_host_status0      0x31
DECL|macro|HOST_TERM
mdefine_line|#define  HOST_TERM         BIT(5)   /*Host Terminal Count */
DECL|macro|HOST_TRSHLD
mdefine_line|#define  HOST_TRSHLD       BIT(6)   /*Host Threshold      */
DECL|macro|CONNECTED_2_HOST
mdefine_line|#define  CONNECTED_2_HOST  BIT(7)   /*Connected to Host   */
DECL|macro|hp_reserved_32
mdefine_line|#define  hp_reserved_32       0x32
DECL|macro|hp_rev_num
mdefine_line|#define  hp_rev_num           0x33
DECL|macro|REV_A_CONST
mdefine_line|#define  REV_A_CONST       0x0E
DECL|macro|REV_B_CONST
mdefine_line|#define  REV_B_CONST       0x0E
DECL|macro|hp_stack_data
mdefine_line|#define  hp_stack_data        0x34
DECL|macro|hp_stack_addr
mdefine_line|#define  hp_stack_addr        0x35
DECL|macro|hp_ext_status
mdefine_line|#define  hp_ext_status        0x36
DECL|macro|BM_FORCE_OFF
mdefine_line|#define  BM_FORCE_OFF      BIT(0)   /*Bus Master is forced to get off */
DECL|macro|PCI_TGT_ABORT
mdefine_line|#define  PCI_TGT_ABORT     BIT(0)   /*PCI bus master transaction aborted */
DECL|macro|PCI_DEV_TMOUT
mdefine_line|#define  PCI_DEV_TMOUT     BIT(1)   /*PCI Device Time out */
DECL|macro|FIFO_TC_NOT_ZERO
mdefine_line|#define  FIFO_TC_NOT_ZERO  BIT(2)   /*FIFO or transfer counter not zero */
DECL|macro|CHIP_RST_OCCUR
mdefine_line|#define  CHIP_RST_OCCUR    BIT(3)   /*Chip reset occurs */
DECL|macro|CMD_ABORTED
mdefine_line|#define  CMD_ABORTED       BIT(4)   /*Command aborted */
DECL|macro|BM_PARITY_ERR
mdefine_line|#define  BM_PARITY_ERR     BIT(5)   /*parity error on data received   */
DECL|macro|PIO_OVERRUN
mdefine_line|#define  PIO_OVERRUN       BIT(6)   /*Slave data overrun */
DECL|macro|BM_CMD_BUSY
mdefine_line|#define  BM_CMD_BUSY       BIT(7)   /*Bus master transfer command busy */
DECL|macro|BAD_EXT_STATUS
mdefine_line|#define  BAD_EXT_STATUS    (BM_FORCE_OFF | PCI_DEV_TMOUT | CMD_ABORTED | &bslash;&n;                                  BM_PARITY_ERR | PIO_OVERRUN)
DECL|macro|hp_int_status
mdefine_line|#define  hp_int_status        0x37
DECL|macro|BM_CMD_CMPL
mdefine_line|#define  BM_CMD_CMPL       BIT(0)   /*Bus Master command complete */
DECL|macro|EXT_STATUS_ON
mdefine_line|#define  EXT_STATUS_ON     BIT(1)   /*Extended status is valid */
DECL|macro|SCSI_INTERRUPT
mdefine_line|#define  SCSI_INTERRUPT    BIT(2)   /*Global indication of a SCSI int. */
DECL|macro|BM_FIFO_RDY
mdefine_line|#define  BM_FIFO_RDY       BIT(4)   
DECL|macro|INT_ASSERTED
mdefine_line|#define  INT_ASSERTED      BIT(5)   /* */
DECL|macro|SRAM_BUSY
mdefine_line|#define  SRAM_BUSY         BIT(6)   /*Scatter/Gather RAM busy */
DECL|macro|CMD_REG_BUSY
mdefine_line|#define  CMD_REG_BUSY      BIT(7)                                       
DECL|macro|hp_fifo_cnt
mdefine_line|#define  hp_fifo_cnt          0x38
DECL|macro|hp_curr_host_cnt
mdefine_line|#define  hp_curr_host_cnt     0x39
DECL|macro|hp_reserved_3A
mdefine_line|#define  hp_reserved_3A       0x3A
DECL|macro|hp_fifo_in_addr
mdefine_line|#define  hp_fifo_in_addr      0x3B
DECL|macro|hp_fifo_out_addr
mdefine_line|#define  hp_fifo_out_addr     0x3C
DECL|macro|hp_reserved_3D
mdefine_line|#define  hp_reserved_3D       0x3D
DECL|macro|hp_reserved_3E
mdefine_line|#define  hp_reserved_3E       0x3E
DECL|macro|hp_reserved_3F
mdefine_line|#define  hp_reserved_3F       0x3F
r_extern
id|USHORT
id|default_intena
suffix:semicolon
DECL|macro|hp_intena
mdefine_line|#define  hp_intena&t;&t; 0x40
DECL|macro|RESET
mdefine_line|#define  RESET&t;&t; BITW(7)
DECL|macro|PROG_HLT
mdefine_line|#define  PROG_HLT&t;&t; BITW(6)  
DECL|macro|PARITY
mdefine_line|#define  PARITY&t;&t; BITW(5)
DECL|macro|FIFO
mdefine_line|#define  FIFO&t;&t; BITW(4)
DECL|macro|SEL
mdefine_line|#define  SEL&t;&t; BITW(3)
DECL|macro|SCAM_SEL
mdefine_line|#define  SCAM_SEL&t;&t; BITW(2) 
DECL|macro|RSEL
mdefine_line|#define  RSEL&t;&t; BITW(1)
DECL|macro|TIMEOUT
mdefine_line|#define  TIMEOUT&t;&t; BITW(0)
DECL|macro|BUS_FREE
mdefine_line|#define  BUS_FREE&t;&t; BITW(15)
DECL|macro|XFER_CNT_0
mdefine_line|#define  XFER_CNT_0&t; BITW(14)
DECL|macro|PHASE
mdefine_line|#define  PHASE&t;&t; BITW(13)
DECL|macro|IUNKWN
mdefine_line|#define  IUNKWN&t;&t; BITW(12)
DECL|macro|ICMD_COMP
mdefine_line|#define  ICMD_COMP&t; BITW(11)
DECL|macro|ITICKLE
mdefine_line|#define  ITICKLE&t;&t; BITW(10)
DECL|macro|IDO_STRT
mdefine_line|#define  IDO_STRT&t;&t; BITW(9)
DECL|macro|ITAR_DISC
mdefine_line|#define  ITAR_DISC&t; BITW(8)
DECL|macro|AUTO_INT
mdefine_line|#define  AUTO_INT&t;&t; (BITW(12)+BITW(11)+BITW(10)+BITW(9)+BITW(8))
DECL|macro|CLR_ALL_INT
mdefine_line|#define  CLR_ALL_INT&t; 0xFFFF
DECL|macro|CLR_ALL_INT_1
mdefine_line|#define  CLR_ALL_INT_1&t; 0xFF00
DECL|macro|hp_intstat
mdefine_line|#define  hp_intstat&t;&t; 0x42
DECL|macro|hp_scsisig
mdefine_line|#define  hp_scsisig           0x44
DECL|macro|SCSI_SEL
mdefine_line|#define  SCSI_SEL          BIT(7)
DECL|macro|SCSI_BSY
mdefine_line|#define  SCSI_BSY          BIT(6)
DECL|macro|SCSI_REQ
mdefine_line|#define  SCSI_REQ          BIT(5)
DECL|macro|SCSI_ACK
mdefine_line|#define  SCSI_ACK          BIT(4)
DECL|macro|SCSI_ATN
mdefine_line|#define  SCSI_ATN          BIT(3)
DECL|macro|SCSI_CD
mdefine_line|#define  SCSI_CD           BIT(2)
DECL|macro|SCSI_MSG
mdefine_line|#define  SCSI_MSG          BIT(1)
DECL|macro|SCSI_IOBIT
mdefine_line|#define  SCSI_IOBIT        BIT(0)
DECL|macro|S_SCSI_PHZ
mdefine_line|#define  S_SCSI_PHZ        (BIT(2)+BIT(1)+BIT(0))
DECL|macro|S_CMD_PH
mdefine_line|#define  S_CMD_PH          (BIT(2)              )
DECL|macro|S_MSGO_PH
mdefine_line|#define  S_MSGO_PH         (BIT(2)+BIT(1)       )
DECL|macro|S_STAT_PH
mdefine_line|#define  S_STAT_PH         (BIT(2)       +BIT(0))
DECL|macro|S_MSGI_PH
mdefine_line|#define  S_MSGI_PH         (BIT(2)+BIT(1)+BIT(0))
DECL|macro|S_DATAI_PH
mdefine_line|#define  S_DATAI_PH        (              BIT(0))
DECL|macro|S_DATAO_PH
mdefine_line|#define  S_DATAO_PH        0x00
DECL|macro|S_ILL_PH
mdefine_line|#define  S_ILL_PH          (       BIT(1)       )
DECL|macro|hp_scsictrl_0
mdefine_line|#define  hp_scsictrl_0        0x45
DECL|macro|NO_ARB
mdefine_line|#define  NO_ARB            BIT(7)
DECL|macro|SEL_TAR
mdefine_line|#define  SEL_TAR           BIT(6)
DECL|macro|ENA_ATN
mdefine_line|#define  ENA_ATN           BIT(4)
DECL|macro|ENA_RESEL
mdefine_line|#define  ENA_RESEL         BIT(2)
DECL|macro|SCSI_RST
mdefine_line|#define  SCSI_RST          BIT(1)
DECL|macro|ENA_SCAM_SEL
mdefine_line|#define  ENA_SCAM_SEL      BIT(0)
DECL|macro|hp_portctrl_0
mdefine_line|#define  hp_portctrl_0        0x46
DECL|macro|SCSI_PORT
mdefine_line|#define  SCSI_PORT         BIT(7)
DECL|macro|SCSI_INBIT
mdefine_line|#define  SCSI_INBIT        BIT(6)
DECL|macro|DMA_PORT
mdefine_line|#define  DMA_PORT          BIT(5)
DECL|macro|DMA_RD
mdefine_line|#define  DMA_RD            BIT(4)
DECL|macro|HOST_PORT
mdefine_line|#define  HOST_PORT         BIT(3)
DECL|macro|HOST_WRT
mdefine_line|#define  HOST_WRT          BIT(2)
DECL|macro|SCSI_BUS_EN
mdefine_line|#define  SCSI_BUS_EN       BIT(1)
DECL|macro|START_TO
mdefine_line|#define  START_TO          BIT(0)
DECL|macro|hp_scsireset
mdefine_line|#define  hp_scsireset         0x47
DECL|macro|SCSI_TAR
mdefine_line|#define  SCSI_TAR          BIT(7)
DECL|macro|SCSI_INI
mdefine_line|#define  SCSI_INI          BIT(6)
DECL|macro|SCAM_EN
mdefine_line|#define  SCAM_EN           BIT(5)
DECL|macro|ACK_HOLD
mdefine_line|#define  ACK_HOLD          BIT(4)
DECL|macro|DMA_RESET
mdefine_line|#define  DMA_RESET         BIT(3)
DECL|macro|HPSCSI_RESET
mdefine_line|#define  HPSCSI_RESET      BIT(2)
DECL|macro|PROG_RESET
mdefine_line|#define  PROG_RESET        BIT(1)
DECL|macro|FIFO_CLR
mdefine_line|#define  FIFO_CLR          BIT(0)
DECL|macro|hp_xfercnt_0
mdefine_line|#define  hp_xfercnt_0         0x48
DECL|macro|hp_xfercnt_1
mdefine_line|#define  hp_xfercnt_1         0x49
DECL|macro|hp_xfercnt_2
mdefine_line|#define  hp_xfercnt_2         0x4A
DECL|macro|hp_xfercnt_3
mdefine_line|#define  hp_xfercnt_3         0x4B
DECL|macro|hp_fifodata_0
mdefine_line|#define  hp_fifodata_0        0x4C
DECL|macro|hp_fifodata_1
mdefine_line|#define  hp_fifodata_1        0x4D
DECL|macro|hp_addstat
mdefine_line|#define  hp_addstat           0x4E
DECL|macro|SCAM_TIMER
mdefine_line|#define  SCAM_TIMER        BIT(7)
DECL|macro|AUTO_RUNNING
mdefine_line|#define  AUTO_RUNNING      BIT(6)
DECL|macro|FAST_SYNC
mdefine_line|#define  FAST_SYNC         BIT(5)
DECL|macro|SCSI_MODE8
mdefine_line|#define  SCSI_MODE8        BIT(3)
DECL|macro|SCSI_PAR_ERR
mdefine_line|#define  SCSI_PAR_ERR      BIT(0)
DECL|macro|hp_prgmcnt_0
mdefine_line|#define  hp_prgmcnt_0         0x4F
DECL|macro|AUTO_PC_MASK
mdefine_line|#define  AUTO_PC_MASK      0x3F
DECL|macro|hp_selfid_0
mdefine_line|#define  hp_selfid_0          0x50
DECL|macro|hp_selfid_1
mdefine_line|#define  hp_selfid_1          0x51
DECL|macro|hp_arb_id
mdefine_line|#define  hp_arb_id            0x52
DECL|macro|ARB_ID
mdefine_line|#define  ARB_ID            (BIT(3) + BIT(2) + BIT(1) + BIT(0))
DECL|macro|hp_select_id
mdefine_line|#define  hp_select_id         0x53
DECL|macro|RESEL_ID
mdefine_line|#define  RESEL_ID          (BIT(7) + BIT(6) + BIT(5) + BIT(4))
DECL|macro|SELECT_ID
mdefine_line|#define  SELECT_ID         (BIT(3) + BIT(2) + BIT(1) + BIT(0))
DECL|macro|hp_synctarg_base
mdefine_line|#define  hp_synctarg_base     0x54
DECL|macro|hp_synctarg_12
mdefine_line|#define  hp_synctarg_12       0x54
DECL|macro|hp_synctarg_13
mdefine_line|#define  hp_synctarg_13       0x55
DECL|macro|hp_synctarg_14
mdefine_line|#define  hp_synctarg_14       0x56
DECL|macro|hp_synctarg_15
mdefine_line|#define  hp_synctarg_15       0x57
DECL|macro|hp_synctarg_8
mdefine_line|#define  hp_synctarg_8        0x58
DECL|macro|hp_synctarg_9
mdefine_line|#define  hp_synctarg_9        0x59
DECL|macro|hp_synctarg_10
mdefine_line|#define  hp_synctarg_10       0x5A
DECL|macro|hp_synctarg_11
mdefine_line|#define  hp_synctarg_11       0x5B
DECL|macro|hp_synctarg_4
mdefine_line|#define  hp_synctarg_4        0x5C
DECL|macro|hp_synctarg_5
mdefine_line|#define  hp_synctarg_5        0x5D
DECL|macro|hp_synctarg_6
mdefine_line|#define  hp_synctarg_6        0x5E
DECL|macro|hp_synctarg_7
mdefine_line|#define  hp_synctarg_7        0x5F
DECL|macro|hp_synctarg_0
mdefine_line|#define  hp_synctarg_0        0x60
DECL|macro|hp_synctarg_1
mdefine_line|#define  hp_synctarg_1        0x61
DECL|macro|hp_synctarg_2
mdefine_line|#define  hp_synctarg_2        0x62
DECL|macro|hp_synctarg_3
mdefine_line|#define  hp_synctarg_3        0x63
DECL|macro|RATE_20MB
mdefine_line|#define  RATE_20MB         0x00
DECL|macro|RATE_10MB
mdefine_line|#define  RATE_10MB         (              BIT(5))
DECL|macro|RATE_6_6MB
mdefine_line|#define  RATE_6_6MB        (       BIT(6)       )   
DECL|macro|RATE_5MB
mdefine_line|#define  RATE_5MB          (       BIT(6)+BIT(5))
DECL|macro|RATE_4MB
mdefine_line|#define  RATE_4MB          (BIT(7)              )
DECL|macro|RATE_3_33MB
mdefine_line|#define  RATE_3_33MB       (BIT(7)       +BIT(5))
DECL|macro|RATE_2_85MB
mdefine_line|#define  RATE_2_85MB       (BIT(7)+BIT(6)       )
DECL|macro|RATE_2_5MB
mdefine_line|#define  RATE_2_5MB        (BIT(7)+BIT(5)+BIT(6))
DECL|macro|NEXT_CLK
mdefine_line|#define  NEXT_CLK          BIT(5)
DECL|macro|SLOWEST_SYNC
mdefine_line|#define  SLOWEST_SYNC      (BIT(7)+BIT(6)+BIT(5))
DECL|macro|NARROW_SCSI
mdefine_line|#define  NARROW_SCSI       BIT(4)
DECL|macro|SYNC_OFFSET
mdefine_line|#define  SYNC_OFFSET       (BIT(3) + BIT(2) + BIT(1) + BIT(0))
DECL|macro|DEFAULT_ASYNC
mdefine_line|#define  DEFAULT_ASYNC     0x00
DECL|macro|DEFAULT_OFFSET
mdefine_line|#define  DEFAULT_OFFSET    0x0F
DECL|macro|hp_autostart_0
mdefine_line|#define  hp_autostart_0       0x64
DECL|macro|hp_autostart_1
mdefine_line|#define  hp_autostart_1       0x65
DECL|macro|hp_autostart_2
mdefine_line|#define  hp_autostart_2       0x66
DECL|macro|hp_autostart_3
mdefine_line|#define  hp_autostart_3       0x67
DECL|macro|DISABLE
mdefine_line|#define  DISABLE  0x00
DECL|macro|AUTO_IMMED
mdefine_line|#define  AUTO_IMMED    BIT(5)
DECL|macro|SELECT
mdefine_line|#define  SELECT   BIT(6)
DECL|macro|RESELECT
mdefine_line|#define  RESELECT (BIT(6)+BIT(5))
DECL|macro|BUSFREE
mdefine_line|#define  BUSFREE  BIT(7)
DECL|macro|XFER_0
mdefine_line|#define  XFER_0   (BIT(7)+BIT(5))
DECL|macro|END_DATA
mdefine_line|#define  END_DATA (BIT(7)+BIT(6))
DECL|macro|MSG_PHZ
mdefine_line|#define  MSG_PHZ  (BIT(7)+BIT(6)+BIT(5))
DECL|macro|hp_gp_reg_0
mdefine_line|#define  hp_gp_reg_0          0x68
DECL|macro|hp_gp_reg_1
mdefine_line|#define  hp_gp_reg_1          0x69
DECL|macro|hp_gp_reg_2
mdefine_line|#define  hp_gp_reg_2          0x6A
DECL|macro|hp_gp_reg_3
mdefine_line|#define  hp_gp_reg_3          0x6B
DECL|macro|hp_seltimeout
mdefine_line|#define  hp_seltimeout        0x6C
DECL|macro|TO_2ms
mdefine_line|#define  TO_2ms            0x54      /* 2.0503ms */
DECL|macro|TO_4ms
mdefine_line|#define  TO_4ms            0x67      /* 3.9959ms */
DECL|macro|TO_5ms
mdefine_line|#define  TO_5ms            0x03      /* 4.9152ms */
DECL|macro|TO_10ms
mdefine_line|#define  TO_10ms           0x07      /* 11.xxxms */
DECL|macro|TO_250ms
mdefine_line|#define  TO_250ms          0x99      /* 250.68ms */
DECL|macro|TO_290ms
mdefine_line|#define  TO_290ms          0xB1      /* 289.99ms */
DECL|macro|TO_350ms
mdefine_line|#define  TO_350ms          0xD6      /* 350.62ms */
DECL|macro|TO_417ms
mdefine_line|#define  TO_417ms          0xFF      /* 417.79ms */
DECL|macro|hp_clkctrl_0
mdefine_line|#define  hp_clkctrl_0         0x6D
DECL|macro|PWR_DWN
mdefine_line|#define  PWR_DWN           BIT(6)
DECL|macro|ACTdeassert
mdefine_line|#define  ACTdeassert       BIT(4)
DECL|macro|ATNonErr
mdefine_line|#define  ATNonErr          BIT(3)
DECL|macro|CLK_30MHZ
mdefine_line|#define  CLK_30MHZ         BIT(1)
DECL|macro|CLK_40MHZ
mdefine_line|#define  CLK_40MHZ         (BIT(1) + BIT(0))
DECL|macro|CLK_50MHZ
mdefine_line|#define  CLK_50MHZ         BIT(2)
DECL|macro|CLKCTRL_DEFAULT
mdefine_line|#define  CLKCTRL_DEFAULT   (ACTdeassert | CLK_40MHZ)
DECL|macro|hp_fiforead
mdefine_line|#define  hp_fiforead          0x6E
DECL|macro|hp_fifowrite
mdefine_line|#define  hp_fifowrite         0x6F
DECL|macro|hp_offsetctr
mdefine_line|#define  hp_offsetctr         0x70
DECL|macro|hp_xferstat
mdefine_line|#define  hp_xferstat          0x71
DECL|macro|FIFO_FULL
mdefine_line|#define  FIFO_FULL         BIT(7)
DECL|macro|FIFO_EMPTY
mdefine_line|#define  FIFO_EMPTY        BIT(6)
DECL|macro|FIFO_MASK
mdefine_line|#define  FIFO_MASK         0x3F   /* Mask for the FIFO count value. */
DECL|macro|FIFO_LEN
mdefine_line|#define  FIFO_LEN          0x20
DECL|macro|hp_portctrl_1
mdefine_line|#define  hp_portctrl_1        0x72
DECL|macro|EVEN_HOST_P
mdefine_line|#define  EVEN_HOST_P       BIT(5)
DECL|macro|INVT_SCSI
mdefine_line|#define  INVT_SCSI         BIT(4)
DECL|macro|CHK_SCSI_P
mdefine_line|#define  CHK_SCSI_P        BIT(3)
DECL|macro|HOST_MODE8
mdefine_line|#define  HOST_MODE8        BIT(0)
DECL|macro|HOST_MODE16
mdefine_line|#define  HOST_MODE16       0x00
DECL|macro|hp_xfer_pad
mdefine_line|#define  hp_xfer_pad          0x73
DECL|macro|ID_UNLOCK
mdefine_line|#define  ID_UNLOCK         BIT(3)
DECL|macro|XFER_PAD
mdefine_line|#define  XFER_PAD          BIT(2)
DECL|macro|hp_scsidata_0
mdefine_line|#define  hp_scsidata_0        0x74
DECL|macro|hp_scsidata_1
mdefine_line|#define  hp_scsidata_1        0x75
DECL|macro|hp_timer_0
mdefine_line|#define  hp_timer_0           0x76
DECL|macro|hp_timer_1
mdefine_line|#define  hp_timer_1           0x77
DECL|macro|hp_reserved_78
mdefine_line|#define  hp_reserved_78       0x78
DECL|macro|hp_reserved_79
mdefine_line|#define  hp_reserved_79       0x79
DECL|macro|hp_reserved_7A
mdefine_line|#define  hp_reserved_7A       0x7A
DECL|macro|hp_reserved_7B
mdefine_line|#define  hp_reserved_7B       0x7B
DECL|macro|hp_reserved_7C
mdefine_line|#define  hp_reserved_7C       0x7C
DECL|macro|hp_reserved_7D
mdefine_line|#define  hp_reserved_7D       0x7D
DECL|macro|hp_reserved_7E
mdefine_line|#define  hp_reserved_7E       0x7E
DECL|macro|hp_reserved_7F
mdefine_line|#define  hp_reserved_7F       0x7F
DECL|macro|hp_aramBase
mdefine_line|#define  hp_aramBase          0x80
DECL|macro|BIOS_DATA_OFFSET
mdefine_line|#define  BIOS_DATA_OFFSET     0x60
DECL|macro|BIOS_RELATIVE_CARD
mdefine_line|#define  BIOS_RELATIVE_CARD   0x64
DECL|macro|AUTO_LEN
mdefine_line|#define  AUTO_LEN 0x80
DECL|macro|AR0
mdefine_line|#define  AR0      0x00
DECL|macro|AR1
mdefine_line|#define  AR1      BITW(8)
DECL|macro|AR2
mdefine_line|#define  AR2      BITW(9)
DECL|macro|AR3
mdefine_line|#define  AR3      (BITW(9) + BITW(8))
DECL|macro|SDATA
mdefine_line|#define  SDATA    BITW(10)
DECL|macro|NOP_OP
mdefine_line|#define  NOP_OP   0x00        /* Nop command */
DECL|macro|CRD_OP
mdefine_line|#define  CRD_OP   BITW(11)     /* Cmp Reg. w/ Data */
DECL|macro|CRR_OP
mdefine_line|#define  CRR_OP   BITW(12)     /* Cmp Reg. w. Reg. */
DECL|macro|CBE_OP
mdefine_line|#define  CBE_OP   (BITW(14)+BITW(12)+BITW(11)) /* Cmp SCSI cmd class &amp; Branch EQ */
DECL|macro|CBN_OP
mdefine_line|#define  CBN_OP   (BITW(14)+BITW(13))  /* Cmp SCSI cmd class &amp; Branch NOT EQ */
DECL|macro|CPE_OP
mdefine_line|#define  CPE_OP   (BITW(14)+BITW(11))  /* Cmp SCSI phs &amp; Branch EQ */
DECL|macro|CPN_OP
mdefine_line|#define  CPN_OP   (BITW(14)+BITW(12))  /* Cmp SCSI phs &amp; Branch NOT EQ */
DECL|macro|ADATA_OUT
mdefine_line|#define  ADATA_OUT   0x00     
DECL|macro|ADATA_IN
mdefine_line|#define  ADATA_IN    BITW(8)
DECL|macro|ACOMMAND
mdefine_line|#define  ACOMMAND    BITW(10)
DECL|macro|ASTATUS
mdefine_line|#define  ASTATUS     (BITW(10)+BITW(8))
DECL|macro|AMSG_OUT
mdefine_line|#define  AMSG_OUT    (BITW(10)+BITW(9))
DECL|macro|AMSG_IN
mdefine_line|#define  AMSG_IN     (BITW(10)+BITW(9)+BITW(8))
DECL|macro|AILLEGAL
mdefine_line|#define  AILLEGAL    (BITW(9)+BITW(8))
DECL|macro|BRH_OP
mdefine_line|#define  BRH_OP   BITW(13)   /* Branch */
DECL|macro|ALWAYS
mdefine_line|#define  ALWAYS   0x00
DECL|macro|EQUAL
mdefine_line|#define  EQUAL    BITW(8)
DECL|macro|NOT_EQ
mdefine_line|#define  NOT_EQ   BITW(9)
DECL|macro|TCB_OP
mdefine_line|#define  TCB_OP   (BITW(13)+BITW(11))    /* Test condition &amp; branch */
DECL|macro|ATN_SET
mdefine_line|#define  ATN_SET     BITW(8)
DECL|macro|ATN_RESET
mdefine_line|#define  ATN_RESET   BITW(9)
DECL|macro|XFER_CNT
mdefine_line|#define  XFER_CNT    (BITW(9)+BITW(8))
DECL|macro|FIFO_0
mdefine_line|#define  FIFO_0      BITW(10)
DECL|macro|FIFO_NOT0
mdefine_line|#define  FIFO_NOT0   (BITW(10)+BITW(8))
DECL|macro|T_USE_SYNC0
mdefine_line|#define  T_USE_SYNC0 (BITW(10)+BITW(9))
DECL|macro|MPM_OP
mdefine_line|#define  MPM_OP   BITW(15)        /* Match phase and move data */
DECL|macro|MDR_OP
mdefine_line|#define  MDR_OP   (BITW(12)+BITW(11)) /* Move data to Reg. */
DECL|macro|MRR_OP
mdefine_line|#define  MRR_OP   BITW(14)        /* Move DReg. to Reg. */
DECL|macro|S_IDREG
mdefine_line|#define  S_IDREG  (BIT(2)+BIT(1)+BIT(0))
DECL|macro|D_AR0
mdefine_line|#define  D_AR0    0x00
DECL|macro|D_AR1
mdefine_line|#define  D_AR1    BIT(0)
DECL|macro|D_AR2
mdefine_line|#define  D_AR2    BIT(1)
DECL|macro|D_AR3
mdefine_line|#define  D_AR3    (BIT(1) + BIT(0))
DECL|macro|D_SDATA
mdefine_line|#define  D_SDATA  BIT(2)
DECL|macro|D_BUCKET
mdefine_line|#define  D_BUCKET (BIT(2) + BIT(1) + BIT(0))
DECL|macro|ADR_OP
mdefine_line|#define  ADR_OP   (BITW(13)+BITW(12)) /* Logical AND Reg. w. Data */
DECL|macro|ADS_OP
mdefine_line|#define  ADS_OP   (BITW(14)+BITW(13)+BITW(12)) 
DECL|macro|ODR_OP
mdefine_line|#define  ODR_OP   (BITW(13)+BITW(12)+BITW(11))  
DECL|macro|ODS_OP
mdefine_line|#define  ODS_OP   (BITW(14)+BITW(13)+BITW(12)+BITW(11))  
DECL|macro|STR_OP
mdefine_line|#define  STR_OP   (BITW(15)+BITW(14)) /* Store to A_Reg. */
DECL|macro|AINT_ENA1
mdefine_line|#define  AINT_ENA1   0x00
DECL|macro|AINT_STAT1
mdefine_line|#define  AINT_STAT1  BITW(8)
DECL|macro|ASCSI_SIG
mdefine_line|#define  ASCSI_SIG   BITW(9)
DECL|macro|ASCSI_CNTL
mdefine_line|#define  ASCSI_CNTL  (BITW(9)+BITW(8))
DECL|macro|APORT_CNTL
mdefine_line|#define  APORT_CNTL  BITW(10)
DECL|macro|ARST_CNTL
mdefine_line|#define  ARST_CNTL   (BITW(10)+BITW(8))
DECL|macro|AXFERCNT0
mdefine_line|#define  AXFERCNT0   (BITW(10)+BITW(9))
DECL|macro|AXFERCNT1
mdefine_line|#define  AXFERCNT1   (BITW(10)+BITW(9)+BITW(8))
DECL|macro|AXFERCNT2
mdefine_line|#define  AXFERCNT2   BITW(11)
DECL|macro|AFIFO_DATA
mdefine_line|#define  AFIFO_DATA  (BITW(11)+BITW(8))
DECL|macro|ASCSISELID
mdefine_line|#define  ASCSISELID  (BITW(11)+BITW(9))
DECL|macro|ASCSISYNC0
mdefine_line|#define  ASCSISYNC0  (BITW(11)+BITW(9)+BITW(8))
DECL|macro|RAT_OP
mdefine_line|#define  RAT_OP      (BITW(14)+BITW(13)+BITW(11))
DECL|macro|SSI_OP
mdefine_line|#define  SSI_OP      (BITW(15)+BITW(11))
DECL|macro|SSI_ITAR_DISC
mdefine_line|#define  SSI_ITAR_DISC&t;(ITAR_DISC &gt;&gt; 8)
DECL|macro|SSI_IDO_STRT
mdefine_line|#define  SSI_IDO_STRT&t;(IDO_STRT &gt;&gt; 8)
DECL|macro|SSI_IDI_STRT
mdefine_line|#define  SSI_IDI_STRT&t;(IDO_STRT &gt;&gt; 8)
DECL|macro|SSI_ICMD_COMP
mdefine_line|#define  SSI_ICMD_COMP&t;(ICMD_COMP &gt;&gt; 8)
DECL|macro|SSI_ITICKLE
mdefine_line|#define  SSI_ITICKLE&t;(ITICKLE &gt;&gt; 8)
DECL|macro|SSI_IUNKWN
mdefine_line|#define  SSI_IUNKWN&t;(IUNKWN &gt;&gt; 8)
DECL|macro|SSI_INO_CC
mdefine_line|#define  SSI_INO_CC&t;(IUNKWN &gt;&gt; 8)
DECL|macro|SSI_IRFAIL
mdefine_line|#define  SSI_IRFAIL&t;(IUNKWN &gt;&gt; 8)
DECL|macro|NP
mdefine_line|#define  NP    0x10     /*Next Phase */
DECL|macro|NTCMD
mdefine_line|#define  NTCMD 0x02     /*Non- Tagged Command start */
DECL|macro|CMDPZ
mdefine_line|#define  CMDPZ 0x04     /*Command phase */
DECL|macro|DINT
mdefine_line|#define  DINT  0x12     /*Data Out/In interrupt */
DECL|macro|DI
mdefine_line|#define  DI    0x13     /*Data Out */
DECL|macro|MI
mdefine_line|#define  MI    0x14     /*Message In */
DECL|macro|DC
mdefine_line|#define  DC    0x19     /*Disconnect Message */
DECL|macro|ST
mdefine_line|#define  ST    0x1D     /*Status Phase */
DECL|macro|UNKNWN
mdefine_line|#define  UNKNWN 0x24    /*Unknown bus action */
DECL|macro|CC
mdefine_line|#define  CC    0x25     /*Command Completion failure */
DECL|macro|TICK
mdefine_line|#define  TICK  0x26     /*New target reselected us. */
DECL|macro|RFAIL
mdefine_line|#define  RFAIL 0x27     /*Reselection failed */
DECL|macro|SELCHK
mdefine_line|#define  SELCHK 0x28     /*Select &amp; Check SCSI ID latch reg */
DECL|macro|ID_MSG_STRT
mdefine_line|#define  ID_MSG_STRT    hp_aramBase + 0x00
DECL|macro|NON_TAG_ID_MSG
mdefine_line|#define  NON_TAG_ID_MSG hp_aramBase + 0x06
DECL|macro|CMD_STRT
mdefine_line|#define  CMD_STRT       hp_aramBase + 0x08
DECL|macro|SYNC_MSGS
mdefine_line|#define  SYNC_MSGS      hp_aramBase + 0x08
DECL|macro|TAG_STRT
mdefine_line|#define  TAG_STRT          0x00
DECL|macro|SELECTION_START
mdefine_line|#define  SELECTION_START   0x00
DECL|macro|DISCONNECT_START
mdefine_line|#define  DISCONNECT_START  0x10/2
DECL|macro|END_DATA_START
mdefine_line|#define  END_DATA_START    0x14/2
DECL|macro|NONTAG_STRT
mdefine_line|#define  NONTAG_STRT       0x02/2
DECL|macro|CMD_ONLY_STRT
mdefine_line|#define  CMD_ONLY_STRT     CMDPZ/2
DECL|macro|TICKLE_STRT
mdefine_line|#define  TICKLE_STRT     TICK/2
DECL|macro|SELCHK_STRT
mdefine_line|#define  SELCHK_STRT     SELCHK/2
DECL|macro|mEEPROM_CLK_DELAY
mdefine_line|#define mEEPROM_CLK_DELAY(port) (RD_HARPOON(port+hp_intstat_1))
DECL|macro|mWAIT_10MS
mdefine_line|#define mWAIT_10MS(port) (RD_HARPOON(port+hp_intstat_1))
DECL|macro|CLR_XFER_CNT
mdefine_line|#define CLR_XFER_CNT(port) (WR_HARPOON(port+hp_xfercnt_0, 0x00))
DECL|macro|SET_XFER_CNT
mdefine_line|#define SET_XFER_CNT(port, data) (WR_HARP32(port,hp_xfercnt_0,data))
DECL|macro|GET_XFER_CNT
mdefine_line|#define GET_XFER_CNT(port, xfercnt) {RD_HARP32(port,hp_xfercnt_0,xfercnt); xfercnt &amp;= 0xFFFFFF;}
multiline_comment|/* #define GET_XFER_CNT(port, xfercnt) (xfercnt = RD_HARPOON(port+hp_xfercnt_2), &bslash;&n;                                 xfercnt &lt;&lt;= 16,&bslash;&n;                                 xfercnt |= RDW_HARPOON((USHORT)(port+hp_xfercnt_0)))&n; */
macro_line|#if defined(DOS)
DECL|macro|HP_SETUP_ADDR_CNT
mdefine_line|#define HP_SETUP_ADDR_CNT(port,addr,count) (WRW_HARPOON((USHORT)(port+hp_host_addr_lo), (USHORT)(addr &amp; 0x0000FFFFL)),&bslash;&n;         addr &gt;&gt;= 16,&bslash;&n;         WRW_HARPOON((USHORT)(port+hp_host_addr_hmi), (USHORT)(addr &amp; 0x0000FFFFL)),&bslash;&n;         WR_HARP32(port,hp_xfercnt_0,count),&bslash;&n;         WRW_HARPOON((USHORT)(port+hp_xfer_cnt_lo), (USHORT)(count &amp; 0x0000FFFFL)),&bslash;&n;         count &gt;&gt;= 16,&bslash;&n;         WR_HARPOON(port+hp_xfer_cnt_hi, (count &amp; 0xFF)))
macro_line|#else
DECL|macro|HP_SETUP_ADDR_CNT
mdefine_line|#define HP_SETUP_ADDR_CNT(port,addr,count) (WRW_HARPOON((port+hp_host_addr_lo), (USHORT)(addr &amp; 0x0000FFFFL)),&bslash;&n;         addr &gt;&gt;= 16,&bslash;&n;         WRW_HARPOON((port+hp_host_addr_hmi), (USHORT)(addr &amp; 0x0000FFFFL)),&bslash;&n;         WR_HARP32(port,hp_xfercnt_0,count),&bslash;&n;         WRW_HARPOON((port+hp_xfer_cnt_lo), (USHORT)(count &amp; 0x0000FFFFL)),&bslash;&n;         count &gt;&gt;= 16,&bslash;&n;         WR_HARPOON(port+hp_xfer_cnt_hi, (count &amp; 0xFF)))
macro_line|#endif
DECL|macro|ACCEPT_MSG
mdefine_line|#define ACCEPT_MSG(port) {while(RD_HARPOON(port+hp_scsisig) &amp; SCSI_REQ){}&bslash;&n;                          WR_HARPOON(port+hp_scsisig, S_ILL_PH);}
DECL|macro|ACCEPT_MSG_ATN
mdefine_line|#define ACCEPT_MSG_ATN(port) {while(RD_HARPOON(port+hp_scsisig) &amp; SCSI_REQ){}&bslash;&n;                          WR_HARPOON(port+hp_scsisig, (S_ILL_PH|SCSI_ATN));}
DECL|macro|ACCEPT_STAT
mdefine_line|#define ACCEPT_STAT(port) {while(RD_HARPOON(port+hp_scsisig) &amp; SCSI_REQ){}&bslash;&n;                          WR_HARPOON(port+hp_scsisig, S_ILL_PH);}
DECL|macro|ACCEPT_STAT_ATN
mdefine_line|#define ACCEPT_STAT_ATN(port) {while(RD_HARPOON(port+hp_scsisig) &amp; SCSI_REQ){}&bslash;&n;                          WR_HARPOON(port+hp_scsisig, (S_ILL_PH|SCSI_ATN));}
DECL|macro|DISABLE_AUTO
mdefine_line|#define DISABLE_AUTO(port) (WR_HARPOON(port+hp_scsireset, PROG_RESET),&bslash;&n;                        WR_HARPOON(port+hp_scsireset, 0x00))
DECL|macro|ARAM_ACCESS
mdefine_line|#define ARAM_ACCESS(p_port) (WR_HARPOON(p_port+hp_page_ctrl, &bslash;&n;                             (RD_HARPOON(p_port+hp_page_ctrl) | SGRAM_ARAM)))
DECL|macro|SGRAM_ACCESS
mdefine_line|#define SGRAM_ACCESS(p_port) (WR_HARPOON(p_port+hp_page_ctrl, &bslash;&n;                             (RD_HARPOON(p_port+hp_page_ctrl) &amp; ~SGRAM_ARAM)))
DECL|macro|MDISABLE_INT
mdefine_line|#define MDISABLE_INT(p_port) (WR_HARPOON(p_port+hp_page_ctrl, &bslash;&n;                             (RD_HARPOON(p_port+hp_page_ctrl) | G_INT_DISABLE)))
DECL|macro|MENABLE_INT
mdefine_line|#define MENABLE_INT(p_port) (WR_HARPOON(p_port+hp_page_ctrl, &bslash;&n;                             (RD_HARPOON(p_port+hp_page_ctrl) &amp; ~G_INT_DISABLE)))
macro_line|#endif
macro_line|#if (FW_TYPE==_UCB_MGR_)
r_void
id|ReadNVRam
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
suffix:semicolon
r_void
id|WriteNVRam
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
suffix:semicolon
r_void
id|UpdateCheckSum
c_func
(paren
id|u32bits
id|baseport
)paren
suffix:semicolon
macro_line|#endif 
singleline_comment|// (FW_TYPE==_UCB_MGR_)
macro_line|#if defined(DOS)
id|UCHAR
id|sfm
c_func
(paren
id|USHORT
id|port
comma
id|PSCCB
id|pcurrSCCB
)paren
suffix:semicolon
r_void
id|scsiStartAuto
c_func
(paren
id|USHORT
id|port
)paren
suffix:semicolon
id|UCHAR
id|sisyncn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|syncFlag
)paren
suffix:semicolon
r_void
id|ssel
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sres
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
)paren
suffix:semicolon
r_void
id|sdecm
c_func
(paren
id|UCHAR
id|message
comma
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|shandem
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|stsyncn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sisyncr
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|sync_pulse
comma
id|UCHAR
id|offset
)paren
suffix:semicolon
r_void
id|sssyncv
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id
comma
id|UCHAR
id|p_sync_value
comma
id|PSCCBMgr_tar_info
id|currTar_Info
)paren
suffix:semicolon
r_void
id|sresb
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sxfrp
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|schkdd
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
id|UCHAR
id|RdStack
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|index
)paren
suffix:semicolon
r_void
id|WrStack
c_func
(paren
id|USHORT
id|portBase
comma
id|UCHAR
id|index
comma
id|UCHAR
id|data
)paren
suffix:semicolon
id|UCHAR
id|ChkIfChipInitialized
c_func
(paren
id|USHORT
id|ioPort
)paren
suffix:semicolon
macro_line|#if defined(V302)
id|UCHAR
id|GetTarLun
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|our_target
comma
id|PSCCBcard
id|pCurrCard
comma
id|PUCHAR
id|tag
comma
id|PUCHAR
id|lun
)paren
suffix:semicolon
macro_line|#endif
r_void
id|SendMsg
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|message
)paren
suffix:semicolon
r_void
id|queueFlushTargSccb
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|thisTarg
comma
id|UCHAR
id|error_code
)paren
suffix:semicolon
id|UCHAR
id|scsellDOS
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|targ_id
)paren
suffix:semicolon
macro_line|#else
id|UCHAR
id|sfm
c_func
(paren
id|ULONG
id|port
comma
id|PSCCB
id|pcurrSCCB
)paren
suffix:semicolon
r_void
id|scsiStartAuto
c_func
(paren
id|ULONG
id|port
)paren
suffix:semicolon
id|UCHAR
id|sisyncn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|syncFlag
)paren
suffix:semicolon
r_void
id|ssel
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sres
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
)paren
suffix:semicolon
r_void
id|sdecm
c_func
(paren
id|UCHAR
id|message
comma
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|shandem
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|stsyncn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sisyncr
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|sync_pulse
comma
id|UCHAR
id|offset
)paren
suffix:semicolon
r_void
id|sssyncv
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id
comma
id|UCHAR
id|p_sync_value
comma
id|PSCCBMgr_tar_info
id|currTar_Info
)paren
suffix:semicolon
r_void
id|sresb
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|sxfrp
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|schkdd
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
id|UCHAR
id|RdStack
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|index
)paren
suffix:semicolon
r_void
id|WrStack
c_func
(paren
id|ULONG
id|portBase
comma
id|UCHAR
id|index
comma
id|UCHAR
id|data
)paren
suffix:semicolon
id|UCHAR
id|ChkIfChipInitialized
c_func
(paren
id|ULONG
id|ioPort
)paren
suffix:semicolon
macro_line|#if defined(V302)
id|UCHAR
id|GetTarLun
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|our_target
comma
id|PSCCBcard
id|pCurrCard
comma
id|PUCHAR
id|tar
comma
id|PUCHAR
id|lun
)paren
suffix:semicolon
macro_line|#endif
r_void
id|SendMsg
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|message
)paren
suffix:semicolon
r_void
id|queueFlushTargSccb
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|thisTarg
comma
id|UCHAR
id|error_code
)paren
suffix:semicolon
macro_line|#endif
r_void
id|ssenss
c_func
(paren
id|PSCCBcard
id|pCurrCard
)paren
suffix:semicolon
r_void
id|sinits
c_func
(paren
id|PSCCB
id|p_sccb
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|RNVRamData
c_func
(paren
id|PNVRamInfo
id|pNvRamInfo
)paren
suffix:semicolon
macro_line|#if defined(WIDE_SCSI)
macro_line|#if defined(DOS)
id|UCHAR
id|siwidn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|stwidn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|siwidr
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|width
)paren
suffix:semicolon
macro_line|#else
id|UCHAR
id|siwidn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|stwidn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|siwidr
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|width
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_void
id|queueSelectFail
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|queueDisconnect
c_func
(paren
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|queueCmdComplete
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|queueSearchSelect
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|queueFlushSccb
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|error_code
)paren
suffix:semicolon
r_void
id|queueAddSccb
c_func
(paren
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|card
)paren
suffix:semicolon
id|UCHAR
id|queueFindSccb
c_func
(paren
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|utilUpdateResidual
c_func
(paren
id|PSCCB
id|p_SCCB
)paren
suffix:semicolon
id|USHORT
id|CalcCrc16
c_func
(paren
id|UCHAR
id|buffer
(braket
)braket
)paren
suffix:semicolon
id|UCHAR
id|CalcLrc
c_func
(paren
id|UCHAR
id|buffer
(braket
)braket
)paren
suffix:semicolon
macro_line|#if defined(DOS)
r_void
id|Wait1Second
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
r_void
id|Wait
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_delay
)paren
suffix:semicolon
r_void
id|utilEEWriteOnOff
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_mode
)paren
suffix:semicolon
r_void
id|utilEEWrite
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_data
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
id|USHORT
id|utilEERead
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
id|USHORT
id|utilEEReadOrg
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
r_void
id|utilEESendCmdAddr
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|ee_cmd
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
macro_line|#else
r_void
id|Wait1Second
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
r_void
id|Wait
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_delay
)paren
suffix:semicolon
r_void
id|utilEEWriteOnOff
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_mode
)paren
suffix:semicolon
r_void
id|utilEEWrite
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_data
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
id|USHORT
id|utilEERead
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
id|USHORT
id|utilEEReadOrg
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
r_void
id|utilEESendCmdAddr
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|ee_cmd
comma
id|USHORT
id|ee_addr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(OS2)
r_void
id|far
id|phaseDataOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseDataIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseCommand
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseStatus
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseMsgOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseMsgIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|far
id|phaseIllegal
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseDataOut
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseDataIn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseCommand
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseStatus
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseMsgOut
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseMsgIn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseIllegal
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
macro_line|#else
r_void
id|phaseDataOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseDataIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseCommand
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseStatus
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseMsgOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseMsgIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseIllegal
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(DOS)
r_void
id|phaseDecode
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseChkFifo
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseBusFree
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
macro_line|#else
r_void
id|phaseDecode
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseChkFifo
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|phaseBusFree
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
r_void
id|XbowInit
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|scamFlg
)paren
suffix:semicolon
r_void
id|BusMasterInit
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
r_int
id|DiagXbow
c_func
(paren
id|USHORT
id|port
)paren
suffix:semicolon
r_int
id|DiagBusMaster
c_func
(paren
id|USHORT
id|port
)paren
suffix:semicolon
r_void
id|DiagEEPROM
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
macro_line|#else
r_void
id|XbowInit
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|scamFlg
)paren
suffix:semicolon
r_void
id|BusMasterInit
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
r_int
id|DiagXbow
c_func
(paren
id|ULONG
id|port
)paren
suffix:semicolon
r_int
id|DiagBusMaster
c_func
(paren
id|ULONG
id|port
)paren
suffix:semicolon
r_void
id|DiagEEPROM
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
r_void
id|busMstrAbort
c_func
(paren
id|USHORT
id|port
)paren
suffix:semicolon
id|UCHAR
id|busMstrTimeOut
c_func
(paren
id|USHORT
id|port
)paren
suffix:semicolon
r_void
id|dataXferProcessor
c_func
(paren
id|USHORT
id|port
comma
id|PSCCBcard
id|pCurrCard
)paren
suffix:semicolon
r_void
id|busMstrSGDataXferStart
c_func
(paren
id|USHORT
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|busMstrDataXferStart
c_func
(paren
id|USHORT
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|hostDataXferAbort
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
macro_line|#else
r_void
id|busMstrAbort
c_func
(paren
id|ULONG
id|port
)paren
suffix:semicolon
id|UCHAR
id|busMstrTimeOut
c_func
(paren
id|ULONG
id|port
)paren
suffix:semicolon
r_void
id|dataXferProcessor
c_func
(paren
id|ULONG
id|port
comma
id|PSCCBcard
id|pCurrCard
)paren
suffix:semicolon
r_void
id|busMstrSGDataXferStart
c_func
(paren
id|ULONG
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|busMstrDataXferStart
c_func
(paren
id|ULONG
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
r_void
id|hostDataXferAbort
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
suffix:semicolon
macro_line|#endif
r_void
id|hostDataXferRestart
c_func
(paren
id|PSCCB
id|currSCCB
)paren
suffix:semicolon
macro_line|#if defined (DOS)
id|UCHAR
id|SccbMgr_bad_isr
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
comma
id|USHORT
id|p_int
)paren
suffix:semicolon
macro_line|#else
id|UCHAR
id|SccbMgr_bad_isr
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
comma
id|USHORT
id|p_int
)paren
suffix:semicolon
macro_line|#endif
r_void
id|SccbMgrTableInitAll
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|SccbMgrTableInitCard
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|SccbMgrTableInitTarget
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|target
)paren
suffix:semicolon
r_void
id|scini
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_our_id
comma
id|UCHAR
id|p_power_up
)paren
suffix:semicolon
macro_line|#if defined(DOS)
r_int
id|scarb
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_sel_type
)paren
suffix:semicolon
r_void
id|scbusf
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
r_void
id|scsel
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
r_void
id|scasid
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
)paren
suffix:semicolon
id|UCHAR
id|scxferc
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data
)paren
suffix:semicolon
id|UCHAR
id|scsendi
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
suffix:semicolon
id|UCHAR
id|sciso
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
suffix:semicolon
r_void
id|scwirod
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
suffix:semicolon
r_void
id|scwiros
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
suffix:semicolon
id|UCHAR
id|scvalq
c_func
(paren
id|UCHAR
id|p_quintet
)paren
suffix:semicolon
id|UCHAR
id|scsell
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|targ_id
)paren
suffix:semicolon
r_void
id|scwtsel
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
r_void
id|inisci
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
comma
id|UCHAR
id|p_our_id
)paren
suffix:semicolon
r_void
id|scsavdi
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
)paren
suffix:semicolon
macro_line|#else
r_int
id|scarb
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_sel_type
)paren
suffix:semicolon
r_void
id|scbusf
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
r_void
id|scsel
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
r_void
id|scasid
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
)paren
suffix:semicolon
id|UCHAR
id|scxferc
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data
)paren
suffix:semicolon
id|UCHAR
id|scsendi
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
suffix:semicolon
id|UCHAR
id|sciso
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
suffix:semicolon
r_void
id|scwirod
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
suffix:semicolon
r_void
id|scwiros
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
suffix:semicolon
id|UCHAR
id|scvalq
c_func
(paren
id|UCHAR
id|p_quintet
)paren
suffix:semicolon
id|UCHAR
id|scsell
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|targ_id
)paren
suffix:semicolon
r_void
id|scwtsel
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
r_void
id|inisci
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
comma
id|UCHAR
id|p_our_id
)paren
suffix:semicolon
r_void
id|scsavdi
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
)paren
suffix:semicolon
macro_line|#endif
id|UCHAR
id|scmachid
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
suffix:semicolon
macro_line|#if defined(DOS)
r_void
id|autoCmdCmplt
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|autoLoadDefaultMap
c_func
(paren
id|USHORT
id|p_port
)paren
suffix:semicolon
macro_line|#else
r_void
id|autoCmdCmplt
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
suffix:semicolon
r_void
id|autoLoadDefaultMap
c_func
(paren
id|ULONG
id|p_port
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if (FW_TYPE==_SCCB_MGR_)
r_void
id|OS_start_timer
c_func
(paren
r_int
r_int
id|ioport
comma
r_int
r_int
id|timeout
)paren
suffix:semicolon
r_void
id|OS_stop_timer
c_func
(paren
r_int
r_int
id|ioport
comma
r_int
r_int
id|timeout
)paren
suffix:semicolon
r_void
id|OS_disable_int
c_func
(paren
r_int
r_char
id|intvec
)paren
suffix:semicolon
r_void
id|OS_enable_int
c_func
(paren
r_int
r_char
id|intvec
)paren
suffix:semicolon
r_void
id|OS_delay
c_func
(paren
r_int
r_int
id|count
)paren
suffix:semicolon
r_int
id|OS_VirtToPhys
c_func
(paren
id|u32bits
id|CardHandle
comma
id|u32bits
op_star
id|physaddr
comma
id|u32bits
op_star
id|virtaddr
)paren
suffix:semicolon
macro_line|#if !(defined(UNIX) || defined(OS2) || defined(SOLARIS_REAL_MODE)) 
r_void
id|OS_Lock
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
r_void
id|OS_UnLock
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
suffix:semicolon
macro_line|#endif 
singleline_comment|// if FW_TYPE == ...
macro_line|#endif
r_extern
id|SCCBCARD
id|BL_Card
(braket
id|MAX_CARDS
)braket
suffix:semicolon
r_extern
id|SCCBMGR_TAR_INFO
id|sccbMgrTbl
(braket
id|MAX_CARDS
)braket
(braket
id|MAX_SCSI_TAR
)braket
suffix:semicolon
macro_line|#if defined(OS2)
r_extern
r_void
(paren
id|far
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#else
macro_line|#if defined(DOS)
r_extern
r_void
(paren
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
id|USHORT
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#else
r_extern
r_void
(paren
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_extern
id|SCCBSCAM_INFO
id|scamInfo
(braket
id|MAX_SCSI_TAR
)braket
suffix:semicolon
r_extern
id|NVRAMINFO
id|nvRamInfo
(braket
id|MAX_MB_CARDS
)braket
suffix:semicolon
macro_line|#if defined(DOS) || defined(OS2)
r_extern
id|UCHAR
id|temp_id_string
(braket
id|ID_STRING_LENGTH
)braket
suffix:semicolon
macro_line|#endif
r_extern
id|UCHAR
id|scamHAString
(braket
)braket
suffix:semicolon
r_extern
id|UCHAR
id|mbCards
suffix:semicolon
macro_line|#if defined(BUGBUG)
r_extern
id|UCHAR
id|debug_int
(braket
id|MAX_CARDS
)braket
(braket
id|debug_size
)braket
suffix:semicolon
r_extern
id|UCHAR
id|debug_index
(braket
id|MAX_CARDS
)braket
suffix:semicolon
r_void
id|Debug_Load
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_bug_data
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if (FW_TYPE==_SCCB_MGR_)
macro_line|#if defined(DOS)
r_extern
id|UCHAR
id|first_time
suffix:semicolon
macro_line|#endif
macro_line|#endif /* (FW_TYPE==_SCCB_MGR_) */
macro_line|#if (FW_TYPE==_UCB_MGR_)
macro_line|#if defined(DOS)
r_extern
id|u08bits
id|first_time
suffix:semicolon
macro_line|#endif
macro_line|#endif /* (FW_TYPE==_UCB_MGR_) */
macro_line|#if defined(BUGBUG)
r_void
id|Debug_Load
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_bug_data
)paren
suffix:semicolon
macro_line|#endif
r_extern
r_int
r_int
id|SccbGlobalFlags
suffix:semicolon
macro_line|#ident &quot;$Id: sccb.c 1.18 1997/06/10 16:47:04 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   sccb.c  $&n; *&n; *   Description:  Functions relating to handling of the SCCB interface&n; *                 between the device driver and the HARPOON.&n; *&n; *   $Date: 1997/06/10 16:47:04 $&n; *&n; *   $Revision: 1.18 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
multiline_comment|/*#include &lt;budioctl.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;eeprom.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
macro_line|#if (FW_TYPE==_SCCB_MGR_)
DECL|macro|mOS_Lock
mdefine_line|#define mOS_Lock(card)    OS_Lock((PSCCBMGR_INFO)(((PSCCBcard)card)-&gt;cardInfo))
DECL|macro|mOS_UnLock
mdefine_line|#define mOS_UnLock(card)  OS_UnLock((PSCCBMGR_INFO)(((PSCCBcard)card)-&gt;cardInfo))
macro_line|#else /* FW_TYPE==_UCB_MGR_ */
DECL|macro|mOS_Lock
mdefine_line|#define mOS_Lock(card)    OS_Lock((u32bits)(((PSCCBcard)card)-&gt;ioPort))
DECL|macro|mOS_UnLock
mdefine_line|#define mOS_UnLock(card)  OS_UnLock((u32bits)(((PSCCBcard)card)-&gt;ioPort))
macro_line|#endif
multiline_comment|/*&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;&n;extern NVRAMINFO nvRamInfo[MAX_MB_CARDS];&n;extern UCHAR mbCards;&n;&n;#if defined (OS2)&n;   extern void (far *s_PhaseTbl[8]) (ULONG, UCHAR);&n;#else&n;   #if defined(DOS)&n;      extern void (*s_PhaseTbl[8]) (USHORT, UCHAR);&n;   #else&n;      extern void (*s_PhaseTbl[8]) (ULONG, UCHAR);&n;   #endif&n;#endif&n;&n;&n;#if defined(BUGBUG)&n;extern UCHAR debug_int[MAX_CARDS][debug_size];&n;extern UCHAR debug_index[MAX_CARDS];&n;void Debug_Load(UCHAR p_card, UCHAR p_bug_data);&n;#endif&n;*/
macro_line|#if (FW_TYPE==_SCCB_MGR_)
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_sense_adapter&n; *&n; * Description: Setup and/or Search for cards and return info to caller.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SccbMgr_sense_adapter
r_int
id|SccbMgr_sense_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
(brace
macro_line|#if defined(DOS)
macro_line|#else
r_static
id|UCHAR
id|first_time
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|UCHAR
id|i
comma
id|j
comma
id|id
comma
id|ScamFlg
suffix:semicolon
id|USHORT
id|temp
comma
id|temp2
comma
id|temp3
comma
id|temp4
comma
id|temp5
comma
id|temp6
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
macro_line|#if defined(DOS)
id|ioport
op_assign
(paren
id|USHORT
)paren
id|pCardInfo-&gt;si_baseaddr
suffix:semicolon
macro_line|#else
id|ioport
op_assign
id|pCardInfo-&gt;si_baseaddr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_vendor_id_0
)paren
op_ne
id|ORION_VEND_0
)paren
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_vendor_id_1
)paren
op_ne
id|ORION_VEND_1
)paren
)paren
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_device_id_0
)paren
op_ne
id|ORION_DEV_0
)paren
)paren
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_device_id_1
)paren
op_ne
id|ORION_DEV_1
)paren
)paren
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_rev_num
)paren
op_ne
l_int|0x0f
)paren
(brace
multiline_comment|/* For new Harpoon then check for sub_device ID LSB&n;   the bits(0-3) must be all ZERO for compatible with&n;   current version of SCCBMgr, else skip this Harpoon&n;&t;device. */
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_sub_device_id_0
)paren
op_amp
l_int|0x0f
)paren
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|first_time
)paren
(brace
id|SccbMgrTableInitAll
c_func
(paren
)paren
suffix:semicolon
id|first_time
op_assign
l_int|0
suffix:semicolon
id|mbCards
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RdStack
c_func
(paren
id|ioport
comma
l_int|0
)paren
op_ne
l_int|0x00
)paren
(brace
r_if
c_cond
(paren
id|ChkIfChipInitialized
c_func
(paren
id|ioport
)paren
op_eq
id|FALSE
)paren
(brace
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
comma
l_int|0x00
)paren
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*Must Init the SCSI before attempting */
id|DiagEEPROM
c_func
(paren
id|ioport
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mbCards
OL
id|MAX_MB_CARDS
)paren
(brace
id|pCurrNvRam
op_assign
op_amp
id|nvRamInfo
(braket
id|mbCards
)braket
suffix:semicolon
id|mbCards
op_increment
suffix:semicolon
id|pCurrNvRam-&gt;niBaseAddr
op_assign
id|ioport
suffix:semicolon
id|RNVRamData
c_func
(paren
id|pCurrNvRam
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if defined (NO_BIOS_OPTION)
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*Must Init the SCSI before attempting */
id|DiagEEPROM
c_func
(paren
id|ioport
)paren
suffix:semicolon
macro_line|#endif  /* No BIOS Option */
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|pCardInfo-&gt;si_id
op_assign
id|pCurrNvRam-&gt;niAdapId
suffix:semicolon
)brace
r_else
id|pCardInfo-&gt;si_id
op_assign
(paren
id|UCHAR
)paren
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|ADAPTER_SCSI_ID
op_div
l_int|2
)paren
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x0FF
)paren
suffix:semicolon
id|pCardInfo-&gt;si_lun
op_assign
l_int|0x00
suffix:semicolon
id|pCardInfo-&gt;si_fw_revision
op_assign
id|ORION_FW_REV
suffix:semicolon
id|temp2
op_assign
l_int|0x0000
suffix:semicolon
id|temp3
op_assign
l_int|0x0000
suffix:semicolon
id|temp4
op_assign
l_int|0x0000
suffix:semicolon
id|temp5
op_assign
l_int|0x0000
suffix:semicolon
id|temp6
op_assign
l_int|0x0000
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
(paren
l_int|16
op_div
l_int|2
)paren
suffix:semicolon
id|id
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|temp
op_assign
(paren
id|USHORT
)paren
id|pCurrNvRam-&gt;niSyncTbl
(braket
id|id
)braket
suffix:semicolon
id|temp
op_assign
(paren
(paren
id|temp
op_amp
l_int|0x03
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0xc0
)paren
)paren
op_plus
(paren
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0x0300
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_amp
l_int|0xc000
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|USHORT
)paren
(paren
(paren
id|SYNC_RATE_TBL
op_div
l_int|2
)paren
op_plus
id|id
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|temp
op_rshift_assign
l_int|8
comma
id|i
op_increment
)paren
(brace
id|temp2
op_rshift_assign
l_int|1
suffix:semicolon
id|temp3
op_rshift_assign
l_int|1
suffix:semicolon
id|temp4
op_rshift_assign
l_int|1
suffix:semicolon
id|temp5
op_rshift_assign
l_int|1
suffix:semicolon
id|temp6
op_rshift_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|temp
op_amp
l_int|0x3
)paren
(brace
r_case
id|AUTO_RATE_20
suffix:colon
multiline_comment|/* Synchronous, 20 mega-transfers/second */
id|temp6
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|AUTO_RATE_10
suffix:colon
multiline_comment|/* Synchronous, 10 mega-transfers/second */
id|temp5
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|AUTO_RATE_05
suffix:colon
multiline_comment|/* Synchronous, 5 mega-transfers/second */
id|temp2
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|AUTO_RATE_00
suffix:colon
multiline_comment|/* Asynchronous */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_amp
id|DISC_ENABLE_BIT
)paren
id|temp3
op_or_assign
l_int|0x8000
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
id|WIDE_NEGO_BIT
)paren
id|temp4
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
)brace
id|pCardInfo-&gt;si_per_targ_init_sync
op_assign
id|temp2
suffix:semicolon
id|pCardInfo-&gt;si_per_targ_no_disc
op_assign
id|temp3
suffix:semicolon
id|pCardInfo-&gt;si_per_targ_wide_nego
op_assign
id|temp4
suffix:semicolon
id|pCardInfo-&gt;si_per_targ_fast_nego
op_assign
id|temp5
suffix:semicolon
id|pCardInfo-&gt;si_per_targ_ultra_nego
op_assign
id|temp6
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|i
op_assign
id|pCurrNvRam-&gt;niSysConf
suffix:semicolon
)brace
r_else
id|i
op_assign
(paren
id|UCHAR
)paren
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|ScamFlg
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
)brace
r_else
id|ScamFlg
op_assign
(paren
id|UCHAR
)paren
id|utilEERead
c_func
(paren
id|ioport
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
id|pCardInfo-&gt;si_flags
op_assign
l_int|0x0000
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x01
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|SCSI_PARITY_ENA
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_amp
l_int|0x02
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|SOFT_RESET
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x10
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|EXTENDED_TRANSLATION
suffix:semicolon
r_if
c_cond
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|FLAG_SCAM_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|ScamFlg
op_amp
id|SCAM_LEVEL2
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|FLAG_SCAM_LEVEL2
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x04
)paren
(brace
id|j
op_or_assign
id|SCSI_TERM_ENA_L
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
comma
id|j
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_H
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x08
)paren
(brace
id|j
op_or_assign
id|SCSI_TERM_ENA_H
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|SUPPORT_16TAR_32LUN
suffix:semicolon
id|pCardInfo-&gt;si_card_family
op_assign
id|HARPOON_FAMILY
suffix:semicolon
id|pCardInfo-&gt;si_bustype
op_assign
id|BUSTYPE_PCI
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|pCardInfo-&gt;si_card_model
(braket
l_int|0
)braket
op_assign
l_char|&squot;9&squot;
suffix:semicolon
r_switch
c_cond
(paren
id|pCurrNvRam-&gt;niModel
op_amp
l_int|0x0f
)paren
(brace
r_case
id|MODEL_LT
suffix:colon
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_LW
suffix:colon
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;5&squot;
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_DL
suffix:colon
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;2&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_DW
suffix:colon
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;5&squot;
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;2&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|MODEL_NUMB_0
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|0
)braket
op_assign
(paren
id|UCHAR
)paren
(paren
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|MODEL_NUMB_2
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_assign
(paren
id|UCHAR
)paren
(paren
id|temp
op_amp
l_int|0x00FF
)paren
suffix:semicolon
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_assign
(paren
id|UCHAR
)paren
(paren
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCardInfo-&gt;si_card_model
(braket
l_int|1
)braket
op_eq
l_char|&squot;3&squot;
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|LOW_BYTE_TERM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pCardInfo-&gt;si_card_model
(braket
l_int|2
)braket
op_eq
l_char|&squot;0&squot;
)paren
(brace
id|temp
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|temp
op_amp
op_complement
id|BIT
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|LOW_BYTE_TERM
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|temp
op_or
id|BIT
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|HIGH_BYTE_TERM
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
id|temp
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
suffix:semicolon
id|temp2
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
(paren
id|temp
op_or
id|SEE_CS
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|temp2
op_or
id|BIT
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|temp3
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|temp3
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
)paren
id|temp3
op_or_assign
l_int|1
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|temp2
op_amp
op_complement
id|BIT
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|temp2
op_or
id|BIT
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
id|temp
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
id|temp2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp3
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|LOW_BYTE_TERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp3
op_amp
id|BIT
c_func
(paren
l_int|6
)paren
)paren
)paren
id|pCardInfo-&gt;si_flags
op_or_assign
id|HIGH_BYTE_TERM
suffix:semicolon
)brace
id|ARAM_ACCESS
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pCardInfo-&gt;si_XlatInfo
(braket
id|i
)braket
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_aramBase
op_plus
id|BIOS_DATA_OFFSET
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* return with -1 if no sort, else return with&n;&t;   logical card number sorted by BIOS (zero-based) */
id|pCardInfo-&gt;si_relative_cardnum
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_aramBase
op_plus
id|BIOS_RELATIVE_CARD
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|0
)braket
op_assign
id|phaseDataOut
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|1
)braket
op_assign
id|phaseDataIn
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|2
)braket
op_assign
id|phaseIllegal
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|3
)braket
op_assign
id|phaseIllegal
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|4
)braket
op_assign
id|phaseCommand
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|5
)braket
op_assign
id|phaseStatus
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|6
)braket
op_assign
id|phaseMsgOut
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|7
)braket
op_assign
id|phaseMsgIn
suffix:semicolon
id|pCardInfo-&gt;si_present
op_assign
l_int|0x01
suffix:semicolon
macro_line|#if defined(BUGBUG)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
id|debug_size
suffix:semicolon
id|id
op_increment
)paren
id|debug_int
(braket
id|i
)braket
(braket
id|id
)braket
op_assign
(paren
id|UCHAR
)paren
l_int|0x00
suffix:semicolon
id|debug_index
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_config_adapter&n; *&n; * Description: Setup adapter for normal operation (hard reset).&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|SccbMgr_config_adapter
id|USHORT
id|SccbMgr_config_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
macro_line|#else
id|ULONG
id|SccbMgr_config_adapter
c_func
(paren
id|PSCCBMGR_INFO
id|pCardInfo
)paren
macro_line|#endif
(brace
id|PSCCBcard
id|CurrCard
op_assign
l_int|NULL
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|UCHAR
id|i
comma
id|j
comma
id|thisCard
comma
id|ScamFlg
suffix:semicolon
id|USHORT
id|temp
comma
id|sync_bit_map
comma
id|id
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
id|ioport
op_assign
(paren
id|USHORT
)paren
id|pCardInfo-&gt;si_baseaddr
suffix:semicolon
macro_line|#else
id|ioport
op_assign
id|pCardInfo-&gt;si_baseaddr
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|thisCard
op_assign
l_int|0
suffix:semicolon
id|thisCard
op_le
id|MAX_CARDS
suffix:semicolon
id|thisCard
op_increment
)paren
(brace
r_if
c_cond
(paren
id|thisCard
op_eq
id|MAX_CARDS
)paren
(brace
r_return
id|FAILURE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_eq
id|ioport
)paren
(brace
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|thisCard
)braket
suffix:semicolon
id|SccbMgrTableInitCard
c_func
(paren
id|CurrCard
comma
id|thisCard
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_eq
l_int|0x00
)paren
(brace
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_assign
id|ioport
suffix:semicolon
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|thisCard
)braket
suffix:semicolon
r_if
c_cond
(paren
id|mbCards
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mbCards
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|CurrCard-&gt;ioPort
op_eq
id|nvRamInfo
(braket
id|i
)braket
dot
id|niBaseAddr
)paren
(brace
id|CurrCard-&gt;pNvRamInfo
op_assign
op_amp
id|nvRamInfo
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
id|SccbMgrTableInitCard
c_func
(paren
id|CurrCard
comma
id|thisCard
)paren
suffix:semicolon
id|CurrCard-&gt;cardIndex
op_assign
id|thisCard
suffix:semicolon
id|CurrCard-&gt;cardInfo
op_assign
id|pCardInfo
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|pCurrNvRam
op_assign
id|CurrCard-&gt;pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|ScamFlg
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
)brace
r_else
(brace
id|ScamFlg
op_assign
(paren
id|UCHAR
)paren
id|utilEERead
c_func
(paren
id|ioport
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
)brace
id|BusMasterInit
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
id|ScamFlg
)paren
suffix:semicolon
macro_line|#if defined (NO_BIOS_OPTION)
r_if
c_cond
(paren
id|DiagXbow
c_func
(paren
id|ioport
)paren
)paren
r_return
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
id|DiagBusMaster
c_func
(paren
id|ioport
)paren
)paren
r_return
id|FAILURE
suffix:semicolon
macro_line|#endif  /* No BIOS Option */
id|autoLoadDefaultMap
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|id
op_assign
l_int|0x01
suffix:semicolon
id|i
op_ne
id|pCardInfo-&gt;si_id
suffix:semicolon
id|i
op_increment
comma
id|id
op_lshift_assign
l_int|1
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_selfid_0
comma
id|id
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_selfid_1
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_arb_id
comma
id|pCardInfo-&gt;si_id
)paren
suffix:semicolon
id|CurrCard-&gt;ourId
op_assign
id|pCardInfo-&gt;si_id
suffix:semicolon
id|i
op_assign
(paren
id|UCHAR
)paren
id|pCardInfo-&gt;si_flags
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|SCSI_PARITY_ENA
)paren
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_portctrl_1
comma
(paren
id|HOST_MODE8
op_or
id|CHK_SCSI_P
)paren
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|LOW_BYTE_TERM
)paren
id|j
op_or_assign
id|SCSI_TERM_ENA_L
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
comma
id|j
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_H
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|HIGH_BYTE_TERM
)paren
id|j
op_or_assign
id|SCSI_TERM_ENA_H
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCardInfo-&gt;si_flags
op_amp
id|SOFT_RESET
)paren
)paren
(brace
id|sresb
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
id|scini
c_func
(paren
id|thisCard
comma
id|pCardInfo-&gt;si_id
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCardInfo-&gt;si_flags
op_amp
id|POST_ALL_UNDERRRUNS
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_NO_FILTER
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niSysConf
op_amp
l_int|0x10
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_GREEN_PC
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|GREEN_PC_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_GREEN_PC
suffix:semicolon
)brace
multiline_comment|/* Set global flag to indicate Re-Negotiation to be done on all&n;&t;&t;ckeck condition */
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niScsiConf
op_amp
l_int|0x04
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_DO_RENEGO
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SCSI_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|RENEGO_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_DO_RENEGO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niScsiConf
op_amp
l_int|0x08
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_CONLUN_IO
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SCSI_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|CONNIO_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_CONLUN_IO
suffix:semicolon
)brace
id|temp
op_assign
id|pCardInfo-&gt;si_per_targ_no_disc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|id
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
comma
id|id
op_lshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|temp
op_amp
id|id
)paren
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|i
)braket
dot
id|TarStatus
op_or_assign
id|TAR_ALLOW_DISC
suffix:semicolon
)brace
id|sync_bit_map
op_assign
l_int|0x0001
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
(paren
id|MAX_SCSI_TAR
op_div
l_int|2
)paren
suffix:semicolon
id|id
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|temp
op_assign
(paren
id|USHORT
)paren
id|pCurrNvRam-&gt;niSyncTbl
(braket
id|id
)braket
suffix:semicolon
id|temp
op_assign
(paren
(paren
id|temp
op_amp
l_int|0x03
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0xc0
)paren
)paren
op_plus
(paren
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0x0300
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_amp
l_int|0xc000
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|USHORT
)paren
(paren
(paren
id|SYNC_RATE_TBL
op_div
l_int|2
)paren
op_plus
id|id
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|temp
op_rshift_assign
l_int|8
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCardInfo-&gt;si_per_targ_init_sync
op_amp
id|sync_bit_map
)paren
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_assign
(paren
id|UCHAR
)paren
id|temp
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|SYNC_SUPPORTED
suffix:semicolon
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_assign
(paren
id|UCHAR
)paren
(paren
id|temp
op_amp
op_complement
id|EE_SYNC_MASK
)paren
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
multiline_comment|/*         if ((pCardInfo-&gt;si_per_targ_wide_nego &amp; sync_bit_map) ||&n;            (id*2+i &gt;= 8)){&n;*/
r_if
c_cond
(paren
id|pCardInfo-&gt;si_per_targ_wide_nego
op_amp
id|sync_bit_map
)paren
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_or_assign
id|EE_WIDE_SCSI
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* NARROW SCSI */
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|WIDE_NEGOCIATED
suffix:semicolon
)brace
macro_line|#else
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|WIDE_NEGOCIATED
suffix:semicolon
macro_line|#endif
id|sync_bit_map
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
id|WR_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
comma
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
)paren
op_or
id|SCCB_MGR_PRESENT
)paren
)paren
suffix:semicolon
macro_line|#if defined(DOS)
r_return
(paren
id|USHORT
)paren
id|CurrCard
suffix:semicolon
macro_line|#else
r_return
(paren
id|ULONG
)paren
id|CurrCard
suffix:semicolon
macro_line|#endif
)brace
macro_line|#else  &t;&t;&t;/* end (FW_TYPE==_SCCB_MGR_)  */
DECL|function|FP_PresenceCheck
id|STATIC
id|s16bits
id|FP_PresenceCheck
c_func
(paren
id|PMGR_INFO
id|pMgrInfo
)paren
(brace
id|PMGR_ENTRYPNTS
id|pMgr_EntryPnts
op_assign
op_amp
id|pMgrInfo-&gt;mi_Functions
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_probe_adapter
op_assign
id|probe_adapter
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_init_adapter
op_assign
id|init_adapter
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_start_UCB
op_assign
id|SccbMgr_start_sccb
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_build_UCB
op_assign
id|build_UCB
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_abort_UCB
op_assign
id|SccbMgr_abort_sccb
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_my_int
op_assign
id|SccbMgr_my_int
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_isr
op_assign
id|SccbMgr_isr
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_scsi_reset
op_assign
id|SccbMgr_scsi_reset
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_timer_expired
op_assign
id|SccbMgr_timer_expired
suffix:semicolon
macro_line|#ifndef NO_IOCTLS
id|pMgr_EntryPnts-&gt;UCBMgr_unload_card
op_assign
id|SccbMgr_unload_card
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_save_foreign_state
op_assign
id|SccbMgr_save_foreign_state
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_restore_foreign_state
op_assign
id|SccbMgr_restore_foreign_state
suffix:semicolon
id|pMgr_EntryPnts-&gt;UCBMgr_restore_native_state
op_assign
id|SccbMgr_restore_native_state
suffix:semicolon
macro_line|#endif /*NO_IOCTLS*/
id|pMgrInfo-&gt;mi_SGListFormat
op_assign
l_int|0x01
suffix:semicolon
id|pMgrInfo-&gt;mi_DataPtrFormat
op_assign
l_int|0x01
suffix:semicolon
id|pMgrInfo-&gt;mi_MaxSGElements
op_assign
(paren
id|u16bits
)paren
l_int|0xffffffff
suffix:semicolon
id|pMgrInfo-&gt;mi_MgrPrivateLen
op_assign
r_sizeof
(paren
id|SCCB
)paren
suffix:semicolon
id|pMgrInfo-&gt;mi_PCIVendorID
op_assign
id|BL_VENDOR_ID
suffix:semicolon
id|pMgrInfo-&gt;mi_PCIDeviceID
op_assign
id|FP_DEVICE_ID
suffix:semicolon
id|pMgrInfo-&gt;mi_MgrAttributes
op_assign
id|ATTR_IO_MAPPED
op_plus
id|ATTR_PHYSICAL_ADDRESS
op_plus
id|ATTR_VIRTUAL_ADDRESS
op_plus
id|ATTR_OVERLAPPED_IO_IOCTLS_OK
suffix:semicolon
id|pMgrInfo-&gt;mi_IoRangeLen
op_assign
l_int|256
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: probe_adapter&n; *&n; * Description: Setup and/or Search for cards and return info to caller.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|probe_adapter
id|STATIC
id|s32bits
id|probe_adapter
c_func
(paren
id|PADAPTER_INFO
id|pAdapterInfo
)paren
(brace
id|u16bits
id|temp
comma
id|temp2
comma
id|temp3
comma
id|temp4
suffix:semicolon
id|u08bits
id|i
comma
id|j
comma
id|id
suffix:semicolon
macro_line|#if defined(DOS)
macro_line|#else
r_static
id|u08bits
id|first_time
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|BASE_PORT
id|ioport
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|ioport
op_assign
(paren
id|BASE_PORT
)paren
id|pAdapterInfo-&gt;ai_baseaddr
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_vendor_id_0
)paren
op_ne
id|ORION_VEND_0
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_vendor_id_1
)paren
op_ne
id|ORION_VEND_1
)paren
)paren
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_device_id_0
)paren
op_ne
id|ORION_DEV_0
)paren
)paren
r_return
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_device_id_1
)paren
op_ne
id|ORION_DEV_1
)paren
)paren
r_return
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_rev_num
)paren
op_ne
l_int|0x0f
)paren
(brace
multiline_comment|/* For new Harpoon then check for sub_device ID LSB&n;   the bits(0-3) must be all ZERO for compatible with&n;   current version of SCCBMgr, else skip this Harpoon&n;&t;device. */
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_sub_device_id_0
)paren
op_amp
l_int|0x0f
)paren
r_return
l_int|5
suffix:semicolon
)brace
r_if
c_cond
(paren
id|first_time
)paren
(brace
id|SccbMgrTableInitAll
c_func
(paren
)paren
suffix:semicolon
id|first_time
op_assign
l_int|0
suffix:semicolon
id|mbCards
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RdStack
c_func
(paren
id|ioport
comma
l_int|0
)paren
op_ne
l_int|0x00
)paren
(brace
r_if
c_cond
(paren
id|ChkIfChipInitialized
c_func
(paren
id|ioport
)paren
op_eq
id|FALSE
)paren
(brace
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
comma
l_int|0x00
)paren
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*Must Init the SCSI before attempting */
id|DiagEEPROM
c_func
(paren
id|ioport
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mbCards
OL
id|MAX_MB_CARDS
)paren
(brace
id|pCurrNvRam
op_assign
op_amp
id|nvRamInfo
(braket
id|mbCards
)braket
suffix:semicolon
id|mbCards
op_increment
suffix:semicolon
id|pCurrNvRam-&gt;niBaseAddr
op_assign
id|ioport
suffix:semicolon
id|RNVRamData
c_func
(paren
id|pCurrNvRam
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
r_int
)paren
id|FAILURE
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if defined (NO_BIOS_OPTION)
id|pCurrNvRam
op_assign
l_int|NULL
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*Must Init the SCSI before attempting */
id|DiagEEPROM
c_func
(paren
id|ioport
)paren
suffix:semicolon
macro_line|#endif  /* No BIOS Option */
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|pAdapterInfo-&gt;ai_id
op_assign
id|pCurrNvRam-&gt;niAdapId
suffix:semicolon
)brace
r_else
id|pAdapterInfo-&gt;ai_id
op_assign
(paren
id|u08bits
)paren
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|ADAPTER_SCSI_ID
op_div
l_int|2
)paren
)paren
op_amp
(paren
id|u08bits
)paren
l_int|0x0FF
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_lun
op_assign
l_int|0x00
suffix:semicolon
id|pAdapterInfo-&gt;ai_fw_revision
(braket
l_int|0
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_fw_revision
(braket
l_int|1
)braket
op_assign
l_char|&squot;1&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_fw_revision
(braket
l_int|2
)braket
op_assign
l_char|&squot;1&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_fw_revision
(braket
l_int|3
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_NumChannels
op_assign
l_int|1
suffix:semicolon
id|temp2
op_assign
l_int|0x0000
suffix:semicolon
id|temp3
op_assign
l_int|0x0000
suffix:semicolon
id|temp4
op_assign
l_int|0x0000
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
(paren
l_int|16
op_div
l_int|2
)paren
suffix:semicolon
id|id
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|temp
op_assign
(paren
id|USHORT
)paren
id|pCurrNvRam-&gt;niSyncTbl
(braket
id|id
)braket
suffix:semicolon
id|temp
op_assign
(paren
(paren
id|temp
op_amp
l_int|0x03
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0xc0
)paren
)paren
op_plus
(paren
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0x0300
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_amp
l_int|0xc000
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
(paren
id|SYNC_RATE_TBL
op_div
l_int|2
)paren
op_plus
id|id
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|temp
op_rshift_assign
l_int|8
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|temp
op_amp
l_int|0x03
)paren
op_ne
id|AUTO_RATE_00
)paren
(brace
id|temp2
op_rshift_assign
l_int|0x01
suffix:semicolon
id|temp2
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
(brace
id|temp2
op_rshift_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_amp
id|DISC_ENABLE_BIT
)paren
(brace
id|temp3
op_rshift_assign
l_int|0x01
suffix:semicolon
id|temp3
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
(brace
id|temp3
op_rshift_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_amp
id|WIDE_NEGO_BIT
)paren
(brace
id|temp4
op_rshift_assign
l_int|0x01
suffix:semicolon
id|temp4
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
(brace
id|temp4
op_rshift_assign
l_int|0x01
suffix:semicolon
)brace
)brace
)brace
id|pAdapterInfo-&gt;ai_per_targ_init_sync
op_assign
id|temp2
suffix:semicolon
id|pAdapterInfo-&gt;ai_per_targ_no_disc
op_assign
id|temp3
suffix:semicolon
id|pAdapterInfo-&gt;ai_per_targ_wide_nego
op_assign
id|temp4
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|i
op_assign
id|pCurrNvRam-&gt;niSysConf
suffix:semicolon
)brace
r_else
id|i
op_assign
(paren
id|u08bits
)paren
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;   ** interrupts always level-triggered for FlashPoint&n;   */
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|LEVEL_TRIG
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x01
)paren
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|SCSI_PARITY_ENA
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x02
)paren
multiline_comment|/* SCSI Bus reset in AutoSCSI Set ? */
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|j
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
)brace
r_else
(brace
id|j
op_assign
(paren
id|u08bits
)paren
id|utilEERead
c_func
(paren
id|ioport
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_amp
id|SCAM_ENABLED
)paren
(brace
r_if
c_cond
(paren
id|j
op_amp
id|SCAM_LEVEL2
)paren
(brace
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|SCAM2_ENA
suffix:semicolon
)brace
r_else
(brace
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|SCAM1_ENA
suffix:semicolon
)brace
)brace
)brace
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x04
)paren
(brace
id|j
op_or_assign
id|SCSI_TERM_ENA_L
suffix:semicolon
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|LOW_BYTE_TERM_ENA
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
comma
id|j
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_H
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|0x08
)paren
(brace
id|j
op_or_assign
id|SCSI_TERM_ENA_H
suffix:semicolon
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
id|HIGH_BYTE_TERM_ENA
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|BIOS_SHADOW
)paren
(brace
id|pAdapterInfo-&gt;ai_FlashRomSize
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* 64k ROM */
)brace
r_else
(brace
id|pAdapterInfo-&gt;ai_FlashRomSize
op_assign
l_int|32
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* 32k ROM */
)brace
id|pAdapterInfo-&gt;ai_stateinfo
op_or_assign
(paren
id|FAST20_ENA
op_or
id|TAG_QUEUE_ENA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
)paren
(brace
id|pAdapterInfo-&gt;ai_attributes
op_or_assign
(paren
id|WIDE_CAPABLE
op_or
id|FAST20_CAPABLE
op_or
id|SCAM2_CAPABLE
op_or
id|TAG_QUEUE_CAPABLE
op_or
id|SUPRESS_UNDERRRUNS_CAPABLE
op_or
id|SCSI_PARITY_CAPABLE
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_MaxTarg
op_assign
l_int|16
suffix:semicolon
id|pAdapterInfo-&gt;ai_MaxLun
op_assign
l_int|32
suffix:semicolon
)brace
r_else
(brace
id|pAdapterInfo-&gt;ai_attributes
op_or_assign
(paren
id|FAST20_CAPABLE
op_or
id|SCAM2_CAPABLE
op_or
id|TAG_QUEUE_CAPABLE
op_or
id|SUPRESS_UNDERRRUNS_CAPABLE
op_or
id|SCSI_PARITY_CAPABLE
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_MaxTarg
op_assign
l_int|8
suffix:semicolon
id|pAdapterInfo-&gt;ai_MaxLun
op_assign
l_int|8
suffix:semicolon
)brace
id|pAdapterInfo-&gt;ai_product_family
op_assign
id|HARPOON_FAMILY
suffix:semicolon
id|pAdapterInfo-&gt;ai_HBAbustype
op_assign
id|BUSTYPE_PCI
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CARD_MODEL_NAMELEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAdapterInfo-&gt;ai_card_model
(braket
id|i
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
multiline_comment|/* initialize the ai_card_model */
)brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|0
)braket
op_assign
l_char|&squot;9&squot;
suffix:semicolon
r_switch
c_cond
(paren
id|pCurrNvRam-&gt;niModel
op_amp
l_int|0x0f
)paren
(brace
r_case
id|MODEL_LT
suffix:colon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_LW
suffix:colon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;5&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_DL
suffix:colon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;2&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODEL_DW
suffix:colon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|1
)braket
op_assign
l_char|&squot;5&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|2
)braket
op_assign
l_char|&squot;2&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|MODEL_NUMB_0
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|0
)braket
op_assign
(paren
id|u08bits
)paren
(paren
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|MODEL_NUMB_2
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|1
)braket
op_assign
(paren
id|u08bits
)paren
(paren
id|temp
op_amp
l_int|0x00FF
)paren
suffix:semicolon
id|pAdapterInfo-&gt;ai_card_model
(braket
l_int|2
)braket
op_assign
(paren
id|u08bits
)paren
(paren
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
id|pAdapterInfo-&gt;ai_FiberProductType
op_assign
l_int|0
suffix:semicolon
id|pAdapterInfo-&gt;ai_secondary_range
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WORLD_WIDE_NAMELEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAdapterInfo-&gt;ai_worldwidename
(braket
id|i
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VENDOR_NAMELEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAdapterInfo-&gt;ai_vendorstring
(braket
id|i
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|0
)braket
op_assign
l_char|&squot;B&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|1
)braket
op_assign
l_char|&squot;U&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|2
)braket
op_assign
l_char|&squot;S&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|3
)braket
op_assign
l_char|&squot;L&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|4
)braket
op_assign
l_char|&squot;O&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|5
)braket
op_assign
l_char|&squot;G&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|6
)braket
op_assign
l_char|&squot;I&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_vendorstring
(braket
l_int|7
)braket
op_assign
l_char|&squot;C&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FAMILY_NAMELEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
id|i
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|0
)braket
op_assign
l_char|&squot;F&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|1
)braket
op_assign
l_char|&squot;L&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|2
)braket
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|3
)braket
op_assign
l_char|&squot;S&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|4
)braket
op_assign
l_char|&squot;H&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|5
)braket
op_assign
l_char|&squot;P&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|6
)braket
op_assign
l_char|&squot;O&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|7
)braket
op_assign
l_char|&squot;I&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|8
)braket
op_assign
l_char|&squot;N&squot;
suffix:semicolon
id|pAdapterInfo-&gt;ai_AdapterFamilyString
(braket
l_int|9
)braket
op_assign
l_char|&squot;T&squot;
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAdapterInfo-&gt;ai_XlatInfo
(braket
id|i
)braket
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_aramBase
op_plus
id|BIOS_DATA_OFFSET
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* return with -1 if no sort, else return with&n;&t;   logical card number sorted by BIOS (zero-based) */
id|pAdapterInfo-&gt;ai_relative_cardnum
op_assign
(paren
id|u08bits
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_aramBase
op_plus
id|BIOS_RELATIVE_CARD
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|0
)braket
op_assign
id|phaseDataOut
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|1
)braket
op_assign
id|phaseDataIn
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|2
)braket
op_assign
id|phaseIllegal
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|3
)braket
op_assign
id|phaseIllegal
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|4
)braket
op_assign
id|phaseCommand
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|5
)braket
op_assign
id|phaseStatus
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|6
)braket
op_assign
id|phaseMsgOut
suffix:semicolon
id|s_PhaseTbl
(braket
l_int|7
)braket
op_assign
id|phaseMsgIn
suffix:semicolon
id|pAdapterInfo-&gt;ai_present
op_assign
l_int|0x01
suffix:semicolon
macro_line|#if defined(BUGBUG)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
id|debug_size
suffix:semicolon
id|id
op_increment
)paren
id|debug_int
(braket
id|i
)braket
(braket
id|id
)braket
op_assign
(paren
id|u08bits
)paren
l_int|0x00
suffix:semicolon
id|debug_index
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: init_adapter, exported to BUDI via UCBMgr_init_adapter entry&n; *&n; *&n; * Description: Setup adapter for normal operation (hard reset).&n; *&n; *---------------------------------------------------------------------*/
DECL|function|init_adapter
id|STATIC
id|CARD_HANDLE
id|init_adapter
c_func
(paren
id|PADAPTER_INFO
id|pCardInfo
)paren
(brace
id|PSCCBcard
id|CurrCard
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|u08bits
id|i
comma
id|j
comma
id|thisCard
comma
id|ScamFlg
suffix:semicolon
id|u16bits
id|temp
comma
id|sync_bit_map
comma
id|id
suffix:semicolon
id|BASE_PORT
id|ioport
suffix:semicolon
id|ioport
op_assign
(paren
id|BASE_PORT
)paren
id|pCardInfo-&gt;ai_baseaddr
suffix:semicolon
r_for
c_loop
(paren
id|thisCard
op_assign
l_int|0
suffix:semicolon
id|thisCard
op_le
id|MAX_CARDS
suffix:semicolon
id|thisCard
op_increment
)paren
(brace
r_if
c_cond
(paren
id|thisCard
op_eq
id|MAX_CARDS
)paren
(brace
r_return
id|FAILURE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_eq
id|ioport
)paren
(brace
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|thisCard
)braket
suffix:semicolon
id|SccbMgrTableInitCard
c_func
(paren
id|CurrCard
comma
id|thisCard
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_eq
l_int|0x00
)paren
(brace
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_assign
id|ioport
suffix:semicolon
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|thisCard
)braket
suffix:semicolon
r_if
c_cond
(paren
id|mbCards
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mbCards
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|CurrCard-&gt;ioPort
op_eq
id|nvRamInfo
(braket
id|i
)braket
dot
id|niBaseAddr
)paren
(brace
id|CurrCard-&gt;pNvRamInfo
op_assign
op_amp
id|nvRamInfo
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
id|SccbMgrTableInitCard
c_func
(paren
id|CurrCard
comma
id|thisCard
)paren
suffix:semicolon
id|CurrCard-&gt;cardIndex
op_assign
id|thisCard
suffix:semicolon
id|CurrCard-&gt;cardInfo
op_assign
id|pCardInfo
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|pCurrNvRam
op_assign
id|CurrCard-&gt;pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|ScamFlg
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
)brace
r_else
(brace
id|ScamFlg
op_assign
(paren
id|UCHAR
)paren
id|utilEERead
c_func
(paren
id|ioport
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
)brace
id|BusMasterInit
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|XbowInit
c_func
(paren
id|ioport
comma
id|ScamFlg
)paren
suffix:semicolon
macro_line|#if defined (NO_BIOS_OPTION)
r_if
c_cond
(paren
id|DiagXbow
c_func
(paren
id|ioport
)paren
)paren
r_return
id|FAILURE
suffix:semicolon
r_if
c_cond
(paren
id|DiagBusMaster
c_func
(paren
id|ioport
)paren
)paren
r_return
id|FAILURE
suffix:semicolon
macro_line|#endif  /* No BIOS Option */
id|autoLoadDefaultMap
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|id
op_assign
l_int|0x01
suffix:semicolon
id|i
op_ne
id|pCardInfo-&gt;ai_id
suffix:semicolon
id|i
op_increment
comma
id|id
op_lshift_assign
l_int|1
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_selfid_0
comma
id|id
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_selfid_1
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_arb_id
comma
id|pCardInfo-&gt;ai_id
)paren
suffix:semicolon
id|CurrCard-&gt;ourId
op_assign
(paren
r_int
r_char
)paren
id|pCardInfo-&gt;ai_id
suffix:semicolon
id|i
op_assign
(paren
id|u08bits
)paren
id|pCardInfo-&gt;ai_stateinfo
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|SCSI_PARITY_ENA
)paren
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_portctrl_1
comma
(paren
id|HOST_MODE8
op_or
id|CHK_SCSI_P
)paren
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|LOW_BYTE_TERM_ENA
)paren
id|j
op_or_assign
id|SCSI_TERM_ENA_L
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_bm_ctrl
comma
id|j
)paren
suffix:semicolon
id|j
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
)paren
op_amp
op_complement
id|SCSI_TERM_ENA_H
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|HIGH_BYTE_TERM_ENA
)paren
id|j
op_or_assign
id|SCSI_TERM_ENA_H
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ee_ctrl
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCardInfo-&gt;ai_stateinfo
op_amp
id|NO_RESET_IN_INIT
)paren
)paren
(brace
id|sresb
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
id|scini
c_func
(paren
id|thisCard
comma
(paren
id|u08bits
)paren
id|pCardInfo-&gt;ai_id
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCardInfo-&gt;ai_stateinfo
op_amp
id|SUPRESS_UNDERRRUNS_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_NO_FILTER
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niSysConf
op_amp
l_int|0x10
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_GREEN_PC
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|GREEN_PC_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_GREEN_PC
suffix:semicolon
)brace
multiline_comment|/* Set global flag to indicate Re-Negotiation to be done on all&n;&t;&t;ckeck condition */
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niScsiConf
op_amp
l_int|0x04
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_DO_RENEGO
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SCSI_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|RENEGO_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_DO_RENEGO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam-&gt;niScsiConf
op_amp
l_int|0x08
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_CONLUN_IO
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|SCSI_CONFIG
op_div
l_int|2
)paren
)paren
op_amp
id|CONNIO_ENA
)paren
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_CONLUN_IO
suffix:semicolon
)brace
id|temp
op_assign
id|pCardInfo-&gt;ai_per_targ_no_disc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|id
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
comma
id|id
op_lshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|temp
op_amp
id|id
)paren
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|i
)braket
dot
id|TarStatus
op_or_assign
id|TAR_ALLOW_DISC
suffix:semicolon
)brace
id|sync_bit_map
op_assign
l_int|0x0001
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|0
suffix:semicolon
id|id
OL
(paren
id|MAX_SCSI_TAR
op_div
l_int|2
)paren
suffix:semicolon
id|id
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|temp
op_assign
(paren
id|USHORT
)paren
id|pCurrNvRam-&gt;niSyncTbl
(braket
id|id
)braket
suffix:semicolon
id|temp
op_assign
(paren
(paren
id|temp
op_amp
l_int|0x03
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0xc0
)paren
)paren
op_plus
(paren
(paren
(paren
id|temp
op_lshift
l_int|4
)paren
op_amp
l_int|0x0300
)paren
op_plus
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_amp
l_int|0xc000
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
(paren
id|SYNC_RATE_TBL
op_div
l_int|2
)paren
op_plus
id|id
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|temp
op_rshift_assign
l_int|8
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pCardInfo-&gt;ai_per_targ_init_sync
op_amp
id|sync_bit_map
)paren
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_assign
(paren
id|u08bits
)paren
id|temp
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|SYNC_SUPPORTED
suffix:semicolon
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_assign
(paren
id|u08bits
)paren
(paren
id|temp
op_amp
op_complement
id|EE_SYNC_MASK
)paren
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
multiline_comment|/*         if ((pCardInfo-&gt;ai_per_targ_wide_nego &amp; sync_bit_map) ||&n;            (id*2+i &gt;= 8)){&n;*/
r_if
c_cond
(paren
id|pCardInfo-&gt;ai_per_targ_wide_nego
op_amp
id|sync_bit_map
)paren
(brace
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarEEValue
op_or_assign
id|EE_WIDE_SCSI
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* NARROW SCSI */
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|WIDE_NEGOCIATED
suffix:semicolon
)brace
macro_line|#else
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|id
op_star
l_int|2
op_plus
id|i
)braket
dot
id|TarStatus
op_or_assign
id|WIDE_NEGOCIATED
suffix:semicolon
macro_line|#endif
id|sync_bit_map
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
id|pCardInfo-&gt;ai_SGListFormat
op_assign
l_int|0x01
suffix:semicolon
id|pCardInfo-&gt;ai_DataPtrFormat
op_assign
l_int|0x01
suffix:semicolon
id|pCardInfo-&gt;ai_AEN_mask
op_and_assign
id|SCSI_RESET_COMPLETE
suffix:semicolon
id|WR_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
comma
(paren
id|u08bits
)paren
(paren
id|RD_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
)paren
op_or
id|SCCB_MGR_PRESENT
)paren
)paren
suffix:semicolon
r_return
(paren
id|u32bits
)paren
id|CurrCard
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: build_ucb, exported to BUDI via UCBMgr_build_ucb entry&n; *&n; * Description: prepare fw portion of ucb. do not start, resource not guaranteed&n; *             so don&squot;t manipulate anything that&squot;s derived from states which&n; *             may change&n; *&n; *---------------------------------------------------------------------*/
DECL|function|build_UCB
r_void
id|build_UCB
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
id|u08bits
id|thisCard
suffix:semicolon
id|u08bits
id|i
comma
id|j
suffix:semicolon
id|PSCCB
id|p_sccb
suffix:semicolon
id|thisCard
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardIndex
suffix:semicolon
id|p_sccb
op_assign
(paren
id|PSCCB
)paren
id|p_ucb-&gt;UCB_MgrPrivatePtr
suffix:semicolon
id|p_sccb-&gt;Sccb_ucb_ptr
op_assign
id|p_ucb
suffix:semicolon
r_switch
c_cond
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
(paren
id|OPC_DEVICE_RESET
op_plus
id|OPC_XFER_SG
op_plus
id|OPC_CHK_RESIDUAL
)paren
)paren
(brace
r_case
id|OPC_DEVICE_RESET
suffix:colon
id|p_sccb-&gt;OperationCode
op_assign
id|RESET_COMMAND
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OPC_XFER_SG
suffix:colon
id|p_sccb-&gt;OperationCode
op_assign
id|SCATTER_GATHER_COMMAND
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OPC_XFER_SG
op_plus
id|OPC_CHK_RESIDUAL
suffix:colon
id|p_sccb-&gt;OperationCode
op_assign
id|RESIDUAL_SG_COMMAND
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OPC_CHK_RESIDUAL
suffix:colon
id|p_sccb-&gt;OperationCode
op_assign
id|RESIDUAL_COMMAND
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|p_sccb-&gt;OperationCode
op_assign
id|SCSI_INITIATOR_COMMAND
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_TQ_ENABLE
)paren
(brace
id|p_sccb-&gt;ControlByte
op_assign
(paren
id|u08bits
)paren
(paren
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_TQ_MASK
)paren
op_rshift
l_int|2
)paren
op_or
id|F_USE_CMD_Q
suffix:semicolon
)brace
r_else
(brace
id|p_sccb-&gt;ControlByte
op_assign
l_int|0
suffix:semicolon
)brace
id|p_sccb-&gt;CdbLength
op_assign
(paren
id|u08bits
)paren
id|p_ucb-&gt;UCB_cdblen
suffix:semicolon
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_NO_AUTO_SENSE
)paren
(brace
id|p_sccb-&gt;RequestSenseLength
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|p_sccb-&gt;RequestSenseLength
op_assign
(paren
r_int
r_char
)paren
id|p_ucb-&gt;UCB_senselen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_XFER_SG
)paren
(brace
id|p_sccb-&gt;DataPointer
op_assign
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|p_sccb-&gt;DataLength
op_assign
(paren
(paren
(paren
id|u32bits
)paren
id|p_ucb-&gt;UCB_NumSgElements
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_else
(brace
id|p_sccb-&gt;DataPointer
op_assign
id|p_ucb-&gt;UCB_phys_dataptr
suffix:semicolon
id|p_sccb-&gt;DataLength
op_assign
id|p_ucb-&gt;UCB_datalen
suffix:semicolon
)brace
suffix:semicolon
id|p_sccb-&gt;HostStatus
op_assign
l_int|0
suffix:semicolon
id|p_sccb-&gt;TargetStatus
op_assign
l_int|0
suffix:semicolon
id|p_sccb-&gt;TargID
op_assign
(paren
r_int
r_char
)paren
id|p_ucb-&gt;UCB_targid
suffix:semicolon
id|p_sccb-&gt;Lun
op_assign
(paren
r_int
r_char
)paren
id|p_ucb-&gt;UCB_lun
suffix:semicolon
id|p_sccb-&gt;SccbIOPort
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
suffix:semicolon
id|j
op_assign
id|p_ucb-&gt;UCB_cdblen
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p_sccb-&gt;Cdb
(braket
id|i
)braket
op_assign
id|p_ucb-&gt;UCB_cdb
(braket
id|i
)braket
suffix:semicolon
)brace
id|p_sccb-&gt;SensePointer
op_assign
id|p_ucb-&gt;UCB_phys_senseptr
suffix:semicolon
id|sinits
c_func
(paren
id|p_sccb
comma
id|thisCard
)paren
suffix:semicolon
)brace
macro_line|#ifndef NO_IOCTLS
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: GetDevSyncRate&n; *&n; *---------------------------------------------------------------------*/
DECL|function|GetDevSyncRate
id|STATIC
r_int
id|GetDevSyncRate
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
r_struct
id|_SYNC_RATE_INFO
op_star
id|pSyncStr
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|BASE_PORT
id|ioport
suffix:semicolon
id|u08bits
id|scsiID
comma
id|j
suffix:semicolon
macro_line|#if (FW_TYPE != _SCCB_MGR_)
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_targid
op_ge
id|pCurrCard-&gt;cardInfo-&gt;ai_MaxTarg
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|ioport
op_assign
id|pCurrCard-&gt;ioPort
suffix:semicolon
id|pSyncStr
op_assign
(paren
r_struct
id|_SYNC_RATE_INFO
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|scsiID
op_assign
(paren
id|u08bits
)paren
id|p_ucb-&gt;UCB_targid
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|pCurrCard-&gt;cardIndex
)braket
(braket
id|scsiID
)braket
suffix:semicolon
id|j
op_assign
id|currTar_Info-&gt;TarSyncCtrl
suffix:semicolon
r_switch
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
r_case
id|EE_SYNC_ASYNC
suffix:colon
id|pSyncStr-&gt;RequestMegaXferRate
op_assign
l_int|0x00
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EE_SYNC_5MB
suffix:colon
id|pSyncStr-&gt;RequestMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|50
suffix:colon
l_int|100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EE_SYNC_10MB
suffix:colon
id|pSyncStr-&gt;RequestMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EE_SYNC_20MB
suffix:colon
id|pSyncStr-&gt;RequestMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|200
suffix:colon
l_int|400
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
(paren
id|j
op_rshift
l_int|5
)paren
op_amp
l_int|0x07
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
(paren
id|j
op_amp
l_int|0x07
)paren
op_eq
l_int|0x00
)paren
(brace
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Async Mode */
)brace
r_else
(brace
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|200
suffix:colon
l_int|400
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|66
suffix:colon
l_int|122
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|50
suffix:colon
l_int|100
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|40
suffix:colon
l_int|80
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x05
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|33
suffix:colon
l_int|66
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x06
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|28
suffix:colon
l_int|56
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x07
suffix:colon
id|pSyncStr-&gt;ActualMegaXferRate
op_assign
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
ques
c_cond
l_int|25
suffix:colon
l_int|50
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pSyncStr-&gt;NegotiatedOffset
op_assign
id|j
op_amp
l_int|0x0f
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SetDevSyncRate&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SetDevSyncRate
id|STATIC
r_int
id|SetDevSyncRate
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
r_struct
id|_SYNC_RATE_INFO
op_star
id|pSyncStr
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|BASE_PORT
id|ioPort
suffix:semicolon
id|u08bits
id|scsiID
comma
id|i
comma
id|j
comma
id|syncVal
suffix:semicolon
id|u16bits
id|syncOffset
comma
id|actualXferRate
suffix:semicolon
r_union
(brace
id|u08bits
id|tempb
(braket
l_int|2
)braket
suffix:semicolon
id|u16bits
id|tempw
suffix:semicolon
)brace
id|temp2
suffix:semicolon
macro_line|#if (FW_TYPE != _SCCB_MGR_)
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_targid
op_ge
id|pCurrCard-&gt;cardInfo-&gt;ai_MaxTarg
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|ioPort
op_assign
id|pCurrCard-&gt;ioPort
suffix:semicolon
id|pSyncStr
op_assign
(paren
r_struct
id|_SYNC_RATE_INFO
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|scsiID
op_assign
(paren
id|u08bits
)paren
id|p_ucb-&gt;UCB_targid
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|pCurrCard-&gt;cardIndex
)braket
(braket
id|scsiID
)braket
suffix:semicolon
id|i
op_assign
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_xfer_pad
)paren
suffix:semicolon
multiline_comment|/* Save current value */
id|WR_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_xfer_pad
comma
(paren
id|i
op_or
id|ID_UNLOCK
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_select_id
comma
(paren
(paren
id|scsiID
op_lshift
l_int|4
)paren
op_or
id|scsiID
)paren
)paren
suffix:semicolon
id|j
op_assign
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_synctarg_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_xfer_pad
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* restore value */
id|actualXferRate
op_assign
id|pSyncStr-&gt;ActualMegaXferRate
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|j
op_amp
id|NARROW_SCSI
)paren
)paren
(brace
id|actualXferRate
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|actualXferRate
op_eq
l_int|0x00
)paren
(brace
id|syncVal
op_assign
id|EE_SYNC_ASYNC
suffix:semicolon
multiline_comment|/* Async Mode */
)brace
r_if
c_cond
(paren
id|actualXferRate
op_eq
l_int|0x0200
)paren
(brace
id|syncVal
op_assign
id|EE_SYNC_20MB
suffix:semicolon
multiline_comment|/* 20/40 MB Mode */
)brace
r_if
c_cond
(paren
id|actualXferRate
OG
l_int|0x0050
op_logical_and
id|actualXferRate
OL
l_int|0x0200
)paren
(brace
id|syncVal
op_assign
id|EE_SYNC_10MB
suffix:semicolon
multiline_comment|/* 10/20 MB Mode */
)brace
r_else
(brace
id|syncVal
op_assign
id|EE_SYNC_5MB
suffix:semicolon
multiline_comment|/* 5/10 MB Mode */
)brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_logical_and
id|EE_SYNC_MASK
op_eq
id|syncVal
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|currTar_Info-&gt;TarEEValue
op_assign
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
op_logical_neg
id|EE_SYNC_MASK
)paren
op_or
id|syncVal
suffix:semicolon
id|syncOffset
op_assign
(paren
id|SYNC_RATE_TBL
op_plus
id|scsiID
)paren
op_div
l_int|2
suffix:semicolon
id|temp2.tempw
op_assign
id|utilEERead
c_func
(paren
id|ioPort
comma
id|syncOffset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scsiID
op_amp
l_int|0x01
)paren
(brace
id|temp2.tempb
(braket
l_int|0
)braket
op_assign
(paren
id|temp2.tempb
(braket
l_int|0
)braket
op_amp
op_logical_neg
id|EE_SYNC_MASK
)paren
op_or
id|syncVal
suffix:semicolon
)brace
r_else
(brace
id|temp2.tempb
(braket
l_int|1
)braket
op_assign
(paren
id|temp2.tempb
(braket
l_int|1
)braket
op_amp
op_logical_neg
id|EE_SYNC_MASK
)paren
op_or
id|syncVal
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|ioPort
comma
l_int|1
)paren
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|ioPort
comma
id|temp2.tempw
comma
id|syncOffset
)paren
suffix:semicolon
id|utilEEWriteOnOff
c_func
(paren
id|ioPort
comma
l_int|0
)paren
suffix:semicolon
id|UpdateCheckSum
c_func
(paren
id|ioPort
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: GetDevWideMode&n; *&n; *---------------------------------------------------------------------*/
DECL|function|GetDevWideMode
r_int
id|GetDevWideMode
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
id|u08bits
op_star
id|pData
suffix:semicolon
id|pData
op_assign
(paren
id|u08bits
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|pCurrCard-&gt;cardIndex
)braket
(braket
id|p_ucb-&gt;UCB_targid
)braket
dot
id|TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
op_star
id|pData
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
op_star
id|pData
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SetDevWideMode&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SetDevWideMode
r_int
id|SetDevWideMode
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
id|u08bits
op_star
id|pData
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|BASE_PORT
id|ioPort
suffix:semicolon
id|u08bits
id|scsiID
comma
id|scsiWideMode
suffix:semicolon
id|u16bits
id|syncOffset
suffix:semicolon
r_union
(brace
id|u08bits
id|tempb
(braket
l_int|2
)braket
suffix:semicolon
id|u16bits
id|tempw
suffix:semicolon
)brace
id|temp2
suffix:semicolon
macro_line|#if (FW_TYPE != _SCCB_MGR_)
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCurrCard-&gt;cardInfo-&gt;ai_attributes
op_amp
id|WIDE_CAPABLE
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_targid
op_ge
id|pCurrCard-&gt;cardInfo-&gt;ai_MaxTarg
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|ioPort
op_assign
id|pCurrCard-&gt;ioPort
suffix:semicolon
id|pData
op_assign
(paren
id|u08bits
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|scsiID
op_assign
(paren
id|u08bits
)paren
id|p_ucb-&gt;UCB_targid
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|pCurrCard-&gt;cardIndex
)braket
(braket
id|scsiID
)braket
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pData
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|scsiWideMode
op_assign
id|EE_WIDE_SCSI
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|scsiWideMode
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|currTar_Info-&gt;TarEEValue
op_assign
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
op_logical_neg
id|EE_WIDE_SCSI
)paren
op_or
id|scsiWideMode
suffix:semicolon
id|syncOffset
op_assign
(paren
id|SYNC_RATE_TBL
op_plus
id|scsiID
)paren
op_div
l_int|2
suffix:semicolon
id|temp2.tempw
op_assign
id|utilEERead
c_func
(paren
id|ioPort
comma
id|syncOffset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scsiID
op_amp
l_int|0x01
)paren
(brace
id|temp2.tempb
(braket
l_int|0
)braket
op_assign
(paren
id|temp2.tempb
(braket
l_int|0
)braket
op_amp
op_logical_neg
id|EE_WIDE_SCSI
)paren
op_or
id|scsiWideMode
suffix:semicolon
)brace
r_else
(brace
id|temp2.tempb
(braket
l_int|1
)braket
op_assign
(paren
id|temp2.tempb
(braket
l_int|1
)braket
op_amp
op_logical_neg
id|EE_WIDE_SCSI
)paren
op_or
id|scsiWideMode
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|ioPort
comma
l_int|1
)paren
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|ioPort
comma
id|temp2.tempw
comma
id|syncOffset
)paren
suffix:semicolon
id|utilEEWriteOnOff
c_func
(paren
id|ioPort
comma
l_int|0
)paren
suffix:semicolon
id|UpdateCheckSum
c_func
(paren
id|ioPort
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: ReadNVRam&n; *&n; *---------------------------------------------------------------------*/
DECL|function|ReadNVRam
r_void
id|ReadNVRam
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
id|u08bits
op_star
id|pdata
suffix:semicolon
id|u16bits
id|i
comma
id|numwrds
comma
id|numbytes
comma
id|offset
comma
id|temp
suffix:semicolon
id|u08bits
id|OneMore
op_assign
id|FALSE
suffix:semicolon
macro_line|#if defined(DOS)
id|u16bits
id|ioport
suffix:semicolon
macro_line|#else
id|u32bits
id|ioport
suffix:semicolon
macro_line|#endif
id|numbytes
op_assign
(paren
id|u16bits
)paren
id|p_ucb-&gt;UCB_datalen
suffix:semicolon
id|ioport
op_assign
id|pCurrCard-&gt;ioPort
suffix:semicolon
id|pdata
op_assign
(paren
id|u08bits
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|offset
op_assign
(paren
id|u16bits
)paren
(paren
id|p_ucb-&gt;UCB_IOCTLParams
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x1
)paren
(brace
op_star
(paren
(paren
id|u16bits
op_star
)paren
id|pdata
)paren
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
(paren
id|offset
op_minus
l_int|1
)paren
op_div
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* 16 bit read */
op_star
id|pdata
op_assign
op_star
(paren
id|pdata
op_plus
l_int|1
)paren
suffix:semicolon
op_increment
id|offset
suffix:semicolon
op_increment
id|pdata
suffix:semicolon
op_decrement
id|numbytes
suffix:semicolon
)brace
id|numwrds
op_assign
id|numbytes
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|numbytes
op_amp
l_int|1
)paren
id|OneMore
op_assign
id|TRUE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numwrds
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
(paren
(paren
id|u16bits
op_star
)paren
id|pdata
)paren
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
id|offset
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pdata
op_add_assign
l_int|2
suffix:semicolon
id|offset
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|OneMore
)paren
(brace
op_decrement
id|pdata
suffix:semicolon
op_decrement
id|offset
suffix:semicolon
id|temp
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
id|offset
op_div
l_int|2
)paren
)paren
suffix:semicolon
op_star
id|pdata
op_assign
(paren
id|u08bits
)paren
(paren
id|temp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end proc ReadNVRam */
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: WriteNVRam&n; *&n; *---------------------------------------------------------------------*/
DECL|function|WriteNVRam
r_void
id|WriteNVRam
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
(brace
id|u08bits
op_star
id|pdata
suffix:semicolon
id|u16bits
id|i
comma
id|numwrds
comma
id|numbytes
comma
id|offset
comma
id|eeprom_end
suffix:semicolon
id|u08bits
id|OneMore
op_assign
id|FALSE
suffix:semicolon
r_union
(brace
id|u08bits
id|tempb
(braket
l_int|2
)braket
suffix:semicolon
id|u16bits
id|tempw
suffix:semicolon
)brace
id|temp2
suffix:semicolon
macro_line|#if defined(DOS)
id|u16bits
id|ioport
suffix:semicolon
macro_line|#else
id|u32bits
id|ioport
suffix:semicolon
macro_line|#endif
id|numbytes
op_assign
(paren
id|u16bits
)paren
id|p_ucb-&gt;UCB_datalen
suffix:semicolon
id|ioport
op_assign
id|pCurrCard-&gt;ioPort
suffix:semicolon
id|pdata
op_assign
(paren
id|u08bits
op_star
)paren
id|p_ucb-&gt;UCB_virt_dataptr
suffix:semicolon
id|offset
op_assign
(paren
id|u16bits
)paren
(paren
id|p_ucb-&gt;UCB_IOCTLParams
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|eeprom_end
op_assign
l_int|512
suffix:semicolon
r_else
id|eeprom_end
op_assign
l_int|768
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
id|eeprom_end
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|offset
op_plus
id|numbytes
)paren
OG
id|eeprom_end
)paren
(brace
id|numbytes
op_assign
id|eeprom_end
op_minus
id|offset
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|ioport
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable write access to the EEPROM */
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x1
)paren
(brace
id|temp2.tempw
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
(paren
id|offset
op_minus
l_int|1
)paren
op_div
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* 16 bit read */
id|temp2.tempb
(braket
l_int|1
)braket
op_assign
op_star
id|pdata
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|ioport
comma
id|temp2.tempw
comma
(paren
id|u16bits
)paren
(paren
(paren
id|offset
op_minus
l_int|1
)paren
op_div
l_int|2
)paren
)paren
suffix:semicolon
op_star
id|pdata
op_assign
op_star
(paren
id|pdata
op_plus
l_int|1
)paren
suffix:semicolon
op_increment
id|offset
suffix:semicolon
op_increment
id|pdata
suffix:semicolon
op_decrement
id|numbytes
suffix:semicolon
)brace
id|numwrds
op_assign
id|numbytes
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|numbytes
op_amp
l_int|1
)paren
id|OneMore
op_assign
id|TRUE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numwrds
suffix:semicolon
id|i
op_increment
)paren
(brace
id|utilEEWrite
c_func
(paren
id|ioport
comma
op_star
(paren
(paren
id|pu16bits
)paren
id|pdata
)paren
comma
(paren
id|u16bits
)paren
(paren
id|offset
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|pdata
op_add_assign
l_int|2
suffix:semicolon
id|offset
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|OneMore
)paren
(brace
id|temp2.tempw
op_assign
id|utilEERead
c_func
(paren
id|ioport
comma
(paren
id|u16bits
)paren
(paren
id|offset
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|temp2.tempb
(braket
l_int|0
)braket
op_assign
op_star
id|pdata
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|ioport
comma
id|temp2.tempw
comma
(paren
id|u16bits
)paren
(paren
id|offset
op_div
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|ioport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Turn off write access */
id|UpdateCheckSum
c_func
(paren
(paren
id|u32bits
)paren
id|ioport
)paren
suffix:semicolon
)brace
multiline_comment|/* end proc WriteNVRam */
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: UpdateCheckSum&n; *&n; * Description: Update Check Sum in EEPROM&n; *&n; *---------------------------------------------------------------------*/
DECL|function|UpdateCheckSum
r_void
id|UpdateCheckSum
c_func
(paren
id|u32bits
id|baseport
)paren
(brace
id|USHORT
id|i
comma
id|sum_data
comma
id|eeprom_end
suffix:semicolon
id|sum_data
op_assign
l_int|0x0000
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|baseport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|eeprom_end
op_assign
l_int|512
suffix:semicolon
r_else
id|eeprom_end
op_assign
l_int|768
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|eeprom_end
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sum_data
op_add_assign
id|utilEERead
c_func
(paren
id|baseport
comma
id|i
)paren
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|baseport
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable write access to the EEPROM */
id|utilEEWrite
c_func
(paren
id|baseport
comma
id|sum_data
comma
id|EEPROM_CHECK_SUM
op_div
l_int|2
)paren
suffix:semicolon
id|utilEEWriteOnOff
c_func
(paren
id|baseport
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Turn off write access */
)brace
DECL|function|SccbMgr_save_foreign_state
r_void
id|SccbMgr_save_foreign_state
c_func
(paren
id|PADAPTER_INFO
id|pAdapterInfo
)paren
(brace
)brace
DECL|function|SccbMgr_restore_foreign_state
r_void
id|SccbMgr_restore_foreign_state
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
(brace
)brace
DECL|function|SccbMgr_restore_native_state
r_void
id|SccbMgr_restore_native_state
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
(brace
)brace
macro_line|#endif /* NO_IOCTLS */
macro_line|#endif /* (FW_TYPE==_UCB_MGR_)   */
macro_line|#ifndef NO_IOCTLS
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_unload_card
r_void
id|SccbMgr_unload_card
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|SccbMgr_unload_card
c_func
(paren
id|USHORT
id|pCurrCard
)paren
macro_line|#else
r_void
id|SccbMgr_unload_card
c_func
(paren
id|ULONG
id|pCurrCard
)paren
macro_line|#endif
macro_line|#endif
(brace
id|UCHAR
id|i
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|portBase
suffix:semicolon
id|USHORT
id|regOffset
suffix:semicolon
macro_line|#else
id|ULONG
id|portBase
suffix:semicolon
id|ULONG
id|regOffset
suffix:semicolon
macro_line|#endif
id|ULONG
id|scamData
suffix:semicolon
macro_line|#if defined(OS2)
id|ULONG
id|far
op_star
id|pScamTbl
suffix:semicolon
macro_line|#else
id|ULONG
op_star
id|pScamTbl
suffix:semicolon
macro_line|#endif
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|pCurrNvRam
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
l_int|0
comma
id|pCurrNvRam-&gt;niModel
)paren
suffix:semicolon
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
l_int|1
comma
id|pCurrNvRam-&gt;niSysConf
)paren
suffix:semicolon
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
l_int|2
comma
id|pCurrNvRam-&gt;niScsiConf
)paren
suffix:semicolon
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
l_int|3
comma
id|pCurrNvRam-&gt;niScamConf
)paren
suffix:semicolon
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
l_int|4
comma
id|pCurrNvRam-&gt;niAdapId
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|WrStack
c_func
(paren
id|pCurrNvRam-&gt;niBaseAddr
comma
(paren
id|UCHAR
)paren
(paren
id|i
op_plus
l_int|5
)paren
comma
id|pCurrNvRam-&gt;niSyncTbl
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|portBase
op_assign
id|pCurrNvRam-&gt;niBaseAddr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regOffset
op_assign
id|hp_aramBase
op_plus
l_int|64
op_plus
id|i
op_star
l_int|4
suffix:semicolon
macro_line|#if defined(OS2)
id|pScamTbl
op_assign
(paren
id|ULONG
id|far
op_star
)paren
op_amp
id|pCurrNvRam-&gt;niScamTbl
(braket
id|i
)braket
suffix:semicolon
macro_line|#else
id|pScamTbl
op_assign
(paren
id|ULONG
op_star
)paren
op_amp
id|pCurrNvRam-&gt;niScamTbl
(braket
id|i
)braket
suffix:semicolon
macro_line|#endif
id|scamData
op_assign
op_star
id|pScamTbl
suffix:semicolon
id|WR_HARP32
c_func
(paren
id|portBase
comma
id|regOffset
comma
id|scamData
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|WrStack
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* NO_IOCTLS */
DECL|function|RNVRamData
r_void
id|RNVRamData
c_func
(paren
id|PNVRamInfo
id|pNvRamInfo
)paren
(brace
id|UCHAR
id|i
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|portBase
suffix:semicolon
id|USHORT
id|regOffset
suffix:semicolon
macro_line|#else
id|ULONG
id|portBase
suffix:semicolon
id|ULONG
id|regOffset
suffix:semicolon
macro_line|#endif
id|ULONG
id|scamData
suffix:semicolon
macro_line|#if defined (OS2)
id|ULONG
id|far
op_star
id|pScamTbl
suffix:semicolon
macro_line|#else
id|ULONG
op_star
id|pScamTbl
suffix:semicolon
macro_line|#endif
id|pNvRamInfo-&gt;niModel
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
l_int|0
)paren
suffix:semicolon
id|pNvRamInfo-&gt;niSysConf
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
l_int|1
)paren
suffix:semicolon
id|pNvRamInfo-&gt;niScsiConf
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
l_int|2
)paren
suffix:semicolon
id|pNvRamInfo-&gt;niScamConf
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
l_int|3
)paren
suffix:semicolon
id|pNvRamInfo-&gt;niAdapId
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pNvRamInfo-&gt;niSyncTbl
(braket
id|i
)braket
op_assign
id|RdStack
c_func
(paren
id|pNvRamInfo-&gt;niBaseAddr
comma
(paren
id|UCHAR
)paren
(paren
id|i
op_plus
l_int|5
)paren
)paren
suffix:semicolon
)brace
id|portBase
op_assign
id|pNvRamInfo-&gt;niBaseAddr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regOffset
op_assign
id|hp_aramBase
op_plus
l_int|64
op_plus
id|i
op_star
l_int|4
suffix:semicolon
id|RD_HARP32
c_func
(paren
id|portBase
comma
id|regOffset
comma
id|scamData
)paren
suffix:semicolon
macro_line|#if defined(OS2)
id|pScamTbl
op_assign
(paren
id|ULONG
id|far
op_star
)paren
op_amp
id|pNvRamInfo-&gt;niScamTbl
(braket
id|i
)braket
suffix:semicolon
macro_line|#else
id|pScamTbl
op_assign
(paren
id|ULONG
op_star
)paren
op_amp
id|pNvRamInfo-&gt;niScamTbl
(braket
id|i
)braket
suffix:semicolon
macro_line|#endif
op_star
id|pScamTbl
op_assign
id|scamData
suffix:semicolon
)brace
)brace
macro_line|#if defined(DOS)
DECL|function|RdStack
id|UCHAR
id|RdStack
c_func
(paren
id|USHORT
id|portBase
comma
id|UCHAR
id|index
)paren
macro_line|#else
id|UCHAR
id|RdStack
c_func
(paren
id|ULONG
id|portBase
comma
id|UCHAR
id|index
)paren
macro_line|#endif
(brace
id|WR_HARPOON
c_func
(paren
id|portBase
op_plus
id|hp_stack_addr
comma
id|index
)paren
suffix:semicolon
r_return
id|RD_HARPOON
c_func
(paren
id|portBase
op_plus
id|hp_stack_data
)paren
suffix:semicolon
)brace
macro_line|#if defined(DOS)
DECL|function|WrStack
r_void
id|WrStack
c_func
(paren
id|USHORT
id|portBase
comma
id|UCHAR
id|index
comma
id|UCHAR
id|data
)paren
macro_line|#else
r_void
id|WrStack
c_func
(paren
id|ULONG
id|portBase
comma
id|UCHAR
id|index
comma
id|UCHAR
id|data
)paren
macro_line|#endif
(brace
id|WR_HARPOON
c_func
(paren
id|portBase
op_plus
id|hp_stack_addr
comma
id|index
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|portBase
op_plus
id|hp_stack_data
comma
id|data
)paren
suffix:semicolon
)brace
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|ChkIfChipInitialized
id|u08bits
id|ChkIfChipInitialized
c_func
(paren
id|BASE_PORT
id|ioPort
)paren
macro_line|#else
macro_line|#if defined(DOS)
id|UCHAR
id|ChkIfChipInitialized
c_func
(paren
id|USHORT
id|ioPort
)paren
macro_line|#else
id|UCHAR
id|ChkIfChipInitialized
c_func
(paren
id|ULONG
id|ioPort
)paren
macro_line|#endif
macro_line|#endif
(brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_arb_id
)paren
op_amp
l_int|0x0f
)paren
op_ne
id|RdStack
c_func
(paren
id|ioPort
comma
l_int|4
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_clkctrl_0
)paren
op_amp
id|CLKCTRL_DEFAULT
)paren
op_ne
id|CLKCTRL_DEFAULT
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_seltimeout
)paren
op_eq
id|TO_250ms
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|ioPort
op_plus
id|hp_seltimeout
)paren
op_eq
id|TO_290ms
)paren
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_start_sccb&n; *&n; * Description: Start a command pointed to by p_Sccb. When the&n; *              command is completed it will be returned via the&n; *              callback function.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_start_sccb
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|USHORT
id|pCurrCard
comma
id|PSCCB
id|p_Sccb
)paren
macro_line|#else
r_void
id|SccbMgr_start_sccb
c_func
(paren
id|ULONG
id|pCurrCard
comma
id|PSCCB
id|p_Sccb
)paren
macro_line|#endif
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
id|UCHAR
id|thisCard
comma
id|lun
suffix:semicolon
id|PSCCB
id|pSaveSccb
suffix:semicolon
id|CALL_BK_FN
id|callback
suffix:semicolon
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|PSCCB
id|p_Sccb
suffix:semicolon
macro_line|#endif
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
id|thisCard
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardIndex
suffix:semicolon
id|ioport
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
suffix:semicolon
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|p_Sccb
op_assign
(paren
id|PSCCB
)paren
id|p_ucb-&gt;UCB_MgrPrivatePtr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|p_Sccb-&gt;TargID
OG
id|MAX_SCSI_TAR
)paren
op_logical_or
(paren
id|p_Sccb-&gt;Lun
OG
id|MAX_LUN
)paren
)paren
(brace
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|p_ucb-&gt;UCB_hbastat
op_assign
id|SCCB_COMPLETE
suffix:semicolon
id|p_ucb-&gt;UCB_status
op_assign
id|SCCB_ERROR
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if (FW_TYPE==_SCCB_MGR_)
id|p_Sccb-&gt;HostStatus
op_assign
id|SCCB_COMPLETE
suffix:semicolon
id|p_Sccb-&gt;SccbStatus
op_assign
id|SCCB_ERROR
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_Sccb-&gt;SccbCallback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_Sccb
)paren
suffix:semicolon
macro_line|#endif
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if (FW_TYPE==_SCCB_MGR_)
id|sinits
c_func
(paren
id|p_Sccb
comma
id|thisCard
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if (FW_TYPE==_UCB_MGR_)
macro_line|#ifndef NO_IOCTLS
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_IOCTL
)paren
(brace
r_switch
c_cond
(paren
id|p_ucb-&gt;UCB_IOCTLCommand
)paren
(brace
r_case
id|READ_NVRAM
suffix:colon
id|ReadNVRam
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
suffix:semicolon
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|WRITE_NVRAM
suffix:colon
id|WriteNVRam
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
suffix:semicolon
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SEND_SCSI_PASSTHRU
suffix:colon
macro_line|#if (FW_TYPE != _SCCB_MGR_)
r_if
c_cond
(paren
id|p_ucb-&gt;UCB_targid
op_ge
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardInfo-&gt;ai_MaxTarg
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_ERROR
suffix:semicolon
id|p_ucb-&gt;UCB_hbastat
op_assign
id|HASTAT_HW_ERROR
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
r_case
id|HARD_RESET
suffix:colon
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_INVALID
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|GET_DEVICE_SYNCRATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|GetDevSyncRate
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
)brace
r_else
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_ERROR
suffix:semicolon
id|p_ucb-&gt;UCB_hbastat
op_assign
id|HASTAT_HW_ERROR
suffix:semicolon
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SET_DEVICE_SYNCRATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|SetDevSyncRate
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
)brace
r_else
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_ERROR
suffix:semicolon
id|p_ucb-&gt;UCB_hbastat
op_assign
id|HASTAT_HW_ERROR
suffix:semicolon
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|GET_WIDE_MODE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|GetDevWideMode
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
)brace
r_else
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_ERROR
suffix:semicolon
id|p_ucb-&gt;UCB_hbastat
op_assign
id|HASTAT_HW_ERROR
suffix:semicolon
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SET_WIDE_MODE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|SetDevWideMode
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|p_ucb
)paren
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_SUCCESS
suffix:semicolon
)brace
r_else
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_ERROR
suffix:semicolon
id|p_ucb-&gt;UCB_hbastat
op_assign
id|HASTAT_HW_ERROR
suffix:semicolon
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|p_ucb-&gt;UCB_status
op_assign
id|UCB_INVALID
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
macro_line|#endif /* NO_IOCTLS */
macro_line|#endif /* (FW_TYPE==_UCB_MGR_) */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cmdCounter
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
comma
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
op_or
id|SCCB_MGR_ACTIVE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_GREEN_PC
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
)brace
)brace
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cmdCounter
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
op_amp
id|BIOS_IN_USE
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
comma
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
op_or
id|TICKLE_ME
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p_Sccb-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
id|pSaveSccb
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|queueSelectFail
c_func
(paren
op_amp
id|BL_Card
(braket
id|thisCard
)braket
comma
id|thisCard
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|pSaveSccb
suffix:semicolon
)brace
r_else
(brace
id|queueAddSccb
c_func
(paren
id|p_Sccb
comma
id|thisCard
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|G_INT_DISABLE
)paren
)paren
(brace
r_if
c_cond
(paren
id|p_Sccb-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
id|pSaveSccb
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|queueSelectFail
c_func
(paren
op_amp
id|BL_Card
(braket
id|thisCard
)braket
comma
id|thisCard
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|pSaveSccb
suffix:semicolon
)brace
r_else
(brace
id|queueAddSccb
c_func
(paren
id|p_Sccb
comma
id|thisCard
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|MDISABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|p_Sccb-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|lun
op_assign
id|p_Sccb-&gt;Lun
suffix:semicolon
)brace
r_else
id|lun
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_eq
l_int|NULL
)paren
op_logical_and
(paren
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|p_Sccb-&gt;TargID
)braket
dot
id|TarSelQ_Cnt
op_eq
l_int|0
)paren
op_logical_and
(paren
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|p_Sccb-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|lun
)braket
op_eq
id|FALSE
)paren
)paren
(brace
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
macro_line|#if defined(DOS)
id|ssel
c_func
(paren
(paren
id|USHORT
)paren
id|p_Sccb-&gt;SccbIOPort
comma
id|thisCard
)paren
suffix:semicolon
macro_line|#else
id|ssel
c_func
(paren
id|p_Sccb-&gt;SccbIOPort
comma
id|thisCard
)paren
suffix:semicolon
macro_line|#endif
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p_Sccb-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
id|pSaveSccb
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|queueSelectFail
c_func
(paren
op_amp
id|BL_Card
(braket
id|thisCard
)braket
comma
id|thisCard
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|pSaveSccb
suffix:semicolon
)brace
r_else
(brace
id|queueAddSccb
c_func
(paren
id|p_Sccb
comma
id|thisCard
)paren
suffix:semicolon
)brace
)brace
id|MENABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
)brace
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_abort_sccb&n; *&n; * Description: Abort the command pointed to by p_Sccb.  When the&n; *              command is completed it will be returned via the&n; *              callback function.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_abort_sccb
id|s32bits
id|SccbMgr_abort_sccb
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
comma
id|PUCB
id|p_ucb
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_int
id|SccbMgr_abort_sccb
c_func
(paren
id|USHORT
id|pCurrCard
comma
id|PSCCB
id|p_Sccb
)paren
macro_line|#else
r_int
id|SccbMgr_abort_sccb
c_func
(paren
id|ULONG
id|pCurrCard
comma
id|PSCCB
id|p_Sccb
)paren
macro_line|#endif
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
id|UCHAR
id|thisCard
suffix:semicolon
id|CALL_BK_FN
id|callback
suffix:semicolon
id|UCHAR
id|TID
suffix:semicolon
id|PSCCB
id|pSaveSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|PSCCB
id|p_Sccb
suffix:semicolon
id|p_Sccb
op_assign
(paren
id|PSCCB
)paren
id|p_ucb-&gt;UCB_MgrPrivatePtr
suffix:semicolon
macro_line|#endif
id|ioport
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
suffix:semicolon
id|thisCard
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardIndex
suffix:semicolon
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_page_ctrl
)paren
op_amp
id|G_INT_DISABLE
)paren
(brace
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|queueFindSccb
c_func
(paren
id|p_Sccb
comma
id|thisCard
)paren
)paren
(brace
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cmdCounter
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cmdCounter
)paren
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
comma
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_semaphore
)paren
op_amp
(paren
id|UCHAR
)paren
(paren
op_complement
(paren
id|SCCB_MGR_ACTIVE
op_or
id|TICKLE_ME
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#if (FW_TYPE==_SCCB_MGR_)
id|p_Sccb-&gt;SccbStatus
op_assign
id|SCCB_ABORT
suffix:semicolon
id|callback
op_assign
id|p_Sccb-&gt;SccbCallback
suffix:semicolon
id|callback
c_func
(paren
id|p_Sccb
)paren
suffix:semicolon
macro_line|#else
id|p_ucb-&gt;UCB_status
op_assign
id|SCCB_ABORT
suffix:semicolon
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_eq
id|p_Sccb
)paren
(brace
id|p_Sccb-&gt;SccbStatus
op_assign
id|SCCB_ABORT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|TID
op_assign
id|p_Sccb-&gt;TargID
suffix:semicolon
r_if
c_cond
(paren
id|p_Sccb-&gt;Sccb_tag
)paren
(brace
id|MDISABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|discQ_Tbl
(braket
id|p_Sccb-&gt;Sccb_tag
)braket
op_eq
id|p_Sccb
)paren
(brace
id|p_Sccb-&gt;SccbStatus
op_assign
id|SCCB_ABORT
suffix:semicolon
id|p_Sccb-&gt;Sccb_scsistat
op_assign
id|ABORT_ST
suffix:semicolon
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|p_ucb-&gt;UCB_status
op_assign
id|SCCB_ABORT
suffix:semicolon
macro_line|#endif
id|p_Sccb-&gt;Sccb_scsimsg
op_assign
id|SMABORT_TAG
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_eq
l_int|NULL
)paren
(brace
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|ssel
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
(brace
id|pSaveSCCB
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|p_Sccb
suffix:semicolon
id|queueSelectFail
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
comma
id|thisCard
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_assign
id|pSaveSCCB
suffix:semicolon
)brace
)brace
id|MENABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|thisCard
)braket
(braket
id|p_Sccb-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|thisCard
)braket
dot
id|discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|p_Sccb-&gt;Lun
)braket
)braket
op_eq
id|p_Sccb
)paren
(brace
id|p_Sccb-&gt;SccbStatus
op_assign
id|SCCB_ABORT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_my_int&n; *&n; * Description: Do a quick check to determine if there is a pending&n; *              interrupt for this card and disable the IRQ Pin if so.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_my_int
id|u08bits
id|SccbMgr_my_int
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
macro_line|#else
macro_line|#if defined(DOS)
id|UCHAR
id|SccbMgr_my_int
c_func
(paren
id|USHORT
id|pCurrCard
)paren
macro_line|#else
id|UCHAR
id|SccbMgr_my_int
c_func
(paren
id|ULONG
id|pCurrCard
)paren
macro_line|#endif
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
id|ioport
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_int_status
)paren
op_amp
id|INT_ASSERTED
)paren
(brace
macro_line|#if defined(DOS)
id|MDISABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
macro_line|#endif
r_return
id|TRUE
suffix:semicolon
)brace
r_else
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_isr&n; *&n; * Description: This is our entry point when an interrupt is generated&n; *              by the card and the upper level driver passes it on to&n; *              us.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_isr
id|s32bits
id|SccbMgr_isr
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_int
id|SccbMgr_isr
c_func
(paren
id|USHORT
id|pCurrCard
)paren
macro_line|#else
r_int
id|SccbMgr_isr
c_func
(paren
id|ULONG
id|pCurrCard
)paren
macro_line|#endif
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|UCHAR
id|thisCard
comma
id|result
comma
id|bm_status
comma
id|bm_int_st
suffix:semicolon
id|USHORT
id|hp_int
suffix:semicolon
id|UCHAR
id|i
comma
id|target
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|ioport
suffix:semicolon
macro_line|#else
id|ULONG
id|ioport
suffix:semicolon
macro_line|#endif
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
id|thisCard
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardIndex
suffix:semicolon
id|ioport
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
suffix:semicolon
id|MDISABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_user_defined_D
comma
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_int_status
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|bm_int_st
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_int_status
)paren
)paren
op_amp
id|EXT_STATUS_ON
)paren
id|bm_status
op_assign
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_ext_status
)paren
op_amp
(paren
id|UCHAR
)paren
id|BAD_EXT_STATUS
suffix:semicolon
r_else
id|bm_status
op_assign
l_int|0
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_int_mask
comma
(paren
id|INT_CMD_COMPL
op_or
id|SCSI_INTERRUPT
)paren
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|hp_int
op_assign
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|default_intena
)paren
op_or
id|bm_status
)paren
(brace
id|currSCCB
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|Debug_Load
c_func
(paren
id|thisCard
comma
(paren
id|UCHAR
)paren
l_int|0XFF
)paren
suffix:semicolon
id|Debug_Load
c_func
(paren
id|thisCard
comma
id|bm_int_st
)paren
suffix:semicolon
id|Debug_Load
c_func
(paren
id|thisCard
comma
id|hp_int_0
)paren
suffix:semicolon
id|Debug_Load
c_func
(paren
id|thisCard
comma
id|hp_int_1
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hp_int
op_amp
(paren
id|FIFO
op_or
id|TIMEOUT
op_or
id|RESET
op_or
id|SCAM_SEL
)paren
op_logical_or
id|bm_status
)paren
(brace
id|result
op_assign
id|SccbMgr_bad_isr
c_func
(paren
id|ioport
comma
id|thisCard
comma
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
comma
id|hp_int
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|FIFO
op_or
id|TIMEOUT
op_or
id|RESET
op_or
id|SCAM_SEL
)paren
)paren
suffix:semicolon
id|bm_status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
id|MENABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|ICMD_COMP
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|hp_int
op_amp
id|BUS_FREE
)paren
)paren
(brace
multiline_comment|/* Wait for the BusFree before starting a new command.  We&n;               must also check for being reselected since the BusFree&n;               may not show up if another device reselects us in 1.5us or&n;               less.  SRR Wednesday, 3/8/1995.&n;&t;         */
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RSEL
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
id|phaseChkFifo
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
multiline_comment|/*         WRW_HARPOON((ioport+hp_intstat),&n;            (BUS_FREE | ICMD_COMP | ITAR_DISC | XFER_CNT_0));&n;         */
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT_1
)paren
suffix:semicolon
id|autoCmdCmplt
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|ITAR_DISC
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|phaseChkFifo
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_gp_reg_1
)paren
op_eq
id|SMSAVE_DATA_PTR
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_gp_reg_1
comma
l_int|0x00
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_or_assign
id|F_NO_DATA_YET
suffix:semicolon
id|currSCCB-&gt;Sccb_savedATC
op_assign
id|currSCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|DISCONNECT_ST
suffix:semicolon
id|queueDisconnect
c_func
(paren
id|currSCCB
comma
id|thisCard
)paren
suffix:semicolon
multiline_comment|/* Wait for the BusFree before starting a new command.  We&n;               must also check for being reselected since the BusFree&n;               may not show up if another device reselects us in 1.5us or&n;               less.  SRR Wednesday, 3/8/1995.&n;             */
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RSEL
)paren
)paren
op_logical_and
op_logical_neg
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|PHASE
)paren
op_logical_and
id|RD_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_scsisig
)paren
)paren
op_eq
(paren
id|SCSI_BSY
op_or
id|SCSI_REQ
op_or
id|SCSI_CD
op_or
id|SCSI_MSG
op_or
id|SCSI_IOBIT
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;     The additional loop exit condition above detects a timing problem&n;&t;     with the revision D/E harpoon chips.  The caller should reset the&n;&t;     host adapter to recover when 0xFE is returned.&n;&t;   */
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RSEL
)paren
)paren
)paren
(brace
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
id|MENABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
l_int|0xFE
suffix:semicolon
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|ITAR_DISC
)paren
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|RSEL
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|PROG_HLT
op_or
id|RSEL
op_or
id|PHASE
op_or
id|BUS_FREE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|ITAR_DISC
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|phaseChkFifo
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_gp_reg_1
)paren
op_eq
id|SMSAVE_DATA_PTR
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_gp_reg_1
comma
l_int|0x00
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_or_assign
id|F_NO_DATA_YET
suffix:semicolon
id|currSCCB-&gt;Sccb_savedATC
op_assign
id|currSCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|ITAR_DISC
)paren
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|DISCONNECT_ST
suffix:semicolon
id|queueDisconnect
c_func
(paren
id|currSCCB
comma
id|thisCard
)paren
suffix:semicolon
)brace
id|sres
c_func
(paren
id|ioport
comma
id|thisCard
comma
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
)paren
suffix:semicolon
id|phaseDecode
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|hp_int
op_amp
id|IDO_STRT
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|hp_int
op_amp
id|BUS_FREE
)paren
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|IDO_STRT
op_or
id|XFER_CNT_0
)paren
)paren
suffix:semicolon
id|phaseDecode
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|hp_int
op_amp
id|IUNKWN
)paren
op_logical_or
(paren
id|hp_int
op_amp
id|PROG_HLT
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
(paren
id|PHASE
op_or
id|IUNKWN
op_or
id|PROG_HLT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_prgmcnt_0
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x3f
)paren
OL
(paren
id|UCHAR
)paren
id|SELCHK
)paren
(brace
id|phaseDecode
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Harpoon problem some SCSI target device respond to selection&n;   with short BUSY pulse (&lt;400ns) this will make the Harpoon is not able&n;   to latch the correct Target ID into reg. x53.&n;   The work around require to correct this reg. But when write to this&n;   reg. (0x53) also increment the FIFO write addr reg (0x6f), thus we&n;   need to read this reg first then restore it later. After update to 0x53 */
id|i
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_fifowrite
)paren
)paren
suffix:semicolon
id|target
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_gp_reg_3
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|UCHAR
)paren
id|ID_UNLOCK
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_select_id
comma
(paren
id|UCHAR
)paren
(paren
id|target
op_or
id|target
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_xfer_pad
comma
(paren
id|UCHAR
)paren
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_fifowrite
comma
id|i
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|ioport
op_plus
id|hp_autostart_3
comma
(paren
id|AUTO_IMMED
op_plus
id|TAG_STRT
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|XFER_CNT_0
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
id|schkdd
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|BUS_FREE
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
id|BUS_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|hostDataXferAbort
c_func
(paren
id|ioport
comma
id|thisCard
comma
id|currSCCB
)paren
suffix:semicolon
)brace
id|phaseBusFree
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hp_int
op_amp
id|ITICKLE
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|ioport
op_plus
id|hp_intstat
)paren
comma
id|ITICKLE
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_NEW_SCCB_CMD
)paren
(brace
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_and_assign
op_complement
id|F_NEW_SCCB_CMD
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_eq
l_int|NULL
)paren
(brace
id|queueSearchSelect
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|currentSCCB
op_ne
l_int|NULL
)paren
(brace
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_and_assign
op_complement
id|F_NEW_SCCB_CMD
suffix:semicolon
id|ssel
c_func
(paren
id|ioport
comma
id|thisCard
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*end while */
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
id|MENABLE_INT
c_func
(paren
id|ioport
)paren
suffix:semicolon
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Sccb_bad_isr&n; *&n; * Description: Some type of interrupt has occurred which is slightly&n; *              out of the ordinary.  We will now decode it fully, in&n; *              this routine.  This is broken up in an attempt to save&n; *              processing time.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|SccbMgr_bad_isr
id|UCHAR
id|SccbMgr_bad_isr
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
comma
id|USHORT
id|p_int
)paren
macro_line|#else
id|UCHAR
id|SccbMgr_bad_isr
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
comma
id|USHORT
id|p_int
)paren
macro_line|#endif
(brace
macro_line|#if defined(HARP_REVX)
id|ULONG
id|timer
suffix:semicolon
macro_line|#endif
id|UCHAR
id|temp
comma
id|ScamFlg
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ext_status
)paren
op_amp
(paren
id|BM_FORCE_OFF
op_or
id|PCI_DEV_TMOUT
op_or
id|BM_PARITY_ERR
op_or
id|PIO_OVERRUN
)paren
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|hostDataXferAbort
c_func
(paren
id|p_port
comma
id|p_card
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_pci_stat_cfg
)paren
op_amp
id|REC_MASTER_ABORT
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_pci_stat_cfg
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_pci_stat_cfg
)paren
op_amp
op_complement
id|REC_MASTER_ABORT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_host_blk_cnt
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pCurrCard-&gt;currentSCCB-&gt;HostStatus
)paren
id|pCurrCard-&gt;currentSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
id|sxfrp
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
)paren
op_amp
(paren
id|EXT_ARB_ACK
op_or
id|SCSI_TERM_ENA_H
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
(paren
id|UCHAR
)paren
id|temp
op_or
id|SEE_MS
op_or
id|SEE_CS
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
)paren
(brace
id|phaseDecode
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|p_int
op_amp
id|RESET
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
id|hostDataXferAbort
c_func
(paren
id|p_port
comma
id|p_card
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
)brace
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|sresb
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
r_while
c_loop
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsictrl_0
)paren
op_amp
id|SCSI_RST
)paren
(brace
)brace
id|pCurrNvRam
op_assign
id|pCurrCard-&gt;pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|ScamFlg
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
)brace
r_else
(brace
id|ScamFlg
op_assign
(paren
id|UCHAR
)paren
id|utilEERead
c_func
(paren
id|p_port
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
)brace
id|XbowInit
c_func
(paren
id|p_port
comma
id|ScamFlg
)paren
suffix:semicolon
id|scini
c_func
(paren
id|p_card
comma
id|pCurrCard-&gt;ourId
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0xFF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p_int
op_amp
id|FIFO
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|FIFO
)paren
suffix:semicolon
macro_line|#if defined(HARP_REVX)
r_for
c_loop
(paren
id|timer
op_assign
l_int|0x00FFFFFFL
suffix:semicolon
id|timer
op_ne
l_int|0x00000000L
suffix:semicolon
id|timer
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_fiforead
)paren
op_ne
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_fifowrite
)paren
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xfercnt_0
)paren
)paren
)paren
id|WR_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/*      else&n; */
multiline_comment|/*         sxfrp(p_port,p_card);&n; */
macro_line|#else
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
id|sxfrp
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|p_int
op_amp
id|TIMEOUT
)paren
(brace
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
op_or
id|PHASE
op_or
id|IUNKWN
)paren
)paren
suffix:semicolon
id|pCurrCard-&gt;currentSCCB-&gt;HostStatus
op_assign
id|SCCB_SELECTION_TIMEOUT
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|pCurrCard-&gt;currentSCCB-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|pCurrCard-&gt;currentSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
id|currTar_Info-&gt;TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|currTar_Info-&gt;TarSyncCtrl
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
id|sssyncv
c_func
(paren
id|p_port
comma
id|pCurrCard-&gt;currentSCCB-&gt;TargID
comma
id|NARROW_SCSI
comma
id|currTar_Info
)paren
suffix:semicolon
id|queueCmdComplete
c_func
(paren
id|pCurrCard
comma
id|pCurrCard-&gt;currentSCCB
comma
id|p_card
)paren
suffix:semicolon
)brace
macro_line|#if defined(SCAM_LEV_2)
r_else
r_if
c_cond
(paren
id|p_int
op_amp
id|SCAM_SEL
)paren
(brace
id|scarb
c_func
(paren
id|p_port
comma
id|LEVEL2_TAR
)paren
suffix:semicolon
id|scsel
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|scasid
c_func
(paren
id|p_card
comma
id|p_port
)paren
suffix:semicolon
id|scbusf
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|SCAM_SEL
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0x00
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_scsi_reset&n; *&n; * Description: A SCSI bus reset will be generated and all outstanding&n; *              Sccbs will be returned via the callback.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_scsi_reset
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|USHORT
id|pCurrCard
)paren
macro_line|#else
r_void
id|SccbMgr_scsi_reset
c_func
(paren
id|ULONG
id|pCurrCard
)paren
macro_line|#endif
macro_line|#endif
(brace
id|UCHAR
id|thisCard
suffix:semicolon
id|thisCard
op_assign
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardIndex
suffix:semicolon
id|mOS_Lock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_amp
id|F_GREEN_PC
)paren
(brace
id|WR_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|sresb
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
comma
id|thisCard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
id|WR_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|SCATTER_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_sg_addr
comma
l_int|0x00
)paren
suffix:semicolon
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|globalFlags
op_and_assign
op_complement
id|F_HOST_XFER_ACT
suffix:semicolon
id|busMstrTimeOut
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ioPort
op_plus
id|hp_int_mask
comma
(paren
id|INT_CMD_COMPL
op_or
id|SCSI_INTERRUPT
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;      if (utilEERead(((PSCCBcard)pCurrCard)-&gt;ioPort, (SCAM_CONFIG/2))&n;            &amp; SCAM_ENABLED)&n;*/
id|scini
c_func
(paren
id|thisCard
comma
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|ourId
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if (FW_TYPE==_UCB_MGR_)
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
op_member_access_from_pointer
id|cardInfo
op_member_access_from_pointer
id|ai_AEN_routine
c_func
(paren
l_int|0x01
comma
id|pCurrCard
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|mOS_UnLock
c_func
(paren
(paren
id|PSCCBcard
)paren
id|pCurrCard
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_timer_expired&n; *&n; * Description: This function allow me to kill my own job that has not&n; *              yet completed, and has cause a timeout to occur.  This&n; *              timeout has caused the upper level driver to call this&n; *              function.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
DECL|function|SccbMgr_timer_expired
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|CARD_HANDLE
id|pCurrCard
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|USHORT
id|pCurrCard
)paren
macro_line|#else
r_void
id|SccbMgr_timer_expired
c_func
(paren
id|ULONG
id|pCurrCard
)paren
macro_line|#endif
macro_line|#endif
(brace
)brace
macro_line|#if defined(DOS)
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgr_status&n; *&n; * Description: This function returns the number of outstanding SCCB&squot;s.&n; *              This is specific to the DOS enviroment, which needs this&n; *              to help them keep protected and real mode commands staight.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SccbMgr_status
id|USHORT
id|SccbMgr_status
c_func
(paren
id|USHORT
id|pCurrCard
)paren
(brace
r_return
id|BL_Card
(braket
id|pCurrCard
)braket
dot
id|cmdCounter
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgrTableInit&n; *&n; * Description: Initialize all Sccb manager data structures.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SccbMgrTableInitAll
r_void
id|SccbMgrTableInitAll
c_func
(paren
)paren
(brace
id|UCHAR
id|thisCard
suffix:semicolon
r_for
c_loop
(paren
id|thisCard
op_assign
l_int|0
suffix:semicolon
id|thisCard
OL
id|MAX_CARDS
suffix:semicolon
id|thisCard
op_increment
)paren
(brace
id|SccbMgrTableInitCard
c_func
(paren
op_amp
id|BL_Card
(braket
id|thisCard
)braket
comma
id|thisCard
)paren
suffix:semicolon
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ioPort
op_assign
l_int|0x00
suffix:semicolon
id|BL_Card
(braket
id|thisCard
)braket
dot
id|cardInfo
op_assign
l_int|NULL
suffix:semicolon
id|BL_Card
(braket
id|thisCard
)braket
dot
id|cardIndex
op_assign
l_int|0xFF
suffix:semicolon
id|BL_Card
(braket
id|thisCard
)braket
dot
id|ourId
op_assign
l_int|0x00
suffix:semicolon
id|BL_Card
(braket
id|thisCard
)braket
dot
id|pNvRamInfo
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgrTableInit&n; *&n; * Description: Initialize all Sccb manager data structures.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SccbMgrTableInitCard
r_void
id|SccbMgrTableInitCard
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
(brace
id|UCHAR
id|scsiID
comma
id|qtag
suffix:semicolon
r_for
c_loop
(paren
id|qtag
op_assign
l_int|0
suffix:semicolon
id|qtag
OL
id|QUEUE_DEPTH
suffix:semicolon
id|qtag
op_increment
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|scsiID
op_assign
l_int|0
suffix:semicolon
id|scsiID
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|scsiID
op_increment
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarStatus
op_assign
l_int|0
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarEEValue
op_assign
l_int|0
suffix:semicolon
id|SccbMgrTableInitTarget
c_func
(paren
id|p_card
comma
id|scsiID
)paren
suffix:semicolon
)brace
id|pCurrCard-&gt;scanIndex
op_assign
l_int|0x00
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
l_int|NULL
suffix:semicolon
id|pCurrCard-&gt;globalFlags
op_assign
l_int|0x00
suffix:semicolon
id|pCurrCard-&gt;cmdCounter
op_assign
l_int|0x00
suffix:semicolon
id|pCurrCard-&gt;tagQ_Lst
op_assign
l_int|0x01
suffix:semicolon
id|pCurrCard-&gt;discQCount
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: SccbMgrTableInit&n; *&n; * Description: Initialize all Sccb manager data structures.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|SccbMgrTableInitTarget
r_void
id|SccbMgrTableInitTarget
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|target
)paren
(brace
id|UCHAR
id|lun
comma
id|qtag
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|target
)braket
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarSyncCtrl
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Head
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarTagQ_Cnt
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarLUN_CA
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|lun
op_assign
l_int|0
suffix:semicolon
id|lun
OL
id|MAX_LUN
suffix:semicolon
id|lun
op_increment
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|FALSE
suffix:semicolon
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|lun
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|qtag
op_assign
l_int|0
suffix:semicolon
id|qtag
OL
id|QUEUE_DEPTH
suffix:semicolon
id|qtag
op_increment
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_member_access_from_pointer
id|TargID
op_eq
id|target
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_assign
l_int|NULL
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#if defined(BUGBUG)
multiline_comment|/*****************************************************************&n; * Save the current byte in the debug array&n; *****************************************************************/
DECL|function|Debug_Load
r_void
id|Debug_Load
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_bug_data
)paren
(brace
id|debug_int
(braket
id|p_card
)braket
(braket
id|debug_index
(braket
id|p_card
)braket
)braket
op_assign
id|p_bug_data
suffix:semicolon
id|debug_index
(braket
id|p_card
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|debug_index
(braket
id|p_card
)braket
op_eq
id|debug_size
)paren
id|debug_index
(braket
id|p_card
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ident &quot;$Id: sccb_dat.c 1.10 1997/02/22 03:16:02 awin Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   sccb_dat.c  $&n; *&n; *   Description:  Functions relating to handling of the SCCB interface &n; *                 between the device driver and the HARPOON.&n; *&n; *   $Date: 1997/02/22 03:16:02 $&n; *&n; *   $Revision: 1.10 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;**  IMPORTANT NOTE!!!&n;**&n;**  You MUST preassign all data to a valid value or zero.  This is&n;**  required due to the MS compiler bug under OS/2 and Solaris Real-Mode&n;**  driver environment.&n;*/
DECL|variable|sccbMgrTbl
id|SCCBMGR_TAR_INFO
id|sccbMgrTbl
(braket
id|MAX_CARDS
)braket
(braket
id|MAX_SCSI_TAR
)braket
op_assign
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
suffix:semicolon
DECL|variable|BL_Card
id|SCCBCARD
id|BL_Card
(braket
id|MAX_CARDS
)braket
op_assign
(brace
(brace
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|scamInfo
id|SCCBSCAM_INFO
id|scamInfo
(braket
id|MAX_SCSI_TAR
)braket
op_assign
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
suffix:semicolon
DECL|variable|nvRamInfo
id|NVRAMINFO
id|nvRamInfo
(braket
id|MAX_MB_CARDS
)braket
op_assign
(brace
(brace
l_int|0
)brace
)brace
suffix:semicolon
macro_line|#if defined(OS2)
DECL|variable|s_PhaseTbl
r_void
(paren
id|far
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|temp_id_string
id|UCHAR
id|temp_id_string
(braket
id|ID_STRING_LENGTH
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
macro_line|#elif defined(SOLARIS_REAL_MODE) || defined(__STDC__)
DECL|variable|s_PhaseTbl
r_void
(paren
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
op_assign
(brace
l_int|0
)brace
suffix:semicolon
macro_line|#else
DECL|variable|s_PhaseTbl
r_void
(paren
op_star
id|s_PhaseTbl
(braket
l_int|8
)braket
)paren
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
DECL|variable|first_time
id|UCHAR
id|first_time
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|mbCards
id|UCHAR
id|mbCards
op_assign
l_int|0
suffix:semicolon
DECL|variable|scamHAString
id|UCHAR
id|scamHAString
(braket
)braket
op_assign
(brace
l_int|0x63
comma
l_int|0x07
comma
l_char|&squot;B&squot;
comma
l_char|&squot;U&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;L&squot;
comma
l_char|&squot;O&squot;
comma
l_char|&squot;G&squot;
comma
l_char|&squot;I&squot;
comma
l_char|&squot;C&squot;
comma
"&bslash;"
l_char|&squot; &squot;
comma
l_char|&squot;B&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;-&squot;
comma
l_char|&squot;9&squot;
comma
l_char|&squot;3&squot;
comma
l_char|&squot;0&squot;
comma
"&bslash;"
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
"&bslash;"
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
)brace
suffix:semicolon
DECL|variable|default_intena
id|USHORT
id|default_intena
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined(BUGBUG)
DECL|variable|debug_int
id|UCHAR
id|debug_int
(braket
id|MAX_CARDS
)braket
(braket
id|debug_size
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|debug_index
id|UCHAR
id|debug_index
(braket
id|MAX_CARDS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|reserved_1
id|UCHAR
id|reserved_1
(braket
l_int|3
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ident &quot;$Id: scsi.c 1.23 1997/07/09 21:42:54 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   scsi.c  $&n; *&n; *   Description:  Functions for handling SCSI bus functions such as&n; *                 selection/reselection, sync negotiation, message-in&n; *                 decoding.&n; *&n; *   $Date: 1997/07/09 21:42:54 $&n; *&n; *   $Revision: 1.23 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;eeprom.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;#if defined(BUGBUG)&n;void Debug_Load(UCHAR p_card, UCHAR p_bug_data);&n;#endif&n;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sfetm&n; *&n; * Description: Read in a message byte from the SCSI bus, and check&n; *              for a parity error.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sfm
id|UCHAR
id|sfm
c_func
(paren
id|USHORT
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#else
id|UCHAR
id|sfm
c_func
(paren
id|ULONG
id|port
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#endif
(brace
id|UCHAR
id|message
suffix:semicolon
id|USHORT
id|TimeOutLoop
suffix:semicolon
id|TimeOutLoop
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
op_logical_and
(paren
id|TimeOutLoop
op_increment
OL
l_int|20000
)paren
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|message
op_assign
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsidata_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
id|SCSI_ACK
op_plus
id|S_MSGI_PH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TimeOutLoop
OG
l_int|20000
)paren
id|message
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* force message byte = 0 if Time Out on Req */
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|PARITY
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_addstat
)paren
op_amp
id|SCSI_PAR_ERR
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
comma
l_int|0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fiforead
comma
l_int|0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifowrite
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCurrSCCB
op_ne
l_int|NULL
)paren
(brace
id|pCurrSCCB-&gt;Sccb_scsimsg
op_assign
id|SMPARITY
suffix:semicolon
)brace
id|message
op_assign
l_int|0x00
suffix:semicolon
r_do
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|TimeOutLoop
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
op_logical_and
(paren
id|TimeOutLoop
op_increment
OL
l_int|20000
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|TimeOutLoop
OG
l_int|20000
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PARITY
)paren
suffix:semicolon
r_return
id|message
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|S_SCSI_PHZ
)paren
op_ne
id|S_MSGI_PH
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PARITY
)paren
suffix:semicolon
r_return
id|message
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsidata_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
comma
l_int|0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fiforead
comma
l_int|0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifowrite
comma
l_int|0
)paren
suffix:semicolon
r_return
id|message
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: ssel&n; *&n; * Description: Load up automation and select target device.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|ssel
r_void
id|ssel
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|ssel
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|UCHAR
id|auto_loaded
comma
id|i
comma
id|target
comma
op_star
id|theCCB
suffix:semicolon
macro_line|#elif defined(OS2)
id|UCHAR
id|auto_loaded
comma
id|i
comma
id|target
suffix:semicolon
id|UCHAR
id|far
op_star
id|theCCB
suffix:semicolon
macro_line|#else
id|UCHAR
id|auto_loaded
comma
id|i
comma
id|target
comma
op_star
id|theCCB
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
id|USHORT
id|cdb_reg
suffix:semicolon
macro_line|#else
id|ULONG
id|cdb_reg
suffix:semicolon
macro_line|#endif
id|PSCCBcard
id|CurrCard
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|UCHAR
id|lastTag
comma
id|lun
suffix:semicolon
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|p_card
)braket
suffix:semicolon
id|currSCCB
op_assign
id|CurrCard-&gt;currentSCCB
suffix:semicolon
id|target
op_assign
id|currSCCB-&gt;TargID
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|target
)braket
suffix:semicolon
id|lastTag
op_assign
id|CurrCard-&gt;tagQ_Lst
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_REJECT
)paren
id|currSCCB-&gt;ControlByte
op_and_assign
op_complement
id|F_USE_CMD_Q
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|CurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|lun
op_assign
id|currSCCB-&gt;Lun
suffix:semicolon
)brace
r_else
id|lun
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined(DOS)
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|CurrCard-&gt;globalFlags
op_amp
id|F_TAG_STARTED
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|F_USE_CMD_Q
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarLUN_CA
op_eq
id|FALSE
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_TRYING
)paren
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarTagQ_Cnt
op_ne
l_int|0
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
id|queueSelectFail
c_func
(paren
id|CurrCard
comma
id|p_card
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
multiline_comment|/*End non-tagged */
r_else
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
multiline_comment|/*!Use cmd Q Tagged */
r_else
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarLUN_CA
op_eq
id|TRUE
)paren
(brace
id|queueSelectFail
c_func
(paren
id|CurrCard
comma
id|p_card
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
multiline_comment|/*else use cmd Q tagged */
)brace
multiline_comment|/*if glob tagged started */
r_else
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
macro_line|#endif /* DOS */
r_if
c_cond
(paren
(paren
(paren
(paren
id|CurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|F_USE_CMD_Q
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|CurrCard-&gt;discQCount
op_ge
id|QUEUE_DEPTH
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
id|queueSelectFail
c_func
(paren
id|CurrCard
comma
id|p_card
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|QUEUE_DEPTH
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_increment
id|lastTag
op_ge
id|QUEUE_DEPTH
)paren
id|lastTag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|CurrCard-&gt;discQ_Tbl
(braket
id|lastTag
)braket
op_eq
l_int|NULL
)paren
(brace
id|CurrCard-&gt;tagQ_Lst
op_assign
id|lastTag
suffix:semicolon
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|lun
)braket
op_assign
id|lastTag
suffix:semicolon
id|CurrCard-&gt;discQ_Tbl
(braket
id|lastTag
)braket
op_assign
id|currSCCB
suffix:semicolon
id|CurrCard-&gt;discQCount
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|QUEUE_DEPTH
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
id|queueSelectFail
c_func
(paren
id|CurrCard
comma
id|p_card
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|auto_loaded
op_assign
id|FALSE
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_select_id
comma
id|target
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_gp_reg_3
comma
id|target
)paren
suffix:semicolon
multiline_comment|/* Use by new automation logic */
r_if
c_cond
(paren
id|currSCCB-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
id|currSCCB-&gt;Sccb_idmsg
op_amp
op_complement
id|DISC_PRIV
)paren
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|2
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsimsg
op_assign
id|SMDEV_RESET
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
id|auto_loaded
op_assign
id|TRUE
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_BDR_ST
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|currTar_Info-&gt;TarSyncCtrl
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
macro_line|#endif
id|sssyncv
c_func
(paren
id|port
comma
id|target
comma
id|NARROW_SCSI
comma
id|currTar_Info
)paren
suffix:semicolon
id|SccbMgrTableInitTarget
c_func
(paren
id|p_card
comma
id|target
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|ABORT_ST
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
id|currSCCB-&gt;Sccb_idmsg
op_amp
op_complement
id|DISC_PRIV
)paren
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|2
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|CMDPZ
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|0
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
(paren
(paren
id|UCHAR
)paren
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|TAG_TYPE_MASK
)paren
op_rshift
l_int|6
)paren
op_or
(paren
id|UCHAR
)paren
l_int|0x20
)paren
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|currSCCB-&gt;Sccb_tag
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|4
)paren
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
id|auto_loaded
op_assign
id|TRUE
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|WIDE_NEGOCIATED
)paren
)paren
(brace
id|auto_loaded
op_assign
id|siwidn
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_WN_ST
suffix:semicolon
)brace
macro_line|#endif
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_SYNC_MASK
)paren
op_eq
id|SYNC_SUPPORTED
)paren
)paren
(brace
id|auto_loaded
op_assign
id|sisyncn
c_func
(paren
id|port
comma
id|p_card
comma
id|FALSE
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_SN_ST
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|auto_loaded
)paren
(brace
macro_line|#if !defined(DOS)
r_if
c_cond
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|F_USE_CMD_Q
)paren
(brace
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_TAG_STARTED
suffix:semicolon
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_REJECT
)paren
(brace
id|currSCCB-&gt;ControlByte
op_and_assign
op_complement
id|F_USE_CMD_Q
suffix:semicolon
multiline_comment|/* Fix up the start instruction with a jump to&n;               Non-Tag-CMD handling */
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NTCMD
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|NON_TAG_ID_MSG
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|currSCCB-&gt;Sccb_idmsg
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
multiline_comment|/* Setup our STATE so we know what happend when&n;               the wheels fall off. */
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_ST
suffix:semicolon
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|currSCCB-&gt;Sccb_idmsg
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
(paren
(paren
id|UCHAR
)paren
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|TAG_TYPE_MASK
)paren
op_rshift
l_int|6
)paren
op_or
(paren
id|UCHAR
)paren
l_int|0x20
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|QUEUE_DEPTH
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_increment
id|lastTag
op_ge
id|QUEUE_DEPTH
)paren
id|lastTag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|CurrCard-&gt;discQ_Tbl
(braket
id|lastTag
)braket
op_eq
l_int|NULL
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|lastTag
)paren
)paren
suffix:semicolon
id|CurrCard-&gt;tagQ_Lst
op_assign
id|lastTag
suffix:semicolon
id|currSCCB-&gt;Sccb_tag
op_assign
id|lastTag
suffix:semicolon
id|CurrCard-&gt;discQ_Tbl
(braket
id|lastTag
)braket
op_assign
id|currSCCB
suffix:semicolon
id|CurrCard-&gt;discQCount
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|QUEUE_DEPTH
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
id|queueSelectFail
c_func
(paren
id|CurrCard
comma
id|p_card
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_Q_ST
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#endif   /* !DOS */
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NTCMD
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|NON_TAG_ID_MSG
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|currSCCB-&gt;Sccb_idmsg
)paren
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_ST
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
macro_line|#if !defined(DOS)
)brace
macro_line|#endif
macro_line|#if defined(OS2)
id|theCCB
op_assign
(paren
id|UCHAR
id|far
op_star
)paren
op_amp
id|currSCCB-&gt;Cdb
(braket
l_int|0
)braket
suffix:semicolon
macro_line|#else
id|theCCB
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|currSCCB-&gt;Cdb
(braket
l_int|0
)braket
suffix:semicolon
macro_line|#endif
id|cdb_reg
op_assign
id|port
op_plus
id|CMD_STRT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|currSCCB-&gt;CdbLength
suffix:semicolon
id|i
op_increment
)paren
(brace
id|WRW_HARPOON
c_func
(paren
id|cdb_reg
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
op_star
id|theCCB
)paren
)paren
suffix:semicolon
id|cdb_reg
op_add_assign
l_int|2
suffix:semicolon
id|theCCB
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;CdbLength
op_ne
id|TWELVE_BYTE_CMD
)paren
id|WRW_HARPOON
c_func
(paren
id|cdb_reg
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* auto_loaded */
macro_line|#if defined(WIDE_SCSI)
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_fiforead
)paren
comma
(paren
id|USHORT
)paren
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#endif
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
(paren
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|currSCCB-&gt;Sccb_MGRFlags
op_amp
id|F_DEV_SELECTED
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsictrl_0
comma
(paren
id|SEL_TAR
op_or
id|ENA_ATN
op_or
id|ENA_RESEL
op_or
id|ENA_SCAM_SEL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*      auto_loaded =  (RD_HARPOON(port+hp_autostart_3) &amp; (UCHAR)0x1F);&n;      auto_loaded |= AUTO_IMMED; */
id|auto_loaded
op_assign
id|AUTO_IMMED
suffix:semicolon
id|DISABLE_AUTO
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
id|auto_loaded
)paren
suffix:semicolon
)brace
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sres&n; *&n; * Description: Hookup the correct CCB and handle the incoming messages.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sres
r_void
id|sres
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
)paren
macro_line|#else
r_void
id|sres
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCBcard
id|pCurrCard
)paren
macro_line|#endif
(brace
macro_line|#if defined(V302)
macro_line|#ifdef DOS
id|UCHAR
id|our_target
comma
id|message
comma
id|msgRetryCount
suffix:semicolon
r_extern
id|UCHAR
id|lun
comma
id|tag
suffix:semicolon
macro_line|#else
id|UCHAR
id|our_target
comma
id|message
comma
id|lun
comma
id|tag
comma
id|msgRetryCount
suffix:semicolon
macro_line|#endif
macro_line|#else  /* V302 */
id|UCHAR
id|our_target
comma
id|message
comma
id|lun
op_assign
l_int|0
comma
id|tag
comma
id|msgRetryCount
suffix:semicolon
macro_line|#endif /* V302 */
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|pCurrCard-&gt;currentSCCB-&gt;TargID
)braket
suffix:semicolon
id|DISABLE_AUTO
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_scsictrl_0
)paren
comma
(paren
id|ENA_RESEL
op_or
id|ENA_SCAM_SEL
)paren
)paren
suffix:semicolon
id|currSCCB
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|BUS_FREE_ST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|BUS_FREE_ST
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_ne
id|ABORT_ST
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_ne
id|ABORT_ST
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_ne
id|ABORT_ST
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
id|queueSelectFail
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|p_card
)paren
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_fiforead
)paren
comma
(paren
id|USHORT
)paren
l_int|0x00
)paren
suffix:semicolon
macro_line|#endif
id|our_target
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_select_id
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
suffix:semicolon
id|msgRetryCount
op_assign
l_int|0
suffix:semicolon
r_do
(brace
macro_line|#if defined(V302)
id|message
op_assign
id|GetTarLun
c_func
(paren
id|port
comma
id|p_card
comma
id|our_target
comma
id|pCurrCard
comma
op_amp
id|tag
comma
op_amp
id|lun
)paren
suffix:semicolon
macro_line|#else /* V302 */
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
suffix:semicolon
id|tag
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|S_SCSI_PHZ
)paren
op_eq
id|S_MSGI_PH
)paren
(brace
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
r_if
c_cond
(paren
id|message
op_le
(paren
l_int|0x80
op_or
id|LUN_MASK
)paren
)paren
(brace
id|lun
op_assign
id|message
op_amp
(paren
id|UCHAR
)paren
id|LUN_MASK
suffix:semicolon
macro_line|#if !defined(DOS)
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_TRYING
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarTagQ_Cnt
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currTar_Info-&gt;TarLUN_CA
)paren
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/*Release the ACK for ID msg. */
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
id|message
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|message
op_ne
id|FALSE
)paren
(brace
id|tag
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tag
)paren
)paren
id|message
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/*C.A. exists! */
)brace
multiline_comment|/*End Q cnt != 0 */
)brace
multiline_comment|/*End Tag cmds supported! */
macro_line|#endif /* !DOS */
)brace
multiline_comment|/*End valid ID message.  */
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* End good id message. */
r_else
(brace
id|message
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|PHASE
op_or
id|RESET
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif /* V302 */
r_if
c_cond
(paren
id|message
op_eq
id|FALSE
)paren
(brace
id|msgRetryCount
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|msgRetryCount
op_eq
l_int|1
)paren
(brace
id|SendMsg
c_func
(paren
id|port
comma
id|SMPARITY
)paren
suffix:semicolon
)brace
r_else
(brace
id|SendMsg
c_func
(paren
id|port
comma
id|SMDEV_RESET
)paren
suffix:semicolon
id|sssyncv
c_func
(paren
id|port
comma
id|our_target
comma
id|NARROW_SCSI
comma
id|currTar_Info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
dot
id|TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
dot
id|TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
id|queueFlushTargSccb
c_func
(paren
id|p_card
comma
id|our_target
comma
id|SCCB_COMPLETE
)paren
suffix:semicolon
id|SccbMgrTableInitTarget
c_func
(paren
id|p_card
comma
id|our_target
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|message
op_eq
id|FALSE
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_assign
id|TRUE
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|lun
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|tag
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;discQ_Tbl
(braket
id|tag
)braket
op_ne
l_int|NULL
)paren
(brace
id|pCurrCard-&gt;currentSCCB
op_assign
id|pCurrCard-&gt;discQ_Tbl
(braket
id|tag
)braket
suffix:semicolon
id|currTar_Info-&gt;TarTagQ_Cnt
op_decrement
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|pCurrCard-&gt;currentSCCB
op_assign
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB-&gt;Sccb_scsistat
op_eq
id|ABORT_ST
)paren
(brace
multiline_comment|/* During Abort Tag command, the target could have got re-selected&n;&t;&t;&t;and completed the command. Check the select Q and remove the CCB&n;&t;&t;&t;if it is in the Select Q */
id|queueFindSccb
c_func
(paren
id|pCurrCard-&gt;currentSCCB
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|PHASE
op_or
id|RESET
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(V302)
macro_line|#if defined(DOS)
DECL|function|GetTarLun
id|UCHAR
id|GetTarLun
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|our_target
comma
id|PSCCBcard
id|pCurrCard
comma
id|PUCHAR
id|tag
comma
id|PUCHAR
id|lun
)paren
macro_line|#else
id|UCHAR
id|GetTarLun
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|our_target
comma
id|PSCCBcard
id|pCurrCard
comma
id|PUCHAR
id|tag
comma
id|PUCHAR
id|lun
)paren
macro_line|#endif
(brace
id|UCHAR
id|message
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|our_target
)braket
suffix:semicolon
op_star
id|tag
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|S_SCSI_PHZ
)paren
op_eq
id|S_MSGI_PH
)paren
(brace
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
r_if
c_cond
(paren
id|message
op_le
(paren
l_int|0x80
op_or
id|LUN_MASK
)paren
)paren
(brace
op_star
id|lun
op_assign
id|message
op_amp
(paren
id|UCHAR
)paren
id|LUN_MASK
suffix:semicolon
macro_line|#if !defined(DOS)
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_TRYING
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarTagQ_Cnt
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currTar_Info-&gt;TarLUN_CA
)paren
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/*Release the ACK for ID msg. */
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
r_return
id|FALSE
suffix:semicolon
op_star
id|tag
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrCard-&gt;currentSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|tag
)paren
)paren
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*C.A. exists! */
)brace
multiline_comment|/*End Q cnt != 0 */
)brace
multiline_comment|/*End Tag cmds supported! */
macro_line|#endif /* !DOS */
)brace
multiline_comment|/*End valid ID message.  */
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* End good id message. */
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif /* V302 */
macro_line|#if defined(DOS)
DECL|function|SendMsg
r_void
id|SendMsg
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|message
)paren
macro_line|#else
r_void
id|SendMsg
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|message
)paren
macro_line|#endif
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PHASE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|S_SCSI_PHZ
)paren
op_eq
id|S_MSGO_PH
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|PHASE
op_or
id|XFER_CNT_0
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_BUS_EN
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsidata_0
comma
id|message
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|message
op_eq
id|SMABORT
)paren
op_logical_or
(paren
id|message
op_eq
id|SMDEV_RESET
)paren
op_logical_or
(paren
id|message
op_eq
id|SMABORT_TAG
)paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|PHASE
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|BUS_FREE
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sdecm&n; *&n; * Description: Determine the proper responce to the message from the&n; *              target device.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sdecm
r_void
id|sdecm
c_func
(paren
id|UCHAR
id|message
comma
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|sdecm
c_func
(paren
id|UCHAR
id|message
comma
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBcard
id|CurrCard
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|CurrCard
op_assign
op_amp
id|BL_Card
(braket
id|p_card
)braket
suffix:semicolon
id|currSCCB
op_assign
id|CurrCard-&gt;currentSCCB
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|message
op_eq
id|SMREST_DATA_PTR
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_NO_DATA_YET
)paren
)paren
(brace
id|currSCCB-&gt;Sccb_ATC
op_assign
id|currSCCB-&gt;Sccb_savedATC
suffix:semicolon
id|hostDataXferRestart
c_func
(paren
id|currSCCB
)paren
suffix:semicolon
)brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|message
op_eq
id|SMCMD_COMP
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_Q_ST
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
(paren
id|UCHAR
)paren
id|TAR_TAG_Q_MASK
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_or_assign
(paren
id|UCHAR
)paren
id|TAG_Q_REJECT
suffix:semicolon
)brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|message
op_eq
id|SMNO_OP
)paren
op_logical_or
(paren
id|message
op_ge
id|SMIDENT
)paren
op_logical_or
(paren
id|message
op_eq
id|SMINIT_RECOVERY
)paren
op_logical_or
(paren
id|message
op_eq
id|SMREL_RECOVERY
)paren
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|message
op_eq
id|SMREJECT
)paren
(brace
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
op_logical_or
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
op_logical_or
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_SYNC_MASK
)paren
op_eq
id|SYNC_TRYING
)paren
op_logical_or
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_TRYING
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|BUS_FREE
)paren
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;Lun
op_eq
l_int|0x00
)paren
(brace
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_or_assign
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
suffix:semicolon
id|currTar_Info-&gt;TarEEValue
op_and_assign
op_complement
id|EE_SYNC_MASK
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
r_else
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_assign
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
id|WIDE_ENABLED
)paren
op_or
id|WIDE_NEGOCIATED
suffix:semicolon
id|currTar_Info-&gt;TarEEValue
op_and_assign
op_complement
id|EE_WIDE_SCSI
suffix:semicolon
)brace
macro_line|#endif
r_else
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_TRYING
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_assign
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_TAG_Q_MASK
)paren
op_or
id|TAG_Q_REJECT
suffix:semicolon
id|currSCCB-&gt;ControlByte
op_and_assign
op_complement
id|F_USE_CMD_Q
suffix:semicolon
id|CurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|CurrCard-&gt;discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
id|currSCCB-&gt;Sccb_tag
op_assign
l_int|0x00
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Lun
op_eq
l_int|0x00
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|BUS_FREE
)paren
suffix:semicolon
id|CurrCard-&gt;globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|CurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|currTar_Info-&gt;TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
id|currTar_Info-&gt;TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
id|currSCCB-&gt;ControlByte
op_and_assign
op_complement
(paren
id|UCHAR
)paren
id|F_USE_CMD_Q
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|message
op_eq
id|SMEXT
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|shandem
c_func
(paren
id|port
comma
id|p_card
comma
id|currSCCB
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|message
op_eq
id|SMIGNORWR
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/* ACK the RESIDUE MSG */
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsimsg
op_ne
id|SMPARITY
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PHASE_SEQUENCE_FAIL
suffix:semicolon
id|currSCCB-&gt;Sccb_scsimsg
op_assign
id|SMREJECT
suffix:semicolon
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: shandem&n; *&n; * Description: Decide what to do with the extended message.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|shandem
r_void
id|shandem
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#else
r_void
id|shandem
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#endif
(brace
id|UCHAR
id|length
comma
id|message
suffix:semicolon
id|length
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|pCurrSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
r_if
c_cond
(paren
id|message
op_eq
id|SMSYNC
)paren
(brace
r_if
c_cond
(paren
id|length
op_eq
l_int|0x03
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|stsyncn
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
(brace
id|pCurrSCCB-&gt;Sccb_scsimsg
op_assign
id|SMREJECT
suffix:semicolon
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
macro_line|#if defined(WIDE_SCSI)
r_else
r_if
c_cond
(paren
id|message
op_eq
id|SMWDTR
)paren
(brace
r_if
c_cond
(paren
id|length
op_eq
l_int|0x02
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|stwidn
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
(brace
id|pCurrSCCB-&gt;Sccb_scsimsg
op_assign
id|SMREJECT
suffix:semicolon
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_else
(brace
id|pCurrSCCB-&gt;Sccb_scsimsg
op_assign
id|SMREJECT
suffix:semicolon
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_scsimsg
op_ne
id|SMPARITY
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_scsimsg
op_eq
id|SMPARITY
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sisyncn&n; *&n; * Description: Read in a message byte from the SCSI bus, and check&n; *              for a parity error.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sisyncn
id|UCHAR
id|sisyncn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|syncFlag
)paren
macro_line|#else
id|UCHAR
id|sisyncn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|UCHAR
id|syncFlag
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_SYNC_MASK
)paren
op_eq
id|SYNC_TRYING
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
id|currSCCB-&gt;Sccb_idmsg
op_amp
op_complement
(paren
id|UCHAR
)paren
id|DISC_PRIV
)paren
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|2
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|CMDPZ
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|0
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMEXT
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x03
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|4
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMSYNC
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_20MB
)paren
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|12
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_10MB
)paren
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|25
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_5MB
)paren
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|50
)paren
)paren
suffix:semicolon
r_else
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|00
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|8
)paren
comma
(paren
id|RAT_OP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|10
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|DEFAULT_OFFSET
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|12
)paren
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|syncFlag
op_eq
id|FALSE
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_assign
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_SYNC_MASK
)paren
op_or
(paren
id|UCHAR
)paren
id|SYNC_TRYING
)paren
suffix:semicolon
)brace
r_else
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|AUTO_IMMED
op_plus
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarStatus
op_or_assign
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
suffix:semicolon
id|currTar_Info-&gt;TarEEValue
op_and_assign
op_complement
id|EE_SYNC_MASK
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: stsyncn&n; *&n; * Description: The has sent us a Sync Nego message so handle it as&n; *              necessary.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|stsyncn
r_void
id|stsyncn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|stsyncn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|UCHAR
id|sync_msg
comma
id|offset
comma
id|sync_reg
comma
id|our_sync_msg
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
suffix:semicolon
id|sync_msg
op_assign
id|sfm
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sync_msg
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|currSCCB-&gt;Sccb_scsimsg
op_eq
id|SMPARITY
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|offset
op_assign
id|sfm
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|offset
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|currSCCB-&gt;Sccb_scsimsg
op_eq
id|SMPARITY
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_20MB
)paren
id|our_sync_msg
op_assign
l_int|12
suffix:semicolon
multiline_comment|/* Setup our Message to 20mb/s */
r_else
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_10MB
)paren
id|our_sync_msg
op_assign
l_int|25
suffix:semicolon
multiline_comment|/* Setup our Message to 10mb/s */
r_else
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
op_eq
id|EE_SYNC_5MB
)paren
id|our_sync_msg
op_assign
l_int|50
suffix:semicolon
multiline_comment|/* Setup our Message to 5mb/s */
r_else
id|our_sync_msg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Message = Async */
r_if
c_cond
(paren
id|sync_msg
OL
id|our_sync_msg
)paren
(brace
id|sync_msg
op_assign
id|our_sync_msg
suffix:semicolon
multiline_comment|/*if faster, then set to max. */
)brace
r_if
c_cond
(paren
id|offset
op_eq
id|ASYNC
)paren
id|sync_msg
op_assign
id|ASYNC
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
id|MAX_OFFSET
)paren
id|offset
op_assign
id|MAX_OFFSET
suffix:semicolon
id|sync_reg
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|sync_msg
OG
l_int|12
)paren
id|sync_reg
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* Use 10MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|25
)paren
id|sync_reg
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* Use 6.6MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|38
)paren
id|sync_reg
op_assign
l_int|0x60
suffix:semicolon
multiline_comment|/* Use 5MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|50
)paren
id|sync_reg
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Use 4MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|62
)paren
id|sync_reg
op_assign
l_int|0xA0
suffix:semicolon
multiline_comment|/* Use 3.33MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|75
)paren
id|sync_reg
op_assign
l_int|0xC0
suffix:semicolon
multiline_comment|/* Use 2.85MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|87
)paren
id|sync_reg
op_assign
l_int|0xE0
suffix:semicolon
multiline_comment|/* Use 2.5MB/s */
r_if
c_cond
(paren
id|sync_msg
OG
l_int|100
)paren
(brace
id|sync_reg
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Use ASYNC */
id|offset
op_assign
l_int|0x00
suffix:semicolon
)brace
macro_line|#if defined(WIDE_SCSI)
r_if
c_cond
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|WIDE_ENABLED
)paren
id|sync_reg
op_or_assign
id|offset
suffix:semicolon
r_else
id|sync_reg
op_or_assign
(paren
id|offset
op_or
id|NARROW_SCSI
)paren
suffix:semicolon
macro_line|#else
id|sync_reg
op_or_assign
(paren
id|offset
op_or
id|NARROW_SCSI
)paren
suffix:semicolon
macro_line|#endif
id|sssyncv
c_func
(paren
id|port
comma
id|currSCCB-&gt;TargID
comma
id|sync_reg
comma
id|currTar_Info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_assign
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_SYNC_MASK
)paren
op_or
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|sisyncr
c_func
(paren
id|port
comma
id|sync_msg
comma
id|offset
)paren
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_assign
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_SYNC_MASK
)paren
op_or
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sisyncr&n; *&n; * Description: Answer the targets sync message.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sisyncr
r_void
id|sisyncr
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|sync_pulse
comma
id|UCHAR
id|offset
)paren
macro_line|#else
r_void
id|sisyncr
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|sync_pulse
comma
id|UCHAR
id|offset
)paren
macro_line|#endif
(brace
id|ARAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|0
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMEXT
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x03
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|4
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMSYNC
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|sync_pulse
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|8
)paren
comma
(paren
id|RAT_OP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|10
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|offset
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|12
)paren
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT_1
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|AUTO_IMMED
op_plus
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|AUTO_INT
)paren
)paren
)paren
(brace
)brace
)brace
macro_line|#if defined(WIDE_SCSI)
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: siwidn&n; *&n; * Description: Read in a message byte from the SCSI bus, and check&n; *              for a parity error.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|siwidn
id|UCHAR
id|siwidn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
id|UCHAR
id|siwidn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_WIDE_MASK
)paren
op_eq
id|WIDE_NEGOCIATED
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
(paren
id|currSCCB-&gt;Sccb_idmsg
op_amp
op_complement
(paren
id|UCHAR
)paren
id|DISC_PRIV
)paren
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|ID_MSG_STRT
op_plus
l_int|2
)paren
comma
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|CMDPZ
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|0
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMEXT
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x02
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|4
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMWDTR
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|RAT_OP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|8
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SM16BIT
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|10
)paren
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_plus
id|SELCHK_STRT
)paren
)paren
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_assign
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_WIDE_MASK
)paren
op_or
(paren
id|UCHAR
)paren
id|WIDE_ENABLED
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarStatus
op_assign
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
op_complement
(paren
id|UCHAR
)paren
id|TAR_WIDE_MASK
)paren
op_or
id|WIDE_NEGOCIATED
)paren
suffix:semicolon
id|currTar_Info-&gt;TarEEValue
op_and_assign
op_complement
id|EE_WIDE_SCSI
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: stwidn&n; *&n; * Description: The has sent us a Wide Nego message so handle it as&n; *              necessary.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|stwidn
r_void
id|stwidn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|stwidn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|UCHAR
id|width
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
suffix:semicolon
id|width
op_assign
id|sfm
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|width
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|currSCCB-&gt;Sccb_scsimsg
op_eq
id|SMPARITY
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
)paren
id|width
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|width
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_or_assign
id|WIDE_ENABLED
suffix:semicolon
id|width
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|width
op_assign
id|NARROW_SCSI
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|WIDE_ENABLED
suffix:semicolon
)brace
id|sssyncv
c_func
(paren
id|port
comma
id|currSCCB-&gt;TargID
comma
id|width
comma
id|currTar_Info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_or_assign
id|WIDE_NEGOCIATED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_SYNC_MASK
)paren
op_eq
id|SYNC_SUPPORTED
)paren
)paren
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
id|sisyncn
c_func
(paren
id|port
comma
id|p_card
comma
id|TRUE
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|SELECT_SN_ST
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
id|width
op_assign
id|SM16BIT
suffix:semicolon
r_else
id|width
op_assign
id|SM8BIT
suffix:semicolon
id|siwidr
c_func
(paren
id|port
comma
id|width
)paren
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_or_assign
(paren
id|WIDE_NEGOCIATED
op_or
id|WIDE_ENABLED
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: siwidr&n; *&n; * Description: Answer the targets Wide nego message.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|siwidr
r_void
id|siwidr
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|width
)paren
macro_line|#else
r_void
id|siwidr
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|width
)paren
macro_line|#endif
(brace
id|ARAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|0
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMEXT
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|2
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x02
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|4
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|SMWDTR
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|6
)paren
comma
(paren
id|RAT_OP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|8
)paren
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
id|width
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|SYNC_MSGS
op_plus
l_int|10
)paren
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT_1
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_3
comma
(paren
id|AUTO_IMMED
op_plus
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|AUTO_INT
)paren
)paren
)paren
(brace
)brace
)brace
macro_line|#endif
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sssyncv&n; *&n; * Description: Write the desired value to the Sync Register for the&n; *              ID specified.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sssyncv
r_void
id|sssyncv
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id
comma
id|UCHAR
id|p_sync_value
comma
id|PSCCBMgr_tar_info
id|currTar_Info
)paren
macro_line|#else
r_void
id|sssyncv
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id
comma
id|UCHAR
id|p_sync_value
comma
id|PSCCBMgr_tar_info
id|currTar_Info
)paren
macro_line|#endif
(brace
id|UCHAR
id|index
suffix:semicolon
id|index
op_assign
id|p_id
suffix:semicolon
r_switch
c_cond
(paren
id|index
)paren
(brace
r_case
l_int|0
suffix:colon
id|index
op_assign
l_int|12
suffix:semicolon
multiline_comment|/* hp_synctarg_0 */
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|index
op_assign
l_int|13
suffix:semicolon
multiline_comment|/* hp_synctarg_1 */
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|index
op_assign
l_int|14
suffix:semicolon
multiline_comment|/* hp_synctarg_2 */
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|index
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* hp_synctarg_3 */
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|index
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* hp_synctarg_4 */
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|index
op_assign
l_int|9
suffix:semicolon
multiline_comment|/* hp_synctarg_5 */
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|index
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* hp_synctarg_6 */
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|index
op_assign
l_int|11
suffix:semicolon
multiline_comment|/* hp_synctarg_7 */
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|index
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* hp_synctarg_8 */
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|index
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* hp_synctarg_9 */
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|index
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* hp_synctarg_10 */
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|index
op_assign
l_int|7
suffix:semicolon
multiline_comment|/* hp_synctarg_11 */
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|index
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* hp_synctarg_12 */
r_break
suffix:semicolon
r_case
l_int|13
suffix:colon
id|index
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* hp_synctarg_13 */
r_break
suffix:semicolon
r_case
l_int|14
suffix:colon
id|index
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* hp_synctarg_14 */
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|index
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* hp_synctarg_15 */
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_synctarg_base
op_plus
id|index
comma
id|p_sync_value
)paren
suffix:semicolon
id|currTar_Info-&gt;TarSyncCtrl
op_assign
id|p_sync_value
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sresb&n; *&n; * Description: Reset the desired card&squot;s SCSI bus.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sresb
r_void
id|sresb
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|sresb
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|UCHAR
id|scsiID
comma
id|i
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
op_or
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsictrl_0
comma
id|SCSI_RST
)paren
suffix:semicolon
id|scsiID
op_assign
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
comma
id|TO_5ms
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|TIMEOUT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|START_TO
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|TIMEOUT
)paren
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
comma
id|scsiID
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsictrl_0
comma
id|ENA_SCAM_SEL
)paren
suffix:semicolon
id|Wait
c_func
(paren
id|port
comma
id|TO_5ms
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_mask
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_mask
)paren
op_or
l_int|0x00
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|scsiID
op_assign
l_int|0
suffix:semicolon
id|scsiID
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|scsiID
op_increment
)paren
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|currTar_Info-&gt;TarSyncCtrl
op_assign
l_int|0
suffix:semicolon
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|currTar_Info-&gt;TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
id|sssyncv
c_func
(paren
id|port
comma
id|scsiID
comma
id|NARROW_SCSI
comma
id|currTar_Info
)paren
suffix:semicolon
id|SccbMgrTableInitTarget
c_func
(paren
id|p_card
comma
id|scsiID
)paren
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|scanIndex
op_assign
l_int|0x00
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
op_assign
l_int|NULL
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_and_assign
op_complement
(paren
id|F_TAG_STARTED
op_or
id|F_HOST_XFER_ACT
op_or
id|F_NEW_SCCB_CMD
)paren
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|cmdCounter
op_assign
l_int|0x00
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_assign
l_int|0x00
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|tagQ_Lst
op_assign
l_int|0x01
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_DEPTH
suffix:semicolon
id|i
op_increment
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: ssenss&n; *&n; * Description: Setup for the Auto Sense command.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|ssenss
r_void
id|ssenss
c_func
(paren
id|PSCCBcard
id|pCurrCard
)paren
(brace
id|UCHAR
id|i
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
id|currSCCB-&gt;Save_CdbLen
op_assign
id|currSCCB-&gt;CdbLength
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|currSCCB-&gt;Save_Cdb
(braket
id|i
)braket
op_assign
id|currSCCB-&gt;Cdb
(braket
id|i
)braket
suffix:semicolon
)brace
id|currSCCB-&gt;CdbLength
op_assign
id|SIX_BYTE_CMD
suffix:semicolon
id|currSCCB-&gt;Cdb
(braket
l_int|0
)braket
op_assign
id|SCSI_REQUEST_SENSE
suffix:semicolon
id|currSCCB-&gt;Cdb
(braket
l_int|1
)braket
op_assign
id|currSCCB-&gt;Cdb
(braket
l_int|1
)braket
op_amp
(paren
id|UCHAR
)paren
l_int|0xE0
suffix:semicolon
multiline_comment|/*Keep LUN. */
id|currSCCB-&gt;Cdb
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|currSCCB-&gt;Cdb
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|currSCCB-&gt;Cdb
(braket
l_int|4
)braket
op_assign
id|currSCCB-&gt;RequestSenseLength
suffix:semicolon
id|currSCCB-&gt;Cdb
(braket
l_int|5
)braket
op_assign
l_int|0x00
suffix:semicolon
id|currSCCB-&gt;Sccb_XferCnt
op_assign
(paren
r_int
r_int
)paren
id|currSCCB-&gt;RequestSenseLength
suffix:semicolon
id|currSCCB-&gt;Sccb_ATC
op_assign
l_int|0x00
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_or_assign
id|F_AUTO_SENSE
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_and_assign
op_complement
id|F_SG_XFER
suffix:semicolon
id|currSCCB-&gt;Sccb_idmsg
op_assign
id|currSCCB-&gt;Sccb_idmsg
op_amp
op_complement
(paren
id|UCHAR
)paren
id|DISC_PRIV
suffix:semicolon
id|currSCCB-&gt;ControlByte
op_assign
l_int|0x00
suffix:semicolon
id|currSCCB-&gt;Sccb_MGRFlags
op_and_assign
id|F_STATUSLOADED
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sxfrp&n; *&n; * Description: Transfer data into the bit bucket until the device&n; *              decides to switch phase.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sxfrp
r_void
id|sxfrp
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|sxfrp
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|UCHAR
id|curr_phz
suffix:semicolon
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|hostDataXferAbort
c_func
(paren
id|p_port
comma
id|p_card
comma
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
)paren
suffix:semicolon
)brace
multiline_comment|/* If the Automation handled the end of the transfer then do not&n;      match the phase or we will get out of sync with the ISR.       */
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|XFER_CNT_0
op_or
id|AUTO_INT
)paren
)paren
r_return
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xfercnt_0
comma
l_int|0x00
)paren
suffix:semicolon
id|curr_phz
op_assign
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
(paren
id|UCHAR
)paren
id|S_SCSI_PHZ
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|curr_phz
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
op_logical_and
(paren
id|curr_phz
op_eq
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
(paren
id|UCHAR
)paren
id|S_SCSI_PHZ
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|curr_phz
op_amp
(paren
id|UCHAR
)paren
id|SCSI_IOBIT
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|HOST_PORT
op_or
id|SCSI_INBIT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
(brace
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_fifodata_0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|HOST_PORT
op_or
id|HOST_WRT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_fifodata_0
comma
l_int|0xFA
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* End of While loop for padding data I/O phase */
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
r_break
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|HOST_PORT
op_or
id|SCSI_INBIT
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
(brace
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_fifodata_0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_autostart_0
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|AUTO_INT
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|ICMD_COMP
op_or
id|ITAR_DISC
)paren
)paren
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RSEL
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: schkdd&n; *&n; * Description: Make sure data has been flushed from both FIFOs and abort&n; *              the operations if necessary.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|schkdd
r_void
id|schkdd
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|schkdd
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|USHORT
id|TimeOutLoop
suffix:semicolon
id|UCHAR
id|sPhase
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;Sccb_scsistat
op_ne
id|DATA_OUT_ST
)paren
op_logical_and
(paren
id|currSCCB-&gt;Sccb_scsistat
op_ne
id|DATA_IN_ST
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_ODD_BALL_CNT
)paren
(brace
id|currSCCB-&gt;Sccb_ATC
op_add_assign
(paren
id|currSCCB-&gt;Sccb_XferCnt
op_minus
l_int|1
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_XferCnt
op_assign
l_int|1
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_and_assign
op_complement
id|F_ODD_BALL_CNT
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_fiforead
)paren
comma
(paren
id|USHORT
)paren
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_else
(brace
id|currSCCB-&gt;Sccb_ATC
op_add_assign
id|currSCCB-&gt;Sccb_XferCnt
suffix:semicolon
id|currSCCB-&gt;Sccb_XferCnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|PARITY
)paren
op_logical_and
(paren
id|currSCCB-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PARITY_ERR
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PARITY
)paren
suffix:semicolon
)brace
id|hostDataXferAbort
c_func
(paren
id|port
comma
id|p_card
comma
id|currSCCB
)paren
suffix:semicolon
r_while
c_loop
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_ACK
)paren
(brace
)brace
id|TimeOutLoop
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
(brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_offsetctr
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x1F
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|RESET
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
op_logical_or
(paren
id|TimeOutLoop
op_increment
OG
l_int|0x3000
)paren
)paren
r_break
suffix:semicolon
)brace
id|sPhase
op_assign
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
(paren
id|SCSI_BSY
op_or
id|S_SCSI_PHZ
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_offsetctr
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x1F
)paren
op_logical_or
(paren
id|sPhase
op_eq
(paren
id|SCSI_BSY
op_or
id|S_DATAO_PH
)paren
)paren
op_logical_or
(paren
id|sPhase
op_eq
(paren
id|SCSI_BSY
op_or
id|S_DATAI_PH
)paren
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_ALL_XFERRED
)paren
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_HOST_XFER_DIR
)paren
(brace
id|phaseDataIn
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
(brace
id|phaseDataOut
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sxfrp
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|ICMD_COMP
op_or
id|ITAR_DISC
op_or
id|RESET
)paren
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|AUTO_INT
)paren
suffix:semicolon
id|phaseDecode
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
l_int|0x00
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sinits&n; *&n; * Description: Setup SCCB manager fields in this SCCB.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|sinits
r_void
id|sinits
c_func
(paren
id|PSCCB
id|p_sccb
comma
id|UCHAR
id|p_card
)paren
(brace
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p_sccb-&gt;TargID
OG
id|MAX_SCSI_TAR
)paren
op_logical_or
(paren
id|p_sccb-&gt;Lun
OG
id|MAX_LUN
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
suffix:semicolon
id|p_sccb-&gt;Sccb_XferState
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_XferCnt
op_assign
id|p_sccb-&gt;DataLength
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|SCATTER_GATHER_COMMAND
)paren
op_logical_or
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|RESIDUAL_SG_COMMAND
)paren
)paren
(brace
id|p_sccb-&gt;Sccb_SGoffset
op_assign
l_int|0
suffix:semicolon
id|p_sccb-&gt;Sccb_XferState
op_assign
id|F_SG_XFER
suffix:semicolon
id|p_sccb-&gt;Sccb_XferCnt
op_assign
l_int|0x00
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_sccb-&gt;DataLength
op_eq
l_int|0x00
)paren
id|p_sccb-&gt;Sccb_XferState
op_or_assign
id|F_ALL_XFERRED
suffix:semicolon
r_if
c_cond
(paren
id|p_sccb-&gt;ControlByte
op_amp
id|F_USE_CMD_Q
)paren
(brace
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_eq
id|TAG_Q_REJECT
)paren
id|p_sccb-&gt;ControlByte
op_and_assign
op_complement
id|F_USE_CMD_Q
suffix:semicolon
r_else
id|currTar_Info-&gt;TarStatus
op_or_assign
id|TAG_Q_TRYING
suffix:semicolon
)brace
multiline_comment|/*      For !single SCSI device in system  &amp; device allow Disconnect&n;&t;or command is tag_q type then send Cmd with Disconnect Enable&n;&t;else send Cmd with Disconnect Disable */
multiline_comment|/*&n;   if (((!(BL_Card[p_card].globalFlags &amp; F_SINGLE_DEVICE)) &amp;&amp;&n;      (currTar_Info-&gt;TarStatus &amp; TAR_ALLOW_DISC)) ||&n;      (currTar_Info-&gt;TarStatus &amp; TAG_Q_TRYING)) {&n;*/
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_ALLOW_DISC
)paren
op_logical_or
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAG_Q_TRYING
)paren
)paren
(brace
id|p_sccb-&gt;Sccb_idmsg
op_assign
(paren
id|UCHAR
)paren
(paren
id|SMIDENT
op_or
id|DISC_PRIV
)paren
op_or
id|p_sccb-&gt;Lun
suffix:semicolon
)brace
r_else
(brace
id|p_sccb-&gt;Sccb_idmsg
op_assign
(paren
id|UCHAR
)paren
id|SMIDENT
op_or
id|p_sccb-&gt;Lun
suffix:semicolon
)brace
id|p_sccb-&gt;HostStatus
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;TargetStatus
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_tag
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_MGRFlags
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_sgseg
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_ATC
op_assign
l_int|0x00
suffix:semicolon
id|p_sccb-&gt;Sccb_savedATC
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/*&n;   p_sccb-&gt;SccbVirtDataPtr    = 0x00;&n;   p_sccb-&gt;Sccb_forwardlink   = NULL;&n;   p_sccb-&gt;Sccb_backlink      = NULL;&n; */
id|p_sccb-&gt;Sccb_scsistat
op_assign
id|BUS_FREE_ST
suffix:semicolon
id|p_sccb-&gt;SccbStatus
op_assign
id|SCCB_IN_PROCESS
suffix:semicolon
id|p_sccb-&gt;Sccb_scsimsg
op_assign
id|SMNO_OP
suffix:semicolon
)brace
macro_line|#ident &quot;$Id: phase.c 1.11 1997/01/31 02:08:49 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   phase.c  $&n; *&n; *   Description:  Functions to intially handle the SCSI bus phase when&n; *                 the target asserts request (and the automation is not&n; *                 enabled to handle the situation).&n; *&n; *   $Date: 1997/01/31 02:08:49 $&n; *&n; *   $Revision: 1.11 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;&n;#if defined(OS2)&n;   extern void (far *s_PhaseTbl[8]) (ULONG, UCHAR);&n;#else&n;   #if defined(DOS)&n;      extern void (*s_PhaseTbl[8]) (USHORT, UCHAR);&n;   #else&n;      extern void (*s_PhaseTbl[8]) (ULONG, UCHAR);&n;   #endif&n;#endif&n;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Phase Decode&n; *&n; * Description: Determine the phase and call the appropriate function.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|phaseDecode
r_void
id|phaseDecode
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseDecode
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
r_int
r_char
id|phase_ref
suffix:semicolon
macro_line|#if defined(OS2)
r_void
(paren
id|far
op_star
id|phase
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#else
macro_line|#if defined(DOS)
r_void
(paren
op_star
id|phase
)paren
(paren
id|USHORT
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#else
r_void
(paren
op_star
id|phase
)paren
(paren
id|ULONG
comma
id|UCHAR
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|phase_ref
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|S_SCSI_PHZ
)paren
suffix:semicolon
id|phase
op_assign
id|s_PhaseTbl
(braket
id|phase_ref
)braket
suffix:semicolon
(paren
op_star
id|phase
)paren
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
multiline_comment|/* Call the correct phase func */
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Data Out Phase&n; *&n; * Description: Start up both the BusMaster and Xbow.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseDataOut
r_void
id|far
id|phaseDataOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseDataOut
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseDataOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
multiline_comment|/* Exit if No SCCB record */
)brace
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|DATA_OUT_ST
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_and_assign
op_complement
(paren
id|F_HOST_XFER_DIR
op_or
id|F_NO_DATA_YET
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_0
comma
(paren
id|END_DATA
op_plus
id|END_DATA_START
)paren
)paren
suffix:semicolon
id|dataXferProcessor
c_func
(paren
id|port
comma
op_amp
id|BL_Card
(braket
id|p_card
)braket
)paren
suffix:semicolon
macro_line|#if defined(NOBUGBUG)
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|XFER_CNT_0
)paren
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferCnt
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|SCCB_DATA_XFER_OUT
)paren
op_logical_and
(paren
id|currSCCB-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
)paren
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_DATA_OVER_RUN
suffix:semicolon
id|sxfrp
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
)paren
id|phaseDecode
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Data In Phase&n; *&n; * Description: Startup the BusMaster and the XBOW.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseDataIn
r_void
id|far
id|phaseDataIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseDataIn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseDataIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
multiline_comment|/* Exit if No SCCB record */
)brace
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|DATA_IN_ST
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_or_assign
id|F_HOST_XFER_DIR
suffix:semicolon
id|currSCCB-&gt;Sccb_XferState
op_and_assign
op_complement
id|F_NO_DATA_YET
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_0
comma
(paren
id|END_DATA
op_plus
id|END_DATA_START
)paren
)paren
suffix:semicolon
id|dataXferProcessor
c_func
(paren
id|port
comma
op_amp
id|BL_Card
(braket
id|p_card
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferCnt
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|currSCCB-&gt;ControlByte
op_amp
id|SCCB_DATA_XFER_IN
)paren
op_logical_and
(paren
id|currSCCB-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
)paren
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_DATA_OVER_RUN
suffix:semicolon
id|sxfrp
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|RESET
)paren
)paren
)paren
id|phaseDecode
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Command Phase&n; *&n; * Description: Load the CDB into the automation and start it up.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseCommand
r_void
id|far
id|phaseCommand
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseCommand
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseCommand
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|cdb_reg
suffix:semicolon
macro_line|#else
id|ULONG
id|cdb_reg
suffix:semicolon
macro_line|#endif
id|UCHAR
id|i
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PHASE_SEQUENCE_FAIL
suffix:semicolon
id|currSCCB-&gt;CdbLength
op_assign
id|SIX_BYTE_CMD
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
l_int|0x00
)paren
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|cdb_reg
op_assign
id|p_port
op_plus
id|CMD_STRT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|currSCCB-&gt;CdbLength
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
id|WRW_HARPOON
c_func
(paren
id|cdb_reg
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
r_else
id|WRW_HARPOON
c_func
(paren
id|cdb_reg
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
id|currSCCB-&gt;Cdb
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|cdb_reg
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;CdbLength
op_ne
id|TWELVE_BYTE_CMD
)paren
id|WRW_HARPOON
c_func
(paren
id|cdb_reg
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
)paren
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|COMMAND_ST
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_autostart_3
comma
(paren
id|AUTO_IMMED
op_or
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Status phase&n; *&n; * Description: Bring in the status and command complete message bytes&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseStatus
r_void
id|far
id|phaseStatus
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseStatus
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseStatus
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
multiline_comment|/* Start-up the automation to finish off this command and let the&n;      isr handle the interrupt for command complete when it comes in.&n;      We could wait here for the interrupt to be generated?&n;    */
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_0
comma
(paren
id|AUTO_IMMED
op_plus
id|END_DATA_START
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Phase Message Out&n; *&n; * Description: Send out our message (if we have one) and handle whatever&n; *              else is involed.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseMsgOut
r_void
id|far
id|phaseMsgOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseMsgOut
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseMsgOut
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|UCHAR
id|message
comma
id|scsiID
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_ne
l_int|NULL
)paren
(brace
id|message
op_assign
id|currSCCB-&gt;Sccb_scsimsg
suffix:semicolon
id|scsiID
op_assign
id|currSCCB-&gt;TargID
suffix:semicolon
r_if
c_cond
(paren
id|message
op_eq
id|SMDEV_RESET
)paren
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
suffix:semicolon
id|currTar_Info-&gt;TarSyncCtrl
op_assign
l_int|0
suffix:semicolon
id|sssyncv
c_func
(paren
id|port
comma
id|scsiID
comma
id|NARROW_SCSI
comma
id|currTar_Info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
id|queueFlushSccb
c_func
(paren
id|p_card
comma
id|SCCB_COMPLETE
)paren
suffix:semicolon
id|SccbMgrTableInitTarget
c_func
(paren
id|p_card
comma
id|scsiID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|ABORT_ST
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_COMPLETE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_ne
l_int|NULL
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scsiID
)braket
dot
id|TarTagQ_Cnt
op_decrement
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
OL
id|COMMAND_ST
)paren
(brace
r_if
c_cond
(paren
id|message
op_eq
id|SMNO_OP
)paren
(brace
id|currSCCB-&gt;Sccb_MGRFlags
op_or_assign
id|F_DEV_SELECTED
suffix:semicolon
id|ssel
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|message
op_eq
id|SMABORT
)paren
id|queueFlushSccb
c_func
(paren
id|p_card
comma
id|SCCB_COMPLETE
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|message
op_assign
id|SMABORT
suffix:semicolon
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|PHASE
op_or
id|XFER_CNT_0
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|SCSI_BUS_EN
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsidata_0
comma
id|message
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|message
op_eq
id|SMABORT
)paren
op_logical_or
(paren
id|message
op_eq
id|SMDEV_RESET
)paren
op_logical_or
(paren
id|message
op_eq
id|SMABORT_TAG
)paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|BUS_FREE
op_or
id|PHASE
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|BUS_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|currSCCB
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
)brace
)brace
r_else
(brace
id|sxfrp
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|message
op_eq
id|SMPARITY
)paren
(brace
id|currSCCB-&gt;Sccb_scsimsg
op_assign
id|SMNO_OP
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|sxfrp
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Message In phase&n; *&n; * Description: Bring in the message and determine what to do with it.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseMsgIn
r_void
id|far
id|phaseMsgIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseMsgIn
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseMsgIn
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|UCHAR
id|message
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|phaseChkFifo
c_func
(paren
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
id|message
op_assign
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsidata_0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|message
op_eq
id|SMDISC
)paren
op_logical_or
(paren
id|message
op_eq
id|SMSAVE_DATA_PTR
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|END_DATA_START
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|message
op_assign
id|sfm
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
(brace
id|sdecm
c_func
(paren
id|message
comma
id|port
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsimsg
op_ne
id|SMPARITY
)paren
(brace
id|ACCEPT_MSG
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_autostart_1
comma
(paren
id|AUTO_IMMED
op_plus
id|DISCONNECT_START
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Illegal phase&n; *&n; * Description: Target switched to some illegal phase, so all we can do&n; *              is report an error back to the host (if that is possible)&n; *              and send an ABORT message to the misbehaving target.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(OS2)
DECL|function|phaseIllegal
r_void
id|far
id|phaseIllegal
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
macro_line|#if defined(DOS)
r_void
id|phaseIllegal
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseIllegal
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_ne
l_int|NULL
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PHASE_SEQUENCE_FAIL
suffix:semicolon
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|ABORT_ST
suffix:semicolon
id|currSCCB-&gt;Sccb_scsimsg
op_assign
id|SMABORT
suffix:semicolon
)brace
id|ACCEPT_MSG_ATN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Phase Check FIFO&n; *&n; * Description: Make sure data has been flushed from both FIFOs and abort&n; *              the operations if necessary.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|phaseChkFifo
r_void
id|phaseChkFifo
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseChkFifo
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|ULONG
id|xfercnt
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|DATA_IN_ST
)paren
(brace
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
(brace
id|currSCCB-&gt;Sccb_ATC
op_add_assign
id|currSCCB-&gt;Sccb_XferCnt
suffix:semicolon
id|currSCCB-&gt;Sccb_XferCnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|PARITY
)paren
op_logical_and
(paren
id|currSCCB-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PARITY_ERR
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PARITY
)paren
suffix:semicolon
)brace
id|hostDataXferAbort
c_func
(paren
id|port
comma
id|p_card
comma
id|currSCCB
)paren
suffix:semicolon
id|dataXferProcessor
c_func
(paren
id|port
comma
op_amp
id|BL_Card
(braket
id|p_card
)braket
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
op_logical_and
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
)paren
(brace
)brace
)brace
)brace
multiline_comment|/*End Data In specific code. */
macro_line|#if defined(DOS)
id|asm
(brace
id|mov
id|dx
comma
id|port
suffix:semicolon
id|add
id|dx
comma
id|hp_xfercnt_2
suffix:semicolon
id|in
id|al
comma
id|dx
suffix:semicolon
id|dec
id|dx
suffix:semicolon
op_xor
id|ah
comma
id|ah
suffix:semicolon
id|mov
id|word
id|ptr
id|xfercnt
op_plus
l_int|2
comma
id|ax
suffix:semicolon
id|in
id|al
comma
id|dx
suffix:semicolon
id|dec
id|dx
suffix:semicolon
id|mov
id|ah
comma
id|al
suffix:semicolon
id|in
id|al
comma
id|dx
suffix:semicolon
id|mov
id|word
id|ptr
id|xfercnt
comma
id|ax
suffix:semicolon
)brace
macro_line|#else
id|GET_XFER_CNT
c_func
(paren
id|port
comma
id|xfercnt
)paren
suffix:semicolon
macro_line|#endif
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfercnt_0
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
l_int|0x00
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_ATC
op_add_assign
(paren
id|currSCCB-&gt;Sccb_XferCnt
op_minus
id|xfercnt
)paren
suffix:semicolon
id|currSCCB-&gt;Sccb_XferCnt
op_assign
id|xfercnt
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|PARITY
)paren
op_logical_and
(paren
id|currSCCB-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PARITY_ERR
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|PARITY
)paren
suffix:semicolon
)brace
id|hostDataXferAbort
c_func
(paren
id|port
comma
id|p_card
comma
id|currSCCB
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifowrite
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fiforead
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
comma
l_int|0x00
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|XFER_CNT_0
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Phase Bus Free&n; *&n; * Description: We just went bus free so figure out if it was&n; *              because of command complete or from a disconnect.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|phaseBusFree
r_void
id|phaseBusFree
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|phaseBusFree
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_ne
l_int|NULL
)paren
(brace
id|DISABLE_AUTO
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;OperationCode
op_eq
id|RESET_COMMAND
)paren
(brace
r_if
c_cond
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|currSCCB
comma
id|p_card
)paren
suffix:semicolon
id|queueSearchSelect
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|p_card
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_or_assign
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_and_assign
op_complement
id|EE_SYNC_MASK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_assign
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
op_complement
id|WIDE_ENABLED
)paren
op_or
id|WIDE_NEGOCIATED
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_and_assign
op_complement
id|EE_WIDE_SCSI
suffix:semicolon
)brace
macro_line|#if !defined(DOS)
r_else
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_Q_ST
)paren
(brace
multiline_comment|/* Make sure this is not a phony BUS_FREE.  If we were&n;&t;      reselected or if BUSY is NOT on then this is a&n;&t;      valid BUS FREE.  SRR Wednesday, 5/10/1995.     */
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_BSY
)paren
)paren
op_logical_or
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|RSEL
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_TAG_Q_MASK
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_or_assign
id|TAG_Q_REJECT
suffix:semicolon
)brace
r_else
(brace
r_return
suffix:semicolon
)brace
)brace
macro_line|#endif
r_else
(brace
id|currSCCB-&gt;Sccb_scsistat
op_assign
id|BUS_FREE_ST
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|currSCCB-&gt;HostStatus
)paren
(brace
id|currSCCB-&gt;HostStatus
op_assign
id|SCCB_PHASE_SEQUENCE_FAIL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|currSCCB
comma
id|p_card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
)brace
multiline_comment|/*end if !=null */
)brace
macro_line|#ident &quot;$Id: automate.c 1.14 1997/01/31 02:11:46 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   automate.c  $&n; *&n; *   Description:  Functions relating to programming the automation of&n; *                 the HARPOON.&n; *&n; *   $Date: 1997/01/31 02:11:46 $&n; *&n; *   $Revision: 1.14 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Auto Load Default Map&n; *&n; * Description: Load the Automation RAM with the defualt map values.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|autoLoadDefaultMap
r_void
id|autoLoadDefaultMap
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|autoLoadDefaultMap
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|USHORT
id|map_addr
suffix:semicolon
macro_line|#else
id|ULONG
id|map_addr
suffix:semicolon
macro_line|#endif
id|ARAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|map_addr
op_assign
id|p_port
op_plus
id|hp_aramBase
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0xC0
)paren
)paren
suffix:semicolon
multiline_comment|/*ID MESSAGE */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x20
)paren
)paren
suffix:semicolon
multiline_comment|/*SIMPLE TAG QUEUEING MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
id|RAT_OP
)paren
suffix:semicolon
multiline_comment|/*RESET ATTENTION */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|AMSG_OUT
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*TAG ID MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 0 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 1 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 2 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 3 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 4 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 5 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 6 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 7 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 8 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 9 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 10 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CDB BYTE 11 */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPE_OP
op_plus
id|ADATA_OUT
op_plus
id|DINT
)paren
)paren
suffix:semicolon
multiline_comment|/*JUMP IF DATA OUT */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|TCB_OP
op_plus
id|FIFO_0
op_plus
id|DI
)paren
)paren
suffix:semicolon
multiline_comment|/*JUMP IF NO DATA IN FIFO */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/*This means AYNC DATA IN */
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_IDO_STRT
)paren
)paren
suffix:semicolon
multiline_comment|/*STOP AND INTERRUPT */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPE_OP
op_plus
id|ADATA_IN
op_plus
id|DINT
)paren
)paren
suffix:semicolon
multiline_comment|/*JUMP IF NOT DATA IN PHZ */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPN_OP
op_plus
id|AMSG_IN
op_plus
id|ST
)paren
)paren
suffix:semicolon
multiline_comment|/*IF NOT MSG IN CHECK 4 DATA IN */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CRD_OP
op_plus
id|SDATA
op_plus
l_int|0x02
)paren
)paren
suffix:semicolon
multiline_comment|/*SAVE DATA PTR MSG? */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|BRH_OP
op_plus
id|NOT_EQ
op_plus
id|DC
)paren
)paren
suffix:semicolon
multiline_comment|/*GO CHECK FOR DISCONNECT MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MRR_OP
op_plus
id|SDATA
op_plus
id|D_AR1
)paren
)paren
suffix:semicolon
multiline_comment|/*SAVE DATA PTRS MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPN_OP
op_plus
id|AMSG_IN
op_plus
id|ST
)paren
)paren
suffix:semicolon
multiline_comment|/*IF NOT MSG IN CHECK DATA IN */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CRD_OP
op_plus
id|SDATA
op_plus
l_int|0x04
)paren
)paren
suffix:semicolon
multiline_comment|/*DISCONNECT MSG? */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|BRH_OP
op_plus
id|NOT_EQ
op_plus
id|UNKNWN
)paren
)paren
suffix:semicolon
multiline_comment|/*UKNKNOWN MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MRR_OP
op_plus
id|SDATA
op_plus
id|D_BUCKET
)paren
)paren
suffix:semicolon
multiline_comment|/*XFER DISCONNECT MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_ITAR_DISC
)paren
)paren
suffix:semicolon
multiline_comment|/*STOP AND INTERRUPT */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPN_OP
op_plus
id|ASTATUS
op_plus
id|UNKNWN
)paren
)paren
suffix:semicolon
multiline_comment|/*JUMP IF NOT STATUS PHZ. */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MRR_OP
op_plus
id|SDATA
op_plus
id|D_AR0
)paren
)paren
suffix:semicolon
multiline_comment|/*GET STATUS BYTE */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CPN_OP
op_plus
id|AMSG_IN
op_plus
id|CC
)paren
)paren
suffix:semicolon
multiline_comment|/*ERROR IF NOT MSG IN PHZ */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CRD_OP
op_plus
id|SDATA
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*CHECK FOR CMD COMPLETE MSG. */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|BRH_OP
op_plus
id|NOT_EQ
op_plus
id|CC
)paren
)paren
suffix:semicolon
multiline_comment|/*ERROR IF NOT CMD COMPLETE MSG. */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|MRR_OP
op_plus
id|SDATA
op_plus
id|D_BUCKET
)paren
)paren
suffix:semicolon
multiline_comment|/*GET CMD COMPLETE MSG */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_ICMD_COMP
)paren
)paren
suffix:semicolon
multiline_comment|/*END OF COMMAND */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_IUNKWN
)paren
)paren
suffix:semicolon
multiline_comment|/*RECEIVED UNKNOWN MSG BYTE */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_INO_CC
)paren
)paren
suffix:semicolon
multiline_comment|/*NO COMMAND COMPLETE AFTER STATUS */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_ITICKLE
)paren
)paren
suffix:semicolon
multiline_comment|/*BIOS Tickled the Mgr */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_IRFAIL
)paren
)paren
suffix:semicolon
multiline_comment|/*EXPECTED ID/TAG MESSAGES AND */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* DIDN&squot;T GET ONE */
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|CRR_OP
op_plus
id|AR3
op_plus
id|S_IDREG
)paren
)paren
suffix:semicolon
multiline_comment|/* comp SCSI SEL ID &amp; AR3*/
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|BRH_OP
op_plus
id|EQUAL
op_plus
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/*SEL ID OK then Conti. */
id|map_addr
op_add_assign
l_int|2
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
id|map_addr
comma
(paren
id|SSI_OP
op_plus
id|SSI_INO_CC
)paren
)paren
suffix:semicolon
multiline_comment|/*NO COMMAND COMPLETE AFTER STATUS */
id|SGRAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Auto Command Complete&n; *&n; * Description: Post command back to host and find another command&n; *              to execute.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|autoCmdCmplt
r_void
id|autoCmdCmplt
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#else
r_void
id|autoCmdCmplt
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_card
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|UCHAR
id|status_byte
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
id|status_byte
op_assign
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_gp_reg_0
)paren
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUN_CA
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|status_byte
op_ne
id|SSGOOD
)paren
(brace
r_if
c_cond
(paren
id|status_byte
op_eq
id|SSQ_FULL
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|currSCCB-&gt;Sccb_MGRFlags
op_or_assign
id|F_STATUSLOADED
suffix:semicolon
id|queueSelectFail
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|p_card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_SN_ST
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_or_assign
(paren
id|UCHAR
)paren
id|SYNC_SUPPORTED
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_and_assign
op_complement
id|EE_SYNC_MASK
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_scsistat
op_eq
id|SELECT_WN_ST
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_assign
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
op_complement
id|WIDE_ENABLED
)paren
op_or
id|WIDE_NEGOCIATED
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_and_assign
op_complement
id|EE_WIDE_SCSI
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status_byte
op_eq
id|SSCHECK
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_DO_RENEGO
)paren
(brace
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_amp
id|EE_SYNC_MASK
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_SYNC_MASK
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarEEValue
op_amp
id|EE_WIDE_SCSI
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_and_assign
op_complement
id|TAR_WIDE_MASK
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_AUTO_SENSE
)paren
)paren
(brace
id|currSCCB-&gt;SccbStatus
op_assign
id|SCCB_ERROR
suffix:semicolon
id|currSCCB-&gt;TargetStatus
op_assign
id|status_byte
suffix:semicolon
r_if
c_cond
(paren
id|status_byte
op_eq
id|SSCHECK
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUN_CA
op_assign
id|TRUE
suffix:semicolon
macro_line|#if (FW_TYPE==_SCCB_MGR_)
r_if
c_cond
(paren
id|currSCCB-&gt;RequestSenseLength
op_ne
id|NO_AUTO_REQUEST_SENSE
)paren
(brace
r_if
c_cond
(paren
id|currSCCB-&gt;RequestSenseLength
op_eq
l_int|0
)paren
id|currSCCB-&gt;RequestSenseLength
op_assign
l_int|14
suffix:semicolon
id|ssenss
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
)paren
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|currSCCB-&gt;Sccb_ucb_ptr-&gt;UCB_opcode
op_amp
id|OPC_NO_AUTO_SENSE
)paren
)paren
op_logical_and
(paren
id|currSCCB-&gt;RequestSenseLength
)paren
)paren
(brace
id|ssenss
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
)paren
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
id|currSCCB-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_tag
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currSCCB-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_ne
l_int|0
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQCount
op_decrement
suffix:semicolon
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
id|currSCCB-&gt;Lun
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|currSCCB-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|currSCCB
comma
id|p_card
)paren
suffix:semicolon
)brace
macro_line|#ident &quot;$Id: busmstr.c 1.8 1997/01/31 02:10:27 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   busmstr.c  $&n; *&n; *   Description:  Functions to start, stop, and abort BusMaster operations.&n; *&n; *   $Date: 1997/01/31 02:10:27 $&n; *&n; *   $Revision: 1.8 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;*/
DECL|macro|SHORT_WAIT
mdefine_line|#define SHORT_WAIT   0x0000000F
DECL|macro|LONG_WAIT
mdefine_line|#define LONG_WAIT    0x0000FFFFL
macro_line|#if defined(BUGBUG)
r_void
id|Debug_Load
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_bug_data
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Data Transfer Processor&n; *&n; * Description: This routine performs two tasks.&n; *              (1) Start data transfer by calling HOST_DATA_XFER_START&n; *              function.  Once data transfer is started, (2) Depends&n; *              on the type of data transfer mode Scatter/Gather mode&n; *              or NON Scatter/Gather mode.  In NON Scatter/Gather mode,&n; *              this routine checks Sccb_MGRFlag (F_HOST_XFER_ACT bit) for&n; *              data transfer done.  In Scatter/Gather mode, this routine&n; *              checks bus master command complete and dual rank busy&n; *              bit to keep chaining SC transfer command.  Similarly,&n; *              in Scatter/Gather mode, it checks Sccb_MGRFlag&n; *              (F_HOST_XFER_ACT bit) for data transfer done.&n; *              &n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|dataXferProcessor
r_void
id|dataXferProcessor
c_func
(paren
id|USHORT
id|port
comma
id|PSCCBcard
id|pCurrCard
)paren
macro_line|#else
r_void
id|dataXferProcessor
c_func
(paren
id|ULONG
id|port
comma
id|PSCCBcard
id|pCurrCard
)paren
macro_line|#endif
(brace
id|PSCCB
id|currSCCB
suffix:semicolon
id|currSCCB
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_SG_XFER
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
(brace
id|currSCCB-&gt;Sccb_sgseg
op_add_assign
(paren
id|UCHAR
)paren
id|SG_BUF_CNT
suffix:semicolon
id|currSCCB-&gt;Sccb_SGoffset
op_assign
l_int|0x00
suffix:semicolon
)brace
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_HOST_XFER_ACT
suffix:semicolon
id|busMstrSGDataXferStart
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_HOST_XFER_ACT
)paren
)paren
(brace
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_HOST_XFER_ACT
suffix:semicolon
id|busMstrDataXferStart
c_func
(paren
id|port
comma
id|currSCCB
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: BusMaster Scatter Gather Data Transfer Start&n; *&n; * Description:&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|busMstrSGDataXferStart
r_void
id|busMstrSGDataXferStart
c_func
(paren
id|USHORT
id|p_port
comma
id|PSCCB
id|pcurrSCCB
)paren
macro_line|#else
r_void
id|busMstrSGDataXferStart
c_func
(paren
id|ULONG
id|p_port
comma
id|PSCCB
id|pcurrSCCB
)paren
macro_line|#endif
(brace
id|ULONG
id|count
comma
id|addr
comma
id|tmpSGCnt
suffix:semicolon
id|UINT
id|sg_index
suffix:semicolon
id|UCHAR
id|sg_count
comma
id|i
suffix:semicolon
macro_line|#if defined(DOS)
id|USHORT
id|reg_offset
suffix:semicolon
macro_line|#else
id|ULONG
id|reg_offset
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pcurrSCCB-&gt;Sccb_XferState
op_amp
id|F_HOST_XFER_DIR
)paren
(brace
id|count
op_assign
(paren
(paren
id|ULONG
)paren
id|HOST_RD_CMD
)paren
op_lshift
l_int|24
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
(paren
(paren
id|ULONG
)paren
id|HOST_WRT_CMD
)paren
op_lshift
l_int|24
suffix:semicolon
)brace
id|sg_count
op_assign
l_int|0
suffix:semicolon
id|tmpSGCnt
op_assign
l_int|0
suffix:semicolon
id|sg_index
op_assign
id|pcurrSCCB-&gt;Sccb_sgseg
suffix:semicolon
id|reg_offset
op_assign
id|hp_aramBase
suffix:semicolon
id|i
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
(paren
id|SGRAM_ARAM
op_or
id|SCATTER_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
id|i
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sg_count
OL
(paren
id|UCHAR
)paren
id|SG_BUF_CNT
)paren
op_logical_and
(paren
(paren
id|ULONG
)paren
(paren
id|sg_index
op_star
(paren
id|UINT
)paren
id|SG_ELEMENT_SIZE
)paren
OL
id|pcurrSCCB-&gt;DataLength
)paren
)paren
(brace
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
id|tmpSGCnt
op_add_assign
op_star
(paren
(paren
(paren
id|ULONG
id|far
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|count
op_or_assign
op_star
(paren
(paren
(paren
id|ULONG
id|far
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|addr
op_assign
op_star
(paren
(paren
(paren
id|ULONG
id|far
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
(paren
id|sg_index
op_star
l_int|2
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#else
id|tmpSGCnt
op_add_assign
op_star
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|count
op_or_assign
op_star
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|addr
op_assign
op_star
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|pcurrSCCB-&gt;DataPointer
)paren
op_plus
(paren
(paren
id|sg_index
op_star
l_int|2
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
op_logical_neg
id|sg_count
)paren
op_logical_and
(paren
id|pcurrSCCB-&gt;Sccb_SGoffset
)paren
)paren
(brace
id|addr
op_add_assign
(paren
(paren
id|count
op_amp
l_int|0x00FFFFFFL
)paren
op_minus
id|pcurrSCCB-&gt;Sccb_SGoffset
)paren
suffix:semicolon
id|count
op_assign
(paren
id|count
op_amp
l_int|0xFF000000L
)paren
op_or
id|pcurrSCCB-&gt;Sccb_SGoffset
suffix:semicolon
id|tmpSGCnt
op_assign
id|count
op_amp
l_int|0x00FFFFFFL
suffix:semicolon
)brace
id|WR_HARP32
c_func
(paren
id|p_port
comma
id|reg_offset
comma
id|addr
)paren
suffix:semicolon
id|reg_offset
op_add_assign
l_int|4
suffix:semicolon
id|WR_HARP32
c_func
(paren
id|p_port
comma
id|reg_offset
comma
id|count
)paren
suffix:semicolon
id|reg_offset
op_add_assign
l_int|4
suffix:semicolon
id|count
op_and_assign
l_int|0xFF000000L
suffix:semicolon
id|sg_index
op_increment
suffix:semicolon
id|sg_count
op_increment
suffix:semicolon
)brace
multiline_comment|/*End While */
id|pcurrSCCB-&gt;Sccb_XferCnt
op_assign
id|tmpSGCnt
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sg_addr
comma
(paren
id|sg_count
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcurrSCCB-&gt;Sccb_XferState
op_amp
id|F_HOST_XFER_DIR
)paren
(brace
id|WR_HARP32
c_func
(paren
id|p_port
comma
id|hp_xfercnt_0
comma
id|tmpSGCnt
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|DMA_PORT
op_or
id|SCSI_PORT
op_or
id|SCSI_INBIT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|S_DATAI_PH
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_synctarg_0
)paren
op_amp
id|NARROW_SCSI
)paren
)paren
op_logical_and
(paren
id|tmpSGCnt
op_amp
l_int|0x000000001
)paren
)paren
(brace
id|pcurrSCCB-&gt;Sccb_XferState
op_or_assign
id|F_ODD_BALL_CNT
suffix:semicolon
id|tmpSGCnt
op_decrement
suffix:semicolon
)brace
id|WR_HARP32
c_func
(paren
id|p_port
comma
id|hp_xfercnt_0
comma
id|tmpSGCnt
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|DMA_PORT
op_or
id|DMA_RD
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|S_DATAO_PH
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|UCHAR
)paren
(paren
id|i
op_or
id|SCATTER_EN
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: BusMaster Data Transfer Start&n; *&n; * Description: &n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|busMstrDataXferStart
r_void
id|busMstrDataXferStart
c_func
(paren
id|USHORT
id|p_port
comma
id|PSCCB
id|pcurrSCCB
)paren
macro_line|#else
r_void
id|busMstrDataXferStart
c_func
(paren
id|ULONG
id|p_port
comma
id|PSCCB
id|pcurrSCCB
)paren
macro_line|#endif
(brace
id|ULONG
id|addr
comma
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pcurrSCCB-&gt;Sccb_XferState
op_amp
id|F_AUTO_SENSE
)paren
)paren
(brace
id|count
op_assign
id|pcurrSCCB-&gt;Sccb_XferCnt
suffix:semicolon
id|addr
op_assign
(paren
id|ULONG
)paren
id|pcurrSCCB-&gt;DataPointer
op_plus
id|pcurrSCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
r_else
(brace
id|addr
op_assign
id|pcurrSCCB-&gt;SensePointer
suffix:semicolon
id|count
op_assign
id|pcurrSCCB-&gt;RequestSenseLength
suffix:semicolon
)brace
macro_line|#if defined(DOS)
id|asm
(brace
id|mov
id|dx
comma
id|p_port
suffix:semicolon
id|mov
id|ax
comma
id|word
id|ptr
id|count
suffix:semicolon
id|add
id|dx
comma
id|hp_xfer_cnt_lo
suffix:semicolon
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|xchg
id|ah
comma
id|al
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|mov
id|ax
comma
id|word
id|ptr
id|count
op_plus
l_int|2
suffix:semicolon
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|mov
id|ax
comma
id|word
id|ptr
id|addr
suffix:semicolon
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|xchg
id|ah
comma
id|al
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|mov
id|ax
comma
id|word
id|ptr
id|addr
op_plus
l_int|2
suffix:semicolon
id|out
id|dx
comma
id|al
suffix:semicolon
id|inc
id|dx
suffix:semicolon
id|xchg
id|ah
comma
id|al
id|out
id|dx
comma
id|al
suffix:semicolon
)brace
id|WR_HARP32
c_func
(paren
id|p_port
comma
id|hp_xfercnt_0
comma
id|count
)paren
suffix:semicolon
macro_line|#else
id|HP_SETUP_ADDR_CNT
c_func
(paren
id|p_port
comma
id|addr
comma
id|count
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pcurrSCCB-&gt;Sccb_XferState
op_amp
id|F_HOST_XFER_DIR
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|DMA_PORT
op_or
id|SCSI_PORT
op_or
id|SCSI_INBIT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|S_DATAI_PH
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xfer_cmd
comma
(paren
id|XFER_DMA_HOST
op_or
id|XFER_HOST_AUTO
op_or
id|XFER_DMA_8BIT
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|SCSI_PORT
op_or
id|DMA_PORT
op_or
id|DMA_RD
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|S_DATAO_PH
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_xfer_cmd
comma
(paren
id|XFER_HOST_DMA
op_or
id|XFER_HOST_AUTO
op_or
id|XFER_DMA_8BIT
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: BusMaster Timeout Handler&n; *&n; * Description: This function is called after a bus master command busy time&n; *               out is detected.  This routines issue halt state machine&n; *               with a software time out for command busy.  If command busy&n; *               is still asserted at the end of the time out, it issues&n; *               hard abort with another software time out.  It hard abort&n; *               command busy is also time out, it&squot;ll just give up.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|busMstrTimeOut
id|UCHAR
id|busMstrTimeOut
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
id|UCHAR
id|busMstrTimeOut
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|ULONG
id|timeout
suffix:semicolon
id|timeout
op_assign
id|LONG_WAIT
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sys_ctrl
comma
id|HALT_MACH
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ext_status
)paren
op_amp
id|CMD_ABORTED
)paren
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sys_ctrl
comma
id|HARD_ABORT
)paren
suffix:semicolon
id|timeout
op_assign
id|LONG_WAIT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
)brace
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_int_status
)paren
suffix:semicolon
multiline_comment|/*Clear command complete */
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Host Data Transfer Abort&n; *&n; * Description: Abort any in progress transfer.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|hostDataXferAbort
r_void
id|hostDataXferAbort
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#else
r_void
id|hostDataXferAbort
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|p_card
comma
id|PSCCB
id|pCurrSCCB
)paren
macro_line|#endif
(brace
id|ULONG
id|timeout
suffix:semicolon
id|ULONG
id|remain_cnt
suffix:semicolon
id|UINT
id|sg_ptr
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_and_assign
op_complement
id|F_HOST_XFER_ACT
suffix:semicolon
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_XferState
op_amp
id|F_AUTO_SENSE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
op_amp
id|INT_CMD_COMPL
)paren
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
)paren
op_or
id|FLUSH_XFER_CNTR
)paren
)paren
suffix:semicolon
id|timeout
op_assign
id|LONG_WAIT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|FLUSH_XFER_CNTR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
r_if
c_cond
(paren
id|busMstrTimeOut
c_func
(paren
id|port
)paren
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
op_amp
id|INT_EXT_STATUS
)paren
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BAD_EXT_STATUS
)paren
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_dual_addr_lo
comma
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_XferCnt
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_XferState
op_amp
id|F_SG_XFER
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|SCATTER_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_sg_addr
comma
l_int|0x00
)paren
suffix:semicolon
id|sg_ptr
op_assign
id|pCurrSCCB-&gt;Sccb_sgseg
op_plus
id|SG_BUF_CNT
suffix:semicolon
r_if
c_cond
(paren
id|sg_ptr
OG
(paren
id|UINT
)paren
(paren
id|pCurrSCCB-&gt;DataLength
op_div
id|SG_ELEMENT_SIZE
)paren
)paren
(brace
id|sg_ptr
op_assign
(paren
id|UINT
)paren
(paren
id|pCurrSCCB-&gt;DataLength
op_div
id|SG_ELEMENT_SIZE
)paren
suffix:semicolon
)brace
id|remain_cnt
op_assign
id|pCurrSCCB-&gt;Sccb_XferCnt
suffix:semicolon
r_while
c_loop
(paren
id|remain_cnt
OL
l_int|0x01000000L
)paren
(brace
id|sg_ptr
op_decrement
suffix:semicolon
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
r_if
c_cond
(paren
id|remain_cnt
OG
(paren
id|ULONG
)paren
(paren
op_star
(paren
(paren
(paren
id|ULONG
id|far
op_star
)paren
id|pCurrSCCB
op_member_access_from_pointer
id|DataPointer
)paren
op_plus
(paren
id|sg_ptr
op_star
l_int|2
)paren
)paren
)paren
)paren
(brace
id|remain_cnt
op_sub_assign
(paren
id|ULONG
)paren
(paren
op_star
(paren
(paren
(paren
id|ULONG
id|far
op_star
)paren
id|pCurrSCCB
op_member_access_from_pointer
id|DataPointer
)paren
op_plus
(paren
id|sg_ptr
op_star
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|remain_cnt
OG
(paren
id|ULONG
)paren
(paren
op_star
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|pCurrSCCB
op_member_access_from_pointer
id|DataPointer
)paren
op_plus
(paren
id|sg_ptr
op_star
l_int|2
)paren
)paren
)paren
)paren
(brace
id|remain_cnt
op_sub_assign
(paren
id|ULONG
)paren
(paren
op_star
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|pCurrSCCB
op_member_access_from_pointer
id|DataPointer
)paren
op_plus
(paren
id|sg_ptr
op_star
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|remain_cnt
OL
l_int|0x01000000L
)paren
(brace
id|pCurrSCCB-&gt;Sccb_SGoffset
op_assign
id|remain_cnt
suffix:semicolon
id|pCurrSCCB-&gt;Sccb_sgseg
op_assign
(paren
id|USHORT
)paren
id|sg_ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ULONG
)paren
(paren
id|sg_ptr
op_star
id|SG_ELEMENT_SIZE
)paren
op_eq
id|pCurrSCCB-&gt;DataLength
op_logical_and
(paren
id|remain_cnt
op_eq
l_int|0
)paren
)paren
id|pCurrSCCB-&gt;Sccb_XferState
op_or_assign
id|F_ALL_XFERRED
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_GROSS_FW_ERR
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCurrSCCB-&gt;Sccb_XferState
op_amp
id|F_HOST_XFER_DIR
)paren
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
id|busMstrTimeOut
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
op_amp
id|INT_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BAD_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_dual_addr_lo
comma
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifo_cnt
)paren
)paren
op_ge
id|BM_THRESHOLD
)paren
(brace
id|timeout
op_assign
id|SHORT_WAIT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
op_logical_and
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifo_cnt
)paren
)paren
op_ge
id|BM_THRESHOLD
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
)paren
op_or
id|FLUSH_XFER_CNTR
)paren
)paren
suffix:semicolon
id|timeout
op_assign
id|LONG_WAIT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_bm_ctrl
)paren
op_amp
op_complement
id|FLUSH_XFER_CNTR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
)brace
id|busMstrTimeOut
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
op_amp
id|INT_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BAD_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_dual_addr_lo
comma
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
id|timeout
op_assign
id|LONG_WAIT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
op_logical_and
id|timeout
op_decrement
)paren
(brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BM_CMD_BUSY
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
)brace
id|busMstrTimeOut
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
op_amp
id|INT_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
op_amp
id|BAD_EXT_STATUS
)paren
(brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;HostStatus
op_eq
l_int|0x00
)paren
(brace
id|pCurrSCCB-&gt;HostStatus
op_assign
id|SCCB_BM_ERR
suffix:semicolon
macro_line|#if defined(BUGBUG)
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_dual_addr_lo
comma
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_ext_status
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
)brace
r_if
c_cond
(paren
id|pCurrSCCB-&gt;Sccb_XferState
op_amp
id|F_SG_XFER
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|SCATTER_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_sg_addr
comma
l_int|0x00
)paren
suffix:semicolon
id|pCurrSCCB-&gt;Sccb_sgseg
op_add_assign
id|SG_BUF_CNT
suffix:semicolon
id|pCurrSCCB-&gt;Sccb_SGoffset
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ULONG
)paren
(paren
id|pCurrSCCB-&gt;Sccb_sgseg
op_star
id|SG_ELEMENT_SIZE
)paren
op_ge
id|pCurrSCCB-&gt;DataLength
)paren
(brace
id|pCurrSCCB-&gt;Sccb_XferState
op_or_assign
id|F_ALL_XFERRED
suffix:semicolon
id|pCurrSCCB-&gt;Sccb_sgseg
op_assign
(paren
id|USHORT
)paren
(paren
id|pCurrSCCB-&gt;DataLength
op_div
id|SG_ELEMENT_SIZE
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pCurrSCCB-&gt;Sccb_XferState
op_amp
id|F_AUTO_SENSE
)paren
)paren
id|pCurrSCCB-&gt;Sccb_XferState
op_or_assign
id|F_ALL_XFERRED
suffix:semicolon
)brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_mask
comma
(paren
id|INT_CMD_COMPL
op_or
id|SCSI_INTERRUPT
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Host Data Transfer Restart&n; *&n; * Description: Reset the available count due to a restore data&n; *              pointers message.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|hostDataXferRestart
r_void
id|hostDataXferRestart
c_func
(paren
id|PSCCB
id|currSCCB
)paren
(brace
id|ULONG
id|data_count
suffix:semicolon
id|UINT
id|sg_index
suffix:semicolon
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
id|ULONG
id|far
op_star
id|sg_ptr
suffix:semicolon
macro_line|#else
id|ULONG
op_star
id|sg_ptr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|currSCCB-&gt;Sccb_XferState
op_amp
id|F_SG_XFER
)paren
(brace
id|currSCCB-&gt;Sccb_XferCnt
op_assign
l_int|0
suffix:semicolon
id|sg_index
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/*Index by long words into sg list. */
id|data_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*Running count of SG xfer counts. */
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
id|sg_ptr
op_assign
(paren
id|ULONG
id|far
op_star
)paren
id|currSCCB-&gt;DataPointer
suffix:semicolon
macro_line|#else
id|sg_ptr
op_assign
(paren
id|ULONG
op_star
)paren
id|currSCCB-&gt;DataPointer
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
id|data_count
OL
id|currSCCB-&gt;Sccb_ATC
)paren
(brace
id|sg_index
op_increment
suffix:semicolon
id|data_count
op_add_assign
op_star
(paren
id|sg_ptr
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data_count
op_eq
id|currSCCB-&gt;Sccb_ATC
)paren
(brace
id|currSCCB-&gt;Sccb_SGoffset
op_assign
l_int|0
suffix:semicolon
id|sg_index
op_increment
suffix:semicolon
)brace
r_else
(brace
id|currSCCB-&gt;Sccb_SGoffset
op_assign
id|data_count
op_minus
id|currSCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
id|currSCCB-&gt;Sccb_sgseg
op_assign
(paren
id|USHORT
)paren
id|sg_index
suffix:semicolon
)brace
r_else
(brace
id|currSCCB-&gt;Sccb_XferCnt
op_assign
id|currSCCB-&gt;DataLength
op_minus
id|currSCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
)brace
macro_line|#ident &quot;$Id: scam.c 1.17 1997/03/20 23:49:37 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   scam.c  $&n; *&n; *   Description:  Functions relating to handling of the SCAM selection&n; *                 and the determination of the SCSI IDs to be assigned&n; *                 to all perspective SCSI targets.&n; *&n; *   $Date: 1997/03/20 23:49:37 $&n; *&n; *   $Revision: 1.17 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;eeprom.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBSCAM_INFO scamInfo[MAX_SCSI_TAR];&n;extern NVRAMINFO nvRamInfo[MAX_MB_CARDS];&n;#if defined(DOS) || defined(OS2)&n;extern UCHAR temp_id_string[ID_STRING_LENGTH];&n;#endif&n;extern UCHAR scamHAString[];&n;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scini&n; *&n; * Description: Setup all data structures necessary for SCAM selection.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|scini
r_void
id|scini
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_our_id
comma
id|UCHAR
id|p_power_up
)paren
(brace
macro_line|#if defined(SCAM_LEV_2)
id|UCHAR
id|loser
comma
id|assigned_id
suffix:semicolon
macro_line|#endif
macro_line|#if defined(DOS)
id|USHORT
id|p_port
suffix:semicolon
macro_line|#else
id|ULONG
id|p_port
suffix:semicolon
macro_line|#endif
id|UCHAR
id|i
comma
id|k
comma
id|ScamFlg
suffix:semicolon
id|PSCCBcard
id|currCard
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|currCard
op_assign
op_amp
id|BL_Card
(braket
id|p_card
)braket
suffix:semicolon
id|p_port
op_assign
id|currCard-&gt;ioPort
suffix:semicolon
id|pCurrNvRam
op_assign
id|currCard-&gt;pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|ScamFlg
op_assign
id|pCurrNvRam-&gt;niScamConf
suffix:semicolon
id|i
op_assign
id|pCurrNvRam-&gt;niSysConf
suffix:semicolon
)brace
r_else
(brace
id|ScamFlg
op_assign
(paren
id|UCHAR
)paren
id|utilEERead
c_func
(paren
id|p_port
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
id|i
op_assign
(paren
id|UCHAR
)paren
(paren
id|utilEERead
c_func
(paren
id|p_port
comma
(paren
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_amp
l_int|0x02
)paren
)paren
(brace
multiline_comment|/* check if reset bus in AutoSCSI parameter set */
r_return
suffix:semicolon
)brace
id|inisci
c_func
(paren
id|p_card
comma
id|p_port
comma
id|p_our_id
)paren
suffix:semicolon
multiline_comment|/* Force to wait 1 sec after SCSI bus reset. Some SCAM device FW&n;      too slow to return to SCAM selection */
multiline_comment|/* if (p_power_up)&n;         Wait1Second(p_port);&n;      else&n;         Wait(p_port, TO_250ms); */
id|Wait1Second
c_func
(paren
id|p_port
)paren
suffix:semicolon
macro_line|#if defined(SCAM_LEV_2)
r_if
c_cond
(paren
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
op_logical_and
(paren
id|ScamFlg
op_amp
id|SCAM_LEVEL2
)paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|scarb
c_func
(paren
id|p_port
comma
id|INIT_SELTD
)paren
)paren
)paren
(brace
)brace
id|scsel
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_do
(brace
id|scxferc
c_func
(paren
id|p_port
comma
id|SYNC_PTRN
)paren
suffix:semicolon
id|scxferc
c_func
(paren
id|p_port
comma
id|DOM_MSTR
)paren
suffix:semicolon
id|loser
op_assign
id|scsendi
c_func
(paren
id|p_port
comma
op_amp
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|loser
op_eq
l_int|0xFF
)paren
suffix:semicolon
id|scbusf
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p_power_up
)paren
op_logical_and
(paren
op_logical_neg
id|loser
)paren
)paren
(brace
id|sresb
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
id|Wait
c_func
(paren
id|p_port
comma
id|TO_250ms
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|scarb
c_func
(paren
id|p_port
comma
id|INIT_SELTD
)paren
)paren
)paren
(brace
)brace
id|scsel
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_do
(brace
id|scxferc
c_func
(paren
id|p_port
comma
id|SYNC_PTRN
)paren
suffix:semicolon
id|scxferc
c_func
(paren
id|p_port
comma
id|DOM_MSTR
)paren
suffix:semicolon
id|loser
op_assign
id|scsendi
c_func
(paren
id|p_port
comma
op_amp
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|loser
op_eq
l_int|0xFF
)paren
suffix:semicolon
id|scbusf
c_func
(paren
id|p_port
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|loser
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|loser
)paren
(brace
macro_line|#endif  /* SCAM_LEV_2 */
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|state
op_assign
id|ID_ASSIGNED
suffix:semicolon
r_if
c_cond
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_eq
id|ID_UNASSIGNED
)paren
op_logical_or
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_eq
id|ID_UNUSED
)paren
)paren
(brace
r_if
c_cond
(paren
id|scsell
c_func
(paren
id|p_port
comma
id|i
)paren
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|LEGACY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_ne
l_int|0xFF
)paren
op_logical_or
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|1
)braket
op_ne
l_int|0xFA
)paren
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|1
)braket
op_assign
l_int|0xFA
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
op_eq
l_int|NULL
)paren
(brace
id|currCard-&gt;globalFlags
op_or_assign
id|F_UPDATE_EEPROM
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|sresb
c_func
(paren
id|p_port
comma
id|p_card
)paren
suffix:semicolon
id|Wait1Second
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|scarb
c_func
(paren
id|p_port
comma
id|INIT_SELTD
)paren
)paren
)paren
(brace
)brace
id|scsel
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|scasid
c_func
(paren
id|p_card
comma
id|p_port
)paren
suffix:semicolon
)brace
macro_line|#if defined(SCAM_LEV_2)
)brace
r_else
r_if
c_cond
(paren
(paren
id|loser
)paren
op_logical_and
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
)paren
(brace
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_assign
id|SLV_TYPE_CODE0
suffix:semicolon
id|assigned_id
op_assign
id|FALSE
suffix:semicolon
id|scwtsel
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_do
(brace
r_while
c_loop
(paren
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0x00
)paren
op_ne
id|SYNC_PTRN
)paren
(brace
)brace
id|i
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|ASSIGN_ID
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|scsendi
c_func
(paren
id|p_port
comma
op_amp
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
)paren
)paren
)paren
(brace
id|i
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scvalq
c_func
(paren
id|i
)paren
)paren
(brace
id|k
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scvalq
c_func
(paren
id|k
)paren
)paren
(brace
id|currCard-&gt;ourId
op_assign
(paren
(paren
id|UCHAR
)paren
(paren
id|i
op_lshift
l_int|3
)paren
op_plus
(paren
id|k
op_amp
(paren
id|UCHAR
)paren
l_int|7
)paren
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x3F
suffix:semicolon
id|inisci
c_func
(paren
id|p_card
comma
id|p_port
comma
id|p_our_id
)paren
suffix:semicolon
id|scamInfo
(braket
id|currCard-&gt;ourId
)braket
dot
id|state
op_assign
id|ID_ASSIGNED
suffix:semicolon
id|scamInfo
(braket
id|currCard-&gt;ourId
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_assign
id|SLV_TYPE_CODE0
suffix:semicolon
id|assigned_id
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|i
op_eq
id|SET_P_FLAG
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|scsendi
c_func
(paren
id|p_port
comma
op_amp
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
)paren
)paren
)paren
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_or_assign
l_int|0x80
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
id|assigned_id
)paren
suffix:semicolon
r_while
c_loop
(paren
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0x00
)paren
op_ne
id|CFG_CMPLT
)paren
(brace
)brace
)brace
macro_line|#endif   /* SCAM_LEV_2 */
r_if
c_cond
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
(brace
id|scbusf
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currCard-&gt;globalFlags
op_amp
id|F_UPDATE_EEPROM
)paren
(brace
id|scsavdi
c_func
(paren
id|p_card
comma
id|p_port
)paren
suffix:semicolon
id|currCard-&gt;globalFlags
op_and_assign
op_complement
id|F_UPDATE_EEPROM
suffix:semicolon
)brace
)brace
macro_line|#if defined(DOS)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
op_logical_and
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_eq
id|LEGACY
)paren
)paren
op_logical_or
(paren
id|i
op_ne
id|p_our_id
)paren
)paren
(brace
id|scsellDOS
c_func
(paren
id|p_port
comma
id|i
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n;   for (i=0,k=0; i &lt; MAX_SCSI_TAR; i++)&n;      {&n;      if ((scamInfo[i].state == ID_ASSIGNED) ||&n;         (scamInfo[i].state == LEGACY))&n;         k++;&n;      }&n;&n;   if (k==2)&n;      currCard-&gt;globalFlags |= F_SINGLE_DEVICE;&n;   else&n;      currCard-&gt;globalFlags &amp;= ~F_SINGLE_DEVICE;&n;*/
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scarb&n; *&n; * Description: Gain control of the bus and wait SCAM select time (250ms)&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scarb
r_int
id|scarb
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_sel_type
)paren
macro_line|#else
r_int
id|scarb
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_sel_type
)paren
macro_line|#endif
(brace
r_if
c_cond
(paren
id|p_sel_type
op_eq
id|INIT_SELTD
)paren
(brace
r_while
c_loop
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
(paren
id|SCSI_SEL
op_or
id|SCSI_BSY
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_SEL
)paren
r_return
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_ne
l_int|00
)paren
r_return
id|FALSE
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_or
id|SCSI_BSY
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_SEL
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
op_complement
id|SCSI_BSY
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_or
id|SCSI_SEL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_ne
l_int|00
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
op_complement
(paren
id|SCSI_BSY
op_or
id|SCSI_SEL
)paren
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
)paren
op_amp
op_complement
id|ACTdeassert
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsireset
comma
id|SCAM_EN
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#if defined(WIDE_SCSI)
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_1
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#endif
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
id|SCSI_BUS_EN
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_or
id|SCSI_MSG
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
op_complement
id|SCSI_BSY
)paren
)paren
suffix:semicolon
id|Wait
c_func
(paren
id|p_port
comma
id|TO_250ms
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scbusf&n; *&n; * Description: Release the SCSI bus and disable SCAM selection.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scbusf
r_void
id|scbusf
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|scbusf
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_or
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
)paren
op_amp
op_complement
id|SCSI_BUS_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsireset
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsireset
)paren
op_amp
op_complement
id|SCAM_EN
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
)paren
op_or
id|ACTdeassert
)paren
)paren
suffix:semicolon
macro_line|#if defined(SCAM_LEV_2)
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|AUTO_INT
op_or
id|SCAM_SEL
)paren
)paren
suffix:semicolon
macro_line|#else
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|BUS_FREE
op_or
id|AUTO_INT
)paren
)paren
suffix:semicolon
macro_line|#endif
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scasid&n; *&n; * Description: Assign an ID to all the SCAM devices.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scasid
r_void
id|scasid
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|scasid
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
macro_line|#if defined(DOS) || defined(OS2)
multiline_comment|/* Use external defined in global space area, instead of Stack&n;      space. WIN/95 DOS doesnot work TINY mode. The OS doesnot intialize&n;      SS equal to DS. Thus the array allocated on stack doesnot get&n;      access correctly */
macro_line|#else
id|UCHAR
id|temp_id_string
(braket
id|ID_STRING_LENGTH
)braket
suffix:semicolon
macro_line|#endif
id|UCHAR
id|i
comma
id|k
comma
id|scam_id
suffix:semicolon
id|UCHAR
id|crcBytes
(braket
l_int|3
)braket
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|ushort_ptr
id|pCrcBytes
suffix:semicolon
id|pCurrNvRam
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|pNvRamInfo
suffix:semicolon
id|i
op_assign
id|FALSE
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|i
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|temp_id_string
(braket
id|k
)braket
op_assign
(paren
id|UCHAR
)paren
l_int|0x00
suffix:semicolon
)brace
id|scxferc
c_func
(paren
id|p_port
comma
id|SYNC_PTRN
)paren
suffix:semicolon
id|scxferc
c_func
(paren
id|p_port
comma
id|ASSIGN_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sciso
c_func
(paren
id|p_port
comma
op_amp
id|temp_id_string
(braket
l_int|0
)braket
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
id|pCrcBytes
op_assign
(paren
id|ushort_ptr
)paren
op_amp
id|crcBytes
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|pCrcBytes
op_assign
id|CalcCrc16
c_func
(paren
op_amp
id|temp_id_string
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|crcBytes
(braket
l_int|2
)braket
op_assign
id|CalcLrc
c_func
(paren
op_amp
id|temp_id_string
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|temp_id_string
(braket
l_int|1
)braket
op_assign
id|crcBytes
(braket
l_int|2
)braket
suffix:semicolon
id|temp_id_string
(braket
l_int|2
)braket
op_assign
id|crcBytes
(braket
l_int|0
)braket
suffix:semicolon
id|temp_id_string
(braket
l_int|3
)braket
op_assign
id|crcBytes
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|4
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|temp_id_string
(braket
id|k
)braket
op_assign
(paren
id|UCHAR
)paren
l_int|0x00
suffix:semicolon
)brace
)brace
id|i
op_assign
id|scmachid
c_func
(paren
id|p_card
comma
id|temp_id_string
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CLR_PRIORITY
)paren
(brace
id|scxferc
c_func
(paren
id|p_port
comma
id|MISC_CODE
)paren
suffix:semicolon
id|scxferc
c_func
(paren
id|p_port
comma
id|CLR_P_FLAG
)paren
suffix:semicolon
id|i
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*Not the last ID yet. */
)brace
r_else
r_if
c_cond
(paren
id|i
op_ne
id|NO_ID_AVAIL
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|8
)paren
id|scxferc
c_func
(paren
id|p_port
comma
id|ID_0_7
)paren
suffix:semicolon
r_else
id|scxferc
c_func
(paren
id|p_port
comma
id|ID_8_F
)paren
suffix:semicolon
id|scam_id
op_assign
(paren
id|i
op_amp
(paren
id|UCHAR
)paren
l_int|0x07
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|1
suffix:semicolon
id|k
OL
l_int|0x08
suffix:semicolon
id|k
op_lshift_assign
l_int|1
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|k
op_amp
id|i
)paren
)paren
id|scam_id
op_add_assign
l_int|0x08
suffix:semicolon
multiline_comment|/*Count number of zeros in DB0-3. */
id|scxferc
c_func
(paren
id|p_port
comma
id|scam_id
)paren
suffix:semicolon
id|i
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*Not the last ID yet. */
)brace
)brace
r_else
(brace
id|i
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
multiline_comment|/*End while */
id|scxferc
c_func
(paren
id|p_port
comma
id|SYNC_PTRN
)paren
suffix:semicolon
id|scxferc
c_func
(paren
id|p_port
comma
id|CFG_CMPLT
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scsel&n; *&n; * Description: Select all the SCAM devices.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scsel
r_void
id|scsel
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|scsel
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
id|SCSI_SEL
)paren
suffix:semicolon
id|scwiros
c_func
(paren
id|p_port
comma
id|SCSI_MSG
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_SEL
op_or
id|SCSI_BSY
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_SEL
op_or
id|SCSI_BSY
op_or
id|SCSI_IOBIT
op_or
id|SCSI_CD
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_or
(paren
id|UCHAR
)paren
(paren
id|BIT
c_func
(paren
l_int|7
)paren
op_plus
id|BIT
c_func
(paren
l_int|6
)paren
)paren
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_BSY
op_or
id|SCSI_IOBIT
op_or
id|SCSI_CD
)paren
)paren
suffix:semicolon
id|scwiros
c_func
(paren
id|p_port
comma
id|SCSI_SEL
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_amp
op_complement
(paren
id|UCHAR
)paren
id|BIT
c_func
(paren
l_int|6
)paren
)paren
)paren
suffix:semicolon
id|scwirod
c_func
(paren
id|p_port
comma
id|BIT
c_func
(paren
l_int|6
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_SEL
op_or
id|SCSI_BSY
op_or
id|SCSI_IOBIT
op_or
id|SCSI_CD
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scxferc&n; *&n; * Description: Handshake the p_data (DB4-0) across the bus.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scxferc
id|UCHAR
id|scxferc
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data
)paren
macro_line|#else
id|UCHAR
id|scxferc
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data
)paren
macro_line|#endif
(brace
id|UCHAR
id|curr_data
comma
id|ret_data
suffix:semicolon
id|curr_data
op_assign
id|p_data
op_or
id|BIT
c_func
(paren
l_int|7
)paren
op_or
id|BIT
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/*Start with DB7 &amp; DB5 asserted. */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|curr_data
op_and_assign
op_complement
id|BIT
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|scwirod
c_func
(paren
id|p_port
comma
id|BIT
c_func
(paren
l_int|7
)paren
)paren
suffix:semicolon
multiline_comment|/*Wait for DB7 to be released. */
r_while
c_loop
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_amp
id|BIT
c_func
(paren
l_int|5
)paren
)paren
)paren
suffix:semicolon
id|ret_data
op_assign
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_amp
(paren
id|UCHAR
)paren
l_int|0x1F
)paren
suffix:semicolon
id|curr_data
op_or_assign
id|BIT
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|curr_data
op_and_assign
op_complement
id|BIT
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|scwirod
c_func
(paren
id|p_port
comma
id|BIT
c_func
(paren
l_int|5
)paren
)paren
suffix:semicolon
multiline_comment|/*Wait for DB5 to be released. */
id|curr_data
op_and_assign
op_complement
(paren
id|BIT
c_func
(paren
l_int|4
)paren
op_or
id|BIT
c_func
(paren
l_int|3
)paren
op_or
id|BIT
c_func
(paren
l_int|2
)paren
op_or
id|BIT
c_func
(paren
l_int|1
)paren
op_or
id|BIT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/*Release data bits */
id|curr_data
op_or_assign
id|BIT
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|curr_data
op_and_assign
op_complement
id|BIT
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
comma
id|curr_data
)paren
suffix:semicolon
id|scwirod
c_func
(paren
id|p_port
comma
id|BIT
c_func
(paren
l_int|6
)paren
)paren
suffix:semicolon
multiline_comment|/*Wait for DB6 to be released. */
r_return
id|ret_data
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scsendi&n; *&n; * Description: Transfer our Identification string to determine if we&n; *              will be the dominant master.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scsendi
id|UCHAR
id|scsendi
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
macro_line|#else
id|UCHAR
id|scsendi
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
macro_line|#endif
(brace
id|UCHAR
id|ret_data
comma
id|byte_cnt
comma
id|bit_cnt
comma
id|defer
suffix:semicolon
id|defer
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|byte_cnt
op_assign
l_int|0
suffix:semicolon
id|byte_cnt
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|byte_cnt
op_increment
)paren
(brace
r_for
c_loop
(paren
id|bit_cnt
op_assign
l_int|0x80
suffix:semicolon
id|bit_cnt
op_ne
l_int|0
suffix:semicolon
id|bit_cnt
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|defer
)paren
id|ret_data
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|00
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p_id_string
(braket
id|byte_cnt
)braket
op_amp
id|bit_cnt
)paren
id|ret_data
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|02
)paren
suffix:semicolon
r_else
(brace
id|ret_data
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret_data
op_amp
l_int|02
)paren
id|defer
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret_data
op_amp
l_int|0x1C
)paren
op_eq
l_int|0x10
)paren
r_return
l_int|0x00
suffix:semicolon
multiline_comment|/*End of isolation stage, we won! */
r_if
c_cond
(paren
id|ret_data
op_amp
l_int|0x1C
)paren
r_return
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
(paren
id|defer
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|ret_data
op_amp
l_int|0x1F
)paren
)paren
)paren
r_return
l_int|0x01
suffix:semicolon
multiline_comment|/*End of isolation stage, we lost. */
)brace
multiline_comment|/*bit loop */
)brace
multiline_comment|/*byte loop */
r_if
c_cond
(paren
id|defer
)paren
r_return
l_int|0x01
suffix:semicolon
multiline_comment|/*We lost */
r_else
r_return
l_int|0
suffix:semicolon
multiline_comment|/*We WON! Yeeessss! */
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: sciso&n; *&n; * Description: Transfer the Identification string.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|sciso
id|UCHAR
id|sciso
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
macro_line|#else
id|UCHAR
id|sciso
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
macro_line|#endif
(brace
id|UCHAR
id|ret_data
comma
id|the_data
comma
id|byte_cnt
comma
id|bit_cnt
suffix:semicolon
id|the_data
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|byte_cnt
op_assign
l_int|0
suffix:semicolon
id|byte_cnt
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|byte_cnt
op_increment
)paren
(brace
r_for
c_loop
(paren
id|bit_cnt
op_assign
l_int|0
suffix:semicolon
id|bit_cnt
OL
l_int|8
suffix:semicolon
id|bit_cnt
op_increment
)paren
(brace
id|ret_data
op_assign
id|scxferc
c_func
(paren
id|p_port
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret_data
op_amp
l_int|0xFC
)paren
r_return
l_int|0xFF
suffix:semicolon
r_else
(brace
id|the_data
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ret_data
op_amp
id|BIT
c_func
(paren
l_int|1
)paren
)paren
(brace
id|the_data
op_or_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|ret_data
op_amp
l_int|0x1F
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;if(bit_cnt != 0 || bit_cnt != 8)&n;&t;&t;&t;&t;{&n;&t;&t;&t;&t;&t;byte_cnt = 0;&n;&t;&t;&t;&t;&t;bit_cnt = 0;&n;&t;&t;&t;&t;&t;scxferc(p_port, SYNC_PTRN);&n;&t;&t;&t;&t;&t;scxferc(p_port, ASSIGN_ID);&n;&t;&t;&t;&t;&t;continue;&n;&t;&t;&t;&t;}&n;*/
r_if
c_cond
(paren
id|byte_cnt
)paren
r_return
l_int|0x00
suffix:semicolon
r_else
r_return
l_int|0xFF
suffix:semicolon
)brace
)brace
multiline_comment|/*bit loop */
id|p_id_string
(braket
id|byte_cnt
)braket
op_assign
id|the_data
suffix:semicolon
)brace
multiline_comment|/*byte loop */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scwirod&n; *&n; * Description: Sample the SCSI data bus making sure the signal has been&n; *              deasserted for the correct number of consecutive samples.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scwirod
r_void
id|scwirod
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
macro_line|#else
r_void
id|scwirod
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|MAX_SCSI_TAR
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsidata_0
)paren
op_amp
id|p_data_bit
)paren
id|i
op_assign
l_int|0
suffix:semicolon
r_else
id|i
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scwiros&n; *&n; * Description: Sample the SCSI Signal lines making sure the signal has been&n; *              deasserted for the correct number of consecutive samples.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scwiros
r_void
id|scwiros
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
macro_line|#else
r_void
id|scwiros
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_data_bit
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|MAX_SCSI_TAR
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|p_data_bit
)paren
id|i
op_assign
l_int|0
suffix:semicolon
r_else
id|i
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scvalq&n; *&n; * Description: Make sure we received a valid data byte.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|scvalq
id|UCHAR
id|scvalq
c_func
(paren
id|UCHAR
id|p_quintet
)paren
(brace
id|UCHAR
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|1
suffix:semicolon
id|count
OL
l_int|0x08
suffix:semicolon
id|count
op_lshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p_quintet
op_amp
id|count
)paren
)paren
id|p_quintet
op_sub_assign
l_int|0x80
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_quintet
op_amp
l_int|0x18
)paren
r_return
id|FALSE
suffix:semicolon
r_else
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scsell&n; *&n; * Description: Select the specified device ID using a selection timeout&n; *              less than 4ms.  If somebody responds then it is a legacy&n; *              drive and this ID must be marked as such.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scsell
id|UCHAR
id|scsell
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|targ_id
)paren
macro_line|#else
id|UCHAR
id|scsell
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|targ_id
)paren
macro_line|#endif
(brace
macro_line|#if defined(DOS)
id|USHORT
id|i
suffix:semicolon
macro_line|#else
id|ULONG
id|i
suffix:semicolon
macro_line|#endif
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_or
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
)paren
op_or
id|SCAM_TIMER
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|TO_4ms
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p_port
op_plus
id|CMD_STRT
suffix:semicolon
id|i
OL
id|p_port
op_plus
id|CMD_STRT
op_plus
l_int|12
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|WRW_HARPOON
c_func
(paren
id|i
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
)paren
)paren
suffix:semicolon
)brace
id|WRW_HARPOON
c_func
(paren
id|i
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|RESET
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
op_or
id|AUTO_INT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_select_id
comma
id|targ_id
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_or
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsictrl_0
comma
(paren
id|SEL_TAR
op_or
id|ENA_RESEL
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|RESET
op_or
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|AUTO_INT
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|RESET
)paren
id|Wait
c_func
(paren
id|p_port
comma
id|TO_250ms
)paren
suffix:semicolon
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
)paren
op_amp
op_complement
id|SCAM_TIMER
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|TO_290ms
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|RESET
op_or
id|TIMEOUT
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|RESET
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
op_or
id|PHASE
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
multiline_comment|/*No legacy device */
)brace
r_else
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|p_port
)paren
suffix:semicolon
)brace
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT_1
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
multiline_comment|/*Found one of them oldies! */
)brace
)brace
macro_line|#if defined(DOS)
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scsell for DOS&n; *&n; * Description: Select the specified device ID using a selection timeout&n; *              less than 2ms.  This was specially required to solve&n; *              the problem with Plextor 12X CD-ROM drive. This drive&n; *&t;&t;&t;&t;&t; was responding the Selection at the end of 4ms and &n; *&t;&t;&t;&t;&t; hanging the system.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|scsellDOS
id|UCHAR
id|scsellDOS
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|targ_id
)paren
(brace
id|USHORT
id|i
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_or
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
id|ARAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
)paren
op_or
id|SCAM_TIMER
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|TO_2ms
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p_port
op_plus
id|CMD_STRT
suffix:semicolon
id|i
OL
id|p_port
op_plus
id|CMD_STRT
op_plus
l_int|12
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|WRW_HARPOON
c_func
(paren
id|i
comma
(paren
id|MPM_OP
op_plus
id|ACOMMAND
)paren
)paren
suffix:semicolon
)brace
id|WRW_HARPOON
c_func
(paren
id|i
comma
(paren
id|BRH_OP
op_plus
id|ALWAYS
op_plus
id|NP
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|RESET
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
op_or
id|AUTO_INT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_select_id
comma
id|targ_id
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
id|SCSI_PORT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_autostart_3
comma
(paren
id|SELECT
op_or
id|CMD_ONLY_STRT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsictrl_0
comma
(paren
id|SEL_TAR
op_or
id|ENA_RESEL
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|RESET
op_or
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|AUTO_INT
)paren
)paren
)paren
(brace
)brace
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|RESET
)paren
id|Wait
c_func
(paren
id|p_port
comma
id|TO_250ms
)paren
suffix:semicolon
id|DISABLE_AUTO
c_func
(paren
id|p_port
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_addstat
)paren
op_amp
op_complement
id|SCAM_TIMER
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|TO_290ms
)paren
suffix:semicolon
id|SGRAM_ACCESS
c_func
(paren
id|p_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
(paren
id|RESET
op_or
id|TIMEOUT
)paren
)paren
(brace
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
(paren
id|RESET
op_or
id|TIMEOUT
op_or
id|SEL
op_or
id|BUS_FREE
op_or
id|PHASE
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
multiline_comment|/*No legacy device */
)brace
r_else
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|BUS_FREE
)paren
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
)paren
op_amp
id|SCSI_REQ
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsisig
comma
(paren
id|SCSI_ACK
op_plus
id|S_ILL_PH
)paren
)paren
suffix:semicolon
id|ACCEPT_MSG
c_func
(paren
id|p_port
)paren
suffix:semicolon
)brace
)brace
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT_1
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
multiline_comment|/*Found one of them oldies! */
)brace
)brace
macro_line|#endif  /* DOS */
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scwtsel&n; *&n; * Description: Wait to be selected by another SCAM initiator.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scwtsel
r_void
id|scwtsel
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|scwtsel
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|SCAM_SEL
)paren
)paren
(brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: inisci&n; *&n; * Description: Setup the data Structure with the info from the EEPROM.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|inisci
r_void
id|inisci
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
comma
id|UCHAR
id|p_our_id
)paren
macro_line|#else
r_void
id|inisci
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
comma
id|UCHAR
id|p_our_id
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
comma
id|k
comma
id|max_id
suffix:semicolon
id|USHORT
id|ee_data
suffix:semicolon
id|PNVRamInfo
id|pCurrNvRam
suffix:semicolon
id|pCurrNvRam
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|pNvRamInfo
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|max_id
op_assign
l_int|0x08
suffix:semicolon
r_else
id|max_id
op_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|pCurrNvRam
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_id
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|4
suffix:semicolon
id|k
op_increment
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
id|pCurrNvRam-&gt;niScamTbl
(braket
id|i
)braket
(braket
id|k
)braket
suffix:semicolon
)brace
r_for
c_loop
(paren
id|k
op_assign
l_int|4
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
(paren
id|UCHAR
)paren
l_int|0x00
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|ID_UNUSED
suffix:semicolon
)brace
multiline_comment|/*Default to unused ID. */
r_else
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|ID_UNASSIGNED
suffix:semicolon
multiline_comment|/*Default to unassigned ID. */
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_id
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_add_assign
l_int|2
)paren
(brace
id|ee_data
op_assign
id|utilEERead
c_func
(paren
id|p_port
comma
(paren
id|USHORT
)paren
(paren
(paren
id|EE_SCAMBASE
op_div
l_int|2
)paren
op_plus
(paren
id|USHORT
)paren
(paren
id|i
op_star
(paren
(paren
id|USHORT
)paren
id|ID_STRING_LENGTH
op_div
l_int|2
)paren
)paren
op_plus
(paren
id|USHORT
)paren
(paren
id|k
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
(paren
id|UCHAR
)paren
id|ee_data
suffix:semicolon
id|ee_data
op_rshift_assign
l_int|8
suffix:semicolon
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
op_plus
l_int|1
)braket
op_assign
(paren
id|UCHAR
)paren
id|ee_data
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
op_logical_or
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_eq
l_int|0xFF
)paren
)paren
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|ID_UNUSED
suffix:semicolon
multiline_comment|/*Default to unused ID. */
r_else
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|ID_UNASSIGNED
suffix:semicolon
multiline_comment|/*Default to unassigned ID. */
)brace
)brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|scamInfo
(braket
id|p_our_id
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
id|scamHAString
(braket
id|k
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scmachid&n; *&n; * Description: Match the Device ID string with our values stored in&n; *              the EEPROM.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|scmachid
id|UCHAR
id|scmachid
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|p_id_string
(braket
)braket
)paren
(brace
id|UCHAR
id|i
comma
id|k
comma
id|match
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SCSI_TAR
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#if !defined(SCAM_LEV_2)
r_if
c_cond
(paren
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_eq
id|ID_UNASSIGNED
)paren
(brace
macro_line|#endif
id|match
op_assign
id|TRUE
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p_id_string
(braket
id|k
)braket
op_ne
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
)braket
)paren
id|match
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|match
)paren
(brace
id|scamInfo
(braket
id|i
)braket
dot
id|state
op_assign
id|ID_ASSIGNED
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
macro_line|#if !defined(SCAM_LEV_2)
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
id|BIT
c_func
(paren
l_int|5
)paren
)paren
id|i
op_assign
l_int|8
suffix:semicolon
r_else
id|i
op_assign
id|MAX_SCSI_TAR
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
l_int|0x06
)paren
op_eq
l_int|0x02
)paren
op_logical_or
(paren
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
l_int|0x06
)paren
op_eq
l_int|0x04
)paren
)paren
id|match
op_assign
id|p_id_string
(braket
l_int|1
)braket
op_amp
(paren
id|UCHAR
)paren
l_int|0x1F
suffix:semicolon
r_else
id|match
op_assign
l_int|7
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|i
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|scamInfo
(braket
id|match
)braket
dot
id|state
op_eq
id|ID_UNUSED
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|scamInfo
(braket
id|match
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
id|p_id_string
(braket
id|k
)braket
suffix:semicolon
)brace
id|scamInfo
(braket
id|match
)braket
dot
id|state
op_assign
id|ID_ASSIGNED
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|pNvRamInfo
op_eq
l_int|NULL
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_UPDATE_EEPROM
suffix:semicolon
)brace
r_return
id|match
suffix:semicolon
)brace
id|match
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|match
op_eq
l_int|0xFF
)paren
(brace
r_if
c_cond
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
id|BIT
c_func
(paren
l_int|5
)paren
)paren
id|match
op_assign
l_int|7
suffix:semicolon
r_else
id|match
op_assign
id|MAX_SCSI_TAR
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
id|BIT
c_func
(paren
l_int|7
)paren
)paren
(brace
r_return
id|CLR_PRIORITY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
id|BIT
c_func
(paren
l_int|5
)paren
)paren
id|i
op_assign
l_int|8
suffix:semicolon
r_else
id|i
op_assign
id|MAX_SCSI_TAR
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
l_int|0x06
)paren
op_eq
l_int|0x02
)paren
op_logical_or
(paren
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
l_int|0x06
)paren
op_eq
l_int|0x04
)paren
)paren
id|match
op_assign
id|p_id_string
(braket
l_int|1
)braket
op_amp
(paren
id|UCHAR
)paren
l_int|0x1F
suffix:semicolon
r_else
id|match
op_assign
l_int|7
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|i
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|scamInfo
(braket
id|match
)braket
dot
id|state
op_eq
id|ID_UNASSIGNED
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_increment
)paren
(brace
id|scamInfo
(braket
id|match
)braket
dot
id|id_string
(braket
id|k
)braket
op_assign
id|p_id_string
(braket
id|k
)braket
suffix:semicolon
)brace
id|scamInfo
(braket
id|match
)braket
dot
id|id_string
(braket
l_int|0
)braket
op_or_assign
id|BIT
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|scamInfo
(braket
id|match
)braket
dot
id|state
op_assign
id|ID_ASSIGNED
suffix:semicolon
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|pNvRamInfo
op_eq
l_int|NULL
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_or_assign
id|F_UPDATE_EEPROM
suffix:semicolon
)brace
r_return
id|match
suffix:semicolon
)brace
id|match
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|match
op_eq
l_int|0xFF
)paren
(brace
r_if
c_cond
(paren
id|p_id_string
(braket
l_int|0
)braket
op_amp
id|BIT
c_func
(paren
l_int|5
)paren
)paren
id|match
op_assign
l_int|7
suffix:semicolon
r_else
id|match
op_assign
id|MAX_SCSI_TAR
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|NO_ID_AVAIL
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: scsavdi&n; *&n; * Description: Save off the device SCAM ID strings.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|scsavdi
r_void
id|scsavdi
c_func
(paren
id|UCHAR
id|p_card
comma
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|scsavdi
c_func
(paren
id|UCHAR
id|p_card
comma
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
comma
id|k
comma
id|max_id
suffix:semicolon
id|USHORT
id|ee_data
comma
id|sum_data
suffix:semicolon
id|sum_data
op_assign
l_int|0x0000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|EE_SCAMBASE
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sum_data
op_add_assign
id|utilEERead
c_func
(paren
id|p_port
comma
id|i
)paren
suffix:semicolon
)brace
id|utilEEWriteOnOff
c_func
(paren
id|p_port
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable write access to the EEPROM */
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|max_id
op_assign
l_int|0x08
suffix:semicolon
r_else
id|max_id
op_assign
l_int|0x10
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_id
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|k
op_add_assign
l_int|2
)paren
(brace
id|ee_data
op_assign
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
op_plus
l_int|1
)braket
suffix:semicolon
id|ee_data
op_lshift_assign
l_int|8
suffix:semicolon
id|ee_data
op_or_assign
id|scamInfo
(braket
id|i
)braket
dot
id|id_string
(braket
id|k
)braket
suffix:semicolon
id|sum_data
op_add_assign
id|ee_data
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
id|ee_data
comma
(paren
id|USHORT
)paren
(paren
(paren
id|EE_SCAMBASE
op_div
l_int|2
)paren
op_plus
(paren
id|USHORT
)paren
(paren
id|i
op_star
(paren
(paren
id|USHORT
)paren
id|ID_STRING_LENGTH
op_div
l_int|2
)paren
)paren
op_plus
(paren
id|USHORT
)paren
(paren
id|k
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
id|utilEEWrite
c_func
(paren
id|p_port
comma
id|sum_data
comma
id|EEPROM_CHECK_SUM
op_div
l_int|2
)paren
suffix:semicolon
id|utilEEWriteOnOff
c_func
(paren
id|p_port
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Turn off write access */
)brace
macro_line|#ident &quot;$Id: diagnose.c 1.10 1997/06/10 16:51:47 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   diagnose.c  $&n; *&n; *   Description:  Diagnostic funtions for testing the integrity of&n; *                 the HARPOON.&n; *&n; *   $Date: 1997/06/10 16:51:47 $&n; *&n; *   $Revision: 1.10 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;eeprom.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: XbowInit&n; *&n; * Description: Setup the Xbow for normal operation.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|XbowInit
r_void
id|XbowInit
c_func
(paren
id|USHORT
id|port
comma
id|UCHAR
id|ScamFlg
)paren
macro_line|#else
r_void
id|XbowInit
c_func
(paren
id|ULONG
id|port
comma
id|UCHAR
id|ScamFlg
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
suffix:semicolon
id|i
op_assign
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
(paren
id|UCHAR
)paren
(paren
id|i
op_or
id|G_INT_DISABLE
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsireset
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_1
comma
id|HOST_MODE8
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsireset
comma
(paren
id|DMA_RESET
op_or
id|HPSCSI_RESET
op_or
id|PROG_RESET
op_or
"&bslash;"
id|FIFO_CLR
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsireset
comma
id|SCSI_INI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsisig
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*  Clear any signals we might */
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_scsictrl_0
comma
id|ENA_SCAM_SEL
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT
)paren
suffix:semicolon
macro_line|#if defined(SCAM_LEV_2)
id|default_intena
op_assign
id|RESET
op_or
id|RSEL
op_or
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|BUS_FREE
op_or
id|XFER_CNT_0
op_or
id|AUTO_INT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ScamFlg
op_amp
id|SCAM_ENABLED
)paren
op_logical_and
(paren
id|ScamFlg
op_amp
id|SCAM_LEVEL2
)paren
)paren
id|default_intena
op_or_assign
id|SCAM_SEL
suffix:semicolon
macro_line|#else
id|default_intena
op_assign
id|RESET
op_or
id|RSEL
op_or
id|PROG_HLT
op_or
id|TIMEOUT
op_or
id|BUS_FREE
op_or
id|XFER_CNT_0
op_or
id|AUTO_INT
suffix:semicolon
macro_line|#endif
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intena
)paren
comma
id|default_intena
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
comma
id|TO_290ms
)paren
suffix:semicolon
multiline_comment|/* Turn on SCSI_MODE8 for narrow cards to fix the&n;      strapping issue with the DUAL CHANNEL card */
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_addstat
comma
id|SCSI_MODE8
)paren
suffix:semicolon
macro_line|#if defined(NO_BIOS_OPTION)
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_0
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_1
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_2
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_3
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_4
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_5
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_6
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_7
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_8
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_9
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_10
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_11
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_12
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_13
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_14
comma
id|NARROW_SCSI
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_synctarg_15
comma
id|NARROW_SCSI
)paren
suffix:semicolon
macro_line|#endif
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_page_ctrl
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: BusMasterInit&n; *&n; * Description: Initialize the BusMaster for normal operations.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|BusMasterInit
r_void
id|BusMasterInit
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|BusMasterInit
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sys_ctrl
comma
id|DRVR_RST
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_sys_ctrl
comma
l_int|0x00
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_host_blk_cnt
comma
id|XFER_BLK64
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_bm_ctrl
comma
(paren
id|BMCTRL_DEFAULT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|SCSI_TERM_ENA_H
)paren
)paren
suffix:semicolon
macro_line|#if defined(NT)
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_pci_cmd_cfg
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_pci_cmd_cfg
)paren
op_amp
op_complement
id|MEM_SPACE_ENA
)paren
)paren
suffix:semicolon
macro_line|#endif
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_int_status
)paren
suffix:semicolon
multiline_comment|/*Clear interrupts. */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_int_mask
comma
(paren
id|INT_CMD_COMPL
op_or
id|SCSI_INTERRUPT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
op_complement
id|SCATTER_EN
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: DiagXbow&n; *&n; * Description: Test Xbow integrity.  Non-zero return indicates an error.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|DiagXbow
r_int
id|DiagXbow
c_func
(paren
id|USHORT
id|port
)paren
macro_line|#else
r_int
id|DiagXbow
c_func
(paren
id|ULONG
id|port
)paren
macro_line|#endif
(brace
r_int
r_char
id|fifo_cnt
comma
id|loop_cnt
suffix:semicolon
r_int
r_char
id|fifodata
(braket
l_int|5
)braket
suffix:semicolon
id|fifodata
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|fifodata
(braket
l_int|1
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|fifodata
(braket
l_int|2
)braket
op_assign
l_int|0x55
suffix:semicolon
id|fifodata
(braket
l_int|3
)braket
op_assign
l_int|0xAA
suffix:semicolon
id|fifodata
(braket
l_int|4
)braket
op_assign
l_int|0x00
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intena
)paren
comma
l_int|0x0000
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
comma
id|TO_5ms
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
id|START_TO
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fifodata
(braket
l_int|4
)braket
op_assign
l_int|0x01
suffix:semicolon
id|fifodata
(braket
l_int|4
)braket
op_ne
(paren
id|UCHAR
)paren
l_int|0
suffix:semicolon
id|fifodata
(braket
l_int|4
)braket
op_assign
id|fifodata
(braket
l_int|4
)braket
op_lshift
l_int|1
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_selfid_0
comma
id|fifodata
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_selfid_1
comma
id|fifodata
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_selfid_0
)paren
op_ne
id|fifodata
(braket
l_int|4
)braket
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_selfid_1
)paren
op_ne
id|fifodata
(braket
l_int|4
)braket
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|loop_cnt
op_assign
l_int|0
suffix:semicolon
id|loop_cnt
OL
l_int|4
suffix:semicolon
id|loop_cnt
op_increment
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
(paren
id|HOST_PORT
op_or
id|HOST_WRT
op_or
id|START_TO
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fifo_cnt
op_assign
l_int|0
suffix:semicolon
id|fifo_cnt
OL
id|FIFO_LEN
suffix:semicolon
id|fifo_cnt
op_increment
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifodata_0
comma
id|fifodata
(braket
id|loop_cnt
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_FULL
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_portctrl_0
comma
(paren
id|HOST_PORT
op_or
id|START_TO
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fifo_cnt
op_assign
l_int|0
suffix:semicolon
id|fifo_cnt
OL
id|FIFO_LEN
suffix:semicolon
id|fifo_cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_fifodata_0
)paren
op_ne
id|fifodata
(braket
id|loop_cnt
)braket
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xferstat
)paren
op_amp
id|FIFO_EMPTY
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|TIMEOUT
)paren
)paren
(brace
)brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_seltimeout
comma
id|TO_290ms
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intstat
)paren
comma
id|CLR_ALL_INT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|port
op_plus
id|hp_intena
)paren
comma
id|default_intena
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: DiagBusMaster&n; *&n; * Description: Test BusMaster integrity.  Non-zero return indicates an&n; *              error.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|DiagBusMaster
r_int
id|DiagBusMaster
c_func
(paren
id|USHORT
id|port
)paren
macro_line|#else
r_int
id|DiagBusMaster
c_func
(paren
id|ULONG
id|port
)paren
macro_line|#endif
(brace
id|UCHAR
id|testdata
suffix:semicolon
r_for
c_loop
(paren
id|testdata
op_assign
(paren
id|UCHAR
)paren
l_int|1
suffix:semicolon
id|testdata
op_ne
(paren
id|UCHAR
)paren
l_int|0
suffix:semicolon
id|testdata
op_assign
id|testdata
op_lshift
l_int|1
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_lo
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_mi
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_hi
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_lo
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_lmi
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_hmi
comma
id|testdata
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_hi
comma
id|testdata
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_lo
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_mi
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_xfer_cnt_hi
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_lo
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_lmi
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_hmi
)paren
op_ne
id|testdata
)paren
op_logical_or
(paren
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_host_addr_hi
)paren
op_ne
id|testdata
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|RD_HARPOON
c_func
(paren
id|port
op_plus
id|hp_int_status
)paren
suffix:semicolon
multiline_comment|/*Clear interrupts. */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: DiagEEPROM&n; *&n; * Description: Verfiy checksum and &squot;Key&squot; and initialize the EEPROM if&n; *              neccessary.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|DiagEEPROM
r_void
id|DiagEEPROM
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|DiagEEPROM
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|USHORT
id|index
comma
id|temp
comma
id|max_wd_cnt
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
id|max_wd_cnt
op_assign
id|EEPROM_WD_CNT
suffix:semicolon
r_else
id|max_wd_cnt
op_assign
id|EEPROM_WD_CNT
op_star
l_int|2
suffix:semicolon
id|temp
op_assign
id|utilEERead
c_func
(paren
id|p_port
comma
id|FW_SIGNATURE
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
l_int|0x4641
)paren
(brace
r_for
c_loop
(paren
id|index
op_assign
l_int|2
suffix:semicolon
id|index
OL
id|max_wd_cnt
suffix:semicolon
id|index
op_increment
)paren
(brace
id|temp
op_add_assign
id|utilEERead
c_func
(paren
id|p_port
comma
id|index
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_eq
id|utilEERead
c_func
(paren
id|p_port
comma
id|EEPROM_CHECK_SUM
op_div
l_int|2
)paren
)paren
(brace
r_return
suffix:semicolon
multiline_comment|/*EEPROM is Okay so return now! */
)brace
)brace
id|utilEEWriteOnOff
c_func
(paren
id|p_port
comma
(paren
id|UCHAR
)paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|max_wd_cnt
suffix:semicolon
id|index
op_increment
)paren
(brace
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0000
comma
id|index
)paren
suffix:semicolon
)brace
id|temp
op_assign
l_int|0
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4641
comma
id|FW_SIGNATURE
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4641
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x3920
comma
id|MODEL_NUMB_0
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x3920
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x3033
comma
id|MODEL_NUMB_2
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x3033
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x2020
comma
id|MODEL_NUMB_4
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x2020
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x70D3
comma
id|SYSTEM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x70D3
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0010
comma
id|BIOS_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0010
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0003
comma
id|SCAM_CONFIG
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0003
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0007
comma
id|ADAPTER_SCSI_ID
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0007
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0000
comma
id|IGNORE_B_SCAN
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0000
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0000
comma
id|SEND_START_ENA
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0000
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x0000
comma
id|DEVICE_ENABLE
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x0000
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBL01
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBL23
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBL45
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBL67
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBL89
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBLab
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBLcd
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4242
comma
id|SYNC_RATE_TBLef
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4242
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x6C46
comma
l_int|64
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/*PRODUCT ID */
id|temp
op_add_assign
l_int|0x6C46
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x7361
comma
l_int|66
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/* FlashPoint LT   */
id|temp
op_add_assign
l_int|0x7361
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x5068
comma
l_int|68
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x5068
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x696F
comma
l_int|70
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x696F
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x746E
comma
l_int|72
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x746E
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4C20
comma
l_int|74
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4C20
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x2054
comma
l_int|76
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x2054
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x2020
comma
l_int|78
op_div
l_int|2
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x2020
suffix:semicolon
id|index
op_assign
(paren
(paren
id|EE_SCAMBASE
op_div
l_int|2
)paren
op_plus
(paren
l_int|7
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
(paren
l_int|0x0700
op_plus
id|TYPE_CODE0
)paren
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
(paren
l_int|0x0700
op_plus
id|TYPE_CODE0
)paren
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x5542
comma
id|index
)paren
suffix:semicolon
multiline_comment|/*Vendor ID code */
id|temp
op_add_assign
l_int|0x5542
suffix:semicolon
multiline_comment|/* BUSLOGIC      */
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4C53
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4C53
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x474F
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x474F
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4349
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4349
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x5442
comma
id|index
)paren
suffix:semicolon
multiline_comment|/*Vendor unique code */
id|temp
op_add_assign
l_int|0x5442
suffix:semicolon
multiline_comment|/* BT- 930           */
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x202D
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x202D
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x3339
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x3339
suffix:semicolon
id|index
op_increment
suffix:semicolon
multiline_comment|/*Serial #          */
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x2030
comma
id|index
)paren
suffix:semicolon
multiline_comment|/* 01234567         */
id|temp
op_add_assign
l_int|0x2030
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x5453
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x5453
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x5645
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x5645
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x2045
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x2045
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x202F
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x202F
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x4F4A
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x4F4A
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x204E
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x204E
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
l_int|0x3539
comma
id|index
)paren
suffix:semicolon
id|temp
op_add_assign
l_int|0x3539
suffix:semicolon
id|utilEEWrite
c_func
(paren
id|p_port
comma
id|temp
comma
id|EEPROM_CHECK_SUM
op_div
l_int|2
)paren
suffix:semicolon
id|utilEEWriteOnOff
c_func
(paren
id|p_port
comma
(paren
id|UCHAR
)paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ident &quot;$Id: utility.c 1.23 1997/06/10 16:55:06 mohan Exp $&quot;
multiline_comment|/*----------------------------------------------------------------------&n; *&n; *&n; *   Copyright 1995-1996 by Mylex Corporation.  All Rights Reserved&n; *&n; *   This file is available under both the GNU General Public License&n; *   and a BSD-style copyright; see LICENSE.FlashPoint for details.&n; *&n; *   $Workfile:   utility.c  $&n; *&n; *   Description:  Utility functions relating to queueing and EEPROM&n; *                 manipulation and any other garbage functions.&n; *&n; *   $Date: 1997/06/10 16:55:06 $&n; *&n; *   $Revision: 1.23 $&n; *&n; *----------------------------------------------------------------------*/
multiline_comment|/*#include &lt;globals.h&gt;*/
macro_line|#if (FW_TYPE==_UCB_MGR_)
multiline_comment|/*#include &lt;budi.h&gt;*/
macro_line|#endif
multiline_comment|/*#include &lt;sccbmgr.h&gt;*/
multiline_comment|/*#include &lt;blx30.h&gt;*/
multiline_comment|/*#include &lt;target.h&gt;*/
multiline_comment|/*#include &lt;scsi2.h&gt;*/
multiline_comment|/*#include &lt;harpoon.h&gt;*/
multiline_comment|/*&n;extern SCCBCARD BL_Card[MAX_CARDS];&n;extern SCCBMGR_TAR_INFO sccbMgrTbl[MAX_CARDS][MAX_SCSI_TAR];&n;extern unsigned int SccbGlobalFlags;&n;*/
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Search Select&n; *&n; * Description: Try to find a new command to execute.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueSearchSelect
r_void
id|queueSearchSelect
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
(brace
id|UCHAR
id|scan_ptr
comma
id|lun
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|PSCCB
id|pOldSccb
suffix:semicolon
id|scan_ptr
op_assign
id|pCurrCard-&gt;scanIndex
suffix:semicolon
r_do
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|scan_ptr
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Cnt
op_ne
l_int|0
)paren
(brace
id|scan_ptr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|scan_ptr
op_eq
id|MAX_SCSI_TAR
)paren
id|scan_ptr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|lun
op_assign
l_int|0
suffix:semicolon
id|lun
OL
id|MAX_LUN
suffix:semicolon
id|lun
op_increment
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarLUNBusy
(braket
id|lun
)braket
op_eq
id|FALSE
)paren
(brace
id|pCurrCard-&gt;currentSCCB
op_assign
id|currTar_Info-&gt;TarSelQ_Head
suffix:semicolon
id|pOldSccb
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|lun
op_ne
id|pCurrCard-&gt;currentSCCB-&gt;Lun
)paren
)paren
(brace
id|pOldSccb
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
op_member_access_from_pointer
id|Sccb_forwardlink
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_eq
l_int|NULL
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pOldSccb
op_ne
l_int|NULL
)paren
(brace
id|pOldSccb-&gt;Sccb_forwardlink
op_assign
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
op_member_access_from_pointer
id|Sccb_forwardlink
suffix:semicolon
id|pOldSccb-&gt;Sccb_backlink
op_assign
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
op_member_access_from_pointer
id|Sccb_backlink
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarSelQ_Head
op_assign
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
op_member_access_from_pointer
id|Sccb_forwardlink
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Head
op_eq
l_int|NULL
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarSelQ_Cnt
op_decrement
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Head-&gt;Sccb_backlink
op_assign
(paren
id|PSCCB
)paren
l_int|NULL
suffix:semicolon
)brace
)brace
id|pCurrCard-&gt;scanIndex
op_assign
id|scan_ptr
suffix:semicolon
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|scan_ptr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|scan_ptr
op_eq
id|MAX_SCSI_TAR
)paren
(brace
id|scan_ptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|currTar_Info-&gt;TarSelQ_Cnt
op_ne
l_int|0
)paren
op_logical_and
(paren
id|currTar_Info-&gt;TarLUNBusy
(braket
l_int|0
)braket
op_eq
id|FALSE
)paren
)paren
(brace
id|pCurrCard-&gt;currentSCCB
op_assign
id|currTar_Info-&gt;TarSelQ_Head
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Head
op_assign
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
op_member_access_from_pointer
id|Sccb_forwardlink
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Head
op_eq
l_int|NULL
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarSelQ_Cnt
op_decrement
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Head-&gt;Sccb_backlink
op_assign
(paren
id|PSCCB
)paren
l_int|NULL
suffix:semicolon
)brace
id|scan_ptr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|scan_ptr
op_eq
id|MAX_SCSI_TAR
)paren
id|scan_ptr
op_assign
l_int|0
suffix:semicolon
id|pCurrCard-&gt;scanIndex
op_assign
id|scan_ptr
suffix:semicolon
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|scan_ptr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|scan_ptr
op_eq
id|MAX_SCSI_TAR
)paren
(brace
id|scan_ptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
r_while
c_loop
(paren
id|scan_ptr
op_ne
id|pCurrCard-&gt;scanIndex
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Select Fail&n; *&n; * Description: Add the current SCCB to the head of the Queue.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueSelectFail
r_void
id|queueSelectFail
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|UCHAR
id|p_card
)paren
(brace
id|UCHAR
id|thisTarg
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
r_if
c_cond
(paren
id|pCurrCard-&gt;currentSCCB
op_ne
l_int|NULL
)paren
(brace
id|thisTarg
op_assign
(paren
id|UCHAR
)paren
(paren
(paren
(paren
id|PSCCB
)paren
(paren
id|pCurrCard-&gt;currentSCCB
)paren
)paren
op_member_access_from_pointer
id|TargID
)paren
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|thisTarg
)braket
suffix:semicolon
id|pCurrCard-&gt;currentSCCB-&gt;Sccb_backlink
op_assign
(paren
id|PSCCB
)paren
l_int|NULL
suffix:semicolon
id|pCurrCard-&gt;currentSCCB-&gt;Sccb_forwardlink
op_assign
id|currTar_Info-&gt;TarSelQ_Head
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Cnt
op_eq
l_int|0
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarSelQ_Head-&gt;Sccb_backlink
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
)brace
id|currTar_Info-&gt;TarSelQ_Head
op_assign
id|pCurrCard-&gt;currentSCCB
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Command Complete&n; *&n; * Description: Call the callback function with the current SCCB.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueCmdComplete
r_void
id|queueCmdComplete
c_func
(paren
id|PSCCBcard
id|pCurrCard
comma
id|PSCCB
id|p_sccb
comma
id|UCHAR
id|p_card
)paren
(brace
macro_line|#if (FW_TYPE==_UCB_MGR_)
id|u08bits
id|SCSIcmd
suffix:semicolon
id|CALL_BK_FN
id|callback
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|PUCB
id|p_ucb
suffix:semicolon
id|p_ucb
op_assign
id|p_sccb-&gt;Sccb_ucb_ptr
suffix:semicolon
id|SCSIcmd
op_assign
id|p_sccb-&gt;Cdb
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p_sccb-&gt;Sccb_XferState
op_amp
id|F_ALL_XFERRED
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p_ucb-&gt;UCB_opcode
op_amp
id|OPC_CHK_UNDER_OVER_RUN
)paren
op_logical_and
(paren
id|p_sccb-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
op_logical_and
(paren
id|p_sccb-&gt;TargetStatus
op_ne
id|SSCHECK
)paren
)paren
r_if
c_cond
(paren
(paren
id|SCSIcmd
op_eq
id|SCSI_READ
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_READ_EXTENDED
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE_EXTENDED
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE_AND_VERIFY
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_START_STOP_UNIT
)paren
op_logical_or
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_NO_FILTER
)paren
)paren
id|p_sccb-&gt;HostStatus
op_assign
id|SCCB_DATA_UNDER_RUN
suffix:semicolon
)brace
id|p_ucb-&gt;UCB_status
op_assign
id|SCCB_SUCCESS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p_ucb-&gt;UCB_hbastat
op_assign
id|p_sccb-&gt;HostStatus
)paren
op_logical_or
(paren
id|p_ucb-&gt;UCB_scsistat
op_assign
id|p_sccb-&gt;TargetStatus
)paren
)paren
(brace
id|p_ucb-&gt;UCB_status
op_assign
id|SCCB_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|RESIDUAL_SG_COMMAND
)paren
op_logical_or
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|RESIDUAL_COMMAND
)paren
)paren
(brace
id|utilUpdateResidual
c_func
(paren
id|p_sccb
)paren
suffix:semicolon
id|p_ucb-&gt;UCB_datalen
op_assign
id|p_sccb-&gt;DataLength
suffix:semicolon
)brace
id|pCurrCard-&gt;cmdCounter
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pCurrCard-&gt;cmdCounter
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_GREEN_PC
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_clkctrl_0
comma
(paren
id|PWR_DWN
op_or
id|CLKCTRL_DEFAULT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_sys_ctrl
comma
id|STOP_CLK
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_semaphore
comma
(paren
id|RD_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_semaphore
)paren
op_amp
op_complement
id|SCCB_MGR_ACTIVE
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrCard-&gt;discQCount
op_ne
l_int|0
)paren
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|p_sccb-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p_sccb-&gt;Sccb_tag
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|p_sccb-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_ucb-&gt;UCB_callback
suffix:semicolon
id|callback
c_func
(paren
id|p_ucb
)paren
suffix:semicolon
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#else
id|UCHAR
id|i
comma
id|SCSIcmd
suffix:semicolon
id|CALL_BK_FN
id|callback
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|SCSIcmd
op_assign
id|p_sccb-&gt;Cdb
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p_sccb-&gt;Sccb_XferState
op_amp
id|F_ALL_XFERRED
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p_sccb-&gt;ControlByte
op_amp
(paren
id|SCCB_DATA_XFER_OUT
op_or
id|SCCB_DATA_XFER_IN
)paren
)paren
op_logical_and
(paren
id|p_sccb-&gt;HostStatus
op_eq
id|SCCB_COMPLETE
)paren
op_logical_and
(paren
id|p_sccb-&gt;TargetStatus
op_ne
id|SSCHECK
)paren
)paren
r_if
c_cond
(paren
(paren
id|SCSIcmd
op_eq
id|SCSI_READ
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_READ_EXTENDED
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE_EXTENDED
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_WRITE_AND_VERIFY
)paren
op_logical_or
(paren
id|SCSIcmd
op_eq
id|SCSI_START_STOP_UNIT
)paren
op_logical_or
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_NO_FILTER
)paren
)paren
id|p_sccb-&gt;HostStatus
op_assign
id|SCCB_DATA_UNDER_RUN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_sccb-&gt;SccbStatus
op_eq
id|SCCB_IN_PROCESS
)paren
(brace
r_if
c_cond
(paren
id|p_sccb-&gt;HostStatus
op_logical_or
id|p_sccb-&gt;TargetStatus
)paren
id|p_sccb-&gt;SccbStatus
op_assign
id|SCCB_ERROR
suffix:semicolon
r_else
id|p_sccb-&gt;SccbStatus
op_assign
id|SCCB_SUCCESS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_sccb-&gt;Sccb_XferState
op_amp
id|F_AUTO_SENSE
)paren
(brace
id|p_sccb-&gt;CdbLength
op_assign
id|p_sccb-&gt;Save_CdbLen
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p_sccb-&gt;Cdb
(braket
id|i
)braket
op_assign
id|p_sccb-&gt;Save_Cdb
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|RESIDUAL_SG_COMMAND
)paren
op_logical_or
(paren
id|p_sccb-&gt;OperationCode
op_eq
id|RESIDUAL_COMMAND
)paren
)paren
(brace
id|utilUpdateResidual
c_func
(paren
id|p_sccb
)paren
suffix:semicolon
)brace
id|pCurrCard-&gt;cmdCounter
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pCurrCard-&gt;cmdCounter
)paren
(brace
r_if
c_cond
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_GREEN_PC
)paren
(brace
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_clkctrl_0
comma
(paren
id|PWR_DWN
op_or
id|CLKCTRL_DEFAULT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_sys_ctrl
comma
id|STOP_CLK
)paren
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_semaphore
comma
(paren
id|RD_HARPOON
c_func
(paren
id|pCurrCard-&gt;ioPort
op_plus
id|hp_semaphore
)paren
op_amp
op_complement
id|SCCB_MGR_ACTIVE
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCurrCard-&gt;discQCount
op_ne
l_int|0
)paren
(brace
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|pCurrCard-&gt;globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|p_sccb-&gt;Lun
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p_sccb-&gt;Sccb_tag
)paren
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|p_sccb-&gt;Sccb_tag
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|pCurrCard-&gt;discQCount
op_decrement
suffix:semicolon
id|pCurrCard-&gt;discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
id|callback
op_assign
(paren
id|CALL_BK_FN
)paren
id|p_sccb-&gt;SccbCallback
suffix:semicolon
id|callback
c_func
(paren
id|p_sccb
)paren
suffix:semicolon
id|pCurrCard-&gt;globalFlags
op_or_assign
id|F_NEW_SCCB_CMD
suffix:semicolon
id|pCurrCard-&gt;currentSCCB
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif /* ( if FW_TYPE==...) */
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Disconnect&n; *&n; * Description: Add SCCB to our disconnect array.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueDisconnect
r_void
id|queueDisconnect
c_func
(paren
id|PSCCB
id|p_sccb
comma
id|UCHAR
id|p_card
)paren
(brace
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|globalFlags
op_amp
id|F_CONLUN_IO
)paren
op_logical_and
(paren
(paren
id|currTar_Info-&gt;TarStatus
op_amp
id|TAR_TAG_Q_MASK
)paren
op_ne
id|TAG_Q_TRYING
)paren
)paren
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
id|p_sccb-&gt;Lun
)braket
)braket
op_assign
id|p_sccb
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p_sccb-&gt;Sccb_tag
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|p_sccb-&gt;Sccb_tag
)braket
op_assign
id|p_sccb
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
dot
id|TarLUNBusy
(braket
l_int|0
)braket
op_assign
id|FALSE
suffix:semicolon
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_sccb-&gt;TargID
)braket
dot
id|TarTagQ_Cnt
op_increment
suffix:semicolon
)brace
r_else
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|currTar_Info-&gt;LunDiscQ_Idx
(braket
l_int|0
)braket
)braket
op_assign
id|p_sccb
suffix:semicolon
)brace
)brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Flush SCCB&n; *&n; * Description: Flush all SCCB&squot;s back to the host driver for this target.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueFlushSccb
r_void
id|queueFlushSccb
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|error_code
)paren
(brace
id|UCHAR
id|qtag
comma
id|thisTarg
suffix:semicolon
id|PSCCB
id|currSCCB
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currSCCB
op_assign
id|BL_Card
(braket
id|p_card
)braket
dot
id|currentSCCB
suffix:semicolon
r_if
c_cond
(paren
id|currSCCB
op_ne
l_int|NULL
)paren
(brace
id|thisTarg
op_assign
(paren
id|UCHAR
)paren
id|currSCCB-&gt;TargID
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|thisTarg
)braket
suffix:semicolon
r_for
c_loop
(paren
id|qtag
op_assign
l_int|0
suffix:semicolon
id|qtag
OL
id|QUEUE_DEPTH
suffix:semicolon
id|qtag
op_increment
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_logical_and
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_member_access_from_pointer
id|TargID
op_eq
id|thisTarg
)paren
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_member_access_from_pointer
id|HostStatus
op_assign
(paren
id|UCHAR
)paren
id|error_code
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
comma
id|p_card
)paren
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarTagQ_Cnt
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Flush Target SCCB&n; *&n; * Description: Flush all SCCB&squot;s back to the host driver for this target.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueFlushTargSccb
r_void
id|queueFlushTargSccb
c_func
(paren
id|UCHAR
id|p_card
comma
id|UCHAR
id|thisTarg
comma
id|UCHAR
id|error_code
)paren
(brace
id|UCHAR
id|qtag
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|thisTarg
)braket
suffix:semicolon
r_for
c_loop
(paren
id|qtag
op_assign
l_int|0
suffix:semicolon
id|qtag
OL
id|QUEUE_DEPTH
suffix:semicolon
id|qtag
op_increment
)paren
(brace
r_if
c_cond
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_logical_and
(paren
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_member_access_from_pointer
id|TargID
op_eq
id|thisTarg
)paren
)paren
(brace
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_member_access_from_pointer
id|HostStatus
op_assign
(paren
id|UCHAR
)paren
id|error_code
suffix:semicolon
id|queueCmdComplete
c_func
(paren
op_amp
id|BL_Card
(braket
id|p_card
)braket
comma
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
comma
id|p_card
)paren
suffix:semicolon
id|BL_Card
(braket
id|p_card
)braket
dot
id|discQ_Tbl
(braket
id|qtag
)braket
op_assign
l_int|NULL
suffix:semicolon
id|currTar_Info-&gt;TarTagQ_Cnt
op_decrement
suffix:semicolon
)brace
)brace
)brace
DECL|function|queueAddSccb
r_void
id|queueAddSccb
c_func
(paren
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|p_card
)paren
(brace
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_SCCB-&gt;TargID
)braket
suffix:semicolon
id|p_SCCB-&gt;Sccb_forwardlink
op_assign
l_int|NULL
suffix:semicolon
id|p_SCCB-&gt;Sccb_backlink
op_assign
id|currTar_Info-&gt;TarSelQ_Tail
suffix:semicolon
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Cnt
op_eq
l_int|0
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Head
op_assign
id|p_SCCB
suffix:semicolon
)brace
r_else
(brace
id|currTar_Info-&gt;TarSelQ_Tail-&gt;Sccb_forwardlink
op_assign
id|p_SCCB
suffix:semicolon
)brace
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
id|p_SCCB
suffix:semicolon
id|currTar_Info-&gt;TarSelQ_Cnt
op_increment
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Queue Find SCCB&n; *&n; * Description: Search the target select Queue for this SCCB, and&n; *              remove it if found.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|queueFindSccb
id|UCHAR
id|queueFindSccb
c_func
(paren
id|PSCCB
id|p_SCCB
comma
id|UCHAR
id|p_card
)paren
(brace
id|PSCCB
id|q_ptr
suffix:semicolon
id|PSCCBMgr_tar_info
id|currTar_Info
suffix:semicolon
id|currTar_Info
op_assign
op_amp
id|sccbMgrTbl
(braket
id|p_card
)braket
(braket
id|p_SCCB-&gt;TargID
)braket
suffix:semicolon
id|q_ptr
op_assign
id|currTar_Info-&gt;TarSelQ_Head
suffix:semicolon
r_while
c_loop
(paren
id|q_ptr
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|q_ptr
op_eq
id|p_SCCB
)paren
(brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Head
op_eq
id|q_ptr
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Head
op_assign
id|q_ptr-&gt;Sccb_forwardlink
suffix:semicolon
)brace
r_if
c_cond
(paren
id|currTar_Info-&gt;TarSelQ_Tail
op_eq
id|q_ptr
)paren
(brace
id|currTar_Info-&gt;TarSelQ_Tail
op_assign
id|q_ptr-&gt;Sccb_backlink
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q_ptr-&gt;Sccb_forwardlink
op_ne
l_int|NULL
)paren
(brace
id|q_ptr-&gt;Sccb_forwardlink-&gt;Sccb_backlink
op_assign
id|q_ptr-&gt;Sccb_backlink
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q_ptr-&gt;Sccb_backlink
op_ne
l_int|NULL
)paren
(brace
id|q_ptr-&gt;Sccb_backlink-&gt;Sccb_forwardlink
op_assign
id|q_ptr-&gt;Sccb_forwardlink
suffix:semicolon
)brace
id|currTar_Info-&gt;TarSelQ_Cnt
op_decrement
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|q_ptr
op_assign
id|q_ptr-&gt;Sccb_forwardlink
suffix:semicolon
)brace
)brace
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Utility Update Residual Count&n; *&n; * Description: Update the XferCnt to the remaining byte count.&n; *              If we transferred all the data then just write zero.&n; *              If Non-SG transfer then report Total Cnt - Actual Transfer&n; *              Cnt.  For SG transfers add the count fields of all&n; *              remaining SG elements, as well as any partial remaining&n; *              element.&n; *&n; *---------------------------------------------------------------------*/
DECL|function|utilUpdateResidual
r_void
id|utilUpdateResidual
c_func
(paren
id|PSCCB
id|p_SCCB
)paren
(brace
id|ULONG
id|partial_cnt
suffix:semicolon
id|UINT
id|sg_index
suffix:semicolon
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
id|ULONG
id|far
op_star
id|sg_ptr
suffix:semicolon
macro_line|#else
id|ULONG
op_star
id|sg_ptr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|p_SCCB-&gt;Sccb_XferState
op_amp
id|F_ALL_XFERRED
)paren
(brace
id|p_SCCB-&gt;DataLength
op_assign
l_int|0x0000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p_SCCB-&gt;Sccb_XferState
op_amp
id|F_SG_XFER
)paren
(brace
id|partial_cnt
op_assign
l_int|0x0000
suffix:semicolon
id|sg_index
op_assign
id|p_SCCB-&gt;Sccb_sgseg
suffix:semicolon
macro_line|#if defined(COMPILER_16_BIT) &amp;&amp; !defined(DOS)
id|sg_ptr
op_assign
(paren
id|ULONG
id|far
op_star
)paren
id|p_SCCB-&gt;DataPointer
suffix:semicolon
macro_line|#else
id|sg_ptr
op_assign
(paren
id|ULONG
op_star
)paren
id|p_SCCB-&gt;DataPointer
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|p_SCCB-&gt;Sccb_SGoffset
)paren
(brace
id|partial_cnt
op_assign
id|p_SCCB-&gt;Sccb_SGoffset
suffix:semicolon
id|sg_index
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|ULONG
)paren
id|sg_index
op_star
(paren
id|ULONG
)paren
id|SG_ELEMENT_SIZE
)paren
OL
id|p_SCCB-&gt;DataLength
)paren
(brace
id|partial_cnt
op_add_assign
op_star
(paren
id|sg_ptr
op_plus
(paren
id|sg_index
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|sg_index
op_increment
suffix:semicolon
)brace
id|p_SCCB-&gt;DataLength
op_assign
id|partial_cnt
suffix:semicolon
)brace
r_else
(brace
id|p_SCCB-&gt;DataLength
op_sub_assign
id|p_SCCB-&gt;Sccb_ATC
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Wait 1 Second&n; *&n; * Description: Wait for 1 second.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|Wait1Second
r_void
id|Wait1Second
c_func
(paren
id|USHORT
id|p_port
)paren
macro_line|#else
r_void
id|Wait1Second
c_func
(paren
id|ULONG
id|p_port
)paren
macro_line|#endif
(brace
id|UCHAR
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Wait
c_func
(paren
id|p_port
comma
id|TO_250ms
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsictrl_0
)paren
op_amp
id|SCSI_RST
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|SCAM_SEL
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Wait&n; *&n; * Description: Wait the desired delay.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|Wait
r_void
id|Wait
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_delay
)paren
macro_line|#else
r_void
id|Wait
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_delay
)paren
macro_line|#endif
(brace
id|UCHAR
id|old_timer
suffix:semicolon
id|UCHAR
id|green_flag
suffix:semicolon
id|old_timer
op_assign
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
)paren
suffix:semicolon
id|green_flag
op_assign
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
comma
id|CLKCTRL_DEFAULT
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|p_delay
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|TIMEOUT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intena
)paren
comma
(paren
id|default_intena
op_amp
op_complement
id|TIMEOUT
)paren
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
)paren
op_or
id|START_TO
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|TIMEOUT
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_scsictrl_0
)paren
op_amp
id|SCSI_RST
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RDW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
)paren
op_amp
id|SCAM_SEL
)paren
)paren
r_break
suffix:semicolon
)brace
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
comma
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_portctrl_0
)paren
op_amp
op_complement
id|START_TO
)paren
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intstat
)paren
comma
id|TIMEOUT
)paren
suffix:semicolon
id|WRW_HARPOON
c_func
(paren
(paren
id|p_port
op_plus
id|hp_intena
)paren
comma
id|default_intena
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_clkctrl_0
comma
id|green_flag
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_seltimeout
comma
id|old_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Enable/Disable Write to EEPROM&n; *&n; * Description: The EEPROM must first be enabled for writes&n; *              A total of 9 clocks are needed.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|utilEEWriteOnOff
r_void
id|utilEEWriteOnOff
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|p_mode
)paren
macro_line|#else
r_void
id|utilEEWriteOnOff
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|p_mode
)paren
macro_line|#endif
(brace
id|UCHAR
id|ee_value
suffix:semicolon
id|ee_value
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
)paren
op_amp
(paren
id|EXT_ARB_ACK
op_or
id|SCSI_TERM_ENA_H
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p_mode
)paren
id|utilEESendCmdAddr
c_func
(paren
id|p_port
comma
id|EWEN
comma
id|EWEN_ADDR
)paren
suffix:semicolon
r_else
id|utilEESendCmdAddr
c_func
(paren
id|p_port
comma
id|EWDS
comma
id|EWDS_ADDR
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|ee_value
op_or
id|SEE_MS
)paren
)paren
suffix:semicolon
multiline_comment|/*Turn off CS */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
multiline_comment|/*Turn off Master Select */
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Write EEPROM&n; *&n; * Description: Write a word to the EEPROM at the specified&n; *              address.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|utilEEWrite
r_void
id|utilEEWrite
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_data
comma
id|USHORT
id|ee_addr
)paren
macro_line|#else
r_void
id|utilEEWrite
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_data
comma
id|USHORT
id|ee_addr
)paren
macro_line|#endif
(brace
id|UCHAR
id|ee_value
suffix:semicolon
id|USHORT
id|i
suffix:semicolon
id|ee_value
op_assign
(paren
id|UCHAR
)paren
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
)paren
op_amp
(paren
id|EXT_ARB_ACK
op_or
id|SCSI_TERM_ENA_H
)paren
)paren
op_or
(paren
id|SEE_MS
op_or
id|SEE_CS
)paren
)paren
suffix:semicolon
id|utilEESendCmdAddr
c_func
(paren
id|p_port
comma
id|EE_WRITE
comma
id|ee_addr
)paren
suffix:semicolon
id|ee_value
op_or_assign
(paren
id|SEE_MS
op_plus
id|SEE_CS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x8000
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
id|ee_data
)paren
id|ee_value
op_or_assign
id|SEE_DO
suffix:semicolon
r_else
id|ee_value
op_and_assign
op_complement
id|SEE_DO
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_or_assign
id|SEE_CLK
suffix:semicolon
multiline_comment|/* Clock  data! */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_and_assign
op_complement
id|SEE_CLK
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
)brace
id|ee_value
op_and_assign
(paren
id|EXT_ARB_ACK
op_or
id|SCSI_TERM_ENA_H
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|ee_value
op_or
id|SEE_MS
)paren
)paren
suffix:semicolon
id|Wait
c_func
(paren
id|p_port
comma
id|TO_10ms
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|ee_value
op_or
id|SEE_MS
op_or
id|SEE_CS
)paren
)paren
suffix:semicolon
multiline_comment|/* Set CS to EEPROM */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|ee_value
op_or
id|SEE_MS
)paren
)paren
suffix:semicolon
multiline_comment|/* Turn off CS */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
multiline_comment|/* Turn off Master Select */
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Read EEPROM&n; *&n; * Description: Read a word from the EEPROM at the desired&n; *              address.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|utilEERead
id|USHORT
id|utilEERead
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_addr
)paren
macro_line|#else
id|USHORT
id|utilEERead
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_addr
)paren
macro_line|#endif
(brace
id|USHORT
id|i
comma
id|ee_data1
comma
id|ee_data2
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|ee_data1
op_assign
id|utilEEReadOrg
c_func
(paren
id|p_port
comma
id|ee_addr
)paren
suffix:semicolon
r_do
(brace
id|ee_data2
op_assign
id|utilEEReadOrg
c_func
(paren
id|p_port
comma
id|ee_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ee_data1
op_eq
id|ee_data2
)paren
(brace
r_return
id|ee_data1
suffix:semicolon
)brace
id|ee_data1
op_assign
id|ee_data2
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
l_int|4
)paren
(brace
suffix:semicolon
)brace
r_return
id|ee_data1
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Read EEPROM Original &n; *&n; * Description: Read a word from the EEPROM at the desired&n; *              address.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|utilEEReadOrg
id|USHORT
id|utilEEReadOrg
c_func
(paren
id|USHORT
id|p_port
comma
id|USHORT
id|ee_addr
)paren
macro_line|#else
id|USHORT
id|utilEEReadOrg
c_func
(paren
id|ULONG
id|p_port
comma
id|USHORT
id|ee_addr
)paren
macro_line|#endif
(brace
id|UCHAR
id|ee_value
suffix:semicolon
id|USHORT
id|i
comma
id|ee_data
suffix:semicolon
id|ee_value
op_assign
(paren
id|UCHAR
)paren
(paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
)paren
op_amp
(paren
id|EXT_ARB_ACK
op_or
id|SCSI_TERM_ENA_H
)paren
)paren
op_or
(paren
id|SEE_MS
op_or
id|SEE_CS
)paren
)paren
suffix:semicolon
id|utilEESendCmdAddr
c_func
(paren
id|p_port
comma
id|EE_READ
comma
id|ee_addr
)paren
suffix:semicolon
id|ee_value
op_or_assign
(paren
id|SEE_MS
op_plus
id|SEE_CS
)paren
suffix:semicolon
id|ee_data
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ee_value
op_or_assign
id|SEE_CLK
suffix:semicolon
multiline_comment|/* Clock  data! */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_and_assign
op_complement
id|SEE_CLK
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_data
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
)paren
op_amp
id|SEE_DI
)paren
id|ee_data
op_or_assign
l_int|1
suffix:semicolon
)brace
id|ee_value
op_and_assign
op_complement
(paren
id|SEE_MS
op_plus
id|SEE_CS
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
(paren
id|ee_value
op_or
id|SEE_MS
)paren
)paren
suffix:semicolon
multiline_comment|/*Turn off CS */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
multiline_comment|/*Turn off Master Select */
r_return
id|ee_data
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------&n; *&n; * Function: Send EE command and Address to the EEPROM&n; *&n; * Description: Transfers the correct command and sends the address&n; *              to the eeprom.&n; *&n; *---------------------------------------------------------------------*/
macro_line|#if defined(DOS)
DECL|function|utilEESendCmdAddr
r_void
id|utilEESendCmdAddr
c_func
(paren
id|USHORT
id|p_port
comma
id|UCHAR
id|ee_cmd
comma
id|USHORT
id|ee_addr
)paren
macro_line|#else
r_void
id|utilEESendCmdAddr
c_func
(paren
id|ULONG
id|p_port
comma
id|UCHAR
id|ee_cmd
comma
id|USHORT
id|ee_addr
)paren
macro_line|#endif
(brace
id|UCHAR
id|ee_value
suffix:semicolon
id|UCHAR
id|narrow_flg
suffix:semicolon
id|USHORT
id|i
suffix:semicolon
id|narrow_flg
op_assign
(paren
id|UCHAR
)paren
(paren
id|RD_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_page_ctrl
)paren
op_amp
id|NARROW_SCSI_CARD
)paren
suffix:semicolon
id|ee_value
op_assign
id|SEE_MS
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_or_assign
id|SEE_CS
suffix:semicolon
multiline_comment|/* Set CS to EEPROM */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x04
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
id|ee_cmd
)paren
id|ee_value
op_or_assign
id|SEE_DO
suffix:semicolon
r_else
id|ee_value
op_and_assign
op_complement
id|SEE_DO
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_or_assign
id|SEE_CLK
suffix:semicolon
multiline_comment|/* Clock  data! */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_and_assign
op_complement
id|SEE_CLK
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|narrow_flg
)paren
id|i
op_assign
l_int|0x0080
suffix:semicolon
r_else
id|i
op_assign
l_int|0x0200
suffix:semicolon
r_while
c_loop
(paren
id|i
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
id|ee_addr
)paren
id|ee_value
op_or_assign
id|SEE_DO
suffix:semicolon
r_else
id|ee_value
op_and_assign
op_complement
id|SEE_DO
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_or_assign
id|SEE_CLK
suffix:semicolon
multiline_comment|/* Clock  data! */
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|ee_value
op_and_assign
op_complement
id|SEE_CLK
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|WR_HARPOON
c_func
(paren
id|p_port
op_plus
id|hp_ee_ctrl
comma
id|ee_value
)paren
suffix:semicolon
id|i
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|CalcCrc16
id|USHORT
id|CalcCrc16
c_func
(paren
id|UCHAR
id|buffer
(braket
)braket
)paren
(brace
id|USHORT
id|crc
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|USHORT
id|ch
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ch
op_assign
(paren
id|USHORT
)paren
id|buffer
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|ch
)paren
op_amp
l_int|1
)paren
id|crc
op_assign
(paren
id|crc
op_rshift
l_int|1
)paren
op_xor
id|CRCMASK
suffix:semicolon
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|ch
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|CalcLrc
id|UCHAR
id|CalcLrc
c_func
(paren
id|UCHAR
id|buffer
(braket
)braket
)paren
(brace
r_int
id|i
suffix:semicolon
id|UCHAR
id|lrc
suffix:semicolon
id|lrc
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ID_STRING_LENGTH
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lrc
op_xor_assign
id|buffer
(braket
id|i
)braket
suffix:semicolon
)brace
r_return
id|lrc
suffix:semicolon
)brace
multiline_comment|/*&n;  The following inline definitions avoid type conflicts.&n;*/
r_static
r_inline
r_int
r_char
DECL|function|FlashPoint__ProbeHostAdapter
id|FlashPoint__ProbeHostAdapter
c_func
(paren
id|FlashPoint_Info_T
op_star
id|FlashPointInfo
)paren
(brace
r_return
id|FlashPoint_ProbeHostAdapter
c_func
(paren
(paren
id|PSCCBMGR_INFO
)paren
id|FlashPointInfo
)paren
suffix:semicolon
)brace
r_static
r_inline
id|FlashPoint_CardHandle_T
DECL|function|FlashPoint__HardwareResetHostAdapter
id|FlashPoint__HardwareResetHostAdapter
c_func
(paren
id|FlashPoint_Info_T
op_star
id|FlashPointInfo
)paren
(brace
r_return
id|FlashPoint_HardwareResetHostAdapter
c_func
(paren
(paren
id|PSCCBMGR_INFO
)paren
id|FlashPointInfo
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|FlashPoint__ReleaseHostAdapter
id|FlashPoint__ReleaseHostAdapter
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
)paren
(brace
id|FlashPoint_ReleaseHostAdapter
c_func
(paren
id|CardHandle
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|FlashPoint__StartCCB
id|FlashPoint__StartCCB
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
comma
id|BusLogic_CCB_T
op_star
id|CCB
)paren
(brace
id|FlashPoint_StartCCB
c_func
(paren
id|CardHandle
comma
(paren
id|PSCCB
)paren
id|CCB
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|FlashPoint__AbortCCB
id|FlashPoint__AbortCCB
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
comma
id|BusLogic_CCB_T
op_star
id|CCB
)paren
(brace
id|FlashPoint_AbortCCB
c_func
(paren
id|CardHandle
comma
(paren
id|PSCCB
)paren
id|CCB
)paren
suffix:semicolon
)brace
r_static
r_inline
id|boolean
DECL|function|FlashPoint__InterruptPending
id|FlashPoint__InterruptPending
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
)paren
(brace
r_return
id|FlashPoint_InterruptPending
c_func
(paren
id|CardHandle
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|FlashPoint__HandleInterrupt
id|FlashPoint__HandleInterrupt
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
)paren
(brace
r_return
id|FlashPoint_HandleInterrupt
c_func
(paren
id|CardHandle
)paren
suffix:semicolon
)brace
DECL|macro|FlashPoint_ProbeHostAdapter
mdefine_line|#define FlashPoint_ProbeHostAdapter&t;    FlashPoint__ProbeHostAdapter
DECL|macro|FlashPoint_HardwareResetHostAdapter
mdefine_line|#define FlashPoint_HardwareResetHostAdapter FlashPoint__HardwareResetHostAdapter
DECL|macro|FlashPoint_ReleaseHostAdapter
mdefine_line|#define FlashPoint_ReleaseHostAdapter&t;    FlashPoint__ReleaseHostAdapter
DECL|macro|FlashPoint_StartCCB
mdefine_line|#define FlashPoint_StartCCB&t;&t;    FlashPoint__StartCCB
DECL|macro|FlashPoint_AbortCCB
mdefine_line|#define FlashPoint_AbortCCB&t;&t;    FlashPoint__AbortCCB
DECL|macro|FlashPoint_InterruptPending
mdefine_line|#define FlashPoint_InterruptPending&t;    FlashPoint__InterruptPending
DECL|macro|FlashPoint_HandleInterrupt
mdefine_line|#define FlashPoint_HandleInterrupt&t;    FlashPoint__HandleInterrupt
multiline_comment|/*&n;  FlashPoint_InquireTargetInfo returns the Synchronous Period, Synchronous&n;  Offset, and Wide Transfers Active information for TargetID on CardHandle.&n;*/
DECL|function|FlashPoint_InquireTargetInfo
r_void
id|FlashPoint_InquireTargetInfo
c_func
(paren
id|FlashPoint_CardHandle_T
id|CardHandle
comma
r_int
id|TargetID
comma
r_int
r_char
op_star
id|SynchronousPeriod
comma
r_int
r_char
op_star
id|SynchronousOffset
comma
r_int
r_char
op_star
id|WideTransfersActive
)paren
(brace
id|SCCBMGR_TAR_INFO
op_star
id|TargetInfo
op_assign
op_amp
id|sccbMgrTbl
(braket
(paren
(paren
id|SCCBCARD
op_star
)paren
id|CardHandle
)paren
op_member_access_from_pointer
id|cardIndex
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|TargetInfo-&gt;TarSyncCtrl
op_amp
id|SYNC_OFFSET
)paren
OG
l_int|0
)paren
(brace
op_star
id|SynchronousPeriod
op_assign
l_int|5
op_star
(paren
(paren
id|TargetInfo-&gt;TarSyncCtrl
op_rshift
l_int|5
)paren
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|SynchronousOffset
op_assign
id|TargetInfo-&gt;TarSyncCtrl
op_amp
id|SYNC_OFFSET
suffix:semicolon
)brace
r_else
(brace
op_star
id|SynchronousPeriod
op_assign
l_int|0
suffix:semicolon
op_star
id|SynchronousOffset
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|WideTransfersActive
op_assign
(paren
id|TargetInfo-&gt;TarSyncCtrl
op_amp
id|NARROW_SCSI
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#else  /* CONFIG_SCSI_OMIT_FLASHPOINT */
multiline_comment|/*&n;  Define prototypes for the FlashPoint SCCB Manager Functions.&n;*/
r_extern
r_int
r_char
id|FlashPoint_ProbeHostAdapter
c_func
(paren
id|FlashPoint_Info_T
op_star
)paren
suffix:semicolon
r_extern
id|FlashPoint_CardHandle_T
id|FlashPoint_HardwareResetHostAdapter
c_func
(paren
id|FlashPoint_Info_T
op_star
)paren
suffix:semicolon
r_extern
r_void
id|FlashPoint_StartCCB
c_func
(paren
id|FlashPoint_CardHandle_T
comma
id|BusLogic_CCB_T
op_star
)paren
suffix:semicolon
r_extern
r_int
id|FlashPoint_AbortCCB
c_func
(paren
id|FlashPoint_CardHandle_T
comma
id|BusLogic_CCB_T
op_star
)paren
suffix:semicolon
r_extern
id|boolean
id|FlashPoint_InterruptPending
c_func
(paren
id|FlashPoint_CardHandle_T
)paren
suffix:semicolon
r_extern
r_int
id|FlashPoint_HandleInterrupt
c_func
(paren
id|FlashPoint_CardHandle_T
)paren
suffix:semicolon
r_extern
r_void
id|FlashPoint_ReleaseHostAdapter
c_func
(paren
id|FlashPoint_CardHandle_T
)paren
suffix:semicolon
r_extern
r_void
id|FlashPoint_InquireTargetInfo
c_func
(paren
id|FlashPoint_CardHandle_T
comma
r_int
comma
r_int
r_char
op_star
comma
r_int
r_char
op_star
comma
r_int
r_char
op_star
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SCSI_OMIT_FLASHPOINT */
eof
