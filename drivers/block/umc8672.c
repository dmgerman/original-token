multiline_comment|/*&n; *  linux/drivers/block/umc8672.c&t;Version 0.01  Nov 16, 1995&n; *&n; *  Copyright (C) 1995  Linus Torvalds &amp; author (see below)&n; */
multiline_comment|/*&n; *  Principal Author/Maintainer:  PODIEN@hml2.atlas.de (Wolfram Podien)&n; *&n; *  This file provides support for the advanced features&n; *  of the UMC 8672 IDE interface.&n; *&n; *  Version 0.01&t;Initial version, hacked out of ide.c,&n; *&t;&t;&t;and #include&squot;d rather than compiled separately.&n; *&t;&t;&t;This will get cleaned up in a subsequent release.&n; */
multiline_comment|/*&n; * VLB Controller Support from &n; * Wolfram Podien&n; * Rohoefe 3&n; * D28832 Achim&n; * Germany&n; *&n; * To enable UMC8672 support there must a lilo line like&n; * append=&quot;hd=umc8672&quot;...&n; * To set the speed according to the abilities of the hardware there must be a&n; * line like&n; * #define UMC_DRIVE0 11&n; * in the beginning of the driver, which sets the speed of drive 0 to 11 (there&n; * are some lines present). 0 - 11 are allowed speed values. These values are&n; * the results from the DOS speed test programm supplied from UMC. 11 is the &n; * highest speed (about PIO mode 3)&n; */
multiline_comment|/*&n; * The speeds will eventually become selectable using hdparm via ioctl&squot;s,&n; * but for now they are coded here:&n; */
DECL|macro|UMC_DRIVE0
mdefine_line|#define UMC_DRIVE0      11              /* DOS messured drive Speeds */
DECL|macro|UMC_DRIVE1
mdefine_line|#define UMC_DRIVE1      11              /* 0 - 11 allowed */
DECL|macro|UMC_DRIVE2
mdefine_line|#define UMC_DRIVE2      11              /* 11 = Highest Speed */
DECL|macro|UMC_DRIVE3
mdefine_line|#define UMC_DRIVE3      11              /* In case of crash reduce speed */
DECL|function|out_umc
r_void
id|out_umc
(paren
r_char
id|port
comma
r_char
id|wert
)paren
(brace
id|outb_p
(paren
id|port
comma
l_int|0x108
)paren
suffix:semicolon
id|outb_p
(paren
id|wert
comma
l_int|0x109
)paren
suffix:semicolon
)brace
DECL|function|in_umc
id|byte
id|in_umc
(paren
r_char
id|port
)paren
(brace
id|outb_p
(paren
id|port
comma
l_int|0x108
)paren
suffix:semicolon
r_return
id|inb_p
(paren
l_int|0x109
)paren
suffix:semicolon
)brace
DECL|function|init_umc8672
r_void
id|init_umc8672
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
r_int
id|speed
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/*      0    1    2    3    4    5    6    7    8    9    10   11      */
r_char
id|speedtab
(braket
l_int|3
)braket
(braket
l_int|12
)braket
op_assign
(brace
(brace
l_int|0xf
comma
l_int|0xb
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
)brace
comma
(brace
l_int|0x3
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x2
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
comma
l_int|0x1
)brace
comma
(brace
l_int|0xff
comma
l_int|0xcb
comma
l_int|0xc0
comma
l_int|0x58
comma
l_int|0x36
comma
l_int|0x33
comma
l_int|0x23
comma
l_int|0x22
comma
l_int|0x21
comma
l_int|0x11
comma
l_int|0x10
comma
l_int|0x0
)brace
)brace
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb_p
(paren
l_int|0x5A
comma
l_int|0x108
)paren
suffix:semicolon
multiline_comment|/* enable umc */
r_if
c_cond
(paren
id|in_umc
(paren
l_int|0xd5
)paren
op_ne
l_int|0xa0
)paren
(brace
id|sti
(paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;UMC8672 not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|speed
(braket
l_int|0
)braket
op_assign
id|UMC_DRIVE0
suffix:semicolon
id|speed
(braket
l_int|1
)braket
op_assign
id|UMC_DRIVE1
suffix:semicolon
id|speed
(braket
l_int|2
)braket
op_assign
id|UMC_DRIVE2
suffix:semicolon
id|speed
(braket
l_int|3
)braket
op_assign
id|UMC_DRIVE3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|speed
(braket
id|i
)braket
OL
l_int|0
)paren
op_logical_or
(paren
id|speed
(braket
id|i
)braket
OG
l_int|11
)paren
)paren
(brace
id|sti
(paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;UMC 8672 drive speed out of range. Drive %d Speed %d&bslash;n&quot;
comma
id|i
comma
id|speed
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;UMC support aborted&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|out_umc
(paren
l_int|0xd7
comma
(paren
id|speedtab
(braket
l_int|0
)braket
(braket
id|speed
(braket
l_int|2
)braket
)braket
op_or
(paren
id|speedtab
(braket
l_int|0
)braket
(braket
id|speed
(braket
l_int|3
)braket
)braket
op_lshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|out_umc
(paren
l_int|0xd6
comma
(paren
id|speedtab
(braket
l_int|0
)braket
(braket
id|speed
(braket
l_int|0
)braket
)braket
op_or
(paren
id|speedtab
(braket
l_int|0
)braket
(braket
id|speed
(braket
l_int|1
)braket
)braket
op_lshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|tmp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tmp
op_assign
(paren
id|tmp
op_lshift
l_int|2
)paren
op_or
id|speedtab
(braket
l_int|1
)braket
(braket
id|speed
(braket
id|i
)braket
)braket
suffix:semicolon
)brace
id|out_umc
(paren
l_int|0xdc
comma
id|tmp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|out_umc
(paren
l_int|0xd0
op_plus
id|i
comma
id|speedtab
(braket
l_int|2
)braket
(braket
id|speed
(braket
id|i
)braket
)braket
)paren
suffix:semicolon
id|out_umc
(paren
l_int|0xd8
op_plus
id|i
comma
id|speedtab
(braket
l_int|2
)braket
(braket
id|speed
(braket
id|i
)braket
)braket
)paren
suffix:semicolon
)brace
id|outb_p
(paren
l_int|0xa5
comma
l_int|0x108
)paren
suffix:semicolon
multiline_comment|/* disable umc */
id|sti
(paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Speeds for UMC8672 &bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
l_string|&quot;Drive %d speed %d&bslash;n&quot;
comma
id|i
comma
id|speed
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
eof
