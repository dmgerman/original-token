multiline_comment|/*&n;&n;  Linux Driver for Mylex DAC960 and DAC1100 PCI RAID Controllers&n;&n;  Copyright 1998-1999 by Leonard N. Zubkoff &lt;lnz@dandelion.com&gt;&n;&n;  This program is free software; you may redistribute and/or modify it under&n;  the terms of the GNU General Public License Version 2 as published by the&n;  Free Software Foundation.&n;&n;  This program is distributed in the hope that it will be useful, but&n;  WITHOUT ANY WARRANTY, without even the implied warranty of MERCHANTABILITY&n;  or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n;  for complete details.&n;&n;  The author respectfully requests that any modifications to this software be&n;  sent directly to him for evaluation and testing.&n;&n;*/
DECL|macro|DAC960_DriverVersion
mdefine_line|#define DAC960_DriverVersion&t;&t;&t;&quot;2.3.4&quot;
DECL|macro|DAC960_DriverDate
mdefine_line|#define DAC960_DriverDate&t;&t;&t;&quot;23 September 1999&quot;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;DAC960.h&quot;
multiline_comment|/*&n;  DAC960_ControllerCount is the number of DAC960 Controllers detected.&n;*/
r_static
r_int
DECL|variable|DAC960_ControllerCount
id|DAC960_ControllerCount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;  DAC960_ActiveControllerCount is the number of Active DAC960 Controllers&n;  detected.&n;*/
r_static
r_int
DECL|variable|DAC960_ActiveControllerCount
id|DAC960_ActiveControllerCount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;  DAC960_Controllers is an array of pointers to the DAC960 Controller&n;  structures.&n;*/
r_static
id|DAC960_Controller_T
DECL|variable|DAC960_Controllers
op_star
id|DAC960_Controllers
(braket
id|DAC960_MaxControllers
)braket
op_assign
(brace
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_FileOperations is the File Operations structure for DAC960 Logical&n;  Disk Devices.&n;  Leonard, no offence, but _where_ did this C dialect come from?&n;*/
DECL|variable|DAC960_FileOperations
r_static
r_struct
id|block_device_operations
id|DAC960_FileOperations
op_assign
(brace
id|open
suffix:colon
id|DAC960_Open
comma
id|release
suffix:colon
id|DAC960_Release
comma
id|ioctl
suffix:colon
id|DAC960_IOCTL
comma
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_ProcDirectoryEntry is the DAC960 /proc/driver/rd directory entry.&n;*/
r_static
id|PROC_DirectoryEntry_T
op_star
DECL|variable|DAC960_ProcDirectoryEntry
id|DAC960_ProcDirectoryEntry
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;  DAC960_NotifierBlock is the Notifier Block structure for DAC960 Driver.&n;*/
r_static
id|NotifierBlock_T
DECL|variable|DAC960_NotifierBlock
id|DAC960_NotifierBlock
op_assign
(brace
id|DAC960_Finalize
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_AnnounceDriver announces the Driver Version and Date, Author&squot;s Name,&n;  Copyright Notice, and Electronic Mail Address.&n;*/
DECL|function|DAC960_AnnounceDriver
r_static
r_void
id|DAC960_AnnounceDriver
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Announce
c_func
(paren
l_string|&quot;***** DAC960 RAID Driver Version &quot;
id|DAC960_DriverVersion
l_string|&quot; of &quot;
id|DAC960_DriverDate
l_string|&quot; *****&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_Announce
c_func
(paren
l_string|&quot;Copyright 1998-1999 by Leonard N. Zubkoff &quot;
l_string|&quot;&lt;lnz@dandelion.com&gt;&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Failure prints a standardized error message, and then returns false.&n;*/
DECL|function|DAC960_Failure
r_static
id|boolean
id|DAC960_Failure
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|ErrorMessage
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;While configuring DAC960 PCI RAID Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;IO_Address
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;%s FAILED - DETACHING&bslash;n&quot;
comma
id|Controller
comma
id|ErrorMessage
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ClearCommand clears critical fields of Command.&n;*/
DECL|function|DAC960_ClearCommand
r_static
r_inline
r_void
id|DAC960_ClearCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Words
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Words
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Words
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Words
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|Command-&gt;CommandStatus
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_AllocateCommand allocates a Command structure from Controller&squot;s&n;  free list.&n;*/
DECL|function|DAC960_AllocateCommand
r_static
r_inline
id|DAC960_Command_T
op_star
id|DAC960_AllocateCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command-&gt;Next
suffix:semicolon
id|Command-&gt;Next
op_assign
l_int|NULL
suffix:semicolon
r_return
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DeallocateCommand deallocates Command, returning it to Controller&squot;s&n;  free list.&n;*/
DECL|function|DAC960_DeallocateCommand
r_static
r_inline
r_void
id|DAC960_DeallocateCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|Command-&gt;Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_QueueCommand queues Command.&n;*/
DECL|function|DAC960_QueueCommand
r_static
r_void
id|DAC960_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command
op_minus
id|Controller-&gt;Commands
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
id|NextCommandMailbox
op_assign
id|Controller-&gt;NextCommandMailbox
suffix:semicolon
id|DAC960_V5_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;DualModeMemoryMailboxInterface
)paren
id|DAC960_V5_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_else
id|DAC960_V5_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
)brace
id|Controller-&gt;PreviousCommandMailbox2
op_assign
id|Controller-&gt;PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
id|NextCommandMailbox
op_assign
id|Controller-&gt;NextCommandMailbox
suffix:semicolon
id|DAC960_V4_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;DualModeMemoryMailboxInterface
)paren
id|DAC960_V4_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_else
id|DAC960_V4_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
)brace
id|Controller-&gt;PreviousCommandMailbox2
op_assign
id|Controller-&gt;PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_V3_MailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_V3_WriteCommandMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_V3_NewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_ExecuteCommand executes Command and waits for completion.  It&n;  returns true on success and false on failure.&n;*/
DECL|function|DAC960_ExecuteCommand
r_static
id|boolean
id|DAC960_ExecuteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DECLARE_MUTEX_LOCKED
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
r_int
r_int
id|ProcessorFlags
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
op_amp
id|Semaphore
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_interrupt
c_func
(paren
)paren
)paren
id|down
c_func
(paren
op_amp
id|Semaphore
)paren
suffix:semicolon
r_return
id|Command-&gt;CommandStatus
op_eq
id|DAC960_NormalCompletion
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ExecuteType3 executes a DAC960 Type 3 Command and waits for&n;  completion.  It returns true on success and false on failure.&n;*/
DECL|function|DAC960_ExecuteType3
r_static
id|boolean
id|DAC960_ExecuteType3
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_CommandOpcode_T
id|CommandOpcode
comma
r_void
op_star
id|DataPointer
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|boolean
id|Result
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|Result
op_assign
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
id|Result
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ExecuteType3D executes a DAC960 Type 3D Command and waits for&n;  completion.  It returns true on success and false on failure.&n;*/
DECL|function|DAC960_ExecuteType3D
r_static
id|boolean
id|DAC960_ExecuteType3D
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_CommandOpcode_T
id|CommandOpcode
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_void
op_star
id|DataPointer
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|boolean
id|Result
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|Result
op_assign
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
id|Result
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_EnableMemoryMailboxInterface enables the Memory Mailbox Interface.&n;*/
DECL|function|DAC960_EnableMemoryMailboxInterface
r_static
id|boolean
id|DAC960_EnableMemoryMailboxInterface
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailboxesMemory
suffix:semicolon
id|DAC960_StatusMailbox_T
op_star
id|StatusMailboxesMemory
suffix:semicolon
id|DAC960_CommandMailbox_T
id|CommandMailbox
suffix:semicolon
id|DAC960_CommandStatus_T
id|CommandStatus
suffix:semicolon
r_void
op_star
id|SavedMemoryMailboxesAddress
op_assign
l_int|NULL
suffix:semicolon
r_int
id|NextCommandMailboxIndex
op_assign
l_int|0
suffix:semicolon
r_int
id|NextStatusMailboxIndex
op_assign
l_int|0
suffix:semicolon
r_int
id|TimeoutCounter
op_assign
l_int|1000000
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;ControllerType
op_eq
id|DAC960_V5_Controller
)paren
id|DAC960_V5_RestoreMemoryMailboxInfo
c_func
(paren
id|Controller
comma
op_amp
id|SavedMemoryMailboxesAddress
comma
op_amp
id|NextCommandMailboxIndex
comma
op_amp
id|NextStatusMailboxIndex
)paren
suffix:semicolon
r_else
id|DAC960_V4_RestoreMemoryMailboxInfo
c_func
(paren
id|Controller
comma
op_amp
id|SavedMemoryMailboxesAddress
comma
op_amp
id|NextCommandMailboxIndex
comma
op_amp
id|NextStatusMailboxIndex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SavedMemoryMailboxesAddress
op_eq
l_int|NULL
)paren
id|CommandMailboxesMemory
op_assign
(paren
id|DAC960_CommandMailbox_T
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|1
)paren
suffix:semicolon
r_else
id|CommandMailboxesMemory
op_assign
id|SavedMemoryMailboxesAddress
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailboxesMemory
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
l_int|1
)paren
suffix:semicolon
id|Controller-&gt;FirstCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|CommandMailboxesMemory
op_add_assign
id|DAC960_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;LastCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;NextCommandMailbox
op_assign
op_amp
id|Controller-&gt;FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|NextCommandMailboxIndex
OL
l_int|0
)paren
id|NextCommandMailboxIndex
op_assign
id|DAC960_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;PreviousCommandMailbox1
op_assign
op_amp
id|Controller-&gt;FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|NextCommandMailboxIndex
OL
l_int|0
)paren
id|NextCommandMailboxIndex
op_assign
id|DAC960_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;PreviousCommandMailbox2
op_assign
op_amp
id|Controller-&gt;FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
id|StatusMailboxesMemory
op_assign
(paren
id|DAC960_StatusMailbox_T
op_star
)paren
(paren
id|CommandMailboxesMemory
op_plus
l_int|1
)paren
suffix:semicolon
id|Controller-&gt;FirstStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|StatusMailboxesMemory
op_add_assign
id|DAC960_StatusMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;LastStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;NextStatusMailbox
op_assign
op_amp
id|Controller-&gt;FirstStatusMailbox
(braket
id|NextStatusMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|SavedMemoryMailboxesAddress
op_ne
l_int|NULL
)paren
r_return
l_bool|true
suffix:semicolon
multiline_comment|/* Enable the Memory Mailbox Interface. */
id|Controller-&gt;DualModeMemoryMailboxInterface
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode
op_assign
l_int|0x2B
suffix:semicolon
id|CommandMailbox.TypeX.CommandIdentifier
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x14
suffix:semicolon
id|CommandMailbox.TypeX.CommandMailboxesBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;FirstCommandMailbox
)paren
suffix:semicolon
id|CommandMailbox.TypeX.StatusMailboxesBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;FirstStatusMailbox
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|Controller-&gt;ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_V5_HardwareMailboxEmptyP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_V5_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_V5_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_V5_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_V5_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V5_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V5_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V4_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_V4_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_V4_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_V4_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_V4_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V4_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V4_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DetectControllers detects DAC960 PCI RAID Controllers by interrogating&n;  the PCI Configuration Space for Controller Type.&n;*/
DECL|function|DAC960_DetectControllers
r_static
r_void
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_ControllerType_T
id|ControllerType
)paren
(brace
r_int
r_int
id|VendorID
op_assign
l_int|0
comma
id|DeviceID
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|MemoryWindowSize
op_assign
l_int|0
suffix:semicolon
id|PCI_Device_T
op_star
id|PCI_Device
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_DEC
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_DEC_21285
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_V5_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960P_V4
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_V4_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960P_V3
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_V3_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|PCI_Device
op_assign
id|pci_find_device
c_func
(paren
id|VendorID
comma
id|DeviceID
comma
id|PCI_Device
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_Controller_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|DAC960_IO_Address_T
id|IO_Address
op_assign
l_int|0
suffix:semicolon
id|DAC960_PCI_Address_T
id|PCI_Address
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|Bus
op_assign
id|PCI_Device-&gt;bus-&gt;number
suffix:semicolon
r_int
r_char
id|DeviceFunction
op_assign
id|PCI_Device-&gt;devfn
suffix:semicolon
r_int
r_char
id|Device
op_assign
id|DeviceFunction
op_rshift
l_int|3
suffix:semicolon
r_int
r_char
id|Function
op_assign
id|DeviceFunction
op_amp
l_int|0x7
suffix:semicolon
r_int
r_int
id|IRQ_Channel
op_assign
id|PCI_Device-&gt;irq
suffix:semicolon
r_int
r_int
id|BaseAddress0
op_assign
id|PCI_Device-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
r_int
r_int
id|BaseAddress1
op_assign
id|PCI_Device-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
r_int
r_int
id|SubsystemVendorID
comma
id|SubsystemDeviceID
suffix:semicolon
r_int
id|CommandIdentifier
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|PCI_Device
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|SubsystemVendorID
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|PCI_Device
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|SubsystemDeviceID
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|SubsystemVendorID
op_eq
id|PCI_VENDOR_ID_MYLEX
op_logical_and
id|SubsystemDeviceID
op_eq
id|PCI_DEVICE_ID_MYLEX_DAC960P_V5
)paren
)paren
r_goto
id|Ignore
suffix:semicolon
id|PCI_Address
op_assign
id|BaseAddress0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
id|PCI_Address
op_assign
id|BaseAddress0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
id|IO_Address
op_assign
id|BaseAddress0
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
id|PCI_Address
op_assign
id|BaseAddress1
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DAC960_ControllerCount
op_eq
id|DAC960_MaxControllers
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;More than %d DAC960 Controllers detected - &quot;
l_string|&quot;ignoring from Controller at&bslash;n&quot;
comma
l_int|NULL
comma
id|DAC960_MaxControllers
)paren
suffix:semicolon
r_goto
id|Ignore
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to allocate Controller structure for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|Ignore
suffix:semicolon
)brace
id|memset
c_func
(paren
id|Controller
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_Controller_T
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
id|Controller-&gt;ControllerNumber
op_assign
id|DAC960_ControllerCount
suffix:semicolon
id|DAC960_Controllers
(braket
id|DAC960_ControllerCount
op_increment
)braket
op_assign
id|Controller
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;ControllerType
op_assign
id|ControllerType
suffix:semicolon
id|Controller-&gt;IO_Address
op_assign
id|IO_Address
suffix:semicolon
id|Controller-&gt;PCI_Address
op_assign
id|PCI_Address
suffix:semicolon
id|Controller-&gt;Bus
op_assign
id|Bus
suffix:semicolon
id|Controller-&gt;Device
op_assign
id|Device
suffix:semicolon
id|Controller-&gt;Function
op_assign
id|Function
suffix:semicolon
id|sprintf
c_func
(paren
id|Controller-&gt;ControllerName
comma
l_string|&quot;c%d&quot;
comma
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Acquire shared access to the IRQ Channel.&n;      */
r_if
c_cond
(paren
id|IRQ_Channel
op_eq
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;IRQ Channel %d illegal for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|IRQ_Channel
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;DAC960&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_Channel
comma
id|DAC960_InterruptHandler
comma
id|SA_SHIRQ
comma
id|Controller-&gt;FullModelName
comma
id|Controller
)paren
OL
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to acquire IRQ Channel %d for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|IRQ_Channel
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|Controller-&gt;IRQ_Channel
op_assign
id|IRQ_Channel
suffix:semicolon
multiline_comment|/*&n;&t;Map the Controller Register Window.&n;      */
r_if
c_cond
(paren
id|MemoryWindowSize
OL
id|PAGE_SIZE
)paren
id|MemoryWindowSize
op_assign
id|PAGE_SIZE
suffix:semicolon
id|Controller-&gt;MemoryMappedAddress
op_assign
id|ioremap_nocache
c_func
(paren
id|PCI_Address
op_amp
id|PAGE_MASK
comma
id|MemoryWindowSize
)paren
suffix:semicolon
id|Controller-&gt;BaseAddress
op_assign
id|Controller-&gt;MemoryMappedAddress
op_plus
(paren
id|PCI_Address
op_amp
op_complement
id|PAGE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to map Controller Register Window for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
id|DAC960_V5_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_V5_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
id|DAC960_V4_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_V4_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
id|request_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
comma
id|Controller-&gt;FullModelName
)paren
suffix:semicolon
id|DAC960_V3_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_ActiveControllerCount
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|CommandIdentifier
op_assign
l_int|0
suffix:semicolon
id|CommandIdentifier
OL
id|DAC960_MaxChannels
suffix:semicolon
id|CommandIdentifier
op_increment
)paren
(brace
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
dot
id|Controller
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
dot
id|Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
suffix:semicolon
)brace
r_continue
suffix:semicolon
id|Failure
suffix:colon
r_if
c_cond
(paren
id|IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Bus
comma
id|Device
comma
id|Function
comma
id|PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Bus
comma
id|Device
comma
id|Function
comma
id|IO_Address
comma
id|PCI_Address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IRQ_Channel
OG
l_int|0
)paren
id|free_irq
c_func
(paren
id|IRQ_Channel
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
op_ne
l_int|NULL
)paren
id|iounmap
c_func
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
suffix:semicolon
id|DAC960_Controllers
(braket
id|Controller-&gt;ControllerNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|Ignore
suffix:colon
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_ReadControllerConfiguration reads the Configuration Information&n;  from Controller and initializes the Controller structure.&n;*/
DECL|function|DAC960_ReadControllerConfiguration
r_static
id|boolean
id|DAC960_ReadControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Enquiry2_T
id|Enquiry2
suffix:semicolon
id|DAC960_Config2_T
id|Config2
suffix:semicolon
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_Enquiry
comma
op_amp
id|Controller-&gt;Enquiry
(braket
l_int|0
)braket
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_Enquiry2
comma
op_amp
id|Enquiry2
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_ReadConfig2
comma
op_amp
id|Config2
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;READ CONFIG2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_GetLogicalDriveInformation
comma
op_amp
id|Controller-&gt;LogicalDriveInformation
(braket
l_int|0
)braket
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET LOGICAL DRIVE INFORMATION&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Enquiry2.ActualChannels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|DAC960_MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ExecuteType3D
c_func
(paren
id|Controller
comma
id|DAC960_GetDeviceState
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|Controller-&gt;DeviceState
(braket
l_int|0
)braket
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET DEVICE STATE&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Model Name and Full Model Name fields.&n;  */
r_switch
c_cond
(paren
id|Enquiry2.HardwareID.SubModel
)paren
(brace
r_case
id|DAC960_P_PD_PU
suffix:colon
r_if
c_cond
(paren
id|Enquiry2.SCSICapability.BusSpeed
op_eq
id|DAC960_Ultra
)paren
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PU&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PD&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PG&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PJ
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PJ&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PR
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PR&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PT
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PT&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PTL0
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL0&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PRL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PRL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PTL1
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL1&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC1164_P
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC1164P&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;MODEL VERIFICATION&quot;
)paren
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;Mylex &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|Controller-&gt;FullModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Firmware Version field and verify that it&n;    is a supported firmware version.  The supported firmware versions are:&n;&n;    DAC1164P&t;&t;    5.06 and above&n;    DAC960PTL/PRL/PJ/PG&t;    4.06 and above&n;    DAC960PU/PD/PL&t;    3.51 and above&n;  */
id|sprintf
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;%d.%02d-%c-%02d&quot;
comma
id|Enquiry2.FirmwareID.MajorVersion
comma
id|Enquiry2.FirmwareID.MinorVersion
comma
id|Enquiry2.FirmwareID.FirmwareType
comma
id|Enquiry2.FirmwareID.TurnID
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;5&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;5.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;4&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;4.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;3&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;3.51&quot;
)paren
op_ge
l_int|0
)paren
)paren
)paren
(brace
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;FIRMWARE VERSION VERIFICATION&quot;
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;Firmware Version = &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Channels, Memory Size, and SAF-TE Enclosure&n;    Management Enabled fields.&n;  */
id|Controller-&gt;Channels
op_assign
id|Enquiry2.ActualChannels
suffix:semicolon
id|Controller-&gt;MemorySize
op_assign
id|Enquiry2.MemorySize
op_rshift
l_int|20
suffix:semicolon
id|Controller-&gt;SAFTE_EnclosureManagementEnabled
op_assign
id|Enquiry2.FaultManagementType
op_eq
id|DAC960_SAFTE
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Queue Depth, Driver Queue Depth, Logical Drive&n;    Count, Maximum Blocks per Command, and Maximum Scatter/Gather Segments.&n;    The Driver Queue Depth must be at most one less than the Controller Queue&n;    Depth to allow for an automatic drive rebuild operation.&n;  */
id|Controller-&gt;ControllerQueueDepth
op_assign
id|Controller-&gt;Enquiry
(braket
l_int|0
)braket
dot
id|MaxCommands
suffix:semicolon
id|Controller-&gt;DriverQueueDepth
op_assign
id|Controller-&gt;ControllerQueueDepth
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|Controller-&gt;Enquiry
(braket
l_int|0
)braket
dot
id|NumberOfLogicalDrives
suffix:semicolon
id|Controller-&gt;MaxBlocksPerCommand
op_assign
id|Enquiry2.MaxBlocksPerCommand
suffix:semicolon
id|Controller-&gt;MaxScatterGatherSegments
op_assign
id|Enquiry2.MaxScatterGatherEntries
suffix:semicolon
multiline_comment|/*&n;    Initialize the Stripe Size, Segment Size, and Geometry Translation.&n;  */
id|Controller-&gt;StripeSize
op_assign
id|Config2.BlocksPerStripe
op_star
id|Config2.BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
id|Controller-&gt;SegmentSize
op_assign
id|Config2.BlocksPerCacheLine
op_star
id|Config2.BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Config2.DriveGeometry
)paren
(brace
r_case
id|DAC960_Geometry_128_32
suffix:colon
id|Controller-&gt;GeometryTranslationHeads
op_assign
l_int|128
suffix:semicolon
id|Controller-&gt;GeometryTranslationSectors
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_Geometry_255_63
suffix:colon
id|Controller-&gt;GeometryTranslationHeads
op_assign
l_int|255
suffix:semicolon
id|Controller-&gt;GeometryTranslationSectors
op_assign
l_int|63
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;CONFIG2 DRIVE GEOMETRY&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Logical Drive Initial State.&n;  */
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
id|Controller-&gt;LogicalDriveInitialState
(braket
id|LogicalDriveNumber
)braket
op_assign
id|Controller-&gt;LogicalDriveInformation
(braket
l_int|0
)braket
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveState
suffix:semicolon
id|Controller-&gt;LastRebuildStatus
op_assign
id|DAC960_NoRebuildOrCheckInProgress
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReportControllerConfiguration reports the Configuration Information of&n;  Controller.&n;*/
DECL|function|DAC960_ReportControllerConfiguration
r_static
id|boolean
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;Configuring Mylex %s PCI RAID Controller&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Firmware Version: %s, Channels: %d, Memory Size: %dMB&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
comma
id|Controller-&gt;Channels
comma
id|Controller-&gt;MemorySize
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Bus: %d, Device: %d, Function: %d, I/O Address: &quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;Unassigned&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IO_Address
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Address: 0x%X mapped at 0x%lX, IRQ Channel: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;PCI_Address
comma
(paren
r_int
r_int
)paren
id|Controller-&gt;BaseAddress
comma
id|Controller-&gt;IRQ_Channel
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Controller Queue Depth: %d, &quot;
l_string|&quot;Maximum Blocks per Command: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerQueueDepth
comma
id|Controller-&gt;MaxBlocksPerCommand
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Driver Queue Depth: %d, &quot;
l_string|&quot;Maximum Scatter/Gather Segments: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;DriverQueueDepth
comma
id|Controller-&gt;MaxScatterGatherSegments
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Stripe Size: %dKB, Segment Size: %dKB, &quot;
l_string|&quot;BIOS Geometry: %d/%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;StripeSize
comma
id|Controller-&gt;SegmentSize
comma
id|Controller-&gt;GeometryTranslationHeads
comma
id|Controller-&gt;GeometryTranslationSectors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;SAFTE_EnclosureManagementEnabled
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;  SAF-TE Enclosure Management Enabled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReadDeviceConfiguration reads the Device Configuration Information by&n;  requesting the SCSI Inquiry and SCSI Inquiry Unit Serial Number information&n;  for each device connected to Controller.&n;*/
DECL|function|DAC960_ReadDeviceConfiguration
r_static
id|boolean
id|DAC960_ReadDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_DCDB_T
id|DCDBs
(braket
id|DAC960_MaxChannels
)braket
comma
op_star
id|DCDB
suffix:semicolon
id|Semaphore_T
id|Semaphores
(braket
id|DAC960_MaxChannels
)braket
comma
op_star
id|Semaphore
suffix:semicolon
r_int
r_int
id|ProcessorFlags
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|DAC960_MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Semaphore
op_assign
op_amp
id|Semaphores
(braket
id|Channel
)braket
suffix:semicolon
id|init_MUTEX_LOCKED
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
id|DCDB
op_assign
op_amp
id|DCDBs
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Semaphore
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_DCDB
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Channel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|TargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryStandardData
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Semaphore
op_assign
op_amp
id|Semaphores
(braket
id|Channel
)braket
suffix:semicolon
id|down
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;CommandStatus
op_ne
id|DAC960_NormalCompletion
)paren
r_continue
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Semaphore
suffix:semicolon
id|DCDB
op_assign
op_amp
id|DCDBs
(braket
id|Channel
)braket
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|down
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
)brace
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReportDeviceConfiguration reports the Device Configuration Information&n;  of Controller.&n;*/
DECL|function|DAC960_ReportDeviceConfiguration
r_static
id|boolean
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Physical Devices:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|DAC960_MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_ErrorTable_T
op_star
id|ErrorTable
op_assign
op_amp
id|Controller-&gt;ErrorTable
(braket
id|Controller-&gt;ErrorTableIndex
)braket
suffix:semicolon
id|DAC960_ErrorTableEntry_T
op_star
id|ErrorEntry
op_assign
op_amp
id|ErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_char
id|Vendor
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
suffix:semicolon
r_char
id|Model
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
suffix:semicolon
r_char
id|Revision
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
suffix:semicolon
r_char
id|SerialNumber
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryUnitSerialNumber
op_member_access_from_pointer
id|ProductSerialNumber
)paren
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|InquiryStandardData-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|Vendor
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|VendorCharacter
op_assign
id|InquiryStandardData-&gt;VendorIdentification
(braket
id|i
)braket
suffix:semicolon
id|Vendor
(braket
id|i
)braket
op_assign
(paren
id|VendorCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|VendorCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|VendorCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Vendor
(braket
r_sizeof
(paren
id|Vendor
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|Model
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|ModelCharacter
op_assign
id|InquiryStandardData-&gt;ProductIdentification
(braket
id|i
)braket
suffix:semicolon
id|Model
(braket
id|i
)braket
op_assign
(paren
id|ModelCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|ModelCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|ModelCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Model
(braket
r_sizeof
(paren
id|Model
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|Revision
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|RevisionCharacter
op_assign
id|InquiryStandardData-&gt;ProductRevisionLevel
(braket
id|i
)braket
suffix:semicolon
id|Revision
(braket
id|i
)braket
op_assign
(paren
id|RevisionCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|RevisionCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|RevisionCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Revision
(braket
r_sizeof
(paren
id|Revision
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    %d:%d%s Vendor: %s  Model: %s  Revision: %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|TargetID
OL
l_int|10
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|Vendor
comma
id|Model
comma
id|Revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_ne
l_int|0x1F
)paren
(brace
r_int
id|SerialNumberLength
op_assign
id|InquiryUnitSerialNumber-&gt;PageLength
suffix:semicolon
r_if
c_cond
(paren
id|SerialNumberLength
OG
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
)paren
id|SerialNumberLength
op_assign
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SerialNumberLength
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|SerialNumberCharacter
op_assign
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
(braket
id|i
)braket
suffix:semicolon
id|SerialNumber
(braket
id|i
)braket
op_assign
(paren
id|SerialNumberCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|SerialNumberCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|SerialNumberCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|SerialNumber
(braket
id|SerialNumberLength
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;         Serial Number: %s&bslash;n&quot;
comma
id|Controller
comma
id|SerialNumber
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_DiskType
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %d blocks, %d resets&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
comma
id|Controller-&gt;DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %d blocks&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ErrorEntry-&gt;ParityErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;SoftErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;HardErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;MiscErrorCount
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Errors - Parity: %d, Soft: %d, &quot;
l_string|&quot;Hard: %d, Misc: %d&bslash;n&quot;
comma
id|Controller
comma
id|ErrorEntry-&gt;ParityErrorCount
comma
id|ErrorEntry-&gt;SoftErrorCount
comma
id|ErrorEntry-&gt;HardErrorCount
comma
id|ErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Logical Drives:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_LogicalDriveInformation_T
op_star
id|LogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
)braket
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    /dev/rd/c%dd%d: RAID-%d, %s, %d blocks, %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|LogicalDriveInformation-&gt;RAIDLevel
comma
(paren
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_LogicalDrive_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_LogicalDrive_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
l_string|&quot;Offline&quot;
)paren
comma
id|LogicalDriveInformation-&gt;LogicalDriveSize
comma
(paren
id|LogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;Write Back&quot;
suffix:colon
l_string|&quot;Write Thru&quot;
)paren
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RegisterBlockDevice registers the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_RegisterBlockDevice
r_static
id|boolean
id|DAC960_RegisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_static
r_void
(paren
op_star
id|RequestFunctions
(braket
id|DAC960_MaxControllers
)braket
)paren
(paren
id|request_queue_t
op_star
)paren
op_assign
(brace
id|DAC960_RequestFunction0
comma
id|DAC960_RequestFunction1
comma
id|DAC960_RequestFunction2
comma
id|DAC960_RequestFunction3
comma
id|DAC960_RequestFunction4
comma
id|DAC960_RequestFunction5
comma
id|DAC960_RequestFunction6
comma
id|DAC960_RequestFunction7
)brace
suffix:semicolon
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
id|GenericDiskInfo_T
op_star
id|GenericDiskInfo
suffix:semicolon
r_int
id|MinorNumber
suffix:semicolon
multiline_comment|/*&n;    Register the Block Device Major Number for this DAC960 Controller.&n;  */
r_if
c_cond
(paren
id|register_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;rd&quot;
comma
op_amp
id|DAC960_FileOperations
)paren
OL
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;UNABLE TO ACQUIRE MAJOR NUMBER %d - DETACHING&bslash;n&quot;
comma
id|Controller
comma
id|MajorNumber
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the I/O Request Function.&n;  */
id|blk_init_queue
c_func
(paren
id|BLK_DEFAULT_QUEUE
c_func
(paren
id|MajorNumber
)paren
comma
id|RequestFunctions
(braket
id|Controller-&gt;ControllerNumber
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Disk Partitions array, Partition Sizes array, Block Sizes&n;    array, Max Sectors per Request array, and Max Segments per Request array.&n;  */
r_for
c_loop
(paren
id|MinorNumber
op_assign
l_int|0
suffix:semicolon
id|MinorNumber
OL
id|DAC960_MinorCount
suffix:semicolon
id|MinorNumber
op_increment
)paren
(brace
id|Controller-&gt;BlockSizes
(braket
id|MinorNumber
)braket
op_assign
id|BLOCK_SIZE
suffix:semicolon
id|Controller-&gt;MaxSectorsPerRequest
(braket
id|MinorNumber
)braket
op_assign
id|Controller-&gt;MaxBlocksPerCommand
suffix:semicolon
id|Controller-&gt;MaxSegmentsPerRequest
(braket
id|MinorNumber
)braket
op_assign
id|Controller-&gt;MaxScatterGatherSegments
suffix:semicolon
)brace
id|Controller-&gt;GenericDiskInfo.part
op_assign
id|Controller-&gt;DiskPartitions
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.sizes
op_assign
id|Controller-&gt;PartitionSizes
suffix:semicolon
id|blksize_size
(braket
id|MajorNumber
)braket
op_assign
id|Controller-&gt;BlockSizes
suffix:semicolon
id|max_sectors
(braket
id|MajorNumber
)braket
op_assign
id|Controller-&gt;MaxSectorsPerRequest
suffix:semicolon
id|max_segments
(braket
id|MajorNumber
)braket
op_assign
id|Controller-&gt;MaxSegmentsPerRequest
suffix:semicolon
multiline_comment|/*&n;    Initialize Read Ahead to 128 sectors.&n;  */
id|read_ahead
(braket
id|MajorNumber
)braket
op_assign
l_int|128
suffix:semicolon
multiline_comment|/*&n;    Complete initialization of the Generic Disk Information structure.&n;  */
id|Controller-&gt;GenericDiskInfo.major
op_assign
id|MajorNumber
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.major_name
op_assign
l_string|&quot;rd&quot;
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.minor_shift
op_assign
id|DAC960_MaxPartitionsBits
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.max_p
op_assign
id|DAC960_MaxPartitions
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.max_nr
op_assign
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.init
op_assign
id|DAC960_InitializeGenericDiskInfo
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.nr_real
op_assign
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.real_devices
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.next
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;    Install the Generic Disk Information structure at the end of the list.&n;  */
r_if
c_cond
(paren
(paren
id|GenericDiskInfo
op_assign
id|gendisk_head
)paren
op_ne
l_int|NULL
)paren
(brace
r_while
c_loop
(paren
id|GenericDiskInfo-&gt;next
op_ne
l_int|NULL
)paren
id|GenericDiskInfo
op_assign
id|GenericDiskInfo-&gt;next
suffix:semicolon
id|GenericDiskInfo-&gt;next
op_assign
op_amp
id|Controller-&gt;GenericDiskInfo
suffix:semicolon
)brace
r_else
id|gendisk_head
op_assign
op_amp
id|Controller-&gt;GenericDiskInfo
suffix:semicolon
multiline_comment|/*&n;    Indicate the Block Device Registration completed successfully,&n;  */
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_UnregisterBlockDevice unregisters the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_UnregisterBlockDevice
r_static
r_void
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
multiline_comment|/*&n;    Unregister the Block Device Major Number for this DAC960 Controller.&n;  */
id|unregister_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;rd&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Remove the I/O Request Function.&n;  */
id|blk_cleanup_queue
c_func
(paren
id|BLK_DEFAULT_QUEUE
c_func
(paren
id|MajorNumber
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Remove the Disk Partitions array, Partition Sizes array, Block Sizes&n;    array, Max Sectors per Request array, and Max Segments per Request array.&n;  */
id|Controller-&gt;GenericDiskInfo.part
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.sizes
op_assign
l_int|NULL
suffix:semicolon
id|blk_size
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|blksize_size
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|max_sectors
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|max_segments
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;    Remove the Generic Disk Information structure from the list.&n;  */
r_if
c_cond
(paren
id|gendisk_head
op_ne
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
(brace
id|GenericDiskInfo_T
op_star
id|GenericDiskInfo
op_assign
id|gendisk_head
suffix:semicolon
r_while
c_loop
(paren
id|GenericDiskInfo
op_ne
l_int|NULL
op_logical_and
id|GenericDiskInfo-&gt;next
op_ne
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
id|GenericDiskInfo
op_assign
id|GenericDiskInfo-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|GenericDiskInfo
op_ne
l_int|NULL
)paren
id|GenericDiskInfo-&gt;next
op_assign
id|GenericDiskInfo-&gt;next-&gt;next
suffix:semicolon
)brace
r_else
id|gendisk_head
op_assign
id|Controller-&gt;GenericDiskInfo.next
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_InitializeController initializes Controller.&n;*/
DECL|function|DAC960_InitializeController
r_static
r_void
id|DAC960_InitializeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|DAC960_ReadControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReadDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_RegisterBlockDevice
c_func
(paren
id|Controller
)paren
)paren
(brace
multiline_comment|/*&n;&t;Initialize the Command structures.&n;      */
id|DAC960_Command_T
op_star
id|Commands
op_assign
id|Controller-&gt;Commands
suffix:semicolon
r_int
id|CommandIdentifier
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|CommandIdentifier
op_assign
l_int|0
suffix:semicolon
id|CommandIdentifier
OL
id|Controller-&gt;DriverQueueDepth
suffix:semicolon
id|CommandIdentifier
op_increment
)paren
(brace
id|Commands
(braket
id|CommandIdentifier
)braket
dot
id|Controller
op_assign
id|Controller
suffix:semicolon
id|Commands
(braket
id|CommandIdentifier
)braket
dot
id|Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
op_amp
id|Commands
(braket
id|CommandIdentifier
)braket
suffix:semicolon
)brace
multiline_comment|/*&n;&t;Initialize the Monitoring Timer.&n;      */
id|init_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|Controller-&gt;MonitoringTimer.data
op_assign
(paren
r_int
r_int
)paren
id|Controller
suffix:semicolon
id|Controller-&gt;MonitoringTimer.function
op_assign
id|DAC960_MonitoringTimerFunction
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;ControllerInitialized
op_assign
l_bool|true
suffix:semicolon
)brace
r_else
id|DAC960_FinalizeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_FinalizeController finalizes Controller.&n;*/
DECL|function|DAC960_FinalizeController
r_static
r_void
id|DAC960_FinalizeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ControllerInitialized
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Flushing Cache...&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_Flush
comma
l_int|NULL
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;done&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;DualModeMemoryMailboxInterface
)paren
id|DAC960_V5_SaveMemoryMailboxInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;DualModeMemoryMailboxInterface
)paren
id|DAC960_V4_SaveMemoryMailboxInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
r_break
suffix:semicolon
)brace
)brace
id|free_irq
c_func
(paren
id|Controller-&gt;IRQ_Channel
comma
id|Controller
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
OG
l_int|0
)paren
id|release_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
)paren
suffix:semicolon
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_Controllers
(braket
id|Controller-&gt;ControllerNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Initialize initializes the DAC960 Driver.&n;*/
DECL|function|DAC960_Initialize
r_void
id|DAC960_Initialize
c_func
(paren
r_void
)paren
(brace
r_int
id|ControllerNumber
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_V5_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_V4_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_V3_Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ActiveControllerCount
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
r_if
c_cond
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
op_ne
l_int|NULL
)paren
id|DAC960_InitializeController
c_func
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
)paren
suffix:semicolon
id|DAC960_CreateProcEntries
c_func
(paren
)paren
suffix:semicolon
id|register_reboot_notifier
c_func
(paren
op_amp
id|DAC960_NotifierBlock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Finalize finalizes the DAC960 Driver.&n;*/
DECL|function|DAC960_Finalize
r_static
r_int
id|DAC960_Finalize
c_func
(paren
id|NotifierBlock_T
op_star
id|NotifierBlock
comma
r_int
r_int
id|Event
comma
r_void
op_star
id|Buffer
)paren
(brace
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|Event
op_eq
id|SYS_RESTART
op_logical_or
id|Event
op_eq
id|SYS_HALT
op_logical_or
id|Event
op_eq
id|SYS_POWER_OFF
)paren
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ActiveControllerCount
op_eq
l_int|0
)paren
r_return
id|NOTIFY_OK
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
r_if
c_cond
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
op_ne
l_int|NULL
)paren
id|DAC960_FinalizeController
c_func
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
)paren
suffix:semicolon
id|DAC960_DestroyProcEntries
c_func
(paren
)paren
suffix:semicolon
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|DAC960_NotifierBlock
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessRequest attempts to remove one I/O Request from Controller&squot;s&n;  I/O Request Queue and queues it to the Controller.  WaitForCommand is true if&n;  this function should wait for a Command to become available if necessary.&n;  This function returns true if an I/O Request was queued and false otherwise.&n;*/
DECL|function|DAC960_ProcessRequest
r_static
id|boolean
id|DAC960_ProcessRequest
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|boolean
id|WaitForCommand
)paren
(brace
id|IO_Request_T
op_star
op_star
id|RequestQueuePointer
op_assign
op_amp
id|blk_dev
(braket
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
)braket
dot
id|request_queue.current_request
suffix:semicolon
id|IO_Request_T
op_star
id|Request
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_char
op_star
id|RequestBuffer
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|Request
op_assign
op_star
id|RequestQueuePointer
suffix:semicolon
r_if
c_cond
(paren
id|Request
op_eq
l_int|NULL
op_logical_or
id|Request-&gt;rq_status
op_eq
id|RQ_INACTIVE
)paren
r_return
l_bool|false
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|WaitForCommand
)paren
r_return
l_bool|false
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
id|sleep_on
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
)brace
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Request-&gt;cmd
op_eq
id|READ
)paren
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadCommand
suffix:semicolon
r_else
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteCommand
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Request-&gt;sem
suffix:semicolon
id|Command-&gt;LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Request-&gt;rq_dev
)paren
suffix:semicolon
id|Command-&gt;BlockNumber
op_assign
id|Request-&gt;sector
op_plus
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Request-&gt;rq_dev
)paren
)braket
dot
id|start_sect
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|Request-&gt;nr_sectors
suffix:semicolon
id|Command-&gt;SegmentCount
op_assign
id|Request-&gt;nr_segments
suffix:semicolon
id|Command-&gt;BufferHeader
op_assign
id|Request-&gt;bh
suffix:semicolon
id|RequestBuffer
op_assign
id|Request-&gt;buffer
suffix:semicolon
id|Request-&gt;rq_status
op_assign
id|RQ_INACTIVE
suffix:semicolon
op_star
id|RequestQueuePointer
op_assign
id|Request-&gt;next
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|wait_for_request
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
op_eq
l_int|1
)paren
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_Read
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_Write
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|RequestBuffer
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|DAC960_ScatterGatherSegment_T
op_star
id|ScatterGatherList
op_assign
id|Command-&gt;ScatterGatherList
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_char
op_star
id|LastDataEndPointer
op_assign
l_int|NULL
suffix:semicolon
r_int
id|SegmentNumber
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_ReadWithOldScatterGather
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_WriteWithOldScatterGather
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|ScatterGatherList
)paren
suffix:semicolon
id|CommandMailbox-&gt;Type5.ScatterGatherCount
op_assign
id|Command-&gt;SegmentCount
suffix:semicolon
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|BufferHeader-&gt;b_data
op_eq
id|LastDataEndPointer
)paren
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
op_minus
l_int|1
)braket
dot
id|SegmentByteCount
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
)brace
r_else
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentByteCount
op_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_assign
id|BufferHeader-&gt;b_data
op_plus
id|BufferHeader-&gt;b_size
suffix:semicolon
r_if
c_cond
(paren
id|SegmentNumber
op_increment
OG
id|Controller-&gt;MaxScatterGatherSegments
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: Scatter/Gather Segment Overflow&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|BufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SegmentNumber
op_ne
id|Command-&gt;SegmentCount
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: SegmentNumber != SegmentCount&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessRequests attempts to remove as many I/O Requests as possible&n;  from Controller&squot;s I/O Request Queue and queue them to the Controller.&n;*/
DECL|function|DAC960_ProcessRequests
r_static
r_inline
r_void
id|DAC960_ProcessRequests
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|Counter
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
id|Counter
op_increment
op_eq
l_int|0
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction0 is the I/O Request Function for DAC960 Controller 0.&n;*/
DECL|function|DAC960_RequestFunction0
r_static
r_void
id|DAC960_RequestFunction0
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|0
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction1 is the I/O Request Function for DAC960 Controller 1.&n;*/
DECL|function|DAC960_RequestFunction1
r_static
r_void
id|DAC960_RequestFunction1
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|1
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction2 is the I/O Request Function for DAC960 Controller 2.&n;*/
DECL|function|DAC960_RequestFunction2
r_static
r_void
id|DAC960_RequestFunction2
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|2
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction3 is the I/O Request Function for DAC960 Controller 3.&n;*/
DECL|function|DAC960_RequestFunction3
r_static
r_void
id|DAC960_RequestFunction3
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|3
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction4 is the I/O Request Function for DAC960 Controller 4.&n;*/
DECL|function|DAC960_RequestFunction4
r_static
r_void
id|DAC960_RequestFunction4
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|4
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction5 is the I/O Request Function for DAC960 Controller 5.&n;*/
DECL|function|DAC960_RequestFunction5
r_static
r_void
id|DAC960_RequestFunction5
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|5
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction6 is the I/O Request Function for DAC960 Controller 6.&n;*/
DECL|function|DAC960_RequestFunction6
r_static
r_void
id|DAC960_RequestFunction6
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|6
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction7 is the I/O Request Function for DAC960 Controller 7.&n;*/
DECL|function|DAC960_RequestFunction7
r_static
r_void
id|DAC960_RequestFunction7
c_func
(paren
id|request_queue_t
op_star
id|q
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
l_int|7
)braket
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReadWriteError prints an appropriate error message for Command when&n;  an error occurs on a Read or Write operation.&n;*/
DECL|function|DAC960_ReadWriteError
r_static
r_void
id|DAC960_ReadWriteError
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_char
op_star
id|CommandName
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandType
)paren
(brace
r_case
id|DAC960_ReadCommand
suffix:colon
r_case
id|DAC960_ReadRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;READ&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_WriteCommand
suffix:colon
r_case
id|DAC960_WriteRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;WRITE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_MonitoringCommand
suffix:colon
r_case
id|DAC960_ImmediateCommand
suffix:colon
r_case
id|DAC960_QueuedCommand
suffix:colon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|Command-&gt;CommandStatus
)paren
(brace
r_case
id|DAC960_IrrecoverableDataError
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Irrecoverable Data Error on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LogicalDriveNonexistentOrOffline
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Logical Drive Nonexistent or Offline on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_AccessBeyondEndOfLogicalDrive
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Attempt to Access Beyond End of Logical Drive &quot;
l_string|&quot;on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_BadDataEncountered
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Bad Data Encountered on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Unexpected Error Status %04X on %s:&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;CommandStatus
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%d:   absolute blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|Command-&gt;BlockNumber
comma
id|Command-&gt;BlockNumber
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
OG
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%dp%d: relative blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessCompletedBuffer performs completion processing for an&n;  individual Buffer.&n;*/
DECL|function|DAC960_ProcessCompletedBuffer
r_static
r_inline
r_void
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader_T
op_star
id|BufferHeader
comma
id|boolean
id|SuccessfulIO
)paren
(brace
id|BufferHeader
op_member_access_from_pointer
id|b_end_io
c_func
(paren
id|BufferHeader
comma
id|SuccessfulIO
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessCompletedCommand performs completion processing for Command.&n;*/
DECL|function|DAC960_ProcessCompletedCommand
r_static
r_void
id|DAC960_ProcessCompletedCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandType_T
id|CommandType
op_assign
id|Command-&gt;CommandType
suffix:semicolon
id|DAC960_CommandOpcode_T
id|CommandOpcode
op_assign
id|Command-&gt;CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DAC960_CommandStatus_T
id|CommandStatus
op_assign
id|Command-&gt;CommandStatus
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
)paren
(brace
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
id|add_blkdev_randomness
c_func
(paren
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CommandStatus
op_eq
id|DAC960_IrrecoverableDataError
op_logical_or
id|CommandStatus
op_eq
id|DAC960_BadDataEncountered
)paren
op_logical_and
id|BufferHeader
op_ne
l_int|NULL
op_logical_and
id|BufferHeader-&gt;b_reqnext
op_ne
l_int|NULL
)paren
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
)paren
(brace
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadRetryCommand
suffix:semicolon
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_Read
suffix:semicolon
)brace
r_else
(brace
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteRetryCommand
suffix:semicolon
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_Write
suffix:semicolon
)brace
id|Command-&gt;BlockCount
op_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadRetryCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteRetryCommand
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;Perform completion processing for this single buffer.&n;      */
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
)paren
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NextBufferHeader
op_ne
l_int|NULL
)paren
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|Command-&gt;BlockNumber
op_add_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|NextBufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|NextBufferHeader-&gt;b_data
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
op_logical_or
id|CommandOpcode
op_eq
id|DAC960_Enquiry
op_logical_or
id|CommandOpcode
op_eq
id|DAC960_GetRebuildProgress
)paren
(brace
r_if
c_cond
(paren
id|CommandType
op_ne
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_Enquiry
)paren
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
op_xor
l_int|1
)braket
comma
id|Bus_to_Virtual
c_func
(paren
id|Command-&gt;CommandMailbox.Type3.BusAddress
)paren
comma
r_sizeof
(paren
id|DAC960_Enquiry_T
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_GetRebuildProgress
)paren
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;RebuildProgress
comma
id|Bus_to_Virtual
c_func
(paren
id|Command-&gt;CommandMailbox.Type3.BusAddress
)paren
comma
r_sizeof
(paren
id|DAC960_RebuildProgress_T
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_Enquiry
)paren
(brace
id|DAC960_Enquiry_T
op_star
id|OldEnquiry
op_assign
op_amp
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
)braket
suffix:semicolon
id|DAC960_Enquiry_T
op_star
id|NewEnquiry
op_assign
op_amp
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
op_xor_assign
l_int|1
)braket
suffix:semicolon
r_int
r_int
id|OldCriticalLogicalDriveCount
op_assign
id|OldEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_int
r_int
id|NewCriticalLogicalDriveCount
op_assign
id|NewEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_if
c_cond
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
op_ne
id|OldEnquiry-&gt;StatusFlags.DeferredWriteError
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Deferred Write Error Flag is now %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewCriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewCriticalLogicalDriveCount
op_ne
id|OldCriticalLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;OfflineLogicalDriveCount
op_ne
id|OldEnquiry-&gt;OfflineLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;DeadDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;DeadDriveCount
op_ne
id|OldEnquiry-&gt;DeadDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;EventLogSequenceNumber
op_ne
id|OldEnquiry-&gt;EventLogSequenceNumber
)paren
op_logical_or
id|Controller-&gt;MonitoringTimerCount
op_eq
l_int|0
op_logical_or
(paren
id|jiffies
op_minus
id|Controller-&gt;SecondaryMonitoringTime
op_ge
id|DAC960_SecondaryMonitoringInterval
)paren
)paren
(brace
id|Controller-&gt;NeedLogicalDriveInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;NewEventLogSequenceNumber
op_assign
id|NewEnquiry-&gt;EventLogSequenceNumber
suffix:semicolon
id|Controller-&gt;NeedErrorTableInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;NeedDeviceStateInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;DeviceStateChannel
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;DeviceStateTargetID
op_assign
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;SecondaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_StandbyRebuildInProgress
op_logical_or
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_BackgroundRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_StandbyRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_BackgroundRebuildInProgress
)paren
id|Controller-&gt;NeedRebuildProgress
op_assign
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_BackgroundCheckInProgress
)paren
r_switch
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
)paren
(brace
r_case
id|DAC960_NoStandbyRebuildOrCheckInProgress
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_StandbyRebuildInProgress
suffix:colon
r_case
id|DAC960_BackgroundRebuildInProgress
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_BackgroundCheckInProgress
suffix:colon
id|Controller-&gt;NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_StandbyRebuildCompletedWithError
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed with Error&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_BackgroundRebuildOrCheckFailed_DriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Physical Drive Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_BackgroundRebuildOrCheckFailed_LogicalDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Logical Drive Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_BackgroundRebuildOrCheckFailed_OtherCauses
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - Other Causes&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_BackgroundRebuildOrCheckSuccessfullyTerminated
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Successfully Terminated&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_BackgroundCheckInProgress
)paren
id|Controller-&gt;NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_PerformEventLogOperation
)paren
(brace
r_static
r_char
op_star
id|DAC960_EventMessages
(braket
)braket
op_assign
(brace
l_string|&quot;killed because write recovery failed&quot;
comma
l_string|&quot;killed because of SCSI bus reset failure&quot;
comma
l_string|&quot;killed because of double check condition&quot;
comma
l_string|&quot;killed because it was removed&quot;
comma
l_string|&quot;killed because of gross error on SCSI chip&quot;
comma
l_string|&quot;killed because of bad tag returned from drive&quot;
comma
l_string|&quot;killed because of timeout on SCSI command&quot;
comma
l_string|&quot;killed because of reset SCSI command issued from system&quot;
comma
l_string|&quot;killed because busy or parity error count exceeded limit&quot;
comma
l_string|&quot;killed because of &squot;kill drive&squot; command from system&quot;
comma
l_string|&quot;killed because of selection timeout&quot;
comma
l_string|&quot;killed due to SCSI phase sequence error&quot;
comma
l_string|&quot;killed due to unknown status&quot;
)brace
suffix:semicolon
id|DAC960_EventLogEntry_T
op_star
id|EventLogEntry
op_assign
op_amp
id|Controller-&gt;EventLogEntry
suffix:semicolon
r_if
c_cond
(paren
id|EventLogEntry-&gt;SequenceNumber
op_eq
id|Controller-&gt;OldEventLogSequenceNumber
)paren
(brace
r_int
r_char
id|SenseKey
op_assign
id|EventLogEntry-&gt;SenseKey
suffix:semicolon
r_int
r_char
id|AdditionalSenseCode
op_assign
id|EventLogEntry-&gt;AdditionalSenseCode
suffix:semicolon
r_int
r_char
id|AdditionalSenseCodeQualifier
op_assign
id|EventLogEntry-&gt;AdditionalSenseCodeQualifier
suffix:semicolon
r_if
c_cond
(paren
id|SenseKey
op_eq
l_int|9
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x80
op_logical_and
id|AdditionalSenseCodeQualifier
OL
r_sizeof
(paren
id|DAC960_EventMessages
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Drive %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|DAC960_EventMessages
(braket
id|AdditionalSenseCodeQualifier
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|SenseKey
op_eq
l_int|6
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x29
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;MonitoringTimerCount
OG
l_int|0
)paren
id|Controller-&gt;DeviceResetCount
(braket
id|EventLogEntry-&gt;Channel
)braket
(braket
id|EventLogEntry-&gt;TargetID
)braket
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|SenseKey
op_eq
l_int|0
op_logical_or
(paren
id|SenseKey
op_eq
l_int|2
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x04
op_logical_and
(paren
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x01
op_logical_or
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x02
)paren
)paren
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Drive %d:%d Error Log: &quot;
l_string|&quot;Sense Key = %d, ASC = %02X, ASCQ = %02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|SenseKey
comma
id|AdditionalSenseCode
comma
id|AdditionalSenseCodeQualifier
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Drive %d:%d Error Log: &quot;
l_string|&quot;Information = %02X%02X%02X%02X &quot;
l_string|&quot;%02X%02X%02X%02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|EventLogEntry-&gt;Information
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|3
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
)brace
id|Controller-&gt;OldEventLogSequenceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_GetErrorTable
)paren
(brace
id|DAC960_ErrorTable_T
op_star
id|OldErrorTable
op_assign
op_amp
id|Controller-&gt;ErrorTable
(braket
id|Controller-&gt;ErrorTableIndex
)braket
suffix:semicolon
id|DAC960_ErrorTable_T
op_star
id|NewErrorTable
op_assign
op_amp
id|Controller-&gt;ErrorTable
(braket
id|Controller-&gt;ErrorTableIndex
op_xor_assign
l_int|1
)braket
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|DAC960_MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_ErrorTableEntry_T
op_star
id|NewErrorEntry
op_assign
op_amp
id|NewErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_ErrorTableEntry_T
op_star
id|OldErrorEntry
op_assign
op_amp
id|OldErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewErrorEntry-&gt;ParityErrorCount
op_ne
id|OldErrorEntry-&gt;ParityErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;SoftErrorCount
op_ne
id|OldErrorEntry-&gt;SoftErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;HardErrorCount
op_ne
id|OldErrorEntry-&gt;HardErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;MiscErrorCount
op_ne
id|OldErrorEntry-&gt;MiscErrorCount
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Drive %d:%d Errors: &quot;
l_string|&quot;Parity = %d, Soft = %d, &quot;
l_string|&quot;Hard = %d, Misc = %d&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|NewErrorEntry-&gt;ParityErrorCount
comma
id|NewErrorEntry-&gt;SoftErrorCount
comma
id|NewErrorEntry-&gt;HardErrorCount
comma
id|NewErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_GetDeviceState
)paren
(brace
id|DAC960_DeviceState_T
op_star
id|OldDeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
suffix:semicolon
id|DAC960_DeviceState_T
op_star
id|NewDeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
op_xor
l_int|1
)braket
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|NewDeviceState-&gt;DeviceState
op_ne
id|OldDeviceState-&gt;DeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Drive %d:%d is now %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;DeviceStateChannel
comma
id|Controller-&gt;DeviceStateTargetID
comma
(paren
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
ques
c_cond
l_string|&quot;DEAD&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_WriteOnly
ques
c_cond
l_string|&quot;WRITE-ONLY&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
l_string|&quot;STANDBY&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|OldDeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
op_logical_and
id|NewDeviceState-&gt;DeviceState
op_ne
id|DAC960_Device_Dead
)paren
(brace
id|Controller-&gt;NeedDeviceInquiryInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_GetLogicalDriveInformation
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_LogicalDriveInformation_T
op_star
id|OldLogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
)braket
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_LogicalDriveInformation_T
op_star
id|NewLogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
op_xor
l_int|1
)braket
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_ne
id|OldLogicalDriveInformation-&gt;LogicalDriveState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_LogicalDrive_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_LogicalDrive_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
l_string|&quot;OFFLINE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
op_ne
id|OldLogicalDriveInformation-&gt;WriteBack
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;WRITE BACK&quot;
suffix:colon
l_string|&quot;WRITE THRU&quot;
)paren
)paren
suffix:semicolon
)brace
id|Controller-&gt;LogicalDriveInformationIndex
op_xor_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_GetRebuildProgress
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;RebuildProgress.LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;RebuildProgress.LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;RebuildProgress.RemainingBlocks
suffix:semicolon
r_switch
c_cond
(paren
id|CommandStatus
)paren
(brace
r_case
id|DAC960_NormalCompletion
suffix:colon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_RebuildFailed_LogicalDriveFailure
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Logical Drive Failure&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_RebuildFailed_BadBlocksOnOther
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Bad Blocks on Other Drives&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_RebuildFailed_NewDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Failure of Drive Being Rebuilt&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_NoRebuildOrCheckInProgress
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;LastRebuildStatus
op_ne
id|DAC960_NormalCompletion
)paren
r_break
suffix:semicolon
r_case
id|DAC960_RebuildSuccessful
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|Controller-&gt;LastRebuildStatus
op_assign
id|CommandStatus
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_RebuildStat
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;RebuildProgress.LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;RebuildProgress.LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;RebuildProgress.RemainingBlocks
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
)paren
(brace
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;NewEventLogSequenceNumber
op_minus
id|Controller-&gt;OldEventLogSequenceNumber
OG
l_int|0
)paren
(brace
id|Command-&gt;CommandMailbox.Type3E.CommandOpcode
op_assign
id|DAC960_PerformEventLogOperation
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3E.OperationType
op_assign
id|DAC960_GetEventLogEntry
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3E.OperationQualifier
op_assign
l_int|1
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3E.SequenceNumber
op_assign
id|Controller-&gt;OldEventLogSequenceNumber
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3E.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;EventLogEntry
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedErrorTableInformation
)paren
(brace
id|Controller-&gt;NeedErrorTableInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_GetErrorTable
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;ErrorTable
(braket
id|Controller-&gt;ErrorTableIndex
op_xor
l_int|1
)braket
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedRebuildProgress
op_logical_and
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
)braket
dot
id|CriticalLogicalDriveCount
OL
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
op_xor
l_int|1
)braket
dot
id|CriticalLogicalDriveCount
)paren
(brace
id|Controller-&gt;NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_GetRebuildProgress
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedDeviceStateInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;NeedDeviceInquiryInformation
)paren
(brace
id|DAC960_DCDB_T
op_star
id|DCDB
op_assign
op_amp
id|Controller-&gt;MonitoringDCDB
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;InquiryStandardData
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_DCDB
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryStandardData
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;NeedDeviceInquiryInformation
op_assign
l_bool|false
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_DCDB_T
op_star
id|DCDB
op_assign
op_amp
id|Controller-&gt;MonitoringDCDB
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;InquiryUnitSerialNumber
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_DCDB
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;NeedDeviceSerialNumberInformation
op_assign
l_bool|false
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|Controller-&gt;DeviceStateTargetID
op_eq
id|DAC960_MaxTargets
)paren
(brace
id|Controller-&gt;DeviceStateChannel
op_increment
suffix:semicolon
id|Controller-&gt;DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|Controller-&gt;DeviceStateChannel
OL
id|Controller-&gt;Channels
)paren
(brace
id|DAC960_DeviceState_T
op_star
id|OldDeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|OldDeviceState-&gt;Present
op_logical_and
id|OldDeviceState-&gt;DeviceType
op_eq
id|DAC960_DiskType
)paren
(brace
id|Command-&gt;CommandMailbox.Type3D.CommandOpcode
op_assign
id|DAC960_GetDeviceState
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3D.Channel
op_assign
id|Controller-&gt;DeviceStateChannel
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3D.TargetID
op_assign
id|Controller-&gt;DeviceStateTargetID
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3D.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
op_xor
l_int|1
)braket
(braket
id|Controller-&gt;DeviceStateChannel
)braket
(braket
id|Controller-&gt;DeviceStateTargetID
)braket
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|Controller-&gt;DeviceStateTargetID
op_eq
id|DAC960_MaxTargets
)paren
(brace
id|Controller-&gt;DeviceStateChannel
op_increment
suffix:semicolon
id|Controller-&gt;DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|Controller-&gt;NeedDeviceStateInformation
op_assign
l_bool|false
suffix:semicolon
id|Controller-&gt;DeviceStateIndex
op_xor_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedLogicalDriveInformation
)paren
(brace
id|Controller-&gt;NeedLogicalDriveInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_GetLogicalDriveInformation
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
op_xor
l_int|1
)braket
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedRebuildProgress
)paren
(brace
id|Controller-&gt;NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_GetRebuildProgress
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;NeedConsistencyCheckProgress
)paren
(brace
id|Controller-&gt;NeedConsistencyCheckProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_RebuildStat
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;MonitoringTimerCount
op_increment
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ImmediateCommand
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_QueuedCommand
)paren
(brace
id|DAC960_KernelCommand_T
op_star
id|KernelCommand
op_assign
id|Command-&gt;KernelCommand
suffix:semicolon
id|KernelCommand-&gt;CommandStatus
op_assign
id|CommandStatus
suffix:semicolon
id|Command-&gt;KernelCommand
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
id|Controller-&gt;DirectCommandActive
(braket
id|KernelCommand-&gt;DCDB-&gt;Channel
)braket
(braket
id|KernelCommand-&gt;DCDB-&gt;TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|KernelCommand
op_member_access_from_pointer
id|CompletionFunction
c_func
(paren
id|KernelCommand
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Queue a Status Monitoring Command to the Controller using the just&n;    completed Command if one was deferred previously due to lack of a&n;    free Command when the Monitoring Timer Function was called.&n;  */
r_if
c_cond
(paren
id|Controller-&gt;MonitoringCommandDeferred
)paren
(brace
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|false
suffix:semicolon
id|DAC960_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Deallocate the Command, and wake up any processes waiting on a free Command.&n;  */
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_InterruptHandler handles hardware interrupts from DAC960 Controllers.&n;*/
DECL|function|DAC960_InterruptHandler
r_static
r_void
id|DAC960_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
r_switch
c_cond
(paren
id|Controller-&gt;ControllerType
)paren
(brace
r_case
id|DAC960_V5_Controller
suffix:colon
id|DAC960_V5_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
suffix:semicolon
id|Command-&gt;CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;FirstStatusMailbox
suffix:semicolon
id|DAC960_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V4_Controller
suffix:colon
id|DAC960_V4_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
suffix:semicolon
id|Command-&gt;CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;FirstStatusMailbox
suffix:semicolon
id|DAC960_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V3_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_V3_StatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
(brace
id|DAC960_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|DAC960_V3_ReadStatusCommandIdentifier
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
op_amp
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
)braket
suffix:semicolon
id|Command-&gt;CommandStatus
op_assign
id|DAC960_V3_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V3_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V3_AcknowledgeStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_QueueMonitoringCommand queues a Monitoring Command to Controller.&n;*/
DECL|function|DAC960_QueueMonitoringCommand
r_static
r_void
id|DAC960_QueueMonitoringCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_MonitoringCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_Enquiry
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
op_xor
l_int|1
)braket
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_MonitoringTimerFunction is the timer function for monitoring&n;  the status of DAC960 Controllers.&n;*/
DECL|function|DAC960_MonitoringTimerFunction
r_static
r_void
id|DAC960_MonitoringTimerFunction
c_func
(paren
r_int
r_int
id|TimerData
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|TimerData
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Queue a Status Monitoring Command to Controller.&n;  */
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|DAC960_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_else
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|true
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Open is the Device Open Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_Open
r_static
r_int
id|DAC960_Open
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
op_eq
l_int|0
op_logical_and
id|LogicalDriveNumber
op_eq
l_int|0
op_logical_and
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_goto
id|ModuleOnly
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
op_logical_or
id|LogicalDriveNumber
OG
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
)braket
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveState
op_eq
id|DAC960_LogicalDrive_Offline
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;LogicalDriveInitialState
(braket
id|LogicalDriveNumber
)braket
op_eq
id|DAC960_LogicalDrive_Offline
)paren
(brace
id|Controller-&gt;LogicalDriveInitialState
(braket
id|LogicalDriveNumber
)braket
op_assign
id|DAC960_LogicalDrive_Online
suffix:semicolon
id|DAC960_InitializeGenericDiskInfo
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
suffix:semicolon
id|resetup_one_dev
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;GenericDiskInfo.sizes
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
op_eq
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/*&n;    Increment Controller and Logical Drive Usage Counts.&n;  */
id|Controller-&gt;ControllerUsageCount
op_increment
suffix:semicolon
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
op_increment
suffix:semicolon
id|ModuleOnly
suffix:colon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Release is the Device Release Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_Release
r_static
r_int
id|DAC960_Release
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
op_eq
l_int|0
op_logical_and
id|LogicalDriveNumber
op_eq
l_int|0
op_logical_and
id|File
op_ne
l_int|NULL
op_logical_and
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_goto
id|ModuleOnly
suffix:semicolon
multiline_comment|/*&n;    Decrement the Logical Drive and Controller Usage Counts.&n;  */
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
op_decrement
suffix:semicolon
id|Controller-&gt;ControllerUsageCount
op_decrement
suffix:semicolon
id|ModuleOnly
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_IOCTL is the Device IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_IOCTL
r_static
r_int
id|DAC960_IOCTL
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
comma
r_int
r_int
id|Request
comma
r_int
r_int
id|Argument
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DiskGeometry_T
id|Geometry
comma
op_star
id|UserGeometry
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|PartitionNumber
suffix:semicolon
r_if
c_cond
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
id|DAC960_UserIOCTL
c_func
(paren
id|Inode
comma
id|File
comma
id|Request
comma
id|Argument
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
op_logical_or
id|LogicalDriveNumber
OG
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|HDIO_GETGEO
suffix:colon
multiline_comment|/* Get BIOS Disk Geometry. */
id|UserGeometry
op_assign
(paren
id|DiskGeometry_T
op_star
)paren
id|Argument
suffix:semicolon
r_if
c_cond
(paren
id|UserGeometry
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|Geometry.heads
op_assign
id|Controller-&gt;GeometryTranslationHeads
suffix:semicolon
id|Geometry.sectors
op_assign
id|Controller-&gt;GeometryTranslationSectors
suffix:semicolon
id|Geometry.cylinders
op_assign
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
)braket
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveSize
op_div
(paren
id|Controller-&gt;GeometryTranslationHeads
op_star
id|Controller-&gt;GeometryTranslationSectors
)paren
suffix:semicolon
id|Geometry.start
op_assign
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
dot
id|start_sect
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|UserGeometry
comma
op_amp
id|Geometry
comma
r_sizeof
(paren
id|DiskGeometry_T
)paren
)paren
suffix:semicolon
r_case
id|BLKGETSIZE
suffix:colon
multiline_comment|/* Get Device Size. */
r_if
c_cond
(paren
(paren
r_int
op_star
)paren
id|Argument
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
dot
id|nr_sects
comma
(paren
r_int
op_star
)paren
id|Argument
)paren
suffix:semicolon
r_case
id|BLKRAGET
suffix:colon
multiline_comment|/* Get Read-Ahead. */
r_if
c_cond
(paren
(paren
r_int
op_star
)paren
id|Argument
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|read_ahead
(braket
id|MAJOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
comma
(paren
r_int
op_star
)paren
id|Argument
)paren
suffix:semicolon
r_case
id|BLKRASET
suffix:colon
multiline_comment|/* Set Read-Ahead. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|Argument
OG
l_int|256
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|read_ahead
(braket
id|MAJOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
op_assign
id|Argument
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|BLKFLSBUF
suffix:colon
multiline_comment|/* Flush Buffers. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|fsync_dev
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|invalidate_buffers
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|BLKRRPART
suffix:colon
multiline_comment|/* Re-Read Partition Table. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
OG
l_int|1
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_for
c_loop
(paren
id|PartitionNumber
op_assign
l_int|0
suffix:semicolon
id|PartitionNumber
OL
id|DAC960_MaxPartitions
suffix:semicolon
id|PartitionNumber
op_increment
)paren
(brace
id|KernelDevice_T
id|Device
op_assign
id|DAC960_KernelDevice
c_func
(paren
id|ControllerNumber
comma
id|LogicalDriveNumber
comma
id|PartitionNumber
)paren
suffix:semicolon
r_int
id|MinorNumber
op_assign
id|DAC960_MinorNumber
c_func
(paren
id|LogicalDriveNumber
comma
id|PartitionNumber
)paren
suffix:semicolon
id|SuperBlock_T
op_star
id|SuperBlock
op_assign
id|get_super
c_func
(paren
id|Device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|nr_sects
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
multiline_comment|/*&n;&t;    Flush all changes and invalidate buffered state.&n;&t;  */
id|sync_dev
c_func
(paren
id|Device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SuperBlock
op_ne
l_int|NULL
)paren
id|invalidate_inodes
c_func
(paren
id|SuperBlock
)paren
suffix:semicolon
id|invalidate_buffers
c_func
(paren
id|Device
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Clear existing partition sizes.&n;&t;  */
r_if
c_cond
(paren
id|PartitionNumber
OG
l_int|0
)paren
(brace
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|start_sect
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|nr_sects
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Reset the Block Size so that the partition table can be read.&n;&t;  */
id|set_blocksize
c_func
(paren
id|Device
comma
id|BLOCK_SIZE
)paren
suffix:semicolon
)brace
id|resetup_one_dev
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_UserIOCTL is the User IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_UserIOCTL
r_static
r_int
id|DAC960_UserIOCTL
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
comma
r_int
r_int
id|Request
comma
r_int
r_int
id|Argument
)paren
(brace
r_int
id|ErrorCode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|DAC960_IOCTL_GET_CONTROLLER_COUNT
suffix:colon
r_return
id|DAC960_ControllerCount
suffix:semicolon
r_case
id|DAC960_IOCTL_GET_CONTROLLER_INFO
suffix:colon
(brace
id|DAC960_ControllerInfo_T
op_star
id|UserSpaceControllerInfo
op_assign
(paren
id|DAC960_ControllerInfo_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_ControllerInfo_T
id|ControllerInfo
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceControllerInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|get_user
c_func
(paren
id|ControllerNumber
comma
op_amp
id|UserSpaceControllerInfo-&gt;ControllerNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_return
id|ErrorCode
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ControllerInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
id|ControllerInfo.ControllerNumber
op_assign
id|ControllerNumber
suffix:semicolon
id|ControllerInfo.PCI_Bus
op_assign
id|Controller-&gt;Bus
suffix:semicolon
id|ControllerInfo.PCI_Device
op_assign
id|Controller-&gt;Device
suffix:semicolon
id|ControllerInfo.PCI_Function
op_assign
id|Controller-&gt;Function
suffix:semicolon
id|ControllerInfo.IRQ_Channel
op_assign
id|Controller-&gt;IRQ_Channel
suffix:semicolon
id|ControllerInfo.Channels
op_assign
id|Controller-&gt;Channels
suffix:semicolon
id|ControllerInfo.PCI_Address
op_assign
id|Controller-&gt;PCI_Address
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.ModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.FirmwareVersion
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|UserSpaceControllerInfo
comma
op_amp
id|ControllerInfo
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_UserCommand_T
op_star
id|UserSpaceUserCommand
op_assign
(paren
id|DAC960_UserCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_UserCommand_T
id|UserCommand
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_CommandOpcode_T
id|CommandOpcode
suffix:semicolon
id|DAC960_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_DCDB_T
id|DCDB
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceUserCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|UserCommand
comma
id|UserSpaceUserCommand
comma
r_sizeof
(paren
id|DAC960_UserCommand_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure
suffix:semicolon
id|ControllerNumber
op_assign
id|UserCommand.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|CommandOpcode
op_assign
id|UserCommand.CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DataTransferLength
op_assign
id|UserCommand.DataTransferLength
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_amp
l_int|0x80
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
(brace
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|DCDB
comma
id|UserCommand.DCDB
comma
r_sizeof
(paren
id|DAC960_DCDB_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|DataTransferLength
op_eq
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_DCDB_NoDataTransfer
)paren
op_logical_or
(paren
id|DataTransferLength
OG
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_DCDB_DataTransferDeviceToSystem
)paren
op_logical_or
(paren
id|DataTransferLength
OL
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_DCDB_DataTransferSystemToDevice
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|DCDB.TransferLengthHigh4
op_lshift
l_int|16
)paren
op_or
id|DCDB.TransferLength
)paren
op_ne
id|abs
c_func
(paren
id|DataTransferLength
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DataTransferLength
OL
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
op_minus
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
id|DataTransferBuffer
comma
id|UserCommand.DataTransferBuffer
comma
op_minus
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
(brace
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
)paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|Controller-&gt;DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
id|sleep_on
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|DCDB
)paren
suffix:semicolon
id|DCDB.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
id|sleep_on
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
)brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;CommandStatus
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_NormalCompletion
op_logical_and
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.DataTransferBuffer
comma
id|DataTransferBuffer
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
(brace
id|Controller-&gt;DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.DCDB
comma
op_amp
id|DCDB
comma
r_sizeof
(paren
id|DAC960_DCDB_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure
suffix:semicolon
)brace
id|ErrorCode
op_assign
id|CommandStatus
suffix:semicolon
id|Failure
suffix:colon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
r_return
id|ErrorCode
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_KernelIOCTL is the Kernel IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_KernelIOCTL
r_int
id|DAC960_KernelIOCTL
c_func
(paren
r_int
r_int
id|Request
comma
r_void
op_star
id|Argument
)paren
(brace
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|DAC960_IOCTL_GET_CONTROLLER_COUNT
suffix:colon
r_return
id|DAC960_ControllerCount
suffix:semicolon
r_case
id|DAC960_IOCTL_GET_CONTROLLER_INFO
suffix:colon
(brace
id|DAC960_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
(paren
id|DAC960_ControllerInfo_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ControllerNumber
op_assign
id|ControllerInfo-&gt;ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|memset
c_func
(paren
id|ControllerInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
id|ControllerInfo-&gt;ControllerNumber
op_assign
id|ControllerNumber
suffix:semicolon
id|ControllerInfo-&gt;PCI_Bus
op_assign
id|Controller-&gt;Bus
suffix:semicolon
id|ControllerInfo-&gt;PCI_Device
op_assign
id|Controller-&gt;Device
suffix:semicolon
id|ControllerInfo-&gt;PCI_Function
op_assign
id|Controller-&gt;Function
suffix:semicolon
id|ControllerInfo-&gt;IRQ_Channel
op_assign
id|Controller-&gt;IRQ_Channel
suffix:semicolon
id|ControllerInfo-&gt;Channels
op_assign
id|Controller-&gt;Channels
suffix:semicolon
id|ControllerInfo-&gt;PCI_Address
op_assign
id|Controller-&gt;PCI_Address
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo-&gt;ModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo-&gt;FirmwareVersion
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_KernelCommand_T
op_star
id|KernelCommand
op_assign
(paren
id|DAC960_KernelCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_CommandOpcode_T
id|CommandOpcode
suffix:semicolon
id|DAC960_DCDB_T
op_star
id|DCDB
op_assign
l_int|NULL
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|KernelCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ControllerNumber
op_assign
id|KernelCommand-&gt;ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|CommandOpcode
op_assign
id|KernelCommand-&gt;CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DataTransferLength
op_assign
id|KernelCommand-&gt;DataTransferLength
suffix:semicolon
id|DataTransferBuffer
op_assign
id|KernelCommand-&gt;DataTransferBuffer
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_amp
l_int|0x80
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
(brace
id|DCDB
op_assign
id|KernelCommand-&gt;DCDB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|DataTransferLength
op_eq
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_DCDB_NoDataTransfer
)paren
op_logical_or
(paren
id|DataTransferLength
OG
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_DCDB_DataTransferDeviceToSystem
)paren
op_logical_or
(paren
id|DataTransferLength
OL
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_DCDB_DataTransferSystemToDevice
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|DCDB-&gt;TransferLengthHigh4
op_lshift
l_int|16
)paren
op_or
id|DCDB-&gt;TransferLength
)paren
op_ne
id|abs
c_func
(paren
id|DataTransferLength
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
op_logical_and
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_DCDB
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;DirectCommandActive
(braket
id|DCDB-&gt;Channel
)braket
(braket
id|DCDB-&gt;TargetID
)braket
)paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_else
id|Controller-&gt;DirectCommandActive
(braket
id|DCDB-&gt;Channel
)braket
(braket
id|DCDB-&gt;TargetID
)braket
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_QueuedCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;CommandMailbox
comma
op_amp
id|KernelCommand-&gt;CommandMailbox
comma
r_sizeof
(paren
id|DAC960_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|Command-&gt;KernelCommand
op_assign
id|KernelCommand
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_QueuedCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;CommandMailbox
comma
op_amp
id|KernelCommand-&gt;CommandMailbox
comma
r_sizeof
(paren
id|DAC960_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|Command-&gt;CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|Command-&gt;KernelCommand
op_assign
id|KernelCommand
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_GenericDiskInit is the Generic Disk Information Initialization&n;  Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_InitializeGenericDiskInfo
r_static
r_void
id|DAC960_InitializeGenericDiskInfo
c_func
(paren
id|GenericDiskInfo_T
op_star
id|GenericDiskInfo
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|GenericDiskInfo-&gt;real_devices
suffix:semicolon
id|DAC960_LogicalDriveInformation_T
op_star
id|LogicalDriveInformation
op_assign
id|Controller-&gt;LogicalDriveInformation
(braket
id|Controller-&gt;LogicalDriveInformationIndex
)braket
suffix:semicolon
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
id|GenericDiskInfo-&gt;part
(braket
id|DAC960_MinorNumber
c_func
(paren
id|LogicalDriveNumber
comma
l_int|0
)paren
)braket
dot
id|nr_sects
op_assign
id|LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveSize
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Message prints Driver Messages.&n;*/
DECL|function|DAC960_Message
r_static
r_void
id|DAC960_Message
c_func
(paren
id|DAC960_MessageLevel_T
id|MessageLevel
comma
r_char
op_star
id|Format
comma
id|DAC960_Controller_T
op_star
id|Controller
comma
dot
dot
dot
)paren
(brace
r_static
r_char
id|Buffer
(braket
id|DAC960_LineBufferSize
)braket
suffix:semicolon
r_static
id|boolean
id|BeginningOfLine
op_assign
l_bool|true
suffix:semicolon
id|va_list
id|Arguments
suffix:semicolon
r_int
id|Length
op_assign
l_int|0
suffix:semicolon
id|va_start
c_func
(paren
id|Arguments
comma
id|Controller
)paren
suffix:semicolon
id|Length
op_assign
id|vsprintf
c_func
(paren
id|Buffer
comma
id|Format
comma
id|Arguments
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|Arguments
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|DAC960_ControllerCount
comma
id|Buffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
op_logical_or
id|MessageLevel
op_eq
id|DAC960_InfoLevel
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;ControllerInitialized
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;InitialStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;InitialStatusLength
op_add_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
)paren
(brace
r_static
r_int
id|AnnouncementLines
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|AnnouncementLines
op_le
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
(brace
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|Length
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_ProgressLevel
)paren
(brace
id|strcpy
c_func
(paren
id|Controller-&gt;RebuildProgressBuffer
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;RebuildProgressLength
op_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;EphemeralProgressMessage
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|Controller-&gt;LastProgressReportTime
op_ge
id|DAC960_ProgressReportingInterval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;LastProgressReportTime
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_UserCriticalLevel
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Controller-&gt;UserStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_add_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
id|BeginningOfLine
op_assign
(paren
id|Buffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParsePhysicalDrive parses spaces followed by a Physical Drive&n;  Channel:TargetID specification from a User Command string.  It updates&n;  Channel and TargetID and returns true on success and returns false otherwise.&n;*/
DECL|function|DAC960_ParsePhysicalDrive
r_static
id|boolean
id|DAC960_ParsePhysicalDrive
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|Channel
comma
r_int
r_char
op_star
id|TargetID
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XChannel
comma
id|XTargetID
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XChannel
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;:&squot;
op_logical_or
id|XChannel
op_ge
id|Controller-&gt;Channels
)paren
r_return
l_bool|false
suffix:semicolon
id|UserCommandString
op_assign
op_increment
id|NewUserCommandString
suffix:semicolon
id|XTargetID
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XTargetID
op_ge
id|DAC960_MaxTargets
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|Channel
op_assign
id|XChannel
suffix:semicolon
op_star
id|TargetID
op_assign
id|XTargetID
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParseLogicalDrive parses spaces followed by a Logical Drive Number&n;  specification from a User Command string.  It updates LogicalDriveNumber and&n;  returns true on success and returns false otherwise.&n;*/
DECL|function|DAC960_ParseLogicalDrive
r_static
id|boolean
id|DAC960_ParseLogicalDrive
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|LogicalDriveNumber
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XLogicalDriveNumber
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XLogicalDriveNumber
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XLogicalDriveNumber
op_ge
id|Controller-&gt;LogicalDriveCount
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|LogicalDriveNumber
op_assign
id|XLogicalDriveNumber
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_SetDeviceState sets the Device State for a Physical Drive.&n;*/
DECL|function|DAC960_SetDeviceState
r_static
r_void
id|DAC960_SetDeviceState
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_Command_T
op_star
id|Command
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
id|DAC960_PhysicalDeviceState_T
id|DeviceState
comma
r_const
r_char
op_star
id|DeviceStateString
)paren
(brace
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_StartDevice
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.DeviceState
op_assign
id|DeviceState
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Modifier
op_assign
l_int|0
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandStatus
)paren
(brace
r_case
id|DAC960_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Succeeded&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_UnableToStartDevice
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Unable to Start Device&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_NoDeviceAtAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Failed - &quot;
l_string|&quot;No Device at Address&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_InvalidChannelOrTargetOrModifier
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Invalid Channel or Target or Modifier&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_ChannelBusy
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Channel Busy&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_ExecuteUserCommand executes a User Command.&n;*/
DECL|function|DAC960_ExecuteUserCommand
r_static
id|boolean
id|DAC960_ExecuteUserCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommand
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
r_char
id|Channel
comma
id|TargetID
comma
id|LogicalDriveNumber
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
id|sleep_on
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
id|Controller-&gt;UserStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;flush-cache&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_Flush
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cache Flush Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;kill&quot;
comma
l_int|4
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|4
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_ne
id|DAC960_Device_Dead
)paren
id|DAC960_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_Device_Dead
comma
l_string|&quot;Kill&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Kill of Physical Drive %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-online&quot;
comma
l_int|11
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|11
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
)paren
id|DAC960_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_Device_Online
comma
l_string|&quot;Make Online&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Online of Physical Drive %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-standby&quot;
comma
l_int|12
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|12
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;DeviceState
(braket
id|Controller-&gt;DeviceStateIndex
)braket
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_Device_Dead
)paren
id|DAC960_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_Device_Standby
comma
l_string|&quot;Make Standby&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Standby of Physical Drive %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;rebuild&quot;
comma
l_int|7
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|7
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_RebuildAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandStatus
)paren
(brace
r_case
id|DAC960_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Initiated&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_AttemptToRebuildOnlineDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Attempt to Rebuild Online or &quot;
l_string|&quot;Unresponsive Drive&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_NewDiskFailedDuringRebuild
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Failed - &quot;
l_string|&quot;New Disk Failed During Rebuild&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_InvalidDeviceAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Invalid Device Address&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Rebuild or Consistency Check Already &quot;
l_string|&quot;in Progress&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Drive %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;check-consistency&quot;
comma
l_int|17
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|17
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3C.CommandOpcode
op_assign
id|DAC960_CheckConsistencyAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3C.LogicalDriveNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type3C.AutoRestore
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandStatus
)paren
(brace
r_case
id|DAC960_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Initiated&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_DependentDiskIsDead
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Dependent Physical Drive is DEAD&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_InvalidOrNonredundantLogicalDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Invalid or Nonredundant Logical Drive&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - Rebuild or &quot;
l_string|&quot;Consistency Check Already in Progress&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|Command-&gt;CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-rebuild&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-consistency-check&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
r_char
id|OldRebuildRateConstant
suffix:semicolon
id|CommandMailbox-&gt;Type3R.CommandOpcode
op_assign
id|DAC960_RebuildControl
suffix:semicolon
id|CommandMailbox-&gt;Type3R.RebuildRateConstant
op_assign
l_int|0xFF
suffix:semicolon
id|CommandMailbox-&gt;Type3R.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|OldRebuildRateConstant
)paren
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandStatus
)paren
(brace
r_case
id|DAC960_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild or Consistency Check Cancelled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cancellation of Rebuild or &quot;
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Illegal User Command: &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|UserCommand
)paren
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadStatus implements reading /proc/rd/status.&n;*/
DECL|function|DAC960_ProcReadStatus
r_static
r_int
id|DAC960_ProcReadStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;OK&bslash;n&quot;
suffix:semicolon
r_int
id|ControllerNumber
comma
id|BytesAvailable
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
id|DAC960_Enquiry_T
op_star
id|Enquiry
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|Enquiry
op_assign
op_amp
id|Controller-&gt;Enquiry
(braket
id|Controller-&gt;EnquiryIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Enquiry-&gt;CriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|Enquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|Enquiry-&gt;DeadDriveCount
OG
l_int|0
)paren
(brace
id|StatusMessage
op_assign
l_string|&quot;ALERT&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|BytesAvailable
op_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|StatusMessage
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadInitialStatus implements reading /proc/rd/cN/initial_status.&n;*/
DECL|function|DAC960_ProcReadInitialStatus
r_static
r_int
id|DAC960_ProcReadInitialStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;InitialStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;InitialStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadCurrentStatus implements reading /proc/rd/cN/current_status.&n;*/
DECL|function|DAC960_ProcReadCurrentStatus
r_static
r_int
id|DAC960_ProcReadCurrentStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_ne
id|Controller-&gt;LastCurrentStatusTime
)paren
(brace
id|Controller-&gt;CurrentStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;RebuildProgressLength
OG
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Controller-&gt;RebuildProgressBuffer
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|Controller-&gt;RebuildProgressLength
suffix:semicolon
)brace
r_else
(brace
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;No Rebuild or Consistency Check in Progress&bslash;n&quot;
suffix:semicolon
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|StatusMessage
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
suffix:semicolon
)brace
id|Controller-&gt;LastCurrentStatusTime
op_assign
id|jiffies
suffix:semicolon
)brace
id|BytesAvailable
op_assign
id|Controller-&gt;CurrentStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadUserCommand implements reading /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcReadUserCommand
r_static
r_int
id|DAC960_ProcReadUserCommand
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;UserStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcWriteUserCommand implements writing /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcWriteUserCommand
r_static
r_int
id|DAC960_ProcWriteUserCommand
c_func
(paren
id|File_T
op_star
id|File
comma
r_const
r_char
op_star
id|Buffer
comma
r_int
r_int
id|Count
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_char
id|CommandBuffer
(braket
l_int|80
)braket
suffix:semicolon
r_int
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Count
OG
r_sizeof
(paren
id|CommandBuffer
)paren
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|copy_from_user
c_func
(paren
id|CommandBuffer
comma
id|Buffer
comma
id|Count
)paren
suffix:semicolon
id|CommandBuffer
(braket
id|Count
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|Length
op_assign
id|strlen
c_func
(paren
id|CommandBuffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandBuffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|CommandBuffer
(braket
op_decrement
id|Length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
(paren
id|DAC960_ExecuteUserCommand
c_func
(paren
id|Controller
comma
id|CommandBuffer
)paren
ques
c_cond
id|Count
suffix:colon
op_minus
id|EBUSY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CreateProcEntries creates the /proc/driver/rd/... entries&n;  for the DAC960 Driver.&n;*/
DECL|function|DAC960_CreateProcEntries
r_static
r_void
id|DAC960_CreateProcEntries
c_func
(paren
r_void
)paren
(brace
r_static
id|PROC_DirectoryEntry_T
op_star
id|StatusProcEntry
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
id|DAC960_ProcDirectoryEntry
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;driver/rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|StatusProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;status&quot;
comma
l_int|0
comma
id|DAC960_ProcDirectoryEntry
comma
id|DAC960_ProcReadStatus
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
id|PROC_DirectoryEntry_T
op_star
id|ControllerProcEntry
suffix:semicolon
id|PROC_DirectoryEntry_T
op_star
id|UserCommandProcEntry
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|ControllerProcEntry
op_assign
id|proc_mkdir
c_func
(paren
id|Controller-&gt;ControllerName
comma
id|DAC960_ProcDirectoryEntry
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;initial_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadInitialStatus
comma
id|Controller
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;current_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadCurrentStatus
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;user_command&quot;
comma
id|S_IWUSR
op_or
id|S_IRUSR
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadUserCommand
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry-&gt;write_proc
op_assign
id|DAC960_ProcWriteUserCommand
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_DestroyProcEntries destroys the /proc/rd/... entries for the DAC960&n;  Driver.&n;*/
DECL|function|DAC960_DestroyProcEntries
r_static
r_void
id|DAC960_DestroyProcEntries
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* FIXME */
id|remove_proc_entry
c_func
(paren
l_string|&quot;driver/rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  Include Module support if requested.&n;*/
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|ControllerNumber
comma
id|LogicalDriveNumber
suffix:semicolon
id|DAC960_Initialize
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ActiveControllerCount
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|DAC960_InitializeGenericDiskInfo
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
id|resetup_one_dev
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|DAC960_Finalize
c_func
(paren
op_amp
id|DAC960_NotifierBlock
comma
id|SYS_RESTART
comma
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
