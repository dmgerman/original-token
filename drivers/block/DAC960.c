multiline_comment|/*&n;&n;  Linux Driver for Mylex DAC960/AcceleRAID/eXtremeRAID PCI RAID Controllers&n;&n;  Copyright 1998-2000 by Leonard N. Zubkoff &lt;lnz@dandelion.com&gt;&n;&n;  This program is free software; you may redistribute and/or modify it under&n;  the terms of the GNU General Public License Version 2 as published by the&n;  Free Software Foundation.&n;&n;  This program is distributed in the hope that it will be useful, but&n;  WITHOUT ANY WARRANTY, without even the implied warranty of MERCHANTABILITY&n;  or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n;  for complete details.&n;&n;  The author respectfully requests that any modifications to this software be&n;  sent directly to him for evaluation and testing.&n;&n;*/
DECL|macro|DAC960_DriverVersion
mdefine_line|#define DAC960_DriverVersion&t;&t;&t;&quot;2.4.9&quot;
DECL|macro|DAC960_DriverDate
mdefine_line|#define DAC960_DriverDate&t;&t;&t;&quot;7 September 2000&quot;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;DAC960.h&quot;
multiline_comment|/*&n;  DAC960_ControllerCount is the number of DAC960 Controllers detected.&n;*/
r_static
r_int
DECL|variable|DAC960_ControllerCount
id|DAC960_ControllerCount
suffix:semicolon
multiline_comment|/*&n;  DAC960_ActiveControllerCount is the number of active DAC960 Controllers&n;  detected.&n;*/
r_static
r_int
DECL|variable|DAC960_ActiveControllerCount
id|DAC960_ActiveControllerCount
suffix:semicolon
multiline_comment|/*&n;  DAC960_Controllers is an array of pointers to the DAC960 Controller&n;  structures.&n;*/
r_static
id|DAC960_Controller_T
DECL|variable|DAC960_Controllers
op_star
id|DAC960_Controllers
(braket
id|DAC960_MaxControllers
)braket
suffix:semicolon
multiline_comment|/*&n;  DAC960_BlockDeviceOperations is the Block Device Operations structure for&n;  DAC960 Logical Disk Devices.&n;*/
r_static
id|BlockDeviceOperations_T
DECL|variable|DAC960_BlockDeviceOperations
id|DAC960_BlockDeviceOperations
op_assign
(brace
id|open
suffix:colon
id|DAC960_Open
comma
id|release
suffix:colon
id|DAC960_Release
comma
id|ioctl
suffix:colon
id|DAC960_IOCTL
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_ProcDirectoryEntry is the DAC960 /proc/rd directory entry.&n;*/
r_static
id|PROC_DirectoryEntry_T
DECL|variable|DAC960_ProcDirectoryEntry
op_star
id|DAC960_ProcDirectoryEntry
suffix:semicolon
multiline_comment|/*&n;  DAC960_NotifierBlock is the Notifier Block structure for DAC960 Driver.&n;*/
r_static
id|NotifierBlock_T
DECL|variable|DAC960_NotifierBlock
id|DAC960_NotifierBlock
op_assign
(brace
id|DAC960_Finalize
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_AnnounceDriver announces the Driver Version and Date, Author&squot;s Name,&n;  Copyright Notice, and Electronic Mail Address.&n;*/
DECL|function|DAC960_AnnounceDriver
r_static
r_void
id|DAC960_AnnounceDriver
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Announce
c_func
(paren
l_string|&quot;***** DAC960 RAID Driver Version &quot;
id|DAC960_DriverVersion
l_string|&quot; of &quot;
id|DAC960_DriverDate
l_string|&quot; *****&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_Announce
c_func
(paren
l_string|&quot;Copyright 1998-2000 by Leonard N. Zubkoff &quot;
l_string|&quot;&lt;lnz@dandelion.com&gt;&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Failure prints a standardized error message, and then returns false.&n;*/
DECL|function|DAC960_Failure
r_static
id|boolean
id|DAC960_Failure
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|ErrorMessage
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;While configuring DAC960 PCI RAID Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;IO_Address
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;%s FAILED - DETACHING&bslash;n&quot;
comma
id|Controller
comma
id|ErrorMessage
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CreateAuxiliaryStructures allocates and initializes the auxiliary&n;  data structures for Controller.  It returns true on success and false on&n;  failure.&n;*/
DECL|function|DAC960_CreateAuxiliaryStructures
r_static
id|boolean
id|DAC960_CreateAuxiliaryStructures
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|CommandAllocationLength
comma
id|CommandAllocationGroupSize
suffix:semicolon
r_int
id|CommandsRemaining
op_assign
l_int|0
comma
id|CommandIdentifier
comma
id|CommandGroupByteCount
suffix:semicolon
r_void
op_star
id|AllocationPointer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|CommandAllocationLength
op_assign
m_offsetof
(paren
id|DAC960_Command_T
comma
id|V1.EndMarker
)paren
suffix:semicolon
id|CommandAllocationGroupSize
op_assign
id|DAC960_V1_CommandAllocationGroupSize
suffix:semicolon
)brace
r_else
(brace
id|CommandAllocationLength
op_assign
m_offsetof
(paren
id|DAC960_Command_T
comma
id|V2.EndMarker
)paren
suffix:semicolon
id|CommandAllocationGroupSize
op_assign
id|DAC960_V2_CommandAllocationGroupSize
suffix:semicolon
)brace
id|Controller-&gt;CommandAllocationGroupSize
op_assign
id|CommandAllocationGroupSize
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|CommandIdentifier
op_le
id|Controller-&gt;DriverQueueDepth
suffix:semicolon
id|CommandIdentifier
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|CommandsRemaining
op_le
l_int|0
)paren
(brace
id|CommandsRemaining
op_assign
id|Controller-&gt;DriverQueueDepth
op_minus
id|CommandIdentifier
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|CommandsRemaining
OG
id|CommandAllocationGroupSize
)paren
id|CommandsRemaining
op_assign
id|CommandAllocationGroupSize
suffix:semicolon
id|CommandGroupByteCount
op_assign
id|CommandsRemaining
op_star
id|CommandAllocationLength
suffix:semicolon
id|AllocationPointer
op_assign
id|kmalloc
c_func
(paren
id|CommandGroupByteCount
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AllocationPointer
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|AllocationPointer
comma
l_int|0
comma
id|CommandGroupByteCount
)paren
suffix:semicolon
)brace
id|Command
op_assign
(paren
id|DAC960_Command_T
op_star
)paren
id|AllocationPointer
suffix:semicolon
id|AllocationPointer
op_add_assign
id|CommandAllocationLength
suffix:semicolon
id|Command-&gt;CommandIdentifier
op_assign
id|CommandIdentifier
suffix:semicolon
id|Command-&gt;Controller
op_assign
id|Controller
suffix:semicolon
id|Command-&gt;Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command
suffix:semicolon
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
op_assign
id|Command
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DestroyAuxiliaryStructures deallocates the auxiliary data&n;  structures for Controller.&n;*/
DECL|function|DAC960_DestroyAuxiliaryStructures
r_static
r_void
id|DAC960_DestroyAuxiliaryStructures
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|i
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|Controller-&gt;DriverQueueDepth
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
op_logical_and
(paren
id|Command-&gt;CommandIdentifier
op_mod
id|Controller-&gt;CommandAllocationGroupSize
)paren
op_eq
l_int|1
)paren
id|kfree
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;Commands
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBuffer
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;CombinedStatusBuffer
)paren
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_V2_MaxPhysicalDevices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;  DAC960_V1_ClearCommand clears critical fields of Command for DAC960 V1&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ClearCommand
r_static
r_inline
r_void
id|DAC960_V1_ClearCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ClearCommand clears critical fields of Command for DAC960 V2&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ClearCommand
r_static
r_inline
r_void
id|DAC960_V2_ClearCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_AllocateCommand allocates a Command structure from Controller&squot;s&n;  free list.&n;*/
DECL|function|DAC960_AllocateCommand
r_static
r_inline
id|DAC960_Command_T
op_star
id|DAC960_AllocateCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command-&gt;Next
suffix:semicolon
id|Command-&gt;Next
op_assign
l_int|NULL
suffix:semicolon
r_return
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DeallocateCommand deallocates Command, returning it to Controller&squot;s&n;  free list.&n;*/
DECL|function|DAC960_DeallocateCommand
r_static
r_inline
r_void
id|DAC960_DeallocateCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|Command-&gt;Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_WaitForCommand waits for a wake_up on Controller&squot;s Command Wait Queue.&n;*/
DECL|function|DAC960_WaitForCommand
r_static
r_void
id|DAC960_WaitForCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
id|__wait_event
c_func
(paren
id|Controller-&gt;CommandWaitQueue
comma
id|Controller-&gt;FreeCommands
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_BA_QueueCommand queues Command for DAC960 BA Series Controllers.&n;*/
DECL|function|DAC960_BA_QueueCommand
r_static
r_void
id|DAC960_BA_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_BA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V2.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V2.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_BA_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V2.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LP_QueueCommand queues Command for DAC960 LP Series Controllers.&n;*/
DECL|function|DAC960_LP_QueueCommand
r_static
r_void
id|DAC960_LP_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LP_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V2.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V2.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LP_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V2.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_QueueCommandDualMode queues Command for DAC960 LA Series&n;  Controllers with Dual Mode Firmware.&n;*/
DECL|function|DAC960_LA_QueueCommandDualMode
r_static
r_void
id|DAC960_LA_QueueCommandDualMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LA_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_QueueCommandSingleMode queues Command for DAC960 LA Series&n;  Controllers with Single Mode Firmware.&n;*/
DECL|function|DAC960_LA_QueueCommandSingleMode
r_static
r_void
id|DAC960_LA_QueueCommandSingleMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_QueueCommandDualMode queues Command for DAC960 PG Series&n;  Controllers with Dual Mode Firmware.&n;*/
DECL|function|DAC960_PG_QueueCommandDualMode
r_static
r_void
id|DAC960_PG_QueueCommandDualMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_PG_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_PG_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_QueueCommandSingleMode queues Command for DAC960 PG Series&n;  Controllers with Single Mode Firmware.&n;*/
DECL|function|DAC960_PG_QueueCommandSingleMode
r_static
r_void
id|DAC960_PG_QueueCommandSingleMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_PG_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_PG_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PD_QueueCommand queues Command for DAC960 PD Series Controllers.&n;*/
DECL|function|DAC960_PD_QueueCommand
r_static
r_void
id|DAC960_PD_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_MailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_PD_WriteCommandMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_PD_NewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ExecuteCommand executes Command and waits for completion.&n;*/
DECL|function|DAC960_ExecuteCommand
r_static
r_void
id|DAC960_ExecuteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DECLARE_MUTEX_LOCKED
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
r_int
r_int
id|ProcessorFlags
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
op_amp
id|Semaphore
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
r_return
suffix:semicolon
id|down
c_func
(paren
op_amp
id|Semaphore
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteType3 executes a DAC960 V1 Firmware Controller Type 3&n;  Command and waits for completion.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V1_ExecuteType3
r_static
id|boolean
id|DAC960_V1_ExecuteType3
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
comma
r_void
op_star
id|DataPointer
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteType3D executes a DAC960 V1 Firmware Controller Type 3D&n;  Command and waits for completion.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V1_ExecuteType3D
r_static
id|boolean
id|DAC960_V1_ExecuteType3D
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_void
op_star
id|DataPointer
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_GeneralInfo executes a DAC960 V2 Firmware General Information&n;  Reading IOCTL Command and waits for completion.  It returns true on success&n;  and false on failure.&n;*/
DECL|function|DAC960_V2_GeneralInfo
r_static
id|boolean
id|DAC960_V2_GeneralInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
r_void
op_star
id|DataPointer
comma
r_int
r_int
id|DataByteCount
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
id|DataByteCount
suffix:semicolon
id|CommandMailbox-&gt;Common.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ControllerInfo executes a DAC960 V2 Firmware Controller&n;  Information Reading IOCTL Command and waits for completion.  It returns&n;  true on success and false on failure.&n;*/
DECL|function|DAC960_V2_ControllerInfo
r_static
id|boolean
id|DAC960_V2_ControllerInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
r_void
op_star
id|DataPointer
comma
r_int
r_int
id|DataByteCount
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
op_assign
id|DataByteCount
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_LogicalDeviceInfo executes a DAC960 V2 Firmware Controller Logical&n;  Device Information Reading IOCTL Command and waits for completion.  It&n;  returns true on success and false on failure.&n;*/
DECL|function|DAC960_V2_LogicalDeviceInfo
r_static
id|boolean
id|DAC960_V2_LogicalDeviceInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
r_int
r_int
id|LogicalDeviceNumber
comma
r_void
op_star
id|DataPointer
comma
r_int
r_int
id|DataByteCount
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
op_assign
id|DataByteCount
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_PhysicalDeviceInfo executes a DAC960 V2 Firmware Controller Physical&n;  Device Information Reading IOCTL Command and waits for completion.  It&n;  returns true on success and false on failure.&n;*/
DECL|function|DAC960_V2_PhysicalDeviceInfo
r_static
id|boolean
id|DAC960_V2_PhysicalDeviceInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_int
r_char
id|LogicalUnit
comma
r_void
op_star
id|DataPointer
comma
r_int
r_int
id|DataByteCount
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
id|DataByteCount
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.LogicalUnit
op_assign
id|LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataPointer
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_DeviceOperation executes a DAC960 V2 Firmware Controller Device&n;  Operation IOCTL Command and waits for completion.  It returns true on&n;  success and false on failure.&n;*/
DECL|function|DAC960_V2_DeviceOperation
r_static
id|boolean
id|DAC960_V2_DeviceOperation
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
id|DAC960_V2_OperationDevice_T
id|OperationDevice
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.OperationDevice
op_assign
id|OperationDevice
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_EnableMemoryMailboxInterface enables the Memory Mailbox Interface&n;  for DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_EnableMemoryMailboxInterface
r_static
id|boolean
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailboxesMemory
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|StatusMailboxesMemory
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
id|CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesAddress
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesOrder
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesSize
suffix:semicolon
r_void
op_star
id|SavedMemoryMailboxesAddress
op_assign
l_int|NULL
suffix:semicolon
r_int
id|NextCommandMailboxIndex
op_assign
l_int|0
suffix:semicolon
r_int
id|NextStatusMailboxIndex
op_assign
l_int|0
suffix:semicolon
r_int
id|TimeoutCounter
op_assign
l_int|1000000
comma
id|i
suffix:semicolon
id|MemoryMailboxPagesOrder
op_assign
l_int|0
suffix:semicolon
id|MemoryMailboxPagesSize
op_assign
id|DAC960_V1_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
op_plus
id|DAC960_V1_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V1_StatusMailbox_T
)paren
suffix:semicolon
r_while
c_loop
(paren
id|MemoryMailboxPagesSize
OG
id|PAGE_SIZE
op_lshift
id|MemoryMailboxPagesOrder
)paren
id|MemoryMailboxPagesOrder
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;HardwareType
op_eq
id|DAC960_LA_Controller
)paren
id|DAC960_LA_RestoreMemoryMailboxInfo
c_func
(paren
id|Controller
comma
op_amp
id|SavedMemoryMailboxesAddress
comma
op_amp
id|NextCommandMailboxIndex
comma
op_amp
id|NextStatusMailboxIndex
)paren
suffix:semicolon
r_else
id|DAC960_PG_RestoreMemoryMailboxInfo
c_func
(paren
id|Controller
comma
op_amp
id|SavedMemoryMailboxesAddress
comma
op_amp
id|NextCommandMailboxIndex
comma
op_amp
id|NextStatusMailboxIndex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SavedMemoryMailboxesAddress
op_eq
l_int|NULL
)paren
(brace
id|MemoryMailboxPagesAddress
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|MemoryMailboxPagesOrder
)paren
suffix:semicolon
id|Controller-&gt;MemoryMailboxPagesAddress
op_assign
id|MemoryMailboxPagesAddress
suffix:semicolon
id|CommandMailboxesMemory
op_assign
(paren
id|DAC960_V1_CommandMailbox_T
op_star
)paren
id|MemoryMailboxPagesAddress
suffix:semicolon
)brace
r_else
id|CommandMailboxesMemory
op_assign
id|SavedMemoryMailboxesAddress
suffix:semicolon
r_if
c_cond
(paren
id|CommandMailboxesMemory
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|Controller-&gt;MemoryMailboxPagesOrder
op_assign
id|MemoryMailboxPagesOrder
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailboxesMemory
comma
l_int|0
comma
id|MemoryMailboxPagesSize
)paren
suffix:semicolon
id|Controller-&gt;V1.FirstCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|CommandMailboxesMemory
op_add_assign
id|DAC960_V1_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.LastCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
op_amp
id|Controller-&gt;V1.FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|NextCommandMailboxIndex
OL
l_int|0
)paren
id|NextCommandMailboxIndex
op_assign
id|DAC960_V1_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
op_amp
id|Controller-&gt;V1.FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|NextCommandMailboxIndex
OL
l_int|0
)paren
id|NextCommandMailboxIndex
op_assign
id|DAC960_V1_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
op_amp
id|Controller-&gt;V1.FirstCommandMailbox
(braket
id|NextCommandMailboxIndex
)braket
suffix:semicolon
id|StatusMailboxesMemory
op_assign
(paren
id|DAC960_V1_StatusMailbox_T
op_star
)paren
(paren
id|CommandMailboxesMemory
op_plus
l_int|1
)paren
suffix:semicolon
id|Controller-&gt;V1.FirstStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|StatusMailboxesMemory
op_add_assign
id|DAC960_V1_StatusMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.LastStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.NextStatusMailbox
op_assign
op_amp
id|Controller-&gt;V1.FirstStatusMailbox
(braket
id|NextStatusMailboxIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|SavedMemoryMailboxesAddress
op_ne
l_int|NULL
)paren
r_return
l_bool|true
suffix:semicolon
multiline_comment|/* Enable the Memory Mailbox Interface. */
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode
op_assign
l_int|0x2B
suffix:semicolon
id|CommandMailbox.TypeX.CommandIdentifier
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x14
suffix:semicolon
id|CommandMailbox.TypeX.CommandMailboxesBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;V1.FirstCommandMailbox
)paren
suffix:semicolon
id|CommandMailbox.TypeX.StatusMailboxesBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;V1.FirstStatusMailbox
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_LA_Controller
suffix:colon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_LA_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_LA_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_LA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LA_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_LA_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_PG_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_PG_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_PG_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PG_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_PG_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_EnableMemoryMailboxInterface enables the Memory Mailbox Interface&n;  for DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_EnableMemoryMailboxInterface
r_static
id|boolean
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailboxesMemory
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|StatusMailboxesMemory
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
id|CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesAddress
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesOrder
suffix:semicolon
r_int
r_int
id|MemoryMailboxPagesSize
suffix:semicolon
id|MemoryMailboxPagesOrder
op_assign
l_int|0
suffix:semicolon
id|MemoryMailboxPagesSize
op_assign
id|DAC960_V2_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
op_plus
id|DAC960_V2_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_StatusMailbox_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
suffix:semicolon
r_while
c_loop
(paren
id|MemoryMailboxPagesSize
OG
id|PAGE_SIZE
op_lshift
id|MemoryMailboxPagesOrder
)paren
id|MemoryMailboxPagesOrder
op_increment
suffix:semicolon
id|MemoryMailboxPagesAddress
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|MemoryMailboxPagesOrder
)paren
suffix:semicolon
id|Controller-&gt;MemoryMailboxPagesAddress
op_assign
id|MemoryMailboxPagesAddress
suffix:semicolon
id|CommandMailboxesMemory
op_assign
(paren
id|DAC960_V2_CommandMailbox_T
op_star
)paren
id|MemoryMailboxPagesAddress
suffix:semicolon
r_if
c_cond
(paren
id|CommandMailboxesMemory
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|Controller-&gt;MemoryMailboxPagesOrder
op_assign
id|MemoryMailboxPagesOrder
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailboxesMemory
comma
l_int|0
comma
id|MemoryMailboxPagesSize
)paren
suffix:semicolon
id|Controller-&gt;V2.FirstCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|CommandMailboxesMemory
op_add_assign
id|DAC960_V2_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V2.LastCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|Controller-&gt;V2.LastCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.LastCommandMailbox
op_minus
l_int|1
suffix:semicolon
id|StatusMailboxesMemory
op_assign
(paren
id|DAC960_V2_StatusMailbox_T
op_star
)paren
(paren
id|CommandMailboxesMemory
op_plus
l_int|1
)paren
suffix:semicolon
id|Controller-&gt;V2.FirstStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|StatusMailboxesMemory
op_add_assign
id|DAC960_V2_StatusMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V2.LastStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|Controller-&gt;V2.HealthStatusBuffer
op_assign
(paren
id|DAC960_V2_HealthStatusBuffer_T
op_star
)paren
(paren
id|StatusMailboxesMemory
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable the Memory Mailbox Interface. */
id|memset
c_func
(paren
op_amp
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.CommandControlBits.NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.FirstCommandMailboxSizeKB
op_assign
(paren
id|DAC960_V2_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
op_rshift
l_int|10
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.FirstStatusMailboxSizeKB
op_assign
(paren
id|DAC960_V2_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_StatusMailbox_T
)paren
)paren
op_rshift
l_int|10
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.SecondCommandMailboxSizeKB
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.SecondStatusMailboxSizeKB
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.RequestSenseSize
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.IOCTL_Opcode
op_assign
id|DAC960_V2_SetMemoryMailbox
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.HealthStatusBufferSizeKB
op_assign
l_int|1
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.HealthStatusBufferBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;V2.HealthStatusBuffer
)paren
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.FirstCommandMailboxBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;V2.FirstCommandMailbox
)paren
suffix:semicolon
id|CommandMailbox.SetMemoryMailbox.FirstStatusMailboxBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Controller-&gt;V2.FirstStatusMailbox
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_BA_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_BA_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_BA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|DAC960_BA_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_BA_ReadCommandStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_LP_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_LP_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_LP_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|DAC960_LP_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_LP_ReadCommandStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadControllerConfiguration reads the Configuration Information&n;  from DAC960 V1 Firmware Controllers and initializes the Controller structure.&n;*/
DECL|function|DAC960_V1_ReadControllerConfiguration
r_static
id|boolean
id|DAC960_V1_ReadControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_V1_Enquiry2_T
id|Enquiry2
suffix:semicolon
id|DAC960_V1_Config2_T
id|Config2
suffix:semicolon
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Enquiry
comma
op_amp
id|Controller-&gt;V1.Enquiry
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Enquiry2
comma
op_amp
id|Enquiry2
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_ReadConfig2
comma
op_amp
id|Config2
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;READ CONFIG2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_GetLogicalDriveInformation
comma
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET LOGICAL DRIVE INFORMATION&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Enquiry2.ActualChannels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Enquiry2.MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3D
c_func
(paren
id|Controller
comma
id|DAC960_V1_GetDeviceState
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET DEVICE STATE&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Model Name and Full Model Name fields.&n;  */
r_switch
c_cond
(paren
id|Enquiry2.HardwareID.SubModel
)paren
(brace
r_case
id|DAC960_V1_P_PD_PU
suffix:colon
r_if
c_cond
(paren
id|Enquiry2.SCSICapability.BusSpeed
op_eq
id|DAC960_V1_Ultra
)paren
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PU&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PD&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PG
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PG&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PJ
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PJ&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PR
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PR&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PT
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PT&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PTL0
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL0&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PRL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PRL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PTL1
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL1&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_1164P
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC1164P&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;MODEL VERIFICATION&quot;
)paren
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;Mylex &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|Controller-&gt;FullModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Firmware Version field and verify that it&n;    is a supported firmware version.  The supported firmware versions are:&n;&n;    DAC1164P&t;&t;    5.06 and above&n;    DAC960PTL/PRL/PJ/PG&t;    4.06 and above&n;    DAC960PU/PD/PL&t;    3.51 and above&n;  */
id|sprintf
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;%d.%02d-%c-%02d&quot;
comma
id|Enquiry2.FirmwareID.MajorVersion
comma
id|Enquiry2.FirmwareID.MinorVersion
comma
id|Enquiry2.FirmwareID.FirmwareType
comma
id|Enquiry2.FirmwareID.TurnID
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;5&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;5.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;4&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;4.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;3&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;3.51&quot;
)paren
op_ge
l_int|0
)paren
)paren
)paren
(brace
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;FIRMWARE VERSION VERIFICATION&quot;
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;Firmware Version = &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Channels, Targets, Memory Size, and SAF-TE&n;    Enclosure Management Enabled fields.&n;  */
id|Controller-&gt;Channels
op_assign
id|Enquiry2.ActualChannels
suffix:semicolon
id|Controller-&gt;Targets
op_assign
id|Enquiry2.MaxTargets
suffix:semicolon
id|Controller-&gt;MemorySize
op_assign
id|Enquiry2.MemorySize
op_rshift
l_int|20
suffix:semicolon
id|Controller-&gt;V1.SAFTE_EnclosureManagementEnabled
op_assign
(paren
id|Enquiry2.FaultManagementType
op_eq
id|DAC960_V1_SAFTE
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Queue Depth, Driver Queue Depth, Logical Drive&n;    Count, Maximum Blocks per Command, Controller Scatter/Gather Limit, and&n;    Driver Scatter/Gather Limit.  The Driver Queue Depth must be at most one&n;    less than the Controller Queue Depth to allow for an automatic drive&n;    rebuild operation.&n;  */
id|Controller-&gt;ControllerQueueDepth
op_assign
id|Controller-&gt;V1.Enquiry.MaxCommands
suffix:semicolon
id|Controller-&gt;DriverQueueDepth
op_assign
id|Controller-&gt;ControllerQueueDepth
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverQueueDepth
OG
id|DAC960_MaxDriverQueueDepth
)paren
id|Controller-&gt;DriverQueueDepth
op_assign
id|DAC960_MaxDriverQueueDepth
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|Controller-&gt;V1.Enquiry.NumberOfLogicalDrives
suffix:semicolon
id|Controller-&gt;MaxBlocksPerCommand
op_assign
id|Enquiry2.MaxBlocksPerCommand
suffix:semicolon
id|Controller-&gt;ControllerScatterGatherLimit
op_assign
id|Enquiry2.MaxScatterGatherEntries
suffix:semicolon
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|Controller-&gt;ControllerScatterGatherLimit
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverScatterGatherLimit
OG
id|DAC960_V1_ScatterGatherLimit
)paren
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|DAC960_V1_ScatterGatherLimit
suffix:semicolon
multiline_comment|/*&n;    Initialize the Stripe Size, Segment Size, and Geometry Translation.&n;  */
id|Controller-&gt;V1.StripeSize
op_assign
id|Config2.BlocksPerStripe
op_star
id|Config2.BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
id|Controller-&gt;V1.SegmentSize
op_assign
id|Config2.BlocksPerCacheLine
op_star
id|Config2.BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Config2.DriveGeometry
)paren
(brace
r_case
id|DAC960_V1_Geometry_128_32
suffix:colon
id|Controller-&gt;V1.GeometryTranslationHeads
op_assign
l_int|128
suffix:semicolon
id|Controller-&gt;V1.GeometryTranslationSectors
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Geometry_255_63
suffix:colon
id|Controller-&gt;V1.GeometryTranslationHeads
op_assign
l_int|255
suffix:semicolon
id|Controller-&gt;V1.GeometryTranslationSectors
op_assign
l_int|63
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;CONFIG2 DRIVE GEOMETRY&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Logical Drive Initially Accessible flag.&n;  */
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
r_if
c_cond
(paren
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveState
op_ne
id|DAC960_V1_LogicalDrive_Offline
)paren
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDriveNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.LastRebuildStatus
op_assign
id|DAC960_V1_NoRebuildOrCheckInProgress
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadControllerConfiguration reads the Configuration Information&n;  from DAC960 V2 Firmware Controllers and initializes the Controller structure.&n;*/
DECL|function|DAC960_V2_ReadControllerConfiguration
r_static
id|boolean
id|DAC960_V2_ReadControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
op_assign
l_int|0
suffix:semicolon
r_int
id|ModelNameLength
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_ControllerInfo
c_func
(paren
id|Controller
comma
id|DAC960_V2_GetControllerInfo
comma
id|ControllerInfo
comma
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET CONTROLLER INFO&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_GeneralInfo
c_func
(paren
id|Controller
comma
id|DAC960_V2_GetHealthStatus
comma
id|Controller-&gt;V2.HealthStatusBuffer
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET HEALTH STATUS&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Model Name and Full Model Name fields.&n;  */
id|ModelNameLength
op_assign
r_sizeof
(paren
id|ControllerInfo-&gt;ControllerName
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ModelNameLength
OG
r_sizeof
(paren
id|Controller-&gt;ModelName
)paren
op_minus
l_int|1
)paren
id|ModelNameLength
op_assign
r_sizeof
(paren
id|Controller-&gt;ModelName
)paren
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
id|ControllerInfo-&gt;ControllerName
comma
id|ModelNameLength
)paren
suffix:semicolon
id|ModelNameLength
op_decrement
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;ModelName
(braket
id|ModelNameLength
)braket
op_eq
l_char|&squot; &squot;
op_logical_or
id|Controller-&gt;ModelName
(braket
id|ModelNameLength
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
id|ModelNameLength
op_decrement
suffix:semicolon
id|Controller-&gt;ModelName
(braket
op_increment
id|ModelNameLength
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;Mylex &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|Controller-&gt;FullModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Firmware Version field.&n;  */
id|sprintf
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;%d.%02d-%02d&quot;
comma
id|ControllerInfo-&gt;FirmwareMajorVersion
comma
id|ControllerInfo-&gt;FirmwareMinorVersion
comma
id|ControllerInfo-&gt;FirmwareTurnNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ControllerInfo-&gt;FirmwareMajorVersion
op_eq
l_int|6
op_logical_and
id|ControllerInfo-&gt;FirmwareMinorVersion
op_eq
l_int|0
op_logical_and
id|ControllerInfo-&gt;FirmwareTurnNumber
OL
l_int|1
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;FIRMWARE VERSION %s DOES NOT PROVIDE THE CONTROLLER&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;STATUS MONITORING FUNCTIONALITY NEEDED BY THIS DRIVER.&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;PLEASE UPGRADE TO VERSION 6.00-01 OR ABOVE.&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Channels, Targets, and Memory Size.&n;  */
id|Controller-&gt;Channels
op_assign
id|ControllerInfo-&gt;NumberOfPhysicalChannelsPresent
suffix:semicolon
id|Controller-&gt;Targets
op_assign
id|ControllerInfo-&gt;MaximumTargetsPerChannel
(braket
id|ControllerInfo-&gt;NumberOfPhysicalChannelsPresent
op_minus
l_int|1
)braket
suffix:semicolon
id|Controller-&gt;MemorySize
op_assign
id|ControllerInfo-&gt;MemorySizeMB
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Queue Depth, Driver Queue Depth, Logical Drive&n;    Count, Maximum Blocks per Command, Controller Scatter/Gather Limit, and&n;    Driver Scatter/Gather Limit.  The Driver Queue Depth must be at most one&n;    less than the Controller Queue Depth to allow for an automatic drive&n;    rebuild operation.&n;  */
id|Controller-&gt;ControllerQueueDepth
op_assign
id|ControllerInfo-&gt;MaximumParallelCommands
suffix:semicolon
id|Controller-&gt;DriverQueueDepth
op_assign
id|Controller-&gt;ControllerQueueDepth
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverQueueDepth
OG
id|DAC960_MaxDriverQueueDepth
)paren
id|Controller-&gt;DriverQueueDepth
op_assign
id|DAC960_MaxDriverQueueDepth
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|ControllerInfo-&gt;LogicalDevicesPresent
suffix:semicolon
id|Controller-&gt;MaxBlocksPerCommand
op_assign
id|ControllerInfo-&gt;MaximumDataTransferSizeInBlocks
suffix:semicolon
id|Controller-&gt;ControllerScatterGatherLimit
op_assign
id|ControllerInfo-&gt;MaximumScatterGatherEntries
suffix:semicolon
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|Controller-&gt;ControllerScatterGatherLimit
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverScatterGatherLimit
OG
id|DAC960_V2_ScatterGatherLimit
)paren
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|DAC960_V2_ScatterGatherLimit
suffix:semicolon
multiline_comment|/*&n;    Initialize the Logical Device Information.&n;  */
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|NewLogicalDeviceInfo
op_assign
op_amp
id|Controller-&gt;V2.NewLogicalDeviceInformation
suffix:semicolon
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
suffix:semicolon
id|DAC960_V2_PhysicalDevice_T
id|PhysicalDevice
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_LogicalDeviceInfo
c_func
(paren
id|Controller
comma
id|DAC960_V2_GetLogicalDeviceInfoValid
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
)paren
r_break
suffix:semicolon
id|LogicalDeviceNumber
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceNumber
OG
id|DAC960_MaxLogicalDrives
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: Logical Drive Number %d not supported&bslash;n&quot;
comma
id|LogicalDeviceNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;DeviceBlockSizeInBytes
op_ne
id|DAC960_BlockSize
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: Logical Drive Block Size %d not supported&bslash;n&quot;
comma
id|NewLogicalDeviceInfo-&gt;DeviceBlockSizeInBytes
)paren
suffix:semicolon
id|PhysicalDevice.Controller
op_assign
l_int|0
suffix:semicolon
id|PhysicalDevice.Channel
op_assign
id|NewLogicalDeviceInfo-&gt;Channel
suffix:semicolon
id|PhysicalDevice.TargetID
op_assign
id|NewLogicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|PhysicalDevice.LogicalUnit
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|PhysicalDevice
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_ne
id|DAC960_V2_LogicalDevice_Offline
)paren
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDeviceNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|LogicalDeviceInfo
op_assign
(paren
id|DAC960_V2_LogicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;LOGICAL DEVICE ALLOCATION&quot;
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|LogicalDeviceInfo
suffix:semicolon
id|memcpy
c_func
(paren
id|LogicalDeviceInfo
comma
id|NewLogicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|LogicalDeviceNumber
op_increment
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReportControllerConfiguration reports the Configuration Information&n;  for Controller.&n;*/
DECL|function|DAC960_ReportControllerConfiguration
r_static
id|boolean
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;Configuring Mylex %s PCI RAID Controller&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Firmware Version: %s, Channels: %d, Memory Size: %dMB&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
comma
id|Controller-&gt;Channels
comma
id|Controller-&gt;MemorySize
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Bus: %d, Device: %d, Function: %d, I/O Address: &quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;Unassigned&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IO_Address
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Address: 0x%X mapped at 0x%lX, IRQ Channel: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;PCI_Address
comma
(paren
r_int
r_int
)paren
id|Controller-&gt;BaseAddress
comma
id|Controller-&gt;IRQ_Channel
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Controller Queue Depth: %d, &quot;
l_string|&quot;Maximum Blocks per Command: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerQueueDepth
comma
id|Controller-&gt;MaxBlocksPerCommand
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Driver Queue Depth: %d, &quot;
l_string|&quot;Scatter/Gather Limit: %d of %d Segments&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;DriverQueueDepth
comma
id|Controller-&gt;DriverScatterGatherLimit
comma
id|Controller-&gt;ControllerScatterGatherLimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Stripe Size: %dKB, Segment Size: %dKB, &quot;
l_string|&quot;BIOS Geometry: %d/%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;V1.StripeSize
comma
id|Controller-&gt;V1.SegmentSize
comma
id|Controller-&gt;V1.GeometryTranslationHeads
comma
id|Controller-&gt;V1.GeometryTranslationSectors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.SAFTE_EnclosureManagementEnabled
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;  SAF-TE Enclosure Management Enabled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadDeviceConfiguration reads the Device Configuration Information&n;  for DAC960 V1 Firmware Controllers by requesting the SCSI Inquiry and SCSI&n;  Inquiry Unit Serial Number information for each device connected to&n;  Controller.&n;*/
DECL|function|DAC960_V1_ReadDeviceConfiguration
r_static
id|boolean
id|DAC960_V1_ReadDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_V1_DCDB_T
id|DCDBs
(braket
id|DAC960_V1_MaxChannels
)braket
comma
op_star
id|DCDB
suffix:semicolon
id|Semaphore_T
id|Semaphores
(braket
id|DAC960_V1_MaxChannels
)braket
comma
op_star
id|Semaphore
suffix:semicolon
r_int
r_int
id|ProcessorFlags
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Semaphore
op_assign
op_amp
id|Semaphores
(braket
id|Channel
)braket
suffix:semicolon
id|init_MUTEX_LOCKED
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
id|DCDB
op_assign
op_amp
id|DCDBs
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Semaphore
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Channel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|TargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryStandardData
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Semaphore
op_assign
op_amp
id|Semaphores
(braket
id|Channel
)braket
suffix:semicolon
id|down
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;V1.CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
r_continue
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Semaphore
suffix:semicolon
id|DCDB
op_assign
op_amp
id|DCDBs
(braket
id|Channel
)braket
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|down
c_func
(paren
id|Semaphore
)paren
suffix:semicolon
)brace
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadDeviceConfiguration reads the Device Configuration Information&n;  for DAC960 V2 Firmware Controllers by requesting the Physical Device&n;  Information and SCSI Inquiry Unit Serial Number information for each&n;  device connected to Controller.&n;*/
DECL|function|DAC960_V2_ReadDeviceConfiguration
r_static
id|boolean
id|DAC960_V2_ReadDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
r_char
id|Channel
op_assign
l_int|0
comma
id|TargetID
op_assign
l_int|0
comma
id|LogicalUnit
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|NewPhysicalDeviceInfo
op_assign
op_amp
id|Controller-&gt;V2.NewPhysicalDeviceInformation
suffix:semicolon
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_PhysicalDeviceInfo
c_func
(paren
id|Controller
comma
id|DAC960_V2_GetPhysicalDeviceInfoValid
comma
id|Channel
comma
id|TargetID
comma
id|LogicalUnit
comma
id|NewPhysicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
)paren
r_break
suffix:semicolon
id|Channel
op_assign
id|NewPhysicalDeviceInfo-&gt;Channel
suffix:semicolon
id|TargetID
op_assign
id|NewPhysicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|LogicalUnit
op_assign
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;PHYSICAL DEVICE ALLOCATION&quot;
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|PhysicalDeviceInfo
suffix:semicolon
id|memcpy
c_func
(paren
id|PhysicalDeviceInfo
comma
id|NewPhysicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber
op_assign
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;SERIAL NUMBER ALLOCATION&quot;
)paren
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|InquiryUnitSerialNumber
suffix:semicolon
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandOpcode
op_assign
id|DAC960_V2_SCSI_10_Passthru
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.LogicalUnit
op_assign
id|LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CDBLength
op_assign
l_int|6
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|PhysicalDeviceIndex
op_increment
suffix:semicolon
id|LogicalUnit
op_increment
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_SanitizeInquiryData sanitizes the Vendor, Model, Revision, and&n;  Product Serial Number fields of the Inquiry Standard Data and Inquiry&n;  Unit Serial Number structures.&n;*/
DECL|function|DAC960_SanitizeInquiryData
r_static
r_void
id|DAC960_SanitizeInquiryData
c_func
(paren
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
comma
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
comma
r_int
r_char
op_star
id|Vendor
comma
r_int
r_char
op_star
id|Model
comma
r_int
r_char
op_star
id|Revision
comma
r_int
r_char
op_star
id|SerialNumber
)paren
(brace
r_int
id|SerialNumberLength
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|InquiryStandardData-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|VendorCharacter
op_assign
id|InquiryStandardData-&gt;VendorIdentification
(braket
id|i
)braket
suffix:semicolon
id|Vendor
(braket
id|i
)braket
op_assign
(paren
id|VendorCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|VendorCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|VendorCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Vendor
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|ModelCharacter
op_assign
id|InquiryStandardData-&gt;ProductIdentification
(braket
id|i
)braket
suffix:semicolon
id|Model
(braket
id|i
)braket
op_assign
(paren
id|ModelCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|ModelCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|ModelCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Model
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|RevisionCharacter
op_assign
id|InquiryStandardData-&gt;ProductRevisionLevel
(braket
id|i
)braket
suffix:semicolon
id|Revision
(braket
id|i
)braket
op_assign
(paren
id|RevisionCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|RevisionCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|RevisionCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Revision
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_return
suffix:semicolon
id|SerialNumberLength
op_assign
id|InquiryUnitSerialNumber-&gt;PageLength
suffix:semicolon
r_if
c_cond
(paren
id|SerialNumberLength
OG
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
)paren
id|SerialNumberLength
op_assign
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SerialNumberLength
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|SerialNumberCharacter
op_assign
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
(braket
id|i
)braket
suffix:semicolon
id|SerialNumber
(braket
id|i
)braket
op_assign
(paren
id|SerialNumberCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|SerialNumberCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|SerialNumberCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|SerialNumber
(braket
id|SerialNumberLength
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReportDeviceConfiguration reports the Device Configuration&n;  Information for DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ReportDeviceConfiguration
r_static
id|boolean
id|DAC960_V1_ReportDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Physical Devices:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_ErrorTableEntry_T
op_star
id|ErrorEntry
op_assign
op_amp
id|Controller-&gt;V1.ErrorTable.ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_char
id|Vendor
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
suffix:semicolon
r_char
id|Model
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
suffix:semicolon
r_char
id|Revision
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
suffix:semicolon
r_char
id|SerialNumber
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryUnitSerialNumber
op_member_access_from_pointer
id|ProductSerialNumber
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|InquiryStandardData-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_continue
suffix:semicolon
id|DAC960_SanitizeInquiryData
c_func
(paren
id|InquiryStandardData
comma
id|InquiryUnitSerialNumber
comma
id|Vendor
comma
id|Model
comma
id|Revision
comma
id|SerialNumber
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    %d:%d%s Vendor: %s  Model: %s  Revision: %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|TargetID
OL
l_int|10
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|Vendor
comma
id|Model
comma
id|Revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_ne
l_int|0x1F
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Serial Number: %s&bslash;n&quot;
comma
id|Controller
comma
id|SerialNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V1.DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %d blocks, %d resets&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
comma
id|Controller-&gt;V1.DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %d blocks&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ErrorEntry-&gt;ParityErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;SoftErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;HardErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;MiscErrorCount
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Errors - Parity: %d, Soft: %d, &quot;
l_string|&quot;Hard: %d, Misc: %d&bslash;n&quot;
comma
id|Controller
comma
id|ErrorEntry-&gt;ParityErrorCount
comma
id|ErrorEntry-&gt;SoftErrorCount
comma
id|ErrorEntry-&gt;HardErrorCount
comma
id|ErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Logical Drives:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|LogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    /dev/rd/c%dd%d: RAID-%d, %s, %d blocks, %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|LogicalDriveInformation-&gt;RAIDLevel
comma
(paren
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
l_string|&quot;Offline&quot;
)paren
comma
id|LogicalDriveInformation-&gt;LogicalDriveSize
comma
(paren
id|LogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;Write Back&quot;
suffix:colon
l_string|&quot;Write Thru&quot;
)paren
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReportDeviceConfiguration reports the Device Configuration&n;  Information for DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ReportDeviceConfiguration
r_static
id|boolean
id|DAC960_V2_ReportDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|PhysicalDeviceIndex
comma
id|LogicalDriveNumber
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Physical Devices:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
id|PhysicalDeviceIndex
OL
id|DAC960_V2_MaxPhysicalDevices
suffix:semicolon
id|PhysicalDeviceIndex
op_increment
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
(paren
id|DAC960_SCSI_Inquiry_T
op_star
)paren
op_amp
id|PhysicalDeviceInfo-&gt;SCSI_InquiryData
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
r_char
id|Vendor
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
suffix:semicolon
r_char
id|Model
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
suffix:semicolon
r_char
id|Revision
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
suffix:semicolon
r_char
id|SerialNumber
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|DAC960_SanitizeInquiryData
c_func
(paren
id|InquiryStandardData
comma
id|InquiryUnitSerialNumber
comma
id|Vendor
comma
id|Model
comma
id|Revision
comma
id|SerialNumber
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    %d:%d%s Vendor: %s  Model: %s  Revision: %s&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;Channel
comma
id|PhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|PhysicalDeviceInfo-&gt;TargetID
OL
l_int|10
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|Vendor
comma
id|Model
comma
id|Revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedSynchronousMegaTransfers
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         %sAsynchronous&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_eq
l_int|16
ques
c_cond
l_string|&quot;Wide &quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;         %sSynchronous at %d MB/sec&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_eq
l_int|16
ques
c_cond
l_string|&quot;Wide &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedSynchronousMegaTransfers
op_star
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_eq
l_int|16
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_ne
l_int|0x1F
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Serial Number: %s&bslash;n&quot;
comma
id|Controller
comma
id|SerialNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Unconfigured
)paren
r_continue
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %d blocks&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|PhysicalDeviceInfo
op_member_access_from_pointer
id|ConfigurableDeviceSizeIn512ByteBlocksOrMB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;ParityErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;SoftErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;HardErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;CommandTimeouts
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;Retries
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;Aborts
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;         Errors - Parity: %d, Soft: %d, &quot;
l_string|&quot;Hard: %d, Misc: %d&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;ParityErrors
comma
id|PhysicalDeviceInfo-&gt;SoftErrors
comma
id|PhysicalDeviceInfo-&gt;HardErrors
comma
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Timeouts: %d, Retries: %d, &quot;
l_string|&quot;Aborts: %d, Predicted: %d&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;CommandTimeouts
comma
id|PhysicalDeviceInfo-&gt;Retries
comma
id|PhysicalDeviceInfo-&gt;Aborts
comma
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Logical Drives:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_int
r_char
op_star
id|ReadCacheStatus
(braket
)braket
op_assign
(brace
l_string|&quot;Read Cache Disabled&quot;
comma
l_string|&quot;Read Cache Enabled&quot;
comma
l_string|&quot;Read Ahead Enabled&quot;
comma
l_string|&quot;Intelligent Read Ahead Enabled&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|WriteCacheStatus
(braket
)braket
op_assign
(brace
l_string|&quot;Write Cache Disabled&quot;
comma
l_string|&quot;Logical Device Read Only&quot;
comma
l_string|&quot;Write Cache Enabled&quot;
comma
l_string|&quot;Intelligent Write Cache Enabled&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|GeometryTranslation
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
(brace
r_case
id|DAC960_V2_Geometry_128_32
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;128/32&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V2_Geometry_255_63
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;255/63&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;Invalid&quot;
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;Illegal Logical Device Geometry %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;    /dev/rd/c%dd%d: RAID-%d, %s, %d blocks&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|LogicalDeviceInfo-&gt;RAIDLevel
comma
(paren
id|LogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|LogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
l_string|&quot;Offline&quot;
)paren
comma
id|LogicalDeviceInfo-&gt;ConfigurableDeviceSizeIn512ByteBlocksOrMB
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Logical Device %s, BIOS Geometry: %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|LogicalDeviceInfo-&gt;LogicalDeviceControl
dot
id|LogicalDeviceInitialized
ques
c_cond
l_string|&quot;Initialized&quot;
suffix:colon
l_string|&quot;Uninitialized&quot;
)paren
comma
id|GeometryTranslation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: N/A, &quot;
l_string|&quot;Segment Size: N/A&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: N/A, &quot;
l_string|&quot;Segment Size: %dKB&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: %dKB, &quot;
l_string|&quot;Segment Size: N/A&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: %dKB, &quot;
l_string|&quot;Segment Size: %dKB&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_minus
l_int|2
)paren
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;                  %s, %s&bslash;n&quot;
comma
id|Controller
comma
id|ReadCacheStatus
(braket
id|LogicalDeviceInfo-&gt;LogicalDeviceControl.ReadCache
)braket
comma
id|WriteCacheStatus
(braket
id|LogicalDeviceInfo-&gt;LogicalDeviceControl.WriteCache
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;SoftErrors
OG
l_int|0
op_logical_or
id|LogicalDeviceInfo-&gt;CommandsFailed
OG
l_int|0
op_logical_or
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Errors - Soft: %d, Failed: %d, &quot;
l_string|&quot;Deferred Write: %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceInfo-&gt;SoftErrors
comma
id|LogicalDeviceInfo-&gt;CommandsFailed
comma
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_BackMergeFunction is the Back Merge Function for the DAC960 driver.&n;*/
DECL|function|DAC960_BackMergeFunction
r_static
r_int
id|DAC960_BackMergeFunction
c_func
(paren
id|RequestQueue_T
op_star
id|RequestQueue
comma
id|IO_Request_T
op_star
id|Request
comma
id|BufferHeader_T
op_star
id|BufferHeader
comma
r_int
id|MaxSegments
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|RequestQueue-&gt;queuedata
suffix:semicolon
r_if
c_cond
(paren
id|Request-&gt;bhtail-&gt;b_data
op_plus
id|Request-&gt;bhtail-&gt;b_size
op_eq
id|BufferHeader-&gt;b_data
)paren
r_return
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|Request-&gt;nr_segments
OL
id|MaxSegments
op_logical_and
id|Request-&gt;nr_segments
OL
id|Controller-&gt;DriverScatterGatherLimit
)paren
(brace
id|Request-&gt;nr_segments
op_increment
suffix:semicolon
id|RequestQueue-&gt;elevator.nr_segments
op_increment
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_FrontMergeFunction is the Front Merge Function for the DAC960 driver.&n;*/
DECL|function|DAC960_FrontMergeFunction
r_static
r_int
id|DAC960_FrontMergeFunction
c_func
(paren
id|RequestQueue_T
op_star
id|RequestQueue
comma
id|IO_Request_T
op_star
id|Request
comma
id|BufferHeader_T
op_star
id|BufferHeader
comma
r_int
id|MaxSegments
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|RequestQueue-&gt;queuedata
suffix:semicolon
r_if
c_cond
(paren
id|BufferHeader-&gt;b_data
op_plus
id|BufferHeader-&gt;b_size
op_eq
id|Request-&gt;bh-&gt;b_data
)paren
r_return
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|Request-&gt;nr_segments
OL
id|MaxSegments
op_logical_and
id|Request-&gt;nr_segments
OL
id|Controller-&gt;DriverScatterGatherLimit
)paren
(brace
id|Request-&gt;nr_segments
op_increment
suffix:semicolon
id|RequestQueue-&gt;elevator.nr_segments
op_increment
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_MergeRequestsFunction is the Merge Requests Function for the&n;  DAC960 driver.&n;*/
DECL|function|DAC960_MergeRequestsFunction
r_static
r_int
id|DAC960_MergeRequestsFunction
c_func
(paren
id|RequestQueue_T
op_star
id|RequestQueue
comma
id|IO_Request_T
op_star
id|Request
comma
id|IO_Request_T
op_star
id|NextRequest
comma
r_int
id|MaxSegments
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|RequestQueue-&gt;queuedata
suffix:semicolon
r_int
id|TotalSegments
op_assign
id|Request-&gt;nr_segments
op_plus
id|NextRequest-&gt;nr_segments
suffix:semicolon
r_int
id|SameSegment
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Request-&gt;bhtail-&gt;b_data
op_plus
id|Request-&gt;bhtail-&gt;b_size
op_eq
id|NextRequest-&gt;bh-&gt;b_data
)paren
(brace
id|TotalSegments
op_decrement
suffix:semicolon
id|SameSegment
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TotalSegments
OG
id|MaxSegments
op_logical_or
id|TotalSegments
OG
id|Controller-&gt;DriverScatterGatherLimit
)paren
r_return
l_bool|false
suffix:semicolon
id|RequestQueue-&gt;elevator.nr_segments
op_sub_assign
id|SameSegment
suffix:semicolon
id|Request-&gt;nr_segments
op_assign
id|TotalSegments
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RegisterBlockDevice registers the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_RegisterBlockDevice
r_static
id|boolean
id|DAC960_RegisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
id|GenericDiskInfo_T
op_star
id|GenericDiskInfo
suffix:semicolon
id|RequestQueue_T
op_star
id|RequestQueue
suffix:semicolon
r_int
id|MinorNumber
suffix:semicolon
multiline_comment|/*&n;    Register the Block Device Major Number for this DAC960 Controller.&n;  */
r_if
c_cond
(paren
id|devfs_register_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;dac960&quot;
comma
op_amp
id|DAC960_BlockDeviceOperations
)paren
OL
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;UNABLE TO ACQUIRE MAJOR NUMBER %d - DETACHING&bslash;n&quot;
comma
id|Controller
comma
id|MajorNumber
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the I/O Request Queue.&n;  */
id|RequestQueue
op_assign
id|BLK_DEFAULT_QUEUE
c_func
(paren
id|MajorNumber
)paren
suffix:semicolon
id|blk_init_queue
c_func
(paren
id|RequestQueue
comma
id|DAC960_RequestFunction
)paren
suffix:semicolon
id|blk_queue_headactive
c_func
(paren
id|RequestQueue
comma
l_int|0
)paren
suffix:semicolon
id|RequestQueue-&gt;back_merge_fn
op_assign
id|DAC960_BackMergeFunction
suffix:semicolon
id|RequestQueue-&gt;front_merge_fn
op_assign
id|DAC960_FrontMergeFunction
suffix:semicolon
id|RequestQueue-&gt;merge_requests_fn
op_assign
id|DAC960_MergeRequestsFunction
suffix:semicolon
id|RequestQueue-&gt;queuedata
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;RequestQueue
op_assign
id|RequestQueue
suffix:semicolon
multiline_comment|/*&n;    Initialize the Disk Partitions array, Partition Sizes array, Block Sizes&n;    array, and Max Sectors per Request array.&n;  */
r_for
c_loop
(paren
id|MinorNumber
op_assign
l_int|0
suffix:semicolon
id|MinorNumber
OL
id|DAC960_MinorCount
suffix:semicolon
id|MinorNumber
op_increment
)paren
(brace
id|Controller-&gt;BlockSizes
(braket
id|MinorNumber
)braket
op_assign
id|BLOCK_SIZE
suffix:semicolon
id|Controller-&gt;MaxSectorsPerRequest
(braket
id|MinorNumber
)braket
op_assign
id|Controller-&gt;MaxBlocksPerCommand
suffix:semicolon
)brace
id|Controller-&gt;GenericDiskInfo.part
op_assign
id|Controller-&gt;DiskPartitions
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.sizes
op_assign
id|Controller-&gt;PartitionSizes
suffix:semicolon
id|blksize_size
(braket
id|MajorNumber
)braket
op_assign
id|Controller-&gt;BlockSizes
suffix:semicolon
id|max_sectors
(braket
id|MajorNumber
)braket
op_assign
id|Controller-&gt;MaxSectorsPerRequest
suffix:semicolon
multiline_comment|/*&n;    Initialize Read Ahead to 128 sectors.&n;  */
id|read_ahead
(braket
id|MajorNumber
)braket
op_assign
l_int|128
suffix:semicolon
multiline_comment|/*&n;    Complete initialization of the Generic Disk Information structure.&n;  */
id|Controller-&gt;GenericDiskInfo.major
op_assign
id|MajorNumber
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.major_name
op_assign
l_string|&quot;rd&quot;
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.minor_shift
op_assign
id|DAC960_MaxPartitionsBits
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.max_p
op_assign
id|DAC960_MaxPartitions
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.nr_real
op_assign
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.next
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.fops
op_assign
op_amp
id|DAC960_BlockDeviceOperations
suffix:semicolon
multiline_comment|/*&n;    Install the Generic Disk Information structure at the end of the list.&n;  */
r_if
c_cond
(paren
(paren
id|GenericDiskInfo
op_assign
id|gendisk_head
)paren
op_ne
l_int|NULL
)paren
(brace
r_while
c_loop
(paren
id|GenericDiskInfo-&gt;next
op_ne
l_int|NULL
)paren
id|GenericDiskInfo
op_assign
id|GenericDiskInfo-&gt;next
suffix:semicolon
id|GenericDiskInfo-&gt;next
op_assign
op_amp
id|Controller-&gt;GenericDiskInfo
suffix:semicolon
)brace
r_else
id|gendisk_head
op_assign
op_amp
id|Controller-&gt;GenericDiskInfo
suffix:semicolon
multiline_comment|/*&n;    Indicate the Block Device Registration completed successfully,&n;  */
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_UnregisterBlockDevice unregisters the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_UnregisterBlockDevice
r_static
r_void
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
multiline_comment|/*&n;    Unregister the Block Device Major Number for this DAC960 Controller.&n;  */
id|devfs_unregister_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;dac960&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Remove the I/O Request Queue.&n;  */
id|blk_cleanup_queue
c_func
(paren
id|BLK_DEFAULT_QUEUE
c_func
(paren
id|MajorNumber
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Remove the Disk Partitions array, Partition Sizes array, Block Sizes&n;    array, Max Sectors per Request array, and Max Segments per Request array.&n;  */
id|Controller-&gt;GenericDiskInfo.part
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.sizes
op_assign
l_int|NULL
suffix:semicolon
id|blk_size
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|blksize_size
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|max_sectors
(braket
id|MajorNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;    Remove the Generic Disk Information structure from the list.&n;  */
r_if
c_cond
(paren
id|gendisk_head
op_ne
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
(brace
id|GenericDiskInfo_T
op_star
id|GenericDiskInfo
op_assign
id|gendisk_head
suffix:semicolon
r_while
c_loop
(paren
id|GenericDiskInfo
op_ne
l_int|NULL
op_logical_and
id|GenericDiskInfo-&gt;next
op_ne
op_amp
id|Controller-&gt;GenericDiskInfo
)paren
id|GenericDiskInfo
op_assign
id|GenericDiskInfo-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|GenericDiskInfo
op_ne
l_int|NULL
)paren
id|GenericDiskInfo-&gt;next
op_assign
id|GenericDiskInfo-&gt;next-&gt;next
suffix:semicolon
)brace
r_else
id|gendisk_head
op_assign
id|Controller-&gt;GenericDiskInfo.next
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RegisterDisk registers the DAC960 Logical Disk Device for Logical&n;  Drive Number if it exists.&n;*/
DECL|function|DAC960_RegisterDisk
r_static
r_void
id|DAC960_RegisterDisk
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
id|LogicalDriveNumber
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
r_if
c_cond
(paren
id|LogicalDriveNumber
OG
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
)paren
r_return
suffix:semicolon
id|register_disk
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|DAC960_KernelDevice
c_func
(paren
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
l_int|0
)paren
comma
id|DAC960_MaxPartitions
comma
op_amp
id|DAC960_BlockDeviceOperations
comma
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveSize
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|register_disk
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|DAC960_KernelDevice
c_func
(paren
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
l_int|0
)paren
comma
id|DAC960_MaxPartitions
comma
op_amp
id|DAC960_BlockDeviceOperations
comma
id|LogicalDeviceInfo
op_member_access_from_pointer
id|ConfigurableDeviceSizeIn512ByteBlocksOrMB
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_ReportErrorStatus reports Controller BIOS Messages passed through&n;  the Error Status Register when the driver performs the BIOS handshaking.&n;  It returns true for fatal errors and false otherwise.&n;*/
DECL|function|DAC960_ReportErrorStatus
r_static
id|boolean
id|DAC960_ReportErrorStatus
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
id|ErrorStatus
comma
r_int
r_char
id|Parameter0
comma
r_int
r_char
id|Parameter1
)paren
(brace
r_switch
c_cond
(paren
id|ErrorStatus
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Physical Device %d:%d Not Responding&bslash;n&quot;
comma
id|Controller
comma
id|Parameter1
comma
id|Parameter0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;DriveSpinUpMessageDisplayed
)paren
r_break
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Spinning Up Drives&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;DriveSpinUpMessageDisplayed
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x30
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Configuration Checksum Error&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x60
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race Recovery Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x70
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race Recovery In Progress&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x90
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Physical Device %d:%d COD Mismatch&bslash;n&quot;
comma
id|Controller
comma
id|Parameter1
comma
id|Parameter0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xA0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Logical Drive Installation Aborted&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xB0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race On A Critical Logical Drive&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xD0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;New Controller Configuration Found&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xF0
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Fatal Memory Parity Error for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Unknown Initialization Error %02X for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|ErrorStatus
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DetectControllers detects Mylex DAC960/AcceleRAID/eXtremeRAID&n;  PCI RAID Controllers by interrogating the PCI Configuration Space for&n;  Controller Type.&n;*/
DECL|function|DAC960_DetectControllers
r_static
r_void
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_HardwareType_T
id|HardwareType
)paren
(brace
r_void
(paren
op_star
id|InterruptHandler
)paren
(paren
r_int
comma
r_void
op_star
comma
id|Registers_T
op_star
)paren
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_FirmwareType_T
id|FirmwareType
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|VendorID
op_assign
l_int|0
comma
id|DeviceID
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|MemoryWindowSize
op_assign
l_int|0
suffix:semicolon
id|PCI_Device_T
op_star
id|PCI_Device
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_BA
suffix:semicolon
id|FirmwareType
op_assign
id|DAC960_V2_Controller
suffix:semicolon
id|InterruptHandler
op_assign
id|DAC960_BA_InterruptHandler
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_BA_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_LP
suffix:semicolon
id|FirmwareType
op_assign
id|DAC960_LP_Controller
suffix:semicolon
id|InterruptHandler
op_assign
id|DAC960_LP_InterruptHandler
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_LP_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_DEC
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_DEC_21285
suffix:semicolon
id|FirmwareType
op_assign
id|DAC960_V1_Controller
suffix:semicolon
id|InterruptHandler
op_assign
id|DAC960_LA_InterruptHandler
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_LA_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_PG
suffix:semicolon
id|FirmwareType
op_assign
id|DAC960_V1_Controller
suffix:semicolon
id|InterruptHandler
op_assign
id|DAC960_PG_InterruptHandler
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_PG_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|VendorID
op_assign
id|PCI_VENDOR_ID_MYLEX
suffix:semicolon
id|DeviceID
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_PD
suffix:semicolon
id|FirmwareType
op_assign
id|DAC960_V1_Controller
suffix:semicolon
id|InterruptHandler
op_assign
id|DAC960_PD_InterruptHandler
suffix:semicolon
id|MemoryWindowSize
op_assign
id|DAC960_PD_RegisterWindowSize
suffix:semicolon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|PCI_Device
op_assign
id|pci_find_device
c_func
(paren
id|VendorID
comma
id|DeviceID
comma
id|PCI_Device
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_IO_Address_T
id|IO_Address
op_assign
l_int|0
suffix:semicolon
id|DAC960_PCI_Address_T
id|PCI_Address
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|Bus
op_assign
id|PCI_Device-&gt;bus-&gt;number
suffix:semicolon
r_int
r_char
id|DeviceFunction
op_assign
id|PCI_Device-&gt;devfn
suffix:semicolon
r_int
r_char
id|Device
op_assign
id|DeviceFunction
op_rshift
l_int|3
suffix:semicolon
r_int
r_char
id|Function
op_assign
id|DeviceFunction
op_amp
l_int|0x7
suffix:semicolon
r_int
r_char
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
suffix:semicolon
r_int
r_int
id|IRQ_Channel
op_assign
id|PCI_Device-&gt;irq
suffix:semicolon
r_void
op_star
id|BaseAddress
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|PCI_Device
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|PCI_Device-&gt;subsystem_vendor
op_eq
id|PCI_VENDOR_ID_MYLEX
op_logical_and
id|PCI_Device-&gt;subsystem_device
op_eq
id|PCI_DEVICE_ID_MYLEX_DAC960_LA
)paren
)paren
r_continue
suffix:semicolon
id|PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|IO_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
id|PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DAC960_ControllerCount
op_eq
id|DAC960_MaxControllers
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;More than %d DAC960 Controllers detected - &quot;
l_string|&quot;ignoring from Controller at&bslash;n&quot;
comma
l_int|NULL
comma
id|DAC960_MaxControllers
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_Controller_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to allocate Controller structure for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|memset
c_func
(paren
id|Controller
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_Controller_T
)paren
)paren
suffix:semicolon
id|Controller-&gt;ControllerNumber
op_assign
id|DAC960_ControllerCount
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
)paren
suffix:semicolon
id|DAC960_Controllers
(braket
id|DAC960_ControllerCount
op_increment
)braket
op_assign
id|Controller
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;FirmwareType
op_assign
id|FirmwareType
suffix:semicolon
id|Controller-&gt;HardwareType
op_assign
id|HardwareType
suffix:semicolon
id|Controller-&gt;IO_Address
op_assign
id|IO_Address
suffix:semicolon
id|Controller-&gt;PCI_Address
op_assign
id|PCI_Address
suffix:semicolon
id|Controller-&gt;Bus
op_assign
id|Bus
suffix:semicolon
id|Controller-&gt;Device
op_assign
id|Device
suffix:semicolon
id|Controller-&gt;Function
op_assign
id|Function
suffix:semicolon
multiline_comment|/*&n;&t;Map the Controller Register Window.&n;      */
r_if
c_cond
(paren
id|MemoryWindowSize
OL
id|PAGE_SIZE
)paren
id|MemoryWindowSize
op_assign
id|PAGE_SIZE
suffix:semicolon
id|Controller-&gt;MemoryMappedAddress
op_assign
id|ioremap_nocache
c_func
(paren
id|PCI_Address
op_amp
id|PAGE_MASK
comma
id|MemoryWindowSize
)paren
suffix:semicolon
id|Controller-&gt;BaseAddress
op_assign
id|Controller-&gt;MemoryMappedAddress
op_plus
(paren
id|PCI_Address
op_amp
op_complement
id|PAGE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to map Controller Register Window for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|BaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
r_switch
c_cond
(paren
id|HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|DAC960_BA_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_BA_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_BA_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_BA_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_BA_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V2_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V2_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V2_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V2_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|DAC960_LP_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_LP_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LP_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_LP_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LP_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V2_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V2_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V2_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V2_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
id|DAC960_LA_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_LA_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LA_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_LA_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LA_QueueCommandDualMode
suffix:semicolon
r_else
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LA_QueueCommandSingleMode
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|DAC960_PG_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PG_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PG_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PG_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PG_QueueCommandDualMode
suffix:semicolon
r_else
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PG_QueueCommandSingleMode
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|request_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
comma
id|Controller-&gt;FullModelName
)paren
suffix:semicolon
id|DAC960_PD_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PD_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|DAC960_PD_EnableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PD_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;Acquire shared access to the IRQ Channel.&n;      */
r_if
c_cond
(paren
id|IRQ_Channel
op_eq
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;IRQ Channel %d illegal for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|IRQ_Channel
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;DAC960&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_Channel
comma
id|InterruptHandler
comma
id|SA_SHIRQ
comma
id|Controller-&gt;FullModelName
comma
id|Controller
)paren
OL
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to acquire IRQ Channel %d for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|IRQ_Channel
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|Controller-&gt;IRQ_Channel
op_assign
id|IRQ_Channel
suffix:semicolon
id|DAC960_ActiveControllerCount
op_increment
suffix:semicolon
id|Controller-&gt;InitialCommand.CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|Controller-&gt;InitialCommand.Controller
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;Commands
(braket
l_int|0
)braket
op_assign
op_amp
id|Controller-&gt;InitialCommand
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
op_amp
id|Controller-&gt;InitialCommand
suffix:semicolon
id|Controller-&gt;ControllerDetectionSuccessful
op_assign
l_bool|true
suffix:semicolon
r_continue
suffix:semicolon
id|Failure
suffix:colon
r_if
c_cond
(paren
id|IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Bus
comma
id|Device
comma
id|Function
comma
id|PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Bus
comma
id|Device
comma
id|Function
comma
id|IO_Address
comma
id|PCI_Address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
op_ne
l_int|NULL
)paren
id|iounmap
c_func
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IRQ_Channel
OG
l_int|0
)paren
id|free_irq
c_func
(paren
id|IRQ_Channel
comma
id|Controller
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_SortControllers sorts the Controllers by PCI Bus and Device Number.&n;*/
DECL|function|DAC960_SortControllers
r_static
r_void
id|DAC960_SortControllers
c_func
(paren
r_void
)paren
(brace
r_int
id|ControllerNumber
comma
id|LastInterchange
comma
id|Bound
comma
id|j
suffix:semicolon
id|LastInterchange
op_assign
id|DAC960_ControllerCount
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|LastInterchange
OG
l_int|0
)paren
(brace
id|Bound
op_assign
id|LastInterchange
suffix:semicolon
id|LastInterchange
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|Bound
suffix:semicolon
id|j
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller1
op_assign
id|DAC960_Controllers
(braket
id|j
)braket
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller2
op_assign
id|DAC960_Controllers
(braket
id|j
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller1-&gt;Bus
OG
id|Controller2-&gt;Bus
op_logical_or
(paren
id|Controller1-&gt;Bus
op_eq
id|Controller2-&gt;Bus
op_logical_and
(paren
id|Controller1-&gt;Device
OG
id|Controller2-&gt;Device
)paren
)paren
)paren
(brace
id|Controller2-&gt;ControllerNumber
op_assign
id|j
suffix:semicolon
id|DAC960_Controllers
(braket
id|j
)braket
op_assign
id|Controller2
suffix:semicolon
id|Controller1-&gt;ControllerNumber
op_assign
id|j
op_plus
l_int|1
suffix:semicolon
id|DAC960_Controllers
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|Controller1
suffix:semicolon
id|LastInterchange
op_assign
id|j
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;ControllerDetectionSuccessful
)paren
(brace
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;  DAC960_InitializeController initializes Controller.&n;*/
DECL|function|DAC960_InitializeController
r_static
r_void
id|DAC960_InitializeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|DAC960_ReadControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_CreateAuxiliaryStructures
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReadDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_RegisterBlockDevice
c_func
(paren
id|Controller
)paren
)paren
(brace
multiline_comment|/*&n;&t;Initialize the Monitoring Timer.&n;      */
id|init_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|Controller-&gt;MonitoringTimer.data
op_assign
(paren
r_int
r_int
)paren
id|Controller
suffix:semicolon
id|Controller-&gt;MonitoringTimer.function
op_assign
id|DAC960_MonitoringTimerFunction
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;ControllerInitialized
op_assign
l_bool|true
suffix:semicolon
)brace
r_else
id|DAC960_FinalizeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_FinalizeController finalizes Controller.&n;*/
DECL|function|DAC960_FinalizeController
r_static
r_void
id|DAC960_FinalizeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ControllerInitialized
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|DAC960_Notice
c_func
(paren
l_string|&quot;Flushing Cache...&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Flush
comma
l_int|NULL
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;done&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_LA_Controller
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|free_pages
c_func
(paren
id|Controller-&gt;MemoryMailboxPagesAddress
comma
id|Controller-&gt;MemoryMailboxPagesOrder
)paren
suffix:semicolon
r_else
id|DAC960_LA_SaveMemoryMailboxInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|free_pages
c_func
(paren
id|Controller-&gt;MemoryMailboxPagesAddress
comma
id|Controller-&gt;MemoryMailboxPagesOrder
)paren
suffix:semicolon
r_else
id|DAC960_PG_SaveMemoryMailboxInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|release_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|DAC960_Notice
c_func
(paren
l_string|&quot;Flushing Cache...&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_DeviceOperation
c_func
(paren
id|Controller
comma
id|DAC960_V2_PauseDevice
comma
id|DAC960_V2_RAID_Controller
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;done&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|free_pages
c_func
(paren
id|Controller-&gt;MemoryMailboxPagesAddress
comma
id|Controller-&gt;MemoryMailboxPagesOrder
)paren
suffix:semicolon
)brace
)brace
id|free_irq
c_func
(paren
id|Controller-&gt;IRQ_Channel
comma
id|Controller
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
suffix:semicolon
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_DestroyAuxiliaryStructures
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_Controllers
(braket
id|Controller-&gt;ControllerNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Initialize initializes the DAC960 Driver.&n;*/
DECL|function|DAC960_Initialize
r_void
id|DAC960_Initialize
c_func
(paren
r_void
)paren
(brace
r_int
id|ControllerNumber
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_BA_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_LP_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_LA_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_PG_Controller
)paren
suffix:semicolon
id|DAC960_DetectControllers
c_func
(paren
id|DAC960_PD_Controller
)paren
suffix:semicolon
id|DAC960_SortControllers
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ActiveControllerCount
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_int
id|LogicalDriveNumber
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|DAC960_InitializeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
id|DAC960_RegisterDisk
c_func
(paren
id|Controller
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
)brace
id|DAC960_CreateProcEntries
c_func
(paren
)paren
suffix:semicolon
id|register_reboot_notifier
c_func
(paren
op_amp
id|DAC960_NotifierBlock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Finalize finalizes the DAC960 Driver.&n;*/
DECL|function|DAC960_Finalize
r_static
r_int
id|DAC960_Finalize
c_func
(paren
id|NotifierBlock_T
op_star
id|NotifierBlock
comma
r_int
r_int
id|Event
comma
r_void
op_star
id|Buffer
)paren
(brace
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|Event
op_eq
id|SYS_RESTART
op_logical_or
id|Event
op_eq
id|SYS_HALT
op_logical_or
id|Event
op_eq
id|SYS_POWER_OFF
)paren
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ActiveControllerCount
op_eq
l_int|0
)paren
r_return
id|NOTIFY_OK
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
r_if
c_cond
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
op_ne
l_int|NULL
)paren
id|DAC960_FinalizeController
c_func
(paren
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
)paren
suffix:semicolon
id|DAC960_DestroyProcEntries
c_func
(paren
)paren
suffix:semicolon
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|DAC960_NotifierBlock
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_QueueReadWriteCommand prepares and queues a Read/Write Command for&n;  DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_QueueReadWriteCommand
r_static
r_void
id|DAC960_V1_QueueReadWriteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Read
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Write
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Command-&gt;RequestBuffer
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V1_ScatterGatherSegment_T
op_star
id|ScatterGatherList
op_assign
id|Command-&gt;V1.ScatterGatherList
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_char
op_star
id|LastDataEndPointer
op_assign
l_int|NULL
suffix:semicolon
r_int
id|SegmentNumber
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_ReadWithOldScatterGather
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_WriteWithOldScatterGather
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|ScatterGatherList
)paren
suffix:semicolon
id|CommandMailbox-&gt;Type5.ScatterGatherCount
op_assign
id|Command-&gt;SegmentCount
suffix:semicolon
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|BufferHeader-&gt;b_data
op_eq
id|LastDataEndPointer
)paren
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
op_minus
l_int|1
)braket
dot
id|SegmentByteCount
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
)brace
r_else
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentByteCount
op_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_assign
id|BufferHeader-&gt;b_data
op_plus
id|BufferHeader-&gt;b_size
suffix:semicolon
r_if
c_cond
(paren
id|SegmentNumber
op_increment
OG
id|Controller-&gt;DriverScatterGatherLimit
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: Scatter/Gather Segment Overflow&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|BufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SegmentNumber
op_ne
id|Command-&gt;SegmentCount
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: SegmentNumber != SegmentCount&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_QueueReadWriteCommand prepares and queues a Read/Write Command for&n;  DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_QueueReadWriteCommand
r_static
r_void
id|DAC960_V2_QueueReadWriteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandOpcode
op_assign
id|DAC960_V2_SCSI_10
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits.DataTransferControllerToHost
op_assign
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
id|Command-&gt;BlockCount
op_lshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.RequestSenseBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Command-&gt;V2.RequestSense
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice
op_assign
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|Command-&gt;LogicalDriveNumber
)braket
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.RequestSenseSize
op_assign
r_sizeof
(paren
id|DAC960_SCSI_RequestSense_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CDBLength
op_assign
l_int|10
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|0
)braket
op_assign
(paren
id|Command-&gt;CommandType
op_eq
id|DAC960_ReadCommand
ques
c_cond
l_int|0x28
suffix:colon
l_int|0x2A
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|24
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|16
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|7
)braket
op_assign
id|Command-&gt;BlockCount
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|8
)braket
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
op_eq
l_int|1
)paren
(brace
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|Command-&gt;RequestBuffer
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_ScatterGatherSegment_T
op_star
id|ScatterGatherList
op_assign
id|Command-&gt;V2.ScatterGatherList
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_char
op_star
id|LastDataEndPointer
op_assign
l_int|NULL
suffix:semicolon
r_int
id|SegmentNumber
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
OG
l_int|2
)paren
(brace
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ExtendedScatterGather.ScatterGatherList0Length
op_assign
id|Command-&gt;SegmentCount
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ExtendedScatterGather.ScatterGatherList0Address
op_assign
id|Virtual_to_Bus
c_func
(paren
id|ScatterGatherList
)paren
suffix:semicolon
)brace
r_else
id|ScatterGatherList
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
suffix:semicolon
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|BufferHeader-&gt;b_data
op_eq
id|LastDataEndPointer
)paren
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
op_minus
l_int|1
)braket
dot
id|SegmentByteCount
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_add_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
)brace
r_else
(brace
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|ScatterGatherList
(braket
id|SegmentNumber
)braket
dot
id|SegmentByteCount
op_assign
id|BufferHeader-&gt;b_size
suffix:semicolon
id|LastDataEndPointer
op_assign
id|BufferHeader-&gt;b_data
op_plus
id|BufferHeader-&gt;b_size
suffix:semicolon
r_if
c_cond
(paren
id|SegmentNumber
op_increment
OG
id|Controller-&gt;DriverScatterGatherLimit
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: Scatter/Gather Segment Overflow&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|BufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SegmentNumber
op_ne
id|Command-&gt;SegmentCount
)paren
id|panic
c_func
(paren
l_string|&quot;DAC960: SegmentNumber != SegmentCount&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessRequest attempts to remove one I/O Request from Controller&squot;s&n;  I/O Request Queue and queues it to the Controller.  WaitForCommand is true if&n;  this function should wait for a Command to become available if necessary.&n;  This function returns true if an I/O Request was queued and false otherwise.&n;*/
DECL|function|DAC960_ProcessRequest
r_static
id|boolean
id|DAC960_ProcessRequest
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|boolean
id|WaitForCommand
)paren
(brace
id|RequestQueue_T
op_star
id|RequestQueue
op_assign
id|Controller-&gt;RequestQueue
suffix:semicolon
id|ListHead_T
op_star
id|RequestQueueHead
suffix:semicolon
id|IO_Request_T
op_star
id|Request
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_if
c_cond
(paren
id|RequestQueue
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|RequestQueueHead
op_assign
op_amp
id|RequestQueue-&gt;queue_head
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|RequestQueueHead
)paren
)paren
r_return
l_bool|false
suffix:semicolon
id|Request
op_assign
id|blkdev_entry_next_request
c_func
(paren
id|RequestQueueHead
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|WaitForCommand
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Request-&gt;cmd
op_eq
id|READ
)paren
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadCommand
suffix:semicolon
r_else
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteCommand
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
id|Request-&gt;sem
suffix:semicolon
id|Command-&gt;LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Request-&gt;rq_dev
)paren
suffix:semicolon
id|Command-&gt;BlockNumber
op_assign
id|Request-&gt;sector
op_plus
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Request-&gt;rq_dev
)paren
)braket
dot
id|start_sect
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|Request-&gt;nr_sectors
suffix:semicolon
id|Command-&gt;SegmentCount
op_assign
id|Request-&gt;nr_segments
suffix:semicolon
id|Command-&gt;BufferHeader
op_assign
id|Request-&gt;bh
suffix:semicolon
id|Command-&gt;RequestBuffer
op_assign
id|Request-&gt;buffer
suffix:semicolon
id|blkdev_dequeue_request
c_func
(paren
id|Request
)paren
suffix:semicolon
id|blkdev_release_request
c_func
(paren
id|Request
)paren
suffix:semicolon
id|DAC960_QueueReadWriteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessRequests attempts to remove as many I/O Requests as possible&n;  from Controller&squot;s I/O Request Queue and queue them to the Controller.&n;*/
DECL|function|DAC960_ProcessRequests
r_static
r_inline
r_void
id|DAC960_ProcessRequests
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|Counter
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
id|Counter
op_increment
op_eq
l_int|0
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction is the I/O Request Function for DAC960 Controllers.&n;*/
DECL|function|DAC960_RequestFunction
r_static
r_void
id|DAC960_RequestFunction
c_func
(paren
id|RequestQueue_T
op_star
id|RequestQueue
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|RequestQueue-&gt;queuedata
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process I/O Requests for Controller.&n;  */
id|DAC960_ProcessRequests
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockRF
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessCompletedBuffer performs completion processing for an&n;  individual Buffer.&n;*/
DECL|function|DAC960_ProcessCompletedBuffer
r_static
r_inline
r_void
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader_T
op_star
id|BufferHeader
comma
id|boolean
id|SuccessfulIO
)paren
(brace
id|BufferHeader
op_member_access_from_pointer
id|b_end_io
c_func
(paren
id|BufferHeader
comma
id|SuccessfulIO
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadWriteError prints an appropriate error message for Command&n;  when an error occurs on a Read or Write operation.&n;*/
DECL|function|DAC960_V1_ReadWriteError
r_static
r_void
id|DAC960_V1_ReadWriteError
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_int
r_char
op_star
id|CommandName
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandType
)paren
(brace
r_case
id|DAC960_ReadCommand
suffix:colon
r_case
id|DAC960_ReadRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;READ&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_WriteCommand
suffix:colon
r_case
id|DAC960_WriteRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;WRITE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_MonitoringCommand
suffix:colon
r_case
id|DAC960_ImmediateCommand
suffix:colon
r_case
id|DAC960_QueuedCommand
suffix:colon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_IrrecoverableDataError
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Irrecoverable Data Error on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_LogicalDriveNonexistentOrOffline
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Logical Drive Nonexistent or Offline on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_AccessBeyondEndOfLogicalDrive
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Attempt to Access Beyond End of Logical Drive &quot;
l_string|&quot;on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BadDataEncountered
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Bad Data Encountered on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Unexpected Error Status %04X on %s:&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;V1.CommandStatus
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%d:   absolute blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|Command-&gt;BlockNumber
comma
id|Command-&gt;BlockNumber
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
OG
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%dp%d: relative blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ProcessCompletedCommand performs completion processing for Command&n;  for DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ProcessCompletedCommand
r_static
r_void
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandType_T
id|CommandType
op_assign
id|Command-&gt;CommandType
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
op_assign
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
(brace
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
id|add_blkdev_randomness
c_func
(paren
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CommandStatus
op_eq
id|DAC960_V1_IrrecoverableDataError
op_logical_or
id|CommandStatus
op_eq
id|DAC960_V1_BadDataEncountered
)paren
op_logical_and
id|BufferHeader
op_ne
l_int|NULL
op_logical_and
id|BufferHeader-&gt;b_reqnext
op_ne
l_int|NULL
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
)paren
(brace
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadRetryCommand
suffix:semicolon
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Read
suffix:semicolon
)brace
r_else
(brace
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteRetryCommand
suffix:semicolon
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Write
suffix:semicolon
)brace
id|Command-&gt;BlockCount
op_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_V1_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadRetryCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteRetryCommand
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;Perform completion processing for this single buffer.&n;      */
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_V1_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NextBufferHeader
op_ne
l_int|NULL
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|Command-&gt;BlockNumber
op_add_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|NextBufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|NextBufferHeader-&gt;b_data
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
op_logical_or
id|CommandOpcode
op_eq
id|DAC960_V1_Enquiry
op_logical_or
id|CommandOpcode
op_eq
id|DAC960_V1_GetRebuildProgress
)paren
(brace
r_if
c_cond
(paren
id|CommandType
op_ne
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_Enquiry
)paren
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.NewEnquiry
comma
id|Bus_to_Virtual
c_func
(paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
)paren
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetRebuildProgress
)paren
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.RebuildProgress
comma
id|Bus_to_Virtual
c_func
(paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
)paren
comma
r_sizeof
(paren
id|DAC960_V1_RebuildProgress_T
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_Enquiry
op_logical_and
id|Controller-&gt;ControllerInitialized
)paren
(brace
id|DAC960_V1_Enquiry_T
op_star
id|OldEnquiry
op_assign
op_amp
id|Controller-&gt;V1.Enquiry
suffix:semicolon
id|DAC960_V1_Enquiry_T
op_star
id|NewEnquiry
op_assign
op_amp
id|Controller-&gt;V1.NewEnquiry
suffix:semicolon
r_int
r_int
id|OldCriticalLogicalDriveCount
op_assign
id|OldEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_int
r_int
id|NewCriticalLogicalDriveCount
op_assign
id|NewEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_if
c_cond
(paren
id|NewEnquiry-&gt;NumberOfLogicalDrives
OG
id|Controller-&gt;LogicalDriveCount
)paren
(brace
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
r_while
c_loop
(paren
id|LogicalDriveNumber
OL
id|NewEnquiry-&gt;NumberOfLogicalDrives
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;Now Exists&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
id|LogicalDriveNumber
op_increment
suffix:semicolon
)brace
id|Controller-&gt;LogicalDriveCount
op_assign
id|LogicalDriveNumber
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
op_ne
id|OldEnquiry-&gt;StatusFlags.DeferredWriteError
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Deferred Write Error Flag is now %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewCriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewCriticalLogicalDriveCount
op_ne
id|OldCriticalLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;OfflineLogicalDriveCount
op_ne
id|OldEnquiry-&gt;OfflineLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;DeadDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;DeadDriveCount
op_ne
id|OldEnquiry-&gt;DeadDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;EventLogSequenceNumber
op_ne
id|OldEnquiry-&gt;EventLogSequenceNumber
)paren
op_logical_or
id|Controller-&gt;MonitoringTimerCount
op_eq
l_int|0
op_logical_or
(paren
id|jiffies
op_minus
id|Controller-&gt;SecondaryMonitoringTime
op_ge
id|DAC960_SecondaryMonitoringInterval
)paren
)paren
(brace
id|Controller-&gt;V1.NeedLogicalDriveInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NewEventLogSequenceNumber
op_assign
id|NewEnquiry-&gt;EventLogSequenceNumber
suffix:semicolon
id|Controller-&gt;V1.NeedErrorTableInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceStateInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DeviceStateChannel
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V1.DeviceStateTargetID
op_assign
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;SecondaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_StandbyRebuildInProgress
op_logical_or
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_StandbyRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundRebuildInProgress
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.RebuildProgressFirst
op_assign
(paren
id|NewEnquiry-&gt;CriticalLogicalDriveCount
OL
id|OldEnquiry-&gt;CriticalLogicalDriveCount
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundCheckInProgress
)paren
r_switch
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
)paren
(brace
r_case
id|DAC960_V1_NoStandbyRebuildOrCheckInProgress
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_StandbyRebuildInProgress
suffix:colon
r_case
id|DAC960_V1_BackgroundRebuildInProgress
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundCheckInProgress
suffix:colon
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_StandbyRebuildCompletedWithError
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed with Error&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_DriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Physical Device Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_LogicalDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Logical Drive Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_OtherCauses
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - Other Causes&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckSuccessfullyTerminated
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Successfully Terminated&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundCheckInProgress
)paren
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;MonitoringAlertMode
op_assign
(paren
id|NewEnquiry-&gt;CriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;DeadDriveCount
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_ne
id|DAC960_MonitoringCommand
op_logical_and
id|Controller-&gt;V1.RebuildFlagPending
)paren
(brace
id|DAC960_V1_Enquiry_T
op_star
id|Enquiry
op_assign
(paren
id|DAC960_V1_Enquiry_T
op_star
)paren
id|Bus_to_Virtual
c_func
(paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
)paren
suffix:semicolon
id|Enquiry-&gt;RebuildFlag
op_assign
id|Controller-&gt;V1.PendingRebuildFlag
suffix:semicolon
id|Controller-&gt;V1.RebuildFlagPending
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
op_logical_and
id|NewEnquiry-&gt;RebuildFlag
OG
id|DAC960_V1_BackgroundCheckInProgress
)paren
(brace
id|Controller-&gt;V1.PendingRebuildFlag
op_assign
id|NewEnquiry-&gt;RebuildFlag
suffix:semicolon
id|Controller-&gt;V1.RebuildFlagPending
op_assign
l_bool|true
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.Enquiry
comma
op_amp
id|Controller-&gt;V1.NewEnquiry
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_PerformEventLogOperation
)paren
(brace
r_static
r_char
op_star
id|DAC960_EventMessages
(braket
)braket
op_assign
(brace
l_string|&quot;killed because write recovery failed&quot;
comma
l_string|&quot;killed because of SCSI bus reset failure&quot;
comma
l_string|&quot;killed because of double check condition&quot;
comma
l_string|&quot;killed because it was removed&quot;
comma
l_string|&quot;killed because of gross error on SCSI chip&quot;
comma
l_string|&quot;killed because of bad tag returned from drive&quot;
comma
l_string|&quot;killed because of timeout on SCSI command&quot;
comma
l_string|&quot;killed because of reset SCSI command issued from system&quot;
comma
l_string|&quot;killed because busy or parity error count exceeded limit&quot;
comma
l_string|&quot;killed because of &squot;kill drive&squot; command from system&quot;
comma
l_string|&quot;killed because of selection timeout&quot;
comma
l_string|&quot;killed due to SCSI phase sequence error&quot;
comma
l_string|&quot;killed due to unknown status&quot;
)brace
suffix:semicolon
id|DAC960_V1_EventLogEntry_T
op_star
id|EventLogEntry
op_assign
op_amp
id|Controller-&gt;V1.EventLogEntry
suffix:semicolon
r_if
c_cond
(paren
id|EventLogEntry-&gt;SequenceNumber
op_eq
id|Controller-&gt;V1.OldEventLogSequenceNumber
)paren
(brace
r_int
r_char
id|SenseKey
op_assign
id|EventLogEntry-&gt;SenseKey
suffix:semicolon
r_int
r_char
id|AdditionalSenseCode
op_assign
id|EventLogEntry-&gt;AdditionalSenseCode
suffix:semicolon
r_int
r_char
id|AdditionalSenseCodeQualifier
op_assign
id|EventLogEntry-&gt;AdditionalSenseCodeQualifier
suffix:semicolon
r_if
c_cond
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_VendorSpecific
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x80
op_logical_and
id|AdditionalSenseCodeQualifier
OL
r_sizeof
(paren
id|DAC960_EventMessages
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|DAC960_EventMessages
(braket
id|AdditionalSenseCodeQualifier
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_UnitAttention
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x29
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;MonitoringTimerCount
OG
l_int|0
)paren
id|Controller-&gt;V1.DeviceResetCount
(braket
id|EventLogEntry-&gt;Channel
)braket
(braket
id|EventLogEntry-&gt;TargetID
)braket
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_NoSense
op_logical_or
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_NotReady
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x04
op_logical_and
(paren
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x01
op_logical_or
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x02
)paren
)paren
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Error Log: &quot;
l_string|&quot;Sense Key = %d, ASC = %02X, ASCQ = %02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|SenseKey
comma
id|AdditionalSenseCode
comma
id|AdditionalSenseCodeQualifier
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Error Log: &quot;
l_string|&quot;Information = %02X%02X%02X%02X &quot;
l_string|&quot;%02X%02X%02X%02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|EventLogEntry-&gt;Information
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|3
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
)brace
id|Controller-&gt;V1.OldEventLogSequenceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetErrorTable
)paren
(brace
id|DAC960_V1_ErrorTable_T
op_star
id|OldErrorTable
op_assign
op_amp
id|Controller-&gt;V1.ErrorTable
suffix:semicolon
id|DAC960_V1_ErrorTable_T
op_star
id|NewErrorTable
op_assign
op_amp
id|Controller-&gt;V1.NewErrorTable
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_V1_ErrorTableEntry_T
op_star
id|NewErrorEntry
op_assign
op_amp
id|NewErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_ErrorTableEntry_T
op_star
id|OldErrorEntry
op_assign
op_amp
id|OldErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewErrorEntry-&gt;ParityErrorCount
op_ne
id|OldErrorEntry-&gt;ParityErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;SoftErrorCount
op_ne
id|OldErrorEntry-&gt;SoftErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;HardErrorCount
op_ne
id|OldErrorEntry-&gt;HardErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;MiscErrorCount
op_ne
id|OldErrorEntry-&gt;MiscErrorCount
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Parity = %d, Soft = %d, &quot;
l_string|&quot;Hard = %d, Misc = %d&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|NewErrorEntry-&gt;ParityErrorCount
comma
id|NewErrorEntry-&gt;SoftErrorCount
comma
id|NewErrorEntry-&gt;HardErrorCount
comma
id|NewErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.ErrorTable
comma
op_amp
id|Controller-&gt;V1.NewErrorTable
comma
r_sizeof
(paren
id|DAC960_V1_ErrorTable_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetDeviceState
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|OldDeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
id|DAC960_V1_DeviceState_T
op_star
id|NewDeviceState
op_assign
op_amp
id|Controller-&gt;V1.NewDeviceState
suffix:semicolon
r_if
c_cond
(paren
id|NewDeviceState-&gt;DeviceState
op_ne
id|OldDeviceState-&gt;DeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d is now %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;V1.DeviceStateChannel
comma
id|Controller-&gt;V1.DeviceStateTargetID
comma
(paren
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;DEAD&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;WRITE-ONLY&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
l_string|&quot;STANDBY&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|OldDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
op_logical_and
id|NewDeviceState-&gt;DeviceState
op_ne
id|DAC960_V1_Device_Dead
)paren
(brace
id|Controller-&gt;V1.NeedDeviceInquiryInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|OldDeviceState
comma
id|NewDeviceState
comma
r_sizeof
(paren
id|DAC960_V1_DeviceState_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetLogicalDriveInformation
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|OldLogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|NewLogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;V1.NewLogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_ne
id|OldLogicalDriveInformation-&gt;LogicalDriveState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
l_string|&quot;OFFLINE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
op_ne
id|OldLogicalDriveInformation-&gt;WriteBack
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;WRITE BACK&quot;
suffix:colon
l_string|&quot;WRITE THRU&quot;
)paren
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
comma
op_amp
id|Controller-&gt;V1.NewLogicalDriveInformation
comma
r_sizeof
(paren
id|DAC960_V1_LogicalDriveInformationArray_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetRebuildProgress
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;V1.RebuildProgress.LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;V1.RebuildProgress.LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;V1.RebuildProgress.RemainingBlocks
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NoRebuildOrCheckInProgress
op_logical_and
id|Controller-&gt;V1.LastRebuildStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
id|CommandStatus
op_assign
id|DAC960_V1_RebuildSuccessful
suffix:semicolon
r_switch
c_cond
(paren
id|CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_LogicalDriveFailure
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Logical Drive Failure&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_BadBlocksOnOther
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Bad Blocks on Other Drives&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_NewDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Failure of Drive Being Rebuilt&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NoRebuildOrCheckInProgress
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildSuccessful
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildSuccessfullyTerminated
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Successfully Terminated&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|Controller-&gt;V1.LastRebuildStatus
op_assign
id|CommandStatus
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_ne
id|DAC960_MonitoringCommand
op_logical_and
id|Controller-&gt;V1.RebuildStatusPending
)paren
(brace
id|Command-&gt;V1.CommandStatus
op_assign
id|Controller-&gt;V1.PendingRebuildStatus
suffix:semicolon
id|Controller-&gt;V1.RebuildStatusPending
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
op_logical_and
id|CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
op_logical_and
id|CommandStatus
op_ne
id|DAC960_V1_NoRebuildOrCheckInProgress
)paren
(brace
id|Controller-&gt;V1.PendingRebuildStatus
op_assign
id|CommandStatus
suffix:semicolon
id|Controller-&gt;V1.RebuildStatusPending
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_RebuildStat
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;V1.RebuildProgress.LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;V1.RebuildProgress.LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;V1.RebuildProgress.RemainingBlocks
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
(brace
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NewEventLogSequenceNumber
op_minus
id|Controller-&gt;V1.OldEventLogSequenceNumber
OG
l_int|0
)paren
(brace
id|Command-&gt;V1.CommandMailbox.Type3E.CommandOpcode
op_assign
id|DAC960_V1_PerformEventLogOperation
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.OperationType
op_assign
id|DAC960_V1_GetEventLogEntry
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.OperationQualifier
op_assign
l_int|1
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.SequenceNumber
op_assign
id|Controller-&gt;V1.OldEventLogSequenceNumber
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.EventLogEntry
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedErrorTableInformation
)paren
(brace
id|Controller-&gt;V1.NeedErrorTableInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetErrorTable
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.NewErrorTable
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedRebuildProgress
op_logical_and
id|Controller-&gt;V1.RebuildProgressFirst
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetRebuildProgress
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceStateInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceInquiryInformation
)paren
(brace
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
op_amp
id|Controller-&gt;V1.MonitoringDCDB
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryStandardData
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceInquiryInformation
op_assign
l_bool|false
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
op_amp
id|Controller-&gt;V1.MonitoringDCDB
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
op_assign
l_bool|false
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|Controller-&gt;V1.DeviceStateTargetID
op_eq
id|Controller-&gt;Targets
)paren
(brace
id|Controller-&gt;V1.DeviceStateChannel
op_increment
suffix:semicolon
id|Controller-&gt;V1.DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|Controller-&gt;V1.DeviceStateChannel
OL
id|Controller-&gt;Channels
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|OldDeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|OldDeviceState-&gt;Present
op_logical_and
id|OldDeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
)paren
(brace
id|Command-&gt;V1.CommandMailbox.Type3D.CommandOpcode
op_assign
id|DAC960_V1_GetDeviceState
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.NewDeviceState
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|Controller-&gt;V1.DeviceStateTargetID
op_eq
id|Controller-&gt;Targets
)paren
(brace
id|Controller-&gt;V1.DeviceStateChannel
op_increment
suffix:semicolon
id|Controller-&gt;V1.DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|Controller-&gt;V1.NeedDeviceStateInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedLogicalDriveInformation
)paren
(brace
id|Controller-&gt;V1.NeedLogicalDriveInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetLogicalDriveInformation
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.NewLogicalDriveInformation
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedRebuildProgress
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetRebuildProgress
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedConsistencyCheckProgress
)paren
(brace
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_RebuildStat
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.RebuildProgress
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;MonitoringTimerCount
op_increment
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ImmediateCommand
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_QueuedCommand
)paren
(brace
id|DAC960_V1_KernelCommand_T
op_star
id|KernelCommand
op_assign
id|Command-&gt;V1.KernelCommand
suffix:semicolon
id|KernelCommand-&gt;CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|Command-&gt;V1.KernelCommand
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
id|Controller-&gt;V1.DirectCommandActive
(braket
id|KernelCommand-&gt;DCDB-&gt;Channel
)braket
(braket
id|KernelCommand-&gt;DCDB-&gt;TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|KernelCommand
op_member_access_from_pointer
id|CompletionFunction
c_func
(paren
id|KernelCommand
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Queue a Status Monitoring Command to the Controller using the just&n;    completed Command if one was deferred previously due to lack of a&n;    free Command when the Monitoring Timer Function was called.&n;  */
r_if
c_cond
(paren
id|Controller-&gt;MonitoringCommandDeferred
)paren
(brace
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Deallocate the Command.&n;  */
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;    Wake up any processes waiting on a free Command.&n;  */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadWriteError prints an appropriate error message for Command&n;  when an error occurs on a Read or Write operation.&n;*/
DECL|function|DAC960_V2_ReadWriteError
r_static
r_void
id|DAC960_V2_ReadWriteError
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_int
r_char
op_star
id|SenseErrors
(braket
)braket
op_assign
(brace
l_string|&quot;NO SENSE&quot;
comma
l_string|&quot;RECOVERED ERROR&quot;
comma
l_string|&quot;NOT READY&quot;
comma
l_string|&quot;MEDIUM ERROR&quot;
comma
l_string|&quot;HARDWARE ERROR&quot;
comma
l_string|&quot;ILLEGAL REQUEST&quot;
comma
l_string|&quot;UNIT ATTENTION&quot;
comma
l_string|&quot;DATA PROTECT&quot;
comma
l_string|&quot;BLANK CHECK&quot;
comma
l_string|&quot;VENDOR-SPECIFIC&quot;
comma
l_string|&quot;COPY ABORTED&quot;
comma
l_string|&quot;ABORTED COMMAND&quot;
comma
l_string|&quot;EQUAL&quot;
comma
l_string|&quot;VOLUME OVERFLOW&quot;
comma
l_string|&quot;MISCOMPARE&quot;
comma
l_string|&quot;RESERVED&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|CommandName
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandType
)paren
(brace
r_case
id|DAC960_ReadCommand
suffix:colon
r_case
id|DAC960_ReadRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;READ&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_WriteCommand
suffix:colon
r_case
id|DAC960_WriteRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;WRITE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_MonitoringCommand
suffix:colon
r_case
id|DAC960_ImmediateCommand
suffix:colon
r_case
id|DAC960_QueuedCommand
suffix:colon
r_break
suffix:semicolon
)brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Error Condition %s on %s:&bslash;n&quot;
comma
id|Controller
comma
id|SenseErrors
(braket
id|Command-&gt;V2.RequestSense.SenseKey
)braket
comma
id|CommandName
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%d:   absolute blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|Command-&gt;BlockNumber
comma
id|Command-&gt;BlockNumber
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
OG
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%dp%d: relative blocks %d..%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|DAC960_PartitionNumber
c_func
(paren
id|Command-&gt;BufferHeader-&gt;b_rdev
)paren
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
comma
id|Command-&gt;BufferHeader-&gt;b_rsector
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReportEvent prints an appropriate message when a Controller Event&n;  occurs.&n;*/
DECL|function|DAC960_V2_ReportEvent
r_static
r_void
id|DAC960_V2_ReportEvent
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_Event_T
op_star
id|Event
)paren
(brace
id|DAC960_SCSI_RequestSense_T
op_star
id|RequestSense
op_assign
(paren
id|DAC960_SCSI_RequestSense_T
op_star
)paren
op_amp
id|Event-&gt;RequestSenseData
suffix:semicolon
r_int
r_char
id|MessageBuffer
(braket
id|DAC960_LineBufferSize
)braket
suffix:semicolon
r_static
r_struct
(brace
r_int
id|EventCode
suffix:semicolon
r_int
r_char
op_star
id|EventMessage
suffix:semicolon
)brace
id|EventList
(braket
)braket
op_assign
(brace
multiline_comment|/* Physical Device Events (0x0000 - 0x007F) */
(brace
l_int|0x0001
comma
l_string|&quot;P Online&quot;
)brace
comma
(brace
l_int|0x0002
comma
l_string|&quot;P Standby&quot;
)brace
comma
(brace
l_int|0x0005
comma
l_string|&quot;P Automatic Rebuild Started&quot;
)brace
comma
(brace
l_int|0x0006
comma
l_string|&quot;P Manual Rebuild Started&quot;
)brace
comma
(brace
l_int|0x0007
comma
l_string|&quot;P Rebuild Completed&quot;
)brace
comma
(brace
l_int|0x0008
comma
l_string|&quot;P Rebuild Cancelled&quot;
)brace
comma
(brace
l_int|0x0009
comma
l_string|&quot;P Rebuild Failed for Unknown Reasons&quot;
)brace
comma
(brace
l_int|0x000A
comma
l_string|&quot;P Rebuild Failed due to New Physical Device&quot;
)brace
comma
(brace
l_int|0x000B
comma
l_string|&quot;P Rebuild Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x000C
comma
l_string|&quot;S Offline&quot;
)brace
comma
(brace
l_int|0x000D
comma
l_string|&quot;P Found&quot;
)brace
comma
(brace
l_int|0x000E
comma
l_string|&quot;P Gone&quot;
)brace
comma
(brace
l_int|0x000F
comma
l_string|&quot;P Unconfigured&quot;
)brace
comma
(brace
l_int|0x0010
comma
l_string|&quot;P Expand Capacity Started&quot;
)brace
comma
(brace
l_int|0x0011
comma
l_string|&quot;P Expand Capacity Completed&quot;
)brace
comma
(brace
l_int|0x0012
comma
l_string|&quot;P Expand Capacity Failed&quot;
)brace
comma
(brace
l_int|0x0016
comma
l_string|&quot;P Parity Error&quot;
)brace
comma
(brace
l_int|0x0017
comma
l_string|&quot;P Soft Error&quot;
)brace
comma
(brace
l_int|0x0018
comma
l_string|&quot;P Miscellaneous Error&quot;
)brace
comma
(brace
l_int|0x0019
comma
l_string|&quot;P Reset&quot;
)brace
comma
(brace
l_int|0x001A
comma
l_string|&quot;P Active Spare Found&quot;
)brace
comma
(brace
l_int|0x001B
comma
l_string|&quot;P Warm Spare Found&quot;
)brace
comma
(brace
l_int|0x001C
comma
l_string|&quot;S Sense Data Received&quot;
)brace
comma
(brace
l_int|0x001D
comma
l_string|&quot;P Initialization Started&quot;
)brace
comma
(brace
l_int|0x001E
comma
l_string|&quot;P Initialization Completed&quot;
)brace
comma
(brace
l_int|0x001F
comma
l_string|&quot;P Initialization Failed&quot;
)brace
comma
(brace
l_int|0x0020
comma
l_string|&quot;P Initialization Cancelled&quot;
)brace
comma
(brace
l_int|0x0021
comma
l_string|&quot;P Failed because Write Recovery Failed&quot;
)brace
comma
(brace
l_int|0x0022
comma
l_string|&quot;P Failed because SCSI Bus Reset Failed&quot;
)brace
comma
(brace
l_int|0x0023
comma
l_string|&quot;P Failed because of Double Check Condition&quot;
)brace
comma
(brace
l_int|0x0024
comma
l_string|&quot;P Failed because Device Cannot Be Accessed&quot;
)brace
comma
(brace
l_int|0x0025
comma
l_string|&quot;P Failed because of Gross Error on SCSI Processor&quot;
)brace
comma
(brace
l_int|0x0026
comma
l_string|&quot;P Failed because of Bad Tag from Device&quot;
)brace
comma
(brace
l_int|0x0027
comma
l_string|&quot;P Failed because of Command Timeout&quot;
)brace
comma
(brace
l_int|0x0028
comma
l_string|&quot;P Failed because of System Reset&quot;
)brace
comma
(brace
l_int|0x0029
comma
l_string|&quot;P Failed because of Busy Status or Parity Error&quot;
)brace
comma
(brace
l_int|0x002A
comma
l_string|&quot;P Failed because Host Set Device to Failed State&quot;
)brace
comma
(brace
l_int|0x002B
comma
l_string|&quot;P Failed because of Selection Timeout&quot;
)brace
comma
(brace
l_int|0x002C
comma
l_string|&quot;P Failed because of SCSI Bus Phase Error&quot;
)brace
comma
(brace
l_int|0x002D
comma
l_string|&quot;P Failed because Device Returned Unknown Status&quot;
)brace
comma
(brace
l_int|0x002E
comma
l_string|&quot;P Failed because Device Not Ready&quot;
)brace
comma
(brace
l_int|0x002F
comma
l_string|&quot;P Failed because Device Not Found at Startup&quot;
)brace
comma
(brace
l_int|0x0030
comma
l_string|&quot;P Failed because COD Write Operation Failed&quot;
)brace
comma
(brace
l_int|0x0031
comma
l_string|&quot;P Failed because BDT Write Operation Failed&quot;
)brace
comma
(brace
l_int|0x0039
comma
l_string|&quot;P Missing at Startup&quot;
)brace
comma
(brace
l_int|0x003A
comma
l_string|&quot;P Start Rebuild Failed due to Physical Drive Too Small&quot;
)brace
comma
multiline_comment|/* Logical Device Events (0x0080 - 0x00FF) */
(brace
l_int|0x0080
comma
l_string|&quot;M Consistency Check Started&quot;
)brace
comma
(brace
l_int|0x0081
comma
l_string|&quot;M Consistency Check Completed&quot;
)brace
comma
(brace
l_int|0x0082
comma
l_string|&quot;M Consistency Check Cancelled&quot;
)brace
comma
(brace
l_int|0x0083
comma
l_string|&quot;M Consistency Check Completed With Errors&quot;
)brace
comma
(brace
l_int|0x0084
comma
l_string|&quot;M Consistency Check Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x0085
comma
l_string|&quot;M Consistency Check Failed due to Physical Device Failure&quot;
)brace
comma
(brace
l_int|0x0086
comma
l_string|&quot;L Offline&quot;
)brace
comma
(brace
l_int|0x0087
comma
l_string|&quot;L Critical&quot;
)brace
comma
(brace
l_int|0x0088
comma
l_string|&quot;L Online&quot;
)brace
comma
(brace
l_int|0x0089
comma
l_string|&quot;M Automatic Rebuild Started&quot;
)brace
comma
(brace
l_int|0x008A
comma
l_string|&quot;M Manual Rebuild Started&quot;
)brace
comma
(brace
l_int|0x008B
comma
l_string|&quot;M Rebuild Completed&quot;
)brace
comma
(brace
l_int|0x008C
comma
l_string|&quot;M Rebuild Cancelled&quot;
)brace
comma
(brace
l_int|0x008D
comma
l_string|&quot;M Rebuild Failed for Unknown Reasons&quot;
)brace
comma
(brace
l_int|0x008E
comma
l_string|&quot;M Rebuild Failed due to New Physical Device&quot;
)brace
comma
(brace
l_int|0x008F
comma
l_string|&quot;M Rebuild Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x0090
comma
l_string|&quot;M Initialization Started&quot;
)brace
comma
(brace
l_int|0x0091
comma
l_string|&quot;M Initialization Completed&quot;
)brace
comma
(brace
l_int|0x0092
comma
l_string|&quot;M Initialization Cancelled&quot;
)brace
comma
(brace
l_int|0x0093
comma
l_string|&quot;M Initialization Failed&quot;
)brace
comma
(brace
l_int|0x0094
comma
l_string|&quot;L Found&quot;
)brace
comma
(brace
l_int|0x0095
comma
l_string|&quot;L Gone&quot;
)brace
comma
(brace
l_int|0x0096
comma
l_string|&quot;M Expand Capacity Started&quot;
)brace
comma
(brace
l_int|0x0097
comma
l_string|&quot;M Expand Capacity Completed&quot;
)brace
comma
(brace
l_int|0x0098
comma
l_string|&quot;M Expand Capacity Failed&quot;
)brace
comma
(brace
l_int|0x0099
comma
l_string|&quot;L Bad Block Found&quot;
)brace
comma
(brace
l_int|0x009A
comma
l_string|&quot;L Size Changed&quot;
)brace
comma
(brace
l_int|0x009B
comma
l_string|&quot;L Type Changed&quot;
)brace
comma
(brace
l_int|0x009C
comma
l_string|&quot;L Bad Data Block Found&quot;
)brace
comma
(brace
l_int|0x009E
comma
l_string|&quot;L Read of Data Block in BDT&quot;
)brace
comma
(brace
l_int|0x009F
comma
l_string|&quot;L Write Back Data for Disk Block Lost&quot;
)brace
comma
multiline_comment|/* Fault Management Events (0x0100 - 0x017F) */
(brace
l_int|0x0140
comma
l_string|&quot;E Fan %d Failed&quot;
)brace
comma
(brace
l_int|0x0141
comma
l_string|&quot;E Fan %d OK&quot;
)brace
comma
(brace
l_int|0x0142
comma
l_string|&quot;E Fan %d Not Present&quot;
)brace
comma
(brace
l_int|0x0143
comma
l_string|&quot;E Power Supply %d Failed&quot;
)brace
comma
(brace
l_int|0x0144
comma
l_string|&quot;E Power Supply %d OK&quot;
)brace
comma
(brace
l_int|0x0145
comma
l_string|&quot;E Power Supply %d Not Present&quot;
)brace
comma
(brace
l_int|0x0146
comma
l_string|&quot;E Temperature Sensor %d Failed&quot;
)brace
comma
(brace
l_int|0x0147
comma
l_string|&quot;E Temperature Sensor %d Critical&quot;
)brace
comma
(brace
l_int|0x0148
comma
l_string|&quot;E Temperature Sensor %d OK&quot;
)brace
comma
(brace
l_int|0x0149
comma
l_string|&quot;E Temperature Sensor %d Not Present&quot;
)brace
comma
(brace
l_int|0x014A
comma
l_string|&quot;E Unit %d Access Critical&quot;
)brace
comma
(brace
l_int|0x014B
comma
l_string|&quot;E Unit %d Access OK&quot;
)brace
comma
(brace
l_int|0x014C
comma
l_string|&quot;E Unit %d Access Offline&quot;
)brace
comma
multiline_comment|/* Controller Events (0x0180 - 0x01FF) */
(brace
l_int|0x0181
comma
l_string|&quot;C Cache Write Back Error&quot;
)brace
comma
(brace
l_int|0x0188
comma
l_string|&quot;C Battery Backup Unit Found&quot;
)brace
comma
(brace
l_int|0x0189
comma
l_string|&quot;C Battery Backup Unit Charge Level Low&quot;
)brace
comma
(brace
l_int|0x018A
comma
l_string|&quot;C Battery Backup Unit Charge Level OK&quot;
)brace
comma
(brace
l_int|0x0193
comma
l_string|&quot;C Installation Aborted&quot;
)brace
comma
(brace
l_int|0x0195
comma
l_string|&quot;C Mirror Race Recovery In Progress&quot;
)brace
comma
(brace
l_int|0x0196
comma
l_string|&quot;C Mirror Race on Critical Drive&quot;
)brace
comma
(brace
l_int|0x019E
comma
l_string|&quot;C Memory Soft ECC Error&quot;
)brace
comma
(brace
l_int|0x019F
comma
l_string|&quot;C Memory Hard ECC Error&quot;
)brace
comma
(brace
l_int|0x01A2
comma
l_string|&quot;C Battery Backup Unit Failed&quot;
)brace
comma
(brace
l_int|0
comma
l_string|&quot;&quot;
)brace
)brace
suffix:semicolon
r_int
id|EventListIndex
op_assign
l_int|0
comma
id|EventCode
suffix:semicolon
r_int
r_char
id|EventType
comma
op_star
id|EventMessage
suffix:semicolon
r_if
c_cond
(paren
id|Event-&gt;EventCode
op_eq
l_int|0x1C
op_logical_and
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_VendorSpecific
op_logical_and
(paren
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x80
op_logical_or
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x81
)paren
)paren
id|Event-&gt;EventCode
op_assign
(paren
(paren
id|RequestSense-&gt;AdditionalSenseCode
op_minus
l_int|0x80
)paren
op_lshift
l_int|8
)paren
op_or
id|RequestSense-&gt;AdditionalSenseCodeQualifier
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|EventCode
op_assign
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventCode
suffix:semicolon
r_if
c_cond
(paren
id|EventCode
op_eq
id|Event-&gt;EventCode
op_logical_or
id|EventCode
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|EventListIndex
op_increment
suffix:semicolon
)brace
id|EventType
op_assign
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventMessage
(braket
l_int|0
)braket
suffix:semicolon
id|EventMessage
op_assign
op_amp
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventMessage
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|EventCode
op_eq
l_int|0
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Unknown Controller Event Code %04X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;EventCode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|EventType
)paren
(brace
r_case
l_char|&squot;P&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;LogicalUnit
comma
id|Controller-&gt;ControllerNumber
comma
id|Event-&gt;LogicalUnit
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;LogicalUnit
comma
id|Controller-&gt;ControllerNumber
comma
id|Event-&gt;LogicalUnit
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;S&squot;
suffix:colon
r_if
c_cond
(paren
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_NoSense
op_logical_or
(paren
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_NotReady
op_logical_and
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x04
op_logical_and
(paren
id|RequestSense-&gt;AdditionalSenseCodeQualifier
op_eq
l_int|0x01
op_logical_or
id|RequestSense-&gt;AdditionalSenseCodeQualifier
op_eq
l_int|0x02
)paren
)paren
)paren
r_break
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|EventMessage
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Request Sense: &quot;
l_string|&quot;Sense Key = %d, ASC = %02X, ASCQ = %02X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|RequestSense-&gt;SenseKey
comma
id|RequestSense-&gt;AdditionalSenseCode
comma
id|RequestSense-&gt;AdditionalSenseCodeQualifier
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Request Sense: &quot;
l_string|&quot;Information = %02X%02X%02X%02X &quot;
l_string|&quot;%02X%02X%02X%02X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|RequestSense-&gt;Information
(braket
l_int|0
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|1
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|2
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|3
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|0
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|1
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|2
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;SuppressEnclosureMessages
)paren
r_break
suffix:semicolon
id|sprintf
c_func
(paren
id|MessageBuffer
comma
id|EventMessage
comma
id|Event-&gt;LogicalUnit
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Enclosure %d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;TargetID
comma
id|MessageBuffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Controller %s&bslash;n&quot;
comma
id|Controller
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Unknown Controller Event Code %04X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;EventCode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_V2_ReportProgress prints an appropriate progress message for&n;  Logical Device Long Operations.&n;*/
DECL|function|DAC960_V2_ReportProgress
r_static
r_void
id|DAC960_V2_ReportProgress
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|MessageString
comma
r_int
r_int
id|LogicalDeviceNumber
comma
r_int
r_int
id|BlocksCompleted
comma
r_int
r_int
id|LogicalDeviceSize
)paren
(brace
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;%s in Progress: Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|MessageString
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDeviceSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ProcessCompletedCommand performs completion processing for Command&n;  for DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ProcessCompletedCommand
r_static
r_void
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandType_T
id|CommandType
op_assign
id|Command-&gt;CommandType
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_IOCTL_Opcode_T
id|CommandOpcode
op_assign
id|CommandMailbox-&gt;Common.IOCTL_Opcode
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|BufferHeader_T
op_star
id|BufferHeader
op_assign
id|Command-&gt;BufferHeader
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
id|add_blkdev_randomness
c_func
(paren
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense.SenseKey
op_eq
id|DAC960_SenseKey_MediumError
op_logical_and
id|BufferHeader
op_ne
l_int|NULL
op_logical_and
id|BufferHeader-&gt;b_reqnext
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
)paren
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadRetryCommand
suffix:semicolon
r_else
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteRetryCommand
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
id|Command-&gt;BlockCount
op_lshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|BufferHeader-&gt;b_data
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|7
)braket
op_assign
id|Command-&gt;BlockCount
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|8
)braket
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense.SenseKey
op_ne
id|DAC960_SenseKey_NotReady
)paren
id|DAC960_V2_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
r_while
c_loop
(paren
id|BufferHeader
op_ne
l_int|NULL
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
id|BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Wake up requestor for swap file paging requests.&n;&t;  */
r_if
c_cond
(paren
id|Command-&gt;Semaphore
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadRetryCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteRetryCommand
)paren
(brace
id|BufferHeader_T
op_star
id|NextBufferHeader
op_assign
id|BufferHeader-&gt;b_reqnext
suffix:semicolon
id|BufferHeader-&gt;b_reqnext
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;Perform completion processing for this single buffer.&n;      */
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|true
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense.SenseKey
op_ne
id|DAC960_SenseKey_NotReady
)paren
id|DAC960_V2_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ProcessCompletedBuffer
c_func
(paren
id|BufferHeader
comma
l_bool|false
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NextBufferHeader
op_ne
l_int|NULL
)paren
(brace
id|Command-&gt;BlockNumber
op_add_assign
id|BufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|NextBufferHeader-&gt;b_size
op_rshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|Command-&gt;BufferHeader
op_assign
id|NextBufferHeader
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
id|Command-&gt;BlockCount
op_lshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|NextBufferHeader-&gt;b_data
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|24
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|16
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|7
)braket
op_assign
id|Command-&gt;BlockCount
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|8
)braket
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetControllerInfo
)paren
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|NewControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.NewControllerInformation
suffix:semicolon
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|NewControllerInfo-&gt;LogicalDevicesPresent
suffix:semicolon
id|Controller-&gt;V2.NeedLogicalDeviceInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V2.NewLogicalDeviceInformation.LogicalDeviceNumber
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation.Channel
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation.TargetID
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation.LogicalUnit
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;MonitoringAlertMode
op_assign
(paren
id|NewControllerInfo-&gt;LogicalDevicesCritical
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;LogicalDevicesOffline
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;PhysicalDisksCritical
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;PhysicalDisksOffline
OG
l_int|0
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ControllerInfo
comma
id|NewControllerInfo
comma
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetEvent
)paren
(brace
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
id|DAC960_V2_ReportEvent
c_func
(paren
id|Controller
comma
op_amp
id|Controller-&gt;V2.Event
)paren
suffix:semicolon
id|Controller-&gt;V2.NextEventSequenceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetPhysicalDeviceInfoValid
op_logical_and
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|NewPhysicalDeviceInfo
op_assign
op_amp
id|Controller-&gt;V2.NewPhysicalDeviceInformation
suffix:semicolon
r_int
r_int
id|PhysicalDeviceIndex
op_assign
id|Controller-&gt;V2.PhysicalDeviceIndex
suffix:semicolon
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Channel
op_ne
id|PhysicalDeviceInfo-&gt;Channel
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;TargetID
op_ne
id|PhysicalDeviceInfo-&gt;TargetID
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
op_ne
id|PhysicalDeviceInfo-&gt;LogicalUnit
)paren
)paren
(brace
r_int
r_int
id|DeviceIndex
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|InquiryUnitSerialNumber
op_assign
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|PhysicalDeviceInfo
)paren
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
l_int|NULL
suffix:semicolon
)brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Now Exists%s&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; - Allocation Failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|DeviceIndex
op_assign
id|PhysicalDeviceIndex
suffix:semicolon
id|DeviceIndex
OL
id|DAC960_V2_MaxPhysicalDevices
op_minus
l_int|1
suffix:semicolon
id|DeviceIndex
op_increment
)paren
(brace
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
op_plus
l_int|1
)braket
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
)braket
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
op_plus
l_int|1
)braket
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
)braket
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|PhysicalDeviceInfo
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|InquiryUnitSerialNumber
suffix:semicolon
)brace
id|memset
c_func
(paren
id|PhysicalDeviceInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_assign
id|DAC960_V2_Device_InvalidState
suffix:semicolon
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_ne
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d is now %s&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Unconfigured
ques
c_cond
l_string|&quot;UNCONFIGURED&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_WriteOnly
ques
c_cond
l_string|&quot;WRITE-ONLY&quot;
suffix:colon
id|NewPhysicalDeviceInfo
op_member_access_from_pointer
id|PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
ques
c_cond
l_string|&quot;DEAD&quot;
suffix:colon
l_string|&quot;STANDBY&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewPhysicalDeviceInfo-&gt;ParityErrors
op_ne
id|PhysicalDeviceInfo-&gt;ParityErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;SoftErrors
op_ne
id|PhysicalDeviceInfo-&gt;SoftErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;HardErrors
op_ne
id|PhysicalDeviceInfo-&gt;HardErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;MiscellaneousErrors
op_ne
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;CommandTimeouts
op_ne
id|PhysicalDeviceInfo-&gt;CommandTimeouts
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Retries
op_ne
id|PhysicalDeviceInfo-&gt;Retries
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Aborts
op_ne
id|PhysicalDeviceInfo-&gt;Aborts
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;PredictedFailuresDetected
op_ne
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Parity = %d, Soft = %d, &quot;
l_string|&quot;Hard = %d, Misc = %d&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
id|NewPhysicalDeviceInfo-&gt;ParityErrors
comma
id|NewPhysicalDeviceInfo-&gt;SoftErrors
comma
id|NewPhysicalDeviceInfo-&gt;HardErrors
comma
id|NewPhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Timeouts = %d, Retries = %d, &quot;
l_string|&quot;Aborts = %d, Predicted = %d&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
id|NewPhysicalDeviceInfo-&gt;CommandTimeouts
comma
id|NewPhysicalDeviceInfo-&gt;Retries
comma
id|NewPhysicalDeviceInfo-&gt;Aborts
comma
id|NewPhysicalDeviceInfo
op_member_access_from_pointer
id|PredictedFailuresDetected
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
op_logical_and
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_ne
id|DAC960_V2_Device_Dead
)paren
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
id|memcpy
c_func
(paren
id|PhysicalDeviceInfo
comma
id|NewPhysicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
)brace
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
op_increment
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceIndex
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetPhysicalDeviceInfoValid
)paren
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
op_assign
l_bool|false
suffix:semicolon
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetLogicalDeviceInfoValid
op_logical_and
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|NewLogicalDeviceInfo
op_assign
op_amp
id|Controller-&gt;V2.NewLogicalDeviceInformation
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
suffix:semicolon
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
(brace
id|DAC960_V2_PhysicalDevice_T
id|PhysicalDevice
suffix:semicolon
id|PhysicalDevice.Controller
op_assign
l_int|0
suffix:semicolon
id|PhysicalDevice.Channel
op_assign
id|NewLogicalDeviceInfo-&gt;Channel
suffix:semicolon
id|PhysicalDevice.TargetID
op_assign
id|NewLogicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|PhysicalDevice.LogicalUnit
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|PhysicalDevice
suffix:semicolon
id|LogicalDeviceInfo
op_assign
(paren
id|DAC960_V2_LogicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|LogicalDeviceInfo
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;Now Exists%s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; - Allocation Failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
)paren
id|memset
c_func
(paren
id|LogicalDeviceInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|LogicalDeviceSize
op_assign
id|NewLogicalDeviceInfo-&gt;ConfigurableDeviceSizeIn512ByteBlocksOrMB
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_ne
id|LogicalDeviceInfo-&gt;LogicalDeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
l_string|&quot;OFFLINE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewLogicalDeviceInfo-&gt;SoftErrors
op_ne
id|LogicalDeviceInfo-&gt;SoftErrors
)paren
op_logical_or
(paren
id|NewLogicalDeviceInfo-&gt;CommandsFailed
op_ne
id|LogicalDeviceInfo-&gt;CommandsFailed
)paren
op_logical_or
(paren
id|NewLogicalDeviceInfo-&gt;DeferredWriteErrors
op_ne
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) Errors: &quot;
l_string|&quot;Soft = %d, Failed = %d, Deferred Write = %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo-&gt;SoftErrors
comma
id|NewLogicalDeviceInfo-&gt;CommandsFailed
comma
id|NewLogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;ConsistencyCheckInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Consistency Check&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|ConsistencyCheckBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;RebuildInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Rebuild&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|RebuildBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;BackgroundInitializationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Background Initialization&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|BackgroundInitializationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;ForegroundInitializationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Foreground Initialization&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|ForegroundInitializationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;DataMigrationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Data Migration&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|DataMigrationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;PatrolOperationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Patrol Operation&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|PatrolOperationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|LogicalDeviceInfo
comma
id|NewLogicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
)brace
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetLogicalDeviceInfoValid
)paren
id|Controller-&gt;V2.NeedLogicalDeviceInformation
op_assign
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_minus
id|Controller-&gt;V2.NextEventSequenceNumber
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;GetEvent.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_Event_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.EventSequenceNumberHigh16
op_assign
id|Controller-&gt;V2.NextEventSequenceNumber
op_rshift
l_int|16
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.IOCTL_Opcode
op_assign
id|DAC960_V2_GetEvent
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.EventSequenceNumberLow16
op_assign
id|Controller-&gt;V2.NextEventSequenceNumber
op_amp
l_int|0xFFFF
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V2.Event
)paren
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;GetEvent.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|Controller-&gt;V2.PhysicalDeviceIndex
op_minus
l_int|1
)braket
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandOpcode
op_assign
id|DAC960_V2_SCSI_10_Passthru
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.LogicalUnit
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.LogicalUnit
op_minus
l_int|1
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.TargetID
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.TargetID
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.Channel
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.Channel
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CDBLength
op_assign
l_int|6
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|false
suffix:semicolon
r_return
suffix:semicolon
)brace
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.LogicalUnit
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation.Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetPhysicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V2.NewPhysicalDeviceInformation
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedLogicalDeviceInformation
)paren
(brace
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformation.LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetLogicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V2.NewLogicalDeviceInformation
)paren
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;MonitoringTimerCount
op_increment
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_HealthStatusMonitoringInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ImmediateCommand
)paren
(brace
id|up
c_func
(paren
id|Command-&gt;Semaphore
)paren
suffix:semicolon
id|Command-&gt;Semaphore
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_QueuedCommand
)paren
(brace
id|DAC960_V2_KernelCommand_T
op_star
id|KernelCommand
op_assign
id|Command-&gt;V2.KernelCommand
suffix:semicolon
id|KernelCommand-&gt;CommandStatus
op_assign
id|CommandStatus
suffix:semicolon
id|KernelCommand-&gt;RequestSenseLength
op_assign
id|Command-&gt;V2.RequestSenseLength
suffix:semicolon
id|KernelCommand-&gt;DataTransferLength
op_assign
id|Command-&gt;V2.DataTransferResidue
suffix:semicolon
id|Command-&gt;V2.KernelCommand
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|KernelCommand
op_member_access_from_pointer
id|CompletionFunction
c_func
(paren
id|KernelCommand
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Queue a Status Monitoring Command to the Controller using the just&n;    completed Command if one was deferred previously due to lack of a&n;    free Command when the Monitoring Timer Function was called.&n;  */
r_if
c_cond
(paren
id|Controller-&gt;MonitoringCommandDeferred
)paren
(brace
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Deallocate the Command.&n;  */
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;    Wake up any processes waiting on a free Command.&n;  */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_BA_InterruptHandler handles hardware interrupts from DAC960 BA Series&n;  Controllers.&n;*/
DECL|function|DAC960_BA_InterruptHandler
r_static
r_void
id|DAC960_BA_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
id|DAC960_BA_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
OG
l_int|0
)paren
(brace
id|DAC960_V2_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|Command-&gt;V2.RequestSenseLength
op_assign
id|NextStatusMailbox-&gt;Fields.RequestSenseLength
suffix:semicolon
id|Command-&gt;V2.DataTransferResidue
op_assign
id|NextStatusMailbox-&gt;Fields.DataTransferResidue
suffix:semicolon
id|NextStatusMailbox-&gt;Words
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V2.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LP_InterruptHandler handles hardware interrupts from DAC960 LP Series&n;  Controllers.&n;*/
DECL|function|DAC960_LP_InterruptHandler
r_static
r_void
id|DAC960_LP_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
id|DAC960_LP_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
OG
l_int|0
)paren
(brace
id|DAC960_V2_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|Command-&gt;V2.RequestSenseLength
op_assign
id|NextStatusMailbox-&gt;Fields.RequestSenseLength
suffix:semicolon
id|Command-&gt;V2.DataTransferResidue
op_assign
id|NextStatusMailbox-&gt;Fields.DataTransferResidue
suffix:semicolon
id|NextStatusMailbox-&gt;Words
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V2.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_InterruptHandler handles hardware interrupts from DAC960 LA Series&n;  Controllers.&n;*/
DECL|function|DAC960_LA_InterruptHandler
r_static
r_void
id|DAC960_LA_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
id|DAC960_LA_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V1.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.FirstStatusMailbox
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V1.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_InterruptHandler handles hardware interrupts from DAC960 PG Series&n;  Controllers.&n;*/
DECL|function|DAC960_PG_InterruptHandler
r_static
r_void
id|DAC960_PG_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
id|DAC960_PG_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V1.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.FirstStatusMailbox
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V1.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PD_InterruptHandler handles hardware interrupts from DAC960 PD Series&n;  Controllers.&n;*/
DECL|function|DAC960_PD_InterruptHandler
r_static
r_void
id|DAC960_PD_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
id|Registers_T
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
multiline_comment|/*&n;    Acquire exclusive access to Controller.&n;  */
id|DAC960_AcquireControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;    Process Hardware Interrupts for Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_PD_StatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|DAC960_PD_ReadStatusCommandIdentifier
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|DAC960_PD_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;    Release exclusive access to Controller.&n;  */
id|DAC960_ReleaseControllerLockIH
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_QueueMonitoringCommand queues a Monitoring Command to DAC960 V1&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V1_QueueMonitoringCommand
r_static
r_void
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_MonitoringCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_V1_Enquiry
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V1.NewEnquiry
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_QueueMonitoringCommand queues a Monitoring Command to DAC960 V2&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V2_QueueMonitoringCommand
r_static
r_void
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_MonitoringCommand
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetControllerInfo
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|Controller-&gt;V2.NewControllerInformation
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_MonitoringTimerFunction is the timer function for monitoring&n;  the status of DAC960 Controllers.&n;*/
DECL|function|DAC960_MonitoringTimerFunction
r_static
r_void
id|DAC960_MonitoringTimerFunction
c_func
(paren
r_int
r_int
id|TimerData
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|TimerData
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
multiline_comment|/*&n;&t;Acquire exclusive access to Controller.&n;      */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Queue a Status Monitoring Command to Controller.&n;      */
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_else
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|true
suffix:semicolon
multiline_comment|/*&n;&t;Release exclusive access to Controller.&n;      */
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
r_int
r_int
id|StatusChangeCounter
op_assign
id|Controller-&gt;V2.HealthStatusBuffer-&gt;StatusChangeCounter
suffix:semicolon
r_if
c_cond
(paren
id|StatusChangeCounter
op_eq
id|Controller-&gt;V2.StatusChangeCounter
op_logical_and
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_eq
id|Controller-&gt;V2.NextEventSequenceNumber
op_logical_and
(paren
id|ControllerInfo-&gt;BackgroundInitializationsActive
op_plus
id|ControllerInfo-&gt;LogicalDeviceInitializationsActive
op_plus
id|ControllerInfo-&gt;PhysicalDeviceInitializationsActive
op_plus
id|ControllerInfo-&gt;ConsistencyChecksActive
op_plus
id|ControllerInfo-&gt;RebuildsActive
op_plus
id|ControllerInfo-&gt;OnlineExpansionsActive
op_eq
l_int|0
op_logical_or
id|jiffies
op_minus
id|Controller-&gt;PrimaryMonitoringTime
OL
id|DAC960_MonitoringTimerInterval
)paren
)paren
(brace
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_HealthStatusMonitoringInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;V2.StatusChangeCounter
op_assign
id|StatusChangeCounter
suffix:semicolon
id|Controller-&gt;PrimaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/*&n;&t;Acquire exclusive access to Controller.&n;      */
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Queue a Status Monitoring Command to Controller.&n;      */
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_else
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|true
suffix:semicolon
multiline_comment|/*&n;&t;Release exclusive access to Controller.&n;      */
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Wake up any processes waiting on a Health Status Buffer change.&n;      */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_Open is the Device Open Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_Open
r_static
r_int
id|DAC960_Open
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
op_eq
l_int|0
op_logical_and
id|LogicalDriveNumber
op_eq
l_int|0
op_logical_and
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_goto
id|ModuleOnly
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
r_if
c_cond
(paren
id|LogicalDriveNumber
OG
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Offline
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
op_logical_or
id|LogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Offline
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDriveNumber
)braket
)paren
(brace
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDriveNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|DAC960_RegisterDisk
c_func
(paren
id|Controller
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;GenericDiskInfo.sizes
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
op_eq
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/*&n;    Increment Controller and Logical Drive Usage Counts.&n;  */
id|Controller-&gt;ControllerUsageCount
op_increment
suffix:semicolon
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
op_increment
suffix:semicolon
id|ModuleOnly
suffix:colon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Release is the Device Release Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_Release
r_static
r_int
id|DAC960_Release
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
op_eq
l_int|0
op_logical_and
id|LogicalDriveNumber
op_eq
l_int|0
op_logical_and
id|File
op_ne
l_int|NULL
op_logical_and
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_goto
id|ModuleOnly
suffix:semicolon
multiline_comment|/*&n;    Decrement the Logical Drive and Controller Usage Counts.&n;  */
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
op_decrement
suffix:semicolon
id|Controller-&gt;ControllerUsageCount
op_decrement
suffix:semicolon
id|ModuleOnly
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_IOCTL is the Device IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_IOCTL
r_static
r_int
id|DAC960_IOCTL
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
comma
r_int
r_int
id|Request
comma
r_int
r_int
id|Argument
)paren
(brace
r_int
id|ControllerNumber
op_assign
id|DAC960_ControllerNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|LogicalDriveNumber
op_assign
id|DAC960_LogicalDriveNumber
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|DiskGeometry_T
id|Geometry
comma
op_star
id|UserGeometry
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|PartitionNumber
suffix:semicolon
r_if
c_cond
(paren
id|File
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|File-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
id|DAC960_UserIOCTL
c_func
(paren
id|Inode
comma
id|File
comma
id|Request
comma
id|Argument
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|HDIO_GETGEO
suffix:colon
multiline_comment|/* Get BIOS Disk Geometry. */
id|UserGeometry
op_assign
(paren
id|DiskGeometry_T
op_star
)paren
id|Argument
suffix:semicolon
r_if
c_cond
(paren
id|UserGeometry
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
r_if
c_cond
(paren
id|LogicalDriveNumber
OG
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Geometry.heads
op_assign
id|Controller-&gt;V1.GeometryTranslationHeads
suffix:semicolon
id|Geometry.sectors
op_assign
id|Controller-&gt;V1.GeometryTranslationSectors
suffix:semicolon
id|Geometry.cylinders
op_assign
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveSize
op_div
(paren
id|Geometry.heads
op_star
id|Geometry.sectors
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
(brace
r_case
id|DAC960_V2_Geometry_128_32
suffix:colon
id|Geometry.heads
op_assign
l_int|128
suffix:semicolon
id|Geometry.sectors
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V2_Geometry_255_63
suffix:colon
id|Geometry.heads
op_assign
l_int|255
suffix:semicolon
id|Geometry.sectors
op_assign
l_int|63
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Illegal Logical Device Geometry %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|Geometry.cylinders
op_assign
id|LogicalDeviceInfo-&gt;ConfigurableDeviceSizeIn512ByteBlocksOrMB
op_div
(paren
id|Geometry.heads
op_star
id|Geometry.sectors
)paren
suffix:semicolon
)brace
id|Geometry.start
op_assign
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
dot
id|start_sect
suffix:semicolon
r_return
(paren
id|copy_to_user
c_func
(paren
id|UserGeometry
comma
op_amp
id|Geometry
comma
r_sizeof
(paren
id|DiskGeometry_T
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
)paren
suffix:semicolon
r_case
id|BLKGETSIZE
suffix:colon
multiline_comment|/* Get Device Size. */
r_if
c_cond
(paren
(paren
r_int
op_star
)paren
id|Argument
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MINOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
dot
id|nr_sects
comma
(paren
r_int
op_star
)paren
id|Argument
)paren
suffix:semicolon
r_case
id|BLKRAGET
suffix:colon
multiline_comment|/* Get Read-Ahead. */
r_if
c_cond
(paren
(paren
r_int
op_star
)paren
id|Argument
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|read_ahead
(braket
id|MAJOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
comma
(paren
r_int
op_star
)paren
id|Argument
)paren
suffix:semicolon
r_case
id|BLKRASET
suffix:colon
multiline_comment|/* Set Read-Ahead. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|Argument
OG
l_int|256
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|read_ahead
(braket
id|MAJOR
c_func
(paren
id|Inode-&gt;i_rdev
)paren
)braket
op_assign
id|Argument
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|BLKFLSBUF
suffix:colon
multiline_comment|/* Flush Buffers. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|fsync_dev
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
id|invalidate_buffers
c_func
(paren
id|Inode-&gt;i_rdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|BLKRRPART
suffix:colon
multiline_comment|/* Re-Read Partition Table. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;LogicalDriveUsageCount
(braket
id|LogicalDriveNumber
)braket
OG
l_int|1
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_for
c_loop
(paren
id|PartitionNumber
op_assign
l_int|0
suffix:semicolon
id|PartitionNumber
OL
id|DAC960_MaxPartitions
suffix:semicolon
id|PartitionNumber
op_increment
)paren
(brace
id|KernelDevice_T
id|Device
op_assign
id|DAC960_KernelDevice
c_func
(paren
id|ControllerNumber
comma
id|LogicalDriveNumber
comma
id|PartitionNumber
)paren
suffix:semicolon
r_int
id|MinorNumber
op_assign
id|DAC960_MinorNumber
c_func
(paren
id|LogicalDriveNumber
comma
id|PartitionNumber
)paren
suffix:semicolon
id|SuperBlock_T
op_star
id|SuperBlock
op_assign
id|get_super
c_func
(paren
id|Device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|nr_sects
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
multiline_comment|/*&n;&t;    Flush all changes and invalidate buffered state.&n;&t;  */
id|sync_dev
c_func
(paren
id|Device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SuperBlock
op_ne
l_int|NULL
)paren
id|invalidate_inodes
c_func
(paren
id|SuperBlock
)paren
suffix:semicolon
id|invalidate_buffers
c_func
(paren
id|Device
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Clear existing partition sizes.&n;&t;  */
r_if
c_cond
(paren
id|PartitionNumber
OG
l_int|0
)paren
(brace
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|start_sect
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;GenericDiskInfo.part
(braket
id|MinorNumber
)braket
dot
id|nr_sects
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;    Reset the Block Size so that the partition table can be read.&n;&t;  */
id|set_blocksize
c_func
(paren
id|Device
comma
id|BLOCK_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
id|grok_partitions
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|LogicalDriveNumber
comma
id|DAC960_MaxPartitions
comma
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveSize
)paren
suffix:semicolon
r_else
id|grok_partitions
c_func
(paren
op_amp
id|Controller-&gt;GenericDiskInfo
comma
id|LogicalDriveNumber
comma
id|DAC960_MaxPartitions
comma
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
op_member_access_from_pointer
id|ConfigurableDeviceSizeIn512ByteBlocksOrMB
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_UserIOCTL is the User IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_UserIOCTL
r_static
r_int
id|DAC960_UserIOCTL
c_func
(paren
id|Inode_T
op_star
id|Inode
comma
id|File_T
op_star
id|File
comma
r_int
r_int
id|Request
comma
r_int
r_int
id|Argument
)paren
(brace
r_int
id|ErrorCode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|DAC960_IOCTL_GET_CONTROLLER_COUNT
suffix:colon
r_return
id|DAC960_ControllerCount
suffix:semicolon
r_case
id|DAC960_IOCTL_GET_CONTROLLER_INFO
suffix:colon
(brace
id|DAC960_ControllerInfo_T
op_star
id|UserSpaceControllerInfo
op_assign
(paren
id|DAC960_ControllerInfo_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_ControllerInfo_T
id|ControllerInfo
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceControllerInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|get_user
c_func
(paren
id|ControllerNumber
comma
op_amp
id|UserSpaceControllerInfo-&gt;ControllerNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_return
id|ErrorCode
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ControllerInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
id|ControllerInfo.ControllerNumber
op_assign
id|ControllerNumber
suffix:semicolon
id|ControllerInfo.FirmwareType
op_assign
id|Controller-&gt;FirmwareType
suffix:semicolon
id|ControllerInfo.Channels
op_assign
id|Controller-&gt;Channels
suffix:semicolon
id|ControllerInfo.Targets
op_assign
id|Controller-&gt;Targets
suffix:semicolon
id|ControllerInfo.PCI_Bus
op_assign
id|Controller-&gt;Bus
suffix:semicolon
id|ControllerInfo.PCI_Device
op_assign
id|Controller-&gt;Device
suffix:semicolon
id|ControllerInfo.PCI_Function
op_assign
id|Controller-&gt;Function
suffix:semicolon
id|ControllerInfo.IRQ_Channel
op_assign
id|Controller-&gt;IRQ_Channel
suffix:semicolon
id|ControllerInfo.PCI_Address
op_assign
id|Controller-&gt;PCI_Address
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.ModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.FirmwareVersion
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
(paren
id|copy_to_user
c_func
(paren
id|UserSpaceControllerInfo
comma
op_amp
id|ControllerInfo
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V1_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V1_UserCommand_T
op_star
id|UserSpaceUserCommand
op_assign
(paren
id|DAC960_V1_UserCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V1_UserCommand_T
id|UserCommand
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_DCDB_T
id|DCDB
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceUserCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|UserCommand
comma
id|UserSpaceUserCommand
comma
r_sizeof
(paren
id|DAC960_V1_UserCommand_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure1
suffix:semicolon
id|ControllerNumber
op_assign
id|UserCommand.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V1_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|CommandOpcode
op_assign
id|UserCommand.CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DataTransferLength
op_assign
id|UserCommand.DataTransferLength
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_amp
l_int|0x80
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|DCDB
comma
id|UserCommand.DCDB
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure1
suffix:semicolon
r_if
c_cond
(paren
id|DCDB.Channel
op_ge
id|DAC960_V1_MaxChannels
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|DataTransferLength
op_eq
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_NoDataTransfer
)paren
op_logical_or
(paren
id|DataTransferLength
OG
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
)paren
op_logical_or
(paren
id|DataTransferLength
OL
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_DataTransferSystemToDevice
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|DCDB.TransferLengthHigh4
op_lshift
l_int|16
)paren
op_or
id|DCDB.TransferLength
)paren
op_ne
id|abs
c_func
(paren
id|DataTransferLength
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DataTransferLength
OL
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
op_minus
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
id|DataTransferBuffer
comma
id|UserCommand.DataTransferBuffer
comma
op_minus
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_logical_or
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|DCDB
)paren
suffix:semicolon
id|DCDB.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
)brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.DataTransferBuffer
comma
id|DataTransferBuffer
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.DCDB
comma
op_amp
id|DCDB
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure1
suffix:semicolon
)brace
id|ErrorCode
op_assign
id|CommandStatus
suffix:semicolon
id|Failure1
suffix:colon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
r_return
id|ErrorCode
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V2_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V2_UserCommand_T
op_star
id|UserSpaceUserCommand
op_assign
(paren
id|DAC960_V2_UserCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V2_UserCommand_T
id|UserCommand
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
id|DataTransferResidue
comma
id|RequestSenseLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|RequestSenseBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceUserCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|UserCommand
comma
id|UserSpaceUserCommand
comma
r_sizeof
(paren
id|DAC960_V2_UserCommand_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
id|ControllerNumber
op_assign
id|UserCommand.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V2_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DataTransferLength
op_assign
id|UserCommand.DataTransferLength
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DataTransferLength
OL
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|kmalloc
c_func
(paren
op_minus
id|DataTransferLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
id|DataTransferBuffer
comma
id|UserCommand.DataTransferBuffer
comma
op_minus
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
)brace
id|RequestSenseLength
op_assign
id|UserCommand.RequestSenseLength
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|RequestSenseBuffer
op_assign
id|kmalloc
c_func
(paren
id|RequestSenseLength
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseBuffer
op_eq
l_int|NULL
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
id|memset
c_func
(paren
id|RequestSenseBuffer
comma
l_int|0
comma
id|RequestSenseLength
)paren
suffix:semicolon
)brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memcpy
c_func
(paren
id|CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferPageNumber
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_DataTransferMemoryAddress_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
id|DataTransferLength
suffix:semicolon
)brace
r_else
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
op_minus
id|DataTransferLength
suffix:semicolon
)brace
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.RequestSenseSize
op_assign
id|RequestSenseLength
suffix:semicolon
id|CommandMailbox-&gt;Common.RequestSenseBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|RequestSenseBuffer
)paren
suffix:semicolon
)brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|RequestSenseLength
op_assign
id|Command-&gt;V2.RequestSenseLength
suffix:semicolon
id|DataTransferResidue
op_assign
id|Command-&gt;V2.DataTransferResidue
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
id|UserCommand.RequestSenseLength
)paren
id|RequestSenseLength
op_assign
id|UserCommand.RequestSenseLength
suffix:semicolon
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
op_amp
id|UserSpaceUserCommand-&gt;DataTransferLength
comma
op_amp
id|DataTransferResidue
comma
r_sizeof
(paren
id|DataTransferResidue
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
op_amp
id|UserSpaceUserCommand-&gt;RequestSenseLength
comma
op_amp
id|RequestSenseLength
comma
r_sizeof
(paren
id|RequestSenseLength
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.DataTransferBuffer
comma
id|DataTransferBuffer
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|UserCommand.RequestSenseBuffer
comma
id|RequestSenseBuffer
comma
id|RequestSenseLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_goto
id|Failure2
suffix:semicolon
)brace
id|ErrorCode
op_assign
id|CommandStatus
suffix:semicolon
id|Failure2
suffix:colon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseBuffer
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|RequestSenseBuffer
)paren
suffix:semicolon
r_return
id|ErrorCode
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V2_GET_HEALTH_STATUS
suffix:colon
(brace
id|DAC960_V2_GetHealthStatus_T
op_star
id|UserSpaceGetHealthStatus
op_assign
(paren
id|DAC960_V2_GetHealthStatus_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V2_GetHealthStatus_T
id|GetHealthStatus
suffix:semicolon
id|DAC960_V2_HealthStatusBuffer_T
id|HealthStatusBuffer
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceGetHealthStatus
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|GetHealthStatus
comma
id|UserSpaceGetHealthStatus
comma
r_sizeof
(paren
id|DAC960_V2_GetHealthStatus_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_return
id|ErrorCode
suffix:semicolon
id|ControllerNumber
op_assign
id|GetHealthStatus.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V2_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|HealthStatusBuffer
comma
id|GetHealthStatus.HealthStatusBuffer
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_return
id|ErrorCode
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;V2.HealthStatusBuffer-&gt;StatusChangeCounter
op_eq
id|HealthStatusBuffer.StatusChangeCounter
op_logical_and
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_eq
id|HealthStatusBuffer.NextEventSequenceNumber
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
comma
id|DAC960_MonitoringTimerInterval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
id|ErrorCode
op_assign
id|copy_to_user
c_func
(paren
id|GetHealthStatus.HealthStatusBuffer
comma
id|Controller-&gt;V2.HealthStatusBuffer
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
)paren
suffix:semicolon
r_return
id|ErrorCode
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_KernelIOCTL is the Kernel IOCTL Function for the DAC960 Driver.&n;*/
DECL|function|DAC960_KernelIOCTL
r_int
id|DAC960_KernelIOCTL
c_func
(paren
r_int
r_int
id|Request
comma
r_void
op_star
id|Argument
)paren
(brace
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|DAC960_IOCTL_GET_CONTROLLER_COUNT
suffix:colon
r_return
id|DAC960_ControllerCount
suffix:semicolon
r_case
id|DAC960_IOCTL_GET_CONTROLLER_INFO
suffix:colon
(brace
id|DAC960_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
(paren
id|DAC960_ControllerInfo_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ControllerNumber
op_assign
id|ControllerInfo-&gt;ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|memset
c_func
(paren
id|ControllerInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
id|ControllerInfo-&gt;ControllerNumber
op_assign
id|ControllerNumber
suffix:semicolon
id|ControllerInfo-&gt;FirmwareType
op_assign
id|Controller-&gt;FirmwareType
suffix:semicolon
id|ControllerInfo-&gt;Channels
op_assign
id|Controller-&gt;Channels
suffix:semicolon
id|ControllerInfo-&gt;Targets
op_assign
id|Controller-&gt;Targets
suffix:semicolon
id|ControllerInfo-&gt;PCI_Bus
op_assign
id|Controller-&gt;Bus
suffix:semicolon
id|ControllerInfo-&gt;PCI_Device
op_assign
id|Controller-&gt;Device
suffix:semicolon
id|ControllerInfo-&gt;PCI_Function
op_assign
id|Controller-&gt;Function
suffix:semicolon
id|ControllerInfo-&gt;IRQ_Channel
op_assign
id|Controller-&gt;IRQ_Channel
suffix:semicolon
id|ControllerInfo-&gt;PCI_Address
op_assign
id|Controller-&gt;PCI_Address
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo-&gt;ModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo-&gt;FirmwareVersion
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V1_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V1_KernelCommand_T
op_star
id|KernelCommand
op_assign
(paren
id|DAC960_V1_KernelCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
suffix:semicolon
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
l_int|NULL
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|KernelCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ControllerNumber
op_assign
id|KernelCommand-&gt;ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V1_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|CommandOpcode
op_assign
id|KernelCommand-&gt;CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DataTransferLength
op_assign
id|KernelCommand-&gt;DataTransferLength
suffix:semicolon
id|DataTransferBuffer
op_assign
id|KernelCommand-&gt;DataTransferBuffer
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_amp
l_int|0x80
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|DCDB
op_assign
id|KernelCommand-&gt;DCDB
suffix:semicolon
r_if
c_cond
(paren
id|DCDB-&gt;Channel
op_ge
id|DAC960_V1_MaxChannels
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|DataTransferLength
op_eq
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_V1_DCDB_NoDataTransfer
)paren
op_logical_or
(paren
id|DataTransferLength
OG
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
)paren
op_logical_or
(paren
id|DataTransferLength
OL
l_int|0
op_logical_and
id|DCDB-&gt;Direction
op_eq
id|DAC960_V1_DCDB_DataTransferSystemToDevice
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|DCDB-&gt;TransferLengthHigh4
op_lshift
l_int|16
)paren
op_or
id|DCDB-&gt;TransferLength
)paren
op_ne
id|abs
c_func
(paren
id|DataTransferLength
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
op_logical_and
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB-&gt;Channel
)braket
(braket
id|DCDB-&gt;TargetID
)braket
)paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_else
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB-&gt;Channel
)braket
(braket
id|DCDB-&gt;TargetID
)braket
op_assign
l_bool|true
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_QueuedCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|KernelCommand-&gt;CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DCDB
)paren
suffix:semicolon
id|Command-&gt;V1.KernelCommand
op_assign
id|KernelCommand
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_QueuedCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|KernelCommand-&gt;CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|Command-&gt;V1.KernelCommand
op_assign
id|KernelCommand
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V2_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V2_KernelCommand_T
op_star
id|KernelCommand
op_assign
(paren
id|DAC960_V2_KernelCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
comma
id|RequestSenseLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|RequestSenseBuffer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|KernelCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ControllerNumber
op_assign
id|KernelCommand-&gt;ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V2_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DataTransferLength
op_assign
id|KernelCommand-&gt;DataTransferLength
suffix:semicolon
id|RequestSenseLength
op_assign
id|KernelCommand-&gt;RequestSenseLength
suffix:semicolon
id|DataTransferBuffer
op_assign
id|KernelCommand-&gt;DataTransferBuffer
suffix:semicolon
id|RequestSenseBuffer
op_assign
id|KernelCommand-&gt;RequestSenseBuffer
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
op_logical_and
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
op_logical_and
id|RequestSenseBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
id|memset
c_func
(paren
id|RequestSenseBuffer
comma
l_int|0
comma
id|RequestSenseLength
)paren
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_QueuedCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memcpy
c_func
(paren
id|CommandMailbox
comma
op_amp
id|KernelCommand-&gt;CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferPageNumber
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_DataTransferMemoryAddress_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
id|DataTransferLength
suffix:semicolon
)brace
r_else
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
op_minus
id|DataTransferLength
suffix:semicolon
)brace
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
id|DataTransferBuffer
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.RequestSenseBusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
id|RequestSenseBuffer
)paren
suffix:semicolon
)brace
id|Command-&gt;V2.KernelCommand
op_assign
id|KernelCommand
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CheckStatusBuffer verifies that there is room to hold ByteCount&n;  additional bytes in the Combined Status Buffer and grows the buffer if&n;  necessary.  It returns true if there is enough room and false otherwise.&n;*/
DECL|function|DAC960_CheckStatusBuffer
r_static
id|boolean
id|DAC960_CheckStatusBuffer
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_int
id|ByteCount
)paren
(brace
r_int
r_char
op_star
id|NewStatusBuffer
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
op_plus
id|Controller-&gt;CurrentStatusLength
op_plus
id|ByteCount
op_plus
l_int|1
op_le
id|Controller-&gt;CombinedStatusBufferLength
)paren
r_return
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBufferLength
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|NewStatusBufferLength
op_assign
id|DAC960_InitialStatusBufferSize
suffix:semicolon
r_while
c_loop
(paren
id|NewStatusBufferLength
OL
id|ByteCount
)paren
id|NewStatusBufferLength
op_mul_assign
l_int|2
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|NewStatusBufferLength
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBuffer
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|Controller-&gt;CombinedStatusBufferLength
op_assign
id|NewStatusBufferLength
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
id|NewStatusBuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
l_int|2
op_star
id|Controller-&gt;CombinedStatusBufferLength
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewStatusBuffer
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Warning
c_func
(paren
l_string|&quot;Unable to expand Combined Status Buffer - Truncating&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|NewStatusBuffer
comma
id|Controller-&gt;CombinedStatusBuffer
comma
id|Controller-&gt;CombinedStatusBufferLength
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|Controller-&gt;CombinedStatusBuffer
)paren
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
id|NewStatusBuffer
suffix:semicolon
id|Controller-&gt;CombinedStatusBufferLength
op_mul_assign
l_int|2
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
op_amp
id|NewStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
)braket
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Message prints Driver Messages.&n;*/
DECL|function|DAC960_Message
r_static
r_void
id|DAC960_Message
c_func
(paren
id|DAC960_MessageLevel_T
id|MessageLevel
comma
r_int
r_char
op_star
id|Format
comma
id|DAC960_Controller_T
op_star
id|Controller
comma
dot
dot
dot
)paren
(brace
r_static
r_int
r_char
id|Buffer
(braket
id|DAC960_LineBufferSize
)braket
suffix:semicolon
r_static
id|boolean
id|BeginningOfLine
op_assign
l_bool|true
suffix:semicolon
id|va_list
id|Arguments
suffix:semicolon
r_int
id|Length
op_assign
l_int|0
suffix:semicolon
id|va_start
c_func
(paren
id|Arguments
comma
id|Controller
)paren
suffix:semicolon
id|Length
op_assign
id|vsprintf
c_func
(paren
id|Buffer
comma
id|Format
comma
id|Arguments
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|Arguments
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|DAC960_ControllerCount
comma
id|Buffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
op_logical_or
id|MessageLevel
op_eq
id|DAC960_InfoLevel
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;ControllerInitialized
)paren
(brace
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
id|Length
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;InitialStatusLength
op_add_assign
id|Length
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
)paren
(brace
r_static
r_int
id|AnnouncementLines
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|AnnouncementLines
op_le
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
(brace
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
id|Length
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|Length
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_ProgressLevel
)paren
(brace
id|strcpy
c_func
(paren
id|Controller-&gt;ProgressBuffer
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;ProgressBufferLength
op_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;EphemeralProgressMessage
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|Controller-&gt;LastProgressReportTime
op_ge
id|DAC960_ProgressReportingInterval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;LastProgressReportTime
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_UserCriticalLevel
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Controller-&gt;UserStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_add_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
id|BeginningOfLine
op_assign
(paren
id|Buffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParsePhysicalDevice parses spaces followed by a Physical Device&n;  Channel:TargetID specification from a User Command string.  It updates&n;  Channel and TargetID and returns true on success and false on failure.&n;*/
DECL|function|DAC960_ParsePhysicalDevice
r_static
id|boolean
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|Channel
comma
r_int
r_char
op_star
id|TargetID
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XChannel
comma
id|XTargetID
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XChannel
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;:&squot;
op_logical_or
id|XChannel
op_ge
id|Controller-&gt;Channels
)paren
r_return
l_bool|false
suffix:semicolon
id|UserCommandString
op_assign
op_increment
id|NewUserCommandString
suffix:semicolon
id|XTargetID
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XTargetID
op_ge
id|Controller-&gt;Targets
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|Channel
op_assign
id|XChannel
suffix:semicolon
op_star
id|TargetID
op_assign
id|XTargetID
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParseLogicalDrive parses spaces followed by a Logical Drive Number&n;  specification from a User Command string.  It updates LogicalDriveNumber and&n;  returns true on success and false on failure.&n;*/
DECL|function|DAC960_ParseLogicalDrive
r_static
id|boolean
id|DAC960_ParseLogicalDrive
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|LogicalDriveNumber
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XLogicalDriveNumber
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XLogicalDriveNumber
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XLogicalDriveNumber
OG
id|DAC960_MaxLogicalDrives
op_minus
l_int|1
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|LogicalDriveNumber
op_assign
id|XLogicalDriveNumber
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_SetDeviceState sets the Device State for a Physical Device for&n;  DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_SetDeviceState
r_static
r_void
id|DAC960_V1_SetDeviceState
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_Command_T
op_star
id|Command
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
id|DAC960_V1_PhysicalDeviceState_T
id|DeviceState
comma
r_const
r_int
r_char
op_star
id|DeviceStateString
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_V1_StartDevice
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.DeviceState
op_assign
id|DeviceState
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Modifier
op_assign
l_int|0
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Succeeded&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_UnableToStartDevice
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unable to Start Device&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NoDeviceAtAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;No Device at Address&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidChannelOrTargetOrModifier
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Invalid Channel or Target or Modifier&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_ChannelBusy
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Channel Busy&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteUserCommand executes a User Command for DAC960 V1 Firmware&n;  Controllers.&n;*/
DECL|function|DAC960_V1_ExecuteUserCommand
r_static
id|boolean
id|DAC960_V1_ExecuteUserCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|UserCommand
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
r_char
id|Channel
comma
id|TargetID
comma
id|LogicalDriveNumber
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;flush-cache&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_V1_Flush
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cache Flush Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;kill&quot;
comma
l_int|4
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|4
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_ne
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Dead
comma
l_string|&quot;Kill&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Kill of Physical Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-online&quot;
comma
l_int|11
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|11
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Online
comma
l_string|&quot;Make Online&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Online of Physical Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-standby&quot;
comma
l_int|12
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|12
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Standby
comma
l_string|&quot;Make Standby&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Standby of Physical &quot;
l_string|&quot;Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;rebuild&quot;
comma
l_int|7
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|7
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_V1_RebuildAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Initiated&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_AttemptToRebuildOnlineDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Attempt to Rebuild Online or &quot;
l_string|&quot;Unresponsive Drive&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NewDiskFailedDuringRebuild
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;New Disk Failed During Rebuild&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidDeviceAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Invalid Device Address&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Rebuild or Consistency Check Already &quot;
l_string|&quot;in Progress&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;check-consistency&quot;
comma
l_int|17
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|17
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3C.CommandOpcode
op_assign
id|DAC960_V1_CheckConsistencyAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3C.LogicalDriveNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type3C.AutoRestore
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Initiated&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_DependentDiskIsDead
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Dependent Physical Device is DEAD&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidOrNonredundantLogicalDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Invalid or Nonredundant Logical Drive&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - Rebuild or &quot;
l_string|&quot;Consistency Check Already in Progress&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-rebuild&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-consistency-check&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
r_char
id|OldRebuildRateConstant
suffix:semicolon
id|CommandMailbox-&gt;Type3R.CommandOpcode
op_assign
id|DAC960_V1_RebuildControl
suffix:semicolon
id|CommandMailbox-&gt;Type3R.RebuildRateConstant
op_assign
l_int|0xFF
suffix:semicolon
id|CommandMailbox-&gt;Type3R.BusAddress
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|OldRebuildRateConstant
)paren
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild or Consistency Check Cancelled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cancellation of Rebuild or &quot;
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Illegal User Command: &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|UserCommand
)paren
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_TranslatePhysicalDevice translates a Physical Device Channel and&n;  TargetID into a Logical Device.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V2_TranslatePhysicalDevice
r_static
id|boolean
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_int
r_int
op_star
id|LogicalDeviceNumber
)paren
(brace
id|DAC960_V2_CommandMailbox_T
id|SavedCommandMailbox
comma
op_star
id|CommandMailbox
suffix:semicolon
id|DAC960_V2_PhysicalToLogicalDevice_T
id|PhysicalToLogicalDevice
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|SavedCommandMailbox
comma
id|CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_PhysicalToLogicalDevice_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_TranslatePhysicalToLogicalDevice
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Virtual_to_Bus
c_func
(paren
op_amp
id|PhysicalToLogicalDevice
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|CommandMailbox
comma
op_amp
id|SavedCommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
op_star
id|LogicalDeviceNumber
op_assign
id|PhysicalToLogicalDevice.LogicalDeviceNumber
suffix:semicolon
r_return
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ExecuteUserCommand executes a User Command for DAC960 V2 Firmware&n;  Controllers.&n;*/
DECL|function|DAC960_V2_ExecuteUserCommand
r_static
id|boolean
id|DAC960_V2_ExecuteUserCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|UserCommand
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|ProcessorFlags_T
id|ProcessorFlags
suffix:semicolon
r_int
r_char
id|Channel
comma
id|TargetID
comma
id|LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits.DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits.NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;flush-cache&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;DeviceOperation.IOCTL_Opcode
op_assign
id|DAC960_V2_PauseDevice
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.OperationDevice
op_assign
id|DAC960_V2_RAID_Controller
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cache Flush Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;kill&quot;
comma
l_int|4
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|4
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Dead
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Kill of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-online&quot;
comma
l_int|11
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|11
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Online
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Online of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-standby&quot;
comma
l_int|12
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|12
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Standby
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Standby of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;rebuild&quot;
comma
l_int|7
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|7
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_RebuildDeviceStart
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Initiated&quot;
suffix:colon
l_string|&quot;Not Initiated&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-rebuild&quot;
comma
l_int|14
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|14
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_RebuildDeviceStop
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Cancelled&quot;
suffix:colon
l_string|&quot;Not Cancelled&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;check-consistency&quot;
comma
l_int|17
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|17
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;ConsistencyCheck.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.IOCTL_Opcode
op_assign
id|DAC960_V2_ConsistencyCheckStart
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.RestoreConsistency
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.InitializedAreaOnly
op_assign
l_bool|false
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Initiated&quot;
suffix:colon
l_string|&quot;Not Initiated&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-consistency-check&quot;
comma
l_int|24
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|24
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;ConsistencyCheck.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.IOCTL_Opcode
op_assign
id|DAC960_V2_ConsistencyCheckStop
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Cancelled&quot;
suffix:colon
l_string|&quot;Not Cancelled&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;suppress-enclosure-messages&quot;
)paren
op_eq
l_int|0
)paren
id|Controller-&gt;SuppressEnclosureMessages
op_assign
l_bool|true
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Illegal User Command: &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|UserCommand
)paren
suffix:semicolon
id|DAC960_AcquireControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_ReleaseControllerLock
c_func
(paren
id|Controller
comma
op_amp
id|ProcessorFlags
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadStatus implements reading /proc/rd/status.&n;*/
DECL|function|DAC960_ProcReadStatus
r_static
r_int
id|DAC960_ProcReadStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
r_int
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;OK&bslash;n&quot;
suffix:semicolon
r_int
id|ControllerNumber
comma
id|BytesAvailable
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MonitoringAlertMode
)paren
(brace
id|StatusMessage
op_assign
l_string|&quot;ALERT&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|BytesAvailable
op_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|StatusMessage
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadInitialStatus implements reading /proc/rd/cN/initial_status.&n;*/
DECL|function|DAC960_ProcReadInitialStatus
r_static
r_int
id|DAC960_ProcReadInitialStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;InitialStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadCurrentStatus implements reading /proc/rd/cN/current_status.&n;*/
DECL|function|DAC960_ProcReadCurrentStatus
r_static
r_int
id|DAC960_ProcReadCurrentStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;No Rebuild or Consistency Check in Progress&bslash;n&quot;
suffix:semicolon
r_int
id|ProgressMessageLength
op_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
suffix:semicolon
r_int
id|BytesAvailable
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_ne
id|Controller-&gt;LastCurrentStatusTime
)paren
(brace
id|Controller-&gt;CurrentStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;ProgressBufferLength
OG
l_int|0
)paren
id|ProgressMessageLength
op_assign
id|Controller-&gt;ProgressBufferLength
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
l_int|2
op_plus
id|ProgressMessageLength
)paren
)paren
(brace
r_int
r_char
op_star
id|CurrentStatusBuffer
op_assign
id|Controller-&gt;CurrentStatusBuffer
suffix:semicolon
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;ProgressBufferLength
OG
l_int|0
)paren
id|strcpy
c_func
(paren
op_amp
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Controller-&gt;ProgressBuffer
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
op_amp
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|StatusMessage
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|ProgressMessageLength
suffix:semicolon
)brace
id|Controller-&gt;LastCurrentStatusTime
op_assign
id|jiffies
suffix:semicolon
)brace
id|BytesAvailable
op_assign
id|Controller-&gt;CurrentStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadUserCommand implements reading /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcReadUserCommand
r_static
r_int
id|DAC960_ProcReadUserCommand
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;UserStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcWriteUserCommand implements writing /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcWriteUserCommand
r_static
r_int
id|DAC960_ProcWriteUserCommand
c_func
(paren
id|File_T
op_star
id|File
comma
r_const
r_char
op_star
id|Buffer
comma
r_int
r_int
id|Count
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
r_char
id|CommandBuffer
(braket
l_int|80
)braket
suffix:semicolon
r_int
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Count
OG
r_sizeof
(paren
id|CommandBuffer
)paren
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|CommandBuffer
comma
id|Buffer
comma
id|Count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|CommandBuffer
(braket
id|Count
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|Length
op_assign
id|strlen
c_func
(paren
id|CommandBuffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandBuffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|CommandBuffer
(braket
op_decrement
id|Length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
r_return
(paren
id|DAC960_V1_ExecuteUserCommand
c_func
(paren
id|Controller
comma
id|CommandBuffer
)paren
ques
c_cond
id|Count
suffix:colon
op_minus
id|EBUSY
)paren
suffix:semicolon
r_else
r_return
(paren
id|DAC960_V2_ExecuteUserCommand
c_func
(paren
id|Controller
comma
id|CommandBuffer
)paren
ques
c_cond
id|Count
suffix:colon
op_minus
id|EBUSY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CreateProcEntries creates the /proc/rd/... entries for the&n;  DAC960 Driver.&n;*/
DECL|function|DAC960_CreateProcEntries
r_static
r_void
id|DAC960_CreateProcEntries
c_func
(paren
r_void
)paren
(brace
id|PROC_DirectoryEntry_T
op_star
id|StatusProcEntry
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
id|DAC960_ProcDirectoryEntry
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|StatusProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;status&quot;
comma
l_int|0
comma
id|DAC960_ProcDirectoryEntry
comma
id|DAC960_ProcReadStatus
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
id|PROC_DirectoryEntry_T
op_star
id|ControllerProcEntry
suffix:semicolon
id|PROC_DirectoryEntry_T
op_star
id|UserCommandProcEntry
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|sprintf
c_func
(paren
id|Controller-&gt;ControllerName
comma
l_string|&quot;c%d&quot;
comma
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
id|ControllerProcEntry
op_assign
id|proc_mkdir
c_func
(paren
id|Controller-&gt;ControllerName
comma
id|DAC960_ProcDirectoryEntry
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;initial_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadInitialStatus
comma
id|Controller
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;current_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadCurrentStatus
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;user_command&quot;
comma
id|S_IWUSR
op_or
id|S_IRUSR
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadUserCommand
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry-&gt;write_proc
op_assign
id|DAC960_ProcWriteUserCommand
suffix:semicolon
id|Controller-&gt;ControllerProcEntry
op_assign
id|ControllerProcEntry
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_DestroyProcEntries destroys the /proc/rd/... entries for the&n;  DAC960 Driver.&n;*/
DECL|function|DAC960_DestroyProcEntries
r_static
r_void
id|DAC960_DestroyProcEntries
c_func
(paren
r_void
)paren
(brace
r_int
id|ControllerNumber
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;initial_status&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;current_status&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;user_command&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|Controller-&gt;ControllerName
comma
id|DAC960_ProcDirectoryEntry
)paren
suffix:semicolon
)brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;rd/status&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  Include Module support if requested.&n;*/
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|DAC960_Initialize
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|DAC960_ActiveControllerCount
OG
l_int|0
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|DAC960_Finalize
c_func
(paren
op_amp
id|DAC960_NotifierBlock
comma
id|SYS_RESTART
comma
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
