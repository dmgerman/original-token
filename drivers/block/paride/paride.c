multiline_comment|/* &n;        paride.c  (c) 1997-8  Grant R. Guenther &lt;grant@torque.net&gt;&n;                              Under the terms of the GNU public license.&n;&n;&t;This is the base module for the family of device drivers&n;        that support parallel port IDE devices.  &n;&n;*/
multiline_comment|/* Changes:&n;&n;&t;1.01&t;GRG 1998.05.03&t;Use spinlocks&n;&t;1.02&t;GRG 1998.05.05  init_proto, release_proto, ktti&n;&t;1.03&t;GRG 1998.08.15  eliminate compiler warning&n;&t;1.04    GRG 1998.11.28  added support for FRIQ &n;&t;1.05    TMW 2000.06.06  use parport_find_number instead of&n;&t;&t;&t;&t;parport_enumerate&n;*/
DECL|macro|PI_VERSION
mdefine_line|#define PI_VERSION      &quot;1.05&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#ifdef CONFIG_PARPORT_MODULE
DECL|macro|CONFIG_PARPORT
mdefine_line|#define CONFIG_PARPORT
macro_line|#endif
macro_line|#ifdef CONFIG_PARPORT
macro_line|#include &lt;linux/parport.h&gt;
macro_line|#endif
macro_line|#include &quot;paride.h&quot;
DECL|macro|MAX_PROTOS
mdefine_line|#define MAX_PROTOS&t;32
DECL|variable|protocols
r_static
r_struct
id|pi_protocol
op_star
id|protocols
(braket
id|MAX_PROTOS
)braket
suffix:semicolon
DECL|variable|pi_spinlock
id|spinlock_t
id|pi_spinlock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|pi_write_regr
r_void
id|pi_write_regr
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|cont
comma
r_int
id|regr
comma
r_int
id|val
)paren
(brace
id|pi-&gt;proto
op_member_access_from_pointer
id|write_regr
c_func
(paren
id|pi
comma
id|cont
comma
id|regr
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|pi_read_regr
r_int
id|pi_read_regr
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|cont
comma
r_int
id|regr
)paren
(brace
r_return
id|pi-&gt;proto
op_member_access_from_pointer
id|read_regr
c_func
(paren
id|pi
comma
id|cont
comma
id|regr
)paren
suffix:semicolon
)brace
DECL|function|pi_write_block
r_void
id|pi_write_block
c_func
(paren
id|PIA
op_star
id|pi
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|pi-&gt;proto
op_member_access_from_pointer
id|write_block
c_func
(paren
id|pi
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|pi_read_block
r_void
id|pi_read_block
c_func
(paren
id|PIA
op_star
id|pi
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|pi-&gt;proto
op_member_access_from_pointer
id|read_block
c_func
(paren
id|pi
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PARPORT
DECL|function|pi_wake_up
r_static
r_void
id|pi_wake_up
c_func
(paren
r_void
op_star
id|p
)paren
(brace
id|PIA
op_star
id|pi
op_assign
(paren
id|PIA
op_star
)paren
id|p
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_void
(paren
op_star
id|cont
)paren
(paren
r_void
)paren
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi_spinlock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;claim_cont
op_logical_and
op_logical_neg
id|parport_claim
c_func
(paren
id|pi-&gt;pardev
)paren
)paren
(brace
id|cont
op_assign
id|pi-&gt;claim_cont
suffix:semicolon
id|pi-&gt;claim_cont
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;claimed
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi_spinlock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
(paren
id|pi-&gt;parq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cont
)paren
id|cont
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|pi_do_claimed
r_void
id|pi_do_claimed
c_func
(paren
id|PIA
op_star
id|pi
comma
r_void
(paren
op_star
id|cont
)paren
(paren
r_void
)paren
)paren
macro_line|#ifdef CONFIG_PARPORT
(brace
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi_spinlock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;pardev
op_logical_or
op_logical_neg
id|parport_claim
c_func
(paren
id|pi-&gt;pardev
)paren
)paren
(brace
id|pi-&gt;claimed
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi_spinlock
comma
id|flags
)paren
suffix:semicolon
id|cont
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|pi-&gt;claim_cont
op_assign
id|cont
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi_spinlock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
(brace
id|cont
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|pi_claim
r_static
r_void
id|pi_claim
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
r_if
c_cond
(paren
id|pi-&gt;claimed
)paren
r_return
suffix:semicolon
id|pi-&gt;claimed
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_PARPORT
r_if
c_cond
(paren
id|pi-&gt;pardev
)paren
id|wait_event
(paren
id|pi-&gt;parq
comma
op_logical_neg
id|parport_claim
(paren
(paren
r_struct
id|pardevice
op_star
)paren
id|pi-&gt;pardev
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|pi_unclaim
r_static
r_void
id|pi_unclaim
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
id|pi-&gt;claimed
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PARPORT
r_if
c_cond
(paren
id|pi-&gt;pardev
)paren
id|parport_release
c_func
(paren
(paren
r_struct
id|pardevice
op_star
)paren
(paren
id|pi-&gt;pardev
)paren
)paren
suffix:semicolon
macro_line|#endif 
)brace
DECL|function|pi_connect
r_void
id|pi_connect
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
id|pi_claim
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi-&gt;proto
op_member_access_from_pointer
id|connect
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
DECL|function|pi_disconnect
r_void
id|pi_disconnect
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
id|pi-&gt;proto
op_member_access_from_pointer
id|disconnect
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi_unclaim
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
DECL|function|pi_unregister_parport
r_static
r_void
id|pi_unregister_parport
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
macro_line|#ifdef CONFIG_PARPORT
r_if
c_cond
(paren
id|pi-&gt;pardev
)paren
(brace
id|parport_unregister_device
c_func
(paren
(paren
r_struct
id|pardevice
op_star
)paren
(paren
id|pi-&gt;pardev
)paren
)paren
suffix:semicolon
id|pi-&gt;pardev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|pi_release
r_void
id|pi_release
c_func
(paren
id|PIA
op_star
id|pi
)paren
(brace
id|pi_unregister_parport
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
op_logical_and
(paren
id|pi-&gt;reserved
)paren
)paren
id|release_region
c_func
(paren
id|pi-&gt;port
comma
id|pi-&gt;reserved
)paren
suffix:semicolon
id|pi-&gt;proto
op_member_access_from_pointer
id|release_proto
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
DECL|macro|WR
mdefine_line|#define WR(r,v)         pi_write_regr(pi,0,r,v)
DECL|macro|RR
mdefine_line|#define RR(r)           (pi_read_regr(pi,0,r))
DECL|function|pi_test_proto
r_static
r_int
id|pi_test_proto
c_func
(paren
id|PIA
op_star
id|pi
comma
r_char
op_star
id|scratch
comma
r_int
id|verbose
)paren
(brace
r_int
id|j
comma
id|k
suffix:semicolon
r_int
id|e
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;proto-&gt;test_proto
)paren
(brace
id|pi_claim
c_func
(paren
id|pi
)paren
suffix:semicolon
id|j
op_assign
id|pi-&gt;proto
op_member_access_from_pointer
id|test_proto
c_func
(paren
id|pi
comma
id|scratch
comma
id|verbose
)paren
suffix:semicolon
id|pi_unclaim
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
id|j
suffix:semicolon
)brace
id|pi_connect
c_func
(paren
id|pi
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|WR
c_func
(paren
l_int|6
comma
l_int|0xa0
op_plus
id|j
op_star
l_int|0x10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|256
suffix:semicolon
id|k
op_increment
)paren
(brace
id|WR
c_func
(paren
l_int|2
comma
id|k
op_xor
l_int|0xaa
)paren
suffix:semicolon
id|WR
c_func
(paren
l_int|3
comma
id|k
op_xor
l_int|0x55
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RR
c_func
(paren
l_int|2
)paren
op_ne
(paren
id|k
op_xor
l_int|0xaa
)paren
)paren
id|e
(braket
id|j
)braket
op_increment
suffix:semicolon
)brace
)brace
id|pi_disconnect
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;%s: %s: port 0x%x, mode  %d, test=(%d,%d)&bslash;n&quot;
comma
id|pi-&gt;device
comma
id|pi-&gt;proto-&gt;name
comma
id|pi-&gt;port
comma
id|pi-&gt;mode
comma
id|e
(braket
l_int|0
)braket
comma
id|e
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
id|e
(braket
l_int|0
)braket
op_logical_and
id|e
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* not here if both &gt; 0 */
)brace
DECL|function|pi_register
r_int
id|pi_register
c_func
(paren
id|PIP
op_star
id|pr
)paren
(brace
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|MAX_PROTOS
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|protocols
(braket
id|k
)braket
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|pr-&gt;name
comma
id|protocols
(braket
id|k
)braket
op_member_access_from_pointer
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;paride: %s protocol already registered&bslash;n&quot;
comma
id|pr-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|k
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|k
OL
id|MAX_PROTOS
)paren
op_logical_and
(paren
id|protocols
(braket
id|k
)braket
)paren
)paren
(brace
id|k
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_eq
id|MAX_PROTOS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;paride: protocol table full&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|protocols
(braket
id|k
)braket
op_assign
id|pr
suffix:semicolon
id|pr-&gt;index
op_assign
id|k
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;paride: %s registered as protocol %d&bslash;n&quot;
comma
id|pr-&gt;name
comma
id|k
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|pi_unregister
r_void
id|pi_unregister
c_func
(paren
id|PIP
op_star
id|pr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|protocols
(braket
id|pr-&gt;index
)braket
op_ne
id|pr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;paride: %s not registered&bslash;n&quot;
comma
id|pr-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|protocols
(braket
id|pr-&gt;index
)braket
op_assign
l_int|0
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|pi_register_parport
r_static
r_void
id|pi_register_parport
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|verbose
)paren
(brace
macro_line|#ifdef CONFIG_PARPORT
r_struct
id|parport
op_star
id|port
suffix:semicolon
id|port
op_assign
id|parport_find_base
(paren
id|pi-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|pi-&gt;pardev
op_assign
id|parport_register_device
c_func
(paren
id|port
comma
id|pi-&gt;device
comma
l_int|NULL
comma
id|pi_wake_up
comma
l_int|NULL
comma
l_int|0
comma
(paren
r_void
op_star
)paren
id|pi
)paren
suffix:semicolon
id|parport_put_port
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
r_return
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|pi-&gt;parq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;%s: 0x%x is %s&bslash;n&quot;
comma
id|pi-&gt;device
comma
id|pi-&gt;port
comma
id|port-&gt;name
)paren
suffix:semicolon
id|pi-&gt;parname
op_assign
(paren
r_char
op_star
)paren
id|port-&gt;name
suffix:semicolon
macro_line|#endif
)brace
DECL|function|pi_probe_mode
r_static
r_int
id|pi_probe_mode
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|max
comma
r_char
op_star
id|scratch
comma
r_int
id|verbose
)paren
(brace
r_int
id|best
comma
id|range
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;mode
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|pi-&gt;mode
op_ge
id|max
)paren
r_return
l_int|0
suffix:semicolon
id|range
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;mode
op_ge
id|pi-&gt;proto-&gt;epp_first
)paren
id|range
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|range
op_eq
l_int|8
)paren
op_logical_and
(paren
id|pi-&gt;port
op_mod
l_int|8
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
op_logical_and
id|check_region
c_func
(paren
id|pi-&gt;port
comma
id|range
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|pi-&gt;reserved
op_assign
id|range
suffix:semicolon
r_return
(paren
op_logical_neg
id|pi_test_proto
c_func
(paren
id|pi
comma
id|scratch
comma
id|verbose
)paren
)paren
suffix:semicolon
)brace
id|best
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|pi-&gt;mode
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;mode
OL
id|max
suffix:semicolon
id|pi-&gt;mode
op_increment
)paren
(brace
id|range
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;mode
op_ge
id|pi-&gt;proto-&gt;epp_first
)paren
id|range
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|range
op_eq
l_int|8
)paren
op_logical_and
(paren
id|pi-&gt;port
op_mod
l_int|8
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
op_logical_and
id|check_region
c_func
(paren
id|pi-&gt;port
comma
id|range
)paren
)paren
r_break
suffix:semicolon
id|pi-&gt;reserved
op_assign
id|range
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi_test_proto
c_func
(paren
id|pi
comma
id|scratch
comma
id|verbose
)paren
)paren
id|best
op_assign
id|pi-&gt;mode
suffix:semicolon
)brace
id|pi-&gt;mode
op_assign
id|best
suffix:semicolon
r_return
(paren
id|best
OG
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pi_probe_unit
r_static
r_int
id|pi_probe_unit
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|unit
comma
r_char
op_star
id|scratch
comma
r_int
id|verbose
)paren
(brace
r_int
id|max
comma
id|s
comma
id|e
suffix:semicolon
id|s
op_assign
id|unit
suffix:semicolon
id|e
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
op_minus
l_int|1
)paren
(brace
id|s
op_assign
l_int|0
suffix:semicolon
id|e
op_assign
id|pi-&gt;proto-&gt;max_units
suffix:semicolon
)brace
id|pi_register_parport
c_func
(paren
id|pi
comma
id|verbose
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
op_logical_and
id|check_region
c_func
(paren
id|pi-&gt;port
comma
l_int|3
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;proto-&gt;test_port
)paren
(brace
id|pi_claim
c_func
(paren
id|pi
)paren
suffix:semicolon
id|max
op_assign
id|pi-&gt;proto
op_member_access_from_pointer
id|test_port
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi_unclaim
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
r_else
id|max
op_assign
id|pi-&gt;proto-&gt;max_mode
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;proto-&gt;probe_unit
)paren
(brace
id|pi_claim
c_func
(paren
id|pi
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pi-&gt;unit
op_assign
id|s
suffix:semicolon
id|pi-&gt;unit
OL
id|e
suffix:semicolon
id|pi-&gt;unit
op_increment
)paren
r_if
c_cond
(paren
id|pi-&gt;proto
op_member_access_from_pointer
id|probe_unit
c_func
(paren
id|pi
)paren
)paren
(brace
id|pi_unclaim
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi_probe_mode
c_func
(paren
id|pi
comma
id|max
comma
id|scratch
comma
id|verbose
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|pi_unregister_parport
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|pi_unclaim
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi_unregister_parport
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pi_probe_mode
c_func
(paren
id|pi
comma
id|max
comma
id|scratch
comma
id|verbose
)paren
)paren
(brace
id|pi_unregister_parport
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|pi_init
r_int
id|pi_init
c_func
(paren
id|PIA
op_star
id|pi
comma
r_int
id|autoprobe
comma
r_int
id|port
comma
r_int
id|mode
comma
r_int
id|unit
comma
r_int
id|protocol
comma
r_int
id|delay
comma
r_char
op_star
id|scratch
comma
r_int
id|devtype
comma
r_int
id|verbose
comma
r_char
op_star
id|device
)paren
(brace
r_int
id|p
comma
id|k
comma
id|s
comma
id|e
suffix:semicolon
r_int
id|lpts
(braket
l_int|7
)braket
op_assign
(brace
l_int|0x3bc
comma
l_int|0x378
comma
l_int|0x278
comma
l_int|0x268
comma
l_int|0x27c
comma
l_int|0x26c
comma
l_int|0
)brace
suffix:semicolon
id|s
op_assign
id|protocol
suffix:semicolon
id|e
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|protocols
(braket
l_int|0
)braket
)paren
id|request_module
(paren
l_string|&quot;paride_protocol&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|autoprobe
)paren
(brace
id|s
op_assign
l_int|0
suffix:semicolon
id|e
op_assign
id|MAX_PROTOS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|s
OL
l_int|0
)paren
op_logical_or
(paren
id|s
op_ge
id|MAX_PROTOS
)paren
op_logical_or
(paren
id|port
op_le
l_int|0
)paren
op_logical_or
(paren
op_logical_neg
id|protocols
(braket
id|s
)braket
)paren
op_logical_or
(paren
id|unit
OL
l_int|0
)paren
op_logical_or
(paren
id|unit
op_ge
id|protocols
(braket
id|s
)braket
op_member_access_from_pointer
id|max_units
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Invalid parameters&bslash;n&quot;
comma
id|device
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|p
op_assign
id|s
suffix:semicolon
id|p
OL
id|e
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|protocols
(braket
id|p
)braket
)paren
(brace
id|pi-&gt;proto
op_assign
id|protocols
(braket
id|p
)braket
suffix:semicolon
id|pi
op_member_access_from_pointer
r_private
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;proto
op_member_access_from_pointer
id|init_proto
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay
op_eq
op_minus
l_int|1
)paren
id|pi-&gt;delay
op_assign
id|pi-&gt;proto-&gt;default_delay
suffix:semicolon
r_else
id|pi-&gt;delay
op_assign
id|delay
suffix:semicolon
id|pi-&gt;devtype
op_assign
id|devtype
suffix:semicolon
id|pi-&gt;device
op_assign
id|device
suffix:semicolon
id|pi-&gt;parname
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;pardev
op_assign
l_int|NULL
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|pi-&gt;parq
)paren
suffix:semicolon
id|pi-&gt;claimed
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;claim_cont
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;mode
op_assign
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ne
op_minus
l_int|1
)paren
(brace
id|pi-&gt;port
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
id|pi_probe_unit
c_func
(paren
id|pi
comma
id|unit
comma
id|scratch
comma
id|verbose
)paren
)paren
r_break
suffix:semicolon
id|pi-&gt;port
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|k
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pi-&gt;port
op_assign
id|lpts
(braket
id|k
op_increment
)braket
)paren
)paren
r_if
c_cond
(paren
id|pi_probe_unit
c_func
(paren
id|pi
comma
id|unit
comma
id|scratch
comma
id|verbose
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;port
)paren
r_break
suffix:semicolon
)brace
id|pi-&gt;proto
op_member_access_from_pointer
id|release_proto
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;port
)paren
(brace
r_if
c_cond
(paren
id|autoprobe
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Autoprobe failed&bslash;n&quot;
comma
id|device
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s: Adapter not found&bslash;n&quot;
comma
id|device
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;pardev
)paren
id|request_region
c_func
(paren
id|pi-&gt;port
comma
id|pi-&gt;reserved
comma
id|pi-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;parname
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Sharing %s at 0x%x&bslash;n&quot;
comma
id|pi-&gt;device
comma
id|pi-&gt;parname
comma
id|pi-&gt;port
)paren
suffix:semicolon
id|pi-&gt;proto
op_member_access_from_pointer
id|log_adapter
c_func
(paren
id|pi
comma
id|scratch
comma
id|verbose
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|MAX_PROTOS
suffix:semicolon
id|k
op_increment
)paren
id|protocols
(braket
id|k
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;paride: version %s installed&bslash;n&quot;
comma
id|PI_VERSION
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#else
DECL|function|paride_init
r_void
id|paride_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PARIDE_ATEN
(brace
r_extern
r_struct
id|pi_protocol
id|aten
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|aten
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_BPCK
(brace
r_extern
r_struct
id|pi_protocol
id|bpck
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|bpck
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_COMM
(brace
r_extern
r_struct
id|pi_protocol
id|comm
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|comm
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_DSTR
(brace
r_extern
r_struct
id|pi_protocol
id|dstr
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|dstr
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_EPAT
(brace
r_extern
r_struct
id|pi_protocol
id|epat
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|epat
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_EPIA
(brace
r_extern
r_struct
id|pi_protocol
id|epia
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|epia
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_FRPW
(brace
r_extern
r_struct
id|pi_protocol
id|frpw
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|frpw
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_FRIQ
(brace
r_extern
r_struct
id|pi_protocol
id|friq
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|friq
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif 
macro_line|#ifdef CONFIG_PARIDE_FIT2
(brace
r_extern
r_struct
id|pi_protocol
id|fit2
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|fit2
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_FIT3
(brace
r_extern
r_struct
id|pi_protocol
id|fit3
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|fit3
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_KBIC
(brace
r_extern
r_struct
id|pi_protocol
id|k951
suffix:semicolon
r_extern
r_struct
id|pi_protocol
id|k971
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|k951
)paren
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|k971
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_KTTI
(brace
r_extern
r_struct
id|pi_protocol
id|ktti
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|ktti
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_ON20
(brace
r_extern
r_struct
id|pi_protocol
id|on20
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|on20
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_ON26
(brace
r_extern
r_struct
id|pi_protocol
id|on26
suffix:semicolon
id|pi_register
c_func
(paren
op_amp
id|on26
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_PD
(brace
r_extern
r_int
id|pd_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|pd_init
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_PCD
(brace
r_extern
r_int
id|pcd_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|pcd_init
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_PF
(brace
r_extern
r_int
id|pf_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|pf_init
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_PT
(brace
r_extern
r_int
id|pt_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|pt_init
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PARIDE_PG
(brace
r_extern
r_int
id|pg_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|pg_init
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
multiline_comment|/* end of paride.c */
eof
