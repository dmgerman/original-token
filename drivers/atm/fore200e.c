multiline_comment|/*&n;  $Id: fore200e.c,v 1.5 2000/04/14 10:10:34 davem Exp $&n;&n;  A FORE Systems 200E-series driver for ATM on Linux.&n;  Christophe Lizzi (lizzi@cnam.fr), October 1999-March 2000.&n;&n;  Based on the PCA-200E driver from Uwe Dannowski (Uwe.Dannowski@inf.tu-dresden.de).&n;&n;  This driver simultaneously supports PCA-200E and SBA-200E adapters&n;  on i386, alpha (untested), powerpc, sparc and sparc64 architectures.&n;&n;  This program is free software; you can redistribute it and/or modify&n;  it under the terms of the GNU General Public License as published by&n;  the Free Software Foundation; either version 2 of the License, or&n;  (at your option) any later version.&n;&n;  This program is distributed in the hope that it will be useful,&n;  but WITHOUT ANY WARRANTY; without even the implied warranty of&n;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;  GNU General Public License for more details.&n;&n;  You should have received a copy of the GNU General Public License&n;  along with this program; if not, write to the Free Software&n;  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;*/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/sonet.h&gt;
macro_line|#include &lt;linux/atm_suni.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#ifdef CONFIG_ATM_FORE200E_SBA
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;fore200e.h&quot;
macro_line|#include &quot;suni.h&quot;
macro_line|#if 1   /* ensure correct handling of 52-byte AAL0 SDUs used by atmdump-like apps */
DECL|macro|FORE200E_52BYTE_AAL0_SDU
mdefine_line|#define FORE200E_52BYTE_AAL0_SDU
macro_line|#endif
DECL|macro|FORE200E_VERSION
mdefine_line|#define FORE200E_VERSION &quot;0.2d&quot;
DECL|macro|FORE200E
mdefine_line|#define FORE200E         &quot;fore200e: &quot;
macro_line|#if defined(CONFIG_ATM_FORE200E_DEBUG) &amp;&amp; (CONFIG_ATM_FORE200E_DEBUG &gt; 0)
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(level, format, args...)  do { if (CONFIG_ATM_FORE200E_DEBUG &gt;= (level)) &bslash;&n;                                                  printk(FORE200E format, ##args); } while(0)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(level, format, args...)  while(0)
macro_line|#endif
DECL|macro|FORE200E_ALIGN
mdefine_line|#define FORE200E_ALIGN(addr, alignment) &bslash;&n;        ((((unsigned long)(addr) + (alignment - 1)) &amp; ~(alignment - 1)) - (unsigned long)(addr))
DECL|macro|FORE200E_DMA_INDEX
mdefine_line|#define FORE200E_DMA_INDEX(dma_addr, type, index)  ((dma_addr) + (index) * sizeof(type))
DECL|macro|FORE200E_INDEX
mdefine_line|#define FORE200E_INDEX(virt_addr, type, index)     (&amp;((type *)(virt_addr))[ index ])
DECL|macro|FORE200E_NEXT_ENTRY
mdefine_line|#define FORE200E_NEXT_ENTRY(index, modulo)    (index = ++(index) % (modulo))
DECL|macro|MSECS
mdefine_line|#define MSECS(ms)  (((ms)*HZ/1000)+1)
r_extern
r_const
r_struct
id|atmdev_ops
id|fore200e_ops
suffix:semicolon
r_extern
r_const
r_struct
id|fore200e_bus
id|fore200e_bus
(braket
)braket
suffix:semicolon
DECL|variable|fore200e_boards
r_static
r_struct
id|fore200e
op_star
id|fore200e_boards
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Christophe Lizzi - credits to Uwe Dannowski and Heikki Vatiainen&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FORE Systems 200E-series ATM driver - version &quot;
id|FORE200E_VERSION
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;PCA-200E, SBA-200E&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|fore200e_rx_buf_nbr
r_static
r_const
r_int
id|fore200e_rx_buf_nbr
(braket
id|BUFFER_SCHEME_NBR
)braket
(braket
id|BUFFER_MAGN_NBR
)braket
op_assign
(brace
(brace
id|BUFFER_S1_NBR
comma
id|BUFFER_L1_NBR
)brace
comma
(brace
id|BUFFER_S2_NBR
comma
id|BUFFER_L2_NBR
)brace
)brace
suffix:semicolon
DECL|variable|fore200e_rx_buf_size
r_static
r_const
r_int
id|fore200e_rx_buf_size
(braket
id|BUFFER_SCHEME_NBR
)braket
(braket
id|BUFFER_MAGN_NBR
)braket
op_assign
(brace
(brace
id|BUFFER_S1_SIZE
comma
id|BUFFER_L1_SIZE
)brace
comma
(brace
id|BUFFER_S2_SIZE
comma
id|BUFFER_L2_SIZE
)brace
)brace
suffix:semicolon
macro_line|#if defined(CONFIG_ATM_FORE200E_DEBUG) &amp;&amp; (CONFIG_ATM_FORE200E_DEBUG &gt; 0)
DECL|variable|fore200e_traffic_class
r_static
r_const
r_char
op_star
id|fore200e_traffic_class
(braket
)braket
op_assign
(brace
l_string|&quot;NONE&quot;
comma
l_string|&quot;UBR&quot;
comma
l_string|&quot;CBR&quot;
comma
l_string|&quot;VBR&quot;
comma
l_string|&quot;ABR&quot;
comma
l_string|&quot;ANY&quot;
)brace
suffix:semicolon
macro_line|#endif
macro_line|#if 0 /* currently unused */
r_static
r_int
id|fore200e_fore2atm_aal
c_func
(paren
r_enum
id|fore200e_aal
id|aal
)paren
(brace
r_switch
c_cond
(paren
id|aal
)paren
(brace
r_case
id|FORE200E_AAL0
suffix:colon
r_return
id|ATM_AAL0
suffix:semicolon
r_case
id|FORE200E_AAL34
suffix:colon
r_return
id|ATM_AAL34
suffix:semicolon
r_case
id|FORE200E_AAL5
suffix:colon
r_return
id|ATM_AAL5
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
r_static
r_enum
id|fore200e_aal
DECL|function|fore200e_atm2fore_aal
id|fore200e_atm2fore_aal
c_func
(paren
r_int
id|aal
)paren
(brace
r_switch
c_cond
(paren
id|aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
r_return
id|FORE200E_AAL0
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
r_return
id|FORE200E_AAL34
suffix:semicolon
r_case
id|ATM_AAL1
suffix:colon
r_case
id|ATM_AAL2
suffix:colon
r_case
id|ATM_AAL5
suffix:colon
r_return
id|FORE200E_AAL5
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_char
op_star
DECL|function|fore200e_irq_itoa
id|fore200e_irq_itoa
c_func
(paren
r_int
id|irq
)paren
(brace
macro_line|#if defined(__sparc_v9__)
r_return
id|__irq_itoa
c_func
(paren
id|irq
)paren
suffix:semicolon
macro_line|#else
r_static
r_char
id|str
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%d&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|str
suffix:semicolon
macro_line|#endif
)brace
r_static
r_void
op_star
DECL|function|fore200e_kmalloc
id|fore200e_kmalloc
c_func
(paren
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_void
op_star
id|chunk
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chunk
)paren
id|memset
c_func
(paren
id|chunk
comma
l_int|0x00
comma
id|size
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;kmalloc() failed, requested size = %d, flags = 0x%x&bslash;n&quot;
comma
id|size
comma
id|flags
)paren
suffix:semicolon
r_return
id|chunk
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_kfree
id|fore200e_kfree
c_func
(paren
r_void
op_star
id|chunk
)paren
(brace
id|kfree
c_func
(paren
id|chunk
)paren
suffix:semicolon
)brace
multiline_comment|/* allocate and align a chunk of memory intended to hold the data behing exchanged&n;   between the driver and the adapter (using streaming DVMA) */
r_static
r_int
DECL|function|fore200e_chunk_alloc
id|fore200e_chunk_alloc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
comma
r_int
id|size
comma
r_int
id|alignment
comma
r_int
id|direction
)paren
(brace
r_int
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|alignment
op_le
r_sizeof
(paren
r_int
)paren
)paren
id|alignment
op_assign
l_int|0
suffix:semicolon
id|chunk-&gt;alloc_size
op_assign
id|size
op_plus
id|alignment
suffix:semicolon
id|chunk-&gt;align_size
op_assign
id|size
suffix:semicolon
id|chunk-&gt;direction
op_assign
id|direction
suffix:semicolon
id|chunk-&gt;alloc_addr
op_assign
id|fore200e_kmalloc
c_func
(paren
id|chunk-&gt;alloc_size
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;alloc_addr
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|alignment
OG
l_int|0
)paren
id|offset
op_assign
id|FORE200E_ALIGN
c_func
(paren
id|chunk-&gt;alloc_addr
comma
id|alignment
)paren
suffix:semicolon
id|chunk-&gt;align_addr
op_assign
id|chunk-&gt;alloc_addr
op_plus
id|offset
suffix:semicolon
id|chunk-&gt;dma_addr
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|chunk-&gt;align_addr
comma
id|chunk-&gt;align_size
comma
id|direction
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* free a chunk of memory */
r_static
r_void
DECL|function|fore200e_chunk_free
id|fore200e_chunk_free
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|chunk-&gt;dma_addr
comma
id|chunk-&gt;dma_size
comma
id|chunk-&gt;direction
)paren
suffix:semicolon
id|fore200e_kfree
c_func
(paren
id|chunk-&gt;alloc_addr
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* currently unused */
r_static
r_int
id|fore200e_checkup
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|u32
id|hb1
comma
id|hb2
suffix:semicolon
id|hb1
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;heartbeat
)paren
suffix:semicolon
id|fore200e_spin
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|hb2
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;heartbeat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hb2
op_le
id|hb1
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s heartbeat is not counting upwards, hb1 = %x; hb2 = %x&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|hb1
comma
id|hb2
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s heartbeat is ok&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif 
r_static
r_void
DECL|function|fore200e_spin
id|fore200e_spin
c_func
(paren
r_int
id|msecs
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|MSECS
c_func
(paren
id|msecs
)paren
suffix:semicolon
r_while
c_loop
(paren
id|jiffies
OL
id|timeout
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_poll
id|fore200e_poll
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_volatile
id|u32
op_star
id|addr
comma
id|u32
id|val
comma
r_int
id|msecs
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|MSECS
c_func
(paren
id|msecs
)paren
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|ok
op_assign
(paren
op_star
id|addr
op_eq
id|val
)paren
)paren
op_logical_or
(paren
op_star
id|addr
op_amp
id|STATUS_ERROR
)paren
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|jiffies
OL
id|timeout
)paren
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;cmd polling failed, got status 0x%08x, expected 0x%08x&bslash;n&quot;
comma
op_star
id|addr
comma
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|ok
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_io_poll
id|fore200e_io_poll
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_volatile
id|u32
op_star
id|addr
comma
id|u32
id|val
comma
r_int
id|msecs
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|MSECS
c_func
(paren
id|msecs
)paren
suffix:semicolon
r_int
id|ok
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|ok
op_assign
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
id|addr
)paren
op_eq
id|val
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|jiffies
OL
id|timeout
)paren
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;I/O polling failed, got status 0x%08x, expected 0x%08x&bslash;n&quot;
comma
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
id|addr
)paren
comma
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|ok
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_free_rx_buf
id|fore200e_free_rx_buf
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|scheme
comma
id|magn
comma
id|nbr
suffix:semicolon
r_struct
id|buffer
op_star
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
(brace
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|buffer
op_assign
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
dot
id|buffer
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|nbr
op_assign
l_int|0
suffix:semicolon
id|nbr
OL
id|fore200e_rx_buf_nbr
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
id|nbr
op_increment
)paren
(brace
r_struct
id|chunk
op_star
id|data
op_assign
op_amp
id|buffer
(braket
id|nbr
)braket
dot
id|data
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;alloc_addr
op_ne
l_int|NULL
)paren
id|fore200e_chunk_free
c_func
(paren
id|fore200e
comma
id|data
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_static
r_void
DECL|function|fore200e_uninit_bs_queue
id|fore200e_uninit_bs_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|scheme
comma
id|magn
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
(brace
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
(brace
r_struct
id|chunk
op_star
id|status
op_assign
op_amp
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
dot
id|status
suffix:semicolon
r_struct
id|chunk
op_star
id|rbd_block
op_assign
op_amp
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
dot
id|rbd_block
suffix:semicolon
r_if
c_cond
(paren
id|status-&gt;alloc_addr
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rbd_block-&gt;alloc_addr
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
id|rbd_block
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_int
DECL|function|fore200e_reset
id|fore200e_reset
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_int
id|diag
)paren
(brace
r_int
id|ok
suffix:semicolon
id|fore200e-&gt;cp_monitor
op_assign
(paren
r_struct
id|cp_monitor
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|FORE200E_CP_MONITOR_OFFSET
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|BSTAT_COLD_START
comma
op_amp
id|fore200e-&gt;cp_monitor-&gt;bstat
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|reset
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|diag
)paren
(brace
id|ok
op_assign
id|fore200e_io_poll
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;cp_monitor-&gt;bstat
comma
id|BSTAT_SELFTEST_OK
comma
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s self-test failed&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s self-test passed&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_RESET
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_shutdown
id|fore200e_shutdown
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;removing device %s at 0x%lx, IRQ %s&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|fore200e-&gt;phys_base
comma
id|fore200e_irq_itoa
c_func
(paren
id|fore200e-&gt;irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;state
OG
id|FORE200E_STATE_RESET
)paren
(brace
multiline_comment|/* first, reset the board to prevent further interrupts or data transfers */
id|fore200e_reset
c_func
(paren
id|fore200e
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* then, release all allocated resources */
r_switch
c_cond
(paren
id|fore200e-&gt;state
)paren
(brace
r_case
id|FORE200E_STATE_COMPLETE
suffix:colon
r_if
c_cond
(paren
id|fore200e-&gt;stats
)paren
id|kfree
c_func
(paren
id|fore200e-&gt;stats
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_IRQ
suffix:colon
id|free_irq
c_func
(paren
id|fore200e-&gt;irq
comma
id|fore200e-&gt;atm_dev
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_ALLOC_BUF
suffix:colon
id|fore200e_free_rx_buf
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_INIT_BSQ
suffix:colon
id|fore200e_uninit_bs_queue
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_INIT_RXQ
suffix:colon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;host_rxq.status
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;host_rxq.rpd
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_INIT_TXQ
suffix:colon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;host_txq.status
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;host_txq.tpd
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_INIT_CMDQ
suffix:colon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;host_cmdq.status
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_INITIALIZE
suffix:colon
multiline_comment|/* nothing to do for that state */
r_case
id|FORE200E_STATE_START_FW
suffix:colon
multiline_comment|/* nothing to do for that state */
r_case
id|FORE200E_STATE_LOAD_FW
suffix:colon
multiline_comment|/* nothing to do for that state */
r_case
id|FORE200E_STATE_RESET
suffix:colon
multiline_comment|/* nothing to do for that state */
r_case
id|FORE200E_STATE_MAP
suffix:colon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|unmap
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_CONFIGURE
suffix:colon
multiline_comment|/* nothing to do for that state */
r_case
id|FORE200E_STATE_REGISTER
suffix:colon
multiline_comment|/* XXX shouldn&squot;t we *start* by deregistering the device? */
id|atm_dev_deregister
c_func
(paren
id|fore200e-&gt;atm_dev
)paren
suffix:semicolon
r_case
id|FORE200E_STATE_BLANK
suffix:colon
multiline_comment|/* nothing to do for that state */
)brace
)brace
macro_line|#ifdef CONFIG_ATM_FORE200E_PCA
DECL|function|fore200e_pca_read
r_static
id|u32
id|fore200e_pca_read
c_func
(paren
r_volatile
id|u32
op_star
id|addr
)paren
(brace
multiline_comment|/* on big-endian hosts, the board is configured to convert&n;       the endianess of slave RAM accesses  */
r_return
id|le32_to_cpu
c_func
(paren
id|readl
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
)brace
DECL|function|fore200e_pca_write
r_static
r_void
id|fore200e_pca_write
c_func
(paren
id|u32
id|val
comma
r_volatile
id|u32
op_star
id|addr
)paren
(brace
multiline_comment|/* on big-endian hosts, the board is configured to convert&n;       the endianess of slave RAM accesses  */
id|writel
c_func
(paren
id|cpu_to_le32
c_func
(paren
id|val
)paren
comma
id|addr
)paren
suffix:semicolon
)brace
r_static
id|u32
DECL|function|fore200e_pca_dma_map
id|fore200e_pca_dma_map
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_void
op_star
id|virt_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|u32
id|dma_addr
op_assign
id|pci_map_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|virt_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;PCI DVMA mapping: virt_addr = 0x%p, size = %d, direction = %d,  --&gt; dma_addr = 0x%08x&bslash;n&quot;
comma
id|virt_addr
comma
id|size
comma
id|direction
comma
id|dma_addr
)paren
suffix:semicolon
r_return
id|dma_addr
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_pca_dma_unmap
id|fore200e_pca_dma_unmap
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
id|u32
id|dma_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;PCI DVMA unmapping: dma_addr = 0x%08x, size = %d, direction = %d&bslash;n&quot;
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_pca_dma_sync
id|fore200e_pca_dma_sync
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
id|u32
id|dma_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;PCI DVMA sync: dma_addr = 0x%08x, size = %d, direction = %d&bslash;n&quot;
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
)brace
multiline_comment|/* allocate a DMA consistent chunk of memory intended to act as a communication mechanism&n;   (to hold descriptors, status, queues, etc.) shared by the driver and the adapter */
r_static
r_int
DECL|function|fore200e_pca_dma_chunk_alloc
id|fore200e_pca_dma_chunk_alloc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
comma
r_int
id|size
comma
r_int
id|nbr
comma
r_int
id|alignment
)paren
(brace
macro_line|#if defined(__sparc_v9__)
multiline_comment|/* returned chunks are page-aligned */
id|chunk-&gt;alloc_addr
op_assign
id|pci_alloc_consistent
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|chunk-&gt;alloc_size
comma
op_amp
id|chunk-&gt;dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;alloc_addr
op_eq
l_int|NULL
op_logical_or
id|chunk-&gt;dma_addr
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chunk-&gt;align_addr
op_assign
id|chunk-&gt;alloc_addr
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|fore200e_chunk_alloc
c_func
(paren
id|fore200e
comma
id|chunk
comma
id|size
op_star
id|nbr
comma
id|alignment
comma
id|FORE200E_DMA_BIDIRECTIONAL
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* free a DMA consistent chunk of memory */
r_static
r_void
DECL|function|fore200e_pca_dma_chunk_free
id|fore200e_pca_dma_chunk_free
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
)paren
(brace
macro_line|#if defined(__sparc_v9__)
id|pci_free_consistent
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|chunk-&gt;alloc_size
comma
id|chunk-&gt;alloc_addr
comma
id|chunk-&gt;dma_addr
)paren
suffix:semicolon
macro_line|#else
id|fore200e_chunk_free
c_func
(paren
id|fore200e
comma
id|chunk
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
r_int
DECL|function|fore200e_pca_irq_check
id|fore200e_pca_irq_check
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
multiline_comment|/* this is a 1 bit register */
r_return
id|readl
c_func
(paren
id|fore200e-&gt;regs.pca.psr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_pca_irq_ack
id|fore200e_pca_irq_ack
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|writel
c_func
(paren
id|PCA200E_HCR_CLRINTR
comma
id|fore200e-&gt;regs.pca.hcr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_pca_reset
id|fore200e_pca_reset
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|writel
c_func
(paren
id|PCA200E_HCR_RESET
comma
id|fore200e-&gt;regs.pca.hcr
)paren
suffix:semicolon
id|fore200e_spin
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|fore200e-&gt;regs.pca.hcr
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_pca_map
id|fore200e_pca_map
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s being mapped in memory&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|fore200e-&gt;virt_base
op_assign
id|ioremap
c_func
(paren
id|fore200e-&gt;phys_base
comma
id|PCA200E_IOSPACE_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;virt_base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;can&squot;t map device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;device %s mapped to 0x%p&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|fore200e-&gt;virt_base
)paren
suffix:semicolon
multiline_comment|/* gain access to the PCA-200E specific registers  */
id|fore200e-&gt;regs.pca.hcr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|PCA200E_HCR_OFFSET
)paren
suffix:semicolon
id|fore200e-&gt;regs.pca.imr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|PCA200E_IMR_OFFSET
)paren
suffix:semicolon
id|fore200e-&gt;regs.pca.psr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|PCA200E_PSR_OFFSET
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_MAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_pca_unmap
id|fore200e_pca_unmap
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s being unmapped from memory&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
multiline_comment|/* XXX iounmap() does nothing on PowerPC (at least in 2.2.12 and 2.3.41),&n;       this leads to a kernel panic if the module is loaded and unloaded several times */
r_if
c_cond
(paren
id|fore200e-&gt;virt_base
op_ne
l_int|NULL
)paren
id|iounmap
c_func
(paren
id|fore200e-&gt;virt_base
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_pca_configure
id|fore200e_pca_configure
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
suffix:semicolon
id|u8
id|master_ctrl
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s being configured&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_dev-&gt;irq
op_eq
l_int|0
)paren
op_logical_or
(paren
id|pci_dev-&gt;irq
op_eq
l_int|0xFF
)paren
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;incorrect IRQ setting - misconfigured PCI-PCI bridge?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCA200E_PCI_MASTER_CTRL
comma
op_amp
id|master_ctrl
)paren
suffix:semicolon
id|master_ctrl
op_assign
id|master_ctrl
macro_line|#if 0
op_or
id|PCA200E_CTRL_DIS_CACHE_RD
op_or
id|PCA200E_CTRL_DIS_WRT_INVAL
macro_line|#endif
macro_line|#if defined(__BIG_ENDIAN)
multiline_comment|/* request the PCA board to convert the endianess of slave RAM accesses */
op_or
id|PCA200E_CTRL_CONVERT_ENDIAN
macro_line|#endif
op_or
id|PCA200E_CTRL_LARGE_PCI_BURSTS
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
id|PCA200E_PCI_MASTER_CTRL
comma
id|master_ctrl
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_CONFIGURE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|fore200e
op_star
id|__init
DECL|function|fore200e_pca_detect
id|fore200e_pca_detect
c_func
(paren
r_const
r_struct
id|fore200e_bus
op_star
id|bus
comma
r_int
id|index
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|count
op_assign
id|index
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;no PCI subsystem&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_do
(brace
id|pci_dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_FORE
comma
id|PCI_DEVICE_ID_FORE_PCA200E
comma
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|fore200e
op_assign
id|fore200e_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fore200e
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|fore200e-&gt;bus
op_assign
id|bus
suffix:semicolon
id|fore200e-&gt;bus_dev
op_assign
id|pci_dev
suffix:semicolon
id|fore200e-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|fore200e-&gt;phys_base
op_assign
id|pci_resource_start
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if defined(__powerpc__)
id|fore200e-&gt;phys_base
op_add_assign
id|KERNELBASE
suffix:semicolon
macro_line|#endif
id|sprintf
c_func
(paren
id|fore200e-&gt;name
comma
l_string|&quot;%s-%d&quot;
comma
id|bus-&gt;model_name
comma
id|index
op_minus
l_int|1
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_return
id|fore200e
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_pca_prom_read
id|fore200e_pca_prom_read
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|prom_data
op_star
id|prom
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|host_cmdq_entry
op_star
id|entry
op_assign
op_amp
id|cmdq-&gt;host_entry
(braket
id|cmdq-&gt;head
)braket
suffix:semicolon
r_struct
id|prom_opcode
id|opcode
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|u32
id|prom_dma
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|cmdq-&gt;head
comma
id|QUEUE_SIZE_CMD
)paren
suffix:semicolon
id|opcode.opcode
op_assign
id|OPCODE_GET_PROM
suffix:semicolon
id|opcode.pad
op_assign
l_int|0
suffix:semicolon
id|prom_dma
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|prom
comma
r_sizeof
(paren
r_struct
id|prom_data
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|prom_dma
comma
op_amp
id|entry-&gt;cp_entry-&gt;cmd.prom_block.prom_haddr
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.prom_block.opcode
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|400
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|prom_dma
comma
r_sizeof
(paren
r_struct
id|prom_data
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to get PROM data from device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#if defined(__BIG_ENDIAN)
DECL|macro|swap_here
mdefine_line|#define swap_here(addr) (*((u32*)(addr)) = swab32( *((u32*)(addr)) ))
multiline_comment|/* MAC address is stored as little-endian */
id|swap_here
c_func
(paren
op_amp
id|prom-&gt;mac_addr
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|swap_here
c_func
(paren
op_amp
id|prom-&gt;mac_addr
(braket
l_int|4
)braket
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_pca_proc_read
id|fore200e_pca_proc_read
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
(paren
r_struct
id|pci_dev
op_star
)paren
id|fore200e-&gt;bus_dev
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;   PCI bus/slot/function:&bslash;t%d/%d/%d&bslash;n&quot;
comma
id|pci_dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|pci_dev-&gt;devfn
)paren
comma
id|PCI_FUNC
c_func
(paren
id|pci_dev-&gt;devfn
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATM_FORE200E_PCA */
macro_line|#ifdef CONFIG_ATM_FORE200E_SBA
r_static
id|u32
DECL|function|fore200e_sba_read
id|fore200e_sba_read
c_func
(paren
r_volatile
id|u32
op_star
id|addr
)paren
(brace
r_return
id|sbus_readl
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_write
id|fore200e_sba_write
c_func
(paren
id|u32
id|val
comma
r_volatile
id|u32
op_star
id|addr
)paren
(brace
id|sbus_writel
c_func
(paren
id|val
comma
id|addr
)paren
suffix:semicolon
)brace
r_static
id|u32
DECL|function|fore200e_sba_dma_map
id|fore200e_sba_dma_map
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_void
op_star
id|virt_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|u32
id|dma_addr
op_assign
id|sbus_map_single
c_func
(paren
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|virt_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;SBUS DVMA mapping: virt_addr = 0x%p, size = %d, direction = %d --&gt; dma_addr = 0x%08x&bslash;n&quot;
comma
id|virt_addr
comma
id|size
comma
id|direction
comma
id|dma_addr
)paren
suffix:semicolon
r_return
id|dma_addr
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_dma_unmap
id|fore200e_sba_dma_unmap
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
id|u32
id|dma_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;SBUS DVMA unmapping: dma_addr = 0x%08x, size = %d, direction = %d,&bslash;n&quot;
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|sbus_unmap_single
c_func
(paren
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_dma_sync
id|fore200e_sba_dma_sync
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
id|u32
id|dma_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;SBUS DVMA sync: dma_addr = 0x%08x, size = %d, direction = %d&bslash;n&quot;
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|sbus_dma_sync_single
c_func
(paren
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|dma_addr
comma
id|size
comma
id|direction
)paren
suffix:semicolon
)brace
multiline_comment|/* allocate a DVMA consistent chunk of memory intended to act as a communication mechanism&n;   (to hold descriptors, status, queues, etc.) shared by the driver and the adapter */
r_static
r_int
DECL|function|fore200e_sba_dma_chunk_alloc
id|fore200e_sba_dma_chunk_alloc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
comma
r_int
id|size
comma
r_int
id|nbr
comma
r_int
id|alignment
)paren
(brace
id|chunk-&gt;alloc_size
op_assign
id|chunk-&gt;align_size
op_assign
id|size
op_star
id|nbr
suffix:semicolon
multiline_comment|/* returned chunks are page-aligned */
id|chunk-&gt;alloc_addr
op_assign
id|sbus_alloc_consistent
c_func
(paren
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|chunk-&gt;alloc_size
comma
op_amp
id|chunk-&gt;dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;alloc_addr
op_eq
l_int|NULL
op_logical_or
id|chunk-&gt;dma_addr
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chunk-&gt;align_addr
op_assign
id|chunk-&gt;alloc_addr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* free a DVMA consistent chunk of memory */
r_static
r_void
DECL|function|fore200e_sba_dma_chunk_free
id|fore200e_sba_dma_chunk_free
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|chunk
op_star
id|chunk
)paren
(brace
id|sbus_free_consistent
c_func
(paren
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
comma
id|chunk-&gt;alloc_size
comma
id|chunk-&gt;alloc_addr
comma
id|chunk-&gt;dma_addr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_irq_enable
id|fore200e_sba_irq_enable
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|u32
id|hcr
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
id|fore200e-&gt;regs.sba.hcr
)paren
op_amp
id|SBA200E_HCR_STICKY
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|hcr
op_or
id|SBA200E_HCR_INTR_ENA
comma
id|fore200e-&gt;regs.sba.hcr
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_sba_irq_check
id|fore200e_sba_irq_check
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_return
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
id|fore200e-&gt;regs.sba.hcr
)paren
op_amp
id|SBA200E_HCR_INTR_REQ
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_irq_ack
id|fore200e_sba_irq_ack
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|u32
id|hcr
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
id|fore200e-&gt;regs.sba.hcr
)paren
op_amp
id|SBA200E_HCR_STICKY
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|hcr
op_or
id|SBA200E_HCR_INTR_CLR
comma
id|fore200e-&gt;regs.sba.hcr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_reset
id|fore200e_sba_reset
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|SBA200E_HCR_RESET
comma
id|fore200e-&gt;regs.sba.hcr
)paren
suffix:semicolon
id|fore200e_spin
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
l_int|0
comma
id|fore200e-&gt;regs.sba.hcr
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_sba_map
id|fore200e_sba_map
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|sbus_dev
op_star
id|sbus_dev
op_assign
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
suffix:semicolon
r_int
r_int
id|bursts
suffix:semicolon
multiline_comment|/* gain access to the SBA-200E specific registers  */
id|fore200e-&gt;regs.sba.hcr
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sbus_dev-&gt;resource
(braket
l_int|0
)braket
comma
l_int|0
comma
id|SBA200E_HCR_LENGTH
comma
l_string|&quot;SBA HCR&quot;
)paren
suffix:semicolon
id|fore200e-&gt;regs.sba.bsr
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sbus_dev-&gt;resource
(braket
l_int|1
)braket
comma
l_int|0
comma
id|SBA200E_BSR_LENGTH
comma
l_string|&quot;SBA BSR&quot;
)paren
suffix:semicolon
id|fore200e-&gt;regs.sba.isr
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sbus_dev-&gt;resource
(braket
l_int|2
)braket
comma
l_int|0
comma
id|SBA200E_ISR_LENGTH
comma
l_string|&quot;SBA ISR&quot;
)paren
suffix:semicolon
id|fore200e-&gt;virt_base
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sbus_dev-&gt;resource
(braket
l_int|3
)braket
comma
l_int|0
comma
id|SBA200E_RAM_LENGTH
comma
l_string|&quot;SBA RAM&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;virt_base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to map RAM of device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;device %s mapped to 0x%p&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|fore200e-&gt;virt_base
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
l_int|0x02
comma
id|fore200e-&gt;regs.sba.isr
)paren
suffix:semicolon
multiline_comment|/* XXX hardwired interrupt level */
multiline_comment|/* get the supported DVMA burst sizes */
id|bursts
op_assign
id|prom_getintdefault
c_func
(paren
id|sbus_dev-&gt;bus-&gt;prom_node
comma
l_string|&quot;burst-sizes&quot;
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbus_can_dma_64bit
c_func
(paren
id|sbus_dev
)paren
)paren
id|sbus_set_sbus64
c_func
(paren
id|sbus_dev
comma
id|bursts
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|bursts
op_amp
id|DMA_BURST16
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|SBA200E_BSR_BURST16
comma
id|fore200e-&gt;regs.sba.bsr
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bursts
op_amp
id|DMA_BURST8
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|SBA200E_BSR_BURST8
comma
id|fore200e-&gt;regs.sba.bsr
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bursts
op_amp
id|DMA_BURST4
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|SBA200E_BSR_BURST4
comma
id|fore200e-&gt;regs.sba.bsr
)paren
suffix:semicolon
macro_line|#endif
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_MAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_sba_unmap
id|fore200e_sba_unmap
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|sbus_iounmap
c_func
(paren
(paren
id|ulong
)paren
id|fore200e-&gt;regs.sba.hcr
comma
id|SBA200E_HCR_LENGTH
)paren
suffix:semicolon
id|sbus_iounmap
c_func
(paren
(paren
id|ulong
)paren
id|fore200e-&gt;regs.sba.bsr
comma
id|SBA200E_BSR_LENGTH
)paren
suffix:semicolon
id|sbus_iounmap
c_func
(paren
(paren
id|ulong
)paren
id|fore200e-&gt;regs.sba.isr
comma
id|SBA200E_ISR_LENGTH
)paren
suffix:semicolon
id|sbus_iounmap
c_func
(paren
(paren
id|ulong
)paren
id|fore200e-&gt;virt_base
comma
id|SBA200E_RAM_LENGTH
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_sba_configure
id|fore200e_sba_configure
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_CONFIGURE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|fore200e
op_star
id|__init
DECL|function|fore200e_sba_detect
id|fore200e_sba_detect
c_func
(paren
r_const
r_struct
id|fore200e_bus
op_star
id|bus
comma
r_int
id|index
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
suffix:semicolon
r_struct
id|sbus_bus
op_star
id|sbus_bus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sbus_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|for_each_sbus
(paren
id|sbus_bus
)paren
(brace
id|for_each_sbusdev
(paren
id|sbus_dev
comma
id|sbus_bus
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|sbus_dev-&gt;prom_name
comma
id|SBA200E_PROM_NAME
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|count
op_ge
id|index
)paren
r_goto
id|found
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
id|found
suffix:colon
macro_line|#if 1
r_if
c_cond
(paren
id|sbus_dev-&gt;num_registers
op_ne
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;this %s device has %d instead of 4 registers&bslash;n&quot;
comma
id|bus-&gt;model_name
comma
id|sbus_dev-&gt;num_registers
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|fore200e
op_assign
id|fore200e_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fore200e
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|fore200e-&gt;bus
op_assign
id|bus
suffix:semicolon
id|fore200e-&gt;bus_dev
op_assign
id|sbus_dev
suffix:semicolon
id|fore200e-&gt;irq
op_assign
id|sbus_dev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|fore200e-&gt;phys_base
op_assign
(paren
r_int
r_int
)paren
id|sbus_dev
suffix:semicolon
id|sprintf
c_func
(paren
id|fore200e-&gt;name
comma
l_string|&quot;%s-%d&quot;
comma
id|bus-&gt;model_name
comma
id|index
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|fore200e
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_sba_prom_read
id|fore200e_sba_prom_read
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|prom_data
op_star
id|prom
)paren
(brace
r_struct
id|sbus_dev
op_star
id|sbus_dev
op_assign
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|sbus_dev-&gt;prom_node
comma
l_string|&quot;macaddrlo2&quot;
comma
op_amp
id|prom-&gt;mac_addr
(braket
l_int|4
)braket
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|sbus_dev-&gt;prom_node
comma
l_string|&quot;macaddrhi4&quot;
comma
op_amp
id|prom-&gt;mac_addr
(braket
l_int|2
)braket
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|sbus_dev-&gt;prom_node
comma
l_string|&quot;serialnumber&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|prom-&gt;serial_number
comma
r_sizeof
(paren
id|prom-&gt;serial_number
)paren
)paren
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|sbus_dev-&gt;prom_node
comma
l_string|&quot;promversion&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|prom-&gt;hw_revision
comma
r_sizeof
(paren
id|prom-&gt;hw_revision
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_sba_proc_read
id|fore200e_sba_proc_read
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|sbus_dev
op_star
id|sbus_dev
op_assign
(paren
r_struct
id|sbus_dev
op_star
)paren
id|fore200e-&gt;bus_dev
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;   SBUS slot/device:&bslash;t&bslash;t%d/&squot;%s&squot;&bslash;n&quot;
comma
id|sbus_dev-&gt;slot
comma
id|sbus_dev-&gt;prom_name
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATM_FORE200E_SBA */
r_static
r_void
DECL|function|fore200e_irq_tx
id|fore200e_irq_tx
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_txq_entry
op_star
id|entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|entry
op_assign
id|fore200e-&gt;host_txq.host_entry
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_SIZE_TX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|entry-&gt;status
op_amp
id|STATUS_COMPLETE
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;TX COMPLETED: entry = %p, vcc = %p, skb = %p&bslash;n&quot;
comma
id|entry
comma
id|entry-&gt;vcc
comma
id|entry-&gt;skb
)paren
suffix:semicolon
multiline_comment|/* free copy of misaligned data */
r_if
c_cond
(paren
id|entry-&gt;data
)paren
id|kfree
c_func
(paren
id|entry-&gt;data
)paren
suffix:semicolon
multiline_comment|/* remove DMA mapping */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|entry-&gt;tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|buffer
comma
id|entry-&gt;tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|length
comma
id|FORE200E_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* notify tx completion */
r_if
c_cond
(paren
id|entry-&gt;vcc-&gt;pop
)paren
id|entry-&gt;vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|entry-&gt;vcc
comma
id|entry-&gt;skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_irq
c_func
(paren
id|entry-&gt;skb
)paren
suffix:semicolon
multiline_comment|/* check error condition */
r_if
c_cond
(paren
op_star
id|entry-&gt;status
op_amp
id|STATUS_ERROR
)paren
id|atomic_inc
c_func
(paren
op_amp
id|entry-&gt;vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
r_else
id|atomic_inc
c_func
(paren
op_amp
id|entry-&gt;vcc-&gt;stats-&gt;tx
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;host_txq.txing
op_decrement
suffix:semicolon
)brace
id|entry
op_increment
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|fore200e_supply
id|fore200e_supply
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|scheme
comma
id|magn
comma
id|i
suffix:semicolon
r_struct
id|host_bsq
op_star
id|bsq
suffix:semicolon
r_struct
id|host_bsq_entry
op_star
id|entry
suffix:semicolon
r_struct
id|buffer
op_star
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
(brace
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
(brace
id|bsq
op_assign
op_amp
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_rx_buf_nbr
(braket
id|scheme
)braket
(braket
id|magn
)braket
op_minus
id|bsq-&gt;count
OG
id|RBD_BLK_SIZE
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;supplying rx buffers to queue %d / %d, count = %d&bslash;n&quot;
comma
id|scheme
comma
id|magn
comma
id|bsq-&gt;count
)paren
suffix:semicolon
id|entry
op_assign
op_amp
id|bsq-&gt;host_entry
(braket
id|bsq-&gt;head
)braket
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|bsq-&gt;head
comma
id|QUEUE_SIZE_BS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RBD_BLK_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buffer
op_assign
op_amp
id|bsq-&gt;buffer
(braket
id|bsq-&gt;free
)braket
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|bsq-&gt;free
comma
id|fore200e_rx_buf_nbr
(braket
id|scheme
)braket
(braket
id|magn
)braket
)paren
suffix:semicolon
id|entry-&gt;rbd_block-&gt;rbd
(braket
id|i
)braket
dot
id|buffer_haddr
op_assign
id|buffer-&gt;data.dma_addr
suffix:semicolon
id|entry-&gt;rbd_block-&gt;rbd
(braket
id|i
)braket
dot
id|handle
op_assign
id|FORE200E_BUF2HDL
c_func
(paren
id|buffer
)paren
suffix:semicolon
)brace
multiline_comment|/* increase the number of supplied rx buffers */
id|bsq-&gt;count
op_add_assign
id|RBD_BLK_SIZE
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|entry-&gt;rbd_block_dma
comma
op_amp
id|entry-&gt;cp_entry-&gt;rbd_block_haddr
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_struct
id|atm_vcc
op_star
DECL|function|fore200e_find_vcc
id|fore200e_find_vcc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|rpd
op_star
id|rpd
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_for
c_loop
(paren
id|vcc
op_assign
id|fore200e-&gt;atm_dev-&gt;vccs
suffix:semicolon
id|vcc
suffix:semicolon
id|vcc
op_assign
id|vcc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;vpi
op_eq
id|rpd-&gt;atm_header.vpi
op_logical_and
id|vcc-&gt;vci
op_eq
id|rpd-&gt;atm_header.vci
)paren
r_break
suffix:semicolon
)brace
r_return
id|vcc
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_push_rpd
id|fore200e_push_rpd
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|rpd
op_star
id|rpd
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|buffer
op_star
id|buffer
suffix:semicolon
r_struct
id|fore200e_vcc
op_star
id|fore200e_vcc
suffix:semicolon
r_int
id|i
comma
id|pdu_len
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef FORE200E_52BYTE_AAL0_SDU
id|u32
id|cell_header
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|vcc
op_assign
id|fore200e_find_vcc
c_func
(paren
id|fore200e
comma
id|rpd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;no vcc found for PDU received on %d.%d.%d&bslash;n&quot;
comma
id|fore200e-&gt;atm_dev-&gt;number
comma
id|rpd-&gt;atm_header.vpi
comma
id|rpd-&gt;atm_header.vci
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fore200e_vcc
op_assign
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
macro_line|#ifdef FORE200E_52BYTE_AAL0_SDU
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_logical_and
(paren
id|vcc-&gt;qos.rxtp.max_sdu
op_eq
id|ATM_AAL0_SDU
)paren
)paren
(brace
id|cell_header
op_assign
(paren
id|rpd-&gt;atm_header.gfc
op_lshift
id|ATM_HDR_GFC_SHIFT
)paren
op_or
(paren
id|rpd-&gt;atm_header.vpi
op_lshift
id|ATM_HDR_VPI_SHIFT
)paren
op_or
(paren
id|rpd-&gt;atm_header.vci
op_lshift
id|ATM_HDR_VCI_SHIFT
)paren
op_or
(paren
id|rpd-&gt;atm_header.plt
op_lshift
id|ATM_HDR_PTI_SHIFT
)paren
op_or
id|rpd-&gt;atm_header.clp
suffix:semicolon
id|pdu_len
op_assign
l_int|4
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* compute total PDU length */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpd-&gt;nseg
suffix:semicolon
id|i
op_increment
)paren
id|pdu_len
op_add_assign
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|length
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|pdu_len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to alloc new skb, rx PDU length = %d&bslash;n&quot;
comma
id|pdu_len
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_drop
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;stamp
op_assign
id|vcc-&gt;timestamp
op_assign
id|xtime
suffix:semicolon
macro_line|#ifdef FORE200E_52BYTE_AAL0_SDU
r_if
c_cond
(paren
id|cell_header
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|4
)paren
)paren
op_assign
id|cell_header
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* reassemble segments */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpd-&gt;nseg
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* rebuild rx buffer address from rsd handle */
id|buffer
op_assign
id|FORE200E_HDL2BUF
c_func
(paren
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|handle
)paren
suffix:semicolon
multiline_comment|/* ensure DMA synchronisation */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_sync
c_func
(paren
id|fore200e
comma
id|buffer-&gt;data.dma_addr
comma
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|length
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|length
)paren
comma
id|buffer-&gt;data.align_addr
comma
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;rx skb: len = %d, truesize = %d&bslash;n&quot;
comma
id|skb-&gt;len
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdu_len
OL
id|fore200e_vcc-&gt;rx_min_pdu
)paren
id|fore200e_vcc-&gt;rx_min_pdu
op_assign
id|pdu_len
suffix:semicolon
r_if
c_cond
(paren
id|pdu_len
OG
id|fore200e_vcc-&gt;rx_max_pdu
)paren
id|fore200e_vcc-&gt;rx_max_pdu
op_assign
id|pdu_len
suffix:semicolon
multiline_comment|/* push PDU */
r_if
c_cond
(paren
id|atm_charge
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;receive buffers saturated for %d.%d.%d - PDU dropped&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_collect_rpd
id|fore200e_collect_rpd
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|rpd
op_star
id|rpd
)paren
(brace
r_struct
id|buffer
op_star
id|buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpd-&gt;nseg
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* rebuild rx buffer address from rsd handle */
id|buffer
op_assign
id|FORE200E_HDL2BUF
c_func
(paren
id|rpd-&gt;rsd
(braket
id|i
)braket
dot
id|handle
)paren
suffix:semicolon
multiline_comment|/* decrease the number of supplied rx buffers */
id|fore200e-&gt;host_bsq
(braket
id|buffer-&gt;scheme
)braket
(braket
id|buffer-&gt;magn
)braket
dot
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|fore200e_irq_rx
id|fore200e_irq_rx
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_rxq
op_star
id|rxq
op_assign
op_amp
id|fore200e-&gt;host_rxq
suffix:semicolon
r_struct
id|host_rxq_entry
op_star
id|entry
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|entry
op_assign
op_amp
id|rxq-&gt;host_entry
(braket
id|rxq-&gt;head
)braket
suffix:semicolon
multiline_comment|/* no more received PDUs */
r_if
c_cond
(paren
(paren
op_star
id|entry-&gt;status
op_amp
id|STATUS_COMPLETE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|rxq-&gt;head
comma
id|QUEUE_SIZE_RX
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|entry-&gt;status
op_amp
id|STATUS_ERROR
)paren
op_eq
l_int|0
)paren
(brace
id|fore200e_push_rpd
c_func
(paren
id|fore200e
comma
id|entry-&gt;rpd
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;damaged PDU on %d.%d.%d&bslash;n&quot;
comma
id|fore200e-&gt;atm_dev-&gt;number
comma
id|entry-&gt;rpd-&gt;atm_header.vpi
comma
id|entry-&gt;rpd-&gt;atm_header.vci
)paren
suffix:semicolon
)brace
id|fore200e_collect_rpd
c_func
(paren
id|fore200e
comma
id|entry-&gt;rpd
)paren
suffix:semicolon
id|fore200e_supply
c_func
(paren
id|fore200e
)paren
suffix:semicolon
multiline_comment|/* rewrite the rpd address to ack the received PDU */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|entry-&gt;rpd_dma
comma
op_amp
id|entry-&gt;cp_entry-&gt;rpd_haddr
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|fore200e_interrupt
id|fore200e_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
(paren
r_struct
id|atm_dev
op_star
)paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|irq_check
c_func
(paren
id|fore200e
)paren
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;unexpected interrupt on device %c&bslash;n&quot;
comma
id|fore200e-&gt;name
(braket
l_int|9
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;valid interrupt on device %c&bslash;n&quot;
comma
id|fore200e-&gt;name
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|irq_ack
c_func
(paren
id|fore200e
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_tasklet
id|fore200e_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
(paren
r_struct
id|fore200e
op_star
)paren
id|data
suffix:semicolon
id|fore200e_irq_rx
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;host_txq.txing
)paren
id|fore200e_irq_tx
c_func
(paren
id|fore200e
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_select_scheme
id|fore200e_select_scheme
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
id|scheme
suffix:semicolon
macro_line|#if 1
multiline_comment|/* fairly balance VCs over (identical) buffer schemes */
id|scheme
op_assign
id|vcc-&gt;vci
op_mod
l_int|2
ques
c_cond
id|BUFFER_SCHEME_ONE
suffix:colon
id|BUFFER_SCHEME_TWO
suffix:semicolon
macro_line|#else
multiline_comment|/* bit 7 of VPI magically selects the second buffer scheme */
r_if
c_cond
(paren
id|vcc-&gt;vpi
op_amp
(paren
l_int|1
op_lshift
l_int|7
)paren
)paren
(brace
id|vcc-&gt;vpi
op_and_assign
(paren
(paren
l_int|1
op_lshift
l_int|7
)paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset the magic bit */
id|scheme
op_assign
id|BUFFER_SCHEME_TWO
suffix:semicolon
)brace
r_else
(brace
id|scheme
op_assign
id|BUFFER_SCHEME_ONE
suffix:semicolon
)brace
macro_line|#endif
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;vpvc %d.%d.%d uses the %s buffer scheme&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|scheme
op_eq
id|BUFFER_SCHEME_ONE
ques
c_cond
l_string|&quot;first&quot;
suffix:colon
l_string|&quot;second&quot;
)paren
suffix:semicolon
r_return
id|scheme
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_activate_vcin
id|fore200e_activate_vcin
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_int
id|activate
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|mtu
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|host_cmdq_entry
op_star
id|entry
op_assign
op_amp
id|cmdq-&gt;host_entry
(braket
id|cmdq-&gt;head
)braket
suffix:semicolon
r_struct
id|activate_opcode
id|activ_opcode
suffix:semicolon
r_struct
id|deactivate_opcode
id|deactiv_opcode
suffix:semicolon
r_struct
id|vpvc
id|vpvc
suffix:semicolon
r_int
id|ok
suffix:semicolon
r_enum
id|fore200e_aal
id|aal
op_assign
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|cmdq-&gt;head
comma
id|QUEUE_SIZE_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|activate
)paren
(brace
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|scheme
op_assign
id|fore200e_select_scheme
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|activ_opcode.opcode
op_assign
id|OPCODE_ACTIVATE_VCIN
suffix:semicolon
id|activ_opcode.aal
op_assign
id|aal
suffix:semicolon
id|activ_opcode.scheme
op_assign
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|scheme
suffix:semicolon
id|activ_opcode.pad
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|deactiv_opcode.opcode
op_assign
id|OPCODE_DEACTIVATE_VCIN
suffix:semicolon
id|deactiv_opcode.pad
op_assign
l_int|0
suffix:semicolon
)brace
id|vpvc.vci
op_assign
id|vcc-&gt;vci
suffix:semicolon
id|vpvc.vpi
op_assign
id|vcc-&gt;vpi
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
r_if
c_cond
(paren
id|activate
)paren
(brace
macro_line|#ifdef FORE200E_52BYTE_AAL0_SDU
id|mtu
op_assign
l_int|48
suffix:semicolon
macro_line|#endif
multiline_comment|/* the MTU is unused by the cp, except in the case of AAL0 */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|mtu
comma
op_amp
id|entry-&gt;cp_entry-&gt;cmd.activate_block.mtu
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|vpvc
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.activate_block.vpvc
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|activ_opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.activate_block.opcode
)paren
suffix:semicolon
)brace
r_else
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|vpvc
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.deactivate_block.vpvc
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|deactiv_opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.deactivate_block.opcode
)paren
suffix:semicolon
)brace
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|400
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to %s vpvc %d.%d on device %s&bslash;n&quot;
comma
id|activate
ques
c_cond
l_string|&quot;open&quot;
suffix:colon
l_string|&quot;close&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;vpvc %d.%d %sed on device %s&bslash;n&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|activate
ques
c_cond
l_string|&quot;open&quot;
suffix:colon
l_string|&quot;clos&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_walk_vccs
id|fore200e_walk_vccs
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
op_star
id|vpi
comma
r_int
op_star
id|vci
)paren
(brace
r_struct
id|atm_vcc
op_star
id|walk
suffix:semicolon
multiline_comment|/* find a free VPI */
r_if
c_cond
(paren
op_star
id|vpi
op_eq
id|ATM_VPI_ANY
)paren
(brace
r_for
c_loop
(paren
op_star
id|vpi
op_assign
l_int|0
comma
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
id|walk
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|walk-&gt;vci
op_eq
op_star
id|vci
)paren
op_logical_and
(paren
id|walk-&gt;vpi
op_eq
op_star
id|vpi
)paren
)paren
(brace
(paren
op_star
id|vpi
)paren
op_increment
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* find a free VCI */
r_if
c_cond
(paren
op_star
id|vci
op_eq
id|ATM_VCI_ANY
)paren
(brace
r_for
c_loop
(paren
op_star
id|vci
op_assign
id|ATM_NOT_RSV_VCI
comma
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
id|walk
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|walk-&gt;vpi
op_assign
op_star
id|vpi
)paren
op_logical_and
(paren
id|walk-&gt;vci
op_eq
op_star
id|vci
)paren
)paren
(brace
op_star
id|vci
op_assign
id|walk-&gt;vci
op_plus
l_int|1
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|FORE200E_MAX_BACK2BACK_CELLS
mdefine_line|#define FORE200E_MAX_BACK2BACK_CELLS 255    /* XXX depends on CDVT */
r_static
r_void
DECL|function|fore200e_rate_ctrl
id|fore200e_rate_ctrl
c_func
(paren
r_struct
id|atm_qos
op_star
id|qos
comma
r_struct
id|tpd_rate
op_star
id|rate
)paren
(brace
r_if
c_cond
(paren
id|qos-&gt;txtp.max_pcr
OL
id|ATM_OC3_PCR
)paren
(brace
multiline_comment|/* compute the data cells to idle cells ratio from the PCR */
id|rate-&gt;data_cells
op_assign
id|qos-&gt;txtp.max_pcr
op_star
id|FORE200E_MAX_BACK2BACK_CELLS
op_div
id|ATM_OC3_PCR
suffix:semicolon
id|rate-&gt;idle_cells
op_assign
id|FORE200E_MAX_BACK2BACK_CELLS
op_minus
id|rate-&gt;data_cells
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* disable rate control */
id|rate-&gt;data_cells
op_assign
id|rate-&gt;idle_cells
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|fore200e_open
id|fore200e_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|fore200e_vcc
op_star
id|fore200e_vcc
suffix:semicolon
multiline_comment|/* find a free VPI/VCI */
id|fore200e_walk_vccs
c_func
(paren
id|vcc
comma
op_amp
id|vpi
comma
op_amp
id|vci
)paren
suffix:semicolon
id|vcc-&gt;vpi
op_assign
id|vpi
suffix:semicolon
id|vcc-&gt;vci
op_assign
id|vci
suffix:semicolon
multiline_comment|/* ressource checking only? */
r_if
c_cond
(paren
id|vci
op_eq
id|ATM_VCI_UNSPEC
op_logical_or
id|vpi
op_eq
id|ATM_VPI_UNSPEC
)paren
r_return
l_int|0
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|vcc-&gt;itf
op_assign
id|vcc-&gt;dev-&gt;number
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;opening %d.%d.%d:%d QoS = (tx: cl=%s, pcr=%d-%d, cdv=%d, max_sdu=%d; &quot;
l_string|&quot;rx: cl=%s, pcr=%d-%d, cdv=%d, max_sdu=%d)&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
comma
id|fore200e_traffic_class
(braket
id|vcc-&gt;qos.txtp.traffic_class
)braket
comma
id|vcc-&gt;qos.txtp.min_pcr
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.txtp.max_cdv
comma
id|vcc-&gt;qos.txtp.max_sdu
comma
id|fore200e_traffic_class
(braket
id|vcc-&gt;qos.rxtp.traffic_class
)braket
comma
id|vcc-&gt;qos.rxtp.min_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_cdv
comma
id|vcc-&gt;qos.rxtp.max_sdu
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_CBR
)paren
op_logical_and
(paren
id|vcc-&gt;qos.txtp.max_pcr
OG
l_int|0
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;available_cell_rate
OL
id|vcc-&gt;qos.txtp.max_pcr
)paren
(brace
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/* reserving the pseudo-CBR bandwidth at this point grants us&n;&t;   to reduce the length of the critical section protected&n;&t;   by &squot;rate_sf&squot;. in counterpart, we have to reset the available&n;&t;   bandwidth if we later encounter an error */
id|fore200e-&gt;available_cell_rate
op_sub_assign
id|vcc-&gt;qos.txtp.max_pcr
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
)brace
id|fore200e_vcc
op_assign
id|fore200e_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fore200e_vcc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_vcc
op_eq
l_int|NULL
)paren
(brace
id|down
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
id|fore200e-&gt;available_cell_rate
op_add_assign
id|vcc-&gt;qos.txtp.max_pcr
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
op_assign
id|fore200e_vcc
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_activate_vcin
c_func
(paren
id|fore200e
comma
l_int|1
comma
id|vcc
comma
id|vcc-&gt;qos.rxtp.max_sdu
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|fore200e_vcc
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
id|fore200e-&gt;available_cell_rate
op_add_assign
id|vcc-&gt;qos.txtp.max_pcr
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* compute rate control parameters */
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_CBR
)paren
op_logical_and
(paren
id|vcc-&gt;qos.txtp.max_pcr
OG
l_int|0
)paren
)paren
(brace
id|fore200e_rate_ctrl
c_func
(paren
op_amp
id|vcc-&gt;qos
comma
op_amp
id|fore200e_vcc-&gt;rate
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;tx on %d.%d.%d:%d, tx PCR = %d, rx PCR = %d, data_cells = %u, idle_cells = %u&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|fore200e_vcc-&gt;rate.data_cells
comma
id|fore200e_vcc-&gt;rate.idle_cells
)paren
suffix:semicolon
)brace
id|fore200e_vcc-&gt;tx_min_pdu
op_assign
id|fore200e_vcc-&gt;rx_min_pdu
op_assign
l_int|65536
suffix:semicolon
id|fore200e_vcc-&gt;tx_max_pdu
op_assign
id|fore200e_vcc-&gt;rx_max_pdu
op_assign
l_int|0
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|fore200e_close
id|fore200e_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;closing %d.%d.%d:%d&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
)paren
suffix:semicolon
id|fore200e_activate_vcin
c_func
(paren
id|fore200e
comma
l_int|0
comma
id|vcc
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_CBR
)paren
op_logical_and
(paren
id|vcc-&gt;qos.txtp.max_pcr
OG
l_int|0
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
id|fore200e-&gt;available_cell_rate
op_add_assign
id|vcc-&gt;qos.txtp.max_pcr
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
)brace
macro_line|#if 0
mdefine_line|#define FORE200E_SYNC_SEND    /* wait tx completion before returning */
macro_line|#endif
r_static
r_int
DECL|function|fore200e_send
id|fore200e_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|fore200e_vcc
op_star
id|fore200e_vcc
op_assign
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_struct
id|host_txq
op_star
id|txq
op_assign
op_amp
id|fore200e-&gt;host_txq
suffix:semicolon
r_struct
id|host_txq_entry
op_star
id|entry
suffix:semicolon
r_struct
id|tpd
op_star
id|tpd
suffix:semicolon
r_struct
id|tpd_haddr
id|tpd_haddr
suffix:semicolon
singleline_comment|//unsigned long          flags;
r_int
id|retry
op_assign
id|CONFIG_ATM_FORE200E_TX_RETRY
suffix:semicolon
r_int
id|tx_copy
op_assign
l_int|0
suffix:semicolon
r_int
id|tx_len
op_assign
id|skb-&gt;len
suffix:semicolon
id|u32
op_star
id|cell_header
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|skb_data
suffix:semicolon
r_int
id|skb_len
suffix:semicolon
macro_line|#ifdef FORE200E_52BYTE_AAL0_SDU
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_logical_and
(paren
id|vcc-&gt;qos.txtp.max_sdu
op_eq
id|ATM_AAL0_SDU
)paren
)paren
(brace
id|cell_header
op_assign
(paren
id|u32
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_data
op_assign
id|skb-&gt;data
op_plus
l_int|4
suffix:semicolon
multiline_comment|/* skip 4-byte cell header */
id|skb_len
op_assign
id|tx_len
op_assign
id|skb-&gt;len
op_minus
l_int|4
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;skipping user-supplied cell header 0x%08x&quot;
comma
op_star
id|cell_header
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|skb_data
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_len
op_assign
id|skb-&gt;len
suffix:semicolon
)brace
id|retry_here
suffix:colon
id|tasklet_disable
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
)paren
suffix:semicolon
id|entry
op_assign
op_amp
id|txq-&gt;host_entry
(braket
id|txq-&gt;head
)braket
suffix:semicolon
r_if
c_cond
(paren
op_star
id|entry-&gt;status
op_ne
id|STATUS_FREE
)paren
(brace
multiline_comment|/* try to free completed tx queue entries */
id|fore200e_irq_tx
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|entry-&gt;status
op_ne
id|STATUS_FREE
)paren
(brace
id|tasklet_enable
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
)paren
suffix:semicolon
multiline_comment|/* retry once again? */
r_if
c_cond
(paren
op_decrement
id|retry
OG
l_int|0
)paren
(brace
r_goto
id|retry_here
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;tx queue of device %s is saturated, PDU dropped - heartbeat is %08x&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|fore200e-&gt;cp_queues-&gt;heartbeat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|tpd
op_assign
id|entry-&gt;tpd
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_int
r_int
)paren
id|skb_data
)paren
op_amp
l_int|0x3
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;misaligned tx PDU on device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|tx_copy
op_assign
l_int|1
suffix:semicolon
id|tx_len
op_assign
id|skb_len
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_logical_and
(paren
id|skb_len
op_mod
id|ATM_CELL_PAYLOAD
)paren
)paren
(brace
multiline_comment|/* this simply NUKES the PCA-200E board */
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;incomplete tx AAL0 PDU on device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|tx_copy
op_assign
l_int|1
suffix:semicolon
id|tx_len
op_assign
(paren
(paren
id|skb_len
op_div
id|ATM_CELL_PAYLOAD
)paren
op_plus
l_int|1
)paren
op_star
id|ATM_CELL_PAYLOAD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_copy
)paren
(brace
id|entry-&gt;data
op_assign
id|kmalloc
c_func
(paren
id|tx_len
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;data
op_eq
l_int|NULL
)paren
(brace
id|tasklet_enable
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|entry-&gt;data
comma
id|skb_data
comma
id|skb_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_len
OL
id|tx_len
)paren
id|memset
c_func
(paren
id|entry-&gt;data
op_plus
id|skb_len
comma
l_int|0x00
comma
id|tx_len
op_minus
id|skb_len
)paren
suffix:semicolon
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|buffer
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|entry-&gt;data
comma
id|tx_len
comma
id|FORE200E_DMA_TODEVICE
)paren
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|buffer
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|skb_data
comma
id|tx_len
comma
id|FORE200E_DMA_TODEVICE
)paren
suffix:semicolon
)brace
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|length
op_assign
id|tx_len
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|txq-&gt;head
comma
id|QUEUE_SIZE_TX
)paren
suffix:semicolon
id|txq-&gt;txing
op_increment
suffix:semicolon
id|tasklet_enable
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
)paren
suffix:semicolon
multiline_comment|/* ensure DMA synchronisation */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_sync
c_func
(paren
id|fore200e
comma
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|buffer
comma
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|length
comma
id|FORE200E_DMA_TODEVICE
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;tx on %d.%d.%d:%d, len = %u (%u)&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
comma
id|tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|length
comma
id|skb_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_len
OL
id|fore200e_vcc-&gt;tx_min_pdu
)paren
id|fore200e_vcc-&gt;tx_min_pdu
op_assign
id|skb_len
suffix:semicolon
r_if
c_cond
(paren
id|skb_len
OG
id|fore200e_vcc-&gt;tx_max_pdu
)paren
id|fore200e_vcc-&gt;tx_max_pdu
op_assign
id|skb_len
suffix:semicolon
id|entry-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;skb
op_assign
id|skb
suffix:semicolon
multiline_comment|/* set tx rate control information */
id|tpd-&gt;rate.data_cells
op_assign
id|fore200e_vcc-&gt;rate.data_cells
suffix:semicolon
id|tpd-&gt;rate.idle_cells
op_assign
id|fore200e_vcc-&gt;rate.idle_cells
suffix:semicolon
r_if
c_cond
(paren
id|cell_header
)paren
(brace
id|tpd-&gt;atm_header.clp
op_assign
(paren
op_star
id|cell_header
op_amp
id|ATM_HDR_CLP
)paren
suffix:semicolon
id|tpd-&gt;atm_header.plt
op_assign
(paren
op_star
id|cell_header
op_amp
id|ATM_HDR_PTI_MASK
)paren
op_rshift
id|ATM_HDR_PTI_SHIFT
suffix:semicolon
id|tpd-&gt;atm_header.vci
op_assign
(paren
op_star
id|cell_header
op_amp
id|ATM_HDR_VCI_MASK
)paren
op_rshift
id|ATM_HDR_VCI_SHIFT
suffix:semicolon
id|tpd-&gt;atm_header.vpi
op_assign
(paren
op_star
id|cell_header
op_amp
id|ATM_HDR_VPI_MASK
)paren
op_rshift
id|ATM_HDR_VPI_SHIFT
suffix:semicolon
id|tpd-&gt;atm_header.gfc
op_assign
(paren
op_star
id|cell_header
op_amp
id|ATM_HDR_GFC_MASK
)paren
op_rshift
id|ATM_HDR_GFC_SHIFT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* set the ATM header, common to all cells conveying the PDU */
id|tpd-&gt;atm_header.clp
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;atm_header.plt
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;atm_header.vci
op_assign
id|vcc-&gt;vci
suffix:semicolon
id|tpd-&gt;atm_header.vpi
op_assign
id|vcc-&gt;vpi
suffix:semicolon
id|tpd-&gt;atm_header.gfc
op_assign
l_int|0
suffix:semicolon
)brace
id|tpd-&gt;spec.length
op_assign
id|tx_len
suffix:semicolon
id|tpd-&gt;spec.nseg
op_assign
l_int|1
suffix:semicolon
id|tpd-&gt;spec.aal
op_assign
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
macro_line|#ifdef FORE200E_SYNC_SEND
id|tpd-&gt;spec.intr
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|tpd-&gt;spec.intr
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|tpd_haddr.size
op_assign
r_sizeof
(paren
r_struct
id|tpd
)paren
op_div
l_int|32
suffix:semicolon
multiline_comment|/* size is expressed in 32 byte blocks */
id|tpd_haddr.pad
op_assign
l_int|0
suffix:semicolon
id|tpd_haddr.haddr
op_assign
id|entry-&gt;tpd_dma
op_rshift
l_int|5
suffix:semicolon
multiline_comment|/* shift the address, as we are in a bitfield */
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|tpd_haddr
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;tpd_haddr
)paren
suffix:semicolon
macro_line|#ifdef FORE200E_SYNC_SEND
(brace
r_int
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|10
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|entry-&gt;tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|buffer
comma
id|entry-&gt;tpd-&gt;tsd
(braket
l_int|0
)braket
dot
id|length
comma
id|FORE200E_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* free tmp copy of misaligned data */
r_if
c_cond
(paren
id|entry-&gt;data
)paren
id|kfree
c_func
(paren
id|entry-&gt;data
)paren
suffix:semicolon
multiline_comment|/* notify tx completion */
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;synchronous tx on %d:%d:%d failed&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|entry-&gt;vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|entry-&gt;vcc-&gt;stats-&gt;tx
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|3
comma
l_string|&quot;synchronous tx on %d:%d:%d succeeded&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_getstats
id|fore200e_getstats
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|host_cmdq_entry
op_star
id|entry
op_assign
op_amp
id|cmdq-&gt;host_entry
(braket
id|cmdq-&gt;head
)braket
suffix:semicolon
r_struct
id|stats_opcode
id|opcode
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|u32
id|stats_dma_addr
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;stats
op_eq
l_int|NULL
)paren
(brace
id|fore200e-&gt;stats
op_assign
id|fore200e_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|stats
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;stats
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|stats_dma_addr
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|fore200e-&gt;stats
comma
r_sizeof
(paren
r_struct
id|stats
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|cmdq-&gt;head
comma
id|QUEUE_SIZE_CMD
)paren
suffix:semicolon
id|opcode.opcode
op_assign
id|OPCODE_GET_STATS
suffix:semicolon
id|opcode.pad
op_assign
l_int|0
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|stats_dma_addr
comma
op_amp
id|entry-&gt;cp_entry-&gt;cmd.stats_block.stats_haddr
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.stats_block.opcode
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|400
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|stats_dma_addr
comma
r_sizeof
(paren
r_struct
id|stats
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to get statistics from device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_getsockopt
id|fore200e_getsockopt
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
singleline_comment|// struct fore200e* fore200e = FORE200E_DEV(vcc-&gt;dev);
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;getsockopt %d.%d.%d, level = %d, optname = 0x%x, optval = 0x%p, optlen = %d&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_setsockopt
id|fore200e_setsockopt
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
singleline_comment|// struct fore200e* fore200e = FORE200E_DEV(vcc-&gt;dev);
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;setsockopt %d.%d.%d, level = %d, optname = 0x%x, optval = 0x%p, optlen = %d&bslash;n&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#if 0 /* currently unused */
r_static
r_int
id|fore200e_get_oc3
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|oc3_regs
op_star
id|regs
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|host_cmdq_entry
op_star
id|entry
op_assign
op_amp
id|cmdq-&gt;host_entry
(braket
id|cmdq-&gt;head
)braket
suffix:semicolon
r_struct
id|oc3_opcode
id|opcode
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|u32
id|oc3_regs_dma_addr
suffix:semicolon
id|oc3_regs_dma_addr
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_map
c_func
(paren
id|fore200e
comma
id|regs
comma
r_sizeof
(paren
r_struct
id|oc3_regs
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|cmdq-&gt;head
comma
id|QUEUE_SIZE_CMD
)paren
suffix:semicolon
id|opcode.opcode
op_assign
id|OPCODE_GET_OC3
suffix:semicolon
id|opcode.reg
op_assign
l_int|0
suffix:semicolon
id|opcode.value
op_assign
l_int|0
suffix:semicolon
id|opcode.mask
op_assign
l_int|0
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|oc3_regs_dma_addr
comma
op_amp
id|entry-&gt;cp_entry-&gt;cmd.oc3_block.regs_haddr
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.oc3_block.opcode
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|400
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_unmap
c_func
(paren
id|fore200e
comma
id|oc3_regs_dma_addr
comma
r_sizeof
(paren
r_struct
id|oc3_regs
)paren
comma
id|FORE200E_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to get OC-3 regs of device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|fore200e_set_oc3
id|fore200e_set_oc3
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
id|u32
id|reg
comma
id|u32
id|value
comma
id|u32
id|mask
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|host_cmdq_entry
op_star
id|entry
op_assign
op_amp
id|cmdq-&gt;host_entry
(braket
id|cmdq-&gt;head
)braket
suffix:semicolon
r_struct
id|oc3_opcode
id|opcode
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|FORE200E_NEXT_ENTRY
c_func
(paren
id|cmdq-&gt;head
comma
id|QUEUE_SIZE_CMD
)paren
suffix:semicolon
id|opcode.opcode
op_assign
id|OPCODE_SET_OC3
suffix:semicolon
id|opcode.reg
op_assign
id|reg
suffix:semicolon
id|opcode.value
op_assign
id|value
suffix:semicolon
id|opcode.mask
op_assign
id|mask
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
l_int|0
comma
op_amp
id|entry-&gt;cp_entry-&gt;cmd.oc3_block.regs_haddr
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_PENDING
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|opcode
comma
(paren
id|u32
op_star
)paren
op_amp
id|entry-&gt;cp_entry-&gt;cmd.oc3_block.opcode
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_poll
c_func
(paren
id|fore200e
comma
id|entry-&gt;status
comma
id|STATUS_COMPLETE
comma
l_int|400
)paren
suffix:semicolon
op_star
id|entry-&gt;status
op_assign
id|STATUS_FREE
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to set OC-3 reg 0x%02x of device %s&bslash;n&quot;
comma
id|reg
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_setloop
id|fore200e_setloop
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_int
id|loop_mode
)paren
(brace
id|u32
id|mct_value
comma
id|mct_mask
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_switch
c_cond
(paren
id|loop_mode
)paren
(brace
r_case
id|ATM_LM_NONE
suffix:colon
id|mct_value
op_assign
l_int|0
suffix:semicolon
id|mct_mask
op_assign
id|SUNI_MCT_DLE
op_or
id|SUNI_MCT_LLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_LM_LOC_PHY
suffix:colon
id|mct_value
op_assign
id|mct_mask
op_assign
id|SUNI_MCT_DLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_LM_RMT_PHY
suffix:colon
id|mct_value
op_assign
id|mct_mask
op_assign
id|SUNI_MCT_LLE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|error
op_assign
id|fore200e_set_oc3
c_func
(paren
id|fore200e
comma
id|SUNI_MCT
comma
id|mct_value
comma
id|mct_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|fore200e-&gt;loop_mode
op_assign
id|loop_mode
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|fore200e_swap
id|fore200e_swap
c_func
(paren
r_int
r_int
id|in
)paren
(brace
macro_line|#if defined(__LITTLE_ENDIAN)
r_return
id|swab32
c_func
(paren
id|in
)paren
suffix:semicolon
macro_line|#else
r_return
id|in
suffix:semicolon
macro_line|#endif
)brace
r_static
r_int
DECL|function|fore200e_fetch_stats
id|fore200e_fetch_stats
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_struct
id|sonet_stats
op_star
id|arg
)paren
(brace
r_struct
id|sonet_stats
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_getstats
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|tmp.section_bip
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.section_bip8_errors
)paren
suffix:semicolon
id|tmp.line_bip
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.line_bip24_errors
)paren
suffix:semicolon
id|tmp.path_bip
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.path_bip8_errors
)paren
suffix:semicolon
id|tmp.line_febe
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.line_febe_errors
)paren
suffix:semicolon
id|tmp.path_febe
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.path_febe_errors
)paren
suffix:semicolon
id|tmp.corr_hcs
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.corr_hcs_errors
)paren
suffix:semicolon
id|tmp.uncorr_hcs
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.ucorr_hcs_errors
)paren
suffix:semicolon
id|tmp.tx_cells
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal0.cells_transmitted
)paren
op_plus
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_transmitted
)paren
op_plus
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cells_transmitted
)paren
suffix:semicolon
id|tmp.rx_cells
op_assign
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal0.cells_received
)paren
op_plus
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_received
)paren
op_plus
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cells_received
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
r_return
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|tmp
comma
r_sizeof
(paren
r_struct
id|sonet_stats
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fore200e_ioctl
id|fore200e_ioctl
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;ioctl cmd = 0x%x (%u), arg = 0x%p (%lu)&bslash;n&quot;
comma
id|cmd
comma
id|cmd
comma
id|arg
comma
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SONET_GETSTAT
suffix:colon
r_return
id|fore200e_fetch_stats
c_func
(paren
id|fore200e
comma
(paren
r_struct
id|sonet_stats
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SONET_GETDIAG
suffix:colon
r_return
id|put_user
c_func
(paren
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|ATM_SETLOOP
suffix:colon
r_return
id|fore200e_setloop
c_func
(paren
id|fore200e
comma
(paren
r_int
)paren
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
r_case
id|ATM_GETLOOP
suffix:colon
r_return
id|put_user
c_func
(paren
id|fore200e-&gt;loop_mode
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|ATM_QUERYLOOP
suffix:colon
r_return
id|put_user
c_func
(paren
id|ATM_LM_LOC_PHY
op_or
id|ATM_LM_RMT_PHY
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* not implemented */
)brace
r_static
r_int
DECL|function|fore200e_change_qos
id|fore200e_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
comma
r_int
id|flags
)paren
(brace
r_struct
id|fore200e_vcc
op_star
id|fore200e_vcc
op_assign
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;change_qos %d.%d.%d, &quot;
l_string|&quot;(tx: cl=%s, pcr=%d-%d, cdv=%d, max_sdu=%d; &quot;
l_string|&quot;rx: cl=%s, pcr=%d-%d, cdv=%d, max_sdu=%d), flags = 0x%x&bslash;n&quot;
l_string|&quot;available_cell_rate = %u&quot;
comma
id|vcc-&gt;itf
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_traffic_class
(braket
id|qos-&gt;txtp.traffic_class
)braket
comma
id|qos-&gt;txtp.min_pcr
comma
id|qos-&gt;txtp.max_pcr
comma
id|qos-&gt;txtp.max_cdv
comma
id|qos-&gt;txtp.max_sdu
comma
id|fore200e_traffic_class
(braket
id|qos-&gt;rxtp.traffic_class
)braket
comma
id|qos-&gt;rxtp.min_pcr
comma
id|qos-&gt;rxtp.max_pcr
comma
id|qos-&gt;rxtp.max_cdv
comma
id|qos-&gt;rxtp.max_sdu
comma
id|flags
comma
id|fore200e-&gt;available_cell_rate
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|qos-&gt;txtp.traffic_class
op_eq
id|ATM_CBR
)paren
op_logical_and
(paren
id|qos-&gt;txtp.max_pcr
OG
l_int|0
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;available_cell_rate
op_plus
id|vcc-&gt;qos.txtp.max_pcr
OL
id|qos-&gt;txtp.max_pcr
)paren
(brace
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|fore200e-&gt;available_cell_rate
op_add_assign
id|vcc-&gt;qos.txtp.max_pcr
suffix:semicolon
id|fore200e-&gt;available_cell_rate
op_sub_assign
id|qos-&gt;txtp.max_pcr
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|vcc-&gt;qos
comma
id|qos
comma
r_sizeof
(paren
r_struct
id|atm_qos
)paren
)paren
suffix:semicolon
multiline_comment|/* update rate control parameters */
id|fore200e_rate_ctrl
c_func
(paren
id|qos
comma
op_amp
id|fore200e_vcc-&gt;rate
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_irq_request
id|fore200e_irq_request
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|fore200e-&gt;irq
comma
id|fore200e_interrupt
comma
id|SA_SHIRQ
comma
id|fore200e-&gt;name
comma
id|fore200e-&gt;atm_dev
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to reserve IRQ %s for device %s&bslash;n&quot;
comma
id|fore200e_irq_itoa
c_func
(paren
id|fore200e-&gt;irq
)paren
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;IRQ %s reserved for device %s&bslash;n&quot;
comma
id|fore200e_irq_itoa
c_func
(paren
id|fore200e-&gt;irq
)paren
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|fore200e-&gt;tasklet
comma
id|fore200e_tasklet
comma
(paren
r_int
r_int
)paren
id|fore200e
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_IRQ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_get_esi
id|fore200e_get_esi
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|prom_data
op_star
id|prom
op_assign
id|fore200e_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|prom_data
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_int
id|ok
comma
id|i
suffix:semicolon
id|ok
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|prom_read
c_func
(paren
id|fore200e
comma
id|prom
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s, rev. %c, S/N: %d, ESI: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
(paren
id|prom-&gt;hw_revision
op_amp
l_int|0xFF
)paren
op_plus
l_char|&squot;@&squot;
comma
multiline_comment|/* probably meaningless with SBA boards */
id|prom-&gt;serial_number
op_amp
l_int|0xFFFF
comma
id|prom-&gt;mac_addr
(braket
l_int|2
)braket
comma
id|prom-&gt;mac_addr
(braket
l_int|3
)braket
comma
id|prom-&gt;mac_addr
(braket
l_int|4
)braket
comma
id|prom-&gt;mac_addr
(braket
l_int|5
)braket
comma
id|prom-&gt;mac_addr
(braket
l_int|6
)braket
comma
id|prom-&gt;mac_addr
(braket
l_int|7
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ESI_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fore200e-&gt;esi
(braket
id|i
)braket
op_assign
id|fore200e-&gt;atm_dev-&gt;esi
(braket
id|i
)braket
op_assign
id|prom-&gt;mac_addr
(braket
id|i
op_plus
l_int|2
)braket
suffix:semicolon
)brace
id|fore200e_kfree
c_func
(paren
id|prom
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_alloc_rx_buf
id|fore200e_alloc_rx_buf
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|scheme
comma
id|magn
comma
id|nbr
comma
id|size
comma
id|i
suffix:semicolon
r_struct
id|host_bsq
op_star
id|bsq
suffix:semicolon
r_struct
id|buffer
op_star
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
(brace
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
(brace
id|bsq
op_assign
op_amp
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
id|nbr
op_assign
id|fore200e_rx_buf_nbr
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
id|size
op_assign
id|fore200e_rx_buf_size
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;rx buffers %d / %d are being allocated&bslash;n&quot;
comma
id|scheme
comma
id|magn
)paren
suffix:semicolon
multiline_comment|/* allocate the array of receive buffers */
id|buffer
op_assign
id|bsq-&gt;buffer
op_assign
id|fore200e_kmalloc
c_func
(paren
id|nbr
op_star
r_sizeof
(paren
r_struct
id|buffer
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbr
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buffer
(braket
id|i
)braket
dot
id|scheme
op_assign
id|scheme
suffix:semicolon
id|buffer
(braket
id|i
)braket
dot
id|magn
op_assign
id|magn
suffix:semicolon
multiline_comment|/* allocate the receive buffer body */
r_if
c_cond
(paren
id|fore200e_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|buffer
(braket
id|i
)braket
dot
id|data
comma
id|size
comma
id|fore200e-&gt;bus-&gt;buffer_alignment
comma
id|FORE200E_DMA_FROMDEVICE
)paren
OL
l_int|0
)paren
(brace
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
id|fore200e_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|buffer
(braket
op_decrement
id|i
)braket
dot
id|data
)paren
suffix:semicolon
id|fore200e_kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
multiline_comment|/* set next free buffer index */
id|bsq-&gt;free
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_ALLOC_BUF
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_init_bs_queue
id|fore200e_init_bs_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|scheme
comma
id|magn
comma
id|i
suffix:semicolon
r_struct
id|host_bsq
op_star
id|bsq
suffix:semicolon
r_struct
id|cp_bsq_entry
op_star
id|cp_entry
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
(brace
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;buffer supply queue %d / %d is being initialized&bslash;n&quot;
comma
id|scheme
comma
id|magn
)paren
suffix:semicolon
id|bsq
op_assign
op_amp
id|fore200e-&gt;host_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
multiline_comment|/* allocate and align the array of status words */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|bsq-&gt;status
comma
r_sizeof
(paren
r_enum
id|status
)paren
comma
id|QUEUE_SIZE_BS
comma
id|fore200e-&gt;bus-&gt;status_alignment
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* allocate and align the array of receive buffer descriptors */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|bsq-&gt;rbd_block
comma
r_sizeof
(paren
r_struct
id|rbd_block
)paren
comma
id|QUEUE_SIZE_BS
comma
id|fore200e-&gt;bus-&gt;descr_alignment
)paren
OL
l_int|0
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|bsq-&gt;status
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* get the base address of the cp resident buffer supply queue entries */
id|cp_entry
op_assign
(paren
r_struct
id|cp_bsq_entry
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;cp_bsq
(braket
id|scheme
)braket
(braket
id|magn
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* fill the host resident and cp resident buffer supply queue entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_SIZE_BS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bsq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|FORE200E_INDEX
c_func
(paren
id|bsq-&gt;status.align_addr
comma
r_enum
id|status
comma
id|i
)paren
suffix:semicolon
id|bsq-&gt;host_entry
(braket
id|i
)braket
dot
id|rbd_block
op_assign
id|FORE200E_INDEX
c_func
(paren
id|bsq-&gt;rbd_block.align_addr
comma
r_struct
id|rbd_block
comma
id|i
)paren
suffix:semicolon
id|bsq-&gt;host_entry
(braket
id|i
)braket
dot
id|rbd_block_dma
op_assign
id|FORE200E_DMA_INDEX
c_func
(paren
id|bsq-&gt;rbd_block.dma_addr
comma
r_struct
id|rbd_block
comma
id|i
)paren
suffix:semicolon
id|bsq-&gt;host_entry
(braket
id|i
)braket
dot
id|cp_entry
op_assign
op_amp
id|cp_entry
(braket
id|i
)braket
suffix:semicolon
op_star
id|bsq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_DMA_INDEX
c_func
(paren
id|bsq-&gt;status.dma_addr
comma
r_enum
id|status
comma
id|i
)paren
comma
op_amp
id|cp_entry
(braket
id|i
)braket
dot
id|status_haddr
)paren
suffix:semicolon
)brace
)brace
)brace
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_INIT_BSQ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_init_rx_queue
id|fore200e_init_rx_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_rxq
op_star
id|rxq
op_assign
op_amp
id|fore200e-&gt;host_rxq
suffix:semicolon
r_struct
id|cp_rxq_entry
op_star
id|cp_entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;receive queue is being initialized&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* allocate and align the array of status words */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|rxq-&gt;status
comma
r_sizeof
(paren
r_enum
id|status
)paren
comma
id|QUEUE_SIZE_RX
comma
id|fore200e-&gt;bus-&gt;status_alignment
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* allocate and align the array of receive PDU descriptors */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|rxq-&gt;rpd
comma
r_sizeof
(paren
r_struct
id|rpd
)paren
comma
id|QUEUE_SIZE_RX
comma
id|fore200e-&gt;bus-&gt;descr_alignment
)paren
OL
l_int|0
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|rxq-&gt;status
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* get the base address of the cp resident rx queue entries */
id|cp_entry
op_assign
(paren
r_struct
id|cp_rxq_entry
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;cp_rxq
)paren
)paren
suffix:semicolon
multiline_comment|/* fill the host resident and cp resident rx entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_SIZE_RX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rxq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|FORE200E_INDEX
c_func
(paren
id|rxq-&gt;status.align_addr
comma
r_enum
id|status
comma
id|i
)paren
suffix:semicolon
id|rxq-&gt;host_entry
(braket
id|i
)braket
dot
id|rpd
op_assign
id|FORE200E_INDEX
c_func
(paren
id|rxq-&gt;rpd.align_addr
comma
r_struct
id|rpd
comma
id|i
)paren
suffix:semicolon
id|rxq-&gt;host_entry
(braket
id|i
)braket
dot
id|rpd_dma
op_assign
id|FORE200E_DMA_INDEX
c_func
(paren
id|rxq-&gt;rpd.dma_addr
comma
r_struct
id|rpd
comma
id|i
)paren
suffix:semicolon
id|rxq-&gt;host_entry
(braket
id|i
)braket
dot
id|cp_entry
op_assign
op_amp
id|cp_entry
(braket
id|i
)braket
suffix:semicolon
op_star
id|rxq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_DMA_INDEX
c_func
(paren
id|rxq-&gt;status.dma_addr
comma
r_enum
id|status
comma
id|i
)paren
comma
op_amp
id|cp_entry
(braket
id|i
)braket
dot
id|status_haddr
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_DMA_INDEX
c_func
(paren
id|rxq-&gt;rpd.dma_addr
comma
r_struct
id|rpd
comma
id|i
)paren
comma
op_amp
id|cp_entry
(braket
id|i
)braket
dot
id|rpd_haddr
)paren
suffix:semicolon
)brace
multiline_comment|/* set the head entry of the queue */
id|rxq-&gt;head
op_assign
l_int|0
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_INIT_RXQ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_init_tx_queue
id|fore200e_init_tx_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_txq
op_star
id|txq
op_assign
op_amp
id|fore200e-&gt;host_txq
suffix:semicolon
r_struct
id|cp_txq_entry
op_star
id|cp_entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;transmit queue is being initialized&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* allocate and align the array of status words */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|txq-&gt;status
comma
r_sizeof
(paren
r_enum
id|status
)paren
comma
id|QUEUE_SIZE_TX
comma
id|fore200e-&gt;bus-&gt;status_alignment
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* allocate and align the array of transmit PDU descriptors */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|txq-&gt;tpd
comma
r_sizeof
(paren
r_struct
id|tpd
)paren
comma
id|QUEUE_SIZE_TX
comma
id|fore200e-&gt;bus-&gt;descr_alignment
)paren
OL
l_int|0
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_free
c_func
(paren
id|fore200e
comma
op_amp
id|txq-&gt;status
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* get the base address of the cp resident tx queue entries */
id|cp_entry
op_assign
(paren
r_struct
id|cp_txq_entry
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;cp_txq
)paren
)paren
suffix:semicolon
multiline_comment|/* fill the host resident and cp resident tx entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_SIZE_TX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|txq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|FORE200E_INDEX
c_func
(paren
id|txq-&gt;status.align_addr
comma
r_enum
id|status
comma
id|i
)paren
suffix:semicolon
id|txq-&gt;host_entry
(braket
id|i
)braket
dot
id|tpd
op_assign
id|FORE200E_INDEX
c_func
(paren
id|txq-&gt;tpd.align_addr
comma
r_struct
id|tpd
comma
id|i
)paren
suffix:semicolon
id|txq-&gt;host_entry
(braket
id|i
)braket
dot
id|tpd_dma
op_assign
id|FORE200E_DMA_INDEX
c_func
(paren
id|txq-&gt;tpd.dma_addr
comma
r_struct
id|tpd
comma
id|i
)paren
suffix:semicolon
id|txq-&gt;host_entry
(braket
id|i
)braket
dot
id|cp_entry
op_assign
op_amp
id|cp_entry
(braket
id|i
)braket
suffix:semicolon
op_star
id|txq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_DMA_INDEX
c_func
(paren
id|txq-&gt;status.dma_addr
comma
r_enum
id|status
comma
id|i
)paren
comma
op_amp
id|cp_entry
(braket
id|i
)braket
dot
id|status_haddr
)paren
suffix:semicolon
multiline_comment|/* although there is a one-to-one mapping of tx queue entries and tpds,&n;&t;   we do not write here the DMA (physical) base address of each tpd into&n;&t;   the related cp resident entry, because the cp relies on this write&n;&t;   operation to detect that a new pdu has been submitted for tx */
)brace
multiline_comment|/* set the head entry of the queue */
id|txq-&gt;head
op_assign
l_int|0
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_INIT_TXQ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_init_cmd_queue
id|fore200e_init_cmd_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|host_cmdq
op_star
id|cmdq
op_assign
op_amp
id|fore200e-&gt;host_cmdq
suffix:semicolon
r_struct
id|cp_cmdq_entry
op_star
id|cp_entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;command queue is being initialized&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* allocate and align the array of status words */
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|dma_chunk_alloc
c_func
(paren
id|fore200e
comma
op_amp
id|cmdq-&gt;status
comma
r_sizeof
(paren
r_enum
id|status
)paren
comma
id|QUEUE_SIZE_CMD
comma
id|fore200e-&gt;bus-&gt;status_alignment
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* get the base address of the cp resident cmd queue entries */
id|cp_entry
op_assign
(paren
r_struct
id|cp_cmdq_entry
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;cp_cmdq
)paren
)paren
suffix:semicolon
multiline_comment|/* fill the host resident and cp resident cmd entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QUEUE_SIZE_CMD
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cmdq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|FORE200E_INDEX
c_func
(paren
id|cmdq-&gt;status.align_addr
comma
r_enum
id|status
comma
id|i
)paren
suffix:semicolon
id|cmdq-&gt;host_entry
(braket
id|i
)braket
dot
id|cp_entry
op_assign
op_amp
id|cp_entry
(braket
id|i
)braket
suffix:semicolon
op_star
id|cmdq-&gt;host_entry
(braket
id|i
)braket
dot
id|status
op_assign
id|STATUS_FREE
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_DMA_INDEX
c_func
(paren
id|cmdq-&gt;status.dma_addr
comma
r_enum
id|status
comma
id|i
)paren
comma
op_amp
id|cp_entry
(braket
id|i
)braket
dot
id|status_haddr
)paren
suffix:semicolon
)brace
multiline_comment|/* set the head entry of the queue */
id|cmdq-&gt;head
op_assign
l_int|0
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_INIT_CMDQ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|fore200e_param_bs_queue
id|fore200e_param_bs_queue
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_enum
id|buffer_scheme
id|scheme
comma
r_enum
id|buffer_magn
id|magn
comma
r_int
id|queue_length
comma
r_int
id|pool_size
comma
r_int
id|supply_blksize
)paren
(brace
r_struct
id|bs_spec
op_star
id|bs_spec
op_assign
op_amp
id|fore200e-&gt;cp_queues-&gt;init.bs_spec
(braket
id|scheme
)braket
(braket
id|magn
)braket
suffix:semicolon
multiline_comment|/* dumb value; the firmware doesn&squot;t allow us to activate a VC while&n;       selecting a buffer scheme with zero-sized rbd pools */
r_if
c_cond
(paren
id|pool_size
op_eq
l_int|0
)paren
id|pool_size
op_assign
l_int|64
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|queue_length
comma
op_amp
id|bs_spec-&gt;queue_length
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|fore200e_rx_buf_size
(braket
id|scheme
)braket
(braket
id|magn
)braket
comma
op_amp
id|bs_spec-&gt;buffer_size
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|pool_size
comma
op_amp
id|bs_spec-&gt;pool_size
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|supply_blksize
comma
op_amp
id|bs_spec-&gt;supply_blksize
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_initialize
id|fore200e_initialize
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|cp_queues
op_star
id|cpq
suffix:semicolon
r_int
id|ok
comma
id|scheme
comma
id|magn
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s being initialized&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|fore200e-&gt;rate_sf
)paren
suffix:semicolon
id|cpq
op_assign
id|fore200e-&gt;cp_queues
op_assign
(paren
r_struct
id|cp_queues
op_star
)paren
(paren
id|fore200e-&gt;virt_base
op_plus
id|FORE200E_CP_QUEUES_OFFSET
)paren
suffix:semicolon
multiline_comment|/* enable cp to host interrupts */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
l_int|1
comma
op_amp
id|cpq-&gt;imask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;bus-&gt;irq_enable
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|irq_enable
c_func
(paren
id|fore200e
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|NBR_CONNECT
comma
op_amp
id|cpq-&gt;init.num_connect
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|QUEUE_SIZE_CMD
comma
op_amp
id|cpq-&gt;init.cmd_queue_len
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|QUEUE_SIZE_RX
comma
op_amp
id|cpq-&gt;init.rx_queue_len
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|QUEUE_SIZE_TX
comma
op_amp
id|cpq-&gt;init.tx_queue_len
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|RSD_EXTENSION
comma
op_amp
id|cpq-&gt;init.rsd_extension
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|TSD_EXTENSION
comma
op_amp
id|cpq-&gt;init.tsd_extension
)paren
suffix:semicolon
r_for
c_loop
(paren
id|scheme
op_assign
l_int|0
suffix:semicolon
id|scheme
OL
id|BUFFER_SCHEME_NBR
suffix:semicolon
id|scheme
op_increment
)paren
r_for
c_loop
(paren
id|magn
op_assign
l_int|0
suffix:semicolon
id|magn
OL
id|BUFFER_MAGN_NBR
suffix:semicolon
id|magn
op_increment
)paren
id|fore200e_param_bs_queue
c_func
(paren
id|fore200e
comma
id|scheme
comma
id|magn
comma
id|QUEUE_SIZE_BS
comma
id|fore200e_rx_buf_nbr
(braket
id|scheme
)braket
(braket
id|magn
)braket
comma
id|RBD_BLK_SIZE
)paren
suffix:semicolon
multiline_comment|/* issue the initialize command */
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|STATUS_PENDING
comma
op_amp
id|cpq-&gt;init.status
)paren
suffix:semicolon
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|OPCODE_INITIALIZE
comma
op_amp
id|cpq-&gt;init.opcode
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_io_poll
c_func
(paren
id|fore200e
comma
op_amp
id|cpq-&gt;init.status
comma
id|STATUS_COMPLETE
comma
l_int|3000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s initialization failed&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s initialized&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_INITIALIZE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|fore200e_monitor_putc
id|fore200e_monitor_putc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_char
id|c
)paren
(brace
r_struct
id|cp_monitor
op_star
id|monitor
op_assign
id|fore200e-&gt;cp_monitor
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;%c&quot;
comma
id|c
)paren
suffix:semicolon
macro_line|#endif
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
(paren
(paren
id|u32
)paren
id|c
)paren
op_or
id|FORE200E_CP_MONITOR_UART_AVAIL
comma
op_amp
id|monitor-&gt;soft_uart.send
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_monitor_getc
id|fore200e_monitor_getc
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|cp_monitor
op_star
id|monitor
op_assign
id|fore200e-&gt;cp_monitor
suffix:semicolon
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|MSECS
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_int
id|c
suffix:semicolon
r_while
c_loop
(paren
id|jiffies
OL
id|timeout
)paren
(brace
id|c
op_assign
(paren
r_int
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|monitor-&gt;soft_uart.recv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_amp
id|FORE200E_CP_MONITOR_UART_AVAIL
)paren
(brace
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|FORE200E_CP_MONITOR_UART_FREE
comma
op_amp
id|monitor-&gt;soft_uart.recv
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;%c&quot;
comma
id|c
op_amp
l_int|0xFF
)paren
suffix:semicolon
macro_line|#endif
r_return
id|c
op_amp
l_int|0xFF
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|fore200e_monitor_puts
id|fore200e_monitor_puts
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
comma
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
op_star
id|str
)paren
(brace
multiline_comment|/* the i960 monitor doesn&squot;t accept any new character if it has something to say */
r_while
c_loop
(paren
id|fore200e_monitor_getc
c_func
(paren
id|fore200e
)paren
op_ge
l_int|0
)paren
suffix:semicolon
id|fore200e_monitor_putc
c_func
(paren
id|fore200e
comma
op_star
id|str
op_increment
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|fore200e_monitor_getc
c_func
(paren
id|fore200e
)paren
op_ge
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_start_fw
id|fore200e_start_fw
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_int
id|ok
suffix:semicolon
r_char
id|cmd
(braket
l_int|48
)braket
suffix:semicolon
r_struct
id|fw_header
op_star
id|fw_header
op_assign
(paren
r_struct
id|fw_header
op_star
)paren
id|fore200e-&gt;bus-&gt;fw_data
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s firmware being started&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|cmd
comma
l_string|&quot;&bslash;rgo %x&bslash;r&quot;
comma
id|le32_to_cpu
c_func
(paren
id|fw_header-&gt;start_offset
)paren
)paren
suffix:semicolon
id|fore200e_monitor_puts
c_func
(paren
id|fore200e
comma
id|cmd
)paren
suffix:semicolon
id|ok
op_assign
id|fore200e_io_poll
c_func
(paren
id|fore200e
comma
op_amp
id|fore200e-&gt;cp_monitor-&gt;bstat
comma
id|BSTAT_CP_RUNNING
comma
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s firmware didn&squot;t start&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s firmware started&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_START_FW
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_load_fw
id|fore200e_load_fw
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
id|u32
op_star
id|fw_data
op_assign
(paren
id|u32
op_star
)paren
id|fore200e-&gt;bus-&gt;fw_data
suffix:semicolon
id|u32
id|fw_size
op_assign
(paren
id|u32
)paren
op_star
id|fore200e-&gt;bus-&gt;fw_size
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
r_struct
id|fw_header
op_star
id|fw_header
op_assign
(paren
r_struct
id|fw_header
op_star
)paren
id|fw_data
suffix:semicolon
id|u32
op_star
id|load_addr
op_assign
id|fore200e-&gt;virt_base
op_plus
id|le32_to_cpu
c_func
(paren
id|fw_header-&gt;load_offset
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s firmware being loaded at 0x%p (%d words)&bslash;n&quot;
comma
id|fore200e-&gt;name
comma
id|load_addr
comma
id|fw_size
)paren
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|fw_header-&gt;magic
)paren
op_ne
id|FW_HEADER_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;corrupted %s firmware image&bslash;n&quot;
comma
id|fore200e-&gt;bus-&gt;model_name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
suffix:semicolon
id|fw_size
op_decrement
suffix:semicolon
id|fw_data
op_increment
comma
id|load_addr
op_increment
)paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|write
c_func
(paren
id|le32_to_cpu
c_func
(paren
op_star
id|fw_data
)paren
comma
id|load_addr
)paren
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_LOAD_FW
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_register
id|fore200e_register
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_struct
id|atm_dev
op_star
id|atm_dev
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;device %s being registered&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
id|atm_dev
op_assign
id|atm_dev_register
c_func
(paren
id|fore200e-&gt;bus-&gt;proc_name
comma
op_amp
id|fore200e_ops
comma
op_minus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;unable to register device %s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|FORE200E_DEV
c_func
(paren
id|atm_dev
)paren
op_assign
id|fore200e
suffix:semicolon
id|fore200e-&gt;atm_dev
op_assign
id|atm_dev
suffix:semicolon
id|atm_dev-&gt;ci_range.vpi_bits
op_assign
l_int|8
suffix:semicolon
id|atm_dev-&gt;ci_range.vci_bits
op_assign
l_int|10
suffix:semicolon
id|fore200e-&gt;available_cell_rate
op_assign
id|ATM_OC3_PCR
suffix:semicolon
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_REGISTER
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|fore200e_init
id|fore200e_init
c_func
(paren
r_struct
id|fore200e
op_star
id|fore200e
)paren
(brace
r_if
c_cond
(paren
id|fore200e_register
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|configure
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|map
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_reset
c_func
(paren
id|fore200e
comma
l_int|1
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_load_fw
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_start_fw
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_initialize
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_init_cmd_queue
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_init_tx_queue
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_init_rx_queue
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_init_bs_queue
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_alloc_rx_buf
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_get_esi
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_irq_request
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|fore200e_supply
c_func
(paren
id|fore200e
)paren
suffix:semicolon
multiline_comment|/* all done, board initialization is now complete */
id|fore200e-&gt;state
op_assign
id|FORE200E_STATE_COMPLETE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
id|__init
DECL|function|fore200e_detect
id|fore200e_detect
c_func
(paren
r_void
)paren
(brace
r_const
r_struct
id|fore200e_bus
op_star
id|bus
suffix:semicolon
r_struct
id|fore200e
op_star
id|fore200e
suffix:semicolon
r_int
id|index
comma
id|link
suffix:semicolon
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;FORE Systems 200E-series driver - version &quot;
id|FORE200E_VERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* for each configured bus interface */
r_for
c_loop
(paren
id|link
op_assign
l_int|0
comma
id|bus
op_assign
id|fore200e_bus
suffix:semicolon
id|bus-&gt;model_name
suffix:semicolon
id|bus
op_increment
)paren
(brace
multiline_comment|/* detect all boards present on that bus */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
(paren
id|fore200e
op_assign
id|bus
op_member_access_from_pointer
id|detect
c_func
(paren
id|bus
comma
id|index
)paren
)paren
suffix:semicolon
id|index
op_increment
)paren
(brace
id|printk
c_func
(paren
id|FORE200E
l_string|&quot;device %s found at 0x%lx, IRQ %s&bslash;n&quot;
comma
id|fore200e-&gt;bus-&gt;model_name
comma
id|fore200e-&gt;phys_base
comma
id|fore200e_irq_itoa
c_func
(paren
id|fore200e-&gt;irq
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|fore200e-&gt;name
comma
l_string|&quot;%s-%d&quot;
comma
id|bus-&gt;model_name
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fore200e_init
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
(brace
id|fore200e_shutdown
c_func
(paren
id|fore200e
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|link
op_increment
suffix:semicolon
id|fore200e-&gt;next
op_assign
id|fore200e_boards
suffix:semicolon
id|fore200e_boards
op_assign
id|fore200e
suffix:semicolon
)brace
)brace
r_return
id|link
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_static
r_void
DECL|function|fore200e_cleanup
id|fore200e_cleanup
c_func
(paren
r_struct
id|fore200e
op_star
op_star
id|head
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
op_star
id|head
suffix:semicolon
id|fore200e_shutdown
c_func
(paren
id|fore200e
)paren
suffix:semicolon
op_star
id|head
op_assign
id|fore200e-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|fore200e
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|fore200e_proc_read
id|fore200e_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|fore200e
op_star
id|fore200e
op_assign
id|FORE200E_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|len
comma
id|left
op_assign
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|fore200e_getstats
c_func
(paren
id|fore200e
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot; device:&bslash;n&quot;
l_string|&quot;   internal name:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|fore200e-&gt;name
)paren
suffix:semicolon
multiline_comment|/* print bus-specific information */
r_if
c_cond
(paren
id|fore200e-&gt;bus-&gt;proc_read
)paren
id|len
op_add_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|proc_read
c_func
(paren
id|fore200e
comma
id|page
op_plus
id|len
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;   interrupt line:&bslash;t&bslash;t%s&bslash;n&quot;
l_string|&quot;   physical base address:&bslash;t0x%p&bslash;n&quot;
l_string|&quot;   virtual base address:&bslash;t0x%p&bslash;n&quot;
l_string|&quot;   factory address (ESI):&bslash;t%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
l_string|&quot;   board serial number:&bslash;t&bslash;t%d&bslash;n&bslash;n&quot;
comma
id|fore200e_irq_itoa
c_func
(paren
id|fore200e-&gt;irq
)paren
comma
(paren
r_void
op_star
)paren
id|fore200e-&gt;phys_base
comma
(paren
r_void
op_star
)paren
id|fore200e-&gt;virt_base
comma
id|fore200e-&gt;esi
(braket
l_int|0
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|1
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|2
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|3
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|4
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|5
)braket
comma
id|fore200e-&gt;esi
(braket
l_int|4
)braket
op_star
l_int|256
op_plus
id|fore200e-&gt;esi
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;   supplied small bufs (1):&bslash;t%d&bslash;n&quot;
l_string|&quot;   supplied large bufs (1):&bslash;t%d&bslash;n&quot;
l_string|&quot;   supplied small bufs (2):&bslash;t%d&bslash;n&quot;
l_string|&quot;   supplied large bufs (2):&bslash;t%d&bslash;n&quot;
comma
id|fore200e-&gt;host_bsq
(braket
id|BUFFER_SCHEME_ONE
)braket
(braket
id|BUFFER_MAGN_SMALL
)braket
dot
id|count
comma
id|fore200e-&gt;host_bsq
(braket
id|BUFFER_SCHEME_ONE
)braket
(braket
id|BUFFER_MAGN_LARGE
)braket
dot
id|count
comma
id|fore200e-&gt;host_bsq
(braket
id|BUFFER_SCHEME_TWO
)braket
(braket
id|BUFFER_MAGN_SMALL
)braket
dot
id|count
comma
id|fore200e-&gt;host_bsq
(braket
id|BUFFER_SCHEME_TWO
)braket
(braket
id|BUFFER_MAGN_LARGE
)braket
dot
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
(brace
id|u32
id|hb
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;heartbeat
)paren
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&bslash;n&quot;
l_string|&quot; cell processor:&bslash;n&quot;
l_string|&quot;   heartbeat state:&bslash;t&bslash;t&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hb
op_rshift
l_int|16
op_ne
l_int|0xDEAD
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|hb
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;*** FATAL ERROR %04x ***&bslash;n&quot;
comma
id|hb
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
(brace
r_static
r_const
r_char
op_star
id|media_name
(braket
)braket
op_assign
(brace
l_string|&quot;unshielded twisted pair&quot;
comma
l_string|&quot;multimode optical fiber ST&quot;
comma
l_string|&quot;multimode optical fiber SC&quot;
comma
l_string|&quot;single-mode optical fiber ST&quot;
comma
l_string|&quot;single-mode optical fiber SC&quot;
comma
l_string|&quot;unknown&quot;
)brace
suffix:semicolon
r_static
r_const
r_char
op_star
id|oc3_mode
(braket
)braket
op_assign
(brace
l_string|&quot;normal operation&quot;
comma
l_string|&quot;diagnostic loopback&quot;
comma
l_string|&quot;line loopback&quot;
comma
l_string|&quot;unknown&quot;
)brace
suffix:semicolon
id|u32
id|fw_release
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;fw_release
)paren
suffix:semicolon
id|u32
id|mon960_release
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;mon960_release
)paren
suffix:semicolon
id|u32
id|oc3_revision
op_assign
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;oc3_revision
)paren
suffix:semicolon
id|u32
id|media_index
op_assign
id|FORE200E_MEDIA_INDEX
c_func
(paren
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|fore200e-&gt;cp_queues-&gt;media_type
)paren
)paren
suffix:semicolon
id|u32
id|oc3_index
suffix:semicolon
r_if
c_cond
(paren
id|media_index
template_param
l_int|4
)paren
id|media_index
op_assign
l_int|5
suffix:semicolon
r_switch
c_cond
(paren
id|fore200e-&gt;loop_mode
)paren
(brace
r_case
id|ATM_LM_NONE
suffix:colon
id|oc3_index
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_LM_LOC_PHY
suffix:colon
id|oc3_index
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_LM_RMT_PHY
suffix:colon
id|oc3_index
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|oc3_index
op_assign
l_int|3
suffix:semicolon
)brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;   firmware release:&bslash;t&bslash;t%d.%d.%d&bslash;n&quot;
l_string|&quot;   monitor release:&bslash;t&bslash;t%d.%d&bslash;n&quot;
l_string|&quot;   media type:&bslash;t&bslash;t&bslash;t%s&bslash;n&quot;
l_string|&quot;   OC-3 revision:&bslash;t&bslash;t0x%x&bslash;n&quot;
l_string|&quot;   OC-3 mode:&bslash;t&bslash;t&bslash;t%s&quot;
comma
id|fw_release
op_rshift
l_int|16
comma
id|fw_release
op_lshift
l_int|16
op_rshift
l_int|24
comma
id|fw_release
op_lshift
l_int|24
op_rshift
l_int|24
comma
id|mon960_release
op_rshift
l_int|16
comma
id|mon960_release
op_lshift
l_int|16
op_rshift
l_int|16
comma
id|media_name
(braket
id|media_index
)braket
comma
id|oc3_revision
comma
id|oc3_mode
(braket
id|oc3_index
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
(brace
r_struct
id|cp_monitor
op_star
id|cp_monitor
op_assign
id|fore200e-&gt;cp_monitor
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&bslash;n&quot;
l_string|&quot; monitor:&bslash;n&quot;
l_string|&quot;   version number:&bslash;t&bslash;t%d&bslash;n&quot;
l_string|&quot;   boot status word:&bslash;t&bslash;t0x%08x&bslash;n&quot;
comma
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|cp_monitor-&gt;mon_version
)paren
comma
id|fore200e-&gt;bus
op_member_access_from_pointer
id|read
c_func
(paren
op_amp
id|cp_monitor-&gt;bstat
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot; device statistics:&bslash;n&quot;
l_string|&quot;  4b5b:&bslash;n&quot;
l_string|&quot;     crc_header_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     framing_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;phy.crc_header_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;phy.framing_errors
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;  OC-3:&bslash;n&quot;
l_string|&quot;     section_bip8_errors:&bslash;t%10u&bslash;n&quot;
l_string|&quot;     path_bip8_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     line_bip24_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     line_febe_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     path_febe_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     corr_hcs_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     ucorr_hcs_errors:&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.section_bip8_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.path_bip8_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.line_bip24_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.line_febe_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.path_febe_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.corr_hcs_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;oc3.ucorr_hcs_errors
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;   ATM:&bslash;t&bslash;t&bslash;t&bslash;t     cells&bslash;n&quot;
l_string|&quot;     TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     vpi out of range:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     vpi no conn:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     vci out of range:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     vci no conn:&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.cells_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.cells_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.vpi_bad_range
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.vpi_no_conn
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.vci_bad_range
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;atm.vci_no_conn
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;   AAL0:&bslash;t&bslash;t&bslash;t     cells&bslash;n&quot;
l_string|&quot;     TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     dropped:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal0.cells_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal0.cells_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal0.cells_dropped
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;   AAL3/4:&bslash;n&quot;
l_string|&quot;     SAR sublayer:&bslash;t&bslash;t     cells&bslash;n&quot;
l_string|&quot;       TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       dropped:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       CRC errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       protocol errors:&bslash;t&bslash;t%10u&bslash;n&bslash;n&quot;
l_string|&quot;     CS  sublayer:&bslash;t&bslash;t      PDUs&bslash;n&quot;
l_string|&quot;       TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       dropped:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       protocol errors:&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_dropped
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_crc_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cells_protocol_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cspdus_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cspdus_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cspdus_dropped
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal34.cspdus_protocol_errors
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;   AAL5:&bslash;n&quot;
l_string|&quot;     SAR sublayer:&bslash;t&bslash;t     cells&bslash;n&quot;
l_string|&quot;       TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       dropped:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       congestions:&bslash;t&bslash;t%10u&bslash;n&bslash;n&quot;
l_string|&quot;     CS  sublayer:&bslash;t&bslash;t      PDUs&bslash;n&quot;
l_string|&quot;       TX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       RX:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       dropped:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       CRC errors:&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;       protocol errors:&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cells_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cells_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cells_dropped
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.congestion_experienced
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cspdus_transmitted
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cspdus_received
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cspdus_dropped
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cspdus_crc_errors
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aal5.cspdus_protocol_errors
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;   AUX:&bslash;t&bslash;t       allocation failures&bslash;n&quot;
l_string|&quot;     small b1:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     large b1:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     small b2:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     large b2:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
l_string|&quot;     RX PDUs:&bslash;t&bslash;t&bslash;t%10u&bslash;n&quot;
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aux.small_b1_failed
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aux.large_b1_failed
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aux.small_b2_failed
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aux.large_b2_failed
)paren
comma
id|fore200e_swap
c_func
(paren
id|fore200e-&gt;stats-&gt;aux.rpd_alloc_failed
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot; receive carrier:&bslash;t&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|fore200e-&gt;stats-&gt;aux.receive_carrier
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF!&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|fore200e_vcc
op_star
id|fore200e_vcc
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot; VCCs:&bslash;n  address&bslash;tVPI.VCI:AAL&bslash;t(min/max tx PDU size) (min/max rx PDU size)&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|vcc
op_assign
id|fore200e-&gt;atm_dev-&gt;vccs
suffix:semicolon
id|vcc
suffix:semicolon
id|vcc
op_assign
id|vcc-&gt;next
)paren
(brace
id|fore200e_vcc
op_assign
id|FORE200E_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;  %x&bslash;t%d.%d:%d&bslash;t&bslash;t(%d/%d)&bslash;t(%d/%d)&bslash;n&quot;
comma
(paren
id|u32
)paren
(paren
r_int
r_int
)paren
id|vcc
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|fore200e_atm2fore_aal
c_func
(paren
id|vcc-&gt;qos.aal
)paren
comma
id|fore200e_vcc-&gt;tx_min_pdu
OG
l_int|0xFFFF
ques
c_cond
l_int|0
suffix:colon
id|fore200e_vcc-&gt;tx_min_pdu
comma
id|fore200e_vcc-&gt;tx_max_pdu
comma
id|fore200e_vcc-&gt;rx_min_pdu
OG
l_int|0xFFFF
ques
c_cond
l_int|0
suffix:colon
id|fore200e_vcc-&gt;rx_min_pdu
comma
id|fore200e_vcc-&gt;rx_max_pdu
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_static
r_int
id|__init
DECL|function|fore200e_module_init
id|fore200e_module_init
c_func
(paren
r_void
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;module loaded&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|fore200e_detect
c_func
(paren
)paren
op_eq
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|fore200e_module_cleanup
id|fore200e_module_cleanup
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|fore200e_boards
)paren
(brace
id|fore200e_cleanup
c_func
(paren
op_amp
id|fore200e_boards
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;module being removed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|fore200e_module_init
id|module_init
c_func
(paren
id|fore200e_module_init
)paren
suffix:semicolon
DECL|variable|fore200e_module_cleanup
id|module_exit
c_func
(paren
id|fore200e_module_cleanup
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|fore200e_ops
r_static
r_const
r_struct
id|atmdev_ops
id|fore200e_ops
op_assign
(brace
id|open
suffix:colon
id|fore200e_open
comma
id|close
suffix:colon
id|fore200e_close
comma
id|ioctl
suffix:colon
id|fore200e_ioctl
comma
id|getsockopt
suffix:colon
id|fore200e_getsockopt
comma
id|setsockopt
suffix:colon
id|fore200e_setsockopt
comma
id|send
suffix:colon
id|fore200e_send
comma
id|change_qos
suffix:colon
id|fore200e_change_qos
comma
id|proc_read
suffix:colon
id|fore200e_proc_read
comma
id|owner
suffix:colon
id|THIS_MODULE
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_ATM_FORE200E_PCA
r_extern
r_const
r_int
r_char
id|_fore200e_pca_fw_data
(braket
)braket
suffix:semicolon
r_extern
r_const
r_int
r_int
id|_fore200e_pca_fw_size
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_FORE200E_SBA
r_extern
r_const
r_int
r_char
id|_fore200e_sba_fw_data
(braket
)braket
suffix:semicolon
r_extern
r_const
r_int
r_int
id|_fore200e_sba_fw_size
suffix:semicolon
macro_line|#endif
DECL|variable|fore200e_bus
r_static
r_const
r_struct
id|fore200e_bus
id|fore200e_bus
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_ATM_FORE200E_PCA
(brace
l_string|&quot;PCA-200E&quot;
comma
l_string|&quot;pca200e&quot;
comma
l_int|32
comma
l_int|4
comma
l_int|32
comma
id|_fore200e_pca_fw_data
comma
op_amp
id|_fore200e_pca_fw_size
comma
id|fore200e_pca_read
comma
id|fore200e_pca_write
comma
id|fore200e_pca_dma_map
comma
id|fore200e_pca_dma_unmap
comma
id|fore200e_pca_dma_sync
comma
id|fore200e_pca_dma_chunk_alloc
comma
id|fore200e_pca_dma_chunk_free
comma
id|fore200e_pca_detect
comma
id|fore200e_pca_configure
comma
id|fore200e_pca_map
comma
id|fore200e_pca_reset
comma
id|fore200e_pca_prom_read
comma
id|fore200e_pca_unmap
comma
l_int|NULL
comma
id|fore200e_pca_irq_check
comma
id|fore200e_pca_irq_ack
comma
id|fore200e_pca_proc_read
comma
)brace
comma
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_FORE200E_SBA
(brace
l_string|&quot;SBA-200E&quot;
comma
l_string|&quot;sba200e&quot;
comma
l_int|32
comma
l_int|64
comma
l_int|32
comma
id|_fore200e_sba_fw_data
comma
op_amp
id|_fore200e_sba_fw_size
comma
id|fore200e_sba_read
comma
id|fore200e_sba_write
comma
id|fore200e_sba_dma_map
comma
id|fore200e_sba_dma_unmap
comma
id|fore200e_sba_dma_sync
comma
id|fore200e_sba_dma_chunk_alloc
comma
id|fore200e_sba_dma_chunk_free
comma
id|fore200e_sba_detect
comma
id|fore200e_sba_configure
comma
id|fore200e_sba_map
comma
id|fore200e_sba_reset
comma
id|fore200e_sba_prom_read
comma
id|fore200e_sba_unmap
comma
id|fore200e_sba_irq_enable
comma
id|fore200e_sba_irq_check
comma
id|fore200e_sba_irq_ack
comma
id|fore200e_sba_proc_read
comma
)brace
comma
macro_line|#endif
(brace
)brace
)brace
suffix:semicolon
eof
