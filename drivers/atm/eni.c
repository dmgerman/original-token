multiline_comment|/* drivers/atm/eni.c - Efficient Networks ENI155P device driver */
multiline_comment|/* Written 1995-2000 by Werner Almesberger, EPFL LRC/ICA */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/atm.h&gt;
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/sonet.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/sched.h&gt; /* for xtime */
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/uio.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/atm_eni.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &quot;tonga.h&quot;
macro_line|#include &quot;midway.h&quot;
macro_line|#include &quot;suni.h&quot;
macro_line|#include &quot;eni.h&quot;
macro_line|#ifndef __i386__
macro_line|#ifndef ioremap_nocache
DECL|macro|ioremap_nocache
mdefine_line|#define ioremap_nocache(X,Y) ioremap(X,Y)
macro_line|#endif 
macro_line|#endif
multiline_comment|/*&n; * TODO:&n; *&n; * Show stoppers&n; *  none&n; *&n; * Minor&n; *  - OAM support&n; *  - fix bugs listed below&n; */
multiline_comment|/*&n; * KNOWN BUGS:&n; *&n; * - may run into JK-JK bug and deadlock&n; * - should allocate UBR channel first&n; * - buffer space allocation algorithm is stupid&n; *   (RX: should be maxSDU+maxdelay*rate&n; *    TX: should be maxSDU+min(maxSDU,maxdelay*rate) )&n; * - doesn&squot;t support OAM cells&n; * - eni_put_free may hang if not putting memory fragments that _complete_&n; *   2^n block (never happens in real life, though)&n; * - keeps IRQ even if initialization fails&n; */
macro_line|#if 0
mdefine_line|#define DPRINTK(format,args...) printk(KERN_DEBUG format,##args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format,args...)
macro_line|#endif
macro_line|#ifndef CONFIG_ATM_ENI_TUNE_BURST
DECL|macro|CONFIG_ATM_ENI_BURST_TX_8W
mdefine_line|#define CONFIG_ATM_ENI_BURST_TX_8W
DECL|macro|CONFIG_ATM_ENI_BURST_RX_4W
mdefine_line|#define CONFIG_ATM_ENI_BURST_RX_4W
macro_line|#endif
macro_line|#ifndef CONFIG_ATM_ENI_DEBUG
DECL|macro|NULLCHECK
mdefine_line|#define NULLCHECK(x)
DECL|macro|EVENT
mdefine_line|#define EVENT(s,a,b)
DECL|function|event_dump
r_static
r_void
id|event_dump
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#else
multiline_comment|/* &n; * NULL pointer checking&n; */
DECL|macro|NULLCHECK
mdefine_line|#define NULLCHECK(x) &bslash;&n;&t;if ((unsigned long) (x) &lt; 0x30) &bslash;&n;&t;&t;printk(KERN_CRIT #x &quot;==0x%lx&bslash;n&quot;,(unsigned long) (x))
multiline_comment|/*&n; * Very extensive activity logging. Greatly improves bug detection speed but&n; * costs a few Mbps if enabled.&n; */
DECL|macro|EV
mdefine_line|#define EV 64
DECL|variable|ev
r_static
r_const
r_char
op_star
id|ev
(braket
id|EV
)braket
suffix:semicolon
DECL|variable|ev_a
DECL|variable|ev_b
r_static
r_int
r_int
id|ev_a
(braket
id|EV
)braket
comma
id|ev_b
(braket
id|EV
)braket
suffix:semicolon
DECL|variable|ec
r_static
r_int
id|ec
op_assign
l_int|0
suffix:semicolon
DECL|function|EVENT
r_static
r_void
id|EVENT
c_func
(paren
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|a
comma
r_int
r_int
id|b
)paren
(brace
id|ev
(braket
id|ec
)braket
op_assign
id|s
suffix:semicolon
id|ev_a
(braket
id|ec
)braket
op_assign
id|a
suffix:semicolon
id|ev_b
(braket
id|ec
)braket
op_assign
id|b
suffix:semicolon
id|ec
op_assign
(paren
id|ec
op_plus
l_int|1
)paren
op_mod
id|EV
suffix:semicolon
)brace
DECL|function|event_dump
r_static
r_void
id|event_dump
c_func
(paren
r_void
)paren
(brace
r_int
id|n
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|EV
suffix:semicolon
id|n
op_increment
)paren
(brace
id|i
op_assign
(paren
id|ec
op_plus
id|n
)paren
op_mod
id|EV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|ev
(braket
id|i
)braket
ques
c_cond
id|ev
(braket
id|i
)braket
suffix:colon
l_string|&quot;(null)&quot;
comma
id|ev_a
(braket
id|i
)braket
comma
id|ev_b
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_ATM_ENI_DEBUG */
multiline_comment|/*&n; * NExx   must not be equal at end&n; * EExx   may be equal at end&n; * xxPJOK verify validity of pointer jumps&n; * xxPMOK operating on a circular buffer of &quot;c&quot; words&n; */
DECL|macro|NEPJOK
mdefine_line|#define NEPJOK(a0,a1,b) &bslash;&n;    ((a0) &lt; (a1) ? (b) &lt;= (a0) || (b) &gt; (a1) : (b) &lt;= (a0) &amp;&amp; (b) &gt; (a1))
DECL|macro|EEPJOK
mdefine_line|#define EEPJOK(a0,a1,b) &bslash;&n;    ((a0) &lt; (a1) ? (b) &lt; (a0) || (b) &gt;= (a1) : (b) &lt; (a0) &amp;&amp; (b) &gt;= (a1))
DECL|macro|NEPMOK
mdefine_line|#define NEPMOK(a0,d,b,c) NEPJOK(a0,(a0+d) &amp; (c-1),b)
DECL|macro|EEPMOK
mdefine_line|#define EEPMOK(a0,d,b,c) EEPJOK(a0,(a0+d) &amp; (c-1),b)
DECL|variable|tx_complete
DECL|variable|dma_complete
DECL|variable|queued
DECL|variable|requeued
r_static
r_int
id|tx_complete
op_assign
l_int|0
comma
id|dma_complete
op_assign
l_int|0
comma
id|queued
op_assign
l_int|0
comma
id|requeued
op_assign
l_int|0
comma
DECL|variable|backlogged
DECL|variable|rx_enqueued
DECL|variable|rx_dequeued
DECL|variable|pushed
DECL|variable|submitted
id|backlogged
op_assign
l_int|0
comma
id|rx_enqueued
op_assign
l_int|0
comma
id|rx_dequeued
op_assign
l_int|0
comma
id|pushed
op_assign
l_int|0
comma
id|submitted
op_assign
l_int|0
comma
DECL|variable|putting
id|putting
op_assign
l_int|0
suffix:semicolon
DECL|variable|eni_boards
r_static
r_struct
id|atm_dev
op_star
id|eni_boards
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|cpu_zeroes
r_static
id|u32
op_star
id|cpu_zeroes
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* aligned &quot;magic&quot; zeroes */
DECL|variable|zeroes
r_static
id|dma_addr_t
id|zeroes
suffix:semicolon
multiline_comment|/* Read/write registers on card */
DECL|macro|eni_in
mdefine_line|#define eni_in(r)&t;readl(eni_dev-&gt;reg+(r)*4)
DECL|macro|eni_out
mdefine_line|#define eni_out(v,r)&t;writel((v),eni_dev-&gt;reg+(r)*4)
multiline_comment|/*-------------------------------- utilities --------------------------------*/
DECL|function|dump_mem
r_static
r_void
id|dump_mem
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|eni_dev-&gt;free_len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  %d: 0x%lx %d&bslash;n&quot;
comma
id|i
comma
id|eni_dev-&gt;free_list
(braket
id|i
)braket
dot
id|start
comma
l_int|1
op_lshift
id|eni_dev-&gt;free_list
(braket
id|i
)braket
dot
id|order
)paren
suffix:semicolon
)brace
DECL|function|dump
r_static
r_void
id|dump
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_int
id|i
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Free memory&bslash;n&quot;
)paren
suffix:semicolon
id|dump_mem
c_func
(paren
id|eni_dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;TX buffers&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CHAN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|send
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;  TX %d @ 0x%lx: %ld&bslash;n&quot;
comma
id|i
comma
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|send
comma
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|words
op_star
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;RX buffers&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1024
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|eni_dev-&gt;rx_map
(braket
id|i
)braket
op_logical_and
id|ENI_VCC
c_func
(paren
id|eni_dev-&gt;rx_map
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|rx
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;  RX %d @ 0x%lx: %ld&bslash;n&quot;
comma
id|i
comma
id|ENI_VCC
c_func
(paren
id|eni_dev-&gt;rx_map
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|recv
comma
id|ENI_VCC
c_func
(paren
id|eni_dev-&gt;rx_map
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|words
op_star
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;----&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|eni_put_free
r_static
r_void
id|eni_put_free
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|eni_free
op_star
id|list
suffix:semicolon
r_int
id|len
comma
id|order
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;init 0x%lx+%ld(0x%lx)&bslash;n&quot;
comma
id|start
comma
id|size
comma
id|size
)paren
suffix:semicolon
id|start
op_add_assign
id|eni_dev-&gt;base_diff
suffix:semicolon
id|list
op_assign
id|eni_dev-&gt;free_list
suffix:semicolon
id|len
op_assign
id|eni_dev-&gt;free_len
suffix:semicolon
r_while
c_loop
(paren
id|size
)paren
(brace
r_if
c_cond
(paren
id|len
op_ge
id|eni_dev-&gt;free_list_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;eni_put_free overflow (0x%lx,%ld)&bslash;n&quot;
comma
id|start
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
op_logical_neg
(paren
(paren
id|start
op_or
id|size
)paren
op_amp
(paren
l_int|1
op_lshift
id|order
)paren
)paren
suffix:semicolon
id|order
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MID_MIN_BUF_SIZE
OG
(paren
l_int|1
op_lshift
id|order
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;eni_put_free: order %d too small&bslash;n&quot;
comma
id|order
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|list
(braket
id|len
)braket
dot
id|start
op_assign
id|start
suffix:semicolon
id|list
(braket
id|len
)braket
dot
id|order
op_assign
id|order
suffix:semicolon
id|len
op_increment
suffix:semicolon
id|start
op_add_assign
l_int|1
op_lshift
id|order
suffix:semicolon
id|size
op_sub_assign
l_int|1
op_lshift
id|order
suffix:semicolon
)brace
id|eni_dev-&gt;free_len
op_assign
id|len
suffix:semicolon
multiline_comment|/*dump_mem(eni_dev);*/
)brace
DECL|function|eni_alloc_mem
r_static
r_int
r_int
id|eni_alloc_mem
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_struct
id|eni_free
op_star
id|list
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
id|len
comma
id|i
comma
id|order
comma
id|best_order
comma
id|index
suffix:semicolon
id|list
op_assign
id|eni_dev-&gt;free_list
suffix:semicolon
id|len
op_assign
id|eni_dev-&gt;free_len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|size
OL
id|MID_MIN_BUF_SIZE
)paren
op_star
id|size
op_assign
id|MID_MIN_BUF_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_star
id|size
OG
id|MID_MAX_BUF_SIZE
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1
op_lshift
id|order
)paren
OL
op_star
id|size
suffix:semicolon
id|order
op_increment
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;trying: %ld-&gt;%d&bslash;n&quot;
comma
op_star
id|size
comma
id|order
)paren
suffix:semicolon
id|best_order
op_assign
l_int|65
suffix:semicolon
multiline_comment|/* we don&squot;t have more than 2^64 of anything ... */
id|index
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* silence GCC */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|list
(braket
id|i
)braket
dot
id|order
op_eq
id|order
)paren
(brace
id|best_order
op_assign
id|order
suffix:semicolon
id|index
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|best_order
OG
id|list
(braket
id|i
)braket
dot
id|order
op_logical_and
id|list
(braket
id|i
)braket
dot
id|order
OG
id|order
)paren
(brace
id|best_order
op_assign
id|list
(braket
id|i
)braket
dot
id|order
suffix:semicolon
id|index
op_assign
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|best_order
op_eq
l_int|65
)paren
r_return
l_int|0
suffix:semicolon
id|start
op_assign
id|list
(braket
id|index
)braket
dot
id|start
op_minus
id|eni_dev-&gt;base_diff
suffix:semicolon
id|list
(braket
id|index
)braket
op_assign
id|list
(braket
op_decrement
id|len
)braket
suffix:semicolon
id|eni_dev-&gt;free_len
op_assign
id|len
suffix:semicolon
op_star
id|size
op_assign
l_int|1
op_lshift
id|order
suffix:semicolon
id|eni_put_free
c_func
(paren
id|eni_dev
comma
id|start
op_plus
op_star
id|size
comma
(paren
l_int|1
op_lshift
id|best_order
)paren
op_minus
op_star
id|size
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%ld bytes (order %d) at 0x%lx&bslash;n&quot;
comma
op_star
id|size
comma
id|order
comma
id|start
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|start
comma
l_int|0
comma
op_star
id|size
)paren
suffix:semicolon
multiline_comment|/* never leak data */
multiline_comment|/*dump_mem(eni_dev);*/
r_return
id|start
suffix:semicolon
)brace
DECL|function|eni_free_mem
r_static
r_void
id|eni_free_mem
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|eni_free
op_star
id|list
suffix:semicolon
r_int
id|len
comma
id|i
comma
id|order
suffix:semicolon
id|start
op_add_assign
id|eni_dev-&gt;base_diff
suffix:semicolon
id|list
op_assign
id|eni_dev-&gt;free_list
suffix:semicolon
id|len
op_assign
id|eni_dev-&gt;free_len
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
op_minus
l_int|1
suffix:semicolon
id|size
suffix:semicolon
id|order
op_increment
)paren
id|size
op_rshift_assign
l_int|1
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;eni_free_mem: 0x%lx+0x%lx (order %d)&bslash;n&quot;
comma
id|start
comma
id|size
comma
id|order
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|list
(braket
id|i
)braket
dot
id|start
op_eq
(paren
id|start
op_xor
(paren
l_int|1
op_lshift
id|order
)paren
)paren
op_logical_and
id|list
(braket
id|i
)braket
dot
id|order
op_eq
id|order
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;match[%d]: 0x%lx/0x%lx(0x%x), %d/%d&bslash;n&quot;
comma
id|i
comma
id|list
(braket
id|i
)braket
dot
id|start
comma
id|start
comma
l_int|1
op_lshift
id|order
comma
id|list
(braket
id|i
)braket
dot
id|order
comma
id|order
)paren
suffix:semicolon
id|list
(braket
id|i
)braket
op_assign
id|list
(braket
op_decrement
id|len
)braket
suffix:semicolon
id|start
op_and_assign
op_complement
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
id|order
)paren
suffix:semicolon
id|order
op_increment
suffix:semicolon
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ge
id|eni_dev-&gt;free_list_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;eni_free_mem overflow (0x%lx,%d)&bslash;n&quot;
comma
id|start
comma
id|order
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list
(braket
id|len
)braket
dot
id|start
op_assign
id|start
suffix:semicolon
id|list
(braket
id|len
)braket
dot
id|order
op_assign
id|order
suffix:semicolon
id|eni_dev-&gt;free_len
op_assign
id|len
op_plus
l_int|1
suffix:semicolon
multiline_comment|/*dump_mem(eni_dev);*/
)brace
multiline_comment|/*----------------------------------- RX ------------------------------------*/
DECL|macro|ENI_VCC_NOS
mdefine_line|#define ENI_VCC_NOS ((struct atm_vcc *) 1)
DECL|function|rx_ident_err
r_static
r_void
id|rx_ident_err
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* immediately halt adapter */
id|eni_out
c_func
(paren
id|eni_in
c_func
(paren
id|MID_MC_S
)paren
op_amp
op_complement
(paren
id|MID_DMA_ENABLE
op_or
id|MID_TX_ENABLE
op_or
id|MID_RX_ENABLE
)paren
comma
id|MID_MC_S
)paren
suffix:semicolon
multiline_comment|/* dump useful information */
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
id|DEV_LABEL
l_string|&quot;(itf %d): driver error - RX ident &quot;
l_string|&quot;mismatch&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;  VCI %d, rxing %d, words %ld&bslash;n&quot;
comma
id|vcc-&gt;vci
comma
id|eni_vcc-&gt;rxing
comma
id|eni_vcc-&gt;words
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;  host descr 0x%lx, rx pos 0x%lx, descr value &quot;
l_string|&quot;0x%x&bslash;n&quot;
comma
id|eni_vcc-&gt;descr
comma
id|eni_vcc-&gt;rx_pos
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|eni_vcc-&gt;recv
op_plus
id|eni_vcc-&gt;descr
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;  last 0x%p, servicing %d&bslash;n&quot;
comma
id|eni_vcc-&gt;last
comma
id|eni_vcc-&gt;servicing
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;---dump ends here---&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;---recent events---&bslash;n&quot;
)paren
suffix:semicolon
id|event_dump
c_func
(paren
)paren
suffix:semicolon
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|fast
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* really stop it */
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|slow
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|rx_queue
)paren
suffix:semicolon
)brace
DECL|function|do_rx_dma
r_static
r_int
id|do_rx_dma
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|skip
comma
r_int
r_int
id|size
comma
r_int
r_int
id|eff
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|u32
id|dma_rd
comma
id|dma_wr
suffix:semicolon
id|u32
id|dma
(braket
id|RX_DMA_BUF
op_star
l_int|2
)braket
suffix:semicolon
id|dma_addr_t
id|paddr
suffix:semicolon
r_int
r_int
id|here
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|paddr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* GCC, shut up */
r_if
c_cond
(paren
id|skb
)paren
(brace
id|paddr
op_assign
id|pci_map_single
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|ENI_PRV_PADDR
c_func
(paren
id|skb
)paren
op_assign
id|paddr
suffix:semicolon
r_if
c_cond
(paren
id|paddr
op_amp
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): VCI %d has &quot;
l_string|&quot;mis-aligned RX data (0x%lx)&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|vcc-&gt;vci
comma
(paren
r_int
r_int
)paren
id|paddr
)paren
suffix:semicolon
id|ENI_PRV_SIZE
c_func
(paren
id|skb
)paren
op_assign
id|size
op_plus
id|skip
suffix:semicolon
multiline_comment|/* PDU plus descriptor */
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
)brace
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|eff
op_logical_and
id|skip
)paren
op_logical_or
l_int|1
)paren
(brace
multiline_comment|/* @@@ actually, skip is always == 1 ... */
id|here
op_assign
(paren
id|eni_vcc-&gt;descr
op_plus
id|skip
)paren
op_amp
(paren
id|eni_vcc-&gt;words
op_minus
l_int|1
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
(paren
id|here
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
op_or
id|MID_DT_JK
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
id|here
op_assign
(paren
id|eni_vcc-&gt;descr
op_plus
id|size
op_plus
id|skip
)paren
op_amp
(paren
id|eni_vcc-&gt;words
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eff
)paren
id|size
op_add_assign
id|skip
suffix:semicolon
r_else
(brace
r_int
r_int
id|words
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;strange things happen ...&bslash;n&quot;
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;strange things happen ... (skip=%ld,eff=%ld)&bslash;n&quot;
comma
id|size
comma
id|eff
)paren
suffix:semicolon
)brace
id|words
op_assign
id|eff
suffix:semicolon
r_if
c_cond
(paren
id|paddr
op_amp
l_int|15
)paren
(brace
r_int
r_int
id|init
suffix:semicolon
id|init
op_assign
l_int|4
op_minus
(paren
(paren
id|paddr
op_amp
l_int|15
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init
OG
id|words
)paren
id|init
op_assign
id|words
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_WORD
op_or
(paren
id|init
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
id|init
op_lshift
l_int|2
suffix:semicolon
id|words
op_sub_assign
id|init
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_16W /* may work with some PCI chipsets ... */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|15
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_16W
op_or
(paren
(paren
id|words
op_rshift
l_int|4
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|15
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|15
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_8W  /* works only with *some* PCI chipsets ... */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|7
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_8W
op_or
(paren
(paren
id|words
op_rshift
l_int|3
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|7
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|7
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_4W /* recommended */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|3
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_4W
op_or
(paren
(paren
id|words
op_rshift
l_int|2
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|3
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|3
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_2W /* probably useless if RX_4W, RX_8W, ... */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|1
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_2W
op_or
(paren
(paren
id|words
op_rshift
l_int|1
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|1
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|words
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|MID_DT_WORD
op_or
(paren
id|words
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
suffix:semicolon
id|dma
(braket
id|j
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|size
op_ne
id|eff
)paren
(brace
id|dma
(braket
id|j
op_increment
)braket
op_assign
(paren
id|here
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|MID_DMA_VCI_SHIFT
)paren
op_or
id|MID_DT_JK
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|j
op_logical_or
id|j
OG
l_int|2
op_star
id|RX_DMA_BUF
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;!j or j too big!!!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|trouble
suffix:semicolon
)brace
id|dma
(braket
id|j
op_minus
l_int|2
)braket
op_or_assign
id|MID_DMA_END
suffix:semicolon
id|j
op_assign
id|j
op_rshift
l_int|1
suffix:semicolon
id|dma_wr
op_assign
id|eni_in
c_func
(paren
id|MID_DMA_WR_RX
)paren
suffix:semicolon
id|dma_rd
op_assign
id|eni_in
c_func
(paren
id|MID_DMA_RD_RX
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Can I move the dma_wr pointer by 2j+1 positions without overwriting&n;&t; * data that hasn&squot;t been read (position of dma_rd) yet ?&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|NEPMOK
c_func
(paren
id|dma_wr
comma
id|j
op_plus
id|j
op_plus
l_int|1
comma
id|dma_rd
comma
id|NR_DMA_RX
)paren
)paren
(brace
multiline_comment|/* @@@ +1 is ugly */
id|printk
c_func
(paren
id|KERN_WARNING
id|DEV_LABEL
l_string|&quot;(itf %d): RX DMA full&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
)paren
suffix:semicolon
r_goto
id|trouble
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writel
c_func
(paren
id|dma
(braket
id|i
op_star
l_int|2
)braket
comma
id|eni_dev-&gt;rx_dma
op_plus
id|dma_wr
op_star
l_int|8
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dma
(braket
id|i
op_star
l_int|2
op_plus
l_int|1
)braket
comma
id|eni_dev-&gt;rx_dma
op_plus
id|dma_wr
op_star
l_int|8
op_plus
l_int|4
)paren
suffix:semicolon
id|dma_wr
op_assign
(paren
id|dma_wr
op_plus
l_int|1
)paren
op_amp
(paren
id|NR_DMA_RX
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
)paren
(brace
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
op_assign
id|eni_vcc-&gt;descr
op_plus
id|size
op_plus
l_int|1
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|eni_dev-&gt;rx_queue
comma
id|skb
)paren
suffix:semicolon
id|eni_vcc-&gt;last
op_assign
id|skb
suffix:semicolon
id|rx_enqueued
op_increment
suffix:semicolon
)brace
id|eni_vcc-&gt;descr
op_assign
id|here
suffix:semicolon
id|eni_out
c_func
(paren
id|dma_wr
comma
id|MID_DMA_WR_RX
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|trouble
suffix:colon
r_if
c_cond
(paren
id|paddr
)paren
id|pci_unmap_single
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|paddr
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|discard
r_static
r_void
id|discard
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;discard (size=%ld)&bslash;n&quot;
comma
id|size
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
id|do_rx_dma
c_func
(paren
id|vcc
comma
l_int|NULL
comma
l_int|1
comma
id|size
comma
l_int|0
)paren
)paren
id|EVENT
c_func
(paren
l_string|&quot;BUSY LOOP&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* could do a full fallback, but that might be more expensive */
r_if
c_cond
(paren
id|eni_vcc-&gt;rxing
)paren
id|ENI_PRV_POS
c_func
(paren
id|eni_vcc-&gt;last
)paren
op_add_assign
id|size
op_plus
l_int|1
suffix:semicolon
r_else
id|eni_vcc-&gt;rx_pos
op_assign
(paren
id|eni_vcc-&gt;rx_pos
op_plus
id|size
op_plus
l_int|1
)paren
op_amp
(paren
id|eni_vcc-&gt;words
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * TODO: should check whether direct copies (without DMA setup, dequeuing on&n; * interrupt, etc.) aren&squot;t much faster for AAL0&n; */
DECL|function|rx_aal0
r_static
r_int
id|rx_aal0
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_int
r_int
id|descr
suffix:semicolon
r_int
r_int
id|length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;rx_aal0&bslash;n&quot;
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|descr
op_assign
id|readl
c_func
(paren
id|eni_vcc-&gt;recv
op_plus
id|eni_vcc-&gt;descr
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|descr
op_amp
id|MID_RED_IDEN
)paren
op_ne
(paren
id|MID_RED_RX_ID
op_lshift
id|MID_RED_SHIFT
)paren
)paren
(brace
id|rx_ident_err
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|descr
op_amp
id|MID_RED_T
)paren
(brace
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;(itf %d): trashing empty cell&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
)paren
suffix:semicolon
id|length
op_assign
l_int|0
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
)brace
r_else
(brace
id|length
op_assign
id|ATM_CELL_SIZE
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* no HEC */
)brace
id|skb
op_assign
id|length
ques
c_cond
id|atm_alloc_charge
c_func
(paren
id|vcc
comma
id|length
comma
id|GFP_ATOMIC
)paren
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|discard
c_func
(paren
id|vcc
comma
id|length
op_rshift
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|length
)paren
suffix:semicolon
id|skb-&gt;stamp
op_assign
id|eni_vcc-&gt;timestamp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;got len %ld&bslash;n&quot;
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_rx_dma
c_func
(paren
id|vcc
comma
id|skb
comma
l_int|1
comma
id|length
op_rshift
l_int|2
comma
id|length
op_rshift
l_int|2
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|eni_vcc-&gt;rxing
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rx_aal5
r_static
r_int
id|rx_aal5
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_int
r_int
id|descr
suffix:semicolon
r_int
r_int
id|size
comma
id|eff
comma
id|length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;rx_aal5&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;rx_aal5&bslash;n&quot;
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|descr
op_assign
id|readl
c_func
(paren
id|eni_vcc-&gt;recv
op_plus
id|eni_vcc-&gt;descr
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|descr
op_amp
id|MID_RED_IDEN
)paren
op_ne
(paren
id|MID_RED_RX_ID
op_lshift
id|MID_RED_SHIFT
)paren
)paren
(brace
id|rx_ident_err
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|descr
op_amp
(paren
id|MID_RED_T
op_or
id|MID_RED_CRC_ERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|descr
op_amp
id|MID_RED_T
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;empty cell (descr=0x%lx)&bslash;n&quot;
comma
id|descr
comma
l_int|0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;(itf %d): trashing empty cell&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_static
r_int
r_int
id|silence
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|silence
)paren
op_logical_or
id|silence
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|DEV_LABEL
l_string|&quot;(itf %d): &quot;
l_string|&quot;discarding PDU(s) with CRC error&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
)paren
suffix:semicolon
id|silence
op_assign
(paren
id|jiffies
op_plus
l_int|2
op_star
id|HZ
)paren
op_or
l_int|1
suffix:semicolon
)brace
id|size
op_assign
(paren
id|descr
op_amp
id|MID_RED_COUNT
)paren
op_star
(paren
id|ATM_CELL_PAYLOAD
op_rshift
l_int|2
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;CRC error (descr=0x%lx,size=%ld)&bslash;n&quot;
comma
id|descr
comma
id|size
)paren
suffix:semicolon
)brace
id|eff
op_assign
id|length
op_assign
l_int|0
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
)brace
r_else
(brace
id|size
op_assign
(paren
id|descr
op_amp
id|MID_RED_COUNT
)paren
op_star
(paren
id|ATM_CELL_PAYLOAD
op_rshift
l_int|2
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;size=%ld&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
id|length
op_assign
id|readl
c_func
(paren
id|eni_vcc-&gt;recv
op_plus
(paren
(paren
(paren
id|eni_vcc-&gt;descr
op_plus
id|size
op_minus
l_int|1
)paren
op_amp
(paren
id|eni_vcc-&gt;words
op_minus
l_int|1
)paren
)paren
)paren
op_star
l_int|4
)paren
op_amp
l_int|0xffff
suffix:semicolon
multiline_comment|/* -trailer(2)+header(1) */
r_if
c_cond
(paren
id|length
op_logical_and
id|length
op_le
(paren
id|size
op_lshift
l_int|2
)paren
op_minus
l_int|8
op_logical_and
id|length
op_le
id|ATM_MAX_AAL5_PDU
)paren
id|eff
op_assign
(paren
id|length
op_plus
l_int|3
)paren
op_rshift
l_int|2
suffix:semicolon
r_else
(brace
multiline_comment|/* ^ trailer length (8) */
id|EVENT
c_func
(paren
l_string|&quot;bad PDU (descr=0x08%lx,length=%ld)&bslash;n&quot;
comma
id|descr
comma
id|length
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): bad AAL5 PDU &quot;
l_string|&quot;(VCI=%d,length=%ld,size=%ld (descr 0x%lx))&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|vcc-&gt;vci
comma
id|length
comma
id|size
op_lshift
l_int|2
comma
id|descr
)paren
suffix:semicolon
id|length
op_assign
id|eff
op_assign
l_int|0
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
)brace
)brace
id|skb
op_assign
id|eff
ques
c_cond
id|atm_alloc_charge
c_func
(paren
id|vcc
comma
id|eff
op_lshift
l_int|2
comma
id|GFP_ATOMIC
)paren
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|discard
c_func
(paren
id|vcc
comma
id|size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|length
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;got len %ld&bslash;n&quot;
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_rx_dma
c_func
(paren
id|vcc
comma
id|skb
comma
l_int|1
comma
id|size
comma
id|eff
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|eni_vcc-&gt;rxing
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rx_vcc
r_static
r_inline
r_int
id|rx_vcc
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
r_int
id|vci_dsc
comma
id|tmp
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vci_dsc
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|vci
op_plus
id|vcc-&gt;vci
op_star
l_int|16
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;rx_vcc(1)&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
id|eni_vcc-&gt;descr
op_ne
(paren
id|tmp
op_assign
(paren
id|readl
c_func
(paren
id|vci_dsc
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_DESCR
)paren
op_rshift
id|MID_VCI_DESCR_SHIFT
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;rx_vcc(2: host dsc=0x%lx, nic dsc=0x%lx)&bslash;n&quot;
comma
id|eni_vcc-&gt;descr
comma
id|tmp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CB_DESCR %ld REG_DESCR %d&bslash;n&quot;
comma
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|descr
comma
(paren
(paren
(paren
r_int
)paren
id|readl
c_func
(paren
id|vci_dsc
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_DESCR
)paren
op_rshift
id|MID_VCI_DESCR_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|rx
c_func
(paren
id|vcc
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* clear IN_SERVICE flag */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|vci_dsc
)paren
op_amp
op_complement
id|MID_VCI_IN_SERVICE
comma
id|vci_dsc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If new data has arrived between evaluating the while condition and&n;&t; * clearing IN_SERVICE, we wouldn&squot;t be notified until additional data&n;&t; * follows. So we have to loop again to be sure.&n;&t; */
id|EVENT
c_func
(paren
l_string|&quot;rx_vcc(3)&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|descr
op_ne
(paren
id|tmp
op_assign
(paren
id|readl
c_func
(paren
id|vci_dsc
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_DESCR
)paren
op_rshift
id|MID_VCI_DESCR_SHIFT
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;rx_vcc(4: host dsc=0x%lx, nic dsc=0x%lx)&bslash;n&quot;
comma
id|eni_vcc-&gt;descr
comma
id|tmp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CB_DESCR %ld REG_DESCR %d&bslash;n&quot;
comma
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|descr
comma
(paren
(paren
(paren
r_int
)paren
id|readl
c_func
(paren
id|vci_dsc
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_DESCR
)paren
op_rshift
id|MID_VCI_DESCR_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|rx
c_func
(paren
id|vcc
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|poll_rx
r_static
r_void
id|poll_rx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|curr
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|curr
op_assign
id|eni_dev-&gt;fast
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;poll_rx.fast&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_vcc
c_func
(paren
id|curr
)paren
)paren
r_return
suffix:semicolon
id|eni_dev-&gt;fast
op_assign
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|next
op_assign
id|ENI_VCC_NOS
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|servicing
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|curr
op_assign
id|eni_dev-&gt;slow
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;poll_rx.slow&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_vcc
c_func
(paren
id|curr
)paren
)paren
r_return
suffix:semicolon
id|eni_dev-&gt;slow
op_assign
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|next
op_assign
id|ENI_VCC_NOS
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|curr
)paren
op_member_access_from_pointer
id|servicing
op_decrement
suffix:semicolon
)brace
)brace
DECL|function|get_service
r_static
r_void
id|get_service
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
r_int
id|vci
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;get_service&bslash;n&quot;
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|eni_in
c_func
(paren
id|MID_SERV_WRITE
)paren
op_ne
id|eni_dev-&gt;serv_read
)paren
(brace
id|vci
op_assign
id|readl
c_func
(paren
id|eni_dev-&gt;service
op_plus
id|eni_dev-&gt;serv_read
op_star
l_int|4
)paren
suffix:semicolon
id|eni_dev-&gt;serv_read
op_assign
(paren
id|eni_dev-&gt;serv_read
op_plus
l_int|1
)paren
op_amp
(paren
id|NR_SERVICE
op_minus
l_int|1
)paren
suffix:semicolon
id|vcc
op_assign
id|eni_dev-&gt;rx_map
(braket
id|vci
op_amp
l_int|1023
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): VCI %ld not &quot;
l_string|&quot;found&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|vci
)paren
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* nasty but we try to go on anyway */
multiline_comment|/* @@@ nope, doesn&squot;t work */
)brace
id|EVENT
c_func
(paren
l_string|&quot;getting from service&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|next
op_ne
id|ENI_VCC_NOS
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;double service&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Grr, servicing VCC %ld twice&bslash;n&quot;
comma
id|vci
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|timestamp
op_assign
id|xtime
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_eq
id|ATM_CBR
)paren
(brace
r_if
c_cond
(paren
id|eni_dev-&gt;fast
)paren
id|ENI_VCC
c_func
(paren
id|eni_dev-&gt;last_fast
)paren
op_member_access_from_pointer
id|next
op_assign
id|vcc
suffix:semicolon
r_else
id|eni_dev-&gt;fast
op_assign
id|vcc
suffix:semicolon
id|eni_dev-&gt;last_fast
op_assign
id|vcc
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|eni_dev-&gt;slow
)paren
id|ENI_VCC
c_func
(paren
id|eni_dev-&gt;last_slow
)paren
op_member_access_from_pointer
id|next
op_assign
id|vcc
suffix:semicolon
r_else
id|eni_dev-&gt;slow
op_assign
id|vcc
suffix:semicolon
id|eni_dev-&gt;last_slow
op_assign
id|vcc
suffix:semicolon
)brace
id|putting
op_increment
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|servicing
op_increment
suffix:semicolon
)brace
)brace
DECL|function|dequeue_rx
r_static
r_void
id|dequeue_rx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|vci_dsc
suffix:semicolon
r_int
id|first
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|first
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|eni_dev-&gt;rx_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
r_if
c_cond
(paren
id|first
)paren
(brace
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;(itf %d): RX but not &quot;
l_string|&quot;rxing&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;nothing to dequeue&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|EVENT
c_func
(paren
l_string|&quot;dequeued (size=%ld,pos=0x%lx)&bslash;n&quot;
comma
id|ENI_PRV_SIZE
c_func
(paren
id|skb
)paren
comma
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
id|rx_dequeued
op_increment
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
id|vci_dsc
op_assign
id|eni_dev-&gt;vci
op_plus
id|vcc-&gt;vci
op_star
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|EEPMOK
c_func
(paren
id|eni_vcc-&gt;rx_pos
comma
id|ENI_PRV_SIZE
c_func
(paren
id|skb
)paren
comma
(paren
id|readl
c_func
(paren
id|vci_dsc
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_READ
)paren
op_rshift
id|MID_VCI_READ_SHIFT
comma
id|eni_vcc-&gt;words
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;requeuing&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|eni_dev-&gt;rx_queue
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|eni_vcc-&gt;rxing
op_decrement
suffix:semicolon
id|eni_vcc-&gt;rx_pos
op_assign
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
op_amp
(paren
id|eni_vcc-&gt;words
op_minus
l_int|1
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|ENI_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;len
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_else
(brace
id|EVENT
c_func
(paren
l_string|&quot;pushing (len=%ld)&bslash;n&quot;
comma
id|skb-&gt;len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_star
(paren
r_int
r_int
op_star
)paren
id|skb-&gt;data
op_assign
id|ntohl
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|memset
c_func
(paren
id|skb-&gt;cb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|eni_skb_prv
)paren
)paren
suffix:semicolon
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|pushed
op_increment
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
)brace
id|wake_up
c_func
(paren
op_amp
id|eni_dev-&gt;rx_wait
)paren
suffix:semicolon
)brace
DECL|function|open_rx_first
r_static
r_int
id|open_rx_first
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;open_rx_first&bslash;n&quot;
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|eni_vcc-&gt;rx
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_eq
id|ATM_NONE
)paren
r_return
l_int|0
suffix:semicolon
id|size
op_assign
id|vcc-&gt;qos.rxtp.max_sdu
op_star
id|eni_dev-&gt;rx_mult
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|MID_MAX_BUF_SIZE
op_logical_and
id|vcc-&gt;qos.rxtp.max_sdu
op_le
id|MID_MAX_BUF_SIZE
)paren
id|size
op_assign
id|MID_MAX_BUF_SIZE
suffix:semicolon
id|eni_vcc-&gt;recv
op_assign
id|eni_alloc_mem
c_func
(paren
id|eni_dev
comma
op_amp
id|size
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;rx at 0x%lx&bslash;n&quot;
comma
id|eni_vcc-&gt;recv
)paren
suffix:semicolon
id|eni_vcc-&gt;words
op_assign
id|size
op_rshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;recv
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|eni_vcc-&gt;rx
op_assign
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
ques
c_cond
id|rx_aal5
suffix:colon
id|rx_aal0
suffix:semicolon
id|eni_vcc-&gt;descr
op_assign
l_int|0
suffix:semicolon
id|eni_vcc-&gt;rx_pos
op_assign
l_int|0
suffix:semicolon
id|eni_vcc-&gt;rxing
op_assign
l_int|0
suffix:semicolon
id|eni_vcc-&gt;servicing
op_assign
l_int|0
suffix:semicolon
id|eni_vcc-&gt;next
op_assign
id|ENI_VCC_NOS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|open_rx_second
r_static
r_int
id|open_rx_second
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
r_int
id|here
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_int
id|order
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;open_rx_second&bslash;n&quot;
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;rx
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* set up VCI descriptor */
id|here
op_assign
id|eni_dev-&gt;vci
op_plus
id|vcc-&gt;vci
op_star
l_int|16
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;loc 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|eni_vcc-&gt;recv
op_minus
id|eni_dev-&gt;ram
)paren
op_div
l_int|4
)paren
suffix:semicolon
id|size
op_assign
id|eni_vcc-&gt;words
op_rshift
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
op_minus
l_int|1
suffix:semicolon
id|size
suffix:semicolon
id|order
op_increment
)paren
id|size
op_rshift_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|here
op_plus
l_int|4
)paren
suffix:semicolon
multiline_comment|/* descr, read = 0 */
id|writel
c_func
(paren
l_int|0
comma
id|here
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* write, state, count = 0 */
r_if
c_cond
(paren
id|eni_dev-&gt;rx_map
(braket
id|vcc-&gt;vci
)braket
)paren
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): BUG - VCI %d already &quot;
l_string|&quot;in use&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|eni_dev-&gt;rx_map
(braket
id|vcc-&gt;vci
)braket
op_assign
id|vcc
suffix:semicolon
multiline_comment|/* now it counts */
id|writel
c_func
(paren
(paren
(paren
id|vcc-&gt;qos.aal
op_ne
id|ATM_AAL5
ques
c_cond
id|MID_MODE_RAW
suffix:colon
id|MID_MODE_AAL5
)paren
op_lshift
id|MID_VCI_MODE_SHIFT
)paren
op_or
id|MID_VCI_PTI_MODE
op_or
(paren
(paren
(paren
id|eni_vcc-&gt;recv
op_minus
id|eni_dev-&gt;ram
)paren
op_rshift
(paren
id|MID_LOC_SKIP
op_plus
l_int|2
)paren
)paren
op_lshift
id|MID_VCI_LOCATION_SHIFT
)paren
op_or
(paren
id|order
op_lshift
id|MID_VCI_SIZE_SHIFT
)paren
comma
id|here
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|close_rx
r_static
r_void
id|close_rx
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|here
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;rx
)paren
r_return
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;vpi
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vcc-&gt;vci
op_ne
id|ATM_VCI_UNSPEC
)paren
(brace
id|here
op_assign
id|eni_dev-&gt;vci
op_plus
id|vcc-&gt;vci
op_star
l_int|16
suffix:semicolon
multiline_comment|/* block receiver */
id|writel
c_func
(paren
(paren
id|readl
c_func
(paren
id|here
)paren
op_amp
op_complement
id|MID_VCI_MODE
)paren
op_or
(paren
id|MID_MODE_TRASH
op_lshift
id|MID_VCI_MODE_SHIFT
)paren
comma
id|here
)paren
suffix:semicolon
multiline_comment|/* wait for receiver to become idle */
id|udelay
c_func
(paren
l_int|27
)paren
suffix:semicolon
multiline_comment|/* discard pending cell */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|here
)paren
op_amp
op_complement
id|MID_VCI_IN_SERVICE
comma
id|here
)paren
suffix:semicolon
multiline_comment|/* don&squot;t accept any new ones */
id|eni_dev-&gt;rx_map
(braket
id|vcc-&gt;vci
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* wait for RX queue to drain */
id|DPRINTK
c_func
(paren
l_string|&quot;eni_close: waiting for RX ...&bslash;n&quot;
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;RX closing&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|eni_dev-&gt;rx_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
multiline_comment|/* transition service-&gt;rx: rxing++, servicing-- */
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;servicing
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;rxing
)paren
r_break
suffix:semicolon
)brace
id|EVENT
c_func
(paren
l_string|&quot;drain PDUs (rx %ld, serv %ld)&bslash;n&quot;
comma
id|eni_vcc-&gt;rxing
comma
id|eni_vcc-&gt;servicing
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%d+%d RX left&bslash;n&quot;
comma
id|eni_vcc-&gt;servicing
comma
id|eni_vcc-&gt;rxing
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
id|at_end
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|tasklet_disable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
id|tmp
op_assign
id|readl
c_func
(paren
id|eni_dev-&gt;vci
op_plus
id|vcc-&gt;vci
op_star
l_int|16
op_plus
l_int|4
)paren
op_amp
id|MID_VCI_READ
suffix:semicolon
id|at_end
op_assign
id|eni_vcc-&gt;rx_pos
op_eq
id|tmp
op_rshift
id|MID_VCI_READ_SHIFT
suffix:semicolon
id|tasklet_enable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
r_if
c_cond
(paren
id|at_end
)paren
r_break
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;drain discard (host 0x%lx, nic 0x%lx)&bslash;n&quot;
comma
id|eni_vcc-&gt;rx_pos
comma
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;draining RX: host 0x%lx, nic 0x%x&bslash;n&quot;
comma
id|eni_vcc-&gt;rx_pos
comma
id|tmp
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|eni_dev-&gt;rx_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
id|eni_free_mem
c_func
(paren
id|eni_dev
comma
id|eni_vcc-&gt;recv
comma
id|eni_vcc-&gt;words
op_lshift
l_int|2
)paren
suffix:semicolon
id|eni_vcc-&gt;rx
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|start_rx
r_static
r_int
id|start_rx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|eni_dev-&gt;rx_map
op_assign
(paren
r_struct
id|atm_vcc
op_star
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_dev-&gt;rx_map
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): couldn&squot;t get free page&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|eni_dev-&gt;free_list
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|eni_dev-&gt;rx_map
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|eni_dev-&gt;rx_mult
op_assign
id|DEFAULT_RX_MULT
suffix:semicolon
id|eni_dev-&gt;fast
op_assign
id|eni_dev-&gt;last_fast
op_assign
l_int|NULL
suffix:semicolon
id|eni_dev-&gt;slow
op_assign
id|eni_dev-&gt;last_slow
op_assign
l_int|NULL
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|eni_dev-&gt;rx_wait
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|eni_dev-&gt;rx_queue
)paren
suffix:semicolon
id|eni_dev-&gt;serv_read
op_assign
id|eni_in
c_func
(paren
id|MID_SERV_WRITE
)paren
suffix:semicolon
id|eni_out
c_func
(paren
l_int|0
comma
id|MID_DMA_WR_RX
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*----------------------------------- TX ------------------------------------*/
DECL|enum|enq_res
DECL|enumerator|enq_ok
DECL|enumerator|enq_next
DECL|enumerator|enq_jam
r_enum
id|enq_res
(brace
id|enq_ok
comma
id|enq_next
comma
id|enq_jam
)brace
suffix:semicolon
DECL|function|put_dma
r_static
r_inline
r_void
id|put_dma
c_func
(paren
r_int
id|chan
comma
id|u32
op_star
id|dma
comma
r_int
op_star
id|j
comma
id|dma_addr_t
id|paddr
comma
id|u32
id|size
)paren
(brace
id|u32
id|init
comma
id|words
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: 0x%lx+0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|size
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;put_dma: 0x%lx+0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|size
)paren
suffix:semicolon
macro_line|#if 0 /* don&squot;t complain anymore */
r_if
c_cond
(paren
id|paddr
op_amp
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;put_dma: unaligned addr (0x%lx)&bslash;n&quot;
comma
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_amp
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;put_dma: unaligned size (0x%lx)&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|paddr
op_amp
l_int|3
)paren
(brace
id|init
op_assign
l_int|4
op_minus
(paren
id|paddr
op_amp
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init
OG
id|size
op_logical_or
id|size
OL
l_int|7
)paren
id|init
op_assign
id|size
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d/%d bytes&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|init
comma
id|size
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_BYTE
op_or
(paren
id|init
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
id|init
suffix:semicolon
id|size
op_sub_assign
id|init
suffix:semicolon
)brace
id|words
op_assign
id|size
op_rshift
l_int|2
suffix:semicolon
id|size
op_and_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|words
op_logical_and
(paren
id|paddr
op_amp
l_int|31
)paren
)paren
(brace
id|init
op_assign
l_int|8
op_minus
(paren
(paren
id|paddr
op_amp
l_int|31
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init
OG
id|words
)paren
id|init
op_assign
id|words
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d/%d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|init
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_WORD
op_or
(paren
id|init
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
id|init
op_lshift
l_int|2
suffix:semicolon
id|words
op_sub_assign
id|init
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_16W /* may work with some PCI chipsets ... */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|15
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d*16/%d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|words
op_rshift
l_int|4
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_16W
op_or
(paren
(paren
id|words
op_rshift
l_int|4
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|15
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|15
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_8W /* recommended */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|7
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d*8/%d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|words
op_rshift
l_int|3
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_8W
op_or
(paren
(paren
id|words
op_rshift
l_int|3
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|7
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|7
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_4W /* probably useless if TX_8W or TX_16W */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|3
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d*4/%d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|words
op_rshift
l_int|2
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_4W
op_or
(paren
(paren
id|words
op_rshift
l_int|2
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|3
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|3
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_2W /* probably useless if TX_4W, TX_8W, ... */
r_if
c_cond
(paren
id|words
op_amp
op_complement
l_int|1
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d*2/%d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|words
op_rshift
l_int|1
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_2W
op_or
(paren
(paren
id|words
op_rshift
l_int|1
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
(paren
id|words
op_amp
op_complement
l_int|1
)paren
op_lshift
l_int|2
suffix:semicolon
id|words
op_and_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|words
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d words&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|words
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_WORD
op_or
(paren
id|words
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
id|paddr
op_add_assign
id|words
op_lshift
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;put_dma: %lx DMA: %d bytes&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|size
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|MID_DT_BYTE
op_or
(paren
id|size
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|chan
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
suffix:semicolon
id|dma
(braket
(paren
op_star
id|j
)paren
op_increment
)braket
op_assign
id|paddr
suffix:semicolon
)brace
)brace
DECL|function|do_tx
r_static
r_enum
id|enq_res
id|do_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_struct
id|eni_tx
op_star
id|tx
suffix:semicolon
id|dma_addr_t
id|paddr
suffix:semicolon
id|u32
id|dma_rd
comma
id|dma_wr
suffix:semicolon
id|u32
id|size
suffix:semicolon
multiline_comment|/* in words */
r_int
id|aal5
comma
id|dma_size
comma
id|i
comma
id|j
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;do_tx&bslash;n&quot;
)paren
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|skb
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;do_tx: skb=0x%lx, %ld bytes&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|eni_dev
)paren
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|tx
op_assign
id|eni_vcc-&gt;tx
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|tx
)paren
suffix:semicolon
macro_line|#if 0 /* Enable this for testing with the &quot;align&quot; program */
(brace
r_int
r_int
id|hack
op_assign
op_star
(paren
(paren
r_char
op_star
)paren
id|skb-&gt;data
)paren
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|hack
OL
l_int|8
)paren
(brace
id|skb-&gt;data
op_add_assign
id|hack
suffix:semicolon
id|skb-&gt;len
op_sub_assign
id|hack
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if 0 /* should work now */
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|skb-&gt;data
op_amp
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): VCI %d has mis-aligned &quot;
l_string|&quot;TX data&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Potential future IP speedup: make hard_header big enough to put&n;&t; * segmentation descriptor directly into PDU. Saves: 4 slave writes,&n;&t; * 1 DMA xfer &amp; 2 DMA&squot;ed bytes (protocol layering is for wimps :-)&n;&t; */
id|aal5
op_assign
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
suffix:semicolon
multiline_comment|/* check space in buffer */
r_if
c_cond
(paren
op_logical_neg
id|aal5
)paren
id|size
op_assign
(paren
id|ATM_CELL_PAYLOAD
op_rshift
l_int|2
)paren
op_plus
id|TX_DESCR_SIZE
suffix:semicolon
multiline_comment|/* cell without HEC plus segmentation header (includes&n;&t;&t;&t;   four-byte cell header) */
r_else
(brace
id|size
op_assign
id|skb-&gt;len
op_plus
l_int|4
op_star
id|AAL5_TRAILER
op_plus
id|ATM_CELL_PAYLOAD
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* add AAL5 trailer */
id|size
op_assign
(paren
(paren
id|size
op_minus
(paren
id|size
op_mod
id|ATM_CELL_PAYLOAD
)paren
)paren
op_rshift
l_int|2
)paren
op_plus
id|TX_DESCR_SIZE
suffix:semicolon
multiline_comment|/* add segmentation header */
)brace
multiline_comment|/*&n;&t; * Can I move tx_pos by size bytes without getting closer than TX_GAP&n;&t; * to the read pointer ? TX_GAP means to leave some space for what&n;&t; * the manual calls &quot;too close&quot;.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|NEPMOK
c_func
(paren
id|tx-&gt;tx_pos
comma
id|size
op_plus
id|TX_GAP
comma
id|eni_in
c_func
(paren
id|MID_TX_RDPTR
c_func
(paren
id|tx-&gt;index
)paren
)paren
comma
id|tx-&gt;words
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;(itf %d): TX full (size %d)&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|size
)paren
suffix:semicolon
r_return
id|enq_next
suffix:semicolon
)brace
multiline_comment|/* check DMA */
id|dma_wr
op_assign
id|eni_in
c_func
(paren
id|MID_DMA_WR_TX
)paren
suffix:semicolon
id|dma_rd
op_assign
id|eni_in
c_func
(paren
id|MID_DMA_RD_TX
)paren
suffix:semicolon
id|dma_size
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* JK for descriptor and final fill, plus final size&n;&t;&t;&t; mis-alignment fix */
id|DPRINTK
c_func
(paren
l_string|&quot;iovcnt = %d&bslash;n&quot;
comma
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
)paren
id|dma_size
op_add_assign
l_int|5
suffix:semicolon
r_else
id|dma_size
op_add_assign
l_int|5
op_star
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
suffix:semicolon
r_if
c_cond
(paren
id|dma_size
OG
id|TX_DMA_BUF
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): needs %d DMA entries &quot;
l_string|&quot;(got only %d)&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|dma_size
comma
id|TX_DMA_BUF
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;dma_wr is %d, tx_pos is %ld&bslash;n&quot;
comma
id|dma_wr
comma
id|tx-&gt;tx_pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma_wr
op_ne
id|dma_rd
op_logical_and
(paren
(paren
id|dma_rd
op_plus
id|NR_DMA_TX
op_minus
id|dma_wr
)paren
op_amp
(paren
id|NR_DMA_TX
op_minus
l_int|1
)paren
)paren
OL
id|dma_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|DEV_LABEL
l_string|&quot;(itf %d): TX DMA full&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
)paren
suffix:semicolon
r_return
id|enq_jam
suffix:semicolon
)brace
id|paddr
op_assign
id|pci_map_single
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|ENI_PRV_PADDR
c_func
(paren
id|skb
)paren
op_assign
id|paddr
suffix:semicolon
multiline_comment|/* prepare DMA queue entries */
id|j
op_assign
l_int|0
suffix:semicolon
id|eni_dev-&gt;dma
(braket
id|j
op_increment
)braket
op_assign
(paren
(paren
(paren
id|tx-&gt;tx_pos
op_plus
id|TX_DESCR_SIZE
)paren
op_amp
(paren
id|tx-&gt;words
op_minus
l_int|1
)paren
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|tx-&gt;index
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
op_or
id|MID_DT_JK
suffix:semicolon
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
)paren
r_if
c_cond
(paren
id|aal5
)paren
id|put_dma
c_func
(paren
id|tx-&gt;index
comma
id|eni_dev-&gt;dma
comma
op_amp
id|j
comma
id|paddr
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_else
id|put_dma
c_func
(paren
id|tx-&gt;index
comma
id|eni_dev-&gt;dma
comma
op_amp
id|j
comma
id|paddr
op_plus
l_int|4
comma
id|skb-&gt;len
op_minus
l_int|4
)paren
suffix:semicolon
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;doing direct send&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* @@@ well, this doesn&squot;t work anyway */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
suffix:semicolon
id|i
op_increment
)paren
id|put_dma
c_func
(paren
id|tx-&gt;index
comma
id|eni_dev-&gt;dma
comma
op_amp
id|j
comma
(paren
r_int
r_int
)paren
(paren
(paren
r_struct
id|iovec
op_star
)paren
id|skb-&gt;data
)paren
(braket
id|i
)braket
dot
id|iov_base
comma
(paren
(paren
r_struct
id|iovec
op_star
)paren
id|skb-&gt;data
)paren
(braket
id|i
)braket
dot
id|iov_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
op_amp
l_int|3
)paren
id|put_dma
c_func
(paren
id|tx-&gt;index
comma
id|eni_dev-&gt;dma
comma
op_amp
id|j
comma
id|zeroes
comma
l_int|4
op_minus
(paren
id|skb-&gt;len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
multiline_comment|/* JK for AAL5 trailer - AAL0 doesn&squot;t need it, but who cares ... */
id|eni_dev-&gt;dma
(braket
id|j
op_increment
)braket
op_assign
(paren
(paren
(paren
id|tx-&gt;tx_pos
op_plus
id|size
)paren
op_amp
(paren
id|tx-&gt;words
op_minus
l_int|1
)paren
)paren
op_lshift
id|MID_DMA_COUNT_SHIFT
)paren
op_or
(paren
id|tx-&gt;index
op_lshift
id|MID_DMA_CHAN_SHIFT
)paren
op_or
id|MID_DMA_END
op_or
id|MID_DT_JK
suffix:semicolon
id|j
op_increment
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;DMA at end: %d&bslash;n&quot;
comma
id|j
)paren
suffix:semicolon
multiline_comment|/* store frame */
id|writel
c_func
(paren
(paren
id|MID_SEG_TX_ID
op_lshift
id|MID_SEG_ID_SHIFT
)paren
op_or
(paren
id|aal5
ques
c_cond
id|MID_SEG_AAL5
suffix:colon
l_int|0
)paren
op_or
(paren
id|tx-&gt;prescaler
op_lshift
id|MID_SEG_PR_SHIFT
)paren
op_or
(paren
id|tx-&gt;resolution
op_lshift
id|MID_SEG_RATE_SHIFT
)paren
op_or
(paren
id|size
op_div
(paren
id|ATM_CELL_PAYLOAD
op_div
l_int|4
)paren
)paren
comma
id|tx-&gt;send
op_plus
id|tx-&gt;tx_pos
op_star
l_int|4
)paren
suffix:semicolon
multiline_comment|/*printk(&quot;dsc = 0x%08lx&bslash;n&quot;,(unsigned long) readl(tx-&gt;send+tx-&gt;tx_pos*4));*/
id|writel
c_func
(paren
(paren
id|vcc-&gt;vci
op_lshift
id|MID_SEG_VCI_SHIFT
)paren
op_or
(paren
id|aal5
ques
c_cond
l_int|0
suffix:colon
(paren
id|skb-&gt;data
(braket
l_int|3
)braket
op_amp
l_int|0xf
)paren
)paren
op_or
(paren
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|atm_options
op_amp
id|ATM_ATMOPT_CLP
ques
c_cond
id|MID_SEG_CLP
suffix:colon
l_int|0
)paren
comma
id|tx-&gt;send
op_plus
(paren
(paren
id|tx-&gt;tx_pos
op_plus
l_int|1
)paren
op_amp
(paren
id|tx-&gt;words
op_minus
l_int|1
)paren
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;size: %d, len:%d&bslash;n&quot;
comma
id|size
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aal5
)paren
id|writel
c_func
(paren
id|skb-&gt;len
comma
id|tx-&gt;send
op_plus
(paren
(paren
id|tx-&gt;tx_pos
op_plus
id|size
op_minus
id|AAL5_TRAILER
)paren
op_amp
(paren
id|tx-&gt;words
op_minus
l_int|1
)paren
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|j
op_assign
id|j
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writel
c_func
(paren
id|eni_dev-&gt;dma
(braket
id|i
op_star
l_int|2
)braket
comma
id|eni_dev-&gt;tx_dma
op_plus
id|dma_wr
op_star
l_int|8
)paren
suffix:semicolon
id|writel
c_func
(paren
id|eni_dev-&gt;dma
(braket
id|i
op_star
l_int|2
op_plus
l_int|1
)braket
comma
id|eni_dev-&gt;tx_dma
op_plus
id|dma_wr
op_star
l_int|8
op_plus
l_int|4
)paren
suffix:semicolon
id|dma_wr
op_assign
(paren
id|dma_wr
op_plus
l_int|1
)paren
op_amp
(paren
id|NR_DMA_TX
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
op_assign
id|tx-&gt;tx_pos
suffix:semicolon
id|ENI_PRV_SIZE
c_func
(paren
id|skb
)paren
op_assign
id|size
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|txing
op_add_assign
id|size
suffix:semicolon
id|tx-&gt;tx_pos
op_assign
(paren
id|tx-&gt;tx_pos
op_plus
id|size
)paren
op_amp
(paren
id|tx-&gt;words
op_minus
l_int|1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;dma_wr set to %d, tx_pos is now %ld&bslash;n&quot;
comma
id|dma_wr
comma
id|tx-&gt;tx_pos
)paren
suffix:semicolon
id|eni_out
c_func
(paren
id|dma_wr
comma
id|MID_DMA_WR_TX
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|eni_dev-&gt;tx_queue
comma
id|skb
)paren
suffix:semicolon
id|queued
op_increment
suffix:semicolon
r_return
id|enq_ok
suffix:semicolon
)brace
DECL|function|poll_tx
r_static
r_void
id|poll_tx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_tx
op_star
id|tx
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_enum
id|enq_res
id|res
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;poll_tx&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|NR_CHAN
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tx
op_assign
op_amp
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|tx
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tx-&gt;send
)paren
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|tx-&gt;backlog
)paren
)paren
)paren
(brace
id|res
op_assign
id|do_tx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
id|enq_ok
)paren
r_continue
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;re-queuing TX PDU&bslash;n&quot;
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|tx-&gt;backlog
comma
id|skb
)paren
suffix:semicolon
id|requeued
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
id|enq_jam
)paren
r_return
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|dequeue_tx
r_static
r_void
id|dequeue_tx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|eni_tx
op_star
id|tx
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|dev
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|eni_dev
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|eni_dev-&gt;tx_queue
)paren
)paren
)paren
(brace
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|tx
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx
suffix:semicolon
id|NULLCHECK
c_func
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;dequeue_tx: next 0x%lx curr 0x%x&bslash;n&quot;
comma
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
comma
(paren
r_int
)paren
id|eni_in
c_func
(paren
id|MID_TX_DESCRSTART
c_func
(paren
id|tx-&gt;index
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|txing
OL
id|tx-&gt;words
op_logical_and
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
op_eq
id|eni_in
c_func
(paren
id|MID_TX_DESCRSTART
c_func
(paren
id|tx-&gt;index
)paren
)paren
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|eni_dev-&gt;tx_queue
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|txing
op_sub_assign
id|ENI_PRV_SIZE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|ENI_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|eni_dev-&gt;tx_wait
)paren
suffix:semicolon
id|dma_complete
op_increment
suffix:semicolon
)brace
)brace
DECL|function|alloc_tx
r_static
r_struct
id|eni_tx
op_star
id|alloc_tx
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
comma
r_int
id|ubr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
op_logical_neg
id|ubr
suffix:semicolon
id|i
OL
id|NR_CHAN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|send
)paren
r_return
id|eni_dev-&gt;tx
op_plus
id|i
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|comp_tx
r_static
r_int
id|comp_tx
c_func
(paren
r_struct
id|eni_dev
op_star
id|eni_dev
comma
r_int
op_star
id|pcr
comma
r_int
id|reserved
comma
r_int
op_star
id|pre
comma
r_int
op_star
id|res
comma
r_int
id|unlimited
)paren
(brace
r_static
r_const
r_int
id|pre_div
(braket
)braket
op_assign
(brace
l_int|4
comma
l_int|16
comma
l_int|128
comma
l_int|2048
)brace
suffix:semicolon
multiline_comment|/* 2^(((x+2)^2-(x+2))/2+1) */
r_if
c_cond
(paren
id|unlimited
)paren
op_star
id|pre
op_assign
op_star
id|res
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_star
id|pcr
OG
l_int|0
)paren
(brace
r_int
id|div
suffix:semicolon
r_for
c_loop
(paren
op_star
id|pre
op_assign
l_int|0
suffix:semicolon
op_star
id|pre
OL
l_int|3
suffix:semicolon
(paren
op_star
id|pre
)paren
op_increment
)paren
r_if
c_cond
(paren
id|TS_CLOCK
op_div
id|pre_div
(braket
op_star
id|pre
)braket
op_div
l_int|64
op_le
op_star
id|pcr
)paren
r_break
suffix:semicolon
id|div
op_assign
id|pre_div
(braket
op_star
id|pre
)braket
op_star
op_star
id|pcr
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;min div %d&bslash;n&quot;
comma
id|div
)paren
suffix:semicolon
op_star
id|res
op_assign
id|TS_CLOCK
op_div
id|div
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
id|div
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|pcr
)paren
op_star
id|pcr
op_assign
id|eni_dev-&gt;tx_bw
op_plus
id|reserved
suffix:semicolon
r_for
c_loop
(paren
op_star
id|pre
op_assign
l_int|3
suffix:semicolon
op_star
id|pre
op_ge
l_int|0
suffix:semicolon
(paren
op_star
id|pre
)paren
op_decrement
)paren
r_if
c_cond
(paren
id|TS_CLOCK
op_div
id|pre_div
(braket
op_star
id|pre
)braket
op_div
l_int|64
OG
op_minus
op_star
id|pcr
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pre
OL
l_int|3
)paren
(paren
op_star
id|pre
)paren
op_increment
suffix:semicolon
multiline_comment|/* else fail later */
id|div
op_assign
id|pre_div
(braket
op_star
id|pre
)braket
op_star
op_minus
op_star
id|pcr
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;max div %d&bslash;n&quot;
comma
id|div
)paren
suffix:semicolon
op_star
id|res
op_assign
(paren
id|TS_CLOCK
op_plus
id|div
op_minus
l_int|1
)paren
op_div
id|div
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|res
OL
l_int|0
)paren
op_star
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
OG
id|MID_SEG_MAX_RATE
)paren
op_star
id|res
op_assign
id|MID_SEG_MAX_RATE
suffix:semicolon
)brace
op_star
id|pcr
op_assign
id|TS_CLOCK
op_div
id|pre_div
(braket
op_star
id|pre
)braket
op_div
(paren
op_star
id|res
op_plus
l_int|1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;out pcr: %d (%d:%d)&bslash;n&quot;
comma
op_star
id|pcr
comma
op_star
id|pre
comma
op_star
id|res
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|reserve_or_set_tx
r_static
r_int
id|reserve_or_set_tx
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_trafprm
op_star
id|txtp
comma
r_int
id|set_rsv
comma
r_int
id|set_shp
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_struct
id|eni_tx
op_star
id|tx
suffix:semicolon
r_int
r_int
id|size
comma
id|mem
suffix:semicolon
r_int
id|rate
comma
id|ubr
comma
id|unlimited
comma
id|new_tx
suffix:semicolon
r_int
id|pre
comma
id|res
comma
id|order
suffix:semicolon
r_int
id|error
suffix:semicolon
id|rate
op_assign
id|atm_pcr_goal
c_func
(paren
id|txtp
)paren
suffix:semicolon
id|ubr
op_assign
id|txtp-&gt;traffic_class
op_eq
id|ATM_UBR
suffix:semicolon
id|unlimited
op_assign
id|ubr
op_logical_and
(paren
op_logical_neg
id|rate
op_logical_or
id|rate
op_le
op_minus
id|ATM_OC3_PCR
op_logical_or
id|rate
op_ge
id|ATM_OC3_PCR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|unlimited
)paren
(brace
id|size
op_assign
id|txtp-&gt;max_sdu
op_star
id|eni_dev-&gt;tx_mult
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|MID_MAX_BUF_SIZE
op_logical_and
id|txtp-&gt;max_sdu
op_le
id|MID_MAX_BUF_SIZE
)paren
id|size
op_assign
id|MID_MAX_BUF_SIZE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|eni_dev-&gt;ubr
)paren
(brace
id|eni_vcc-&gt;tx
op_assign
id|eni_dev-&gt;ubr
suffix:semicolon
id|txtp-&gt;pcr
op_assign
id|ATM_OC3_PCR
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|size
op_assign
id|UBR_BUFFER
suffix:semicolon
)brace
id|new_tx
op_assign
op_logical_neg
id|eni_vcc-&gt;tx
suffix:semicolon
id|mem
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* for gcc */
r_if
c_cond
(paren
op_logical_neg
id|new_tx
)paren
id|tx
op_assign
id|eni_vcc-&gt;tx
suffix:semicolon
r_else
(brace
id|mem
op_assign
id|eni_alloc_mem
c_func
(paren
id|eni_dev
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|tx
op_assign
id|alloc_tx
c_func
(paren
id|eni_dev
comma
id|unlimited
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx
)paren
(brace
id|eni_free_mem
c_func
(paren
id|eni_dev
comma
id|mem
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;got chan %d&bslash;n&quot;
comma
id|tx-&gt;index
)paren
suffix:semicolon
id|tx-&gt;reserved
op_assign
id|tx-&gt;shaping
op_assign
l_int|0
suffix:semicolon
id|tx-&gt;send
op_assign
id|mem
suffix:semicolon
id|tx-&gt;words
op_assign
id|size
op_rshift
l_int|2
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|tx-&gt;backlog
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
id|size
OG
(paren
l_int|1
op_lshift
(paren
id|order
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|order
op_increment
)paren
suffix:semicolon
id|eni_out
c_func
(paren
(paren
id|order
op_lshift
id|MID_SIZE_SHIFT
)paren
op_or
(paren
(paren
id|tx-&gt;send
op_minus
id|eni_dev-&gt;ram
)paren
op_rshift
(paren
id|MID_LOC_SKIP
op_plus
l_int|2
)paren
)paren
comma
id|MID_TX_PLACE
c_func
(paren
id|tx-&gt;index
)paren
)paren
suffix:semicolon
id|tx-&gt;tx_pos
op_assign
id|eni_in
c_func
(paren
id|MID_TX_DESCRSTART
c_func
(paren
id|tx-&gt;index
)paren
)paren
op_amp
id|MID_DESCR_START
suffix:semicolon
)brace
id|error
op_assign
id|comp_tx
c_func
(paren
id|eni_dev
comma
op_amp
id|rate
comma
id|tx-&gt;reserved
comma
op_amp
id|pre
comma
op_amp
id|res
comma
id|unlimited
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
id|txtp-&gt;min_pcr
OG
id|rate
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
id|txtp-&gt;max_pcr
op_logical_and
id|txtp-&gt;max_pcr
op_ne
id|ATM_MAX_PCR
op_logical_and
id|txtp-&gt;max_pcr
OL
id|rate
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
op_logical_neg
id|ubr
op_logical_and
id|rate
OG
id|eni_dev-&gt;tx_bw
op_plus
id|tx-&gt;reserved
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
id|set_rsv
op_logical_and
op_logical_neg
id|set_shp
op_logical_and
id|rate
OL
id|tx-&gt;shaping
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
op_logical_neg
id|set_rsv
op_logical_and
id|rate
OG
id|tx-&gt;reserved
op_logical_and
op_logical_neg
id|ubr
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_if
c_cond
(paren
id|new_tx
)paren
(brace
id|tx-&gt;send
op_assign
l_int|0
suffix:semicolon
id|eni_free_mem
c_func
(paren
id|eni_dev
comma
id|mem
comma
id|size
)paren
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
id|txtp-&gt;pcr
op_assign
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|set_rsv
op_logical_and
op_logical_neg
id|ubr
)paren
(brace
id|eni_dev-&gt;tx_bw
op_add_assign
id|tx-&gt;reserved
suffix:semicolon
id|tx-&gt;reserved
op_assign
id|rate
suffix:semicolon
id|eni_dev-&gt;tx_bw
op_sub_assign
id|rate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set_shp
op_logical_or
(paren
id|unlimited
op_logical_and
id|new_tx
)paren
)paren
(brace
r_if
c_cond
(paren
id|unlimited
op_logical_and
id|new_tx
)paren
id|eni_dev-&gt;ubr
op_assign
id|tx
suffix:semicolon
id|tx-&gt;prescaler
op_assign
id|pre
suffix:semicolon
id|tx-&gt;resolution
op_assign
id|res
suffix:semicolon
id|tx-&gt;shaping
op_assign
id|rate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set_shp
)paren
id|eni_vcc-&gt;tx
op_assign
id|tx
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;rsv %d shp %d&bslash;n&quot;
comma
id|tx-&gt;reserved
comma
id|tx-&gt;shaping
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|open_tx_first
r_static
r_int
id|open_tx_first
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_NONE
)paren
r_return
l_int|0
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|txing
op_assign
l_int|0
suffix:semicolon
r_return
id|reserve_or_set_tx
c_func
(paren
id|vcc
comma
op_amp
id|vcc-&gt;qos.txtp
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|open_tx_second
r_static
r_int
id|open_tx_second
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing to do */
)brace
DECL|function|close_tx
r_static
r_void
id|close_tx
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc-&gt;tx
)paren
r_return
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* wait for TX queue to drain */
id|DPRINTK
c_func
(paren
l_string|&quot;eni_close: waiting for TX ...&bslash;n&quot;
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|eni_dev-&gt;tx_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
id|txing
suffix:semicolon
id|tasklet_disable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
id|txing
op_assign
id|skb_peek
c_func
(paren
op_amp
id|eni_vcc-&gt;tx-&gt;backlog
)paren
op_logical_or
id|eni_vcc-&gt;txing
suffix:semicolon
id|tasklet_enable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|txing
)paren
r_break
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%d TX left&bslash;n&quot;
comma
id|eni_vcc-&gt;txing
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|eni_dev-&gt;tx_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eni_vcc-&gt;tx
op_ne
id|eni_dev-&gt;ubr
)paren
(brace
multiline_comment|/*&n;&t;&t; * Looping a few times in here is probably far cheaper than&n;&t;&t; * keeping track of TX completions all the time, so let&squot;s poll&n;&t;&t; * a bit ...&n;&t;&t; */
r_while
c_loop
(paren
id|eni_in
c_func
(paren
id|MID_TX_RDPTR
c_func
(paren
id|eni_vcc-&gt;tx-&gt;index
)paren
)paren
op_ne
id|eni_in
c_func
(paren
id|MID_TX_DESCRSTART
c_func
(paren
id|eni_vcc-&gt;tx-&gt;index
)paren
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|eni_free_mem
c_func
(paren
id|eni_dev
comma
id|eni_vcc-&gt;tx-&gt;send
comma
id|eni_vcc-&gt;tx-&gt;words
op_lshift
l_int|2
)paren
suffix:semicolon
id|eni_vcc-&gt;tx-&gt;send
op_assign
l_int|0
suffix:semicolon
id|eni_dev-&gt;tx_bw
op_add_assign
id|eni_vcc-&gt;tx-&gt;reserved
suffix:semicolon
)brace
id|eni_vcc-&gt;tx
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_int
id|i
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|eni_dev-&gt;lost
op_assign
l_int|0
suffix:semicolon
id|eni_dev-&gt;tx_bw
op_assign
id|ATM_OC3_PCR
suffix:semicolon
id|eni_dev-&gt;tx_mult
op_assign
id|DEFAULT_TX_MULT
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|eni_dev-&gt;tx_wait
)paren
suffix:semicolon
id|eni_dev-&gt;ubr
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|eni_dev-&gt;tx_queue
)paren
suffix:semicolon
id|eni_out
c_func
(paren
l_int|0
comma
id|MID_DMA_WR_TX
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CHAN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|send
op_assign
l_int|0
suffix:semicolon
id|eni_dev-&gt;tx
(braket
id|i
)braket
dot
id|index
op_assign
id|i
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------- common ----------------------------------*/
macro_line|#if 0 /* may become useful again when tuning things */
r_static
r_void
id|foo
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tx_complete=%d,dma_complete=%d,queued=%d,requeued=%d,sub=%d,&bslash;n&quot;
l_string|&quot;backlogged=%d,rx_enqueued=%d,rx_dequeued=%d,putting=%d,pushed=%d&bslash;n&quot;
comma
id|tx_complete
comma
id|dma_complete
comma
id|queued
comma
id|requeued
comma
id|submitted
comma
id|backlogged
comma
id|rx_enqueued
comma
id|rx_dequeued
comma
id|putting
comma
id|pushed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eni_boards
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;loss: %ld&bslash;n&quot;
comma
id|ENI_DEV
c_func
(paren
id|eni_boards
)paren
op_member_access_from_pointer
id|lost
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|bug_int
r_static
r_void
id|bug_int
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|reason
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;bug_int&bslash;n&quot;
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reason
op_amp
id|MID_DMA_ERR_ACK
)paren
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): driver error - DMA &quot;
l_string|&quot;error&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reason
op_amp
id|MID_TX_IDENT_MISM
)paren
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): driver error - ident &quot;
l_string|&quot;mismatch&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reason
op_amp
id|MID_TX_DMA_OVFL
)paren
id|printk
c_func
(paren
id|KERN_CRIT
id|DEV_LABEL
l_string|&quot;(itf %d): driver error - DMA &quot;
l_string|&quot;overflow&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;---dump ends here---&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;---recent events---&bslash;n&quot;
)paren
suffix:semicolon
id|event_dump
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|eni_int
r_static
r_void
id|eni_int
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
id|u32
id|reason
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_int&bslash;n&quot;
)paren
suffix:semicolon
id|dev
op_assign
id|dev_id
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|reason
op_assign
id|eni_in
c_func
(paren
id|MID_ISA
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;: int 0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|reason
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Must handle these two right now, because reading ISA doesn&squot;t clear&n;&t; * them, so they re-occur and we never make it to the tasklet. Since&n;&t; * they&squot;re rare, we don&squot;t mind the occasional invocation of eni_tasklet&n;&t; * with eni_dev-&gt;events == 0.&n;&t; */
r_if
c_cond
(paren
id|reason
op_amp
id|MID_STAT_OVFL
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;stat overflow&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|eni_dev-&gt;lost
op_add_assign
id|eni_in
c_func
(paren
id|MID_STAT
)paren
op_amp
id|MID_OVFL_TRASH
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reason
op_amp
id|MID_SUNI_INT
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;SUNI int&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;phy
op_member_access_from_pointer
id|interrupt
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#if 0
id|foo
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
id|spin_lock
c_func
(paren
op_amp
id|eni_dev-&gt;lock
)paren
suffix:semicolon
id|eni_dev-&gt;events
op_or_assign
id|reason
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|eni_dev-&gt;lock
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
)brace
DECL|function|eni_tasklet
r_static
r_void
id|eni_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
(paren
r_struct
id|atm_dev
op_star
)paren
id|data
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|events
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;eni_tasklet (dev %p)&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eni_dev-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|events
op_assign
id|xchg
c_func
(paren
op_amp
id|eni_dev-&gt;events
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eni_dev-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|MID_RX_DMA_COMPLETE
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;INT: RX DMA complete, starting dequeue_rx&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|dequeue_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;dequeue_rx done, starting poll_rx&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|poll_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;poll_rx done&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* poll_tx ? */
)brace
r_if
c_cond
(paren
id|events
op_amp
id|MID_SERVICE
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;INT: service, starting get_service&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|get_service
c_func
(paren
id|dev
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;get_service done, starting poll_rx&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|poll_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;poll_rx done&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
id|MID_TX_DMA_COMPLETE
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;INT: TX DMA COMPLETE&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|dequeue_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
id|MID_TX_COMPLETE
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;INT: TX COMPLETE&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|tx_complete
op_increment
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|eni_dev-&gt;tx_wait
)paren
suffix:semicolon
multiline_comment|/* poll_rx ? */
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|MID_DMA_ERR_ACK
op_or
id|MID_TX_IDENT_MISM
op_or
id|MID_TX_DMA_OVFL
)paren
)paren
(brace
id|EVENT
c_func
(paren
l_string|&quot;bug interrupt&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bug_int
c_func
(paren
id|dev
comma
id|events
)paren
suffix:semicolon
)brace
id|poll_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*--------------------------------- entries ---------------------------------*/
DECL|variable|__devinitdata
r_static
r_const
r_char
op_star
id|media_name
(braket
)braket
id|__devinitdata
op_assign
(brace
l_string|&quot;MMF&quot;
comma
l_string|&quot;SMF&quot;
comma
l_string|&quot;MMF&quot;
comma
l_string|&quot;03?&quot;
comma
multiline_comment|/*  0- 3 */
l_string|&quot;UTP&quot;
comma
l_string|&quot;05?&quot;
comma
l_string|&quot;06?&quot;
comma
l_string|&quot;07?&quot;
comma
multiline_comment|/*  4- 7 */
l_string|&quot;TAXI&quot;
comma
l_string|&quot;09?&quot;
comma
l_string|&quot;10?&quot;
comma
l_string|&quot;11?&quot;
comma
multiline_comment|/*  8-11 */
l_string|&quot;12?&quot;
comma
l_string|&quot;13?&quot;
comma
l_string|&quot;14?&quot;
comma
l_string|&quot;15?&quot;
comma
multiline_comment|/* 12-15 */
l_string|&quot;MMF&quot;
comma
l_string|&quot;SMF&quot;
comma
l_string|&quot;18?&quot;
comma
l_string|&quot;19?&quot;
comma
multiline_comment|/* 16-19 */
l_string|&quot;UTP&quot;
comma
l_string|&quot;21?&quot;
comma
l_string|&quot;22?&quot;
comma
l_string|&quot;23?&quot;
comma
multiline_comment|/* 20-23 */
l_string|&quot;24?&quot;
comma
l_string|&quot;25?&quot;
comma
l_string|&quot;26?&quot;
comma
l_string|&quot;27?&quot;
comma
multiline_comment|/* 24-27 */
l_string|&quot;28?&quot;
comma
l_string|&quot;29?&quot;
comma
l_string|&quot;30?&quot;
comma
l_string|&quot;31?&quot;
multiline_comment|/* 28-31 */
)brace
suffix:semicolon
DECL|macro|SET_SEPROM
mdefine_line|#define SET_SEPROM &bslash;&n;  ({ if (!error &amp;&amp; !pci_error) { &bslash;&n;    pci_error = pci_write_config_byte(eni_dev-&gt;pci_dev,PCI_TONGA_CTRL,tonga); &bslash;&n;    udelay(10); /* 10 usecs */ &bslash;&n;  } })
DECL|macro|GET_SEPROM
mdefine_line|#define GET_SEPROM &bslash;&n;  ({ if (!error &amp;&amp; !pci_error) { &bslash;&n;    pci_error = pci_read_config_byte(eni_dev-&gt;pci_dev,PCI_TONGA_CTRL,&amp;tonga); &bslash;&n;    udelay(10); /* 10 usecs */ &bslash;&n;  } })
DECL|function|get_esi_asic
r_static
r_int
id|__devinit
id|get_esi_asic
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_int
r_char
id|tonga
suffix:semicolon
r_int
id|error
comma
id|failed
comma
id|pci_error
suffix:semicolon
r_int
id|address
comma
id|i
comma
id|j
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|error
op_assign
id|pci_error
op_assign
l_int|0
suffix:semicolon
id|tonga
op_assign
id|SEPROM_MAGIC
op_or
id|SEPROM_DATA
op_or
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ESI_LEN
op_logical_and
op_logical_neg
id|error
op_logical_and
op_logical_neg
id|pci_error
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* start operation */
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
multiline_comment|/* send address */
id|address
op_assign
(paren
(paren
id|i
op_plus
id|SEPROM_ESI_BASE
)paren
op_lshift
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|7
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|tonga
op_assign
(paren
id|address
op_rshift
id|j
)paren
op_amp
l_int|1
ques
c_cond
id|tonga
op_or
id|SEPROM_DATA
suffix:colon
id|tonga
op_amp
op_complement
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
)brace
multiline_comment|/* get ack */
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|GET_SEPROM
suffix:semicolon
id|failed
op_assign
id|tonga
op_amp
id|SEPROM_DATA
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
r_if
c_cond
(paren
id|failed
)paren
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
(brace
id|dev-&gt;esi
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|7
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|dev-&gt;esi
(braket
id|i
)braket
op_lshift_assign
l_int|1
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|GET_SEPROM
suffix:semicolon
r_if
c_cond
(paren
id|tonga
op_amp
id|SEPROM_DATA
)paren
id|dev-&gt;esi
(braket
id|i
)braket
op_or_assign
l_int|1
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
)brace
multiline_comment|/* get ack */
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|GET_SEPROM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tonga
op_amp
id|SEPROM_DATA
)paren
)paren
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
id|tonga
op_and_assign
op_complement
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
)brace
multiline_comment|/* stop operation */
id|tonga
op_and_assign
op_complement
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_CLK
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
id|tonga
op_or_assign
id|SEPROM_DATA
suffix:semicolon
id|SET_SEPROM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_error
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): error reading ESI &quot;
l_string|&quot;(0x%02x)&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|pci_error
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
DECL|macro|SET_SEPROM
macro_line|#undef SET_SEPROM
DECL|macro|GET_SEPROM
macro_line|#undef GET_SEPROM
DECL|function|get_esi_fpga
r_static
r_int
id|__devinit
id|get_esi_fpga
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|mac_base
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mac_base
op_assign
id|base
op_plus
id|EPROM_SIZE
op_minus
r_sizeof
(paren
r_struct
id|midway_eprom
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ESI_LEN
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;esi
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
id|mac_base
op_plus
(paren
id|i
op_xor
l_int|3
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_do_init
r_static
r_int
id|__devinit
id|eni_do_init
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|midway_eprom
op_star
id|eprom
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
r_int
r_int
id|real_base
comma
id|base
suffix:semicolon
r_int
r_char
id|revision
suffix:semicolon
r_int
id|error
comma
id|i
comma
id|last
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_init&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;ci_range.vpi_bits
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;ci_range.vci_bits
op_assign
id|NR_VCI_LD
suffix:semicolon
id|dev-&gt;link_rate
op_assign
id|ATM_OC3_PCR
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_dev
op_assign
id|eni_dev-&gt;pci_dev
suffix:semicolon
id|real_base
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|eni_dev-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|error
op_assign
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): init error 0x%02x&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|error
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|pci_write_config_word
c_func
(paren
id|pci_dev
comma
id|PCI_COMMAND
comma
id|PCI_COMMAND_MEMORY
op_or
(paren
id|eni_dev-&gt;asic
ques
c_cond
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
suffix:colon
l_int|0
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): can&squot;t enable memory &quot;
l_string|&quot;(0x%02x)&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|error
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_NOTICE
id|DEV_LABEL
l_string|&quot;(itf %d): rev.%d,base=0x%lx,irq=%d,&quot;
comma
id|dev-&gt;number
comma
id|revision
comma
id|real_base
comma
id|eni_dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|base
op_assign
(paren
r_int
r_int
)paren
id|ioremap_nocache
c_func
(paren
id|real_base
comma
id|MAP_MAX_SIZE
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): can&squot;t set up page &quot;
l_string|&quot;mapping&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|eni_dev-&gt;base_diff
op_assign
id|real_base
op_minus
id|base
suffix:semicolon
multiline_comment|/* id may not be present in ASIC Tonga boards - check this @@@ */
r_if
c_cond
(paren
op_logical_neg
id|eni_dev-&gt;asic
)paren
(brace
id|eprom
op_assign
(paren
r_struct
id|midway_eprom
op_star
)paren
(paren
id|base
op_plus
id|EPROM_SIZE
op_minus
r_sizeof
(paren
r_struct
id|midway_eprom
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
op_amp
id|eprom-&gt;magic
)paren
op_ne
id|ENI155_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): bad &quot;
l_string|&quot;magic - expected 0x%x, got 0x%x&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|ENI155_MAGIC
comma
(paren
r_int
)paren
id|readl
c_func
(paren
op_amp
id|eprom-&gt;magic
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|eni_dev-&gt;phy
op_assign
id|base
op_plus
id|PHY_BASE
suffix:semicolon
id|eni_dev-&gt;reg
op_assign
id|base
op_plus
id|REG_BASE
suffix:semicolon
id|eni_dev-&gt;ram
op_assign
id|base
op_plus
id|RAM_BASE
suffix:semicolon
id|last
op_assign
id|MAP_MAX_SIZE
op_minus
id|RAM_BASE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|last
op_minus
id|RAM_INCREMENT
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_sub_assign
id|RAM_INCREMENT
)paren
(brace
id|writel
c_func
(paren
l_int|0x55555555
comma
id|eni_dev-&gt;ram
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
id|eni_dev-&gt;ram
op_plus
id|i
)paren
op_ne
l_int|0x55555555
)paren
id|last
op_assign
id|i
suffix:semicolon
r_else
(brace
id|writel
c_func
(paren
l_int|0xAAAAAAAA
comma
id|eni_dev-&gt;ram
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
id|eni_dev-&gt;ram
op_plus
id|i
)paren
op_ne
l_int|0xAAAAAAAA
)paren
id|last
op_assign
id|i
suffix:semicolon
r_else
id|writel
c_func
(paren
id|i
comma
id|eni_dev-&gt;ram
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|last
suffix:semicolon
id|i
op_add_assign
id|RAM_INCREMENT
)paren
r_if
c_cond
(paren
id|readl
c_func
(paren
id|eni_dev-&gt;ram
op_plus
id|i
)paren
op_ne
id|i
)paren
r_break
suffix:semicolon
id|eni_dev-&gt;mem
op_assign
id|i
suffix:semicolon
id|memset_io
c_func
(paren
id|eni_dev-&gt;ram
comma
l_int|0
comma
id|eni_dev-&gt;mem
)paren
suffix:semicolon
multiline_comment|/* TODO: should shrink allocation now */
id|printk
c_func
(paren
l_string|&quot;mem=%dkB (&quot;
comma
id|eni_dev-&gt;mem
op_rshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* TODO: check for non-SUNI, check for TAXI ? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|eni_in
c_func
(paren
id|MID_RES_ID_MCON
)paren
op_amp
l_int|0x200
)paren
op_ne
op_logical_neg
id|eni_dev-&gt;asic
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;)&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): ERROR - wrong id 0x%x&bslash;n&quot;
comma
id|dev-&gt;number
comma
(paren
r_int
)paren
id|eni_in
c_func
(paren
id|MID_RES_ID_MCON
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|error
op_assign
id|eni_dev-&gt;asic
ques
c_cond
id|get_esi_asic
c_func
(paren
id|dev
)paren
suffix:colon
id|get_esi_fpga
c_func
(paren
id|dev
comma
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ESI_LEN
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02X&quot;
comma
id|i
ques
c_cond
l_string|&quot;-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|dev-&gt;esi
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;)&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
id|DEV_LABEL
l_string|&quot;(itf %d): %s,%s&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|eni_in
c_func
(paren
id|MID_RES_ID_MCON
)paren
op_amp
l_int|0x200
ques
c_cond
l_string|&quot;ASIC&quot;
suffix:colon
l_string|&quot;FPGA&quot;
comma
id|media_name
(braket
id|eni_in
c_func
(paren
id|MID_RES_ID_MCON
)paren
op_amp
id|DAUGTHER_ID
)braket
)paren
suffix:semicolon
r_return
id|suni_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|eni_start
r_static
r_int
id|__devinit
id|eni_start
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_int
r_int
id|buf
comma
id|buffer_mem
suffix:semicolon
r_int
id|error
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_start&bslash;n&quot;
)paren
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|eni_dev-&gt;irq
comma
op_amp
id|eni_int
comma
id|SA_SHIRQ
comma
id|DEV_LABEL
comma
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): IRQ%d is already in use&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|eni_dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/* @@@ should release IRQ on error */
r_if
c_cond
(paren
(paren
id|error
op_assign
id|pci_write_config_word
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|PCI_COMMAND
comma
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
op_or
(paren
id|eni_dev-&gt;asic
ques
c_cond
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
suffix:colon
l_int|0
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): can&squot;t enable memory+&quot;
l_string|&quot;master (0x%02x)&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#ifdef __sparc_v9__ /* copied from drivers/net/sunhme.c */
multiline_comment|/* NOTE: Cache line size is in 32-bit word units. */
id|pci_write_config_byte
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|PCI_CACHE_LINE_SIZE
comma
l_int|0x10
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|error
op_assign
id|pci_write_config_byte
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|PCI_TONGA_CTRL
comma
id|END_SWAP_DMA
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): can&squot;t set endian swap &quot;
l_string|&quot;(0x%02x)&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* determine addresses of internal tables */
id|eni_dev-&gt;vci
op_assign
id|eni_dev-&gt;ram
suffix:semicolon
id|eni_dev-&gt;rx_dma
op_assign
id|eni_dev-&gt;ram
op_plus
id|NR_VCI
op_star
l_int|16
suffix:semicolon
id|eni_dev-&gt;tx_dma
op_assign
id|eni_dev-&gt;rx_dma
op_plus
id|NR_DMA_RX
op_star
l_int|8
suffix:semicolon
id|eni_dev-&gt;service
op_assign
id|eni_dev-&gt;tx_dma
op_plus
id|NR_DMA_TX
op_star
l_int|8
suffix:semicolon
id|buf
op_assign
id|eni_dev-&gt;service
op_plus
id|NR_SERVICE
op_star
l_int|4
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;vci 0x%lx,rx 0x%lx, tx 0x%lx,srv 0x%lx,buf 0x%lx&bslash;n&quot;
comma
id|eni_dev-&gt;vci
comma
id|eni_dev-&gt;rx_dma
comma
id|eni_dev-&gt;tx_dma
comma
id|eni_dev-&gt;service
comma
id|buf
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|eni_dev-&gt;lock
)paren
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|eni_dev-&gt;task
comma
id|eni_tasklet
comma
(paren
r_int
r_int
)paren
id|dev
)paren
suffix:semicolon
id|eni_dev-&gt;events
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initialize memory management */
id|buffer_mem
op_assign
id|eni_dev-&gt;mem
op_minus
(paren
id|buf
op_minus
id|eni_dev-&gt;ram
)paren
suffix:semicolon
id|eni_dev-&gt;free_list_size
op_assign
id|buffer_mem
op_div
id|MID_MIN_BUF_SIZE
op_div
l_int|2
suffix:semicolon
id|eni_dev-&gt;free_list
op_assign
(paren
r_struct
id|eni_free
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|eni_free
)paren
op_star
(paren
id|eni_dev-&gt;free_list_size
op_plus
l_int|1
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_dev-&gt;free_list
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|DEV_LABEL
l_string|&quot;(itf %d): couldn&squot;t get free page&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|eni_dev-&gt;free_len
op_assign
l_int|0
suffix:semicolon
id|eni_put_free
c_func
(paren
id|eni_dev
comma
id|buf
comma
id|buffer_mem
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|eni_dev-&gt;vci
comma
l_int|0
comma
l_int|16
op_star
id|NR_VCI
)paren
suffix:semicolon
multiline_comment|/* clear VCI table */
multiline_comment|/*&n;&t; * byte_addr  free (k)&n;&t; * 0x00000000     512  VCI table&n;&t; * 0x00004000&t;  496  RX DMA&n;&t; * 0x00005000&t;  492  TX DMA&n;&t; * 0x00006000&t;  488  service list&n;&t; * 0x00007000&t;  484  buffers&n;&t; * 0x00080000&t;    0  end (512kB)&n;&t; */
id|eni_out
c_func
(paren
l_int|0xffffffff
comma
id|MID_IE
)paren
suffix:semicolon
id|error
op_assign
id|start_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|error
op_assign
id|start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|error
op_assign
id|dev-&gt;phy
op_member_access_from_pointer
id|start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|eni_out
c_func
(paren
id|eni_in
c_func
(paren
id|MID_MC_S
)paren
op_or
(paren
l_int|1
op_lshift
id|MID_INT_SEL_SHIFT
)paren
op_or
id|MID_TX_LOCK_MODE
op_or
id|MID_DMA_ENABLE
op_or
id|MID_TX_ENABLE
op_or
id|MID_RX_ENABLE
comma
id|MID_MC_S
)paren
suffix:semicolon
multiline_comment|/* Tonga uses SBus INTReq1 */
(paren
r_void
)paren
id|eni_in
c_func
(paren
id|MID_ISA
)paren
suffix:semicolon
multiline_comment|/* clear Midway interrupts */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_close
r_static
r_void
id|eni_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_close&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ENI_VCC
c_func
(paren
id|vcc
)paren
)paren
r_return
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|close_rx
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|close_tx
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;eni_close: done waiting&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* deallocate memory */
id|kfree
c_func
(paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
)paren
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_assign
l_int|NULL
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
multiline_comment|/*foo();*/
)brace
DECL|function|get_ci
r_static
r_int
id|get_ci
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
op_star
id|vpi
comma
r_int
op_star
id|vci
)paren
(brace
r_struct
id|atm_vcc
op_star
id|walk
suffix:semicolon
r_if
c_cond
(paren
op_star
id|vpi
op_eq
id|ATM_VPI_ANY
)paren
op_star
id|vpi
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|vci
op_eq
id|ATM_VCI_ANY
)paren
(brace
r_for
c_loop
(paren
op_star
id|vci
op_assign
id|ATM_NOT_RSV_VCI
suffix:semicolon
op_star
id|vci
OL
id|NR_VCI
suffix:semicolon
(paren
op_star
id|vci
)paren
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|rx_map
(braket
op_star
id|vci
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_for
c_loop
(paren
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
id|walk
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
)paren
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|walk-&gt;flags
)paren
op_logical_and
id|walk-&gt;vci
op_eq
op_star
id|vci
op_logical_and
id|walk-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|walk
)paren
r_continue
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
op_star
id|vci
op_eq
id|NR_VCI
ques
c_cond
op_minus
id|EADDRINUSE
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|vci
op_eq
id|ATM_VCI_UNSPEC
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|rx_map
(braket
op_star
id|vci
)braket
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_NONE
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
id|walk
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
)paren
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|walk-&gt;flags
)paren
op_logical_and
id|walk-&gt;vci
op_eq
op_star
id|vci
op_logical_and
id|walk-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_open
r_static
r_int
id|eni_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_struct
id|eni_vcc
op_star
id|eni_vcc
suffix:semicolon
r_int
id|error
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_open&bslash;n&quot;
)paren
suffix:semicolon
id|EVENT
c_func
(paren
l_string|&quot;eni_open&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_assign
l_int|NULL
suffix:semicolon
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
id|error
op_assign
id|get_ci
c_func
(paren
id|vcc
comma
op_amp
id|vpi
comma
op_amp
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|vcc-&gt;vpi
op_assign
id|vpi
suffix:semicolon
id|vcc-&gt;vci
op_assign
id|vci
suffix:semicolon
r_if
c_cond
(paren
id|vci
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vpi
op_ne
id|ATM_VCI_UNSPEC
)paren
id|set_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_ne
id|ATM_AAL0
op_logical_and
id|vcc-&gt;qos.aal
op_ne
id|ATM_AAL5
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DPRINTK
c_func
(paren
id|DEV_LABEL
l_string|&quot;(itf %d): open %d.%d&bslash;n&quot;
comma
id|vcc-&gt;dev-&gt;number
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|eni_vcc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|eni_vcc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_vcc
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_assign
id|eni_vcc
suffix:semicolon
id|eni_vcc-&gt;tx
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* for eni_close after open_rx */
r_if
c_cond
(paren
(paren
id|error
op_assign
id|open_rx_first
c_func
(paren
id|vcc
)paren
)paren
)paren
(brace
id|eni_close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|open_tx_first
c_func
(paren
id|vcc
)paren
)paren
)paren
(brace
id|eni_close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vci
op_eq
id|ATM_VPI_UNSPEC
op_logical_or
id|vpi
op_eq
id|ATM_VCI_UNSPEC
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|open_rx_second
c_func
(paren
id|vcc
)paren
)paren
)paren
(brace
id|eni_close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|open_tx_second
c_func
(paren
id|vcc
)paren
)paren
)paren
(brace
id|eni_close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
multiline_comment|/* should power down SUNI while !ref_count @@@ */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_change_qos
r_static
r_int
id|eni_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
comma
r_int
id|flgs
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|eni_tx
op_star
id|tx
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|error
comma
id|rate
comma
id|rsv
comma
id|shp
suffix:semicolon
r_if
c_cond
(paren
id|qos-&gt;txtp.traffic_class
op_eq
id|ATM_NONE
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tx
op_eq
id|eni_dev-&gt;ubr
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
id|rate
op_assign
id|atm_pcr_goal
c_func
(paren
op_amp
id|qos-&gt;txtp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|0
)paren
id|rate
op_assign
op_minus
id|rate
suffix:semicolon
id|rsv
op_assign
id|shp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flgs
op_amp
id|ATM_MF_DEC_RSV
)paren
op_logical_and
id|rate
op_logical_and
id|rate
OL
id|tx-&gt;reserved
)paren
id|rsv
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flgs
op_amp
id|ATM_MF_INC_RSV
)paren
op_logical_and
(paren
op_logical_neg
id|rate
op_logical_or
id|rate
OG
id|tx-&gt;reserved
)paren
)paren
id|rsv
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flgs
op_amp
id|ATM_MF_DEC_SHP
)paren
op_logical_and
id|rate
op_logical_and
id|rate
OL
id|tx-&gt;shaping
)paren
id|shp
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flgs
op_amp
id|ATM_MF_INC_SHP
)paren
op_logical_and
(paren
op_logical_neg
id|rate
op_logical_or
id|rate
OG
id|tx-&gt;shaping
)paren
)paren
id|shp
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsv
op_logical_and
op_logical_neg
id|shp
)paren
r_return
l_int|0
suffix:semicolon
id|error
op_assign
id|reserve_or_set_tx
c_func
(paren
id|vcc
comma
op_amp
id|qos-&gt;txtp
comma
id|rsv
comma
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|shp
op_logical_and
op_logical_neg
(paren
id|flgs
op_amp
id|ATM_MF_IMMED
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Walk through the send buffer and patch the rate information in all&n;&t; * segmentation buffer descriptors of this VCC.&n;&t; */
id|tasklet_disable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
r_for
c_loop
(paren
id|skb
op_assign
id|eni_dev-&gt;tx_queue.next
suffix:semicolon
id|skb
op_ne
(paren
r_struct
id|sk_buff
op_star
)paren
op_amp
id|eni_dev-&gt;tx_queue
suffix:semicolon
id|skb
op_assign
id|skb-&gt;next
)paren
(brace
r_int
r_int
id|dsc
suffix:semicolon
r_if
c_cond
(paren
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_ne
id|vcc
)paren
r_continue
suffix:semicolon
id|dsc
op_assign
id|tx-&gt;send
op_plus
id|ENI_PRV_POS
c_func
(paren
id|skb
)paren
op_star
l_int|4
suffix:semicolon
id|writel
c_func
(paren
(paren
id|readl
c_func
(paren
id|dsc
)paren
op_amp
op_complement
(paren
id|MID_SEG_RATE
op_or
id|MID_SEG_PR
)paren
)paren
op_or
(paren
id|tx-&gt;prescaler
op_lshift
id|MID_SEG_PR_SHIFT
)paren
op_or
(paren
id|tx-&gt;resolution
op_lshift
id|MID_SEG_RATE_SHIFT
)paren
comma
id|dsc
)paren
suffix:semicolon
)brace
id|tasklet_enable
c_func
(paren
op_amp
id|eni_dev-&gt;task
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_ioctl
r_static
r_int
id|eni_ioctl
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|eni_dev
op_star
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|ENI_MEMDUMP
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Please use /proc/atm/&quot;
id|DEV_LABEL
l_string|&quot;:%d &quot;
l_string|&quot;instead of obsolete ioctl ENI_MEMDUMP&bslash;n&quot;
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|dump
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|ENI_SETMULT
)paren
(brace
r_struct
id|eni_multipliers
id|mult
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mult
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|eni_multipliers
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mult.tx
op_logical_and
id|mult.tx
op_le
l_int|100
)paren
op_logical_or
(paren
id|mult.rx
op_logical_and
id|mult.rx
op_le
l_int|100
)paren
op_logical_or
id|mult.tx
OG
l_int|65536
op_logical_or
id|mult.rx
OG
l_int|65536
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mult.tx
)paren
id|eni_dev-&gt;tx_mult
op_assign
id|mult.tx
suffix:semicolon
r_if
c_cond
(paren
id|mult.rx
)paren
id|eni_dev-&gt;rx_mult
op_assign
id|mult.rx
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|ATM_SETCIRANGE
)paren
(brace
r_struct
id|atm_cirange
id|ci
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ci
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|atm_cirange
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ci.vpi_bits
op_eq
l_int|0
op_logical_or
id|ci.vpi_bits
op_eq
id|ATM_CI_MAX
)paren
op_logical_and
(paren
id|ci.vci_bits
op_eq
id|NR_VCI_LD
op_logical_or
id|ci.vpi_bits
op_eq
id|ATM_CI_MAX
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;phy-&gt;ioctl
)paren
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_return
id|dev-&gt;phy
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|eni_getsockopt
r_static
r_int
id|eni_getsockopt
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|eni_setsockopt
r_static
r_int
id|eni_setsockopt
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|eni_send
r_static
r_int
id|eni_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_enum
id|enq_res
id|res
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&gt;eni_send&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;!skb in eni_send ?&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;len
op_ne
id|ATM_CELL_SIZE
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
op_star
(paren
id|u32
op_star
)paren
id|skb-&gt;data
op_assign
id|htonl
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
)brace
id|submitted
op_increment
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|tasklet_disable
c_func
(paren
op_amp
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|task
)paren
suffix:semicolon
id|res
op_assign
id|do_tx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tasklet_enable
c_func
(paren
op_amp
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|task
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
id|enq_ok
)paren
r_return
l_int|0
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ENI_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|tx-&gt;backlog
comma
id|skb
)paren
suffix:semicolon
id|backlogged
op_increment
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|ENI_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
op_member_access_from_pointer
id|task
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eni_sg_send
r_static
r_int
id|eni_sg_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_return
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
op_logical_and
op_logical_neg
(paren
(paren
id|start
op_or
id|size
)paren
op_amp
l_int|3
)paren
suffix:semicolon
multiline_comment|/* don&squot;t tolerate misalignment */
)brace
DECL|function|eni_phy_put
r_static
r_void
id|eni_phy_put
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_char
id|value
comma
r_int
r_int
id|addr
)paren
(brace
id|writel
c_func
(paren
id|value
comma
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|phy
op_plus
id|addr
op_star
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|eni_phy_get
r_static
r_int
r_char
id|eni_phy_get
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_return
id|readl
c_func
(paren
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|phy
op_plus
id|addr
op_star
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|eni_proc_read
r_static
r_int
id|eni_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
(brace
r_static
r_const
r_char
op_star
id|signal
(braket
)braket
op_assign
(brace
l_string|&quot;LOST&quot;
comma
l_string|&quot;unknown&quot;
comma
l_string|&quot;okay&quot;
)brace
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
op_assign
id|ENI_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
id|left
comma
id|i
suffix:semicolon
id|left
op_assign
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
id|DEV_LABEL
l_string|&quot;(itf %d) signal %s, %dkB, &quot;
l_string|&quot;%d cps remaining&bslash;n&quot;
comma
id|dev-&gt;number
comma
id|signal
(braket
(paren
r_int
)paren
id|dev-&gt;signal
)braket
comma
id|eni_dev-&gt;mem
op_rshift
l_int|10
comma
id|eni_dev-&gt;tx_bw
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|left
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%4sBursts: TX&quot;
macro_line|#if !defined(CONFIG_ATM_ENI_BURST_TX_16W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_TX_8W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_TX_4W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_TX_2W)
l_string|&quot; none&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_16W
l_string|&quot; 16W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_8W
l_string|&quot; 8W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_4W
l_string|&quot; 4W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_TX_2W
l_string|&quot; 2W&quot;
macro_line|#endif
l_string|&quot;, RX&quot;
macro_line|#if !defined(CONFIG_ATM_ENI_BURST_RX_16W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_RX_8W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_RX_4W) &amp;&amp; &bslash;&n;    !defined(CONFIG_ATM_ENI_BURST_RX_2W)
l_string|&quot; none&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_16W
l_string|&quot; 16W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_8W
l_string|&quot; 8W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_4W
l_string|&quot; 4W&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_ENI_BURST_RX_2W
l_string|&quot; 2W&quot;
macro_line|#endif
macro_line|#ifndef CONFIG_ATM_ENI_TUNE_BURST
l_string|&quot; (default)&quot;
macro_line|#endif
l_string|&quot;&bslash;n&quot;
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|left
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%4sBuffer multipliers: tx %d%%, rx %d%%&bslash;n&quot;
comma
l_string|&quot;&quot;
comma
id|eni_dev-&gt;tx_mult
comma
id|eni_dev-&gt;rx_mult
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CHAN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|eni_tx
op_star
id|tx
op_assign
id|eni_dev-&gt;tx
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx-&gt;send
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|left
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;tx[%d]:    0x%06lx-0x%06lx &quot;
l_string|&quot;(%6ld bytes), rsv %d cps, shp %d cps%s&bslash;n&quot;
comma
id|i
comma
id|tx-&gt;send
op_minus
id|eni_dev-&gt;ram
comma
id|tx-&gt;send
op_minus
id|eni_dev-&gt;ram
op_plus
id|tx-&gt;words
op_star
l_int|4
op_minus
l_int|1
comma
id|tx-&gt;words
op_star
l_int|4
comma
id|tx-&gt;reserved
comma
id|tx-&gt;shaping
comma
id|tx
op_eq
id|eni_dev-&gt;ubr
ques
c_cond
l_string|&quot; (UBR)&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|left
)paren
r_continue
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%10sbacklog %u packets&bslash;n&quot;
comma
l_string|&quot;&quot;
comma
id|skb_queue_len
c_func
(paren
op_amp
id|tx-&gt;backlog
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|vcc
op_assign
id|dev-&gt;vccs
suffix:semicolon
id|vcc
suffix:semicolon
id|vcc
op_assign
id|vcc-&gt;next
)paren
(brace
r_struct
id|eni_vcc
op_star
id|eni_vcc
op_assign
id|ENI_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_int
id|length
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|left
)paren
r_continue
suffix:semicolon
id|length
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;vcc %4d: &quot;
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eni_vcc-&gt;rx
)paren
(brace
id|length
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|length
comma
l_string|&quot;0x%06lx-0x%06lx &quot;
l_string|&quot;(%6ld bytes)&quot;
comma
id|eni_vcc-&gt;recv
op_minus
id|eni_dev-&gt;ram
comma
id|eni_vcc-&gt;recv
op_minus
id|eni_dev-&gt;ram
op_plus
id|eni_vcc-&gt;words
op_star
l_int|4
op_minus
l_int|1
comma
id|eni_vcc-&gt;words
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eni_vcc-&gt;tx
)paren
id|length
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|length
comma
l_string|&quot;, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eni_vcc-&gt;tx
)paren
id|length
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|length
comma
l_string|&quot;tx[%d], txing %d bytes&quot;
comma
id|eni_vcc-&gt;tx-&gt;index
comma
id|eni_vcc-&gt;txing
)paren
suffix:semicolon
id|page
(braket
id|length
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
r_return
id|length
op_plus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|eni_dev-&gt;free_len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|eni_free
op_star
id|fe
op_assign
id|eni_dev-&gt;free_list
op_plus
id|i
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|left
)paren
r_continue
suffix:semicolon
id|offset
op_assign
id|eni_dev-&gt;ram
op_plus
id|eni_dev-&gt;base_diff
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;free      0x%06lx-0x%06lx (%6d bytes)&bslash;n&quot;
comma
id|fe-&gt;start
op_minus
id|offset
comma
id|fe-&gt;start
op_minus
id|offset
op_plus
(paren
l_int|1
op_lshift
id|fe-&gt;order
)paren
op_minus
l_int|1
comma
l_int|1
op_lshift
id|fe-&gt;order
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ops
r_static
r_const
r_struct
id|atmdev_ops
id|ops
op_assign
(brace
id|open
suffix:colon
id|eni_open
comma
id|close
suffix:colon
id|eni_close
comma
id|ioctl
suffix:colon
id|eni_ioctl
comma
id|getsockopt
suffix:colon
id|eni_getsockopt
comma
id|setsockopt
suffix:colon
id|eni_setsockopt
comma
id|send
suffix:colon
id|eni_send
comma
id|sg_send
suffix:colon
id|eni_sg_send
comma
id|phy_put
suffix:colon
id|eni_phy_put
comma
id|phy_get
suffix:colon
id|eni_phy_get
comma
id|change_qos
suffix:colon
id|eni_change_qos
comma
id|proc_read
suffix:colon
id|eni_proc_read
)brace
suffix:semicolon
DECL|function|eni_init_one
r_static
r_int
id|__devinit
id|eni_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_struct
id|eni_dev
op_star
id|eni_dev
suffix:semicolon
r_int
id|error
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;eni_init_one&bslash;n&quot;
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
multiline_comment|/* @@@ we don&squot;t support unloading yet */
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out0
suffix:semicolon
)brace
id|eni_dev
op_assign
(paren
r_struct
id|eni_dev
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|eni_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eni_dev
)paren
r_goto
id|out0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_zeroes
)paren
(brace
id|cpu_zeroes
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci_dev
comma
id|ENI_ZEROES_SIZE
comma
op_amp
id|zeroes
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_zeroes
)paren
r_goto
id|out1
suffix:semicolon
)brace
id|dev
op_assign
id|atm_dev_register
c_func
(paren
id|DEV_LABEL
comma
op_amp
id|ops
comma
op_minus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out2
suffix:semicolon
id|pci_dev-&gt;driver_data
op_assign
id|dev
suffix:semicolon
id|eni_dev-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
id|ENI_DEV
c_func
(paren
id|dev
)paren
op_assign
id|eni_dev
suffix:semicolon
id|eni_dev-&gt;asic
op_assign
id|ent-&gt;driver_data
suffix:semicolon
id|error
op_assign
id|eni_do_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out3
suffix:semicolon
id|error
op_assign
id|eni_start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out3
suffix:semicolon
id|eni_dev-&gt;more
op_assign
id|eni_boards
suffix:semicolon
id|eni_boards
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out3
suffix:colon
id|atm_dev_deregister
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out2
suffix:colon
id|pci_free_consistent
c_func
(paren
id|eni_dev-&gt;pci_dev
comma
id|ENI_ZEROES_SIZE
comma
id|cpu_zeroes
comma
id|zeroes
)paren
suffix:semicolon
id|cpu_zeroes
op_assign
l_int|NULL
suffix:semicolon
id|out1
suffix:colon
id|kfree
c_func
(paren
id|eni_dev
)paren
suffix:semicolon
id|out0
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
multiline_comment|/* @@@ we don&squot;t support unloading yet */
r_return
id|error
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|eni_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_EF
comma
id|PCI_DEVICE_ID_EF_ATM_FPGA
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
multiline_comment|/* FPGA */
)brace
comma
(brace
id|PCI_VENDOR_ID_EF
comma
id|PCI_DEVICE_ID_EF_ATM_ASIC
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|1
multiline_comment|/* ASIC */
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|eni_pci_tbl
)paren
suffix:semicolon
DECL|function|eni_remove_one
r_static
r_void
id|__devexit
id|eni_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
multiline_comment|/* grrr */
)brace
DECL|variable|eni_driver
r_static
r_struct
id|pci_driver
id|eni_driver
op_assign
(brace
id|name
suffix:colon
id|DEV_LABEL
comma
id|id_table
suffix:colon
id|eni_pci_tbl
comma
id|probe
suffix:colon
id|eni_init_one
comma
id|remove
suffix:colon
id|eni_remove_one
comma
)brace
suffix:semicolon
DECL|function|eni_init
r_static
r_int
id|__init
id|eni_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* dummy for sizeof */
r_if
c_cond
(paren
r_sizeof
(paren
id|skb-&gt;cb
)paren
OL
r_sizeof
(paren
r_struct
id|eni_skb_prv
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eni_detect: skb-&gt;cb is too small (%d &lt; %d)&bslash;n&quot;
comma
r_sizeof
(paren
id|skb-&gt;cb
)paren
comma
r_sizeof
(paren
r_struct
id|eni_skb_prv
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_register_driver
c_func
(paren
op_amp
id|eni_driver
)paren
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|pci_unregister_driver
(paren
op_amp
id|eni_driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|eni_cleanup
r_static
r_void
id|__exit
id|eni_cleanup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Well, there&squot;s no way to get rid of the driver yet, so we don&squot;t&n;&t; * have to clean up, right ? :-)&n;&t; */
)brace
DECL|variable|eni_init
id|module_init
c_func
(paren
id|eni_init
)paren
suffix:semicolon
DECL|variable|eni_cleanup
id|module_exit
c_func
(paren
id|eni_cleanup
)paren
suffix:semicolon
eof
