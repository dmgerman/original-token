multiline_comment|/*&n;    bttv - Bt848 frame grabber driver&n;&n;    Copyright (C) 1996,97,98 Ralph  Metzler (rjkm@thp.uni-koeln.de)&n;                           &amp; Marcus Metzler (mocm@thp.uni-koeln.de)&n;    (c) 1999,2000 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;bttvp.h&quot;
macro_line|#include &quot;tuner.h&quot;
DECL|macro|DEBUG
mdefine_line|#define DEBUG(x)&t;/* Debug driver */
DECL|macro|MIN
mdefine_line|#define MIN(a,b) (((a)&gt;(b))?(b):(a))
DECL|macro|MAX
mdefine_line|#define MAX(a,b) (((a)&gt;(b))?(a):(b))
r_static
r_void
id|bt848_set_risc_jmps
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|state
)paren
suffix:semicolon
DECL|variable|bttv_num
r_int
id|bttv_num
suffix:semicolon
multiline_comment|/* number of Bt848s in use */
DECL|variable|bttvs
r_struct
id|bttv
id|bttvs
(braket
id|BTTV_MAX
)braket
suffix:semicolon
multiline_comment|/* configuration variables */
macro_line|#if defined(__sparc__) || defined(__powerpc__) || defined(__hppa__)
DECL|variable|bigendian
r_static
r_int
r_int
id|bigendian
op_assign
l_int|1
suffix:semicolon
macro_line|#else
DECL|variable|bigendian
r_static
r_int
r_int
id|bigendian
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|radio
r_static
r_int
r_int
id|radio
(braket
id|BTTV_MAX
)braket
suffix:semicolon
DECL|variable|fieldnr
r_static
r_int
r_int
id|fieldnr
op_assign
l_int|0
suffix:semicolon
DECL|variable|irq_debug
r_static
r_int
r_int
id|irq_debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|gbuffers
r_static
r_int
r_int
id|gbuffers
op_assign
l_int|2
suffix:semicolon
DECL|variable|gbufsize
r_static
r_int
r_int
id|gbufsize
op_assign
id|BTTV_MAX_FBUF
suffix:semicolon
DECL|variable|combfilter
r_static
r_int
r_int
id|combfilter
op_assign
l_int|0
suffix:semicolon
DECL|variable|bttv_debug
r_int
r_int
id|bttv_debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|bttv_verbose
r_int
r_int
id|bttv_verbose
op_assign
l_int|1
suffix:semicolon
DECL|variable|bttv_gpio
r_int
r_int
id|bttv_gpio
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* insmod options */
id|MODULE_PARM
c_func
(paren
id|radio
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|radio
comma
l_string|&quot;The TV card supports radio, default is 0 (no)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bigendian
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bigendian
comma
l_string|&quot;byte order of the framebuffer, default is native endian&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|fieldnr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|fieldnr
comma
l_string|&quot;count fields, default is 0 (no)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bttv_verbose
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bttv_verbose
comma
l_string|&quot;verbose startup messages, default is 1 (yes)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bttv_gpio
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bttv_gpio
comma
l_string|&quot;log gpio changes, default is 0 (no)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bttv_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bttv_debug
comma
l_string|&quot;debug messages, default is 0 (no)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq_debug
comma
l_string|&quot;irq handler debug messages, default is 0 (no)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|gbuffers
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gbuffers
comma
l_string|&quot;number of capture buffers, default is 2 (64 max)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|gbufsize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gbufsize
comma
l_string|&quot;size of the capture buffers, default is 0x208000&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|combfilter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;bttv - v4l driver module for bt848/878 based cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ralph  Metzler &amp; Marcus Metzler &amp; Gerd Knorr&quot;
)paren
suffix:semicolon
multiline_comment|/* kernel args */
macro_line|#ifndef MODULE
DECL|function|p_radio
r_static
r_int
id|__init
id|p_radio
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_return
id|bttv_parse
c_func
(paren
id|str
comma
id|BTTV_MAX
comma
id|radio
)paren
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;bttv.radio=&quot;
comma
id|p_radio
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|I2C_TIMING
mdefine_line|#define I2C_TIMING (0x7&lt;&lt;4)
DECL|macro|I2C_DELAY
mdefine_line|#define I2C_DELAY   10
DECL|macro|I2C_SET
mdefine_line|#define I2C_SET(CTRL,DATA) &bslash;&n;    { btwrite((CTRL&lt;&lt;1)|(DATA), BT848_I2C); udelay(I2C_DELAY); }
DECL|macro|I2C_GET
mdefine_line|#define I2C_GET()   (btread(BT848_I2C)&amp;1)
DECL|macro|BURSTOFFSET
mdefine_line|#define BURSTOFFSET 76
DECL|macro|BTTV_ERRORS
mdefine_line|#define BTTV_ERRORS 5
multiline_comment|/*******************************/
multiline_comment|/* Memory management functions */
multiline_comment|/*******************************/
DECL|macro|MDEBUG
mdefine_line|#define MDEBUG(x)&t;do { } while(0)&t;&t;/* Debug memory management */
multiline_comment|/* [DaveM] I&squot;ve recoded most of this so that:&n; * 1) It&squot;s easier to tell what is happening&n; * 2) It&squot;s more portable, especially for translating things&n; *    out of vmalloc mapped areas in the kernel.&n; * 3) Less unnecessary translations happen.&n; *&n; * The code used to assume that the kernel vmalloc mappings&n; * existed in the page tables of every process, this is simply&n; * not guarenteed.  We now use pgd_offset_k which is the&n; * defined way to get at the kernel page tables.&n; */
multiline_comment|/* Given PGD from the address space&squot;s page table, return the kernel&n; * virtual mapping of the physical memory mapped at ADR.&n; */
DECL|function|uvirt_to_kva
r_static
r_inline
r_int
r_int
id|uvirt_to_kva
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|ret
op_assign
l_int|0UL
suffix:semicolon
id|pmd_t
op_star
id|pmd
suffix:semicolon
id|pte_t
op_star
id|ptep
comma
id|pte
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|pgd
comma
id|adr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|ptep
op_assign
id|pte_offset
c_func
(paren
id|pmd
comma
id|adr
)paren
suffix:semicolon
id|pte
op_assign
op_star
id|ptep
suffix:semicolon
r_if
c_cond
(paren
id|pte_present
c_func
(paren
id|pte
)paren
)paren
(brace
id|ret
op_assign
(paren
r_int
r_int
)paren
id|page_address
c_func
(paren
id|pte_page
c_func
(paren
id|pte
)paren
)paren
suffix:semicolon
id|ret
op_or_assign
(paren
id|adr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;uv2kva(%lx--&gt;%lx)&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|uvirt_to_bus
r_static
r_inline
r_int
r_int
id|uvirt_to_bus
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|kva
comma
id|ret
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset
c_func
(paren
id|current-&gt;mm
comma
id|adr
)paren
comma
id|adr
)paren
suffix:semicolon
id|ret
op_assign
id|virt_to_bus
c_func
(paren
(paren
r_void
op_star
)paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;uv2b(%lx--&gt;%lx)&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|kvirt_to_bus
r_static
r_inline
r_int
r_int
id|kvirt_to_bus
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|va
comma
id|kva
comma
id|ret
suffix:semicolon
id|va
op_assign
id|VMALLOC_VMADDR
c_func
(paren
id|adr
)paren
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset_k
c_func
(paren
id|va
)paren
comma
id|va
)paren
suffix:semicolon
id|ret
op_assign
id|virt_to_bus
c_func
(paren
(paren
r_void
op_star
)paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;kv2b(%lx--&gt;%lx)&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Here we want the physical address of the memory.&n; * This is used when initializing the contents of the&n; * area and marking the pages as reserved.&n; */
DECL|function|kvirt_to_pa
r_static
r_inline
r_int
r_int
id|kvirt_to_pa
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|va
comma
id|kva
comma
id|ret
suffix:semicolon
id|va
op_assign
id|VMALLOC_VMADDR
c_func
(paren
id|adr
)paren
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset_k
c_func
(paren
id|va
)paren
comma
id|va
)paren
suffix:semicolon
id|ret
op_assign
id|__pa
c_func
(paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;kv2pa(%lx--&gt;%lx)&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|rvmalloc
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
r_int
r_int
id|adr
comma
id|page
suffix:semicolon
id|mem
op_assign
id|vmalloc_32
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
(brace
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* Clear the ram out, no junk to the user */
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|adr
)paren
suffix:semicolon
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|__va
c_func
(paren
id|page
)paren
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|rvfree
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|adr
comma
id|page
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
(brace
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|adr
)paren
suffix:semicolon
id|mem_map_unreserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|__va
c_func
(paren
id|page
)paren
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Create the giant waste of buffer space we need for now&n; *&t;until we get DMA to user space sorted out (probably 2.3.x)&n; *&n; *&t;We only create this as and when someone uses mmap&n; */
DECL|function|fbuffer_alloc
r_static
r_int
id|fbuffer_alloc
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;fbuffer
)paren
(brace
id|btv-&gt;fbuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|rvmalloc
c_func
(paren
id|gbuffers
op_star
id|gbufsize
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bttv%d: Double alloc of fbuffer!&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;fbuffer
)paren
(brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* init + register i2c algo-bit adapter */
DECL|function|init_bttv_i2c
r_static
r_int
id|__devinit
id|init_bttv_i2c
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;i2c_adap
comma
op_amp
id|bttv_i2c_adap_template
comma
r_sizeof
(paren
r_struct
id|i2c_adapter
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;i2c_algo
comma
op_amp
id|bttv_i2c_algo_template
comma
r_sizeof
(paren
r_struct
id|i2c_algo_bit_data
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;i2c_client
comma
op_amp
id|bttv_i2c_client_template
comma
r_sizeof
(paren
r_struct
id|i2c_client
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|btv-&gt;i2c_adap.name
op_plus
id|strlen
c_func
(paren
id|btv-&gt;i2c_adap.name
)paren
comma
l_string|&quot; #%d&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|btv-&gt;i2c_algo.data
op_assign
id|btv
suffix:semicolon
id|btv-&gt;i2c_adap.data
op_assign
id|btv
suffix:semicolon
id|btv-&gt;i2c_adap.algo_data
op_assign
op_amp
id|btv-&gt;i2c_algo
suffix:semicolon
id|btv-&gt;i2c_client.adapter
op_assign
op_amp
id|btv-&gt;i2c_adap
suffix:semicolon
id|bttv_bit_setscl
c_func
(paren
id|btv
comma
l_int|1
)paren
suffix:semicolon
id|bttv_bit_setsda
c_func
(paren
id|btv
comma
l_int|1
)paren
suffix:semicolon
id|btv-&gt;i2c_rc
op_assign
id|i2c_bit_add_bus
c_func
(paren
op_amp
id|btv-&gt;i2c_adap
)paren
suffix:semicolon
r_return
id|btv-&gt;i2c_rc
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|function|bttv_gpio_tracking
r_void
id|bttv_gpio_tracking
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_char
op_star
id|comment
)paren
(brace
r_int
r_int
id|outbits
comma
id|data
suffix:semicolon
id|outbits
op_assign
id|btread
c_func
(paren
id|BT848_GPIO_OUT_EN
)paren
suffix:semicolon
id|data
op_assign
id|btread
c_func
(paren
id|BT848_GPIO_DATA
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: gpio: en=%08x, out=%08x in=%08x [%s]&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|outbits
comma
id|data
op_amp
id|outbits
comma
id|data
op_amp
op_complement
id|outbits
comma
id|comment
)paren
suffix:semicolon
)brace
DECL|variable|audio_modes
r_static
r_char
op_star
id|audio_modes
(braket
)braket
op_assign
(brace
l_string|&quot;audio: tuner&quot;
comma
l_string|&quot;audio: radio&quot;
comma
l_string|&quot;audio: extern&quot;
comma
l_string|&quot;audio: intern&quot;
comma
l_string|&quot;audio: off&quot;
)brace
suffix:semicolon
DECL|function|audio
r_static
r_void
id|audio
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|mode
comma
r_int
id|no_irq_context
)paren
(brace
id|btaor
c_func
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask
comma
op_complement
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask
comma
id|BT848_GPIO_OUT_EN
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|AUDIO_MUTE
suffix:colon
id|btv-&gt;audio
op_or_assign
id|AUDIO_MUTE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_UNMUTE
suffix:colon
id|btv-&gt;audio
op_and_assign
op_complement
id|AUDIO_MUTE
suffix:semicolon
id|mode
op_assign
id|btv-&gt;audio
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_OFF
suffix:colon
id|mode
op_assign
id|AUDIO_OFF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ON
suffix:colon
id|mode
op_assign
id|btv-&gt;audio
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|btv-&gt;audio
op_and_assign
id|AUDIO_MUTE
suffix:semicolon
id|btv-&gt;audio
op_or_assign
id|mode
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* if audio mute or not in H-lock, turn audio off */
r_if
c_cond
(paren
(paren
id|btv-&gt;audio
op_amp
id|AUDIO_MUTE
)paren
)paren
id|mode
op_assign
id|AUDIO_OFF
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mode
op_eq
id|AUDIO_TUNER
)paren
op_logical_and
(paren
id|btv-&gt;radio
)paren
)paren
id|mode
op_assign
id|AUDIO_RADIO
suffix:semicolon
id|btaor
c_func
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audiomux
(braket
id|mode
)braket
comma
op_complement
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask
comma
id|BT848_GPIO_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_gpio
)paren
id|bttv_gpio_tracking
c_func
(paren
id|btv
comma
id|audio_modes
(braket
id|mode
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|no_irq_context
)paren
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|AUDC_SET_INPUT
comma
op_amp
(paren
id|mode
)paren
)paren
suffix:semicolon
)brace
DECL|function|bt848_dma
r_extern
r_inline
r_void
id|bt848_dma
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
id|uint
id|state
)paren
(brace
r_if
c_cond
(paren
id|state
)paren
id|btor
c_func
(paren
l_int|3
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
r_else
id|btand
c_func
(paren
op_complement
l_int|3
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
)brace
multiline_comment|/* If Bt848a or Bt849, use PLL for PAL/SECAM and crystal for NTSC*/
multiline_comment|/* Frequency = (F_input / PLL_X) * PLL_I.PLL_F/PLL_C &n;   PLL_X = Reference pre-divider (0=1, 1=2) &n;   PLL_C = Post divider (0=6, 1=4)&n;   PLL_I = Integer input &n;   PLL_F = Fractional input &n;   &n;   F_input = 28.636363 MHz: &n;   PAL (CLKx2 = 35.46895 MHz): PLL_X = 1, PLL_I = 0x0E, PLL_F = 0xDCF9, PLL_C = 0&n;*/
DECL|function|set_pll_freq
r_static
r_void
id|set_pll_freq
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
id|fin
comma
r_int
r_int
id|fout
)paren
(brace
r_int
r_char
id|fl
comma
id|fh
comma
id|fi
suffix:semicolon
multiline_comment|/* prevent overflows */
id|fin
op_div_assign
l_int|4
suffix:semicolon
id|fout
op_div_assign
l_int|4
suffix:semicolon
id|fout
op_mul_assign
l_int|12
suffix:semicolon
id|fi
op_assign
id|fout
op_div
id|fin
suffix:semicolon
id|fout
op_assign
(paren
id|fout
op_mod
id|fin
)paren
op_star
l_int|256
suffix:semicolon
id|fh
op_assign
id|fout
op_div
id|fin
suffix:semicolon
id|fout
op_assign
(paren
id|fout
op_mod
id|fin
)paren
op_star
l_int|256
suffix:semicolon
id|fl
op_assign
id|fout
op_div
id|fin
suffix:semicolon
multiline_comment|/*printk(&quot;0x%02x 0x%02x 0x%02x&bslash;n&quot;, fi, fh, fl);*/
id|btwrite
c_func
(paren
id|fl
comma
id|BT848_PLL_F_LO
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|fh
comma
id|BT848_PLL_F_HI
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|fi
op_or
id|BT848_PLL_X
comma
id|BT848_PLL_XCI
)paren
suffix:semicolon
)brace
DECL|function|set_pll
r_static
r_int
id|set_pll
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|tv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;pll.pll_crystal
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;pll.pll_ifreq
op_eq
id|btv-&gt;pll.pll_ofreq
)paren
(brace
multiline_comment|/* no PLL needed */
r_if
c_cond
(paren
id|btv-&gt;pll.pll_current
op_eq
l_int|0
)paren
(brace
multiline_comment|/* printk (&quot;bttv%d: PLL: is off&bslash;n&quot;,btv-&gt;nr); */
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
(paren
l_string|&quot;bttv%d: PLL: switching off&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_TGCTRL
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_PLL_XCI
)paren
suffix:semicolon
id|btv-&gt;pll.pll_current
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;pll.pll_ofreq
op_eq
id|btv-&gt;pll.pll_current
)paren
(brace
multiline_comment|/* printk(&quot;bttv%d: PLL: no change required&bslash;n&quot;,btv-&gt;nr); */
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: PLL: %d =&gt; %d ... &quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;pll.pll_ifreq
comma
id|btv-&gt;pll.pll_ofreq
)paren
suffix:semicolon
id|set_pll_freq
c_func
(paren
id|btv
comma
id|btv-&gt;pll.pll_ifreq
comma
id|btv-&gt;pll.pll_ofreq
)paren
suffix:semicolon
multiline_comment|/*  Let other people run while the PLL stabilizes */
id|tv
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|10
suffix:semicolon
multiline_comment|/* .1 seconds */
r_do
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|tv
)paren
)paren
(brace
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|btread
c_func
(paren
id|BT848_DSTATUS
)paren
op_amp
id|BT848_DSTATUS_PLOCK
)paren
)paren
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_DSTATUS
)paren
suffix:semicolon
r_else
(brace
id|btwrite
c_func
(paren
l_int|0x08
comma
id|BT848_TGCTRL
)paren
suffix:semicolon
id|btv-&gt;pll.pll_current
op_assign
id|btv-&gt;pll.pll_ofreq
suffix:semicolon
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|btv-&gt;pll.pll_current
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;oops&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|bt848_muxsel
r_static
r_void
id|bt848_muxsel
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
id|input
)paren
(brace
macro_line|#if 0 /* seems no card uses this ... */
id|btaor
c_func
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask2
comma
op_complement
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask2
comma
id|BT848_GPIO_OUT_EN
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* This seems to get rid of some synchronization problems */
id|btand
c_func
(paren
op_complement
(paren
l_int|3
op_lshift
l_int|5
)paren
comma
id|BT848_IFORM
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|input
op_mod_assign
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|video_inputs
suffix:semicolon
r_if
c_cond
(paren
id|input
op_eq
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|svhs
)paren
(brace
id|btor
c_func
(paren
id|BT848_CONTROL_COMP
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btor
c_func
(paren
id|BT848_CONTROL_COMP
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
)brace
r_else
(brace
id|btand
c_func
(paren
op_complement
id|BT848_CONTROL_COMP
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btand
c_func
(paren
op_complement
id|BT848_CONTROL_COMP
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
)brace
id|btaor
c_func
(paren
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|muxsel
(braket
id|input
op_amp
l_int|7
)braket
op_amp
l_int|3
)paren
op_lshift
l_int|5
comma
op_complement
(paren
l_int|3
op_lshift
l_int|5
)paren
comma
id|BT848_IFORM
)paren
suffix:semicolon
id|audio
c_func
(paren
id|btv
comma
(paren
id|input
op_ne
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|tuner
)paren
ques
c_cond
id|AUDIO_EXTERN
suffix:colon
id|AUDIO_TUNER
comma
l_int|1
)paren
suffix:semicolon
macro_line|#if 0 /* seems no card uses this ... */
id|btaor
c_func
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|muxsel
(braket
id|input
)braket
op_rshift
l_int|4
comma
op_complement
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|gpiomask2
comma
id|BT848_GPIO_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_gpio
)paren
id|bttv_gpio_tracking
c_func
(paren
id|btv
comma
l_string|&quot;muxsel&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|struct|tvnorm
r_struct
id|tvnorm
(brace
DECL|member|Fsc
id|u32
id|Fsc
suffix:semicolon
DECL|member|swidth
DECL|member|sheight
id|u16
id|swidth
comma
id|sheight
suffix:semicolon
multiline_comment|/* scaled standard width, height */
DECL|member|totalwidth
id|u16
id|totalwidth
suffix:semicolon
DECL|member|adelay
DECL|member|bdelay
DECL|member|iform
id|u8
id|adelay
comma
id|bdelay
comma
id|iform
suffix:semicolon
DECL|member|scaledtwidth
id|u32
id|scaledtwidth
suffix:semicolon
DECL|member|hdelayx1
DECL|member|hactivex1
id|u16
id|hdelayx1
comma
id|hactivex1
suffix:semicolon
DECL|member|vdelay
id|u16
id|vdelay
suffix:semicolon
DECL|member|vbipack
id|u8
id|vbipack
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|tvnorms
r_static
r_struct
id|tvnorm
id|tvnorms
(braket
)braket
op_assign
(brace
multiline_comment|/* PAL-BDGHI */
multiline_comment|/* max. active video is actually 922, but 924 is divisible by 4 and 3! */
multiline_comment|/* actually, max active PAL with HSCALE=0 is 948, NTSC is 768 - nil */
(brace
l_int|35468950
comma
l_int|924
comma
l_int|576
comma
l_int|1135
comma
l_int|0x7f
comma
l_int|0x72
comma
(paren
id|BT848_IFORM_PAL_BDGHI
op_or
id|BT848_IFORM_XT1
)paren
comma
l_int|1135
comma
l_int|186
comma
l_int|924
comma
l_int|0x20
comma
l_int|255
)brace
comma
multiline_comment|/* NTSC */
(brace
l_int|28636363
comma
l_int|768
comma
l_int|480
comma
l_int|910
comma
l_int|0x68
comma
l_int|0x5d
comma
(paren
id|BT848_IFORM_NTSC
op_or
id|BT848_IFORM_XT0
)paren
comma
l_int|910
comma
l_int|128
comma
l_int|910
comma
l_int|0x1a
comma
l_int|144
)brace
comma
macro_line|#if 0
multiline_comment|/* SECAM EAST */
(brace
l_int|35468950
comma
l_int|768
comma
l_int|576
comma
l_int|1135
comma
l_int|0x7f
comma
l_int|0xb0
comma
(paren
id|BT848_IFORM_SECAM
op_or
id|BT848_IFORM_XT1
)paren
comma
l_int|944
comma
l_int|186
comma
l_int|922
comma
l_int|0x20
comma
l_int|255
)brace
comma
macro_line|#else
multiline_comment|/* SECAM L */
(brace
l_int|35468950
comma
l_int|924
comma
l_int|576
comma
l_int|1135
comma
l_int|0x7f
comma
l_int|0xb0
comma
(paren
id|BT848_IFORM_SECAM
op_or
id|BT848_IFORM_XT1
)paren
comma
l_int|1135
comma
l_int|186
comma
l_int|922
comma
l_int|0x20
comma
l_int|255
)brace
comma
macro_line|#endif
multiline_comment|/* PAL-NC */
(brace
l_int|28636363
comma
l_int|640
comma
l_int|576
comma
l_int|910
comma
l_int|0x68
comma
l_int|0x5d
comma
(paren
id|BT848_IFORM_PAL_NC
op_or
id|BT848_IFORM_XT0
)paren
comma
l_int|780
comma
l_int|130
comma
l_int|734
comma
l_int|0x1a
comma
l_int|144
)brace
comma
multiline_comment|/* PAL-M */
(brace
l_int|28636363
comma
l_int|640
comma
l_int|480
comma
l_int|910
comma
l_int|0x68
comma
l_int|0x5d
comma
(paren
id|BT848_IFORM_PAL_M
op_or
id|BT848_IFORM_XT0
)paren
comma
l_int|780
comma
l_int|135
comma
l_int|754
comma
l_int|0x1a
comma
l_int|144
)brace
comma
multiline_comment|/* PAL-N */
(brace
l_int|35468950
comma
l_int|768
comma
l_int|576
comma
l_int|1135
comma
l_int|0x7f
comma
l_int|0x72
comma
(paren
id|BT848_IFORM_PAL_N
op_or
id|BT848_IFORM_XT1
)paren
comma
l_int|944
comma
l_int|186
comma
l_int|922
comma
l_int|0x20
comma
l_int|144
)brace
comma
multiline_comment|/* NTSC-Japan */
(brace
l_int|28636363
comma
l_int|640
comma
l_int|480
comma
l_int|910
comma
l_int|0x68
comma
l_int|0x5d
comma
(paren
id|BT848_IFORM_NTSC_J
op_or
id|BT848_IFORM_XT0
)paren
comma
l_int|780
comma
l_int|135
comma
l_int|754
comma
l_int|0x16
comma
l_int|144
)brace
comma
)brace
suffix:semicolon
DECL|macro|TVNORMS
mdefine_line|#define TVNORMS (sizeof(tvnorms)/sizeof(tvnorm))
DECL|macro|VBI_SPL
mdefine_line|#define VBI_SPL 2044
multiline_comment|/* RISC command to write one VBI data line */
DECL|macro|VBI_RISC
mdefine_line|#define VBI_RISC BT848_RISC_WRITE|VBI_SPL|BT848_RISC_EOL|BT848_RISC_SOL
DECL|function|make_vbitab
r_static
r_void
id|make_vbitab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|po
op_assign
(paren
r_int
r_int
op_star
)paren
id|btv-&gt;vbi_odd
suffix:semicolon
r_int
r_int
op_star
id|pe
op_assign
(paren
r_int
r_int
op_star
)paren
id|btv-&gt;vbi_even
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: vbi1: po=%08lx pe=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|po
)paren
comma
id|virt_to_bus
c_func
(paren
id|pe
)paren
)paren
suffix:semicolon
op_star
(paren
id|po
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|po
op_increment
)paren
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
(paren
id|po
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|VBI_RISC
)paren
suffix:semicolon
op_star
(paren
id|po
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
(paren
r_int
r_int
)paren
id|btv-&gt;vbibuf
op_plus
id|i
op_star
l_int|2048
)paren
)paren
suffix:semicolon
)brace
op_star
(paren
id|po
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|po
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|4
)paren
)paren
suffix:semicolon
op_star
(paren
id|pe
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|pe
op_increment
)paren
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
(paren
id|pe
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|VBI_RISC
)paren
suffix:semicolon
op_star
(paren
id|pe
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
(paren
r_int
r_int
)paren
id|btv-&gt;vbibuf
op_plus
id|i
op_star
l_int|2048
)paren
)paren
suffix:semicolon
)brace
op_star
(paren
id|pe
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
id|BT848_RISC_IRQ
op_or
(paren
l_int|0x01
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
op_star
(paren
id|pe
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: vbi2: po=%08lx pe=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|po
)paren
comma
id|virt_to_bus
c_func
(paren
id|pe
)paren
)paren
suffix:semicolon
)brace
DECL|variable|fmtbppx2
r_static
r_int
id|fmtbppx2
(braket
l_int|16
)braket
op_assign
(brace
l_int|8
comma
l_int|6
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|4
comma
l_int|3
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|palette2fmt
r_static
r_int
id|palette2fmt
(braket
)braket
op_assign
(brace
l_int|0
comma
id|BT848_COLOR_FMT_Y8
comma
id|BT848_COLOR_FMT_RGB8
comma
id|BT848_COLOR_FMT_RGB16
comma
id|BT848_COLOR_FMT_RGB24
comma
id|BT848_COLOR_FMT_RGB32
comma
id|BT848_COLOR_FMT_RGB15
comma
id|BT848_COLOR_FMT_YUY2
comma
id|BT848_COLOR_FMT_BtYUV
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|BT848_COLOR_FMT_RAW
comma
id|BT848_COLOR_FMT_YCrCb422
comma
id|BT848_COLOR_FMT_YCrCb411
comma
id|BT848_COLOR_FMT_YCrCb422
comma
id|BT848_COLOR_FMT_YCrCb411
comma
)brace
suffix:semicolon
DECL|macro|PALETTEFMT_MAX
mdefine_line|#define PALETTEFMT_MAX (sizeof(palette2fmt)/sizeof(int))
DECL|function|make_rawrisctab
r_static
r_int
id|make_rawrisctab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
op_star
id|ro
comma
r_int
r_int
op_star
id|re
comma
r_int
r_int
op_star
id|vbuf
)paren
(brace
r_int
r_int
id|line
suffix:semicolon
r_int
r_int
id|bpl
op_assign
l_int|1024
suffix:semicolon
multiline_comment|/* bytes per line */
r_int
r_int
id|vadr
op_assign
(paren
r_int
r_int
)paren
id|vbuf
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* In PAL 650 blocks of 256 DWORDs are sampled, but only if VDELAY&n;           is 2 and without separate VBI grabbing.&n;           We&squot;ll have to handle this inside the IRQ handler ... */
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
l_int|640
suffix:semicolon
id|line
op_increment
)paren
(brace
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|bpl
op_or
id|BT848_RISC_SOL
op_or
id|BT848_RISC_EOL
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|bpl
op_or
id|BT848_RISC_SOL
op_or
id|BT848_RISC_EOL
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
op_plus
id|gbufsize
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|bpl
suffix:semicolon
)brace
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_even
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
id|BT848_RISC_IRQ
op_or
(paren
l_int|2
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_odd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|make_prisctab
r_static
r_int
id|make_prisctab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
op_star
id|ro
comma
r_int
r_int
op_star
id|re
comma
r_int
r_int
op_star
id|vbuf
comma
r_int
r_int
id|width
comma
r_int
r_int
id|height
comma
r_int
r_int
id|fmt
)paren
(brace
r_int
r_int
id|line
comma
id|lmask
suffix:semicolon
r_int
r_int
id|bl
comma
id|blcr
comma
id|blcb
comma
id|rcmd
suffix:semicolon
r_int
r_int
id|todo
suffix:semicolon
r_int
r_int
op_star
op_star
id|rp
suffix:semicolon
r_int
id|inter
suffix:semicolon
r_int
r_int
id|cbadr
comma
id|cradr
suffix:semicolon
r_int
r_int
id|vadr
op_assign
(paren
r_int
r_int
)paren
id|vbuf
suffix:semicolon
r_int
id|shift
comma
id|csize
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: prisc1: ro=%08lx re=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|ro
)paren
comma
id|virt_to_bus
c_func
(paren
id|re
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
id|VIDEO_PALETTE_YUV422P
suffix:colon
id|csize
op_assign
(paren
id|width
op_star
id|height
)paren
op_rshift
l_int|1
suffix:semicolon
id|shift
op_assign
l_int|1
suffix:semicolon
id|lmask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV411P
suffix:colon
id|csize
op_assign
(paren
id|width
op_star
id|height
)paren
op_rshift
l_int|2
suffix:semicolon
id|shift
op_assign
l_int|2
suffix:semicolon
id|lmask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV420P
suffix:colon
id|csize
op_assign
(paren
id|width
op_star
id|height
)paren
op_rshift
l_int|2
suffix:semicolon
id|shift
op_assign
l_int|1
suffix:semicolon
id|lmask
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV410P
suffix:colon
id|csize
op_assign
(paren
id|width
op_star
id|height
)paren
op_rshift
l_int|4
suffix:semicolon
id|shift
op_assign
l_int|2
suffix:semicolon
id|lmask
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|cbadr
op_assign
id|vadr
op_plus
(paren
id|width
op_star
id|height
)paren
suffix:semicolon
id|cradr
op_assign
id|cbadr
op_plus
id|csize
suffix:semicolon
id|inter
op_assign
(paren
id|height
OG
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
dot
id|sheight
op_div
l_int|2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM3
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM3
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
(paren
id|height
op_lshift
(paren
l_int|1
op_xor
id|inter
)paren
)paren
suffix:semicolon
id|line
op_increment
)paren
(brace
r_if
c_cond
(paren
id|line
op_eq
id|height
)paren
(brace
id|vadr
op_add_assign
id|csize
op_lshift
l_int|1
suffix:semicolon
id|cbadr
op_assign
id|vadr
op_plus
(paren
id|width
op_star
id|height
)paren
suffix:semicolon
id|cradr
op_assign
id|cbadr
op_plus
id|csize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inter
)paren
id|rp
op_assign
(paren
id|line
op_amp
l_int|1
)paren
ques
c_cond
op_amp
id|re
suffix:colon
op_amp
id|ro
suffix:semicolon
r_else
id|rp
op_assign
(paren
id|line
op_ge
id|height
)paren
ques
c_cond
op_amp
id|ro
suffix:colon
op_amp
id|re
suffix:semicolon
r_if
c_cond
(paren
id|line
op_amp
id|lmask
)paren
(brace
id|rcmd
op_assign
id|BT848_RISC_WRITE1S23
op_or
id|BT848_RISC_SOL
suffix:semicolon
)brace
r_else
id|rcmd
op_assign
id|BT848_RISC_WRITE123
op_or
id|BT848_RISC_SOL
suffix:semicolon
id|todo
op_assign
id|width
suffix:semicolon
r_while
c_loop
(paren
id|todo
)paren
(brace
id|bl
op_assign
id|PAGE_SIZE
op_minus
(paren
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|vadr
)paren
suffix:semicolon
id|blcr
op_assign
(paren
id|PAGE_SIZE
op_minus
(paren
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|cradr
)paren
)paren
op_lshift
id|shift
suffix:semicolon
id|blcb
op_assign
(paren
id|PAGE_SIZE
op_minus
(paren
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|cbadr
)paren
)paren
op_lshift
id|shift
suffix:semicolon
id|bl
op_assign
(paren
id|blcr
OL
id|bl
)paren
ques
c_cond
id|blcr
suffix:colon
id|bl
suffix:semicolon
id|bl
op_assign
(paren
id|blcb
OL
id|bl
)paren
ques
c_cond
id|blcb
suffix:colon
id|bl
suffix:semicolon
id|bl
op_assign
(paren
id|bl
OG
id|todo
)paren
ques
c_cond
id|todo
suffix:colon
id|bl
suffix:semicolon
id|blcr
op_assign
id|bl
op_rshift
id|shift
suffix:semicolon
id|blcb
op_assign
id|blcr
suffix:semicolon
multiline_comment|/* bl now containts the longest row that can be written */
id|todo
op_sub_assign
id|bl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|todo
)paren
(brace
id|rcmd
op_or_assign
id|BT848_RISC_EOL
suffix:semicolon
)brace
multiline_comment|/* if this is the last EOL */
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|rcmd
op_or
id|bl
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|blcb
op_or
(paren
id|blcr
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|bl
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rcmd
op_amp
(paren
l_int|15
op_lshift
l_int|28
)paren
)paren
op_eq
id|BT848_RISC_WRITE123
)paren
(brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
(paren
id|kvirt_to_bus
c_func
(paren
id|cbadr
)paren
)paren
suffix:semicolon
id|cbadr
op_add_assign
id|blcb
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|cradr
)paren
)paren
suffix:semicolon
id|cradr
op_add_assign
id|blcr
suffix:semicolon
)brace
id|rcmd
op_and_assign
op_complement
id|BT848_RISC_SOL
suffix:semicolon
multiline_comment|/* only the first has SOL */
)brace
)brace
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_even
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
id|BT848_RISC_IRQ
op_or
(paren
l_int|2
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_odd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: prisc2: ro=%08lx re=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|ro
)paren
comma
id|virt_to_bus
c_func
(paren
id|re
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|make_vrisctab
r_static
r_int
id|make_vrisctab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
op_star
id|ro
comma
r_int
r_int
op_star
id|re
comma
r_int
r_int
op_star
id|vbuf
comma
r_int
r_int
id|width
comma
r_int
r_int
id|height
comma
r_int
r_int
id|palette
)paren
(brace
r_int
r_int
id|line
suffix:semicolon
r_int
r_int
id|bpl
suffix:semicolon
multiline_comment|/* bytes per line */
r_int
r_int
id|bl
suffix:semicolon
r_int
r_int
id|todo
suffix:semicolon
r_int
r_int
op_star
op_star
id|rp
suffix:semicolon
r_int
id|inter
suffix:semicolon
r_int
r_int
id|vadr
op_assign
(paren
r_int
r_int
)paren
id|vbuf
suffix:semicolon
r_if
c_cond
(paren
id|palette
op_eq
id|VIDEO_PALETTE_RAW
)paren
r_return
id|make_rawrisctab
c_func
(paren
id|btv
comma
id|ro
comma
id|re
comma
id|vbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|palette
op_ge
id|VIDEO_PALETTE_PLANAR
)paren
r_return
id|make_prisctab
c_func
(paren
id|btv
comma
id|ro
comma
id|re
comma
id|vbuf
comma
id|width
comma
id|height
comma
id|palette
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: vrisc1: ro=%08lx re=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|ro
)paren
comma
id|virt_to_bus
c_func
(paren
id|re
)paren
)paren
suffix:semicolon
id|inter
op_assign
(paren
id|height
OG
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
dot
id|sheight
op_div
l_int|2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|bpl
op_assign
id|width
op_star
id|fmtbppx2
(braket
id|palette2fmt
(braket
id|palette
)braket
op_amp
l_int|0xf
)braket
op_div
l_int|2
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
(paren
id|height
op_lshift
(paren
l_int|1
op_xor
id|inter
)paren
)paren
suffix:semicolon
id|line
op_increment
)paren
(brace
r_if
c_cond
(paren
id|inter
)paren
id|rp
op_assign
(paren
id|line
op_amp
l_int|1
)paren
ques
c_cond
op_amp
id|re
suffix:colon
op_amp
id|ro
suffix:semicolon
r_else
id|rp
op_assign
(paren
id|line
op_ge
id|height
)paren
ques
c_cond
op_amp
id|ro
suffix:colon
op_amp
id|re
suffix:semicolon
id|bl
op_assign
id|PAGE_SIZE
op_minus
(paren
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|vadr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bpl
op_le
id|bl
)paren
(brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_SOL
op_or
id|BT848_RISC_EOL
op_or
id|bpl
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|bpl
suffix:semicolon
)brace
r_else
(brace
id|todo
op_assign
id|bpl
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_SOL
op_or
id|bl
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|bl
suffix:semicolon
id|todo
op_sub_assign
id|bl
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
id|PAGE_SIZE
)paren
(brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|PAGE_SIZE
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|todo
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_EOL
op_or
id|todo
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|kvirt_to_bus
c_func
(paren
id|vadr
)paren
)paren
suffix:semicolon
id|vadr
op_add_assign
id|todo
suffix:semicolon
)brace
)brace
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_even
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
id|BT848_RISC_IRQ
op_or
(paren
l_int|2
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_odd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: vrisc2: ro=%08lx re=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|ro
)paren
comma
id|virt_to_bus
c_func
(paren
id|re
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|lmaskt
r_static
r_int
r_char
id|lmaskt
(braket
l_int|8
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xfe
comma
l_int|0xfc
comma
l_int|0xf8
comma
l_int|0xf0
comma
l_int|0xe0
comma
l_int|0xc0
comma
l_int|0x80
)brace
suffix:semicolon
DECL|variable|rmaskt
r_static
r_int
r_char
id|rmaskt
(braket
l_int|8
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x03
comma
l_int|0x07
comma
l_int|0x0f
comma
l_int|0x1f
comma
l_int|0x3f
comma
l_int|0x7f
comma
l_int|0xff
)brace
suffix:semicolon
DECL|function|clip_draw_rectangle
r_static
r_void
id|clip_draw_rectangle
c_func
(paren
r_int
r_char
op_star
id|clipmap
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|w
comma
r_int
id|h
)paren
(brace
r_int
r_char
id|lmask
comma
id|rmask
comma
op_star
id|p
suffix:semicolon
r_int
id|W
comma
id|l
comma
id|r
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv clip: %dx%d+%d+%d&bslash;n&quot;
comma
id|w
comma
id|h
comma
id|x
comma
id|y
)paren
suffix:semicolon
multiline_comment|/* bitmap is fixed width, 128 bytes (1024 pixels represented) */
r_if
c_cond
(paren
id|x
OL
l_int|0
)paren
(brace
id|w
op_add_assign
id|x
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|y
OL
l_int|0
)paren
(brace
id|h
op_add_assign
id|y
suffix:semicolon
id|y
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w
OL
l_int|0
op_logical_or
id|h
OL
l_int|0
)paren
multiline_comment|/* catch bad clips */
r_return
suffix:semicolon
multiline_comment|/* out of range data should just fall through */
r_if
c_cond
(paren
id|y
op_plus
id|h
op_ge
l_int|625
)paren
id|h
op_assign
l_int|625
op_minus
id|y
suffix:semicolon
r_if
c_cond
(paren
id|x
op_plus
id|w
op_ge
l_int|1024
)paren
id|w
op_assign
l_int|1024
op_minus
id|x
suffix:semicolon
id|l
op_assign
id|x
op_rshift
l_int|3
suffix:semicolon
id|r
op_assign
(paren
id|x
op_plus
id|w
op_minus
l_int|1
)paren
op_rshift
l_int|3
suffix:semicolon
id|W
op_assign
id|r
op_minus
id|l
op_minus
l_int|1
suffix:semicolon
id|lmask
op_assign
id|lmaskt
(braket
id|x
op_amp
l_int|7
)braket
suffix:semicolon
id|rmask
op_assign
id|rmaskt
(braket
(paren
id|x
op_plus
id|w
op_minus
l_int|1
)paren
op_amp
l_int|7
)braket
suffix:semicolon
id|p
op_assign
id|clipmap
op_plus
l_int|128
op_star
id|y
op_plus
id|l
suffix:semicolon
r_if
c_cond
(paren
id|W
OG
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|h
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|128
)paren
(brace
op_star
id|p
op_or_assign
id|lmask
suffix:semicolon
id|memset
c_func
(paren
id|p
op_plus
l_int|1
comma
l_int|0xff
comma
id|W
)paren
suffix:semicolon
id|p
(braket
id|W
op_plus
l_int|1
)braket
op_or_assign
id|rmask
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|W
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|h
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|128
)paren
(brace
id|p
(braket
l_int|0
)braket
op_or_assign
id|lmask
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_or_assign
id|rmask
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|h
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|128
)paren
id|p
(braket
l_int|0
)braket
op_or_assign
id|lmask
op_amp
id|rmask
suffix:semicolon
)brace
)brace
DECL|function|make_clip_tab
r_static
r_void
id|make_clip_tab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|video_clip
op_star
id|cr
comma
r_int
id|ncr
)paren
(brace
r_int
id|i
comma
id|line
comma
id|x
comma
id|y
comma
id|bpl
comma
id|width
comma
id|height
comma
id|inter
comma
id|maxw
suffix:semicolon
r_int
r_int
id|bpp
comma
id|dx
comma
id|sx
comma
op_star
op_star
id|rp
comma
op_star
id|ro
comma
op_star
id|re
comma
id|flags
comma
id|len
suffix:semicolon
r_int
r_int
id|adr
suffix:semicolon
r_int
r_char
op_star
id|clipmap
comma
op_star
id|clipline
comma
id|cbit
comma
id|lastbit
comma
id|outofmem
suffix:semicolon
multiline_comment|/* take care: bpp != btv-&gt;win.bpp is allowed here */
id|bpp
op_assign
id|fmtbppx2
(braket
id|btv-&gt;win.color_fmt
op_amp
l_int|0xf
)braket
op_div
l_int|2
suffix:semicolon
id|bpl
op_assign
id|btv-&gt;win.bpl
suffix:semicolon
id|adr
op_assign
id|btv-&gt;win.vidadr
op_plus
id|btv-&gt;win.x
op_star
id|btv-&gt;win.bpp
op_plus
id|btv-&gt;win.y
op_star
id|bpl
suffix:semicolon
id|inter
op_assign
(paren
id|btv-&gt;win.interlace
op_amp
l_int|1
)paren
op_xor
l_int|1
suffix:semicolon
id|width
op_assign
id|btv-&gt;win.width
suffix:semicolon
id|height
op_assign
id|btv-&gt;win.height
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: clip1: pal=%d size=%dx%d, bpl=%d bpp=%d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;picture.palette
comma
id|width
comma
id|height
comma
id|bpl
comma
id|bpp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
l_int|1023
)paren
(brace
id|width
op_assign
l_int|1023
suffix:semicolon
)brace
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|height
OG
l_int|625
)paren
(brace
id|height
op_assign
l_int|625
suffix:semicolon
)brace
multiline_comment|/* sanity check */
id|ro
op_assign
id|btv-&gt;risc_scr_odd
suffix:semicolon
id|re
op_assign
id|btv-&gt;risc_scr_even
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: clip: ro=%08lx re=%08lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|ro
)paren
comma
id|virt_to_bus
c_func
(paren
id|re
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|clipmap
op_assign
id|vmalloc
c_func
(paren
id|VIDEO_CLIPMAP_SIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* can&squot;t clip, don&squot;t generate any risc code */
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_even
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_odd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ncr
OL
l_int|0
)paren
(brace
multiline_comment|/* bitmap was pased */
id|memcpy
c_func
(paren
id|clipmap
comma
(paren
r_int
r_char
op_star
)paren
id|cr
comma
id|VIDEO_CLIPMAP_SIZE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* convert rectangular clips to a bitmap */
id|memset
c_func
(paren
id|clipmap
comma
l_int|0
comma
id|VIDEO_CLIPMAP_SIZE
)paren
suffix:semicolon
multiline_comment|/* clear map */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ncr
suffix:semicolon
id|i
op_increment
)paren
id|clip_draw_rectangle
c_func
(paren
id|clipmap
comma
id|cr
(braket
id|i
)braket
dot
id|x
comma
id|cr
(braket
id|i
)braket
dot
id|y
comma
id|cr
(braket
id|i
)braket
dot
id|width
comma
id|cr
(braket
id|i
)braket
dot
id|height
)paren
suffix:semicolon
)brace
multiline_comment|/* clip against viewing window AND screen &n;&t;   so we do not have to rely on the user program&n;&t; */
id|maxw
op_assign
(paren
id|bpl
op_minus
id|btv-&gt;win.x
op_star
id|btv-&gt;win.bpp
)paren
op_div
id|bpp
suffix:semicolon
id|clip_draw_rectangle
c_func
(paren
id|clipmap
comma
(paren
id|width
OG
id|maxw
)paren
ques
c_cond
id|maxw
suffix:colon
id|width
comma
l_int|0
comma
l_int|1024
comma
l_int|768
)paren
suffix:semicolon
id|clip_draw_rectangle
c_func
(paren
id|clipmap
comma
l_int|0
comma
(paren
id|btv-&gt;win.y
op_plus
id|height
OG
id|btv-&gt;win.sheight
)paren
ques
c_cond
(paren
id|btv-&gt;win.sheight
op_minus
id|btv-&gt;win.y
)paren
suffix:colon
id|height
comma
l_int|1024
comma
l_int|768
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;win.x
OL
l_int|0
)paren
id|clip_draw_rectangle
c_func
(paren
id|clipmap
comma
l_int|0
comma
l_int|0
comma
op_minus
(paren
id|btv-&gt;win.x
)paren
comma
l_int|768
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;win.y
OL
l_int|0
)paren
id|clip_draw_rectangle
c_func
(paren
id|clipmap
comma
l_int|0
comma
l_int|0
comma
l_int|1024
comma
op_minus
(paren
id|btv-&gt;win.y
)paren
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* translate bitmap to risc code */
r_for
c_loop
(paren
id|line
op_assign
id|outofmem
op_assign
l_int|0
suffix:semicolon
id|line
OL
(paren
id|height
op_lshift
id|inter
)paren
op_logical_and
op_logical_neg
id|outofmem
suffix:semicolon
id|line
op_increment
)paren
(brace
id|y
op_assign
id|line
op_rshift
id|inter
suffix:semicolon
id|rp
op_assign
(paren
id|line
op_amp
l_int|1
)paren
ques
c_cond
op_amp
id|re
suffix:colon
op_amp
id|ro
suffix:semicolon
id|clipline
op_assign
id|clipmap
op_plus
(paren
id|y
op_lshift
l_int|7
)paren
suffix:semicolon
multiline_comment|/* running pointers ... */
id|lastbit
op_assign
op_star
id|clipline
op_amp
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
id|dx
op_assign
l_int|0
comma
id|sx
op_assign
l_int|0
suffix:semicolon
id|x
op_le
id|width
op_logical_and
op_logical_neg
id|outofmem
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_eq
(paren
id|x
op_amp
l_int|7
)paren
)paren
(brace
multiline_comment|/* check bytes not bits if we can ... */
r_if
c_cond
(paren
id|lastbit
)paren
(brace
r_while
c_loop
(paren
l_int|0xff
op_eq
op_star
id|clipline
op_logical_and
id|x
OL
id|width
op_minus
l_int|8
)paren
(brace
id|x
op_add_assign
l_int|8
suffix:semicolon
id|dx
op_add_assign
l_int|8
suffix:semicolon
id|clipline
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
l_int|0x00
op_eq
op_star
id|clipline
op_logical_and
id|x
OL
id|width
op_minus
l_int|8
)paren
(brace
id|x
op_add_assign
l_int|8
suffix:semicolon
id|dx
op_add_assign
l_int|8
suffix:semicolon
id|clipline
op_increment
suffix:semicolon
)brace
)brace
)brace
id|cbit
op_assign
op_star
id|clipline
op_amp
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
OL
id|width
op_logical_and
op_logical_neg
id|lastbit
op_eq
op_logical_neg
id|cbit
)paren
(brace
id|dx
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* generate the dma controller code */
id|len
op_assign
id|dx
op_star
id|bpp
suffix:semicolon
id|flags
op_assign
(paren
(paren
id|bpp
op_eq
l_int|4
)paren
ques
c_cond
id|BT848_RISC_BYTE3
suffix:colon
l_int|0
)paren
suffix:semicolon
id|flags
op_or_assign
(paren
(paren
op_logical_neg
id|sx
)paren
ques
c_cond
id|BT848_RISC_SOL
suffix:colon
l_int|0
)paren
suffix:semicolon
id|flags
op_or_assign
(paren
(paren
id|sx
op_plus
id|dx
op_eq
id|width
)paren
ques
c_cond
id|BT848_RISC_EOL
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lastbit
)paren
(brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|flags
op_or
id|len
)paren
suffix:semicolon
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|adr
op_plus
id|bpp
op_star
id|sx
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
op_star
id|rp
)paren
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SKIP
op_or
id|flags
op_or
id|len
)paren
suffix:semicolon
)brace
id|lastbit
op_assign
id|cbit
suffix:semicolon
id|sx
op_add_assign
id|dx
suffix:semicolon
id|dx
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ro
op_minus
id|btv-&gt;risc_scr_odd
OG
(paren
id|RISCMEM_LEN
op_rshift
l_int|3
)paren
op_minus
l_int|16
)paren
id|outofmem
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|re
op_minus
id|btv-&gt;risc_scr_even
OG
(paren
id|RISCMEM_LEN
op_rshift
l_int|3
)paren
op_minus
l_int|16
)paren
id|outofmem
op_increment
suffix:semicolon
)brace
id|x
op_increment
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
(paren
id|x
op_amp
l_int|7
)paren
)paren
id|clipline
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|inter
)paren
op_logical_or
(paren
id|line
op_amp
l_int|1
)paren
)paren
id|adr
op_add_assign
id|bpl
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|clipmap
)paren
suffix:semicolon
multiline_comment|/* outofmem flag relies on the following code to discard extra data */
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|ro
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_even
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|re
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;bus_vbi_odd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: clip2: pal=%d size=%dx%d, bpl=%d bpp=%d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;picture.palette
comma
id|width
comma
id|height
comma
id|bpl
comma
id|bpp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Set the registers for the size we have specified. Don&squot;t bother&n; *&t;trying to understand this without the BT848 manual in front of&n; *&t;you [AC]. &n; *&n; *&t;PS: The manual is free for download in .pdf format from &n; *&t;www.brooktree.com - nicely done those folks.&n; */
DECL|function|bt848_set_eogeo
r_static
r_inline
r_void
id|bt848_set_eogeo
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|tvnorm
op_star
id|tvn
comma
r_int
id|odd
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
id|u16
id|vscale
comma
id|hscale
suffix:semicolon
id|u32
id|xsf
comma
id|sr
suffix:semicolon
id|u16
id|hdelay
suffix:semicolon
id|u8
id|crop
comma
id|vtc
suffix:semicolon
r_int
id|inter
op_assign
(paren
id|height
OG
id|tvn-&gt;sheight
op_div
l_int|2
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_int
id|off
op_assign
id|odd
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
suffix:semicolon
id|xsf
op_assign
(paren
id|width
op_star
id|tvn-&gt;scaledtwidth
)paren
op_div
id|tvn-&gt;swidth
suffix:semicolon
id|hscale
op_assign
(paren
(paren
id|tvn-&gt;totalwidth
op_star
l_int|4096UL
)paren
op_div
id|xsf
op_minus
l_int|4096
)paren
suffix:semicolon
id|hdelay
op_assign
id|tvn-&gt;hdelayx1
suffix:semicolon
id|hdelay
op_assign
(paren
id|hdelay
op_star
id|width
)paren
op_div
id|tvn-&gt;swidth
suffix:semicolon
id|hdelay
op_and_assign
l_int|0x3fe
suffix:semicolon
id|sr
op_assign
(paren
(paren
id|tvn-&gt;sheight
op_rshift
id|inter
)paren
op_star
l_int|512
)paren
op_div
id|height
op_minus
l_int|512
suffix:semicolon
id|vscale
op_assign
(paren
l_int|0x10000UL
op_minus
id|sr
)paren
op_amp
l_int|0x1fff
suffix:semicolon
id|crop
op_assign
(paren
(paren
id|width
op_rshift
l_int|8
)paren
op_amp
l_int|0x03
)paren
op_or
(paren
(paren
id|hdelay
op_rshift
l_int|6
)paren
op_amp
l_int|0x0c
)paren
op_or
(paren
(paren
id|tvn-&gt;sheight
op_rshift
l_int|4
)paren
op_amp
l_int|0x30
)paren
op_or
(paren
(paren
id|tvn-&gt;vdelay
op_rshift
l_int|2
)paren
op_amp
l_int|0xc0
)paren
suffix:semicolon
id|vscale
op_or_assign
id|inter
ques
c_cond
(paren
id|BT848_VSCALE_INT
op_lshift
l_int|8
)paren
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|combfilter
)paren
(brace
multiline_comment|/* Some people say interpolation looks bad ... */
id|vtc
op_assign
(paren
id|width
OL
l_int|193
)paren
ques
c_cond
l_int|2
suffix:colon
(paren
(paren
id|width
OL
l_int|385
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OL
l_int|769
)paren
id|btor
c_func
(paren
id|BT848_VSCALE_COMB
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
r_else
id|btand
c_func
(paren
op_complement
id|BT848_VSCALE_COMB
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
)brace
r_else
(brace
id|vtc
op_assign
l_int|0
suffix:semicolon
id|btand
c_func
(paren
op_complement
id|BT848_VSCALE_COMB
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
)brace
id|btwrite
c_func
(paren
id|vtc
comma
id|BT848_E_VTC
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|hscale
op_rshift
l_int|8
comma
id|BT848_E_HSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|hscale
op_amp
l_int|0xff
comma
id|BT848_E_HSCALE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btaor
c_func
(paren
(paren
id|vscale
op_rshift
l_int|8
)paren
comma
l_int|0xe0
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|vscale
op_amp
l_int|0xff
comma
id|BT848_E_VSCALE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|width
op_amp
l_int|0xff
comma
id|BT848_E_HACTIVE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|hdelay
op_amp
l_int|0xff
comma
id|BT848_E_HDELAY_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|tvn-&gt;sheight
op_amp
l_int|0xff
comma
id|BT848_E_VACTIVE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|tvn-&gt;vdelay
op_amp
l_int|0xff
comma
id|BT848_E_VDELAY_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|crop
comma
id|BT848_E_CROP
op_plus
id|off
)paren
suffix:semicolon
)brace
DECL|function|bt848_set_geo
r_static
r_void
id|bt848_set_geo
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|no_irq_context
)paren
(brace
id|u16
id|ewidth
comma
id|eheight
comma
id|owidth
comma
id|oheight
suffix:semicolon
id|u16
id|format
comma
id|bswap
suffix:semicolon
r_struct
id|tvnorm
op_star
id|tvn
suffix:semicolon
id|tvn
op_assign
op_amp
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
suffix:semicolon
id|btwrite
c_func
(paren
id|tvn-&gt;adelay
comma
id|BT848_ADELAY
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|tvn-&gt;bdelay
comma
id|BT848_BDELAY
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|tvn-&gt;iform
comma
op_complement
(paren
id|BT848_IFORM_NORM
op_or
id|BT848_IFORM_XTBOTH
)paren
comma
id|BT848_IFORM
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|tvn-&gt;vbipack
comma
id|BT848_VBI_PACK_SIZE
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|1
comma
id|BT848_VBI_PACK_DEL
)paren
suffix:semicolon
id|btv-&gt;pll.pll_ofreq
op_assign
id|tvn-&gt;Fsc
suffix:semicolon
r_if
c_cond
(paren
id|no_irq_context
)paren
id|set_pll
c_func
(paren
id|btv
)paren
suffix:semicolon
id|btv-&gt;win.interlace
op_assign
(paren
id|btv-&gt;win.height
OG
id|tvn-&gt;sheight
op_div
l_int|2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|btv-&gt;risc_cap_odd
op_logical_and
l_int|0
op_eq
id|btv-&gt;risc_cap_even
)paren
(brace
multiline_comment|/* overlay only */
id|owidth
op_assign
id|btv-&gt;win.width
suffix:semicolon
id|oheight
op_assign
id|btv-&gt;win.height
suffix:semicolon
id|ewidth
op_assign
id|btv-&gt;win.width
suffix:semicolon
id|eheight
op_assign
id|btv-&gt;win.height
suffix:semicolon
id|format
op_assign
id|btv-&gt;win.color_fmt
suffix:semicolon
id|bswap
op_assign
id|btv-&gt;fb_color_ctl
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_minus
l_int|1
op_ne
id|btv-&gt;gq_grab
op_logical_and
l_int|0
op_eq
id|btv-&gt;risc_cap_odd
op_logical_and
op_logical_neg
id|btv-&gt;win.interlace
op_logical_and
id|btv-&gt;scr_on
)paren
(brace
multiline_comment|/* odd field -&gt; overlay, even field -&gt; capture */
id|owidth
op_assign
id|btv-&gt;win.width
suffix:semicolon
id|oheight
op_assign
id|btv-&gt;win.height
suffix:semicolon
id|ewidth
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|width
suffix:semicolon
id|eheight
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|height
suffix:semicolon
id|format
op_assign
(paren
id|btv-&gt;win.color_fmt
op_amp
l_int|0xf0
)paren
op_or
(paren
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|fmt
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|bswap
op_assign
id|btv-&gt;fb_color_ctl
op_amp
l_int|0x0a
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* capture only */
id|owidth
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|width
suffix:semicolon
id|oheight
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|height
suffix:semicolon
id|ewidth
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|width
suffix:semicolon
id|eheight
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|height
suffix:semicolon
id|format
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|fmt
suffix:semicolon
id|bswap
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* program odd + even fields */
id|bt848_set_eogeo
c_func
(paren
id|btv
comma
id|tvn
comma
l_int|1
comma
id|owidth
comma
id|oheight
)paren
suffix:semicolon
id|bt848_set_eogeo
c_func
(paren
id|btv
comma
id|tvn
comma
l_int|0
comma
id|ewidth
comma
id|eheight
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|format
comma
id|BT848_COLOR_FMT
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|bswap
op_or
id|BT848_COLOR_CTL_GAMMA
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
DECL|variable|bpp2fmt
r_static
r_int
id|bpp2fmt
(braket
l_int|4
)braket
op_assign
(brace
id|BT848_COLOR_FMT_RGB8
comma
id|BT848_COLOR_FMT_RGB16
comma
id|BT848_COLOR_FMT_RGB24
comma
id|BT848_COLOR_FMT_RGB32
)brace
suffix:semicolon
DECL|function|bt848_set_winsize
r_static
r_void
id|bt848_set_winsize
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
r_int
id|format
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;picture.palette
OG
l_int|0
op_logical_and
id|btv-&gt;picture.palette
op_le
id|VIDEO_PALETTE_YUV422
)paren
(brace
multiline_comment|/* format set by VIDIOCSPICT */
id|format
op_assign
id|palette2fmt
(braket
id|btv-&gt;picture.palette
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* use default for the given color depth */
id|format
op_assign
(paren
id|btv-&gt;win.depth
op_eq
l_int|15
)paren
ques
c_cond
id|BT848_COLOR_FMT_RGB15
suffix:colon
id|bpp2fmt
(braket
(paren
id|btv-&gt;win.bpp
op_minus
l_int|1
)paren
op_amp
l_int|3
)braket
suffix:semicolon
)brace
id|btv-&gt;win.color_fmt
op_assign
id|format
suffix:semicolon
r_if
c_cond
(paren
id|bigendian
op_logical_and
id|format
op_eq
id|BT848_COLOR_FMT_RGB32
)paren
(brace
id|btv-&gt;fb_color_ctl
op_assign
id|BT848_COLOR_CTL_WSWAP_ODD
op_or
id|BT848_COLOR_CTL_WSWAP_EVEN
op_or
id|BT848_COLOR_CTL_BSWAP_ODD
op_or
id|BT848_COLOR_CTL_BSWAP_EVEN
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bigendian
op_logical_and
(paren
id|format
op_eq
id|BT848_COLOR_FMT_RGB16
op_logical_or
id|format
op_eq
id|BT848_COLOR_FMT_RGB15
)paren
)paren
(brace
id|btv-&gt;fb_color_ctl
op_assign
id|BT848_COLOR_CTL_BSWAP_ODD
op_or
id|BT848_COLOR_CTL_BSWAP_EVEN
suffix:semicolon
)brace
r_else
(brace
id|btv-&gt;fb_color_ctl
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&t;RGB8 seems to be a 9x5x5 GRB color cube starting at&n;&t; *&t;color 16. Why the h... can&squot;t they even mention this in the&n;&t; *&t;data sheet?  [AC - because it&squot;s a standard format so I guess&n;&t; *&t;it never occurred to them]&n;&t; *&t;Enable dithering in this mode.&n;&t; */
r_if
c_cond
(paren
id|format
op_eq
id|BT848_COLOR_FMT_RGB8
)paren
id|btand
c_func
(paren
op_complement
id|BT848_CAP_CTL_DITH_FRAME
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
r_else
id|btor
c_func
(paren
id|BT848_CAP_CTL_DITH_FRAME
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Grab into virtual memory.&n; */
DECL|function|vgrab
r_static
r_int
id|vgrab
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|video_mmap
op_star
id|mp
)paren
(brace
r_int
r_int
op_star
id|ro
comma
op_star
id|re
suffix:semicolon
r_int
r_int
op_star
id|vbuf
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;fbuffer
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|fbuffer_alloc
c_func
(paren
id|btv
)paren
)paren
(brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mp-&gt;frame
op_ge
id|gbuffers
op_logical_or
id|mp-&gt;frame
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|stat
op_ne
id|GBUFFER_UNUSED
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mp-&gt;height
OL
l_int|32
op_logical_or
id|mp-&gt;width
OL
l_int|32
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mp-&gt;format
op_ge
id|PALETTEFMT_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;height
op_star
id|mp-&gt;width
op_star
id|fmtbppx2
(braket
id|palette2fmt
(braket
id|mp-&gt;format
)braket
op_amp
l_int|0x0f
)braket
op_div
l_int|2
OG
id|gbufsize
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_minus
l_int|1
op_eq
id|palette2fmt
(braket
id|mp-&gt;format
)braket
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Ok load up the BT848&n;&t; */
id|vbuf
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|btv-&gt;fbuffer
op_plus
id|gbufsize
op_star
id|mp-&gt;frame
)paren
suffix:semicolon
id|ro
op_assign
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|risc
suffix:semicolon
id|re
op_assign
id|ro
op_plus
l_int|2048
suffix:semicolon
id|make_vrisctab
c_func
(paren
id|btv
comma
id|ro
comma
id|re
comma
id|vbuf
comma
id|mp-&gt;width
comma
id|mp-&gt;height
comma
id|mp-&gt;format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap vgrab: queue %d (%d:%dx%d)&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|mp-&gt;frame
comma
id|mp-&gt;format
comma
id|mp-&gt;width
comma
id|mp-&gt;height
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|stat
op_assign
id|GBUFFER_GRABBING
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|fmt
op_assign
id|palette2fmt
(braket
id|mp-&gt;format
)braket
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|width
op_assign
id|mp-&gt;width
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|height
op_assign
id|mp-&gt;height
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|ro
op_assign
id|virt_to_bus
c_func
(paren
id|ro
)paren
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|re
op_assign
id|virt_to_bus
c_func
(paren
id|re
)paren
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|mp-&gt;height
op_le
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
dot
id|sheight
op_div
l_int|2
op_logical_and
id|mp-&gt;format
op_ne
id|VIDEO_PALETTE_RAW
)paren
id|btv-&gt;gbuf
(braket
id|mp-&gt;frame
)braket
dot
id|ro
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_minus
l_int|1
op_eq
id|btv-&gt;gq_grab
op_logical_and
id|btv-&gt;gq_in
op_eq
id|btv-&gt;gq_out
)paren
(brace
id|btv-&gt;gq_start
op_assign
l_int|1
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|12
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
(paren
l_int|0x8
op_lshift
l_int|16
)paren
op_or
id|BT848_RISC_IRQ
)paren
suffix:semicolon
)brace
id|btv-&gt;gqueue
(braket
id|btv-&gt;gq_in
op_increment
)braket
op_assign
id|mp-&gt;frame
suffix:semicolon
id|btv-&gt;gq_in
op_assign
id|btv-&gt;gq_in
op_mod
id|MAX_GBUFFERS
suffix:semicolon
id|btor
c_func
(paren
l_int|3
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
id|btor
c_func
(paren
l_int|3
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bttv_write
r_static
r_int
id|bttv_write
c_func
(paren
r_struct
id|video_device
op_star
id|v
comma
r_const
r_char
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|bttv_read
r_static
r_int
id|bttv_read
c_func
(paren
r_struct
id|video_device
op_star
id|v
comma
r_char
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|v
suffix:semicolon
r_int
id|q
comma
id|todo
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
multiline_comment|/* BROKEN: RETURNS VBI WHEN IT SHOULD RETURN GRABBED VIDEO FRAME */
id|todo
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|todo
op_logical_and
id|todo
OG
(paren
id|q
op_assign
id|VBIBUF_SIZE
op_minus
id|btv-&gt;vbip
)paren
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|buf
comma
(paren
r_void
op_star
)paren
id|btv-&gt;vbibuf
op_plus
id|btv-&gt;vbip
comma
id|q
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|todo
op_sub_assign
id|q
suffix:semicolon
id|buf
op_add_assign
id|q
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_if
c_cond
(paren
id|todo
op_logical_and
id|q
op_eq
id|VBIBUF_SIZE
op_minus
id|btv-&gt;vbip
)paren
(brace
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
id|todo
)paren
(brace
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
)brace
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|todo
op_eq
id|count
)paren
(brace
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
r_else
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|todo
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|buf
comma
(paren
r_void
op_star
)paren
id|btv-&gt;vbibuf
op_plus
id|btv-&gt;vbip
comma
id|todo
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|btv-&gt;vbip
op_add_assign
id|todo
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|burst
r_static
r_inline
r_void
id|burst
c_func
(paren
r_int
id|on
)paren
(brace
id|tvnorms
(braket
l_int|0
)braket
dot
id|scaledtwidth
op_assign
l_int|1135
op_minus
(paren
id|on
ques
c_cond
id|BURSTOFFSET
op_minus
l_int|2
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tvnorms
(braket
l_int|0
)braket
dot
id|hdelayx1
op_assign
l_int|186
op_minus
(paren
id|on
ques
c_cond
id|BURSTOFFSET
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tvnorms
(braket
l_int|2
)braket
dot
id|scaledtwidth
op_assign
l_int|1135
op_minus
(paren
id|on
ques
c_cond
id|BURSTOFFSET
op_minus
l_int|2
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tvnorms
(braket
l_int|2
)braket
dot
id|hdelayx1
op_assign
l_int|186
op_minus
(paren
id|on
ques
c_cond
id|BURSTOFFSET
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * called from irq handler on fatal errors.  Takes the grabber chip&n; * offline, flag it needs a reinitialization (which can&squot;t be done&n; * from irq context) and wake up all sleeping proccesses.  They would&n; * block forever else.  We also need someone who actually does the&n; * reinitialization from process context...&n; */
DECL|function|bt848_offline
r_static
r_void
id|bt848_offline
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
multiline_comment|/* cancel all outstanding grab requests */
id|btv-&gt;gq_in
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;gq_out
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;gq_grab
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gbuffers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_eq
id|GBUFFER_GRABBING
)paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_assign
id|GBUFFER_ERROR
suffix:semicolon
multiline_comment|/* disable screen overlay and DMA */
id|btv-&gt;risc_cap_odd
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* flag the chip needs a restart */
id|btv-&gt;needs_restart
op_assign
l_int|1
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|btv-&gt;vbiq
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|btv-&gt;capq
)paren
suffix:semicolon
)brace
DECL|function|bt848_restart
r_static
r_void
id|bt848_restart
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
r_int
id|irq_flags
suffix:semicolon
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: resetting chip&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0xfffffUL
comma
id|BT848_INT_STAT
)paren
suffix:semicolon
id|btand
c_func
(paren
op_complement
l_int|15
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_SRESET
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|2
)paren
comma
id|BT848_RISC_STRT_ADD
)paren
suffix:semicolon
multiline_comment|/* enforce pll reprogramming */
id|btv-&gt;pll.pll_current
op_assign
l_int|0
suffix:semicolon
id|set_pll
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|btv-&gt;errors
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;needs_restart
op_assign
l_int|0
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Open a bttv card. Right now the flags stuff is just playing&n; */
DECL|function|bttv_open
r_static
r_int
id|bttv_open
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: open called&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;user
)paren
r_goto
id|out_unlock
suffix:semicolon
id|btv-&gt;fbuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|rvmalloc
c_func
(paren
id|gbuffers
op_star
id|gbufsize
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;fbuffer
)paren
r_goto
id|out_unlock
suffix:semicolon
id|btv-&gt;gq_in
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;gq_out
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;gq_grab
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gbuffers
suffix:semicolon
id|i
op_increment
)paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_assign
id|GBUFFER_UNUSED
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;needs_restart
)paren
id|bt848_restart
c_func
(paren
id|btv
)paren
suffix:semicolon
id|burst
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|set_pll
c_func
(paren
id|btv
)paren
suffix:semicolon
id|btv-&gt;user
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|bttv_close
r_static
r_void
id|bttv_close
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev
suffix:semicolon
r_int
r_int
id|irq_flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|btv-&gt;user
op_decrement
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|btv-&gt;scr_on
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_odd
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;A word of warning. At this point the chip&n;&t; *&t;is still capturing because its FIFO hasn&squot;t emptied&n;&t; *&t;and the DMA control operations are posted PCI &n;&t; *&t;operations.&n;&t; */
id|btread
c_func
(paren
id|BT848_I2C
)paren
suffix:semicolon
multiline_comment|/* This fixes the PCI posting delay */
r_if
c_cond
(paren
op_minus
l_int|1
op_ne
id|btv-&gt;gq_grab
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;This is sucky but right now I can&squot;t find a good way to&n;&t;&t; *&t;be sure its safe to free the buffer. We wait 5-6 fields&n;&t;&t; *&t;which is more than sufficient to be sure.&n;&t;&t; */
id|current-&gt;state
op_assign
id|TASK_UNINTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Wait 1/10th of a second */
)brace
multiline_comment|/*&n;&t; *&t;We have allowed it to drain.&n;&t; */
r_if
c_cond
(paren
id|btv-&gt;fbuffer
)paren
(brace
id|rvfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;fbuffer
comma
id|gbuffers
op_star
id|gbufsize
)paren
suffix:semicolon
)brace
id|btv-&gt;fbuffer
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
multiline_comment|/***********************************/
multiline_comment|/* ioctls and supporting functions */
multiline_comment|/***********************************/
DECL|function|bt848_bright
r_extern
r_inline
r_void
id|bt848_bright
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
id|uint
id|bright
)paren
(brace
id|btwrite
c_func
(paren
id|bright
op_amp
l_int|0xff
comma
id|BT848_BRIGHT
)paren
suffix:semicolon
)brace
DECL|function|bt848_hue
r_extern
r_inline
r_void
id|bt848_hue
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
id|uint
id|hue
)paren
(brace
id|btwrite
c_func
(paren
id|hue
op_amp
l_int|0xff
comma
id|BT848_HUE
)paren
suffix:semicolon
)brace
DECL|function|bt848_contrast
r_extern
r_inline
r_void
id|bt848_contrast
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
id|uint
id|cont
)paren
(brace
r_int
r_int
id|conthi
suffix:semicolon
id|conthi
op_assign
(paren
id|cont
op_rshift
l_int|6
)paren
op_amp
l_int|4
suffix:semicolon
id|btwrite
c_func
(paren
id|cont
op_amp
l_int|0xff
comma
id|BT848_CONTRAST_LO
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|conthi
comma
op_complement
l_int|4
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|conthi
comma
op_complement
l_int|4
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
)brace
DECL|function|bt848_sat_u
r_extern
r_inline
r_void
id|bt848_sat_u
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
id|data
)paren
(brace
id|u32
id|datahi
suffix:semicolon
id|datahi
op_assign
(paren
id|data
op_rshift
l_int|7
)paren
op_amp
l_int|2
suffix:semicolon
id|btwrite
c_func
(paren
id|data
op_amp
l_int|0xff
comma
id|BT848_SAT_U_LO
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|datahi
comma
op_complement
l_int|2
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|datahi
comma
op_complement
l_int|2
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
)brace
DECL|function|bt848_sat_v
r_static
r_inline
r_void
id|bt848_sat_v
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
r_int
id|data
)paren
(brace
id|u32
id|datahi
suffix:semicolon
id|datahi
op_assign
(paren
id|data
op_rshift
l_int|8
)paren
op_amp
l_int|1
suffix:semicolon
id|btwrite
c_func
(paren
id|data
op_amp
l_int|0xff
comma
id|BT848_SAT_V_LO
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|datahi
comma
op_complement
l_int|1
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|datahi
comma
op_complement
l_int|1
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ioctl routine&n; */
DECL|function|bttv_ioctl
r_static
r_int
id|bttv_ioctl
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev
suffix:semicolon
r_int
r_int
id|irq_flags
suffix:semicolon
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: ioctl 0x%x&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
id|b
suffix:semicolon
id|strcpy
c_func
(paren
id|b.name
comma
id|btv-&gt;video_dev.name
)paren
suffix:semicolon
id|b.type
op_assign
id|VID_TYPE_CAPTURE
op_or
(paren
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|tuner
op_ne
op_minus
l_int|1
)paren
ques
c_cond
id|VID_TYPE_TUNER
suffix:colon
l_int|0
)paren
op_or
id|VID_TYPE_OVERLAY
op_or
id|VID_TYPE_CLIPPING
op_or
id|VID_TYPE_FRAMERAM
op_or
id|VID_TYPE_SCALES
suffix:semicolon
id|b.channels
op_assign
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|video_inputs
suffix:semicolon
id|b.audios
op_assign
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_inputs
suffix:semicolon
id|b.maxwidth
op_assign
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
dot
id|swidth
suffix:semicolon
id|b.maxheight
op_assign
id|tvnorms
(braket
id|btv-&gt;win.norm
)braket
dot
id|sheight
suffix:semicolon
id|b.minwidth
op_assign
l_int|32
suffix:semicolon
id|b.minheight
op_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|b
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGCHAN
suffix:colon
(brace
r_struct
id|video_channel
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|v.flags
op_assign
id|VIDEO_VC_AUDIO
suffix:semicolon
id|v.tuners
op_assign
l_int|0
suffix:semicolon
id|v.type
op_assign
id|VIDEO_TYPE_CAMERA
suffix:semicolon
id|v.norm
op_assign
id|btv-&gt;win.norm
suffix:semicolon
r_if
c_cond
(paren
id|v.channel
op_ge
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|video_inputs
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|v.channel
op_eq
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|tuner
)paren
(brace
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;Television&quot;
)paren
suffix:semicolon
id|v.flags
op_or_assign
id|VIDEO_VC_TUNER
suffix:semicolon
id|v.type
op_assign
id|VIDEO_TYPE_TV
suffix:semicolon
id|v.tuners
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|v.channel
op_eq
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|svhs
)paren
(brace
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;S-Video&quot;
)paren
suffix:semicolon
)brace
r_else
id|sprintf
c_func
(paren
id|v.name
comma
l_string|&quot;Composite%d&quot;
comma
id|v.channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Each channel has 1 tuner&n;&t; */
r_case
id|VIDIOCSCHAN
suffix:colon
(brace
r_struct
id|video_channel
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.channel
OG
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|video_inputs
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|v.norm
OG
(paren
r_sizeof
(paren
id|tvnorms
)paren
op_div
r_sizeof
(paren
op_star
id|tvnorms
)paren
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|bt848_muxsel
c_func
(paren
id|btv
comma
id|v.channel
)paren
suffix:semicolon
id|btv-&gt;channel
op_assign
id|v.channel
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;win.norm
op_ne
id|v.norm
)paren
(brace
id|btv-&gt;win.norm
op_assign
id|v.norm
suffix:semicolon
id|make_vbitab
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_winsize
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.tuner
op_logical_or
id|btv-&gt;channel
)paren
(brace
multiline_comment|/* Only tuner 0 */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;Television&quot;
)paren
suffix:semicolon
id|v.rangelow
op_assign
l_int|0
suffix:semicolon
id|v.rangehigh
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|v.flags
op_assign
id|VIDEO_TUNER_PAL
op_or
id|VIDEO_TUNER_NTSC
op_or
id|VIDEO_TUNER_SECAM
suffix:semicolon
id|v.mode
op_assign
id|btv-&gt;win.norm
suffix:semicolon
id|v.signal
op_assign
(paren
id|btread
c_func
(paren
id|BT848_DSTATUS
)paren
op_amp
id|BT848_DSTATUS_HLOC
)paren
ques
c_cond
l_int|0xFFFF
suffix:colon
l_int|0
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* We have but one tuner */
r_case
id|VIDIOCSTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Only one channel has a tuner */
r_if
c_cond
(paren
id|v.tuner
op_ne
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|tuner
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.mode
op_ne
id|VIDEO_MODE_PAL
op_logical_and
id|v.mode
op_ne
id|VIDEO_MODE_NTSC
op_logical_and
id|v.mode
op_ne
id|VIDEO_MODE_SECAM
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;win.norm
op_ne
id|v.mode
)paren
(brace
id|btv-&gt;win.norm
op_assign
id|v.mode
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|set_pll
c_func
(paren
id|btv
)paren
suffix:semicolon
id|make_vbitab
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_winsize
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGPICT
suffix:colon
(brace
r_struct
id|video_picture
id|p
op_assign
id|btv-&gt;picture
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|p
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSPICT
suffix:colon
(brace
r_struct
id|video_picture
id|p
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
id|arg
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.palette
OG
id|PALETTEFMT_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* We want -128 to 127 we get 0-65535 */
id|bt848_bright
c_func
(paren
id|btv
comma
(paren
id|p.brightness
op_rshift
l_int|8
)paren
op_minus
l_int|128
)paren
suffix:semicolon
multiline_comment|/* 0-511 for the colour */
id|bt848_sat_u
c_func
(paren
id|btv
comma
id|p.colour
op_rshift
l_int|7
)paren
suffix:semicolon
id|bt848_sat_v
c_func
(paren
id|btv
comma
(paren
(paren
id|p.colour
op_rshift
l_int|7
)paren
op_star
l_int|201L
)paren
op_div
l_int|237
)paren
suffix:semicolon
multiline_comment|/* -128 to 127 */
id|bt848_hue
c_func
(paren
id|btv
comma
(paren
id|p.hue
op_rshift
l_int|8
)paren
op_minus
l_int|128
)paren
suffix:semicolon
multiline_comment|/* 0-511 */
id|bt848_contrast
c_func
(paren
id|btv
comma
id|p.contrast
op_rshift
l_int|7
)paren
suffix:semicolon
id|btv-&gt;picture
op_assign
id|p
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSWIN
suffix:colon
(brace
r_struct
id|video_window
id|vw
suffix:semicolon
r_struct
id|video_clip
op_star
id|vcp
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vw
comma
id|arg
comma
r_sizeof
(paren
id|vw
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vw.flags
op_logical_or
id|vw.width
OL
l_int|16
op_logical_or
id|vw.height
OL
l_int|16
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|btv-&gt;scr_on
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;win.bpp
OL
l_int|4
)paren
(brace
multiline_comment|/* adjust and align writes */
id|vw.x
op_assign
(paren
id|vw.x
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|vw.width
op_and_assign
op_complement
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;needs_restart
)paren
id|bt848_restart
c_func
(paren
id|btv
)paren
suffix:semicolon
id|btv-&gt;win.x
op_assign
id|vw.x
suffix:semicolon
id|btv-&gt;win.y
op_assign
id|vw.y
suffix:semicolon
id|btv-&gt;win.width
op_assign
id|vw.width
suffix:semicolon
id|btv-&gt;win.height
op_assign
id|vw.height
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|bt848_set_winsize
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Do any clips.&n;&t;&t; */
r_if
c_cond
(paren
id|vw.clipcount
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|vcp
op_assign
id|vmalloc
c_func
(paren
id|VIDEO_CLIPMAP_SIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|vcp
comma
id|vw.clips
comma
id|VIDEO_CLIPMAP_SIZE
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|vcp
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|vw.clipcount
)paren
(brace
r_if
c_cond
(paren
(paren
id|vcp
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|video_clip
)paren
op_star
(paren
id|vw.clipcount
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|vcp
comma
id|vw.clips
comma
r_sizeof
(paren
r_struct
id|video_clip
)paren
op_star
id|vw.clipcount
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|vcp
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
id|make_clip_tab
c_func
(paren
id|btv
comma
id|vcp
comma
id|vw.clipcount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vw.clipcount
op_ne
l_int|0
)paren
id|vfree
c_func
(paren
id|vcp
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGWIN
suffix:colon
(brace
r_struct
id|video_window
id|vw
suffix:semicolon
multiline_comment|/* Oh for a COBOL move corresponding .. */
id|vw.x
op_assign
id|btv-&gt;win.x
suffix:semicolon
id|vw.y
op_assign
id|btv-&gt;win.y
suffix:semicolon
id|vw.width
op_assign
id|btv-&gt;win.width
suffix:semicolon
id|vw.height
op_assign
id|btv-&gt;win.height
suffix:semicolon
id|vw.chromakey
op_assign
l_int|0
suffix:semicolon
id|vw.flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;win.interlace
)paren
(brace
id|vw.flags
op_or_assign
id|VIDEO_WINDOW_INTERLACE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|vw
comma
r_sizeof
(paren
id|vw
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCCAPTURE
suffix:colon
(brace
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;win.vidadr
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;win.width
op_eq
l_int|0
op_logical_or
id|btv-&gt;win.height
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|1
op_logical_and
id|btv-&gt;win.vidadr
op_ne
l_int|0
)paren
id|btv-&gt;scr_on
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|0
)paren
id|btv-&gt;scr_on
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGFBUF
suffix:colon
(brace
r_struct
id|video_buffer
id|v
suffix:semicolon
id|v.base
op_assign
(paren
r_void
op_star
)paren
id|btv-&gt;win.vidadr
suffix:semicolon
id|v.height
op_assign
id|btv-&gt;win.sheight
suffix:semicolon
id|v.width
op_assign
id|btv-&gt;win.swidth
suffix:semicolon
id|v.depth
op_assign
id|btv-&gt;win.depth
suffix:semicolon
id|v.bytesperline
op_assign
id|btv-&gt;win.bpl
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSFBUF
suffix:colon
(brace
r_struct
id|video_buffer
id|v
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.depth
op_ne
l_int|8
op_logical_and
id|v.depth
op_ne
l_int|15
op_logical_and
id|v.depth
op_ne
l_int|16
op_logical_and
id|v.depth
op_ne
l_int|24
op_logical_and
id|v.depth
op_ne
l_int|32
op_logical_and
id|v.width
OG
l_int|16
op_logical_and
id|v.height
OG
l_int|16
op_logical_and
id|v.bytesperline
OG
l_int|16
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v.base
)paren
id|btv-&gt;win.vidadr
op_assign
(paren
r_int
r_int
)paren
id|v.base
suffix:semicolon
id|btv-&gt;win.sheight
op_assign
id|v.height
suffix:semicolon
id|btv-&gt;win.swidth
op_assign
id|v.width
suffix:semicolon
id|btv-&gt;win.bpp
op_assign
(paren
(paren
id|v.depth
op_plus
l_int|7
)paren
op_amp
l_int|0x38
)paren
op_div
l_int|8
suffix:semicolon
id|btv-&gt;win.depth
op_assign
id|v.depth
suffix:semicolon
id|btv-&gt;win.bpl
op_assign
id|v.bytesperline
suffix:semicolon
multiline_comment|/* set sefault color format */
r_switch
c_cond
(paren
id|btv-&gt;win.bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|btv-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_HI240
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|btv-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_RGB555
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|btv-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_RGB565
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|btv-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_RGB24
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|btv-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_RGB32
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;Display at %p is %d by %d, bytedepth %d, bpl %d&bslash;n&quot;
comma
id|v.base
comma
id|v.width
comma
id|v.height
comma
id|btv-&gt;win.bpp
comma
id|btv-&gt;win.bpl
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_winsize
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCKEY
suffix:colon
(brace
multiline_comment|/* Will be handled higher up .. */
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGFREQ
suffix:colon
(brace
r_int
r_int
id|v
op_assign
id|btv-&gt;win.freq
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSFREQ
suffix:colon
(brace
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|btv-&gt;win.freq
op_assign
id|v
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|btv-&gt;type
op_eq
id|BTTV_MIROPRO
op_logical_and
id|btv-&gt;radio
)paren
id|tea5757_set_freq
c_func
(paren
id|btv
comma
id|v
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGAUDIO
suffix:colon
(brace
r_struct
id|video_audio
id|v
suffix:semicolon
id|v
op_assign
id|btv-&gt;audio_dev
suffix:semicolon
id|v.flags
op_and_assign
op_complement
(paren
id|VIDEO_AUDIO_MUTE
op_or
id|VIDEO_AUDIO_MUTABLE
)paren
suffix:semicolon
id|v.flags
op_or_assign
id|VIDEO_AUDIO_MUTABLE
suffix:semicolon
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;TV&quot;
)paren
suffix:semicolon
id|v.mode
op_assign
id|VIDEO_SOUND_MONO
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
multiline_comment|/* card specific hooks */
r_if
c_cond
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_hook
)paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_hook
c_func
(paren
id|btv
comma
op_amp
id|v
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSAUDIO
suffix:colon
(brace
r_struct
id|video_audio
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v.flags
op_amp
id|VIDEO_AUDIO_MUTE
)paren
(brace
id|audio
c_func
(paren
id|btv
comma
id|AUDIO_MUTE
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* One audio source per tuner -- huh? &lt;GA&gt; */
r_if
c_cond
(paren
id|v.audio
OL
l_int|0
op_logical_or
id|v.audio
op_ge
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_inputs
)paren
(brace
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* bt848_muxsel(btv,v.audio); */
r_if
c_cond
(paren
op_logical_neg
(paren
id|v.flags
op_amp
id|VIDEO_AUDIO_MUTE
)paren
)paren
(brace
id|audio
c_func
(paren
id|btv
comma
id|AUDIO_UNMUTE
comma
l_int|1
)paren
suffix:semicolon
)brace
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
multiline_comment|/* card specific hooks */
r_if
c_cond
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_hook
)paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|audio_hook
c_func
(paren
id|btv
comma
op_amp
id|v
comma
l_int|0
)paren
suffix:semicolon
id|btv-&gt;audio_dev
op_assign
id|v
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSYNC
suffix:colon
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|i
comma
id|arg
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|gbuffers
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
)paren
(brace
r_case
id|GBUFFER_UNUSED
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GBUFFER_GRABBING
suffix:colon
id|add_wait_queue
c_func
(paren
op_amp
id|btv-&gt;capq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_while
c_loop
(paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_eq
id|GBUFFER_GRABBING
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap sync: sleep on %d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|i
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;capq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;capq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
multiline_comment|/* fall throuth */
r_case
id|GBUFFER_DONE
suffix:colon
r_case
id|GBUFFER_ERROR
suffix:colon
id|ret
op_assign
(paren
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_eq
id|GBUFFER_ERROR
)paren
ques
c_cond
op_minus
id|EIO
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap sync: buffer %d, retval %d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|i
comma
id|ret
)paren
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|i
)braket
dot
id|stat
op_assign
id|GBUFFER_UNUSED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;needs_restart
)paren
(brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|bt848_restart
c_func
(paren
id|btv
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_case
id|BTTV_FIELDNR
suffix:colon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|btv-&gt;last_field
comma
r_sizeof
(paren
id|btv-&gt;last_field
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|BTTV_PLLSET
suffix:colon
(brace
r_struct
id|bttv_pll_info
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|btv-&gt;pll
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|btv-&gt;pll.pll_ifreq
op_assign
id|p.pll_ifreq
suffix:semicolon
id|btv-&gt;pll.pll_ofreq
op_assign
id|p.pll_ofreq
suffix:semicolon
id|btv-&gt;pll.pll_crystal
op_assign
id|p.pll_crystal
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCMCAPTURE
suffix:colon
(brace
r_struct
id|video_mmap
id|vm
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|vm
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vm
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|ret
op_assign
id|vgrab
c_func
(paren
id|btv
comma
op_amp
id|vm
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_case
id|VIDIOCGMBUF
suffix:colon
(brace
r_struct
id|video_mbuf
id|vm
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vm
comma
l_int|0
comma
r_sizeof
(paren
id|vm
)paren
)paren
suffix:semicolon
id|vm.size
op_assign
id|gbufsize
op_star
id|gbuffers
suffix:semicolon
id|vm.frames
op_assign
id|gbuffers
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gbuffers
suffix:semicolon
id|i
op_increment
)paren
id|vm.offsets
(braket
id|i
)braket
op_assign
id|i
op_star
id|gbufsize
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|vm
comma
r_sizeof
(paren
id|vm
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGUNIT
suffix:colon
(brace
r_struct
id|video_unit
id|vu
suffix:semicolon
id|vu.video
op_assign
id|btv-&gt;video_dev.minor
suffix:semicolon
id|vu.vbi
op_assign
id|btv-&gt;vbi_dev.minor
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;radio_dev.minor
op_ne
op_minus
l_int|1
)paren
(brace
id|vu.radio
op_assign
id|btv-&gt;radio_dev.minor
suffix:semicolon
)brace
r_else
id|vu.radio
op_assign
id|VIDEO_NO_UNIT
suffix:semicolon
id|vu.audio
op_assign
id|VIDEO_NO_UNIT
suffix:semicolon
id|vu.teletext
op_assign
id|VIDEO_NO_UNIT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|vu
comma
r_sizeof
(paren
id|vu
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|BTTV_BURST_ON
suffix:colon
(brace
id|burst
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|BTTV_BURST_OFF
suffix:colon
(brace
id|burst
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|BTTV_VERSION
suffix:colon
(brace
r_return
id|BTTV_VERSION_CODE
suffix:semicolon
)brace
r_case
id|BTTV_PICNR
suffix:colon
(brace
multiline_comment|/* return picture;*/
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This maps the vmalloced and reserved fbuffer to user space.&n; *&n; *  FIXME: &n; *  - PAGE_READONLY should suffice!?&n; *  - remap_page_range is kind of inefficient for page by page remapping.&n; *    But e.g. pte_alloc() does not work in modules ... :-(&n; */
DECL|function|do_bttv_mmap
r_static
r_int
id|do_bttv_mmap
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_const
r_char
op_star
id|adr
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
r_int
r_int
)paren
id|adr
suffix:semicolon
r_int
r_int
id|page
comma
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|gbuffers
op_star
id|gbufsize
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;fbuffer
)paren
(brace
r_if
c_cond
(paren
id|fbuffer_alloc
c_func
(paren
id|btv
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|pos
op_assign
(paren
r_int
r_int
)paren
id|btv-&gt;fbuffer
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|start
comma
id|page
comma
id|PAGE_SIZE
comma
id|PAGE_SHARED
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pos
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bttv_mmap
r_static
r_int
id|bttv_mmap
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_const
r_char
op_star
id|adr
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev
suffix:semicolon
r_int
id|r
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|r
op_assign
id|do_bttv_mmap
c_func
(paren
id|btv
comma
id|adr
comma
id|size
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
DECL|variable|bttv_template
r_static
r_struct
id|video_device
id|bttv_template
op_assign
(brace
id|name
suffix:colon
l_string|&quot;UNSET&quot;
comma
id|type
suffix:colon
id|VID_TYPE_TUNER
op_or
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_OVERLAY
op_or
id|VID_TYPE_TELETEXT
comma
id|hardware
suffix:colon
id|VID_HARDWARE_BT848
comma
id|open
suffix:colon
id|bttv_open
comma
id|close
suffix:colon
id|bttv_close
comma
id|read
suffix:colon
id|bttv_read
comma
id|write
suffix:colon
id|bttv_write
comma
id|ioctl
suffix:colon
id|bttv_ioctl
comma
id|mmap
suffix:colon
id|bttv_mmap
comma
id|minor
suffix:colon
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|vbi_read
r_static
r_int
id|vbi_read
c_func
(paren
r_struct
id|video_device
op_star
id|v
comma
r_char
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|v
op_minus
l_int|2
)paren
suffix:semicolon
r_int
id|q
comma
id|todo
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|todo
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|todo
op_logical_and
id|todo
OG
(paren
id|q
op_assign
id|VBIBUF_SIZE
op_minus
id|btv-&gt;vbip
)paren
)paren
(brace
r_if
c_cond
(paren
id|btv-&gt;needs_restart
)paren
(brace
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|bt848_restart
c_func
(paren
id|btv
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|buf
comma
(paren
r_void
op_star
)paren
id|btv-&gt;vbibuf
op_plus
id|btv-&gt;vbip
comma
id|q
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|todo
op_sub_assign
id|q
suffix:semicolon
id|buf
op_add_assign
id|q
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_if
c_cond
(paren
id|todo
op_logical_and
id|q
op_eq
id|VBIBUF_SIZE
op_minus
id|btv-&gt;vbip
)paren
(brace
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
id|todo
)paren
(brace
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
)brace
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|todo
op_eq
id|count
)paren
(brace
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
r_else
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|btv-&gt;vbiq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|todo
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|buf
comma
(paren
r_void
op_star
)paren
id|btv-&gt;vbibuf
op_plus
id|btv-&gt;vbip
comma
id|todo
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|btv-&gt;vbip
op_add_assign
id|todo
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|vbi_poll
r_static
r_int
r_int
id|vbi_poll
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|2
)paren
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|btv-&gt;vbiq
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;vbip
OL
id|VBIBUF_SIZE
)paren
id|mask
op_or_assign
(paren
id|POLLIN
op_or
id|POLLRDNORM
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|vbi_open
r_static
r_int
id|vbi_open
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|2
)paren
suffix:semicolon
r_int
r_int
id|irq_flags
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;needs_restart
)paren
id|bt848_restart
c_func
(paren
id|btv
)paren
suffix:semicolon
id|set_pll
c_func
(paren
id|btv
)paren
suffix:semicolon
id|btv-&gt;vbip
op_assign
id|VBIBUF_SIZE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|btv-&gt;vbi_on
op_assign
l_int|1
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vbi_close
r_static
r_void
id|vbi_close
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|2
)paren
suffix:semicolon
r_int
r_int
id|irq_flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|btv-&gt;vbi_on
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|vbi_ioctl
r_static
r_int
id|vbi_ioctl
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
id|b
suffix:semicolon
id|strcpy
c_func
(paren
id|b.name
comma
id|btv-&gt;vbi_dev.name
)paren
suffix:semicolon
id|b.type
op_assign
(paren
(paren
id|bttv_tvcards
(braket
id|btv-&gt;type
)braket
dot
id|tuner
op_ne
op_minus
l_int|1
)paren
ques
c_cond
id|VID_TYPE_TUNER
suffix:colon
l_int|0
)paren
op_or
id|VID_TYPE_TELETEXT
suffix:semicolon
id|b.channels
op_assign
l_int|0
suffix:semicolon
id|b.audios
op_assign
l_int|0
suffix:semicolon
id|b.maxwidth
op_assign
l_int|0
suffix:semicolon
id|b.maxheight
op_assign
l_int|0
suffix:semicolon
id|b.minwidth
op_assign
l_int|0
suffix:semicolon
id|b.minheight
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|b
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGFREQ
suffix:colon
r_case
id|VIDIOCSFREQ
suffix:colon
r_case
id|BTTV_VERSION
suffix:colon
r_return
id|bttv_ioctl
c_func
(paren
id|dev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|BTTV_VBISIZE
suffix:colon
multiline_comment|/* make alevt happy :-) */
r_return
id|VBIBUF_SIZE
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|variable|vbi_template
r_static
r_struct
id|video_device
id|vbi_template
op_assign
(brace
id|name
suffix:colon
l_string|&quot;bttv vbi&quot;
comma
id|type
suffix:colon
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_TELETEXT
comma
id|hardware
suffix:colon
id|VID_HARDWARE_BT848
comma
id|open
suffix:colon
id|vbi_open
comma
id|close
suffix:colon
id|vbi_close
comma
id|read
suffix:colon
id|vbi_read
comma
id|write
suffix:colon
id|bttv_write
comma
id|poll
suffix:colon
id|vbi_poll
comma
id|ioctl
suffix:colon
id|vbi_ioctl
comma
id|minor
suffix:colon
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|radio_open
r_static
r_int
id|radio_open
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|v
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;user
)paren
r_goto
id|busy_unlock
suffix:semicolon
id|btv-&gt;user
op_increment
suffix:semicolon
id|btv-&gt;radio
op_assign
l_int|1
suffix:semicolon
id|v
op_assign
l_int|400
op_star
l_int|16
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|VIDIOCSFREQ
comma
op_amp
id|v
)paren
suffix:semicolon
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|AUDC_SET_RADIO
comma
op_amp
id|btv-&gt;tuner_type
)paren
suffix:semicolon
id|bt848_muxsel
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|busy_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|radio_close
r_static
r_void
id|radio_close
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|1
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|btv-&gt;user
op_decrement
suffix:semicolon
id|btv-&gt;radio
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|radio_read
r_static
r_int
id|radio_read
c_func
(paren
r_struct
id|video_device
op_star
id|v
comma
r_char
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|radio_ioctl
r_static
r_int
id|radio_ioctl
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|bttv
op_star
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
(paren
id|dev
op_minus
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
id|v
suffix:semicolon
id|strcpy
c_func
(paren
id|v.name
comma
id|btv-&gt;video_dev.name
)paren
suffix:semicolon
id|v.type
op_assign
id|VID_TYPE_TUNER
suffix:semicolon
id|v.channels
op_assign
l_int|1
suffix:semicolon
id|v.audios
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* No we don&squot;t do pictures */
id|v.maxwidth
op_assign
l_int|0
suffix:semicolon
id|v.maxheight
op_assign
l_int|0
suffix:semicolon
id|v.minwidth
op_assign
l_int|0
suffix:semicolon
id|v.minheight
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCGTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.tuner
op_logical_or
id|btv-&gt;channel
)paren
(brace
multiline_comment|/* Only tuner 0 */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;Radio&quot;
)paren
suffix:semicolon
id|v.rangelow
op_assign
(paren
r_int
)paren
(paren
l_int|76
op_star
l_int|16
)paren
suffix:semicolon
multiline_comment|/* jp: 76.0MHz - 89.9MHz  */
id|v.rangehigh
op_assign
(paren
r_int
)paren
(paren
l_int|108
op_star
l_int|16
)paren
suffix:semicolon
multiline_comment|/* eu: 87.5MHz - 108.0MHz */
id|v.flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* XXX */
id|v.mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* XXX */
id|bttv_call_i2c_clients
c_func
(paren
id|btv
comma
id|cmd
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Only channel 0 has a tuner */
r_if
c_cond
(paren
id|v.tuner
op_ne
l_int|0
op_logical_or
id|btv-&gt;channel
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* XXX anything to do ??? */
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGFREQ
suffix:colon
r_case
id|VIDIOCSFREQ
suffix:colon
r_case
id|VIDIOCGAUDIO
suffix:colon
r_case
id|VIDIOCSAUDIO
suffix:colon
id|bttv_ioctl
c_func
(paren
(paren
r_struct
id|video_device
op_star
)paren
id|btv
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|radio_template
r_static
r_struct
id|video_device
id|radio_template
op_assign
(brace
id|name
suffix:colon
l_string|&quot;bttv radio&quot;
comma
id|type
suffix:colon
id|VID_TYPE_TUNER
comma
id|hardware
suffix:colon
id|VID_HARDWARE_BT848
comma
id|open
suffix:colon
id|radio_open
comma
id|close
suffix:colon
id|radio_close
comma
id|read
suffix:colon
id|radio_read
comma
multiline_comment|/* just returns -EINVAL */
id|write
suffix:colon
id|bttv_write
comma
multiline_comment|/* just returns -EINVAL */
id|ioctl
suffix:colon
id|radio_ioctl
comma
id|minor
suffix:colon
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|bt848_set_risc_jmps
r_static
r_void
id|bt848_set_risc_jmps
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
op_minus
l_int|1
op_eq
id|flags
)paren
(brace
multiline_comment|/* defaults */
id|flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;scr_on
)paren
id|flags
op_or_assign
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;vbi_on
)paren
id|flags
op_or_assign
l_int|0x0c
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: set_risc_jmp %08lx:&quot;
comma
id|btv-&gt;nr
comma
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
)paren
)paren
suffix:semicolon
multiline_comment|/* Sync to start of odd field */
id|btv-&gt;risc_jmp
(braket
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_RISC_RESYNC
op_or
id|BT848_FIFO_STATUS_VRE
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Jump to odd vbi sub */
id|btv-&gt;risc_jmp
(braket
l_int|2
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
(paren
l_int|0xd
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; ev=%08lx&quot;
comma
id|virt_to_bus
c_func
(paren
id|btv-&gt;vbi_odd
)paren
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|3
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;vbi_odd
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; -----------&quot;
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|3
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|4
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Jump to odd sub */
id|btv-&gt;risc_jmp
(braket
l_int|4
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
(paren
l_int|0xe
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|btv-&gt;risc_cap_odd
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; e%d=%08x&quot;
comma
id|btv-&gt;gq_grab
comma
id|btv-&gt;risc_cap_odd
)paren
suffix:semicolon
id|flags
op_or_assign
l_int|3
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|5
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;risc_cap_odd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|flags
op_amp
l_int|2
)paren
op_logical_and
(paren
op_logical_neg
id|btv-&gt;win.interlace
op_logical_or
l_int|0
op_eq
id|btv-&gt;risc_cap_even
)paren
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; eo=%08lx&quot;
comma
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_scr_odd
)paren
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|5
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_scr_odd
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; -----------&quot;
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|5
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|6
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Sync to start of even field */
id|btv-&gt;risc_jmp
(braket
l_int|6
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_RISC_RESYNC
op_or
id|BT848_FIFO_STATUS_VRO
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|7
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Jump to even vbi sub */
id|btv-&gt;risc_jmp
(braket
l_int|8
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; ov=%08lx&quot;
comma
id|virt_to_bus
c_func
(paren
id|btv-&gt;vbi_even
)paren
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|9
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;vbi_even
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; -----------&quot;
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|9
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|10
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Jump to even sub */
id|btv-&gt;risc_jmp
(braket
l_int|10
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
(paren
l_int|8
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|btv-&gt;risc_cap_even
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; o%d=%08x&quot;
comma
id|btv-&gt;gq_grab
comma
id|btv-&gt;risc_cap_even
)paren
suffix:semicolon
id|flags
op_or_assign
l_int|3
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|11
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;risc_cap_even
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|flags
op_amp
l_int|1
)paren
op_logical_and
id|btv-&gt;win.interlace
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; oo=%08lx&quot;
comma
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_scr_even
)paren
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|11
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_scr_even
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; -----------&quot;
)paren
suffix:semicolon
id|btv-&gt;risc_jmp
(braket
l_int|11
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|12
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;gq_start
)paren
(brace
id|btv-&gt;risc_jmp
(braket
l_int|12
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
op_or
(paren
l_int|0x8
op_lshift
l_int|16
)paren
op_or
id|BT848_RISC_IRQ
)paren
suffix:semicolon
)brace
r_else
(brace
id|btv-&gt;risc_jmp
(braket
l_int|12
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
)brace
id|btv-&gt;risc_jmp
(braket
l_int|13
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
)paren
)paren
suffix:semicolon
multiline_comment|/* enable cpaturing and DMA */
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; flags=0x%x dma=%s&bslash;n&quot;
comma
id|flags
comma
(paren
id|flags
op_amp
l_int|0x0f
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|flags
comma
op_complement
l_int|0x0f
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x0f
)paren
id|bt848_dma
c_func
(paren
id|btv
comma
l_int|3
)paren
suffix:semicolon
r_else
id|bt848_dma
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|init_video_dev
r_static
r_int
id|__devinit
id|init_video_dev
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
id|audio
c_func
(paren
id|btv
comma
id|AUDIO_MUTE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
op_amp
id|btv-&gt;video_dev
comma
id|VFL_TYPE_GRABBER
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
op_amp
id|btv-&gt;vbi_dev
comma
id|VFL_TYPE_VBI
)paren
OL
l_int|0
)paren
(brace
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;video_dev
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|radio
(braket
id|btv-&gt;nr
)braket
)paren
(brace
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
op_amp
id|btv-&gt;radio_dev
comma
id|VFL_TYPE_RADIO
)paren
OL
l_int|0
)paren
(brace
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;vbi_dev
)paren
suffix:semicolon
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;video_dev
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|init_bt848
r_static
r_int
id|__devinit
id|init_bt848
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
id|j
suffix:semicolon
r_int
r_int
id|irq_flags
suffix:semicolon
id|btv-&gt;user
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|btv-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* dump current state of the gpio registers before changing them,&n;&t; * might help to make a new card work */
r_if
c_cond
(paren
id|bttv_gpio
)paren
id|bttv_gpio_tracking
c_func
(paren
id|btv
comma
l_string|&quot;init #1&quot;
)paren
suffix:semicolon
multiline_comment|/* reset the bt848 */
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_SRESET
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: bt848_mem: 0x%lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
(paren
r_int
r_int
)paren
id|btv-&gt;bt848_mem
)paren
)paren
suffix:semicolon
multiline_comment|/* not registered yet */
id|btv-&gt;video_dev.minor
op_assign
op_minus
l_int|1
suffix:semicolon
id|btv-&gt;radio_dev.minor
op_assign
op_minus
l_int|1
suffix:semicolon
id|btv-&gt;vbi_dev.minor
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* default setup for max. PAL size in a 1024xXXX hicolor framebuffer */
id|btv-&gt;win.norm
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* change this to 1 for NTSC, 2 for SECAM */
id|btv-&gt;win.interlace
op_assign
l_int|1
suffix:semicolon
id|btv-&gt;win.x
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;win.y
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;win.width
op_assign
l_int|768
suffix:semicolon
multiline_comment|/* 640 */
id|btv-&gt;win.height
op_assign
l_int|576
suffix:semicolon
multiline_comment|/* 480 */
id|btv-&gt;win.bpp
op_assign
l_int|2
suffix:semicolon
id|btv-&gt;win.depth
op_assign
l_int|16
suffix:semicolon
id|btv-&gt;win.color_fmt
op_assign
id|BT848_COLOR_FMT_RGB16
suffix:semicolon
id|btv-&gt;win.bpl
op_assign
l_int|1024
op_star
id|btv-&gt;win.bpp
suffix:semicolon
id|btv-&gt;win.swidth
op_assign
l_int|1024
suffix:semicolon
id|btv-&gt;win.sheight
op_assign
l_int|768
suffix:semicolon
id|btv-&gt;win.vidadr
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;vbi_on
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;scr_on
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_scr_odd
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_scr_even
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_odd
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_jmp
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;vbibuf
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;field
op_assign
id|btv-&gt;last_field
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;errors
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;needs_restart
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|btv-&gt;risc_scr_odd
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|RISCMEM_LEN
op_div
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|btv-&gt;risc_scr_even
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|RISCMEM_LEN
op_div
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|btv-&gt;risc_jmp
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmalloc
c_func
(paren
l_int|2048
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|btv-&gt;vbi_odd
op_assign
id|btv-&gt;risc_jmp
op_plus
l_int|16
suffix:semicolon
id|btv-&gt;vbi_even
op_assign
id|btv-&gt;vbi_odd
op_plus
l_int|256
suffix:semicolon
id|btv-&gt;bus_vbi_odd
op_assign
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|12
)paren
suffix:semicolon
id|btv-&gt;bus_vbi_even
op_assign
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|6
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|2
)paren
comma
id|BT848_RISC_STRT_ADD
)paren
suffix:semicolon
id|btv-&gt;vbibuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|vmalloc_32
c_func
(paren
id|VBIBUF_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;vbibuf
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|btv-&gt;gbuf
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|bttv_gbuf
)paren
op_star
id|gbuffers
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|gbuffers
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|btv-&gt;gbuf
(braket
id|j
)braket
dot
id|risc
op_assign
id|kmalloc
c_func
(paren
l_int|16384
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|btv-&gt;vbibuf
comma
l_int|0
comma
id|VBIBUF_SIZE
)paren
suffix:semicolon
multiline_comment|/* We don&squot;t want to return random&n;&t;                                        memory to the user */
id|btv-&gt;fbuffer
op_assign
l_int|NULL
suffix:semicolon
id|bt848_muxsel
c_func
(paren
id|btv
comma
l_int|1
)paren
suffix:semicolon
id|bt848_set_winsize
c_func
(paren
id|btv
)paren
suffix:semicolon
multiline_comment|/*&t;btwrite(0, BT848_TDEC); */
id|btwrite
c_func
(paren
l_int|0x10
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
multiline_comment|/* set planar and packed mode trigger points and         */
multiline_comment|/* set rising edge of inverted GPINTR pin as irq trigger */
id|btwrite
c_func
(paren
id|BT848_GPIO_DMA_CTL_PKTP_32
op_or
id|BT848_GPIO_DMA_CTL_PLTP1_16
op_or
id|BT848_GPIO_DMA_CTL_PLTP23_16
op_or
id|BT848_GPIO_DMA_CTL_GPINTC
op_or
id|BT848_GPIO_DMA_CTL_GPINTI
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
multiline_comment|/* select direct input */
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_GPIO_REG_INP
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_GPIO_OUT_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_gpio
)paren
id|bttv_gpio_tracking
c_func
(paren
id|btv
comma
l_string|&quot;init #2&quot;
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|BT848_IFORM_MUX1
op_or
id|BT848_IFORM_XTAUTO
op_or
id|BT848_IFORM_AUTO
comma
id|BT848_IFORM
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0xd8
comma
id|BT848_CONTRAST_LO
)paren
suffix:semicolon
id|bt848_bright
c_func
(paren
id|btv
comma
l_int|0x10
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x20
comma
id|BT848_E_VSCALE_HI
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x20
comma
id|BT848_O_VSCALE_HI
)paren
suffix:semicolon
id|btwrite
c_func
(paren
multiline_comment|/*BT848_ADC_SYNC_T|*/
id|BT848_ADC_RESERVED
op_or
id|BT848_ADC_CRUSH
comma
id|BT848_ADC
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|BT848_CONTROL_LDEC
comma
id|BT848_E_CONTROL
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|BT848_CONTROL_LDEC
comma
id|BT848_O_CONTROL
)paren
suffix:semicolon
id|btv-&gt;picture.colour
op_assign
l_int|254
op_lshift
l_int|7
suffix:semicolon
id|btv-&gt;picture.brightness
op_assign
l_int|128
op_lshift
l_int|8
suffix:semicolon
id|btv-&gt;picture.hue
op_assign
l_int|128
op_lshift
l_int|8
suffix:semicolon
id|btv-&gt;picture.contrast
op_assign
l_int|0xd8
op_lshift
l_int|7
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_E_SCLOOP
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x00
comma
id|BT848_O_SCLOOP
)paren
suffix:semicolon
multiline_comment|/* clear interrupt status */
id|btwrite
c_func
(paren
l_int|0xfffffUL
comma
id|BT848_INT_STAT
)paren
suffix:semicolon
multiline_comment|/* set interrupt mask */
id|btwrite
c_func
(paren
id|btv-&gt;triton1
op_or
multiline_comment|/*BT848_INT_PABORT|BT848_INT_RIPERR|BT848_INT_PPERR|&n;                  BT848_INT_FDSR|BT848_INT_FTRGT|BT848_INT_FBUS|*/
(paren
id|fieldnr
ques
c_cond
id|BT848_INT_VSYNC
suffix:colon
l_int|0
)paren
op_or
id|BT848_INT_GPINT
op_or
id|BT848_INT_SCERR
op_or
id|BT848_INT_RISCI
op_or
id|BT848_INT_OCERR
op_or
id|BT848_INT_VPRES
op_or
id|BT848_INT_FMTCHG
op_or
id|BT848_INT_HLOCK
comma
id|BT848_INT_MASK
)paren
suffix:semicolon
id|make_vbitab
c_func
(paren
id|btv
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|btv-&gt;s_lock
comma
id|irq_flags
)paren
suffix:semicolon
multiline_comment|/* needs to be done before i2c is registered */
r_if
c_cond
(paren
id|btv-&gt;type
op_eq
id|BTTV_HAUPPAUGE
op_logical_or
id|btv-&gt;type
op_eq
id|BTTV_HAUPPAUGE878
)paren
id|bttv_hauppauge_boot_msp34xx
c_func
(paren
id|btv
)paren
suffix:semicolon
multiline_comment|/* register i2c */
id|btv-&gt;tuner_type
op_assign
op_minus
l_int|1
suffix:semicolon
id|init_bttv_i2c
c_func
(paren
id|btv
)paren
suffix:semicolon
multiline_comment|/* some card-specific stuff (needs working i2c) */
id|bttv_init_card
c_func
(paren
id|btv
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now add the template and register the device unit.&n;&t; */
id|init_video_dev
c_func
(paren
id|btv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|irq_name
r_static
r_char
op_star
id|irq_name
(braket
)braket
op_assign
(brace
l_string|&quot;FMTCHG&quot;
comma
l_string|&quot;VSYNC&quot;
comma
l_string|&quot;HSYNC&quot;
comma
l_string|&quot;OFLOW&quot;
comma
l_string|&quot;HLOCK&quot;
comma
l_string|&quot;VPRES&quot;
comma
l_string|&quot;6&quot;
comma
l_string|&quot;7&quot;
comma
l_string|&quot;I2CDONE&quot;
comma
l_string|&quot;GPINT&quot;
comma
l_string|&quot;10&quot;
comma
l_string|&quot;RISCI&quot;
comma
l_string|&quot;FBUS&quot;
comma
l_string|&quot;FTRGT&quot;
comma
l_string|&quot;FDSR&quot;
comma
l_string|&quot;PPERR&quot;
comma
l_string|&quot;RIPERR&quot;
comma
l_string|&quot;PABORT&quot;
comma
l_string|&quot;OCERR&quot;
comma
l_string|&quot;SCERR&quot;
)brace
suffix:semicolon
DECL|function|bttv_irq
r_static
r_void
id|bttv_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|stat
comma
id|astat
suffix:semicolon
id|u32
id|dstat
suffix:semicolon
r_int
id|count
suffix:semicolon
r_struct
id|bttv
op_star
id|btv
suffix:semicolon
id|btv
op_assign
(paren
r_struct
id|bttv
op_star
)paren
id|dev_id
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
multiline_comment|/* get/clear interrupt status bits */
id|stat
op_assign
id|btread
c_func
(paren
id|BT848_INT_STAT
)paren
suffix:semicolon
id|astat
op_assign
id|stat
op_amp
id|btread
c_func
(paren
id|BT848_INT_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|astat
)paren
r_return
suffix:semicolon
id|btwrite
c_func
(paren
id|stat
comma
id|BT848_INT_STAT
)paren
suffix:semicolon
multiline_comment|/* get device status bits */
id|dstat
op_assign
id|btread
c_func
(paren
id|BT848_DSTATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_debug
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: irq loop=%d risc=%x, bits:&quot;
comma
id|btv-&gt;nr
comma
id|count
comma
id|stat
op_rshift
l_int|28
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
id|irq_name
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|stat
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; %s&quot;
comma
id|irq_name
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|astat
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;*&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|BT848_INT_HLOCK
)paren
id|printk
c_func
(paren
l_string|&quot;   HLOC =&gt; %s&quot;
comma
(paren
id|dstat
op_amp
id|BT848_DSTATUS_HLOC
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|BT848_INT_VPRES
)paren
id|printk
c_func
(paren
l_string|&quot;   PRES =&gt; %s&quot;
comma
(paren
id|dstat
op_amp
id|BT848_DSTATUS_PRES
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|BT848_INT_FMTCHG
)paren
id|printk
c_func
(paren
l_string|&quot;   NUML =&gt; %s&quot;
comma
(paren
id|dstat
op_amp
id|BT848_DSTATUS_PRES
)paren
ques
c_cond
l_string|&quot;625&quot;
suffix:colon
l_string|&quot;525&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|astat
op_amp
id|BT848_INT_GPINT
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|btv-&gt;gpioq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|astat
op_amp
id|BT848_INT_VSYNC
)paren
id|btv-&gt;field
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|astat
op_amp
(paren
id|BT848_INT_SCERR
op_or
id|BT848_INT_OCERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: irq:%s%s risc_count=%08x&bslash;n&quot;
comma
id|btv-&gt;nr
comma
(paren
id|astat
op_amp
id|BT848_INT_SCERR
)paren
ques
c_cond
l_string|&quot; SCERR&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|astat
op_amp
id|BT848_INT_OCERR
)paren
ques
c_cond
l_string|&quot; OCERR&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|btread
c_func
(paren
id|BT848_RISC_COUNT
)paren
)paren
suffix:semicolon
id|btv-&gt;errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;errors
OL
id|BTTV_ERRORS
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
id|btand
c_func
(paren
op_complement
l_int|15
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|virt_to_bus
c_func
(paren
id|btv-&gt;risc_jmp
op_plus
l_int|2
)paren
comma
id|BT848_RISC_STRT_ADD
)paren
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: aiee: error loops&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|bt848_offline
c_func
(paren
id|btv
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|astat
op_amp
id|BT848_INT_RISCI
)paren
(brace
r_if
c_cond
(paren
id|bttv_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: IRQ_RISCI&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
multiline_comment|/* captured VBI frame */
r_if
c_cond
(paren
id|stat
op_amp
(paren
l_int|1
op_lshift
l_int|28
)paren
)paren
(brace
id|btv-&gt;vbip
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* inc vbi frame count for detecting drops */
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
(paren
id|btv-&gt;vbibuf
(braket
id|VBIBUF_SIZE
op_minus
l_int|4
)braket
)paren
)paren
op_increment
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|btv-&gt;vbiq
)paren
suffix:semicolon
)brace
multiline_comment|/* captured full frame */
r_if
c_cond
(paren
id|stat
op_amp
(paren
l_int|2
op_lshift
l_int|28
)paren
op_logical_and
id|btv-&gt;gq_grab
op_ne
op_minus
l_int|1
)paren
(brace
id|btv-&gt;last_field
op_assign
id|btv-&gt;field
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap irq: done %d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;gq_grab
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|tv
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|stat
op_assign
id|GBUFFER_DONE
suffix:semicolon
id|btv-&gt;gq_grab
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;gq_in
op_ne
id|btv-&gt;gq_out
)paren
(brace
id|btv-&gt;gq_grab
op_assign
id|btv-&gt;gqueue
(braket
id|btv-&gt;gq_out
op_increment
)braket
suffix:semicolon
id|btv-&gt;gq_out
op_assign
id|btv-&gt;gq_out
op_mod
id|MAX_GBUFFERS
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap irq: capture %d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;gq_grab
)paren
suffix:semicolon
id|btv-&gt;risc_cap_odd
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|ro
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|re
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|BT848_COLOR_CTL_GAMMA
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
r_else
(brace
id|btv-&gt;risc_cap_odd
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
l_int|0
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|btv-&gt;fb_color_ctl
op_or
id|BT848_COLOR_CTL_GAMMA
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|btv-&gt;capq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
(paren
l_int|8
op_lshift
l_int|28
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
id|btv-&gt;gq_start
op_assign
l_int|0
suffix:semicolon
id|btv-&gt;gq_grab
op_assign
id|btv-&gt;gqueue
(braket
id|btv-&gt;gq_out
op_increment
)braket
suffix:semicolon
id|btv-&gt;gq_out
op_assign
id|btv-&gt;gq_out
op_mod
id|MAX_GBUFFERS
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: cap irq: capture %d [start]&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|btv-&gt;gq_grab
)paren
suffix:semicolon
id|btv-&gt;risc_cap_odd
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|ro
suffix:semicolon
id|btv-&gt;risc_cap_even
op_assign
id|btv-&gt;gbuf
(braket
id|btv-&gt;gq_grab
)braket
dot
id|re
suffix:semicolon
id|bt848_set_risc_jmps
c_func
(paren
id|btv
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|bt848_set_geo
c_func
(paren
id|btv
comma
l_int|0
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|BT848_COLOR_CTL_GAMMA
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|btv-&gt;s_lock
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|astat
op_amp
id|BT848_INT_HLOCK
)paren
(brace
r_if
c_cond
(paren
(paren
id|dstat
op_amp
id|BT848_DSTATUS_HLOC
)paren
op_logical_or
(paren
id|btv-&gt;radio
)paren
)paren
id|audio
c_func
(paren
id|btv
comma
id|AUDIO_ON
comma
l_int|0
)paren
suffix:semicolon
r_else
id|audio
c_func
(paren
id|btv
comma
id|AUDIO_OFF
comma
l_int|0
)paren
suffix:semicolon
)brace
id|count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|20
)paren
(brace
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_INT_MASK
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bttv%d: IRQ lockup, cleared int mask&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
id|bt848_offline
c_func
(paren
id|btv
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Scan for a Bt848 card, request the irq and map the io memory &n; */
DECL|function|bttv_remove
r_static
r_void
id|__devexit
id|bttv_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
id|u8
id|command
suffix:semicolon
r_int
id|j
suffix:semicolon
r_struct
id|bttv
op_star
id|btv
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
l_string|&quot;bttv%d: unloading&bslash;n&quot;
comma
id|btv-&gt;nr
)paren
suffix:semicolon
multiline_comment|/* unregister i2c_bus */
r_if
c_cond
(paren
l_int|0
op_eq
id|btv-&gt;i2c_rc
)paren
id|i2c_bit_del_bus
c_func
(paren
op_amp
id|btv-&gt;i2c_adap
)paren
suffix:semicolon
multiline_comment|/* turn off all capturing, DMA and IRQs */
id|btand
c_func
(paren
op_complement
l_int|15
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
multiline_comment|/* first disable interrupts before unmapping the memory! */
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_INT_MASK
)paren
suffix:semicolon
id|btwrite
c_func
(paren
op_complement
l_int|0x0UL
comma
id|BT848_INT_STAT
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x0
comma
id|BT848_GPIO_OUT_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bttv_gpio
)paren
id|bttv_gpio_tracking
c_func
(paren
id|btv
comma
l_string|&quot;cleanup&quot;
)paren
suffix:semicolon
multiline_comment|/* disable PCI bus-mastering */
id|pci_read_config_byte
c_func
(paren
id|btv-&gt;dev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
suffix:semicolon
multiline_comment|/* Should this be &amp;=~ ?? */
id|command
op_and_assign
op_complement
id|PCI_COMMAND_MASTER
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|btv-&gt;dev
comma
id|PCI_COMMAND
comma
id|command
)paren
suffix:semicolon
multiline_comment|/* unmap and free memory */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|gbuffers
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|btv-&gt;gbuf
(braket
id|j
)braket
dot
id|risc
)paren
id|kfree
c_func
(paren
id|btv-&gt;gbuf
(braket
id|j
)braket
dot
id|risc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;gbuf
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;gbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;risc_scr_odd
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;risc_scr_odd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;risc_scr_even
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;risc_scr_even
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;free: risc_jmp: 0x%p.&bslash;n&quot;
comma
id|btv-&gt;risc_jmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;risc_jmp
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;risc_jmp
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bt848_vbibuf: 0x%p.&bslash;n&quot;
comma
id|btv-&gt;vbibuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;vbibuf
)paren
id|vfree
c_func
(paren
(paren
r_void
op_star
)paren
id|btv-&gt;vbibuf
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|btv-&gt;irq
comma
id|btv
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bt848_mem: 0x%p.&bslash;n&quot;
comma
id|btv-&gt;bt848_mem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;bt848_mem
)paren
id|iounmap
c_func
(paren
id|btv-&gt;bt848_mem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;video_dev.minor
op_ne
op_minus
l_int|1
)paren
(brace
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;video_dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;vbi_dev.minor
op_ne
op_minus
l_int|1
)paren
(brace
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;vbi_dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|radio
(braket
id|btv-&gt;nr
)braket
op_logical_and
id|btv-&gt;radio_dev.minor
op_ne
op_minus
l_int|1
)paren
id|video_unregister_device
c_func
(paren
op_amp
id|btv-&gt;radio_dev
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|btv-&gt;dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|btv-&gt;dev
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* wake up any waiting processes&n;           because shutdown flag is set, no new processes (in this queue)&n;           are expected&n;        */
id|btv-&gt;shutdown
op_assign
l_int|1
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|btv-&gt;gpioq
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|bttv_probe
r_static
r_int
id|__devinit
id|bttv_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_char
id|lat
suffix:semicolon
r_struct
id|bttv
op_star
id|btv
suffix:semicolon
macro_line|#if defined(__powerpc__)
r_int
r_int
id|cmd
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;bttv: Bt8xx card found (%d).&bslash;n&quot;
comma
id|bttv_num
)paren
suffix:semicolon
id|btv
op_assign
op_amp
id|bttvs
(braket
id|bttv_num
)braket
suffix:semicolon
id|btv-&gt;dev
op_assign
id|dev
suffix:semicolon
id|btv-&gt;nr
op_assign
id|bttv_num
suffix:semicolon
id|btv-&gt;bt848_mem
op_assign
l_int|NULL
suffix:semicolon
id|btv-&gt;vbibuf
op_assign
l_int|NULL
suffix:semicolon
id|btv-&gt;risc_jmp
op_assign
l_int|NULL
suffix:semicolon
id|btv-&gt;vbi_odd
op_assign
l_int|NULL
suffix:semicolon
id|btv-&gt;vbi_even
op_assign
l_int|NULL
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|btv-&gt;vbiq
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|btv-&gt;capq
)paren
suffix:semicolon
id|btv-&gt;vbip
op_assign
id|VBIBUF_SIZE
suffix:semicolon
id|btv-&gt;s_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|btv-&gt;gpioq
)paren
suffix:semicolon
id|btv-&gt;shutdown
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;video_dev
comma
op_amp
id|bttv_template
comma
r_sizeof
(paren
id|bttv_template
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;vbi_dev
comma
op_amp
id|vbi_template
comma
r_sizeof
(paren
id|vbi_template
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|btv-&gt;radio_dev
comma
op_amp
id|radio_template
comma
r_sizeof
(paren
id|radio_template
)paren
)paren
suffix:semicolon
id|btv-&gt;id
op_assign
id|dev-&gt;device
suffix:semicolon
id|btv-&gt;irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|btv-&gt;bt848_adr
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
l_string|&quot;bttv&quot;
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|btv-&gt;id
op_ge
l_int|878
)paren
id|btv-&gt;i2c_command
op_assign
l_int|0x83
suffix:semicolon
r_else
id|btv-&gt;i2c_command
op_assign
(paren
id|I2C_TIMING
op_or
id|BT848_I2C_SCL
op_or
id|BT848_I2C_SDA
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|btv-&gt;revision
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|lat
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;bttv%d: Bt%d (rev %d) at %02x:%02x.%x, &quot;
comma
id|bttv_num
comma
id|btv-&gt;id
comma
id|btv-&gt;revision
comma
id|dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
comma
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;irq: %d, latency: %d, memory: 0x%lx&bslash;n&quot;
comma
id|btv-&gt;irq
comma
id|lat
comma
id|btv-&gt;bt848_adr
)paren
suffix:semicolon
id|bttv_idcard
c_func
(paren
id|btv
)paren
suffix:semicolon
macro_line|#if defined(__powerpc__)
multiline_comment|/* on OpenFirmware machines (PowerMac at least), PCI memory cycle */
multiline_comment|/* response on cards with no firmware is not enabled by OF */
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd
op_assign
(paren
id|cmd
op_or
id|PCI_COMMAND_MEMORY
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef __sparc__
id|btv-&gt;bt848_mem
op_assign
(paren
r_int
r_char
op_star
)paren
id|btv-&gt;bt848_adr
suffix:semicolon
macro_line|#else
id|btv-&gt;bt848_mem
op_assign
id|ioremap
c_func
(paren
id|btv-&gt;bt848_adr
comma
l_int|0x1000
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* clear interrupt mask */
id|btwrite
c_func
(paren
l_int|0
comma
id|BT848_INT_MASK
)paren
suffix:semicolon
id|result
op_assign
id|request_irq
c_func
(paren
id|btv-&gt;irq
comma
id|bttv_irq
comma
id|SA_SHIRQ
op_or
id|SA_INTERRUPT
comma
l_string|&quot;bttv&quot;
comma
(paren
r_void
op_star
)paren
id|btv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EINVAL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bttv%d: Bad irq number or handler&bslash;n&quot;
comma
id|bttv_num
)paren
suffix:semicolon
r_goto
id|fail1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EBUSY
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bttv%d: IRQ %d busy, change your PnP config in BIOS&bslash;n&quot;
comma
id|bttv_num
comma
id|btv-&gt;irq
)paren
suffix:semicolon
r_goto
id|fail1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|fail1
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|bttv_handle_chipset
c_func
(paren
id|btv
)paren
)paren
(brace
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|fail2
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
id|btv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_bt848
c_func
(paren
id|btv
)paren
OL
l_int|0
)paren
(brace
id|bttv_remove
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|bttv_num
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail2
suffix:colon
id|free_irq
c_func
(paren
id|btv-&gt;irq
comma
id|btv
)paren
suffix:semicolon
id|fail1
suffix:colon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|btv-&gt;dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|btv-&gt;dev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|bttv_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_BROOKTREE
comma
id|PCI_DEVICE_ID_BT848
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_BROOKTREE
comma
id|PCI_DEVICE_ID_BT849
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_BROOKTREE
comma
id|PCI_DEVICE_ID_BT878
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_BROOKTREE
comma
id|PCI_DEVICE_ID_BT879
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|bttv_pci_tbl
)paren
suffix:semicolon
DECL|variable|bttv_pci_driver
r_static
r_struct
id|pci_driver
id|bttv_pci_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;bttv&quot;
comma
id|id_table
suffix:colon
id|bttv_pci_tbl
comma
id|probe
suffix:colon
id|bttv_probe
comma
id|remove
suffix:colon
id|bttv_remove
comma
)brace
suffix:semicolon
DECL|function|bttv_init_module
r_int
id|bttv_init_module
c_func
(paren
r_void
)paren
(brace
id|bttv_num
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;bttv: driver version %d.%d.%d loaded&bslash;n&quot;
comma
(paren
id|BTTV_VERSION_CODE
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
comma
(paren
id|BTTV_VERSION_CODE
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|BTTV_VERSION_CODE
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gbuffers
template_param
id|MAX_GBUFFERS
)paren
id|gbuffers
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|gbufsize
template_param
id|BTTV_MAX_FBUF
)paren
id|gbufsize
op_assign
id|BTTV_MAX_FBUF
suffix:semicolon
r_if
c_cond
(paren
id|bttv_verbose
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;bttv: using %d buffers with %dk (%dk total) for capture&bslash;n&quot;
comma
id|gbuffers
comma
id|gbufsize
op_div
l_int|1024
comma
id|gbuffers
op_star
id|gbufsize
op_div
l_int|1024
)paren
suffix:semicolon
id|bttv_check_chipset
c_func
(paren
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|bttv_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|bttv_cleanup_module
r_void
id|bttv_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|bttv_pci_driver
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|bttv_init_module
id|module_init
c_func
(paren
id|bttv_init_module
)paren
suffix:semicolon
DECL|variable|bttv_cleanup_module
id|module_exit
c_func
(paren
id|bttv_cleanup_module
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
