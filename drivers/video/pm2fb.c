multiline_comment|/*&n; * Permedia2 framebuffer driver.&n; * Copyright (c) 1998-1999 Ilario Nardinocchi (nardinoc@CS.UniBO.IT)&n; * Copyright (c) 1999 Jakub Jelinek (jakub@redhat.com)&n; * Based on linux/drivers/video/skeletonfb.c by Geert Uytterhoeven.&n; * --------------------------------------------------------------------------&n; * $Id: pm2fb.c,v 1.163 1999/02/21 14:06:49 illo Exp $&n; * --------------------------------------------------------------------------&n; * TODO multiple boards support&n; * --------------------------------------------------------------------------&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &quot;pm2fb.h&quot;
macro_line|#include &quot;cvisionppc.h&quot;
macro_line|#ifdef __sparc__
macro_line|#include &lt;asm/pbm.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#endif
macro_line|#if !defined(__LITTLE_ENDIAN) &amp;&amp; !defined(__BIG_ENDIAN)
macro_line|#error&t;&quot;The endianness of the target host has not been defined.&quot;
macro_line|#endif
macro_line|#if defined(__BIG_ENDIAN) &amp;&amp; !defined(__sparc__)
DECL|macro|PM2FB_BE_APERTURE
mdefine_line|#define PM2FB_BE_APERTURE
macro_line|#endif
multiline_comment|/* Need to debug this some more */
DECL|macro|PM2FB_HW_CURSOR
macro_line|#undef PM2FB_HW_CURSOR
macro_line|#if defined(CONFIG_FB_PM2_PCI) &amp;&amp; !defined(CONFIG_PCI)
DECL|macro|CONFIG_FB_PM2_PCI
macro_line|#undef CONFIG_FB_PM2_PCI
macro_line|#warning &quot;support for Permedia2 PCI boards with no generic PCI support!&quot;
macro_line|#endif
DECL|macro|PM2FB_MASTER_DEBUG
macro_line|#undef PM2FB_MASTER_DEBUG
macro_line|#ifdef PM2FB_MASTER_DEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(a,b...)&t;printk(KERN_DEBUG &quot;pm2fb: %s: &quot; a, __FUNCTION__ , ## b)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(a,b...)
macro_line|#endif 
DECL|macro|PICOS2KHZ
mdefine_line|#define PICOS2KHZ(a) (1000000000UL/(a))
DECL|macro|KHZ2PICOS
mdefine_line|#define KHZ2PICOS(a) (1000000000UL/(a))
multiline_comment|/*&n; * The _DEFINITIVE_ memory mapping/unmapping functions.&n; * This is due to the fact that they&squot;re changing soooo often...&n; */
DECL|macro|MMAP
mdefine_line|#define MMAP(a,b)&t;ioremap((unsigned long )(a), b)
DECL|macro|UNMAP
mdefine_line|#define UNMAP(a,b)&t;iounmap(a)
multiline_comment|/*&n; * The _DEFINITIVE_ memory i/o barrier functions.&n; * This is due to the fact that they&squot;re changing soooo often...&n; */
DECL|macro|DEFW
mdefine_line|#define DEFW()&t;&t;wmb()
DECL|macro|DEFR
mdefine_line|#define DEFR()&t;&t;rmb()
DECL|macro|DEFRW
mdefine_line|#define DEFRW()&t;&t;mb()
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) ((a)&lt;(b)?(a):(b))
macro_line|#endif
macro_line|#ifndef MAX
DECL|macro|MAX
mdefine_line|#define MAX(a,b) ((a)&gt;(b)?(a):(b))
macro_line|#endif
DECL|struct|pm2fb_par
r_struct
id|pm2fb_par
(brace
DECL|member|pixclock
id|u32
id|pixclock
suffix:semicolon
multiline_comment|/* pixclock in KHz */
DECL|member|width
id|u32
id|width
suffix:semicolon
multiline_comment|/* width of virtual screen */
DECL|member|height
id|u32
id|height
suffix:semicolon
multiline_comment|/* height of virtual screen */
DECL|member|hsstart
id|u32
id|hsstart
suffix:semicolon
multiline_comment|/* horiz. sync start */
DECL|member|hsend
id|u32
id|hsend
suffix:semicolon
multiline_comment|/* horiz. sync end */
DECL|member|hbend
id|u32
id|hbend
suffix:semicolon
multiline_comment|/* horiz. blank end (also gate end) */
DECL|member|htotal
id|u32
id|htotal
suffix:semicolon
multiline_comment|/* total width (w/ sync &amp; blank) */
DECL|member|vsstart
id|u32
id|vsstart
suffix:semicolon
multiline_comment|/* vert. sync start */
DECL|member|vsend
id|u32
id|vsend
suffix:semicolon
multiline_comment|/* vert. sync end */
DECL|member|vbend
id|u32
id|vbend
suffix:semicolon
multiline_comment|/* vert. blank end */
DECL|member|vtotal
id|u32
id|vtotal
suffix:semicolon
multiline_comment|/* total height (w/ sync &amp; blank) */
DECL|member|stride
id|u32
id|stride
suffix:semicolon
multiline_comment|/* screen stride */
DECL|member|base
id|u32
id|base
suffix:semicolon
multiline_comment|/* screen base (xoffset+yoffset) */
DECL|member|depth
id|u32
id|depth
suffix:semicolon
multiline_comment|/* screen depth (8, 16, 24 or 32) */
DECL|member|video
id|u32
id|video
suffix:semicolon
multiline_comment|/* video control (hsync,vsync) */
)brace
suffix:semicolon
DECL|macro|OPTF_OLD_MEM
mdefine_line|#define OPTF_OLD_MEM&t;&t;(1L&lt;&lt;0)
DECL|macro|OPTF_YPAN
mdefine_line|#define OPTF_YPAN&t;&t;(1L&lt;&lt;1)
DECL|macro|OPTF_VIRTUAL
mdefine_line|#define OPTF_VIRTUAL&t;&t;(1L&lt;&lt;2)
DECL|macro|OPTF_USER
mdefine_line|#define OPTF_USER&t;&t;(1L&lt;&lt;3)
r_static
r_struct
(brace
DECL|member|font
r_char
id|font
(braket
l_int|40
)braket
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|user_mode
r_struct
id|pm2fb_par
id|user_mode
suffix:semicolon
DECL|variable|pm2fb_options
)brace
id|pm2fb_options
op_assign
macro_line|#ifdef __sparc__
multiline_comment|/* For some reason Raptor is not happy with the low-end mode */
(brace
l_string|&quot;&bslash;0&quot;
comma
l_int|0L
comma
(brace
l_int|31499
comma
l_int|640
comma
l_int|480
comma
l_int|4
comma
l_int|20
comma
l_int|50
comma
l_int|209
comma
l_int|0
comma
l_int|3
comma
l_int|20
comma
l_int|499
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
suffix:semicolon
macro_line|#else
(brace
l_string|&quot;&bslash;0&quot;
comma
l_int|0L
comma
(brace
l_int|25174
comma
l_int|640
comma
l_int|480
comma
l_int|4
comma
l_int|28
comma
l_int|40
comma
l_int|199
comma
l_int|9
comma
l_int|11
comma
l_int|45
comma
l_int|524
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_char
id|curblink
id|__initdata
op_assign
l_int|1
suffix:semicolon
r_static
r_const
r_struct
(brace
DECL|member|name
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|par
r_struct
id|pm2fb_par
id|par
suffix:semicolon
DECL|variable|__initdata
)brace
id|user_mode
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_string|&quot;640x480-60&quot;
comma
(brace
l_int|25174
comma
l_int|640
comma
l_int|480
comma
l_int|4
comma
l_int|28
comma
l_int|40
comma
l_int|199
comma
l_int|9
comma
l_int|11
comma
l_int|45
comma
l_int|524
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;640x480-72&quot;
comma
(brace
l_int|31199
comma
l_int|640
comma
l_int|480
comma
l_int|6
comma
l_int|16
comma
l_int|48
comma
l_int|207
comma
l_int|8
comma
l_int|10
comma
l_int|39
comma
l_int|518
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;640x480-75&quot;
comma
(brace
l_int|31499
comma
l_int|640
comma
l_int|480
comma
l_int|4
comma
l_int|20
comma
l_int|50
comma
l_int|209
comma
l_int|0
comma
l_int|3
comma
l_int|20
comma
l_int|499
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;640x480-90&quot;
comma
(brace
l_int|39909
comma
l_int|640
comma
l_int|480
comma
l_int|8
comma
l_int|18
comma
l_int|48
comma
l_int|207
comma
l_int|24
comma
l_int|38
comma
l_int|53
comma
l_int|532
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;640x480-100&quot;
comma
(brace
l_int|44899
comma
l_int|640
comma
l_int|480
comma
l_int|8
comma
l_int|40
comma
l_int|52
comma
l_int|211
comma
l_int|21
comma
l_int|33
comma
l_int|51
comma
l_int|530
comma
l_int|80
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;800x600-56&quot;
comma
(brace
l_int|35999
comma
l_int|800
comma
l_int|600
comma
l_int|6
comma
l_int|24
comma
l_int|56
comma
l_int|255
comma
l_int|0
comma
l_int|2
comma
l_int|25
comma
l_int|624
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;800x600-60&quot;
comma
(brace
l_int|40000
comma
l_int|800
comma
l_int|600
comma
l_int|10
comma
l_int|42
comma
l_int|64
comma
l_int|263
comma
l_int|0
comma
l_int|4
comma
l_int|28
comma
l_int|627
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;800x600-70&quot;
comma
(brace
l_int|44899
comma
l_int|800
comma
l_int|600
comma
l_int|6
comma
l_int|42
comma
l_int|52
comma
l_int|251
comma
l_int|8
comma
l_int|20
comma
l_int|36
comma
l_int|635
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|105
)brace
)brace
comma
(brace
l_string|&quot;800x600-72&quot;
comma
(brace
l_int|50000
comma
l_int|800
comma
l_int|600
comma
l_int|14
comma
l_int|44
comma
l_int|60
comma
l_int|259
comma
l_int|36
comma
l_int|42
comma
l_int|66
comma
l_int|665
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;800x600-75&quot;
comma
(brace
l_int|49497
comma
l_int|800
comma
l_int|600
comma
l_int|4
comma
l_int|24
comma
l_int|64
comma
l_int|263
comma
l_int|0
comma
l_int|3
comma
l_int|25
comma
l_int|624
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;800x600-90&quot;
comma
(brace
l_int|56637
comma
l_int|800
comma
l_int|600
comma
l_int|2
comma
l_int|18
comma
l_int|48
comma
l_int|247
comma
l_int|7
comma
l_int|18
comma
l_int|35
comma
l_int|634
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;800x600-100&quot;
comma
(brace
l_int|67499
comma
l_int|800
comma
l_int|600
comma
l_int|0
comma
l_int|16
comma
l_int|70
comma
l_int|269
comma
l_int|6
comma
l_int|10
comma
l_int|25
comma
l_int|624
comma
l_int|100
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1024x768-60&quot;
comma
(brace
l_int|64998
comma
l_int|1024
comma
l_int|768
comma
l_int|6
comma
l_int|40
comma
l_int|80
comma
l_int|335
comma
l_int|2
comma
l_int|8
comma
l_int|38
comma
l_int|805
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1024x768-70&quot;
comma
(brace
l_int|74996
comma
l_int|1024
comma
l_int|768
comma
l_int|6
comma
l_int|40
comma
l_int|76
comma
l_int|331
comma
l_int|2
comma
l_int|8
comma
l_int|38
comma
l_int|805
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1024x768-72&quot;
comma
(brace
l_int|74996
comma
l_int|1024
comma
l_int|768
comma
l_int|6
comma
l_int|40
comma
l_int|66
comma
l_int|321
comma
l_int|2
comma
l_int|8
comma
l_int|38
comma
l_int|805
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1024x768-75&quot;
comma
(brace
l_int|78932
comma
l_int|1024
comma
l_int|768
comma
l_int|4
comma
l_int|28
comma
l_int|72
comma
l_int|327
comma
l_int|0
comma
l_int|3
comma
l_int|32
comma
l_int|799
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1024x768-90&quot;
comma
(brace
l_int|100000
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|24
comma
l_int|72
comma
l_int|327
comma
l_int|20
comma
l_int|35
comma
l_int|77
comma
l_int|844
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1024x768-100&quot;
comma
(brace
l_int|109998
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|22
comma
l_int|92
comma
l_int|347
comma
l_int|0
comma
l_int|7
comma
l_int|24
comma
l_int|791
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1024x768-illo&quot;
comma
(brace
l_int|120322
comma
l_int|1024
comma
l_int|768
comma
l_int|12
comma
l_int|48
comma
l_int|120
comma
l_int|375
comma
l_int|3
comma
l_int|7
comma
l_int|32
comma
l_int|799
comma
l_int|128
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1152x864-60&quot;
comma
(brace
l_int|80000
comma
l_int|1152
comma
l_int|864
comma
l_int|16
comma
l_int|44
comma
l_int|76
comma
l_int|363
comma
l_int|5
comma
l_int|10
comma
l_int|52
comma
l_int|915
comma
l_int|144
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1152x864-70&quot;
comma
(brace
l_int|100000
comma
l_int|1152
comma
l_int|864
comma
l_int|10
comma
l_int|48
comma
l_int|90
comma
l_int|377
comma
l_int|12
comma
l_int|23
comma
l_int|81
comma
l_int|944
comma
l_int|144
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1152x864-75&quot;
comma
(brace
l_int|109998
comma
l_int|1152
comma
l_int|864
comma
l_int|6
comma
l_int|42
comma
l_int|78
comma
l_int|365
comma
l_int|44
comma
l_int|52
comma
l_int|138
comma
l_int|1001
comma
l_int|144
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1152x864-80&quot;
comma
(brace
l_int|109998
comma
l_int|1152
comma
l_int|864
comma
l_int|4
comma
l_int|32
comma
l_int|72
comma
l_int|359
comma
l_int|29
comma
l_int|36
comma
l_int|94
comma
l_int|957
comma
l_int|144
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-60&quot;
comma
(brace
l_int|107991
comma
l_int|1280
comma
l_int|1024
comma
l_int|12
comma
l_int|40
comma
l_int|102
comma
l_int|421
comma
l_int|0
comma
l_int|3
comma
l_int|42
comma
l_int|1065
comma
l_int|160
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-70&quot;
comma
(brace
l_int|125992
comma
l_int|1280
comma
l_int|1024
comma
l_int|20
comma
l_int|48
comma
l_int|102
comma
l_int|421
comma
l_int|0
comma
l_int|5
comma
l_int|42
comma
l_int|1065
comma
l_int|160
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-74&quot;
comma
(brace
l_int|134989
comma
l_int|1280
comma
l_int|1024
comma
l_int|8
comma
l_int|44
comma
l_int|108
comma
l_int|427
comma
l_int|0
comma
l_int|29
comma
l_int|40
comma
l_int|1063
comma
l_int|160
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-75&quot;
comma
(brace
l_int|134989
comma
l_int|1280
comma
l_int|1024
comma
l_int|4
comma
l_int|40
comma
l_int|102
comma
l_int|421
comma
l_int|0
comma
l_int|3
comma
l_int|42
comma
l_int|1065
comma
l_int|160
comma
l_int|0
comma
l_int|8
comma
l_int|41
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-60&quot;
comma
(brace
l_int|155981
comma
l_int|1600
comma
l_int|1200
comma
l_int|8
comma
l_int|48
comma
l_int|112
comma
l_int|511
comma
l_int|9
comma
l_int|17
comma
l_int|70
comma
l_int|1269
comma
l_int|200
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-66&quot;
comma
(brace
l_int|171998
comma
l_int|1600
comma
l_int|1200
comma
l_int|10
comma
l_int|44
comma
l_int|120
comma
l_int|519
comma
l_int|2
comma
l_int|5
comma
l_int|53
comma
l_int|1252
comma
l_int|200
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-76&quot;
comma
(brace
l_int|197980
comma
l_int|1600
comma
l_int|1200
comma
l_int|10
comma
l_int|44
comma
l_int|120
comma
l_int|519
comma
l_int|2
comma
l_int|7
comma
l_int|50
comma
l_int|1249
comma
l_int|200
comma
l_int|0
comma
l_int|8
comma
l_int|121
)brace
)brace
comma
(brace
l_string|&quot;&bslash;0&quot;
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_FB_PM2_PCI
DECL|struct|pm2pci_par
r_struct
id|pm2pci_par
(brace
DECL|member|mem_config
id|u32
id|mem_config
suffix:semicolon
DECL|member|mem_control
id|u32
id|mem_control
suffix:semicolon
DECL|member|boot_address
id|u32
id|boot_address
suffix:semicolon
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|DEFAULT_CURSOR_BLINK_RATE
mdefine_line|#define DEFAULT_CURSOR_BLINK_RATE       (20)
DECL|macro|CURSOR_DRAW_DELAY
mdefine_line|#define CURSOR_DRAW_DELAY               (2)
DECL|struct|pm2_cursor
r_struct
id|pm2_cursor
(brace
DECL|member|enable
r_int
id|enable
suffix:semicolon
DECL|member|on
r_int
id|on
suffix:semicolon
DECL|member|vbl_cnt
r_int
id|vbl_cnt
suffix:semicolon
DECL|member|blink_rate
r_int
id|blink_rate
suffix:semicolon
r_struct
(brace
DECL|member|x
DECL|member|y
id|u16
id|x
comma
id|y
suffix:semicolon
DECL|member|pos
DECL|member|hot
DECL|member|size
)brace
id|pos
comma
id|hot
comma
id|size
suffix:semicolon
DECL|member|color
id|u8
id|color
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|bits
id|u8
id|bits
(braket
l_int|8
)braket
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|mask
id|u8
id|mask
(braket
l_int|8
)braket
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
op_star
id|timer
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|permedia2_name
r_static
r_const
r_char
id|permedia2_name
(braket
l_int|16
)braket
op_assign
l_string|&quot;Permedia2&quot;
suffix:semicolon
DECL|struct|pm2fb_info
r_static
r_struct
id|pm2fb_info
(brace
DECL|member|gen
r_struct
id|fb_info_gen
id|gen
suffix:semicolon
DECL|member|board
r_int
id|board
suffix:semicolon
multiline_comment|/* Permedia2 board index (see&n;&t;&t;&t;&t;&t;   board_table[] below) */
DECL|member|type
id|pm2type_t
id|type
suffix:semicolon
r_struct
(brace
DECL|member|fb_base
r_int
r_int
id|fb_base
suffix:semicolon
multiline_comment|/* physical framebuffer memory base */
DECL|member|fb_size
id|u32
id|fb_size
suffix:semicolon
multiline_comment|/* framebuffer memory size */
DECL|member|rg_base
r_int
r_int
id|rg_base
suffix:semicolon
multiline_comment|/* physical register memory base */
DECL|member|p_fb
r_int
r_int
id|p_fb
suffix:semicolon
multiline_comment|/* physical address of frame buffer */
DECL|member|v_fb
r_int
r_char
op_star
id|v_fb
suffix:semicolon
multiline_comment|/* virtual address of frame buffer */
DECL|member|p_regs
r_int
r_int
id|p_regs
suffix:semicolon
multiline_comment|/* physical address of registers&n;&t;&t;&t;&t;&t;   region, must be rg_base or&n;&t;&t;&t;&t;&t;   rg_base+PM2_REGS_SIZE depending on&n;&t;&t;&t;&t;&t;   the host endianness */
DECL|member|v_regs
r_int
r_char
op_star
id|v_regs
suffix:semicolon
multiline_comment|/* virtual address of p_regs */
DECL|member|regions
)brace
id|regions
suffix:semicolon
r_union
(brace
multiline_comment|/* here, the per-board par structs */
macro_line|#ifdef CONFIG_FB_PM2_CVPPC
DECL|member|cvppc
r_struct
id|cvppc_par
id|cvppc
suffix:semicolon
multiline_comment|/* CVisionPPC data */
macro_line|#endif
macro_line|#ifdef CONFIG_FB_PM2_PCI
DECL|member|pci
r_struct
id|pm2pci_par
id|pci
suffix:semicolon
multiline_comment|/* Permedia2 PCI boards data */
macro_line|#endif
DECL|member|board_par
)brace
id|board_par
suffix:semicolon
DECL|member|current_par
r_struct
id|pm2fb_par
id|current_par
suffix:semicolon
multiline_comment|/* displayed screen */
DECL|member|current_par_valid
r_int
id|current_par_valid
suffix:semicolon
DECL|member|memclock
id|u32
id|memclock
suffix:semicolon
multiline_comment|/* memclock (set by the per-board&n;&t;&t;&t;&t;&t;   &t;&t;init routine) */
DECL|member|disp
r_struct
id|display
id|disp
suffix:semicolon
r_struct
(brace
DECL|member|transp
id|u8
id|transp
suffix:semicolon
DECL|member|red
id|u8
id|red
suffix:semicolon
DECL|member|green
id|u8
id|green
suffix:semicolon
DECL|member|blue
id|u8
id|blue
suffix:semicolon
DECL|member|palette
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
r_union
(brace
macro_line|#ifdef FBCON_HAS_CFB16
DECL|member|cmap16
id|u16
id|cmap16
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
DECL|member|cmap24
id|u32
id|cmap24
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|member|cmap32
id|u32
id|cmap32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
DECL|member|cmap
)brace
id|cmap
suffix:semicolon
DECL|member|cursor
r_struct
id|pm2_cursor
op_star
id|cursor
suffix:semicolon
DECL|variable|fb_info
)brace
id|fb_info
suffix:semicolon
macro_line|#ifdef CONFIG_FB_PM2_CVPPC
r_static
r_int
id|cvppc_detect
c_func
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|cvppc_init
c_func
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_PM2_PCI
r_static
r_int
id|pm2pci_detect
c_func
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|pm2pci_init
c_func
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PM2FB_HW_CURSOR
r_static
r_void
id|pm2fb_cursor
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|mode
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_set_font
c_func
(paren
r_struct
id|display
op_star
id|d
comma
r_int
id|width
comma
r_int
id|height
)paren
suffix:semicolon
r_static
r_struct
id|pm2_cursor
op_star
id|pm2_init_cursor
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_void
id|pm2v_set_cursor_color
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
)paren
suffix:semicolon
r_static
r_void
id|pm2v_set_cursor_shape
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
)paren
suffix:semicolon
DECL|variable|cursor_color_map
r_static
id|u8
id|cursor_color_map
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0xff
)brace
suffix:semicolon
macro_line|#else
DECL|macro|pm2fb_cursor
mdefine_line|#define pm2fb_cursor NULL
DECL|macro|pm2fb_set_font
mdefine_line|#define pm2fb_set_font NULL
macro_line|#endif
multiline_comment|/*&n; * Table of the supported Permedia2 based boards.&n; * Three hooks are defined for each board:&n; * detect(): should return 1 if the related board has been detected, 0&n; *           otherwise. It should also fill the fields &squot;regions.fb_base&squot;,&n; *           &squot;regions.fb_size&squot;, &squot;regions.rg_base&squot; and &squot;memclock&squot; in the&n; *           passed pm2fb_info structure.&n; * init(): called immediately after the reset of the Permedia2 chip.&n; *         It should reset the memory controller if needed (the MClk&n; *         is set shortly afterwards by the caller).&n; * cleanup(): called after the driver has been unregistered.&n; *&n; * the init and cleanup pointers can be NULL.&n; */
r_static
r_const
r_struct
(brace
DECL|member|detect
r_int
(paren
op_star
id|detect
)paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
DECL|member|init
r_void
(paren
op_star
id|init
)paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
DECL|member|cleanup
r_void
(paren
op_star
id|cleanup
)paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|32
)braket
suffix:semicolon
DECL|variable|board_table
)brace
id|board_table
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_FB_PM2_PCI
(brace
id|pm2pci_detect
comma
id|pm2pci_init
comma
l_int|NULL
comma
l_string|&quot;Permedia2 PCI board&quot;
)brace
comma
macro_line|#endif
macro_line|#ifdef CONFIG_FB_PM2_CVPPC
(brace
id|cvppc_detect
comma
id|cvppc_init
comma
l_int|NULL
comma
l_string|&quot;CVisionPPC/BVisionPPC&quot;
)brace
comma
macro_line|#endif
(brace
l_int|NULL
comma
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * partial products for the supported horizontal resolutions.&n; */
DECL|macro|PACKPP
mdefine_line|#define PACKPP(p0,p1,p2)&t;(((p2)&lt;&lt;6)|((p1)&lt;&lt;3)|(p0))
r_static
r_const
r_struct
(brace
DECL|member|width
id|u16
id|width
suffix:semicolon
DECL|member|pp
id|u16
id|pp
suffix:semicolon
DECL|variable|pp_table
)brace
id|pp_table
(braket
)braket
op_assign
(brace
(brace
l_int|32
comma
id|PACKPP
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
)paren
)brace
comma
(brace
l_int|64
comma
id|PACKPP
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
)brace
comma
(brace
l_int|96
comma
id|PACKPP
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
)paren
)brace
comma
(brace
l_int|128
comma
id|PACKPP
c_func
(paren
l_int|2
comma
l_int|1
comma
l_int|1
)paren
)brace
comma
(brace
l_int|160
comma
id|PACKPP
c_func
(paren
l_int|2
comma
l_int|2
comma
l_int|1
)paren
)brace
comma
(brace
l_int|192
comma
id|PACKPP
c_func
(paren
l_int|2
comma
l_int|2
comma
l_int|2
)paren
)brace
comma
(brace
l_int|224
comma
id|PACKPP
c_func
(paren
l_int|3
comma
l_int|2
comma
l_int|1
)paren
)brace
comma
(brace
l_int|256
comma
id|PACKPP
c_func
(paren
l_int|3
comma
l_int|2
comma
l_int|2
)paren
)brace
comma
(brace
l_int|288
comma
id|PACKPP
c_func
(paren
l_int|3
comma
l_int|3
comma
l_int|1
)paren
)brace
comma
(brace
l_int|320
comma
id|PACKPP
c_func
(paren
l_int|3
comma
l_int|3
comma
l_int|2
)paren
)brace
comma
(brace
l_int|384
comma
id|PACKPP
c_func
(paren
l_int|3
comma
l_int|3
comma
l_int|3
)paren
)brace
comma
(brace
l_int|416
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|3
comma
l_int|1
)paren
)brace
comma
(brace
l_int|448
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|3
comma
l_int|2
)paren
)brace
comma
(brace
l_int|512
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|3
comma
l_int|3
)paren
)brace
comma
(brace
l_int|544
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|4
comma
l_int|1
)paren
)brace
comma
(brace
l_int|576
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|4
comma
l_int|2
)paren
)brace
comma
(brace
l_int|640
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|4
comma
l_int|3
)paren
)brace
comma
(brace
l_int|768
comma
id|PACKPP
c_func
(paren
l_int|4
comma
l_int|4
comma
l_int|4
)paren
)brace
comma
(brace
l_int|800
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|4
comma
l_int|1
)paren
)brace
comma
(brace
l_int|832
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|4
comma
l_int|2
)paren
)brace
comma
(brace
l_int|896
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|4
comma
l_int|3
)paren
)brace
comma
(brace
l_int|1024
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|4
comma
l_int|4
)paren
)brace
comma
(brace
l_int|1056
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|5
comma
l_int|1
)paren
)brace
comma
(brace
l_int|1088
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|5
comma
l_int|2
)paren
)brace
comma
(brace
l_int|1152
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|5
comma
l_int|3
)paren
)brace
comma
(brace
l_int|1280
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|5
comma
l_int|4
)paren
)brace
comma
(brace
l_int|1536
comma
id|PACKPP
c_func
(paren
l_int|5
comma
l_int|5
comma
l_int|5
)paren
)brace
comma
(brace
l_int|1568
comma
id|PACKPP
c_func
(paren
l_int|6
comma
l_int|5
comma
l_int|1
)paren
)brace
comma
(brace
l_int|1600
comma
id|PACKPP
c_func
(paren
l_int|6
comma
l_int|5
comma
l_int|2
)paren
)brace
comma
(brace
l_int|1664
comma
id|PACKPP
c_func
(paren
l_int|6
comma
l_int|5
comma
l_int|3
)paren
)brace
comma
(brace
l_int|1792
comma
id|PACKPP
c_func
(paren
l_int|6
comma
l_int|5
comma
l_int|4
)paren
)brace
comma
(brace
l_int|2048
comma
id|PACKPP
c_func
(paren
l_int|6
comma
l_int|5
comma
l_int|5
)paren
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
r_static
r_void
id|pm2fb_detect
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm2fb_get_par
c_func
(paren
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm2fb_set_par
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm2fb_pan_display
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm2fb_set_disp
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
DECL|variable|pm2fb_hwswitch
r_static
r_struct
id|fbgen_hwswitch
id|pm2fb_hwswitch
op_assign
initialization_block
suffix:semicolon
DECL|variable|pm2fb_ops
r_static
r_struct
id|fb_ops
id|pm2fb_ops
op_assign
initialization_block
suffix:semicolon
multiline_comment|/***************************************************************************&n; * Begin of Permedia2 specific functions&n; ***************************************************************************/
DECL|function|RD32
r_inline
r_static
id|u32
id|RD32
c_func
(paren
r_int
r_char
op_star
id|base
comma
id|s32
id|off
)paren
(brace
r_return
id|readl
c_func
(paren
id|base
op_plus
id|off
)paren
suffix:semicolon
)brace
DECL|function|WR32
r_inline
r_static
r_void
id|WR32
c_func
(paren
r_int
r_char
op_star
id|base
comma
id|s32
id|off
comma
id|u32
id|v
)paren
(brace
id|writel
c_func
(paren
id|v
comma
id|base
op_plus
id|off
)paren
suffix:semicolon
)brace
DECL|function|pm2_RD
r_inline
r_static
id|u32
id|pm2_RD
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|off
)paren
(brace
r_return
id|RD32
c_func
(paren
id|p-&gt;regions.v_regs
comma
id|off
)paren
suffix:semicolon
)brace
DECL|function|pm2_WR
r_inline
r_static
r_void
id|pm2_WR
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|off
comma
id|u32
id|v
)paren
(brace
id|WR32
c_func
(paren
id|p-&gt;regions.v_regs
comma
id|off
comma
id|v
)paren
suffix:semicolon
)brace
DECL|function|pm2_RDAC_RD
r_inline
r_static
id|u32
id|pm2_RDAC_RD
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|idx
)paren
(brace
r_int
id|index
op_assign
id|PM2R_RD_INDEXED_DATA
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;type
)paren
(brace
r_case
id|PM2_TYPE_PERMEDIA2
suffix:colon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_WRITE_ADDRESS
comma
id|idx
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2_TYPE_PERMEDIA2V
suffix:colon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEX_LOW
comma
id|idx
op_amp
l_int|0xff
)paren
suffix:semicolon
id|index
op_assign
id|PM2VR_RD_INDEXED_DATA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
r_return
id|pm2_RD
c_func
(paren
id|p
comma
id|index
)paren
suffix:semicolon
)brace
DECL|function|pm2_RDAC_WR
r_inline
r_static
r_void
id|pm2_RDAC_WR
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|idx
comma
id|u32
id|v
)paren
(brace
r_int
id|index
op_assign
id|PM2R_RD_INDEXED_DATA
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;type
)paren
(brace
r_case
id|PM2_TYPE_PERMEDIA2
suffix:colon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_WRITE_ADDRESS
comma
id|idx
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2_TYPE_PERMEDIA2V
suffix:colon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEX_LOW
comma
id|idx
op_amp
l_int|0xff
)paren
suffix:semicolon
id|index
op_assign
id|PM2VR_RD_INDEXED_DATA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|index
comma
id|v
)paren
suffix:semicolon
)brace
DECL|function|pm2v_RDAC_RD
r_inline
r_static
id|u32
id|pm2v_RDAC_RD
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|idx
)paren
(brace
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEX_LOW
comma
id|idx
op_amp
l_int|0xff
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
r_return
id|pm2_RD
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEXED_DATA
)paren
suffix:semicolon
)brace
DECL|function|pm2v_RDAC_WR
r_inline
r_static
r_void
id|pm2v_RDAC_WR
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|s32
id|idx
comma
id|u32
id|v
)paren
(brace
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEX_LOW
comma
id|idx
op_amp
l_int|0xff
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEXED_DATA
comma
id|v
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_PM2_FIFO_DISCONNECT
DECL|macro|WAIT_FIFO
mdefine_line|#define WAIT_FIFO(p,a)
macro_line|#else
DECL|function|WAIT_FIFO
r_inline
r_static
r_void
id|WAIT_FIFO
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
id|u32
id|a
)paren
(brace
r_while
c_loop
(paren
id|pm2_RD
c_func
(paren
id|p
comma
id|PM2R_IN_FIFO_SPACE
)paren
OL
id|a
)paren
(brace
suffix:semicolon
)brace
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|partprod
r_static
id|u32
id|partprod
c_func
(paren
id|u32
id|xres
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|pp_table
(braket
id|i
)braket
dot
id|width
op_logical_and
id|pp_table
(braket
id|i
)braket
dot
id|width
op_ne
id|xres
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pp_table
(braket
id|i
)braket
dot
id|width
)paren
id|DPRINTK
c_func
(paren
l_string|&quot;invalid width %u&bslash;n&quot;
comma
id|xres
)paren
suffix:semicolon
r_return
id|pp_table
(braket
id|i
)braket
dot
id|pp
suffix:semicolon
)brace
DECL|function|to3264
r_static
id|u32
id|to3264
c_func
(paren
id|u32
id|timing
comma
r_int
id|bpp
comma
r_int
id|is64
)paren
(brace
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|timing
op_assign
id|timing
op_rshift
(paren
l_int|2
op_plus
id|is64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|timing
op_assign
id|timing
op_rshift
(paren
l_int|1
op_plus
id|is64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|timing
op_assign
(paren
id|timing
op_star
l_int|3
)paren
op_rshift
(paren
l_int|2
op_plus
id|is64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|is64
)paren
id|timing
op_assign
id|timing
op_rshift
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|timing
suffix:semicolon
)brace
DECL|function|from3264
r_static
id|u32
id|from3264
c_func
(paren
id|u32
id|timing
comma
r_int
id|bpp
comma
r_int
id|is64
)paren
(brace
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|timing
op_assign
id|timing
op_lshift
(paren
l_int|2
op_plus
id|is64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|timing
op_assign
id|timing
op_lshift
(paren
l_int|1
op_plus
id|is64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|timing
op_assign
(paren
id|timing
op_lshift
(paren
l_int|2
op_plus
id|is64
)paren
)paren
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|is64
)paren
id|timing
op_assign
id|timing
op_lshift
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|timing
suffix:semicolon
)brace
DECL|function|pm2_mnp
r_static
r_void
id|pm2_mnp
c_func
(paren
id|u32
id|clk
comma
r_int
r_char
op_star
id|mm
comma
r_int
r_char
op_star
id|nn
comma
r_int
r_char
op_star
id|pp
)paren
(brace
r_int
r_char
id|m
suffix:semicolon
r_int
r_char
id|n
suffix:semicolon
r_int
r_char
id|p
suffix:semicolon
id|u32
id|f
suffix:semicolon
id|s32
id|curr
suffix:semicolon
id|s32
id|delta
op_assign
l_int|100000
suffix:semicolon
op_star
id|mm
op_assign
op_star
id|nn
op_assign
op_star
id|pp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|2
suffix:semicolon
id|n
OL
l_int|15
suffix:semicolon
id|n
op_increment
)paren
(brace
r_for
c_loop
(paren
id|m
op_assign
l_int|2
suffix:semicolon
id|m
suffix:semicolon
id|m
op_increment
)paren
(brace
id|f
op_assign
id|PM2_REFERENCE_CLOCK
op_star
id|m
op_div
id|n
suffix:semicolon
r_if
c_cond
(paren
id|f
op_ge
l_int|150000
op_logical_and
id|f
op_le
l_int|300000
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
l_int|0
suffix:semicolon
id|p
OL
l_int|5
suffix:semicolon
id|p
op_increment
comma
id|f
op_rshift_assign
l_int|1
)paren
(brace
id|curr
op_assign
id|clk
OG
id|f
ques
c_cond
id|clk
op_minus
id|f
suffix:colon
id|f
op_minus
id|clk
suffix:semicolon
r_if
c_cond
(paren
id|curr
OL
id|delta
)paren
(brace
id|delta
op_assign
id|curr
suffix:semicolon
op_star
id|mm
op_assign
id|m
suffix:semicolon
op_star
id|nn
op_assign
id|n
suffix:semicolon
op_star
id|pp
op_assign
id|p
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
)brace
DECL|function|pm2v_mnp
r_static
r_void
id|pm2v_mnp
c_func
(paren
id|u32
id|clk
comma
r_int
r_char
op_star
id|mm
comma
r_int
r_char
op_star
id|nn
comma
r_int
r_char
op_star
id|pp
)paren
(brace
r_int
r_char
id|m
suffix:semicolon
r_int
r_char
id|n
suffix:semicolon
r_int
r_char
id|p
suffix:semicolon
id|u32
id|f
suffix:semicolon
id|s32
id|delta
op_assign
l_int|1000
suffix:semicolon
op_star
id|mm
op_assign
op_star
id|nn
op_assign
op_star
id|pp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|1
suffix:semicolon
id|n
suffix:semicolon
id|n
op_increment
)paren
(brace
r_for
c_loop
(paren
id|m
op_assign
l_int|1
suffix:semicolon
id|m
suffix:semicolon
id|m
op_increment
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
l_int|0
suffix:semicolon
id|p
OL
l_int|2
suffix:semicolon
id|p
op_increment
)paren
(brace
id|f
op_assign
id|PM2_REFERENCE_CLOCK
op_star
id|n
op_div
(paren
id|m
op_star
(paren
l_int|1
op_lshift
(paren
id|p
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clk
OG
id|f
op_minus
id|delta
op_logical_and
id|clk
OL
id|f
op_plus
id|delta
)paren
(brace
id|delta
op_assign
id|clk
OG
id|f
ques
c_cond
id|clk
op_minus
id|f
suffix:colon
id|f
op_minus
id|clk
suffix:semicolon
op_star
id|mm
op_assign
id|m
suffix:semicolon
op_star
id|nn
op_assign
id|n
suffix:semicolon
op_star
id|pp
op_assign
id|p
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|wait_pm2
r_static
r_void
id|wait_pm2
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SYNC
comma
l_int|0
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
r_while
c_loop
(paren
id|pm2_RD
c_func
(paren
id|i
comma
id|PM2R_OUT_FIFO_WORDS
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|DEFR
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pm2_RD
c_func
(paren
id|i
comma
id|PM2R_OUT_FIFO
)paren
op_ne
id|PM2TAG
c_func
(paren
id|PM2R_SYNC
)paren
)paren
suffix:semicolon
)brace
DECL|function|pm2_set_memclock
r_static
r_void
id|pm2_set_memclock
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|info
comma
id|u32
id|clk
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|m
comma
id|n
comma
id|p
suffix:semicolon
id|pm2_mnp
c_func
(paren
id|clk
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|info
comma
l_int|10
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_MEMORY_CLOCK_3
comma
l_int|6
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_MEMORY_CLOCK_1
comma
id|m
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_MEMORY_CLOCK_2
comma
id|n
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_MEMORY_CLOCK_3
comma
l_int|8
op_or
id|p
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_RD
c_func
(paren
id|info
comma
id|PM2I_RD_MEMORY_CLOCK_STATUS
)paren
suffix:semicolon
id|DEFR
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|256
suffix:semicolon
id|i
op_logical_and
op_logical_neg
(paren
id|pm2_RD
c_func
(paren
id|info
comma
id|PM2R_RD_INDEXED_DATA
)paren
op_amp
id|PM2F_PLL_LOCKED
)paren
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
)brace
DECL|function|pm2_set_pixclock
r_static
r_void
id|pm2_set_pixclock
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|info
comma
id|u32
id|clk
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|m
comma
id|n
comma
id|p
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;type
)paren
(brace
r_case
id|PM2_TYPE_PERMEDIA2
suffix:colon
id|pm2_mnp
c_func
(paren
id|clk
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|info
comma
l_int|10
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_PIXEL_CLOCK_A3
comma
l_int|0
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_PIXEL_CLOCK_A1
comma
id|m
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_PIXEL_CLOCK_A2
comma
id|n
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|info
comma
id|PM2I_RD_PIXEL_CLOCK_A3
comma
l_int|8
op_or
id|p
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_RDAC_RD
c_func
(paren
id|info
comma
id|PM2I_RD_PIXEL_CLOCK_STATUS
)paren
suffix:semicolon
id|DEFR
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|256
suffix:semicolon
id|i
op_logical_and
op_logical_neg
(paren
id|pm2_RD
c_func
(paren
id|info
comma
id|PM2R_RD_INDEXED_DATA
)paren
op_amp
id|PM2F_PLL_LOCKED
)paren
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2_TYPE_PERMEDIA2V
suffix:colon
id|pm2v_mnp
c_func
(paren
id|clk
op_div
l_int|2
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|info
comma
l_int|8
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|info
comma
id|PM2VR_RD_INDEX_HIGH
comma
id|PM2VI_RD_CLK0_PRESCALE
op_rshift
l_int|8
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|info
comma
id|PM2VI_RD_CLK0_PRESCALE
comma
id|m
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|info
comma
id|PM2VI_RD_CLK0_FEEDBACK
comma
id|n
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|info
comma
id|PM2VI_RD_CLK0_POSTSCALE
comma
id|p
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|info
comma
id|PM2VR_RD_INDEX_HIGH
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|clear_palette
r_static
r_void
id|clear_palette
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_int
id|i
op_assign
l_int|256
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_WRITE_ADDRESS
comma
l_int|0
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|3
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_color
r_static
r_void
id|set_color
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
comma
r_int
r_char
id|regno
comma
r_int
r_char
id|r
comma
r_int
r_char
id|g
comma
r_int
r_char
id|b
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|4
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_WRITE_ADDRESS
comma
id|regno
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
id|r
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
id|g
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RD_PALETTE_DATA
comma
id|b
)paren
suffix:semicolon
)brace
DECL|function|set_aperture
r_static
r_void
id|set_aperture
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
comma
r_struct
id|pm2fb_par
op_star
id|p
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|2
)paren
suffix:semicolon
macro_line|#ifdef __LITTLE_ENDIAN
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_ONE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_TWO
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
r_switch
c_cond
(paren
id|p-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_case
l_int|24
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_ONE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_TWO
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_ONE
comma
l_int|2
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_TWO
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_ONE
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_APERTURE_TWO
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|set_screen
r_static
r_void
id|set_screen
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
comma
r_struct
id|pm2fb_par
op_star
id|p
)paren
(brace
id|u32
id|clrmode
op_assign
l_int|0
suffix:semicolon
id|u32
id|txtmap
op_assign
l_int|0
suffix:semicolon
id|u32
id|pixsize
op_assign
l_int|0
suffix:semicolon
id|u32
id|clrformat
op_assign
l_int|0
suffix:semicolon
id|u32
id|xres
suffix:semicolon
id|u32
id|video
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;type
op_eq
id|PM2_TYPE_PERMEDIA2V
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2VR_RD_INDEX_HIGH
comma
l_int|0
)paren
suffix:semicolon
)brace
id|xres
op_assign
(paren
id|p-&gt;width
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
suffix:semicolon
id|set_aperture
c_func
(paren
id|i
comma
id|p
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|27
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|i
comma
id|PM2I_RD_COLOR_KEY_CONTROL
comma
id|p-&gt;depth
op_eq
l_int|8
ques
c_cond
l_int|0
suffix:colon
id|PM2F_COLOR_KEY_TEST_OFF
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_READ_PIXEL
comma
l_int|0
)paren
suffix:semicolon
id|clrformat
op_assign
l_int|0x0e
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_READ_PIXEL
comma
l_int|1
)paren
suffix:semicolon
id|clrmode
op_assign
id|PM2F_RD_TRUECOLOR
op_or
l_int|0x06
suffix:semicolon
id|txtmap
op_assign
id|PM2F_TEXTEL_SIZE_16
suffix:semicolon
id|pixsize
op_assign
l_int|1
suffix:semicolon
id|clrformat
op_assign
l_int|0x70
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_READ_PIXEL
comma
l_int|2
)paren
suffix:semicolon
id|clrmode
op_assign
id|PM2F_RD_TRUECOLOR
op_or
l_int|0x08
suffix:semicolon
id|txtmap
op_assign
id|PM2F_TEXTEL_SIZE_32
suffix:semicolon
id|pixsize
op_assign
l_int|2
suffix:semicolon
id|clrformat
op_assign
l_int|0x20
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_READ_PIXEL
comma
l_int|4
)paren
suffix:semicolon
id|clrmode
op_assign
id|PM2F_RD_TRUECOLOR
op_or
l_int|0x09
suffix:semicolon
id|txtmap
op_assign
id|PM2F_TEXTEL_SIZE_24
suffix:semicolon
id|pixsize
op_assign
l_int|4
suffix:semicolon
id|clrformat
op_assign
l_int|0x20
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCREEN_SIZE
comma
(paren
id|p-&gt;height
op_lshift
l_int|16
)paren
op_or
id|p-&gt;width
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCISSOR_MODE
comma
id|PM2F_SCREEN_SCISSOR_ENABLE
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_WRITE_MODE
comma
id|PM2F_FB_WRITE_ENABLE
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_READ_MODE
comma
id|partprod
c_func
(paren
id|xres
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_LB_READ_MODE
comma
id|partprod
c_func
(paren
id|xres
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_TEXTURE_MAP_FORMAT
comma
id|txtmap
op_or
id|partprod
c_func
(paren
id|xres
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_H_TOTAL
comma
id|p-&gt;htotal
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_HS_START
comma
id|p-&gt;hsstart
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_HS_END
comma
id|p-&gt;hsend
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_HG_END
comma
id|p-&gt;hbend
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_HB_END
comma
id|p-&gt;hbend
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_V_TOTAL
comma
id|p-&gt;vtotal
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_VS_START
comma
id|p-&gt;vsstart
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_VS_END
comma
id|p-&gt;vsend
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_VB_END
comma
id|p-&gt;vbend
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCREEN_STRIDE
comma
id|p-&gt;stride
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCREEN_BASE
comma
id|p-&gt;base
)paren
suffix:semicolon
multiline_comment|/* HW cursor needs /VSYNC for recognizing vert retrace */
id|video
op_assign
id|p-&gt;video
op_amp
op_complement
(paren
id|PM2F_HSYNC_ACT_LOW
op_or
id|PM2F_VSYNC_ACT_LOW
)paren
suffix:semicolon
id|video
op_or_assign
id|PM2F_HSYNC_ACT_HIGH
op_or
id|PM2F_VSYNC_ACT_HIGH
suffix:semicolon
r_switch
c_cond
(paren
id|i-&gt;type
)paren
(brace
r_case
id|PM2_TYPE_PERMEDIA2
suffix:colon
id|tmp
op_assign
id|PM2F_RD_PALETTE_WIDTH_8
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|i
comma
id|PM2I_RD_COLOR_MODE
comma
id|PM2F_RD_COLOR_MODE_RGB
op_or
id|PM2F_RD_GUI_ACTIVE
op_or
id|clrmode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_HSYNC_ACT_LOW
)paren
op_eq
id|PM2F_HSYNC_ACT_LOW
)paren
id|tmp
op_or_assign
l_int|4
suffix:semicolon
multiline_comment|/* invert hsync */
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_HSYNC_ACT_LOW
)paren
op_eq
id|PM2F_HSYNC_ACT_LOW
)paren
id|tmp
op_or_assign
l_int|8
suffix:semicolon
multiline_comment|/* invert vsync */
id|pm2_RDAC_WR
c_func
(paren
id|i
comma
id|PM2I_RD_MISC_CONTROL
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2_TYPE_PERMEDIA2V
suffix:colon
id|tmp
op_assign
l_int|0
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|i
comma
id|PM2VI_RD_PIXEL_SIZE
comma
id|pixsize
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|i
comma
id|PM2VI_RD_COLOR_FORMAT
comma
id|clrformat
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_HSYNC_ACT_LOW
)paren
op_eq
id|PM2F_HSYNC_ACT_LOW
)paren
id|tmp
op_or_assign
l_int|1
suffix:semicolon
multiline_comment|/* invert hsync */
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_HSYNC_ACT_LOW
)paren
op_eq
id|PM2F_HSYNC_ACT_LOW
)paren
id|tmp
op_or_assign
l_int|4
suffix:semicolon
multiline_comment|/* invert vsync */
id|pm2v_RDAC_WR
c_func
(paren
id|i
comma
id|PM2VI_RD_SYNC_CONTROL
comma
id|tmp
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|i
comma
id|PM2VI_RD_MISC_CONTROL
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_VIDEO_CONTROL
comma
id|video
)paren
suffix:semicolon
id|pm2_set_pixclock
c_func
(paren
id|i
comma
id|p-&gt;pixclock
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * copy with packed pixels (8/16bpp only).&n; */
DECL|function|pm2fb_pp_copy
r_static
r_void
id|pm2fb_pp_copy
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
comma
id|s32
id|xsrc
comma
id|s32
id|ysrc
comma
id|s32
id|x
comma
id|s32
id|y
comma
id|s32
id|w
comma
id|s32
id|h
)paren
(brace
id|s32
id|scale
op_assign
id|i-&gt;current_par.depth
op_eq
l_int|8
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|s32
id|offset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|w
op_logical_or
op_logical_neg
id|h
)paren
r_return
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|7
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_CONFIG
comma
id|PM2F_CONFIG_FB_WRITE_ENABLE
op_or
id|PM2F_CONFIG_FB_PACKED_DATA
op_or
id|PM2F_CONFIG_FB_READ_SOURCE_ENABLE
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_PIXEL_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_SOURCE_DELTA
comma
(paren
(paren
id|ysrc
op_minus
id|y
)paren
op_amp
l_int|0xfff
)paren
op_lshift
l_int|16
op_or
(paren
(paren
id|xsrc
op_minus
id|x
)paren
op_amp
l_int|0xfff
)paren
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|x
op_amp
l_int|0x3
)paren
op_minus
(paren
id|xsrc
op_amp
l_int|0x3
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RECTANGLE_ORIGIN
comma
(paren
id|y
op_lshift
l_int|16
)paren
op_or
(paren
id|x
op_rshift
id|scale
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RECTANGLE_SIZE
comma
(paren
id|h
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|w
op_plus
l_int|7
)paren
op_rshift
id|scale
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_PACKED_DATA_LIMITS
comma
(paren
id|offset
op_lshift
l_int|29
)paren
op_or
(paren
id|x
op_lshift
l_int|16
)paren
op_or
(paren
id|x
op_plus
id|w
)paren
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RENDER
comma
id|PM2F_RENDER_RECTANGLE
op_or
(paren
id|x
OL
id|xsrc
ques
c_cond
id|PM2F_INCREASE_X
suffix:colon
l_int|0
)paren
op_or
(paren
id|y
OL
id|ysrc
ques
c_cond
id|PM2F_INCREASE_Y
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|wait_pm2
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * block operation. copy=0: rectangle fill, copy=1: rectangle copy.&n; */
DECL|function|pm2fb_block_op
r_static
r_void
id|pm2fb_block_op
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
comma
r_int
id|copy
comma
id|s32
id|xsrc
comma
id|s32
id|ysrc
comma
id|s32
id|x
comma
id|s32
id|y
comma
id|s32
id|w
comma
id|s32
id|h
comma
id|u32
id|color
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|w
op_logical_or
op_logical_neg
id|h
)paren
r_return
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|6
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_CONFIG
comma
id|PM2F_CONFIG_FB_WRITE_ENABLE
op_or
id|PM2F_CONFIG_FB_READ_SOURCE_ENABLE
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_PIXEL_OFFSET
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy
)paren
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_SOURCE_DELTA
comma
(paren
(paren
id|ysrc
op_minus
id|y
)paren
op_amp
l_int|0xfff
)paren
op_lshift
l_int|16
op_or
(paren
(paren
id|xsrc
op_minus
id|x
)paren
op_amp
l_int|0xfff
)paren
)paren
suffix:semicolon
r_else
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_FB_BLOCK_COLOR
comma
id|color
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RECTANGLE_ORIGIN
comma
(paren
id|y
op_lshift
l_int|16
)paren
op_or
id|x
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RECTANGLE_SIZE
comma
(paren
id|h
op_lshift
l_int|16
)paren
op_or
id|w
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_RENDER
comma
id|PM2F_RENDER_RECTANGLE
op_or
(paren
id|x
OL
id|xsrc
ques
c_cond
id|PM2F_INCREASE_X
suffix:colon
l_int|0
)paren
op_or
(paren
id|y
OL
id|ysrc
ques
c_cond
id|PM2F_INCREASE_Y
suffix:colon
l_int|0
)paren
op_or
(paren
id|copy
ques
c_cond
l_int|0
suffix:colon
id|PM2F_RENDER_FASTFILL
)paren
)paren
suffix:semicolon
id|wait_pm2
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************&n; * Begin of generic initialization functions&n; ***************************************************************************/
DECL|function|pm2fb_reset
r_static
r_void
id|pm2fb_reset
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|PM2_TYPE_PERMEDIA2V
)paren
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2VR_RD_INDEX_HIGH
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_RESET_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|pm2_RD
c_func
(paren
id|p
comma
id|PM2R_RESET_STATUS
)paren
op_amp
id|PM2F_BEING_RESET
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_PM2_FIFO_DISCONNECT
id|DPRINTK
c_func
(paren
l_string|&quot;FIFO disconnect enabled&bslash;n&quot;
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FIFO_DISCON
comma
l_int|1
)paren
suffix:semicolon
id|DEFRW
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|init
)paren
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|init
c_func
(paren
id|p
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|48
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_CHIP_CONFIG
comma
id|pm2_RD
c_func
(paren
id|p
comma
id|PM2R_CHIP_CONFIG
)paren
op_amp
op_complement
(paren
id|PM2F_VGA_ENABLE
op_or
id|PM2F_VGA_FIXED
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_BYPASS_WRITE_MASK
comma
op_complement
(paren
l_int|0L
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FRAMEBUFFER_WRITE_MASK
comma
op_complement
(paren
l_int|0L
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FIFO_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FILTER_MODE
comma
id|PM2F_SYNCHRONIZATION
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_APERTURE_ONE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_APERTURE_TWO
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LB_READ_FORMAT
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LB_WRITE_FORMAT
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LB_READ_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LB_SOURCE_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_SOURCE_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_PIXEL_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_WINDOW_ORIGIN
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_WINDOW_BASE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LB_WINDOW_BASE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_SOFT_WRITE_MASK
comma
op_complement
(paren
l_int|0L
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_HARD_WRITE_MASK
comma
op_complement
(paren
l_int|0L
)paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FB_READ_PIXEL
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_DITHER_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_AREA_STIPPLE_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_DEPTH_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_STENCIL_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_TEXTURE_ADDRESS_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_TEXTURE_READ_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_TEXEL_LUT_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_YUV_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_COLOR_DDA_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_TEXTURE_COLOR_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_FOG_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_ALPHA_BLEND_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_LOGICAL_OP_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_STATISTICS_MODE
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_SCISSOR_MODE
comma
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;type
)paren
(brace
r_case
id|PM2_TYPE_PERMEDIA2
suffix:colon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_MODE_CONTROL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* no overlay */
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_CURSOR_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_MISC_CONTROL
comma
id|PM2F_RD_PALETTE_WIDTH_8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2_TYPE_PERMEDIA2V
suffix:colon
id|pm2v_RDAC_WR
c_func
(paren
id|p
comma
id|PM2VI_RD_MISC_CONTROL
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 8bit */
r_break
suffix:semicolon
)brace
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_COLOR_KEY_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_OVERLAY_KEY
comma
l_int|0
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_RED_KEY
comma
l_int|0
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_GREEN_KEY
comma
l_int|0
)paren
suffix:semicolon
id|pm2_RDAC_WR
c_func
(paren
id|p
comma
id|PM2I_RD_BLUE_KEY
comma
l_int|0
)paren
suffix:semicolon
id|clear_palette
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;memclock
)paren
id|pm2_set_memclock
c_func
(paren
id|p
comma
id|p-&gt;memclock
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_conf
r_static
r_int
id|__init
(def_block
id|pm2fb_conf
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_for
c_loop
(paren
id|p-&gt;board
op_assign
l_int|0
suffix:semicolon
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|detect
op_logical_and
op_logical_neg
(paren
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|detect
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|p-&gt;board
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|detect
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no board found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;found board: %s&bslash;n&quot;
comma
id|board_table
(braket
id|p-&gt;board
)braket
dot
id|name
)paren
suffix:semicolon
id|p-&gt;regions.p_fb
op_assign
id|p-&gt;regions.fb_base
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|p-&gt;regions.p_fb
comma
id|p-&gt;regions.fb_size
comma
l_string|&quot;pm2fb&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;pm2fb: cannot reserve fb memory, abort&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|p-&gt;regions.v_fb
op_assign
id|MMAP
c_func
(paren
id|p-&gt;regions.p_fb
comma
id|p-&gt;regions.fb_size
)paren
suffix:semicolon
macro_line|#ifndef PM2FB_BE_APERTURE
id|p-&gt;regions.p_regs
op_assign
id|p-&gt;regions.rg_base
suffix:semicolon
macro_line|#else
id|p-&gt;regions.p_regs
op_assign
id|p-&gt;regions.rg_base
op_plus
id|PM2_REGS_SIZE
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|p-&gt;regions.p_regs
comma
id|PM2_REGS_SIZE
comma
l_string|&quot;pm2fb&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;pm2fb: cannot reserve mmio memory, abort&bslash;n&quot;
)paren
suffix:semicolon
id|UNMAP
c_func
(paren
id|p-&gt;regions.v_fb
comma
id|p-&gt;regions.fb_size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|p-&gt;regions.v_regs
op_assign
id|MMAP
c_func
(paren
id|p-&gt;regions.p_regs
comma
id|PM2_REGS_SIZE
)paren
suffix:semicolon
macro_line|#ifdef PM2FB_HW_CURSOR
id|p-&gt;cursor
op_assign
id|pm2_init_cursor
c_func
(paren
id|p
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
)def_block
multiline_comment|/***************************************************************************&n; * Begin of per-board initialization functions&n; ***************************************************************************/
multiline_comment|/*&n; * Phase5 CvisionPPC/BVisionPPC&n; */
macro_line|#ifdef CONFIG_FB_PM2_CVPPC
DECL|function|cvppc_PCI_init
r_static
r_int
id|cvppc_PCI_init
c_func
(paren
r_struct
id|cvppc_par
op_star
id|p
)paren
(brace
r_extern
id|u32
id|powerup_PCI_present
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|powerup_PCI_present
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no PCI bridge detected&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;pci_config
op_assign
id|MMAP
c_func
(paren
id|CVPPC_PCI_CONFIG
comma
l_int|256
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;unable to map PCI config region&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RD32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_VENDOR_ID
)paren
op_ne
(paren
(paren
id|PCI_DEVICE_ID_TI_TVP4020
op_lshift
l_int|16
)paren
op_or
id|PCI_VENDOR_ID_TI
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;bad vendorID/deviceID&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;pci_bridge
op_assign
id|MMAP
c_func
(paren
id|CSPPC_PCI_BRIDGE
comma
l_int|256
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;unable to map PCI bridge&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|WR32
c_func
(paren
id|p-&gt;pci_bridge
comma
id|CSPPC_BRIDGE_ENDIAN
comma
id|CSPPCF_BRIDGE_BIG_ENDIAN
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm2fb_options.flags
op_amp
id|OPTF_OLD_MEM
)paren
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_CACHE_LINE_SIZE
comma
l_int|0xff00
)paren
suffix:semicolon
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_BASE_ADDRESS_0
comma
id|CVPPC_REGS_REGION
)paren
suffix:semicolon
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_BASE_ADDRESS_1
comma
id|CVPPC_FB_APERTURE_ONE
)paren
suffix:semicolon
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_BASE_ADDRESS_2
comma
id|CVPPC_FB_APERTURE_TWO
)paren
suffix:semicolon
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_ROM_ADDRESS
comma
id|CVPPC_ROM_ADDRESS
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|WR32
c_func
(paren
id|p-&gt;pci_config
comma
id|PCI_COMMAND
comma
l_int|0xef000000
op_or
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|cvppc_detect
r_static
r_int
id|__init
id|cvppc_detect
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cvppc_PCI_init
c_func
(paren
op_amp
id|p-&gt;board_par.cvppc
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p-&gt;type
op_assign
id|PM2_TYPE_PERMEDIA2
suffix:semicolon
id|p-&gt;regions.fb_base
op_assign
id|CVPPC_FB_APERTURE_ONE
suffix:semicolon
id|p-&gt;regions.fb_size
op_assign
id|CVPPC_FB_SIZE
suffix:semicolon
id|p-&gt;regions.rg_base
op_assign
id|CVPPC_REGS_REGION
suffix:semicolon
id|p-&gt;memclock
op_assign
id|CVPPC_MEMCLOCK
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|cvppc_init
r_static
r_void
id|cvppc_init
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|3
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_MEM_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_BOOT_ADDRESS
comma
l_int|0x30
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm2fb_options.flags
op_amp
id|OPTF_OLD_MEM
)paren
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_MEM_CONFIG
comma
id|CVPPC_MEM_CONFIG_OLD
)paren
suffix:semicolon
r_else
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_MEM_CONFIG
comma
id|CVPPC_MEM_CONFIG_NEW
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_PM2_CVPPC */
multiline_comment|/*&n; * Generic PCI detection routines&n; */
macro_line|#ifdef CONFIG_FB_PM2_PCI
r_struct
(brace
DECL|member|vendor
DECL|member|device
r_int
r_int
id|vendor
comma
id|device
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|type
id|pm2type_t
id|type
suffix:semicolon
DECL|variable|__initdata
)brace
id|pm2pci_cards
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_TVP4020
comma
l_string|&quot;Texas Instruments TVP4020&quot;
comma
id|PM2_TYPE_PERMEDIA2
)brace
comma
(brace
id|PCI_VENDOR_ID_3DLABS
comma
id|PCI_DEVICE_ID_3DLABS_PERMEDIA2
comma
l_string|&quot;3dLabs Permedia 2&quot;
comma
id|PM2_TYPE_PERMEDIA2
)brace
comma
(brace
id|PCI_VENDOR_ID_3DLABS
comma
id|PCI_DEVICE_ID_3DLABS_PERMEDIA2V
comma
l_string|&quot;3dLabs Permedia 2v&quot;
comma
id|PM2_TYPE_PERMEDIA2V
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|pm2pci_detect
r_static
r_int
id|__init
id|pm2pci_detect
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_struct
id|pm2pci_par
op_star
id|pci
op_assign
op_amp
id|p-&gt;board_par.pci
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|m
suffix:semicolon
macro_line|#ifdef __sparc__
r_struct
id|pcidev_cookie
op_star
id|pcp
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|pci
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pm2pci_par
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no PCI bus found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;scanning PCI bus for known chipsets...&bslash;n&quot;
)paren
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|pm2pci_cards
(braket
id|i
)braket
dot
id|vendor
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pm2pci_cards
(braket
id|i
)braket
dot
id|vendor
op_eq
id|dev-&gt;vendor
op_logical_and
id|pm2pci_cards
(braket
id|i
)braket
dot
id|device
op_eq
id|dev-&gt;device
)paren
(brace
id|pci-&gt;dev
op_assign
id|dev
suffix:semicolon
id|p-&gt;type
op_assign
id|pm2pci_cards
(braket
id|i
)braket
dot
id|type
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;... found %s&bslash;n&quot;
comma
id|pm2pci_cards
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci-&gt;dev
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pci-&gt;dev
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no PCI board found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;PCI board @%08lx %08lx %08lx rom %08lx&bslash;n&quot;
comma
id|pci-&gt;dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
id|pci-&gt;dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
comma
id|pci-&gt;dev-&gt;resource
(braket
l_int|2
)braket
dot
id|start
comma
id|pci-&gt;dev-&gt;resource
(braket
id|PCI_ROM_RESOURCE
)braket
dot
id|start
)paren
suffix:semicolon
macro_line|#ifdef __sparc__
id|p-&gt;regions.rg_base
op_assign
id|pci-&gt;dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|p-&gt;regions.fb_base
op_assign
id|pci-&gt;dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
id|pcp
op_assign
id|pci-&gt;dev-&gt;sysdata
suffix:semicolon
multiline_comment|/* If the user has not asked for a particular mode, lets guess */
r_if
c_cond
(paren
id|pcp-&gt;prom_node
op_logical_and
op_logical_neg
(paren
id|pm2fb_options.flags
op_amp
id|OPTF_USER
)paren
)paren
(brace
r_char
id|timing
(braket
l_int|256
)braket
comma
op_star
id|q
comma
op_star
id|r
suffix:semicolon
r_int
r_int
id|w
comma
id|h
suffix:semicolon
r_int
id|i
suffix:semicolon
id|prom_getstring
c_func
(paren
id|pcp-&gt;prom_node
comma
l_string|&quot;timing-numbers&quot;
comma
id|timing
comma
l_int|256
)paren
suffix:semicolon
multiline_comment|/* FIXME: Find out what the actual pixclock is and other values as well */
r_if
c_cond
(paren
id|timing
(braket
l_int|0
)braket
)paren
(brace
id|w
op_assign
id|simple_strtoul
c_func
(paren
id|timing
comma
op_amp
id|q
comma
l_int|0
)paren
suffix:semicolon
id|h
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
id|timing
)paren
id|w
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|w
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|r
op_assign
id|q
suffix:semicolon
op_star
id|r
op_logical_and
(paren
op_star
id|r
template_param
l_char|&squot;9&squot;
)paren
suffix:semicolon
id|r
op_increment
)paren
suffix:semicolon
id|simple_strtoul
c_func
(paren
id|r
comma
op_amp
id|q
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
id|q
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|3
)paren
id|w
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w
)paren
(brace
r_for
c_loop
(paren
id|r
op_assign
id|q
suffix:semicolon
op_star
id|r
op_logical_and
(paren
op_star
id|r
template_param
l_char|&squot;9&squot;
)paren
suffix:semicolon
id|r
op_increment
)paren
suffix:semicolon
id|h
op_assign
id|simple_strtoul
c_func
(paren
id|r
comma
op_amp
id|q
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
id|q
)paren
id|w
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w
op_eq
l_int|640
op_logical_and
id|h
op_eq
l_int|480
)paren
id|w
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|w
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|user_mode
(braket
id|i
)braket
dot
id|name
(braket
l_int|0
)braket
op_logical_and
(paren
id|w
op_ne
id|user_mode
(braket
id|i
)braket
dot
id|par.width
op_logical_or
id|h
op_ne
id|user_mode
(braket
id|i
)braket
dot
id|par.height
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
(braket
id|i
)braket
dot
id|name
(braket
l_int|0
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|p-&gt;current_par
comma
op_amp
id|user_mode
(braket
id|i
)braket
dot
id|par
comma
r_sizeof
(paren
id|user_mode
(braket
id|i
)braket
dot
id|par
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
r_if
c_cond
(paren
id|pm2fb_options.flags
op_amp
id|OPTF_VIRTUAL
)paren
(brace
id|p-&gt;regions.rg_base
op_assign
id|__pa
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci-&gt;dev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|p-&gt;regions.fb_base
op_assign
id|__pa
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci-&gt;dev
comma
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;regions.rg_base
op_assign
id|pci_resource_start
c_func
(paren
id|pci-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
id|p-&gt;regions.fb_base
op_assign
id|pci_resource_start
c_func
(paren
id|pci-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef PM2FB_BE_APERTURE
id|p-&gt;regions.rg_base
op_add_assign
id|PM2_REGS_SIZE
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|m
op_assign
id|MMAP
c_func
(paren
id|p-&gt;regions.rg_base
comma
id|PM2_REGS_SIZE
)paren
)paren
)paren
(brace
id|pci-&gt;mem_control
op_assign
id|RD32
c_func
(paren
id|m
comma
id|PM2R_MEM_CONTROL
)paren
suffix:semicolon
id|pci-&gt;boot_address
op_assign
id|RD32
c_func
(paren
id|m
comma
id|PM2R_BOOT_ADDRESS
)paren
suffix:semicolon
id|pci-&gt;mem_config
op_assign
id|RD32
c_func
(paren
id|m
comma
id|PM2R_MEM_CONFIG
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pci-&gt;mem_config
op_amp
id|PM2F_MEM_CONFIG_RAM_MASK
)paren
(brace
r_case
id|PM2F_MEM_BANKS_1
suffix:colon
id|p-&gt;regions.fb_size
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2F_MEM_BANKS_2
suffix:colon
id|p-&gt;regions.fb_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2F_MEM_BANKS_3
suffix:colon
id|p-&gt;regions.fb_size
op_assign
l_int|0x600000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM2F_MEM_BANKS_4
suffix:colon
id|p-&gt;regions.fb_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p-&gt;memclock
op_assign
id|CVPPC_MEMCLOCK
suffix:semicolon
id|UNMAP
c_func
(paren
id|m
comma
id|PM2_REGS_SIZE
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;MMAP() failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pm2pci_init
r_static
r_void
id|pm2pci_init
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|p
)paren
(brace
r_struct
id|pm2pci_par
op_star
id|pci
op_assign
op_amp
id|p-&gt;board_par.pci
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|p
comma
l_int|3
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_MEM_CONTROL
comma
id|pci-&gt;mem_control
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_BOOT_ADDRESS
comma
id|pci-&gt;boot_address
)paren
suffix:semicolon
id|DEFW
c_func
(paren
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|p
comma
id|PM2R_MEM_CONFIG
comma
id|pci-&gt;mem_config
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_PM2_PCI */
multiline_comment|/***************************************************************************&n; * Console hw acceleration&n; ***************************************************************************/
DECL|function|pm2fb_blank
r_static
r_int
id|pm2fb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|video
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i-&gt;current_par_valid
)paren
r_return
l_int|1
suffix:semicolon
id|video
op_assign
id|i-&gt;current_par.video
suffix:semicolon
r_if
c_cond
(paren
id|blank_mode
OG
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|blank_mode
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
multiline_comment|/* FIXME */
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM2F_VIDEO_ENABLE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM2F_HSYNC_MASK
op_or
id|PM2F_BLANK_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM2F_VSYNC_MASK
op_or
id|PM2F_BLANK_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM2F_VSYNC_MASK
op_or
id|PM2F_HSYNC_MASK
op_or
id|PM2F_BLANK_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_VIDEO_CONTROL
comma
id|video
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pm2fb_pan_display
r_static
r_int
id|pm2fb_pan_display
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i-&gt;current_par_valid
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|i-&gt;current_par.base
op_assign
id|to3264
c_func
(paren
id|var-&gt;yoffset
op_star
id|i-&gt;current_par.width
op_plus
id|var-&gt;xoffset
comma
id|i-&gt;current_par.depth
comma
l_int|1
)paren
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCREEN_BASE
comma
id|i-&gt;current_par.base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pm2fb_pp_bmove
r_static
r_void
id|pm2fb_pp_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
(brace
id|sx
op_assign
id|sx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_assign
id|dx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_assign
id|dx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dy
op_assign
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|pm2fb_pp_copy
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
id|sx
comma
id|sy
comma
id|dx
comma
id|dy
comma
id|width
comma
id|height
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_bmove
r_static
r_void
id|pm2fb_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
(brace
id|sx
op_assign
id|sx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_assign
id|dx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_assign
id|dx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dy
op_assign
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|1
comma
id|sx
comma
id|sy
comma
id|dx
comma
id|dy
comma
id|width
comma
id|height
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|pm2fb_clear8
r_static
r_void
id|pm2fb_clear8
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u32
id|c
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|8
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
id|sy
comma
id|width
comma
id|height
comma
id|c
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_clear_margins8
r_static
r_void
id|pm2fb_clear_margins8
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
id|u32
id|c
suffix:semicolon
id|u32
id|sx
suffix:semicolon
id|u32
id|sy
suffix:semicolon
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|8
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
l_int|0
comma
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
comma
id|p-&gt;var.yres_virtual
comma
id|c
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;var.yoffset
op_plus
id|sy
comma
id|sx
comma
id|p-&gt;var.yres
op_minus
id|sy
comma
id|c
)paren
suffix:semicolon
)brace
DECL|variable|pm2_cfb8
r_static
r_struct
id|display_switch
id|pm2_cfb8
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb8_setup
comma
id|bmove
suffix:colon
id|pm2fb_pp_bmove
comma
macro_line|#ifdef __alpha__
multiline_comment|/* Not sure why, but this works and the other does not. */
multiline_comment|/* Also, perhaps we need a separate routine to wait for the&n;&t;   blitter to stop before doing this? */
multiline_comment|/* In addition, maybe we need to do this for 16 and 32 bit depths? */
id|clear
suffix:colon
id|fbcon_cfb8_clear
comma
macro_line|#else
id|clear
suffix:colon
id|pm2fb_clear8
comma
macro_line|#endif
id|putc
suffix:colon
id|fbcon_cfb8_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb8_putcs
comma
id|revc
suffix:colon
id|fbcon_cfb8_revc
comma
id|cursor
suffix:colon
id|pm2fb_cursor
comma
id|set_font
suffix:colon
id|pm2fb_set_font
comma
id|clear_margins
suffix:colon
id|pm2fb_clear_margins8
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB8 */
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|pm2fb_clear16
r_static
r_void
id|pm2fb_clear16
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u32
id|c
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
id|sy
comma
id|width
comma
id|height
comma
id|c
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_clear_margins16
r_static
r_void
id|pm2fb_clear_margins16
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
id|u32
id|c
suffix:semicolon
id|u32
id|sx
suffix:semicolon
id|u32
id|sy
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
l_int|0
comma
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
comma
id|p-&gt;var.yres_virtual
comma
id|c
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;var.yoffset
op_plus
id|sy
comma
id|sx
comma
id|p-&gt;var.yres
op_minus
id|sy
comma
id|c
)paren
suffix:semicolon
)brace
DECL|variable|pm2_cfb16
r_static
r_struct
id|display_switch
id|pm2_cfb16
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb16_setup
comma
id|bmove
suffix:colon
id|pm2fb_pp_bmove
comma
id|clear
suffix:colon
id|pm2fb_clear16
comma
id|putc
suffix:colon
id|fbcon_cfb16_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb16_putcs
comma
id|revc
suffix:colon
id|fbcon_cfb16_revc
comma
id|cursor
suffix:colon
id|pm2fb_cursor
comma
id|set_font
suffix:colon
id|pm2fb_set_font
comma
id|clear_margins
suffix:colon
id|pm2fb_clear_margins16
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB16 */
macro_line|#ifdef FBCON_HAS_CFB24
multiline_comment|/*&n; * fast fill for 24bpp works only when red==green==blue&n; */
DECL|function|pm2fb_clear24
r_static
r_void
id|pm2fb_clear24
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;palette
(braket
id|c
)braket
dot
id|red
op_eq
id|i-&gt;palette
(braket
id|c
)braket
dot
id|green
op_logical_and
id|i-&gt;palette
(braket
id|c
)braket
dot
id|green
op_eq
id|i-&gt;palette
(braket
id|c
)braket
dot
id|blue
)paren
(brace
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|c
)braket
suffix:semicolon
id|c
op_or_assign
(paren
id|c
op_amp
l_int|0xff0000
)paren
op_lshift
l_int|8
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
id|sy
comma
id|width
comma
id|height
comma
id|c
)paren
suffix:semicolon
)brace
r_else
id|fbcon_cfb24_clear
c_func
(paren
id|conp
comma
id|p
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_clear_margins24
r_static
r_void
id|pm2fb_clear_margins24
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|u32
id|sx
suffix:semicolon
id|u32
id|sy
suffix:semicolon
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;palette
(braket
id|c
)braket
dot
id|red
op_eq
id|i-&gt;palette
(braket
id|c
)braket
dot
id|green
op_logical_and
id|i-&gt;palette
(braket
id|c
)braket
dot
id|green
op_eq
id|i-&gt;palette
(braket
id|c
)braket
dot
id|blue
)paren
(brace
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|c
)braket
suffix:semicolon
id|c
op_or_assign
(paren
id|c
op_amp
l_int|0xff0000
)paren
op_lshift
l_int|8
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
id|pm2fb_block_op
c_func
(paren
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
l_int|0
comma
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
comma
id|p-&gt;var.yres_virtual
comma
id|c
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;var.yoffset
op_plus
id|sy
comma
id|sx
comma
id|p-&gt;var.yres
op_minus
id|sy
comma
id|c
)paren
suffix:semicolon
)brace
r_else
id|fbcon_cfb24_clear_margins
c_func
(paren
id|conp
comma
id|p
comma
id|bottom_only
)paren
suffix:semicolon
)brace
DECL|variable|pm2_cfb24
r_static
r_struct
id|display_switch
id|pm2_cfb24
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb24_setup
comma
id|bmove
suffix:colon
id|pm2fb_bmove
comma
id|clear
suffix:colon
id|pm2fb_clear24
comma
id|putc
suffix:colon
id|fbcon_cfb24_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb24_putcs
comma
id|revc
suffix:colon
id|fbcon_cfb24_revc
comma
id|cursor
suffix:colon
id|pm2fb_cursor
comma
id|set_font
suffix:colon
id|pm2fb_set_font
comma
id|clear_margins
suffix:colon
id|pm2fb_clear_margins24
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB24 */
macro_line|#ifdef FBCON_HAS_CFB32
DECL|function|pm2fb_clear32
r_static
r_void
id|pm2fb_clear32
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u32
id|c
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
id|sy
comma
id|width
comma
id|height
comma
id|c
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_clear_margins32
r_static
r_void
id|pm2fb_clear_margins32
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
id|u32
id|c
suffix:semicolon
id|u32
id|sx
suffix:semicolon
id|u32
id|sy
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|sx
comma
l_int|0
comma
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
comma
id|p-&gt;var.yres_virtual
comma
id|c
)paren
suffix:semicolon
id|pm2fb_block_op
c_func
(paren
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;var.yoffset
op_plus
id|sy
comma
id|sx
comma
id|p-&gt;var.yres
op_minus
id|sy
comma
id|c
)paren
suffix:semicolon
)brace
DECL|variable|pm2_cfb32
r_static
r_struct
id|display_switch
id|pm2_cfb32
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb32_setup
comma
id|bmove
suffix:colon
id|pm2fb_bmove
comma
id|clear
suffix:colon
id|pm2fb_clear32
comma
id|putc
suffix:colon
id|fbcon_cfb32_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb32_putcs
comma
id|revc
suffix:colon
id|fbcon_cfb32_revc
comma
id|cursor
suffix:colon
id|pm2fb_cursor
comma
id|set_font
suffix:colon
id|pm2fb_set_font
comma
id|clear_margins
suffix:colon
id|pm2fb_clear_margins32
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB32 */
multiline_comment|/***************************************************************************&n; * Framebuffer functions&n; ***************************************************************************/
DECL|function|pm2fb_detect
r_static
r_void
id|pm2fb_detect
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|pm2fb_encode_fix
r_static
r_int
id|pm2fb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm2fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|permedia2_name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|i-&gt;regions.p_fb
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|i-&gt;regions.fb_size
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|i-&gt;regions.p_regs
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|PM2_REGS_SIZE
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_3DLABS_PERMEDIA2
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;visual
op_assign
id|p-&gt;depth
op_eq
l_int|8
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;current_par_valid
)paren
id|fix-&gt;line_length
op_assign
id|i-&gt;current_par.width
op_star
(paren
id|i-&gt;current_par.depth
op_div
l_int|8
)paren
suffix:semicolon
r_else
id|fix-&gt;line_length
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
id|p-&gt;depth
op_eq
l_int|24
ques
c_cond
l_int|8
suffix:colon
l_int|64
op_div
id|p-&gt;depth
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef PM2FB_MASTER_DEBUG
DECL|function|pm2fb_display_var
r_static
r_void
id|pm2fb_display_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;- struct fb_var_screeninfo ---------------------------------------------------&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;resolution: %ux%ux%u (virtual %ux%u+%u+%u)&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;yres_virtual
comma
id|var-&gt;xoffset
comma
id|var-&gt;yoffset
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;color: %c%c &quot;
l_string|&quot;R(%u,%u,%u), G(%u,%u,%u), B(%u,%u,%u), T(%u,%u,%u)&bslash;n&quot;
comma
id|var-&gt;grayscale
ques
c_cond
l_char|&squot;G&squot;
suffix:colon
l_char|&squot;C&squot;
comma
id|var-&gt;nonstd
ques
c_cond
l_char|&squot;N&squot;
suffix:colon
l_char|&squot;S&squot;
comma
id|var-&gt;red.offset
comma
id|var-&gt;red.length
comma
id|var-&gt;red.msb_right
comma
id|var-&gt;green.offset
comma
id|var-&gt;green.length
comma
id|var-&gt;green.msb_right
comma
id|var-&gt;blue.offset
comma
id|var-&gt;blue.length
comma
id|var-&gt;blue.msb_right
comma
id|var-&gt;transp.offset
comma
id|var-&gt;transp.length
comma
id|var-&gt;transp.msb_right
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;timings: %ups (%u,%u)-(%u,%u)+%u+%u&bslash;n&quot;
comma
id|var-&gt;pixclock
comma
id|var-&gt;left_margin
comma
id|var-&gt;upper_margin
comma
id|var-&gt;right_margin
comma
id|var-&gt;lower_margin
comma
id|var-&gt;hsync_len
comma
id|var-&gt;vsync_len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;activate %08x accel_flags %08x sync %08x vmode %08x&bslash;n&quot;
comma
id|var-&gt;activate
comma
id|var-&gt;accel_flags
comma
id|var-&gt;sync
comma
id|var-&gt;vmode
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;------------------------------------------------------------------------------&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|macro|pm2fb_decode_var
mdefine_line|#define pm2fb_decode_var pm2fb_wrapped_decode_var
macro_line|#endif
DECL|function|pm2fb_decode_var
r_static
r_int
id|pm2fb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm2fb_par
id|p
suffix:semicolon
id|u32
id|xres
suffix:semicolon
r_int
id|data64
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|p
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pm2fb_par
)paren
)paren
suffix:semicolon
id|p.width
op_assign
(paren
id|var-&gt;xres_virtual
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|p.height
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
id|p.depth
op_assign
(paren
id|var-&gt;bits_per_pixel
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|p.depth
op_assign
id|p.depth
OG
l_int|32
ques
c_cond
l_int|32
suffix:colon
id|p.depth
suffix:semicolon
id|data64
op_assign
id|p.depth
OG
l_int|8
op_logical_or
id|i-&gt;type
op_eq
id|PM2_TYPE_PERMEDIA2V
suffix:semicolon
id|xres
op_assign
(paren
id|var-&gt;xres
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
suffix:semicolon
r_if
c_cond
(paren
id|p.width
OL
id|xres
op_plus
id|var-&gt;xoffset
)paren
id|p.width
op_assign
id|xres
op_plus
id|var-&gt;xoffset
suffix:semicolon
r_if
c_cond
(paren
id|p.height
OL
id|var-&gt;yres
op_plus
id|var-&gt;yoffset
)paren
id|p.height
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|partprod
c_func
(paren
id|xres
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;width not supported: %u&bslash;n&quot;
comma
id|xres
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.width
OG
l_int|2047
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;virtual width not supported: %u&bslash;n&quot;
comma
id|p.width
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres
OL
l_int|200
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;height not supported: %u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|var-&gt;yres
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.height
l_int|2047
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;virtual height not supported: %u&bslash;n&quot;
comma
id|p.height
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.depth
OG
l_int|32
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;depth not supported: %u&bslash;n&quot;
comma
id|p.depth
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.width
op_star
id|p.height
op_star
id|p.depth
op_div
l_int|8
OG
id|i-&gt;regions.fb_size
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no memory for screen (%ux%ux%u)&bslash;n&quot;
comma
id|p.width
comma
id|p.height
comma
id|p.depth
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|p.pixclock
op_assign
id|PICOS2KHZ
c_func
(paren
id|var-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p.pixclock
OG
id|PM2_MAX_PIXCLOCK
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;pixclock too high (%uKHz)&bslash;n&quot;
comma
id|p.pixclock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|p.hsstart
op_assign
id|to3264
c_func
(paren
id|var-&gt;right_margin
comma
id|p.depth
comma
id|data64
)paren
suffix:semicolon
id|p.hsend
op_assign
id|p.hsstart
op_plus
id|to3264
c_func
(paren
id|var-&gt;hsync_len
comma
id|p.depth
comma
id|data64
)paren
suffix:semicolon
id|p.hbend
op_assign
id|p.hsend
op_plus
id|to3264
c_func
(paren
id|var-&gt;left_margin
comma
id|p.depth
comma
id|data64
)paren
suffix:semicolon
id|p.htotal
op_assign
id|to3264
c_func
(paren
id|xres
comma
id|p.depth
comma
id|data64
)paren
op_plus
id|p.hbend
op_minus
l_int|1
suffix:semicolon
id|p.vsstart
op_assign
id|var-&gt;lower_margin
ques
c_cond
id|var-&gt;lower_margin
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* FIXME! */
id|p.vsend
op_assign
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_minus
l_int|1
suffix:semicolon
id|p.vbend
op_assign
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
suffix:semicolon
id|p.vtotal
op_assign
id|var-&gt;yres
op_plus
id|p.vbend
op_minus
l_int|1
suffix:semicolon
id|p.stride
op_assign
id|to3264
c_func
(paren
id|p.width
comma
id|p.depth
comma
l_int|1
)paren
suffix:semicolon
id|p.base
op_assign
id|to3264
c_func
(paren
id|var-&gt;yoffset
op_star
id|xres
op_plus
id|var-&gt;xoffset
comma
id|p.depth
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data64
)paren
id|p.video
op_or_assign
id|PM2F_DATA_64_ENABLE
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|p.video
op_or_assign
id|PM2F_HSYNC_ACT_HIGH
suffix:semicolon
r_else
id|p.video
op_or_assign
id|PM2F_HSYNC_ACT_LOW
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|p.video
op_or_assign
id|PM2F_VSYNC_ACT_HIGH
suffix:semicolon
r_else
id|p.video
op_or_assign
id|PM2F_VSYNC_ACT_LOW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;interlaced not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
id|p.video
op_or_assign
id|PM2F_LINE_DOUBLE
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;activate
op_eq
id|FB_ACTIVATE_NOW
)paren
id|p.video
op_or_assign
id|PM2F_VIDEO_ENABLE
suffix:semicolon
op_star
(paren
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
)paren
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef PM2FB_MASTER_DEBUG
DECL|macro|pm2fb_decode_var
macro_line|#undef pm2fb_decode_var
DECL|function|pm2fb_decode_var
r_static
r_int
id|pm2fb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|pm2fb_wrapped_decode_var
c_func
(paren
id|var
comma
id|par
comma
id|info
)paren
suffix:semicolon
id|pm2fb_display_var
c_func
(paren
id|var
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
macro_line|#endif
DECL|function|pm2fb_encode_var
r_static
r_int
id|pm2fb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|v
suffix:semicolon
id|u32
id|base
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|v
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
id|v.xres_virtual
op_assign
id|p-&gt;width
suffix:semicolon
id|v.yres_virtual
op_assign
id|p-&gt;height
suffix:semicolon
id|v.xres
op_assign
(paren
id|p-&gt;htotal
op_plus
l_int|1
)paren
op_minus
id|p-&gt;hbend
suffix:semicolon
id|v.yres
op_assign
(paren
id|p-&gt;vtotal
op_plus
l_int|1
)paren
op_minus
id|p-&gt;vbend
suffix:semicolon
id|v.right_margin
op_assign
id|p-&gt;hsstart
suffix:semicolon
id|v.hsync_len
op_assign
id|p-&gt;hsend
op_minus
id|p-&gt;hsstart
suffix:semicolon
id|v.left_margin
op_assign
id|p-&gt;hbend
op_minus
id|p-&gt;hsend
suffix:semicolon
id|v.lower_margin
op_assign
id|p-&gt;vsstart
op_plus
l_int|1
suffix:semicolon
id|v.vsync_len
op_assign
id|p-&gt;vsend
op_minus
id|v.lower_margin
op_plus
l_int|1
suffix:semicolon
id|v.upper_margin
op_assign
id|p-&gt;vbend
op_minus
id|v.lower_margin
op_minus
id|v.vsync_len
suffix:semicolon
id|v.bits_per_pixel
op_assign
id|p-&gt;depth
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;video
op_amp
id|PM2F_DATA_64_ENABLE
)paren
(brace
id|v.xres
op_assign
id|v.xres
op_lshift
l_int|1
suffix:semicolon
id|v.right_margin
op_assign
id|v.right_margin
op_lshift
l_int|1
suffix:semicolon
id|v.hsync_len
op_assign
id|v.hsync_len
op_lshift
l_int|1
suffix:semicolon
id|v.left_margin
op_assign
id|v.left_margin
op_lshift
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|p-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
id|v.xres
op_assign
id|v.xres
op_lshift
l_int|2
suffix:semicolon
id|v.right_margin
op_assign
id|v.right_margin
op_lshift
l_int|2
suffix:semicolon
id|v.hsync_len
op_assign
id|v.hsync_len
op_lshift
l_int|2
suffix:semicolon
id|v.left_margin
op_assign
id|v.left_margin
op_lshift
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|v.red.offset
op_assign
l_int|11
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|6
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
id|v.xres
op_assign
id|v.xres
op_lshift
l_int|1
suffix:semicolon
id|v.right_margin
op_assign
id|v.right_margin
op_lshift
l_int|1
suffix:semicolon
id|v.hsync_len
op_assign
id|v.hsync_len
op_lshift
l_int|1
suffix:semicolon
id|v.left_margin
op_assign
id|v.left_margin
op_lshift
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|v.transp.offset
op_assign
l_int|24
suffix:semicolon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
id|v.transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|v.blue.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
id|v.xres
op_assign
(paren
id|v.xres
op_lshift
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
id|v.right_margin
op_assign
(paren
id|v.right_margin
op_lshift
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
id|v.hsync_len
op_assign
(paren
id|v.hsync_len
op_lshift
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
id|v.left_margin
op_assign
(paren
id|v.left_margin
op_lshift
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
)brace
id|base
op_assign
id|from3264
c_func
(paren
id|p-&gt;base
comma
id|p-&gt;depth
comma
l_int|1
)paren
suffix:semicolon
id|v.xoffset
op_assign
id|base
op_mod
id|v.xres
suffix:semicolon
id|v.yoffset
op_assign
id|base
op_div
id|v.xres
suffix:semicolon
id|v.height
op_assign
id|v.width
op_assign
op_minus
l_int|1
suffix:semicolon
id|v.pixclock
op_assign
id|KHZ2PICOS
c_func
(paren
id|p-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_HSYNC_MASK
)paren
op_eq
id|PM2F_HSYNC_ACT_HIGH
)paren
id|v.sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM2F_VSYNC_MASK
)paren
op_eq
id|PM2F_VSYNC_ACT_HIGH
)paren
id|v.sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;video
op_amp
id|PM2F_LINE_DOUBLE
)paren
id|v.vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
op_star
id|var
op_assign
id|v
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_user_mode
r_static
r_void
id|set_user_mode
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|i
)paren
(brace
r_if
c_cond
(paren
id|pm2fb_options.flags
op_amp
id|OPTF_YPAN
)paren
(brace
r_int
id|h
op_assign
id|i-&gt;current_par.height
suffix:semicolon
id|i-&gt;current_par.height
op_assign
id|i-&gt;regions.fb_size
op_div
(paren
id|i-&gt;current_par.width
op_star
id|i-&gt;current_par.depth
op_div
l_int|8
)paren
suffix:semicolon
id|i-&gt;current_par.height
op_assign
id|MIN
c_func
(paren
id|i-&gt;current_par.height
comma
l_int|2047
)paren
suffix:semicolon
id|i-&gt;current_par.height
op_assign
id|MAX
c_func
(paren
id|i-&gt;current_par.height
comma
id|h
)paren
suffix:semicolon
)brace
)brace
DECL|function|pm2fb_get_par
r_static
r_void
id|pm2fb_get_par
c_func
(paren
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i-&gt;current_par_valid
)paren
(brace
id|set_user_mode
c_func
(paren
id|i
)paren
suffix:semicolon
id|pm2fb_reset
c_func
(paren
id|i
)paren
suffix:semicolon
id|set_screen
c_func
(paren
id|i
comma
op_amp
id|i-&gt;current_par
)paren
suffix:semicolon
id|i-&gt;current_par_valid
op_assign
l_int|1
suffix:semicolon
)brace
op_star
(paren
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
)paren
op_assign
id|i-&gt;current_par
suffix:semicolon
)brace
DECL|function|pm2fb_set_par
r_static
r_void
id|pm2fb_set_par
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm2fb_par
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;current_par_valid
)paren
(brace
id|i-&gt;current_par.base
op_assign
id|p-&gt;base
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|p
comma
op_amp
id|i-&gt;current_par
comma
r_sizeof
(paren
r_struct
id|pm2fb_par
)paren
)paren
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|i
comma
id|PM2R_SCREEN_BASE
comma
id|p-&gt;base
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|set_screen
c_func
(paren
id|i
comma
id|p
)paren
suffix:semicolon
id|i-&gt;current_par
op_assign
op_star
id|p
suffix:semicolon
id|i-&gt;current_par_valid
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef PM2FB_HW_CURSOR&t;
r_if
c_cond
(paren
id|i-&gt;cursor
)paren
(brace
id|pm2v_set_cursor_color
c_func
(paren
id|i
comma
id|cursor_color_map
comma
id|cursor_color_map
comma
id|cursor_color_map
)paren
suffix:semicolon
id|pm2v_set_cursor_shape
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|pm2fb_getcolreg
r_static
r_int
id|pm2fb_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
op_star
id|red
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|transp
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|transp
suffix:semicolon
)brace
r_return
id|regno
OG
l_int|255
suffix:semicolon
)brace
DECL|function|pm2fb_setcolreg
r_static
r_int
id|pm2fb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|i-&gt;current_par.depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|i-&gt;cmap.cmap16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xf800
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|i-&gt;cmap.cmap24
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xff00
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|i-&gt;cmap.cmap32
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|transp
op_amp
l_int|0xff00
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;bad depth %u&bslash;n&quot;
comma
id|i-&gt;current_par.depth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
op_rshift
l_int|8
suffix:semicolon
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
op_rshift
l_int|8
suffix:semicolon
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
op_rshift
l_int|8
suffix:semicolon
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|transp
op_assign
id|transp
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;current_par.depth
op_eq
l_int|8
)paren
id|set_color
c_func
(paren
id|i
comma
id|regno
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|regno
OG
l_int|255
suffix:semicolon
)brace
DECL|function|pm2fb_set_disp
r_static
r_void
id|pm2fb_set_disp
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|info
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|depth
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|disp-&gt;screen_base
op_assign
id|i-&gt;regions.v_fb
suffix:semicolon
r_switch
c_cond
(paren
id|depth
op_assign
(paren
(paren
r_struct
id|pm2fb_par
op_star
)paren
id|par
)paren
op_member_access_from_pointer
id|depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|pm2_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|pm2_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|i-&gt;cmap.cmap16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|pm2_cfb24
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|i-&gt;cmap.cmap24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|pm2_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|i-&gt;cmap.cmap32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef PM2FB_HW_CURSOR
multiline_comment|/***************************************************************************&n; * Hardware cursor support&n; ***************************************************************************/
DECL|variable|cursor_bits_lookup
r_static
id|u8
id|cursor_bits_lookup
(braket
l_int|16
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x40
comma
l_int|0x10
comma
l_int|0x50
comma
l_int|0x04
comma
l_int|0x44
comma
l_int|0x14
comma
l_int|0x54
comma
l_int|0x01
comma
l_int|0x41
comma
l_int|0x11
comma
l_int|0x51
comma
l_int|0x05
comma
l_int|0x45
comma
l_int|0x15
comma
l_int|0x55
)brace
suffix:semicolon
DECL|variable|cursor_mask_lookup
r_static
id|u8
id|cursor_mask_lookup
(braket
l_int|16
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x80
comma
l_int|0x20
comma
l_int|0xa0
comma
l_int|0x08
comma
l_int|0x88
comma
l_int|0x28
comma
l_int|0xa8
comma
l_int|0x02
comma
l_int|0x82
comma
l_int|0x22
comma
l_int|0xa2
comma
l_int|0x0a
comma
l_int|0x8a
comma
l_int|0x2a
comma
l_int|0xaa
)brace
suffix:semicolon
DECL|function|pm2v_set_cursor_color
r_static
r_void
id|pm2v_set_cursor_color
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
)paren
(brace
r_struct
id|pm2_cursor
op_star
id|c
op_assign
id|fb-&gt;cursor
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c-&gt;color
(braket
l_int|3
op_star
id|i
)braket
op_assign
id|red
(braket
id|i
)braket
suffix:semicolon
id|c-&gt;color
(braket
l_int|3
op_star
id|i
op_plus
l_int|1
)braket
op_assign
id|green
(braket
id|i
)braket
suffix:semicolon
id|c-&gt;color
(braket
l_int|3
op_star
id|i
op_plus
l_int|2
)braket
op_assign
id|blue
(braket
id|i
)braket
suffix:semicolon
)brace
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|14
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|fb
comma
id|PM2VR_RD_INDEX_HIGH
comma
id|PM2VI_RD_CURSOR_PALETTE
op_rshift
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PALETTE
op_plus
id|i
comma
id|c-&gt;color
(braket
id|i
)braket
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|fb
comma
id|PM2VR_RD_INDEX_HIGH
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm2v_set_cursor_shape
r_static
r_void
id|pm2v_set_cursor_shape
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
)paren
(brace
r_struct
id|pm2_cursor
op_star
id|c
op_assign
id|fb-&gt;cursor
suffix:semicolon
id|u8
id|m
comma
id|b
suffix:semicolon
r_int
id|i
comma
id|x
comma
id|y
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|fb
comma
id|PM2VR_RD_INDEX_HIGH
comma
id|PM2VI_RD_CURSOR_PATTERN
op_rshift
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|y
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|y
OL
id|c-&gt;size.y
suffix:semicolon
id|y
op_increment
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|32
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|c-&gt;size.x
op_rshift
l_int|3
suffix:semicolon
id|x
op_increment
)paren
(brace
id|m
op_assign
id|c-&gt;mask
(braket
id|x
)braket
(braket
id|y
)braket
suffix:semicolon
id|b
op_assign
id|c-&gt;bits
(braket
id|x
)braket
(braket
id|y
)braket
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
comma
id|cursor_mask_lookup
(braket
id|m
op_rshift
l_int|4
)braket
op_or
id|cursor_bits_lookup
(braket
(paren
id|b
op_amp
id|m
)paren
op_rshift
l_int|4
)braket
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
op_plus
l_int|1
comma
id|cursor_mask_lookup
(braket
id|m
op_amp
l_int|0x0f
)braket
op_or
id|cursor_bits_lookup
(braket
(paren
id|b
op_amp
id|m
)paren
op_amp
l_int|0x0f
)braket
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|x
OL
l_int|8
suffix:semicolon
id|x
op_increment
)paren
(brace
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
id|y
OL
l_int|64
suffix:semicolon
id|y
op_increment
)paren
(brace
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|32
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
l_int|8
suffix:semicolon
id|x
op_increment
)paren
(brace
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_PATTERN
op_plus
id|i
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|1
)paren
suffix:semicolon
id|pm2_WR
c_func
(paren
id|fb
comma
id|PM2VR_RD_INDEX_HIGH
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm2v_set_cursor
r_static
r_void
id|pm2v_set_cursor
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
comma
r_int
id|on
)paren
(brace
r_struct
id|pm2_cursor
op_star
id|c
op_assign
id|fb-&gt;cursor
suffix:semicolon
r_int
id|x
op_assign
id|c-&gt;pos.x
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|on
)paren
id|x
op_assign
l_int|4000
suffix:semicolon
id|WAIT_FIFO
c_func
(paren
id|fb
comma
l_int|14
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_X_LOW
comma
id|x
op_amp
l_int|0xff
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_X_HIGH
comma
(paren
id|x
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_Y_LOW
comma
id|c-&gt;pos.y
op_amp
l_int|0xff
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_Y_HIGH
comma
(paren
id|c-&gt;pos.y
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_X_HOT
comma
id|c-&gt;hot.x
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_Y_HOT
comma
id|c-&gt;hot.y
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|pm2v_RDAC_WR
c_func
(paren
id|fb
comma
id|PM2VI_RD_CURSOR_MODE
comma
l_int|0x11
)paren
suffix:semicolon
)brace
DECL|function|pm2_cursor_timer_handler
r_static
r_void
id|pm2_cursor_timer_handler
c_func
(paren
r_int
r_int
id|dev_addr
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|fb
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|dev_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb-&gt;cursor-&gt;enable
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;cursor-&gt;vbl_cnt
op_logical_and
op_decrement
id|fb-&gt;cursor-&gt;vbl_cnt
op_eq
l_int|0
)paren
(brace
id|fb-&gt;cursor-&gt;on
op_xor_assign
l_int|1
suffix:semicolon
id|pm2v_set_cursor
c_func
(paren
id|fb
comma
id|fb-&gt;cursor-&gt;on
)paren
suffix:semicolon
id|fb-&gt;cursor-&gt;vbl_cnt
op_assign
id|fb-&gt;cursor-&gt;blink_rate
suffix:semicolon
)brace
id|out
suffix:colon
id|fb-&gt;cursor-&gt;timer-&gt;expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|50
)paren
suffix:semicolon
id|add_timer
c_func
(paren
id|fb-&gt;cursor-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|pm2fb_cursor
r_static
r_void
id|pm2fb_cursor
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|mode
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|fb
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_struct
id|pm2_cursor
op_star
id|c
op_assign
id|fb-&gt;cursor
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_return
suffix:semicolon
id|x
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|y
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;pos.x
op_eq
id|x
op_logical_and
id|c-&gt;pos.y
op_eq
id|y
op_logical_and
(paren
id|mode
op_eq
id|CM_ERASE
)paren
op_eq
op_logical_neg
id|c-&gt;enable
)paren
r_return
suffix:semicolon
id|c-&gt;enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;on
)paren
id|pm2v_set_cursor
c_func
(paren
id|fb
comma
l_int|0
)paren
suffix:semicolon
id|c-&gt;pos.x
op_assign
id|x
suffix:semicolon
id|c-&gt;pos.y
op_assign
id|y
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|c-&gt;on
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_DRAW
suffix:colon
r_case
id|CM_MOVE
suffix:colon
r_if
c_cond
(paren
id|c-&gt;on
)paren
id|pm2v_set_cursor
c_func
(paren
id|fb
comma
l_int|1
)paren
suffix:semicolon
r_else
id|c-&gt;vbl_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
id|c-&gt;enable
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|pm2_init_cursor
r_static
r_struct
id|pm2_cursor
op_star
id|__init
id|pm2_init_cursor
c_func
(paren
r_struct
id|pm2fb_info
op_star
id|fb
)paren
(brace
r_struct
id|pm2_cursor
op_star
id|cursor
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;type
op_ne
id|PM2_TYPE_PERMEDIA2V
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: Support hw cursor everywhere */
id|cursor
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pm2_cursor
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|cursor
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cursor
)paren
)paren
suffix:semicolon
id|cursor-&gt;timer
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cursor-&gt;timer
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor-&gt;timer
)paren
(brace
id|kfree
c_func
(paren
id|cursor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cursor-&gt;timer
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cursor-&gt;timer
)paren
)paren
suffix:semicolon
id|cursor-&gt;blink_rate
op_assign
id|DEFAULT_CURSOR_BLINK_RATE
suffix:semicolon
r_if
c_cond
(paren
id|curblink
)paren
(brace
id|init_timer
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
id|cursor-&gt;timer-&gt;expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|50
)paren
suffix:semicolon
id|cursor-&gt;timer-&gt;data
op_assign
(paren
r_int
r_int
)paren
id|fb
suffix:semicolon
id|cursor-&gt;timer-&gt;function
op_assign
id|pm2_cursor_timer_handler
suffix:semicolon
id|add_timer
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
)brace
r_return
id|cursor
suffix:semicolon
)brace
DECL|function|pm2fb_set_font
r_static
r_int
id|pm2fb_set_font
c_func
(paren
r_struct
id|display
op_star
id|d
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|fb
op_assign
(paren
r_struct
id|pm2fb_info
op_star
)paren
id|d-&gt;fb_info
suffix:semicolon
r_struct
id|pm2_cursor
op_star
id|c
op_assign
id|fb-&gt;cursor
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|c
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|width
op_logical_or
op_logical_neg
id|height
)paren
(brace
id|width
op_assign
l_int|8
suffix:semicolon
id|height
op_assign
l_int|16
suffix:semicolon
)brace
id|c-&gt;hot.x
op_assign
l_int|0
suffix:semicolon
id|c-&gt;hot.y
op_assign
l_int|0
suffix:semicolon
id|c-&gt;size.x
op_assign
id|width
suffix:semicolon
id|c-&gt;size.y
op_assign
id|height
suffix:semicolon
id|memset
c_func
(paren
id|c-&gt;bits
comma
l_int|0xff
comma
r_sizeof
(paren
id|c-&gt;bits
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|c-&gt;mask
comma
l_int|0
comma
r_sizeof
(paren
id|c-&gt;mask
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
id|width
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
id|j
op_sub_assign
l_int|8
comma
id|i
op_increment
)paren
(brace
id|c-&gt;mask
(braket
id|i
)braket
(braket
id|height
op_minus
l_int|2
)braket
op_assign
(paren
id|j
op_ge
l_int|8
)paren
ques
c_cond
l_int|0xff
suffix:colon
(paren
l_int|0xff
op_lshift
(paren
l_int|8
op_minus
id|j
)paren
)paren
suffix:semicolon
id|c-&gt;mask
(braket
id|i
)braket
(braket
id|height
op_minus
l_int|1
)braket
op_assign
(paren
id|j
op_ge
l_int|8
)paren
ques
c_cond
l_int|0xff
suffix:colon
(paren
l_int|0xff
op_lshift
(paren
l_int|8
op_minus
id|j
)paren
)paren
suffix:semicolon
)brace
id|pm2v_set_cursor_color
c_func
(paren
id|fb
comma
id|cursor_color_map
comma
id|cursor_color_map
comma
id|cursor_color_map
)paren
suffix:semicolon
id|pm2v_set_cursor_shape
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* PM2FB_HW_CURSOR */
multiline_comment|/***************************************************************************&n; * Begin of public functions&n; ***************************************************************************/
macro_line|#ifdef MODULE
DECL|function|pm2fb_cleanup
r_static
r_void
id|pm2fb_cleanup
c_func
(paren
r_void
)paren
(brace
r_struct
id|pm2fb_info
op_star
id|i
op_assign
op_amp
id|fb_info
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|i
)paren
suffix:semicolon
id|pm2fb_reset
c_func
(paren
id|i
)paren
suffix:semicolon
id|UNMAP
c_func
(paren
id|i-&gt;regions.v_fb
comma
id|i-&gt;regions.fb_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|i-&gt;regions.p_fb
comma
id|i-&gt;regions.fb_size
)paren
suffix:semicolon
id|UNMAP
c_func
(paren
id|i-&gt;regions.v_regs
comma
id|PM2_REGS_SIZE
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|i-&gt;regions.p_regs
comma
id|PM2_REGS_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|board_table
(braket
id|i-&gt;board
)braket
dot
id|cleanup
)paren
id|board_table
(braket
id|i-&gt;board
)braket
dot
id|cleanup
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|pm2fb_init
r_int
id|__init
(def_block
id|pm2fb_init
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fb_info
comma
l_int|0
comma
r_sizeof
(paren
id|fb_info
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fb_info.current_par
comma
op_amp
id|pm2fb_options.user_mode
comma
r_sizeof
(paren
id|fb_info.current_par
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pm2fb_conf
c_func
(paren
op_amp
id|fb_info
)paren
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|pm2fb_reset
c_func
(paren
op_amp
id|fb_info
)paren
suffix:semicolon
id|fb_info.disp.scrollmode
op_assign
id|SCROLL_YNOMOVE
suffix:semicolon
id|fb_info.gen.parsize
op_assign
r_sizeof
(paren
r_struct
id|pm2fb_par
)paren
suffix:semicolon
id|fb_info.gen.fbhw
op_assign
op_amp
id|pm2fb_hwswitch
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.gen.info.modename
comma
id|permedia2_name
)paren
suffix:semicolon
id|fb_info.gen.info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|fb_info.gen.info.fbops
op_assign
op_amp
id|pm2fb_ops
suffix:semicolon
id|fb_info.gen.info.disp
op_assign
op_amp
id|fb_info.disp
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.gen.info.fontname
comma
id|pm2fb_options.font
)paren
suffix:semicolon
id|fb_info.gen.info.switch_con
op_assign
op_amp
id|fbgen_switch
suffix:semicolon
id|fb_info.gen.info.updatevar
op_assign
op_amp
id|fbgen_update_var
suffix:semicolon
id|fb_info.gen.info.blank
op_assign
op_amp
id|fbgen_blank
suffix:semicolon
id|fbgen_get_var
c_func
(paren
op_amp
id|fb_info.disp.var
comma
op_minus
l_int|1
comma
op_amp
id|fb_info.gen.info
)paren
suffix:semicolon
id|fbgen_do_set_var
c_func
(paren
op_amp
id|fb_info.disp.var
comma
l_int|1
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
id|fbgen_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
id|fbgen_install_cmap
c_func
(paren
l_int|0
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info.gen.info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pm2fb: unable to register.&bslash;n&quot;
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s (%s), using %uK of video memory.&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|fb_info.gen.info.node
)paren
comma
id|board_table
(braket
id|fb_info.board
)braket
dot
id|name
comma
id|permedia2_name
comma
(paren
id|u32
)paren
(paren
id|fb_info.regions.fb_size
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
DECL|function|pm2fb_mode_setup
r_static
r_void
id|__init
(def_block
id|pm2fb_mode_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|user_mode
(braket
id|i
)braket
dot
id|name
(braket
l_int|0
)braket
op_logical_and
id|strcmp
c_func
(paren
id|options
comma
id|user_mode
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
(braket
id|i
)braket
dot
id|name
(braket
l_int|0
)braket
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|pm2fb_options.user_mode
comma
op_amp
id|user_mode
(braket
id|i
)braket
dot
id|par
comma
r_sizeof
(paren
id|pm2fb_options.user_mode
)paren
)paren
suffix:semicolon
id|pm2fb_options.flags
op_or_assign
id|OPTF_USER
suffix:semicolon
)brace
)brace
)def_block
DECL|function|pm2fb_font_setup
r_static
r_void
id|__init
(def_block
id|pm2fb_font_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
id|strncpy
c_func
(paren
id|pm2fb_options.font
comma
id|options
comma
r_sizeof
(paren
id|pm2fb_options.font
)paren
)paren
suffix:semicolon
id|pm2fb_options.font
(braket
r_sizeof
(paren
id|pm2fb_options.font
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)def_block
DECL|function|pm2fb_setup
r_int
id|__init
(def_block
id|pm2fb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|options
)paren
(brace
r_if
c_cond
(paren
(paren
id|next
op_assign
id|strchr
c_func
(paren
id|options
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
(paren
id|next
op_increment
)paren
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
id|pm2fb_font_setup
c_func
(paren
id|options
op_plus
l_int|5
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
id|pm2fb_mode_setup
c_func
(paren
id|options
op_plus
l_int|5
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|options
comma
l_string|&quot;ypan&quot;
)paren
)paren
id|pm2fb_options.flags
op_or_assign
id|OPTF_YPAN
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|options
comma
l_string|&quot;oldmem&quot;
)paren
)paren
id|pm2fb_options.flags
op_or_assign
id|OPTF_OLD_MEM
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|options
comma
l_string|&quot;virtual&quot;
)paren
)paren
id|pm2fb_options.flags
op_or_assign
id|OPTF_VIRTUAL
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|options
comma
l_string|&quot;noblink&quot;
)paren
)paren
id|curblink
op_assign
l_int|0
suffix:semicolon
id|options
op_assign
id|next
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)def_block
multiline_comment|/***************************************************************************&n; * Begin of module functions&n; ***************************************************************************/
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|__init
id|init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mode
)paren
id|pm2fb_mode_setup
c_func
(paren
id|mode
)paren
suffix:semicolon
r_return
id|pm2fb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pm2fb_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
multiline_comment|/***************************************************************************&n; * That&squot;s all folks!&n; ***************************************************************************/
eof
