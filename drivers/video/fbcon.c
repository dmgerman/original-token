multiline_comment|/*&n; *  linux/drivers/video/fbcon.c -- Low level frame buffer based console driver&n; *&n; *&t;Copyright (C) 1995 Geert Uytterhoeven&n; *&n; *&n; *  This file is based on the original Amiga console driver (amicon.c):&n; *&n; *&t;Copyright (C) 1993 Hamish Macdonald&n; *&t;&t;&t;   Greg Harp&n; *&t;Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *&t;      with work by William Rucklidge (wjr@cs.cornell.edu)&n; *&t;&t;&t;   Geert Uytterhoeven&n; *&t;&t;&t;   Jes Sorensen (jds@kom.auc.dk)&n; *&t;&t;&t;   Martin Apel&n; *&n; *  and on the original Atari console driver (atacon.c):&n; *&n; *&t;Copyright (C) 1993 Bjoern Brauel&n; *&t;&t;&t;   Roman Hodek&n; *&n; *&t;      with work by Guenther Kelleter&n; *&t;&t;&t;   Martin Schaller&n; *&t;&t;&t;   Andreas Schwab&n; *&n; *  Hardware cursor support added by Emmanuel Marty (core@ggi-project.org)&n; *  Smart redraw scrolling, arbitrary font width support, 512char font support&n; *  and software scrollback added by &n; *                         Jakub Jelinek (jj@ultra.linux.cz)&n; *&n; *  Random hacking by Martin Mares &lt;mj@ucw.cz&gt;&n; *&n; *&n; *  The low level operations for the various display memory organizations are&n; *  now in separate source files.&n; *&n; *  Currently the following organizations are supported:&n; *&n; *    o afb&t;&t;&t;Amiga bitplanes&n; *    o cfb{2,4,8,16,24,32}&t;Packed pixels&n; *    o ilbm&t;&t;&t;Amiga interleaved bitplanes&n; *    o iplan2p[248]&t;&t;Atari interleaved bitplanes&n; *    o mfb&t;&t;&t;Monochrome&n; *    o vga&t;&t;&t;VGA characters/attributes&n; *&n; *  To do:&n; *&n; *    - Implement 16 plane mode (iplan2p16)&n; *&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
DECL|macro|FBCONDEBUG
macro_line|#undef FBCONDEBUG
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/delay.h&gt;&t;/* MSch: for IRQ probe */
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_AMIGA
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_ATARI
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_MAC
macro_line|#include &lt;asm/macints.h&gt;
macro_line|#endif
macro_line|#if defined(__mc68000__) || defined(CONFIG_APUS)
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_FBCON_VGA_PLANES
macro_line|#include &lt;asm/io.h&gt;
macro_line|#endif
DECL|macro|INCLUDE_LINUX_LOGO_DATA
mdefine_line|#define INCLUDE_LINUX_LOGO_DATA
macro_line|#include &lt;asm/linux_logo.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-mac.h&gt;&t;/* for 6x11 font on mac */
macro_line|#include &lt;video/font.h&gt;
macro_line|#ifdef FBCONDEBUG
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...)
macro_line|#endif
DECL|macro|LOGO_H
mdefine_line|#define LOGO_H&t;&t;&t;80
DECL|macro|LOGO_W
mdefine_line|#define LOGO_W&t;&t;&t;80
DECL|macro|LOGO_LINE
mdefine_line|#define LOGO_LINE&t;(LOGO_W/8)
DECL|variable|fb_display
r_struct
id|display
id|fb_display
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|con2fb_map
r_char
id|con2fb_map
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|logo_lines
r_static
r_int
id|logo_lines
suffix:semicolon
DECL|variable|logo_shown
r_static
r_int
id|logo_shown
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Software scrollback */
DECL|variable|fbcon_softback_size
r_int
id|fbcon_softback_size
op_assign
l_int|32768
suffix:semicolon
DECL|variable|softback_buf
DECL|variable|softback_curr
r_static
r_int
r_int
id|softback_buf
comma
id|softback_curr
suffix:semicolon
DECL|variable|softback_in
r_static
r_int
r_int
id|softback_in
suffix:semicolon
DECL|variable|softback_top
DECL|variable|softback_end
r_static
r_int
r_int
id|softback_top
comma
id|softback_end
suffix:semicolon
DECL|variable|softback_lines
r_static
r_int
id|softback_lines
suffix:semicolon
DECL|macro|REFCOUNT
mdefine_line|#define REFCOUNT(fd)&t;(((int *)(fd))[-1])
DECL|macro|FNTSIZE
mdefine_line|#define FNTSIZE(fd)&t;(((int *)(fd))[-2])
DECL|macro|FNTCHARCNT
mdefine_line|#define FNTCHARCNT(fd)&t;(((int *)(fd))[-3])
DECL|macro|FNTSUM
mdefine_line|#define FNTSUM(fd)&t;(((int *)(fd))[-4])
DECL|macro|FONT_EXTRA_WORDS
mdefine_line|#define FONT_EXTRA_WORDS 4
DECL|macro|CM_SOFTBACK
mdefine_line|#define CM_SOFTBACK&t;(8)
DECL|macro|advance_row
mdefine_line|#define advance_row(p, delta) (unsigned short *)((unsigned long)(p) + (delta) * conp-&gt;vc_size_row)
r_static
r_void
id|fbcon_free_font
c_func
(paren
r_struct
id|display
op_star
)paren
suffix:semicolon
r_static
r_int
id|fbcon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; * Emmanuel: fbcon will now use a hardware cursor if the&n; * low-level driver provides a non-NULL dispsw-&gt;cursor pointer,&n; * in which case the hardware should do blinking, etc.&n; *&n; * if dispsw-&gt;cursor is NULL, use Atari alike software cursor&n; */
DECL|variable|cursor_drawn
r_static
r_int
id|cursor_drawn
suffix:semicolon
DECL|macro|CURSOR_DRAW_DELAY
mdefine_line|#define CURSOR_DRAW_DELAY&t;&t;(1)
multiline_comment|/* # VBL ints between cursor state changes */
DECL|macro|ARM_CURSOR_BLINK_RATE
mdefine_line|#define ARM_CURSOR_BLINK_RATE&t;&t;(10)
DECL|macro|AMIGA_CURSOR_BLINK_RATE
mdefine_line|#define AMIGA_CURSOR_BLINK_RATE&t;&t;(20)
DECL|macro|ATARI_CURSOR_BLINK_RATE
mdefine_line|#define ATARI_CURSOR_BLINK_RATE&t;&t;(42)
DECL|macro|MAC_CURSOR_BLINK_RATE
mdefine_line|#define MAC_CURSOR_BLINK_RATE&t;&t;(32)
DECL|macro|DEFAULT_CURSOR_BLINK_RATE
mdefine_line|#define DEFAULT_CURSOR_BLINK_RATE&t;(20)
DECL|variable|vbl_cursor_cnt
r_static
r_int
id|vbl_cursor_cnt
suffix:semicolon
DECL|variable|cursor_on
r_static
r_int
id|cursor_on
suffix:semicolon
DECL|variable|cursor_blink_rate
r_static
r_int
id|cursor_blink_rate
suffix:semicolon
DECL|function|cursor_undrawn
r_static
r_inline
r_void
id|cursor_undrawn
c_func
(paren
r_void
)paren
(brace
id|vbl_cursor_cnt
op_assign
l_int|0
suffix:semicolon
id|cursor_drawn
op_assign
l_int|0
suffix:semicolon
)brace
DECL|macro|divides
mdefine_line|#define divides(a, b)&t;((!(a) || (b)%(a)) ? 0 : 1)
multiline_comment|/*&n; *  Interface used by the world&n; */
r_static
r_const
r_char
op_star
id|fbcon_startup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|init
)paren
suffix:semicolon
r_static
r_void
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
suffix:semicolon
r_static
r_int
id|fbcon_changevar
c_func
(paren
r_int
id|con
)paren
suffix:semicolon
r_static
r_void
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
suffix:semicolon
r_static
r_void
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
suffix:semicolon
r_static
r_void
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
suffix:semicolon
r_static
r_int
id|fbcon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|blank
)paren
suffix:semicolon
r_static
r_int
id|fbcon_font_op
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|console_font_op
op_star
id|op
)paren
suffix:semicolon
r_static
r_int
id|fbcon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
r_char
op_star
id|table
)paren
suffix:semicolon
r_static
r_int
id|fbcon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|lines
)paren
suffix:semicolon
multiline_comment|/*&n; *  Internal routines&n; */
r_static
r_void
id|fbcon_setup
c_func
(paren
r_int
id|con
comma
r_int
id|init
comma
r_int
id|logo
)paren
suffix:semicolon
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|ypos
)paren
suffix:semicolon
r_static
r_void
id|fbcon_vbl_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|updatescrollmode
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ywrap_up
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ywrap_down
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ypan_up
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ypan_down
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
suffix:semicolon
r_static
r_int
id|fbcon_show_logo
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MAC
multiline_comment|/*&n; * On the Macintoy, there may or may not be a working VBL int. We need to probe&n; */
DECL|variable|vbl_detected
r_static
r_int
id|vbl_detected
suffix:semicolon
DECL|function|fbcon_vbl_detect
r_static
r_void
id|fbcon_vbl_detect
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|vbl_detected
op_increment
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
id|cursor_timer_handler
c_func
(paren
r_int
r_int
id|dev_addr
)paren
suffix:semicolon
DECL|variable|cursor_timer
r_static
r_struct
id|timer_list
id|cursor_timer
op_assign
(brace
id|function
suffix:colon
id|cursor_timer_handler
)brace
suffix:semicolon
DECL|function|cursor_timer_handler
r_static
r_void
id|cursor_timer_handler
c_func
(paren
r_int
r_int
id|dev_addr
)paren
(brace
id|fbcon_vbl_handler
c_func
(paren
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|cursor_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|50
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|cursor_timer
)paren
suffix:semicolon
)brace
DECL|function|PROC_CONSOLE
r_int
id|PROC_CONSOLE
c_func
(paren
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|fgc
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;display_fg
op_ne
l_int|NULL
)paren
id|fgc
op_assign
id|info-&gt;display_fg-&gt;vc_num
suffix:semicolon
r_else
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|current-&gt;tty
)paren
r_return
id|fgc
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;tty-&gt;driver.type
op_ne
id|TTY_DRIVER_TYPE_CONSOLE
)paren
multiline_comment|/* XXX Should report error here? */
r_return
id|fgc
suffix:semicolon
r_if
c_cond
(paren
id|MINOR
c_func
(paren
id|current-&gt;tty-&gt;device
)paren
OL
l_int|1
)paren
r_return
id|fgc
suffix:semicolon
r_return
id|MINOR
c_func
(paren
id|current-&gt;tty-&gt;device
)paren
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|set_all_vcs
r_int
id|set_all_vcs
c_func
(paren
r_int
id|fbidx
comma
r_struct
id|fb_ops
op_star
id|fb
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|unit
comma
id|err
suffix:semicolon
id|var-&gt;activate
op_or_assign
id|FB_ACTIVATE_TEST
suffix:semicolon
id|err
op_assign
id|fb
op_member_access_from_pointer
id|fb_set_var
c_func
(paren
id|var
comma
id|PROC_CONSOLE
c_func
(paren
id|info
)paren
comma
id|info
)paren
suffix:semicolon
id|var-&gt;activate
op_and_assign
op_complement
id|FB_ACTIVATE_TEST
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|unit
op_assign
l_int|0
suffix:semicolon
id|unit
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|unit
op_increment
)paren
r_if
c_cond
(paren
id|fb_display
(braket
id|unit
)braket
dot
id|conp
op_logical_and
id|con2fb_map
(braket
id|unit
)braket
op_eq
id|fbidx
)paren
id|fb
op_member_access_from_pointer
id|fb_set_var
c_func
(paren
id|var
comma
id|unit
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_con2fb_map
r_void
id|set_con2fb_map
c_func
(paren
r_int
id|unit
comma
r_int
id|newidx
)paren
(brace
r_int
id|oldidx
op_assign
id|con2fb_map
(braket
id|unit
)braket
suffix:semicolon
r_struct
id|fb_info
op_star
id|oldfb
comma
op_star
id|newfb
suffix:semicolon
r_struct
id|vc_data
op_star
id|conp
suffix:semicolon
r_char
op_star
id|fontdata
suffix:semicolon
r_int
r_int
id|fontwidth
comma
id|fontheight
comma
id|fontwidthlog
comma
id|fontheightlog
suffix:semicolon
r_int
id|userfont
suffix:semicolon
r_if
c_cond
(paren
id|newidx
op_ne
id|con2fb_map
(braket
id|unit
)braket
)paren
(brace
id|oldfb
op_assign
id|registered_fb
(braket
id|oldidx
)braket
suffix:semicolon
id|newfb
op_assign
id|registered_fb
(braket
id|newidx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|newfb-&gt;fbops-&gt;owner
)paren
id|__MOD_INC_USE_COUNT
c_func
(paren
id|newfb-&gt;fbops-&gt;owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newfb-&gt;fbops-&gt;fb_open
op_logical_and
id|newfb-&gt;fbops
op_member_access_from_pointer
id|fb_open
c_func
(paren
id|newfb
comma
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|newfb-&gt;fbops-&gt;owner
)paren
id|__MOD_DEC_USE_COUNT
c_func
(paren
id|newfb-&gt;fbops-&gt;owner
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oldfb-&gt;fbops-&gt;fb_release
)paren
id|oldfb-&gt;fbops
op_member_access_from_pointer
id|fb_release
c_func
(paren
id|oldfb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|oldfb-&gt;fbops-&gt;owner
)paren
id|__MOD_DEC_USE_COUNT
c_func
(paren
id|oldfb-&gt;fbops-&gt;owner
)paren
suffix:semicolon
id|conp
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|conp
suffix:semicolon
id|fontdata
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|fontdata
suffix:semicolon
id|fontwidth
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|_fontwidth
suffix:semicolon
id|fontheight
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|_fontheight
suffix:semicolon
id|fontwidthlog
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|_fontwidthlog
suffix:semicolon
id|fontheightlog
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|_fontheightlog
suffix:semicolon
id|userfont
op_assign
id|fb_display
(braket
id|unit
)braket
dot
id|userfont
suffix:semicolon
id|con2fb_map
(braket
id|unit
)braket
op_assign
id|newidx
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
op_assign
op_star
(paren
id|newfb-&gt;disp
)paren
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|conp
op_assign
id|conp
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|fontdata
op_assign
id|fontdata
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|_fontwidth
op_assign
id|fontwidth
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|_fontheight
op_assign
id|fontheight
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|_fontwidthlog
op_assign
id|fontwidthlog
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|_fontheightlog
op_assign
id|fontheightlog
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|userfont
op_assign
id|userfont
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|fb_info
op_assign
id|newfb
suffix:semicolon
r_if
c_cond
(paren
id|conp
)paren
id|conp-&gt;vc_display_fg
op_assign
op_amp
id|newfb-&gt;display_fg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newfb-&gt;display_fg
)paren
id|newfb-&gt;display_fg
op_assign
id|conp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newfb-&gt;changevar
)paren
id|newfb-&gt;changevar
op_assign
id|oldfb-&gt;changevar
suffix:semicolon
multiline_comment|/* tell console var has changed */
r_if
c_cond
(paren
id|newfb-&gt;changevar
)paren
id|newfb
op_member_access_from_pointer
id|changevar
c_func
(paren
id|unit
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Low Level Operations&n; */
DECL|variable|fbcon_dummy
r_struct
id|display_switch
id|fbcon_dummy
suffix:semicolon
multiline_comment|/* NOTE: fbcon cannot be __init: it may be called from take_over_console later */
DECL|function|fbcon_startup
r_static
r_const
r_char
op_star
id|fbcon_startup
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|display_desc
op_assign
l_string|&quot;frame buffer device&quot;
suffix:semicolon
r_int
id|irqres
op_assign
l_int|1
suffix:semicolon
r_static
r_int
id|done
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;     *  If num_registered_fb is zero, this is a call for the dummy part.&n;     *  The frame buffer devices weren&squot;t initialized yet.&n;     */
r_if
c_cond
(paren
op_logical_neg
id|num_registered_fb
op_logical_or
id|done
)paren
r_return
id|display_desc
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_AMIGA
r_if
c_cond
(paren
id|MACH_IS_AMIGA
)paren
(brace
id|cursor_blink_rate
op_assign
id|AMIGA_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_AMIGA_VERTB
comma
id|fbcon_vbl_handler
comma
l_int|0
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_ATARI
r_if
c_cond
(paren
id|MACH_IS_ATARI
)paren
(brace
id|cursor_blink_rate
op_assign
id|ATARI_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_AUTO_4
comma
id|fbcon_vbl_handler
comma
id|IRQ_TYPE_PRIO
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_MAC
multiline_comment|/*&n;     * On a Macintoy, the VBL interrupt may or may not be active. &n;     * As interrupt based cursor is more reliable and race free, we &n;     * probe for VBL interrupts.&n;     */
r_if
c_cond
(paren
id|MACH_IS_MAC
)paren
(brace
r_int
id|ct
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Probe for VBL: set temp. handler ...&n;&t; */
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fbcon_vbl_detect
comma
l_int|0
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_detect
)paren
suffix:semicolon
id|vbl_detected
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * ... and spin for 20 ms ...&n;&t; */
r_while
c_loop
(paren
op_logical_neg
id|vbl_detected
op_logical_and
op_increment
id|ct
OL
l_int|1000
)paren
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ct
op_eq
l_int|1000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;fbcon_startup: No VBL detected, using timer based cursor.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|free_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fbcon_vbl_detect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vbl_detected
)paren
(brace
multiline_comment|/*&n;&t;     * interrupt based cursor ok&n;&t;     */
id|cursor_blink_rate
op_assign
id|MAC_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fbcon_vbl_handler
comma
l_int|0
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;     * VBL not detected: fall through, use timer based cursor&n;&t;     */
id|irqres
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_MAC */
macro_line|#if defined(__arm__) &amp;&amp; defined(IRQ_VSYNCPULSE)
id|cursor_blink_rate
op_assign
id|ARM_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_VSYNCPULSE
comma
id|fbcon_vbl_handler
comma
id|SA_SHIRQ
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|irqres
)paren
(brace
id|cursor_blink_rate
op_assign
id|DEFAULT_CURSOR_BLINK_RATE
suffix:semicolon
id|cursor_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|50
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|cursor_timer
)paren
suffix:semicolon
)brace
r_return
id|display_desc
suffix:semicolon
)brace
DECL|function|fbcon_init
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|init
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
multiline_comment|/* on which frame buffer will we open this console? */
id|info
op_assign
id|registered_fb
(braket
(paren
r_int
)paren
id|con2fb_map
(braket
id|unit
)braket
)braket
suffix:semicolon
id|info-&gt;changevar
op_assign
op_amp
id|fbcon_changevar
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
op_assign
op_star
(paren
id|info-&gt;disp
)paren
suffix:semicolon
multiline_comment|/* copy from default */
id|DPRINTK
c_func
(paren
l_string|&quot;mode:   %s&bslash;n&quot;
comma
id|info-&gt;modename
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;visual: %d&bslash;n&quot;
comma
id|fb_display
(braket
id|unit
)braket
dot
id|visual
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;res:    %dx%d-%d&bslash;n&quot;
comma
id|fb_display
(braket
id|unit
)braket
dot
id|var.xres
comma
id|fb_display
(braket
id|unit
)braket
dot
id|var.yres
comma
id|fb_display
(braket
id|unit
)braket
dot
id|var.bits_per_pixel
)paren
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|conp
op_assign
id|conp
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|fb_info
op_assign
id|info
suffix:semicolon
multiline_comment|/* clear out the cmap so we don&squot;t have dangling pointers */
id|fb_display
(braket
id|unit
)braket
dot
id|cmap.len
op_assign
l_int|0
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|cmap.red
op_assign
l_int|0
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|cmap.green
op_assign
l_int|0
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|cmap.blue
op_assign
l_int|0
suffix:semicolon
id|fb_display
(braket
id|unit
)braket
dot
id|cmap.transp
op_assign
l_int|0
suffix:semicolon
id|fbcon_setup
c_func
(paren
id|unit
comma
id|init
comma
op_logical_neg
id|init
)paren
suffix:semicolon
multiline_comment|/* Must be done after fbcon_setup to prevent excess updates */
id|conp-&gt;vc_display_fg
op_assign
op_amp
id|info-&gt;display_fg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;display_fg
)paren
id|info-&gt;display_fg
op_assign
id|conp
suffix:semicolon
)brace
DECL|function|fbcon_deinit
r_static
r_void
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
id|fbcon_free_font
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
id|p-&gt;conp
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_changevar
r_static
r_int
id|fbcon_changevar
c_func
(paren
r_int
id|con
)paren
(brace
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|conp
)paren
id|fbcon_setup
c_func
(paren
id|con
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|updatescrollmode
r_static
id|__inline__
r_void
id|updatescrollmode
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
id|m
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YFIXED
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ywrapstep
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_logical_and
id|divides
c_func
(paren
id|fontheight
c_func
(paren
id|p
)paren
comma
id|p-&gt;var.yres_virtual
)paren
)paren
id|m
op_assign
id|__SCROLL_YWRAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ypanstep
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_logical_and
id|p-&gt;var.yres_virtual
op_ge
id|p-&gt;var.yres
op_plus
id|fontheight
c_func
(paren
id|p
)paren
)paren
id|m
op_assign
id|__SCROLL_YPAN
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YNOMOVE
)paren
id|m
op_assign
id|__SCROLL_YREDRAW
suffix:semicolon
r_else
id|m
op_assign
id|__SCROLL_YMOVE
suffix:semicolon
id|p-&gt;scrollmode
op_assign
(paren
id|p-&gt;scrollmode
op_amp
op_complement
id|__SCROLL_YMASK
)paren
op_or
id|m
suffix:semicolon
)brace
DECL|function|fbcon_font_widths
r_static
r_void
id|fbcon_font_widths
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
id|p-&gt;_fontwidthlog
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
op_le
l_int|6
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_eq
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|p-&gt;_fontwidthlog
op_assign
id|i
suffix:semicolon
id|p-&gt;_fontheightlog
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
op_le
l_int|6
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_eq
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|p-&gt;_fontheightlog
op_assign
id|i
suffix:semicolon
)brace
DECL|macro|fontwidthvalid
mdefine_line|#define fontwidthvalid(p,w) ((p)-&gt;dispsw-&gt;fontwidthmask &amp; FONTWIDTH(w))
DECL|function|fbcon_setup
r_static
r_void
id|fbcon_setup
c_func
(paren
r_int
id|con
comma
r_int
id|init
comma
r_int
id|logo
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
r_int
id|nr_rows
comma
id|nr_cols
suffix:semicolon
r_int
id|old_rows
comma
id|old_cols
suffix:semicolon
r_int
r_int
op_star
id|save
op_assign
l_int|NULL
comma
op_star
id|r
comma
op_star
id|q
suffix:semicolon
r_int
id|i
comma
id|charcnt
op_assign
l_int|256
suffix:semicolon
r_struct
id|fbcon_font_desc
op_star
id|font
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ne
id|fg_console
op_logical_or
(paren
id|p-&gt;fb_info-&gt;flags
op_amp
id|FBINFO_FLAG_MODULE
)paren
op_logical_or
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
)paren
id|logo
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset wrap/pan */
r_if
c_cond
(paren
id|con
op_eq
id|fg_console
op_logical_and
id|p-&gt;type
op_ne
id|FB_TYPE_TEXT
)paren
(brace
r_if
c_cond
(paren
id|fbcon_softback_size
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|softback_buf
)paren
(brace
id|softback_buf
op_assign
(paren
r_int
r_int
)paren
id|kmalloc
c_func
(paren
id|fbcon_softback_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|softback_buf
)paren
(brace
id|fbcon_softback_size
op_assign
l_int|0
suffix:semicolon
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|softback_buf
)paren
(brace
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|softback_buf
)paren
suffix:semicolon
id|softback_buf
op_assign
l_int|0
suffix:semicolon
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|softback_buf
)paren
id|softback_in
op_assign
id|softback_top
op_assign
id|softback_curr
op_assign
id|softback_buf
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|i
op_ne
id|con
op_logical_and
id|fb_display
(braket
id|i
)braket
dot
id|fb_info
op_eq
id|p-&gt;fb_info
op_logical_and
id|fb_display
(braket
id|i
)braket
dot
id|conp
op_logical_and
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
)paren
r_break
suffix:semicolon
id|fbcon_free_font
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|MAX_NR_CONSOLES
)paren
(brace
r_struct
id|display
op_star
id|q
op_assign
op_amp
id|fb_display
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fontwidthvalid
c_func
(paren
id|p
comma
id|fontwidth
c_func
(paren
id|q
)paren
)paren
)paren
(brace
multiline_comment|/* If we are not the first console on this&n;               fb, copy the font from that console */
id|p-&gt;_fontwidth
op_assign
id|q-&gt;_fontwidth
suffix:semicolon
id|p-&gt;_fontheight
op_assign
id|q-&gt;_fontheight
suffix:semicolon
id|p-&gt;_fontwidthlog
op_assign
id|q-&gt;_fontwidthlog
suffix:semicolon
id|p-&gt;_fontheightlog
op_assign
id|q-&gt;_fontheightlog
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|q-&gt;fontdata
suffix:semicolon
id|p-&gt;userfont
op_assign
id|q-&gt;userfont
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
(brace
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_increment
suffix:semicolon
id|charcnt
op_assign
id|FNTCHARCNT
c_func
(paren
id|p-&gt;fontdata
)paren
suffix:semicolon
)brace
id|con_copy_unimap
c_func
(paren
id|con
comma
id|i
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;fontdata
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;fb_info-&gt;fontname
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
(paren
id|font
op_assign
id|fbcon_find_font
c_func
(paren
id|p-&gt;fb_info-&gt;fontname
)paren
)paren
)paren
id|font
op_assign
id|fbcon_get_default_font
c_func
(paren
id|p-&gt;var.xres
comma
id|p-&gt;var.yres
)paren
suffix:semicolon
id|p-&gt;_fontwidth
op_assign
id|font-&gt;width
suffix:semicolon
id|p-&gt;_fontheight
op_assign
id|font-&gt;height
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|font-&gt;data
suffix:semicolon
id|fbcon_font_widths
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fontwidthvalid
c_func
(paren
id|p
comma
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
(brace
macro_line|#ifdef CONFIG_MAC
r_if
c_cond
(paren
id|MACH_IS_MAC
)paren
multiline_comment|/* ++Geert: hack to make 6x11 fonts work on mac */
id|p-&gt;dispsw
op_assign
op_amp
id|fbcon_mac
suffix:semicolon
r_else
macro_line|#endif
(brace
multiline_comment|/* ++Geert: changed from panic() to `correct and continue&squot; */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;fbcon_setup: No support for fontwidth %d&bslash;n&quot;
comma
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;set_font
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|set_font
c_func
(paren
id|p
comma
id|fontwidth
c_func
(paren
id|p
)paren
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|updatescrollmode
c_func
(paren
id|p
)paren
suffix:semicolon
id|old_cols
op_assign
id|conp-&gt;vc_cols
suffix:semicolon
id|old_rows
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
id|nr_cols
op_assign
id|p-&gt;var.xres
op_div
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|nr_rows
op_assign
id|p-&gt;var.yres
op_div
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo
)paren
(brace
multiline_comment|/* Need to make room for the logo */
r_int
id|cnt
suffix:semicolon
r_int
id|step
suffix:semicolon
id|logo_lines
op_assign
(paren
id|LOGO_H
op_plus
id|fontheight
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
op_div
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|q
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|old_rows
)paren
suffix:semicolon
id|step
op_assign
id|logo_lines
op_star
id|old_cols
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
id|q
op_minus
id|logo_lines
op_star
id|old_cols
suffix:semicolon
id|r
OL
id|q
suffix:semicolon
id|r
op_increment
)paren
r_if
c_cond
(paren
id|scr_readw
c_func
(paren
id|r
)paren
op_ne
id|conp-&gt;vc_video_erase_char
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ne
id|q
op_logical_and
id|nr_rows
op_ge
id|old_rows
op_plus
id|logo_lines
)paren
(brace
id|save
op_assign
id|kmalloc
c_func
(paren
id|logo_lines
op_star
id|nr_cols
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|save
)paren
(brace
r_int
id|i
op_assign
id|old_cols
OL
id|nr_cols
ques
c_cond
id|old_cols
suffix:colon
id|nr_cols
suffix:semicolon
id|scr_memsetw
c_func
(paren
id|save
comma
id|conp-&gt;vc_video_erase_char
comma
id|logo_lines
op_star
id|nr_cols
op_star
l_int|2
)paren
suffix:semicolon
id|r
op_assign
id|q
op_minus
id|step
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|logo_lines
suffix:semicolon
id|cnt
op_increment
comma
id|r
op_add_assign
id|i
)paren
id|scr_memcpyw_from
c_func
(paren
id|save
op_plus
id|cnt
op_star
id|nr_cols
comma
id|r
comma
l_int|2
op_star
id|i
)paren
suffix:semicolon
id|r
op_assign
id|q
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|r
op_eq
id|q
)paren
(brace
multiline_comment|/* We can scroll screen down */
id|r
op_assign
id|q
op_minus
id|step
op_minus
id|old_cols
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
id|old_rows
op_minus
id|logo_lines
suffix:semicolon
id|cnt
OG
l_int|0
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
id|scr_memcpyw
c_func
(paren
id|r
op_plus
id|step
comma
id|r
comma
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
id|r
op_sub_assign
id|old_cols
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|save
)paren
(brace
id|conp-&gt;vc_y
op_add_assign
id|logo_lines
suffix:semicolon
id|conp-&gt;vc_pos
op_add_assign
id|logo_lines
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
)brace
)brace
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|conp-&gt;vc_origin
comma
id|conp-&gt;vc_video_erase_char
comma
id|conp-&gt;vc_size_row
op_star
id|logo_lines
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;     *  ++guenther: console.c:vc_allocate() relies on initializing&n;     *  vc_{cols,rows}, but we must not set those if we are only&n;     *  resizing the console.&n;     */
r_if
c_cond
(paren
id|init
)paren
(brace
id|conp-&gt;vc_cols
op_assign
id|nr_cols
suffix:semicolon
id|conp-&gt;vc_rows
op_assign
id|nr_rows
suffix:semicolon
)brace
id|p-&gt;vrows
op_assign
id|p-&gt;var.yres_virtual
op_div
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;var.yres
op_mod
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_logical_and
(paren
id|p-&gt;var.yres_virtual
op_mod
id|fontheight
c_func
(paren
id|p
)paren
OL
id|p-&gt;var.yres
op_mod
id|fontheight
c_func
(paren
id|p
)paren
)paren
)paren
id|p-&gt;vrows
op_decrement
suffix:semicolon
id|conp-&gt;vc_can_do_color
op_assign
id|p-&gt;var.bits_per_pixel
op_ne
l_int|1
suffix:semicolon
id|conp-&gt;vc_complement_mask
op_assign
id|conp-&gt;vc_can_do_color
ques
c_cond
l_int|0x7700
suffix:colon
l_int|0x0800
suffix:semicolon
r_if
c_cond
(paren
id|charcnt
op_eq
l_int|256
)paren
(brace
id|conp-&gt;vc_hi_font_mask
op_assign
l_int|0
suffix:semicolon
id|p-&gt;fgshift
op_assign
l_int|8
suffix:semicolon
id|p-&gt;bgshift
op_assign
l_int|12
suffix:semicolon
id|p-&gt;charmask
op_assign
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
id|conp-&gt;vc_hi_font_mask
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_can_do_color
)paren
id|conp-&gt;vc_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
id|p-&gt;fgshift
op_assign
l_int|9
suffix:semicolon
id|p-&gt;bgshift
op_assign
l_int|13
suffix:semicolon
id|p-&gt;charmask
op_assign
l_int|0x1ff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;dispsw
op_eq
op_amp
id|fbcon_dummy
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;fbcon_setup: type %d (aux %d, depth %d) not &quot;
l_string|&quot;supported&bslash;n&quot;
comma
id|p-&gt;type
comma
id|p-&gt;type_aux
comma
id|p-&gt;var.bits_per_pixel
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|setup
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;fgcol
op_assign
id|p-&gt;var.bits_per_pixel
OG
l_int|2
ques
c_cond
l_int|7
suffix:colon
(paren
l_int|1
op_lshift
id|p-&gt;var.bits_per_pixel
)paren
op_minus
l_int|1
suffix:semicolon
id|p-&gt;bgcol
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
r_if
c_cond
(paren
id|conp-&gt;vc_cols
op_ne
id|nr_cols
op_logical_or
id|conp-&gt;vc_rows
op_ne
id|nr_rows
)paren
id|vc_resize_con
c_func
(paren
id|nr_rows
comma
id|nr_cols
comma
id|con
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|conp
)paren
op_logical_and
id|vt_cons
(braket
id|conp-&gt;vc_num
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;clear_margins
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|conp
comma
id|p
comma
l_int|0
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|save
)paren
(brace
id|q
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|old_rows
)paren
suffix:semicolon
id|scr_memcpyw
c_func
(paren
id|q
comma
id|save
comma
id|logo_lines
op_star
id|nr_cols
op_star
l_int|2
)paren
suffix:semicolon
id|conp-&gt;vc_y
op_add_assign
id|logo_lines
suffix:semicolon
id|conp-&gt;vc_pos
op_add_assign
id|logo_lines
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
id|kfree
c_func
(paren
id|save
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|logo
)paren
(brace
id|logo_shown
op_assign
op_minus
l_int|2
suffix:semicolon
id|conp-&gt;vc_top
op_assign
id|logo_lines
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|fg_console
op_logical_and
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;    &t;       the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/*  fbcon_XXX routines - interface used by the world&n; *&n; *  This system is now divided into two levels because of complications&n; *  caused by hardware scrolling. Top level functions:&n; *&n; *&t;fbcon_bmove(), fbcon_clear(), fbcon_putc()&n; *&n; *  handles y values in range [0, scr_height-1] that correspond to real&n; *  screen positions. y_wrap shift means that first line of bitmap may be&n; *  anywhere on this display. These functions convert lineoffsets to&n; *  bitmap offsets and deal with the wrap-around case by splitting blits.&n; *&n; *&t;fbcon_bmove_physical_8()    -- These functions fast implementations&n; *&t;fbcon_clear_physical_8()    -- of original fbcon_XXX fns.&n; *&t;fbcon_putc_physical_8()&t;    -- (fontwidth != 8) may be added later&n; *&n; *  WARNING:&n; *&n; *  At the moment fbcon_putc() cannot blit across vertical wrap boundary&n; *  Implies should only really hardware scroll in rows. Only reason for&n; *  restriction is simplicity &amp; efficiency at the moment.&n; */
DECL|function|real_y
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|ypos
)paren
(brace
r_int
id|rows
op_assign
id|p-&gt;vrows
suffix:semicolon
id|ypos
op_add_assign
id|p-&gt;yscroll
suffix:semicolon
r_return
id|ypos
OL
id|rows
ques
c_cond
id|ypos
suffix:colon
id|ypos
op_minus
id|rows
suffix:semicolon
)brace
DECL|function|fbcon_clear
r_static
r_void
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
id|u_int
id|y_break
suffix:semicolon
r_int
id|redraw_cursor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|height
op_logical_or
op_logical_neg
id|width
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|sy
op_plus
id|height
)paren
op_logical_and
(paren
id|sx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|sx
op_plus
id|width
)paren
)paren
(brace
id|cursor_undrawn
c_func
(paren
)paren
suffix:semicolon
id|redraw_cursor
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Split blits that cross physical y_wrap boundary */
id|y_break
op_assign
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
suffix:semicolon
r_if
c_cond
(paren
id|sy
OL
id|y_break
op_logical_and
id|sy
op_plus
id|height
op_minus
l_int|1
op_ge
id|y_break
)paren
(brace
id|u_int
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|b
comma
id|width
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
)paren
comma
id|sx
comma
id|height
op_minus
id|b
comma
id|width
)paren
suffix:semicolon
)brace
r_else
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
r_if
c_cond
(paren
id|redraw_cursor
)paren
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|function|fbcon_putc
r_static
r_void
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|redraw_cursor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_x
op_eq
id|xpos
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
op_eq
id|ypos
)paren
)paren
(brace
id|cursor_undrawn
c_func
(paren
)paren
suffix:semicolon
id|redraw_cursor
op_assign
l_int|1
suffix:semicolon
)brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putc
c_func
(paren
id|conp
comma
id|p
comma
id|c
comma
id|real_y
c_func
(paren
id|p
comma
id|ypos
)paren
comma
id|xpos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|redraw_cursor
)paren
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|function|fbcon_putcs
r_static
r_void
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|redraw_cursor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_y
op_eq
id|ypos
)paren
op_logical_and
(paren
id|xpos
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
(paren
id|xpos
op_plus
id|count
)paren
)paren
)paren
(brace
id|cursor_undrawn
c_func
(paren
)paren
suffix:semicolon
id|redraw_cursor
op_assign
l_int|1
suffix:semicolon
)brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|s
comma
id|count
comma
id|real_y
c_func
(paren
id|p
comma
id|ypos
)paren
comma
id|xpos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|redraw_cursor
)paren
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|function|fbcon_cursor
r_static
r_void
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|y
op_assign
id|conp-&gt;vc_y
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|CM_SOFTBACK
)paren
(brace
id|mode
op_and_assign
op_complement
id|CM_SOFTBACK
suffix:semicolon
r_if
c_cond
(paren
id|softback_lines
)paren
(brace
r_if
c_cond
(paren
id|y
op_plus
id|softback_lines
op_ge
id|conp-&gt;vc_rows
)paren
id|mode
op_assign
id|CM_ERASE
suffix:semicolon
r_else
id|y
op_add_assign
id|softback_lines
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|conp
)paren
suffix:semicolon
multiline_comment|/* do we have a hardware cursor ? */
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;cursor
)paren
(brace
id|p-&gt;cursor_x
op_assign
id|conp-&gt;vc_x
suffix:semicolon
id|p-&gt;cursor_y
op_assign
id|y
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|cursor
c_func
(paren
id|p
comma
id|mode
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Avoid flickering if there&squot;s no real change. */
r_if
c_cond
(paren
id|p-&gt;cursor_x
op_eq
id|conp-&gt;vc_x
op_logical_and
id|p-&gt;cursor_y
op_eq
id|y
op_logical_and
(paren
id|mode
op_eq
id|CM_ERASE
)paren
op_eq
op_logical_neg
id|cursor_on
)paren
r_return
suffix:semicolon
id|cursor_on
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cursor_drawn
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|revc
c_func
(paren
id|p
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
id|p-&gt;cursor_x
op_assign
id|conp-&gt;vc_x
suffix:semicolon
id|p-&gt;cursor_y
op_assign
id|y
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|cursor_drawn
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_MOVE
suffix:colon
r_case
id|CM_DRAW
suffix:colon
r_if
c_cond
(paren
id|cursor_drawn
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|revc
c_func
(paren
id|p
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
id|cursor_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|fbcon_vbl_handler
r_static
r_void
id|fbcon_vbl_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_struct
id|display
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor_on
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vbl_cursor_cnt
op_logical_and
op_decrement
id|vbl_cursor_cnt
op_eq
l_int|0
)paren
(brace
id|p
op_assign
op_amp
id|fb_display
(braket
id|fg_console
)braket
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;revc
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|revc
c_func
(paren
id|p
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
id|cursor_drawn
op_xor_assign
l_int|1
suffix:semicolon
id|vbl_cursor_cnt
op_assign
id|cursor_blink_rate
suffix:semicolon
)brace
)brace
DECL|variable|scrollback_phys_max
r_static
r_int
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
DECL|variable|scrollback_max
r_static
r_int
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
DECL|variable|scrollback_current
r_static
r_int
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
DECL|function|ywrap_up
r_static
id|__inline__
r_void
id|ywrap_up
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
(brace
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
op_ge
id|p-&gt;vrows
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|p-&gt;fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
id|scrollback_max
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OG
id|scrollback_phys_max
)paren
id|scrollback_max
op_assign
id|scrollback_phys_max
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ywrap_down
r_static
id|__inline__
r_void
id|ywrap_down
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
(brace
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|p-&gt;fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
id|scrollback_max
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OL
l_int|0
)paren
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_up
r_static
id|__inline__
r_void
id|ypan_up
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
(brace
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OG
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|conp-&gt;vc_rows
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
suffix:semicolon
)brace
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|p-&gt;fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;clear_margins
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|conp
comma
id|p
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OG
id|scrollback_phys_max
)paren
id|scrollback_max
op_assign
id|scrollback_phys_max
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_down
r_static
id|__inline__
r_void
id|ypan_down
c_func
(paren
r_int
id|unit
comma
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|count
)paren
(brace
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
comma
l_int|0
comma
id|conp-&gt;vc_rows
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
suffix:semicolon
)brace
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|p-&gt;fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;clear_margins
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|conp
comma
id|p
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OL
l_int|0
)paren
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_redraw_softback
r_static
r_void
id|fbcon_redraw_softback
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|delta
)paren
(brace
r_int
r_int
op_star
id|d
comma
op_star
id|s
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
r_int
id|line
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
id|d
op_assign
(paren
id|u16
op_star
)paren
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
id|n
op_assign
id|softback_curr
op_plus
id|delta
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
id|softback_lines
op_sub_assign
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|softback_curr
OL
id|softback_top
op_logical_and
id|n
OL
id|softback_buf
)paren
(brace
id|n
op_add_assign
id|softback_end
op_minus
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
id|softback_top
)paren
(brace
id|softback_lines
op_sub_assign
(paren
id|softback_top
op_minus
id|n
)paren
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
id|n
op_assign
id|softback_top
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_curr
op_ge
id|softback_top
op_logical_and
id|n
OL
id|softback_top
)paren
(brace
id|softback_lines
op_sub_assign
(paren
id|softback_top
op_minus
id|n
)paren
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
id|n
op_assign
id|softback_top
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|softback_curr
OG
id|softback_in
op_logical_and
id|n
op_ge
id|softback_end
)paren
(brace
id|n
op_add_assign
id|softback_buf
op_minus
id|softback_end
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|softback_in
)paren
(brace
id|n
op_assign
id|softback_in
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_curr
op_le
id|softback_in
op_logical_and
id|n
OG
id|softback_in
)paren
(brace
id|n
op_assign
id|softback_in
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|n
op_eq
id|softback_curr
)paren
r_return
suffix:semicolon
id|softback_curr
op_assign
id|n
suffix:semicolon
id|s
op_assign
(paren
id|u16
op_star
)paren
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_int
r_int
op_star
id|start
suffix:semicolon
r_int
r_int
op_star
id|le
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
id|le
op_assign
id|advance_row
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|c
op_eq
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
id|s
op_increment
suffix:semicolon
id|d
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
id|line
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
)brace
)brace
DECL|function|fbcon_redraw
r_static
r_void
id|fbcon_redraw
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|line
comma
r_int
id|count
comma
r_int
id|offset
)paren
(brace
r_int
r_int
op_star
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|line
)paren
suffix:semicolon
r_int
r_int
op_star
id|s
op_assign
id|d
op_plus
id|offset
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_int
r_int
op_star
id|start
op_assign
id|s
suffix:semicolon
r_int
r_int
op_star
id|le
op_assign
id|advance_row
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|c
op_eq
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
id|scr_writew
c_func
(paren
id|c
comma
id|d
)paren
suffix:semicolon
id|s
op_increment
suffix:semicolon
id|d
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|s
op_minus
id|start
comma
id|real_y
c_func
(paren
id|p
comma
id|line
)paren
comma
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
l_int|0
)paren
id|line
op_increment
suffix:semicolon
r_else
(brace
id|line
op_decrement
suffix:semicolon
multiline_comment|/* NOTE: We subtract two lines from these pointers */
id|s
op_sub_assign
id|conp-&gt;vc_size_row
suffix:semicolon
id|d
op_sub_assign
id|conp-&gt;vc_size_row
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_redraw_clear
r_void
id|fbcon_redraw_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|x
comma
id|y
suffix:semicolon
r_for
c_loop
(paren
id|y
op_assign
l_int|0
suffix:semicolon
id|y
OL
id|height
suffix:semicolon
id|y
op_increment
)paren
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|width
suffix:semicolon
id|x
op_increment
)paren
id|fbcon_putc
c_func
(paren
id|conp
comma
l_char|&squot; &squot;
comma
id|sy
op_plus
id|y
comma
id|sx
op_plus
id|x
)paren
suffix:semicolon
)brace
multiline_comment|/* This cannot be used together with ypan or ywrap */
DECL|function|fbcon_redraw_bmove
r_void
id|fbcon_redraw_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|h
comma
r_int
id|w
)paren
(brace
r_if
c_cond
(paren
id|sy
op_ne
id|dy
)paren
id|panic
c_func
(paren
l_string|&quot;fbcon_redraw_bmove width sy != dy&quot;
)paren
suffix:semicolon
multiline_comment|/* h will be always 1, but it does not matter if we are more generic */
r_while
c_loop
(paren
id|h
op_decrement
OG
l_int|0
)paren
(brace
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
r_int
r_int
op_star
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|dy
op_plus
id|dx
op_star
l_int|2
)paren
suffix:semicolon
r_int
r_int
op_star
id|s
op_assign
id|d
op_plus
(paren
id|dx
op_minus
id|sx
)paren
suffix:semicolon
r_int
r_int
op_star
id|start
op_assign
id|d
suffix:semicolon
r_int
r_int
op_star
id|ls
op_assign
id|d
suffix:semicolon
r_int
r_int
op_star
id|le
op_assign
id|d
op_plus
id|w
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
id|dx
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|d
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|d
op_minus
id|start
comma
id|dy
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|d
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|d
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|s
op_ge
id|ls
op_logical_and
id|s
OL
id|le
op_logical_and
id|c
op_eq
id|scr_readw
c_func
(paren
id|s
)paren
)paren
(brace
r_if
c_cond
(paren
id|d
OG
id|start
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|d
op_minus
id|start
comma
id|dy
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|d
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
id|d
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
id|s
op_increment
suffix:semicolon
id|d
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|d
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
OG
id|start
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|start
comma
id|d
op_minus
id|start
comma
id|dy
comma
id|x
)paren
suffix:semicolon
id|sy
op_increment
suffix:semicolon
id|dy
op_increment
suffix:semicolon
)brace
)brace
DECL|function|fbcon_softback_note
r_static
r_inline
r_void
id|fbcon_softback_note
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_ne
id|fg_console
)paren
r_return
suffix:semicolon
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|t
op_star
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|scr_memcpyw
c_func
(paren
(paren
id|u16
op_star
)paren
id|softback_in
comma
id|p
comma
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|p
op_assign
id|advance_row
c_func
(paren
id|p
comma
l_int|1
)paren
suffix:semicolon
id|softback_in
op_add_assign
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_in
op_eq
id|softback_end
)paren
id|softback_in
op_assign
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|softback_in
op_eq
id|softback_top
)paren
(brace
id|softback_top
op_add_assign
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
op_eq
id|softback_end
)paren
id|softback_top
op_assign
id|softback_buf
suffix:semicolon
)brace
)brace
id|softback_curr
op_assign
id|softback_in
suffix:semicolon
)brace
DECL|function|fbcon_scroll
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|scroll_partial
op_assign
op_logical_neg
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YNOPARTIAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
op_logical_or
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_return
l_int|0
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
multiline_comment|/*&n;     * ++Geert: Only use ywrap/ypan if the console is in text mode&n;     * ++Andrew: Only use ypan on hardware text mode when scrolling the&n;     *           whole screen (prevents flicker).&n;     */
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|SM_UP
suffix:colon
r_if
c_cond
(paren
id|count
OG
id|conp-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
id|fbcon_softback_note
c_func
(paren
id|conp
comma
id|t
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
r_goto
id|redraw_up
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YMASK
)paren
(brace
r_case
id|__SCROLL_YMOVE
suffix:colon
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YWRAP
suffix:colon
r_if
c_cond
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|conp-&gt;vc_rows
op_rshift
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
l_int|0
comma
l_int|0
comma
id|count
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|ywrap_up
c_func
(paren
id|unit
comma
id|conp
comma
id|p
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|b
comma
l_int|0
comma
id|conp-&gt;vc_rows
op_minus
id|b
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YPANREDRAW
)paren
r_goto
id|redraw_up
suffix:semicolon
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YPAN
suffix:colon
r_if
c_cond
(paren
(paren
id|p-&gt;yscroll
op_plus
id|count
op_le
l_int|2
op_star
(paren
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|conp-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|conp-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
l_int|0
comma
l_int|0
comma
id|count
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|ypan_up
c_func
(paren
id|unit
comma
id|conp
comma
id|p
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|b
comma
l_int|0
comma
id|conp-&gt;vc_rows
op_minus
id|b
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YPANREDRAW
)paren
r_goto
id|redraw_up
suffix:semicolon
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YREDRAW
suffix:colon
id|redraw_up
suffix:colon
id|fbcon_redraw
c_func
(paren
id|conp
comma
id|p
comma
id|t
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|count
op_star
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|b
op_minus
id|count
)paren
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
(paren
id|b
op_minus
id|count
)paren
)paren
comma
id|conp-&gt;vc_video_erase_char
comma
id|conp-&gt;vc_size_row
op_star
id|count
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SM_DOWN
suffix:colon
r_if
c_cond
(paren
id|count
OG
id|conp-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YMASK
)paren
(brace
r_case
id|__SCROLL_YMOVE
suffix:colon
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YWRAP
suffix:colon
r_if
c_cond
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|conp-&gt;vc_rows
op_rshift
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|conp-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|b
comma
l_int|0
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|conp-&gt;vc_rows
op_minus
id|b
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|ywrap_down
c_func
(paren
id|unit
comma
id|conp
comma
id|p
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|count
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YPANREDRAW
)paren
r_goto
id|redraw_down
suffix:semicolon
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YPAN
suffix:colon
r_if
c_cond
(paren
(paren
id|count
op_minus
id|p-&gt;yscroll
op_le
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|conp-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|conp-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|conp-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|b
comma
l_int|0
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|conp-&gt;vc_rows
op_minus
id|b
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|ypan_down
c_func
(paren
id|unit
comma
id|conp
comma
id|p
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|count
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YPANREDRAW
)paren
r_goto
id|redraw_down
suffix:semicolon
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YREDRAW
suffix:colon
id|redraw_down
suffix:colon
id|fbcon_redraw
c_func
(paren
id|conp
comma
id|p
comma
id|b
op_minus
l_int|1
comma
id|b
op_minus
id|t
op_minus
id|count
comma
op_minus
id|count
op_star
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|t
)paren
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|t
)paren
comma
id|conp-&gt;vc_video_erase_char
comma
id|conp-&gt;vc_size_row
op_star
id|count
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_bmove
r_static
r_void
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|width
op_logical_or
op_logical_neg
id|height
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|sy
op_plus
id|height
)paren
op_logical_and
(paren
id|sx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|sx
op_plus
id|width
)paren
)paren
op_logical_or
(paren
(paren
id|dy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|dy
op_plus
id|height
)paren
op_logical_and
(paren
id|dx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|dx
op_plus
id|width
)paren
)paren
)paren
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
op_or
id|CM_SOFTBACK
)paren
suffix:semicolon
multiline_comment|/*  Split blits that cross physical y_wrap case.&n;     *  Pathological case involves 4 blits, better to use recursive&n;     *  code rather than unrolled case&n;     *&n;     *  Recursive invocations don&squot;t need to erase the cursor over and&n;     *  over again, so we use fbcon_bmove_rec()&n;     */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
comma
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
)paren
suffix:semicolon
)brace
DECL|function|fbcon_bmove_rec
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
(brace
id|u_int
id|b
suffix:semicolon
r_if
c_cond
(paren
id|sy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|dy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|real_y
c_func
(paren
id|p
comma
id|dy
)paren
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|fbcon_switch
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|conp
)paren
suffix:semicolon
id|softback_top
op_assign
id|softback_curr
op_assign
id|softback_in
op_assign
id|softback_buf
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;&t;       the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
(brace
r_struct
id|vc_data
op_star
id|conp2
op_assign
id|vc_cons
(braket
id|logo_shown
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|conp2-&gt;vc_top
op_eq
id|logo_lines
op_logical_and
id|conp2-&gt;vc_bottom
op_eq
id|conp2-&gt;vc_rows
)paren
id|conp2-&gt;vc_top
op_assign
l_int|0
suffix:semicolon
id|logo_shown
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
op_amp
id|__SCROLL_YMASK
)paren
(brace
r_case
id|__SCROLL_YWRAP
suffix:colon
id|scrollback_phys_max
op_assign
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YPAN
suffix:colon
id|scrollback_phys_max
op_assign
id|p-&gt;vrows
op_minus
l_int|2
op_star
id|conp-&gt;vc_rows
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_phys_max
OL
l_int|0
)paren
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
id|info-&gt;switch_con
)paren
(paren
op_star
id|info-&gt;switch_con
)paren
(paren
id|unit
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;clear_margins
op_logical_and
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|conp
comma
id|p
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_eq
op_minus
l_int|2
)paren
(brace
id|logo_shown
op_assign
id|fg_console
suffix:semicolon
id|fbcon_show_logo
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This is protected above by initmem_freed */
id|update_region
c_func
(paren
id|fg_console
comma
id|conp-&gt;vc_origin
op_plus
id|conp-&gt;vc_size_row
op_star
id|conp-&gt;vc_top
comma
id|conp-&gt;vc_size_row
op_star
(paren
id|conp-&gt;vc_bottom
op_minus
id|conp-&gt;vc_top
)paren
op_div
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|fbcon_blank
r_static
r_int
id|fbcon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|blank
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|conp-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_if
c_cond
(paren
id|blank
OL
l_int|0
)paren
multiline_comment|/* Entering graphics mode */
r_return
l_int|0
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|p-&gt;conp
comma
id|blank
ques
c_cond
id|CM_ERASE
suffix:colon
id|CM_DRAW
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
)paren
(brace
r_if
c_cond
(paren
id|blank
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_MONO01
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;screen_base
)paren
id|fb_memset255
c_func
(paren
id|p-&gt;screen_base
comma
id|p-&gt;var.xres_virtual
op_star
id|p-&gt;var.yres_virtual
op_star
id|p-&gt;var.bits_per_pixel
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|oldc
suffix:semicolon
id|u_int
id|height
suffix:semicolon
id|u_int
id|y_break
suffix:semicolon
id|oldc
op_assign
id|conp-&gt;vc_video_erase_char
suffix:semicolon
id|conp-&gt;vc_video_erase_char
op_and_assign
id|p-&gt;charmask
suffix:semicolon
id|height
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
id|y_break
op_assign
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
suffix:semicolon
r_if
c_cond
(paren
id|height
OG
id|y_break
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
l_int|0
)paren
comma
l_int|0
comma
id|y_break
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|y_break
)paren
comma
l_int|0
comma
id|height
op_minus
id|y_break
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
l_int|0
)paren
comma
l_int|0
comma
id|height
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|conp-&gt;vc_video_erase_char
op_assign
id|oldc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Tell console.c that it has to restore the screen itself */
r_return
l_int|1
suffix:semicolon
)brace
)brace
(paren
op_star
id|info-&gt;blank
)paren
(paren
id|blank
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_free_font
r_static
r_void
id|fbcon_free_font
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;userfont
op_logical_and
id|p-&gt;fontdata
op_logical_and
(paren
op_decrement
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_eq
l_int|0
)paren
)paren
id|kfree
c_func
(paren
id|p-&gt;fontdata
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p-&gt;fontdata
op_assign
l_int|NULL
suffix:semicolon
id|p-&gt;userfont
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_get_font
r_static
r_inline
r_int
id|fbcon_get_font
c_func
(paren
r_int
id|unit
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|op-&gt;data
suffix:semicolon
id|u8
op_star
id|fontdata
op_assign
id|p-&gt;fontdata
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_FONTWIDTH8_ONLY
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_ne
l_int|8
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
id|op-&gt;width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|op-&gt;height
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|op-&gt;charcount
op_assign
(paren
id|p-&gt;charmask
op_eq
l_int|0x1ff
)paren
ques
c_cond
l_int|512
suffix:colon
l_int|256
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;data
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;width
op_le
l_int|8
)paren
(brace
id|j
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|32
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|32
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
macro_line|#ifndef CONFIG_FBCON_FONTWIDTH8_ONLY
r_else
r_if
c_cond
(paren
id|op-&gt;width
op_le
l_int|16
)paren
(brace
id|j
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|64
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|64
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;width
op_le
l_int|24
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|2
)braket
suffix:semicolon
id|fontdata
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
l_int|3
op_star
(paren
l_int|32
op_minus
id|j
)paren
)paren
suffix:semicolon
id|data
op_add_assign
l_int|3
op_star
(paren
l_int|32
op_minus
id|j
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|j
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|128
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|128
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_do_set_font
r_static
r_int
id|fbcon_do_set_font
c_func
(paren
r_int
id|unit
comma
r_struct
id|console_font_op
op_star
id|op
comma
id|u8
op_star
id|data
comma
r_int
id|userfont
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|resize
suffix:semicolon
r_int
id|w
op_assign
id|op-&gt;width
suffix:semicolon
r_int
id|h
op_assign
id|op-&gt;height
suffix:semicolon
r_int
id|cnt
suffix:semicolon
r_char
op_star
id|old_data
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fontwidthvalid
c_func
(paren
id|p
comma
id|w
)paren
)paren
(brace
r_if
c_cond
(paren
id|userfont
op_logical_and
id|op-&gt;op
op_ne
id|KD_FONT_OP_COPY
)paren
id|kfree
c_func
(paren
id|data
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|p-&gt;conp
)paren
op_logical_and
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|p-&gt;conp
)paren
suffix:semicolon
id|resize
op_assign
(paren
id|w
op_ne
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_logical_or
(paren
id|h
op_ne
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|old_data
op_assign
id|p-&gt;fontdata
suffix:semicolon
r_if
c_cond
(paren
id|userfont
)paren
id|cnt
op_assign
id|FNTCHARCNT
c_func
(paren
id|data
)paren
suffix:semicolon
r_else
id|cnt
op_assign
l_int|256
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;userfont
op_assign
id|userfont
)paren
)paren
id|REFCOUNT
c_func
(paren
id|data
)paren
op_increment
suffix:semicolon
id|p-&gt;_fontwidth
op_assign
id|w
suffix:semicolon
id|p-&gt;_fontheight
op_assign
id|h
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;conp-&gt;vc_hi_font_mask
op_logical_and
id|cnt
op_eq
l_int|256
)paren
(brace
id|p-&gt;conp-&gt;vc_hi_font_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;conp-&gt;vc_can_do_color
)paren
id|p-&gt;conp-&gt;vc_complement_mask
op_rshift_assign
l_int|1
suffix:semicolon
id|p-&gt;fgshift
op_decrement
suffix:semicolon
id|p-&gt;bgshift
op_decrement
suffix:semicolon
id|p-&gt;charmask
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* ++Edmund: reorder the attribute bits */
r_if
c_cond
(paren
id|p-&gt;conp-&gt;vc_can_do_color
)paren
(brace
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
r_int
r_int
op_star
id|cp
op_assign
(paren
r_int
r_int
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
r_int
id|count
op_assign
id|conp-&gt;vc_screenbuf_size
op_div
l_int|2
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|cp
op_increment
)paren
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|scr_writew
c_func
(paren
(paren
(paren
id|c
op_amp
l_int|0xfe00
)paren
op_rshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
comma
id|cp
)paren
suffix:semicolon
)brace
id|c
op_assign
id|conp-&gt;vc_video_erase_char
suffix:semicolon
id|conp-&gt;vc_video_erase_char
op_assign
(paren
(paren
id|c
op_amp
l_int|0xfe00
)paren
op_rshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
id|conp-&gt;vc_attr
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;conp-&gt;vc_hi_font_mask
op_logical_and
id|cnt
op_eq
l_int|512
)paren
(brace
id|p-&gt;conp-&gt;vc_hi_font_mask
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;conp-&gt;vc_can_do_color
)paren
id|p-&gt;conp-&gt;vc_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
id|p-&gt;fgshift
op_increment
suffix:semicolon
id|p-&gt;bgshift
op_increment
suffix:semicolon
id|p-&gt;charmask
op_assign
l_int|0x1ff
suffix:semicolon
multiline_comment|/* ++Edmund: reorder the attribute bits */
(brace
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
r_int
r_int
op_star
id|cp
op_assign
(paren
r_int
r_int
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
r_int
id|count
op_assign
id|conp-&gt;vc_screenbuf_size
op_div
l_int|2
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|cp
op_increment
)paren
(brace
r_int
r_int
id|newc
suffix:semicolon
id|c
op_assign
id|scr_readw
c_func
(paren
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_can_do_color
)paren
id|newc
op_assign
(paren
(paren
id|c
op_amp
l_int|0xff00
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
r_else
id|newc
op_assign
id|c
op_amp
op_complement
l_int|0x100
suffix:semicolon
id|scr_writew
c_func
(paren
id|newc
comma
id|cp
)paren
suffix:semicolon
)brace
id|c
op_assign
id|conp-&gt;vc_video_erase_char
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_can_do_color
)paren
(brace
id|conp-&gt;vc_video_erase_char
op_assign
(paren
(paren
id|c
op_amp
l_int|0xff00
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
id|conp-&gt;vc_attr
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|conp-&gt;vc_video_erase_char
op_assign
id|c
op_amp
op_complement
l_int|0x100
suffix:semicolon
)brace
)brace
id|fbcon_font_widths
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resize
)paren
(brace
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
multiline_comment|/* reset wrap/pan */
id|p-&gt;var.xoffset
op_assign
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
id|p-&gt;vrows
op_assign
id|p-&gt;var.yres_virtual
op_div
id|h
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;var.yres
op_mod
id|h
)paren
op_logical_and
(paren
id|p-&gt;var.yres_virtual
op_mod
id|h
OL
id|p-&gt;var.yres
op_mod
id|h
)paren
)paren
id|p-&gt;vrows
op_decrement
suffix:semicolon
id|updatescrollmode
c_func
(paren
id|p
)paren
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|p-&gt;var.yres
op_div
id|h
comma
id|p-&gt;var.xres
op_div
id|w
comma
id|unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|conp
)paren
op_logical_and
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;&t;&t;   the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|p-&gt;conp
)paren
op_logical_and
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;dispsw-&gt;clear_margins
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|p-&gt;conp
comma
id|p
comma
l_int|0
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|unit
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|old_data
op_logical_and
(paren
op_decrement
id|REFCOUNT
c_func
(paren
id|old_data
)paren
op_eq
l_int|0
)paren
)paren
id|kfree
c_func
(paren
id|old_data
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_copy_font
r_static
r_inline
r_int
id|fbcon_copy_font
c_func
(paren
r_int
id|unit
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_struct
id|display
op_star
id|od
comma
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|h
op_assign
id|op-&gt;height
suffix:semicolon
r_if
c_cond
(paren
id|h
OL
l_int|0
op_logical_or
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|h
)paren
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
r_if
c_cond
(paren
id|h
op_eq
id|unit
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing to do */
id|od
op_assign
op_amp
id|fb_display
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|od-&gt;fontdata
op_eq
id|p-&gt;fontdata
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already the same font... */
id|op-&gt;width
op_assign
id|fontwidth
c_func
(paren
id|od
)paren
suffix:semicolon
id|op-&gt;height
op_assign
id|fontheight
c_func
(paren
id|od
)paren
suffix:semicolon
r_return
id|fbcon_do_set_font
c_func
(paren
id|unit
comma
id|op
comma
id|od-&gt;fontdata
comma
id|od-&gt;userfont
)paren
suffix:semicolon
)brace
DECL|function|fbcon_set_font
r_static
r_inline
r_int
id|fbcon_set_font
c_func
(paren
r_int
id|unit
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_int
id|w
op_assign
id|op-&gt;width
suffix:semicolon
r_int
id|h
op_assign
id|op-&gt;height
suffix:semicolon
r_int
id|size
op_assign
id|h
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
id|u8
op_star
id|new_data
comma
op_star
id|data
op_assign
id|op-&gt;data
comma
op_star
id|p
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_FONTWIDTH8_ONLY
r_if
c_cond
(paren
id|w
op_ne
l_int|8
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|w
op_le
l_int|0
)paren
op_logical_or
(paren
id|w
OG
l_int|32
)paren
op_logical_or
(paren
id|op-&gt;charcount
op_ne
l_int|256
op_logical_and
id|op-&gt;charcount
op_ne
l_int|512
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|w
OG
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|w
op_le
l_int|16
)paren
id|size
op_mul_assign
l_int|2
suffix:semicolon
r_else
id|size
op_mul_assign
l_int|4
suffix:semicolon
)brace
id|size
op_mul_assign
id|op-&gt;charcount
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_data
op_assign
id|kmalloc
c_func
(paren
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
op_plus
id|size
comma
id|GFP_USER
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|new_data
op_add_assign
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|FNTSIZE
c_func
(paren
id|new_data
)paren
op_assign
id|size
suffix:semicolon
id|FNTCHARCNT
c_func
(paren
id|new_data
)paren
op_assign
id|op-&gt;charcount
suffix:semicolon
id|REFCOUNT
c_func
(paren
id|new_data
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* usage counter */
id|p
op_assign
id|new_data
suffix:semicolon
r_if
c_cond
(paren
id|w
op_le
l_int|8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|data
comma
id|h
)paren
suffix:semicolon
id|data
op_add_assign
l_int|32
suffix:semicolon
id|p
op_add_assign
id|h
suffix:semicolon
)brace
)brace
macro_line|#ifndef CONFIG_FBCON_FONTWIDTH8_ONLY
r_else
r_if
c_cond
(paren
id|w
op_le
l_int|16
)paren
(brace
id|h
op_mul_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|data
comma
id|h
)paren
suffix:semicolon
id|data
op_add_assign
l_int|64
suffix:semicolon
id|p
op_add_assign
id|h
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|w
op_le
l_int|24
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|h
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|data
comma
l_int|3
)paren
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|data
op_add_assign
l_int|3
suffix:semicolon
id|p
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
id|data
op_add_assign
l_int|3
op_star
(paren
l_int|32
op_minus
id|h
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|h
op_mul_assign
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|data
comma
id|h
)paren
suffix:semicolon
id|data
op_add_assign
l_int|128
suffix:semicolon
id|p
op_add_assign
id|h
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* we can do it in u32 chunks because of charcount is 256 or 512, so&n;       font length must be multiple of 256, at least. And 256 is multiple&n;       of 4 */
id|k
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|p
OG
id|new_data
)paren
id|k
op_add_assign
op_star
op_decrement
(paren
id|u32
op_star
)paren
id|p
suffix:semicolon
id|FNTSUM
c_func
(paren
id|new_data
)paren
op_assign
id|k
suffix:semicolon
multiline_comment|/* Check if the same font is on some other console already */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fb_display
(braket
id|i
)braket
dot
id|userfont
op_logical_and
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
op_logical_and
id|FNTSUM
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
)paren
op_eq
id|k
op_logical_and
id|FNTSIZE
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
)paren
op_eq
id|size
op_logical_and
id|fontwidth
c_func
(paren
op_amp
id|fb_display
(braket
id|i
)braket
)paren
op_eq
id|w
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
comma
id|new_data
comma
id|size
)paren
)paren
(brace
id|kfree
c_func
(paren
id|new_data
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|new_data
op_assign
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|fbcon_do_set_font
c_func
(paren
id|unit
comma
id|op
comma
id|new_data
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|fbcon_set_def_font
r_static
r_inline
r_int
id|fbcon_set_def_font
c_func
(paren
r_int
id|unit
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_char
id|name
(braket
id|MAX_FONT_NAME
)braket
suffix:semicolon
r_struct
id|fbcon_font_desc
op_star
id|f
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;data
)paren
id|f
op_assign
id|fbcon_get_default_font
c_func
(paren
id|p-&gt;var.xres
comma
id|p-&gt;var.yres
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strncpy_from_user
c_func
(paren
id|name
comma
id|op-&gt;data
comma
id|MAX_FONT_NAME
op_minus
l_int|1
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
id|name
(braket
id|MAX_FONT_NAME
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|f
op_assign
id|fbcon_find_font
c_func
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|op-&gt;width
op_assign
id|f-&gt;width
suffix:semicolon
id|op-&gt;height
op_assign
id|f-&gt;height
suffix:semicolon
r_return
id|fbcon_do_set_font
c_func
(paren
id|unit
comma
id|op
comma
id|f-&gt;data
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|fbcon_font_op
r_static
r_int
id|fbcon_font_op
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_switch
c_cond
(paren
id|op-&gt;op
)paren
(brace
r_case
id|KD_FONT_OP_SET
suffix:colon
r_return
id|fbcon_set_font
c_func
(paren
id|unit
comma
id|op
)paren
suffix:semicolon
r_case
id|KD_FONT_OP_GET
suffix:colon
r_return
id|fbcon_get_font
c_func
(paren
id|unit
comma
id|op
)paren
suffix:semicolon
r_case
id|KD_FONT_OP_SET_DEFAULT
suffix:colon
r_return
id|fbcon_set_def_font
c_func
(paren
id|unit
comma
id|op
)paren
suffix:semicolon
r_case
id|KD_FONT_OP_COPY
suffix:colon
r_return
id|fbcon_copy_font
c_func
(paren
id|unit
comma
id|op
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|variable|palette_red
r_static
id|u16
id|palette_red
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_green
r_static
id|u16
id|palette_green
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_blue
r_static
id|u16
id|palette_blue
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_cmap
r_static
r_struct
id|fb_cmap
id|palette_cmap
op_assign
(brace
l_int|0
comma
l_int|16
comma
id|palette_red
comma
id|palette_green
comma
id|palette_blue
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|fbcon_set_palette
r_static
r_int
id|fbcon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
r_char
op_star
id|table
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conp-&gt;vc_can_do_color
op_logical_or
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|k
op_assign
id|table
(braket
id|i
)braket
suffix:semicolon
id|val
op_assign
id|conp-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_red
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
id|val
op_assign
id|conp-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_green
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
id|val
op_assign
id|conp-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_blue
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_le
l_int|4
)paren
id|palette_cmap.len
op_assign
l_int|1
op_lshift
id|p-&gt;var.bits_per_pixel
suffix:semicolon
r_else
id|palette_cmap.len
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.start
op_assign
l_int|0
suffix:semicolon
r_return
id|p-&gt;fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_set_cmap
c_func
(paren
op_amp
id|palette_cmap
comma
l_int|1
comma
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
)brace
DECL|function|fbcon_screen_pos
r_static
id|u16
op_star
id|fbcon_screen_pos
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|offset
)paren
(brace
r_int
id|line
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_ne
id|fg_console
op_logical_or
op_logical_neg
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|offset
)paren
suffix:semicolon
id|line
op_assign
id|offset
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|line
op_ge
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|offset
op_minus
id|softback_lines
op_star
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
id|p
op_assign
id|softback_curr
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|softback_end
)paren
id|p
op_add_assign
id|softback_buf
op_minus
id|softback_end
suffix:semicolon
r_return
(paren
id|u16
op_star
)paren
id|p
suffix:semicolon
)brace
DECL|function|fbcon_getxy
r_static
r_int
r_int
id|fbcon_getxy
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
r_int
id|pos
comma
r_int
op_star
id|px
comma
r_int
op_star
id|py
)paren
(brace
r_int
id|x
comma
id|y
suffix:semicolon
r_int
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|conp-&gt;vc_origin
op_logical_and
id|pos
OL
id|conp-&gt;vc_scr_end
)paren
(brace
r_int
r_int
id|offset
op_assign
(paren
id|pos
op_minus
id|conp-&gt;vc_origin
)paren
op_div
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|conp-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|conp-&gt;vc_cols
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_eq
id|fg_console
)paren
id|y
op_add_assign
id|softback_lines
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|conp-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_eq
id|fg_console
op_logical_and
id|softback_lines
)paren
(brace
r_int
r_int
id|offset
op_assign
id|pos
op_minus
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|softback_curr
)paren
id|offset
op_add_assign
id|softback_end
op_minus
id|softback_buf
suffix:semicolon
id|offset
op_div_assign
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|conp-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|conp-&gt;vc_cols
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|conp-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_end
)paren
id|ret
op_assign
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_in
)paren
id|ret
op_assign
id|conp-&gt;vc_origin
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Should not happen */
id|x
op_assign
id|y
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|conp-&gt;vc_origin
suffix:semicolon
)brace
r_if
c_cond
(paren
id|px
)paren
op_star
id|px
op_assign
id|x
suffix:semicolon
r_if
c_cond
(paren
id|py
)paren
op_star
id|py
op_assign
id|y
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* As we might be inside of softback, we may work with non-contiguous buffer,&n;   that&squot;s why we have to use a separate routine. */
DECL|function|fbcon_invert_region
r_static
r_void
id|fbcon_invert_region
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
id|u16
op_star
id|p
comma
r_int
id|cnt
)paren
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|conp-&gt;vc_can_do_color
)paren
op_star
id|p
op_increment
op_xor_assign
l_int|0x0800
suffix:semicolon
r_else
r_if
c_cond
(paren
id|conp-&gt;vc_hi_font_mask
op_eq
l_int|0x100
)paren
(brace
id|u16
id|a
op_assign
op_star
id|p
suffix:semicolon
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x11ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0xe000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0e00
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|a
suffix:semicolon
)brace
r_else
(brace
id|u16
id|a
op_assign
op_star
id|p
suffix:semicolon
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x7000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0700
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|a
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|p
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|p
op_assign
(paren
id|u16
op_star
)paren
id|conp-&gt;vc_origin
suffix:semicolon
)brace
)brace
DECL|function|fbcon_scrolldelta
r_static
r_int
id|fbcon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|lines
)paren
(brace
r_int
id|unit
comma
id|offset
comma
id|limit
comma
id|scrollback_old
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
id|unit
op_assign
id|fg_console
suffix:semicolon
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
(brace
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_ne
id|unit
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
op_logical_or
op_logical_neg
id|lines
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
(brace
r_struct
id|vc_data
op_star
id|conp2
op_assign
id|vc_cons
(braket
id|logo_shown
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|conp2-&gt;vc_top
op_eq
id|logo_lines
op_logical_and
id|conp2-&gt;vc_bottom
op_eq
id|conp2-&gt;vc_rows
)paren
id|conp2-&gt;vc_top
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_eq
id|unit
)paren
(brace
r_int
r_int
id|p
comma
id|q
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
id|softback_in
suffix:semicolon
id|q
op_assign
id|conp-&gt;vc_origin
op_plus
id|logo_lines
op_star
id|conp-&gt;vc_size_row
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p
op_eq
id|softback_top
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
id|softback_buf
)paren
id|p
op_assign
id|softback_end
suffix:semicolon
id|p
op_sub_assign
id|conp-&gt;vc_size_row
suffix:semicolon
id|q
op_sub_assign
id|conp-&gt;vc_size_row
suffix:semicolon
id|scr_memcpyw
c_func
(paren
(paren
id|u16
op_star
)paren
id|q
comma
(paren
id|u16
op_star
)paren
id|p
comma
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
)brace
id|softback_in
op_assign
id|p
suffix:semicolon
id|update_region
c_func
(paren
id|unit
comma
id|conp-&gt;vc_origin
comma
id|logo_lines
op_star
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
id|logo_shown
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
op_or
id|CM_SOFTBACK
)paren
suffix:semicolon
id|fbcon_redraw_softback
c_func
(paren
id|conp
comma
id|p
comma
id|lines
)paren
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_DRAW
op_or
id|CM_SOFTBACK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|scrollback_phys_max
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|scrollback_old
op_assign
id|scrollback_current
suffix:semicolon
id|scrollback_current
op_sub_assign
id|lines
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_current
OL
l_int|0
)paren
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scrollback_current
OG
id|scrollback_max
)paren
id|scrollback_current
op_assign
id|scrollback_max
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_current
op_eq
id|scrollback_old
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
(paren
id|console_blanked
op_logical_or
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
op_logical_or
op_logical_neg
id|lines
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
id|offset
op_assign
id|p-&gt;yscroll
op_minus
id|scrollback_current
suffix:semicolon
id|limit
op_assign
id|p-&gt;vrows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
op_logical_and
id|__SCROLL_YMASK
)paren
(brace
r_case
id|__SCROLL_YWRAP
suffix:colon
id|p-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__SCROLL_YPAN
suffix:colon
id|limit
op_sub_assign
id|conp-&gt;vc_rows
suffix:semicolon
id|p-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
OL
l_int|0
)paren
id|offset
op_add_assign
id|limit
suffix:semicolon
r_else
r_if
c_cond
(paren
id|offset
op_ge
id|limit
)paren
id|offset
op_sub_assign
id|limit
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|offset
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scrollback_current
)paren
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_DRAW
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_set_origin
r_static
r_int
id|fbcon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_if
c_cond
(paren
id|softback_lines
op_logical_and
op_logical_neg
id|console_blanked
)paren
id|fbcon_scrolldelta
c_func
(paren
id|conp
comma
id|softback_lines
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|safe_shift
r_static
r_inline
r_int
id|safe_shift
c_func
(paren
r_int
id|d
comma
r_int
id|n
)paren
(brace
r_return
id|n
OL
l_int|0
ques
c_cond
id|d
op_rshift
op_minus
id|n
suffix:colon
id|d
op_lshift
id|n
suffix:semicolon
)brace
DECL|function|fbcon_show_logo
r_static
r_int
id|__init
id|fbcon_show_logo
c_func
(paren
r_void
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|fg_console
)braket
suffix:semicolon
multiline_comment|/* draw to vt in foreground */
r_int
id|depth
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
r_int
id|line
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
r_char
op_star
id|fb
op_assign
id|p-&gt;screen_base
suffix:semicolon
r_int
r_char
op_star
id|logo
suffix:semicolon
r_int
r_char
op_star
id|dst
comma
op_star
id|src
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|n
comma
id|x1
comma
id|y1
comma
id|x
suffix:semicolon
r_int
id|logo_depth
comma
id|done
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Return if the frame buffer is not mapped */
r_if
c_cond
(paren
op_logical_neg
id|fb
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Set colors if visual is PSEUDOCOLOR and we have enough colors, or for&n;     * DIRECTCOLOR */
r_if
c_cond
(paren
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_PSEUDOCOLOR
op_logical_and
id|depth
op_ge
l_int|4
)paren
op_logical_or
id|p-&gt;visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
r_int
id|is_truecolor
op_assign
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
suffix:semicolon
r_int
id|use_256
op_assign
(paren
op_logical_neg
id|is_truecolor
op_logical_and
id|depth
op_ge
l_int|8
)paren
op_logical_or
(paren
id|is_truecolor
op_logical_and
id|depth
op_ge
l_int|24
)paren
suffix:semicolon
r_int
id|first_col
op_assign
id|use_256
ques
c_cond
l_int|32
suffix:colon
id|depth
OG
l_int|4
ques
c_cond
l_int|16
suffix:colon
l_int|0
suffix:semicolon
r_int
id|num_cols
op_assign
id|use_256
ques
c_cond
id|LINUX_LOGO_COLORS
suffix:colon
l_int|16
suffix:semicolon
r_int
r_char
op_star
id|red
comma
op_star
id|green
comma
op_star
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|use_256
)paren
(brace
id|red
op_assign
id|linux_logo_red
suffix:semicolon
id|green
op_assign
id|linux_logo_green
suffix:semicolon
id|blue
op_assign
id|linux_logo_blue
suffix:semicolon
)brace
r_else
(brace
id|red
op_assign
id|linux_logo16_red
suffix:semicolon
id|green
op_assign
id|linux_logo16_green
suffix:semicolon
id|blue
op_assign
id|linux_logo16_blue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_cols
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|n
op_assign
id|num_cols
op_minus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|16
)paren
multiline_comment|/* palette_cmap provides space for only 16 colors at once */
id|n
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.start
op_assign
id|first_col
op_plus
id|i
suffix:semicolon
id|palette_cmap.len
op_assign
id|n
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
op_increment
id|j
)paren
(brace
id|palette_cmap.red
(braket
id|j
)braket
op_assign
(paren
id|red
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|red
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|palette_cmap.green
(braket
id|j
)braket
op_assign
(paren
id|green
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|green
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|palette_cmap.blue
(braket
id|j
)braket
op_assign
(paren
id|blue
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|blue
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
)brace
id|p-&gt;fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_set_cmap
c_func
(paren
op_amp
id|palette_cmap
comma
l_int|1
comma
id|fg_console
comma
id|p-&gt;fb_info
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|depth
op_ge
l_int|8
)paren
(brace
id|logo
op_assign
id|linux_logo
suffix:semicolon
id|logo_depth
op_assign
l_int|8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|depth
op_ge
l_int|4
)paren
(brace
id|logo
op_assign
id|linux_logo16
suffix:semicolon
id|logo_depth
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|logo
op_assign
id|linux_logo_bw
suffix:semicolon
id|logo_depth
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;fb_info-&gt;fbops-&gt;fb_rasterimg
)paren
id|p-&gt;fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_rasterimg
c_func
(paren
id|p-&gt;fb_info
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|smp_num_cpus
op_star
(paren
id|LOGO_W
op_plus
l_int|8
)paren
op_logical_and
id|x
OL
id|p-&gt;var.xres
op_minus
(paren
id|LOGO_W
op_plus
l_int|8
)paren
suffix:semicolon
id|x
op_add_assign
(paren
id|LOGO_W
op_plus
l_int|8
)paren
)paren
(brace
macro_line|#if defined(CONFIG_FBCON_CFB16) || defined(CONFIG_FBCON_CFB24) || &bslash;&n;    defined(CONFIG_FBCON_CFB32) || defined(CONFIG_FB_SBUS)
r_if
c_cond
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
multiline_comment|/* max. depth 32! */
r_int
id|bdepth
suffix:semicolon
r_int
id|redshift
comma
id|greenshift
comma
id|blueshift
suffix:semicolon
multiline_comment|/* Bug: Doesn&squot;t obey msb_right ... (who needs that?) */
id|redshift
op_assign
id|p-&gt;var.red.offset
suffix:semicolon
id|greenshift
op_assign
id|p-&gt;var.green.offset
suffix:semicolon
id|blueshift
op_assign
id|p-&gt;var.blue.offset
suffix:semicolon
r_if
c_cond
(paren
id|depth
op_ge
l_int|24
op_logical_and
(paren
id|depth
op_mod
l_int|8
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* have at least 8 bits per color */
id|src
op_assign
id|logo
suffix:semicolon
id|bdepth
op_assign
id|depth
op_div
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
op_star
id|bdepth
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
suffix:semicolon
id|x1
op_increment
comma
id|src
op_increment
)paren
(brace
id|val
op_assign
(paren
op_star
id|src
op_lshift
id|redshift
)paren
op_or
(paren
op_star
id|src
op_lshift
id|greenshift
)paren
op_or
(paren
op_star
id|src
op_lshift
id|blueshift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdepth
op_eq
l_int|4
op_logical_and
op_logical_neg
(paren
(paren
r_int
)paren
id|dst
op_amp
l_int|3
)paren
)paren
(brace
multiline_comment|/* Some cards require 32bit access */
id|fb_writel
(paren
id|val
comma
id|dst
)paren
suffix:semicolon
id|dst
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef __LITTLE_ENDIAN
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bdepth
suffix:semicolon
op_increment
id|i
)paren
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
id|bdepth
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
macro_line|#endif
id|fb_writeb
(paren
id|val
op_rshift
(paren
id|i
op_star
l_int|8
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|depth
op_ge
l_int|15
op_logical_and
id|depth
op_le
l_int|23
)paren
(brace
multiline_comment|/* have 5..7 bits per color, using 16 color image */
r_int
r_int
id|pix
suffix:semicolon
id|src
op_assign
id|linux_logo16
suffix:semicolon
id|bdepth
op_assign
(paren
id|depth
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
op_star
id|bdepth
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
op_div
l_int|2
suffix:semicolon
id|x1
op_increment
comma
id|src
op_increment
)paren
(brace
id|pix
op_assign
(paren
op_star
id|src
op_rshift
l_int|4
)paren
op_or
l_int|0x10
suffix:semicolon
multiline_comment|/* upper nibble */
id|val
op_assign
(paren
id|pix
op_lshift
id|redshift
)paren
op_or
(paren
id|pix
op_lshift
id|greenshift
)paren
op_or
(paren
id|pix
op_lshift
id|blueshift
)paren
suffix:semicolon
macro_line|#ifdef __LITTLE_ENDIAN
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bdepth
suffix:semicolon
op_increment
id|i
)paren
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
id|bdepth
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
macro_line|#endif
id|fb_writeb
(paren
id|val
op_rshift
(paren
id|i
op_star
l_int|8
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
id|pix
op_assign
(paren
op_star
id|src
op_amp
l_int|0x0f
)paren
op_or
l_int|0x10
suffix:semicolon
multiline_comment|/* lower nibble */
id|val
op_assign
(paren
id|pix
op_lshift
id|redshift
)paren
op_or
(paren
id|pix
op_lshift
id|greenshift
)paren
op_or
(paren
id|pix
op_lshift
id|blueshift
)paren
suffix:semicolon
macro_line|#ifdef __LITTLE_ENDIAN
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bdepth
suffix:semicolon
op_increment
id|i
)paren
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
id|bdepth
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
macro_line|#endif
id|fb_writeb
(paren
id|val
op_rshift
(paren
id|i
op_star
l_int|8
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_CFB16) || defined(CONFIG_FBCON_CFB24) || &bslash;&n;    defined(CONFIG_FBCON_CFB32) || defined(CONFIG_FB_SBUS)
r_if
c_cond
(paren
(paren
id|depth
op_mod
l_int|8
op_eq
l_int|0
)paren
op_logical_and
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_TRUECOLOR
)paren
)paren
(brace
multiline_comment|/* Modes without color mapping, needs special data transformation... */
r_int
r_int
id|val
suffix:semicolon
multiline_comment|/* max. depth 32! */
r_int
id|bdepth
op_assign
id|depth
op_div
l_int|8
suffix:semicolon
r_int
r_char
id|mask
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
l_int|0x80
comma
l_int|0xc0
comma
l_int|0xe0
comma
l_int|0xf0
comma
l_int|0xf8
comma
l_int|0xfc
comma
l_int|0xfe
comma
l_int|0xff
)brace
suffix:semicolon
r_int
r_char
id|redmask
comma
id|greenmask
comma
id|bluemask
suffix:semicolon
r_int
id|redshift
comma
id|greenshift
comma
id|blueshift
suffix:semicolon
multiline_comment|/* Bug: Doesn&squot;t obey msb_right ... (who needs that?) */
id|redmask
op_assign
id|mask
(braket
id|p-&gt;var.red.length
OL
l_int|8
ques
c_cond
id|p-&gt;var.red.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|greenmask
op_assign
id|mask
(braket
id|p-&gt;var.green.length
OL
l_int|8
ques
c_cond
id|p-&gt;var.green.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|bluemask
op_assign
id|mask
(braket
id|p-&gt;var.blue.length
OL
l_int|8
ques
c_cond
id|p-&gt;var.blue.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|redshift
op_assign
id|p-&gt;var.red.offset
op_minus
(paren
l_int|8
op_minus
id|p-&gt;var.red.length
)paren
suffix:semicolon
id|greenshift
op_assign
id|p-&gt;var.green.offset
op_minus
(paren
l_int|8
op_minus
id|p-&gt;var.green.length
)paren
suffix:semicolon
id|blueshift
op_assign
id|p-&gt;var.blue.offset
op_minus
(paren
l_int|8
op_minus
id|p-&gt;var.blue.length
)paren
suffix:semicolon
id|src
op_assign
id|logo
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
op_star
id|bdepth
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
suffix:semicolon
id|x1
op_increment
comma
id|src
op_increment
)paren
(brace
id|val
op_assign
id|safe_shift
c_func
(paren
(paren
id|linux_logo_red
(braket
op_star
id|src
op_minus
l_int|32
)braket
op_amp
id|redmask
)paren
comma
id|redshift
)paren
op_or
id|safe_shift
c_func
(paren
(paren
id|linux_logo_green
(braket
op_star
id|src
op_minus
l_int|32
)braket
op_amp
id|greenmask
)paren
comma
id|greenshift
)paren
op_or
id|safe_shift
c_func
(paren
(paren
id|linux_logo_blue
(braket
op_star
id|src
op_minus
l_int|32
)braket
op_amp
id|bluemask
)paren
comma
id|blueshift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdepth
op_eq
l_int|4
op_logical_and
op_logical_neg
(paren
(paren
r_int
)paren
id|dst
op_amp
l_int|3
)paren
)paren
(brace
multiline_comment|/* Some cards require 32bit access */
id|fb_writel
(paren
id|val
comma
id|dst
)paren
suffix:semicolon
id|dst
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef __LITTLE_ENDIAN
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bdepth
suffix:semicolon
op_increment
id|i
)paren
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
id|bdepth
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
macro_line|#endif
id|fb_writeb
(paren
id|val
op_rshift
(paren
id|i
op_star
l_int|8
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_CFB4)
r_if
c_cond
(paren
id|depth
op_eq
l_int|4
op_logical_and
id|p-&gt;type
op_eq
id|FB_TYPE_PACKED_PIXELS
)paren
(brace
id|src
op_assign
id|logo
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
op_div
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
op_div
l_int|2
suffix:semicolon
id|x1
op_increment
)paren
(brace
id|u8
id|q
op_assign
op_star
id|src
op_increment
suffix:semicolon
id|q
op_assign
(paren
id|q
op_lshift
l_int|4
)paren
op_or
(paren
id|q
op_rshift
l_int|4
)paren
suffix:semicolon
id|fb_writeb
(paren
id|q
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_CFB8) || defined(CONFIG_FB_SBUS)
r_if
c_cond
(paren
id|depth
op_eq
l_int|8
op_logical_and
id|p-&gt;type
op_eq
id|FB_TYPE_PACKED_PIXELS
)paren
(brace
multiline_comment|/* depth 8 or more, packed, with color registers */
id|src
op_assign
id|logo
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
suffix:semicolon
id|x1
op_increment
)paren
(brace
id|fb_writeb
(paren
op_star
id|src
op_increment
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_AFB) || defined(CONFIG_FBCON_ILBM) || &bslash;&n;    defined(CONFIG_FBCON_IPLAN2P2) || defined(CONFIG_FBCON_IPLAN2P4) || &bslash;&n;    defined(CONFIG_FBCON_IPLAN2P8)
r_if
c_cond
(paren
id|depth
op_ge
l_int|2
op_logical_and
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_PLANES
op_logical_or
id|p-&gt;type
op_eq
id|FB_TYPE_INTERLEAVED_PLANES
)paren
)paren
(brace
multiline_comment|/* planes (normal or interleaved), with color registers */
r_int
id|bit
suffix:semicolon
r_int
r_char
id|val
comma
id|mask
suffix:semicolon
r_int
id|plane
op_assign
id|p-&gt;next_plane
suffix:semicolon
macro_line|#if defined(CONFIG_FBCON_IPLAN2P2) || defined(CONFIG_FBCON_IPLAN2P4) || &bslash;&n;    defined(CONFIG_FBCON_IPLAN2P8)
r_int
id|line_length
op_assign
id|p-&gt;line_length
suffix:semicolon
multiline_comment|/* for support of Atari interleaved planes */
DECL|macro|MAP_X
mdefine_line|#define MAP_X(x)&t;(line_length ? (x) : ((x) &amp; ~1)*depth + ((x) &amp; 1))
macro_line|#else
mdefine_line|#define MAP_X(x)&t;(x)
macro_line|#endif
multiline_comment|/* extract a bit from the source image */
DECL|macro|BIT
mdefine_line|#define&t;BIT(p,pix,bit)&t;(p[pix*logo_depth/8] &amp; &bslash;&n;&t;&t;&t; (1 &lt;&lt; ((8-((pix*logo_depth)&amp;7)-logo_depth) + bit)))
id|src
op_assign
id|logo
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_LINE
suffix:semicolon
id|x1
op_increment
comma
id|src
op_add_assign
id|logo_depth
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|MAP_X
c_func
(paren
id|x
op_div
l_int|8
op_plus
id|x1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
id|logo_depth
suffix:semicolon
id|bit
op_increment
)paren
(brace
id|val
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|mask
op_assign
l_int|0x80
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|mask
op_rshift_assign
l_int|1
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|BIT
c_func
(paren
id|src
comma
id|i
comma
id|bit
)paren
)paren
id|val
op_or_assign
id|mask
suffix:semicolon
)brace
op_star
id|dst
op_assign
id|val
suffix:semicolon
id|dst
op_add_assign
id|plane
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* fill remaining planes&n;&t;     * special case for logo_depth == 4: we used color registers 16..31,&n;&t;     * so fill plane 4 with 1 bits instead of 0 */
r_if
c_cond
(paren
id|depth
OG
id|logo_depth
)paren
(brace
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_LINE
suffix:semicolon
id|x1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|MAP_X
c_func
(paren
id|x
op_div
l_int|8
op_plus
id|x1
)paren
op_plus
id|logo_depth
op_star
id|plane
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|logo_depth
suffix:semicolon
id|i
OL
id|depth
suffix:semicolon
id|i
op_increment
comma
id|dst
op_add_assign
id|plane
)paren
(brace
op_star
id|dst
op_assign
(paren
id|i
op_eq
id|logo_depth
op_logical_and
id|logo_depth
op_eq
l_int|4
)paren
ques
c_cond
l_int|0xff
suffix:colon
l_int|0x00
suffix:semicolon
)brace
)brace
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_MFB) || defined(CONFIG_FBCON_AFB) || &bslash;&n;    defined(CONFIG_FBCON_ILBM) || defined(CONFIG_FBCON_HGA)
r_if
c_cond
(paren
id|depth
op_eq
l_int|1
op_logical_and
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_PACKED_PIXELS
op_logical_or
id|p-&gt;type
op_eq
id|FB_TYPE_PLANES
op_logical_or
id|p-&gt;type
op_eq
id|FB_TYPE_INTERLEAVED_PLANES
)paren
)paren
(brace
multiline_comment|/* monochrome */
r_int
r_char
id|inverse
op_assign
id|p-&gt;inverse
op_logical_or
id|p-&gt;visual
op_eq
id|FB_VISUAL_MONO01
ques
c_cond
l_int|0x00
suffix:colon
l_int|0xff
suffix:semicolon
r_int
id|is_hga
op_assign
op_logical_neg
id|strncmp
c_func
(paren
id|p-&gt;fb_info-&gt;modename
comma
l_string|&quot;HGA&quot;
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* can&squot;t use simply memcpy because need to apply inverse */
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
id|src
op_assign
id|logo
op_plus
id|y1
op_star
id|LOGO_LINE
suffix:semicolon
r_if
c_cond
(paren
id|is_hga
)paren
id|dst
op_assign
id|fb
op_plus
(paren
id|y1
op_mod
l_int|4
)paren
op_star
l_int|8192
op_plus
(paren
id|y1
op_rshift
l_int|2
)paren
op_star
id|line
op_plus
id|x
op_div
l_int|8
suffix:semicolon
r_else
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x
op_div
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_LINE
suffix:semicolon
op_increment
id|x1
)paren
(brace
id|fb_writeb
c_func
(paren
id|fb_readb
c_func
(paren
id|src
op_increment
)paren
op_xor
id|inverse
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_VGA_PLANES)
r_if
c_cond
(paren
id|depth
op_eq
l_int|4
op_logical_and
id|p-&gt;type
op_eq
id|FB_TYPE_VGA_PLANES
)paren
(brace
id|outb_p
c_func
(paren
l_int|1
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xf
comma
l_int|0x3cf
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|3
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3cf
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|5
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3cf
)paren
suffix:semicolon
id|src
op_assign
id|logo
suffix:semicolon
r_for
c_loop
(paren
id|y1
op_assign
l_int|0
suffix:semicolon
id|y1
OL
id|LOGO_H
suffix:semicolon
id|y1
op_increment
)paren
(brace
r_for
c_loop
(paren
id|x1
op_assign
l_int|0
suffix:semicolon
id|x1
OL
id|LOGO_W
op_div
l_int|2
suffix:semicolon
id|x1
op_increment
)paren
(brace
id|dst
op_assign
id|fb
op_plus
id|y1
op_star
id|line
op_plus
id|x1
op_div
l_int|4
op_plus
id|x
op_div
l_int|8
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
op_star
id|src
op_rshift
l_int|4
comma
l_int|0x3cf
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|8
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|1
op_lshift
(paren
l_int|7
op_minus
id|x1
op_mod
l_int|4
op_star
l_int|2
)paren
comma
l_int|0x3cf
)paren
suffix:semicolon
id|fb_readb
(paren
id|dst
)paren
suffix:semicolon
id|fb_writeb
(paren
l_int|0
comma
id|dst
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
op_star
id|src
op_amp
l_int|0xf
comma
l_int|0x3cf
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|8
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|1
op_lshift
(paren
l_int|7
op_minus
(paren
l_int|1
op_plus
id|x1
op_mod
l_int|4
op_star
l_int|2
)paren
)paren
comma
l_int|0x3cf
)paren
suffix:semicolon
id|fb_readb
(paren
id|dst
)paren
suffix:semicolon
id|fb_writeb
(paren
l_int|0
comma
id|dst
)paren
suffix:semicolon
id|src
op_increment
suffix:semicolon
)brace
)brace
id|done
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;
)brace
r_if
c_cond
(paren
id|p-&gt;fb_info-&gt;fbops-&gt;fb_rasterimg
)paren
id|p-&gt;fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_rasterimg
c_func
(paren
id|p-&gt;fb_info
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Modes not yet supported: packed pixels with depth != 8 (does such a&n;     * thing exist in reality?) */
r_return
id|done
ques
c_cond
(paren
id|LOGO_H
op_plus
id|fontheight
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
op_div
id|fontheight
c_func
(paren
id|p
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  The console `switch&squot; structure for the frame buffer based console&n; */
DECL|variable|fb_con
r_const
r_struct
id|consw
id|fb_con
op_assign
(brace
id|con_startup
suffix:colon
id|fbcon_startup
comma
id|con_init
suffix:colon
id|fbcon_init
comma
id|con_deinit
suffix:colon
id|fbcon_deinit
comma
id|con_clear
suffix:colon
id|fbcon_clear
comma
id|con_putc
suffix:colon
id|fbcon_putc
comma
id|con_putcs
suffix:colon
id|fbcon_putcs
comma
id|con_cursor
suffix:colon
id|fbcon_cursor
comma
id|con_scroll
suffix:colon
id|fbcon_scroll
comma
id|con_bmove
suffix:colon
id|fbcon_bmove
comma
id|con_switch
suffix:colon
id|fbcon_switch
comma
id|con_blank
suffix:colon
id|fbcon_blank
comma
id|con_font_op
suffix:colon
id|fbcon_font_op
comma
id|con_set_palette
suffix:colon
id|fbcon_set_palette
comma
id|con_scrolldelta
suffix:colon
id|fbcon_scrolldelta
comma
id|con_set_origin
suffix:colon
id|fbcon_set_origin
comma
id|con_invert_region
suffix:colon
id|fbcon_invert_region
comma
id|con_screen_pos
suffix:colon
id|fbcon_screen_pos
comma
id|con_getxy
suffix:colon
id|fbcon_getxy
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Dummy Low Level Operations&n; */
DECL|function|fbcon_dummy_op
r_static
r_void
id|fbcon_dummy_op
c_func
(paren
r_void
)paren
(brace
)brace
DECL|macro|DUMMY
mdefine_line|#define DUMMY&t;(void *)fbcon_dummy_op
DECL|variable|fbcon_dummy
r_struct
id|display_switch
id|fbcon_dummy
op_assign
(brace
id|setup
suffix:colon
id|DUMMY
comma
id|bmove
suffix:colon
id|DUMMY
comma
id|clear
suffix:colon
id|DUMMY
comma
id|putc
suffix:colon
id|DUMMY
comma
id|putcs
suffix:colon
id|DUMMY
comma
id|revc
suffix:colon
id|DUMMY
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Visible symbols for modules&n; */
DECL|variable|fb_display
id|EXPORT_SYMBOL
c_func
(paren
id|fb_display
)paren
suffix:semicolon
DECL|variable|fbcon_redraw_bmove
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_redraw_bmove
)paren
suffix:semicolon
DECL|variable|fbcon_redraw_clear
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_redraw_clear
)paren
suffix:semicolon
DECL|variable|fbcon_dummy
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_dummy
)paren
suffix:semicolon
DECL|variable|fb_con
id|EXPORT_SYMBOL
c_func
(paren
id|fb_con
)paren
suffix:semicolon
eof
