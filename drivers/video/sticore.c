macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sti.h&quot;
DECL|variable|default_sti
r_struct
id|sti_struct
id|default_sti
op_assign
(brace
id|SPIN_LOCK_UNLOCKED
comma
)brace
suffix:semicolon
DECL|variable|default_font_flags
r_static
r_struct
id|sti_font_flags
id|default_font_flags
op_assign
(brace
id|STI_WAIT
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/* The colour indices used by STI are&n; *   0 - Black&n; *   1 - White&n; *   2 - Red&n; *   3 - Yellow/Brown&n; *   4 - Green&n; *   5 - Cyan&n; *   6 - Blue&n; *   7 - Magenta&n; *&n; * So we have the same colours as VGA (basically one bit each for R, G, B),&n; * but have to translate them, anyway. */
DECL|variable|col_trans
r_static
id|u8
id|col_trans
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|6
comma
l_int|4
comma
l_int|5
comma
l_int|2
comma
l_int|7
comma
l_int|3
comma
l_int|1
)brace
suffix:semicolon
DECL|macro|c_fg
mdefine_line|#define c_fg(sti, c) col_trans[((c&gt;&gt; 8) &amp; 7)]
DECL|macro|c_bg
mdefine_line|#define c_bg(sti, c) col_trans[((c&gt;&gt;11) &amp; 7)]
DECL|macro|c_index
mdefine_line|#define c_index(sti, c) (c&amp;0xff)
DECL|variable|default_init_flags
r_static
r_struct
id|sti_init_flags
id|default_init_flags
op_assign
(brace
id|STI_WAIT
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
r_void
DECL|function|sti_init_graph
id|sti_init_graph
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
(brace
r_struct
id|sti_init_inptr_ext
id|inptr_ext
op_assign
(brace
l_int|0
comma
(brace
l_int|0
)brace
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_init_inptr
id|inptr
op_assign
(brace
l_int|3
comma
id|STI_PTR
c_func
(paren
op_amp
id|inptr_ext
)paren
)brace
suffix:semicolon
r_struct
id|sti_init_outptr
id|outptr
op_assign
(brace
l_int|0
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|s32
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;init_graph
comma
op_amp
id|default_init_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sti-&gt;text_planes
op_assign
id|outptr.text_planes
suffix:semicolon
)brace
DECL|variable|default_conf_flags
r_static
r_struct
id|sti_conf_flags
id|default_conf_flags
op_assign
(brace
id|STI_WAIT
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
r_void
DECL|function|sti_inq_conf
id|sti_inq_conf
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
(brace
r_struct
id|sti_conf_inptr
id|inptr
op_assign
(brace
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_conf_outptr_ext
id|outptr_ext
op_assign
(brace
id|future_ptr
suffix:colon
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_conf_outptr
id|outptr
op_assign
(brace
id|ext_ptr
suffix:colon
id|STI_PTR
c_func
(paren
op_amp
id|outptr_ext
)paren
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;inq_conf
comma
op_amp
id|default_conf_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
r_void
DECL|function|sti_putc
id|sti_putc
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
r_struct
id|sti_font_inptr
id|inptr
op_assign
(brace
(paren
id|u32
)paren
id|sti-&gt;font
comma
id|c_index
c_func
(paren
id|sti
comma
id|c
)paren
comma
id|c_fg
c_func
(paren
id|sti
comma
id|c
)paren
comma
id|c_bg
c_func
(paren
id|sti
comma
id|c
)paren
comma
id|x
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|y
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_font_outptr
id|outptr
op_assign
(brace
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;font_unpmv
comma
op_amp
id|default_font_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|variable|clear_blkmv_flags
r_static
r_struct
id|sti_blkmv_flags
id|clear_blkmv_flags
op_assign
(brace
id|STI_WAIT
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
r_void
DECL|function|sti_set
id|sti_set
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
comma
id|u8
id|color
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
id|color
comma
id|color
comma
id|src_x
comma
id|src_y
comma
id|src_x
comma
id|src_y
comma
id|width
comma
id|height
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
id|s32
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|clear_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
r_void
DECL|function|sti_clear
id|sti_clear
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
l_int|0
comma
l_int|0
comma
id|src_x
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|src_y
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
id|src_x
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|src_y
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
id|width
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|height
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
id|s32
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|clear_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|variable|default_blkmv_flags
r_static
r_struct
id|sti_blkmv_flags
id|default_blkmv_flags
op_assign
(brace
id|STI_WAIT
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
r_void
DECL|function|sti_bmove
id|sti_bmove
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|dst_y
comma
r_int
id|dst_x
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
l_int|0
comma
l_int|0
comma
id|src_x
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|src_y
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
id|dst_x
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|dst_y
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
id|width
op_star
id|sti_font_x
c_func
(paren
id|sti
)paren
comma
id|height
op_star
id|sti_font_y
c_func
(paren
id|sti
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
l_int|NULL
)brace
suffix:semicolon
id|s32
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|default_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|sti_rom_copy
id|sti_rom_copy
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|count
comma
r_void
op_star
id|dest
)paren
(brace
r_void
op_star
id|savedest
op_assign
id|dest
suffix:semicolon
r_int
id|savecount
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|count
op_sub_assign
l_int|4
suffix:semicolon
op_star
(paren
id|u32
op_star
)paren
id|dest
op_assign
id|gsc_readl
c_func
(paren
id|base
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
l_int|4
suffix:semicolon
id|dest
op_add_assign
l_int|4
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
op_star
(paren
id|u8
op_star
)paren
id|dest
op_assign
id|gsc_readb
c_func
(paren
id|base
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_increment
suffix:semicolon
id|dest
op_increment
suffix:semicolon
)brace
id|__flush_dcache_range
c_func
(paren
(paren
r_int
r_int
)paren
id|dest
comma
id|count
)paren
suffix:semicolon
id|__flush_icache_range
c_func
(paren
(paren
r_int
r_int
)paren
id|dest
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|dump_sti_rom
r_static
r_void
id|dump_sti_rom
c_func
(paren
r_struct
id|sti_rom
op_star
id|rom
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;STI word mode ROM type %d&bslash;n&quot;
comma
id|rom-&gt;type
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; supports %d monitors&bslash;n&quot;
comma
id|rom-&gt;num_mons
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; conforms to STI ROM spec revision %d.%02x&bslash;n&quot;
comma
id|rom-&gt;revno
(braket
l_int|0
)braket
op_rshift
l_int|4
comma
id|rom-&gt;revno
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; graphics id %02x%02x%02x%02x%02x%02x%02x%02x&bslash;n&quot;
comma
id|rom-&gt;graphics_id
(braket
l_int|0
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|1
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|2
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|3
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|4
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|5
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|6
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; font start %08x&bslash;n&quot;
comma
id|rom-&gt;font_start
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; region list %08x&bslash;n&quot;
comma
id|rom-&gt;region_list
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; init_graph %08x&bslash;n&quot;
comma
id|rom-&gt;init_graph
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; alternate code type %d&bslash;n&quot;
comma
id|rom-&gt;alt_code_type
)paren
suffix:semicolon
)brace
DECL|function|sti_cook_fonts
r_static
r_void
id|__init
id|sti_cook_fonts
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|cooked_rom
comma
r_struct
id|sti_rom
op_star
id|raw_rom
)paren
(brace
r_struct
id|sti_rom_font
op_star
id|raw_font
suffix:semicolon
r_struct
id|sti_cooked_font
op_star
id|cooked_font
suffix:semicolon
r_struct
id|sti_rom_font
op_star
id|font_start
suffix:semicolon
id|cooked_font
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|cooked_font
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked_font
)paren
(brace
r_return
suffix:semicolon
)brace
id|cooked_rom-&gt;font_start
op_assign
id|cooked_font
suffix:semicolon
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|raw_rom
)paren
op_plus
(paren
id|raw_rom-&gt;font_start
)paren
suffix:semicolon
id|font_start
op_assign
id|raw_font
suffix:semicolon
id|cooked_font-&gt;raw
op_assign
id|raw_font
suffix:semicolon
r_while
c_loop
(paren
id|raw_font-&gt;next_font
)paren
(brace
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|font_start
)paren
op_plus
(paren
id|raw_font-&gt;next_font
)paren
suffix:semicolon
id|cooked_font-&gt;next_font
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|cooked_font
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked_font-&gt;next_font
)paren
(brace
r_return
suffix:semicolon
)brace
id|cooked_font
op_assign
id|cooked_font-&gt;next_font
suffix:semicolon
id|cooked_font-&gt;raw
op_assign
id|raw_font
suffix:semicolon
)brace
id|cooked_font-&gt;next_font
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|font_index
DECL|variable|font_height
DECL|variable|font_width
r_static
r_int
id|font_index
comma
id|font_height
comma
id|font_width
suffix:semicolon
DECL|function|sti_font_setup
r_static
r_int
id|__init
id|sti_font_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|x
suffix:semicolon
multiline_comment|/* we accept sti_font=10x20, sti_font=10*20 or sti_font=7 style&n;&t; * command lines. */
r_if
c_cond
(paren
(paren
id|x
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;x&squot;
)paren
)paren
op_logical_or
(paren
id|x
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;*&squot;
)paren
)paren
)paren
(brace
id|font_height
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|font_width
op_assign
id|simple_strtoul
c_func
(paren
id|x
op_plus
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|font_index
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;sti_font=&quot;
comma
id|sti_font_setup
)paren
suffix:semicolon
DECL|function|sti_search_font
r_static
r_int
id|__init
id|sti_search_font
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|rom
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|sti_cooked_font
op_star
id|font
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|font
op_assign
id|rom-&gt;font_start
suffix:semicolon
id|font
suffix:semicolon
id|font
op_assign
id|font-&gt;next_font
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|font-&gt;raw-&gt;width
op_eq
id|width
)paren
op_logical_and
(paren
id|font-&gt;raw-&gt;height
op_eq
id|height
)paren
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|sti_cooked_font
op_star
id|__init
DECL|function|sti_select_font
id|sti_select_font
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|rom
)paren
(brace
r_struct
id|sti_cooked_font
op_star
id|font
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|font_width
op_logical_and
id|font_height
)paren
(brace
id|font_index
op_assign
id|sti_search_font
c_func
(paren
id|rom
comma
id|font_height
comma
id|font_width
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|font
op_assign
id|rom-&gt;font_start
comma
id|i
op_assign
id|font_index
suffix:semicolon
id|font
op_logical_and
(paren
id|i
OG
l_int|0
)paren
suffix:semicolon
id|font
op_assign
id|font-&gt;next_font
comma
id|i
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|font
)paren
(brace
r_return
id|font
suffix:semicolon
)brace
r_else
r_return
id|rom-&gt;font_start
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|sti_dump_globcfg_ext
id|sti_dump_globcfg_ext
c_func
(paren
r_struct
id|sti_glob_cfg_ext
op_star
id|cfg
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;monitor %d&bslash;n&quot;
l_string|&quot;in friendly mode: %d&bslash;n&quot;
l_string|&quot;power consumption %d watts&bslash;n&quot;
l_string|&quot;freq ref %d&bslash;n&quot;
l_string|&quot;sti_mem_addr %p&bslash;n&quot;
comma
id|cfg-&gt;curr_mon
comma
id|cfg-&gt;friendly_boot
comma
id|cfg-&gt;power
comma
id|cfg-&gt;freq_ref
comma
id|cfg-&gt;sti_mem_addr
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|sti_dump_globcfg
id|sti_dump_globcfg
c_func
(paren
r_struct
id|sti_glob_cfg
op_star
id|glob_cfg
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d text planes&bslash;n&quot;
l_string|&quot;%4d x %4d screen resolution&bslash;n&quot;
l_string|&quot;%4d x %4d offscreen&bslash;n&quot;
l_string|&quot;%4d x %4d layout&bslash;n&quot;
l_string|&quot;regions at %08x %08x %08x %08x&bslash;n&quot;
l_string|&quot;regions at %08x %08x %08x %08x&bslash;n&quot;
l_string|&quot;reent_lvl %d&bslash;n&quot;
l_string|&quot;save_addr %p&bslash;n&quot;
comma
id|glob_cfg-&gt;text_planes
comma
id|glob_cfg-&gt;onscreen_x
comma
id|glob_cfg-&gt;onscreen_y
comma
id|glob_cfg-&gt;offscreen_x
comma
id|glob_cfg-&gt;offscreen_y
comma
id|glob_cfg-&gt;total_x
comma
id|glob_cfg-&gt;total_y
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|0
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|1
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|2
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|3
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|4
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|5
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|6
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|7
)braket
comma
id|glob_cfg-&gt;reent_lvl
comma
id|glob_cfg-&gt;save_addr
)paren
suffix:semicolon
id|sti_dump_globcfg_ext
c_func
(paren
id|PTR_STI
c_func
(paren
id|glob_cfg-&gt;ext_ptr
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|sti_init_glob_cfg
id|sti_init_glob_cfg
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
r_int
id|hpa
comma
r_int
r_int
id|rom_address
)paren
(brace
r_struct
id|sti_glob_cfg
op_star
id|glob_cfg
suffix:semicolon
r_struct
id|sti_glob_cfg_ext
op_star
id|glob_cfg_ext
suffix:semicolon
r_void
op_star
id|save_addr
suffix:semicolon
r_void
op_star
id|sti_mem_addr
suffix:semicolon
id|glob_cfg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|sti-&gt;glob_cfg
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|glob_cfg_ext
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|glob_cfg_ext
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|save_addr
op_assign
id|kmalloc
c_func
(paren
l_int|1024
multiline_comment|/*XXX*/
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|sti_mem_addr
op_assign
id|kmalloc
c_func
(paren
l_int|1024
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|glob_cfg
)paren
op_logical_or
(paren
op_logical_neg
id|glob_cfg_ext
)paren
op_logical_or
(paren
op_logical_neg
id|save_addr
)paren
op_logical_or
(paren
op_logical_neg
id|sti_mem_addr
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|glob_cfg
comma
l_int|0
comma
r_sizeof
op_star
id|glob_cfg
)paren
suffix:semicolon
id|memset
c_func
(paren
id|glob_cfg_ext
comma
l_int|0
comma
r_sizeof
op_star
id|glob_cfg_ext
)paren
suffix:semicolon
id|memset
c_func
(paren
id|save_addr
comma
l_int|0
comma
l_int|1024
)paren
suffix:semicolon
id|memset
c_func
(paren
id|sti_mem_addr
comma
l_int|0
comma
l_int|1024
)paren
suffix:semicolon
id|glob_cfg-&gt;ext_ptr
op_assign
id|STI_PTR
c_func
(paren
id|glob_cfg_ext
)paren
suffix:semicolon
id|glob_cfg-&gt;save_addr
op_assign
id|STI_PTR
c_func
(paren
id|save_addr
)paren
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|0
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|rom_address
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|1
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|2
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|3
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|4
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|4
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|5
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|5
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|6
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|6
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg-&gt;region_ptrs
(braket
l_int|7
)braket
op_assign
(paren
(paren
id|sti-&gt;regions
(braket
l_int|7
)braket
op_rshift
l_int|18
)paren
op_lshift
l_int|12
)paren
op_plus
id|hpa
suffix:semicolon
id|glob_cfg_ext-&gt;sti_mem_addr
op_assign
id|STI_PTR
c_func
(paren
id|sti_mem_addr
)paren
suffix:semicolon
id|sti-&gt;glob_cfg
op_assign
id|STI_PTR
c_func
(paren
id|glob_cfg
)paren
suffix:semicolon
)brace
multiline_comment|/* address is a pointer to a word mode or pci rom */
r_static
r_struct
id|sti_struct
op_star
id|__init
DECL|function|sti_read_rom
id|sti_read_rom
c_func
(paren
r_int
r_int
id|address
)paren
(brace
r_struct
id|sti_struct
op_star
id|ret
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sti_cooked_rom
op_star
id|cooked
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sti_rom
op_star
id|raw
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|ret
op_assign
op_amp
id|default_sti
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_goto
id|out_err
suffix:semicolon
)brace
id|cooked
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|cooked
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|raw
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|raw
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|raw
op_logical_and
id|cooked
)paren
)paren
(brace
r_goto
id|out_err
suffix:semicolon
)brace
multiline_comment|/* reallocate raw */
id|sti_rom_copy
c_func
(paren
id|address
comma
l_int|0
comma
r_sizeof
op_star
id|raw
comma
id|raw
)paren
suffix:semicolon
id|dump_sti_rom
c_func
(paren
id|raw
)paren
suffix:semicolon
id|size
op_assign
id|raw-&gt;last_addr
suffix:semicolon
multiline_comment|/* kfree(raw); */
id|raw
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|raw
)paren
(brace
r_goto
id|out_err
suffix:semicolon
)brace
id|sti_rom_copy
c_func
(paren
id|address
comma
l_int|0
comma
id|size
comma
id|raw
)paren
suffix:semicolon
id|sti_cook_fonts
c_func
(paren
id|cooked
comma
id|raw
)paren
suffix:semicolon
macro_line|#if 0
id|sti_cook_regions
c_func
(paren
id|cooked
comma
id|raw
)paren
suffix:semicolon
id|sti_cook_functions
c_func
(paren
id|cooked
comma
id|raw
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|raw-&gt;region_list
)paren
(brace
id|ret-&gt;regions
op_assign
id|kmalloc
c_func
(paren
l_int|32
comma
id|GFP_KERNEL
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|memcpy
c_func
(paren
id|ret-&gt;regions
comma
(paren
(paren
r_void
op_star
)paren
id|raw
)paren
op_plus
id|raw-&gt;region_list
comma
l_int|32
)paren
suffix:semicolon
)brace
id|address
op_assign
id|virt_to_phys
c_func
(paren
id|raw
)paren
suffix:semicolon
id|ret-&gt;font_unpmv
op_assign
id|address
op_plus
(paren
id|raw-&gt;font_unpmv
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|ret-&gt;block_move
op_assign
id|address
op_plus
(paren
id|raw-&gt;block_move
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|ret-&gt;init_graph
op_assign
id|address
op_plus
(paren
id|raw-&gt;init_graph
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|ret-&gt;inq_conf
op_assign
id|address
op_plus
(paren
id|raw-&gt;inq_conf
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|ret-&gt;rom
op_assign
id|cooked
suffix:semicolon
id|ret-&gt;rom-&gt;raw
op_assign
id|raw
suffix:semicolon
id|ret-&gt;font
op_assign
(paren
r_struct
id|sti_rom_font
op_star
)paren
id|virt_to_phys
c_func
(paren
id|sti_select_font
c_func
(paren
id|ret-&gt;rom
)paren
op_member_access_from_pointer
id|raw
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
id|out_err
suffix:colon
r_if
c_cond
(paren
id|raw
)paren
(brace
id|kfree
c_func
(paren
id|raw
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cooked
)paren
(brace
id|kfree
c_func
(paren
id|cooked
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|sti_struct
op_star
id|__init
DECL|function|sti_try_rom
id|sti_try_rom
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|hpa
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|sig
suffix:semicolon
id|test_rom
suffix:colon
multiline_comment|/* if we can&squot;t read the ROM, bail out early.  Not being able&n;&t; * to read the hpa is okay, for romless sti */
r_if
c_cond
(paren
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
id|address
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;found potential STI ROM at %08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|sig
op_assign
id|le16_to_cpu
c_func
(paren
id|gsc_readw
c_func
(paren
id|address
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sig
op_eq
l_int|0x55aa
)paren
op_logical_or
(paren
id|sig
op_eq
l_int|0xaa55
)paren
)paren
(brace
id|address
op_add_assign
id|le32_to_cpu
c_func
(paren
id|gsc_readl
c_func
(paren
id|address
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sig %04x, PCI STI ROM at %08lx&bslash;n&quot;
comma
id|sig
comma
id|address
)paren
suffix:semicolon
r_goto
id|test_rom
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sig
op_amp
l_int|0xff
)paren
op_eq
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;STI byte mode ROM at %08lx, ignored&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|sti
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sig
op_eq
l_int|0x0303
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;STI word mode ROM at %08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|sti
op_assign
id|sti_read_rom
c_func
(paren
id|address
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* this is hacked.  We need a better way to find out the HPA for&n;&t; * romless STI (eg search for the graphics devices we know about&n;&t; * by sversion) */
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf5000000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;f4000000 g&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf7000000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;f6000000 g&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf9000000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;f8000000 g&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xfb000000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;fa000000 g&bslash;n&quot;
)paren
suffix:semicolon
id|sti_init_glob_cfg
c_func
(paren
id|sti
comma
id|hpa
comma
id|address
)paren
suffix:semicolon
id|sti_init_graph
c_func
(paren
id|sti
)paren
suffix:semicolon
id|sti_inq_conf
c_func
(paren
id|sti
)paren
suffix:semicolon
id|sti_dump_globcfg
c_func
(paren
id|PTR_STI
c_func
(paren
id|sti-&gt;glob_cfg
)paren
)paren
suffix:semicolon
r_return
id|sti
suffix:semicolon
)brace
DECL|variable|sti_address
r_static
r_int
r_int
id|sti_address
suffix:semicolon
DECL|variable|sti_hpa
r_static
r_int
r_int
id|sti_hpa
suffix:semicolon
multiline_comment|/* XXX: should build a list of STI ROMs */
r_struct
id|sti_struct
op_star
id|__init
DECL|function|sti_init_roms
id|sti_init_roms
c_func
(paren
r_void
)paren
(brace
r_struct
id|sti_struct
op_star
id|tmp
op_assign
l_int|NULL
comma
op_star
id|sti
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* handle the command line */
r_if
c_cond
(paren
id|sti_address
op_logical_and
id|sti_hpa
)paren
(brace
r_return
id|sti_try_rom
c_func
(paren
id|sti_address
comma
id|sti_hpa
)paren
suffix:semicolon
)brace
multiline_comment|/* 712, 715, some other boxes don&squot;t have a separate STI ROM,&n;&t; * but use part of the regular flash */
r_if
c_cond
(paren
id|PAGE0-&gt;proc_sti
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;STI ROM from PDC at %08x&bslash;n&quot;
comma
id|PAGE0-&gt;proc_sti
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf9000000
)paren
)paren
id|sti
op_assign
id|sti_try_rom
c_func
(paren
id|PAGE0-&gt;proc_sti
comma
l_int|0xf8000000
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf5000000
)paren
)paren
id|sti
op_assign
id|sti_try_rom
c_func
(paren
id|PAGE0-&gt;proc_sti
comma
l_int|0xf4000000
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf7000000
)paren
)paren
id|sti
op_assign
id|sti_try_rom
c_func
(paren
id|PAGE0-&gt;proc_sti
comma
l_int|0xf6000000
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xfb000000
)paren
)paren
id|sti
op_assign
id|sti_try_rom
c_func
(paren
id|PAGE0-&gt;proc_sti
comma
l_int|0xfa000000
)paren
suffix:semicolon
)brace
multiline_comment|/* standard locations for GSC graphic devices */
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf4000000
)paren
)paren
id|tmp
op_assign
id|sti_try_rom
c_func
(paren
l_int|0xf4000000
comma
l_int|0xf4000000
)paren
suffix:semicolon
id|sti
op_assign
id|tmp
ques
c_cond
id|tmp
suffix:colon
id|sti
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf6000000
)paren
)paren
id|tmp
op_assign
id|sti_try_rom
c_func
(paren
l_int|0xf6000000
comma
l_int|0xf6000000
)paren
suffix:semicolon
id|sti
op_assign
id|tmp
ques
c_cond
id|tmp
suffix:colon
id|sti
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xf8000000
)paren
)paren
id|tmp
op_assign
id|sti_try_rom
c_func
(paren
l_int|0xf8000000
comma
l_int|0xf8000000
)paren
suffix:semicolon
id|sti
op_assign
id|tmp
ques
c_cond
id|tmp
suffix:colon
id|sti
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdc_add_valid
c_func
(paren
(paren
r_void
op_star
)paren
l_int|0xfa000000
)paren
)paren
id|tmp
op_assign
id|sti_try_rom
c_func
(paren
l_int|0xfa000000
comma
l_int|0xfa000000
)paren
suffix:semicolon
id|sti
op_assign
id|tmp
ques
c_cond
id|tmp
suffix:colon
id|sti
suffix:semicolon
r_return
id|sti
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|sti_setup
id|sti_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|end
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|str
comma
l_string|&quot;pdc&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|sti_address
op_assign
id|PAGE0-&gt;proc_sti
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|sti_address
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|end
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_eq
id|str
)paren
op_logical_or
(paren
id|sti_address
OL
l_int|0xf0000000
)paren
)paren
(brace
id|sti_address
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sti_hpa
op_assign
id|sti_address
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;sti=&quot;
comma
id|sti_setup
)paren
suffix:semicolon
eof
