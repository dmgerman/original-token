multiline_comment|/*&n; * newport_con.c: Abscon for newport hardware&n; * &n; * (C) 1998 Thomas Bogendoerfer (tsbogend@alpha.franken.de)&n; * (C) 1999 Ulf Carlsson (ulfc@thepuffingruop.com)&n; * &n; * This driver is based on sgicons.c and cons_newport.&n; * &n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; * Copyright (C) 1997 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;video/newport.h&gt;
DECL|macro|INCLUDE_LINUX_LOGO_DATA
mdefine_line|#define INCLUDE_LINUX_LOGO_DATA
macro_line|#include &lt;asm/linux_logo.h&gt;
macro_line|#include &lt;video/font.h&gt;
DECL|macro|LOGO_W
mdefine_line|#define LOGO_W&t;&t;80
DECL|macro|LOGO_H
mdefine_line|#define LOGO_H&t;&t;80
r_extern
r_struct
id|fbcon_font_desc
id|font_vga_8x16
suffix:semicolon
DECL|macro|FONT_DATA
mdefine_line|#define FONT_DATA ((unsigned char *)font_vga_8x16.data)
r_extern
r_struct
id|newport_regs
op_star
id|npregs
suffix:semicolon
DECL|variable|logo_active
r_static
r_int
id|logo_active
suffix:semicolon
DECL|variable|topscan
r_static
r_int
id|topscan
suffix:semicolon
DECL|variable|xcurs_correction
r_static
r_int
id|xcurs_correction
op_assign
l_int|29
suffix:semicolon
DECL|variable|newport_xsize
r_static
r_int
id|newport_xsize
suffix:semicolon
DECL|variable|newport_ysize
r_static
r_int
id|newport_ysize
suffix:semicolon
DECL|macro|BMASK
mdefine_line|#define BMASK(c) (c &lt;&lt; 24)
DECL|macro|RENDER
mdefine_line|#define RENDER(regs, cp) do { &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0x0]); (regs)-&gt;go.zpattern = BMASK((cp)[0x1]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0x2]); (regs)-&gt;go.zpattern = BMASK((cp)[0x3]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0x4]); (regs)-&gt;go.zpattern = BMASK((cp)[0x5]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0x6]); (regs)-&gt;go.zpattern = BMASK((cp)[0x7]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0x8]); (regs)-&gt;go.zpattern = BMASK((cp)[0x9]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0xa]); (regs)-&gt;go.zpattern = BMASK((cp)[0xb]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0xc]); (regs)-&gt;go.zpattern = BMASK((cp)[0xd]); &bslash;&n;(regs)-&gt;go.zpattern = BMASK((cp)[0xe]); (regs)-&gt;go.zpattern = BMASK((cp)[0xf]); &bslash;&n;} while(0)
DECL|macro|TESTVAL
mdefine_line|#define TESTVAL 0xdeadbeef
DECL|macro|XSTI_TO_FXSTART
mdefine_line|#define XSTI_TO_FXSTART(val) (((val) &amp; 0xffff) &lt;&lt; 11)
DECL|function|newport_render_background
r_static
r_inline
r_void
id|newport_render_background
c_func
(paren
r_int
id|xstart
comma
r_int
id|ystart
comma
r_int
id|xend
comma
r_int
id|yend
comma
r_int
id|ci
)paren
(brace
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|npregs-&gt;set.wrmask
op_assign
l_int|0xffffffff
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_DRAW
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_DOSETUP
op_or
id|NPORT_DMODE0_STOPX
op_or
id|NPORT_DMODE0_STOPY
)paren
suffix:semicolon
id|npregs-&gt;set.colori
op_assign
id|ci
suffix:semicolon
id|npregs-&gt;set.xystarti
op_assign
(paren
id|xstart
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|ystart
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
)paren
suffix:semicolon
id|npregs-&gt;go.xyendi
op_assign
(paren
(paren
id|xend
op_plus
l_int|7
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|yend
op_plus
id|topscan
op_plus
l_int|15
)paren
op_amp
l_int|0x3ff
)paren
suffix:semicolon
)brace
DECL|function|newport_init_cmap
r_static
r_inline
r_void
id|newport_init_cmap
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
id|newport_cmap_setaddr
c_func
(paren
id|npregs
comma
id|color_table
(braket
id|i
)braket
)paren
suffix:semicolon
id|newport_cmap_setrgb
c_func
(paren
id|npregs
comma
id|default_red
(braket
id|i
)braket
comma
id|default_grn
(braket
id|i
)braket
comma
id|default_blu
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|newport_show_logo
r_static
r_inline
r_void
id|newport_show_logo
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LINUX_LOGO_COLORS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
id|newport_cmap_setaddr
c_func
(paren
id|npregs
comma
id|i
op_plus
l_int|0x20
)paren
suffix:semicolon
id|newport_cmap_setrgb
c_func
(paren
id|npregs
comma
id|linux_logo_red
(braket
id|i
)braket
comma
id|linux_logo_green
(braket
id|i
)braket
comma
id|linux_logo_blue
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_DRAW
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_CHOST
)paren
suffix:semicolon
id|npregs-&gt;set.xystarti
op_assign
(paren
(paren
id|newport_xsize
op_minus
id|LOGO_W
)paren
op_lshift
l_int|16
)paren
op_or
(paren
l_int|0
)paren
suffix:semicolon
id|npregs-&gt;set.xyendi
op_assign
(paren
(paren
id|newport_xsize
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LOGO_W
op_star
id|LOGO_H
suffix:semicolon
id|i
op_increment
)paren
id|npregs-&gt;go.hostrw0
op_assign
id|linux_logo
(braket
id|i
)braket
op_lshift
l_int|24
suffix:semicolon
)brace
DECL|function|newport_clear_screen
r_static
r_inline
r_void
id|newport_clear_screen
c_func
(paren
r_int
id|xstart
comma
r_int
id|ystart
comma
r_int
id|xend
comma
r_int
id|yend
comma
r_int
id|ci
)paren
(brace
r_if
c_cond
(paren
id|logo_active
)paren
r_return
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|npregs-&gt;set.wrmask
op_assign
l_int|0xffffffff
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_DRAW
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_DOSETUP
op_or
id|NPORT_DMODE0_STOPX
op_or
id|NPORT_DMODE0_STOPY
)paren
suffix:semicolon
id|npregs-&gt;set.colori
op_assign
id|ci
suffix:semicolon
id|npregs-&gt;set.xystarti
op_assign
(paren
id|xstart
op_lshift
l_int|16
)paren
op_or
id|ystart
suffix:semicolon
id|npregs-&gt;go.xyendi
op_assign
(paren
id|xend
op_lshift
l_int|16
)paren
op_or
id|yend
suffix:semicolon
)brace
DECL|function|newport_clear_lines
r_static
r_inline
r_void
id|newport_clear_lines
c_func
(paren
r_int
id|ystart
comma
r_int
id|yend
comma
r_int
id|ci
)paren
(brace
id|ystart
op_assign
(paren
(paren
id|ystart
op_lshift
l_int|4
)paren
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|yend
op_assign
(paren
(paren
id|yend
op_lshift
l_int|4
)paren
op_plus
id|topscan
op_plus
l_int|15
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|newport_clear_screen
(paren
l_int|0
comma
id|ystart
comma
l_int|1280
op_plus
l_int|63
comma
id|yend
comma
id|ci
)paren
suffix:semicolon
)brace
DECL|function|newport_reset
r_void
id|newport_reset
(paren
r_void
)paren
(brace
r_int
r_int
id|treg
suffix:semicolon
r_int
id|i
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
comma
(paren
id|treg
op_or
id|VC2_CTRL_EVIDEO
)paren
)paren
suffix:semicolon
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CENTRY
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_RADDR
comma
id|treg
)paren
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|NPORT_DMODE_AVC2
op_or
id|VC2_REGADDR_RAM
op_or
id|NPORT_DMODE_W2
op_or
id|VC2_PROTOCOL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|92
op_logical_or
id|i
op_eq
l_int|94
)paren
id|npregs-&gt;set.dcbdata0.byshort.s1
op_assign
l_int|0xff00
suffix:semicolon
r_else
id|npregs-&gt;set.dcbdata0.byshort.s1
op_assign
l_int|0x0000
suffix:semicolon
)brace
id|newport_init_cmap
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* turn off popup plane */
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_XMAP0
op_or
id|R_DCB_XMAP9_PROTOCOL
op_or
id|XM9_CRS_CONFIG
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|npregs-&gt;set.dcbdata0.bybytes.b3
op_and_assign
op_complement
id|XM9_PUPMODE
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_XMAP1
op_or
id|R_DCB_XMAP9_PROTOCOL
op_or
id|XM9_CRS_CONFIG
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|npregs-&gt;set.dcbdata0.bybytes.b3
op_and_assign
op_complement
id|XM9_PUPMODE
suffix:semicolon
id|topscan
op_assign
l_int|0
suffix:semicolon
id|npregs-&gt;cset.topscan
op_assign
l_int|0x3ff
suffix:semicolon
id|npregs-&gt;cset.xywin
op_assign
(paren
l_int|4096
op_lshift
l_int|16
)paren
op_or
l_int|4096
suffix:semicolon
multiline_comment|/* Clear the screen. */
id|newport_clear_screen
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|1280
op_plus
l_int|63
comma
l_int|1024
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * calculate the actual screen size by reading&n; * the video timing out of the VC2&n; */
DECL|function|newport_get_screensize
r_void
id|newport_get_screensize
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|cols
suffix:semicolon
r_int
r_int
id|ventry
comma
id|treg
suffix:semicolon
r_int
r_int
id|linetable
(braket
l_int|128
)braket
suffix:semicolon
multiline_comment|/* should be enough */
id|ventry
op_assign
id|newport_vc2_get
(paren
id|npregs
comma
id|VC2_IREG_VENTRY
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_RADDR
comma
id|ventry
)paren
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|NPORT_DMODE_AVC2
op_or
id|VC2_REGADDR_RAM
op_or
id|NPORT_DMODE_W2
op_or
id|VC2_PROTOCOL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
id|linetable
(braket
id|i
)braket
op_assign
id|npregs-&gt;set.dcbdata0.byshort.s1
suffix:semicolon
)brace
id|newport_xsize
op_assign
id|newport_ysize
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|linetable
(braket
id|i
op_plus
l_int|1
)braket
op_logical_and
(paren
id|i
OL
r_sizeof
(paren
id|linetable
)paren
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|cols
op_assign
l_int|0
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_RADDR
comma
id|linetable
(braket
id|i
)braket
)paren
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|NPORT_DMODE_AVC2
op_or
id|VC2_REGADDR_RAM
op_or
id|NPORT_DMODE_W2
op_or
id|VC2_PROTOCOL
)paren
suffix:semicolon
r_do
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
id|treg
op_assign
id|npregs-&gt;set.dcbdata0.byshort.s1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|treg
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
id|cols
op_add_assign
(paren
id|treg
op_rshift
l_int|7
)paren
op_amp
l_int|0xfe
suffix:semicolon
r_if
c_cond
(paren
(paren
id|treg
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|newport_bfwait
c_func
(paren
)paren
suffix:semicolon
id|treg
op_assign
id|npregs-&gt;set.dcbdata0.byshort.s1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|treg
op_amp
l_int|0x8000
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cols
)paren
(brace
r_if
c_cond
(paren
id|cols
OG
id|newport_xsize
)paren
id|newport_xsize
op_assign
id|cols
suffix:semicolon
id|newport_ysize
op_add_assign
id|linetable
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
)brace
id|printk
(paren
l_string|&quot;NG1: Screensize %dx%d&bslash;n&quot;
comma
id|newport_xsize
comma
id|newport_ysize
)paren
suffix:semicolon
)brace
DECL|function|newport_get_revisions
r_static
r_void
id|newport_get_revisions
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|board_rev
suffix:semicolon
r_int
r_int
id|rex3_rev
suffix:semicolon
r_int
r_int
id|vc2_rev
suffix:semicolon
r_int
r_int
id|cmap_rev
suffix:semicolon
r_int
r_int
id|xmap9_rev
suffix:semicolon
r_int
r_int
id|bt445_rev
suffix:semicolon
r_int
r_int
id|bitplanes
suffix:semicolon
id|rex3_rev
op_assign
id|npregs-&gt;cset.status
op_amp
id|NPORT_STAT_VERS
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_CMAP0
op_or
id|NCMAP_PROTOCOL
op_or
id|NCMAP_REGADDR_RREG
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|tmp
op_assign
id|npregs-&gt;set.dcbdata0.bybytes.b3
suffix:semicolon
id|cmap_rev
op_assign
id|tmp
op_amp
l_int|7
suffix:semicolon
id|board_rev
op_assign
(paren
id|tmp
op_rshift
l_int|4
)paren
op_amp
l_int|7
suffix:semicolon
id|bitplanes
op_assign
(paren
(paren
id|board_rev
OG
l_int|1
)paren
op_logical_and
(paren
id|tmp
op_amp
l_int|0x80
)paren
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|24
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_CMAP1
op_or
id|NCMAP_PROTOCOL
op_or
id|NCMAP_REGADDR_RREG
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|tmp
op_assign
id|npregs-&gt;set.dcbdata0.bybytes.b3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|7
)paren
OL
id|cmap_rev
)paren
id|cmap_rev
op_assign
(paren
id|tmp
op_amp
l_int|7
)paren
suffix:semicolon
id|vc2_rev
op_assign
(paren
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONFIG
)paren
op_rshift
l_int|5
)paren
op_amp
l_int|7
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_XMAP0
op_or
id|R_DCB_XMAP9_PROTOCOL
op_or
id|XM9_CRS_REVISION
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|xmap9_rev
op_assign
id|npregs-&gt;set.dcbdata0.bybytes.b3
op_amp
l_int|7
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_BT445
op_or
id|BT445_PROTOCOL
op_or
id|BT445_CSR_ADDR_REG
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|npregs-&gt;set.dcbdata0.bybytes.b3
op_assign
id|BT445_REVISION_REG
suffix:semicolon
id|npregs-&gt;set.dcbmode
op_assign
(paren
id|DCB_BT445
op_or
id|BT445_PROTOCOL
op_or
id|BT445_CSR_REVISION
op_or
id|NPORT_DMODE_W1
)paren
suffix:semicolon
id|bt445_rev
op_assign
(paren
id|npregs-&gt;set.dcbdata0.bybytes.b3
op_rshift
l_int|4
)paren
op_minus
l_int|0x0a
suffix:semicolon
DECL|macro|L
mdefine_line|#define L(a)     (char)(&squot;A&squot;+(a))
id|printk
(paren
l_string|&quot;NG1: Revision %d, %d bitplanes, REX3 revision %c, VC2 revision %c, xmap9 revision %c, cmap revision %c, bt445 revision %c&bslash;n&quot;
comma
id|board_rev
comma
id|bitplanes
comma
id|L
c_func
(paren
id|rex3_rev
)paren
comma
id|L
c_func
(paren
id|vc2_rev
)paren
comma
id|L
c_func
(paren
id|xmap9_rev
)paren
comma
id|L
c_func
(paren
id|cmap_rev
ques
c_cond
(paren
id|cmap_rev
op_plus
l_int|1
)paren
suffix:colon
l_int|0
)paren
comma
id|L
c_func
(paren
id|bt445_rev
)paren
)paren
suffix:semicolon
DECL|macro|L
macro_line|#undef L
r_if
c_cond
(paren
id|board_rev
op_eq
l_int|3
)paren
multiline_comment|/* I don&squot;t know all affected revisions */
id|xcurs_correction
op_assign
l_int|21
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|newport_startup
r_static
r_const
r_char
op_star
id|newport_startup
c_func
(paren
r_void
)paren
macro_line|#else
r_static
r_const
r_char
op_star
id|__init
id|newport_startup
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
r_struct
id|newport_regs
op_star
id|p
suffix:semicolon
id|npregs
op_assign
(paren
r_struct
id|newport_regs
op_star
)paren
(paren
id|KSEG1
op_plus
l_int|0x1f0f0000
)paren
suffix:semicolon
id|p
op_assign
id|npregs
suffix:semicolon
id|p-&gt;cset.config
op_assign
id|NPORT_CFG_GD0
suffix:semicolon
r_if
c_cond
(paren
id|newport_wait
c_func
(paren
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|p-&gt;set.xstarti
op_assign
id|TESTVAL
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;set._xstart.word
op_ne
id|XSTI_TO_FXSTART
c_func
(paren
id|TESTVAL
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|newport_reset
(paren
)paren
suffix:semicolon
id|newport_get_revisions
c_func
(paren
)paren
suffix:semicolon
id|newport_get_screensize
c_func
(paren
)paren
suffix:semicolon
singleline_comment|// gfx_init (display_desc);
r_return
l_string|&quot;SGI Newport&quot;
suffix:semicolon
)brace
DECL|function|newport_init
r_static
r_void
id|newport_init
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|init
)paren
(brace
id|vc-&gt;vc_cols
op_assign
id|newport_xsize
op_div
l_int|8
suffix:semicolon
id|vc-&gt;vc_rows
op_assign
id|newport_ysize
op_div
l_int|16
suffix:semicolon
id|vc-&gt;vc_can_do_color
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|newport_clear
r_static
r_void
id|newport_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|xend
op_assign
(paren
(paren
id|sx
op_plus
id|width
)paren
op_lshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|ystart
op_assign
(paren
(paren
id|sy
op_lshift
l_int|4
)paren
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
suffix:semicolon
r_int
id|yend
op_assign
(paren
(paren
(paren
id|sy
op_plus
id|height
)paren
op_lshift
l_int|4
)paren
op_plus
id|topscan
op_minus
l_int|1
)paren
op_amp
l_int|0x3ff
suffix:semicolon
r_if
c_cond
(paren
id|logo_active
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ystart
OL
id|yend
)paren
(brace
id|newport_clear_screen
c_func
(paren
id|sx
op_lshift
l_int|3
comma
id|ystart
comma
id|xend
comma
id|yend
comma
(paren
id|vc-&gt;vc_color
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|newport_clear_screen
c_func
(paren
id|sx
op_lshift
l_int|3
comma
id|ystart
comma
id|xend
comma
l_int|1023
comma
(paren
id|vc-&gt;vc_color
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|newport_clear_screen
c_func
(paren
id|sx
op_lshift
l_int|3
comma
l_int|0
comma
id|xend
comma
id|yend
comma
(paren
id|vc-&gt;vc_color
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
)brace
DECL|function|newport_putc
r_static
r_void
id|newport_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|charattr
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
op_amp
id|FONT_DATA
(braket
(paren
id|charattr
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|charattr
op_assign
(paren
id|charattr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|xpos
op_lshift_assign
l_int|3
suffix:semicolon
id|ypos
op_lshift_assign
l_int|4
suffix:semicolon
id|newport_render_background
c_func
(paren
id|xpos
comma
id|ypos
comma
id|xpos
comma
id|ypos
comma
(paren
id|charattr
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Set the color and drawing mode. */
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|npregs-&gt;set.colori
op_assign
id|charattr
op_amp
l_int|0xf
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_DRAW
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_STOPX
op_or
id|NPORT_DMODE0_ZPENAB
op_or
id|NPORT_DMODE0_L32
)paren
suffix:semicolon
multiline_comment|/* Set coordinates for bitmap operation. */
id|npregs-&gt;set.xystarti
op_assign
(paren
id|xpos
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|ypos
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
)paren
suffix:semicolon
id|npregs-&gt;set.xyendi
op_assign
(paren
(paren
id|xpos
op_plus
l_int|7
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Go, baby, go... */
id|RENDER
c_func
(paren
id|npregs
comma
id|p
)paren
suffix:semicolon
)brace
DECL|function|newport_putcs
r_static
r_void
id|newport_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|charattr
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
id|charattr
op_assign
(paren
op_star
id|s
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|xpos
op_lshift_assign
l_int|3
suffix:semicolon
id|ypos
op_lshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|logo_active
)paren
multiline_comment|/* Clear the area behing the string */
id|newport_render_background
c_func
(paren
id|xpos
comma
id|ypos
comma
id|xpos
op_plus
(paren
(paren
id|count
op_minus
l_int|1
)paren
op_lshift
l_int|3
)paren
comma
id|ypos
comma
(paren
id|charattr
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set the color and drawing mode. */
id|npregs-&gt;set.colori
op_assign
id|charattr
op_amp
l_int|0xf
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_DRAW
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_STOPX
op_or
id|NPORT_DMODE0_ZPENAB
op_or
id|NPORT_DMODE0_L32
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|xpos
op_add_assign
l_int|8
)paren
(brace
id|p
op_assign
op_amp
id|FONT_DATA
(braket
(paren
id|s
(braket
id|i
)braket
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set coordinates for bitmap operation. */
id|npregs-&gt;set.xystarti
op_assign
(paren
id|xpos
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|ypos
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
)paren
suffix:semicolon
id|npregs-&gt;set.xyendi
op_assign
(paren
(paren
id|xpos
op_plus
l_int|7
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Go, baby, go... */
id|RENDER
c_func
(paren
id|npregs
comma
id|p
)paren
suffix:semicolon
)brace
)brace
DECL|function|newport_cursor
r_static
r_void
id|newport_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|mode
)paren
(brace
r_int
r_int
id|treg
suffix:semicolon
r_int
id|xcurs
comma
id|ycurs
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
comma
(paren
id|treg
op_amp
op_complement
(paren
id|VC2_CTRL_ECDISP
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_MOVE
suffix:colon
r_case
id|CM_DRAW
suffix:colon
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
comma
(paren
id|treg
op_or
id|VC2_CTRL_ECDISP
)paren
)paren
suffix:semicolon
id|xcurs
op_assign
(paren
id|vc-&gt;vc_pos
op_minus
id|vc-&gt;vc_visible_origin
)paren
op_div
l_int|2
suffix:semicolon
id|ycurs
op_assign
(paren
(paren
id|xcurs
op_div
id|vc-&gt;vc_cols
)paren
op_lshift
l_int|4
)paren
op_plus
l_int|31
suffix:semicolon
id|xcurs
op_assign
(paren
(paren
id|xcurs
op_mod
id|vc-&gt;vc_cols
)paren
op_lshift
l_int|3
)paren
op_plus
id|xcurs_correction
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CURSX
comma
id|xcurs
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CURSY
comma
id|ycurs
)paren
suffix:semicolon
)brace
)brace
DECL|function|newport_switch
r_static
r_int
id|newport_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_static
r_int
id|logo_drawn
op_assign
l_int|0
suffix:semicolon
id|topscan
op_assign
l_int|0
suffix:semicolon
id|npregs-&gt;cset.topscan
op_assign
l_int|0x3ff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|logo_drawn
)paren
(brace
id|newport_show_logo
c_func
(paren
)paren
suffix:semicolon
id|logo_drawn
op_assign
l_int|1
suffix:semicolon
id|logo_active
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|newport_blank
r_static
r_int
id|newport_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
id|blank
)paren
(brace
r_int
r_int
id|treg
suffix:semicolon
r_if
c_cond
(paren
id|blank
op_eq
l_int|0
)paren
(brace
multiline_comment|/* unblank console */
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
comma
(paren
id|treg
op_or
id|VC2_CTRL_EDISP
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* blank console */
id|treg
op_assign
id|newport_vc2_get
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
)paren
suffix:semicolon
id|newport_vc2_set
c_func
(paren
id|npregs
comma
id|VC2_IREG_CONTROL
comma
(paren
id|treg
op_amp
op_complement
(paren
id|VC2_CTRL_EDISP
)paren
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|newport_font_op
r_static
r_int
id|newport_font_op
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|console_font_op
op_star
id|f
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|newport_set_palette
r_static
r_int
id|newport_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
r_char
op_star
id|table
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|newport_scrolldelta
r_static
r_int
id|newport_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|lines
)paren
(brace
multiline_comment|/* there is (nearly) no off-screen memory, so we can&squot;t scroll back */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|newport_scroll
r_static
r_int
id|newport_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|lines
)paren
(brace
r_int
id|count
comma
id|x
comma
id|y
suffix:semicolon
r_int
r_int
op_star
id|s
comma
op_star
id|d
suffix:semicolon
r_int
r_int
id|chattr
suffix:semicolon
id|logo_active
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* it&squot;s time to disable the logo now.. */
r_if
c_cond
(paren
id|t
op_eq
l_int|0
op_logical_and
id|b
op_eq
id|vc-&gt;vc_rows
)paren
(brace
r_if
c_cond
(paren
id|dir
op_eq
id|SM_UP
)paren
(brace
id|topscan
op_assign
(paren
id|topscan
op_plus
(paren
id|lines
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|newport_clear_lines
(paren
id|vc-&gt;vc_rows
op_minus
id|lines
comma
id|vc-&gt;vc_rows
op_minus
l_int|1
comma
(paren
id|vc-&gt;vc_color
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|topscan
op_assign
(paren
id|topscan
op_plus
(paren
op_minus
id|lines
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|newport_clear_lines
(paren
l_int|0
comma
id|lines
op_minus
l_int|1
comma
(paren
id|vc-&gt;vc_color
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
id|npregs-&gt;cset.topscan
op_assign
(paren
id|topscan
op_minus
l_int|1
)paren
op_amp
l_int|0x3ff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|count
op_assign
(paren
id|b
op_minus
id|t
op_minus
id|lines
)paren
op_star
id|vc-&gt;vc_cols
suffix:semicolon
r_if
c_cond
(paren
id|dir
op_eq
id|SM_UP
)paren
(brace
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_assign
id|t
suffix:semicolon
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
(paren
id|t
op_plus
id|lines
)paren
)paren
suffix:semicolon
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|t
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|chattr
op_assign
id|scr_readw
(paren
id|s
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chattr
op_ne
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
id|newport_putc
(paren
id|vc
comma
id|chattr
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|scr_writew
(paren
id|chattr
comma
id|d
)paren
suffix:semicolon
)brace
id|d
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|x
op_eq
id|vc-&gt;vc_cols
)paren
(brace
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_increment
suffix:semicolon
)brace
)brace
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
(paren
id|b
op_minus
id|lines
)paren
)paren
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_assign
id|b
op_minus
id|lines
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
(paren
id|lines
op_star
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|scr_readw
c_func
(paren
id|d
)paren
op_ne
id|vc-&gt;vc_video_erase_char
)paren
(brace
id|newport_putc
(paren
id|vc
comma
id|vc-&gt;vc_video_erase_char
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|scr_writew
(paren
id|vc-&gt;vc_video_erase_char
comma
id|d
)paren
suffix:semicolon
)brace
id|d
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|x
op_eq
id|vc-&gt;vc_cols
)paren
(brace
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_increment
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|x
op_assign
id|vc-&gt;vc_cols
op_minus
l_int|1
suffix:semicolon
id|y
op_assign
id|b
op_minus
l_int|1
suffix:semicolon
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
(paren
id|b
op_minus
id|lines
)paren
op_minus
l_int|2
)paren
suffix:semicolon
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|b
op_minus
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|chattr
op_assign
id|scr_readw
(paren
id|s
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chattr
op_ne
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
id|newport_putc
(paren
id|vc
comma
id|chattr
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|scr_writew
(paren
id|chattr
comma
id|d
)paren
suffix:semicolon
)brace
id|d
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|x
op_decrement
op_eq
l_int|0
)paren
(brace
id|x
op_assign
id|vc-&gt;vc_cols
op_minus
l_int|1
suffix:semicolon
id|y
op_decrement
suffix:semicolon
)brace
)brace
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|t
)paren
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_assign
id|t
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
(paren
id|lines
op_star
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|scr_readw
c_func
(paren
id|d
)paren
op_ne
id|vc-&gt;vc_video_erase_char
)paren
(brace
id|newport_putc
(paren
id|vc
comma
id|vc-&gt;vc_video_erase_char
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|scr_writew
(paren
id|vc-&gt;vc_video_erase_char
comma
id|d
)paren
suffix:semicolon
)brace
id|d
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|x
op_eq
id|vc-&gt;vc_cols
)paren
(brace
id|x
op_assign
l_int|0
suffix:semicolon
id|y
op_increment
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|newport_bmove
r_static
r_void
id|newport_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|h
comma
r_int
id|w
)paren
(brace
r_int
id|xs
comma
id|ys
comma
id|xe
comma
id|ye
comma
id|xoffs
comma
id|yoffs
comma
id|tmp
suffix:semicolon
id|xs
op_assign
id|sx
op_lshift
l_int|3
suffix:semicolon
id|xe
op_assign
(paren
(paren
id|sx
op_plus
id|w
)paren
op_lshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;     * as bmove is only used to move stuff around in the same line&n;     * (h == 1), we don&squot;t care about wrap arounds caused by topscan != 0&n;     */
id|ys
op_assign
(paren
(paren
id|sy
op_lshift
l_int|4
)paren
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|ye
op_assign
(paren
(paren
(paren
id|sy
op_plus
id|h
)paren
op_lshift
l_int|4
)paren
op_minus
l_int|1
op_plus
id|topscan
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|xoffs
op_assign
(paren
id|dx
op_minus
id|sx
)paren
op_lshift
l_int|3
suffix:semicolon
id|yoffs
op_assign
(paren
id|dy
op_minus
id|sy
)paren
op_lshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|xoffs
OG
l_int|0
)paren
(brace
multiline_comment|/* move to the right, exchange starting points */
id|tmp
op_assign
id|xe
suffix:semicolon
id|xe
op_assign
id|xs
suffix:semicolon
id|xs
op_assign
id|tmp
suffix:semicolon
)brace
id|newport_wait
c_func
(paren
)paren
suffix:semicolon
id|npregs-&gt;set.drawmode0
op_assign
(paren
id|NPORT_DMODE0_S2S
op_or
id|NPORT_DMODE0_BLOCK
op_or
id|NPORT_DMODE0_DOSETUP
op_or
id|NPORT_DMODE0_STOPX
op_or
id|NPORT_DMODE0_STOPY
)paren
suffix:semicolon
id|npregs-&gt;set.xystarti
op_assign
(paren
id|xs
op_lshift
l_int|16
)paren
op_or
id|ys
suffix:semicolon
id|npregs-&gt;set.xyendi
op_assign
(paren
id|xe
op_lshift
l_int|16
)paren
op_or
id|ye
suffix:semicolon
id|npregs-&gt;go.xymove
op_assign
(paren
id|xoffs
op_lshift
l_int|16
)paren
op_or
id|yoffs
suffix:semicolon
)brace
DECL|function|newport_dummy
r_static
r_int
id|newport_dummy
c_func
(paren
r_struct
id|vc_data
op_star
id|c
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|DUMMY
mdefine_line|#define DUMMY (void *) newport_dummy
DECL|variable|newport_con
r_const
r_struct
id|consw
id|newport_con
op_assign
(brace
id|con_startup
suffix:colon
id|newport_startup
comma
id|con_init
suffix:colon
id|newport_init
comma
id|con_deinit
suffix:colon
id|DUMMY
comma
id|con_clear
suffix:colon
id|newport_clear
comma
id|con_putc
suffix:colon
id|newport_putc
comma
id|con_putcs
suffix:colon
id|newport_putcs
comma
id|con_cursor
suffix:colon
id|newport_cursor
comma
id|con_scroll
suffix:colon
id|newport_scroll
comma
id|con_bmove
suffix:colon
id|newport_bmove
comma
id|con_switch
suffix:colon
id|newport_switch
comma
id|con_blank
suffix:colon
id|newport_blank
comma
id|con_font_op
suffix:colon
id|newport_font_op
comma
id|con_set_palette
suffix:colon
id|newport_set_palette
comma
id|con_scrolldelta
suffix:colon
id|newport_scrolldelta
comma
id|con_set_origin
suffix:colon
id|DUMMY
comma
id|con_save_screen
suffix:colon
id|DUMMY
comma
)brace
suffix:semicolon
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|newport_startup
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;Error loading SGI Newport Console driver&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;Loading SGI Newport Console Driver&bslash;n&quot;
)paren
suffix:semicolon
id|take_over_console
c_func
(paren
op_amp
id|newport_con
comma
l_int|0
comma
id|MAX_NR_CONSOLES
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_int
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Unloading SGI Newport Console Driver&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
eof
