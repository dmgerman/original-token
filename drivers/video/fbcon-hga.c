multiline_comment|/*&n; *  linux/drivers/video/fbcon-hga.c -- Low level frame buffer operations for&n; *&t;&t;&t;&t;       the Hercules graphics adaptor&n; *&n; *&t;Created 25 Nov 1999 by Ferenc Bakonyi (fero@drama.obuda.kando.hu)&n; *&t;Based on fbcon-mfb.c by Geert Uytterhoeven&n; *&n; * History:&n; *&n; * - Revision 0.1.0 (6 Dec 1999): comment changes&n; * - First release (25 Nov 1999)&n; * &n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-hga.h&gt;
macro_line|#if 0
mdefine_line|#define DPRINTK(args...) printk(KERN_DEBUG __FILE__&quot;: &quot; ##args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(args...)
macro_line|#endif
DECL|macro|HGA_ROWADDR
mdefine_line|#define HGA_ROWADDR(row) ((row%4)*8192 + (row&gt;&gt;2)*90)
multiline_comment|/*&n;     *  Hercules monochrome&n;     */
DECL|function|rowaddr
r_static
r_inline
id|u8
op_star
id|rowaddr
c_func
(paren
r_struct
id|display
op_star
id|p
comma
id|u_int
id|row
)paren
(brace
r_return
id|p-&gt;screen_base
op_plus
id|HGA_ROWADDR
c_func
(paren
id|row
)paren
suffix:semicolon
)brace
DECL|function|fbcon_hga_setup
r_void
id|fbcon_hga_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;fbcon_hga_setup: ll:%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|p-&gt;line_length
)paren
suffix:semicolon
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_hga_bmove
r_void
id|fbcon_hga_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u8
op_star
id|src
comma
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
comma
id|y1
comma
id|y2
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
suffix:semicolon
id|fb_memmove
c_func
(paren
id|dest
comma
id|src
comma
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|dy
op_le
id|sy
)paren
(brace
id|y1
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|y2
op_assign
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y1
)paren
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y2
)paren
op_plus
id|dx
suffix:semicolon
id|fb_memmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|y1
op_increment
suffix:semicolon
id|y2
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|y1
op_assign
(paren
id|sy
op_plus
id|height
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
id|y2
op_assign
(paren
id|dy
op_plus
id|height
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y1
)paren
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y2
)paren
op_plus
id|dx
suffix:semicolon
id|fb_memmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|y1
op_decrement
suffix:semicolon
id|y2
op_decrement
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_hga_clear
r_void
id|fbcon_hga_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u8
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
comma
id|y
suffix:semicolon
r_int
id|inverse
op_assign
id|conp
ques
c_cond
id|attr_reverse
c_func
(paren
id|p
comma
id|conp-&gt;vc_video_erase_char
)paren
suffix:colon
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;fbcon_hga_clear: sx:%d, sy:%d, height:%d, width:%d&bslash;n&quot;
comma
id|sx
comma
id|sy
comma
id|height
comma
id|width
)paren
suffix:semicolon
id|y
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
)paren
(brace
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|fb_memset255
c_func
(paren
id|dest
comma
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
)paren
suffix:semicolon
)brace
r_else
(brace
id|fb_memclear
c_func
(paren
id|dest
comma
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
)paren
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif&t;    
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|y
op_increment
)paren
(brace
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y
)paren
op_plus
id|sx
suffix:semicolon
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|fb_memset255
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
)brace
r_else
(brace
id|fb_memclear
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_hga_putc
r_void
id|fbcon_hga_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u8
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
id|u_int
id|rows
comma
id|y
comma
id|bold
comma
id|revs
comma
id|underl
suffix:semicolon
id|u8
id|d
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|bold
op_assign
id|attr_bold
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|revs
op_assign
id|attr_reverse
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|underl
op_assign
id|attr_underline
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|y
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|y
op_increment
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underl
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bold
)paren
id|d
op_or_assign
id|d
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|revs
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y
)paren
op_plus
id|xx
suffix:semicolon
op_star
id|dest
op_assign
id|d
suffix:semicolon
)brace
)brace
DECL|function|fbcon_hga_putcs
r_void
id|fbcon_hga_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u8
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
id|u_int
id|rows
comma
id|y
comma
id|y0
comma
id|bold
comma
id|revs
comma
id|underl
suffix:semicolon
id|u8
id|d
suffix:semicolon
id|u16
id|c
suffix:semicolon
id|bold
op_assign
id|attr_bold
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|revs
op_assign
id|attr_reverse
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|underl
op_assign
id|attr_underline
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|y0
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|y
op_assign
id|y0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|y
op_increment
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underl
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bold
)paren
id|d
op_or_assign
id|d
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|revs
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y
)paren
op_plus
id|xx
suffix:semicolon
op_star
id|dest
op_assign
id|d
suffix:semicolon
)brace
id|xx
op_increment
suffix:semicolon
)brace
)brace
DECL|function|fbcon_hga_revc
r_void
id|fbcon_hga_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
id|u8
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
comma
id|y
suffix:semicolon
id|y
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|y
op_increment
)paren
(brace
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y
)paren
op_plus
id|xx
suffix:semicolon
op_star
id|dest
op_assign
op_complement
op_star
id|dest
suffix:semicolon
)brace
)brace
DECL|function|fbcon_hga_clear_margins
r_void
id|fbcon_hga_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
id|u8
op_star
id|dest
suffix:semicolon
id|u_int
id|height
comma
id|y
suffix:semicolon
r_int
id|inverse
op_assign
id|conp
ques
c_cond
id|attr_reverse
c_func
(paren
id|p
comma
id|conp-&gt;vc_video_erase_char
)paren
suffix:colon
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;fbcon_hga_clear_margins: enter&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* No need to handle right margin. */
id|y
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|height
op_assign
id|p-&gt;var.yres
op_minus
id|y
suffix:semicolon
id|height
op_decrement
OG
l_int|0
suffix:semicolon
id|y
op_increment
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;fbcon_hga_clear_margins: y:%d, height:%d&bslash;n&quot;
comma
id|y
comma
id|height
)paren
suffix:semicolon
id|dest
op_assign
id|rowaddr
c_func
(paren
id|p
comma
id|y
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|fb_memset255
c_func
(paren
id|dest
comma
id|p-&gt;next_line
)paren
suffix:semicolon
)brace
r_else
(brace
id|fb_memclear
c_func
(paren
id|dest
comma
id|p-&gt;next_line
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; *  `switch&squot; for the low level operations&n;&t; */
DECL|variable|fbcon_hga
r_struct
id|display_switch
id|fbcon_hga
op_assign
(brace
id|setup
suffix:colon
id|fbcon_hga_setup
comma
id|bmove
suffix:colon
id|fbcon_hga_bmove
comma
id|clear
suffix:colon
id|fbcon_hga_clear
comma
id|putc
suffix:colon
id|fbcon_hga_putc
comma
id|putcs
suffix:colon
id|fbcon_hga_putcs
comma
id|revc
suffix:colon
id|fbcon_hga_revc
comma
id|clear_margins
suffix:colon
id|fbcon_hga_clear_margins
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
)brace
suffix:semicolon
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#endif /* MODULE */
multiline_comment|/*&n;&t; *  Visible symbols for modules&n;&t; */
DECL|variable|fbcon_hga
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga
)paren
suffix:semicolon
DECL|variable|fbcon_hga_setup
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_setup
)paren
suffix:semicolon
DECL|variable|fbcon_hga_bmove
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_bmove
)paren
suffix:semicolon
DECL|variable|fbcon_hga_clear
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_clear
)paren
suffix:semicolon
DECL|variable|fbcon_hga_putc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_putc
)paren
suffix:semicolon
DECL|variable|fbcon_hga_putcs
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_putcs
)paren
suffix:semicolon
DECL|variable|fbcon_hga_revc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_revc
)paren
suffix:semicolon
DECL|variable|fbcon_hga_clear_margins
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_hga_clear_margins
)paren
suffix:semicolon
eof
