multiline_comment|/*&n; *  linux/drivers/video/sticon.c  - console driver using HP&squot;s STI firmware&n; *&n; *&t;Copyright (C) 2000 Philipp Rumpf &lt;prumpf@tux.org&gt;&n; *&n; *  Based on linux/drivers/video/vgacon.c and linux/drivers/video/fbcon.c,&n; *  which were&n; *&n; *&t;Created 28 Sep 1997 by Geert Uytterhoeven&n; *&t;Rewritten by Martin Mares &lt;mj@ucw.cz&gt;, July 1998&n; *&t;Copyright (C) 1991, 1992  Linus Torvalds&n; *&t;&t;&t;    1995  Jay Estabrook&n; *&t;Copyright (C) 1995 Geert Uytterhoeven&n; *&t;Copyright (C) 1993 Bjoern Brauel&n; *&t;&t;&t;   Roman Hodek&n; *&t;Copyright (C) 1993 Hamish Macdonald&n; *&t;&t;&t;   Greg Harp&n; *&t;Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *&t;      with work by William Rucklidge (wjr@cs.cornell.edu)&n; *&t;&t;&t;   Geert Uytterhoeven&n; *&t;&t;&t;   Jes Sorensen (jds@kom.auc.dk)&n; *&t;&t;&t;   Martin Apel&n; *&t;      with work by Guenther Kelleter&n; *&t;&t;&t;   Martin Schaller&n; *&t;&t;&t;   Andreas Schwab&n; *&t;&t;&t;   Emmanuel Marty (core@ggi-project.org)&n; *&t;&t;&t;   Jakub Jelinek (jj@ultra.linux.cz)&n; *&t;&t;&t;   Martin Mares &lt;mj@ucw.cz&gt;&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
multiline_comment|/*&n; *  TODO:&n; *   - call STI in virtual mode rather than in real mode&n; *   - support for PCI-only STI ROMs (which don&squot;t have a traditional region&n; *     list)&n; *   - safe detection (i.e. verify there is a graphics device at a given&n; *     address first, not just read a random device&squot;s io space)&n; *   - support for multiple STI devices in one machine&n; *   - support for byte-mode STI ROMs&n; *   - support for just using STI to switch to a colour fb (stifb ?)&n; *   - try to make it work on m68k hp workstations ;)&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sti.h&quot;
multiline_comment|/* STICON */
r_static
r_const
r_char
op_star
id|__init
DECL|function|sticon_startup
id|sticon_startup
c_func
(paren
r_void
)paren
(brace
r_return
l_string|&quot;STI console&quot;
suffix:semicolon
)brace
r_static
r_int
DECL|function|sticon_set_palette
id|sticon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
r_char
op_star
id|table
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|sticon_font_op
id|sticon_font_op
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sticon_putc
r_static
r_void
id|sticon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
id|sti_putc
c_func
(paren
op_amp
id|default_sti
comma
id|c
comma
id|ypos
comma
id|xpos
)paren
suffix:semicolon
)brace
DECL|function|sticon_putcs
r_static
r_void
id|sticon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|sti_putc
c_func
(paren
op_amp
id|default_sti
comma
op_star
id|s
op_increment
comma
id|ypos
comma
id|xpos
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|sticon_cursor
r_static
r_void
id|sticon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
(brace
)brace
DECL|function|sticon_scroll
r_static
r_int
id|sticon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
op_assign
op_amp
id|default_sti
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|sticon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|SM_UP
suffix:colon
id|sti_bmove
c_func
(paren
id|sti
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|sti_clear
c_func
(paren
id|sti
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SM_DOWN
suffix:colon
id|sti_bmove
c_func
(paren
id|sti
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|sti_clear
c_func
(paren
id|sti
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_bmove
r_static
r_void
id|sticon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sti_bmove
c_func
(paren
op_amp
id|default_sti
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|sticon_init
r_static
r_void
id|sticon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
id|init
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
op_assign
op_amp
id|default_sti
suffix:semicolon
r_int
id|vc_cols
comma
id|vc_rows
suffix:semicolon
id|sti_set
c_func
(paren
id|sti
comma
l_int|0
comma
l_int|0
comma
id|sti_onscreen_y
c_func
(paren
id|sti
)paren
comma
id|sti_onscreen_x
c_func
(paren
id|sti
)paren
comma
l_int|0
)paren
suffix:semicolon
id|c-&gt;vc_can_do_color
op_assign
l_int|1
suffix:semicolon
id|vc_cols
op_assign
id|PTR_STI
c_func
(paren
id|sti-&gt;glob_cfg
)paren
op_member_access_from_pointer
id|onscreen_x
op_div
id|sti_font_x
c_func
(paren
id|sti
)paren
suffix:semicolon
id|vc_rows
op_assign
id|PTR_STI
c_func
(paren
id|sti-&gt;glob_cfg
)paren
op_member_access_from_pointer
id|onscreen_y
op_div
id|sti_font_y
c_func
(paren
id|sti
)paren
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|vc_rows
comma
id|vc_cols
comma
id|c-&gt;vc_num
)paren
suffix:semicolon
)brace
DECL|function|sticon_deinit
r_static
r_void
id|sticon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|c
)paren
(brace
)brace
DECL|function|sticon_clear
r_static
r_void
id|sticon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sti_clear
c_func
(paren
op_amp
id|default_sti
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|sticon_switch
r_static
r_int
id|sticon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_blank
r_static
r_int
id|sticon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|blank
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_scrolldelta
r_static
r_int
id|sticon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|lines
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_set_origin
r_static
r_int
id|sticon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_screen_pos
r_static
id|u16
op_star
id|sticon_screen_pos
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|offset
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sticon_getxy
r_static
r_int
r_int
id|sticon_getxy
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
r_int
id|pos
comma
r_int
op_star
id|px
comma
r_int
op_star
id|py
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_build_attr
r_static
id|u8
id|sticon_build_attr
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
id|u8
id|color
comma
id|u8
id|intens
comma
id|u8
id|blink
comma
id|u8
id|underline
comma
id|u8
id|reverse
)paren
(brace
id|u8
id|attr
op_assign
(paren
(paren
id|color
op_amp
l_int|0x70
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|color
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
(brace
id|color
op_assign
(paren
(paren
id|color
op_rshift
l_int|3
)paren
op_amp
l_int|0x7
)paren
op_or
(paren
(paren
id|color
op_amp
l_int|0x7
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_return
id|attr
suffix:semicolon
)brace
DECL|variable|sti_con
r_struct
id|consw
id|sti_con
op_assign
(brace
id|con_startup
suffix:colon
id|sticon_startup
comma
id|con_init
suffix:colon
id|sticon_init
comma
id|con_deinit
suffix:colon
id|sticon_deinit
comma
id|con_clear
suffix:colon
id|sticon_clear
comma
id|con_putc
suffix:colon
id|sticon_putc
comma
id|con_putcs
suffix:colon
id|sticon_putcs
comma
id|con_cursor
suffix:colon
id|sticon_cursor
comma
id|con_scroll
suffix:colon
id|sticon_scroll
comma
id|con_bmove
suffix:colon
id|sticon_bmove
comma
id|con_switch
suffix:colon
id|sticon_switch
comma
id|con_blank
suffix:colon
id|sticon_blank
comma
id|con_font_op
suffix:colon
id|sticon_font_op
comma
id|con_set_palette
suffix:colon
id|sticon_set_palette
comma
id|con_scrolldelta
suffix:colon
id|sticon_scrolldelta
comma
id|con_set_origin
suffix:colon
id|sticon_set_origin
comma
id|con_save_screen
suffix:colon
l_int|NULL
comma
id|con_build_attr
suffix:colon
id|sticon_build_attr
comma
id|con_invert_region
suffix:colon
l_int|NULL
comma
id|con_screen_pos
suffix:colon
id|sticon_screen_pos
comma
id|con_getxy
suffix:colon
id|sticon_getxy
comma
)brace
suffix:semicolon
DECL|function|sti_init
r_static
r_int
id|__init
id|sti_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;searching for word mode STI ROMs&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sti_init_roms
c_func
(paren
)paren
)paren
(brace
id|pdc_console_die
c_func
(paren
)paren
suffix:semicolon
id|take_over_console
c_func
(paren
op_amp
id|sti_con
comma
l_int|0
comma
id|MAX_NR_CONSOLES
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|sti_init
)paren
eof
