DECL|macro|STI_REGION_MAX
mdefine_line|#define STI_REGION_MAX 8
DECL|macro|STI_DEV_NAME_LENGTH
mdefine_line|#define STI_DEV_NAME_LENGTH 32
DECL|struct|sti_rom_font
r_struct
id|sti_rom_font
(brace
DECL|member|first_char
id|u16
id|first_char
suffix:semicolon
DECL|member|last_char
id|u16
id|last_char
suffix:semicolon
DECL|member|width
id|u8
id|width
suffix:semicolon
DECL|member|height
id|u8
id|height
suffix:semicolon
DECL|member|font_type
id|u8
id|font_type
suffix:semicolon
DECL|member|bytes_per_char
id|u8
id|bytes_per_char
suffix:semicolon
DECL|member|next_font
id|u32
id|next_font
suffix:semicolon
DECL|member|underline_height
id|u8
id|underline_height
suffix:semicolon
DECL|member|underline_pos
id|u8
id|underline_pos
suffix:semicolon
DECL|member|res008
id|u8
id|res008
(braket
l_int|2
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_rom
r_struct
id|sti_rom
(brace
DECL|member|type
id|u8
id|type
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|res004
id|u8
id|res004
suffix:semicolon
DECL|member|num_mons
id|u8
id|num_mons
suffix:semicolon
DECL|member|revno
id|u8
id|revno
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|graphics_id
id|u8
id|graphics_id
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|font_start
id|u32
id|font_start
suffix:semicolon
DECL|member|statesize
id|u32
id|statesize
suffix:semicolon
DECL|member|last_addr
id|u32
id|last_addr
suffix:semicolon
DECL|member|region_list
id|u32
id|region_list
suffix:semicolon
DECL|member|reentsize
id|u16
id|reentsize
suffix:semicolon
DECL|member|maxtime
id|u16
id|maxtime
suffix:semicolon
DECL|member|mon_tbl_addr
id|u32
id|mon_tbl_addr
suffix:semicolon
DECL|member|user_data_addr
id|u32
id|user_data_addr
suffix:semicolon
DECL|member|sti_mem_req
id|u32
id|sti_mem_req
suffix:semicolon
DECL|member|user_data_size
id|u32
id|user_data_size
suffix:semicolon
DECL|member|power
id|u16
id|power
suffix:semicolon
DECL|member|bus_support
id|u8
id|bus_support
suffix:semicolon
DECL|member|ext_bus_support
id|u8
id|ext_bus_support
suffix:semicolon
DECL|member|alt_code_type
id|u8
id|alt_code_type
suffix:semicolon
DECL|member|ext_dd_struct
id|u8
id|ext_dd_struct
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cfb_addr
id|u32
id|cfb_addr
suffix:semicolon
DECL|member|init_graph
id|u32
id|init_graph
suffix:semicolon
DECL|member|state_mgmt
id|u32
id|state_mgmt
suffix:semicolon
DECL|member|font_unpmv
id|u32
id|font_unpmv
suffix:semicolon
DECL|member|block_move
id|u32
id|block_move
suffix:semicolon
DECL|member|self_test
id|u32
id|self_test
suffix:semicolon
DECL|member|excep_hdlr
id|u32
id|excep_hdlr
suffix:semicolon
DECL|member|inq_conf
id|u32
id|inq_conf
suffix:semicolon
DECL|member|set_cm_entry
id|u32
id|set_cm_entry
suffix:semicolon
DECL|member|dma_ctrl
id|u32
id|dma_ctrl
suffix:semicolon
DECL|member|res040
id|u8
id|res040
(braket
l_int|7
op_star
l_int|4
)braket
suffix:semicolon
DECL|member|init_graph_m68k
id|u32
id|init_graph_m68k
suffix:semicolon
DECL|member|flow_ctrl
id|u32
id|flow_ctrl
suffix:semicolon
DECL|member|user_timing
id|u32
id|user_timing
suffix:semicolon
DECL|member|process_mgr
id|u32
id|process_mgr
suffix:semicolon
DECL|member|sti_util
id|u32
id|sti_util
suffix:semicolon
DECL|member|end_addr
id|u32
id|end_addr
suffix:semicolon
DECL|member|res0b8
id|u32
id|res0b8
suffix:semicolon
DECL|member|res0bc
id|u32
id|res0bc
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_cooked_font
r_struct
id|sti_cooked_font
(brace
DECL|member|raw
r_struct
id|sti_rom_font
op_star
id|raw
suffix:semicolon
DECL|member|next_font
r_struct
id|sti_cooked_font
op_star
id|next_font
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_cooked_rom
r_struct
id|sti_cooked_rom
(brace
DECL|member|raw
r_struct
id|sti_rom
op_star
id|raw
suffix:semicolon
DECL|member|font_start
r_struct
id|sti_cooked_font
op_star
id|font_start
suffix:semicolon
DECL|member|region_list
id|u32
op_star
id|region_list
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_glob_cfg_ext
r_struct
id|sti_glob_cfg_ext
(brace
DECL|member|curr_mon
id|u8
id|curr_mon
suffix:semicolon
DECL|member|friendly_boot
id|u8
id|friendly_boot
suffix:semicolon
DECL|member|power
id|s16
id|power
suffix:semicolon
DECL|member|freq_ref
id|s32
id|freq_ref
suffix:semicolon
DECL|member|sti_mem_addr
id|s32
op_star
id|sti_mem_addr
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_glob_cfg
r_struct
id|sti_glob_cfg
(brace
DECL|member|text_planes
id|s32
id|text_planes
suffix:semicolon
DECL|member|onscreen_x
id|s16
id|onscreen_x
suffix:semicolon
DECL|member|onscreen_y
id|s16
id|onscreen_y
suffix:semicolon
DECL|member|offscreen_x
id|s16
id|offscreen_x
suffix:semicolon
DECL|member|offscreen_y
id|s16
id|offscreen_y
suffix:semicolon
DECL|member|total_x
id|s16
id|total_x
suffix:semicolon
DECL|member|total_y
id|s16
id|total_y
suffix:semicolon
DECL|member|region_ptrs
id|u32
id|region_ptrs
(braket
id|STI_REGION_MAX
)braket
suffix:semicolon
DECL|member|reent_lvl
id|s32
id|reent_lvl
suffix:semicolon
DECL|member|save_addr
id|s32
op_star
id|save_addr
suffix:semicolon
DECL|member|ext_ptr
r_struct
id|sti_glob_cfg_ext
op_star
id|ext_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_init_flags
r_struct
id|sti_init_flags
(brace
DECL|member|wait
id|u32
id|wait
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reset
id|u32
id|reset
suffix:colon
l_int|1
suffix:semicolon
DECL|member|text
id|u32
id|text
suffix:colon
l_int|1
suffix:semicolon
DECL|member|nontext
id|u32
id|nontext
suffix:colon
l_int|1
suffix:semicolon
DECL|member|clear
id|u32
id|clear
suffix:colon
l_int|1
suffix:semicolon
DECL|member|cmap_blk
id|u32
id|cmap_blk
suffix:colon
l_int|1
suffix:semicolon
DECL|member|enable_be_timer
id|u32
id|enable_be_timer
suffix:colon
l_int|1
suffix:semicolon
DECL|member|enable_be_int
id|u32
id|enable_be_int
suffix:colon
l_int|1
suffix:semicolon
DECL|member|no_chg_tx
id|u32
id|no_chg_tx
suffix:colon
l_int|1
suffix:semicolon
DECL|member|no_chg_ntx
id|u32
id|no_chg_ntx
suffix:colon
l_int|1
suffix:semicolon
DECL|member|no_chg_bet
id|u32
id|no_chg_bet
suffix:colon
l_int|1
suffix:semicolon
DECL|member|no_chg_bei
id|u32
id|no_chg_bei
suffix:colon
l_int|1
suffix:semicolon
DECL|member|init_cmap_tx
id|u32
id|init_cmap_tx
suffix:colon
l_int|1
suffix:semicolon
DECL|member|cmt_chg
id|u32
id|cmt_chg
suffix:colon
l_int|1
suffix:semicolon
DECL|member|retain_ie
id|u32
id|retain_ie
suffix:colon
l_int|1
suffix:semicolon
DECL|member|pad
id|u32
id|pad
suffix:colon
l_int|17
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_init_inptr_ext
r_struct
id|sti_init_inptr_ext
(brace
DECL|member|config_mon_type
id|u8
id|config_mon_type
suffix:semicolon
DECL|member|pad
id|u8
id|pad
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|inflight_data
id|u16
id|inflight_data
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_init_inptr
r_struct
id|sti_init_inptr
(brace
DECL|member|text_planes
id|s32
id|text_planes
suffix:semicolon
DECL|member|ext_ptr
r_struct
id|sti_init_inptr_ext
op_star
id|ext_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_init_outptr
r_struct
id|sti_init_outptr
(brace
DECL|member|errno
id|s32
id|errno
suffix:semicolon
DECL|member|text_planes
id|s32
id|text_planes
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_conf_flags
r_struct
id|sti_conf_flags
(brace
DECL|member|wait
id|u32
id|wait
suffix:colon
l_int|1
suffix:semicolon
DECL|member|pad
id|u32
id|pad
suffix:colon
l_int|31
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_conf_inptr
r_struct
id|sti_conf_inptr
(brace
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_conf_outptr_ext
r_struct
id|sti_conf_outptr_ext
(brace
DECL|member|crt_config
id|u32
id|crt_config
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|crt_hdw
id|u32
id|crt_hdw
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_conf_outptr
r_struct
id|sti_conf_outptr
(brace
DECL|member|errno
id|s32
id|errno
suffix:semicolon
DECL|member|onscreen_x
id|s16
id|onscreen_x
suffix:semicolon
DECL|member|onscreen_y
id|s16
id|onscreen_y
suffix:semicolon
DECL|member|offscreen_x
id|s16
id|offscreen_x
suffix:semicolon
DECL|member|offscreen_y
id|s16
id|offscreen_y
suffix:semicolon
DECL|member|total_x
id|s16
id|total_x
suffix:semicolon
DECL|member|total_y
id|s16
id|total_y
suffix:semicolon
DECL|member|bits_per_pixel
id|s32
id|bits_per_pixel
suffix:semicolon
DECL|member|bits_used
id|s32
id|bits_used
suffix:semicolon
DECL|member|planes
id|s32
id|planes
suffix:semicolon
DECL|member|dev_name
id|u8
id|dev_name
(braket
id|STI_DEV_NAME_LENGTH
)braket
suffix:semicolon
DECL|member|attributes
id|u32
id|attributes
suffix:semicolon
DECL|member|ext_ptr
r_struct
id|sti_conf_outptr_ext
op_star
id|ext_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_font_inptr
r_struct
id|sti_font_inptr
(brace
DECL|member|font_start_addr
id|u32
id|font_start_addr
suffix:semicolon
DECL|member|index
id|s16
id|index
suffix:semicolon
DECL|member|fg_color
id|u8
id|fg_color
suffix:semicolon
DECL|member|bg_color
id|u8
id|bg_color
suffix:semicolon
DECL|member|dest_x
id|s16
id|dest_x
suffix:semicolon
DECL|member|dest_y
id|s16
id|dest_y
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_font_flags
r_struct
id|sti_font_flags
(brace
DECL|member|wait
id|u32
id|wait
suffix:colon
l_int|1
suffix:semicolon
DECL|member|non_text
id|u32
id|non_text
suffix:colon
l_int|1
suffix:semicolon
DECL|member|pad
id|u32
id|pad
suffix:colon
l_int|30
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_font_outptr
r_struct
id|sti_font_outptr
(brace
DECL|member|errno
id|s32
id|errno
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_blkmv_flags
r_struct
id|sti_blkmv_flags
(brace
DECL|member|wait
id|u32
id|wait
suffix:colon
l_int|1
suffix:semicolon
DECL|member|color
id|u32
id|color
suffix:colon
l_int|1
suffix:semicolon
DECL|member|clear
id|u32
id|clear
suffix:colon
l_int|1
suffix:semicolon
DECL|member|non_text
id|u32
id|non_text
suffix:colon
l_int|1
suffix:semicolon
DECL|member|pad
id|u32
id|pad
suffix:colon
l_int|28
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_blkmv_inptr
r_struct
id|sti_blkmv_inptr
(brace
DECL|member|fg_color
id|u8
id|fg_color
suffix:semicolon
DECL|member|bg_color
id|u8
id|bg_color
suffix:semicolon
DECL|member|src_x
id|s16
id|src_x
suffix:semicolon
DECL|member|src_y
id|s16
id|src_y
suffix:semicolon
DECL|member|dest_x
id|s16
id|dest_x
suffix:semicolon
DECL|member|dest_y
id|s16
id|dest_y
suffix:semicolon
DECL|member|width
id|s16
id|width
suffix:semicolon
DECL|member|height
id|s16
id|height
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_blkmv_outptr
r_struct
id|sti_blkmv_outptr
(brace
DECL|member|errno
id|s32
id|errno
suffix:semicolon
DECL|member|future_ptr
id|s32
op_star
id|future_ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sti_struct
r_struct
id|sti_struct
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|rom
r_struct
id|sti_cooked_rom
op_star
id|rom
suffix:semicolon
DECL|member|font_unpmv
r_int
r_int
id|font_unpmv
suffix:semicolon
DECL|member|block_move
r_int
r_int
id|block_move
suffix:semicolon
DECL|member|init_graph
r_int
r_int
id|init_graph
suffix:semicolon
DECL|member|inq_conf
r_int
r_int
id|inq_conf
suffix:semicolon
DECL|member|glob_cfg
r_struct
id|sti_glob_cfg
op_star
id|glob_cfg
suffix:semicolon
DECL|member|font
r_struct
id|sti_rom_font
op_star
id|font
suffix:semicolon
DECL|member|text_planes
id|s32
id|text_planes
suffix:semicolon
DECL|member|mon_strings
r_char
op_star
op_star
id|mon_strings
suffix:semicolon
DECL|member|regions
id|u32
op_star
id|regions
suffix:semicolon
DECL|member|pci_regions
id|u8
op_star
id|pci_regions
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|STI_CALL
mdefine_line|#define STI_CALL(func, flags, inptr, outptr, glob_cfg) &bslash;&n;&t;({&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;real32_call( func, (unsigned long)STI_PTR(flags), &bslash;&n;&t;&t;&t;&t;    STI_PTR(inptr), STI_PTR(outptr), &bslash;&n;&t;&t;&t;&t;    glob_cfg); &bslash;&n;&t;})
multiline_comment|/* The latency of the STI functions cannot really be reduced by setting&n; * this to 0;  STI doesn&squot;t seem to be designed to allow calling a different&n; * function (or the same function with different arguments) after a&n; * function exited with 1 as return value.&n; *&n; * As all of the functions below could be called from interrupt context,&n; * we have to spin_lock_irqsave around the do { ret = bla(); } while(ret==1)&n; * block.  Really bad latency there.&n; *&n; * Probably the best solution to all this is have the generic code manage&n; * the screen buffer and a kernel thread to call STI occasionally.&n; * &n; * Luckily, the frame buffer guys have the same problem so we can just wait&n; * for them to fix it and steal their solution.   prumpf&n; *&n; * Actually, another long-term viable solution is to completely do STI&n; * support in userspace - that way we avoid the potential license issues&n; * of using proprietary fonts, too. */
DECL|macro|STI_WAIT
mdefine_line|#define STI_WAIT 1
DECL|macro|STI_PTR
mdefine_line|#define STI_PTR(p) ( (typeof(p)) virt_to_phys(p))
DECL|macro|PTR_STI
mdefine_line|#define PTR_STI(p) ( (typeof(p)) phys_to_virt((unsigned long)p) )
DECL|macro|sti_onscreen_x
mdefine_line|#define sti_onscreen_x(sti) (PTR_STI(sti-&gt;glob_cfg)-&gt;onscreen_x)
DECL|macro|sti_onscreen_y
mdefine_line|#define sti_onscreen_y(sti) (PTR_STI(sti-&gt;glob_cfg)-&gt;onscreen_y)
DECL|macro|sti_font_x
mdefine_line|#define sti_font_x(sti) (PTR_STI(sti-&gt;font)-&gt;width)
DECL|macro|sti_font_y
mdefine_line|#define sti_font_y(sti) (PTR_STI(sti-&gt;font)-&gt;height)
r_extern
r_struct
id|sti_struct
op_star
id|sti_init_roms
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|sti_init_graph
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
suffix:semicolon
r_void
id|sti_inq_conf
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
suffix:semicolon
r_void
id|sti_putc
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_void
id|sti_set
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
comma
id|u8
id|color
)paren
suffix:semicolon
r_void
id|sti_clear
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_void
id|sti_bmove
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|dst_y
comma
r_int
id|dst_x
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
multiline_comment|/* XXX: this probably should not be here, but we rely on STI being&n;   initialized early and independently of stifb at the moment, so&n;   there&squot;s no other way for stifb to find it. */
r_extern
r_struct
id|sti_struct
id|default_sti
suffix:semicolon
eof
