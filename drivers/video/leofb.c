multiline_comment|/* $Id: leofb.c,v 1.4 1998/09/04 15:43:45 jj Exp $&n; * leofb.c: Leo (ZX) 24/8bit frame buffer driver&n; *&n; * Copyright (C) 1996,1997,1998 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1997 Michal Rehacek (Michal.Rehacek@st.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;video/sbusfb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|LEO_OFF_LC_SS0_KRN
mdefine_line|#define LEO_OFF_LC_SS0_KRN&t;0x00200000
DECL|macro|LEO_OFF_LC_SS0_USR
mdefine_line|#define LEO_OFF_LC_SS0_USR&t;0x00201000
DECL|macro|LEO_OFF_LC_SS1_KRN
mdefine_line|#define LEO_OFF_LC_SS1_KRN&t;0x01200000
DECL|macro|LEO_OFF_LC_SS1_USR
mdefine_line|#define LEO_OFF_LC_SS1_USR&t;0x01201000
DECL|macro|LEO_OFF_LD_SS0
mdefine_line|#define LEO_OFF_LD_SS0&t;&t;0x00400000
DECL|macro|LEO_OFF_LD_SS1
mdefine_line|#define LEO_OFF_LD_SS1&t;&t;0x01400000
DECL|macro|LEO_OFF_LD_GBL
mdefine_line|#define LEO_OFF_LD_GBL&t;&t;0x00401000
DECL|macro|LEO_OFF_LX_KRN
mdefine_line|#define LEO_OFF_LX_KRN&t;&t;0x00600000
DECL|macro|LEO_OFF_LX_CURSOR
mdefine_line|#define LEO_OFF_LX_CURSOR&t;0x00601000
DECL|macro|LEO_OFF_SS0
mdefine_line|#define LEO_OFF_SS0&t;&t;0x00800000
DECL|macro|LEO_OFF_SS1
mdefine_line|#define LEO_OFF_SS1&t;&t;0x01800000
DECL|macro|LEO_OFF_UNK
mdefine_line|#define LEO_OFF_UNK&t;&t;0x00602000
DECL|macro|LEO_OFF_UNK2
mdefine_line|#define LEO_OFF_UNK2&t;&t;0x00000000
DECL|macro|LEO_CUR_ENABLE
mdefine_line|#define LEO_CUR_ENABLE&t;&t;0x00000080
DECL|macro|LEO_CUR_UPDATE
mdefine_line|#define LEO_CUR_UPDATE&t;&t;0x00000030
DECL|macro|LEO_CUR_PROGRESS
mdefine_line|#define LEO_CUR_PROGRESS&t;0x00000006
DECL|macro|LEO_CUR_UPDATECMAP
mdefine_line|#define LEO_CUR_UPDATECMAP&t;0x00000003
DECL|macro|LEO_CUR_TYPE_MASK
mdefine_line|#define LEO_CUR_TYPE_MASK&t;0x00000000
DECL|macro|LEO_CUR_TYPE_IMAGE
mdefine_line|#define LEO_CUR_TYPE_IMAGE&t;0x00000020
DECL|macro|LEO_CUR_TYPE_CMAP
mdefine_line|#define LEO_CUR_TYPE_CMAP&t;0x00000050
DECL|struct|leo_cursor
r_struct
id|leo_cursor
(brace
DECL|member|xxx0
id|u8
id|xxx0
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|cur_type
r_volatile
id|u32
id|cur_type
suffix:semicolon
DECL|member|cur_misc
r_volatile
id|u32
id|cur_misc
suffix:semicolon
DECL|member|cur_cursxy
r_volatile
id|u32
id|cur_cursxy
suffix:semicolon
DECL|member|cur_data
r_volatile
id|u32
id|cur_data
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|LEO_KRN_TYPE_CLUT0
mdefine_line|#define LEO_KRN_TYPE_CLUT0&t;0x00001000
DECL|macro|LEO_KRN_TYPE_CLUT1
mdefine_line|#define LEO_KRN_TYPE_CLUT1&t;0x00001001
DECL|macro|LEO_KRN_TYPE_CLUT2
mdefine_line|#define LEO_KRN_TYPE_CLUT2&t;0x00001002
DECL|macro|LEO_KRN_TYPE_WID
mdefine_line|#define LEO_KRN_TYPE_WID&t;0x00001003
DECL|macro|LEO_KRN_TYPE_UNK
mdefine_line|#define LEO_KRN_TYPE_UNK&t;0x00001006
DECL|macro|LEO_KRN_TYPE_VIDEO
mdefine_line|#define LEO_KRN_TYPE_VIDEO&t;0x00002003
DECL|macro|LEO_KRN_TYPE_CLUTDATA
mdefine_line|#define LEO_KRN_TYPE_CLUTDATA&t;0x00004000
DECL|macro|LEO_KRN_CSR_ENABLE
mdefine_line|#define LEO_KRN_CSR_ENABLE&t;0x00000008
DECL|macro|LEO_KRN_CSR_PROGRESS
mdefine_line|#define LEO_KRN_CSR_PROGRESS&t;0x00000004
DECL|macro|LEO_KRN_CSR_UNK
mdefine_line|#define LEO_KRN_CSR_UNK&t;&t;0x00000002
DECL|macro|LEO_KRN_CSR_UNK2
mdefine_line|#define LEO_KRN_CSR_UNK2&t;0x00000001
DECL|struct|leo_lx_krn
r_struct
id|leo_lx_krn
(brace
DECL|member|krn_type
r_volatile
id|u32
id|krn_type
suffix:semicolon
DECL|member|krn_csr
r_volatile
id|u32
id|krn_csr
suffix:semicolon
DECL|member|krn_value
r_volatile
id|u32
id|krn_value
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_lc_ss0_krn
r_struct
id|leo_lc_ss0_krn
(brace
DECL|member|misc
r_volatile
id|u32
id|misc
suffix:semicolon
DECL|member|xxx0
id|u8
id|xxx0
(braket
l_int|0x800
op_minus
l_int|4
)braket
suffix:semicolon
DECL|member|rev
r_volatile
id|u32
id|rev
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_lc_ss0_usr
r_struct
id|leo_lc_ss0_usr
(brace
DECL|member|csr
r_volatile
id|u32
id|csr
suffix:semicolon
DECL|member|attrs
r_volatile
id|u32
id|attrs
suffix:semicolon
DECL|member|fontc
r_volatile
id|u32
id|fontc
suffix:semicolon
DECL|member|fontc2
r_volatile
id|u32
id|fontc2
suffix:semicolon
DECL|member|extent
r_volatile
id|u32
id|extent
suffix:semicolon
DECL|member|src
r_volatile
id|u32
id|src
suffix:semicolon
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|copy
r_volatile
id|u32
id|copy
suffix:semicolon
DECL|member|fill
r_volatile
id|u32
id|fill
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_lc_ss1_krn
r_struct
id|leo_lc_ss1_krn
(brace
DECL|member|unknown
id|u8
id|unknown
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_lc_ss1_usr
r_struct
id|leo_lc_ss1_usr
(brace
DECL|member|unknown
id|u8
id|unknown
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_ld_ss0
r_struct
id|leo_ld_ss0
(brace
DECL|member|xxx0
id|u8
id|xxx0
(braket
l_int|0xe00
)braket
suffix:semicolon
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|unk
r_volatile
id|u32
id|unk
suffix:semicolon
DECL|member|xxx2
id|u32
id|xxx2
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|unk2
r_volatile
id|u32
id|unk2
suffix:semicolon
DECL|member|unk3
r_volatile
id|u32
id|unk3
suffix:semicolon
DECL|member|xxx3
id|u32
id|xxx3
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|fg
r_volatile
id|u32
id|fg
suffix:semicolon
DECL|member|bg
r_volatile
id|u32
id|bg
suffix:semicolon
DECL|member|xxx4
id|u8
id|xxx4
(braket
l_int|0x05c
)braket
suffix:semicolon
DECL|member|planemask
r_volatile
id|u32
id|planemask
suffix:semicolon
DECL|member|rop
r_volatile
id|u32
id|rop
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|LEO_SS1_MISC_ENABLE
mdefine_line|#define LEO_SS1_MISC_ENABLE&t;0x00000001
DECL|macro|LEO_SS1_MISC_STEREO
mdefine_line|#define LEO_SS1_MISC_STEREO&t;0x00000002
DECL|struct|leo_ld_ss1
r_struct
id|leo_ld_ss1
(brace
DECL|member|xxx0
id|u8
id|xxx0
(braket
l_int|0xef4
)braket
suffix:semicolon
DECL|member|ss1_misc
r_volatile
id|u32
id|ss1_misc
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|leo_ld_gbl
r_struct
id|leo_ld_gbl
(brace
DECL|member|unknown
id|u8
id|unknown
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|leo_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|leo_mmap_map
(braket
)braket
op_assign
(brace
(brace
id|LEO_SS0_MAP
comma
id|LEO_OFF_SS0
comma
l_int|0x800000
)brace
comma
(brace
id|LEO_LC_SS0_USR_MAP
comma
id|LEO_OFF_LC_SS0_USR
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LD_SS0_MAP
comma
id|LEO_OFF_LD_SS0
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LX_CURSOR_MAP
comma
id|LEO_OFF_LX_CURSOR
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_SS1_MAP
comma
id|LEO_OFF_SS1
comma
l_int|0x800000
)brace
comma
(brace
id|LEO_LC_SS1_USR_MAP
comma
id|LEO_OFF_LC_SS1_USR
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LD_SS1_MAP
comma
id|LEO_OFF_LD_SS1
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_UNK_MAP
comma
id|LEO_OFF_UNK
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LX_KRN_MAP
comma
id|LEO_OFF_LX_KRN
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LC_SS0_KRN_MAP
comma
id|LEO_OFF_LC_SS0_KRN
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LC_SS1_KRN_MAP
comma
id|LEO_OFF_LC_SS1_KRN
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_LD_GBL_MAP
comma
id|LEO_OFF_LD_GBL
comma
id|PAGE_SIZE
)brace
comma
(brace
id|LEO_UNK2_MAP
comma
id|LEO_OFF_UNK2
comma
l_int|0x100000
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|leo_setup
r_static
r_void
id|leo_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
id|p-&gt;next_line
op_assign
l_int|8192
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|leo_clear
r_static
r_void
id|leo_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|leo_lc_ss0_usr
op_star
id|us
op_assign
id|fb-&gt;s.leo.lc_ss0_usr
suffix:semicolon
r_register
r_struct
id|leo_ld_ss0
op_star
id|ss
op_assign
id|fb-&gt;s.leo.ld_ss0
suffix:semicolon
r_int
id|x
comma
id|y
comma
id|w
comma
id|h
suffix:semicolon
r_int
id|i
suffix:semicolon
r_do
(brace
id|i
op_assign
id|us-&gt;csr
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x20000000
)paren
suffix:semicolon
id|ss-&gt;unk
op_assign
l_int|0xffff
suffix:semicolon
id|ss-&gt;unk2
op_assign
l_int|0
suffix:semicolon
id|ss-&gt;unk3
op_assign
id|fb-&gt;s.leo.extent
suffix:semicolon
id|ss-&gt;fg
op_assign
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
op_lshift
l_int|24
)paren
op_or
l_int|0x030703
suffix:semicolon
id|ss-&gt;planemask
op_assign
l_int|0xff000000
suffix:semicolon
id|ss-&gt;rop
op_assign
l_int|0xd0840
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|y
op_assign
id|sy
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|h
op_assign
id|height
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|y
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|h
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
(brace
id|x
op_assign
id|sx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|w
op_assign
id|width
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|x
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|w
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|us-&gt;extent
op_assign
(paren
id|w
op_minus
l_int|1
)paren
op_or
(paren
(paren
id|h
op_minus
l_int|1
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|i
op_assign
id|us-&gt;attrs
suffix:semicolon
id|us-&gt;fill
op_assign
(paren
id|x
op_plus
id|fb-&gt;x_margin
)paren
op_or
(paren
(paren
id|y
op_plus
id|fb-&gt;y_margin
)paren
op_lshift
l_int|11
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|3
)paren
op_lshift
l_int|29
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|8
)paren
ques
c_cond
l_int|0x80000000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|leo_fill
r_static
r_void
id|leo_fill
c_func
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|s
comma
r_int
id|count
comma
r_int
r_int
op_star
id|boxes
)paren
(brace
r_int
id|i
suffix:semicolon
r_register
r_struct
id|leo_lc_ss0_usr
op_star
id|us
op_assign
id|fb-&gt;s.leo.lc_ss0_usr
suffix:semicolon
r_register
r_struct
id|leo_ld_ss0
op_star
id|ss
op_assign
id|fb-&gt;s.leo.ld_ss0
suffix:semicolon
r_do
(brace
id|i
op_assign
id|us-&gt;csr
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x20000000
)paren
suffix:semicolon
id|ss-&gt;unk
op_assign
l_int|0xffff
suffix:semicolon
id|ss-&gt;unk2
op_assign
l_int|0
suffix:semicolon
id|ss-&gt;unk3
op_assign
id|fb-&gt;s.leo.extent
suffix:semicolon
id|ss-&gt;fg
op_assign
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|s
)paren
op_lshift
l_int|24
)paren
op_or
l_int|0x030703
suffix:semicolon
id|ss-&gt;planemask
op_assign
l_int|0xff000000
suffix:semicolon
id|ss-&gt;rop
op_assign
l_int|0xd0840
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
id|us-&gt;extent
op_assign
(paren
id|boxes
(braket
l_int|2
)braket
op_minus
id|boxes
(braket
l_int|0
)braket
op_minus
l_int|1
)paren
op_or
(paren
(paren
id|boxes
(braket
l_int|3
)braket
op_minus
id|boxes
(braket
l_int|1
)braket
op_minus
l_int|1
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|i
op_assign
id|us-&gt;attrs
suffix:semicolon
id|us-&gt;fill
op_assign
id|boxes
(braket
l_int|0
)braket
op_or
(paren
id|boxes
(braket
l_int|1
)braket
op_lshift
l_int|11
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|3
)paren
op_lshift
l_int|29
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|8
)paren
ques
c_cond
l_int|0x80000000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|leo_putc
r_static
r_void
id|leo_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|leo_lc_ss0_usr
op_star
id|us
op_assign
id|fb-&gt;s.leo.lc_ss0_usr
suffix:semicolon
r_register
r_struct
id|leo_ld_ss0
op_star
id|ss
op_assign
id|fb-&gt;s.leo.ld_ss0
suffix:semicolon
r_int
id|i
comma
id|x
comma
id|y
suffix:semicolon
id|u8
op_star
id|fd
suffix:semicolon
id|u32
op_star
id|u
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|y
op_assign
id|yy
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|11
)paren
suffix:semicolon
id|i
op_assign
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|y
op_assign
(paren
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|11
suffix:semicolon
id|i
op_assign
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|fd
op_assign
id|p-&gt;fontdata
op_plus
id|i
suffix:semicolon
r_else
id|fd
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|i
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
id|x
op_assign
id|xx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|x
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|us-&gt;csr
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x20000000
)paren
suffix:semicolon
id|ss-&gt;fg
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
op_lshift
l_int|24
suffix:semicolon
id|ss-&gt;bg
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
op_lshift
l_int|24
suffix:semicolon
id|ss-&gt;rop
op_assign
l_int|0x310040
suffix:semicolon
id|ss-&gt;planemask
op_assign
l_int|0xff000000
suffix:semicolon
id|us-&gt;fontc2
op_assign
l_int|0xFFFFFFFE
suffix:semicolon
id|us-&gt;attrs
op_assign
l_int|4
suffix:semicolon
id|us-&gt;fontc
op_assign
l_int|0xFFFFFFFF
op_lshift
(paren
l_int|32
op_minus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|u
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;screen_base
)paren
op_plus
id|y
op_plus
id|x
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
op_star
id|u
op_assign
op_star
id|fd
op_increment
op_lshift
l_int|24
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
(brace
op_star
id|u
op_assign
op_star
(paren
id|u16
op_star
)paren
id|fd
op_lshift
l_int|16
suffix:semicolon
id|fd
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
)brace
DECL|function|leo_putcs
r_static
r_void
id|leo_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|leo_lc_ss0_usr
op_star
id|us
op_assign
id|fb-&gt;s.leo.lc_ss0_usr
suffix:semicolon
r_register
r_struct
id|leo_ld_ss0
op_star
id|ss
op_assign
id|fb-&gt;s.leo.ld_ss0
suffix:semicolon
r_int
id|i
comma
id|x
comma
id|y
suffix:semicolon
id|u8
op_star
id|fd1
comma
op_star
id|fd2
comma
op_star
id|fd3
comma
op_star
id|fd4
suffix:semicolon
id|u32
op_star
id|u
suffix:semicolon
r_do
(brace
id|i
op_assign
id|us-&gt;csr
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x20000000
)paren
suffix:semicolon
id|ss-&gt;fg
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
op_star
id|s
)paren
op_lshift
l_int|24
suffix:semicolon
id|ss-&gt;bg
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
op_star
id|s
)paren
op_lshift
l_int|24
suffix:semicolon
id|ss-&gt;rop
op_assign
l_int|0x310040
suffix:semicolon
id|ss-&gt;planemask
op_assign
l_int|0xff000000
suffix:semicolon
id|us-&gt;fontc2
op_assign
l_int|0xFFFFFFFE
suffix:semicolon
id|us-&gt;attrs
op_assign
l_int|4
suffix:semicolon
id|us-&gt;fontc
op_assign
l_int|0xFFFFFFFF
op_lshift
(paren
l_int|32
op_minus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
id|x
op_assign
(paren
id|xx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|x
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
id|y
op_assign
id|yy
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|11
)paren
suffix:semicolon
r_else
id|y
op_assign
(paren
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|11
suffix:semicolon
id|u
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;screen_base
)paren
op_plus
id|y
op_plus
id|x
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|us-&gt;fontc
op_assign
l_int|0xFFFFFFFF
op_lshift
(paren
l_int|32
op_minus
l_int|4
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|x
op_assign
l_int|4
op_star
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|2048
suffix:semicolon
r_while
c_loop
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|count
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd3
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd4
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd3
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd4
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_eq
l_int|8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
op_star
id|u
op_assign
(paren
(paren
id|u32
)paren
op_star
id|fd4
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd3
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd2
op_increment
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd1
op_increment
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|u
op_add_assign
id|x
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
op_star
id|u
op_assign
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd4
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd3
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd2
op_increment
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd1
op_increment
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
(paren
l_int|24
op_minus
l_int|3
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|u
op_add_assign
id|x
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|us-&gt;fontc
op_assign
l_int|0xFFFFFFFF
op_lshift
(paren
l_int|32
op_minus
l_int|2
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|x
op_assign
l_int|2
op_star
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|2048
suffix:semicolon
r_while
c_loop
(paren
id|count
op_ge
l_int|2
)paren
(brace
id|count
op_sub_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
(brace
op_star
id|u
op_assign
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
(paren
id|u16
op_star
)paren
id|fd1
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_or
(paren
(paren
id|u32
)paren
op_star
(paren
id|u16
op_star
)paren
id|fd2
)paren
)paren
op_lshift
(paren
l_int|16
op_minus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd1
op_add_assign
l_int|2
suffix:semicolon
id|fd2
op_add_assign
l_int|2
suffix:semicolon
)brace
id|u
op_add_assign
id|x
suffix:semicolon
)brace
)brace
id|us-&gt;fontc
op_assign
l_int|0xFFFFFFFF
op_lshift
(paren
l_int|32
op_minus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|x
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|2048
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
id|i
op_assign
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|i
op_assign
(paren
(paren
op_star
id|s
op_increment
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
op_star
id|u
op_assign
op_star
id|fd1
op_increment
op_lshift
l_int|24
suffix:semicolon
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|i
op_lshift
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
comma
id|u
op_add_assign
l_int|2048
)paren
(brace
op_star
id|u
op_assign
op_star
(paren
id|u16
op_star
)paren
id|fd1
op_lshift
l_int|16
suffix:semicolon
id|fd1
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
id|u
op_add_assign
id|x
suffix:semicolon
)brace
)brace
DECL|function|leo_revc
r_static
r_void
id|leo_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
multiline_comment|/* Not used if hw cursor */
)brace
DECL|function|leo_wait
r_static
r_int
id|leo_wait
(paren
r_struct
id|leo_lx_krn
op_star
id|lx_krn
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|lx_krn-&gt;krn_csr
op_amp
id|LEO_KRN_CSR_PROGRESS
)paren
op_logical_and
id|i
OL
l_int|300000
suffix:semicolon
id|i
op_increment
)paren
id|udelay
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Busy wait at most 0.3 sec */
r_if
c_cond
(paren
id|i
op_eq
l_int|300000
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* Timed out - should we print some message? */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|leo_loadcmap
r_static
r_void
id|leo_loadcmap
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
r_struct
id|leo_lx_krn
op_star
id|lx_krn
op_assign
id|fb-&gt;s.leo.lx_krn
suffix:semicolon
r_int
id|i
suffix:semicolon
id|lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_CLUT0
suffix:semicolon
id|i
op_assign
id|leo_wait
(paren
id|lx_krn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
suffix:semicolon
id|lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_CLUTDATA
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|lx_krn-&gt;krn_value
op_assign
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
op_or
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Throw colors there :)) */
id|lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_CLUT0
suffix:semicolon
id|lx_krn-&gt;krn_csr
op_or_assign
(paren
id|LEO_KRN_CSR_UNK
op_or
id|LEO_KRN_CSR_UNK2
)paren
suffix:semicolon
)brace
DECL|function|leo_restore_palette
r_static
r_void
id|leo_restore_palette
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
id|fb-&gt;s.leo.ld_ss1-&gt;ss1_misc
op_and_assign
op_complement
(paren
id|LEO_SS1_MISC_ENABLE
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|display_switch
id|leo_dispsw
id|__initdata
op_assign
(brace
id|leo_setup
comma
id|fbcon_redraw_bmove
comma
id|leo_clear
comma
id|leo_putc
comma
id|leo_putcs
comma
id|leo_revc
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
multiline_comment|/* Allow fontwidths up to 16 */
)brace
suffix:semicolon
DECL|function|leo_setcursormap
r_static
r_void
id|leo_setcursormap
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
)paren
(brace
r_struct
id|leo_cursor
op_star
id|l
op_assign
id|fb-&gt;s.leo.cursor
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|l-&gt;cur_misc
op_amp
id|LEO_CUR_PROGRESS
)paren
op_logical_and
id|i
OL
l_int|300000
suffix:semicolon
id|i
op_increment
)paren
id|udelay
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Busy wait at most 0.3 sec */
r_if
c_cond
(paren
id|i
op_eq
l_int|300000
)paren
r_return
suffix:semicolon
multiline_comment|/* Timed out - should we print some message? */
id|l-&gt;cur_type
op_assign
id|LEO_CUR_TYPE_CMAP
suffix:semicolon
id|l-&gt;cur_data
op_assign
(paren
id|red
(braket
l_int|0
)braket
op_or
(paren
id|green
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|l-&gt;cur_data
op_assign
(paren
id|red
(braket
l_int|1
)braket
op_or
(paren
id|green
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|l-&gt;cur_misc
op_assign
id|LEO_CUR_UPDATECMAP
suffix:semicolon
)brace
multiline_comment|/* Set cursor shape */
DECL|function|leo_setcurshape
r_static
r_void
id|leo_setcurshape
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|u32
id|m
comma
id|n
comma
id|mask
suffix:semicolon
r_struct
id|leo_cursor
op_star
id|l
op_assign
id|fb-&gt;s.leo.cursor
suffix:semicolon
id|l-&gt;cur_misc
op_and_assign
op_complement
id|LEO_CUR_ENABLE
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|2
suffix:semicolon
id|k
op_increment
)paren
(brace
id|l-&gt;cur_type
op_assign
(paren
id|k
op_star
id|LEO_CUR_TYPE_IMAGE
)paren
suffix:semicolon
multiline_comment|/* LEO_CUR_TYPE_MASK is 0 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mask
op_assign
l_int|0
suffix:semicolon
id|m
op_assign
id|fb-&gt;cursor.bits
(braket
id|k
)braket
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* mask = m with reversed bit order */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
comma
id|n
op_assign
l_int|1
suffix:semicolon
id|j
OL
l_int|32
suffix:semicolon
id|j
op_increment
comma
id|n
op_lshift_assign
l_int|1
)paren
r_if
c_cond
(paren
id|m
op_amp
id|n
)paren
id|mask
op_or_assign
(paren
l_int|0x80000000
op_rshift
id|j
)paren
suffix:semicolon
id|l-&gt;cur_data
op_assign
id|mask
suffix:semicolon
)brace
)brace
id|l-&gt;cur_misc
op_or_assign
id|LEO_CUR_ENABLE
suffix:semicolon
)brace
multiline_comment|/* Load cursor information */
DECL|function|leo_setcursor
r_static
r_void
id|leo_setcursor
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_struct
id|cg_cursor
op_star
id|c
op_assign
op_amp
id|fb-&gt;cursor
suffix:semicolon
r_struct
id|leo_cursor
op_star
id|l
op_assign
id|fb-&gt;s.leo.cursor
suffix:semicolon
id|l-&gt;cur_misc
op_and_assign
op_complement
id|LEO_CUR_ENABLE
suffix:semicolon
id|l-&gt;cur_cursxy
op_assign
(paren
(paren
id|c-&gt;cpos.fbx
op_minus
id|c-&gt;chot.fbx
)paren
op_amp
l_int|0x7ff
)paren
op_or
(paren
(paren
(paren
id|c-&gt;cpos.fby
op_minus
id|c-&gt;chot.fby
)paren
op_amp
l_int|0x7ff
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|l-&gt;cur_misc
op_or_assign
id|LEO_CUR_UPDATE
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;enable
)paren
id|l-&gt;cur_misc
op_or_assign
id|LEO_CUR_ENABLE
suffix:semicolon
)brace
DECL|function|leo_blank
r_static
r_void
id|leo_blank
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
id|fb-&gt;s.leo.lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_VIDEO
suffix:semicolon
id|fb-&gt;s.leo.lx_krn-&gt;krn_csr
op_and_assign
op_complement
id|LEO_KRN_CSR_ENABLE
suffix:semicolon
)brace
DECL|function|leo_unblank
r_static
r_void
id|leo_unblank
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
id|fb-&gt;s.leo.lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_VIDEO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fb-&gt;s.leo.lx_krn-&gt;krn_csr
op_amp
id|LEO_KRN_CSR_ENABLE
)paren
)paren
id|fb-&gt;s.leo.lx_krn-&gt;krn_csr
op_or_assign
id|LEO_KRN_CSR_ENABLE
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|leo_wid_put
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|fb_wid_list
op_star
id|wl
)paren
)paren
(brace
r_struct
id|leo_lx_krn
op_star
id|lx_krn
op_assign
id|fb-&gt;s.leo.lx_krn
suffix:semicolon
r_struct
id|fb_wid_item
op_star
id|wi
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|lx_krn-&gt;krn_type
op_assign
id|LEO_KRN_TYPE_WID
suffix:semicolon
id|i
op_assign
id|leo_wait
(paren
id|lx_krn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|wi
op_assign
id|wl-&gt;wl_list
suffix:semicolon
id|i
OL
id|wl-&gt;wl_count
suffix:semicolon
id|i
op_increment
comma
id|wi
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|wi-&gt;wi_type
)paren
(brace
r_case
id|FB_WID_DBL_8
suffix:colon
id|j
op_assign
(paren
id|wi-&gt;wi_index
op_amp
l_int|0xf
)paren
op_plus
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_WID_DBL_24
suffix:colon
id|j
op_assign
id|wi-&gt;wi_index
op_amp
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|lx_krn-&gt;krn_type
op_assign
l_int|0x5800
op_plus
id|j
suffix:semicolon
id|lx_krn-&gt;krn_value
op_assign
id|wi-&gt;wi_values
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|leo_margins
r_static
r_void
id|leo_margins
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|x_margin
comma
r_int
id|y_margin
)paren
(brace
id|p-&gt;screen_base
op_add_assign
l_int|8192
op_star
(paren
id|y_margin
op_minus
id|fb-&gt;y_margin
)paren
op_plus
l_int|4
op_star
(paren
id|x_margin
op_minus
id|fb-&gt;x_margin
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_char
id|idstring
(braket
l_int|40
)braket
id|__initdata
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_char
op_star
id|leofb_init
c_func
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
)paren
(brace
r_struct
id|fb_fix_screeninfo
op_star
id|fix
op_assign
op_amp
id|fb-&gt;fix
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|fb-&gt;var
suffix:semicolon
r_struct
id|display
op_star
id|disp
op_assign
op_amp
id|fb-&gt;disp
suffix:semicolon
r_struct
id|fbtype
op_star
id|type
op_assign
op_amp
id|fb-&gt;type
suffix:semicolon
r_int
r_int
id|phys
op_assign
id|fb-&gt;sbdp-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
r_struct
id|fb_wid_item
id|wi
suffix:semicolon
r_struct
id|fb_wid_list
id|wl
suffix:semicolon
r_int
id|i
suffix:semicolon
id|strcpy
c_func
(paren
id|fb-&gt;info.modename
comma
l_string|&quot;Leo&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;Leo&quot;
)paren
suffix:semicolon
id|fix-&gt;visual
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* We only know how to do acceleration and know nothing&n;&t;                       about the actual memory layout */
id|fix-&gt;line_length
op_assign
l_int|8192
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SUN_LEO
suffix:semicolon
id|var-&gt;accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|disp-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|disp-&gt;screen_base
)paren
id|disp-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_SS0
comma
l_int|0
comma
l_int|0x800000
comma
l_string|&quot;leo_ram&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|disp-&gt;screen_base
op_add_assign
l_int|8192
op_star
id|fb-&gt;y_margin
op_plus
l_int|4
op_star
id|fb-&gt;x_margin
suffix:semicolon
id|fb-&gt;s.leo.lc_ss0_usr
op_assign
(paren
r_struct
id|leo_lc_ss0_usr
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_LC_SS0_USR
comma
l_int|0
comma
id|PAGE_SIZE
comma
l_string|&quot;leo_lc_ss0_usr&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0
op_assign
(paren
r_struct
id|leo_ld_ss0
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_LD_SS0
comma
l_int|0
comma
id|PAGE_SIZE
comma
l_string|&quot;leo_ld_ss0&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;s.leo.ld_ss1
op_assign
(paren
r_struct
id|leo_ld_ss1
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_LD_SS1
comma
l_int|0
comma
id|PAGE_SIZE
comma
l_string|&quot;leo_ld_ss1&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;s.leo.lx_krn
op_assign
(paren
r_struct
id|leo_lx_krn
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_LX_KRN
comma
l_int|0
comma
id|PAGE_SIZE
comma
l_string|&quot;leo_lx_krn&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;s.leo.cursor
op_assign
(paren
r_struct
id|leo_cursor
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|phys
op_plus
id|LEO_OFF_LX_CURSOR
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|leo_cursor
)paren
comma
l_string|&quot;leo_lx_cursor&quot;
comma
id|fb-&gt;iospace
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;dispsw
op_assign
id|leo_dispsw
suffix:semicolon
id|fb-&gt;s.leo.extent
op_assign
(paren
id|type-&gt;fb_width
op_minus
l_int|1
)paren
op_or
(paren
(paren
id|type-&gt;fb_height
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;unk
op_assign
l_int|0xffff
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;unk2
op_assign
l_int|0
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;unk3
op_assign
id|fb-&gt;s.leo.extent
suffix:semicolon
id|wl.wl_count
op_assign
l_int|1
suffix:semicolon
id|wl.wl_list
op_assign
op_amp
id|wi
suffix:semicolon
id|wi.wi_type
op_assign
id|FB_WID_DBL_8
suffix:semicolon
id|wi.wi_index
op_assign
l_int|0
suffix:semicolon
id|wi.wi_values
(braket
l_int|0
)braket
op_assign
l_int|0x2c0
suffix:semicolon
id|leo_wid_put
(paren
id|fb
comma
op_amp
id|wl
)paren
suffix:semicolon
id|wi.wi_index
op_assign
l_int|1
suffix:semicolon
id|wi.wi_values
(braket
l_int|0
)braket
op_assign
l_int|0x30
suffix:semicolon
id|leo_wid_put
(paren
id|fb
comma
op_amp
id|wl
)paren
suffix:semicolon
id|wi.wi_index
op_assign
l_int|2
suffix:semicolon
id|wi.wi_values
(braket
l_int|0
)braket
op_assign
l_int|0x20
suffix:semicolon
id|leo_wid_put
(paren
id|fb
comma
op_amp
id|wl
)paren
suffix:semicolon
id|fb-&gt;s.leo.ld_ss1-&gt;ss1_misc
op_or_assign
id|LEO_SS1_MISC_ENABLE
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;fg
op_assign
l_int|0x30703
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;planemask
op_assign
l_int|0xff000000
suffix:semicolon
id|fb-&gt;s.leo.ld_ss0-&gt;rop
op_assign
l_int|0xd0840
suffix:semicolon
id|fb-&gt;s.leo.lc_ss0_usr-&gt;extent
op_assign
(paren
id|type-&gt;fb_width
op_minus
l_int|1
)paren
op_or
(paren
(paren
id|type-&gt;fb_height
op_minus
l_int|1
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|i
op_assign
id|fb-&gt;s.leo.lc_ss0_usr-&gt;attrs
suffix:semicolon
id|fb-&gt;s.leo.lc_ss0_usr-&gt;fill
op_assign
(paren
l_int|0
)paren
op_or
(paren
(paren
l_int|0
)paren
op_lshift
l_int|11
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|3
)paren
op_lshift
l_int|29
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|8
)paren
ques
c_cond
l_int|0x80000000
suffix:colon
l_int|0
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|fb-&gt;s.leo.lc_ss0_usr-&gt;csr
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x20000000
)paren
suffix:semicolon
id|fb-&gt;margins
op_assign
id|leo_margins
suffix:semicolon
id|fb-&gt;loadcmap
op_assign
id|leo_loadcmap
suffix:semicolon
id|fb-&gt;setcursor
op_assign
id|leo_setcursor
suffix:semicolon
id|fb-&gt;setcursormap
op_assign
id|leo_setcursormap
suffix:semicolon
id|fb-&gt;setcurshape
op_assign
id|leo_setcurshape
suffix:semicolon
id|fb-&gt;restore_palette
op_assign
id|leo_restore_palette
suffix:semicolon
id|fb-&gt;fill
op_assign
id|leo_fill
suffix:semicolon
id|fb-&gt;blank
op_assign
id|leo_blank
suffix:semicolon
id|fb-&gt;unblank
op_assign
id|leo_unblank
suffix:semicolon
id|fb-&gt;physbase
op_assign
id|phys
suffix:semicolon
id|fb-&gt;mmap_map
op_assign
id|leo_mmap_map
suffix:semicolon
macro_line|#ifdef __sparc_v9__
id|sprintf
c_func
(paren
id|idstring
comma
l_string|&quot;leo at %016lx&quot;
comma
id|phys
)paren
suffix:semicolon
macro_line|#else&t;
id|sprintf
c_func
(paren
id|idstring
comma
l_string|&quot;leo at %x.%08lx&quot;
comma
id|fb-&gt;iospace
comma
id|phys
)paren
suffix:semicolon
macro_line|#endif
r_return
id|idstring
suffix:semicolon
)brace
eof
