multiline_comment|/*&n; * linux/drivers/video/amifb.c -- Amiga builtin chipset frame buffer device&n; *&n; *    Copyright (C) 1995 Geert Uytterhoeven&n; *&n; *          with work by Roman Zippel&n; *&n; *&n; * This file is based on the Atari frame buffer device (atafb.c):&n; *&n; *    Copyright (C) 1994 Martin Schaller&n; *                       Roman Hodek&n; *&n; *          with work by Andreas Schwab&n; *                       Guenther Kelleter&n; *&n; * and on the original Amiga console driver (amicon.c):&n; *&n; *    Copyright (C) 1993 Hamish Macdonald&n; *                       Greg Harp&n; *    Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *          with work by William Rucklidge (wjr@cs.cornell.edu)&n; *                       Geert Uytterhoeven&n; *                       Jes Sorensen (jds@kom.auc.dk)&n; *&n; *&n; * History:&n; *&n; *   - 24 Jul 96: Copper generates now vblank interrupt and&n; *                VESA Power Saving Protocol is fully implemented&n; *   - 14 Jul 96: Rework and hopefully last ECS bugs fixed&n; *   -  7 Mar 96: Hardware sprite support by Roman Zippel&n; *   - 18 Feb 96: OCS and ECS support by Roman Zippel&n; *                Hardware functions completely rewritten&n; *   -  2 Dec 95: AGA version by Geert Uytterhoeven&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License. See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-afb.h&gt;
macro_line|#include &lt;video/fbcon-ilbm.h&gt;
macro_line|#include &lt;video/fbcon-mfb.h&gt;
DECL|macro|DEBUG
mdefine_line|#define DEBUG
macro_line|#if !defined(CONFIG_FB_AMIGA_OCS) &amp;&amp; !defined(CONFIG_FB_AMIGA_ECS) &amp;&amp; !defined(CONFIG_FB_AMIGA_AGA)
DECL|macro|CONFIG_FB_AMIGA_OCS
mdefine_line|#define CONFIG_FB_AMIGA_OCS   /* define at least one fb driver, this will change later */
macro_line|#endif
macro_line|#if !defined(CONFIG_FB_AMIGA_OCS)
DECL|macro|IS_OCS
macro_line|#  define IS_OCS (0)
macro_line|#elif defined(CONFIG_FB_AMIGA_ECS) || defined(CONFIG_FB_AMIGA_AGA)
DECL|macro|IS_OCS
macro_line|#  define IS_OCS (chipset == TAG_OCS)
macro_line|#else
DECL|macro|CONFIG_FB_AMIGA_OCS_ONLY
macro_line|#  define CONFIG_FB_AMIGA_OCS_ONLY
DECL|macro|IS_OCS
macro_line|#  define IS_OCS (1)
macro_line|#endif
macro_line|#if !defined(CONFIG_FB_AMIGA_ECS)
DECL|macro|IS_ECS
macro_line|#  define IS_ECS (0)
macro_line|#elif defined(CONFIG_FB_AMIGA_OCS) || defined(CONFIG_FB_AMIGA_AGA)
DECL|macro|IS_ECS
macro_line|#  define IS_ECS (chipset == TAG_ECS)
macro_line|#else
DECL|macro|CONFIG_FB_AMIGA_ECS_ONLY
macro_line|#  define CONFIG_FB_AMIGA_ECS_ONLY
DECL|macro|IS_ECS
macro_line|#  define IS_ECS (1)
macro_line|#endif
macro_line|#if !defined(CONFIG_FB_AMIGA_AGA)
DECL|macro|IS_AGA
macro_line|#  define IS_AGA (0)
macro_line|#elif defined(CONFIG_FB_AMIGA_OCS) || defined(CONFIG_FB_AMIGA_ECS)
DECL|macro|IS_AGA
macro_line|#  define IS_AGA (chipset == TAG_AGA)
macro_line|#else
DECL|macro|CONFIG_FB_AMIGA_AGA_ONLY
macro_line|#  define CONFIG_FB_AMIGA_AGA_ONLY
DECL|macro|IS_AGA
macro_line|#  define IS_AGA (1)
macro_line|#endif
macro_line|#ifdef DEBUG
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...)&t;printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...)
macro_line|#endif
multiline_comment|/*******************************************************************************&n;&n;&n;   Generic video timings&n;   ---------------------&n;&n;   Timings used by the frame buffer interface:&n;&n;   +----------+---------------------------------------------+----------+-------+&n;   |          |                ^                            |          |       |&n;   |          |                |upper_margin                |          |       |&n;   |          |                &#xfffd;                            |          |       |&n;   +----------###############################################----------+-------+&n;   |          #                ^                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |   left   #                |                            #  right   | hsync |&n;   |  margin  #                |       xres                 #  margin  |  len  |&n;   |&lt;--------&gt;#&lt;---------------+---------------------------&gt;#&lt;--------&gt;|&lt;-----&gt;|&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |yres                        #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                |                            #          |       |&n;   |          #                &#xfffd;                            #          |       |&n;   +----------###############################################----------+-------+&n;   |          |                ^                            |          |       |&n;   |          |                |lower_margin                |          |       |&n;   |          |                &#xfffd;                            |          |       |&n;   +----------+---------------------------------------------+----------+-------+&n;   |          |                ^                            |          |       |&n;   |          |                |vsync_len                   |          |       |&n;   |          |                &#xfffd;                            |          |       |&n;   +----------+---------------------------------------------+----------+-------+&n;&n;&n;   Amiga video timings&n;   -------------------&n;&n;   The Amiga native chipsets uses another timing scheme:&n;&n;      - hsstrt:   Start of horizontal synchronization pulse&n;      - hsstop:   End of horizontal synchronization pulse&n;      - htotal:   Last value on the line (i.e. line length = htotal+1)&n;      - vsstrt:   Start of vertical synchronization pulse&n;      - vsstop:   End of vertical synchronization pulse&n;      - vtotal:   Last line value (i.e. number of lines = vtotal+1)&n;      - hcenter:  Start of vertical retrace for interlace&n;&n;   You can specify the blanking timings independently. Currently I just set&n;   them equal to the respective synchronization values:&n;&n;      - hbstrt:   Start of horizontal blank&n;      - hbstop:   End of horizontal blank&n;      - vbstrt:   Start of vertical blank&n;      - vbstop:   End of vertical blank&n;&n;   Horizontal values are in color clock cycles (280 ns), vertical values are in&n;   scanlines.&n;&n;   (0, 0) is somewhere in the upper-left corner :-)&n;&n;&n;   Amiga visible window definitions&n;   --------------------------------&n;&n;   Currently I only have values for AGA, SHRES (28 MHz dotclock). Feel free to&n;   make corrections and/or additions.&n;&n;   Within the above synchronization specifications, the visible window is&n;   defined by the following parameters (actual register resolutions may be&n;   different; all horizontal values are normalized with respect to the pixel&n;   clock):&n;&n;      - diwstrt_h:   Horizontal start of the visible window&n;      - diwstop_h:   Horizontal stop+1(*) of the visible window&n;      - diwstrt_v:   Vertical start of the visible window&n;      - diwstop_v:   Vertical stop of the visible window&n;      - ddfstrt:     Horizontal start of display DMA&n;      - ddfstop:     Horizontal stop of display DMA&n;      - hscroll:     Horizontal display output delay&n;&n;   Sprite positioning:&n;&n;      - sprstrt_h:   Horizontal start-4 of sprite&n;      - sprstrt_v:   Vertical start of sprite&n;&n;   (*) Even Commodore did it wrong in the AGA monitor drivers by not adding 1.&n;&n;   Horizontal values are in dotclock cycles (35 ns), vertical values are in&n;   scanlines.&n;&n;   (0, 0) is somewhere in the upper-left corner :-)&n;&n;&n;   Dependencies (AGA, SHRES (35 ns dotclock))&n;   -------------------------------------------&n;&n;   Since there are much more parameters for the Amiga display than for the&n;   frame buffer interface, there must be some dependencies among the Amiga&n;   display parameters. Here&squot;s what I found out:&n;&n;      - ddfstrt and ddfstop are best aligned to 64 pixels.&n;      - the chipset needs 64+4 horizontal pixels after the DMA start before the&n;        first pixel is output, so diwstrt_h = ddfstrt+64+4 if you want to&n;        display the first pixel on the line too. Increase diwstrt_h for virtual&n;        screen panning.&n;      - the display DMA always fetches 64 pixels at a time (fmode = 3).&n;      - ddfstop is ddfstrt+#pixels-64.&n;      - diwstop_h = diwstrt_h+xres+1. Because of the additional 1 this can be 1&n;        more than htotal.&n;      - hscroll simply adds a delay to the display output. Smooth horizontal&n;        panning needs an extra 64 pixels on the left to prefetch the pixels that&n;        `fall off&squot; on the left.&n;      - if ddfstrt &lt; 192, the sprite DMA cycles are all stolen by the bitplane&n;        DMA, so it&squot;s best to make the DMA start as late as possible.&n;      - you really don&squot;t want to make ddfstrt &lt; 128, since this will steal DMA&n;        cycles from the other DMA channels (audio, floppy and Chip RAM refresh).&n;      - I make diwstop_h and diwstop_v as large as possible.&n;&n;   General dependencies&n;   --------------------&n;&n;      - all values are SHRES pixel (35ns)&n;&n;                  table 1:fetchstart  table 2:prefetch    table 3:fetchsize&n;                  ------------------  ----------------    -----------------&n;   Pixclock     # SHRES|HIRES|LORES # SHRES|HIRES|LORES # SHRES|HIRES|LORES&n;   -------------#------+-----+------#------+-----+------#------+-----+------&n;   Bus width 1x #   16 |  32 |  64  #   16 |  32 |  64  #   64 |  64 |  64&n;   Bus width 2x #   32 |  64 | 128  #   32 |  64 |  64  #   64 |  64 | 128&n;   Bus width 4x #   64 | 128 | 256  #   64 |  64 |  64  #   64 | 128 | 256&n;&n;      - chipset needs 4 pixels before the first pixel is output&n;      - ddfstrt must be aligned to fetchstart (table 1)&n;      - chipset needs also prefetch (table 2) to get first pixel data, so&n;        ddfstrt = ((diwstrt_h-4) &amp; -fetchstart) - prefetch&n;      - for horizontal panning decrease diwstrt_h&n;      - the length of a fetchline must be aligned to fetchsize (table 3)&n;      - if fetchstart is smaller than fetchsize, then ddfstrt can a little bit&n;        moved to optimize use of dma (usefull for OCS/ECS overscan displays)&n;      - ddfstop is ddfstrt+ddfsize-fetchsize&n;      - If C= didn&squot;t change anything for AGA, then at following positions the&n;        dma bus is allready used:&n;        ddfstrt &lt;  48 -&gt; memory refresh&n;                &lt;  96 -&gt; disk dma&n;                &lt; 160 -&gt; audio dma&n;                &lt; 192 -&gt; sprite 0 dma&n;                &lt; 416 -&gt; sprite dma (32 per sprite)&n;      - in accordance with the hardware reference manual a hardware stop is at&n;        192, but AGA (ECS?) can go below this.&n;&n;   DMA priorities&n;   --------------&n;&n;   Since there are limits on the earliest start value for display DMA and the&n;   display of sprites, I use the following policy on horizontal panning and&n;   the hardware cursor:&n;&n;      - if you want to start display DMA too early, you loose the ability to&n;        do smooth horizontal panning (xpanstep 1 -&gt; 64).&n;      - if you want to go even further, you loose the hardware cursor too.&n;&n;   IMHO a hardware cursor is more important for X than horizontal scrolling,&n;   so that&squot;s my motivation.&n;&n;&n;   Implementation&n;   --------------&n;&n;   ami_decode_var() converts the frame buffer values to the Amiga values. It&squot;s&n;   just a `straightforward&squot; implementation of the above rules.&n;&n;&n;   Standard VGA timings&n;   --------------------&n;&n;               xres  yres    left  right  upper  lower    hsync    vsync&n;               ----  ----    ----  -----  -----  -----    -----    -----&n;      80x25     720   400      27     45     35     12      108        2&n;      80x30     720   480      27     45     30      9      108        2&n;&n;   These were taken from a XFree86 configuration file, recalculated for a 28 MHz&n;   dotclock (Amigas don&squot;t have a 25 MHz dotclock) and converted to frame buffer&n;   generic timings.&n;&n;   As a comparison, graphics/monitor.h suggests the following:&n;&n;               xres  yres    left  right  upper  lower    hsync    vsync&n;               ----  ----    ----  -----  -----  -----    -----    -----&n;&n;      VGA       640   480      52    112     24     19    112 -      2 +&n;      VGA70     640   400      52    112     27     21    112 -      2 -&n;&n;&n;   Sync polarities&n;   ---------------&n;&n;      VSYNC    HSYNC    Vertical size    Vertical total&n;      -----    -----    -------------    --------------&n;        +        +           Reserved          Reserved&n;        +        -                400               414&n;        -        +                350               362&n;        -        -                480               496&n;&n;   Source: CL-GD542X Technical Reference Manual, Cirrus Logic, Oct 1992&n;&n;&n;   Broadcast video timings&n;   -----------------------&n;&n;   According to the CCIR and RETMA specifications, we have the following values:&n;&n;   CCIR -&gt; PAL&n;   -----------&n;&n;      - a scanline is 64 &#xfffd;s long, of which 52.48 &#xfffd;s are visible. This is about&n;        736 visible 70 ns pixels per line.&n;      - we have 625 scanlines, of which 575 are visible (interlaced); after&n;        rounding this becomes 576.&n;&n;   RETMA -&gt; NTSC&n;   -------------&n;&n;      - a scanline is 63.5 &#xfffd;s long, of which 53.5 &#xfffd;s are visible.  This is about&n;        736 visible 70 ns pixels per line.&n;      - we have 525 scanlines, of which 485 are visible (interlaced); after&n;        rounding this becomes 484.&n;&n;   Thus if you want a PAL compatible display, you have to do the following:&n;&n;      - set the FB_SYNC_BROADCAST flag to indicate that standard broadcast&n;        timings are to be used.&n;      - make sure upper_margin+yres+lower_margin+vsync_len = 625 for an&n;        interlaced, 312 for a non-interlaced and 156 for a doublescanned&n;        display.&n;      - make sure left_margin+xres+right_margin+hsync_len = 1816 for a SHRES,&n;        908 for a HIRES and 454 for a LORES display.&n;      - the left visible part begins at 360 (SHRES; HIRES:180, LORES:90),&n;        left_margin+2*hsync_len must be greater or equal.&n;      - the upper visible part begins at 48 (interlaced; non-interlaced:24,&n;        doublescanned:12), upper_margin+2*vsync_len must be greater or equal.&n;      - ami_encode_var() calculates margins with a hsync of 5320 ns and a vsync&n;        of 4 scanlines&n;&n;   The settings for a NTSC compatible display are straightforward.&n;&n;   Note that in a strict sense the PAL and NTSC standards only define the&n;   encoding of the color part (chrominance) of the video signal and don&squot;t say&n;   anything about horizontal/vertical synchronization nor refresh rates.&n;&n;&n;                                                            -- Geert --&n;&n;*******************************************************************************/
multiline_comment|/*&n;&t; * Custom Chipset Definitions&n;&t; */
DECL|macro|CUSTOM_OFS
mdefine_line|#define CUSTOM_OFS(fld) ((long)&amp;((struct CUSTOM*)0)-&gt;fld)
multiline_comment|/*&n;&t; * BPLCON0 -- Bitplane Control Register 0&n;&t; */
DECL|macro|BPC0_HIRES
mdefine_line|#define BPC0_HIRES&t;(0x8000)
DECL|macro|BPC0_BPU2
mdefine_line|#define BPC0_BPU2&t;(0x4000) /* Bit plane used count */
DECL|macro|BPC0_BPU1
mdefine_line|#define BPC0_BPU1&t;(0x2000)
DECL|macro|BPC0_BPU0
mdefine_line|#define BPC0_BPU0&t;(0x1000)
DECL|macro|BPC0_HAM
mdefine_line|#define BPC0_HAM&t;(0x0800) /* HAM mode */
DECL|macro|BPC0_DPF
mdefine_line|#define BPC0_DPF&t;(0x0400) /* Double playfield */
DECL|macro|BPC0_COLOR
mdefine_line|#define BPC0_COLOR&t;(0x0200) /* Enable colorburst */
DECL|macro|BPC0_GAUD
mdefine_line|#define BPC0_GAUD&t;(0x0100) /* Genlock audio enable */
DECL|macro|BPC0_UHRES
mdefine_line|#define BPC0_UHRES&t;(0x0080) /* Ultrahi res enable */
DECL|macro|BPC0_SHRES
mdefine_line|#define BPC0_SHRES&t;(0x0040) /* Super hi res mode */
DECL|macro|BPC0_BYPASS
mdefine_line|#define BPC0_BYPASS&t;(0x0020) /* Bypass LUT - AGA */
DECL|macro|BPC0_BPU3
mdefine_line|#define BPC0_BPU3&t;(0x0010) /* AGA */
DECL|macro|BPC0_LPEN
mdefine_line|#define BPC0_LPEN&t;(0x0008) /* Light pen enable */
DECL|macro|BPC0_LACE
mdefine_line|#define BPC0_LACE&t;(0x0004) /* Interlace */
DECL|macro|BPC0_ERSY
mdefine_line|#define BPC0_ERSY&t;(0x0002) /* External resync */
DECL|macro|BPC0_ECSENA
mdefine_line|#define BPC0_ECSENA&t;(0x0001) /* ECS enable */
multiline_comment|/*&n;&t; * BPLCON2 -- Bitplane Control Register 2&n;&t; */
DECL|macro|BPC2_ZDBPSEL2
mdefine_line|#define BPC2_ZDBPSEL2&t;(0x4000) /* Bitplane to be used for ZD - AGA */
DECL|macro|BPC2_ZDBPSEL1
mdefine_line|#define BPC2_ZDBPSEL1&t;(0x2000)
DECL|macro|BPC2_ZDBPSEL0
mdefine_line|#define BPC2_ZDBPSEL0&t;(0x1000)
DECL|macro|BPC2_ZDBPEN
mdefine_line|#define BPC2_ZDBPEN&t;(0x0800) /* Enable ZD with ZDBPSELx - AGA */
DECL|macro|BPC2_ZDCTEN
mdefine_line|#define BPC2_ZDCTEN&t;(0x0400) /* Enable ZD with palette bit #31 - AGA */
DECL|macro|BPC2_KILLEHB
mdefine_line|#define BPC2_KILLEHB&t;(0x0200) /* Kill EHB mode - AGA */
DECL|macro|BPC2_RDRAM
mdefine_line|#define BPC2_RDRAM&t;(0x0100) /* Color table accesses read, not write - AGA */
DECL|macro|BPC2_SOGEN
mdefine_line|#define BPC2_SOGEN&t;(0x0080) /* SOG output pin high - AGA */
DECL|macro|BPC2_PF2PRI
mdefine_line|#define BPC2_PF2PRI&t;(0x0040) /* PF2 priority over PF1 */
DECL|macro|BPC2_PF2P2
mdefine_line|#define BPC2_PF2P2&t;(0x0020) /* PF2 priority wrt sprites */
DECL|macro|BPC2_PF2P1
mdefine_line|#define BPC2_PF2P1&t;(0x0010)
DECL|macro|BPC2_PF2P0
mdefine_line|#define BPC2_PF2P0&t;(0x0008)
DECL|macro|BPC2_PF1P2
mdefine_line|#define BPC2_PF1P2&t;(0x0004) /* ditto PF1 */
DECL|macro|BPC2_PF1P1
mdefine_line|#define BPC2_PF1P1&t;(0x0002)
DECL|macro|BPC2_PF1P0
mdefine_line|#define BPC2_PF1P0&t;(0x0001)
multiline_comment|/*&n;&t; * BPLCON3 -- Bitplane Control Register 3 (AGA)&n;&t; */
DECL|macro|BPC3_BANK2
mdefine_line|#define BPC3_BANK2&t;(0x8000) /* Bits to select color register bank */
DECL|macro|BPC3_BANK1
mdefine_line|#define BPC3_BANK1&t;(0x4000)
DECL|macro|BPC3_BANK0
mdefine_line|#define BPC3_BANK0&t;(0x2000)
DECL|macro|BPC3_PF2OF2
mdefine_line|#define BPC3_PF2OF2&t;(0x1000) /* Bits for color table offset when PF2 */
DECL|macro|BPC3_PF2OF1
mdefine_line|#define BPC3_PF2OF1&t;(0x0800)
DECL|macro|BPC3_PF2OF0
mdefine_line|#define BPC3_PF2OF0&t;(0x0400)
DECL|macro|BPC3_LOCT
mdefine_line|#define BPC3_LOCT&t;(0x0200) /* Color register writes go to low bits */
DECL|macro|BPC3_SPRES1
mdefine_line|#define BPC3_SPRES1&t;(0x0080) /* Sprite resolution bits */
DECL|macro|BPC3_SPRES0
mdefine_line|#define BPC3_SPRES0&t;(0x0040)
DECL|macro|BPC3_BRDRBLNK
mdefine_line|#define BPC3_BRDRBLNK&t;(0x0020) /* Border blanked? */
DECL|macro|BPC3_BRDRTRAN
mdefine_line|#define BPC3_BRDRTRAN&t;(0x0010) /* Border transparent? */
DECL|macro|BPC3_ZDCLKEN
mdefine_line|#define BPC3_ZDCLKEN&t;(0x0004) /* ZD pin is 14 MHz (HIRES) clock output */
DECL|macro|BPC3_BRDRSPRT
mdefine_line|#define BPC3_BRDRSPRT&t;(0x0002) /* Sprites in border? */
DECL|macro|BPC3_EXTBLKEN
mdefine_line|#define BPC3_EXTBLKEN&t;(0x0001) /* BLANK programmable */
multiline_comment|/*&n;&t; * BPLCON4 -- Bitplane Control Register 4 (AGA)&n;&t; */
DECL|macro|BPC4_BPLAM7
mdefine_line|#define BPC4_BPLAM7&t;(0x8000) /* bitplane color XOR field */
DECL|macro|BPC4_BPLAM6
mdefine_line|#define BPC4_BPLAM6&t;(0x4000)
DECL|macro|BPC4_BPLAM5
mdefine_line|#define BPC4_BPLAM5&t;(0x2000)
DECL|macro|BPC4_BPLAM4
mdefine_line|#define BPC4_BPLAM4&t;(0x1000)
DECL|macro|BPC4_BPLAM3
mdefine_line|#define BPC4_BPLAM3&t;(0x0800)
DECL|macro|BPC4_BPLAM2
mdefine_line|#define BPC4_BPLAM2&t;(0x0400)
DECL|macro|BPC4_BPLAM1
mdefine_line|#define BPC4_BPLAM1&t;(0x0200)
DECL|macro|BPC4_BPLAM0
mdefine_line|#define BPC4_BPLAM0&t;(0x0100)
DECL|macro|BPC4_ESPRM7
mdefine_line|#define BPC4_ESPRM7&t;(0x0080) /* 4 high bits for even sprite colors */
DECL|macro|BPC4_ESPRM6
mdefine_line|#define BPC4_ESPRM6&t;(0x0040)
DECL|macro|BPC4_ESPRM5
mdefine_line|#define BPC4_ESPRM5&t;(0x0020)
DECL|macro|BPC4_ESPRM4
mdefine_line|#define BPC4_ESPRM4&t;(0x0010)
DECL|macro|BPC4_OSPRM7
mdefine_line|#define BPC4_OSPRM7&t;(0x0008) /* 4 high bits for odd sprite colors */
DECL|macro|BPC4_OSPRM6
mdefine_line|#define BPC4_OSPRM6&t;(0x0004)
DECL|macro|BPC4_OSPRM5
mdefine_line|#define BPC4_OSPRM5&t;(0x0002)
DECL|macro|BPC4_OSPRM4
mdefine_line|#define BPC4_OSPRM4&t;(0x0001)
multiline_comment|/*&n;&t; * BEAMCON0 -- Beam Control Register&n;&t; */
DECL|macro|BMC0_HARDDIS
mdefine_line|#define BMC0_HARDDIS&t;(0x4000) /* Disable hardware limits */
DECL|macro|BMC0_LPENDIS
mdefine_line|#define BMC0_LPENDIS&t;(0x2000) /* Disable light pen latch */
DECL|macro|BMC0_VARVBEN
mdefine_line|#define BMC0_VARVBEN&t;(0x1000) /* Enable variable vertical blank */
DECL|macro|BMC0_LOLDIS
mdefine_line|#define BMC0_LOLDIS&t;(0x0800) /* Disable long/short line toggle */
DECL|macro|BMC0_CSCBEN
mdefine_line|#define BMC0_CSCBEN&t;(0x0400) /* Composite sync/blank */
DECL|macro|BMC0_VARVSYEN
mdefine_line|#define BMC0_VARVSYEN&t;(0x0200) /* Enable variable vertical sync */
DECL|macro|BMC0_VARHSYEN
mdefine_line|#define BMC0_VARHSYEN&t;(0x0100) /* Enable variable horizontal sync */
DECL|macro|BMC0_VARBEAMEN
mdefine_line|#define BMC0_VARBEAMEN&t;(0x0080) /* Enable variable beam counters */
DECL|macro|BMC0_DUAL
mdefine_line|#define BMC0_DUAL&t;(0x0040) /* Enable alternate horizontal beam counter */
DECL|macro|BMC0_PAL
mdefine_line|#define BMC0_PAL&t;(0x0020) /* Set decodes for PAL */
DECL|macro|BMC0_VARCSYEN
mdefine_line|#define BMC0_VARCSYEN&t;(0x0010) /* Enable variable composite sync */
DECL|macro|BMC0_BLANKEN
mdefine_line|#define BMC0_BLANKEN&t;(0x0008) /* Blank enable (no longer used on AGA) */
DECL|macro|BMC0_CSYTRUE
mdefine_line|#define BMC0_CSYTRUE&t;(0x0004) /* CSY polarity */
DECL|macro|BMC0_VSYTRUE
mdefine_line|#define BMC0_VSYTRUE&t;(0x0002) /* VSY polarity */
DECL|macro|BMC0_HSYTRUE
mdefine_line|#define BMC0_HSYTRUE&t;(0x0001) /* HSY polarity */
multiline_comment|/*&n;&t; * FMODE -- Fetch Mode Control Register (AGA)&n;&t; */
DECL|macro|FMODE_SSCAN2
mdefine_line|#define FMODE_SSCAN2&t;(0x8000) /* Sprite scan-doubling */
DECL|macro|FMODE_BSCAN2
mdefine_line|#define FMODE_BSCAN2&t;(0x4000) /* Use PF2 modulus every other line */
DECL|macro|FMODE_SPAGEM
mdefine_line|#define FMODE_SPAGEM&t;(0x0008) /* Sprite page mode */
DECL|macro|FMODE_SPR32
mdefine_line|#define FMODE_SPR32&t;(0x0004) /* Sprite 32 bit fetch */
DECL|macro|FMODE_BPAGEM
mdefine_line|#define FMODE_BPAGEM&t;(0x0002) /* Bitplane page mode */
DECL|macro|FMODE_BPL32
mdefine_line|#define FMODE_BPL32&t;(0x0001) /* Bitplane 32 bit fetch */
multiline_comment|/*&n;&t; * Tags used to indicate a specific Pixel Clock&n;&t; *&n;&t; * clk_shift is the shift value to get the timings in 35 ns units&n;&t; */
DECL|enumerator|TAG_SHRES
DECL|enumerator|TAG_HIRES
DECL|enumerator|TAG_LORES
r_enum
(brace
id|TAG_SHRES
comma
id|TAG_HIRES
comma
id|TAG_LORES
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Tags used to indicate the specific chipset&n;&t; */
DECL|enumerator|TAG_OCS
DECL|enumerator|TAG_ECS
DECL|enumerator|TAG_AGA
r_enum
(brace
id|TAG_OCS
comma
id|TAG_ECS
comma
id|TAG_AGA
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Tags used to indicate the memory bandwidth&n;&t; */
DECL|enumerator|TAG_FMODE_1
DECL|enumerator|TAG_FMODE_2
DECL|enumerator|TAG_FMODE_4
r_enum
(brace
id|TAG_FMODE_1
comma
id|TAG_FMODE_2
comma
id|TAG_FMODE_4
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Clock Definitions, Maximum Display Depth&n;&t; *&n;&t; * These depend on the E-Clock or the Chipset, so they are filled in&n;&t; * dynamically&n;&t; */
DECL|variable|pixclock
r_static
id|u_long
id|pixclock
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* SHRES/HIRES/LORES: index = clk_shift */
DECL|variable|maxdepth
r_static
id|u_short
id|maxdepth
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* SHRES/HIRES/LORES: index = clk_shift */
DECL|variable|maxfmode
DECL|variable|chipset
r_static
id|u_short
id|maxfmode
comma
id|chipset
suffix:semicolon
multiline_comment|/*&n;&t; * Broadcast Video Timings&n;&t; *&n;&t; * Horizontal values are in 35 ns (SHRES) units&n;&t; * Vertical values are in interlaced scanlines&n;&t; */
DECL|macro|PAL_DIWSTRT_H
mdefine_line|#define PAL_DIWSTRT_H&t;(360)&t;/* PAL Window Limits */
DECL|macro|PAL_DIWSTRT_V
mdefine_line|#define PAL_DIWSTRT_V&t;(48)
DECL|macro|PAL_HTOTAL
mdefine_line|#define PAL_HTOTAL&t;(1816)
DECL|macro|PAL_VTOTAL
mdefine_line|#define PAL_VTOTAL&t;(625)
DECL|macro|NTSC_DIWSTRT_H
mdefine_line|#define NTSC_DIWSTRT_H&t;(360)&t;/* NTSC Window Limits */
DECL|macro|NTSC_DIWSTRT_V
mdefine_line|#define NTSC_DIWSTRT_V&t;(40)
DECL|macro|NTSC_HTOTAL
mdefine_line|#define NTSC_HTOTAL&t;(1816)
DECL|macro|NTSC_VTOTAL
mdefine_line|#define NTSC_VTOTAL&t;(525)
multiline_comment|/*&n;&t; * Various macros&n;&t; */
DECL|macro|up2
mdefine_line|#define up2(v)&t;&t;(((v)+1) &amp; -2)
DECL|macro|down2
mdefine_line|#define down2(v)&t;((v) &amp; -2)
DECL|macro|div2
mdefine_line|#define div2(v)&t;&t;((v)&gt;&gt;1)
DECL|macro|mod2
mdefine_line|#define mod2(v)&t;&t;((v) &amp; 1)
DECL|macro|up4
mdefine_line|#define up4(v)&t;&t;(((v)+3) &amp; -4)
DECL|macro|down4
mdefine_line|#define down4(v)&t;((v) &amp; -4)
DECL|macro|mul4
mdefine_line|#define mul4(v)&t;&t;((v)&lt;&lt;2)
DECL|macro|div4
mdefine_line|#define div4(v)&t;&t;((v)&gt;&gt;2)
DECL|macro|mod4
mdefine_line|#define mod4(v)&t;&t;((v) &amp; 3)
DECL|macro|up8
mdefine_line|#define up8(v)&t;&t;(((v)+7) &amp; -8)
DECL|macro|down8
mdefine_line|#define down8(v)&t;((v) &amp; -8)
DECL|macro|div8
mdefine_line|#define div8(v)&t;&t;((v)&gt;&gt;3)
DECL|macro|mod8
mdefine_line|#define mod8(v)&t;&t;((v) &amp; 7)
DECL|macro|up16
mdefine_line|#define up16(v)&t;&t;(((v)+15) &amp; -16)
DECL|macro|down16
mdefine_line|#define down16(v)&t;((v) &amp; -16)
DECL|macro|div16
mdefine_line|#define div16(v)&t;((v)&gt;&gt;4)
DECL|macro|mod16
mdefine_line|#define mod16(v)&t;((v) &amp; 15)
DECL|macro|up32
mdefine_line|#define up32(v)&t;&t;(((v)+31) &amp; -32)
DECL|macro|down32
mdefine_line|#define down32(v)&t;((v) &amp; -32)
DECL|macro|div32
mdefine_line|#define div32(v)&t;((v)&gt;&gt;5)
DECL|macro|mod32
mdefine_line|#define mod32(v)&t;((v) &amp; 31)
DECL|macro|up64
mdefine_line|#define up64(v)&t;&t;(((v)+63) &amp; -64)
DECL|macro|down64
mdefine_line|#define down64(v)&t;((v) &amp; -64)
DECL|macro|div64
mdefine_line|#define div64(v)&t;((v)&gt;&gt;6)
DECL|macro|mod64
mdefine_line|#define mod64(v)&t;((v) &amp; 63)
DECL|macro|upx
mdefine_line|#define upx(x,v)&t;(((v)+(x)-1) &amp; -(x))
DECL|macro|downx
mdefine_line|#define downx(x,v)&t;((v) &amp; -(x))
DECL|macro|modx
mdefine_line|#define modx(x,v)&t;((v) &amp; ((x)-1))
multiline_comment|/* if x1 is not a constant, this macro won&squot;t make real sense :-) */
macro_line|#ifdef __mc68000__
DECL|macro|DIVUL
mdefine_line|#define DIVUL(x1, x2) ({int res; asm(&quot;divul %1,%2,%3&quot;: &quot;=d&quot; (res): &bslash;&n;&t;&quot;d&quot; (x2), &quot;d&quot; ((long)((x1)/0x100000000ULL)), &quot;0&quot; ((long)(x1))); res;})
macro_line|#else
multiline_comment|/* We know a bit about the numbers, so we can do it this way */
DECL|macro|DIVUL
mdefine_line|#define DIVUL(x1, x2) ((((long)((unsigned long long)x1 &gt;&gt; 8) / x2) &lt;&lt; 8) + &bslash;&n;&t;((((long)((unsigned long long)x1 &gt;&gt; 8) % x2) &lt;&lt; 8) / x2))
macro_line|#endif
DECL|macro|min
mdefine_line|#define min(a, b)&t;((a) &lt; (b) ? (a) : (b))
DECL|macro|max
mdefine_line|#define max(a, b)&t;((a) &gt; (b) ? (a) : (b))
DECL|macro|highw
mdefine_line|#define highw(x)&t;((u_long)(x)&gt;&gt;16 &amp; 0xffff)
DECL|macro|loww
mdefine_line|#define loww(x)&t;&t;((u_long)(x) &amp; 0xffff)
DECL|macro|VBlankOn
mdefine_line|#define VBlankOn()&t;custom.intena = IF_SETCLR|IF_COPER
DECL|macro|VBlankOff
mdefine_line|#define VBlankOff()&t;custom.intena = IF_COPER
multiline_comment|/*&n;&t; * Chip RAM we reserve for the Frame Buffer&n;&t; *&n;&t; * This defines the Maximum Virtual Screen Size&n;&t; * (Setable per kernel options?)&n;&t; */
DECL|macro|VIDEOMEMSIZE_AGA_2M
mdefine_line|#define VIDEOMEMSIZE_AGA_2M&t;(1310720) /* AGA (2MB) : max 1280*1024*256  */
DECL|macro|VIDEOMEMSIZE_AGA_1M
mdefine_line|#define VIDEOMEMSIZE_AGA_1M&t;(786432)  /* AGA (1MB) : max 1024*768*256   */
DECL|macro|VIDEOMEMSIZE_ECS_2M
mdefine_line|#define VIDEOMEMSIZE_ECS_2M&t;(655360)  /* ECS (2MB) : max 1280*1024*16   */
DECL|macro|VIDEOMEMSIZE_ECS_1M
mdefine_line|#define VIDEOMEMSIZE_ECS_1M&t;(393216)  /* ECS (1MB) : max 1024*768*16    */
DECL|macro|VIDEOMEMSIZE_OCS
mdefine_line|#define VIDEOMEMSIZE_OCS&t;(262144)  /* OCS       : max ca. 800*600*16 */
DECL|macro|SPRITEMEMSIZE
mdefine_line|#define SPRITEMEMSIZE&t;&t;(64*64/4) /* max 64*64*4 */
DECL|macro|DUMMYSPRITEMEMSIZE
mdefine_line|#define DUMMYSPRITEMEMSIZE&t;(8)
DECL|macro|CHIPRAM_SAFETY_LIMIT
mdefine_line|#define CHIPRAM_SAFETY_LIMIT&t;(16384)
DECL|variable|videomemory
DECL|variable|spritememory
r_static
id|u_long
id|videomemory
comma
id|spritememory
suffix:semicolon
DECL|variable|videomemorysize
r_static
id|u_long
id|videomemorysize
suffix:semicolon
DECL|variable|videomemory_phys
r_static
id|u_long
id|videomemory_phys
suffix:semicolon
multiline_comment|/*&n;&t; * This is the earliest allowed start of fetching display data.&n;&t; * Only if you really want no hardware cursor and audio,&n;&t; * set this to 128, but let it better at 192&n;&t; */
DECL|variable|min_fstrt
r_static
id|u_long
id|min_fstrt
op_assign
l_int|192
suffix:semicolon
DECL|macro|assignchunk
mdefine_line|#define assignchunk(name, type, ptr, size) &bslash;&n;{ &bslash;&n;&t;(name) = (type)(ptr); &bslash;&n;&t;ptr += size; &bslash;&n;}
multiline_comment|/*&n;&t; * Copper Instructions&n;&t; */
DECL|macro|CMOVE
mdefine_line|#define CMOVE(val, reg)&t;&t;(CUSTOM_OFS(reg)&lt;&lt;16 | (val))
DECL|macro|CMOVE2
mdefine_line|#define CMOVE2(val, reg)&t;((CUSTOM_OFS(reg)+2)&lt;&lt;16 | (val))
DECL|macro|CWAIT
mdefine_line|#define CWAIT(x, y)&t;&t;(((y) &amp; 0x1fe)&lt;&lt;23 | ((x) &amp; 0x7f0)&lt;&lt;13 | 0x0001fffe)
DECL|macro|CEND
mdefine_line|#define CEND&t;&t;&t;(0xfffffffe)
r_typedef
r_union
(brace
DECL|member|l
id|u_long
id|l
suffix:semicolon
DECL|member|w
id|u_short
id|w
(braket
l_int|2
)braket
suffix:semicolon
DECL|typedef|copins
)brace
id|copins
suffix:semicolon
DECL|struct|copdisplay
r_static
r_struct
id|copdisplay
(brace
DECL|member|init
id|copins
op_star
id|init
suffix:semicolon
DECL|member|wait
id|copins
op_star
id|wait
suffix:semicolon
DECL|member|list
id|copins
op_star
id|list
(braket
l_int|2
)braket
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|rebuild
id|copins
op_star
id|rebuild
(braket
l_int|2
)braket
suffix:semicolon
DECL|variable|copdisplay
)brace
id|copdisplay
suffix:semicolon
DECL|variable|currentcop
r_static
id|u_short
id|currentcop
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Hardware Cursor&n;&t; */
DECL|variable|cursorrate
r_static
r_int
id|cursorrate
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* Number of frames/flash toggle */
DECL|variable|cursorstate
r_static
id|u_short
id|cursorstate
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cursormode
r_static
id|u_short
id|cursormode
op_assign
id|FB_CURSOR_OFF
suffix:semicolon
DECL|variable|lofsprite
DECL|variable|shfsprite
DECL|variable|dummysprite
r_static
id|u_short
op_star
id|lofsprite
comma
op_star
id|shfsprite
comma
op_star
id|dummysprite
suffix:semicolon
multiline_comment|/*&n;&t; * Current Video Mode&n;&t; */
DECL|struct|amifb_par
r_static
r_struct
id|amifb_par
(brace
multiline_comment|/* General Values */
DECL|member|xres
r_int
id|xres
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|yres
r_int
id|yres
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vxres
r_int
id|vxres
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vyres
r_int
id|vyres
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|xoffset
r_int
id|xoffset
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|yoffset
r_int
id|yoffset
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|bpp
id|u_short
id|bpp
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|clk_shift
id|u_short
id|clk_shift
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|line_shift
id|u_short
id|line_shift
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vmode
r_int
id|vmode
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|diwstrt_h
id|u_short
id|diwstrt_h
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|diwstop_h
id|u_short
id|diwstop_h
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|diwstrt_v
id|u_short
id|diwstrt_v
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|diwstop_v
id|u_short
id|diwstop_v
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|next_line
id|u_long
id|next_line
suffix:semicolon
multiline_comment|/* modulo for next line */
DECL|member|next_plane
id|u_long
id|next_plane
suffix:semicolon
multiline_comment|/* modulo for next plane */
multiline_comment|/* Cursor Values */
r_struct
(brace
DECL|member|crsr_x
r_int
id|crsr_x
suffix:semicolon
multiline_comment|/* movecursor */
DECL|member|crsr_y
r_int
id|crsr_y
suffix:semicolon
multiline_comment|/* movecursor */
DECL|member|spot_x
r_int
id|spot_x
suffix:semicolon
DECL|member|spot_y
r_int
id|spot_y
suffix:semicolon
DECL|member|height
id|u_short
id|height
suffix:semicolon
DECL|member|width
id|u_short
id|width
suffix:semicolon
DECL|member|fmode
id|u_short
id|fmode
suffix:semicolon
DECL|member|crsr
)brace
id|crsr
suffix:semicolon
multiline_comment|/* OCS Hardware Registers */
DECL|member|bplpt0
id|u_long
id|bplpt0
suffix:semicolon
multiline_comment|/* vmode, pan (Note: physical address) */
DECL|member|bplpt0wrap
id|u_long
id|bplpt0wrap
suffix:semicolon
multiline_comment|/* vmode, pan (Note: physical address) */
DECL|member|ddfstrt
id|u_short
id|ddfstrt
suffix:semicolon
DECL|member|ddfstop
id|u_short
id|ddfstop
suffix:semicolon
DECL|member|bpl1mod
id|u_short
id|bpl1mod
suffix:semicolon
DECL|member|bpl2mod
id|u_short
id|bpl2mod
suffix:semicolon
DECL|member|bplcon0
id|u_short
id|bplcon0
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|bplcon1
id|u_short
id|bplcon1
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|htotal
id|u_short
id|htotal
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vtotal
id|u_short
id|vtotal
suffix:semicolon
multiline_comment|/* vmode */
multiline_comment|/* Additional ECS Hardware Registers */
DECL|member|bplcon3
id|u_short
id|bplcon3
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|beamcon0
id|u_short
id|beamcon0
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|hsstrt
id|u_short
id|hsstrt
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|hsstop
id|u_short
id|hsstop
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|hbstrt
id|u_short
id|hbstrt
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|hbstop
id|u_short
id|hbstop
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vsstrt
id|u_short
id|vsstrt
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vsstop
id|u_short
id|vsstop
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vbstrt
id|u_short
id|vbstrt
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|vbstop
id|u_short
id|vbstop
suffix:semicolon
multiline_comment|/* vmode */
DECL|member|hcenter
id|u_short
id|hcenter
suffix:semicolon
multiline_comment|/* vmode */
multiline_comment|/* Additional AGA Hardware Registers */
DECL|member|fmode
id|u_short
id|fmode
suffix:semicolon
multiline_comment|/* vmode */
DECL|variable|currentpar
)brace
id|currentpar
suffix:semicolon
DECL|variable|currcon
r_static
r_int
id|currcon
op_assign
l_int|0
suffix:semicolon
DECL|variable|disp
r_static
r_struct
id|display
id|disp
suffix:semicolon
DECL|variable|fb_info
r_static
r_struct
id|fb_info
id|fb_info
suffix:semicolon
multiline_comment|/*&n;&t; * Since we can&squot;t read the palette on OCS/ECS, and since reading one&n;&t; * single color palette entry requires 5 expensive custom chip bus accesses&n;&t; * on AGA, we keep a copy of the current palette.&n;&t; * Note that the entries are always 24 bit!&n;&t; */
macro_line|#if defined(CONFIG_FB_AMIGA_AGA)
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
DECL|variable|palette
r_static
r_struct
(brace
id|u_char
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
macro_line|#else
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
DECL|variable|palette
r_static
r_struct
(brace
id|u_char
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
id|palette
(braket
l_int|32
)braket
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_FB_AMIGA_ECS)
DECL|variable|ecs_palette
r_static
id|u_short
id|ecs_palette
(braket
l_int|32
)braket
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Latches for Display Changes during VBlank&n;&t; */
DECL|variable|do_vmode_full
r_static
id|u_short
id|do_vmode_full
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Change the Video Mode */
DECL|variable|do_vmode_pan
r_static
id|u_short
id|do_vmode_pan
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Update the Video Mode */
DECL|variable|do_blank
r_static
r_int
id|do_blank
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* (Un)Blank the Screen (&#xfffd;1) */
DECL|variable|do_cursor
r_static
id|u_short
id|do_cursor
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Move the Cursor */
multiline_comment|/*&n;&t; * Various Flags&n;&t; */
DECL|variable|is_blanked
r_static
id|u_short
id|is_blanked
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Screen is Blanked */
DECL|variable|is_lace
r_static
id|u_short
id|is_lace
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Screen is laced */
multiline_comment|/*&n;&t; * Frame Buffer Name&n;&t; *&n;&t; * The rest of the name is filled in during initialization&n;&t; */
DECL|variable|amifb_name
r_static
r_char
id|amifb_name
(braket
l_int|16
)braket
op_assign
l_string|&quot;Amiga &quot;
suffix:semicolon
multiline_comment|/*&n;&t; * Predefined Video Modes&n;&t; *&n;&t; */
DECL|variable|__initdata
r_static
r_struct
id|fb_videomode
id|ami_modedb
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/*&n;     *  AmigaOS Video Modes&n;     *&n;     *  If you change these, make sure to update DEFMODE_* as well!&n;     */
(brace
multiline_comment|/* 640x200, 15 kHz, 60 Hz (NTSC) */
l_string|&quot;ntsc&quot;
comma
l_int|60
comma
l_int|640
comma
l_int|200
comma
id|TAG_HIRES
comma
l_int|106
comma
l_int|86
comma
l_int|44
comma
l_int|16
comma
l_int|76
comma
l_int|2
comma
id|FB_SYNC_BROADCAST
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x400, 15 kHz, 60 Hz interlaced (NTSC) */
l_string|&quot;ntsc-lace&quot;
comma
l_int|60
comma
l_int|640
comma
id|TAG_HIRES
comma
l_int|106
comma
l_int|86
comma
l_int|88
comma
l_int|33
comma
l_int|76
comma
l_int|4
comma
id|FB_SYNC_BROADCAST
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x256, 15 kHz, 50 Hz (PAL) */
l_string|&quot;pal&quot;
comma
l_int|50
comma
l_int|640
comma
l_int|256
comma
id|TAG_HIRES
comma
l_int|106
comma
l_int|86
comma
l_int|40
comma
l_int|14
comma
l_int|76
comma
l_int|2
comma
id|FB_SYNC_BROADCAST
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x512, 15 kHz, 50 Hz interlaced (PAL) */
l_string|&quot;pal-lace&quot;
comma
l_int|50
comma
l_int|640
comma
l_int|512
comma
id|TAG_HIRES
comma
l_int|106
comma
l_int|86
comma
l_int|80
comma
l_int|29
comma
l_int|76
comma
l_int|4
comma
id|FB_SYNC_BROADCAST
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x480, 29 kHz, 57 Hz */
l_string|&quot;multiscan&quot;
comma
l_int|57
comma
l_int|640
comma
l_int|480
comma
id|TAG_SHRES
comma
l_int|96
comma
l_int|112
comma
l_int|29
comma
l_int|8
comma
l_int|72
comma
l_int|8
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x960, 29 kHz, 57 Hz interlaced */
l_string|&quot;multiscan-lace&quot;
comma
l_int|57
comma
l_int|640
comma
l_int|960
comma
id|TAG_SHRES
comma
l_int|96
comma
l_int|112
comma
l_int|58
comma
l_int|16
comma
l_int|72
comma
l_int|16
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x200, 15 kHz, 72 Hz */
l_string|&quot;euro36&quot;
comma
l_int|72
comma
l_int|640
comma
l_int|200
comma
id|TAG_HIRES
comma
l_int|92
comma
l_int|124
comma
l_int|6
comma
l_int|6
comma
l_int|52
comma
l_int|5
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x400, 15 kHz, 72 Hz interlaced */
l_string|&quot;euro36-lace&quot;
comma
l_int|72
comma
l_int|640
comma
l_int|400
comma
id|TAG_HIRES
comma
l_int|92
comma
l_int|124
comma
l_int|12
comma
l_int|12
comma
l_int|52
comma
l_int|10
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x400, 29 kHz, 68 Hz */
l_string|&quot;euro72&quot;
comma
l_int|68
comma
l_int|640
comma
l_int|400
comma
id|TAG_SHRES
comma
l_int|164
comma
l_int|92
comma
l_int|9
comma
l_int|9
comma
l_int|80
comma
l_int|8
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x800, 29 kHz, 68 Hz interlaced */
l_string|&quot;euro72-lace&quot;
comma
l_int|68
comma
l_int|640
comma
l_int|800
comma
id|TAG_SHRES
comma
l_int|164
comma
l_int|92
comma
l_int|18
comma
l_int|18
comma
l_int|80
comma
l_int|16
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 800x300, 23 kHz, 70 Hz */
l_string|&quot;super72&quot;
comma
l_int|70
comma
l_int|800
comma
l_int|300
comma
id|TAG_SHRES
comma
l_int|212
comma
l_int|140
comma
l_int|10
comma
l_int|11
comma
l_int|80
comma
l_int|7
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 800x600, 23 kHz, 70 Hz interlaced */
l_string|&quot;super72-lace&quot;
comma
l_int|70
comma
l_int|800
comma
l_int|600
comma
id|TAG_SHRES
comma
l_int|212
comma
l_int|140
comma
l_int|20
comma
l_int|22
comma
l_int|80
comma
l_int|14
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x200, 27 kHz, 57 Hz doublescan */
l_string|&quot;dblntsc&quot;
comma
l_int|57
comma
l_int|640
comma
l_int|200
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|18
comma
l_int|17
comma
l_int|80
comma
l_int|4
comma
l_int|0
comma
id|FB_VMODE_DOUBLE
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x400, 27 kHz, 57 Hz */
l_string|&quot;dblntsc-ff&quot;
comma
l_int|57
comma
l_int|640
comma
l_int|400
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|36
comma
l_int|35
comma
l_int|80
comma
l_int|7
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x800, 27 kHz, 57 Hz interlaced */
l_string|&quot;dblntsc-lace&quot;
comma
l_int|57
comma
l_int|640
comma
l_int|800
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|72
comma
l_int|70
comma
l_int|80
comma
l_int|14
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x256, 27 kHz, 47 Hz doublescan */
l_string|&quot;dblpal&quot;
comma
l_int|47
comma
l_int|640
comma
l_int|256
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|14
comma
l_int|13
comma
l_int|80
comma
l_int|4
comma
l_int|0
comma
id|FB_VMODE_DOUBLE
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x512, 27 kHz, 47 Hz */
l_string|&quot;dblpal-ff&quot;
comma
l_int|47
comma
l_int|640
comma
l_int|512
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|28
comma
l_int|27
comma
l_int|80
comma
l_int|7
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x1024, 27 kHz, 47 Hz interlaced */
l_string|&quot;dblpal-lace&quot;
comma
l_int|47
comma
l_int|640
comma
l_int|1024
comma
id|TAG_SHRES
comma
l_int|196
comma
l_int|124
comma
l_int|56
comma
l_int|54
comma
l_int|80
comma
l_int|14
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
multiline_comment|/*&n;     *  VGA Video Modes&n;     */
(brace
multiline_comment|/* 640x480, 31 kHz, 60 Hz (VGA) */
l_string|&quot;vga&quot;
comma
l_int|60
comma
l_int|640
comma
l_int|480
comma
id|TAG_SHRES
comma
l_int|64
comma
l_int|96
comma
l_int|30
comma
l_int|9
comma
l_int|112
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 640x400, 31 kHz, 70 Hz (VGA) */
l_string|&quot;vga70&quot;
comma
l_int|70
comma
l_int|640
comma
l_int|400
comma
id|TAG_SHRES
comma
l_int|64
comma
l_int|96
comma
l_int|35
comma
l_int|12
comma
l_int|112
comma
l_int|2
comma
id|FB_SYNC_VERT_HIGH_ACT
op_or
id|FB_SYNC_COMP_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
macro_line|#if 0
multiline_comment|/*&n;     *  A2024 video modes&n;     *  These modes don&squot;t work yet because there&squot;s no A2024 driver.&n;     */
(brace
multiline_comment|/* 1024x800, 10 Hz */
l_string|&quot;a2024-10&quot;
comma
l_int|10
comma
l_int|1024
comma
l_int|800
comma
id|TAG_HIRES
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
comma
(brace
multiline_comment|/* 1024x800, 15 Hz */
l_string|&quot;a2024-15&quot;
comma
l_int|10
comma
l_int|1024
comma
l_int|800
comma
id|TAG_HIRES
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
op_or
id|FB_VMODE_YWRAP
)brace
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|NUM_TOTAL_MODES
mdefine_line|#define NUM_TOTAL_MODES  ARRAY_SIZE(ami_modedb)
DECL|variable|__initdata
r_static
r_const
r_char
op_star
id|mode_option
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|round_down_bpp
r_static
r_int
id|round_down_bpp
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* for mode probing */
multiline_comment|/*&n;&t; * Some default modes&n;&t; */
DECL|macro|DEFMODE_PAL
mdefine_line|#define DEFMODE_PAL&t;    2&t;/* &quot;pal&quot; for PAL OCS/ECS */
DECL|macro|DEFMODE_NTSC
mdefine_line|#define DEFMODE_NTSC&t;    0&t;/* &quot;ntsc&quot; for NTSC OCS/ECS */
DECL|macro|DEFMODE_AMBER_PAL
mdefine_line|#define DEFMODE_AMBER_PAL   3&t;/* &quot;pal-lace&quot; for flicker fixed PAL (A3000) */
DECL|macro|DEFMODE_AMBER_NTSC
mdefine_line|#define DEFMODE_AMBER_NTSC  1&t;/* &quot;ntsc-lace&quot; for flicker fixed NTSC (A3000) */
DECL|macro|DEFMODE_AGA
mdefine_line|#define DEFMODE_AGA&t;    19&t;/* &quot;vga70&quot; for AGA */
DECL|variable|amifb_ilbm
r_static
r_int
id|amifb_ilbm
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* interleaved or normal bitplanes */
DECL|variable|amifb_inverse
r_static
r_int
id|amifb_inverse
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Macros for the conversion from real world values to hardware register&n;&t; * values&n;&t; *&n;&t; * This helps us to keep our attention on the real stuff...&n;&t; *&n;&t; * Hardware limits for AGA:&n;&t; *&n;&t; *&t;parameter  min    max  step&n;&t; *&t;---------  ---   ----  ----&n;&t; *&t;diwstrt_h    0   2047     1&n;&t; *&t;diwstrt_v    0   2047     1&n;&t; *&t;diwstop_h    0   4095     1&n;&t; *&t;diwstop_v    0   4095     1&n;&t; *&n;&t; *&t;ddfstrt      0   2032    16&n;&t; *&t;ddfstop      0   2032    16&n;&t; *&n;&t; *&t;htotal       8   2048     8&n;&t; *&t;hsstrt       0   2040     8&n;&t; *&t;hsstop       0   2040     8&n;&t; *&t;vtotal       1   4096     1&n;&t; *&t;vsstrt       0   4095     1&n;&t; *&t;vsstop       0   4095     1&n;&t; *&t;hcenter      0   2040     8&n;&t; *&n;&t; *&t;hbstrt       0   2047     1&n;&t; *&t;hbstop       0   2047     1&n;&t; *&t;vbstrt       0   4095     1&n;&t; *&t;vbstop       0   4095     1&n;&t; *&n;&t; * Horizontal values are in 35 ns (SHRES) pixels&n;&t; * Vertical values are in half scanlines&n;&t; */
multiline_comment|/* bplcon1 (smooth scrolling) */
DECL|macro|hscroll2hw
mdefine_line|#define hscroll2hw(hscroll) &bslash;&n;&t;(((hscroll)&lt;&lt;12 &amp; 0x3000) | ((hscroll)&lt;&lt;8 &amp; 0xc300) | &bslash;&n;&t; ((hscroll)&lt;&lt;4 &amp; 0x0c00) | ((hscroll)&lt;&lt;2 &amp; 0x00f0) | ((hscroll)&gt;&gt;2 &amp; 0x000f))
multiline_comment|/* diwstrt/diwstop/diwhigh (visible display window) */
DECL|macro|diwstrt2hw
mdefine_line|#define diwstrt2hw(diwstrt_h, diwstrt_v) &bslash;&n;&t;(((diwstrt_v)&lt;&lt;7 &amp; 0xff00) | ((diwstrt_h)&gt;&gt;2 &amp; 0x00ff))
DECL|macro|diwstop2hw
mdefine_line|#define diwstop2hw(diwstop_h, diwstop_v) &bslash;&n;&t;(((diwstop_v)&lt;&lt;7 &amp; 0xff00) | ((diwstop_h)&gt;&gt;2 &amp; 0x00ff))
DECL|macro|diwhigh2hw
mdefine_line|#define diwhigh2hw(diwstrt_h, diwstrt_v, diwstop_h, diwstop_v) &bslash;&n;&t;(((diwstop_h)&lt;&lt;3 &amp; 0x2000) | ((diwstop_h)&lt;&lt;11 &amp; 0x1800) | &bslash;&n;&t; ((diwstop_v)&gt;&gt;1 &amp; 0x0700) | ((diwstrt_h)&gt;&gt;5 &amp; 0x0020) | &bslash;&n;&t; ((diwstrt_h)&lt;&lt;3 &amp; 0x0018) | ((diwstrt_v)&gt;&gt;9 &amp; 0x0007))
multiline_comment|/* ddfstrt/ddfstop (display DMA) */
DECL|macro|ddfstrt2hw
mdefine_line|#define ddfstrt2hw(ddfstrt)&t;div8(ddfstrt)
DECL|macro|ddfstop2hw
mdefine_line|#define ddfstop2hw(ddfstop)&t;div8(ddfstop)
multiline_comment|/* hsstrt/hsstop/htotal/vsstrt/vsstop/vtotal/hcenter (sync timings) */
DECL|macro|hsstrt2hw
mdefine_line|#define hsstrt2hw(hsstrt)&t;(div8(hsstrt))
DECL|macro|hsstop2hw
mdefine_line|#define hsstop2hw(hsstop)&t;(div8(hsstop))
DECL|macro|htotal2hw
mdefine_line|#define htotal2hw(htotal)&t;(div8(htotal)-1)
DECL|macro|vsstrt2hw
mdefine_line|#define vsstrt2hw(vsstrt)&t;(div2(vsstrt))
DECL|macro|vsstop2hw
mdefine_line|#define vsstop2hw(vsstop)&t;(div2(vsstop))
DECL|macro|vtotal2hw
mdefine_line|#define vtotal2hw(vtotal)&t;(div2(vtotal)-1)
DECL|macro|hcenter2hw
mdefine_line|#define hcenter2hw(htotal)&t;(div8(htotal))
multiline_comment|/* hbstrt/hbstop/vbstrt/vbstop (blanking timings) */
DECL|macro|hbstrt2hw
mdefine_line|#define hbstrt2hw(hbstrt)&t;(((hbstrt)&lt;&lt;8 &amp; 0x0700) | ((hbstrt)&gt;&gt;3 &amp; 0x00ff))
DECL|macro|hbstop2hw
mdefine_line|#define hbstop2hw(hbstop)&t;(((hbstop)&lt;&lt;8 &amp; 0x0700) | ((hbstop)&gt;&gt;3 &amp; 0x00ff))
DECL|macro|vbstrt2hw
mdefine_line|#define vbstrt2hw(vbstrt)&t;(div2(vbstrt))
DECL|macro|vbstop2hw
mdefine_line|#define vbstop2hw(vbstop)&t;(div2(vbstop))
multiline_comment|/* colour */
DECL|macro|rgb2hw8_high
mdefine_line|#define rgb2hw8_high(red, green, blue) &bslash;&n;&t;(((red &amp; 0xf0)&lt;&lt;4) | (green &amp; 0xf0) | ((blue &amp; 0xf0)&gt;&gt;4))
DECL|macro|rgb2hw8_low
mdefine_line|#define rgb2hw8_low(red, green, blue) &bslash;&n;&t;(((red &amp; 0x0f)&lt;&lt;8) | ((green &amp; 0x0f)&lt;&lt;4) | (blue &amp; 0x0f))
DECL|macro|rgb2hw4
mdefine_line|#define rgb2hw4(red, green, blue) &bslash;&n;&t;(((red &amp; 0xf0)&lt;&lt;4) | (green &amp; 0xf0) | ((blue &amp; 0xf0)&gt;&gt;4))
DECL|macro|rgb2hw2
mdefine_line|#define rgb2hw2(red, green, blue) &bslash;&n;&t;(((red &amp; 0xc0)&lt;&lt;4) | (green &amp; 0xc0) | ((blue &amp; 0xc0)&gt;&gt;4))
multiline_comment|/* sprpos/sprctl (sprite positioning) */
DECL|macro|spr2hw_pos
mdefine_line|#define spr2hw_pos(start_v, start_h) &bslash;&n;&t;(((start_v)&lt;&lt;7&amp;0xff00) | ((start_h)&gt;&gt;3&amp;0x00ff))
DECL|macro|spr2hw_ctl
mdefine_line|#define spr2hw_ctl(start_v, start_h, stop_v) &bslash;&n;&t;(((stop_v)&lt;&lt;7&amp;0xff00) | ((start_v)&gt;&gt;4&amp;0x0040) | ((stop_v)&gt;&gt;5&amp;0x0020) | &bslash;&n;&t; ((start_h)&lt;&lt;3&amp;0x0018) | ((start_v)&gt;&gt;7&amp;0x0004) | ((stop_v)&gt;&gt;8&amp;0x0002) | &bslash;&n;&t; ((start_h)&gt;&gt;2&amp;0x0001))
multiline_comment|/* get current vertical position of beam */
DECL|macro|get_vbpos
mdefine_line|#define get_vbpos()&t;((u_short)((*(u_long volatile *)&amp;custom.vposr &gt;&gt; 7) &amp; 0xffe))
multiline_comment|/*&n;&t; * Copper Initialisation List&n;&t; */
DECL|macro|COPINITSIZE
mdefine_line|#define COPINITSIZE (sizeof(copins)*40)
r_enum
(brace
DECL|enumerator|cip_bplcon0
id|cip_bplcon0
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Long Frame/Short Frame Copper List&n;&t; * Don&squot;t change the order, build_copper()/rebuild_copper() rely on this&n;&t; */
DECL|macro|COPLISTSIZE
mdefine_line|#define COPLISTSIZE (sizeof(copins)*64)
r_enum
(brace
DECL|enumerator|cop_wait
DECL|enumerator|cop_bplcon0
id|cop_wait
comma
id|cop_bplcon0
comma
DECL|enumerator|cop_spr0ptrh
DECL|enumerator|cop_spr0ptrl
id|cop_spr0ptrh
comma
id|cop_spr0ptrl
comma
DECL|enumerator|cop_diwstrt
DECL|enumerator|cop_diwstop
id|cop_diwstrt
comma
id|cop_diwstop
comma
DECL|enumerator|cop_diwhigh
id|cop_diwhigh
comma
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Pixel modes for Bitplanes and Sprites&n;&t; */
DECL|variable|bplpixmode
r_static
id|u_short
id|bplpixmode
(braket
l_int|3
)braket
op_assign
(brace
id|BPC0_SHRES
comma
multiline_comment|/*  35 ns */
id|BPC0_HIRES
comma
multiline_comment|/*  70 ns */
l_int|0
multiline_comment|/* 140 ns */
)brace
suffix:semicolon
DECL|variable|sprpixmode
r_static
id|u_short
id|sprpixmode
(braket
l_int|3
)braket
op_assign
(brace
id|BPC3_SPRES1
op_or
id|BPC3_SPRES0
comma
multiline_comment|/*  35 ns */
id|BPC3_SPRES1
comma
multiline_comment|/*  70 ns */
id|BPC3_SPRES0
multiline_comment|/* 140 ns */
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Fetch modes for Bitplanes and Sprites&n;&t; */
DECL|variable|bplfetchmode
r_static
id|u_short
id|bplfetchmode
(braket
l_int|3
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* 1x */
id|FMODE_BPL32
comma
multiline_comment|/* 2x */
id|FMODE_BPAGEM
op_or
id|FMODE_BPL32
multiline_comment|/* 4x */
)brace
suffix:semicolon
DECL|variable|sprfetchmode
r_static
id|u_short
id|sprfetchmode
(braket
l_int|3
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* 1x */
id|FMODE_SPR32
comma
multiline_comment|/* 2x */
id|FMODE_SPAGEM
op_or
id|FMODE_SPR32
multiline_comment|/* 4x */
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Interface used by the world&n;&t; */
r_int
id|amifb_setup
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_fix_cursorinfo
c_func
(paren
r_struct
id|fb_fix_cursorinfo
op_star
id|fix
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|amifb_set_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|amifb_get_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|amifb_set_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Interface to the low level console driver&n;&t; */
r_int
id|amifb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|amifb_deinit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|amifbcon_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|amifbcon_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|amifbcon_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Internal routines&n;&t; */
r_static
r_void
id|do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|flash_cursor
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|amifb_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
r_static
id|u_long
id|chipalloc
c_func
(paren
id|u_long
id|size
)paren
suffix:semicolon
r_static
r_void
id|chipfree
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_char
op_star
id|strtoke
c_func
(paren
r_char
op_star
id|s
comma
r_const
r_char
op_star
id|ct
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Hardware routines&n;&t; */
r_static
r_int
id|ami_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|amifb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|ami_decode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|amifb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|ami_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|amifb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_void
id|ami_get_par
c_func
(paren
r_struct
id|amifb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_void
id|ami_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_static
r_void
id|ami_set_par
c_func
(paren
r_struct
id|amifb_par
op_star
id|par
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|ami_pan_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
r_static
r_int
id|ami_update_par
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|ami_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|ami_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|ami_update_display
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_init_display
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_do_blank
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|ami_get_fix_cursorinfo
c_func
(paren
r_struct
id|fb_fix_cursorinfo
op_star
id|fix
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|ami_get_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|ami_set_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|ami_get_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|ami_set_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
suffix:semicolon
r_static
r_void
id|ami_set_sprite
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_init_copper
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_reinit_copper
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_build_copper
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_rebuild_copper
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|amifb_ops
r_static
r_struct
id|fb_ops
id|amifb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|amifb_get_fix
comma
id|fb_get_var
suffix:colon
id|amifb_get_var
comma
id|fb_set_var
suffix:colon
id|amifb_set_var
comma
id|fb_get_cmap
suffix:colon
id|amifb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|amifb_set_cmap
comma
id|fb_pan_display
suffix:colon
id|amifb_pan_display
comma
id|fb_ioctl
suffix:colon
id|amifb_ioctl
comma
)brace
suffix:semicolon
DECL|function|amifb_setup
r_int
id|__init
id|amifb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_char
id|mcap_spec
(braket
l_int|80
)braket
suffix:semicolon
id|mcap_spec
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|fb_info.fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|this_opt
op_assign
id|strtok
c_func
(paren
id|options
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|this_opt
suffix:semicolon
id|this_opt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|amifb_inverse
op_assign
l_int|1
suffix:semicolon
id|fb_invert_cmaps
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;off&quot;
)paren
)paren
(brace
id|amifb_video_off
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;ilbm&quot;
)paren
)paren
id|amifb_ilbm
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;monitorcap:&quot;
comma
l_int|11
)paren
)paren
id|strcpy
c_func
(paren
id|mcap_spec
comma
id|this_opt
op_plus
l_int|11
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
id|strcpy
c_func
(paren
id|fb_info.fontname
comma
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;fstart:&quot;
comma
l_int|7
)paren
)paren
id|min_fstrt
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|min_fstrt
OL
l_int|48
)paren
id|min_fstrt
op_assign
l_int|48
suffix:semicolon
r_if
c_cond
(paren
op_star
id|mcap_spec
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|vmin
comma
id|vmax
comma
id|hmin
comma
id|hmax
suffix:semicolon
multiline_comment|/* Format for monitor capabilities is: &lt;Vmin&gt;;&lt;Vmax&gt;;&lt;Hmin&gt;;&lt;Hmax&gt;&n;&t; * &lt;V*&gt; vertical freq. in Hz&n;&t; * &lt;H*&gt; horizontal freq. in kHz&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strtoke
c_func
(paren
id|mcap_spec
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|cap_invalid
suffix:semicolon
id|vmin
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vmin
op_le
l_int|0
)paren
r_goto
id|cap_invalid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strtoke
c_func
(paren
l_int|NULL
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|cap_invalid
suffix:semicolon
id|vmax
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vmax
op_le
l_int|0
op_logical_or
id|vmax
op_le
id|vmin
)paren
r_goto
id|cap_invalid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strtoke
c_func
(paren
l_int|NULL
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|cap_invalid
suffix:semicolon
id|hmin
op_assign
l_int|1000
op_star
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hmin
op_le
l_int|0
)paren
r_goto
id|cap_invalid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strtoke
c_func
(paren
l_int|NULL
comma
l_string|&quot;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|cap_invalid
suffix:semicolon
id|hmax
op_assign
l_int|1000
op_star
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hmax
op_le
l_int|0
op_logical_or
id|hmax
op_le
id|hmin
)paren
r_goto
id|cap_invalid
suffix:semicolon
id|fb_info.monspecs.vfmin
op_assign
id|vmin
suffix:semicolon
id|fb_info.monspecs.vfmax
op_assign
id|vmax
suffix:semicolon
id|fb_info.monspecs.hfmin
op_assign
id|hmin
suffix:semicolon
id|fb_info.monspecs.hfmax
op_assign
id|hmax
suffix:semicolon
id|cap_invalid
suffix:colon
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get the Fixed Part of the Display&n;&t; */
DECL|function|amifb_get_fix
r_static
r_int
id|amifb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|amifb_par
id|par
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|ami_get_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
r_else
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ami_decode_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|par
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
id|ami_encode_fix
c_func
(paren
id|fix
comma
op_amp
id|par
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get the User Defined Part of the Display&n;&t; */
DECL|function|amifb_get_var
r_static
r_int
id|amifb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
r_struct
id|amifb_par
id|par
suffix:semicolon
id|ami_get_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
id|err
op_assign
id|ami_encode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
suffix:semicolon
)brace
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Set the User Defined Part of the Display&n;&t; */
DECL|function|amifb_set_var
r_static
r_int
id|amifb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
comma
id|activate
op_assign
id|var-&gt;activate
suffix:semicolon
r_int
id|oldxres
comma
id|oldyres
comma
id|oldvxres
comma
id|oldvyres
comma
id|oldbpp
suffix:semicolon
r_struct
id|amifb_par
id|par
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_else
id|display
op_assign
op_amp
id|disp
suffix:semicolon
multiline_comment|/* used during initialization */
multiline_comment|/*&n;&t; * FB_VMODE_CONUPDATE and FB_VMODE_SMOOTH_XPAN are equal!&n;&t; * as FB_VMODE_SMOOTH_XPAN is only used internally&n;&t; */
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_CONUPDATE
)paren
(brace
id|var-&gt;vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|display-&gt;var.xoffset
suffix:semicolon
id|var-&gt;yoffset
op_assign
id|display-&gt;var.yoffset
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ami_decode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|ami_encode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
(brace
id|oldxres
op_assign
id|display-&gt;var.xres
suffix:semicolon
id|oldyres
op_assign
id|display-&gt;var.yres
suffix:semicolon
id|oldvxres
op_assign
id|display-&gt;var.xres_virtual
suffix:semicolon
id|oldvyres
op_assign
id|display-&gt;var.yres_virtual
suffix:semicolon
id|oldbpp
op_assign
id|display-&gt;var.bits_per_pixel
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
r_if
c_cond
(paren
id|oldxres
op_ne
id|var-&gt;xres
op_logical_or
id|oldyres
op_ne
id|var-&gt;yres
op_logical_or
id|oldvxres
op_ne
id|var-&gt;xres_virtual
op_logical_or
id|oldvyres
op_ne
id|var-&gt;yres_virtual
op_logical_or
id|oldbpp
op_ne
id|var-&gt;bits_per_pixel
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
id|ami_encode_fix
c_func
(paren
op_amp
id|fix
comma
op_amp
id|par
)paren
suffix:semicolon
id|display-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|videomemory
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|amifb_inverse
suffix:semicolon
r_switch
c_cond
(paren
id|fix.type
)paren
(brace
macro_line|#ifdef FBCON_HAS_ILBM
r_case
id|FB_TYPE_INTERLEAVED_PLANES
suffix:colon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_ilbm
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_AFB
r_case
id|FB_TYPE_PLANES
suffix:colon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_afb
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_MFB
r_case
id|FB_TYPE_PACKED_PIXELS
suffix:colon
multiline_comment|/* depth == 1 */
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_mfb
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb_info.changevar
)paren
(paren
op_star
id|fb_info.changevar
)paren
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oldbpp
op_ne
id|var-&gt;bits_per_pixel
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|display-&gt;cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
id|ami_set_var
c_func
(paren
op_amp
id|display-&gt;var
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Pan or Wrap the Display&n;&t; *&n;&t; * This call looks only at xoffset, yoffset and the FB_VMODE_YWRAP flag&n;&t; */
DECL|function|amifb_pan_display
r_static
r_int
id|amifb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * TODO: There will be problems when xpan!=1, so some columns&n;&t;&t; * on the right side will never be seen&n;&t;&t; */
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.xres
OG
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|fb_display
(braket
id|con
)braket
dot
id|var.xres_virtual
)paren
op_logical_or
id|var-&gt;yoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.yres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
id|ami_pan_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get the Colormap&n;&t; */
DECL|function|amifb_get_cmap
r_static
r_int
id|amifb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
multiline_comment|/* current console? */
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|ami_getcolreg
comma
id|info
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
multiline_comment|/* non default colormap? */
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
l_int|1
op_lshift
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Set the Colormap&n;&t; */
DECL|function|amifb_set_cmap
r_static
r_int
id|amifb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
multiline_comment|/* no colormap allocated? */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
op_lshift
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
multiline_comment|/* current console? */
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|ami_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Amiga Frame Buffer Specific ioctls&n;&t; */
DECL|function|amifb_ioctl
r_static
r_int
id|amifb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIOGET_FCURSORINFO
suffix:colon
(brace
r_struct
id|fb_fix_cursorinfo
id|crsrfix
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrfix
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|i
op_assign
id|amifb_get_fix_cursorinfo
c_func
(paren
op_amp
id|crsrfix
comma
id|con
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|crsrfix
comma
r_sizeof
(paren
id|crsrfix
)paren
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_case
id|FBIOGET_VCURSORINFO
suffix:colon
(brace
r_struct
id|fb_var_cursorinfo
id|crsrvar
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrvar
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|i
op_assign
id|amifb_get_var_cursorinfo
c_func
(paren
op_amp
id|crsrvar
comma
(paren
(paren
r_struct
id|fb_var_cursorinfo
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|data
comma
id|con
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|crsrvar
comma
r_sizeof
(paren
id|crsrvar
)paren
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_case
id|FBIOPUT_VCURSORINFO
suffix:colon
(brace
r_struct
id|fb_var_cursorinfo
id|crsrvar
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrvar
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|copy_from_user
c_func
(paren
op_amp
id|crsrvar
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrvar
)paren
)paren
suffix:semicolon
id|i
op_assign
id|amifb_set_var_cursorinfo
c_func
(paren
op_amp
id|crsrvar
comma
(paren
(paren
r_struct
id|fb_var_cursorinfo
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|data
comma
id|con
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_case
id|FBIOGET_CURSORSTATE
suffix:colon
(brace
r_struct
id|fb_cursorstate
id|crsrstate
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrstate
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|i
op_assign
id|amifb_get_cursorstate
c_func
(paren
op_amp
id|crsrstate
comma
id|con
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|crsrstate
comma
r_sizeof
(paren
id|crsrstate
)paren
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_case
id|FBIOPUT_CURSORSTATE
suffix:colon
(brace
r_struct
id|fb_cursorstate
id|crsrstate
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrstate
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|copy_from_user
c_func
(paren
op_amp
id|crsrstate
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|crsrstate
)paren
)paren
suffix:semicolon
id|i
op_assign
id|amifb_set_cursorstate
c_func
(paren
op_amp
id|crsrstate
comma
id|con
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
r_case
id|FBCMD_GET_CURRENTPAR
suffix:colon
(brace
r_struct
id|amifb_par
id|par
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|amifb_par
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|ami_get_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|par
comma
r_sizeof
(paren
r_struct
id|amifb_par
)paren
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_case
id|FBCMD_SET_CURRENTPAR
suffix:colon
(brace
r_struct
id|amifb_par
id|par
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|amifb_par
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|copy_from_user
c_func
(paren
op_amp
id|par
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|amifb_par
)paren
)paren
suffix:semicolon
id|ami_set_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
macro_line|#endif */ DEBUG */
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Hardware Cursor&n;&t; */
DECL|function|amifb_get_fix_cursorinfo
r_static
r_int
id|amifb_get_fix_cursorinfo
c_func
(paren
r_struct
id|fb_fix_cursorinfo
op_star
id|fix
comma
r_int
id|con
)paren
(brace
r_return
id|ami_get_fix_cursorinfo
c_func
(paren
id|fix
comma
id|con
)paren
suffix:semicolon
)brace
DECL|function|amifb_get_var_cursorinfo
r_static
r_int
id|amifb_get_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
(brace
r_return
id|ami_get_var_cursorinfo
c_func
(paren
id|var
comma
id|data
comma
id|con
)paren
suffix:semicolon
)brace
DECL|function|amifb_set_var_cursorinfo
r_static
r_int
id|amifb_set_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
(brace
r_return
id|ami_set_var_cursorinfo
c_func
(paren
id|var
comma
id|data
comma
id|con
)paren
suffix:semicolon
)brace
DECL|function|amifb_get_cursorstate
r_static
r_int
id|amifb_get_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
(brace
r_return
id|ami_get_cursorstate
c_func
(paren
id|state
comma
id|con
)paren
suffix:semicolon
)brace
DECL|function|amifb_set_cursorstate
r_static
r_int
id|amifb_set_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
(brace
r_return
id|ami_set_cursorstate
c_func
(paren
id|state
comma
id|con
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Allocate, Clear and Align a Block of Chip Memory&n;&t; */
DECL|variable|unaligned_chipptr
r_static
id|u_long
id|unaligned_chipptr
op_assign
l_int|0
suffix:semicolon
DECL|function|chipalloc
r_static
r_inline
id|u_long
id|__init
id|chipalloc
c_func
(paren
id|u_long
id|size
)paren
(brace
id|size
op_add_assign
id|PAGE_SIZE
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|unaligned_chipptr
op_assign
(paren
id|u_long
)paren
id|amiga_chip_alloc
c_func
(paren
id|size
comma
l_string|&quot;amifb [RAM]&quot;
)paren
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;No Chip RAM for frame buffer&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|unaligned_chipptr
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|PAGE_ALIGN
c_func
(paren
id|unaligned_chipptr
)paren
suffix:semicolon
)brace
DECL|function|chipfree
r_static
r_inline
r_void
id|chipfree
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|unaligned_chipptr
)paren
id|amiga_chip_free
c_func
(paren
(paren
r_void
op_star
)paren
id|unaligned_chipptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Initialisation&n;&t; */
DECL|function|amifb_init
r_int
id|__init
id|amifb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|tag
comma
id|i
comma
id|err
op_assign
l_int|0
suffix:semicolon
id|u_long
id|chipptr
suffix:semicolon
id|u_int
id|defmode
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACH_IS_AMIGA
op_logical_or
op_logical_neg
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_VIDEO
)paren
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/*&n;&t; * TODO: where should we put this? The DMI Resolver doesn&squot;t have a&n;&t; *&t; frame buffer accessible by the CPU&n;&t; */
macro_line|#ifdef CONFIG_GSP_RESOLVER
r_if
c_cond
(paren
id|amifb_resolver
)paren
(brace
id|custom.dmacon
op_assign
id|DMAF_MASTER
op_or
id|DMAF_RASTER
op_or
id|DMAF_COPPER
op_or
id|DMAF_BLITTER
op_or
id|DMAF_SPRITE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * We request all registers starting from bplpt[0]&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|CUSTOM_PHYSADDR
op_plus
l_int|0xe0
comma
l_int|0x120
comma
l_string|&quot;amifb [Denise/Lisa]&quot;
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|custom.dmacon
op_assign
id|DMAF_ALL
op_or
id|DMAF_MASTER
suffix:semicolon
r_switch
c_cond
(paren
id|amiga_chipset
)paren
(brace
macro_line|#ifdef CONFIG_FB_AMIGA_OCS
r_case
id|CS_OCS
suffix:colon
id|strcat
c_func
(paren
id|amifb_name
comma
l_string|&quot;OCS&quot;
)paren
suffix:semicolon
id|default_chipset
suffix:colon
id|chipset
op_assign
id|TAG_OCS
suffix:semicolon
id|maxdepth
(braket
id|TAG_SHRES
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* OCS means no SHRES */
id|maxdepth
(braket
id|TAG_HIRES
)braket
op_assign
l_int|4
suffix:semicolon
id|maxdepth
(braket
id|TAG_LORES
)braket
op_assign
l_int|6
suffix:semicolon
id|maxfmode
op_assign
id|TAG_FMODE_1
suffix:semicolon
id|defmode
op_assign
id|amiga_vblank
op_eq
l_int|50
ques
c_cond
id|DEFMODE_PAL
suffix:colon
id|DEFMODE_NTSC
suffix:semicolon
id|videomemorysize
op_assign
id|VIDEOMEMSIZE_OCS
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_FB_AMIGA_OCS */
macro_line|#ifdef CONFIG_FB_AMIGA_ECS
r_case
id|CS_ECS
suffix:colon
id|strcat
c_func
(paren
id|amifb_name
comma
l_string|&quot;ECS&quot;
)paren
suffix:semicolon
id|chipset
op_assign
id|TAG_ECS
suffix:semicolon
id|maxdepth
(braket
id|TAG_SHRES
)braket
op_assign
l_int|2
suffix:semicolon
id|maxdepth
(braket
id|TAG_HIRES
)braket
op_assign
l_int|4
suffix:semicolon
id|maxdepth
(braket
id|TAG_LORES
)braket
op_assign
l_int|6
suffix:semicolon
id|maxfmode
op_assign
id|TAG_FMODE_1
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMBER_FF
)paren
)paren
id|defmode
op_assign
id|amiga_vblank
op_eq
l_int|50
ques
c_cond
id|DEFMODE_AMBER_PAL
suffix:colon
id|DEFMODE_AMBER_NTSC
suffix:semicolon
r_else
id|defmode
op_assign
id|amiga_vblank
op_eq
l_int|50
ques
c_cond
id|DEFMODE_PAL
suffix:colon
id|DEFMODE_NTSC
suffix:semicolon
r_if
c_cond
(paren
id|amiga_chip_avail
c_func
(paren
)paren
op_minus
id|CHIPRAM_SAFETY_LIMIT
OG
id|VIDEOMEMSIZE_ECS_1M
)paren
id|videomemorysize
op_assign
id|VIDEOMEMSIZE_ECS_2M
suffix:semicolon
r_else
id|videomemorysize
op_assign
id|VIDEOMEMSIZE_ECS_1M
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_FB_AMIGA_ECS */
macro_line|#ifdef CONFIG_FB_AMIGA_AGA
r_case
id|CS_AGA
suffix:colon
id|strcat
c_func
(paren
id|amifb_name
comma
l_string|&quot;AGA&quot;
)paren
suffix:semicolon
id|chipset
op_assign
id|TAG_AGA
suffix:semicolon
id|maxdepth
(braket
id|TAG_SHRES
)braket
op_assign
l_int|8
suffix:semicolon
id|maxdepth
(braket
id|TAG_HIRES
)braket
op_assign
l_int|8
suffix:semicolon
id|maxdepth
(braket
id|TAG_LORES
)braket
op_assign
l_int|8
suffix:semicolon
id|maxfmode
op_assign
id|TAG_FMODE_4
suffix:semicolon
id|defmode
op_assign
id|DEFMODE_AGA
suffix:semicolon
r_if
c_cond
(paren
id|amiga_chip_avail
c_func
(paren
)paren
op_minus
id|CHIPRAM_SAFETY_LIMIT
OG
id|VIDEOMEMSIZE_AGA_1M
)paren
id|videomemorysize
op_assign
id|VIDEOMEMSIZE_AGA_2M
suffix:semicolon
r_else
id|videomemorysize
op_assign
id|VIDEOMEMSIZE_AGA_1M
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_FB_AMIGA_AGA */
r_default
suffix:colon
macro_line|#ifdef CONFIG_FB_AMIGA_OCS
id|printk
c_func
(paren
l_string|&quot;Unknown graphics chipset, defaulting to OCS&bslash;n&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|amifb_name
comma
l_string|&quot;Unknown&quot;
)paren
suffix:semicolon
r_goto
id|default_chipset
suffix:semicolon
macro_line|#else /* CONFIG_FB_AMIGA_OCS */
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|amifb_error
suffix:semicolon
macro_line|#endif /* CONFIG_FB_AMIGA_OCS */
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Calculate the Pixel Clock Values for this Machine&n;&t; */
(brace
id|u_long
id|tmp
op_assign
id|DIVUL
c_func
(paren
l_float|200E9
comma
id|amiga_eclock
)paren
suffix:semicolon
id|pixclock
(braket
id|TAG_SHRES
)braket
op_assign
(paren
id|tmp
op_plus
l_int|4
)paren
op_div
l_int|8
suffix:semicolon
multiline_comment|/* SHRES:  35 ns / 28 MHz */
id|pixclock
(braket
id|TAG_HIRES
)braket
op_assign
(paren
id|tmp
op_plus
l_int|2
)paren
op_div
l_int|4
suffix:semicolon
multiline_comment|/* HIRES:  70 ns / 14 MHz */
id|pixclock
(braket
id|TAG_LORES
)braket
op_assign
(paren
id|tmp
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
multiline_comment|/* LORES: 140 ns /  7 MHz */
)brace
multiline_comment|/*&n;&t; * Replace the Tag Values with the Real Pixel Clock Values&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TOTAL_MODES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|fb_videomode
op_star
id|mode
op_assign
op_amp
id|ami_modedb
(braket
id|i
)braket
suffix:semicolon
id|tag
op_assign
id|mode-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
id|tag
op_eq
id|TAG_SHRES
op_logical_or
id|tag
op_eq
id|TAG_HIRES
op_logical_or
id|tag
op_eq
id|TAG_LORES
)paren
(brace
id|mode-&gt;pixclock
op_assign
id|pixclock
(braket
id|tag
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *  These monitor specs are for a typical Amiga monitor (e.g. A1960)&n;&t; */
r_if
c_cond
(paren
id|fb_info.monspecs.hfmin
op_eq
l_int|0
)paren
(brace
id|fb_info.monspecs.hfmin
op_assign
l_int|15000
suffix:semicolon
id|fb_info.monspecs.hfmax
op_assign
l_int|38000
suffix:semicolon
id|fb_info.monspecs.vfmin
op_assign
l_int|49
suffix:semicolon
id|fb_info.monspecs.vfmax
op_assign
l_int|90
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|fb_info.modename
comma
id|amifb_name
)paren
suffix:semicolon
id|fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fb_info.node
op_assign
op_minus
l_int|1
suffix:semicolon
id|fb_info.fbops
op_assign
op_amp
id|amifb_ops
suffix:semicolon
id|fb_info.disp
op_assign
op_amp
id|disp
suffix:semicolon
id|fb_info.switch_con
op_assign
op_amp
id|amifbcon_switch
suffix:semicolon
id|fb_info.updatevar
op_assign
op_amp
id|amifbcon_updatevar
suffix:semicolon
id|fb_info.blank
op_assign
op_amp
id|amifbcon_blank
suffix:semicolon
id|fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|var
comma
l_int|0
comma
r_sizeof
(paren
id|var
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_find_mode
c_func
(paren
op_amp
id|var
comma
op_amp
id|fb_info
comma
id|mode_option
comma
id|ami_modedb
comma
id|NUM_TOTAL_MODES
comma
op_amp
id|ami_modedb
(braket
id|defmode
)braket
comma
l_int|4
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|amifb_error
suffix:semicolon
)brace
id|round_down_bpp
op_assign
l_int|0
suffix:semicolon
id|chipptr
op_assign
id|chipalloc
c_func
(paren
id|videomemorysize
op_plus
id|SPRITEMEMSIZE
op_plus
id|DUMMYSPRITEMEMSIZE
op_plus
id|COPINITSIZE
op_plus
l_int|4
op_star
id|COPLISTSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|videomemory
comma
id|u_long
comma
id|chipptr
comma
id|videomemorysize
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|spritememory
comma
id|u_long
comma
id|chipptr
comma
id|SPRITEMEMSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|dummysprite
comma
id|u_short
op_star
comma
id|chipptr
comma
id|DUMMYSPRITEMEMSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|copdisplay.init
comma
id|copins
op_star
comma
id|chipptr
comma
id|COPINITSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|copdisplay.list
(braket
l_int|0
)braket
(braket
l_int|0
)braket
comma
id|copins
op_star
comma
id|chipptr
comma
id|COPLISTSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|copdisplay.list
(braket
l_int|0
)braket
(braket
l_int|1
)braket
comma
id|copins
op_star
comma
id|chipptr
comma
id|COPLISTSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|copdisplay.list
(braket
l_int|1
)braket
(braket
l_int|0
)braket
comma
id|copins
op_star
comma
id|chipptr
comma
id|COPLISTSIZE
)paren
suffix:semicolon
id|assignchunk
c_func
(paren
id|copdisplay.list
(braket
l_int|1
)braket
(braket
l_int|1
)braket
comma
id|copins
op_star
comma
id|chipptr
comma
id|COPLISTSIZE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * access the videomem with writethrough cache&n;&t; */
id|videomemory_phys
op_assign
(paren
id|u_long
)paren
id|ZTWO_PADDR
c_func
(paren
id|videomemory
)paren
suffix:semicolon
id|videomemory
op_assign
(paren
id|u_long
)paren
id|ioremap_writethrough
c_func
(paren
id|videomemory_phys
comma
id|videomemorysize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|videomemory
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;amifb: WARNING! unable to map videomem cached writethrough&bslash;n&quot;
)paren
suffix:semicolon
id|videomemory
op_assign
id|ZTWO_VADDR
c_func
(paren
id|videomemory_phys
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dummysprite
comma
l_int|0
comma
id|DUMMYSPRITEMEMSIZE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable Display DMA&n;&t; */
id|custom.dmacon
op_assign
id|DMAF_SETCLR
op_or
id|DMAF_MASTER
op_or
id|DMAF_RASTER
op_or
id|DMAF_COPPER
op_or
id|DMAF_BLITTER
op_or
id|DMAF_SPRITE
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure the Copper has something to do&n;&t; */
id|ami_init_copper
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_AMIGA_VERTB
comma
id|amifb_interrupt
comma
l_int|0
comma
l_string|&quot;fb vertb handler&quot;
comma
op_amp
id|currentpar
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|amifb_error
suffix:semicolon
)brace
id|amifb_set_var
c_func
(paren
op_amp
id|var
comma
op_minus
l_int|1
comma
op_amp
id|fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|amifb_error
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;fb%d: %s frame buffer device, using %ldK of video memory&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|fb_info.node
)paren
comma
id|fb_info.modename
comma
id|videomemorysize
op_rshift
l_int|10
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|amifb_error
suffix:colon
id|amifb_deinit
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|amifb_deinit
r_static
r_void
id|amifb_deinit
c_func
(paren
r_void
)paren
(brace
id|chipfree
c_func
(paren
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|CUSTOM_PHYSADDR
op_plus
l_int|0xe0
comma
l_int|0x120
)paren
suffix:semicolon
id|custom.dmacon
op_assign
id|DMAF_ALL
op_or
id|DMAF_MASTER
suffix:semicolon
)brace
DECL|function|amifbcon_switch
r_static
r_int
id|amifbcon_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
multiline_comment|/* Do we have to save the colormap? */
r_if
c_cond
(paren
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap.len
)paren
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|ami_getcolreg
comma
id|info
)paren
suffix:semicolon
id|currcon
op_assign
id|con
suffix:semicolon
id|ami_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
multiline_comment|/* Install new colormap */
id|do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Update the `var&squot; structure (called by fbcon.c)&n;&t; */
DECL|function|amifbcon_updatevar
r_static
r_int
id|amifbcon_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|ami_pan_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Blank the display.&n;&t; */
DECL|function|amifbcon_blank
r_static
r_void
id|amifbcon_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|do_blank
op_assign
id|blank
ques
c_cond
id|blank
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Set the colormap&n;&t; */
DECL|function|do_install_cmap
r_static
r_void
id|do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|ami_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
l_int|1
op_lshift
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
)paren
comma
l_int|1
comma
id|ami_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
DECL|function|flash_cursor
r_static
r_int
id|flash_cursor
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|cursorcount
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cursormode
op_eq
id|FB_CURSOR_FLASH
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|cursorcount
)paren
(brace
id|cursorstate
op_assign
op_minus
id|cursorstate
suffix:semicolon
id|cursorcount
op_assign
id|cursorrate
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_blanked
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * VBlank Display Interrupt&n;&t; */
DECL|function|amifb_interrupt
r_static
r_void
id|amifb_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_if
c_cond
(paren
id|do_vmode_pan
op_logical_or
id|do_vmode_full
)paren
id|ami_update_display
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_vmode_full
)paren
id|ami_init_display
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_vmode_pan
)paren
(brace
id|flash_cursor
c_func
(paren
)paren
suffix:semicolon
id|ami_rebuild_copper
c_func
(paren
)paren
suffix:semicolon
id|do_cursor
op_assign
id|do_vmode_pan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|do_cursor
)paren
(brace
id|flash_cursor
c_func
(paren
)paren
suffix:semicolon
id|ami_set_sprite
c_func
(paren
)paren
suffix:semicolon
id|do_cursor
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|flash_cursor
c_func
(paren
)paren
)paren
id|ami_set_sprite
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_blank
)paren
(brace
id|ami_do_blank
c_func
(paren
)paren
suffix:semicolon
id|do_blank
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_vmode_full
)paren
(brace
id|ami_reinit_copper
c_func
(paren
)paren
suffix:semicolon
id|do_vmode_full
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * A strtok which returns empty strings, too&n;&t; */
DECL|function|strtoke
r_static
r_char
id|__init
op_star
id|strtoke
c_func
(paren
r_char
op_star
id|s
comma
r_const
r_char
op_star
id|ct
)paren
(brace
r_char
op_star
id|sbegin
comma
op_star
id|send
suffix:semicolon
r_static
r_char
op_star
id|ssave
op_assign
l_int|NULL
suffix:semicolon
id|sbegin
op_assign
id|s
ques
c_cond
id|s
suffix:colon
id|ssave
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbegin
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_star
id|sbegin
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|ssave
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|send
op_assign
id|strpbrk
c_func
(paren
id|sbegin
comma
id|ct
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send
op_logical_and
op_star
id|send
op_ne
l_char|&squot;&bslash;0&squot;
)paren
op_star
id|send
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|ssave
op_assign
id|send
suffix:semicolon
r_return
id|sbegin
suffix:semicolon
)brace
multiline_comment|/* --------------------------- Hardware routines --------------------------- */
multiline_comment|/*&n;&t; * This function should fill in the `fix&squot; structure based on the&n;&t; * values in the `par&squot; structure.&n;&t; */
DECL|function|ami_encode_fix
r_static
r_int
id|ami_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|amifb_par
op_star
id|par
)paren
(brace
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|amifb_name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|videomemory_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|videomemorysize
suffix:semicolon
macro_line|#ifdef FBCON_HAS_MFB
r_if
c_cond
(paren
id|par-&gt;bpp
op_eq
l_int|1
)paren
(brace
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|amifb_ilbm
)paren
(brace
id|fix-&gt;type
op_assign
id|FB_TYPE_INTERLEAVED_PLANES
suffix:semicolon
id|fix-&gt;type_aux
op_assign
id|par-&gt;next_line
suffix:semicolon
)brace
r_else
(brace
id|fix-&gt;type
op_assign
id|FB_TYPE_PLANES
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
)brace
id|fix-&gt;line_length
op_assign
id|div8
c_func
(paren
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;vxres
)paren
)paren
suffix:semicolon
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
id|fix-&gt;ywrapstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
id|fix-&gt;ypanstep
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_and_assign
id|FB_VMODE_SMOOTH_XPAN
)paren
id|fix-&gt;xpanstep
op_assign
l_int|1
suffix:semicolon
r_else
id|fix-&gt;xpanstep
op_assign
l_int|16
op_lshift
id|maxfmode
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
)brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_AMIGABLITT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get the video params out of `var&squot;. If a value doesn&squot;t fit, round&n;&t; * it up, if it&squot;s too big, return -EINVAL.&n;&t; */
DECL|function|ami_decode_var
r_static
r_int
id|ami_decode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|amifb_par
op_star
id|par
)paren
(brace
id|u_short
id|clk_shift
comma
id|line_shift
suffix:semicolon
id|u_long
id|maxfetchstop
comma
id|fstrt
comma
id|fsize
comma
id|fconst
comma
id|xres_n
comma
id|yres_n
suffix:semicolon
id|u_int
id|htotal
comma
id|vtotal
suffix:semicolon
multiline_comment|/*&n;&t; * Find a matching Pixel Clock&n;&t; */
r_for
c_loop
(paren
id|clk_shift
op_assign
id|TAG_SHRES
suffix:semicolon
id|clk_shift
op_le
id|TAG_LORES
suffix:semicolon
id|clk_shift
op_increment
)paren
r_if
c_cond
(paren
id|var-&gt;pixclock
op_le
id|pixclock
(braket
id|clk_shift
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|clk_shift
OG
id|TAG_LORES
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;pixclock too high&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|par-&gt;clk_shift
op_assign
id|clk_shift
suffix:semicolon
multiline_comment|/*&n;&t; * Check the Geometry Values&n;&t; */
r_if
c_cond
(paren
(paren
id|par-&gt;xres
op_assign
id|var-&gt;xres
)paren
OL
l_int|64
)paren
id|par-&gt;xres
op_assign
l_int|64
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;yres
op_assign
id|var-&gt;yres
)paren
OL
l_int|64
)paren
id|par-&gt;yres
op_assign
l_int|64
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;vxres
op_assign
id|var-&gt;xres_virtual
)paren
OL
id|par-&gt;xres
)paren
id|par-&gt;vxres
op_assign
id|par-&gt;xres
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;vyres
op_assign
id|var-&gt;yres_virtual
)paren
OL
id|par-&gt;yres
)paren
id|par-&gt;vyres
op_assign
id|par-&gt;yres
suffix:semicolon
id|par-&gt;bpp
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|var-&gt;nonstd
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;bpp
OL
l_int|1
)paren
id|par-&gt;bpp
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bpp
OG
id|maxdepth
(braket
id|clk_shift
)braket
)paren
(brace
r_if
c_cond
(paren
id|round_down_bpp
op_logical_and
id|maxdepth
(braket
id|clk_shift
)braket
)paren
id|par-&gt;bpp
op_assign
id|maxdepth
(braket
id|clk_shift
)braket
suffix:semicolon
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;invalid bpp&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;nonstd
op_eq
id|FB_NONSTD_HAM
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;bpp
OL
l_int|6
)paren
id|par-&gt;bpp
op_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bpp
op_ne
l_int|6
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;bpp
OL
l_int|8
)paren
id|par-&gt;bpp
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bpp
op_ne
l_int|8
op_logical_or
op_logical_neg
id|IS_AGA
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;invalid bpp for ham mode&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;unknown nonstd mode&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * FB_VMODE_SMOOTH_XPAN will be cleared, if one of the folloing&n;&t; * checks failed and smooth scrolling is not possible&n;&t; */
id|par-&gt;vmode
op_assign
id|var-&gt;vmode
op_or
id|FB_VMODE_SMOOTH_XPAN
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
(brace
r_case
id|FB_VMODE_INTERLACED
suffix:colon
id|line_shift
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_VMODE_NONINTERLACED
suffix:colon
id|line_shift
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_VMODE_DOUBLE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|IS_AGA
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;double mode only possible with aga&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|line_shift
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;unknown video mode&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|par-&gt;line_shift
op_assign
id|line_shift
suffix:semicolon
multiline_comment|/*&n;&t; * Vertical and Horizontal Timings&n;&t; */
id|xres_n
op_assign
id|par-&gt;xres
op_lshift
id|clk_shift
suffix:semicolon
id|yres_n
op_assign
id|par-&gt;yres
op_lshift
id|line_shift
suffix:semicolon
id|par-&gt;htotal
op_assign
id|down8
c_func
(paren
(paren
id|var-&gt;left_margin
op_plus
id|par-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
)paren
op_lshift
id|clk_shift
)paren
suffix:semicolon
id|par-&gt;vtotal
op_assign
id|down2
c_func
(paren
(paren
(paren
id|var-&gt;upper_margin
op_plus
id|par-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
)paren
op_lshift
id|line_shift
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|par-&gt;bplcon3
op_assign
id|sprpixmode
(braket
id|clk_shift
)braket
suffix:semicolon
r_else
id|par-&gt;bplcon3
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_BROADCAST
)paren
(brace
id|par-&gt;diwstop_h
op_assign
id|par-&gt;htotal
op_minus
(paren
(paren
id|var-&gt;right_margin
op_minus
id|var-&gt;hsync_len
)paren
op_lshift
id|clk_shift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|par-&gt;diwstop_h
op_add_assign
id|mod4
c_func
(paren
id|var-&gt;hsync_len
)paren
suffix:semicolon
r_else
id|par-&gt;diwstop_h
op_assign
id|down4
c_func
(paren
id|par-&gt;diwstop_h
)paren
suffix:semicolon
id|par-&gt;diwstrt_h
op_assign
id|par-&gt;diwstop_h
op_minus
id|xres_n
suffix:semicolon
id|par-&gt;diwstop_v
op_assign
id|par-&gt;vtotal
op_minus
(paren
(paren
id|var-&gt;lower_margin
op_minus
id|var-&gt;vsync_len
)paren
op_lshift
id|line_shift
)paren
suffix:semicolon
id|par-&gt;diwstrt_v
op_assign
id|par-&gt;diwstop_v
op_minus
id|yres_n
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;diwstop_h
op_ge
id|par-&gt;htotal
op_plus
l_int|8
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;invalid diwstop_h&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;diwstop_v
OG
id|par-&gt;vtotal
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;invaild diwstop_v&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
multiline_comment|/* Initialize sync with some reasonable values for pwrsave */
id|par-&gt;hsstrt
op_assign
l_int|160
suffix:semicolon
id|par-&gt;hsstop
op_assign
l_int|320
suffix:semicolon
id|par-&gt;vsstrt
op_assign
l_int|30
suffix:semicolon
id|par-&gt;vsstop
op_assign
l_int|34
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;hsstrt
op_assign
l_int|0
suffix:semicolon
id|par-&gt;hsstop
op_assign
l_int|0
suffix:semicolon
id|par-&gt;vsstrt
op_assign
l_int|0
suffix:semicolon
id|par-&gt;vsstop
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;vtotal
OG
(paren
id|PAL_VTOTAL
op_plus
id|NTSC_VTOTAL
)paren
op_div
l_int|2
)paren
(brace
multiline_comment|/* PAL video mode */
r_if
c_cond
(paren
id|par-&gt;htotal
op_ne
id|PAL_HTOTAL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;htotal invalid for pal&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;diwstrt_h
OL
id|PAL_DIWSTRT_H
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;diwstrt_h too low for pal&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;diwstrt_v
OL
id|PAL_DIWSTRT_V
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;diwstrt_v too low for pal&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|htotal
op_assign
id|PAL_HTOTAL
op_rshift
id|clk_shift
suffix:semicolon
id|vtotal
op_assign
id|PAL_VTOTAL
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
id|par-&gt;beamcon0
op_assign
id|BMC0_PAL
suffix:semicolon
id|par-&gt;bplcon3
op_or_assign
id|BPC3_BRDRBLNK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AGNUS_HR_PAL
)paren
op_logical_or
id|AMIGAHW_PRESENT
c_func
(paren
id|AGNUS_HR_NTSC
)paren
)paren
(brace
id|par-&gt;beamcon0
op_assign
id|BMC0_PAL
suffix:semicolon
id|par-&gt;hsstop
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|amiga_vblank
op_ne
l_int|50
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;pal not supported by this chipset&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* NTSC video mode&n;&t;&t;&t; * In the AGA chipset seems to be hardware bug with BPC3_BRDRBLNK&n;&t;&t;&t; * and NTSC activated, so than better let diwstop_h &lt;= 1812&n;&t;&t;&t; */
r_if
c_cond
(paren
id|par-&gt;htotal
op_ne
id|NTSC_HTOTAL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;htotal invalid for ntsc&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;diwstrt_h
OL
id|NTSC_DIWSTRT_H
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;diwstrt_h too low for ntsc&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;diwstrt_v
OL
id|NTSC_DIWSTRT_V
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;diwstrt_v too low for ntsc&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|htotal
op_assign
id|NTSC_HTOTAL
op_rshift
id|clk_shift
suffix:semicolon
id|vtotal
op_assign
id|NTSC_VTOTAL
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
id|par-&gt;beamcon0
op_assign
l_int|0
suffix:semicolon
id|par-&gt;bplcon3
op_or_assign
id|BPC3_BRDRBLNK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AGNUS_HR_PAL
)paren
op_logical_or
id|AMIGAHW_PRESENT
c_func
(paren
id|AGNUS_HR_NTSC
)paren
)paren
(brace
id|par-&gt;beamcon0
op_assign
l_int|0
suffix:semicolon
id|par-&gt;hsstop
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|amiga_vblank
op_ne
l_int|60
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ntsc not supported by this chipset&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|IS_OCS
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;diwstrt_h
op_ge
l_int|1024
op_logical_or
id|par-&gt;diwstop_h
OL
l_int|1024
op_logical_or
id|par-&gt;diwstrt_v
op_ge
l_int|512
op_logical_or
id|par-&gt;diwstop_v
OL
l_int|256
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;invalid position for display on ocs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
multiline_comment|/* Programmable video mode */
id|par-&gt;hsstrt
op_assign
id|var-&gt;right_margin
op_lshift
id|clk_shift
suffix:semicolon
id|par-&gt;hsstop
op_assign
(paren
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
)paren
op_lshift
id|clk_shift
suffix:semicolon
id|par-&gt;diwstop_h
op_assign
id|par-&gt;htotal
op_minus
id|mod8
c_func
(paren
id|par-&gt;hsstrt
)paren
op_plus
l_int|8
op_minus
(paren
l_int|1
op_lshift
id|clk_shift
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_AGA
)paren
id|par-&gt;diwstop_h
op_assign
id|down4
c_func
(paren
id|par-&gt;diwstop_h
)paren
op_minus
l_int|16
suffix:semicolon
id|par-&gt;diwstrt_h
op_assign
id|par-&gt;diwstop_h
op_minus
id|xres_n
suffix:semicolon
id|par-&gt;hbstop
op_assign
id|par-&gt;diwstrt_h
op_plus
l_int|4
suffix:semicolon
id|par-&gt;hbstrt
op_assign
id|par-&gt;diwstop_h
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;hbstrt
op_ge
id|par-&gt;htotal
op_plus
l_int|8
)paren
id|par-&gt;hbstrt
op_sub_assign
id|par-&gt;htotal
suffix:semicolon
id|par-&gt;hcenter
op_assign
id|par-&gt;hsstrt
op_plus
(paren
id|par-&gt;htotal
op_rshift
l_int|1
)paren
suffix:semicolon
id|par-&gt;vsstrt
op_assign
id|var-&gt;lower_margin
op_lshift
id|line_shift
suffix:semicolon
id|par-&gt;vsstop
op_assign
(paren
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
)paren
op_lshift
id|line_shift
suffix:semicolon
id|par-&gt;diwstop_v
op_assign
id|par-&gt;vtotal
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
id|par-&gt;diwstop_v
op_sub_assign
l_int|2
suffix:semicolon
id|par-&gt;diwstrt_v
op_assign
id|par-&gt;diwstop_v
op_minus
id|yres_n
suffix:semicolon
id|par-&gt;vbstop
op_assign
id|par-&gt;diwstrt_v
op_minus
l_int|2
suffix:semicolon
id|par-&gt;vbstrt
op_assign
id|par-&gt;diwstop_v
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vtotal
OG
l_int|2048
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;vtotal too high&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;htotal
OG
l_int|2048
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;htotal too high&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|par-&gt;bplcon3
op_or_assign
id|BPC3_EXTBLKEN
suffix:semicolon
id|par-&gt;beamcon0
op_assign
id|BMC0_HARDDIS
op_or
id|BMC0_VARVBEN
op_or
id|BMC0_LOLDIS
op_or
id|BMC0_VARVSYEN
op_or
id|BMC0_VARHSYEN
op_or
id|BMC0_VARBEAMEN
op_or
id|BMC0_PAL
op_or
id|BMC0_VARCSYEN
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|par-&gt;beamcon0
op_or_assign
id|BMC0_HSYTRUE
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|par-&gt;beamcon0
op_or_assign
id|BMC0_VSYTRUE
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
)paren
id|par-&gt;beamcon0
op_or_assign
id|BMC0_CSYTRUE
suffix:semicolon
id|htotal
op_assign
id|par-&gt;htotal
op_rshift
id|clk_shift
suffix:semicolon
id|vtotal
op_assign
id|par-&gt;vtotal
op_rshift
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;only broadcast modes possible for ocs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Checking the DMA timing&n;&t; */
id|fconst
op_assign
l_int|16
op_lshift
id|maxfmode
op_lshift
id|clk_shift
suffix:semicolon
multiline_comment|/*&n;&t; * smallest window start value without turn off other dma cycles&n;&t; * than sprite1-7, unless you change min_fstrt&n;&t; */
id|fsize
op_assign
(paren
(paren
id|maxfmode
op_plus
id|clk_shift
op_le
l_int|1
)paren
ques
c_cond
id|fconst
suffix:colon
l_int|64
)paren
suffix:semicolon
id|fstrt
op_assign
id|downx
c_func
(paren
id|fconst
comma
id|par-&gt;diwstrt_h
op_minus
l_int|4
)paren
op_minus
id|fsize
suffix:semicolon
r_if
c_cond
(paren
id|fstrt
OL
id|min_fstrt
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;fetch start too low&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * smallest window start value where smooth scrolling is possible&n;&t; */
id|fstrt
op_assign
id|downx
c_func
(paren
id|fconst
comma
id|par-&gt;diwstrt_h
op_minus
id|fconst
op_plus
(paren
l_int|1
op_lshift
id|clk_shift
)paren
op_minus
l_int|4
)paren
op_minus
id|fsize
suffix:semicolon
r_if
c_cond
(paren
id|fstrt
OL
id|min_fstrt
)paren
id|par-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_SMOOTH_XPAN
suffix:semicolon
id|maxfetchstop
op_assign
id|down16
c_func
(paren
id|par-&gt;htotal
op_minus
l_int|80
)paren
suffix:semicolon
id|fstrt
op_assign
id|downx
c_func
(paren
id|fconst
comma
id|par-&gt;diwstrt_h
op_minus
l_int|4
)paren
op_minus
l_int|64
op_minus
id|fconst
suffix:semicolon
id|fsize
op_assign
id|upx
c_func
(paren
id|fconst
comma
id|xres_n
op_plus
id|modx
c_func
(paren
id|fconst
comma
id|downx
c_func
(paren
l_int|1
op_lshift
id|clk_shift
comma
id|par-&gt;diwstrt_h
op_minus
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fstrt
op_plus
id|fsize
OG
id|maxfetchstop
)paren
id|par-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_SMOOTH_XPAN
suffix:semicolon
id|fsize
op_assign
id|upx
c_func
(paren
id|fconst
comma
id|xres_n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fstrt
op_plus
id|fsize
OG
id|maxfetchstop
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;fetch stop too high&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|maxfmode
op_plus
id|clk_shift
op_le
l_int|1
)paren
(brace
id|fsize
op_assign
id|up64
c_func
(paren
id|xres_n
op_plus
id|fconst
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|min_fstrt
op_plus
id|fsize
op_minus
l_int|64
OG
id|maxfetchstop
)paren
id|par-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_SMOOTH_XPAN
suffix:semicolon
id|fsize
op_assign
id|up64
c_func
(paren
id|xres_n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|min_fstrt
op_plus
id|fsize
op_minus
l_int|64
OG
id|maxfetchstop
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;fetch size too high&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|fsize
op_sub_assign
l_int|64
suffix:semicolon
)brace
r_else
id|fsize
op_sub_assign
id|fconst
suffix:semicolon
multiline_comment|/*&n;&t; * Check if there is enough time to update the bitplane pointers for ywrap&n;&t; */
r_if
c_cond
(paren
id|par-&gt;htotal
op_minus
id|fsize
op_minus
l_int|64
OL
id|par-&gt;bpp
op_star
l_int|64
)paren
id|par-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
multiline_comment|/*&n;&t; * Bitplane calculations and check the Memory Requirements&n;&t; */
r_if
c_cond
(paren
id|amifb_ilbm
)paren
(brace
id|par-&gt;next_plane
op_assign
id|div8
c_func
(paren
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;vxres
)paren
)paren
suffix:semicolon
id|par-&gt;next_line
op_assign
id|par-&gt;bpp
op_star
id|par-&gt;next_plane
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;next_line
op_star
id|par-&gt;vyres
OG
id|videomemorysize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;too few video mem&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
id|par-&gt;next_line
op_assign
id|div8
c_func
(paren
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;vxres
)paren
)paren
suffix:semicolon
id|par-&gt;next_plane
op_assign
id|par-&gt;vyres
op_star
id|par-&gt;next_line
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;next_plane
op_star
id|par-&gt;bpp
OG
id|videomemorysize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;too few video mem&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Hardware Register Values&n;&t; */
id|par-&gt;bplcon0
op_assign
id|BPC0_COLOR
op_or
id|bplpixmode
(braket
id|clk_shift
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
id|par-&gt;bplcon0
op_or_assign
id|BPC0_ECSENA
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bpp
op_eq
l_int|8
)paren
id|par-&gt;bplcon0
op_or_assign
id|BPC0_BPU3
suffix:semicolon
r_else
id|par-&gt;bplcon0
op_or_assign
id|par-&gt;bpp
op_lshift
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;nonstd
op_eq
id|FB_NONSTD_HAM
)paren
id|par-&gt;bplcon0
op_or_assign
id|BPC0_HAM
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_EXT
)paren
id|par-&gt;bplcon0
op_or_assign
id|BPC0_ERSY
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|par-&gt;fmode
op_assign
id|bplfetchmode
(braket
id|maxfmode
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
(brace
r_case
id|FB_VMODE_INTERLACED
suffix:colon
id|par-&gt;bplcon0
op_or_assign
id|BPC0_LACE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_VMODE_DOUBLE
suffix:colon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|par-&gt;fmode
op_or_assign
id|FMODE_SSCAN2
op_or
id|FMODE_BSCAN2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|par-&gt;vmode
op_xor
id|var-&gt;vmode
)paren
op_amp
id|FB_VMODE_YWRAP
)paren
)paren
(brace
id|par-&gt;xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|par-&gt;yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;xoffset
op_logical_or
id|par-&gt;yoffset
OL
l_int|0
op_logical_or
id|par-&gt;yoffset
op_ge
id|par-&gt;vyres
)paren
id|par-&gt;xoffset
op_assign
id|par-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|par-&gt;xoffset
template_param
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;vxres
op_minus
id|par-&gt;xres
)paren
op_logical_or
id|par-&gt;yoffset
template_param
id|par-&gt;vyres
op_minus
id|par-&gt;yres
)paren
id|par-&gt;xoffset
op_assign
id|par-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|par-&gt;xoffset
op_assign
id|par-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|par-&gt;crsr.crsr_x
op_assign
id|par-&gt;crsr.crsr_y
op_assign
l_int|0
suffix:semicolon
id|par-&gt;crsr.spot_x
op_assign
id|par-&gt;crsr.spot_y
op_assign
l_int|0
suffix:semicolon
id|par-&gt;crsr.height
op_assign
id|par-&gt;crsr.width
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0&t;/* fbmon not done.  uncomment for 2.5.x -brad */
r_if
c_cond
(paren
op_logical_neg
id|fbmon_valid_timings
c_func
(paren
id|pixclock
(braket
id|clk_shift
)braket
comma
id|htotal
comma
id|vtotal
comma
op_amp
id|fb_info
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;mode doesn&squot;t fit for monitor&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Fill the `var&squot; structure based on the values in `par&squot; and maybe&n;&t; * other values read out of the hardware.&n;&t; */
DECL|function|ami_encode_var
r_static
r_int
id|ami_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|amifb_par
op_star
id|par
)paren
(brace
id|u_short
id|clk_shift
comma
id|line_shift
suffix:semicolon
id|memset
c_func
(paren
id|var
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
id|clk_shift
op_assign
id|par-&gt;clk_shift
suffix:semicolon
id|line_shift
op_assign
id|par-&gt;line_shift
suffix:semicolon
id|var-&gt;xres
op_assign
id|par-&gt;xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|par-&gt;yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|par-&gt;vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|par-&gt;vyres
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|par-&gt;xoffset
suffix:semicolon
id|var-&gt;yoffset
op_assign
id|par-&gt;yoffset
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|par-&gt;bpp
suffix:semicolon
id|var-&gt;grayscale
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|clk_shift
op_eq
id|TAG_SHRES
)paren
(brace
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|2
suffix:semicolon
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|var-&gt;blue
op_assign
id|var-&gt;green
op_assign
id|var-&gt;red
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_HAM
)paren
id|var-&gt;nonstd
op_assign
id|FB_NONSTD_HAM
suffix:semicolon
r_else
id|var-&gt;nonstd
op_assign
l_int|0
suffix:semicolon
id|var-&gt;activate
op_assign
l_int|0
suffix:semicolon
id|var-&gt;height
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|pixclock
(braket
id|clk_shift
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
op_logical_and
id|par-&gt;fmode
op_amp
id|FMODE_BSCAN2
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
op_logical_and
id|par-&gt;beamcon0
op_amp
id|BMC0_VARBEAMEN
)paren
(brace
id|var-&gt;hsync_len
op_assign
(paren
id|par-&gt;hsstop
op_minus
id|par-&gt;hsstrt
)paren
op_rshift
id|clk_shift
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|par-&gt;hsstrt
op_rshift
id|clk_shift
suffix:semicolon
id|var-&gt;left_margin
op_assign
(paren
id|par-&gt;htotal
op_rshift
id|clk_shift
)paren
op_minus
id|var-&gt;xres
op_minus
id|var-&gt;right_margin
op_minus
id|var-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
(paren
id|par-&gt;vsstop
op_minus
id|par-&gt;vsstrt
)paren
op_rshift
id|line_shift
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|par-&gt;vsstrt
op_rshift
id|line_shift
suffix:semicolon
id|var-&gt;upper_margin
op_assign
(paren
id|par-&gt;vtotal
op_rshift
id|line_shift
)paren
op_minus
id|var-&gt;yres
op_minus
id|var-&gt;lower_margin
op_minus
id|var-&gt;vsync_len
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_HSYTRUE
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_VSYTRUE
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_CSYTRUE
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_COMP_HIGH_ACT
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;sync
op_assign
id|FB_SYNC_BROADCAST
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
l_int|152
op_rshift
id|clk_shift
)paren
op_plus
id|mod4
c_func
(paren
id|par-&gt;diwstop_h
)paren
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
(paren
id|par-&gt;htotal
op_minus
id|down4
c_func
(paren
id|par-&gt;diwstop_h
)paren
)paren
op_rshift
id|clk_shift
)paren
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|var-&gt;left_margin
op_assign
(paren
id|par-&gt;htotal
op_rshift
id|clk_shift
)paren
op_minus
id|var-&gt;xres
op_minus
id|var-&gt;right_margin
op_minus
id|var-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
l_int|4
op_rshift
id|line_shift
suffix:semicolon
id|var-&gt;lower_margin
op_assign
(paren
(paren
id|par-&gt;vtotal
op_minus
id|par-&gt;diwstop_v
)paren
op_rshift
id|line_shift
)paren
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|var-&gt;upper_margin
op_assign
(paren
(paren
(paren
id|par-&gt;vtotal
op_minus
l_int|2
)paren
op_rshift
id|line_shift
)paren
op_plus
l_int|1
)paren
op_minus
id|var-&gt;yres
op_minus
id|var-&gt;lower_margin
op_minus
id|var-&gt;vsync_len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_ERSY
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_EXT
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|var-&gt;vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get current hardware setting&n;&t; */
DECL|function|ami_get_par
r_static
r_void
id|ami_get_par
c_func
(paren
r_struct
id|amifb_par
op_star
id|par
)paren
(brace
op_star
id|par
op_assign
id|currentpar
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Set new videomode&n;&t; */
DECL|function|ami_set_var
r_static
r_void
id|ami_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|do_vmode_pan
op_assign
l_int|0
suffix:semicolon
id|do_vmode_full
op_assign
l_int|0
suffix:semicolon
id|ami_decode_var
c_func
(paren
id|var
comma
op_amp
id|currentpar
)paren
suffix:semicolon
id|ami_build_copper
c_func
(paren
)paren
suffix:semicolon
id|do_vmode_full
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
DECL|function|ami_set_par
r_static
r_void
id|ami_set_par
c_func
(paren
r_struct
id|amifb_par
op_star
id|par
)paren
(brace
id|do_vmode_pan
op_assign
l_int|0
suffix:semicolon
id|do_vmode_full
op_assign
l_int|0
suffix:semicolon
id|currentpar
op_assign
op_star
id|par
suffix:semicolon
id|ami_build_copper
c_func
(paren
)paren
suffix:semicolon
id|do_vmode_full
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * Pan or Wrap the Display&n;&t; *&n;&t; * This call looks only at xoffset, yoffset and the FB_VMODE_YWRAP flag&n;&t; * in `var&squot;.&n;&t; */
DECL|function|ami_pan_var
r_static
r_void
id|ami_pan_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|par-&gt;xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|par-&gt;yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|par-&gt;vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|par-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|do_vmode_pan
op_assign
l_int|0
suffix:semicolon
id|ami_update_par
c_func
(paren
)paren
suffix:semicolon
id|do_vmode_pan
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Update hardware&n;&t; */
DECL|function|ami_update_par
r_static
r_int
id|ami_update_par
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
r_int
id|clk_shift
comma
id|vshift
comma
id|fstrt
comma
id|fsize
comma
id|fstop
comma
id|fconst
comma
id|shift
comma
id|move
comma
id|mod
suffix:semicolon
id|clk_shift
op_assign
id|par-&gt;clk_shift
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_SMOOTH_XPAN
)paren
)paren
id|par-&gt;xoffset
op_assign
id|upx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;xoffset
)paren
suffix:semicolon
id|fconst
op_assign
l_int|16
op_lshift
id|maxfmode
op_lshift
id|clk_shift
suffix:semicolon
id|vshift
op_assign
id|modx
c_func
(paren
l_int|16
op_lshift
id|maxfmode
comma
id|par-&gt;xoffset
)paren
suffix:semicolon
id|fstrt
op_assign
id|par-&gt;diwstrt_h
op_minus
(paren
id|vshift
op_lshift
id|clk_shift
)paren
op_minus
l_int|4
suffix:semicolon
id|fsize
op_assign
(paren
id|par-&gt;xres
op_plus
id|vshift
)paren
op_lshift
id|clk_shift
suffix:semicolon
id|shift
op_assign
id|modx
c_func
(paren
id|fconst
comma
id|fstrt
)paren
suffix:semicolon
id|move
op_assign
id|downx
c_func
(paren
l_int|2
op_lshift
id|maxfmode
comma
id|div8
c_func
(paren
id|par-&gt;xoffset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxfmode
op_plus
id|clk_shift
OG
l_int|1
)paren
(brace
id|fstrt
op_assign
id|downx
c_func
(paren
id|fconst
comma
id|fstrt
)paren
op_minus
l_int|64
suffix:semicolon
id|fsize
op_assign
id|upx
c_func
(paren
id|fconst
comma
id|fsize
)paren
suffix:semicolon
id|fstop
op_assign
id|fstrt
op_plus
id|fsize
op_minus
id|fconst
suffix:semicolon
)brace
r_else
(brace
id|mod
op_assign
id|fstrt
op_assign
id|downx
c_func
(paren
id|fconst
comma
id|fstrt
)paren
op_minus
id|fconst
suffix:semicolon
id|fstop
op_assign
id|fstrt
op_plus
id|upx
c_func
(paren
id|fconst
comma
id|fsize
)paren
op_minus
l_int|64
suffix:semicolon
id|fsize
op_assign
id|up64
c_func
(paren
id|fsize
)paren
suffix:semicolon
id|fstrt
op_assign
id|fstop
op_minus
id|fsize
op_plus
l_int|64
suffix:semicolon
r_if
c_cond
(paren
id|fstrt
OL
id|min_fstrt
)paren
(brace
id|fstop
op_add_assign
id|min_fstrt
op_minus
id|fstrt
suffix:semicolon
id|fstrt
op_assign
id|min_fstrt
suffix:semicolon
)brace
id|move
op_assign
id|move
op_minus
id|div8
c_func
(paren
(paren
id|mod
op_minus
id|fstrt
)paren
op_rshift
id|clk_shift
)paren
suffix:semicolon
)brace
id|mod
op_assign
id|par-&gt;next_line
op_minus
id|div8
c_func
(paren
id|fsize
op_rshift
id|clk_shift
)paren
suffix:semicolon
id|par-&gt;ddfstrt
op_assign
id|fstrt
suffix:semicolon
id|par-&gt;ddfstop
op_assign
id|fstop
suffix:semicolon
id|par-&gt;bplcon1
op_assign
id|hscroll2hw
c_func
(paren
id|shift
)paren
suffix:semicolon
id|par-&gt;bpl2mod
op_assign
id|mod
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
id|par-&gt;bpl2mod
op_add_assign
id|par-&gt;next_line
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
op_logical_and
(paren
id|par-&gt;fmode
op_amp
id|FMODE_BSCAN2
)paren
)paren
id|par-&gt;bpl1mod
op_assign
op_minus
id|div8
c_func
(paren
id|fsize
op_rshift
id|clk_shift
)paren
suffix:semicolon
r_else
id|par-&gt;bpl1mod
op_assign
id|par-&gt;bpl2mod
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;yoffset
)paren
(brace
id|par-&gt;bplpt0
op_assign
id|videomemory_phys
op_plus
id|par-&gt;next_line
op_star
id|par-&gt;yoffset
op_plus
id|move
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;yoffset
OG
id|par-&gt;vyres
op_minus
id|par-&gt;yres
)paren
(brace
id|par-&gt;bplpt0wrap
op_assign
id|videomemory_phys
op_plus
id|move
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
op_logical_and
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
op_plus
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
)paren
id|par-&gt;bplpt0wrap
op_add_assign
id|par-&gt;next_line
suffix:semicolon
)brace
)brace
)brace
r_else
id|par-&gt;bplpt0
op_assign
id|videomemory_phys
op_plus
id|move
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
op_logical_and
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
)paren
)paren
id|par-&gt;bplpt0
op_add_assign
id|par-&gt;next_line
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Read a single color register and split it into&n;&t; * colors/transparent. Return != 0 for invalid regno.&n;&t; */
DECL|function|ami_getcolreg
r_static
r_int
id|ami_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|len
comma
id|tr
comma
id|tg
comma
id|tb
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
id|len
op_assign
l_int|8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currentpar.bplcon0
op_amp
id|BPC0_SHRES
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|3
)paren
r_return
l_int|1
suffix:semicolon
id|len
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|31
)paren
r_return
l_int|1
suffix:semicolon
id|len
op_assign
l_int|4
suffix:semicolon
)brace
id|tr
op_assign
id|palette
(braket
id|regno
)braket
dot
id|red
op_rshift
(paren
l_int|8
op_minus
id|len
)paren
suffix:semicolon
id|tg
op_assign
id|palette
(braket
id|regno
)braket
dot
id|green
op_rshift
(paren
l_int|8
op_minus
id|len
)paren
suffix:semicolon
id|tb
op_assign
id|palette
(braket
id|regno
)braket
dot
id|blue
op_rshift
(paren
l_int|8
op_minus
id|len
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
OL
l_int|16
)paren
(brace
id|tr
op_or_assign
id|tr
op_lshift
id|len
suffix:semicolon
id|tg
op_or_assign
id|tg
op_lshift
id|len
suffix:semicolon
id|tb
op_or_assign
id|tb
op_lshift
id|len
suffix:semicolon
id|len
op_lshift_assign
l_int|1
suffix:semicolon
)brace
op_star
id|red
op_assign
id|tr
suffix:semicolon
op_star
id|green
op_assign
id|tg
suffix:semicolon
op_star
id|blue
op_assign
id|tb
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Set a single color register. The values supplied are already&n;&t; * rounded down to the hardware&squot;s capabilities (according to the&n;&t; * entries in the var structure). Return != 0 for invalid regno.&n;&t; */
DECL|function|ami_setcolreg
r_static
r_int
id|ami_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|currentpar.bplcon0
op_amp
id|BPC0_SHRES
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|3
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|31
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
multiline_comment|/*&n;&t; * Update the corresponding Hardware Color Register, unless it&squot;s Color&n;&t; * Register 0 and the screen is blanked.&n;&t; *&n;&t; * VBlank is switched off to protect bplcon3 or ecs_palette[] from&n;&t; * being changed by ami_do_blank() during the VBlank.&n;&t; */
r_if
c_cond
(paren
id|regno
op_logical_or
op_logical_neg
id|is_blanked
)paren
(brace
macro_line|#if defined(CONFIG_FB_AMIGA_AGA)
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
id|u_short
id|bplcon3
op_assign
id|currentpar.bplcon3
suffix:semicolon
id|VBlankOff
c_func
(paren
)paren
suffix:semicolon
id|custom.bplcon3
op_assign
id|bplcon3
op_or
(paren
id|regno
op_lshift
l_int|8
op_amp
l_int|0xe000
)paren
suffix:semicolon
id|custom.color
(braket
id|regno
op_amp
l_int|31
)braket
op_assign
id|rgb2hw8_high
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|custom.bplcon3
op_assign
id|bplcon3
op_or
(paren
id|regno
op_lshift
l_int|8
op_amp
l_int|0xe000
)paren
op_or
id|BPC3_LOCT
suffix:semicolon
id|custom.color
(braket
id|regno
op_amp
l_int|31
)braket
op_assign
id|rgb2hw8_low
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|custom.bplcon3
op_assign
id|bplcon3
suffix:semicolon
id|VBlankOn
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
macro_line|#if defined(CONFIG_FB_AMIGA_ECS)
r_if
c_cond
(paren
id|currentpar.bplcon0
op_amp
id|BPC0_SHRES
)paren
(brace
id|u_short
id|color
comma
id|mask
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mask
op_assign
l_int|0x3333
suffix:semicolon
id|color
op_assign
id|rgb2hw2
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|VBlankOff
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|regno
op_plus
l_int|12
suffix:semicolon
id|i
op_ge
(paren
r_int
)paren
id|regno
suffix:semicolon
id|i
op_sub_assign
l_int|4
)paren
id|custom.color
(braket
id|i
)braket
op_assign
id|ecs_palette
(braket
id|i
)braket
op_assign
(paren
id|ecs_palette
(braket
id|i
)braket
op_amp
id|mask
)paren
op_or
id|color
suffix:semicolon
id|mask
op_lshift_assign
l_int|2
suffix:semicolon
id|color
op_rshift_assign
l_int|2
suffix:semicolon
id|regno
op_assign
id|down16
c_func
(paren
id|regno
)paren
op_plus
id|mul4
c_func
(paren
id|mod4
c_func
(paren
id|regno
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|regno
op_plus
l_int|3
suffix:semicolon
id|i
op_ge
(paren
r_int
)paren
id|regno
suffix:semicolon
id|i
op_decrement
)paren
id|custom.color
(braket
id|i
)braket
op_assign
id|ecs_palette
(braket
id|i
)braket
op_assign
(paren
id|ecs_palette
(braket
id|i
)braket
op_amp
id|mask
)paren
op_or
id|color
suffix:semicolon
id|VBlankOn
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|custom.color
(braket
id|regno
)braket
op_assign
id|rgb2hw4
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_update_display
r_static
r_void
id|ami_update_display
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|custom.bplcon1
op_assign
id|par-&gt;bplcon1
suffix:semicolon
id|custom.bpl1mod
op_assign
id|par-&gt;bpl1mod
suffix:semicolon
id|custom.bpl2mod
op_assign
id|par-&gt;bpl2mod
suffix:semicolon
id|custom.ddfstrt
op_assign
id|ddfstrt2hw
c_func
(paren
id|par-&gt;ddfstrt
)paren
suffix:semicolon
id|custom.ddfstop
op_assign
id|ddfstop2hw
c_func
(paren
id|par-&gt;ddfstop
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Change the video mode (called by VBlank interrupt)&n;&t; */
DECL|function|ami_init_display
r_static
r_void
id|ami_init_display
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|custom.bplcon0
op_assign
id|par-&gt;bplcon0
op_amp
op_complement
id|BPC0_LACE
suffix:semicolon
id|custom.bplcon2
op_assign
(paren
id|IS_OCS
ques
c_cond
l_int|0
suffix:colon
id|BPC2_KILLEHB
)paren
op_or
id|BPC2_PF2P2
op_or
id|BPC2_PF1P2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
id|custom.bplcon3
op_assign
id|par-&gt;bplcon3
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|custom.bplcon4
op_assign
id|BPC4_ESPRM4
op_or
id|BPC4_OSPRM4
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_VARBEAMEN
)paren
(brace
id|custom.htotal
op_assign
id|htotal2hw
c_func
(paren
id|par-&gt;htotal
)paren
suffix:semicolon
id|custom.hbstrt
op_assign
id|hbstrt2hw
c_func
(paren
id|par-&gt;hbstrt
)paren
suffix:semicolon
id|custom.hbstop
op_assign
id|hbstop2hw
c_func
(paren
id|par-&gt;hbstop
)paren
suffix:semicolon
id|custom.hsstrt
op_assign
id|hsstrt2hw
c_func
(paren
id|par-&gt;hsstrt
)paren
suffix:semicolon
id|custom.hsstop
op_assign
id|hsstop2hw
c_func
(paren
id|par-&gt;hsstop
)paren
suffix:semicolon
id|custom.hcenter
op_assign
id|hcenter2hw
c_func
(paren
id|par-&gt;hcenter
)paren
suffix:semicolon
id|custom.vtotal
op_assign
id|vtotal2hw
c_func
(paren
id|par-&gt;vtotal
)paren
suffix:semicolon
id|custom.vbstrt
op_assign
id|vbstrt2hw
c_func
(paren
id|par-&gt;vbstrt
)paren
suffix:semicolon
id|custom.vbstop
op_assign
id|vbstop2hw
c_func
(paren
id|par-&gt;vbstop
)paren
suffix:semicolon
id|custom.vsstrt
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vsstrt
)paren
suffix:semicolon
id|custom.vsstop
op_assign
id|vsstop2hw
c_func
(paren
id|par-&gt;vsstop
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
op_logical_or
id|par-&gt;hsstop
)paren
id|custom.beamcon0
op_assign
id|par-&gt;beamcon0
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
id|custom.fmode
op_assign
id|par-&gt;fmode
suffix:semicolon
multiline_comment|/*&n;&t; * The minimum period for audio depends on htotal&n;&t; */
id|amiga_audio_min_period
op_assign
id|div16
c_func
(paren
id|par-&gt;htotal
)paren
suffix:semicolon
id|is_lace
op_assign
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|is_lace
)paren
(brace
r_if
c_cond
(paren
id|custom.vposr
op_amp
l_int|0x8000
)paren
id|custom.cop2lc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_else
id|custom.cop2lc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|custom.vposw
op_assign
id|custom.vposr
op_or
l_int|0x8000
suffix:semicolon
id|custom.cop2lc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#else
id|custom.vposw
op_assign
id|custom.vposr
op_or
l_int|0x8000
suffix:semicolon
id|custom.cop2lc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&t; * (Un)Blank the screen (called by VBlank interrupt)&n;&t; */
DECL|function|ami_do_blank
r_static
r_void
id|ami_do_blank
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
macro_line|#if defined(CONFIG_FB_AMIGA_AGA)
id|u_short
id|bplcon3
op_assign
id|par-&gt;bplcon3
suffix:semicolon
macro_line|#endif
id|u_char
id|red
comma
id|green
comma
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|do_blank
OG
l_int|0
)paren
(brace
id|custom.dmacon
op_assign
id|DMAF_RASTER
op_or
id|DMAF_SPRITE
suffix:semicolon
id|red
op_assign
id|green
op_assign
id|blue
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
op_logical_and
id|do_blank
OG
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|do_blank
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|custom.hsstrt
op_assign
id|hsstrt2hw
c_func
(paren
id|par-&gt;hsstrt
)paren
suffix:semicolon
id|custom.hsstop
op_assign
id|hsstop2hw
c_func
(paren
id|par-&gt;hsstop
)paren
suffix:semicolon
id|custom.vsstrt
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vtotal
op_plus
l_int|4
)paren
suffix:semicolon
id|custom.vsstop
op_assign
id|vsstop2hw
c_func
(paren
id|par-&gt;vtotal
op_plus
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|custom.hsstrt
op_assign
id|hsstrt2hw
c_func
(paren
id|par-&gt;htotal
op_plus
l_int|16
)paren
suffix:semicolon
id|custom.hsstop
op_assign
id|hsstop2hw
c_func
(paren
id|par-&gt;htotal
op_plus
l_int|16
)paren
suffix:semicolon
id|custom.vsstrt
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vsstrt
)paren
suffix:semicolon
id|custom.vsstop
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vsstop
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|custom.hsstrt
op_assign
id|hsstrt2hw
c_func
(paren
id|par-&gt;htotal
op_plus
l_int|16
)paren
suffix:semicolon
id|custom.hsstop
op_assign
id|hsstop2hw
c_func
(paren
id|par-&gt;htotal
op_plus
l_int|16
)paren
suffix:semicolon
id|custom.vsstrt
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vtotal
op_plus
l_int|4
)paren
suffix:semicolon
id|custom.vsstop
op_assign
id|vsstop2hw
c_func
(paren
id|par-&gt;vtotal
op_plus
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_VARBEAMEN
)paren
)paren
(brace
id|custom.htotal
op_assign
id|htotal2hw
c_func
(paren
id|par-&gt;htotal
)paren
suffix:semicolon
id|custom.vtotal
op_assign
id|vtotal2hw
c_func
(paren
id|par-&gt;vtotal
)paren
suffix:semicolon
id|custom.beamcon0
op_assign
id|BMC0_HARDDIS
op_or
id|BMC0_VARBEAMEN
op_or
id|BMC0_VARVSYEN
op_or
id|BMC0_VARHSYEN
op_or
id|BMC0_VARCSYEN
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|custom.dmacon
op_assign
id|DMAF_SETCLR
op_or
id|DMAF_RASTER
op_or
id|DMAF_SPRITE
suffix:semicolon
id|red
op_assign
id|palette
(braket
l_int|0
)braket
dot
id|red
suffix:semicolon
id|green
op_assign
id|palette
(braket
l_int|0
)braket
dot
id|green
suffix:semicolon
id|blue
op_assign
id|palette
(braket
l_int|0
)braket
dot
id|blue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
id|custom.hsstrt
op_assign
id|hsstrt2hw
c_func
(paren
id|par-&gt;hsstrt
)paren
suffix:semicolon
id|custom.hsstop
op_assign
id|hsstop2hw
c_func
(paren
id|par-&gt;hsstop
)paren
suffix:semicolon
id|custom.vsstrt
op_assign
id|vsstrt2hw
c_func
(paren
id|par-&gt;vsstrt
)paren
suffix:semicolon
id|custom.vsstop
op_assign
id|vsstop2hw
c_func
(paren
id|par-&gt;vsstop
)paren
suffix:semicolon
id|custom.beamcon0
op_assign
id|par-&gt;beamcon0
suffix:semicolon
)brace
)brace
macro_line|#if defined(CONFIG_FB_AMIGA_AGA)
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
id|custom.bplcon3
op_assign
id|bplcon3
suffix:semicolon
id|custom.color
(braket
l_int|0
)braket
op_assign
id|rgb2hw8_high
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|custom.bplcon3
op_assign
id|bplcon3
op_or
id|BPC3_LOCT
suffix:semicolon
id|custom.color
(braket
l_int|0
)braket
op_assign
id|rgb2hw8_low
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|custom.bplcon3
op_assign
id|bplcon3
suffix:semicolon
)brace
r_else
macro_line|#endif
macro_line|#if defined(CONFIG_FB_AMIGA_ECS)
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_SHRES
)paren
(brace
id|u_short
id|color
comma
id|mask
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mask
op_assign
l_int|0x3333
suffix:semicolon
id|color
op_assign
id|rgb2hw2
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|12
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_sub_assign
l_int|4
)paren
id|custom.color
(braket
id|i
)braket
op_assign
id|ecs_palette
(braket
id|i
)braket
op_assign
(paren
id|ecs_palette
(braket
id|i
)braket
op_amp
id|mask
)paren
op_or
id|color
suffix:semicolon
id|mask
op_lshift_assign
l_int|2
suffix:semicolon
id|color
op_rshift_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|custom.color
(braket
id|i
)braket
op_assign
id|ecs_palette
(braket
id|i
)braket
op_assign
(paren
id|ecs_palette
(braket
id|i
)braket
op_amp
id|mask
)paren
op_or
id|color
suffix:semicolon
)brace
r_else
macro_line|#endif
id|custom.color
(braket
l_int|0
)braket
op_assign
id|rgb2hw4
c_func
(paren
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
id|is_blanked
op_assign
id|do_blank
OG
l_int|0
ques
c_cond
id|do_blank
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Flash the cursor (called by VBlank interrupt)&n;&t; */
DECL|function|ami_get_fix_cursorinfo
r_static
r_int
id|ami_get_fix_cursorinfo
c_func
(paren
r_struct
id|fb_fix_cursorinfo
op_star
id|fix
comma
r_int
id|con
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|fix-&gt;crsr_width
op_assign
id|fix-&gt;crsr_xsize
op_assign
id|par-&gt;crsr.width
suffix:semicolon
id|fix-&gt;crsr_height
op_assign
id|fix-&gt;crsr_ysize
op_assign
id|par-&gt;crsr.height
suffix:semicolon
id|fix-&gt;crsr_color1
op_assign
l_int|17
suffix:semicolon
id|fix-&gt;crsr_color2
op_assign
l_int|18
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_get_var_cursorinfo
r_static
r_int
id|ami_get_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
r_register
id|u_short
op_star
id|lspr
comma
op_star
id|sspr
suffix:semicolon
macro_line|#ifdef __mc68000__
r_register
id|u_long
id|datawords
id|asm
(paren
l_string|&quot;d2&quot;
)paren
suffix:semicolon
macro_line|#else
r_register
id|u_long
id|datawords
suffix:semicolon
macro_line|#endif
r_register
r_int
id|delta
suffix:semicolon
r_register
id|u_char
id|color
suffix:semicolon
r_int
id|height
comma
id|width
comma
id|bits
comma
id|words
suffix:semicolon
r_int
id|i
comma
id|size
comma
id|alloc
suffix:semicolon
id|size
op_assign
id|par-&gt;crsr.height
op_star
id|par-&gt;crsr.width
suffix:semicolon
id|alloc
op_assign
id|var-&gt;height
op_star
id|var-&gt;width
suffix:semicolon
id|var-&gt;height
op_assign
id|par-&gt;crsr.height
suffix:semicolon
id|var-&gt;width
op_assign
id|par-&gt;crsr.width
suffix:semicolon
id|var-&gt;xspot
op_assign
id|par-&gt;crsr.spot_x
suffix:semicolon
id|var-&gt;yspot
op_assign
id|par-&gt;crsr.spot_y
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|var-&gt;height
op_star
id|var-&gt;width
)paren
r_return
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|data
comma
id|size
)paren
)paren
)paren
r_return
id|i
suffix:semicolon
id|delta
op_assign
l_int|1
op_lshift
id|par-&gt;crsr.fmode
suffix:semicolon
id|lspr
op_assign
id|lofsprite
op_plus
(paren
id|delta
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
id|sspr
op_assign
id|shfsprite
op_plus
(paren
id|delta
op_lshift
l_int|1
)paren
suffix:semicolon
r_else
id|sspr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|height
op_assign
(paren
r_int
)paren
id|var-&gt;height
op_minus
l_int|1
suffix:semicolon
id|height
op_ge
l_int|0
suffix:semicolon
id|height
op_decrement
)paren
(brace
id|bits
op_assign
l_int|0
suffix:semicolon
id|words
op_assign
id|delta
suffix:semicolon
id|datawords
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|width
op_assign
(paren
r_int
)paren
id|var-&gt;width
op_minus
l_int|1
suffix:semicolon
id|width
op_ge
l_int|0
suffix:semicolon
id|width
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|bits
op_eq
l_int|0
)paren
(brace
id|bits
op_assign
l_int|16
suffix:semicolon
op_decrement
id|words
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;movew %1@(%3:w:2),%0 ; swap %0 ; movew %1@+,%0&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|datawords
)paren
comma
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
suffix:colon
l_string|&quot;1&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
)paren
suffix:semicolon
macro_line|#else
id|datawords
op_assign
(paren
op_star
(paren
id|lspr
op_plus
id|delta
)paren
op_lshift
l_int|16
)paren
op_or
(paren
op_star
id|lspr
op_increment
)paren
suffix:semicolon
macro_line|#endif
)brace
op_decrement
id|bits
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;clrb %0 ; swap %1 ; lslw #1,%1 ; roxlb #1,%0 ; &quot;
l_string|&quot;swap %1 ; lslw #1,%1 ; roxlb #1,%0&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|color
)paren
comma
l_string|&quot;=d&quot;
(paren
id|datawords
)paren
suffix:colon
l_string|&quot;1&quot;
(paren
id|datawords
)paren
)paren
suffix:semicolon
macro_line|#else
id|color
op_assign
(paren
(paren
(paren
id|datawords
op_rshift
l_int|30
)paren
op_amp
l_int|2
)paren
op_or
(paren
(paren
id|datawords
op_rshift
l_int|15
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
id|datawords
op_lshift_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|put_user
c_func
(paren
id|color
comma
id|data
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bits
OG
l_int|0
)paren
(brace
op_decrement
id|words
suffix:semicolon
op_increment
id|lspr
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|words
op_ge
l_int|0
)paren
op_increment
id|lspr
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;lea %0@(%4:w:2),%0 ; tstl %1 ; jeq 1f ; exg %0,%1&bslash;n1:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;=a&quot;
(paren
id|sspr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;1&quot;
(paren
id|sspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
)paren
suffix:semicolon
macro_line|#else
id|lspr
op_add_assign
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|sspr
)paren
(brace
id|u_short
op_star
id|tmp
op_assign
id|lspr
suffix:semicolon
id|lspr
op_assign
id|sspr
suffix:semicolon
id|sspr
op_assign
id|tmp
suffix:semicolon
)brace
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_set_var_cursorinfo
r_static
r_int
id|ami_set_var_cursorinfo
c_func
(paren
r_struct
id|fb_var_cursorinfo
op_star
id|var
comma
id|u_char
op_star
id|data
comma
r_int
id|con
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
r_register
id|u_short
op_star
id|lspr
comma
op_star
id|sspr
suffix:semicolon
macro_line|#ifdef __mc68000__
r_register
id|u_long
id|datawords
id|asm
(paren
l_string|&quot;d2&quot;
)paren
suffix:semicolon
macro_line|#else
r_register
id|u_long
id|datawords
suffix:semicolon
macro_line|#endif
r_register
r_int
id|delta
suffix:semicolon
id|u_short
id|fmode
suffix:semicolon
r_int
id|height
comma
id|width
comma
id|bits
comma
id|words
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|var-&gt;width
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;width
op_le
l_int|16
)paren
id|fmode
op_assign
id|TAG_FMODE_1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;width
op_le
l_int|32
)paren
id|fmode
op_assign
id|TAG_FMODE_2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;width
op_le
l_int|64
)paren
id|fmode
op_assign
id|TAG_FMODE_4
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|fmode
OG
id|maxfmode
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|var-&gt;height
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|data
comma
id|var-&gt;width
op_star
id|var-&gt;height
)paren
)paren
)paren
r_return
id|i
suffix:semicolon
id|delta
op_assign
l_int|1
op_lshift
id|fmode
suffix:semicolon
id|lofsprite
op_assign
id|shfsprite
op_assign
(paren
id|u_short
op_star
)paren
id|spritememory
suffix:semicolon
id|lspr
op_assign
id|lofsprite
op_plus
(paren
id|delta
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;height
op_plus
l_int|4
)paren
op_lshift
id|fmode
op_lshift
l_int|2
)paren
OG
id|SPRITEMEMSIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|lspr
comma
l_int|0
comma
(paren
id|var-&gt;height
op_plus
l_int|4
)paren
op_lshift
id|fmode
op_lshift
l_int|2
)paren
suffix:semicolon
id|shfsprite
op_add_assign
(paren
(paren
id|var-&gt;height
op_plus
l_int|5
)paren
op_amp
op_minus
l_int|2
)paren
op_lshift
id|fmode
suffix:semicolon
id|sspr
op_assign
id|shfsprite
op_plus
(paren
id|delta
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;height
op_plus
l_int|2
)paren
op_lshift
id|fmode
op_lshift
l_int|2
)paren
OG
id|SPRITEMEMSIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|lspr
comma
l_int|0
comma
(paren
id|var-&gt;height
op_plus
l_int|2
)paren
op_lshift
id|fmode
op_lshift
l_int|2
)paren
suffix:semicolon
id|sspr
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|height
op_assign
(paren
r_int
)paren
id|var-&gt;height
op_minus
l_int|1
suffix:semicolon
id|height
op_ge
l_int|0
suffix:semicolon
id|height
op_decrement
)paren
(brace
id|bits
op_assign
l_int|16
suffix:semicolon
id|words
op_assign
id|delta
suffix:semicolon
id|datawords
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|width
op_assign
(paren
r_int
)paren
id|var-&gt;width
op_minus
l_int|1
suffix:semicolon
id|width
op_ge
l_int|0
suffix:semicolon
id|width
op_decrement
)paren
(brace
r_int
r_int
id|tdata
op_assign
l_int|0
suffix:semicolon
id|get_user
c_func
(paren
id|tdata
comma
(paren
r_char
op_star
)paren
id|data
)paren
suffix:semicolon
id|data
op_increment
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;lsrb #1,%2 ; roxlw #1,%0 ; swap %0 ; &quot;
l_string|&quot;lsrb #1,%2 ; roxlw #1,%0 ; swap %0&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|datawords
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|datawords
)paren
comma
l_string|&quot;d&quot;
(paren
id|tdata
)paren
)paren
suffix:semicolon
macro_line|#else
id|datawords
op_assign
(paren
(paren
id|datawords
op_lshift
l_int|1
)paren
op_amp
l_int|0xfffefffe
)paren
suffix:semicolon
id|datawords
op_or_assign
id|tdata
op_amp
l_int|1
suffix:semicolon
id|datawords
op_or_assign
(paren
id|tdata
op_amp
l_int|2
)paren
op_lshift
(paren
l_int|16
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_decrement
id|bits
op_eq
l_int|0
)paren
(brace
id|bits
op_assign
l_int|16
suffix:semicolon
op_decrement
id|words
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;swap %2 ; movew %2,%0@(%3:w:2) ; swap %2 ; movew %2,%0@+&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|datawords
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
)paren
suffix:semicolon
macro_line|#else
op_star
(paren
id|lspr
op_plus
id|delta
)paren
op_assign
(paren
id|u_short
)paren
(paren
id|datawords
op_rshift
l_int|16
)paren
suffix:semicolon
op_star
id|lspr
op_increment
op_assign
(paren
id|u_short
)paren
(paren
id|datawords
op_amp
l_int|0xffff
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
id|bits
OL
l_int|16
)paren
(brace
op_decrement
id|words
suffix:semicolon
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;swap %2 ; lslw %4,%2 ; movew %2,%0@(%3:w:2) ; &quot;
l_string|&quot;swap %2 ; lslw %4,%2 ; movew %2,%0@+&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|datawords
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
comma
l_string|&quot;d&quot;
(paren
id|bits
)paren
)paren
suffix:semicolon
macro_line|#else
op_star
(paren
id|lspr
op_plus
id|delta
)paren
op_assign
(paren
id|u_short
)paren
(paren
id|datawords
op_rshift
(paren
l_int|16
op_plus
id|bits
)paren
)paren
suffix:semicolon
op_star
id|lspr
op_increment
op_assign
(paren
id|u_short
)paren
(paren
(paren
id|datawords
op_amp
l_int|0x0000ffff
)paren
op_rshift
id|bits
)paren
suffix:semicolon
macro_line|#endif
)brace
r_while
c_loop
(paren
op_decrement
id|words
op_ge
l_int|0
)paren
(brace
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;moveql #0,%%d0 ; movew %%d0,%0@(%2:w:2) ; movew %%d0,%0@+&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
suffix:colon
l_string|&quot;d0&quot;
)paren
suffix:semicolon
macro_line|#else
op_star
(paren
id|lspr
op_plus
id|delta
)paren
op_assign
l_int|0
suffix:semicolon
op_star
id|lspr
op_increment
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef __mc68000__
id|asm
r_volatile
(paren
l_string|&quot;lea %0@(%4:w:2),%0 ; tstl %1 ; jeq 1f ; exg %0,%1&bslash;n1:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;=a&quot;
(paren
id|sspr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|lspr
)paren
comma
l_string|&quot;1&quot;
(paren
id|sspr
)paren
comma
l_string|&quot;d&quot;
(paren
id|delta
)paren
)paren
suffix:semicolon
macro_line|#else
id|lspr
op_add_assign
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|sspr
)paren
(brace
id|u_short
op_star
id|tmp
op_assign
id|lspr
suffix:semicolon
id|lspr
op_assign
id|sspr
suffix:semicolon
id|sspr
op_assign
id|tmp
suffix:semicolon
)brace
macro_line|#endif
)brace
id|par-&gt;crsr.height
op_assign
id|var-&gt;height
suffix:semicolon
id|par-&gt;crsr.width
op_assign
id|var-&gt;width
suffix:semicolon
id|par-&gt;crsr.spot_x
op_assign
id|var-&gt;xspot
suffix:semicolon
id|par-&gt;crsr.spot_y
op_assign
id|var-&gt;yspot
suffix:semicolon
id|par-&gt;crsr.fmode
op_assign
id|fmode
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
)paren
(brace
id|par-&gt;fmode
op_and_assign
op_complement
(paren
id|FMODE_SPAGEM
op_or
id|FMODE_SPR32
)paren
suffix:semicolon
id|par-&gt;fmode
op_or_assign
id|sprfetchmode
(braket
id|fmode
)braket
suffix:semicolon
id|custom.fmode
op_assign
id|par-&gt;fmode
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_get_cursorstate
r_static
r_int
id|ami_get_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|state-&gt;xoffset
op_assign
id|par-&gt;crsr.crsr_x
suffix:semicolon
id|state-&gt;yoffset
op_assign
id|par-&gt;crsr.crsr_y
suffix:semicolon
id|state-&gt;mode
op_assign
id|cursormode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_set_cursorstate
r_static
r_int
id|ami_set_cursorstate
c_func
(paren
r_struct
id|fb_cursorstate
op_star
id|state
comma
r_int
id|con
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|par-&gt;crsr.crsr_x
op_assign
id|state-&gt;xoffset
suffix:semicolon
id|par-&gt;crsr.crsr_y
op_assign
id|state-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cursormode
op_assign
id|state-&gt;mode
)paren
op_eq
id|FB_CURSOR_OFF
)paren
id|cursorstate
op_assign
op_minus
l_int|1
suffix:semicolon
id|do_cursor
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ami_set_sprite
r_static
r_void
id|ami_set_sprite
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|copins
op_star
id|copl
comma
op_star
id|cops
suffix:semicolon
id|u_short
id|hs
comma
id|vs
comma
id|ve
suffix:semicolon
id|u_long
id|pl
comma
id|ps
comma
id|pt
suffix:semicolon
r_int
id|mx
comma
id|my
suffix:semicolon
id|cops
op_assign
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|0
)braket
suffix:semicolon
id|copl
op_assign
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
suffix:semicolon
id|ps
op_assign
id|pl
op_assign
id|ZTWO_PADDR
c_func
(paren
id|dummysprite
)paren
suffix:semicolon
id|mx
op_assign
id|par-&gt;crsr.crsr_x
op_minus
id|par-&gt;crsr.spot_x
suffix:semicolon
id|my
op_assign
id|par-&gt;crsr.crsr_y
op_minus
id|par-&gt;crsr.spot_y
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
)paren
(brace
id|mx
op_sub_assign
id|par-&gt;xoffset
suffix:semicolon
id|my
op_sub_assign
id|par-&gt;yoffset
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|is_blanked
op_logical_and
id|cursorstate
OG
l_int|0
op_logical_and
id|par-&gt;crsr.height
OG
l_int|0
op_logical_and
id|mx
OG
op_minus
(paren
r_int
)paren
id|par-&gt;crsr.width
op_logical_and
id|mx
template_param
op_minus
(paren
r_int
)paren
id|par-&gt;crsr.height
op_logical_and
id|my
OL
id|par-&gt;yres
)paren
(brace
id|pl
op_assign
id|ZTWO_PADDR
c_func
(paren
id|lofsprite
)paren
suffix:semicolon
id|hs
op_assign
id|par-&gt;diwstrt_h
op_plus
(paren
id|mx
op_lshift
id|par-&gt;clk_shift
)paren
op_minus
l_int|4
suffix:semicolon
id|vs
op_assign
id|par-&gt;diwstrt_v
op_plus
(paren
id|my
op_lshift
id|par-&gt;line_shift
)paren
suffix:semicolon
id|ve
op_assign
id|vs
op_plus
(paren
id|par-&gt;crsr.height
op_lshift
id|par-&gt;line_shift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
(brace
id|ps
op_assign
id|ZTWO_PADDR
c_func
(paren
id|shfsprite
)paren
suffix:semicolon
id|lofsprite
(braket
l_int|0
)braket
op_assign
id|spr2hw_pos
c_func
(paren
id|vs
comma
id|hs
)paren
suffix:semicolon
id|shfsprite
(braket
l_int|0
)braket
op_assign
id|spr2hw_pos
c_func
(paren
id|vs
op_plus
l_int|1
comma
id|hs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mod2
c_func
(paren
id|vs
)paren
)paren
(brace
id|lofsprite
(braket
l_int|1
op_lshift
id|par-&gt;crsr.fmode
)braket
op_assign
id|spr2hw_ctl
c_func
(paren
id|vs
comma
id|hs
comma
id|ve
)paren
suffix:semicolon
id|shfsprite
(braket
l_int|1
op_lshift
id|par-&gt;crsr.fmode
)braket
op_assign
id|spr2hw_ctl
c_func
(paren
id|vs
op_plus
l_int|1
comma
id|hs
comma
id|ve
op_plus
l_int|1
)paren
suffix:semicolon
id|pt
op_assign
id|pl
suffix:semicolon
id|pl
op_assign
id|ps
suffix:semicolon
id|ps
op_assign
id|pt
suffix:semicolon
)brace
r_else
(brace
id|lofsprite
(braket
l_int|1
op_lshift
id|par-&gt;crsr.fmode
)braket
op_assign
id|spr2hw_ctl
c_func
(paren
id|vs
comma
id|hs
comma
id|ve
op_plus
l_int|1
)paren
suffix:semicolon
id|shfsprite
(braket
l_int|1
op_lshift
id|par-&gt;crsr.fmode
)braket
op_assign
id|spr2hw_ctl
c_func
(paren
id|vs
op_plus
l_int|1
comma
id|hs
comma
id|ve
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|lofsprite
(braket
l_int|0
)braket
op_assign
id|spr2hw_pos
c_func
(paren
id|vs
comma
id|hs
)paren
op_or
(paren
id|IS_AGA
op_logical_and
(paren
id|par-&gt;fmode
op_amp
id|FMODE_BSCAN2
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
)paren
suffix:semicolon
id|lofsprite
(braket
l_int|1
op_lshift
id|par-&gt;crsr.fmode
)braket
op_assign
id|spr2hw_ctl
c_func
(paren
id|vs
comma
id|hs
comma
id|ve
)paren
suffix:semicolon
)brace
)brace
id|copl
(braket
id|cop_spr0ptrh
)braket
dot
id|w
(braket
l_int|1
)braket
op_assign
id|highw
c_func
(paren
id|pl
)paren
suffix:semicolon
id|copl
(braket
id|cop_spr0ptrl
)braket
dot
id|w
(braket
l_int|1
)braket
op_assign
id|loww
c_func
(paren
id|pl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
(brace
id|cops
(braket
id|cop_spr0ptrh
)braket
dot
id|w
(braket
l_int|1
)braket
op_assign
id|highw
c_func
(paren
id|ps
)paren
suffix:semicolon
id|cops
(braket
id|cop_spr0ptrl
)braket
dot
id|w
(braket
l_int|1
)braket
op_assign
id|loww
c_func
(paren
id|ps
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Initialise the Copper Initialisation List&n;&t; */
DECL|function|ami_init_copper
r_static
r_void
id|__init
id|ami_init_copper
c_func
(paren
r_void
)paren
(brace
id|copins
op_star
id|cop
op_assign
id|copdisplay.init
suffix:semicolon
id|u_long
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|BPC0_COLOR
op_or
id|BPC0_SHRES
op_or
id|BPC0_ECSENA
comma
id|bplcon0
)paren
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0x0181
comma
id|diwstrt
)paren
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0x0281
comma
id|diwstop
)paren
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0x0000
comma
id|diwhigh
)paren
suffix:semicolon
)brace
r_else
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|BPC0_COLOR
comma
id|bplcon0
)paren
suffix:semicolon
id|p
op_assign
id|ZTWO_PADDR
c_func
(paren
id|dummysprite
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0
comma
id|spr
(braket
id|i
)braket
dot
id|pos
)paren
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|sprpt
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|sprpt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|IF_SETCLR
op_or
id|IF_COPER
comma
id|intreq
)paren
suffix:semicolon
id|copdisplay.wait
op_assign
id|cop
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CEND
suffix:semicolon
(paren
id|cop
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0
comma
id|copjmp2
)paren
suffix:semicolon
id|cop-&gt;l
op_assign
id|CEND
suffix:semicolon
id|custom.cop1lc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.init
)paren
suffix:semicolon
id|custom.copjmp1
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ami_reinit_copper
r_static
r_void
id|ami_reinit_copper
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|copdisplay.init
(braket
id|cip_bplcon0
)braket
dot
id|w
(braket
l_int|1
)braket
op_assign
op_complement
(paren
id|BPC0_BPU3
op_or
id|BPC0_BPU2
op_or
id|BPC0_BPU1
op_or
id|BPC0_BPU0
)paren
op_amp
id|par-&gt;bplcon0
suffix:semicolon
id|copdisplay.wait-&gt;l
op_assign
id|CWAIT
c_func
(paren
l_int|32
comma
id|par-&gt;diwstrt_v
op_minus
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Build the Copper List&n;&t; */
DECL|function|ami_build_copper
r_static
r_void
id|ami_build_copper
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|copins
op_star
id|copl
comma
op_star
id|cops
suffix:semicolon
id|u_long
id|p
suffix:semicolon
id|currentcop
op_assign
l_int|1
op_minus
id|currentcop
suffix:semicolon
id|copl
op_assign
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
l_int|0
comma
l_int|10
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|par-&gt;bplcon0
comma
id|bplcon0
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0
comma
id|sprpt
(braket
l_int|0
)braket
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
l_int|0
comma
id|sprpt
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
(brace
id|cops
op_assign
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|0
)braket
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
l_int|0
comma
l_int|10
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|par-&gt;bplcon0
comma
id|bplcon0
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
l_int|0
comma
id|sprpt
(braket
l_int|0
)braket
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
l_int|0
comma
id|sprpt
(braket
l_int|0
)braket
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstrt2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
op_plus
l_int|1
)paren
comma
id|diwstrt
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstop2hw
c_func
(paren
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
op_plus
l_int|1
)paren
comma
id|diwstop
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstrt2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
)paren
comma
id|diwstrt
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstop2hw
c_func
(paren
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
)paren
comma
id|diwstop
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwhigh2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
op_plus
l_int|1
comma
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
op_plus
l_int|1
)paren
comma
id|diwhigh
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwhigh2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
comma
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
)paren
comma
id|diwhigh
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_VARBEAMEN
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vtotal2hw
c_func
(paren
id|par-&gt;vtotal
)paren
comma
id|vtotal
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstrt2hw
c_func
(paren
id|par-&gt;vbstrt
op_plus
l_int|1
)paren
comma
id|vbstrt
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstop2hw
c_func
(paren
id|par-&gt;vbstop
op_plus
l_int|1
)paren
comma
id|vbstop
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vtotal2hw
c_func
(paren
id|par-&gt;vtotal
)paren
comma
id|vtotal
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstrt2hw
c_func
(paren
id|par-&gt;vbstrt
)paren
comma
id|vbstrt
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstop2hw
c_func
(paren
id|par-&gt;vbstop
)paren
comma
id|vbstop
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
id|p
op_assign
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|cop2lc
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|cop2lc
)paren
suffix:semicolon
id|p
op_assign
id|ZTWO_PADDR
c_func
(paren
id|copdisplay.list
(braket
id|currentcop
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|cop2lc
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|cop2lc
)paren
suffix:semicolon
id|copdisplay.rebuild
(braket
l_int|0
)braket
op_assign
id|cops
suffix:semicolon
)brace
r_else
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstrt2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
)paren
comma
id|diwstrt
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwstop2hw
c_func
(paren
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
)paren
comma
id|diwstop
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_OCS
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|diwhigh2hw
c_func
(paren
id|par-&gt;diwstrt_h
comma
id|par-&gt;diwstrt_v
comma
id|par-&gt;diwstop_h
comma
id|par-&gt;diwstop_v
)paren
comma
id|diwhigh
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|par-&gt;beamcon0
op_amp
id|BMC0_VARBEAMEN
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vtotal2hw
c_func
(paren
id|par-&gt;vtotal
)paren
comma
id|vtotal
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstrt2hw
c_func
(paren
id|par-&gt;vbstrt
)paren
comma
id|vbstrt
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|vbstop2hw
c_func
(paren
id|par-&gt;vbstop
)paren
comma
id|vbstop
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
id|copdisplay.rebuild
(braket
l_int|1
)braket
op_assign
id|copl
suffix:semicolon
id|ami_update_par
c_func
(paren
)paren
suffix:semicolon
id|ami_rebuild_copper
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Rebuild the Copper List&n;&t; *&n;&t; * We only change the things that are not static&n;&t; */
DECL|function|ami_rebuild_copper
r_static
r_void
id|ami_rebuild_copper
c_func
(paren
r_void
)paren
(brace
r_struct
id|amifb_par
op_star
id|par
op_assign
op_amp
id|currentpar
suffix:semicolon
id|copins
op_star
id|copl
comma
op_star
id|cops
suffix:semicolon
id|u_short
id|line
comma
id|h_end1
comma
id|h_end2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u_long
id|p
suffix:semicolon
r_if
c_cond
(paren
id|IS_AGA
op_logical_and
id|maxfmode
op_plus
id|par-&gt;clk_shift
op_eq
l_int|0
)paren
id|h_end1
op_assign
id|par-&gt;diwstrt_h
op_minus
l_int|64
suffix:semicolon
r_else
id|h_end1
op_assign
id|par-&gt;htotal
op_minus
l_int|32
suffix:semicolon
id|h_end2
op_assign
id|par-&gt;ddfstop
op_plus
l_int|64
suffix:semicolon
id|ami_set_sprite
c_func
(paren
)paren
suffix:semicolon
id|copl
op_assign
id|copdisplay.rebuild
(braket
l_int|1
)braket
suffix:semicolon
id|p
op_assign
id|par-&gt;bplpt0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
(paren
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
op_ne
l_int|1
op_logical_or
op_logical_neg
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
)paren
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;yoffset
OG
id|par-&gt;vyres
op_minus
id|par-&gt;yres
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|par-&gt;bpp
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|par-&gt;next_plane
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|line
op_assign
id|par-&gt;diwstrt_v
op_plus
(paren
(paren
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
op_lshift
id|par-&gt;line_shift
)paren
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|line
op_ge
l_int|512
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end1
comma
l_int|510
)paren
suffix:semicolon
id|line
op_sub_assign
l_int|512
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line
op_ge
l_int|510
op_logical_and
id|IS_AGA
op_logical_and
id|maxfmode
op_plus
id|par-&gt;clk_shift
op_eq
l_int|0
)paren
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end1
comma
id|line
)paren
suffix:semicolon
r_else
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end2
comma
id|line
)paren
suffix:semicolon
id|p
op_assign
id|par-&gt;bplpt0wrap
suffix:semicolon
)brace
)brace
r_else
id|p
op_assign
id|par-&gt;bplpt0wrap
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|par-&gt;bpp
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|par-&gt;next_plane
)paren
(brace
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
id|copl
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|copl-&gt;l
op_assign
id|CEND
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;bplcon0
op_amp
id|BPC0_LACE
)paren
(brace
id|cops
op_assign
id|copdisplay.rebuild
(braket
l_int|0
)braket
suffix:semicolon
id|p
op_assign
id|par-&gt;bplpt0
suffix:semicolon
r_if
c_cond
(paren
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
)paren
)paren
id|p
op_sub_assign
id|par-&gt;next_line
suffix:semicolon
r_else
id|p
op_add_assign
id|par-&gt;next_line
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
(paren
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
op_ne
l_int|1
op_logical_or
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
)paren
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;yoffset
OG
id|par-&gt;vyres
op_minus
id|par-&gt;yres
op_plus
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|par-&gt;bpp
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|par-&gt;next_plane
)paren
(brace
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|line
op_assign
id|par-&gt;diwstrt_v
op_plus
(paren
(paren
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
op_lshift
id|par-&gt;line_shift
)paren
op_minus
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|line
op_ge
l_int|512
)paren
(brace
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end1
comma
l_int|510
)paren
suffix:semicolon
id|line
op_sub_assign
l_int|512
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line
OG
l_int|510
op_logical_and
id|IS_AGA
op_logical_and
id|maxfmode
op_plus
id|par-&gt;clk_shift
op_eq
l_int|0
)paren
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end1
comma
id|line
)paren
suffix:semicolon
r_else
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CWAIT
c_func
(paren
id|h_end2
comma
id|line
)paren
suffix:semicolon
id|p
op_assign
id|par-&gt;bplpt0wrap
suffix:semicolon
r_if
c_cond
(paren
id|mod2
c_func
(paren
id|par-&gt;diwstrt_v
op_plus
id|par-&gt;vyres
op_minus
id|par-&gt;yoffset
)paren
)paren
id|p
op_sub_assign
id|par-&gt;next_line
suffix:semicolon
r_else
id|p
op_add_assign
id|par-&gt;next_line
suffix:semicolon
)brace
)brace
r_else
id|p
op_assign
id|par-&gt;bplpt0wrap
op_minus
id|par-&gt;next_line
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|par-&gt;bpp
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|par-&gt;next_plane
)paren
(brace
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE
c_func
(paren
id|highw
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
id|cops
op_increment
)paren
op_member_access_from_pointer
id|l
op_assign
id|CMOVE2
c_func
(paren
id|loww
c_func
(paren
id|p
)paren
comma
id|bplpt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|cops-&gt;l
op_assign
id|CEND
suffix:semicolon
)brace
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|amifb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
suffix:semicolon
id|amifb_deinit
c_func
(paren
)paren
suffix:semicolon
id|amifb_video_off
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
