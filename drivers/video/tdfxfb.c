multiline_comment|/*&n; *&n; * tdfxfb.c&n; *&n; * Author: Hannu Mallat &lt;hmallat@cc.hut.fi&gt;&n; *&n; * Copyright &#xfffd; 1999 Hannu Mallat&n; * All rights reserved&n; *&n; * Created      : Thu Sep 23 18:17:43 1999, hmallat&n; * Last modified: Thu Oct  7 18:39:04 1999, hmallat&n; *&n; * Lots of the information here comes from the Daryll Strauss&squot; Banshee &n; * patches to the XF86 server, and the rest comes from the 3dfx&n; * Banshee specification. I&squot;m very much indebted to Daryll for his&n; * work on the X server.&n; *&n; * Voodoo3 support was contributed Harold Oga. Thanks!&n; *&n; * While I _am_ grateful to 3Dfx for releasing the specs for Banshee,&n; * I do wish the next version is a bit more complete. Without the XF86&n; * patches I couldn&squot;t have gotten even this far... for instance, the&n; * extensions to the VGA register set go completely unmentioned in the&n; * spec! Also, lots of references are made to the &squot;SST core&squot;, but no&n; * spec is publicly available, AFAIK.&n; *&n; * The structure of this driver comes pretty much from the Permedia&n; * driver by Ilario Nardinocchi, which in turn is based on skeletonfb.&n; * &n; * TODO:&n; * - support for 16/32 bpp needs fixing (funky bootup penguin)&n; * - multihead support (it&squot;s all hosed now with pokes to VGA standard&n; *   register locations, but shouldn&squot;t be that hard to change, some&n; *   other code needs to be changed too where the fb_info (which should&n; *   be an array of head-specific information) is referred to directly.&n; *   are referred to )&n; * - hw cursor&n; * - better acceleration support (e.g., font blitting from fb memory?)&n; * - banshee and voodoo3 now supported -- any others? afaik, the original&n; *   voodoo was a 3d-only card, so we won&squot;t consider that. what about&n; *   voodoo2?&n; * - 24bpp &n; * - panning (doesn&squot;t seem to work properly yet)&n; *&n; * Version history:&n; *&n; * 0.1.1 (released 1999-10-07) added Voodoo3 support by Harold Oga.&n; * 0.1.0 (released 1999-10-06) initial version&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/nvram.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#ifndef LINUX_VERSION_CODE
macro_line|#include &lt;linux/version.h&gt;
macro_line|#endif
macro_line|#ifndef KERNEL_VERSION
DECL|macro|KERNEL_VERSION
mdefine_line|#define KERNEL_VERSION(x,y,z) (((x)&lt;&lt;16)+((y)&lt;&lt;8)+(z))
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
DECL|macro|PCI_DEVICE_ID_3DFX_VOODOO3
mdefine_line|#define PCI_DEVICE_ID_3DFX_VOODOO3      0x0005
macro_line|#endif
multiline_comment|/* membase0 register offsets */
DECL|macro|STATUS
mdefine_line|#define STATUS&t;&t;0x00
DECL|macro|PCIINIT0
mdefine_line|#define PCIINIT0&t;0x04
DECL|macro|SIPMONITOR
mdefine_line|#define SIPMONITOR&t;0x08
DECL|macro|LFBMEMORYCONFIG
mdefine_line|#define LFBMEMORYCONFIG&t;0x0c
DECL|macro|MISCINIT0
mdefine_line|#define MISCINIT0&t;0x10
DECL|macro|MISCINIT1
mdefine_line|#define MISCINIT1&t;0x14
DECL|macro|DRAMINIT0
mdefine_line|#define DRAMINIT0&t;0x18
DECL|macro|DRAMINIT1
mdefine_line|#define DRAMINIT1&t;0x1c
DECL|macro|AGPINIT
mdefine_line|#define AGPINIT&t;&t;0x20
DECL|macro|TMUGBEINIT
mdefine_line|#define TMUGBEINIT&t;0x24
DECL|macro|VGAINIT0
mdefine_line|#define VGAINIT0&t;0x28
DECL|macro|VGAINIT1
mdefine_line|#define VGAINIT1&t;0x2c
DECL|macro|DRAMCOMMAND
mdefine_line|#define DRAMCOMMAND&t;0x30
DECL|macro|DRAMDATA
mdefine_line|#define DRAMDATA&t;0x34
multiline_comment|/* reserved             0x38 */
multiline_comment|/* reserved             0x3c */
DECL|macro|PLLCTRL0
mdefine_line|#define PLLCTRL0&t;0x40
DECL|macro|PLLCTRL1
mdefine_line|#define PLLCTRL1&t;0x44
DECL|macro|PLLCTRL2
mdefine_line|#define PLLCTRL2&t;0x48
DECL|macro|DACMODE
mdefine_line|#define DACMODE&t;&t;0x4c
DECL|macro|DACADDR
mdefine_line|#define DACADDR&t;&t;0x50
DECL|macro|DACDATA
mdefine_line|#define DACDATA&t;&t;0x54
DECL|macro|RGBMAXDELTA
mdefine_line|#define RGBMAXDELTA&t;0x58
DECL|macro|VIDPROCCFG
mdefine_line|#define VIDPROCCFG&t;0x5c
DECL|macro|HWCURPATADDR
mdefine_line|#define HWCURPATADDR&t;0x60
DECL|macro|HWCURLOC
mdefine_line|#define HWCURLOC&t;0x64
DECL|macro|HWCURC0
mdefine_line|#define HWCURC0&t;&t;0x68
DECL|macro|HWCURC1
mdefine_line|#define HWCURC1&t;&t;0x6c
DECL|macro|VIDINFORMAT
mdefine_line|#define VIDINFORMAT&t;0x70
DECL|macro|VIDINSTATUS
mdefine_line|#define VIDINSTATUS&t;0x74
DECL|macro|VIDSERPARPORT
mdefine_line|#define VIDSERPARPORT&t;0x78
DECL|macro|VIDINXDELTA
mdefine_line|#define VIDINXDELTA&t;0x7c
DECL|macro|VIDININITERR
mdefine_line|#define VIDININITERR&t;0x80
DECL|macro|VIDINYDELTA
mdefine_line|#define VIDINYDELTA&t;0x84
DECL|macro|VIDPIXBUFTHOLD
mdefine_line|#define VIDPIXBUFTHOLD&t;0x88
DECL|macro|VIDCHRMIN
mdefine_line|#define VIDCHRMIN&t;0x8c
DECL|macro|VIDCHRMAX
mdefine_line|#define VIDCHRMAX&t;0x90
DECL|macro|VIDCURLIN
mdefine_line|#define VIDCURLIN&t;0x94
DECL|macro|VIDSCREENSIZE
mdefine_line|#define VIDSCREENSIZE&t;0x98
DECL|macro|VIDOVRSTARTCRD
mdefine_line|#define VIDOVRSTARTCRD&t;0x9c
DECL|macro|VIDOVRENDCRD
mdefine_line|#define VIDOVRENDCRD&t;0xa0
DECL|macro|VIDOVRDUDX
mdefine_line|#define VIDOVRDUDX&t;0xa4
DECL|macro|VIDOVRDUDXOFF
mdefine_line|#define VIDOVRDUDXOFF&t;0xa8
DECL|macro|VIDOVRDVDY
mdefine_line|#define VIDOVRDVDY&t;0xac
multiline_comment|/*  ... */
DECL|macro|VIDOVRDVDYOFF
mdefine_line|#define VIDOVRDVDYOFF&t;0xe0
DECL|macro|VIDDESKSTART
mdefine_line|#define VIDDESKSTART&t;0xe4
DECL|macro|VIDDESKSTRIDE
mdefine_line|#define VIDDESKSTRIDE&t;0xe8
DECL|macro|VIDINADDR0
mdefine_line|#define VIDINADDR0&t;0xec
DECL|macro|VIDINADDR1
mdefine_line|#define VIDINADDR1&t;0xf0
DECL|macro|VIDINADDR2
mdefine_line|#define VIDINADDR2&t;0xf4
DECL|macro|VIDINSTRIDE
mdefine_line|#define VIDINSTRIDE&t;0xf8
DECL|macro|VIDCUROVRSTART
mdefine_line|#define VIDCUROVRSTART&t;0xfc
DECL|macro|INTCTRL
mdefine_line|#define INTCTRL&t;&t;(0x00100000 + 0x04)
DECL|macro|CLIP0MIN
mdefine_line|#define CLIP0MIN&t;(0x00100000 + 0x08)
DECL|macro|CLIP0MAX
mdefine_line|#define CLIP0MAX&t;(0x00100000 + 0x0c)
DECL|macro|DSTBASE
mdefine_line|#define DSTBASE&t;&t;(0x00100000 + 0x10)
DECL|macro|DSTFORMAT
mdefine_line|#define DSTFORMAT&t;(0x00100000 + 0x14)
DECL|macro|SRCBASE
mdefine_line|#define SRCBASE&t;&t;(0x00100000 + 0x34)
DECL|macro|COMMANDEXTRA_2D
mdefine_line|#define COMMANDEXTRA_2D&t;(0x00100000 + 0x38)
DECL|macro|CLIP1MIN
mdefine_line|#define CLIP1MIN&t;(0x00100000 + 0x4c)
DECL|macro|CLIP1MAX
mdefine_line|#define CLIP1MAX&t;(0x00100000 + 0x50)
DECL|macro|SRCFORMAT
mdefine_line|#define SRCFORMAT&t;(0x00100000 + 0x54)
DECL|macro|SRCSIZE
mdefine_line|#define SRCSIZE&t;&t;(0x00100000 + 0x58)
DECL|macro|SRCXY
mdefine_line|#define SRCXY&t;&t;(0x00100000 + 0x5c)
DECL|macro|COLORBACK
mdefine_line|#define COLORBACK&t;(0x00100000 + 0x60)
DECL|macro|COLORFORE
mdefine_line|#define COLORFORE&t;(0x00100000 + 0x64)
DECL|macro|DSTSIZE
mdefine_line|#define DSTSIZE&t;&t;(0x00100000 + 0x68)
DECL|macro|DSTXY
mdefine_line|#define DSTXY&t;&t;(0x00100000 + 0x6c)
DECL|macro|COMMAND_2D
mdefine_line|#define COMMAND_2D&t;(0x00100000 + 0x70)
DECL|macro|LAUNCH_2D
mdefine_line|#define LAUNCH_2D&t;(0x00100000 + 0x80)
DECL|macro|COMMAND_3D
mdefine_line|#define COMMAND_3D&t;(0x00200000 + 0x120)
multiline_comment|/* register bitfields (not all, only as needed) */
DECL|macro|BIT
mdefine_line|#define BIT(x) (1UL &lt;&lt; (x))
DECL|macro|ROP_COPY
mdefine_line|#define ROP_COPY&t;0xcc
DECL|macro|COMMAND_2D_FILLRECT
mdefine_line|#define COMMAND_2D_FILLRECT&t;&t;0x05
DECL|macro|COMMAND_2D_BITBLT
mdefine_line|#define COMMAND_2D_BITBLT&t;&t;0x01
DECL|macro|COMMAND_3D_NOP
mdefine_line|#define COMMAND_3D_NOP&t;&t;&t;0x00
DECL|macro|STATUS_RETRACE
mdefine_line|#define STATUS_RETRACE&t;&t;&t;BIT(6)
DECL|macro|STATUS_BUSY
mdefine_line|#define STATUS_BUSY&t;&t;&t;BIT(9)
DECL|macro|MISCINIT1_CLUT_INV
mdefine_line|#define MISCINIT1_CLUT_INV&t;&t;BIT(0)
DECL|macro|MISCINIT1_2DBLOCK_DIS
mdefine_line|#define MISCINIT1_2DBLOCK_DIS&t;&t;BIT(15)
DECL|macro|DRAMINIT0_SGRAM_NUM
mdefine_line|#define DRAMINIT0_SGRAM_NUM&t;&t;BIT(26)
DECL|macro|DRAMINIT0_SGRAM_TYPE
mdefine_line|#define DRAMINIT0_SGRAM_TYPE&t;&t;BIT(27)
DECL|macro|DRAMINIT1_MEM_SDRAM
mdefine_line|#define DRAMINIT1_MEM_SDRAM&t;&t;BIT(30)
DECL|macro|VGAINIT0_VGA_DISABLE
mdefine_line|#define VGAINIT0_VGA_DISABLE&t;&t;BIT(0)
DECL|macro|VGAINIT0_EXT_TIMING
mdefine_line|#define VGAINIT0_EXT_TIMING&t;&t;BIT(1)
DECL|macro|VGAINIT0_8BIT_DAC
mdefine_line|#define VGAINIT0_8BIT_DAC&t;&t;BIT(2)
DECL|macro|VGAINIT0_EXT_ENABLE
mdefine_line|#define VGAINIT0_EXT_ENABLE&t;&t;BIT(6)
DECL|macro|VGAINIT0_WAKEUP_3C3
mdefine_line|#define VGAINIT0_WAKEUP_3C3&t;&t;BIT(8)
DECL|macro|VGAINIT0_LEGACY_DISABLE
mdefine_line|#define VGAINIT0_LEGACY_DISABLE&t;&t;BIT(9)
DECL|macro|VGAINIT0_ALT_READBACK
mdefine_line|#define VGAINIT0_ALT_READBACK&t;&t;BIT(10)
DECL|macro|VGAINIT0_FAST_BLINK
mdefine_line|#define VGAINIT0_FAST_BLINK&t;&t;BIT(11)
DECL|macro|VGAINIT0_EXTSHIFTOUT
mdefine_line|#define VGAINIT0_EXTSHIFTOUT&t;&t;BIT(12)
DECL|macro|VGAINIT0_DECODE_3C6
mdefine_line|#define VGAINIT0_DECODE_3C6&t;&t;BIT(13)
DECL|macro|VGAINIT0_SGRAM_HBLANK_DISABLE
mdefine_line|#define VGAINIT0_SGRAM_HBLANK_DISABLE&t;BIT(22)
DECL|macro|VGAINIT1_MASK
mdefine_line|#define VGAINIT1_MASK&t;&t;&t;0x1fffff
DECL|macro|VIDCFG_VIDPROC_ENABLE
mdefine_line|#define VIDCFG_VIDPROC_ENABLE&t;&t;BIT(0)
DECL|macro|VIDCFG_CURS_X11
mdefine_line|#define VIDCFG_CURS_X11&t;&t;&t;BIT(1)
DECL|macro|VIDCFG_HALF_MODE
mdefine_line|#define VIDCFG_HALF_MODE&t;&t;BIT(4)
DECL|macro|VIDCFG_DESK_ENABLE
mdefine_line|#define VIDCFG_DESK_ENABLE&t;&t;BIT(7)
DECL|macro|VIDCFG_CLUT_BYPASS
mdefine_line|#define VIDCFG_CLUT_BYPASS&t;&t;BIT(10)
DECL|macro|VIDCFG_2X
mdefine_line|#define VIDCFG_2X&t;&t;&t;BIT(26)
DECL|macro|VIDCFG_PIXFMT_SHIFT
mdefine_line|#define VIDCFG_PIXFMT_SHIFT&t;&t;18
DECL|macro|DACMODE_2X
mdefine_line|#define DACMODE_2X&t;&t;&t;BIT(0)
multiline_comment|/* VGA rubbish, need to change this for multihead support */
DECL|macro|MISC_W
mdefine_line|#define MISC_W &t;0x3c2
DECL|macro|MISC_R
mdefine_line|#define MISC_R &t;0x3cc
DECL|macro|SEQ_I
mdefine_line|#define SEQ_I &t;0x3c4
DECL|macro|SEQ_D
mdefine_line|#define SEQ_D&t;0x3c5
DECL|macro|CRT_I
mdefine_line|#define CRT_I&t;0x3d4
DECL|macro|CRT_D
mdefine_line|#define CRT_D&t;0x3d5
DECL|macro|ATT_IW
mdefine_line|#define ATT_IW&t;0x3c0
DECL|macro|IS1_R
mdefine_line|#define IS1_R&t;0x3da
DECL|macro|GRA_I
mdefine_line|#define GRA_I&t;0x3ce
DECL|macro|GRA_D
mdefine_line|#define GRA_D&t;0x3cf
DECL|macro|DAC_IR
mdefine_line|#define DAC_IR&t;0x3c7
DECL|macro|DAC_IW
mdefine_line|#define DAC_IW&t;0x3c8
DECL|macro|DAC_D
mdefine_line|#define DAC_D&t;0x3c9
macro_line|#ifndef FB_ACCEL_3DFX_BANSHEE 
DECL|macro|FB_ACCEL_3DFX_BANSHEE
mdefine_line|#define FB_ACCEL_3DFX_BANSHEE 31
macro_line|#endif
DECL|macro|TDFXF_HSYNC_ACT_HIGH
mdefine_line|#define TDFXF_HSYNC_ACT_HIGH&t;0x01
DECL|macro|TDFXF_HSYNC_ACT_LOW
mdefine_line|#define TDFXF_HSYNC_ACT_LOW&t;0x02
DECL|macro|TDFXF_VSYNC_ACT_HIGH
mdefine_line|#define TDFXF_VSYNC_ACT_HIGH&t;0x04
DECL|macro|TDFXF_VSYNC_ACT_LOW
mdefine_line|#define TDFXF_VSYNC_ACT_LOW&t;0x08
DECL|macro|TDFXF_LINE_DOUBLE
mdefine_line|#define TDFXF_LINE_DOUBLE&t;0x10
DECL|macro|TDFXF_VIDEO_ENABLE
mdefine_line|#define TDFXF_VIDEO_ENABLE&t;0x20
DECL|macro|TDFXF_HSYNC_MASK
mdefine_line|#define TDFXF_HSYNC_MASK&t;0x03
DECL|macro|TDFXF_VSYNC_MASK
mdefine_line|#define TDFXF_VSYNC_MASK&t;0x0c
multiline_comment|/* #define TDFXFB_DEBUG */
macro_line|#ifdef TDFXFB_DEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(a,b...) printk(&quot;fb: %s: &quot; a, __FUNCTION__ , ## b)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(a,b...)
macro_line|#endif 
DECL|macro|PICOS2KHZ
mdefine_line|#define PICOS2KHZ(a) (1000000000UL/(a))
DECL|macro|KHZ2PICOS
mdefine_line|#define KHZ2PICOS(a) (1000000000UL/(a))
DECL|macro|BANSHEE_MAX_PIXCLOCK
mdefine_line|#define BANSHEE_MAX_PIXCLOCK 270000.0
DECL|macro|VOODOO3_MAX_PIXCLOCK
mdefine_line|#define VOODOO3_MAX_PIXCLOCK 300000.0
DECL|struct|banshee_reg
r_struct
id|banshee_reg
(brace
multiline_comment|/* VGA rubbish */
DECL|member|att
r_int
r_char
id|att
(braket
l_int|21
)braket
suffix:semicolon
DECL|member|crt
r_int
r_char
id|crt
(braket
l_int|25
)braket
suffix:semicolon
DECL|member|gra
r_int
r_char
id|gra
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|misc
r_int
r_char
id|misc
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|seq
r_int
r_char
id|seq
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Banshee extensions */
DECL|member|ext
r_int
r_char
id|ext
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|vidcfg
r_int
r_int
id|vidcfg
suffix:semicolon
DECL|member|vidpll
r_int
r_int
id|vidpll
suffix:semicolon
DECL|member|mempll
r_int
r_int
id|mempll
suffix:semicolon
DECL|member|gfxpll
r_int
r_int
id|gfxpll
suffix:semicolon
DECL|member|dacmode
r_int
r_int
id|dacmode
suffix:semicolon
DECL|member|vgainit0
r_int
r_int
id|vgainit0
suffix:semicolon
DECL|member|vgainit1
r_int
r_int
id|vgainit1
suffix:semicolon
DECL|member|screensize
r_int
r_int
id|screensize
suffix:semicolon
DECL|member|stride
r_int
r_int
id|stride
suffix:semicolon
DECL|member|cursloc
r_int
r_int
id|cursloc
suffix:semicolon
DECL|member|startaddr
r_int
r_int
id|startaddr
suffix:semicolon
DECL|member|clip0min
r_int
r_int
id|clip0min
suffix:semicolon
DECL|member|clip0max
r_int
r_int
id|clip0max
suffix:semicolon
DECL|member|clip1min
r_int
r_int
id|clip1min
suffix:semicolon
DECL|member|clip1max
r_int
r_int
id|clip1max
suffix:semicolon
DECL|member|srcbase
r_int
r_int
id|srcbase
suffix:semicolon
DECL|member|dstbase
r_int
r_int
id|dstbase
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|tdfxfb_par
r_struct
id|tdfxfb_par
(brace
DECL|member|pixclock
id|u32
id|pixclock
suffix:semicolon
DECL|member|baseline
id|u32
id|baseline
suffix:semicolon
DECL|member|width
id|u32
id|width
suffix:semicolon
DECL|member|height
id|u32
id|height
suffix:semicolon
DECL|member|width_virt
id|u32
id|width_virt
suffix:semicolon
DECL|member|height_virt
id|u32
id|height_virt
suffix:semicolon
DECL|member|lpitch
id|u32
id|lpitch
suffix:semicolon
multiline_comment|/* line pitch, in bytes */
DECL|member|ppitch
id|u32
id|ppitch
suffix:semicolon
multiline_comment|/* pixel pitch, in bits */
DECL|member|bpp
id|u32
id|bpp
suffix:semicolon
DECL|member|hdispend
id|u32
id|hdispend
suffix:semicolon
DECL|member|hsyncsta
id|u32
id|hsyncsta
suffix:semicolon
DECL|member|hsyncend
id|u32
id|hsyncend
suffix:semicolon
DECL|member|htotal
id|u32
id|htotal
suffix:semicolon
DECL|member|vdispend
id|u32
id|vdispend
suffix:semicolon
DECL|member|vsyncsta
id|u32
id|vsyncsta
suffix:semicolon
DECL|member|vsyncend
id|u32
id|vsyncend
suffix:semicolon
DECL|member|vtotal
id|u32
id|vtotal
suffix:semicolon
DECL|member|video
id|u32
id|video
suffix:semicolon
DECL|member|accel_flags
id|u32
id|accel_flags
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|fb_info_tdfx
r_struct
id|fb_info_tdfx
(brace
DECL|member|fb_info
r_struct
id|fb_info
id|fb_info
suffix:semicolon
DECL|member|dev
id|u16
id|dev
suffix:semicolon
DECL|member|max_pixclock
id|u32
id|max_pixclock
suffix:semicolon
DECL|member|regbase_phys
r_int
r_int
id|regbase_phys
suffix:semicolon
DECL|member|regbase_virt
r_int
r_int
id|regbase_virt
suffix:semicolon
DECL|member|regbase_size
r_int
r_int
id|regbase_size
suffix:semicolon
DECL|member|bufbase_phys
r_int
r_int
id|bufbase_phys
suffix:semicolon
DECL|member|bufbase_virt
r_int
r_int
id|bufbase_virt
suffix:semicolon
DECL|member|bufbase_size
r_int
r_int
id|bufbase_size
suffix:semicolon
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
DECL|member|palette
r_struct
(brace
id|u8
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|default_par
r_struct
id|tdfxfb_par
id|default_par
suffix:semicolon
DECL|member|current_par
r_struct
id|tdfxfb_par
id|current_par
suffix:semicolon
DECL|member|disp
r_struct
id|display
id|disp
suffix:semicolon
DECL|member|dispsw
r_struct
id|display_switch
id|dispsw
suffix:semicolon
r_union
(brace
macro_line|#ifdef FBCON_HAS_CFB16
DECL|member|cfb16
id|u16
id|cfb16
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|member|cfb32
id|u32
id|cfb32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
DECL|member|fbcon_cmap
)brace
id|fbcon_cmap
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; *  Frame buffer device API&n; */
r_static
r_int
id|tdfxfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n; *  Interface to the low level console driver&n; */
r_static
r_int
id|tdfxfb_switch_con
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_void
id|tdfxfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
multiline_comment|/*&n; *  Internal routines&n; */
r_static
r_void
id|tdfxfb_set_par
c_func
(paren
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|tdfxfb_set_disp
c_func
(paren
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_tdfx
op_star
id|info
comma
r_int
id|bpp
comma
r_int
id|accel
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_int
id|tdfxfb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|fb
)paren
suffix:semicolon
r_static
r_void
id|tdfxfb_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n; *  Interface used by the world&n; */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_void
id|tdfxfb_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#else
r_int
id|tdfxfb_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
r_void
id|tdfxfb_setup
c_func
(paren
r_char
op_star
id|options
comma
r_int
op_star
id|ints
)paren
suffix:semicolon
DECL|variable|currcon
r_static
r_int
id|currcon
op_assign
l_int|0
suffix:semicolon
DECL|variable|tdfxfb_ops
r_static
r_struct
id|fb_ops
id|tdfxfb_ops
op_assign
(brace
id|tdfxfb_open
comma
id|tdfxfb_release
comma
id|tdfxfb_get_fix
comma
id|tdfxfb_get_var
comma
id|tdfxfb_set_var
comma
id|tdfxfb_get_cmap
comma
id|tdfxfb_set_cmap
comma
id|tdfxfb_pan_display
comma
id|tdfxfb_ioctl
comma
l_int|NULL
)brace
suffix:semicolon
DECL|struct|mode
r_struct
id|mode
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|var
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
DECL|variable|mode
)brace
id|mode
suffix:semicolon
multiline_comment|/* 2.3.x kernels have a fb mode database, so supply only one backup default */
DECL|variable|default_mode
r_struct
id|mode
id|default_mode
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;640x480-8@60&quot;
comma
multiline_comment|/* @ 60 Hz */
(brace
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
id|FB_ACTIVATE_NOW
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|39722
comma
l_int|40
comma
l_int|24
comma
l_int|32
comma
l_int|11
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
comma
(brace
l_string|&quot;800x600-8@56&quot;
comma
multiline_comment|/* @ 56 Hz */
(brace
l_int|800
comma
l_int|600
comma
l_int|800
comma
l_int|600
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
id|FB_ACTIVATE_NOW
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|27778
comma
l_int|128
comma
l_int|24
comma
l_int|22
comma
l_int|1
comma
l_int|72
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1024x768-8@60&quot;
comma
multiline_comment|/* @ 60 Hz */
(brace
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
id|FB_ACTIVATE_NOW
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|15385
comma
l_int|168
comma
l_int|8
comma
l_int|29
comma
l_int|3
comma
l_int|144
comma
l_int|6
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-8@61&quot;
comma
multiline_comment|/* @ 61 Hz */
(brace
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
id|FB_ACTIVATE_NOW
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|9091
comma
l_int|200
comma
l_int|48
comma
l_int|26
comma
l_int|1
comma
l_int|184
comma
l_int|3
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1024x768-16@60&quot;
comma
multiline_comment|/* @ 60 Hz */
multiline_comment|/* basically for testing */
(brace
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
id|FB_ACTIVATE_NOW
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|15385
comma
l_int|168
comma
l_int|8
comma
l_int|29
comma
l_int|3
comma
l_int|144
comma
l_int|6
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
macro_line|#endif
)brace
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
DECL|variable|modes
r_static
r_int
id|modes
op_assign
r_sizeof
(paren
id|default_mode
)paren
op_div
r_sizeof
(paren
r_struct
id|mode
)paren
suffix:semicolon
DECL|variable|default_mode_index
r_static
r_int
id|default_mode_index
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|fb_info
r_static
r_struct
id|fb_info_tdfx
id|fb_info
suffix:semicolon
DECL|variable|noaccel
r_static
r_int
id|__initdata
id|noaccel
op_assign
l_int|0
suffix:semicolon
DECL|variable|nopan
r_static
r_int
id|__initdata
id|nopan
op_assign
l_int|0
suffix:semicolon
DECL|variable|nowrap
r_static
r_int
id|__initdata
id|nowrap
op_assign
l_int|0
suffix:semicolon
DECL|variable|inverse
r_static
r_int
id|__initdata
id|inverse
op_assign
l_int|0
suffix:semicolon
DECL|variable|fontname
r_static
r_char
id|__initdata
id|fontname
(braket
l_int|40
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
op_star
id|mode_option
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|function|vga_inb
r_static
r_inline
id|__u8
id|vga_inb
c_func
(paren
id|__u32
id|reg
)paren
(brace
r_return
id|inb
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
DECL|function|vga_inw
r_static
r_inline
id|__u16
id|vga_inw
c_func
(paren
id|__u32
id|reg
)paren
(brace
r_return
id|inw
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
DECL|function|vga_inl
r_static
r_inline
id|__u16
id|vga_inl
c_func
(paren
id|__u32
id|reg
)paren
(brace
r_return
id|inl
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
DECL|function|vga_outb
r_static
r_inline
r_void
id|vga_outb
c_func
(paren
id|__u32
id|reg
comma
id|__u8
id|val
)paren
(brace
id|outb
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|vga_outw
r_static
r_inline
r_void
id|vga_outw
c_func
(paren
id|__u32
id|reg
comma
id|__u16
id|val
)paren
(brace
id|outw
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|vga_outl
r_static
r_inline
r_void
id|vga_outl
c_func
(paren
id|__u32
id|reg
comma
id|__u32
id|val
)paren
(brace
id|outl
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|gra_outb
r_static
r_inline
r_void
id|gra_outb
c_func
(paren
id|__u32
id|idx
comma
id|__u8
id|val
)paren
(brace
id|vga_outb
c_func
(paren
id|GRA_I
comma
id|idx
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|GRA_D
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|gra_inb
r_static
r_inline
id|__u8
id|gra_inb
c_func
(paren
id|__u32
id|idx
)paren
(brace
id|vga_outb
c_func
(paren
id|GRA_I
comma
id|idx
)paren
suffix:semicolon
r_return
id|vga_inb
c_func
(paren
id|GRA_D
)paren
suffix:semicolon
)brace
DECL|function|seq_outb
r_static
r_inline
r_void
id|seq_outb
c_func
(paren
id|__u32
id|idx
comma
id|__u8
id|val
)paren
(brace
id|vga_outb
c_func
(paren
id|SEQ_I
comma
id|idx
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|SEQ_D
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|seq_inb
r_static
r_inline
id|__u8
id|seq_inb
c_func
(paren
id|__u32
id|idx
)paren
(brace
id|vga_outb
c_func
(paren
id|SEQ_I
comma
id|idx
)paren
suffix:semicolon
r_return
id|vga_inb
c_func
(paren
id|SEQ_D
)paren
suffix:semicolon
)brace
DECL|function|crt_outb
r_static
r_inline
r_void
id|crt_outb
c_func
(paren
id|__u32
id|idx
comma
id|__u8
id|val
)paren
(brace
id|vga_outb
c_func
(paren
id|CRT_I
comma
id|idx
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|CRT_D
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|crt_inb
r_static
r_inline
id|__u8
id|crt_inb
c_func
(paren
id|__u32
id|idx
)paren
(brace
id|vga_outb
c_func
(paren
id|CRT_I
comma
id|idx
)paren
suffix:semicolon
r_return
id|vga_inb
c_func
(paren
id|CRT_D
)paren
suffix:semicolon
)brace
DECL|function|att_outb
r_static
r_inline
r_void
id|att_outb
c_func
(paren
id|__u32
id|idx
comma
id|__u8
id|val
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|vga_inb
c_func
(paren
id|IS1_R
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|ATT_IW
comma
id|idx
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|ATT_IW
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|att_inb
r_static
r_inline
id|__u8
id|att_inb
c_func
(paren
id|__u32
id|idx
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|vga_inb
c_func
(paren
id|IS1_R
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|ATT_IW
comma
id|idx
)paren
suffix:semicolon
r_return
id|vga_inb
c_func
(paren
id|ATT_IW
)paren
suffix:semicolon
)brace
DECL|function|vga_disable_video
r_static
r_inline
r_void
id|vga_disable_video
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|s
suffix:semicolon
id|s
op_assign
id|seq_inb
c_func
(paren
l_int|0x01
)paren
op_or
l_int|0x20
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x01
comma
id|s
)paren
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
)brace
DECL|function|vga_enable_video
r_static
r_inline
r_void
id|vga_enable_video
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|s
suffix:semicolon
id|s
op_assign
id|seq_inb
c_func
(paren
l_int|0x01
)paren
op_amp
l_int|0xdf
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x01
comma
id|s
)paren
suffix:semicolon
id|seq_outb
c_func
(paren
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
)brace
DECL|function|vga_disable_palette
r_static
r_inline
r_void
id|vga_disable_palette
c_func
(paren
r_void
)paren
(brace
id|vga_inb
c_func
(paren
id|IS1_R
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|ATT_IW
comma
l_int|0x00
)paren
suffix:semicolon
)brace
DECL|function|vga_enable_palette
r_static
r_inline
r_void
id|vga_enable_palette
c_func
(paren
r_void
)paren
(brace
id|vga_inb
c_func
(paren
id|IS1_R
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|ATT_IW
comma
l_int|0x20
)paren
suffix:semicolon
)brace
DECL|function|tdfx_inl
r_static
r_inline
id|__u32
id|tdfx_inl
c_func
(paren
r_int
r_int
id|reg
)paren
(brace
r_return
id|readl
c_func
(paren
id|fb_info.regbase_virt
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|tdfx_outl
r_static
r_inline
r_void
id|tdfx_outl
c_func
(paren
r_int
r_int
id|reg
comma
id|__u32
id|val
)paren
(brace
id|writel
c_func
(paren
id|val
comma
id|fb_info.regbase_virt
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|banshee_make_room
r_static
r_inline
r_void
id|banshee_make_room
c_func
(paren
r_int
id|size
)paren
(brace
r_while
c_loop
(paren
(paren
id|tdfx_inl
c_func
(paren
id|STATUS
)paren
op_amp
l_int|0x1f
)paren
OL
id|size
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|banshee_wait_idle
r_static
r_inline
r_void
id|banshee_wait_idle
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMAND_3D
comma
id|COMMAND_3D_NOP
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|i
op_assign
(paren
id|tdfx_inl
c_func
(paren
id|STATUS
)paren
op_amp
id|STATUS_BUSY
)paren
ques
c_cond
l_int|0
suffix:colon
id|i
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|3
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|banshee_fillrect
r_static
r_void
id|banshee_fillrect
c_func
(paren
id|__u32
id|x
comma
id|__u32
id|y
comma
id|__u32
id|w
comma
id|__u32
id|h
comma
id|__u32
id|color
comma
id|__u32
id|stride
comma
id|__u32
id|bpp
)paren
(brace
id|banshee_make_room
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTFORMAT
comma
(paren
id|stride
op_amp
l_int|0x3fff
)paren
op_or
(paren
id|bpp
op_eq
l_int|8
ques
c_cond
l_int|0x10000
suffix:colon
id|bpp
op_eq
l_int|16
ques
c_cond
l_int|0x30000
suffix:colon
l_int|0x50000
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COLORFORE
comma
id|color
)paren
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMAND_2D
comma
id|COMMAND_2D_FILLRECT
op_or
(paren
id|ROP_COPY
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTSIZE
comma
(paren
id|w
op_amp
l_int|0x1fff
)paren
op_or
(paren
(paren
id|h
op_amp
l_int|0x1fff
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|LAUNCH_2D
comma
(paren
id|x
op_amp
l_int|0x1fff
)paren
op_or
(paren
(paren
id|y
op_amp
l_int|0x1fff
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
DECL|function|banshee_bitblt
r_static
r_void
id|banshee_bitblt
c_func
(paren
id|__u32
id|curx
comma
id|__u32
id|cury
comma
id|__u32
id|dstx
comma
id|__u32
id|dsty
comma
id|__u32
id|width
comma
id|__u32
id|height
comma
id|__u32
id|stride
comma
id|__u32
id|bpp
)paren
(brace
r_int
id|xdir
comma
id|ydir
suffix:semicolon
id|xdir
op_assign
id|dstx
OL
id|curx
ques
c_cond
l_int|1
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|ydir
op_assign
id|dsty
OL
id|cury
ques
c_cond
l_int|1
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|SRCFORMAT
comma
(paren
id|stride
op_amp
l_int|0x3fff
)paren
op_or
(paren
id|bpp
op_eq
l_int|8
ques
c_cond
l_int|0x10000
suffix:colon
id|bpp
op_eq
l_int|16
ques
c_cond
l_int|0x30000
suffix:colon
l_int|0x50000
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTFORMAT
comma
(paren
id|stride
op_amp
l_int|0x3fff
)paren
op_or
(paren
id|bpp
op_eq
l_int|8
ques
c_cond
l_int|0x10000
suffix:colon
id|bpp
op_eq
l_int|16
ques
c_cond
l_int|0x30000
suffix:colon
l_int|0x50000
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMAND_2D
comma
id|COMMAND_2D_BITBLT
op_or
(paren
id|xdir
op_eq
op_minus
l_int|1
ques
c_cond
id|BIT
c_func
(paren
l_int|14
)paren
suffix:colon
l_int|0
)paren
op_or
(paren
id|ydir
op_eq
op_minus
l_int|1
ques
c_cond
id|BIT
c_func
(paren
l_int|15
)paren
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMANDEXTRA_2D
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* no color keying */
r_if
c_cond
(paren
id|xdir
op_eq
op_minus
l_int|1
)paren
(brace
id|curx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|dstx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ydir
op_eq
op_minus
l_int|1
)paren
(brace
id|cury
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
id|dsty
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Consecutive overlapping regions can hang the board -- &n;     since we allow mmap&squot;ing of control registers, we cannot&n;     __safely__ assume anything, like XF86 does... */
id|banshee_make_room
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMAND_3D
comma
id|COMMAND_3D_NOP
)paren
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTSIZE
comma
(paren
id|width
op_amp
l_int|0x1fff
)paren
op_or
(paren
(paren
id|height
op_amp
l_int|0x1fff
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTXY
comma
(paren
id|dstx
op_amp
l_int|0x1fff
)paren
op_or
(paren
(paren
id|dsty
op_amp
l_int|0x1fff
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|LAUNCH_2D
comma
(paren
id|curx
op_amp
l_int|0x1fff
)paren
op_or
(paren
(paren
id|cury
op_amp
l_int|0x1fff
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
DECL|function|banshee_calc_pll
r_static
id|__u32
id|banshee_calc_pll
c_func
(paren
r_int
id|freq
comma
r_int
op_star
id|freq_out
)paren
(brace
r_int
id|m
comma
id|n
comma
id|k
comma
id|best_m
comma
id|best_n
comma
id|best_k
comma
id|f_cur
comma
id|best_error
suffix:semicolon
r_int
id|fref
op_assign
l_int|14318
suffix:semicolon
multiline_comment|/* this really could be done with more intelligence */
id|best_error
op_assign
id|freq
suffix:semicolon
id|best_n
op_assign
id|best_m
op_assign
id|best_k
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|1
suffix:semicolon
id|n
OL
l_int|256
suffix:semicolon
id|n
op_increment
)paren
(brace
r_for
c_loop
(paren
id|m
op_assign
l_int|1
suffix:semicolon
id|m
OL
l_int|64
suffix:semicolon
id|m
op_increment
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|4
suffix:semicolon
id|k
op_increment
)paren
(brace
id|f_cur
op_assign
id|fref
op_star
(paren
id|n
op_plus
l_int|2
)paren
op_div
(paren
id|m
op_plus
l_int|2
)paren
op_div
(paren
l_int|1
op_lshift
id|k
)paren
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
id|f_cur
op_minus
id|freq
)paren
OL
id|best_error
)paren
(brace
id|best_error
op_assign
id|abs
c_func
(paren
id|f_cur
op_minus
id|freq
)paren
suffix:semicolon
id|best_n
op_assign
id|n
suffix:semicolon
id|best_m
op_assign
id|m
suffix:semicolon
id|best_k
op_assign
id|k
suffix:semicolon
)brace
)brace
)brace
)brace
id|n
op_assign
id|best_n
suffix:semicolon
id|m
op_assign
id|best_m
suffix:semicolon
id|k
op_assign
id|best_k
suffix:semicolon
op_star
id|freq_out
op_assign
id|fref
op_star
(paren
id|n
op_plus
l_int|2
)paren
op_div
(paren
id|m
op_plus
l_int|2
)paren
op_div
(paren
l_int|1
op_lshift
id|k
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;freq = %d kHz, freq_out = %d kHz&bslash;n&quot;
comma
id|freq
comma
op_star
id|freq_out
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;N = %d, M = %d, K = %d&bslash;n&quot;
comma
id|n
comma
id|m
comma
id|k
)paren
suffix:semicolon
r_return
(paren
id|n
op_lshift
l_int|8
)paren
op_or
(paren
id|m
op_lshift
l_int|2
)paren
op_or
id|k
suffix:semicolon
)brace
DECL|function|banshee_write_regs
r_static
r_void
id|banshee_write_regs
c_func
(paren
r_struct
id|banshee_reg
op_star
id|reg
)paren
(brace
r_int
id|i
suffix:semicolon
id|banshee_wait_idle
c_func
(paren
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|MISCINIT1
comma
id|tdfx_inl
c_func
(paren
id|MISCINIT1
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
id|crt_outb
c_func
(paren
l_int|0x11
comma
id|crt_inb
c_func
(paren
l_int|0x11
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
multiline_comment|/* CRT unprotect */
id|banshee_make_room
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VGAINIT1
comma
id|reg-&gt;vgainit1
op_amp
l_int|0x001FFFFF
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDPROCCFG
comma
id|reg-&gt;vidcfg
op_amp
op_complement
l_int|0x00000001
)paren
suffix:semicolon
macro_line|#if 0
id|tdfx_outl
c_func
(paren
id|PLLCTRL1
comma
id|reg-&gt;mempll
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|PLLCTRL2
comma
id|reg-&gt;gfxpll
)paren
suffix:semicolon
macro_line|#endif
id|tdfx_outl
c_func
(paren
id|PLLCTRL0
comma
id|reg-&gt;vidpll
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|MISC_W
comma
id|reg-&gt;misc
(braket
l_int|0x00
)braket
op_or
l_int|0x01
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|seq_outb
c_func
(paren
id|i
comma
id|reg-&gt;seq
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crt_outb
c_func
(paren
id|i
comma
id|reg-&gt;crt
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
(brace
id|gra_outb
c_func
(paren
id|i
comma
id|reg-&gt;gra
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
(brace
id|att_outb
c_func
(paren
id|i
comma
id|reg-&gt;att
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|crt_outb
c_func
(paren
l_int|0x1a
comma
id|reg-&gt;ext
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|crt_outb
c_func
(paren
l_int|0x1b
comma
id|reg-&gt;ext
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|vga_enable_palette
c_func
(paren
)paren
suffix:semicolon
id|vga_enable_video
c_func
(paren
)paren
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VGAINIT0
comma
id|reg-&gt;vgainit0
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DACMODE
comma
id|reg-&gt;dacmode
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDDESKSTRIDE
comma
id|reg-&gt;stride
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|HWCURPATADDR
comma
id|reg-&gt;cursloc
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDSCREENSIZE
comma
id|reg-&gt;screensize
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDDESKSTART
comma
id|reg-&gt;startaddr
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDPROCCFG
comma
id|reg-&gt;vidcfg
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VGAINIT1
comma
id|reg-&gt;vgainit1
)paren
suffix:semicolon
id|banshee_make_room
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|SRCBASE
comma
id|reg-&gt;srcbase
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTBASE
comma
id|reg-&gt;dstbase
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|COMMANDEXTRA_2D
comma
l_int|0
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|CLIP0MIN
comma
l_int|0
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|CLIP0MAX
comma
l_int|0x0fff0fff
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|CLIP1MIN
comma
l_int|0
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|CLIP1MAX
comma
l_int|0x0fff0fff
)paren
suffix:semicolon
id|banshee_wait_idle
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tdfx_lfb_size
r_static
r_int
r_int
id|tdfx_lfb_size
c_func
(paren
r_void
)paren
(brace
id|__u32
id|draminit0
op_assign
l_int|0
suffix:semicolon
id|__u32
id|draminit1
op_assign
l_int|0
suffix:semicolon
id|__u32
id|miscinit1
op_assign
l_int|0
suffix:semicolon
id|__u32
id|lfbsize
op_assign
l_int|0
suffix:semicolon
r_int
id|sgram_p
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
op_logical_or
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_VOODOO3
)paren
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|draminit0
op_assign
id|tdfx_inl
c_func
(paren
id|DRAMINIT0
)paren
suffix:semicolon
id|draminit1
op_assign
id|tdfx_inl
c_func
(paren
id|DRAMINIT1
)paren
suffix:semicolon
id|sgram_p
op_assign
(paren
id|draminit1
op_amp
id|DRAMINIT1_MEM_SDRAM
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|lfbsize
op_assign
id|sgram_p
ques
c_cond
(paren
(paren
(paren
id|draminit0
op_amp
id|DRAMINIT0_SGRAM_NUM
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
op_star
(paren
(paren
id|draminit0
op_amp
id|DRAMINIT0_SGRAM_TYPE
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|4
)paren
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:colon
l_int|16
op_star
l_int|1024
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* disable block writes for SDRAM (why?) */
id|miscinit1
op_assign
id|tdfx_inl
c_func
(paren
id|MISCINIT1
)paren
suffix:semicolon
id|miscinit1
op_or_assign
id|sgram_p
ques
c_cond
l_int|0
suffix:colon
id|MISCINIT1_2DBLOCK_DIS
suffix:semicolon
id|miscinit1
op_or_assign
id|MISCINIT1_CLUT_INV
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|MISCINIT1
comma
id|miscinit1
)paren
suffix:semicolon
r_return
id|lfbsize
suffix:semicolon
)brace
DECL|function|fbcon_banshee_bmove
r_static
r_void
id|fbcon_banshee_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|banshee_bitblt
c_func
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|sx
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|sy
comma
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|dx
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|dy
comma
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|width
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|height
comma
id|fb_info.current_par.lpitch
comma
id|fb_info.current_par.bpp
)paren
suffix:semicolon
)brace
DECL|function|fbcon_banshee_clear
r_static
r_void
id|fbcon_banshee_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_int
id|bg
suffix:semicolon
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|banshee_fillrect
c_func
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|sx
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|sy
comma
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|width
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|height
comma
id|bg
comma
id|fb_info.current_par.lpitch
comma
id|fb_info.current_par.bpp
)paren
suffix:semicolon
)brace
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|fbcon_banshee8
r_static
r_struct
id|display_switch
id|fbcon_banshee8
op_assign
(brace
id|fbcon_cfb8_setup
comma
id|fbcon_banshee_bmove
comma
id|fbcon_banshee_clear
comma
id|fbcon_cfb8_putc
comma
id|fbcon_cfb8_putcs
comma
id|fbcon_cfb8_revc
comma
l_int|NULL
comma
l_int|NULL
comma
id|fbcon_cfb8_clear_margins
comma
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|variable|fbcon_banshee16
r_static
r_struct
id|display_switch
id|fbcon_banshee16
op_assign
(brace
id|fbcon_cfb16_setup
comma
id|fbcon_banshee_bmove
comma
id|fbcon_banshee_clear
comma
id|fbcon_cfb16_putc
comma
id|fbcon_cfb16_putcs
comma
id|fbcon_cfb16_revc
comma
l_int|NULL
comma
l_int|NULL
comma
id|fbcon_cfb16_clear_margins
comma
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|variable|fbcon_banshee32
r_static
r_struct
id|display_switch
id|fbcon_banshee32
op_assign
(brace
id|fbcon_cfb32_setup
comma
id|fbcon_banshee_bmove
comma
id|fbcon_banshee_clear
comma
id|fbcon_cfb32_putc
comma
id|fbcon_cfb32_putcs
comma
id|fbcon_cfb32_revc
comma
l_int|NULL
comma
l_int|NULL
comma
id|fbcon_cfb32_clear_margins
comma
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|function|tdfxfb_set_par
r_static
r_void
id|tdfxfb_set_par
c_func
(paren
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|i
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|info
suffix:semicolon
r_struct
id|banshee_reg
id|reg
suffix:semicolon
id|__u32
id|cpp
suffix:semicolon
id|__u32
id|hd
comma
id|hs
comma
id|he
comma
id|ht
comma
id|hbs
comma
id|hbe
suffix:semicolon
id|__u32
id|vd
comma
id|vs
comma
id|ve
comma
id|vt
comma
id|vbs
comma
id|vbe
suffix:semicolon
id|__u32
id|wd
suffix:semicolon
r_int
id|fout
suffix:semicolon
r_int
id|freq
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|reg
comma
l_int|0
comma
r_sizeof
(paren
id|reg
)paren
)paren
suffix:semicolon
id|cpp
op_assign
(paren
id|par-&gt;bpp
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|wd
op_assign
(paren
id|par-&gt;hdispend
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|hd
op_assign
(paren
id|par-&gt;hdispend
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|hs
op_assign
(paren
id|par-&gt;hsyncsta
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|he
op_assign
(paren
id|par-&gt;hsyncend
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|ht
op_assign
(paren
id|par-&gt;htotal
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|hbs
op_assign
id|hd
suffix:semicolon
id|hbe
op_assign
id|ht
suffix:semicolon
id|vd
op_assign
id|par-&gt;vdispend
op_minus
l_int|1
suffix:semicolon
id|vs
op_assign
id|par-&gt;vsyncsta
op_minus
l_int|1
suffix:semicolon
id|ve
op_assign
id|par-&gt;vsyncend
op_minus
l_int|1
suffix:semicolon
id|vt
op_assign
id|par-&gt;vtotal
op_minus
l_int|2
suffix:semicolon
id|vbs
op_assign
id|vd
suffix:semicolon
id|vbe
op_assign
id|vt
suffix:semicolon
multiline_comment|/* this is all pretty standard VGA register stuffing */
id|reg.misc
(braket
l_int|0x00
)braket
op_assign
l_int|0x0f
op_or
(paren
id|par-&gt;hdispend
OL
l_int|400
ques
c_cond
l_int|0xa0
suffix:colon
id|par-&gt;hdispend
OL
l_int|480
ques
c_cond
l_int|0x60
suffix:colon
id|par-&gt;hdispend
OL
l_int|768
ques
c_cond
l_int|0xe0
suffix:colon
l_int|0x20
)paren
suffix:semicolon
id|reg.gra
(braket
l_int|0x00
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.gra
(braket
l_int|0x01
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.gra
(braket
l_int|0x02
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.gra
(braket
l_int|0x03
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.gra
(braket
l_int|0x04
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.gra
(braket
l_int|0x05
)braket
op_assign
l_int|0x40
suffix:semicolon
id|reg.gra
(braket
l_int|0x06
)braket
op_assign
l_int|0x05
suffix:semicolon
id|reg.gra
(braket
l_int|0x07
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|reg.gra
(braket
l_int|0x08
)braket
op_assign
l_int|0xff
suffix:semicolon
id|reg.att
(braket
l_int|0x00
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.att
(braket
l_int|0x01
)braket
op_assign
l_int|0x01
suffix:semicolon
id|reg.att
(braket
l_int|0x02
)braket
op_assign
l_int|0x02
suffix:semicolon
id|reg.att
(braket
l_int|0x03
)braket
op_assign
l_int|0x03
suffix:semicolon
id|reg.att
(braket
l_int|0x04
)braket
op_assign
l_int|0x04
suffix:semicolon
id|reg.att
(braket
l_int|0x05
)braket
op_assign
l_int|0x05
suffix:semicolon
id|reg.att
(braket
l_int|0x06
)braket
op_assign
l_int|0x06
suffix:semicolon
id|reg.att
(braket
l_int|0x07
)braket
op_assign
l_int|0x07
suffix:semicolon
id|reg.att
(braket
l_int|0x08
)braket
op_assign
l_int|0x08
suffix:semicolon
id|reg.att
(braket
l_int|0x09
)braket
op_assign
l_int|0x09
suffix:semicolon
id|reg.att
(braket
l_int|0x0a
)braket
op_assign
l_int|0x0a
suffix:semicolon
id|reg.att
(braket
l_int|0x0b
)braket
op_assign
l_int|0x0b
suffix:semicolon
id|reg.att
(braket
l_int|0x0c
)braket
op_assign
l_int|0x0c
suffix:semicolon
id|reg.att
(braket
l_int|0x0d
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reg.att
(braket
l_int|0x0e
)braket
op_assign
l_int|0x0e
suffix:semicolon
id|reg.att
(braket
l_int|0x0f
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|reg.att
(braket
l_int|0x10
)braket
op_assign
l_int|0x41
suffix:semicolon
id|reg.att
(braket
l_int|0x11
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.att
(braket
l_int|0x12
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|reg.att
(braket
l_int|0x13
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.att
(braket
l_int|0x14
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.seq
(braket
l_int|0x00
)braket
op_assign
l_int|0x03
suffix:semicolon
id|reg.seq
(braket
l_int|0x01
)braket
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* fixme: clkdiv2? */
id|reg.seq
(braket
l_int|0x02
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|reg.seq
(braket
l_int|0x03
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.seq
(braket
l_int|0x04
)braket
op_assign
l_int|0x0e
suffix:semicolon
id|reg.crt
(braket
l_int|0x00
)braket
op_assign
id|ht
op_minus
l_int|4
suffix:semicolon
id|reg.crt
(braket
l_int|0x01
)braket
op_assign
id|hd
suffix:semicolon
id|reg.crt
(braket
l_int|0x02
)braket
op_assign
id|hbs
suffix:semicolon
id|reg.crt
(braket
l_int|0x03
)braket
op_assign
l_int|0x80
op_or
(paren
id|hbe
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|reg.crt
(braket
l_int|0x04
)braket
op_assign
id|hs
suffix:semicolon
id|reg.crt
(braket
l_int|0x05
)braket
op_assign
(paren
(paren
id|hbe
op_amp
l_int|0x20
)paren
op_lshift
l_int|2
)paren
op_or
(paren
id|he
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|reg.crt
(braket
l_int|0x06
)braket
op_assign
id|vt
suffix:semicolon
id|reg.crt
(braket
l_int|0x07
)braket
op_assign
(paren
(paren
id|vs
op_amp
l_int|0x200
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x200
)paren
op_rshift
l_int|3
)paren
op_or
(paren
(paren
id|vt
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
op_or
l_int|0x10
op_or
(paren
(paren
id|vbs
op_amp
l_int|0x100
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|vs
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x100
)paren
op_rshift
l_int|7
)paren
op_or
(paren
(paren
id|vt
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|reg.crt
(braket
l_int|0x08
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x09
)braket
op_assign
l_int|0x40
op_or
(paren
(paren
id|vbs
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|reg.crt
(braket
l_int|0x0a
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x0b
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x0c
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x0d
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x0e
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x0f
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x10
)braket
op_assign
id|vs
suffix:semicolon
id|reg.crt
(braket
l_int|0x11
)braket
op_assign
(paren
id|ve
op_amp
l_int|0x0f
)paren
op_or
l_int|0x20
suffix:semicolon
id|reg.crt
(braket
l_int|0x12
)braket
op_assign
id|vd
suffix:semicolon
id|reg.crt
(braket
l_int|0x13
)braket
op_assign
id|wd
suffix:semicolon
id|reg.crt
(braket
l_int|0x14
)braket
op_assign
l_int|0x00
suffix:semicolon
id|reg.crt
(braket
l_int|0x15
)braket
op_assign
id|vbs
suffix:semicolon
id|reg.crt
(braket
l_int|0x16
)braket
op_assign
id|vbe
op_plus
l_int|1
suffix:semicolon
id|reg.crt
(braket
l_int|0x17
)braket
op_assign
l_int|0xc3
suffix:semicolon
id|reg.crt
(braket
l_int|0x18
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* Banshee&squot;s nonvga stuff */
id|reg.ext
(braket
l_int|0x00
)braket
op_assign
(paren
(paren
(paren
id|ht
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
id|hd
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|hbs
op_amp
l_int|0x100
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|hbe
op_amp
l_int|0x40
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|hs
op_amp
l_int|0x100
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|he
op_amp
l_int|0x20
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|reg.ext
(braket
l_int|0x01
)braket
op_assign
(paren
(paren
(paren
id|vt
op_amp
l_int|0x400
)paren
op_rshift
l_int|10
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x400
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
id|vbs
op_amp
l_int|0x400
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|vbe
op_amp
l_int|0x400
)paren
op_rshift
l_int|4
)paren
)paren
suffix:semicolon
id|reg.vgainit0
op_assign
id|VGAINIT0_8BIT_DAC
op_or
id|VGAINIT0_EXT_ENABLE
op_or
id|VGAINIT0_WAKEUP_3C3
op_or
id|VGAINIT0_ALT_READBACK
op_or
id|VGAINIT0_EXTSHIFTOUT
suffix:semicolon
id|reg.vgainit1
op_assign
id|tdfx_inl
c_func
(paren
id|VGAINIT1
)paren
op_amp
l_int|0x1fffff
suffix:semicolon
id|reg.vidcfg
op_assign
id|VIDCFG_VIDPROC_ENABLE
op_or
id|VIDCFG_DESK_ENABLE
op_or
(paren
(paren
id|cpp
op_minus
l_int|1
)paren
op_lshift
id|VIDCFG_PIXFMT_SHIFT
)paren
op_or
(paren
id|cpp
op_ne
l_int|1
ques
c_cond
id|VIDCFG_CLUT_BYPASS
suffix:colon
l_int|0
)paren
suffix:semicolon
id|reg.stride
op_assign
id|par-&gt;width
op_star
id|cpp
suffix:semicolon
id|reg.cursloc
op_assign
l_int|0
suffix:semicolon
id|reg.startaddr
op_assign
id|par-&gt;baseline
op_star
id|reg.stride
suffix:semicolon
id|reg.srcbase
op_assign
id|reg.startaddr
suffix:semicolon
id|reg.dstbase
op_assign
id|reg.startaddr
suffix:semicolon
multiline_comment|/* PLL settings */
id|freq
op_assign
id|par-&gt;pixclock
suffix:semicolon
id|reg.dacmode
op_and_assign
op_complement
id|DACMODE_2X
suffix:semicolon
id|reg.vidcfg
op_and_assign
op_complement
id|VIDCFG_2X
suffix:semicolon
r_if
c_cond
(paren
id|freq
OG
id|i-&gt;max_pixclock
op_div
l_int|2
)paren
(brace
id|freq
op_assign
id|freq
OG
id|i-&gt;max_pixclock
ques
c_cond
id|i-&gt;max_pixclock
suffix:colon
id|freq
suffix:semicolon
id|reg.dacmode
op_or_assign
id|DACMODE_2X
suffix:semicolon
id|reg.vidcfg
op_or_assign
id|VIDCFG_2X
suffix:semicolon
)brace
id|reg.vidpll
op_assign
id|banshee_calc_pll
c_func
(paren
id|freq
comma
op_amp
id|fout
)paren
suffix:semicolon
macro_line|#if 0
id|reg.mempll
op_assign
id|banshee_calc_pll
c_func
(paren
dot
dot
dot
comma
op_amp
id|fout
)paren
suffix:semicolon
id|reg.gfxpll
op_assign
id|banshee_calc_pll
c_func
(paren
dot
dot
dot
comma
op_amp
id|fout
)paren
suffix:semicolon
macro_line|#endif
id|reg.screensize
op_assign
id|par-&gt;width
op_or
(paren
id|par-&gt;height
op_lshift
l_int|12
)paren
suffix:semicolon
id|reg.vidcfg
op_and_assign
op_complement
id|VIDCFG_HALF_MODE
suffix:semicolon
id|banshee_write_regs
c_func
(paren
op_amp
id|reg
)paren
suffix:semicolon
id|i-&gt;current_par
op_assign
op_star
id|par
suffix:semicolon
)brace
DECL|function|tdfxfb_decode_var
r_static
r_int
id|tdfxfb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|i
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_ne
l_int|8
op_logical_and
id|var-&gt;bits_per_pixel
op_ne
l_int|16
op_logical_and
id|var-&gt;bits_per_pixel
op_ne
l_int|32
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;depth not supported: %u&bslash;n&quot;
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;interlace not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;xoffset
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;xoffset not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;xres
op_ne
id|var-&gt;xres_virtual
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;virtual x resolution != physical x resolution not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nopan
op_logical_and
id|nowrap
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yres
op_ne
id|var-&gt;yres_virtual
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;virtual y resolution != physical y resolution not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;virtual y resolution &lt; physical y resolution not possible&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;interlace not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|par
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tdfxfb_par
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|i-&gt;dev
)paren
(brace
r_case
id|PCI_DEVICE_ID_3DFX_BANSHEE
suffix:colon
r_case
id|PCI_DEVICE_ID_3DFX_VOODOO3
suffix:colon
id|par-&gt;width
op_assign
(paren
id|var-&gt;xres
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
multiline_comment|/* could sometimes be 8 */
id|par-&gt;width_virt
op_assign
id|par-&gt;width
suffix:semicolon
id|par-&gt;height
op_assign
id|var-&gt;yres
suffix:semicolon
id|par-&gt;height_virt
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
id|par-&gt;bpp
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|par-&gt;ppitch
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|par-&gt;lpitch
op_assign
id|par-&gt;width
op_star
id|par-&gt;ppitch
op_div
l_int|8
suffix:semicolon
id|par-&gt;baseline
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;width
template_param
l_int|2048
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;width not supported: %u&bslash;n&quot;
comma
id|par-&gt;width
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;height
template_param
l_int|2048
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;height not supported: %u&bslash;n&quot;
comma
id|par-&gt;height
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;lpitch
op_star
id|par-&gt;height_virt
OG
id|i-&gt;bufbase_size
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;no memory for screen (%ux%ux%u)&bslash;n&quot;
comma
id|par-&gt;width
comma
id|par-&gt;height_virt
comma
id|par-&gt;bpp
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|par-&gt;pixclock
op_assign
id|PICOS2KHZ
c_func
(paren
id|var-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;pixclock
OG
id|i-&gt;max_pixclock
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;pixclock too high (%uKHz)&bslash;n&quot;
comma
id|par-&gt;pixclock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|par-&gt;hdispend
op_assign
id|var-&gt;xres
suffix:semicolon
id|par-&gt;hsyncsta
op_assign
id|par-&gt;hdispend
op_plus
id|var-&gt;right_margin
suffix:semicolon
id|par-&gt;hsyncend
op_assign
id|par-&gt;hsyncsta
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|par-&gt;htotal
op_assign
id|par-&gt;hsyncend
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|par-&gt;vdispend
op_assign
id|var-&gt;yres
suffix:semicolon
id|par-&gt;vsyncsta
op_assign
id|par-&gt;vdispend
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|par-&gt;vsyncend
op_assign
id|par-&gt;vsyncsta
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|par-&gt;vtotal
op_assign
id|par-&gt;vsyncend
op_plus
id|var-&gt;upper_margin
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
(brace
id|par-&gt;video
op_or_assign
id|TDFXF_HSYNC_ACT_HIGH
suffix:semicolon
)brace
r_else
id|par-&gt;video
op_or_assign
id|TDFXF_HSYNC_ACT_LOW
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
(brace
id|par-&gt;video
op_or_assign
id|TDFXF_VSYNC_ACT_HIGH
suffix:semicolon
)brace
r_else
id|par-&gt;video
op_or_assign
id|TDFXF_VSYNC_ACT_LOW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|par-&gt;video
op_or_assign
id|TDFXF_LINE_DOUBLE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;activate
op_eq
id|FB_ACTIVATE_NOW
)paren
(brace
id|par-&gt;video
op_or_assign
id|TDFXF_VIDEO_ENABLE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|par-&gt;accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
)brace
r_else
id|par-&gt;accel_flags
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_encode_var
r_static
r_int
id|tdfxfb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
(brace
r_struct
id|fb_var_screeninfo
id|v
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|v
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
id|v.xres_virtual
op_assign
id|par-&gt;width_virt
suffix:semicolon
id|v.yres_virtual
op_assign
id|par-&gt;height_virt
suffix:semicolon
id|v.xres
op_assign
id|par-&gt;width
suffix:semicolon
id|v.yres
op_assign
id|par-&gt;height
suffix:semicolon
id|v.right_margin
op_assign
id|par-&gt;hsyncsta
op_minus
id|par-&gt;hdispend
suffix:semicolon
id|v.hsync_len
op_assign
id|par-&gt;hsyncend
op_minus
id|par-&gt;hsyncsta
suffix:semicolon
id|v.left_margin
op_assign
id|par-&gt;htotal
op_minus
id|par-&gt;hsyncend
suffix:semicolon
id|v.lower_margin
op_assign
id|par-&gt;vsyncsta
op_minus
id|par-&gt;vdispend
suffix:semicolon
id|v.vsync_len
op_assign
id|par-&gt;vsyncend
op_minus
id|par-&gt;vsyncsta
suffix:semicolon
id|v.upper_margin
op_assign
id|par-&gt;vtotal
op_minus
id|par-&gt;vsyncend
suffix:semicolon
id|v.bits_per_pixel
op_assign
id|par-&gt;bpp
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|v.red.offset
op_assign
l_int|11
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|6
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
id|v.height
op_assign
id|v.width
op_assign
op_minus
l_int|1
suffix:semicolon
id|v.pixclock
op_assign
id|KHZ2PICOS
c_func
(paren
id|par-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;video
op_amp
id|TDFXF_HSYNC_MASK
)paren
op_eq
id|TDFXF_HSYNC_ACT_HIGH
)paren
(brace
id|v.sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|par-&gt;video
op_amp
id|TDFXF_VSYNC_MASK
)paren
op_eq
id|TDFXF_VSYNC_ACT_HIGH
)paren
(brace
id|v.sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;video
op_amp
id|TDFXF_LINE_DOUBLE
)paren
(brace
id|v.vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
)brace
op_star
id|var
op_assign
id|v
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_open
r_static
r_int
id|tdfxfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_release
r_static
r_int
id|tdfxfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_encode_fix
r_static
r_int
id|tdfxfb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_struct
id|tdfxfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
)paren
(brace
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;dev
)paren
(brace
r_case
id|PCI_DEVICE_ID_3DFX_BANSHEE
suffix:colon
r_case
id|PCI_DEVICE_ID_3DFX_VOODOO3
suffix:colon
r_if
c_cond
(paren
id|info-&gt;dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;3Dfx Banshee&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;3Dfx Voodoo3&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
id|fix-&gt;smem_start
op_assign
(paren
r_char
op_star
)paren
id|info-&gt;bufbase_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|info-&gt;bufbase_size
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
(paren
r_char
op_star
)paren
id|info-&gt;regbase_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|info-&gt;regbase_size
suffix:semicolon
macro_line|#else
id|fix-&gt;smem_start
op_assign
id|info-&gt;bufbase_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|info-&gt;bufbase_size
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|info-&gt;regbase_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|info-&gt;regbase_size
suffix:semicolon
macro_line|#endif
id|fix-&gt;accel
op_assign
id|FB_ACCEL_3DFX_BANSHEE
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|par-&gt;lpitch
suffix:semicolon
id|fix-&gt;visual
op_assign
id|par-&gt;bpp
op_eq
l_int|8
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
(paren
id|nowrap
op_logical_and
id|nopan
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
id|nowrap
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_get_fix
r_static
r_int
id|tdfxfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
r_struct
id|tdfxfb_par
id|par
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|par
op_assign
id|info-&gt;default_par
suffix:semicolon
)brace
r_else
id|tdfxfb_decode_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
id|tdfxfb_encode_fix
c_func
(paren
id|fix
comma
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_get_var
r_static
r_int
id|tdfxfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_const
r_struct
id|fb_info_tdfx
op_star
id|info
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|tdfxfb_encode_var
c_func
(paren
id|var
comma
op_amp
id|info-&gt;default_par
comma
id|info
)paren
suffix:semicolon
)brace
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_set_disp
r_static
r_void
id|tdfxfb_set_disp
c_func
(paren
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_tdfx
op_star
id|info
comma
r_int
id|bpp
comma
r_int
id|accel
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;actually, %s using acceleration!&bslash;n&quot;
comma
id|noaccel
ques
c_cond
l_string|&quot;NOT&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|info-&gt;dispsw
op_assign
id|noaccel
ques
c_cond
id|fbcon_cfb8
suffix:colon
id|fbcon_banshee8
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|info-&gt;dispsw
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|info-&gt;dispsw
op_assign
id|noaccel
ques
c_cond
id|fbcon_cfb16
suffix:colon
id|fbcon_banshee16
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|info-&gt;dispsw
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|info-&gt;fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|info-&gt;dispsw
op_assign
id|noaccel
ques
c_cond
id|fbcon_cfb32
suffix:colon
id|fbcon_banshee32
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|info-&gt;dispsw
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|info-&gt;fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|info-&gt;dispsw
op_assign
id|fbcon_dummy
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|info-&gt;dispsw
suffix:semicolon
)brace
)brace
DECL|function|tdfxfb_set_var
r_static
r_int
id|tdfxfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|info
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
r_struct
id|tdfxfb_par
id|par
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_int
id|oldxres
comma
id|oldyres
comma
id|oldvxres
comma
id|oldvyres
comma
id|oldbpp
comma
id|oldaccel
comma
id|accel
comma
id|err
suffix:semicolon
r_int
id|activate
op_assign
id|var-&gt;activate
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
)brace
r_else
id|display
op_assign
id|fb-&gt;disp
suffix:semicolon
multiline_comment|/* used during initialization */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|tdfxfb_decode_var
c_func
(paren
id|var
comma
op_amp
id|par
comma
id|info
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|tdfxfb_encode_var
c_func
(paren
id|var
comma
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
(brace
id|oldxres
op_assign
id|display-&gt;var.xres
suffix:semicolon
id|oldyres
op_assign
id|display-&gt;var.yres
suffix:semicolon
id|oldvxres
op_assign
id|display-&gt;var.xres_virtual
suffix:semicolon
id|oldvyres
op_assign
id|display-&gt;var.yres_virtual
suffix:semicolon
id|oldbpp
op_assign
id|display-&gt;var.bits_per_pixel
suffix:semicolon
id|oldaccel
op_assign
id|display-&gt;var.accel_flags
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
r_if
c_cond
(paren
id|con
OL
l_int|0
op_logical_or
id|oldxres
op_ne
id|var-&gt;xres
op_logical_or
id|oldyres
op_ne
id|var-&gt;yres
op_logical_or
id|oldvxres
op_ne
id|var-&gt;xres_virtual
op_logical_or
id|oldvyres
op_ne
id|var-&gt;yres_virtual
op_logical_or
id|oldbpp
op_ne
id|var-&gt;bits_per_pixel
op_logical_or
id|oldaccel
op_ne
id|var-&gt;accel_flags
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
id|tdfxfb_encode_fix
c_func
(paren
op_amp
id|fix
comma
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
id|display-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|info-&gt;bufbase_virt
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|inverse
suffix:semicolon
id|accel
op_assign
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
suffix:semicolon
id|tdfxfb_set_disp
c_func
(paren
id|display
comma
id|info
comma
id|par.bpp
comma
id|accel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nopan
op_logical_and
id|nowrap
)paren
(brace
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
macro_line|#ifdef FBCON_HAS_CFB8
id|fbcon_banshee8.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
id|fbcon_banshee16.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
id|fbcon_banshee32.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|info-&gt;fb_info.changevar
)paren
(paren
op_star
id|info-&gt;fb_info.changevar
)paren
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;fb_info.display_fg
op_logical_or
id|info-&gt;fb_info.display_fg-&gt;vc_num
op_eq
id|con
op_logical_or
id|con
OL
l_int|0
)paren
(brace
id|tdfxfb_set_par
c_func
(paren
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oldbpp
op_ne
id|var-&gt;bits_per_pixel
op_logical_or
id|con
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|display-&gt;cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|tdfxfb_install_cmap
c_func
(paren
id|con
comma
op_amp
id|info-&gt;fb_info
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_pan_display
r_static
r_int
id|tdfxfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|i
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
id|__u32
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|nowrap
op_logical_and
id|nopan
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nopan
op_logical_and
id|var-&gt;yoffset
OG
id|var-&gt;yres_virtual
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nowrap
op_logical_and
id|var-&gt;yoffset
op_plus
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i-&gt;current_par.baseline
op_assign
id|var-&gt;yoffset
suffix:semicolon
id|addr
op_assign
id|var-&gt;yoffset
op_star
id|i-&gt;current_par.lpitch
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|VIDDESKSTART
comma
id|addr
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|SRCBASE
comma
id|addr
)paren
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DSTBASE
comma
id|addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|tdfxfb_get_cmap
r_static
r_int
id|tdfxfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fb-&gt;display_fg
op_logical_or
id|con
op_eq
id|fb-&gt;display_fg-&gt;vc_num
)paren
(brace
multiline_comment|/* current console? */
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|tdfxfb_getcolreg
comma
id|fb
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
multiline_comment|/* non default colormap? */
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|size
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
op_eq
l_int|16
ques
c_cond
l_int|32
suffix:colon
l_int|256
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|size
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_set_cmap
r_static
r_int
id|tdfxfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|disp
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
)brace
r_else
id|disp
op_assign
id|fb-&gt;disp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|disp-&gt;cmap.len
)paren
(brace
multiline_comment|/* no colormap allocated? */
r_int
id|size
op_assign
id|disp-&gt;var.bits_per_pixel
op_eq
l_int|16
ques
c_cond
l_int|32
suffix:colon
l_int|256
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|disp-&gt;cmap
comma
id|size
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|fb-&gt;display_fg
op_logical_or
id|con
op_eq
id|fb-&gt;display_fg-&gt;vc_num
)paren
(brace
multiline_comment|/* current console? */
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|tdfxfb_setcolreg
comma
id|fb
)paren
suffix:semicolon
)brace
r_else
(brace
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|disp-&gt;cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tdfxfb_ioctl
r_static
r_int
id|tdfxfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|tdfxfb_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#else
r_int
id|__init
id|tdfxfb_init
c_func
(paren
r_void
)paren
(brace
macro_line|#endif
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
id|j
comma
id|k
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|pdev
op_assign
id|pci_devices
suffix:semicolon
id|pdev
suffix:semicolon
id|pdev
op_assign
id|pdev-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|pdev
op_member_access_from_pointer
r_class
op_rshift
l_int|16
)paren
op_eq
id|PCI_BASE_CLASS_DISPLAY
)paren
op_logical_and
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_3DFX
)paren
op_logical_and
(paren
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
op_logical_or
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_3DFX_VOODOO3
)paren
)paren
)paren
(brace
id|fb_info.dev
op_assign
id|pdev-&gt;device
suffix:semicolon
id|fb_info.max_pixclock
op_assign
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
ques
c_cond
id|BANSHEE_MAX_PIXCLOCK
suffix:colon
id|VOODOO3_MAX_PIXCLOCK
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
id|fb_info.regbase_phys
op_assign
id|pdev-&gt;base_address
(braket
l_int|0
)braket
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
id|fb_info.regbase_size
op_assign
l_int|1
op_lshift
l_int|25
suffix:semicolon
id|fb_info.regbase_virt
op_assign
(paren
id|__u32
)paren
id|ioremap_nocache
c_func
(paren
id|fb_info.regbase_phys
comma
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info.regbase_virt
)paren
(brace
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Banshee register area.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Voodoo3 register area.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fb_info.bufbase_phys
op_assign
id|pdev-&gt;base_address
(braket
l_int|1
)braket
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fb_info.bufbase_size
op_assign
id|tdfx_lfb_size
c_func
(paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t count Banshee memory.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t count Voodoo3 memory.&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|fb_info.regbase_virt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fb_info.bufbase_virt
op_assign
(paren
id|__u32
)paren
id|ioremap_nocache
c_func
(paren
id|fb_info.bufbase_phys
comma
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info.regbase_virt
)paren
(brace
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Banshee framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Voodoo3 framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|fb_info.regbase_virt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#else
id|fb_info.regbase_phys
op_assign
id|pdev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|fb_info.regbase_size
op_assign
l_int|1
op_lshift
l_int|25
suffix:semicolon
id|fb_info.regbase_virt
op_assign
(paren
id|__u32
)paren
id|ioremap_nocache
c_func
(paren
id|fb_info.regbase_phys
comma
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info.regbase_virt
)paren
(brace
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Banshee register area.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Voodoo3 register area.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|fb_info.bufbase_phys
op_assign
id|pdev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fb_info.bufbase_size
op_assign
id|tdfx_lfb_size
c_func
(paren
)paren
)paren
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|fb_info.regbase_virt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t count Banshee memory.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t count Voodoo3 memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|fb_info.bufbase_virt
op_assign
(paren
id|__u32
)paren
id|ioremap_nocache
c_func
(paren
id|fb_info.bufbase_phys
comma
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info.regbase_virt
)paren
(brace
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Banshee framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Can&squot;t remap Voodoo3 framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|fb_info.regbase_virt
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|printk
c_func
(paren
l_string|&quot;fb: Banshee memory = %ldK&bslash;n&quot;
comma
id|fb_info.bufbase_size
op_rshift
l_int|10
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;fb: Voodoo3 memory = %ldK&bslash;n&quot;
comma
id|fb_info.bufbase_size
op_rshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* clear framebuffer memory */
id|memset_io
c_func
(paren
id|fb_info.bufbase_virt
comma
l_int|0
comma
id|fb_info.bufbase_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_info.dev
op_eq
id|PCI_DEVICE_ID_3DFX_BANSHEE
)paren
id|strcpy
c_func
(paren
id|fb_info.fb_info.modename
comma
l_string|&quot;3Dfx Banshee&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|fb_info.fb_info.modename
comma
l_string|&quot;3Dfx Voodoo3&quot;
)paren
suffix:semicolon
id|fb_info.fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fb_info.fb_info.node
op_assign
op_minus
l_int|1
suffix:semicolon
id|fb_info.fb_info.fbops
op_assign
op_amp
id|tdfxfb_ops
suffix:semicolon
id|fb_info.fb_info.disp
op_assign
op_amp
id|fb_info.disp
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.fb_info.fontname
comma
id|fontname
)paren
suffix:semicolon
id|fb_info.fb_info.switch_con
op_assign
op_amp
id|tdfxfb_switch_con
suffix:semicolon
id|fb_info.fb_info.updatevar
op_assign
op_amp
id|tdfxfb_updatevar
suffix:semicolon
id|fb_info.fb_info.blank
op_assign
op_amp
id|tdfxfb_blank
suffix:semicolon
id|fb_info.fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
id|var
op_assign
id|default_mode
(braket
id|default_mode_index
OL
id|modes
ques
c_cond
id|default_mode_index
suffix:colon
l_int|0
)braket
dot
id|var
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|var
comma
l_int|0
comma
r_sizeof
(paren
id|var
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode_option
op_logical_or
op_logical_neg
id|fb_find_mode
c_func
(paren
op_amp
id|var
comma
op_amp
id|fb_info.fb_info
comma
id|mode_option
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|8
)paren
)paren
(brace
id|var
op_assign
id|default_mode
(braket
l_int|0
)braket
dot
id|var
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|noaccel
)paren
(brace
id|var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
)brace
r_else
id|var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_if
c_cond
(paren
id|tdfxfb_decode_var
c_func
(paren
op_amp
id|var
comma
op_amp
id|fb_info.default_par
comma
op_amp
id|fb_info
)paren
)paren
(brace
multiline_comment|/* ugh -- can&squot;t use the mode from the mode db. (or command line),&n;&t;   so try the default */
id|printk
c_func
(paren
l_string|&quot;tdfxfb: &quot;
l_string|&quot;can&squot;t decode the supplied video mode, using default&bslash;n&quot;
)paren
suffix:semicolon
id|var
op_assign
id|default_mode
(braket
l_int|0
)braket
dot
id|var
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
(brace
id|var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
)brace
r_else
id|var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_if
c_cond
(paren
id|tdfxfb_decode_var
c_func
(paren
op_amp
id|var
comma
op_amp
id|fb_info.default_par
comma
op_amp
id|fb_info
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tdfxfb: can&squot;t decode default video mode&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_return
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
)brace
)brace
id|fb_info.disp.screen_base
op_assign
(paren
r_void
op_star
)paren
id|fb_info.bufbase_virt
suffix:semicolon
id|fb_info.disp.visual
op_assign
id|var.bits_per_pixel
op_eq
l_int|8
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|fb_info.disp.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fb_info.disp.type_aux
op_assign
l_int|0
suffix:semicolon
id|fb_info.disp.ypanstep
op_assign
(paren
id|nowrap
op_logical_and
id|nopan
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|fb_info.disp.ywrapstep
op_assign
id|nowrap
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|fb_info.disp.line_length
op_assign
id|fb_info.disp.next_line
op_assign
id|var.xres
op_star
(paren
id|var.bits_per_pixel
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|fb_info.disp.can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|fb_info.disp.inverse
op_assign
id|inverse
suffix:semicolon
id|fb_info.disp.scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|fb_info.disp.var
op_assign
id|var
suffix:semicolon
id|tdfxfb_set_disp
c_func
(paren
op_amp
id|fb_info.disp
comma
op_amp
id|fb_info
comma
id|var.bits_per_pixel
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|k
op_assign
id|color_table
(braket
id|j
)braket
suffix:semicolon
id|fb_info.palette
(braket
id|j
)braket
dot
id|red
op_assign
id|default_red
(braket
id|k
)braket
suffix:semicolon
id|fb_info.palette
(braket
id|j
)braket
dot
id|green
op_assign
id|default_grn
(braket
id|k
)braket
suffix:semicolon
id|fb_info.palette
(braket
id|j
)braket
dot
id|blue
op_assign
id|default_blu
(braket
id|k
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tdfxfb_set_var
c_func
(paren
op_amp
id|var
comma
op_minus
l_int|1
comma
op_amp
id|fb_info.fb_info
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tdfxfb: can&squot;t set default video mode&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_return
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info.fb_info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tdfxfb: can&squot;t register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_return
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
)brace
id|printk
c_func
(paren
l_string|&quot;fb%d: %s frame buffer device&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|fb_info.fb_info.node
)paren
comma
id|fb_info.fb_info.modename
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_return
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_return
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
)brace
DECL|function|tdfxfb_setup
r_void
id|tdfxfb_setup
c_func
(paren
r_char
op_star
id|options
comma
r_int
op_star
id|ints
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|this_opt
op_assign
id|strtok
c_func
(paren
id|options
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|this_opt
suffix:semicolon
id|this_opt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|inverse
op_assign
l_int|1
suffix:semicolon
id|fb_invert_cmaps
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nopan&quot;
)paren
)paren
(brace
id|nopan
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nowrap&quot;
)paren
)paren
(brace
id|nowrap
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|fontname
comma
id|this_opt
op_plus
l_int|5
comma
l_int|40
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|modes
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
id|default_mode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|default_mode_index
op_assign
id|i
suffix:semicolon
)brace
)brace
macro_line|#else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
macro_line|#endif
)brace
)brace
)brace
DECL|function|tdfxfb_switch_con
r_static
r_int
id|tdfxfb_switch_con
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|info
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
r_struct
id|tdfxfb_par
id|par
suffix:semicolon
multiline_comment|/* Do we have to save the colormap? */
r_if
c_cond
(paren
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap.len
)paren
(brace
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|tdfxfb_getcolreg
comma
id|fb
)paren
suffix:semicolon
)brace
id|currcon
op_assign
id|con
suffix:semicolon
id|tdfxfb_decode_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
id|tdfxfb_set_par
c_func
(paren
op_amp
id|par
comma
id|info
)paren
suffix:semicolon
id|tdfxfb_set_disp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
comma
id|info
comma
id|par.bpp
comma
id|par.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
suffix:semicolon
id|tdfxfb_install_cmap
c_func
(paren
id|con
comma
id|fb
)paren
suffix:semicolon
id|tdfxfb_updatevar
c_func
(paren
id|con
comma
id|fb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* 0 unblank, 1 blank, 2 no vsync, 3 no hsync, 4 off */
DECL|function|tdfxfb_blank
r_static
r_void
id|tdfxfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
id|u32
id|dacmode
comma
id|state
op_assign
l_int|0
comma
id|vgablank
op_assign
l_int|0
suffix:semicolon
id|dacmode
op_assign
id|tdfx_inl
c_func
(paren
id|DACMODE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Screen: On; HSync: On, VSync: On */
id|state
op_assign
l_int|0
suffix:semicolon
id|vgablank
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Screen: Off; HSync: On, VSync: On */
id|state
op_assign
l_int|0
suffix:semicolon
id|vgablank
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Screen: Off; HSync: On, VSync: Off */
id|state
op_assign
id|BIT
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|vgablank
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* Screen: Off; HSync: Off, VSync: On */
id|state
op_assign
id|BIT
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|vgablank
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* Screen: Off; HSync: Off, VSync: Off */
id|state
op_assign
id|BIT
c_func
(paren
l_int|1
)paren
op_or
id|BIT
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|vgablank
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dacmode
op_and_assign
op_complement
(paren
id|BIT
c_func
(paren
l_int|1
)paren
op_or
id|BIT
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|dacmode
op_or_assign
id|state
suffix:semicolon
id|tdfx_outl
c_func
(paren
id|DACMODE
comma
id|dacmode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vgablank
)paren
(brace
id|vga_disable_video
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
id|vga_enable_video
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|tdfxfb_updatevar
r_static
r_int
id|tdfxfb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|currcon
op_logical_or
(paren
id|nowrap
op_logical_and
id|nopan
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|var
suffix:semicolon
r_return
id|tdfxfb_pan_display
c_func
(paren
id|var
comma
id|con
comma
id|fb
)paren
suffix:semicolon
)brace
)brace
DECL|function|tdfxfb_getcolreg
r_static
r_int
id|tdfxfb_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|i
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|fb
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
op_star
id|red
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_lshift
l_int|8
op_or
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|regno
OG
l_int|255
suffix:semicolon
)brace
DECL|function|tdfxfb_setcolreg
r_static
r_int
id|tdfxfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_info_tdfx
op_star
id|i
op_assign
(paren
r_struct
id|fb_info_tdfx
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|i-&gt;current_par.bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|i-&gt;fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|0
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|i-&gt;fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xff00
)paren
op_lshift
l_int|0
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;bad depth %u&bslash;n&quot;
comma
id|i-&gt;current_par.bpp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
op_rshift
l_int|8
suffix:semicolon
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
op_rshift
l_int|8
suffix:semicolon
id|i-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;current_par.bpp
op_eq
l_int|8
)paren
(brace
id|vga_outb
c_func
(paren
id|DAC_IW
comma
(paren
r_int
r_char
)paren
id|regno
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|DAC_D
comma
(paren
r_int
r_char
)paren
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|DAC_D
comma
(paren
r_int
r_char
)paren
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|vga_outb
c_func
(paren
id|DAC_D
comma
(paren
r_int
r_char
)paren
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
)brace
r_return
id|regno
OG
l_int|255
suffix:semicolon
)brace
DECL|function|tdfxfb_install_cmap
r_static
r_void
id|tdfxfb_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|currcon
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|tdfxfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|size
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
op_eq
l_int|16
ques
c_cond
l_int|32
suffix:colon
l_int|256
suffix:semicolon
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|size
)paren
comma
l_int|1
comma
id|tdfxfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
)brace
eof
