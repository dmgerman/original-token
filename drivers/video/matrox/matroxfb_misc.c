multiline_comment|/*&n; *&n; * Hardware accelerated Matrox Millennium I, II, Mystique, G100, G200 and G400&n; *&n; * (c) 1998,1999,2000 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&n; *&n; * Version: 1.50 2000/08/10&n; *&n; * MTRR stuff: 1998 Tom Rini &lt;trini@kernel.crashing.org&gt;&n; *&n; * Contributors: &quot;menion?&quot; &lt;menion@mindless.com&gt;&n; *                     Betatesting, fixes, ideas&n; *&n; *               &quot;Kurt Garloff&quot; &lt;garloff@suse.de&gt;&n; *                     Betatesting, fixes, ideas, videomodes, videomodes timmings&n; *&n; *               &quot;Tom Rini&quot; &lt;trini@kernel.crashing.org&gt;&n; *                     MTRR stuff, PPC cleanups, betatesting, fixes, ideas&n; *&n; *               &quot;Bibek Sahu&quot; &lt;scorpio@dodds.net&gt;&n; *                     Access device through readb|w|l and write b|w|l&n; *                     Extensive debugging stuff&n; *&n; *               &quot;Daniel Haun&quot; &lt;haund@usa.net&gt;&n; *                     Testing, hardware cursor fixes&n; *&n; *               &quot;Scott Wood&quot; &lt;sawst46+@pitt.edu&gt;&n; *                     Fixes&n; *&n; *               &quot;Gerd Knorr&quot; &lt;kraxel@goldbach.isdn.cs.tu-berlin.de&gt;&n; *                     Betatesting&n; *&n; *               &quot;Kelly French&quot; &lt;targon@hazmat.com&gt;&n; *               &quot;Fernando Herrera&quot; &lt;fherrera@eurielec.etsit.upm.es&gt;&n; *                     Betatesting, bug reporting&n; *&n; *               &quot;Pablo Bianucci&quot; &lt;pbian@pccp.com.ar&gt;&n; *                     Fixes, ideas, betatesting&n; *&n; *               &quot;Inaky Perez Gonzalez&quot; &lt;inaky@peloncho.fis.ucm.es&gt;&n; *                     Fixes, enhandcements, ideas, betatesting&n; *&n; *               &quot;Ryuichi Oikawa&quot; &lt;roikawa@rr.iiij4u.or.jp&gt;&n; *                     PPC betatesting, PPC support, backward compatibility&n; *&n; *               &quot;Paul Womar&quot; &lt;Paul@pwomar.demon.co.uk&gt;&n; *               &quot;Owen Waller&quot; &lt;O.Waller@ee.qub.ac.uk&gt;&n; *                     PPC betatesting&n; *&n; *               &quot;Thomas Pornin&quot; &lt;pornin@bolet.ens.fr&gt;&n; *                     Alpha betatesting&n; *&n; *               &quot;Pieter van Leuven&quot; &lt;pvl@iae.nl&gt;&n; *               &quot;Ulf Jaenicke-Roessler&quot; &lt;ujr@physik.phy.tu-dresden.de&gt;&n; *                     G100 testing&n; *&n; *               &quot;H. Peter Arvin&quot; &lt;hpa@transmeta.com&gt;&n; *                     Ideas&n; *&n; *               &quot;Cort Dougan&quot; &lt;cort@cs.nmt.edu&gt;&n; *                     CHRP fixes and PReP cleanup&n; *&n; *               &quot;Mark Vojkovich&quot; &lt;mvojkovi@ucsd.edu&gt;&n; *                     G400 support&n; *&n; * (following author is not in any relation with this code, but his code&n; *  is included in this driver)&n; *&n; * Based on framebuffer driver for VBE 2.0 compliant graphic boards&n; *     (c) 1998 Gerd Knorr &lt;kraxel@cs.tu-berlin.de&gt;&n; *&n; * (following author is not in any relation with this code, but his ideas&n; *  were used when writting this driver)&n; *&n; *&t;&t; FreeVBE/AF (Matrox), &quot;Shawn Hargreaves&quot; &lt;shawn@talula.demon.co.uk&gt;&n; *&n; */
multiline_comment|/* make checkconfig does not check includes for this... */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;matroxfb_misc.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/matroxfb.h&gt;
DECL|function|matroxfb_createcursorshape
r_void
id|matroxfb_createcursorshape
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
comma
r_int
id|vmode
)paren
(brace
r_int
r_int
id|h
suffix:semicolon
r_int
r_int
id|cu
comma
id|cd
suffix:semicolon
id|h
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
id|h
op_mul_assign
l_int|2
suffix:semicolon
id|cd
op_assign
id|h
suffix:semicolon
r_if
c_cond
(paren
id|cd
op_ge
l_int|10
)paren
id|cd
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|cursor.type
)paren
op_assign
(paren
id|p-&gt;conp-&gt;vc_cursor_type
op_amp
id|CUR_HWMASK
)paren
)paren
(brace
r_case
id|CUR_NONE
suffix:colon
id|cu
op_assign
id|cd
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_UNDERLINE
suffix:colon
id|cu
op_assign
id|cd
op_minus
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_LOWER_THIRD
suffix:colon
id|cu
op_assign
(paren
id|h
op_star
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_LOWER_HALF
suffix:colon
id|cu
op_assign
id|h
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_TWO_THIRDS
suffix:colon
id|cu
op_assign
id|h
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_BLOCK
suffix:colon
r_default
suffix:colon
id|cu
op_assign
l_int|0
suffix:semicolon
id|cd
op_assign
id|h
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ACCESS_FBINFO
c_func
(paren
id|cursor.w
)paren
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cursor.u
)paren
op_assign
id|cu
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cursor.d
)paren
op_assign
id|cd
suffix:semicolon
)brace
DECL|function|matroxfb_DAC_out
r_void
id|matroxfb_DAC_out
c_func
(paren
id|CPMINFO
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|DBG_REG
c_func
(paren
l_string|&quot;outDAC&quot;
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_RAMDAC_BASE
op_plus
id|M_X_INDEX
comma
id|reg
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_RAMDAC_BASE
op_plus
id|M_X_DATAREG
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|matroxfb_DAC_in
r_int
id|matroxfb_DAC_in
c_func
(paren
id|CPMINFO
r_int
id|reg
)paren
(brace
id|DBG_REG
c_func
(paren
l_string|&quot;inDAC&quot;
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_RAMDAC_BASE
op_plus
id|M_X_INDEX
comma
id|reg
)paren
suffix:semicolon
r_return
id|mga_inb
c_func
(paren
id|M_RAMDAC_BASE
op_plus
id|M_X_DATAREG
)paren
suffix:semicolon
)brace
DECL|function|matroxfb_var2my
r_void
id|matroxfb_var2my
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|my_timming
op_star
id|mt
)paren
(brace
r_int
r_int
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;var2my&quot;
)paren
r_if
c_cond
(paren
op_logical_neg
id|pixclock
)paren
id|pixclock
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10ns = 100MHz */
id|mt-&gt;pixclock
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
r_if
c_cond
(paren
id|mt-&gt;pixclock
OL
l_int|1
)paren
id|mt-&gt;pixclock
op_assign
l_int|1
suffix:semicolon
id|mt-&gt;dblscan
op_assign
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
suffix:semicolon
id|mt-&gt;interlaced
op_assign
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
suffix:semicolon
id|mt-&gt;HDisplay
op_assign
id|var-&gt;xres
suffix:semicolon
id|mt-&gt;HSyncStart
op_assign
id|mt-&gt;HDisplay
op_plus
id|var-&gt;right_margin
suffix:semicolon
id|mt-&gt;HSyncEnd
op_assign
id|mt-&gt;HSyncStart
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|mt-&gt;HTotal
op_assign
id|mt-&gt;HSyncEnd
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|mt-&gt;VDisplay
op_assign
id|var-&gt;yres
suffix:semicolon
id|mt-&gt;VSyncStart
op_assign
id|mt-&gt;VDisplay
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|mt-&gt;VSyncEnd
op_assign
id|mt-&gt;VSyncStart
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|mt-&gt;VTotal
op_assign
id|mt-&gt;VSyncEnd
op_plus
id|var-&gt;upper_margin
suffix:semicolon
id|mt-&gt;sync
op_assign
id|var-&gt;sync
suffix:semicolon
)brace
DECL|function|matroxfb_PLL_calcclock
r_int
id|matroxfb_PLL_calcclock
c_func
(paren
r_const
r_struct
id|matrox_pll_features
op_star
id|pll
comma
r_int
r_int
id|freq
comma
r_int
r_int
id|fmax
comma
r_int
r_int
op_star
id|in
comma
r_int
r_int
op_star
id|feed
comma
r_int
r_int
op_star
id|post
)paren
(brace
r_int
r_int
id|bestdiff
op_assign
op_complement
l_int|0
suffix:semicolon
r_int
r_int
id|bestvco
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|fxtal
op_assign
id|pll-&gt;ref_freq
suffix:semicolon
r_int
r_int
id|fwant
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;PLL_calcclock&quot;
)paren
id|fwant
op_assign
id|freq
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;post_shift_max: %d&bslash;n&quot;
comma
id|pll-&gt;post_shift_max
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ref_freq: %d&bslash;n&quot;
comma
id|pll-&gt;ref_freq
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;freq: %d&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vco_freq_min: %d&bslash;n&quot;
comma
id|pll-&gt;vco_freq_min
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;in_div_min: %d&bslash;n&quot;
comma
id|pll-&gt;in_div_min
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;in_div_max: %d&bslash;n&quot;
comma
id|pll-&gt;in_div_max
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;feed_div_min: %d&bslash;n&quot;
comma
id|pll-&gt;feed_div_min
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;feed_div_max: %d&bslash;n&quot;
comma
id|pll-&gt;feed_div_max
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;fmax: %d&bslash;n&quot;
comma
id|fmax
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|p
op_assign
l_int|1
suffix:semicolon
id|p
op_le
id|pll-&gt;post_shift_max
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fwant
op_star
l_int|2
OG
id|fmax
)paren
r_break
suffix:semicolon
id|fwant
op_mul_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fwant
OL
id|pll-&gt;vco_freq_min
)paren
id|fwant
op_assign
id|pll-&gt;vco_freq_min
suffix:semicolon
r_if
c_cond
(paren
id|fwant
OG
id|fmax
)paren
id|fwant
op_assign
id|fmax
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|p
op_decrement
OG
l_int|0
suffix:semicolon
id|fwant
op_rshift_assign
l_int|1
comma
id|bestdiff
op_rshift_assign
l_int|1
)paren
(brace
r_int
r_int
id|m
suffix:semicolon
r_if
c_cond
(paren
id|fwant
OL
id|pll-&gt;vco_freq_min
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|m
op_assign
id|pll-&gt;in_div_min
suffix:semicolon
id|m
op_le
id|pll-&gt;in_div_max
suffix:semicolon
id|m
op_increment
)paren
(brace
r_int
r_int
id|diff
comma
id|fvco
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
id|n
op_assign
(paren
id|fwant
op_star
(paren
id|m
op_plus
l_int|1
)paren
op_plus
(paren
id|fxtal
op_rshift
l_int|1
)paren
)paren
op_div
id|fxtal
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|pll-&gt;feed_div_max
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
id|pll-&gt;feed_div_min
)paren
id|n
op_assign
id|pll-&gt;feed_div_min
suffix:semicolon
id|fvco
op_assign
(paren
id|fxtal
op_star
(paren
id|n
op_plus
l_int|1
)paren
)paren
op_div
(paren
id|m
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fvco
OL
id|fwant
)paren
id|diff
op_assign
id|fwant
op_minus
id|fvco
suffix:semicolon
r_else
id|diff
op_assign
id|fvco
op_minus
id|fwant
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
id|bestdiff
)paren
(brace
id|bestdiff
op_assign
id|diff
suffix:semicolon
op_star
id|post
op_assign
id|p
suffix:semicolon
op_star
id|in
op_assign
id|m
suffix:semicolon
op_star
id|feed
op_assign
id|n
suffix:semicolon
id|bestvco
op_assign
id|fvco
suffix:semicolon
)brace
)brace
)brace
id|dprintk
c_func
(paren
id|KERN_ERR
l_string|&quot;clk: %02X %02X %02X %d %d %d&bslash;n&quot;
comma
op_star
id|in
comma
op_star
id|feed
comma
op_star
id|post
comma
id|fxtal
comma
id|bestvco
comma
id|fwant
)paren
suffix:semicolon
r_return
id|bestvco
suffix:semicolon
)brace
DECL|function|matroxfb_vgaHWinit
r_int
id|matroxfb_vgaHWinit
c_func
(paren
id|CPMINFO
r_struct
id|matrox_hw_state
op_star
id|hw
comma
r_struct
id|my_timming
op_star
id|m
comma
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
r_int
id|hd
comma
id|hs
comma
id|he
comma
id|hbe
comma
id|ht
suffix:semicolon
r_int
r_int
id|vd
comma
id|vs
comma
id|ve
comma
id|vt
suffix:semicolon
r_int
r_int
id|wd
suffix:semicolon
r_int
r_int
id|divider
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|text
op_assign
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
suffix:semicolon
r_int
id|fwidth
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
id|fwidth
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fwidth
)paren
id|fwidth
op_assign
l_int|8
suffix:semicolon
)brace
r_else
id|fwidth
op_assign
l_int|8
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;vgaHWinit&quot;
)paren
id|hw-&gt;SEQ
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|fwidth
op_eq
l_int|9
)paren
id|hw-&gt;SEQ
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
r_else
id|hw-&gt;SEQ
(braket
l_int|1
)braket
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* or 0x09 */
id|hw-&gt;SEQ
(braket
l_int|2
)braket
op_assign
l_int|0x0F
suffix:semicolon
multiline_comment|/* bitplanes */
id|hw-&gt;SEQ
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
id|hw-&gt;SEQ
(braket
l_int|4
)braket
op_assign
l_int|0x02
suffix:semicolon
r_else
id|hw-&gt;SEQ
(braket
l_int|4
)braket
op_assign
l_int|0x0E
suffix:semicolon
multiline_comment|/* CRTC 0..7, 9, 16..19, 21, 22 are reprogrammed by Matrox Millennium code... Hope that by MGA1064 too */
r_if
c_cond
(paren
id|m-&gt;dblscan
)paren
(brace
id|m-&gt;VTotal
op_lshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VDisplay
op_lshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VSyncStart
op_lshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VSyncEnd
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m-&gt;interlaced
)paren
(brace
id|m-&gt;VTotal
op_rshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VDisplay
op_rshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VSyncStart
op_rshift_assign
l_int|1
suffix:semicolon
id|m-&gt;VSyncEnd
op_rshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* GCTL is ignored when not using 0xA0000 aperture */
id|hw-&gt;GCTL
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|4
)braket
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
id|hw-&gt;GCTL
(braket
l_int|5
)braket
op_assign
l_int|0x10
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|6
)braket
op_assign
l_int|0x02
suffix:semicolon
)brace
r_else
(brace
id|hw-&gt;GCTL
(braket
l_int|5
)braket
op_assign
l_int|0x40
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|6
)braket
op_assign
l_int|0x05
suffix:semicolon
)brace
id|hw-&gt;GCTL
(braket
l_int|7
)braket
op_assign
l_int|0x0F
suffix:semicolon
id|hw-&gt;GCTL
(braket
l_int|8
)braket
op_assign
l_int|0xFF
suffix:semicolon
multiline_comment|/* Whole ATTR is ignored in PowerGraphics mode */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|hw-&gt;ATTR
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
id|hw-&gt;ATTR
(braket
l_int|16
)braket
op_assign
l_int|0x04
suffix:semicolon
)brace
r_else
(brace
id|hw-&gt;ATTR
(braket
l_int|16
)braket
op_assign
l_int|0x41
suffix:semicolon
)brace
id|hw-&gt;ATTR
(braket
l_int|17
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|hw-&gt;ATTR
(braket
l_int|18
)braket
op_assign
l_int|0x0F
suffix:semicolon
r_if
c_cond
(paren
id|fwidth
op_eq
l_int|9
)paren
id|hw-&gt;ATTR
(braket
l_int|19
)braket
op_assign
l_int|0x08
suffix:semicolon
r_else
id|hw-&gt;ATTR
(braket
l_int|19
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;ATTR
(braket
l_int|20
)braket
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
id|hd
op_assign
id|m-&gt;HDisplay
op_div
id|fwidth
suffix:semicolon
id|hs
op_assign
id|m-&gt;HSyncStart
op_div
id|fwidth
suffix:semicolon
id|he
op_assign
id|m-&gt;HSyncEnd
op_div
id|fwidth
suffix:semicolon
id|ht
op_assign
id|m-&gt;HTotal
op_div
id|fwidth
suffix:semicolon
id|divider
op_assign
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|hd
op_assign
id|m-&gt;HDisplay
op_rshift
l_int|3
suffix:semicolon
id|hs
op_assign
id|m-&gt;HSyncStart
op_rshift
l_int|3
suffix:semicolon
id|he
op_assign
id|m-&gt;HSyncEnd
op_rshift
l_int|3
suffix:semicolon
id|ht
op_assign
id|m-&gt;HTotal
op_rshift
l_int|3
suffix:semicolon
multiline_comment|/* standard timmings are in 8pixels, but for interleaved we cannot */
multiline_comment|/* do it for 4bpp (because of (4bpp &gt;&gt; 1(interleaved))/4 == 0) */
multiline_comment|/* using 16 or more pixels per unit can save us */
id|divider
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|curr.final_bppShift
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|divider
op_amp
l_int|3
)paren
(brace
id|hd
op_rshift_assign
l_int|1
suffix:semicolon
id|hs
op_rshift_assign
l_int|1
suffix:semicolon
id|he
op_rshift_assign
l_int|1
suffix:semicolon
id|ht
op_rshift_assign
l_int|1
suffix:semicolon
id|divider
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|divider
op_assign
id|divider
op_div
l_int|4
suffix:semicolon
multiline_comment|/* divider can be from 1 to 8 */
r_while
c_loop
(paren
id|divider
OG
l_int|8
)paren
(brace
id|hd
op_lshift_assign
l_int|1
suffix:semicolon
id|hs
op_lshift_assign
l_int|1
suffix:semicolon
id|he
op_lshift_assign
l_int|1
suffix:semicolon
id|ht
op_lshift_assign
l_int|1
suffix:semicolon
id|divider
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|hd
op_assign
id|hd
op_minus
l_int|1
suffix:semicolon
id|hs
op_assign
id|hs
op_minus
l_int|1
suffix:semicolon
id|he
op_assign
id|he
op_minus
l_int|1
suffix:semicolon
id|ht
op_assign
id|ht
op_minus
l_int|1
suffix:semicolon
id|vd
op_assign
id|m-&gt;VDisplay
op_minus
l_int|1
suffix:semicolon
id|vs
op_assign
id|m-&gt;VSyncStart
op_minus
l_int|1
suffix:semicolon
id|ve
op_assign
id|m-&gt;VSyncEnd
op_minus
l_int|1
suffix:semicolon
id|vt
op_assign
id|m-&gt;VTotal
op_minus
l_int|2
suffix:semicolon
multiline_comment|/* G200 cannot work with (ht &amp; 7) == 6 */
r_if
c_cond
(paren
(paren
(paren
id|ht
op_amp
l_int|0x07
)paren
op_eq
l_int|0x06
)paren
op_logical_or
(paren
(paren
id|ht
op_amp
l_int|0x0F
)paren
op_eq
l_int|0x04
)paren
)paren
id|ht
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
id|hbe
op_assign
id|ht
op_minus
l_int|1
suffix:semicolon
id|wd
op_assign
id|p-&gt;var.xres_virtual
op_div
(paren
id|fwidth
op_star
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|hbe
op_assign
id|ht
suffix:semicolon
id|wd
op_assign
id|p-&gt;var.xres_virtual
op_star
id|ACCESS_FBINFO
c_func
(paren
id|curr.final_bppShift
)paren
op_div
l_int|64
suffix:semicolon
)brace
id|hw-&gt;CRTCEXT
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;CRTCEXT
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;interlaced
)paren
(brace
id|hw-&gt;CRTCEXT
(braket
l_int|0
)braket
op_assign
l_int|0x80
suffix:semicolon
id|hw-&gt;CRTCEXT
(braket
l_int|5
)braket
op_assign
(paren
id|hs
op_plus
id|he
op_minus
id|ht
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|m-&gt;dblscan
)paren
id|wd
op_lshift_assign
l_int|1
suffix:semicolon
id|vt
op_and_assign
op_complement
l_int|1
suffix:semicolon
)brace
id|hw-&gt;CRTCEXT
(braket
l_int|0
)braket
op_or_assign
(paren
id|wd
op_amp
l_int|0x300
)paren
op_rshift
l_int|4
suffix:semicolon
id|hw-&gt;CRTCEXT
(braket
l_int|1
)braket
op_assign
(paren
(paren
(paren
id|ht
op_minus
l_int|4
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
id|hd
op_amp
l_int|0x100
)paren
op_rshift
l_int|7
)paren
op_or
multiline_comment|/* blanking */
(paren
(paren
id|hs
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
multiline_comment|/* sync start */
(paren
id|hbe
op_amp
l_int|0x040
)paren
suffix:semicolon
multiline_comment|/* end hor. blanking */
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|output.ph
)paren
op_amp
id|MATROXFB_OUTPUT_CONN_SECONDARY
)paren
id|hw-&gt;CRTCEXT
(braket
l_int|1
)braket
op_or_assign
l_int|0x88
suffix:semicolon
multiline_comment|/* enable horizontal and vertical vidrst */
id|hw-&gt;CRTCEXT
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|vt
op_amp
l_int|0xC00
)paren
op_rshift
l_int|10
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x400
)paren
op_rshift
l_int|8
)paren
op_or
multiline_comment|/* disp end */
(paren
(paren
id|vd
op_amp
l_int|0xC00
)paren
op_rshift
l_int|7
)paren
op_or
multiline_comment|/* vblanking start */
(paren
(paren
id|vs
op_amp
l_int|0xC00
)paren
op_rshift
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
id|hw-&gt;CRTCEXT
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
r_else
id|hw-&gt;CRTCEXT
(braket
l_int|3
)braket
op_assign
(paren
id|divider
op_minus
l_int|1
)paren
op_or
l_int|0x80
suffix:semicolon
id|hw-&gt;CRTCEXT
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|0
)braket
op_assign
id|ht
op_minus
l_int|4
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|1
)braket
op_assign
id|hd
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|2
)braket
op_assign
id|hd
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|3
)braket
op_assign
(paren
id|hbe
op_amp
l_int|0x1F
)paren
op_or
l_int|0x80
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|4
)braket
op_assign
id|hs
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|5
)braket
op_assign
(paren
(paren
id|hbe
op_amp
l_int|0x20
)paren
op_lshift
l_int|2
)paren
op_or
(paren
id|he
op_amp
l_int|0x1F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
id|hw-&gt;CRTC
(braket
l_int|5
)braket
op_or_assign
l_int|0x60
suffix:semicolon
multiline_comment|/* delay sync for 3 clocks (to same picture position on MGA and VGA) */
id|hw-&gt;CRTC
(braket
l_int|6
)braket
op_assign
id|vt
op_amp
l_int|0xFF
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|7
)braket
op_assign
(paren
(paren
id|vt
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x100
)paren
op_rshift
l_int|7
)paren
op_or
(paren
(paren
id|vs
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x100
)paren
op_rshift
l_int|5
)paren
op_or
l_int|0x10
op_or
(paren
(paren
id|vt
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|vd
op_amp
l_int|0x200
)paren
op_rshift
l_int|3
)paren
op_or
(paren
(paren
id|vs
op_amp
l_int|0x200
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|8
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|9
)braket
op_assign
(paren
(paren
id|vd
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
op_or
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
id|hw-&gt;CRTC
(braket
l_int|9
)braket
op_or_assign
id|fontheight
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;dblscan
op_logical_and
op_logical_neg
id|m-&gt;interlaced
)paren
id|hw-&gt;CRTC
(braket
l_int|9
)braket
op_or_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|10
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|hw-&gt;CRTC
(braket
id|i
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|16
)braket
op_assign
id|vs
multiline_comment|/* &amp; 0xFF */
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|17
)braket
op_assign
(paren
id|ve
op_amp
l_int|0x0F
)paren
op_or
l_int|0x20
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|18
)braket
op_assign
id|vd
multiline_comment|/* &amp; 0xFF */
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|19
)braket
op_assign
id|wd
multiline_comment|/* &amp; 0xFF */
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|20
)braket
op_assign
l_int|0x00
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|21
)braket
op_assign
id|vd
multiline_comment|/* &amp; 0xFF */
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|22
)braket
op_assign
(paren
id|vt
op_plus
l_int|1
)paren
multiline_comment|/* &amp; 0xFF */
suffix:semicolon
r_if
c_cond
(paren
id|text
)paren
(brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textmode
)paren
op_eq
l_int|1
)paren
id|hw-&gt;CRTC
(braket
l_int|23
)braket
op_assign
l_int|0xC3
suffix:semicolon
r_else
id|hw-&gt;CRTC
(braket
l_int|23
)braket
op_assign
l_int|0xA3
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textmode
)paren
op_eq
l_int|4
)paren
id|hw-&gt;CRTC
(braket
l_int|20
)braket
op_assign
l_int|0x5F
suffix:semicolon
r_else
id|hw-&gt;CRTC
(braket
l_int|20
)braket
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|hw-&gt;CRTC
(braket
l_int|23
)braket
op_assign
l_int|0xC3
suffix:semicolon
id|hw-&gt;CRTC
(braket
l_int|24
)braket
op_assign
l_int|0xFF
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
DECL|function|matroxfb_vgaHWrestore
r_void
id|matroxfb_vgaHWrestore
c_func
(paren
id|WPMINFO
r_struct
id|matrox_hw_state
op_star
id|hw
comma
r_struct
id|matrox_hw_state
op_star
id|oldhw
)paren
(brace
r_int
id|i
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
l_string|&quot;vgaHWrestore&quot;
)paren
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;MiscOutReg: %02X&bslash;n&quot;
comma
id|hw-&gt;MiscOutReg
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;SEQ regs:   &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;%02X:&quot;
comma
id|hw-&gt;SEQ
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;GDC regs:   &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;%02X:&quot;
comma
id|hw-&gt;GCTL
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;CRTC regs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;%02X:&quot;
comma
id|hw-&gt;CRTC
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;ATTR regs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;%02X:&quot;
comma
id|hw-&gt;ATTR
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_inb
c_func
(paren
id|M_ATTR_RESET
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_ATTR_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_MISC_REG
comma
id|hw-&gt;MiscOutReg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
id|i
comma
id|hw-&gt;SEQ
(braket
id|i
)braket
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|17
comma
id|hw-&gt;CRTC
(braket
l_int|17
)braket
op_amp
l_int|0x7F
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
id|i
comma
id|hw-&gt;CRTC
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|mga_setr
c_func
(paren
id|M_GRAPHICS_INDEX
comma
id|i
comma
id|hw-&gt;GCTL
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mga_inb
c_func
(paren
id|M_ATTR_RESET
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_ATTR_INDEX
comma
id|i
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_ATTR_INDEX
comma
id|hw-&gt;ATTR
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|mga_outb
c_func
(paren
id|M_PALETTE_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_DAC_REG
comma
l_int|0x00
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|768
suffix:semicolon
id|i
op_increment
)paren
id|mga_outb
c_func
(paren
id|M_DAC_VAL
comma
id|hw-&gt;DACpal
(braket
id|i
)braket
)paren
suffix:semicolon
id|mga_inb
c_func
(paren
id|M_ATTR_RESET
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_ATTR_INDEX
comma
l_int|0x20
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matroxfb_fastfont_init
r_void
(def_block
id|matroxfb_fastfont_init
c_func
(paren
r_struct
id|matrox_fb_info
op_star
id|minfo
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
id|size
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.size
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.size
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
(brace
r_int
r_int
id|end
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|video.len_usable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
id|end
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
id|start
op_assign
(paren
id|end
op_minus
id|size
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ge
l_int|0x00100000
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|video.len_usable
)paren
op_assign
id|start
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.mgabase
)paren
op_assign
id|start
op_star
l_int|8
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
suffix:semicolon
id|vaddr_add
c_func
(paren
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
comma
id|start
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.size
)paren
op_assign
id|end
op_minus
id|start
suffix:semicolon
)brace
)brace
)brace
)brace
)def_block
macro_line|#ifndef FNTCHARCNT
DECL|macro|FNTCHARCNT
mdefine_line|#define FNTCHARCNT(fd)&t;(((int *)(fd))[-3])
macro_line|#endif
DECL|function|matrox_text_loadfont
r_int
id|matrox_text_loadfont
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
r_int
id|fsize
suffix:semicolon
r_int
r_int
id|width
suffix:semicolon
id|vaddr_t
id|dst
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u_int8_t
op_star
id|font
suffix:semicolon
id|CRITFLAGS
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
id|p-&gt;fontdata
)paren
r_return
l_int|0
suffix:semicolon
id|width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|fsize
op_assign
id|p-&gt;userfont
ques
c_cond
id|FNTCHARCNT
c_func
(paren
id|p-&gt;fontdata
)paren
suffix:colon
l_int|256
suffix:semicolon
id|dst
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
suffix:semicolon
id|i
op_assign
l_int|2
suffix:semicolon
id|font
op_assign
(paren
id|u_int8_t
op_star
)paren
id|p-&gt;fontdata
suffix:semicolon
id|CRITBEGIN
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|0x02
comma
l_int|0x04
)paren
suffix:semicolon
r_while
c_loop
(paren
id|fsize
op_decrement
)paren
(brace
r_int
id|l
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|l
op_increment
)paren
(brace
id|mga_writeb
c_func
(paren
id|dst
comma
id|i
comma
op_star
id|font
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
OG
l_int|8
)paren
id|font
op_increment
suffix:semicolon
id|i
op_add_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.vgastep
)paren
suffix:semicolon
)brace
id|i
op_add_assign
(paren
l_int|32
op_minus
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_star
id|ACCESS_FBINFO
c_func
(paren
id|devflags.vgastep
)paren
suffix:semicolon
)brace
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|0x02
comma
l_int|0x03
)paren
suffix:semicolon
id|CRITEND
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|matroxfb_fastfont_tryset
r_int
id|matroxfb_fastfont_tryset
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
r_int
id|fsize
suffix:semicolon
r_int
r_int
id|width
suffix:semicolon
id|CRITFLAGS
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
id|p-&gt;fontdata
)paren
r_return
l_int|0
suffix:semicolon
id|width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
l_int|32
)paren
r_return
l_int|0
suffix:semicolon
id|fsize
op_assign
(paren
id|p-&gt;userfont
ques
c_cond
id|FNTCHARCNT
c_func
(paren
id|p-&gt;fontdata
)paren
suffix:colon
l_int|256
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|fsize
op_star
id|width
op_plus
l_int|31
)paren
op_div
l_int|32
)paren
op_star
l_int|4
OG
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.size
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|CRITBEGIN
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|M_OPMODE_8BPP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
op_le
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|width
op_eq
l_int|8
)paren
id|mga_memcpy_toio
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
comma
l_int|0
comma
id|p-&gt;fontdata
comma
id|fsize
)paren
suffix:semicolon
r_else
(brace
id|vaddr_t
id|dst
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u_int8_t
op_star
id|font
suffix:semicolon
id|u_int32_t
id|mask
comma
id|valid
comma
id|reg
suffix:semicolon
id|dst
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
suffix:semicolon
id|font
op_assign
(paren
id|u_int8_t
op_star
)paren
id|p-&gt;fontdata
suffix:semicolon
id|mask
op_assign
op_complement
l_int|0
op_lshift
(paren
l_int|8
op_minus
id|width
)paren
suffix:semicolon
id|valid
op_assign
l_int|0
suffix:semicolon
id|reg
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fsize
op_decrement
)paren
(brace
id|reg
op_or_assign
(paren
op_star
id|font
op_increment
op_amp
id|mask
)paren
op_lshift
(paren
l_int|8
op_minus
id|valid
)paren
suffix:semicolon
id|valid
op_add_assign
id|width
suffix:semicolon
r_if
c_cond
(paren
id|valid
op_ge
l_int|8
)paren
(brace
id|mga_writeb
c_func
(paren
id|dst
comma
id|i
op_increment
comma
id|reg
op_rshift
l_int|8
)paren
suffix:semicolon
id|reg
op_assign
id|reg
op_lshift
l_int|8
suffix:semicolon
id|valid
op_sub_assign
l_int|8
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|valid
)paren
id|mga_writeb
c_func
(paren
id|dst
comma
id|i
comma
id|reg
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|width
op_le
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|width
op_eq
l_int|16
)paren
id|mga_memcpy_toio
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
comma
l_int|0
comma
id|p-&gt;fontdata
comma
id|fsize
op_star
l_int|2
)paren
suffix:semicolon
r_else
(brace
id|vaddr_t
id|dst
suffix:semicolon
id|u_int16_t
op_star
id|font
suffix:semicolon
id|u_int32_t
id|mask
comma
id|valid
comma
id|reg
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|dst
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
suffix:semicolon
id|font
op_assign
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;fontdata
suffix:semicolon
id|mask
op_assign
op_complement
l_int|0
op_lshift
(paren
l_int|16
op_minus
id|width
)paren
suffix:semicolon
id|valid
op_assign
l_int|0
suffix:semicolon
id|reg
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fsize
op_decrement
)paren
(brace
id|reg
op_or_assign
(paren
id|ntohs
c_func
(paren
op_star
id|font
op_increment
)paren
op_amp
id|mask
)paren
op_lshift
(paren
l_int|16
op_minus
id|valid
)paren
suffix:semicolon
id|valid
op_add_assign
id|width
suffix:semicolon
r_if
c_cond
(paren
id|valid
op_ge
l_int|16
)paren
(brace
id|mga_writew
c_func
(paren
id|dst
comma
id|i
comma
id|htons
c_func
(paren
id|reg
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
id|reg
op_assign
id|reg
op_lshift
l_int|16
suffix:semicolon
id|valid
op_sub_assign
l_int|16
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|valid
)paren
id|mga_writew
c_func
(paren
id|dst
comma
id|i
comma
id|htons
c_func
(paren
id|reg
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|width
op_eq
l_int|32
)paren
id|mga_memcpy_toio
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
comma
l_int|0
comma
id|p-&gt;fontdata
comma
id|fsize
op_star
l_int|4
)paren
suffix:semicolon
r_else
(brace
id|vaddr_t
id|dst
suffix:semicolon
id|u_int32_t
op_star
id|font
suffix:semicolon
id|u_int32_t
id|mask
comma
id|valid
comma
id|reg
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|dst
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.vbase
)paren
suffix:semicolon
id|font
op_assign
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;fontdata
suffix:semicolon
id|mask
op_assign
op_complement
l_int|0
op_lshift
(paren
l_int|32
op_minus
id|width
)paren
suffix:semicolon
id|valid
op_assign
l_int|0
suffix:semicolon
id|reg
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fsize
op_decrement
)paren
(brace
id|reg
op_or_assign
(paren
id|ntohl
c_func
(paren
op_star
id|font
)paren
op_amp
id|mask
)paren
op_rshift
id|valid
suffix:semicolon
id|valid
op_add_assign
id|width
suffix:semicolon
r_if
c_cond
(paren
id|valid
op_ge
l_int|32
)paren
(brace
id|mga_writel
c_func
(paren
id|dst
comma
id|i
comma
id|htonl
c_func
(paren
id|reg
)paren
)paren
suffix:semicolon
id|i
op_add_assign
l_int|4
suffix:semicolon
id|valid
op_sub_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|valid
)paren
id|reg
op_assign
(paren
id|ntohl
c_func
(paren
op_star
id|font
)paren
op_amp
id|mask
)paren
op_lshift
(paren
id|width
op_minus
id|valid
)paren
suffix:semicolon
r_else
id|reg
op_assign
l_int|0
suffix:semicolon
)brace
id|font
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|valid
)paren
id|mga_writel
c_func
(paren
id|dst
comma
id|i
comma
id|htonl
c_func
(paren
id|reg
)paren
)paren
suffix:semicolon
)brace
)brace
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_opmode
)paren
)paren
suffix:semicolon
id|CRITEND
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|matroxfb_DAC_in
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_DAC_in
)paren
suffix:semicolon
DECL|variable|matroxfb_DAC_out
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_DAC_out
)paren
suffix:semicolon
DECL|variable|matroxfb_var2my
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_var2my
)paren
suffix:semicolon
DECL|variable|matroxfb_PLL_calcclock
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_PLL_calcclock
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_FB_MATROX_MULTIHEAD
DECL|variable|matroxfb_global_mxinfo
r_struct
id|matrox_fb_info
id|matroxfb_global_mxinfo
suffix:semicolon
DECL|variable|matroxfb_global_mxinfo
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_global_mxinfo
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|matrox_text_loadfont
id|EXPORT_SYMBOL
c_func
(paren
id|matrox_text_loadfont
)paren
suffix:semicolon
multiline_comment|/* for matroxfb_accel */
DECL|variable|matroxfb_createcursorshape
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_createcursorshape
)paren
suffix:semicolon
multiline_comment|/* accel, DAC1064, Ti3026 */
DECL|variable|matroxfb_fastfont_tryset
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_fastfont_tryset
)paren
suffix:semicolon
multiline_comment|/* accel */
DECL|variable|matroxfb_fastfont_init
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_fastfont_init
)paren
suffix:semicolon
multiline_comment|/* DAC1064, Ti3026 */
DECL|variable|matroxfb_vgaHWinit
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_vgaHWinit
)paren
suffix:semicolon
multiline_comment|/* DAC1064, Ti3026 */
DECL|variable|matroxfb_vgaHWrestore
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_vgaHWrestore
)paren
suffix:semicolon
multiline_comment|/* DAC1064, Ti3026 */
macro_line|#ifdef MATROXFB_USE_SPINLOCK
DECL|variable|matroxfb_spinlock
id|spinlock_t
id|matroxfb_spinlock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|matroxfb_spinlock
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_spinlock
)paren
suffix:semicolon
macro_line|#endif
eof
