multiline_comment|/*&n; *&n; * Hardware accelerated Matrox Millennium I, II, Mystique, G100, G200 and G400&n; *&n; * (c) 1998,1999,2000 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&n; *&n; * Version: 1.50 2000/08/10&n; *&n; * MTRR stuff: 1998 Tom Rini &lt;trini@kernel.crashing.org&gt;&n; *&n; * Contributors: &quot;menion?&quot; &lt;menion@mindless.com&gt;&n; *                     Betatesting, fixes, ideas&n; *&n; *               &quot;Kurt Garloff&quot; &lt;garloff@suse.de&gt;&n; *                     Betatesting, fixes, ideas, videomodes, videomodes timmings&n; *&n; *               &quot;Tom Rini&quot; &lt;trini@kernel.crashing.org&gt;&n; *                     MTRR stuff, PPC cleanups, betatesting, fixes, ideas&n; *&n; *               &quot;Bibek Sahu&quot; &lt;scorpio@dodds.net&gt;&n; *                     Access device through readb|w|l and write b|w|l&n; *                     Extensive debugging stuff&n; *&n; *               &quot;Daniel Haun&quot; &lt;haund@usa.net&gt;&n; *                     Testing, hardware cursor fixes&n; *&n; *               &quot;Scott Wood&quot; &lt;sawst46+@pitt.edu&gt;&n; *                     Fixes&n; *&n; *               &quot;Gerd Knorr&quot; &lt;kraxel@goldbach.isdn.cs.tu-berlin.de&gt;&n; *                     Betatesting&n; *&n; *               &quot;Kelly French&quot; &lt;targon@hazmat.com&gt;&n; *               &quot;Fernando Herrera&quot; &lt;fherrera@eurielec.etsit.upm.es&gt;&n; *                     Betatesting, bug reporting&n; *&n; *               &quot;Pablo Bianucci&quot; &lt;pbian@pccp.com.ar&gt;&n; *                     Fixes, ideas, betatesting&n; *&n; *               &quot;Inaky Perez Gonzalez&quot; &lt;inaky@peloncho.fis.ucm.es&gt;&n; *                     Fixes, enhandcements, ideas, betatesting&n; *&n; *               &quot;Ryuichi Oikawa&quot; &lt;roikawa@rr.iiij4u.or.jp&gt;&n; *                     PPC betatesting, PPC support, backward compatibility&n; *&n; *               &quot;Paul Womar&quot; &lt;Paul@pwomar.demon.co.uk&gt;&n; *               &quot;Owen Waller&quot; &lt;O.Waller@ee.qub.ac.uk&gt;&n; *                     PPC betatesting&n; *&n; *               &quot;Thomas Pornin&quot; &lt;pornin@bolet.ens.fr&gt;&n; *                     Alpha betatesting&n; *&n; *               &quot;Pieter van Leuven&quot; &lt;pvl@iae.nl&gt;&n; *               &quot;Ulf Jaenicke-Roessler&quot; &lt;ujr@physik.phy.tu-dresden.de&gt;&n; *                     G100 testing&n; *&n; *               &quot;H. Peter Arvin&quot; &lt;hpa@transmeta.com&gt;&n; *                     Ideas&n; *&n; *               &quot;Cort Dougan&quot; &lt;cort@cs.nmt.edu&gt;&n; *                     CHRP fixes and PReP cleanup&n; *&n; *               &quot;Mark Vojkovich&quot; &lt;mvojkovi@ucsd.edu&gt;&n; *                     G400 support&n; *&n; * (following author is not in any relation with this code, but his code&n; *  is included in this driver)&n; *&n; * Based on framebuffer driver for VBE 2.0 compliant graphic boards&n; *     (c) 1998 Gerd Knorr &lt;kraxel@cs.tu-berlin.de&gt;&n; *&n; * (following author is not in any relation with this code, but his ideas&n; *  were used when writting this driver)&n; *&n; *&t;&t; FreeVBE/AF (Matrox), &quot;Shawn Hargreaves&quot; &lt;shawn@talula.demon.co.uk&gt;&n; *&n; */
macro_line|#include &quot;matroxfb_accel.h&quot;
macro_line|#include &quot;matroxfb_DAC1064.h&quot;
macro_line|#include &quot;matroxfb_Ti3026.h&quot;
macro_line|#include &quot;matroxfb_misc.h&quot;
DECL|macro|curr_ydstorg
mdefine_line|#define curr_ydstorg(x)&t;ACCESS_FBINFO2(x, curr.ydstorg.pixels)
DECL|macro|mga_ydstlen
mdefine_line|#define mga_ydstlen(y,l) mga_outl(M_YDSTLEN | M_EXEC, ((y) &lt;&lt; 16) | (l))
DECL|function|matrox_cfbX_init
r_void
id|matrox_cfbX_init
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
(brace
id|u_int32_t
id|maccess
suffix:semicolon
id|u_int32_t
id|mpitch
suffix:semicolon
id|u_int32_t
id|mopmode
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfbX_init&quot;
)paren
id|mpitch
op_assign
id|p-&gt;var.xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
)paren
(brace
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
id|mpitch
op_assign
(paren
id|mpitch
op_rshift
l_int|4
)paren
op_or
l_int|0x8000
suffix:semicolon
multiline_comment|/* set something */
id|mopmode
op_assign
id|M_OPMODE_8BPP
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|p-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|4
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
multiline_comment|/* accelerate as 8bpp video */
id|mpitch
op_assign
(paren
id|mpitch
op_rshift
l_int|1
)paren
op_or
l_int|0x8000
suffix:semicolon
multiline_comment|/* disable linearization */
id|mopmode
op_assign
id|M_OPMODE_4BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_8BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|p-&gt;var.green.length
op_eq
l_int|5
)paren
id|maccess
op_assign
l_int|0xC0000001
suffix:semicolon
r_else
id|maccess
op_assign
l_int|0x40000001
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_16BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|maccess
op_assign
l_int|0x00000003
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_24BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|maccess
op_assign
l_int|0x00000002
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_32BPP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
id|mopmode
op_assign
l_int|0x00000000
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* turn off acceleration!!! */
)brace
)brace
id|mga_fifo
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_PITCH
comma
id|mpitch
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDSTORG
comma
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|capable.plnwt
)paren
)paren
id|mga_outl
c_func
(paren
id|M_PLNWT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|mopmode
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CXBNDRY
comma
l_int|0xFFFF0000
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YTOP
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YBOT
comma
l_int|0x01FFFFFF
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
id|maccess
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_assign
id|M_DWG_TRAP
op_or
id|M_DWG_SOLID
op_or
id|M_DWG_ARZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
suffix:semicolon
r_if
c_cond
(paren
id|isMilleniumII
c_func
(paren
id|MINFO
)paren
)paren
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or_assign
id|M_DWG_TRANSC
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_opmode
)paren
op_assign
id|mopmode
suffix:semicolon
)brace
DECL|function|matrox_cfbX_bmove
r_static
r_void
id|matrox_cfbX_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|pixx
op_assign
id|p-&gt;var.xres_virtual
comma
id|start
comma
id|end
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfbX_bmove&quot;
)paren
id|CRITBEGIN
id|sx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
(paren
id|dy
op_eq
id|sy
)paren
op_logical_and
(paren
id|dx
op_le
id|sx
)paren
)paren
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
id|pixx
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|start
op_assign
id|sy
op_star
id|pixx
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|width
suffix:semicolon
)brace
r_else
(brace
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_SGN
comma
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
op_minus
id|pixx
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|end
op_assign
(paren
id|sy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|pixx
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|start
op_assign
id|end
op_plus
id|width
suffix:semicolon
id|dy
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
id|mga_fifo
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|end
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|start
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|dx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|dx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|dy
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
macro_line|#ifdef FBCON_HAS_CFB4
DECL|function|matrox_cfb4_bmove
r_static
r_void
id|matrox_cfb4_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|pixx
comma
id|start
comma
id|end
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* both (sx or dx or width) and fontwidth() are odd, so their multiply is&n;&t;   also odd, that means that we cannot use acceleration */
id|DBG
c_func
(paren
l_string|&quot;matrox_cfb4_bmove&quot;
)paren
id|CRITBEGIN
r_if
c_cond
(paren
(paren
id|sx
op_or
id|dx
op_or
id|width
)paren
op_amp
id|fontwidth
c_func
(paren
id|p
)paren
op_amp
l_int|1
)paren
(brace
id|fbcon_cfb4_bmove
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|pixx
op_assign
id|p-&gt;var.xres_virtual
op_rshift
l_int|1
suffix:semicolon
id|sx
op_rshift_assign
l_int|1
suffix:semicolon
id|dx
op_rshift_assign
l_int|1
suffix:semicolon
id|width
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
(paren
id|dy
op_eq
id|sy
)paren
op_logical_and
(paren
id|dx
op_le
id|sx
)paren
)paren
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
id|pixx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|start
op_assign
id|sy
op_star
id|pixx
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|width
suffix:semicolon
)brace
r_else
(brace
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_SGN
comma
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
op_minus
id|pixx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|end
op_assign
(paren
id|sy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|pixx
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|start
op_assign
id|end
op_plus
id|width
suffix:semicolon
id|dy
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|end
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|start
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|dx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|dx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDST
comma
id|dy
op_star
id|pixx
op_rshift
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_LEN
op_or
id|M_EXEC
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
macro_line|#endif
DECL|function|matroxfb_accel_clear
r_static
r_void
id|matroxfb_accel_clear
c_func
(paren
id|WPMINFO
id|u_int32_t
id|color
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|CRITFLAGS
id|DBG
c_func
(paren
l_string|&quot;matroxfb_accel_clear&quot;
)paren
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|color
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|sx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|sx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|sy
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_cfbX_clear
r_static
r_void
id|matrox_cfbX_clear
c_func
(paren
id|u_int32_t
id|color
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|DBG
c_func
(paren
l_string|&quot;matrox_cfbX_clear&quot;
)paren
id|matroxfb_accel_clear
c_func
(paren
id|PMXINFO
c_func
(paren
id|p
)paren
id|color
comma
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
comma
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
comma
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
comma
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef FBCON_HAS_CFB4
DECL|function|matrox_cfb4_clear
r_static
r_void
id|matrox_cfb4_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_int32_t
id|bgx
suffix:semicolon
r_int
id|whattodo
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfb4_clear&quot;
)paren
id|CRITBEGIN
id|whattodo
op_assign
l_int|0
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_or_assign
id|bgx
op_lshift
l_int|4
suffix:semicolon
id|bgx
op_or_assign
id|bgx
op_lshift
l_int|8
suffix:semicolon
id|bgx
op_or_assign
id|bgx
op_lshift
l_int|16
suffix:semicolon
id|sy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|sx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|sx
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|width
)paren
r_return
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|whattodo
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|whattodo
op_or_assign
l_int|2
suffix:semicolon
)brace
id|width
op_rshift_assign
l_int|1
suffix:semicolon
id|sx
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|width
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_REPLACE2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|bgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|sx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|sx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDST
comma
id|sy
op_star
id|p-&gt;var.xres_virtual
op_rshift
l_int|6
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_LEN
op_or
id|M_EXEC
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|whattodo
)paren
(brace
id|u_int32_t
id|step
op_assign
id|p-&gt;var.xres_virtual
op_rshift
l_int|1
suffix:semicolon
id|vaddr_t
id|vbase
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|whattodo
op_amp
l_int|1
)paren
(brace
r_int
r_int
id|uaddr
op_assign
id|sy
op_star
id|step
op_plus
id|sx
op_minus
l_int|1
suffix:semicolon
id|u_int32_t
id|loop
suffix:semicolon
id|u_int8_t
id|bgx2
op_assign
id|bgx
op_amp
l_int|0xF0
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
id|height
suffix:semicolon
id|loop
OG
l_int|0
suffix:semicolon
id|loop
op_decrement
)paren
(brace
id|mga_writeb
c_func
(paren
id|vbase
comma
id|uaddr
comma
(paren
id|mga_readb
c_func
(paren
id|vbase
comma
id|uaddr
)paren
op_amp
l_int|0x0F
)paren
op_or
id|bgx2
)paren
suffix:semicolon
id|uaddr
op_add_assign
id|step
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|whattodo
op_amp
l_int|2
)paren
(brace
r_int
r_int
id|uaddr
op_assign
id|sy
op_star
id|step
op_plus
id|sx
op_plus
id|width
suffix:semicolon
id|u_int32_t
id|loop
suffix:semicolon
id|u_int8_t
id|bgx2
op_assign
id|bgx
op_amp
l_int|0x0F
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
id|height
suffix:semicolon
id|loop
OG
l_int|0
suffix:semicolon
id|loop
op_decrement
)paren
(brace
id|mga_writeb
c_func
(paren
id|vbase
comma
id|uaddr
comma
(paren
id|mga_readb
c_func
(paren
id|vbase
comma
id|uaddr
)paren
op_amp
l_int|0xF0
)paren
op_or
id|bgx2
)paren
suffix:semicolon
id|uaddr
op_add_assign
id|step
suffix:semicolon
)brace
)brace
)brace
id|CRITEND
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|matrox_cfb8_clear
r_static
r_void
id|matrox_cfb8_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_int32_t
id|bgx
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfb8_clear&quot;
)paren
id|bgx
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_or_assign
id|bgx
op_lshift
l_int|8
suffix:semicolon
id|bgx
op_or_assign
id|bgx
op_lshift
l_int|16
suffix:semicolon
id|matrox_cfbX_clear
c_func
(paren
id|bgx
comma
id|p
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|matrox_cfb16_clear
r_static
r_void
id|matrox_cfb16_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_int32_t
id|bgx
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfb16_clear&quot;
)paren
id|bgx
op_assign
(paren
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|matrox_cfbX_clear
c_func
(paren
(paren
id|bgx
op_lshift
l_int|16
)paren
op_or
id|bgx
comma
id|p
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(FBCON_HAS_CFB32) || defined(FBCON_HAS_CFB24)
DECL|function|matrox_cfb32_clear
r_static
r_void
id|matrox_cfb32_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_int32_t
id|bgx
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfb32_clear&quot;
)paren
id|bgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|matrox_cfbX_clear
c_func
(paren
id|bgx
comma
id|p
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|matrox_cfbX_fastputc
r_static
r_void
id|matrox_cfbX_fastputc
c_func
(paren
id|u_int32_t
id|fgx
comma
id|u_int32_t
id|bgx
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_int
r_int
id|charcell
suffix:semicolon
r_int
r_int
id|ar3
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|charcell
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_LINEAR
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
)paren
suffix:semicolon
id|ar3
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.mgabase
)paren
op_plus
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|charcell
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|ar3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
(paren
id|ar3
op_plus
id|charcell
op_minus
l_int|1
)paren
op_amp
l_int|0x0003FFFF
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_cfbX_putc
r_static
r_void
id|matrox_cfbX_putc
c_func
(paren
id|u_int32_t
id|fgx
comma
id|u_int32_t
id|bgx
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|ar0
suffix:semicolon
id|u_int32_t
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matrox_cfbX_putc&quot;
)paren
suffix:semicolon
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
macro_line|#ifdef __BIG_ENDIAN
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|M_OPMODE_8BPP
)paren
suffix:semicolon
macro_line|#else
id|mga_fifo
c_func
(paren
l_int|7
)paren
suffix:semicolon
macro_line|#endif
id|ar0
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|xx
op_plus
id|ar0
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|step
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|step
op_assign
l_int|2
suffix:semicolon
r_else
id|step
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_eq
id|step
op_lshift
l_int|3
)paren
(brace
r_int
id|charcell
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|step
suffix:semicolon
multiline_comment|/* TODO: Align charcell to 4B for BE */
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_LINEAR
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|mga_memcpy_toio
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|mmio.vbase
)paren
comma
l_int|0
comma
id|p-&gt;fontdata
op_plus
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|charcell
comma
id|charcell
)paren
suffix:semicolon
)brace
r_else
(brace
id|u8
op_star
id|chardata
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|step
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|ar0
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|step
)paren
(brace
r_case
l_int|1
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
macro_line|#ifdef __LITTLE_ENDIAN
id|mga_outl
c_func
(paren
l_int|0
comma
op_star
id|chardata
op_increment
)paren
suffix:semicolon
macro_line|#else
id|mga_outl
c_func
(paren
l_int|0
comma
(paren
op_star
id|chardata
op_increment
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
macro_line|#endif
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
macro_line|#ifdef __LITTLE_ENDIAN
id|mga_outl
c_func
(paren
l_int|0
comma
op_star
(paren
id|u_int16_t
op_star
)paren
id|chardata
)paren
suffix:semicolon
macro_line|#else
id|mga_outl
c_func
(paren
l_int|0
comma
(paren
op_star
(paren
id|u_int16_t
op_star
)paren
id|chardata
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
macro_line|#endif
id|chardata
op_add_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|mga_memcpy_toio
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|mmio.vbase
)paren
comma
l_int|0
comma
id|chardata
comma
id|fontheight
c_func
(paren
id|p
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_opmode
)paren
)paren
suffix:semicolon
macro_line|#endif
id|CRITEND
)brace
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|matrox_cfb8_putc
r_static
r_void
id|matrox_cfb8_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb8_putc&quot;
)paren
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putc
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|matrox_cfb16_putc
r_static
r_void
id|matrox_cfb16_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb16_putc&quot;
)paren
suffix:semicolon
id|fgx
op_assign
(paren
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putc
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(FBCON_HAS_CFB32) || defined(FBCON_HAS_CFB24)
DECL|function|matrox_cfb32_putc
r_static
r_void
id|matrox_cfb32_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb32_putc&quot;
)paren
suffix:semicolon
id|fgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putc
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|matrox_cfbX_fastputcs
r_static
r_void
id|matrox_cfbX_fastputcs
c_func
(paren
id|u_int32_t
id|fgx
comma
id|u_int32_t
id|bgx
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_int
r_int
id|charcell
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|charcell
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_LINEAR
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|u_int32_t
id|ar3
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fastfont.mgabase
)paren
op_plus
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|charcell
suffix:semicolon
id|mga_fifo
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|ar3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
(paren
id|ar3
op_plus
id|charcell
op_minus
l_int|1
)paren
op_amp
l_int|0x0003FFFF
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|xx
op_add_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_cfbX_putcs
r_static
r_void
id|matrox_cfbX_putcs
c_func
(paren
id|u_int32_t
id|fgx
comma
id|u_int32_t
id|bgx
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|step
suffix:semicolon
id|u_int32_t
id|ydstlen
suffix:semicolon
id|u_int32_t
id|xlen
suffix:semicolon
id|u_int32_t
id|ar0
suffix:semicolon
id|u_int32_t
id|charcell
suffix:semicolon
id|u_int32_t
id|fxbndry
suffix:semicolon
id|vaddr_t
id|mmio
suffix:semicolon
r_int
id|easy
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfbX_putcs&quot;
)paren
suffix:semicolon
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|step
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|step
op_assign
l_int|2
suffix:semicolon
r_else
id|step
op_assign
l_int|4
suffix:semicolon
id|charcell
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|step
suffix:semicolon
id|xlen
op_assign
(paren
id|charcell
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|ydstlen
op_assign
(paren
id|yy
op_lshift
l_int|16
)paren
op_or
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_eq
id|step
op_lshift
l_int|3
)paren
(brace
id|ar0
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
id|easy
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|ar0
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
suffix:semicolon
id|easy
op_assign
l_int|0
suffix:semicolon
)brace
id|CRITBEGIN
macro_line|#ifdef __BIG_ENDIAN
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|M_OPMODE_8BPP
)paren
suffix:semicolon
macro_line|#else
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|easy
)paren
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_LINEAR
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
r_else
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
id|fxbndry
op_assign
(paren
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
suffix:semicolon
id|mmio
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|mmio.vbase
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|u_int8_t
op_star
id|chardata
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|charcell
suffix:semicolon
id|mga_fifo
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_FXBNDRY
comma
id|fxbndry
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR0
comma
id|ar0
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR3
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|easy
)paren
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_YDSTLEN
op_or
id|M_EXEC
comma
id|ydstlen
)paren
suffix:semicolon
id|mga_memcpy_toio
c_func
(paren
id|mmio
comma
l_int|0
comma
id|chardata
comma
id|xlen
)paren
suffix:semicolon
)brace
r_else
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR5
comma
l_int|0
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_YDSTLEN
op_or
id|M_EXEC
comma
id|ydstlen
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|step
)paren
(brace
r_case
l_int|1
suffix:colon
(brace
id|u_int8_t
op_star
id|charend
op_assign
id|chardata
op_plus
id|charcell
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|chardata
op_ne
id|charend
suffix:semicolon
id|chardata
op_increment
)paren
(brace
macro_line|#ifdef __LITTLE_ENDIAN
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
op_star
id|chardata
)paren
suffix:semicolon
macro_line|#else
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
(paren
op_star
id|chardata
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
(brace
id|u_int8_t
op_star
id|charend
op_assign
id|chardata
op_plus
id|charcell
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|chardata
op_ne
id|charend
suffix:semicolon
id|chardata
op_add_assign
l_int|2
)paren
(brace
macro_line|#ifdef __LITTLE_ENDIAN
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
op_star
(paren
id|u_int16_t
op_star
)paren
id|chardata
)paren
suffix:semicolon
macro_line|#else
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
(paren
op_star
(paren
id|u_int16_t
op_star
)paren
id|chardata
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|mga_memcpy_toio
c_func
(paren
id|mmio
comma
l_int|0
comma
id|chardata
comma
id|charcell
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|fxbndry
op_add_assign
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_opmode
)paren
)paren
suffix:semicolon
macro_line|#endif
id|CRITEND
)brace
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|matrox_cfb8_putcs
r_static
r_void
id|matrox_cfb8_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb8_putcs&quot;
)paren
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putcs
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|matrox_cfb16_putcs
r_static
r_void
id|matrox_cfb16_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb16_putcs&quot;
)paren
suffix:semicolon
id|fgx
op_assign
(paren
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u_int16_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
)braket
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putcs
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(FBCON_HAS_CFB32) || defined(FBCON_HAS_CFB24)
DECL|function|matrox_cfb32_putcs
r_static
r_void
id|matrox_cfb32_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
l_string|&quot;matroxfb_cfb32_putcs&quot;
)paren
suffix:semicolon
id|fgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
)braket
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putcs
)paren
(paren
id|fgx
comma
id|bgx
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB4
DECL|function|matrox_cfb4_revc
r_static
r_void
id|matrox_cfb4_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_LOOP
c_func
(paren
l_string|&quot;matroxfb_cfb4_revc&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_amp
l_int|1
)paren
(brace
id|fbcon_cfb4_revc
c_func
(paren
id|p
comma
id|xx
comma
id|yy
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_or_assign
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|16
suffix:semicolon
id|xx
op_rshift_assign
l_int|1
suffix:semicolon
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_XOR
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
id|xx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDST
comma
id|yy
op_star
id|p-&gt;var.xres_virtual
op_rshift
l_int|6
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_LEN
op_or
id|M_EXEC
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|matrox_cfb8_revc
r_static
r_void
id|matrox_cfb8_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_LOOP
c_func
(paren
l_string|&quot;matrox_cfb8_revc&quot;
)paren
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_XOR
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
l_int|0x0F0F0F0F
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
macro_line|#endif
DECL|function|matrox_cfbX_revc
r_static
r_void
id|matrox_cfbX_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|DBG_LOOP
c_func
(paren
l_string|&quot;matrox_cfbX_revc&quot;
)paren
id|yy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|xx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_XOR
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|xx
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|yy
comma
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_cfbX_clear_margins
r_static
r_void
id|matrox_cfbX_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_int
r_int
id|bottom_height
comma
id|right_width
suffix:semicolon
r_int
r_int
id|bottom_start
comma
id|right_start
suffix:semicolon
r_int
r_int
id|cell_h
comma
id|cell_w
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;matrox_cfbX_clear_margins&quot;
)paren
id|cell_w
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cell_w
)paren
r_return
suffix:semicolon
multiline_comment|/* PARANOID */
id|right_width
op_assign
id|p-&gt;var.xres
op_mod
id|cell_w
suffix:semicolon
id|right_start
op_assign
id|p-&gt;var.xres
op_minus
id|right_width
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
op_logical_and
id|right_width
)paren
(brace
multiline_comment|/* clear whole right margin, not only visible portion */
id|matroxfb_accel_clear
c_func
(paren
id|PMXINFO
c_func
(paren
id|p
)paren
multiline_comment|/* color */
l_int|0x00000000
comma
multiline_comment|/* y */
l_int|0
comma
multiline_comment|/* x */
id|p-&gt;var.xoffset
op_plus
id|right_start
comma
multiline_comment|/* height */
id|p-&gt;var.yres_virtual
comma
multiline_comment|/* width */
id|right_width
)paren
suffix:semicolon
)brace
id|cell_h
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cell_h
)paren
r_return
suffix:semicolon
multiline_comment|/* PARANOID */
id|bottom_height
op_assign
id|p-&gt;var.yres
op_mod
id|cell_h
suffix:semicolon
r_if
c_cond
(paren
id|bottom_height
)paren
(brace
id|bottom_start
op_assign
id|p-&gt;var.yres
op_minus
id|bottom_height
suffix:semicolon
id|matroxfb_accel_clear
c_func
(paren
id|PMXINFO
c_func
(paren
id|p
)paren
multiline_comment|/* color */
l_int|0x00000000
comma
multiline_comment|/* y */
id|p-&gt;var.yoffset
op_plus
id|bottom_start
comma
multiline_comment|/* x */
id|p-&gt;var.xoffset
comma
multiline_comment|/* height */
id|bottom_height
comma
multiline_comment|/* width */
id|right_start
)paren
suffix:semicolon
)brace
)brace
DECL|function|matrox_text_setup
r_static
r_void
id|matrox_text_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
ques
c_cond
id|p-&gt;line_length
suffix:colon
(paren
(paren
id|p-&gt;var.xres_virtual
op_div
(paren
id|fontwidth
c_func
(paren
id|p
)paren
ques
c_cond
id|fontwidth
c_func
(paren
id|p
)paren
suffix:colon
l_int|8
)paren
)paren
op_star
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
)paren
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|matrox_text_bmove
r_static
r_void
id|matrox_text_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_int
id|srcoff
suffix:semicolon
r_int
r_int
id|dstoff
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|CRITBEGIN
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
suffix:semicolon
id|srcoff
op_assign
(paren
id|sy
op_star
id|p-&gt;next_line
)paren
op_plus
(paren
id|sx
op_star
id|step
)paren
suffix:semicolon
id|dstoff
op_assign
(paren
id|dy
op_star
id|p-&gt;next_line
)paren
op_plus
(paren
id|dx
op_star
id|step
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dstoff
OL
id|srcoff
)paren
(brace
r_while
c_loop
(paren
id|height
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|width
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|dstoff
op_add_assign
id|step
comma
id|srcoff
op_add_assign
id|step
comma
id|i
op_decrement
)paren
id|mga_writew
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|dstoff
comma
id|mga_readw
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|srcoff
)paren
)paren
suffix:semicolon
id|height
op_decrement
suffix:semicolon
id|dstoff
op_add_assign
id|p-&gt;next_line
op_minus
id|width
op_star
id|step
suffix:semicolon
id|srcoff
op_add_assign
id|p-&gt;next_line
op_minus
id|width
op_star
id|step
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
r_int
id|off
suffix:semicolon
id|off
op_assign
(paren
id|height
op_minus
l_int|1
)paren
op_star
id|p-&gt;next_line
op_plus
(paren
id|width
op_minus
l_int|1
)paren
op_star
id|step
suffix:semicolon
id|srcoff
op_add_assign
id|off
suffix:semicolon
id|dstoff
op_add_assign
id|off
suffix:semicolon
r_while
c_loop
(paren
id|height
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|width
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|dstoff
op_sub_assign
id|step
comma
id|srcoff
op_sub_assign
id|step
comma
id|i
op_decrement
)paren
id|mga_writew
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|dstoff
comma
id|mga_readw
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|srcoff
)paren
)paren
suffix:semicolon
id|dstoff
op_sub_assign
id|p-&gt;next_line
op_minus
id|width
op_star
id|step
suffix:semicolon
id|srcoff
op_sub_assign
id|p-&gt;next_line
op_minus
id|width
op_star
id|step
suffix:semicolon
id|height
op_decrement
suffix:semicolon
)brace
)brace
id|CRITEND
)brace
DECL|function|matrox_text_clear
r_static
r_void
id|matrox_text_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_int
id|offs
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
suffix:semicolon
id|offs
op_assign
id|sy
op_star
id|p-&gt;next_line
op_plus
id|sx
op_star
id|step
suffix:semicolon
id|val
op_assign
id|ntohs
c_func
(paren
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp-&gt;vc_video_erase_char
)paren
op_lshift
l_int|4
)paren
op_or
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp-&gt;vc_video_erase_char
)paren
op_or
(paren
l_char|&squot; &squot;
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|CRITBEGIN
r_while
c_loop
(paren
id|height
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|width
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|offs
op_add_assign
id|step
comma
id|i
op_decrement
)paren
id|mga_writew
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|offs
comma
id|val
)paren
suffix:semicolon
id|offs
op_add_assign
id|p-&gt;next_line
op_minus
id|width
op_star
id|step
suffix:semicolon
id|height
op_decrement
suffix:semicolon
)brace
id|CRITEND
)brace
DECL|function|matrox_text_putc
r_static
r_void
id|matrox_text_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_int
r_int
id|offs
suffix:semicolon
r_int
r_int
id|chr
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
suffix:semicolon
id|offs
op_assign
id|yy
op_star
id|p-&gt;next_line
op_plus
id|xx
op_star
id|step
suffix:semicolon
id|chr
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
op_or
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chr
op_amp
l_int|0x10000
)paren
id|chr
op_or_assign
l_int|0x08
suffix:semicolon
id|CRITBEGIN
id|mga_writew
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|offs
comma
id|ntohs
c_func
(paren
id|chr
)paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_text_putcs
r_static
r_void
id|matrox_text_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_int
r_int
id|offs
suffix:semicolon
r_int
r_int
id|attr
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
suffix:semicolon
id|offs
op_assign
id|yy
op_star
id|p-&gt;next_line
op_plus
id|xx
op_star
id|step
suffix:semicolon
id|attr
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
op_or
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|CRITBEGIN
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
r_int
r_int
id|chr
op_assign
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|chr
op_amp
l_int|0x10000
)paren
id|chr
op_xor_assign
l_int|0x10008
suffix:semicolon
id|mga_writew
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|offs
comma
id|ntohs
c_func
(paren
id|attr
op_or
id|chr
)paren
)paren
suffix:semicolon
id|offs
op_add_assign
id|step
suffix:semicolon
)brace
id|CRITEND
)brace
DECL|function|matrox_text_revc
r_static
r_void
id|matrox_text_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_int
r_int
id|offs
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
suffix:semicolon
id|offs
op_assign
id|yy
op_star
id|p-&gt;next_line
op_plus
id|xx
op_star
id|step
op_plus
l_int|1
suffix:semicolon
id|CRITBEGIN
id|mga_writeb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|offs
comma
id|mga_readb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
id|offs
)paren
op_xor
l_int|0x77
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_text_createcursor
r_void
id|matrox_text_createcursor
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
(brace
id|CRITFLAGS
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|currcon_display
)paren
op_ne
id|p
)paren
r_return
suffix:semicolon
id|matroxfb_createcursorshape
c_func
(paren
id|PMINFO
id|p
comma
l_int|0
)paren
suffix:semicolon
id|CRITBEGIN
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0A
comma
id|ACCESS_FBINFO
c_func
(paren
id|cursor.u
)paren
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0B
comma
id|ACCESS_FBINFO
c_func
(paren
id|cursor.d
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_text_cursor
r_static
r_void
id|matrox_text_cursor
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|mode
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
r_int
r_int
id|pos
suffix:semicolon
id|CRITFLAGS
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|currcon_display
)paren
op_ne
id|p
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|CM_ERASE
)paren
(brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|cursor.state
)paren
op_ne
id|CM_ERASE
)paren
(brace
id|CRITBEGIN
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0A
comma
l_int|0x20
)paren
suffix:semicolon
id|CRITEND
id|ACCESS_FBINFO
c_func
(paren
id|cursor.state
)paren
op_assign
id|CM_ERASE
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|p-&gt;conp-&gt;vc_cursor_type
op_amp
id|CUR_HWMASK
)paren
op_ne
id|ACCESS_FBINFO
c_func
(paren
id|cursor.type
)paren
)paren
id|matrox_text_createcursor
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
multiline_comment|/* DO NOT CHECK cursor.x != x because of matroxfb_vgaHWinit moves cursor to 0,0 */
id|ACCESS_FBINFO
c_func
(paren
id|cursor.x
)paren
op_assign
id|x
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cursor.y
)paren
op_assign
id|y
suffix:semicolon
id|pos
op_assign
id|p-&gt;next_line
op_div
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
op_star
id|y
op_plus
id|x
suffix:semicolon
id|CRITBEGIN
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0F
comma
id|pos
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0E
comma
id|pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_CRTC_INDEX
comma
l_int|0x0A
comma
id|ACCESS_FBINFO
c_func
(paren
id|cursor.u
)paren
)paren
suffix:semicolon
id|CRITEND
id|ACCESS_FBINFO
c_func
(paren
id|cursor.state
)paren
op_assign
id|CM_DRAW
suffix:semicolon
)brace
DECL|function|matrox_text_round
r_void
id|matrox_text_round
c_func
(paren
id|CPMINFO
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|display
op_star
id|p
)paren
(brace
r_int
id|hf
suffix:semicolon
r_int
id|vf
suffix:semicolon
r_int
id|vxres
suffix:semicolon
r_int
id|ych
suffix:semicolon
id|hf
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hf
)paren
id|hf
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* do not touch xres */
id|vxres
op_assign
(paren
id|var-&gt;xres_virtual
op_plus
id|hf
op_minus
l_int|1
)paren
op_div
id|hf
suffix:semicolon
r_if
c_cond
(paren
id|vxres
op_ge
l_int|256
)paren
id|vxres
op_assign
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|vxres
OL
l_int|16
)paren
id|vxres
op_assign
l_int|16
suffix:semicolon
id|vxres
op_assign
(paren
id|vxres
op_plus
l_int|1
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
multiline_comment|/* must be even */
id|vf
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vf
)paren
id|vf
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres
OL
id|var-&gt;yres_virtual
)paren
(brace
id|ych
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textvram
)paren
op_div
id|vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|ych
op_star
id|vf
suffix:semicolon
)brace
r_else
id|ych
op_assign
id|var-&gt;yres_virtual
op_div
id|vf
suffix:semicolon
r_if
c_cond
(paren
id|vxres
op_star
id|ych
OG
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textvram
)paren
)paren
(brace
id|ych
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textvram
)paren
op_div
id|vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|ych
op_star
id|vf
suffix:semicolon
)brace
id|var-&gt;xres_virtual
op_assign
id|vxres
op_star
id|hf
suffix:semicolon
)brace
DECL|function|matrox_text_setfont
r_static
r_int
id|matrox_text_setfont
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
id|DBG
c_func
(paren
l_string|&quot;matrox_text_setfont&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
id|MINFO_FROM_DISP
c_func
(paren
id|p
)paren
suffix:semicolon
id|matrox_text_round
c_func
(paren
id|PMINFO
op_amp
id|p-&gt;var
comma
id|p
)paren
suffix:semicolon
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
op_assign
(paren
(paren
id|p-&gt;var.xres_virtual
op_div
(paren
id|fontwidth
c_func
(paren
id|p
)paren
ques
c_cond
id|fontwidth
c_func
(paren
id|p
)paren
suffix:colon
l_int|8
)paren
)paren
op_star
id|ACCESS_FBINFO
c_func
(paren
id|devflags.textstep
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;conp
)paren
id|matrox_text_createcursor
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|matrox_cfb16_revc
mdefine_line|#define matrox_cfb16_revc matrox_cfbX_revc
DECL|macro|matrox_cfb24_revc
mdefine_line|#define matrox_cfb24_revc matrox_cfbX_revc
DECL|macro|matrox_cfb32_revc
mdefine_line|#define matrox_cfb32_revc matrox_cfbX_revc
DECL|macro|matrox_cfb24_clear
mdefine_line|#define matrox_cfb24_clear matrox_cfb32_clear
DECL|macro|matrox_cfb24_putc
mdefine_line|#define matrox_cfb24_putc matrox_cfb32_putc
DECL|macro|matrox_cfb24_putcs
mdefine_line|#define matrox_cfb24_putcs matrox_cfb32_putcs
macro_line|#ifdef FBCON_HAS_VGATEXT
DECL|variable|matroxfb_text
r_static
r_struct
id|display_switch
id|matroxfb_text
op_assign
(brace
id|setup
suffix:colon
id|matrox_text_setup
comma
id|bmove
suffix:colon
id|matrox_text_bmove
comma
id|clear
suffix:colon
id|matrox_text_clear
comma
id|putc
suffix:colon
id|matrox_text_putc
comma
id|putcs
suffix:colon
id|matrox_text_putcs
comma
id|revc
suffix:colon
id|matrox_text_revc
comma
id|cursor
suffix:colon
id|matrox_text_cursor
comma
id|set_font
suffix:colon
id|matrox_text_setfont
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|9
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB4
DECL|variable|matroxfb_cfb4
r_static
r_struct
id|display_switch
id|matroxfb_cfb4
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb4_setup
comma
id|bmove
suffix:colon
id|matrox_cfb4_bmove
comma
id|clear
suffix:colon
id|matrox_cfb4_clear
comma
id|putc
suffix:colon
id|fbcon_cfb4_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb4_putcs
comma
id|revc
suffix:colon
id|matrox_cfb4_revc
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
multiline_comment|/* fix, fix, fix it */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|matroxfb_cfb8
r_static
r_struct
id|display_switch
id|matroxfb_cfb8
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb8_setup
comma
id|bmove
suffix:colon
id|matrox_cfbX_bmove
comma
id|clear
suffix:colon
id|matrox_cfb8_clear
comma
id|putc
suffix:colon
id|matrox_cfb8_putc
comma
id|putcs
suffix:colon
id|matrox_cfb8_putcs
comma
id|revc
suffix:colon
id|matrox_cfb8_revc
comma
id|clear_margins
suffix:colon
id|matrox_cfbX_clear_margins
comma
id|fontwidthmask
suffix:colon
op_complement
l_int|1
multiline_comment|/* FONTWIDTHS */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|variable|matroxfb_cfb16
r_static
r_struct
id|display_switch
id|matroxfb_cfb16
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb16_setup
comma
id|bmove
suffix:colon
id|matrox_cfbX_bmove
comma
id|clear
suffix:colon
id|matrox_cfb16_clear
comma
id|putc
suffix:colon
id|matrox_cfb16_putc
comma
id|putcs
suffix:colon
id|matrox_cfb16_putcs
comma
id|revc
suffix:colon
id|matrox_cfb16_revc
comma
id|clear_margins
suffix:colon
id|matrox_cfbX_clear_margins
comma
id|fontwidthmask
suffix:colon
op_complement
l_int|1
multiline_comment|/* FONTWIDTHS */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
DECL|variable|matroxfb_cfb24
r_static
r_struct
id|display_switch
id|matroxfb_cfb24
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb24_setup
comma
id|bmove
suffix:colon
id|matrox_cfbX_bmove
comma
id|clear
suffix:colon
id|matrox_cfb24_clear
comma
id|putc
suffix:colon
id|matrox_cfb24_putc
comma
id|putcs
suffix:colon
id|matrox_cfb24_putcs
comma
id|revc
suffix:colon
id|matrox_cfb24_revc
comma
id|clear_margins
suffix:colon
id|matrox_cfbX_clear_margins
comma
id|fontwidthmask
suffix:colon
op_complement
l_int|1
multiline_comment|/* FONTWIDTHS */
multiline_comment|/* TODO: and what about non-aligned access on BE? I think that there are no in my code */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|variable|matroxfb_cfb32
r_static
r_struct
id|display_switch
id|matroxfb_cfb32
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb32_setup
comma
id|bmove
suffix:colon
id|matrox_cfbX_bmove
comma
id|clear
suffix:colon
id|matrox_cfb32_clear
comma
id|putc
suffix:colon
id|matrox_cfb32_putc
comma
id|putcs
suffix:colon
id|matrox_cfb32_putcs
comma
id|revc
suffix:colon
id|matrox_cfb32_revc
comma
id|clear_margins
suffix:colon
id|matrox_cfbX_clear_margins
comma
id|fontwidthmask
suffix:colon
op_complement
l_int|1
multiline_comment|/* FONTWIDTHS */
)brace
suffix:semicolon
macro_line|#endif
DECL|function|initMatrox
r_void
id|initMatrox
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
(brace
r_struct
id|display_switch
op_star
id|swtmp
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;initMatrox&quot;
)paren
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|currcon_display
)paren
op_ne
id|p
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dispsw
op_logical_and
id|p-&gt;conp
)paren
id|fb_con
dot
id|con_cursor
c_func
(paren
id|p-&gt;conp
comma
id|CM_ERASE
)paren
suffix:semicolon
id|p-&gt;dispsw_data
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
op_ne
id|FB_ACCELF_TEXT
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
)paren
(brace
id|swtmp
op_assign
op_amp
id|matroxfb_text
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|p-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB4
r_case
l_int|4
suffix:colon
id|swtmp
op_assign
op_amp
id|fbcon_cfb4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|swtmp
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb16
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb24
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|fbcon_cfb24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb32
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|p-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;matroxfb: acceleration disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
)paren
(brace
id|swtmp
op_assign
op_amp
id|matroxfb_text
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|p-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB4
r_case
l_int|4
suffix:colon
id|swtmp
op_assign
op_amp
id|matroxfb_cfb4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|swtmp
op_assign
op_amp
id|matroxfb_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb16
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|matroxfb_cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb24
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|matroxfb_cfb24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|p-&gt;dispsw_data
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cmap.cfb32
)paren
suffix:semicolon
id|swtmp
op_assign
op_amp
id|matroxfb_cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|p-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|dispsw
)paren
comma
id|swtmp
comma
r_sizeof
(paren
id|ACCESS_FBINFO
c_func
(paren
id|dispsw
)paren
)paren
)paren
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|dispsw
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;type
op_ne
id|FB_TYPE_TEXT
)paren
op_logical_and
id|ACCESS_FBINFO
c_func
(paren
id|devflags.hwcursor
)paren
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|hw_switch
)paren
op_member_access_from_pointer
id|selhwcursor
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
)brace
)brace
DECL|function|matrox_init_putc
r_void
id|matrox_init_putc
c_func
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
comma
r_void
(paren
op_star
id|dac_createcursor
)paren
(paren
id|WPMINFO
r_struct
id|display
op_star
id|p
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|p
op_logical_and
id|p-&gt;conp
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_TEXT
)paren
(brace
id|matrox_text_createcursor
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
id|matrox_text_loadfont
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|dac_createcursor
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
id|i
op_assign
id|matroxfb_fastfont_tryset
c_func
(paren
id|PMINFO
id|p
)paren
suffix:semicolon
)brace
)brace
r_else
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|curr.putc
)paren
op_assign
id|matrox_cfbX_fastputc
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putcs
)paren
op_assign
id|matrox_cfbX_fastputcs
suffix:semicolon
)brace
r_else
(brace
id|ACCESS_FBINFO
c_func
(paren
id|curr.putc
)paren
op_assign
id|matrox_cfbX_putc
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|curr.putcs
)paren
op_assign
id|matrox_cfbX_putcs
suffix:semicolon
)brace
)brace
eof
