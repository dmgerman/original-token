multiline_comment|/*&n; *  linux/drivers/video/macmodes.c -- Standard MacOS video modes&n; *&n; *&t;Copyright (C) 1998 Geert Uytterhoeven&n; *&n; *      2000 - Removal of OpenFirmware dependencies by:&n; *      - Ani Joshi&n; *      - Brad Douglas &lt;brad@neruo.com&gt;&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License. See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#ifdef CONFIG_FB_COMPAT_XPMAC
macro_line|#include &lt;asm/vc_ioctl.h&gt;
macro_line|#endif
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/macmodes.h&gt;
multiline_comment|/*&n;     *  MacOS video mode definitions&n;     *&n;     *  Order IS important! If you change these, don&squot;t forget to update&n;     *  mac_modes[] below!&n;     */
DECL|macro|DEFAULT_MODEDB_INDEX
mdefine_line|#define DEFAULT_MODEDB_INDEX&t;0
DECL|variable|mac_modedb
r_static
r_const
r_struct
id|fb_videomode
id|mac_modedb
(braket
)braket
op_assign
(brace
(brace
multiline_comment|/* 640x480, 60 Hz, Non-Interlaced (25.175 MHz dotclock) */
l_string|&quot;mac5&quot;
comma
l_int|60
comma
l_int|640
comma
l_int|480
comma
l_int|39722
comma
l_int|32
comma
l_int|32
comma
l_int|33
comma
l_int|10
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 640x480, 67Hz, Non-Interlaced (30.0 MHz dotclock) */
l_string|&quot;mac6&quot;
comma
l_int|67
comma
l_int|640
comma
l_int|480
comma
l_int|33334
comma
l_int|80
comma
l_int|80
comma
l_int|39
comma
l_int|3
comma
l_int|64
comma
l_int|3
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 800x600, 56 Hz, Non-Interlaced (36.00 MHz dotclock) */
l_string|&quot;mac9&quot;
comma
l_int|56
comma
l_int|800
comma
l_int|600
comma
l_int|27778
comma
l_int|112
comma
l_int|40
comma
l_int|22
comma
l_int|1
comma
l_int|72
comma
l_int|2
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 800x600, 60 Hz, Non-Interlaced (40.00 MHz dotclock) */
l_string|&quot;mac10&quot;
comma
l_int|60
comma
l_int|800
comma
l_int|600
comma
l_int|25000
comma
l_int|72
comma
l_int|56
comma
l_int|23
comma
l_int|1
comma
l_int|128
comma
l_int|4
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 800x600, 72 Hz, Non-Interlaced (50.00 MHz dotclock) */
l_string|&quot;mac11&quot;
comma
l_int|72
comma
l_int|800
comma
l_int|600
comma
l_int|20000
comma
l_int|48
comma
l_int|72
comma
l_int|23
comma
l_int|37
comma
l_int|120
comma
l_int|6
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 800x600, 75 Hz, Non-Interlaced (49.50 MHz dotclock) */
l_string|&quot;mac12&quot;
comma
l_int|75
comma
l_int|800
comma
l_int|600
comma
l_int|20203
comma
l_int|144
comma
l_int|32
comma
l_int|21
comma
l_int|1
comma
l_int|80
comma
l_int|3
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 832x624, 75Hz, Non-Interlaced (57.6 MHz dotclock) */
l_string|&quot;mac13&quot;
comma
l_int|75
comma
l_int|832
comma
l_int|624
comma
l_int|17362
comma
l_int|208
comma
l_int|48
comma
l_int|39
comma
l_int|1
comma
l_int|64
comma
l_int|3
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1024x768, 60 Hz, Non-Interlaced (65.00 MHz dotclock) */
l_string|&quot;mac14&quot;
comma
l_int|60
comma
l_int|1024
comma
l_int|768
comma
l_int|15385
comma
l_int|144
comma
l_int|40
comma
l_int|29
comma
l_int|3
comma
l_int|136
comma
l_int|6
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1024x768, 72 Hz, Non-Interlaced (75.00 MHz dotclock) */
l_string|&quot;mac15&quot;
comma
l_int|72
comma
l_int|1024
comma
l_int|768
comma
l_int|13334
comma
l_int|128
comma
l_int|40
comma
l_int|29
comma
l_int|3
comma
l_int|136
comma
l_int|6
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1024x768, 75 Hz, Non-Interlaced (78.75 MHz dotclock) */
l_string|&quot;mac16&quot;
comma
l_int|75
comma
l_int|1024
comma
l_int|768
comma
l_int|12699
comma
l_int|176
comma
l_int|16
comma
l_int|28
comma
l_int|1
comma
l_int|96
comma
l_int|3
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1024x768, 75 Hz, Non-Interlaced (78.75 MHz dotclock) */
l_string|&quot;mac17&quot;
comma
l_int|75
comma
l_int|1024
comma
l_int|768
comma
l_int|12699
comma
l_int|160
comma
l_int|32
comma
l_int|28
comma
l_int|1
comma
l_int|96
comma
l_int|3
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1152x870, 75 Hz, Non-Interlaced (100.0 MHz dotclock) */
l_string|&quot;mac18&quot;
comma
l_int|75
comma
l_int|1152
comma
l_int|870
comma
l_int|10000
comma
l_int|128
comma
l_int|48
comma
l_int|39
comma
l_int|3
comma
l_int|128
comma
l_int|3
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1280x960, 75 Hz, Non-Interlaced (126.00 MHz dotclock) */
l_string|&quot;mac19&quot;
comma
l_int|75
comma
l_int|1280
comma
l_int|960
comma
l_int|7937
comma
l_int|224
comma
l_int|32
comma
l_int|36
comma
l_int|1
comma
l_int|144
comma
l_int|3
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* 1280x1024, 75 Hz, Non-Interlaced (135.00 MHz dotclock) */
l_string|&quot;mac20&quot;
comma
l_int|75
comma
l_int|1280
comma
l_int|1024
comma
l_int|7408
comma
l_int|232
comma
l_int|64
comma
l_int|38
comma
l_int|1
comma
l_int|112
comma
l_int|3
comma
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
macro_line|#if 0
multiline_comment|/* Anyone who has timings for these? */
(brace
multiline_comment|/* VMODE_512_384_60I: 512x384, 60Hz, Interlaced (NTSC) */
l_string|&quot;mac1&quot;
comma
l_int|60
comma
l_int|512
comma
l_int|384
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_INTERLACED
)brace
comma
(brace
multiline_comment|/* VMODE_512_384_60: 512x384, 60Hz, Non-Interlaced */
l_string|&quot;mac2&quot;
comma
l_int|60
comma
l_int|512
comma
l_int|384
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* VMODE_640_480_50I: 640x480, 50Hz, Interlaced (PAL) */
l_string|&quot;mac3&quot;
comma
l_int|50
comma
l_int|640
comma
l_int|480
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_INTERLACED
)brace
comma
(brace
multiline_comment|/* VMODE_640_480_60I: 640x480, 60Hz, Interlaced (NTSC) */
l_string|&quot;mac4&quot;
comma
l_int|60
comma
l_int|640
comma
l_int|480
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_INTERLACED
)brace
comma
(brace
multiline_comment|/* VMODE_640_870_75P: 640x870, 75Hz (portrait), Non-Interlaced */
l_string|&quot;mac7&quot;
comma
l_int|75
comma
l_int|640
comma
l_int|870
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_NONINTERLACED
)brace
comma
(brace
multiline_comment|/* VMODE_768_576_50I: 768x576, 50Hz (PAL full frame), Interlaced */
l_string|&quot;mac8&quot;
comma
l_int|50
comma
l_int|768
comma
l_int|576
comma
id|pixclock
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
comma
id|FB_VMODE_INTERLACED
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n;     *  Mapping between MacOS video mode numbers and video mode definitions&n;     *&n;     *  These MUST be ordered in&n;     *    - increasing resolution&n;     *    - decreasing refresh rate&n;     */
DECL|struct|mode_map
r_static
r_const
r_struct
id|mode_map
(brace
DECL|member|vmode
r_int
id|vmode
suffix:semicolon
DECL|member|mode
r_const
r_struct
id|fb_videomode
op_star
id|mode
suffix:semicolon
DECL|variable|mac_modes
)brace
id|mac_modes
(braket
)braket
op_assign
(brace
multiline_comment|/* 640x480 */
(brace
id|VMODE_640_480_67
comma
op_amp
id|mac_modedb
(braket
l_int|1
)braket
)brace
comma
(brace
id|VMODE_640_480_60
comma
op_amp
id|mac_modedb
(braket
l_int|0
)braket
)brace
comma
multiline_comment|/* 800x600 */
(brace
id|VMODE_800_600_75
comma
op_amp
id|mac_modedb
(braket
l_int|5
)braket
)brace
comma
(brace
id|VMODE_800_600_72
comma
op_amp
id|mac_modedb
(braket
l_int|4
)braket
)brace
comma
(brace
id|VMODE_800_600_60
comma
op_amp
id|mac_modedb
(braket
l_int|3
)braket
)brace
comma
(brace
id|VMODE_800_600_56
comma
op_amp
id|mac_modedb
(braket
l_int|2
)braket
)brace
comma
multiline_comment|/* 832x624 */
(brace
id|VMODE_832_624_75
comma
op_amp
id|mac_modedb
(braket
l_int|6
)braket
)brace
comma
multiline_comment|/* 1024x768 */
(brace
id|VMODE_1024_768_75
comma
op_amp
id|mac_modedb
(braket
l_int|10
)braket
)brace
comma
(brace
id|VMODE_1024_768_75V
comma
op_amp
id|mac_modedb
(braket
l_int|9
)braket
)brace
comma
(brace
id|VMODE_1024_768_70
comma
op_amp
id|mac_modedb
(braket
l_int|8
)braket
)brace
comma
(brace
id|VMODE_1024_768_60
comma
op_amp
id|mac_modedb
(braket
l_int|7
)braket
)brace
comma
multiline_comment|/* 1152x870 */
(brace
id|VMODE_1152_870_75
comma
op_amp
id|mac_modedb
(braket
l_int|11
)braket
)brace
comma
multiline_comment|/* 1280x960 */
(brace
id|VMODE_1280_960_75
comma
op_amp
id|mac_modedb
(braket
l_int|12
)braket
)brace
comma
multiline_comment|/* 1280x1024 */
(brace
id|VMODE_1280_1024_75
comma
op_amp
id|mac_modedb
(braket
l_int|13
)braket
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/*&n;     *  Mapping between monitor sense values and MacOS video mode numbers&n;     */
DECL|struct|monitor_map
r_static
r_const
r_struct
id|monitor_map
(brace
DECL|member|sense
r_int
id|sense
suffix:semicolon
DECL|member|vmode
r_int
id|vmode
suffix:semicolon
DECL|variable|mac_monitors
)brace
id|mac_monitors
(braket
)braket
op_assign
(brace
(brace
l_int|0x000
comma
id|VMODE_1280_1024_75
)brace
comma
multiline_comment|/* 21&quot; RGB */
(brace
l_int|0x114
comma
id|VMODE_640_870_75P
)brace
comma
multiline_comment|/* Portrait Monochrome */
(brace
l_int|0x221
comma
id|VMODE_512_384_60
)brace
comma
multiline_comment|/* 12&quot; RGB*/
(brace
l_int|0x331
comma
id|VMODE_1280_1024_75
)brace
comma
multiline_comment|/* 21&quot; RGB (Radius) */
(brace
l_int|0x334
comma
id|VMODE_1280_1024_75
)brace
comma
multiline_comment|/* 21&quot; mono (Radius) */
(brace
l_int|0x335
comma
id|VMODE_1280_1024_75
)brace
comma
multiline_comment|/* 21&quot; mono */
(brace
l_int|0x40A
comma
id|VMODE_640_480_60I
)brace
comma
multiline_comment|/* NTSC */
(brace
l_int|0x51E
comma
id|VMODE_640_870_75P
)brace
comma
multiline_comment|/* Portrait RGB */
(brace
l_int|0x603
comma
id|VMODE_832_624_75
)brace
comma
multiline_comment|/* 12&quot;-16&quot; multiscan */
(brace
l_int|0x60b
comma
id|VMODE_1024_768_70
)brace
comma
multiline_comment|/* 13&quot;-19&quot; multiscan */
(brace
l_int|0x623
comma
id|VMODE_1152_870_75
)brace
comma
multiline_comment|/* 13&quot;-21&quot; multiscan */
(brace
l_int|0x62b
comma
id|VMODE_640_480_67
)brace
comma
multiline_comment|/* 13&quot;/14&quot; RGB */
(brace
l_int|0x700
comma
id|VMODE_640_480_50I
)brace
comma
multiline_comment|/* PAL */
(brace
l_int|0x714
comma
id|VMODE_640_480_60I
)brace
comma
multiline_comment|/* NTSC */
(brace
l_int|0x717
comma
id|VMODE_800_600_75
)brace
comma
multiline_comment|/* VGA */
(brace
l_int|0x72d
comma
id|VMODE_832_624_75
)brace
comma
multiline_comment|/* 16&quot; RGB (Goldfish) */
(brace
l_int|0x730
comma
id|VMODE_768_576_50I
)brace
comma
multiline_comment|/* PAL (Alternate) */
(brace
l_int|0x73a
comma
id|VMODE_1152_870_75
)brace
comma
multiline_comment|/* 3rd party 19&quot; */
(brace
l_int|0x73f
comma
id|VMODE_640_480_67
)brace
comma
multiline_comment|/* no sense lines connected at all */
(brace
op_minus
l_int|1
comma
id|VMODE_640_480_60
)brace
comma
multiline_comment|/* catch-all, must be last */
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_FB_COMPAT_XPMAC
DECL|variable|console_fb_info
r_struct
id|fb_info
op_star
id|console_fb_info
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|display_info
r_struct
id|vc_mode
id|display_info
suffix:semicolon
DECL|variable|palette_red
r_static
id|u16
id|palette_red
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_green
r_static
id|u16
id|palette_green
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_blue
r_static
id|u16
id|palette_blue
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_cmap
r_static
r_struct
id|fb_cmap
id|palette_cmap
op_assign
(brace
l_int|0
comma
l_int|16
comma
id|palette_red
comma
id|palette_green
comma
id|palette_blue
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|console_getmode
r_int
id|console_getmode
c_func
(paren
r_struct
id|vc_mode
op_star
id|mode
)paren
(brace
op_star
id|mode
op_assign
id|display_info
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|console_setmode
r_int
id|console_setmode
c_func
(paren
r_struct
id|vc_mode
op_star
id|mode
comma
r_int
id|doit
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
id|cmode
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|console_fb_info
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_switch
c_cond
(paren
id|mode-&gt;depth
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|8
suffix:colon
id|cmode
op_assign
id|CMODE_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|cmode
op_assign
id|CMODE_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|cmode
op_assign
id|CMODE_32
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|mac_vmode_to_var
c_func
(paren
id|mode-&gt;mode
comma
id|cmode
comma
op_amp
id|var
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|var.activate
op_assign
id|FB_ACTIVATE_TEST
suffix:semicolon
id|err
op_assign
id|console_fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_set_var
c_func
(paren
op_amp
id|var
comma
id|fg_console
comma
id|console_fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_or
op_logical_neg
id|doit
)paren
r_return
id|err
suffix:semicolon
r_else
(brace
r_int
id|unit
suffix:semicolon
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_for
c_loop
(paren
id|unit
op_assign
l_int|0
suffix:semicolon
id|unit
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|unit
op_increment
)paren
r_if
c_cond
(paren
id|fb_display
(braket
id|unit
)braket
dot
id|conp
op_logical_and
(paren
id|GET_FB_IDX
c_func
(paren
id|console_fb_info-&gt;node
)paren
op_eq
id|con2fb_map
(braket
id|unit
)braket
)paren
)paren
id|console_fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_set_var
c_func
(paren
op_amp
id|var
comma
id|unit
comma
id|console_fb_info
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|console_setcmap
r_int
id|console_setcmap
c_func
(paren
r_int
id|n_entries
comma
r_int
r_char
op_star
id|red
comma
r_int
r_char
op_star
id|green
comma
r_int
r_char
op_star
id|blue
)paren
(brace
r_int
id|i
comma
id|j
comma
id|n
op_assign
l_int|0
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|console_fb_info
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n_entries
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|n
op_assign
id|n_entries
op_minus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|16
)paren
id|n
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.start
op_assign
id|i
suffix:semicolon
id|palette_cmap.len
op_assign
id|n
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
(brace
id|palette_cmap.red
(braket
id|j
)braket
op_assign
(paren
id|red
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|red
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|palette_cmap.green
(braket
id|j
)braket
op_assign
(paren
id|green
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|green
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|palette_cmap.blue
(braket
id|j
)braket
op_assign
(paren
id|blue
(braket
id|i
op_plus
id|j
)braket
op_lshift
l_int|8
)paren
op_or
id|blue
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
)brace
id|err
op_assign
id|console_fb_info-&gt;fbops
op_member_access_from_pointer
id|fb_set_cmap
c_func
(paren
op_amp
id|palette_cmap
comma
l_int|1
comma
id|fg_console
comma
id|console_fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|console_powermode
r_int
id|console_powermode
c_func
(paren
r_int
id|mode
)paren
(brace
r_if
c_cond
(paren
id|mode
op_eq
id|VC_POWERMODE_INQUIRY
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode
template_param
id|VESA_POWERDOWN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Not Supported */
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_COMPAT_XPMAC */
multiline_comment|/*&n;     *  Convert a MacOS vmode/cmode pair to a frame buffer video mode structure&n;     */
DECL|function|mac_vmode_to_var
r_int
id|mac_vmode_to_var
c_func
(paren
r_int
id|vmode
comma
r_int
id|cmode
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_const
r_struct
id|fb_videomode
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
r_const
r_struct
id|mode_map
op_star
id|map
suffix:semicolon
r_for
c_loop
(paren
id|map
op_assign
id|mac_modes
suffix:semicolon
id|map-&gt;vmode
op_ne
op_minus
l_int|1
suffix:semicolon
id|map
op_increment
)paren
r_if
c_cond
(paren
id|map-&gt;vmode
op_eq
id|vmode
)paren
(brace
id|mode
op_assign
id|map-&gt;mode
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|var
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmode
)paren
(brace
r_case
id|CMODE_8
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMODE_16
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMODE_32
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|var-&gt;xres
op_assign
id|mode-&gt;xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|mode-&gt;yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|mode-&gt;xres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|mode-&gt;yres
suffix:semicolon
id|var-&gt;height
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|mode-&gt;pixclock
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|mode-&gt;left_margin
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|mode-&gt;right_margin
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|mode-&gt;upper_margin
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|mode-&gt;lower_margin
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|mode-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|mode-&gt;vsync_len
suffix:semicolon
id|var-&gt;sync
op_assign
id|mode-&gt;sync
suffix:semicolon
id|var-&gt;vmode
op_assign
id|mode-&gt;vmode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Convert a frame buffer video mode structure to a MacOS vmode/cmode pair&n;     */
DECL|function|mac_var_to_vmode
r_int
id|mac_var_to_vmode
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
op_star
id|vmode
comma
r_int
op_star
id|cmode
)paren
(brace
r_const
r_struct
id|fb_videomode
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
r_const
r_struct
id|mode_map
op_star
id|map
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|8
)paren
op_star
id|cmode
op_assign
id|CMODE_8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|16
)paren
op_star
id|cmode
op_assign
id|CMODE_16
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|32
)paren
op_star
id|cmode
op_assign
id|CMODE_32
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|map
op_assign
id|mac_modes
suffix:semicolon
id|map-&gt;vmode
op_ne
op_minus
l_int|1
suffix:semicolon
id|map
op_increment
)paren
(brace
id|mode
op_assign
id|map-&gt;mode
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres
OG
id|mode-&gt;xres
op_logical_or
id|var-&gt;yres
OG
id|mode-&gt;yres
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OG
id|mode-&gt;xres
op_logical_or
id|var-&gt;yres_virtual
OG
id|mode-&gt;yres
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;pixclock
OG
id|mode-&gt;pixclock
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_ne
id|mode-&gt;vmode
)paren
r_continue
suffix:semicolon
op_star
id|vmode
op_assign
id|map-&gt;vmode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Convert a Mac monitor sense number to a MacOS vmode number&n;     */
DECL|function|mac_map_monitor_sense
r_int
id|mac_map_monitor_sense
c_func
(paren
r_int
id|sense
)paren
(brace
r_const
r_struct
id|monitor_map
op_star
id|map
suffix:semicolon
r_for
c_loop
(paren
id|map
op_assign
id|mac_monitors
suffix:semicolon
id|map-&gt;sense
op_ne
op_minus
l_int|1
suffix:semicolon
id|map
op_increment
)paren
r_if
c_cond
(paren
id|map-&gt;sense
op_eq
id|sense
)paren
r_break
suffix:semicolon
r_return
id|map-&gt;vmode
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Find a suitable video mode&n;     *&n;     *  If the name of the wanted mode begins with `mac&squot;, use the Mac video&n;     *  mode database, else fall back to the standard video mode database.&n;     */
DECL|function|mac_find_mode
r_int
id|__init
id|mac_find_mode
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_char
op_star
id|mode_option
comma
r_int
r_int
id|default_bpp
)paren
(brace
r_const
r_struct
id|fb_videomode
op_star
id|db
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|dbsize
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode_option
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|mode_option
comma
l_string|&quot;mac&quot;
comma
l_int|3
)paren
)paren
(brace
id|db
op_assign
id|mac_modedb
suffix:semicolon
id|dbsize
op_assign
r_sizeof
(paren
id|mac_modedb
)paren
op_div
r_sizeof
(paren
op_star
id|mac_modedb
)paren
suffix:semicolon
)brace
r_return
id|fb_find_mode
c_func
(paren
id|var
comma
id|info
comma
id|mode_option
comma
id|db
comma
id|dbsize
comma
op_amp
id|mac_modedb
(braket
id|DEFAULT_MODEDB_INDEX
)braket
comma
id|default_bpp
)paren
suffix:semicolon
)brace
eof
