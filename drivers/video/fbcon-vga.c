multiline_comment|/*&n; *  linux/drivers/video/fbcon-vga.c -- Low level frame buffer operations for&n; *&t;&t;&t;&t;       VGA characters/attributes&n; *&n; *&t;Created 28 Mar 1998 by Geert Uytterhoeven&n; *&t;Monochrome attributes added May 1998 by Andrew Apted&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-vga.h&gt;
multiline_comment|/*&n;     *  VGA screen access&n;     */
DECL|function|vga_writew
r_static
r_inline
r_void
id|vga_writew
c_func
(paren
id|u16
id|val
comma
id|u16
op_star
id|addr
)paren
(brace
macro_line|#ifdef __powerpc__
id|st_le16
c_func
(paren
id|addr
comma
id|val
)paren
suffix:semicolon
macro_line|#else
id|writew
c_func
(paren
id|val
comma
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
macro_line|#endif /* !__powerpc__ */
)brace
DECL|function|vga_readw
r_static
r_inline
id|u16
id|vga_readw
c_func
(paren
id|u16
op_star
id|addr
)paren
(brace
macro_line|#ifdef __powerpc__
r_return
id|ld_le16
c_func
(paren
id|addr
)paren
suffix:semicolon
macro_line|#else
r_return
id|readw
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
macro_line|#endif /* !__powerpc__ */&t;
)brace
DECL|function|vga_memsetw
r_static
r_inline
r_void
id|vga_memsetw
c_func
(paren
r_void
op_star
id|s
comma
id|u16
id|c
comma
r_int
r_int
id|count
)paren
(brace
id|u16
op_star
id|addr
op_assign
(paren
id|u16
op_star
)paren
id|s
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|vga_writew
c_func
(paren
id|c
comma
id|addr
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|vga_memmovew
r_static
r_inline
r_void
id|vga_memmovew
c_func
(paren
id|u16
op_star
id|to
comma
id|u16
op_star
id|from
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|to
OL
id|from
)paren
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|vga_writew
c_func
(paren
id|vga_readw
c_func
(paren
id|from
op_increment
)paren
comma
id|to
op_increment
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|from
op_add_assign
id|count
suffix:semicolon
id|to
op_add_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|vga_writew
c_func
(paren
id|vga_readw
c_func
(paren
op_decrement
id|from
)paren
comma
op_decrement
id|to
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;     *  VGA characters/attributes&n;     */
DECL|function|fbcon_vga_attr
r_static
r_inline
id|u16
id|fbcon_vga_attr
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
r_int
id|s
)paren
(brace
multiline_comment|/* Underline and reverse-video are mutually exclusive on MDA.&n;         * Since reverse-video is used for cursors and selected areas, &n;&t; * it takes precedence.&n;         */
r_return
(paren
id|attr_reverse
c_func
(paren
id|p
comma
id|s
)paren
ques
c_cond
l_int|0x7000
suffix:colon
(paren
id|attr_underline
c_func
(paren
id|p
comma
id|s
)paren
ques
c_cond
l_int|0x0100
suffix:colon
l_int|0x0700
)paren
)paren
op_or
(paren
id|attr_bold
c_func
(paren
id|p
comma
id|s
)paren
ques
c_cond
l_int|0x0800
suffix:colon
l_int|0
)paren
op_or
(paren
id|attr_blink
c_func
(paren
id|p
comma
id|s
)paren
ques
c_cond
l_int|0x8000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|fbcon_vga_setup
r_void
id|fbcon_vga_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_vga_bmove
r_void
id|fbcon_vga_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u16
op_star
id|src
comma
op_star
id|dst
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
op_div
l_int|2
)paren
(brace
id|src
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;next_line
)paren
suffix:semicolon
id|vga_memmovew
c_func
(paren
id|dst
comma
id|src
comma
id|height
op_star
id|width
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dy
OL
id|sy
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
)paren
(brace
id|src
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
op_plus
id|sx
op_star
l_int|2
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;next_line
op_plus
id|dx
op_star
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|vga_memmovew
c_func
(paren
id|dst
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_add_assign
id|p-&gt;next_line
op_div
l_int|2
suffix:semicolon
id|dst
op_add_assign
id|p-&gt;next_line
op_div
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|src
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
(paren
id|sy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|p-&gt;next_line
op_plus
id|sx
op_star
l_int|2
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
(paren
id|dy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|p-&gt;next_line
op_plus
id|dx
op_star
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|vga_memmovew
c_func
(paren
id|dst
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_sub_assign
id|p-&gt;next_line
op_div
l_int|2
suffix:semicolon
id|dst
op_sub_assign
id|p-&gt;next_line
op_div
l_int|2
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_vga_clear
r_void
id|fbcon_vga_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u16
op_star
id|dest
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
op_plus
id|sx
op_star
l_int|2
)paren
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_star
l_int|2
op_eq
id|p-&gt;next_line
)paren
id|vga_memsetw
c_func
(paren
id|dest
comma
id|conp-&gt;vc_video_erase_char
comma
id|height
op_star
id|width
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|rows
op_assign
id|height
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
op_div
l_int|2
)paren
id|vga_memsetw
c_func
(paren
id|dest
comma
id|conp-&gt;vc_video_erase_char
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|fbcon_vga_putc
r_void
id|fbcon_vga_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u16
op_star
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;next_line
op_plus
id|x
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_can_do_color
)paren
id|vga_writew
c_func
(paren
id|c
comma
id|dst
)paren
suffix:semicolon
r_else
id|vga_writew
c_func
(paren
id|fbcon_vga_attr
c_func
(paren
id|p
comma
id|c
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
comma
id|dst
)paren
suffix:semicolon
)brace
DECL|function|fbcon_vga_putcs
r_void
id|fbcon_vga_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u16
op_star
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;next_line
op_plus
id|x
op_star
l_int|2
)paren
suffix:semicolon
id|u16
id|sattr
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_can_do_color
)paren
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|vga_writew
c_func
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
r_else
(brace
id|sattr
op_assign
id|fbcon_vga_attr
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|vga_writew
c_func
(paren
id|sattr
op_or
(paren
(paren
r_int
)paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
)paren
op_amp
l_int|0xff
)paren
comma
id|dst
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|fbcon_vga_revc
r_void
id|fbcon_vga_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u16
op_star
id|dst
op_assign
(paren
id|u16
op_star
)paren
(paren
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;next_line
op_plus
id|x
op_star
l_int|2
)paren
suffix:semicolon
id|u16
id|val
op_assign
id|vga_readw
c_func
(paren
id|dst
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
id|val
op_lshift
l_int|4
)paren
op_amp
l_int|0x7000
)paren
op_or
(paren
(paren
id|val
op_rshift
l_int|4
)paren
op_amp
l_int|0x0700
)paren
suffix:semicolon
id|vga_writew
c_func
(paren
id|val
comma
id|dst
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;     *  `switch&squot; for the low level operations&n;     */
DECL|variable|fbcon_vga
r_struct
id|display_switch
id|fbcon_vga
op_assign
(brace
id|setup
suffix:colon
id|fbcon_vga_setup
comma
id|bmove
suffix:colon
id|fbcon_vga_bmove
comma
id|clear
suffix:colon
id|fbcon_vga_clear
comma
id|putc
suffix:colon
id|fbcon_vga_putc
comma
id|putcs
suffix:colon
id|fbcon_vga_putcs
comma
id|revc
suffix:colon
id|fbcon_vga_revc
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
)brace
suffix:semicolon
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#endif /* MODULE */
multiline_comment|/*&n;     *  Visible symbols for modules&n;     */
DECL|variable|fbcon_vga
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga
)paren
suffix:semicolon
DECL|variable|fbcon_vga_setup
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_setup
)paren
suffix:semicolon
DECL|variable|fbcon_vga_bmove
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_bmove
)paren
suffix:semicolon
DECL|variable|fbcon_vga_clear
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_clear
)paren
suffix:semicolon
DECL|variable|fbcon_vga_putc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_putc
)paren
suffix:semicolon
DECL|variable|fbcon_vga_putcs
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_putcs
)paren
suffix:semicolon
DECL|variable|fbcon_vga_revc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_vga_revc
)paren
suffix:semicolon
eof
