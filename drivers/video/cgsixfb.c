multiline_comment|/* $Id: cgsixfb.c,v 1.23 2000/07/26 23:02:51 davem Exp $&n; * cgsixfb.c: CGsix (GX,GXplus) frame buffer driver&n; *&n; * Copyright (C) 1996,1998 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;video/sbusfb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* Offset of interesting structures in the OBIO space */
multiline_comment|/*&n; * Brooktree is the video dac and is funny to program on the cg6.&n; * (it&squot;s even funnier on the cg3)&n; * The FBC could be the frame buffer control&n; * The FHC could is the frame buffer hardware control.&n; */
DECL|macro|CG6_ROM_OFFSET
mdefine_line|#define CG6_ROM_OFFSET       0x0UL
DECL|macro|CG6_BROOKTREE_OFFSET
mdefine_line|#define CG6_BROOKTREE_OFFSET 0x200000UL
DECL|macro|CG6_DHC_OFFSET
mdefine_line|#define CG6_DHC_OFFSET       0x240000UL
DECL|macro|CG6_ALT_OFFSET
mdefine_line|#define CG6_ALT_OFFSET       0x280000UL
DECL|macro|CG6_FHC_OFFSET
mdefine_line|#define CG6_FHC_OFFSET       0x300000UL
DECL|macro|CG6_THC_OFFSET
mdefine_line|#define CG6_THC_OFFSET       0x301000UL
DECL|macro|CG6_FBC_OFFSET
mdefine_line|#define CG6_FBC_OFFSET       0x700000UL
DECL|macro|CG6_TEC_OFFSET
mdefine_line|#define CG6_TEC_OFFSET       0x701000UL
DECL|macro|CG6_RAM_OFFSET
mdefine_line|#define CG6_RAM_OFFSET       0x800000UL
multiline_comment|/* FHC definitions */
DECL|macro|CG6_FHC_FBID_SHIFT
mdefine_line|#define CG6_FHC_FBID_SHIFT           24
DECL|macro|CG6_FHC_FBID_MASK
mdefine_line|#define CG6_FHC_FBID_MASK            255
DECL|macro|CG6_FHC_REV_SHIFT
mdefine_line|#define CG6_FHC_REV_SHIFT            20
DECL|macro|CG6_FHC_REV_MASK
mdefine_line|#define CG6_FHC_REV_MASK             15
DECL|macro|CG6_FHC_FROP_DISABLE
mdefine_line|#define CG6_FHC_FROP_DISABLE         (1 &lt;&lt; 19)
DECL|macro|CG6_FHC_ROW_DISABLE
mdefine_line|#define CG6_FHC_ROW_DISABLE          (1 &lt;&lt; 18)
DECL|macro|CG6_FHC_SRC_DISABLE
mdefine_line|#define CG6_FHC_SRC_DISABLE          (1 &lt;&lt; 17)
DECL|macro|CG6_FHC_DST_DISABLE
mdefine_line|#define CG6_FHC_DST_DISABLE          (1 &lt;&lt; 16)
DECL|macro|CG6_FHC_RESET
mdefine_line|#define CG6_FHC_RESET                (1 &lt;&lt; 15)
DECL|macro|CG6_FHC_LITTLE_ENDIAN
mdefine_line|#define CG6_FHC_LITTLE_ENDIAN        (1 &lt;&lt; 13)
DECL|macro|CG6_FHC_RES_MASK
mdefine_line|#define CG6_FHC_RES_MASK             (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_1024
mdefine_line|#define CG6_FHC_1024                 (0 &lt;&lt; 11)
DECL|macro|CG6_FHC_1152
mdefine_line|#define CG6_FHC_1152                 (1 &lt;&lt; 11)
DECL|macro|CG6_FHC_1280
mdefine_line|#define CG6_FHC_1280                 (2 &lt;&lt; 11)
DECL|macro|CG6_FHC_1600
mdefine_line|#define CG6_FHC_1600                 (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_CPU_MASK
mdefine_line|#define CG6_FHC_CPU_MASK             (3 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_SPARC
mdefine_line|#define CG6_FHC_CPU_SPARC            (0 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_68020
mdefine_line|#define CG6_FHC_CPU_68020            (1 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_386
mdefine_line|#define CG6_FHC_CPU_386              (2 &lt;&lt; 9)
DECL|macro|CG6_FHC_TEST
mdefine_line|#define CG6_FHC_TEST&t;&t;     (1 &lt;&lt; 8)
DECL|macro|CG6_FHC_TEST_X_SHIFT
mdefine_line|#define CG6_FHC_TEST_X_SHIFT&t;     4
DECL|macro|CG6_FHC_TEST_X_MASK
mdefine_line|#define CG6_FHC_TEST_X_MASK&t;     15
DECL|macro|CG6_FHC_TEST_Y_SHIFT
mdefine_line|#define CG6_FHC_TEST_Y_SHIFT&t;     0
DECL|macro|CG6_FHC_TEST_Y_MASK
mdefine_line|#define CG6_FHC_TEST_Y_MASK&t;     15
multiline_comment|/* FBC mode definitions */
DECL|macro|CG6_FBC_BLIT_IGNORE
mdefine_line|#define CG6_FBC_BLIT_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BLIT_NOSRC
mdefine_line|#define CG6_FBC_BLIT_NOSRC&t;&t;0x00100000
DECL|macro|CG6_FBC_BLIT_SRC
mdefine_line|#define CG6_FBC_BLIT_SRC&t;&t;0x00200000
DECL|macro|CG6_FBC_BLIT_ILLEGAL
mdefine_line|#define CG6_FBC_BLIT_ILLEGAL&t;&t;0x00300000
DECL|macro|CG6_FBC_BLIT_MASK
mdefine_line|#define CG6_FBC_BLIT_MASK&t;&t;0x00300000
DECL|macro|CG6_FBC_VBLANK
mdefine_line|#define CG6_FBC_VBLANK&t;&t;&t;0x00080000
DECL|macro|CG6_FBC_MODE_IGNORE
mdefine_line|#define CG6_FBC_MODE_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_MODE_COLOR8
mdefine_line|#define CG6_FBC_MODE_COLOR8&t;&t;0x00020000
DECL|macro|CG6_FBC_MODE_COLOR1
mdefine_line|#define CG6_FBC_MODE_COLOR1&t;&t;0x00040000
DECL|macro|CG6_FBC_MODE_HRMONO
mdefine_line|#define CG6_FBC_MODE_HRMONO&t;&t;0x00060000
DECL|macro|CG6_FBC_MODE_MASK
mdefine_line|#define CG6_FBC_MODE_MASK&t;&t;0x00060000
DECL|macro|CG6_FBC_DRAW_IGNORE
mdefine_line|#define CG6_FBC_DRAW_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_DRAW_RENDER
mdefine_line|#define CG6_FBC_DRAW_RENDER&t;&t;0x00008000
DECL|macro|CG6_FBC_DRAW_PICK
mdefine_line|#define CG6_FBC_DRAW_PICK&t;&t;0x00010000
DECL|macro|CG6_FBC_DRAW_ILLEGAL
mdefine_line|#define CG6_FBC_DRAW_ILLEGAL&t;&t;0x00018000
DECL|macro|CG6_FBC_DRAW_MASK
mdefine_line|#define CG6_FBC_DRAW_MASK&t;&t;0x00018000
DECL|macro|CG6_FBC_BWRITE0_IGNORE
mdefine_line|#define CG6_FBC_BWRITE0_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE0_ENABLE
mdefine_line|#define CG6_FBC_BWRITE0_ENABLE&t;&t;0x00002000
DECL|macro|CG6_FBC_BWRITE0_DISABLE
mdefine_line|#define CG6_FBC_BWRITE0_DISABLE&t;&t;0x00004000
DECL|macro|CG6_FBC_BWRITE0_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE0_ILLEGAL&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE0_MASK
mdefine_line|#define CG6_FBC_BWRITE0_MASK&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE1_IGNORE
mdefine_line|#define CG6_FBC_BWRITE1_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE1_ENABLE
mdefine_line|#define CG6_FBC_BWRITE1_ENABLE&t;&t;0x00000800
DECL|macro|CG6_FBC_BWRITE1_DISABLE
mdefine_line|#define CG6_FBC_BWRITE1_DISABLE&t;&t;0x00001000
DECL|macro|CG6_FBC_BWRITE1_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE1_ILLEGAL&t;&t;0x00001800
DECL|macro|CG6_FBC_BWRITE1_MASK
mdefine_line|#define CG6_FBC_BWRITE1_MASK&t;&t;0x00001800
DECL|macro|CG6_FBC_BREAD_IGNORE
mdefine_line|#define CG6_FBC_BREAD_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BREAD_0
mdefine_line|#define CG6_FBC_BREAD_0&t;&t;&t;0x00000200
DECL|macro|CG6_FBC_BREAD_1
mdefine_line|#define CG6_FBC_BREAD_1&t;&t;&t;0x00000400
DECL|macro|CG6_FBC_BREAD_ILLEGAL
mdefine_line|#define CG6_FBC_BREAD_ILLEGAL&t;&t;0x00000600
DECL|macro|CG6_FBC_BREAD_MASK
mdefine_line|#define CG6_FBC_BREAD_MASK&t;&t;0x00000600
DECL|macro|CG6_FBC_BDISP_IGNORE
mdefine_line|#define CG6_FBC_BDISP_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BDISP_0
mdefine_line|#define CG6_FBC_BDISP_0&t;&t;&t;0x00000080
DECL|macro|CG6_FBC_BDISP_1
mdefine_line|#define CG6_FBC_BDISP_1&t;&t;&t;0x00000100
DECL|macro|CG6_FBC_BDISP_ILLEGAL
mdefine_line|#define CG6_FBC_BDISP_ILLEGAL&t;&t;0x00000180
DECL|macro|CG6_FBC_BDISP_MASK
mdefine_line|#define CG6_FBC_BDISP_MASK&t;&t;0x00000180
DECL|macro|CG6_FBC_INDEX_MOD
mdefine_line|#define CG6_FBC_INDEX_MOD&t;&t;0x00000040
DECL|macro|CG6_FBC_INDEX_MASK
mdefine_line|#define CG6_FBC_INDEX_MASK&t;&t;0x00000030
multiline_comment|/* THC definitions */
DECL|macro|CG6_THC_MISC_REV_SHIFT
mdefine_line|#define CG6_THC_MISC_REV_SHIFT       16
DECL|macro|CG6_THC_MISC_REV_MASK
mdefine_line|#define CG6_THC_MISC_REV_MASK        15
DECL|macro|CG6_THC_MISC_RESET
mdefine_line|#define CG6_THC_MISC_RESET           (1 &lt;&lt; 12)
DECL|macro|CG6_THC_MISC_VIDEO
mdefine_line|#define CG6_THC_MISC_VIDEO           (1 &lt;&lt; 10)
DECL|macro|CG6_THC_MISC_SYNC
mdefine_line|#define CG6_THC_MISC_SYNC            (1 &lt;&lt; 9)
DECL|macro|CG6_THC_MISC_VSYNC
mdefine_line|#define CG6_THC_MISC_VSYNC           (1 &lt;&lt; 8)
DECL|macro|CG6_THC_MISC_SYNC_ENAB
mdefine_line|#define CG6_THC_MISC_SYNC_ENAB       (1 &lt;&lt; 7)
DECL|macro|CG6_THC_MISC_CURS_RES
mdefine_line|#define CG6_THC_MISC_CURS_RES        (1 &lt;&lt; 6)
DECL|macro|CG6_THC_MISC_INT_ENAB
mdefine_line|#define CG6_THC_MISC_INT_ENAB        (1 &lt;&lt; 5)
DECL|macro|CG6_THC_MISC_INT
mdefine_line|#define CG6_THC_MISC_INT             (1 &lt;&lt; 4)
DECL|macro|CG6_THC_MISC_INIT
mdefine_line|#define CG6_THC_MISC_INIT            0x9f
multiline_comment|/* The contents are unknown */
DECL|struct|cg6_tec
r_struct
id|cg6_tec
(brace
DECL|member|tec_matrix
r_volatile
r_int
id|tec_matrix
suffix:semicolon
DECL|member|tec_clip
r_volatile
r_int
id|tec_clip
suffix:semicolon
DECL|member|tec_vdc
r_volatile
r_int
id|tec_vdc
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cg6_thc
r_struct
id|cg6_thc
(brace
DECL|member|thc_pad0
id|uint
id|thc_pad0
(braket
l_int|512
)braket
suffix:semicolon
DECL|member|thc_hs
r_volatile
id|uint
id|thc_hs
suffix:semicolon
multiline_comment|/* hsync timing */
DECL|member|thc_hsdvs
r_volatile
id|uint
id|thc_hsdvs
suffix:semicolon
DECL|member|thc_hd
r_volatile
id|uint
id|thc_hd
suffix:semicolon
DECL|member|thc_vs
r_volatile
id|uint
id|thc_vs
suffix:semicolon
multiline_comment|/* vsync timing */
DECL|member|thc_vd
r_volatile
id|uint
id|thc_vd
suffix:semicolon
DECL|member|thc_refresh
r_volatile
id|uint
id|thc_refresh
suffix:semicolon
DECL|member|thc_misc
r_volatile
id|uint
id|thc_misc
suffix:semicolon
DECL|member|thc_pad1
id|uint
id|thc_pad1
(braket
l_int|56
)braket
suffix:semicolon
DECL|member|thc_cursxy
r_volatile
id|uint
id|thc_cursxy
suffix:semicolon
multiline_comment|/* cursor x,y position (16 bits each) */
DECL|member|thc_cursmask
r_volatile
id|uint
id|thc_cursmask
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* cursor mask bits */
DECL|member|thc_cursbits
r_volatile
id|uint
id|thc_cursbits
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* what to show where mask enabled */
)brace
suffix:semicolon
DECL|struct|cg6_fbc
r_struct
id|cg6_fbc
(brace
DECL|member|xxx0
id|u32
id|xxx0
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|mode
r_volatile
id|u32
id|mode
suffix:semicolon
DECL|member|clip
r_volatile
id|u32
id|clip
suffix:semicolon
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|s
r_volatile
id|u32
id|s
suffix:semicolon
DECL|member|draw
r_volatile
id|u32
id|draw
suffix:semicolon
DECL|member|blit
r_volatile
id|u32
id|blit
suffix:semicolon
DECL|member|font
r_volatile
id|u32
id|font
suffix:semicolon
DECL|member|xxx2
id|u32
id|xxx2
(braket
l_int|24
)braket
suffix:semicolon
DECL|member|x0
DECL|member|y0
DECL|member|z0
DECL|member|color0
r_volatile
id|u32
id|x0
comma
id|y0
comma
id|z0
comma
id|color0
suffix:semicolon
DECL|member|x1
DECL|member|y1
DECL|member|z1
DECL|member|color1
r_volatile
id|u32
id|x1
comma
id|y1
comma
id|z1
comma
id|color1
suffix:semicolon
DECL|member|x2
DECL|member|y2
DECL|member|z2
DECL|member|color2
r_volatile
id|u32
id|x2
comma
id|y2
comma
id|z2
comma
id|color2
suffix:semicolon
DECL|member|x3
DECL|member|y3
DECL|member|z3
DECL|member|color3
r_volatile
id|u32
id|x3
comma
id|y3
comma
id|z3
comma
id|color3
suffix:semicolon
DECL|member|offx
DECL|member|offy
r_volatile
id|u32
id|offx
comma
id|offy
suffix:semicolon
DECL|member|xxx3
id|u32
id|xxx3
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|incx
DECL|member|incy
r_volatile
id|u32
id|incx
comma
id|incy
suffix:semicolon
DECL|member|xxx4
id|u32
id|xxx4
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipminx
DECL|member|clipminy
r_volatile
id|u32
id|clipminx
comma
id|clipminy
suffix:semicolon
DECL|member|xxx5
id|u32
id|xxx5
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipmaxx
DECL|member|clipmaxy
r_volatile
id|u32
id|clipmaxx
comma
id|clipmaxy
suffix:semicolon
DECL|member|xxx6
id|u32
id|xxx6
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|fg
r_volatile
id|u32
id|fg
suffix:semicolon
DECL|member|bg
r_volatile
id|u32
id|bg
suffix:semicolon
DECL|member|alu
r_volatile
id|u32
id|alu
suffix:semicolon
DECL|member|pm
r_volatile
id|u32
id|pm
suffix:semicolon
DECL|member|pixelm
r_volatile
id|u32
id|pixelm
suffix:semicolon
DECL|member|xxx7
id|u32
id|xxx7
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|patalign
r_volatile
id|u32
id|patalign
suffix:semicolon
DECL|member|pattern
r_volatile
id|u32
id|pattern
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|xxx8
id|u32
id|xxx8
(braket
l_int|432
)braket
suffix:semicolon
DECL|member|apointx
DECL|member|apointy
DECL|member|apointz
r_volatile
id|u32
id|apointx
comma
id|apointy
comma
id|apointz
suffix:semicolon
DECL|member|xxx9
id|u32
id|xxx9
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rpointx
DECL|member|rpointy
DECL|member|rpointz
r_volatile
id|u32
id|rpointx
comma
id|rpointy
comma
id|rpointz
suffix:semicolon
DECL|member|xxx10
id|u32
id|xxx10
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|pointr
DECL|member|pointg
DECL|member|pointb
DECL|member|pointa
r_volatile
id|u32
id|pointr
comma
id|pointg
comma
id|pointb
comma
id|pointa
suffix:semicolon
DECL|member|alinex
DECL|member|aliney
DECL|member|alinez
r_volatile
id|u32
id|alinex
comma
id|aliney
comma
id|alinez
suffix:semicolon
DECL|member|xxx11
id|u32
id|xxx11
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rlinex
DECL|member|rliney
DECL|member|rlinez
r_volatile
id|u32
id|rlinex
comma
id|rliney
comma
id|rlinez
suffix:semicolon
DECL|member|xxx12
id|u32
id|xxx12
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|liner
DECL|member|lineg
DECL|member|lineb
DECL|member|linea
r_volatile
id|u32
id|liner
comma
id|lineg
comma
id|lineb
comma
id|linea
suffix:semicolon
DECL|member|atrix
DECL|member|atriy
DECL|member|atriz
r_volatile
id|u32
id|atrix
comma
id|atriy
comma
id|atriz
suffix:semicolon
DECL|member|xxx13
id|u32
id|xxx13
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rtrix
DECL|member|rtriy
DECL|member|rtriz
r_volatile
id|u32
id|rtrix
comma
id|rtriy
comma
id|rtriz
suffix:semicolon
DECL|member|xxx14
id|u32
id|xxx14
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|trir
DECL|member|trig
DECL|member|trib
DECL|member|tria
r_volatile
id|u32
id|trir
comma
id|trig
comma
id|trib
comma
id|tria
suffix:semicolon
DECL|member|aquadx
DECL|member|aquady
DECL|member|aquadz
r_volatile
id|u32
id|aquadx
comma
id|aquady
comma
id|aquadz
suffix:semicolon
DECL|member|xxx15
id|u32
id|xxx15
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rquadx
DECL|member|rquady
DECL|member|rquadz
r_volatile
id|u32
id|rquadx
comma
id|rquady
comma
id|rquadz
suffix:semicolon
DECL|member|xxx16
id|u32
id|xxx16
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|quadr
DECL|member|quadg
DECL|member|quadb
DECL|member|quada
r_volatile
id|u32
id|quadr
comma
id|quadg
comma
id|quadb
comma
id|quada
suffix:semicolon
DECL|member|arectx
DECL|member|arecty
DECL|member|arectz
r_volatile
id|u32
id|arectx
comma
id|arecty
comma
id|arectz
suffix:semicolon
DECL|member|xxx17
id|u32
id|xxx17
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rrectx
DECL|member|rrecty
DECL|member|rrectz
r_volatile
id|u32
id|rrectx
comma
id|rrecty
comma
id|rrectz
suffix:semicolon
DECL|member|xxx18
id|u32
id|xxx18
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|rectr
DECL|member|rectg
DECL|member|rectb
DECL|member|recta
r_volatile
id|u32
id|rectr
comma
id|rectg
comma
id|rectb
comma
id|recta
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|cg6_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|cg6_mmap_map
(braket
)braket
op_assign
(brace
(brace
id|CG6_FBC
comma
id|CG6_FBC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_TEC
comma
id|CG6_TEC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_BTREGS
comma
id|CG6_BROOKTREE_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_FHC
comma
id|CG6_FHC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_THC
comma
id|CG6_THC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_ROM
comma
id|CG6_ROM_OFFSET
comma
l_int|0x10000
)brace
comma
(brace
id|CG6_RAM
comma
id|CG6_RAM_OFFSET
comma
id|SBUS_MMAP_FBSIZE
c_func
(paren
l_int|1
)paren
)brace
comma
(brace
id|CG6_DHC
comma
id|CG6_DHC_OFFSET
comma
l_int|0x40000
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|cg6_setup
r_static
r_void
id|cg6_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
id|p-&gt;next_line
op_assign
id|sbusfbinfo
c_func
(paren
id|p-&gt;fb_info
)paren
op_member_access_from_pointer
id|var.xres_virtual
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|cg6_clear
r_static
r_void
id|cg6_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|x
comma
id|y
comma
id|w
comma
id|h
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xea80ff00
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|y
op_assign
id|sy
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|h
op_assign
id|height
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|y
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|h
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
(brace
id|x
op_assign
id|sx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
id|w
op_assign
id|width
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|x
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|w
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|sbus_writel
c_func
(paren
id|y
op_plus
id|fb-&gt;y_margin
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
op_plus
id|fb-&gt;x_margin
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
op_plus
id|fb-&gt;y_margin
op_plus
id|h
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
op_plus
id|fb-&gt;x_margin
op_plus
id|w
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;draw
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
l_int|0
op_logical_and
(paren
id|i
op_amp
l_int|0x20000000
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_fill
r_static
r_void
id|cg6_fill
c_func
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|s
comma
r_int
id|count
comma
r_int
r_int
op_star
id|boxes
)paren
(brace
r_int
id|i
suffix:semicolon
r_register
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|s
)paren
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|s
)paren
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xea80ff00
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
id|sbus_writel
c_func
(paren
id|boxes
(braket
l_int|1
)braket
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|boxes
(braket
l_int|0
)braket
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|boxes
(braket
l_int|3
)braket
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|boxes
(braket
l_int|2
)braket
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
id|boxes
op_add_assign
l_int|4
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;draw
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
l_int|0
op_logical_and
(paren
id|i
op_amp
l_int|0x20000000
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_putc
r_static
r_void
id|cg6_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|x
comma
id|y
suffix:semicolon
id|u8
op_star
id|fd
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|y
op_assign
id|fb-&gt;y_margin
op_plus
(paren
id|yy
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|i
op_assign
(paren
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|y
op_assign
id|fb-&gt;y_margin
op_plus
(paren
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|i
op_assign
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|fd
op_assign
id|p-&gt;fontdata
op_plus
id|i
suffix:semicolon
r_else
id|fd
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|i
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
id|x
op_assign
id|fb-&gt;x_margin
op_plus
(paren
id|xx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|x
op_assign
id|fb-&gt;x_margin
op_plus
(paren
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x140000
comma
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xe880fc30
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xff
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;incx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|1
comma
op_amp
id|fbc-&gt;incy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
op_plus
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
op_star
id|fd
op_increment
op_lshift
l_int|24
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
op_star
(paren
id|u16
op_star
)paren
id|fd
op_lshift
l_int|16
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
id|fd
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_putcs
r_static
r_void
id|cg6_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
(paren
r_struct
id|fb_info_sbusfb
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_register
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|x
comma
id|y
suffix:semicolon
id|u8
op_star
id|fd1
comma
op_star
id|fd2
comma
op_star
id|fd3
comma
op_star
id|fd4
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|scr_readw
c_func
(paren
id|s
)paren
)paren
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x140000
comma
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xe880fc30
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xff
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
id|x
op_assign
id|fb-&gt;x_margin
suffix:semicolon
id|y
op_assign
id|fb-&gt;y_margin
suffix:semicolon
r_if
c_cond
(paren
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
id|x
op_add_assign
(paren
id|xx
op_lshift
id|fontwidthlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|x
op_add_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
id|y
op_add_assign
(paren
id|yy
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|y
op_add_assign
(paren
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
r_while
c_loop
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|count
op_sub_assign
l_int|4
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;incx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|1
comma
op_amp
id|fbc-&gt;incy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|x
op_add_assign
l_int|4
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd3
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd4
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd3
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|fd4
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_eq
l_int|8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
(paren
(paren
id|u32
)paren
op_star
id|fd4
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd3
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd2
op_increment
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd1
op_increment
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd4
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd3
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd2
op_increment
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
op_star
id|fd1
op_increment
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_lshift
(paren
l_int|24
op_minus
l_int|3
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
op_ge
l_int|2
)paren
(brace
id|count
op_sub_assign
l_int|2
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;incx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|1
comma
op_amp
id|fbc-&gt;incy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|x
op_add_assign
l_int|2
op_star
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|fd2
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
(paren
(paren
(paren
(paren
id|u32
)paren
op_star
(paren
id|u16
op_star
)paren
id|fd1
)paren
op_lshift
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_or
(paren
(paren
id|u32
)paren
op_star
(paren
id|u16
op_star
)paren
id|fd2
)paren
)paren
op_lshift
(paren
l_int|16
op_minus
id|fontwidth
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
id|fd1
op_add_assign
l_int|2
suffix:semicolon
id|fd2
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;incx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|1
comma
op_amp
id|fbc-&gt;incy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|x
op_add_assign
id|fontwidth
c_func
(paren
id|p
)paren
)paren
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
id|i
op_assign
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_lshift
id|fontheightlog
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_else
id|i
op_assign
(paren
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
op_star
id|fd1
op_increment
op_lshift
l_int|24
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|fd1
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|i
op_lshift
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
op_star
(paren
id|u16
op_star
)paren
id|fd1
op_lshift
l_int|16
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
id|fd1
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_revc
r_static
r_void
id|cg6_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
multiline_comment|/* Not used if hw cursor */
)brace
DECL|function|cg6_loadcmap
r_static
r_void
id|cg6_loadcmap
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|fb-&gt;s.cg6.bt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|index
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|index
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sbus_writel
c_func
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_restore_palette
r_static
r_void
id|cg6_restore_palette
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|fb-&gt;s.cg6.bt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|display_switch
id|cg6_dispsw
id|__initdata
op_assign
(brace
id|setup
suffix:colon
id|cg6_setup
comma
id|bmove
suffix:colon
id|fbcon_redraw_bmove
comma
id|clear
suffix:colon
id|cg6_clear
comma
id|putc
suffix:colon
id|cg6_putc
comma
id|putcs
suffix:colon
id|cg6_putcs
comma
id|revc
suffix:colon
id|cg6_revc
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
multiline_comment|/* Allow fontwidths up to 16 */
)brace
suffix:semicolon
DECL|function|cg6_setcursormap
r_static
r_void
id|cg6_setcursormap
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|fb-&gt;s.cg6.bt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|1
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|red
(braket
l_int|0
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|green
(braket
l_int|0
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|blue
(braket
l_int|0
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|3
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|red
(braket
l_int|1
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|green
(braket
l_int|1
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|blue
(braket
l_int|1
)braket
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;cursor
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Set cursor shape */
DECL|function|cg6_setcurshape
r_static
r_void
id|cg6_setcurshape
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_struct
id|cg6_thc
op_star
id|thc
op_assign
id|fb-&gt;s.cg6.thc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sbus_writel
c_func
(paren
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
id|i
)braket
comma
op_amp
id|thc-&gt;thc_cursmask
(braket
id|i
)braket
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
(braket
id|i
)braket
comma
op_amp
id|thc-&gt;thc_cursbits
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Load cursor information */
DECL|function|cg6_setcursor
r_static
r_void
id|cg6_setcursor
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|cg_cursor
op_star
id|c
op_assign
op_amp
id|fb-&gt;cursor
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;enable
)paren
id|v
op_assign
(paren
(paren
id|c-&gt;cpos.fbx
op_minus
id|c-&gt;chot.fbx
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|c-&gt;cpos.fby
op_minus
id|c-&gt;chot.fby
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_else
multiline_comment|/* Magic constant to turn off the cursor */
id|v
op_assign
(paren
(paren
l_int|65536
op_minus
l_int|32
)paren
op_lshift
l_int|16
)paren
op_or
(paren
l_int|65536
op_minus
l_int|32
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|v
comma
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_cursxy
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_blank
r_static
r_void
id|cg6_blank
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_misc
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CG6_THC_MISC_VIDEO
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_misc
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_unblank
r_static
r_void
id|cg6_unblank
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_misc
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CG6_THC_MISC_VIDEO
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_misc
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_reset
r_static
r_void
id|cg6_reset
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_int
r_int
id|rev
comma
id|conf
suffix:semicolon
r_struct
id|cg6_tec
op_star
id|tec
op_assign
id|fb-&gt;s.cg6.tec
suffix:semicolon
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|mode
comma
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Turn off stuff in the Transform Engine. */
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_matrix
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_vdc
)paren
suffix:semicolon
multiline_comment|/* Take care of bugs in old revisions. */
id|rev
op_assign
(paren
id|sbus_readl
c_func
(paren
id|fb-&gt;s.cg6.fhc
)paren
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|5
)paren
(brace
id|conf
op_assign
(paren
id|sbus_readl
c_func
(paren
id|fb-&gt;s.cg6.fhc
)paren
op_amp
id|CG6_FHC_RES_MASK
)paren
op_or
id|CG6_FHC_CPU_68020
op_or
id|CG6_FHC_TEST
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_X_SHIFT
)paren
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_Y_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|2
)paren
id|conf
op_or_assign
id|CG6_FHC_DST_DISABLE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|conf
comma
id|fb-&gt;s.cg6.fhc
)paren
suffix:semicolon
)brace
multiline_comment|/* Set things in the FBC. Bad things appear to happen if we do&n;&t; * back to back store/loads on the mode register, so copy it&n;&t; * out instead. */
id|mode
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|mode
op_and_assign
op_complement
(paren
id|CG6_FBC_BLIT_MASK
op_or
id|CG6_FBC_MODE_MASK
op_or
id|CG6_FBC_DRAW_MASK
op_or
id|CG6_FBC_BWRITE0_MASK
op_or
id|CG6_FBC_BWRITE1_MASK
op_or
id|CG6_FBC_BREAD_MASK
op_or
id|CG6_FBC_BDISP_MASK
)paren
suffix:semicolon
id|mode
op_or_assign
(paren
id|CG6_FBC_BLIT_SRC
op_or
id|CG6_FBC_MODE_COLOR8
op_or
id|CG6_FBC_DRAW_RENDER
op_or
id|CG6_FBC_BWRITE0_ENABLE
op_or
id|CG6_FBC_BWRITE1_DISABLE
op_or
id|CG6_FBC_BREAD_0
op_or
id|CG6_FBC_BDISP_0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|mode
comma
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;offx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;offy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clipminx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clipminy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|fb-&gt;type.fb_width
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;clipmaxx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|fb-&gt;type.fb_height
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;clipmaxy
)paren
suffix:semicolon
multiline_comment|/* Enable cursor in Brooktree DAC. */
id|sbus_writel
c_func
(paren
l_int|0x06
op_lshift
l_int|24
comma
op_amp
id|fb-&gt;s.cg6.bt-&gt;addr
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fb-&gt;s.cg6.bt-&gt;control
)paren
suffix:semicolon
id|tmp
op_or_assign
l_int|0x03
op_lshift
l_int|24
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
op_amp
id|fb-&gt;s.cg6.bt-&gt;control
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cg6_margins
r_static
r_void
id|cg6_margins
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|x_margin
comma
r_int
id|y_margin
)paren
(brace
id|p-&gt;screen_base
op_add_assign
(paren
id|y_margin
op_minus
id|fb-&gt;y_margin
)paren
op_star
id|p-&gt;line_length
op_plus
(paren
id|x_margin
op_minus
id|fb-&gt;x_margin
)paren
suffix:semicolon
)brace
DECL|function|cg6_rasterimg
r_static
r_int
id|__init
id|cg6_rasterimg
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|start
)paren
(brace
r_struct
id|fb_info_sbusfb
op_star
id|fb
op_assign
id|sbusfbinfo
c_func
(paren
id|info
)paren
suffix:semicolon
r_register
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|fb-&gt;s.cg6.fbc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_char
id|idstring
(braket
l_int|70
)braket
id|__initdata
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|function|cgsixfb_init
r_char
id|__init
op_star
id|cgsixfb_init
c_func
(paren
r_struct
id|fb_info_sbusfb
op_star
id|fb
)paren
(brace
r_struct
id|fb_fix_screeninfo
op_star
id|fix
op_assign
op_amp
id|fb-&gt;fix
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|fb-&gt;var
suffix:semicolon
r_struct
id|display
op_star
id|disp
op_assign
op_amp
id|fb-&gt;disp
suffix:semicolon
r_struct
id|fbtype
op_star
id|type
op_assign
op_amp
id|fb-&gt;type
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
op_assign
id|fb-&gt;sbdp
suffix:semicolon
r_int
r_int
id|phys
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|u32
id|conf
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
op_star
id|cardtype
suffix:semicolon
r_struct
id|bt_regs
op_star
id|bt
suffix:semicolon
r_struct
id|fb_ops
op_star
id|fbops
suffix:semicolon
id|fbops
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|fbops
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fbops
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|fbops
op_assign
op_star
id|fb-&gt;info.fbops
suffix:semicolon
id|fbops-&gt;fb_rasterimg
op_assign
id|cg6_rasterimg
suffix:semicolon
id|fb-&gt;info.fbops
op_assign
id|fbops
suffix:semicolon
r_if
c_cond
(paren
id|prom_getbool
(paren
id|fb-&gt;prom_node
comma
l_string|&quot;dblbuf&quot;
)paren
)paren
(brace
id|type-&gt;fb_size
op_mul_assign
l_int|4
suffix:semicolon
id|fix-&gt;smem_len
op_mul_assign
l_int|4
suffix:semicolon
)brace
id|fix-&gt;line_length
op_assign
id|fb-&gt;var.xres_virtual
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SUN_CGSIX
suffix:semicolon
id|var-&gt;accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|disp-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|disp-&gt;screen_base
)paren
(brace
id|disp-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_RAM_OFFSET
comma
id|type-&gt;fb_size
comma
l_string|&quot;cgsix ram&quot;
)paren
suffix:semicolon
)brace
id|disp-&gt;screen_base
op_add_assign
id|fix-&gt;line_length
op_star
id|fb-&gt;y_margin
op_plus
id|fb-&gt;x_margin
suffix:semicolon
id|fb-&gt;s.cg6.fbc
op_assign
(paren
r_struct
id|cg6_fbc
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_FBC_OFFSET
comma
l_int|4096
comma
l_string|&quot;cgsix fbc&quot;
)paren
suffix:semicolon
id|fb-&gt;s.cg6.tec
op_assign
(paren
r_struct
id|cg6_tec
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_TEC_OFFSET
comma
r_sizeof
(paren
r_struct
id|cg6_tec
)paren
comma
l_string|&quot;cgsix tec&quot;
)paren
suffix:semicolon
id|fb-&gt;s.cg6.thc
op_assign
(paren
r_struct
id|cg6_thc
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_THC_OFFSET
comma
r_sizeof
(paren
r_struct
id|cg6_thc
)paren
comma
l_string|&quot;cgsix thc&quot;
)paren
suffix:semicolon
id|fb-&gt;s.cg6.bt
op_assign
id|bt
op_assign
(paren
r_struct
id|bt_regs
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_BROOKTREE_OFFSET
comma
r_sizeof
(paren
r_struct
id|bt_regs
)paren
comma
l_string|&quot;cgsix dac&quot;
)paren
suffix:semicolon
id|fb-&gt;s.cg6.fhc
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_FHC_OFFSET
comma
r_sizeof
(paren
id|u32
)paren
comma
l_string|&quot;cgsix fhc&quot;
)paren
suffix:semicolon
macro_line|#if 0
id|prom_printf
c_func
(paren
l_string|&quot;CG6: RES[%016lx:%016lx:%016lx]&bslash;n&quot;
comma
id|sdev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
id|sdev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
comma
id|sdev-&gt;resource
(braket
l_int|0
)braket
dot
id|flags
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;CG6: fbc(%p) tec(%p) thc(%p) bt(%p) fhc(%p)&bslash;n&quot;
comma
id|fb-&gt;s.cg6.fbc
comma
id|fb-&gt;s.cg6.tec
comma
id|fb-&gt;s.cg6.thc
comma
id|fb-&gt;s.cg6.bt
comma
id|fb-&gt;s.cg6.fhc
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|fb-&gt;dispsw
op_assign
id|cg6_dispsw
suffix:semicolon
id|fb-&gt;margins
op_assign
id|cg6_margins
suffix:semicolon
id|fb-&gt;loadcmap
op_assign
id|cg6_loadcmap
suffix:semicolon
id|fb-&gt;setcursor
op_assign
id|cg6_setcursor
suffix:semicolon
id|fb-&gt;setcursormap
op_assign
id|cg6_setcursormap
suffix:semicolon
id|fb-&gt;setcurshape
op_assign
id|cg6_setcurshape
suffix:semicolon
id|fb-&gt;restore_palette
op_assign
id|cg6_restore_palette
suffix:semicolon
id|fb-&gt;fill
op_assign
id|cg6_fill
suffix:semicolon
id|fb-&gt;blank
op_assign
id|cg6_blank
suffix:semicolon
id|fb-&gt;unblank
op_assign
id|cg6_unblank
suffix:semicolon
id|fb-&gt;reset
op_assign
id|cg6_reset
suffix:semicolon
id|fb-&gt;physbase
op_assign
id|phys
suffix:semicolon
id|fb-&gt;mmap_map
op_assign
id|cg6_mmap_map
suffix:semicolon
multiline_comment|/* Initialize Brooktree DAC */
id|sbus_writel
c_func
(paren
l_int|0x04
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* color planes */
id|sbus_writel
c_func
(paren
l_int|0xff
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x05
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x06
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* overlay plane */
id|sbus_writel
c_func
(paren
l_int|0x73
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x07
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|conf
op_assign
id|sbus_readl
c_func
(paren
id|fb-&gt;s.cg6.fhc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf
op_amp
id|CG6_FHC_CPU_MASK
)paren
(brace
r_case
id|CG6_FHC_CPU_SPARC
suffix:colon
id|p
op_assign
l_string|&quot;sparc&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_FHC_CPU_68020
suffix:colon
id|p
op_assign
l_string|&quot;68020&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|p
op_assign
l_string|&quot;i386&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|conf
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
)paren
op_ge
l_int|11
)paren
(brace
r_if
c_cond
(paren
id|fix-&gt;smem_len
op_le
l_int|0x100000
)paren
(brace
id|cardtype
op_assign
l_string|&quot;TGX&quot;
suffix:semicolon
)brace
r_else
(brace
id|cardtype
op_assign
l_string|&quot;TGX+&quot;
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|fix-&gt;smem_len
op_le
l_int|0x100000
)paren
(brace
id|cardtype
op_assign
l_string|&quot;GX&quot;
suffix:semicolon
)brace
r_else
(brace
id|cardtype
op_assign
l_string|&quot;GX+&quot;
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|idstring
comma
macro_line|#ifdef __sparc_v9__
l_string|&quot;cgsix at %016lx TEC Rev %x CPU %s Rev %x [%s]&quot;
comma
id|phys
comma
macro_line|#else&t;
l_string|&quot;cgsix at %x.%08lx TEC Rev %x CPU %s Rev %x [%s]&quot;
comma
id|fb-&gt;iospace
comma
id|phys
comma
macro_line|#endif
(paren
(paren
id|sbus_readl
c_func
(paren
op_amp
id|fb-&gt;s.cg6.thc-&gt;thc_misc
)paren
op_rshift
id|CG6_THC_MISC_REV_SHIFT
)paren
op_amp
id|CG6_THC_MISC_REV_MASK
)paren
comma
id|p
comma
(paren
id|conf
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
comma
id|cardtype
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|fb-&gt;info.modename
comma
l_string|&quot;CGsix [%s]&quot;
comma
id|cardtype
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;CGsix [%s]&quot;
comma
id|cardtype
)paren
suffix:semicolon
id|cg6_reset
c_func
(paren
id|fb
)paren
suffix:semicolon
r_return
id|idstring
suffix:semicolon
)brace
eof
