multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&t;audio.c  --  USB Audio Class driver&n; *&n; *&t;Copyright (C) 1999, 2000&n; *&t;    Alan Cox (alan@lxorguk.ukuu.org.uk)&n; *&t;    Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&n; * 1999-09-07:  Alan Cox&n; *&t;&t;Parsing Audio descriptor patch&n; * 1999-09-08:  Thomas Sailer&n; *&t;&t;Added OSS compatible data io functions; both parts of the&n; *&t;&t;driver remain to be glued together&n; * 1999-09-10:  Thomas Sailer&n; *&t;&t;Beautified the driver. Added sample format conversions.&n; *&t;&t;Still not properly glued with the parsing code.&n; *&t;&t;The parsing code seems to have its problems btw,&n; *&t;&t;Since it parses all available configs but doesn&squot;t&n; *&t;&t;store which iface/altsetting belongs to which config.&n; * 1999-09-20:  Thomas Sailer&n; *&t;&t;Threw out Alan&squot;s parsing code and implemented my own one.&n; *&t;&t;You cannot reasonnably linearly parse audio descriptors,&n; *&t;&t;especially the AudioClass descriptors have to be considered&n; *&t;&t;pointer lists. Mixer parsing untested, due to lack of device.&n; *&t;&t;First stab at synch pipe implementation, the Dallas USB DAC&n; *&t;&t;wants to use an Asynch out pipe. usb_audio_state now basically&n; *&t;&t;only contains lists of mixer and wave devices. We can therefore&n; *&t;&t;now have multiple mixer/wave devices per USB device.&n; * 1999-10-28:  Thomas Sailer&n; *&t;&t;Converted to URB API. Fixed a taskstate/wakeup semantics mistake&n; *&t;&t;that made the driver consume all available CPU cycles.&n; *&t;&t;Now runs stable on UHCI-Acher/Fliegl/Sailer.&n; * 1999-10-31:  Thomas Sailer&n; *&t;&t;Audio can now be unloaded if it is not in use by any mixer&n; *&t;&t;or dsp client (formerly you had to disconnect the audio devices&n; *&t;&t;from the USB port)&n; *&t;&t;Finally, about three months after ordering, my &quot;Maxxtro SPK222&quot;&n; *&t;&t;speakers arrived, isn&squot;t disdata a great mail order company 8-)&n; *&t;&t;Parse class specific endpoint descriptor of the audiostreaming&n; *&t;&t;interfaces and take the endpoint attributes from there.&n; *&t;&t;Unbelievably, the Philips USB DAC has a sampling rate range&n; *&t;&t;of over a decade, yet does not support the sampling rate control!&n; *&t;&t;No wonder it sounds so bad, has very audible sampling rate&n; *&t;&t;conversion distortion. Don&squot;t try to listen to it using&n; *&t;&t;decent headphones!&n; *&t;&t;&quot;Let&squot;s make things better&quot; -&gt; but please Philips start with your&n; *&t;&t;own stuff!!!!&n; * 1999-11-02:  Thomas Sailer&n; *&t;&t;It takes the Philips boxes several seconds to acquire synchronisation&n; *&t;&t;that means they won&squot;t play short sounds. Should probably maintain&n; *&t;&t;the ISO datastream even if there&squot;s nothing to play.&n; *&t;&t;Fix counting the total_bytes counter, RealPlayer G2 depends on it.&n; * 1999-12-20:  Thomas Sailer&n; *&t;&t;Fix bad bug in conversion to per interface probing.&n; *&t;&t;disconnect was called multiple times for the audio device,&n; *&t;&t;leading to a premature freeing of the audio structures&n; * 2000-05-13:  Thomas Sailer&n; *&t;&t;I don&squot;t remember who changed the find_format routine,&n; *              but the change was completely broken for the Dallas&n; *              chip. Anyway taking sampling rate into account in find_format&n; *              is bad and should not be done unless there are devices with&n; *              completely broken audio descriptors. Unless someone shows&n; *              me such a descriptor, I will not allow find_format to&n; *              take the sampling rate into account.&n; *              Also, the former find_format made:&n; *              - mpg123 play mono instead of stereo&n; *              - sox completely fail for wav&squot;s with sample rates &lt; 44.1kHz&n; *                  for the Dallas chip.&n; *              Also fix a rather long standing problem with applications that&n; *              use &quot;small&quot; writes producing no sound at all.&n; * 2000-05-15:  Thomas Sailer&n; *&t;&t;My fears came true, the Philips camera indeed has pretty stupid&n; *              audio descriptors.&n; * 2000-05-17:  Thomas Sailer&n; *&t;&t;Nemsoft spotted my stupid last minute change, thanks&n; * 2000-05-19:  Thomas Sailer&n; *&t;&t;Fixed FEATURE_UNIT thinkos found thanks to the KC Technology&n; *              Xtend device. Basically the driver treated FEATURE_UNIT&squot;s sourced&n; *              by mono terminals as stereo.&n; * 2000-05-20:  Thomas Sailer&n; *&t;&t;SELECTOR support (and thus selecting record channels from the mixer).&n; *              Somewhat peculiar due to OSS interface limitations. Only works&n; *              for channels where a &quot;slider&quot; is already in front of it (i.e.&n; *              a MIXER unit or a FEATURE unit with volume capability).&n; * 2000-11-26:  Thomas Sailer&n; *              Workaround for Dallas DS4201. The DS4201 uses PCM8 as format tag for&n; *              its 8 bit modes, but expects signed data (and should therefore have used PCM).&n; *&n; */
multiline_comment|/*&n; * Strategy:&n; *&n; * Alan Cox and Thomas Sailer are starting to dig at opposite ends and&n; * are hoping to meet in the middle, just like tunnel diggers :)&n; * Alan tackles the descriptor parsing, Thomas the actual data IO and the&n; * OSS compatible interface.&n; *&n; * Data IO implementation issues&n; *&n; * A mmap&squot;able ring buffer per direction is implemented, because&n; * almost every OSS app expects it. It is however impractical to&n; * transmit/receive USB data directly into and out of the ring buffer,&n; * due to alignment and synchronisation issues. Instead, the ring buffer&n; * feeds a constant time delay line that handles the USB issues.&n; *&n; * Now we first try to find an alternate setting that exactly matches&n; * the sample format requested by the user. If we find one, we do not&n; * need to perform any sample rate conversions. If there is no matching&n; * altsetting, we choose the closest one and perform sample format&n; * conversions. We never do sample rate conversion; these are too&n; * expensive to be performed in the kernel.&n; *&n; * Current status:&n; * - Pretty stable on UHCI-Acher/Fliegl/Sailer&n; * - Does not work on OHCI due to lack of OHCI driver supporting URB&squot;s&n; *&n; * Generally: Due to the brokenness of the Audio Class spec&n; * it seems generally impossible to write a generic Audio Class driver,&n; * so a reasonable driver should implement the features that are actually&n; * used.&n; *&n; * Parsing implementation issues&n; *&n; * One cannot reasonably parse the AudioClass descriptors linearly.&n; * Therefore the current implementation features routines to look&n; * for a specific descriptor in the descriptor list.&n; *&n; * How does the parsing work? First, all interfaces are searched&n; * for an AudioControl class interface. If found, the config descriptor&n; * that belongs to the current configuration is fetched from the device.&n; * Then the HEADER descriptor is fetched. It contains a list of&n; * all AudioStreaming and MIDIStreaming devices. This list is then walked,&n; * and all AudioStreaming interfaces are classified into input and output&n; * interfaces (according to the endpoint0 direction in altsetting1) (MIDIStreaming&n; * is currently not supported). The input &amp; output list is then used&n; * to group inputs and outputs together and issued pairwise to the&n; * AudioStreaming class parser. Finally, all OUTPUT_TERMINAL descriptors&n; * are walked and issued to the mixer construction routine.&n; *&n; * The AudioStreaming parser simply enumerates all altsettings belonging&n; * to the specified interface. It looks for AS_GENERAL and FORMAT_TYPE&n; * class specific descriptors to extract the sample format/sample rate&n; * data. Only sample format types PCM and PCM8 are supported right now, and&n; * only FORMAT_TYPE_I is handled. The isochronous data endpoint needs to&n; * be the first endpoint of the interface, and the optional synchronisation&n; * isochronous endpoint the second one.&n; *&n; * Mixer construction works as follows: The various TERMINAL and UNIT&n; * descriptors span a tree from the root (OUTPUT_TERMINAL) through the&n; * intermediate nodes (UNITs) to the leaves (INPUT_TERMINAL). We walk&n; * that tree in a depth first manner. FEATURE_UNITs may contribute volume,&n; * bass and treble sliders to the mixer, MIXER_UNITs volume sliders.&n; * The terminal type encoded in the INPUT_TERMINALs feeds a heuristic&n; * to determine &quot;meaningful&quot; OSS slider numbers, however we will see&n; * how well this works in practice. Other features are not used at the&n; * moment, they seem less often used. Also, it seems difficult at least&n; * to construct recording source switches from SELECTOR_UNITs, but&n; * since there are not many USB ADC&squot;s available, we leave that for later.&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &quot;audio.h&quot;
DECL|macro|AUDIO_DEBUG
mdefine_line|#define AUDIO_DEBUG 1
DECL|macro|SND_DEV_DSP16
mdefine_line|#define SND_DEV_DSP16   5 
DECL|macro|dprintk
mdefine_line|#define dprintk(x)
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * Linked list of all audio devices...&n; */
DECL|variable|audiodevs
r_static
r_struct
id|list_head
id|audiodevs
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|audiodevs
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|open_sem
)paren
suffix:semicolon
multiline_comment|/*&n; * wait queue for processes wanting to open an USB audio device&n; */
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|open_wait
)paren
suffix:semicolon
DECL|macro|MAXFORMATS
mdefine_line|#define MAXFORMATS        MAX_ALT
DECL|macro|DMABUFSHIFT
mdefine_line|#define DMABUFSHIFT       17  /* 128k worth of DMA buffer */
DECL|macro|NRSGBUF
mdefine_line|#define NRSGBUF           (1U&lt;&lt;(DMABUFSHIFT-PAGE_SHIFT))
multiline_comment|/*&n; * This influences:&n; * - Latency&n; * - Interrupt rate&n; * - Synchronisation behaviour&n; * Don&squot;t touch this if you don&squot;t understand all of the above.&n; */
DECL|macro|DESCFRAMES
mdefine_line|#define DESCFRAMES  5
DECL|macro|SYNCFRAMES
mdefine_line|#define SYNCFRAMES  DESCFRAMES
DECL|macro|MIXFLG_STEREOIN
mdefine_line|#define MIXFLG_STEREOIN   1
DECL|macro|MIXFLG_STEREOOUT
mdefine_line|#define MIXFLG_STEREOOUT  2
DECL|struct|mixerchannel
r_struct
id|mixerchannel
(brace
DECL|member|value
id|__u16
id|value
suffix:semicolon
DECL|member|osschannel
id|__u16
id|osschannel
suffix:semicolon
multiline_comment|/* number of the OSS channel */
DECL|member|minval
DECL|member|maxval
id|__s16
id|minval
comma
id|maxval
suffix:semicolon
DECL|member|slctunitid
id|__u16
id|slctunitid
suffix:semicolon
DECL|member|unitid
id|__u8
id|unitid
suffix:semicolon
DECL|member|selector
id|__u8
id|selector
suffix:semicolon
DECL|member|chnum
id|__u8
id|chnum
suffix:semicolon
DECL|member|flags
id|__u8
id|flags
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|audioformat
r_struct
id|audioformat
(brace
DECL|member|format
r_int
r_int
id|format
suffix:semicolon
DECL|member|sratelo
r_int
r_int
id|sratelo
suffix:semicolon
DECL|member|sratehi
r_int
r_int
id|sratehi
suffix:semicolon
DECL|member|altsetting
r_int
r_char
id|altsetting
suffix:semicolon
DECL|member|attributes
r_int
r_char
id|attributes
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|dmabuf
r_struct
id|dmabuf
(brace
multiline_comment|/* buffer data format */
DECL|member|format
r_int
r_int
id|format
suffix:semicolon
DECL|member|srate
r_int
r_int
id|srate
suffix:semicolon
multiline_comment|/* physical buffer */
DECL|member|sgbuf
r_int
r_char
op_star
id|sgbuf
(braket
id|NRSGBUF
)braket
suffix:semicolon
DECL|member|bufsize
r_int
id|bufsize
suffix:semicolon
DECL|member|numfrag
r_int
id|numfrag
suffix:semicolon
DECL|member|fragshift
r_int
id|fragshift
suffix:semicolon
DECL|member|wrptr
DECL|member|rdptr
r_int
id|wrptr
comma
id|rdptr
suffix:semicolon
DECL|member|total_bytes
r_int
id|total_bytes
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|error
r_int
id|error
suffix:semicolon
multiline_comment|/* over/underrun */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
multiline_comment|/* redundant, but makes calculations easier */
DECL|member|fragsize
r_int
id|fragsize
suffix:semicolon
DECL|member|dmasize
r_int
id|dmasize
suffix:semicolon
multiline_comment|/* OSS stuff */
DECL|member|mapped
r_int
id|mapped
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ready
r_int
id|ready
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ossfragshift
r_int
id|ossfragshift
suffix:semicolon
DECL|member|ossmaxfrags
r_int
id|ossmaxfrags
suffix:semicolon
DECL|member|subdivision
r_int
id|subdivision
suffix:semicolon
)brace
suffix:semicolon
r_struct
id|usb_audio_state
suffix:semicolon
DECL|macro|FLG_URB0RUNNING
mdefine_line|#define FLG_URB0RUNNING   1
DECL|macro|FLG_URB1RUNNING
mdefine_line|#define FLG_URB1RUNNING   2
DECL|macro|FLG_SYNC0RUNNING
mdefine_line|#define FLG_SYNC0RUNNING  4
DECL|macro|FLG_SYNC1RUNNING
mdefine_line|#define FLG_SYNC1RUNNING  8
DECL|macro|FLG_RUNNING
mdefine_line|#define FLG_RUNNING      16
DECL|macro|FLG_CONNECTED
mdefine_line|#define FLG_CONNECTED    32
DECL|struct|my_data_urb
r_struct
id|my_data_urb
(brace
DECL|member|urb
id|urb_t
id|urb
suffix:semicolon
DECL|member|isoframe
id|iso_packet_descriptor_t
id|isoframe
(braket
id|DESCFRAMES
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|my_sync_urb
r_struct
id|my_sync_urb
(brace
DECL|member|urb
id|urb_t
id|urb
suffix:semicolon
DECL|member|isoframe
id|iso_packet_descriptor_t
id|isoframe
(braket
id|SYNCFRAMES
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usb_audiodev
r_struct
id|usb_audiodev
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|state
r_struct
id|usb_audio_state
op_star
id|state
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_audio
r_int
id|dev_audio
suffix:semicolon
multiline_comment|/* wave stuff */
DECL|member|open_mode
id|mode_t
id|open_mode
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* DMA buffer access spinlock */
DECL|struct|usbin
r_struct
id|usbin
(brace
DECL|member|interface
r_int
id|interface
suffix:semicolon
multiline_comment|/* Interface number, -1 means not used */
DECL|member|format
r_int
r_int
id|format
suffix:semicolon
multiline_comment|/* USB data format */
DECL|member|datapipe
r_int
r_int
id|datapipe
suffix:semicolon
multiline_comment|/* the data input pipe */
DECL|member|syncpipe
r_int
r_int
id|syncpipe
suffix:semicolon
multiline_comment|/* the synchronisation pipe - 0 for anything but adaptive IN mode */
DECL|member|syncinterval
r_int
r_int
id|syncinterval
suffix:semicolon
multiline_comment|/* P for adaptive IN mode, 0 otherwise */
DECL|member|freqn
r_int
r_int
id|freqn
suffix:semicolon
multiline_comment|/* nominal sampling rate in USB format, i.e. fs/1000 in Q10.14 */
DECL|member|freqmax
r_int
r_int
id|freqmax
suffix:semicolon
multiline_comment|/* maximum sampling rate, used for buffer management */
DECL|member|phase
r_int
r_int
id|phase
suffix:semicolon
multiline_comment|/* phase accumulator */
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* see FLG_ defines */
DECL|member|durb
r_struct
id|my_data_urb
id|durb
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* ISO descriptors for the data endpoint */
DECL|member|surb
r_struct
id|my_sync_urb
id|surb
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* ISO sync pipe descriptor if needed */
DECL|member|dma
r_struct
id|dmabuf
id|dma
suffix:semicolon
DECL|member|usbin
)brace
id|usbin
suffix:semicolon
DECL|struct|usbout
r_struct
id|usbout
(brace
DECL|member|interface
r_int
id|interface
suffix:semicolon
multiline_comment|/* Interface number, -1 means not used */
DECL|member|format
r_int
r_int
id|format
suffix:semicolon
multiline_comment|/* USB data format */
DECL|member|datapipe
r_int
r_int
id|datapipe
suffix:semicolon
multiline_comment|/* the data input pipe */
DECL|member|syncpipe
r_int
r_int
id|syncpipe
suffix:semicolon
multiline_comment|/* the synchronisation pipe - 0 for anything but asynchronous OUT mode */
DECL|member|syncinterval
r_int
r_int
id|syncinterval
suffix:semicolon
multiline_comment|/* P for asynchronous OUT mode, 0 otherwise */
DECL|member|freqn
r_int
r_int
id|freqn
suffix:semicolon
multiline_comment|/* nominal sampling rate in USB format, i.e. fs/1000 in Q10.14 */
DECL|member|freqm
r_int
r_int
id|freqm
suffix:semicolon
multiline_comment|/* momentary sampling rate in USB format, i.e. fs/1000 in Q10.14 */
DECL|member|freqmax
r_int
r_int
id|freqmax
suffix:semicolon
multiline_comment|/* maximum sampling rate, used for buffer management */
DECL|member|phase
r_int
r_int
id|phase
suffix:semicolon
multiline_comment|/* phase accumulator */
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* see FLG_ defines */
DECL|member|durb
r_struct
id|my_data_urb
id|durb
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* ISO descriptors for the data endpoint */
DECL|member|surb
r_struct
id|my_sync_urb
id|surb
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* ISO sync pipe descriptor if needed */
DECL|member|dma
r_struct
id|dmabuf
id|dma
suffix:semicolon
DECL|member|usbout
)brace
id|usbout
suffix:semicolon
DECL|member|numfmtin
DECL|member|numfmtout
r_int
r_int
id|numfmtin
comma
id|numfmtout
suffix:semicolon
DECL|member|fmtin
r_struct
id|audioformat
id|fmtin
(braket
id|MAXFORMATS
)braket
suffix:semicolon
DECL|member|fmtout
r_struct
id|audioformat
id|fmtout
(braket
id|MAXFORMATS
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usb_mixerdev
r_struct
id|usb_mixerdev
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|state
r_struct
id|usb_audio_state
op_star
id|state
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_mixer
r_int
id|dev_mixer
suffix:semicolon
DECL|member|iface
r_int
r_char
id|iface
suffix:semicolon
multiline_comment|/* interface number of the AudioControl interface */
multiline_comment|/* USB format descriptions */
DECL|member|numch
DECL|member|modcnt
r_int
r_int
id|numch
comma
id|modcnt
suffix:semicolon
multiline_comment|/* mixch is last and gets allocated dynamically */
DECL|member|ch
r_struct
id|mixerchannel
id|ch
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usb_audio_state
r_struct
id|usb_audio_state
(brace
DECL|member|audiodev
r_struct
id|list_head
id|audiodev
suffix:semicolon
multiline_comment|/* USB device */
DECL|member|usbdev
r_struct
id|usb_device
op_star
id|usbdev
suffix:semicolon
DECL|member|audiolist
r_struct
id|list_head
id|audiolist
suffix:semicolon
DECL|member|mixerlist
r_struct
id|list_head
id|mixerlist
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
multiline_comment|/* usage counter; NOTE: the usb stack is also considered a user */
)brace
suffix:semicolon
multiline_comment|/* private audio format extensions */
DECL|macro|AFMT_STEREO
mdefine_line|#define AFMT_STEREO        0x80000000
DECL|macro|AFMT_ISSTEREO
mdefine_line|#define AFMT_ISSTEREO(x)   ((x) &amp; AFMT_STEREO)
DECL|macro|AFMT_IS16BIT
mdefine_line|#define AFMT_IS16BIT(x)    ((x) &amp; (AFMT_S16_LE|AFMT_S16_BE|AFMT_U16_LE|AFMT_U16_BE))
DECL|macro|AFMT_ISUNSIGNED
mdefine_line|#define AFMT_ISUNSIGNED(x) ((x) &amp; (AFMT_U8|AFMT_U16_LE|AFMT_U16_BE))
DECL|macro|AFMT_BYTESSHIFT
mdefine_line|#define AFMT_BYTESSHIFT(x) ((AFMT_ISSTEREO(x) ? 1 : 0) + (AFMT_IS16BIT(x) ? 1 : 0))
DECL|macro|AFMT_BYTES
mdefine_line|#define AFMT_BYTES(x)      (1&lt;&lt;AFMT_BYTESSHFIT(x))
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|ld2
r_extern
r_inline
r_int
id|ld2
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|r
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10000
)paren
(brace
id|x
op_rshift_assign
l_int|16
suffix:semicolon
id|r
op_add_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x100
)paren
(brace
id|x
op_rshift_assign
l_int|8
suffix:semicolon
id|r
op_add_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10
)paren
(brace
id|x
op_rshift_assign
l_int|4
suffix:semicolon
id|r
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|4
)paren
(brace
id|x
op_rshift_assign
l_int|2
suffix:semicolon
id|r
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|2
)paren
id|r
op_increment
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * OSS compatible ring buffer management. The ring buffer may be mmap&squot;ed into&n; * an application address space.&n; *&n; * I first used the rvmalloc stuff copied from bttv. Alan Cox did not like it, so&n; * we now use an array of pointers to a single page each. This saves us the&n; * kernel page table manipulations, but we have to do a page table alike mechanism&n; * (though only one indirection) in software.&n; */
DECL|function|dmabuf_release
r_static
r_void
id|dmabuf_release
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_int
r_int
id|nr
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
id|nr
OL
id|NRSGBUF
suffix:semicolon
id|nr
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|db-&gt;sgbuf
(braket
id|nr
)braket
)paren
)paren
r_continue
suffix:semicolon
id|mem_map_unreserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|p
)paren
suffix:semicolon
id|db-&gt;sgbuf
(braket
id|nr
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|db-&gt;mapped
op_assign
id|db-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|dmabuf_init
r_static
r_int
id|dmabuf_init
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_int
r_int
id|nr
comma
id|bytepersec
comma
id|bufs
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
multiline_comment|/* initialize some fields */
id|db-&gt;rdptr
op_assign
id|db-&gt;wrptr
op_assign
id|db-&gt;total_bytes
op_assign
id|db-&gt;count
op_assign
id|db-&gt;error
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* calculate required buffer size */
id|bytepersec
op_assign
id|db-&gt;srate
op_lshift
id|AFMT_BYTESSHIFT
c_func
(paren
id|db-&gt;format
)paren
suffix:semicolon
id|bufs
op_assign
l_int|1U
op_lshift
id|DMABUFSHIFT
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossfragshift
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1000
op_lshift
id|db-&gt;ossfragshift
)paren
OL
id|bytepersec
)paren
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|1000
)paren
suffix:semicolon
r_else
id|db-&gt;fragshift
op_assign
id|db-&gt;ossfragshift
suffix:semicolon
)brace
r_else
(brace
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|100
op_div
(paren
id|db-&gt;subdivision
ques
c_cond
id|db-&gt;subdivision
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;fragshift
OL
l_int|3
)paren
id|db-&gt;fragshift
op_assign
l_int|3
suffix:semicolon
)brace
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
r_while
c_loop
(paren
id|db-&gt;numfrag
template_param
l_int|3
)paren
(brace
id|db-&gt;fragshift
op_decrement
suffix:semicolon
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
)brace
id|db-&gt;fragsize
op_assign
l_int|1
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossmaxfrags
op_ge
l_int|4
op_logical_and
id|db-&gt;ossmaxfrags
OL
id|db-&gt;numfrag
)paren
id|db-&gt;numfrag
op_assign
id|db-&gt;ossmaxfrags
suffix:semicolon
id|db-&gt;dmasize
op_assign
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
id|nr
OL
id|NRSGBUF
suffix:semicolon
id|nr
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;sgbuf
(braket
id|nr
)braket
)paren
(brace
id|p
op_assign
(paren
r_void
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|db-&gt;sgbuf
(braket
id|nr
)braket
op_assign
id|p
suffix:semicolon
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|db-&gt;sgbuf
(braket
id|nr
)braket
comma
id|AFMT_ISUNSIGNED
c_func
(paren
id|db-&gt;format
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nr
op_lshift
id|PAGE_SHIFT
)paren
op_ge
id|db-&gt;dmasize
)paren
r_break
suffix:semicolon
)brace
id|db-&gt;bufsize
op_assign
id|nr
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|db-&gt;ready
op_assign
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;dmabuf_init: bytepersec %d bufs %d ossfragshift %d ossmaxfrags %d &quot;
l_string|&quot;fragshift %d fragsize %d numfrag %d dmasize %d bufsize %d fmt 0x%x&bslash;n&quot;
comma
id|bytepersec
comma
id|bufs
comma
id|db-&gt;ossfragshift
comma
id|db-&gt;ossmaxfrags
comma
id|db-&gt;fragshift
comma
id|db-&gt;fragsize
comma
id|db-&gt;numfrag
comma
id|db-&gt;dmasize
comma
id|db-&gt;bufsize
comma
id|db-&gt;format
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmabuf_mmap
r_static
r_int
id|dmabuf_mmap
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
comma
id|pgprot_t
id|prot
)paren
(brace
r_int
r_int
id|nr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;ready
op_logical_or
id|db-&gt;mapped
op_logical_or
(paren
id|start
op_or
id|size
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_logical_or
id|size
OG
id|db-&gt;bufsize
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|size
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
id|nr
OL
id|size
suffix:semicolon
id|nr
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;sgbuf
(braket
id|nr
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|db-&gt;mapped
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
id|nr
OL
id|size
suffix:semicolon
id|nr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|start
comma
id|virt_to_phys
c_func
(paren
id|db-&gt;sgbuf
(braket
id|nr
)braket
)paren
comma
id|PAGE_SIZE
comma
id|prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmabuf_copyin
r_static
r_void
id|dmabuf_copyin
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
comma
r_const
r_void
op_star
id|buffer
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|pgrem
comma
id|rem
suffix:semicolon
id|db-&gt;total_bytes
op_add_assign
id|size
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|pgrem
op_assign
(paren
(paren
op_complement
id|db-&gt;wrptr
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|size
)paren
id|pgrem
op_assign
id|size
suffix:semicolon
id|rem
op_assign
id|db-&gt;dmasize
op_minus
id|db-&gt;wrptr
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|rem
)paren
id|pgrem
op_assign
id|rem
suffix:semicolon
id|memcpy
c_func
(paren
(paren
id|db-&gt;sgbuf
(braket
id|db-&gt;wrptr
op_rshift
id|PAGE_SHIFT
)braket
)paren
op_plus
(paren
id|db-&gt;wrptr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
comma
id|buffer
comma
id|pgrem
)paren
suffix:semicolon
id|size
op_sub_assign
id|pgrem
suffix:semicolon
(paren
r_char
op_star
)paren
id|buffer
op_add_assign
id|pgrem
suffix:semicolon
id|db-&gt;wrptr
op_add_assign
id|pgrem
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;wrptr
op_ge
id|db-&gt;dmasize
)paren
id|db-&gt;wrptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|dmabuf_copyout
r_static
r_void
id|dmabuf_copyout
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
comma
r_void
op_star
id|buffer
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|pgrem
comma
id|rem
suffix:semicolon
id|db-&gt;total_bytes
op_add_assign
id|size
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|pgrem
op_assign
(paren
(paren
op_complement
id|db-&gt;rdptr
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|size
)paren
id|pgrem
op_assign
id|size
suffix:semicolon
id|rem
op_assign
id|db-&gt;dmasize
op_minus
id|db-&gt;rdptr
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|rem
)paren
id|pgrem
op_assign
id|rem
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
(paren
id|db-&gt;sgbuf
(braket
id|db-&gt;rdptr
op_rshift
id|PAGE_SHIFT
)braket
)paren
op_plus
(paren
id|db-&gt;rdptr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
comma
id|pgrem
)paren
suffix:semicolon
id|size
op_sub_assign
id|pgrem
suffix:semicolon
(paren
r_char
op_star
)paren
id|buffer
op_add_assign
id|pgrem
suffix:semicolon
id|db-&gt;rdptr
op_add_assign
id|pgrem
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;rdptr
op_ge
id|db-&gt;dmasize
)paren
id|db-&gt;rdptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|dmabuf_copyin_user
r_static
r_int
id|dmabuf_copyin_user
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
comma
r_int
r_int
id|ptr
comma
r_const
r_void
op_star
id|buffer
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|pgrem
comma
id|rem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;ready
op_logical_or
id|db-&gt;mapped
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|pgrem
op_assign
(paren
(paren
op_complement
id|ptr
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|size
)paren
id|pgrem
op_assign
id|size
suffix:semicolon
id|rem
op_assign
id|db-&gt;dmasize
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|rem
)paren
id|pgrem
op_assign
id|rem
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
id|db-&gt;sgbuf
(braket
id|ptr
op_rshift
id|PAGE_SHIFT
)braket
)paren
op_plus
(paren
id|ptr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
comma
id|buffer
comma
id|pgrem
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|size
op_sub_assign
id|pgrem
suffix:semicolon
(paren
r_char
op_star
)paren
id|buffer
op_add_assign
id|pgrem
suffix:semicolon
id|ptr
op_add_assign
id|pgrem
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|db-&gt;dmasize
)paren
id|ptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|dmabuf_copyout_user
r_static
r_int
id|dmabuf_copyout_user
c_func
(paren
r_struct
id|dmabuf
op_star
id|db
comma
r_int
r_int
id|ptr
comma
r_void
op_star
id|buffer
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|pgrem
comma
id|rem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;ready
op_logical_or
id|db-&gt;mapped
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|pgrem
op_assign
(paren
(paren
op_complement
id|ptr
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|size
)paren
id|pgrem
op_assign
id|size
suffix:semicolon
id|rem
op_assign
id|db-&gt;dmasize
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|pgrem
OG
id|rem
)paren
id|pgrem
op_assign
id|rem
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
(paren
id|db-&gt;sgbuf
(braket
id|ptr
op_rshift
id|PAGE_SHIFT
)braket
)paren
op_plus
(paren
id|ptr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
comma
id|pgrem
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|size
op_sub_assign
id|pgrem
suffix:semicolon
(paren
r_char
op_star
)paren
id|buffer
op_add_assign
id|pgrem
suffix:semicolon
id|ptr
op_add_assign
id|pgrem
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|db-&gt;dmasize
)paren
id|ptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * USB I/O code. We do sample format conversion if necessary&n; */
DECL|function|usbin_stop
r_static
r_void
id|usbin_stop
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|i
comma
id|notkilled
op_assign
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
id|i
op_assign
id|u-&gt;flags
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_amp
(paren
id|FLG_URB0RUNNING
op_or
id|FLG_URB1RUNNING
op_or
id|FLG_SYNC0RUNNING
op_or
id|FLG_SYNC1RUNNING
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|notkilled
ques
c_cond
id|TASK_INTERRUPTIBLE
suffix:colon
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|u-&gt;flags
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notkilled
op_logical_and
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
id|FLG_URB0RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_URB1RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_SYNC0RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_SYNC1RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
)paren
suffix:semicolon
id|notkilled
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|usbin_release
r_static
r_inline
r_void
id|usbin_release
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
DECL|function|usbin_disc
r_static
r_void
id|usbin_disc
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|FLG_RUNNING
op_or
id|FLG_CONNECTED
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
DECL|function|conversion
r_static
r_void
id|conversion
c_func
(paren
r_const
r_void
op_star
id|ibuf
comma
r_int
r_int
id|ifmt
comma
r_void
op_star
id|obuf
comma
r_int
r_int
id|ofmt
comma
r_void
op_star
id|tmp
comma
r_int
r_int
id|scnt
)paren
(brace
r_int
r_int
id|cnt
comma
id|i
suffix:semicolon
id|__s16
op_star
id|sp
comma
op_star
id|sp2
comma
id|s
suffix:semicolon
r_int
r_char
op_star
id|bp
suffix:semicolon
id|cnt
op_assign
id|scnt
suffix:semicolon
r_if
c_cond
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|ifmt
)paren
)paren
id|cnt
op_lshift_assign
l_int|1
suffix:semicolon
id|sp
op_assign
(paren
(paren
id|__s16
op_star
)paren
id|tmp
)paren
op_plus
id|cnt
suffix:semicolon
r_switch
c_cond
(paren
id|ifmt
op_amp
op_complement
id|AFMT_STEREO
)paren
(brace
r_case
id|AFMT_U8
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_decrement
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
(paren
op_star
id|bp
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_decrement
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
op_star
id|bp
op_lshift
l_int|8
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
l_int|2
op_star
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_sub_assign
l_int|2
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
(paren
id|bp
(braket
l_int|0
)braket
op_or
(paren
id|bp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
)paren
op_xor
l_int|0x8000
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
l_int|2
op_star
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_sub_assign
l_int|2
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
(paren
id|bp
(braket
l_int|1
)braket
op_or
(paren
id|bp
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
)paren
op_xor
l_int|0x8000
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
l_int|2
op_star
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_sub_assign
l_int|2
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
id|bp
(braket
l_int|0
)braket
op_or
(paren
id|bp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_for
c_loop
(paren
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|ibuf
)paren
op_plus
l_int|2
op_star
id|cnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bp
op_sub_assign
l_int|2
suffix:semicolon
id|sp
op_decrement
suffix:semicolon
op_star
id|sp
op_assign
id|bp
(braket
l_int|1
)braket
op_or
(paren
id|bp
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|AFMT_ISSTEREO
c_func
(paren
id|ifmt
)paren
op_logical_and
id|AFMT_ISSTEREO
c_func
(paren
id|ofmt
)paren
)paren
(brace
multiline_comment|/* expand from mono to stereo */
r_for
c_loop
(paren
id|sp
op_assign
(paren
(paren
id|__s16
op_star
)paren
id|tmp
)paren
op_plus
id|scnt
comma
id|sp2
op_assign
(paren
(paren
id|__s16
op_star
)paren
id|tmp
)paren
op_plus
l_int|2
op_star
id|scnt
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sp
op_decrement
suffix:semicolon
id|sp2
op_sub_assign
l_int|2
suffix:semicolon
id|sp2
(braket
l_int|0
)braket
op_assign
id|sp2
(braket
l_int|1
)braket
op_assign
id|sp
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|ifmt
)paren
op_logical_and
op_logical_neg
id|AFMT_ISSTEREO
c_func
(paren
id|ofmt
)paren
)paren
(brace
multiline_comment|/* contract from stereo to mono */
r_for
c_loop
(paren
id|sp
op_assign
id|sp2
op_assign
(paren
(paren
id|__s16
op_star
)paren
id|tmp
)paren
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|sp2
op_add_assign
l_int|2
)paren
id|sp
(braket
l_int|0
)braket
op_assign
(paren
id|sp2
(braket
l_int|0
)braket
op_plus
id|sp2
(braket
l_int|1
)braket
)paren
op_rshift
l_int|1
suffix:semicolon
)brace
id|cnt
op_assign
id|scnt
suffix:semicolon
r_if
c_cond
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|ofmt
)paren
)paren
id|cnt
op_lshift_assign
l_int|1
suffix:semicolon
id|sp
op_assign
(paren
(paren
id|__s16
op_star
)paren
id|tmp
)paren
suffix:semicolon
id|bp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|obuf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofmt
op_amp
op_complement
id|AFMT_STEREO
)paren
(brace
r_case
id|AFMT_U8
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_increment
)paren
op_star
id|bp
op_assign
(paren
op_star
id|sp
op_rshift
l_int|8
)paren
op_xor
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_increment
)paren
op_star
id|bp
op_assign
op_star
id|sp
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_add_assign
l_int|2
)paren
(brace
id|s
op_assign
op_star
id|sp
suffix:semicolon
id|bp
(braket
l_int|0
)braket
op_assign
id|s
suffix:semicolon
id|bp
(braket
l_int|1
)braket
op_assign
(paren
id|s
op_rshift
l_int|8
)paren
op_xor
l_int|0x80
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_add_assign
l_int|2
)paren
(brace
id|s
op_assign
op_star
id|sp
suffix:semicolon
id|bp
(braket
l_int|1
)braket
op_assign
id|s
suffix:semicolon
id|bp
(braket
l_int|0
)braket
op_assign
(paren
id|s
op_rshift
l_int|8
)paren
op_xor
l_int|0x80
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_add_assign
l_int|2
)paren
(brace
id|s
op_assign
op_star
id|sp
suffix:semicolon
id|bp
(braket
l_int|0
)braket
op_assign
id|s
suffix:semicolon
id|bp
(braket
l_int|1
)braket
op_assign
id|s
op_rshift
l_int|8
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
comma
id|sp
op_increment
comma
id|bp
op_add_assign
l_int|2
)paren
(brace
id|s
op_assign
op_star
id|sp
suffix:semicolon
id|bp
(braket
l_int|1
)braket
op_assign
id|s
suffix:semicolon
id|bp
(braket
l_int|0
)braket
op_assign
id|s
op_rshift
l_int|8
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|usbin_convert
r_static
r_void
id|usbin_convert
c_func
(paren
r_struct
id|usbin
op_star
id|u
comma
r_int
r_char
op_star
id|buffer
comma
r_int
r_int
id|samples
)paren
(brace
r_union
(brace
id|__s16
id|s
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_char
id|b
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|tmp
suffix:semicolon
r_int
r_int
id|scnt
comma
id|maxs
comma
id|ufmtsh
comma
id|dfmtsh
suffix:semicolon
id|ufmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
suffix:semicolon
id|dfmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;dma.format
)paren
suffix:semicolon
id|maxs
op_assign
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|u-&gt;dma.format
op_or
id|u-&gt;format
)paren
)paren
ques
c_cond
l_int|32
suffix:colon
l_int|64
suffix:semicolon
r_while
c_loop
(paren
id|samples
OG
l_int|0
)paren
(brace
id|scnt
op_assign
id|samples
suffix:semicolon
r_if
c_cond
(paren
id|scnt
OG
id|maxs
)paren
id|scnt
op_assign
id|maxs
suffix:semicolon
id|conversion
c_func
(paren
id|buffer
comma
id|u-&gt;format
comma
id|tmp.b
comma
id|u-&gt;dma.format
comma
id|tmp.b
comma
id|scnt
)paren
suffix:semicolon
id|dmabuf_copyin
c_func
(paren
op_amp
id|u-&gt;dma
comma
id|tmp.b
comma
id|scnt
op_lshift
id|dfmtsh
)paren
suffix:semicolon
id|buffer
op_add_assign
id|scnt
op_lshift
id|ufmtsh
suffix:semicolon
id|samples
op_sub_assign
id|scnt
suffix:semicolon
)brace
)brace
DECL|function|usbin_prepare_desc
r_static
r_int
id|usbin_prepare_desc
c_func
(paren
r_struct
id|usbin
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
comma
id|maxsize
comma
id|offs
suffix:semicolon
id|maxsize
op_assign
(paren
id|u-&gt;freqmax
op_plus
l_int|0x3fff
)paren
op_rshift
(paren
l_int|14
op_minus
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
)paren
suffix:semicolon
singleline_comment|//printk(KERN_DEBUG &quot;usbin_prepare_desc: maxsize %d freq 0x%x format 0x%x&bslash;n&quot;, maxsize, u-&gt;freqn, u-&gt;format);
r_for
c_loop
(paren
id|i
op_assign
id|offs
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DESCFRAMES
suffix:semicolon
id|i
op_increment
comma
id|offs
op_add_assign
id|maxsize
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
id|maxsize
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offs
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return value: 0 if descriptor should be restarted, -1 otherwise&n; * convert sample format on the fly if necessary&n; */
DECL|function|usbin_retire_desc
r_static
r_int
id|usbin_retire_desc
c_func
(paren
r_struct
id|usbin
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
comma
id|ufmtsh
comma
id|dfmtsh
comma
id|err
op_assign
l_int|0
comma
id|cnt
comma
id|scnt
comma
id|dmafree
suffix:semicolon
r_int
r_char
op_star
id|cp
suffix:semicolon
id|ufmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
suffix:semicolon
id|dfmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;dma.format
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DESCFRAMES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
id|urb-&gt;transfer_buffer
)paren
op_plus
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbin_retire_desc: frame %u status %d&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|scnt
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
op_rshift
id|ufmtsh
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scnt
)paren
r_continue
suffix:semicolon
id|cnt
op_assign
id|scnt
op_lshift
id|dfmtsh
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|u-&gt;dma.mapped
)paren
(brace
id|dmafree
op_assign
id|u-&gt;dma.dmasize
op_minus
id|u-&gt;dma.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|dmafree
)paren
(brace
id|scnt
op_assign
id|dmafree
op_rshift
id|dfmtsh
suffix:semicolon
id|cnt
op_assign
id|scnt
op_lshift
id|dfmtsh
suffix:semicolon
id|err
op_increment
suffix:semicolon
)brace
)brace
id|u-&gt;dma.count
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;format
op_eq
id|u-&gt;dma.format
)paren
(brace
multiline_comment|/* we do not need format conversion */
id|dmabuf_copyin
c_func
(paren
op_amp
id|u-&gt;dma
comma
id|cp
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* we need sampling format conversion */
id|usbin_convert
c_func
(paren
id|u
comma
id|cp
comma
id|scnt
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|err
)paren
id|u-&gt;dma.error
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;dma.count
op_ge
(paren
r_int
)paren
id|u-&gt;dma.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
r_return
id|err
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|usbin_completed
r_static
r_void
id|usbin_completed
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
id|suret
op_assign
id|USB_ST_NOERROR
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbin_completed: status %d errcnt %d flags 0x%x&bslash;n&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;error_count
comma
id|u-&gt;flags
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_URB0RUNNING
suffix:semicolon
r_else
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_URB1RUNNING
suffix:semicolon
r_else
(brace
id|mask
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbin_completed: panic: unknown URB&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbin_retire_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
id|usbin_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
(paren
id|suret
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
op_eq
id|USB_ST_NOERROR
)paren
(brace
id|u-&gt;flags
op_or_assign
id|mask
suffix:semicolon
)brace
r_else
(brace
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|mask
op_or
id|FLG_RUNNING
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbin_completed: descriptor not restarted (usb_submit_urb: %d)&bslash;n&quot;
comma
id|suret
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * we output sync data&n; */
DECL|function|usbin_sync_prepare_desc
r_static
r_int
id|usbin_sync_prepare_desc
c_func
(paren
r_struct
id|usbin
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_char
op_star
id|cp
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
r_int
id|i
comma
id|offs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|offs
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYNCFRAMES
suffix:semicolon
id|i
op_increment
comma
id|offs
op_add_assign
l_int|3
comma
id|cp
op_add_assign
l_int|3
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
l_int|3
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offs
suffix:semicolon
id|cp
(braket
l_int|0
)braket
op_assign
id|u-&gt;freqn
suffix:semicolon
id|cp
(braket
l_int|1
)braket
op_assign
id|u-&gt;freqn
op_rshift
l_int|8
suffix:semicolon
id|cp
(braket
l_int|2
)braket
op_assign
id|u-&gt;freqn
op_rshift
l_int|16
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return value: 0 if descriptor should be restarted, -1 otherwise&n; */
DECL|function|usbin_sync_retire_desc
r_static
r_int
id|usbin_sync_retire_desc
c_func
(paren
r_struct
id|usbin
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYNCFRAMES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|urb-&gt;iso_frame_desc
(braket
l_int|0
)braket
dot
id|status
)paren
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbin_sync_retire_desc: frame %u status %d&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usbin_sync_completed
r_static
r_void
id|usbin_sync_completed
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
id|suret
op_assign
id|USB_ST_NOERROR
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbin_sync_completed: status %d errcnt %d flags 0x%x&bslash;n&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;error_count
comma
id|u-&gt;flags
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_SYNC0RUNNING
suffix:semicolon
r_else
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_SYNC1RUNNING
suffix:semicolon
r_else
(brace
id|mask
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbin_sync_completed: panic: unknown URB&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbin_sync_retire_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
id|usbin_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
(paren
id|suret
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
op_eq
id|USB_ST_NOERROR
)paren
(brace
id|u-&gt;flags
op_or_assign
id|mask
suffix:semicolon
)brace
r_else
(brace
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|mask
op_or
id|FLG_RUNNING
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbin_sync_completed: descriptor not restarted (usb_submit_urb: %d)&bslash;n&quot;
comma
id|suret
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|usbin_start
r_static
r_int
id|usbin_start
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
id|purb_t
id|urb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|maxsze
comma
id|bufsz
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbin_start: device %d ufmt 0x%08x dfmt 0x%08x srate %d&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;format
comma
id|u-&gt;dma.format
comma
id|u-&gt;dma.srate
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* allocate USB storage if not already done */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_CONNECTED
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;freqn
op_assign
(paren
(paren
id|u-&gt;dma.srate
op_lshift
l_int|11
)paren
op_plus
l_int|62
)paren
op_div
l_int|125
suffix:semicolon
multiline_comment|/* this will overflow at approx 2MSPS */
id|u-&gt;freqmax
op_assign
id|u-&gt;freqn
op_plus
(paren
id|u-&gt;freqn
op_rshift
l_int|2
)paren
suffix:semicolon
id|u-&gt;phase
op_assign
l_int|0
suffix:semicolon
id|maxsze
op_assign
(paren
id|u-&gt;freqmax
op_plus
l_int|0x3fff
)paren
op_rshift
(paren
l_int|14
op_minus
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
)paren
suffix:semicolon
id|bufsz
op_assign
id|DESCFRAMES
op_star
id|maxsze
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
id|bufsz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer_length
op_assign
id|bufsz
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
id|bufsz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer_length
op_assign
id|bufsz
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;syncpipe
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|3
op_star
id|SYNCFRAMES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer_length
op_assign
l_int|3
op_star
id|SYNCFRAMES
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|3
op_star
id|SYNCFRAMES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer_length
op_assign
l_int|3
op_star
id|SYNCFRAMES
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_logical_or
op_logical_neg
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_logical_or
(paren
id|u-&gt;syncpipe
op_logical_and
(paren
op_logical_neg
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_logical_or
op_logical_neg
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot start playback device %d&bslash;n&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;dma.count
op_ge
id|u-&gt;dma.dmasize
op_logical_and
op_logical_neg
id|u-&gt;dma.mapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|u-&gt;flags
op_or_assign
id|FLG_RUNNING
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_URB0RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;datapipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|DESCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbin_completed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbin_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_URB0RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_URB1RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;datapipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|DESCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbin_completed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbin_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_URB1RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;syncpipe
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_SYNC0RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;syncpipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|SYNCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbin_sync_completed
suffix:semicolon
multiline_comment|/* stride: u-&gt;syncinterval */
r_if
c_cond
(paren
op_logical_neg
id|usbin_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_SYNC0RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_SYNC1RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;syncpipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|SYNCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbin_sync_completed
suffix:semicolon
multiline_comment|/* stride: u-&gt;syncinterval */
r_if
c_cond
(paren
op_logical_neg
id|usbin_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_SYNC1RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usbout_stop
r_static
r_void
id|usbout_stop
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|i
comma
id|notkilled
op_assign
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
id|i
op_assign
id|u-&gt;flags
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_amp
(paren
id|FLG_URB0RUNNING
op_or
id|FLG_URB1RUNNING
op_or
id|FLG_SYNC0RUNNING
op_or
id|FLG_SYNC1RUNNING
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|notkilled
ques
c_cond
id|TASK_INTERRUPTIBLE
suffix:colon
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|u-&gt;flags
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notkilled
op_logical_and
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
id|FLG_URB0RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_URB1RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_SYNC0RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
id|FLG_SYNC1RUNNING
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
)paren
suffix:semicolon
id|notkilled
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|usbout_release
r_static
r_inline
r_void
id|usbout_release
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
DECL|function|usbout_disc
r_static
r_void
id|usbout_disc
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|FLG_RUNNING
op_or
id|FLG_CONNECTED
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
DECL|function|usbout_convert
r_static
r_void
id|usbout_convert
c_func
(paren
r_struct
id|usbout
op_star
id|u
comma
r_int
r_char
op_star
id|buffer
comma
r_int
r_int
id|samples
)paren
(brace
r_union
(brace
id|__s16
id|s
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_char
id|b
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|tmp
suffix:semicolon
r_int
r_int
id|scnt
comma
id|maxs
comma
id|ufmtsh
comma
id|dfmtsh
suffix:semicolon
id|ufmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
suffix:semicolon
id|dfmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;dma.format
)paren
suffix:semicolon
id|maxs
op_assign
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|u-&gt;dma.format
op_or
id|u-&gt;format
)paren
)paren
ques
c_cond
l_int|32
suffix:colon
l_int|64
suffix:semicolon
r_while
c_loop
(paren
id|samples
OG
l_int|0
)paren
(brace
id|scnt
op_assign
id|samples
suffix:semicolon
r_if
c_cond
(paren
id|scnt
OG
id|maxs
)paren
id|scnt
op_assign
id|maxs
suffix:semicolon
id|dmabuf_copyout
c_func
(paren
op_amp
id|u-&gt;dma
comma
id|tmp.b
comma
id|scnt
op_lshift
id|dfmtsh
)paren
suffix:semicolon
id|conversion
c_func
(paren
id|tmp.b
comma
id|u-&gt;dma.format
comma
id|buffer
comma
id|u-&gt;format
comma
id|tmp.b
comma
id|scnt
)paren
suffix:semicolon
id|buffer
op_add_assign
id|scnt
op_lshift
id|ufmtsh
suffix:semicolon
id|samples
op_sub_assign
id|scnt
suffix:semicolon
)brace
)brace
DECL|function|usbout_prepare_desc
r_static
r_int
id|usbout_prepare_desc
c_func
(paren
r_struct
id|usbout
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
comma
id|ufmtsh
comma
id|dfmtsh
comma
id|err
op_assign
l_int|0
comma
id|cnt
comma
id|scnt
comma
id|offs
suffix:semicolon
r_int
r_char
op_star
id|cp
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
id|ufmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
suffix:semicolon
id|dfmtsh
op_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;dma.format
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|offs
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DESCFRAMES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offs
suffix:semicolon
id|u-&gt;phase
op_assign
(paren
id|u-&gt;phase
op_amp
l_int|0x3fff
)paren
op_plus
id|u-&gt;freqm
suffix:semicolon
id|scnt
op_assign
id|u-&gt;phase
op_rshift
l_int|14
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scnt
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|cnt
op_assign
id|scnt
op_lshift
id|dfmtsh
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|u-&gt;dma.mapped
)paren
(brace
r_if
c_cond
(paren
id|cnt
OG
id|u-&gt;dma.count
)paren
(brace
id|scnt
op_assign
id|u-&gt;dma.count
op_rshift
id|dfmtsh
suffix:semicolon
id|cnt
op_assign
id|scnt
op_lshift
id|dfmtsh
suffix:semicolon
id|err
op_increment
suffix:semicolon
)brace
id|u-&gt;dma.count
op_sub_assign
id|cnt
suffix:semicolon
)brace
r_else
id|u-&gt;dma.count
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;format
op_eq
id|u-&gt;dma.format
)paren
(brace
multiline_comment|/* we do not need format conversion */
id|dmabuf_copyout
c_func
(paren
op_amp
id|u-&gt;dma
comma
id|cp
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* we need sampling format conversion */
id|usbout_convert
c_func
(paren
id|u
comma
id|cp
comma
id|scnt
)paren
suffix:semicolon
)brace
id|cnt
op_assign
id|scnt
op_lshift
id|ufmtsh
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
id|cnt
suffix:semicolon
id|offs
op_add_assign
id|cnt
suffix:semicolon
id|cp
op_add_assign
id|cnt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
id|u-&gt;dma.error
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;dma.mapped
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;dma.count
op_ge
(paren
r_int
)paren
id|u-&gt;dma.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|u-&gt;dma.dmasize
op_ge
id|u-&gt;dma.count
op_plus
(paren
r_int
)paren
id|u-&gt;dma.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
)brace
r_return
id|err
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return value: 0 if descriptor should be restarted, -1 otherwise&n; */
DECL|function|usbout_retire_desc
r_static
r_int
id|usbout_retire_desc
c_func
(paren
r_struct
id|usbout
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DESCFRAMES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbout_retire_desc: frame %u status %d&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usbout_completed
r_static
r_void
id|usbout_completed
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
id|suret
op_assign
id|USB_ST_NOERROR
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbout_completed: status %d errcnt %d flags 0x%x&bslash;n&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;error_count
comma
id|u-&gt;flags
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_URB0RUNNING
suffix:semicolon
r_else
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_URB1RUNNING
suffix:semicolon
r_else
(brace
id|mask
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbout_completed: panic: unknown URB&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbout_retire_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
id|usbout_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
(paren
id|suret
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
op_eq
id|USB_ST_NOERROR
)paren
(brace
id|u-&gt;flags
op_or_assign
id|mask
suffix:semicolon
)brace
r_else
(brace
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|mask
op_or
id|FLG_RUNNING
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbout_completed: descriptor not restarted (usb_submit_urb: %d)&bslash;n&quot;
comma
id|suret
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|usbout_sync_prepare_desc
r_static
r_int
id|usbout_sync_prepare_desc
c_func
(paren
r_struct
id|usbout
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_int
id|i
comma
id|offs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|offs
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYNCFRAMES
suffix:semicolon
id|i
op_increment
comma
id|offs
op_add_assign
l_int|3
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
l_int|3
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offs
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return value: 0 if descriptor should be restarted, -1 otherwise&n; */
DECL|function|usbout_sync_retire_desc
r_static
r_int
id|usbout_sync_retire_desc
c_func
(paren
r_struct
id|usbout
op_star
id|u
comma
id|purb_t
id|urb
)paren
(brace
r_int
r_char
op_star
id|cp
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
r_int
id|f
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYNCFRAMES
suffix:semicolon
id|i
op_increment
comma
id|cp
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbout_sync_retire_desc: frame %u status %d&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
OL
l_int|3
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbout_sync_retire_desc: frame %u length %d&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|f
op_assign
id|cp
(braket
l_int|0
)braket
op_or
(paren
id|cp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|cp
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
id|f
op_minus
id|u-&gt;freqn
)paren
OG
(paren
id|u-&gt;freqn
op_rshift
l_int|3
)paren
op_logical_or
id|f
OG
id|u-&gt;freqmax
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbout_sync_retire_desc: requested frequency %u (nominal %u) out of range!&bslash;n&quot;
comma
id|f
comma
id|u-&gt;freqn
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|u-&gt;freqm
op_assign
id|f
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usbout_sync_completed
r_static
r_void
id|usbout_sync_completed
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
id|suret
op_assign
id|USB_ST_NOERROR
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbout_sync_completed: status %d errcnt %d flags 0x%x&bslash;n&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;error_count
comma
id|u-&gt;flags
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_SYNC0RUNNING
suffix:semicolon
r_else
r_if
c_cond
(paren
id|urb
op_eq
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
)paren
id|mask
op_assign
id|FLG_SYNC1RUNNING
suffix:semicolon
r_else
(brace
id|mask
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbout_sync_completed: panic: unknown URB&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbout_sync_retire_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
id|usbout_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
(paren
id|suret
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
op_eq
id|USB_ST_NOERROR
)paren
(brace
id|u-&gt;flags
op_or_assign
id|mask
suffix:semicolon
)brace
r_else
(brace
id|u-&gt;flags
op_and_assign
op_complement
(paren
id|mask
op_or
id|FLG_RUNNING
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|u-&gt;dma.wait
)paren
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbout_sync_completed: descriptor not restarted (usb_submit_urb: %d)&bslash;n&quot;
comma
id|suret
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|usbout_start
r_static
r_int
id|usbout_start
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
id|purb_t
id|urb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|maxsze
comma
id|bufsz
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbout_start: device %d ufmt 0x%08x dfmt 0x%08x srate %d&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;format
comma
id|u-&gt;dma.format
comma
id|u-&gt;dma.srate
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* allocate USB storage if not already done */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_CONNECTED
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;freqn
op_assign
id|u-&gt;freqm
op_assign
(paren
(paren
id|u-&gt;dma.srate
op_lshift
l_int|11
)paren
op_plus
l_int|62
)paren
op_div
l_int|125
suffix:semicolon
multiline_comment|/* this will overflow at approx 2MSPS */
id|u-&gt;freqmax
op_assign
id|u-&gt;freqn
op_plus
(paren
id|u-&gt;freqn
op_rshift
l_int|2
)paren
suffix:semicolon
id|u-&gt;phase
op_assign
l_int|0
suffix:semicolon
id|maxsze
op_assign
(paren
id|u-&gt;freqmax
op_plus
l_int|0x3fff
)paren
op_rshift
(paren
l_int|14
op_minus
id|AFMT_BYTESSHIFT
c_func
(paren
id|u-&gt;format
)paren
)paren
suffix:semicolon
id|bufsz
op_assign
id|DESCFRAMES
op_star
id|maxsze
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
id|bufsz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer_length
op_assign
id|bufsz
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
id|bufsz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer_length
op_assign
id|bufsz
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;syncpipe
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|3
op_star
id|SYNCFRAMES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer_length
op_assign
l_int|3
op_star
id|SYNCFRAMES
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
id|kfree
c_func
(paren
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|3
op_star
id|SYNCFRAMES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer_length
op_assign
l_int|3
op_star
id|SYNCFRAMES
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_logical_or
op_logical_neg
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
op_logical_or
(paren
id|u-&gt;syncpipe
op_logical_and
(paren
op_logical_neg
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb.transfer_buffer
op_logical_or
op_logical_neg
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb.transfer_buffer
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot start playback device %d&bslash;n&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;dma.count
op_le
l_int|0
op_logical_and
op_logical_neg
id|u-&gt;dma.mapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|u-&gt;flags
op_or_assign
id|FLG_RUNNING
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_URB0RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;durb
(braket
l_int|0
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;datapipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|DESCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbout_completed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbout_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_URB0RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_URB1RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;durb
(braket
l_int|1
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;datapipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|DESCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbout_completed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbout_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_URB1RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;syncpipe
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_SYNC0RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;surb
(braket
l_int|0
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;syncpipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|SYNCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbout_sync_completed
suffix:semicolon
multiline_comment|/* stride: u-&gt;syncinterval */
r_if
c_cond
(paren
op_logical_neg
id|usbout_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_SYNC0RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;flags
op_amp
id|FLG_RUNNING
op_logical_and
op_logical_neg
(paren
id|u-&gt;flags
op_amp
id|FLG_SYNC1RUNNING
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|u-&gt;surb
(braket
l_int|1
)braket
dot
id|urb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|u-&gt;syncpipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|SYNCFRAMES
suffix:semicolon
id|urb-&gt;context
op_assign
id|as
suffix:semicolon
id|urb-&gt;complete
op_assign
id|usbout_sync_completed
suffix:semicolon
multiline_comment|/* stride: u-&gt;syncinterval */
r_if
c_cond
(paren
op_logical_neg
id|usbout_sync_prepare_desc
c_func
(paren
id|u
comma
id|urb
)paren
op_logical_and
op_logical_neg
id|usb_submit_urb
c_func
(paren
id|urb
)paren
)paren
id|u-&gt;flags
op_or_assign
id|FLG_SYNC1RUNNING
suffix:semicolon
r_else
id|u-&gt;flags
op_and_assign
op_complement
id|FLG_RUNNING
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|format_goodness
r_static
r_int
r_int
id|format_goodness
c_func
(paren
r_struct
id|audioformat
op_star
id|afp
comma
r_int
r_int
id|fmt
comma
r_int
r_int
id|srate
)paren
(brace
r_int
r_int
id|g
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|srate
OL
id|afp-&gt;sratelo
)paren
id|g
op_add_assign
id|afp-&gt;sratelo
op_minus
id|srate
suffix:semicolon
r_if
c_cond
(paren
id|srate
OG
id|afp-&gt;sratehi
)paren
id|g
op_add_assign
id|srate
op_minus
id|afp-&gt;sratehi
suffix:semicolon
r_if
c_cond
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|afp-&gt;format
)paren
op_logical_and
op_logical_neg
id|AFMT_ISSTEREO
c_func
(paren
id|fmt
)paren
)paren
id|g
op_add_assign
l_int|0x100000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|AFMT_ISSTEREO
c_func
(paren
id|afp-&gt;format
)paren
op_logical_and
id|AFMT_ISSTEREO
c_func
(paren
id|fmt
)paren
)paren
id|g
op_add_assign
l_int|0x400000
suffix:semicolon
r_if
c_cond
(paren
id|AFMT_IS16BIT
c_func
(paren
id|afp-&gt;format
)paren
op_logical_and
op_logical_neg
id|AFMT_IS16BIT
c_func
(paren
id|fmt
)paren
)paren
id|g
op_add_assign
l_int|0x100000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|AFMT_IS16BIT
c_func
(paren
id|afp-&gt;format
)paren
op_logical_and
id|AFMT_IS16BIT
c_func
(paren
id|fmt
)paren
)paren
id|g
op_add_assign
l_int|0x400000
suffix:semicolon
r_return
id|g
suffix:semicolon
)brace
DECL|function|find_format
r_static
r_int
id|find_format
c_func
(paren
r_struct
id|audioformat
op_star
id|afp
comma
r_int
r_int
id|nr
comma
r_int
r_int
id|fmt
comma
r_int
r_int
id|srate
)paren
(brace
r_int
r_int
id|i
comma
id|g
comma
id|gb
op_assign
op_complement
l_int|0
suffix:semicolon
r_int
id|j
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* default to failure */
multiline_comment|/* find &quot;best&quot; format (according to format_goodness) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr
suffix:semicolon
id|i
op_increment
)paren
(brace
id|g
op_assign
id|format_goodness
c_func
(paren
op_amp
id|afp
(braket
id|i
)braket
comma
id|fmt
comma
id|srate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|g
op_ge
id|gb
)paren
r_continue
suffix:semicolon
id|j
op_assign
id|i
suffix:semicolon
id|gb
op_assign
id|g
suffix:semicolon
)brace
r_return
id|j
suffix:semicolon
)brace
DECL|function|set_format_in
r_static
r_int
id|set_format_in
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
r_struct
id|usb_config_descriptor
op_star
id|config
op_assign
id|dev-&gt;actconfig
suffix:semicolon
r_struct
id|usb_interface_descriptor
op_star
id|alts
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
suffix:semicolon
r_struct
id|usbin
op_star
id|u
op_assign
op_amp
id|as-&gt;usbin
suffix:semicolon
r_struct
id|dmabuf
op_star
id|d
op_assign
op_amp
id|u-&gt;dma
suffix:semicolon
r_struct
id|audioformat
op_star
id|fmt
suffix:semicolon
r_int
r_int
id|ep
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|fmtnr
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;interface
OL
l_int|0
op_logical_or
id|u-&gt;interface
op_ge
id|config-&gt;bNumInterfaces
)paren
r_return
l_int|0
suffix:semicolon
id|iface
op_assign
op_amp
id|config-&gt;interface
(braket
id|u-&gt;interface
)braket
suffix:semicolon
id|fmtnr
op_assign
id|find_format
c_func
(paren
id|as-&gt;fmtin
comma
id|as-&gt;numfmtin
comma
id|d-&gt;format
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fmtnr
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: set_format_in(): failed to find desired format/speed combination.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|fmt
op_assign
id|as-&gt;fmtin
op_plus
id|fmtnr
suffix:semicolon
id|alts
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|fmt-&gt;altsetting
)braket
suffix:semicolon
id|u-&gt;format
op_assign
id|fmt-&gt;format
suffix:semicolon
id|u-&gt;datapipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|dev
comma
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bEndpointAddress
op_amp
l_int|0xf
)paren
suffix:semicolon
id|u-&gt;syncpipe
op_assign
id|u-&gt;syncinterval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
l_int|0x0c
)paren
op_eq
l_int|0x08
)paren
(brace
r_if
c_cond
(paren
id|alts-&gt;bNumEndpoints
OL
l_int|2
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bmAttributes
op_ne
l_int|0x01
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bSynchAddress
op_ne
l_int|0
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bEndpointAddress
op_ne
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bSynchAddress
op_amp
l_int|0x7f
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d interface %d altsetting %d invalid synch pipe&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|u-&gt;syncpipe
op_assign
id|usb_sndisocpipe
c_func
(paren
id|dev
comma
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bEndpointAddress
op_amp
l_int|0xf
)paren
suffix:semicolon
id|u-&gt;syncinterval
op_assign
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bRefresh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;srate
OL
id|fmt-&gt;sratelo
)paren
id|d-&gt;srate
op_assign
id|fmt-&gt;sratelo
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;srate
OG
id|fmt-&gt;sratehi
)paren
id|d-&gt;srate
op_assign
id|fmt-&gt;sratehi
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio: set_format_in: usb_set_interface %u %u&bslash;n&quot;
comma
id|alts-&gt;bInterfaceNumber
comma
id|fmt-&gt;altsetting
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|dev
comma
id|alts-&gt;bInterfaceNumber
comma
id|fmt-&gt;altsetting
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: usb_set_interface failed, device %d interface %d altsetting %d&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt-&gt;sratelo
op_eq
id|fmt-&gt;sratehi
)paren
r_return
l_int|0
suffix:semicolon
id|ep
op_assign
id|usb_pipeendpoint
c_func
(paren
id|u-&gt;datapipe
)paren
op_or
(paren
id|u-&gt;datapipe
op_amp
id|USB_DIR_IN
)paren
suffix:semicolon
multiline_comment|/* if endpoint has pitch control, enable it */
r_if
c_cond
(paren
id|fmt-&gt;attributes
op_amp
l_int|0x02
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_OUT
comma
id|PITCH_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|1
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to set output pitch control device %d interface %u endpoint 0x%x to %u&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* if endpoint has sampling rate control, set it */
r_if
c_cond
(paren
id|fmt-&gt;attributes
op_amp
l_int|0x01
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
id|d-&gt;srate
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|d-&gt;srate
op_rshift
l_int|8
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|d-&gt;srate
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_OUT
comma
id|SAMPLING_FREQ_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|3
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to set input sampling frequency device %d interface %u endpoint 0x%x to %u&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_IN
comma
id|SAMPLING_FREQ_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|3
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to get input sampling frequency device %d interface %u endpoint 0x%x&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: set_format_in: device %d interface %d altsetting %d srate req: %u real %u&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
comma
id|d-&gt;srate
comma
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
)paren
)paren
suffix:semicolon
id|d-&gt;srate
op_assign
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: set_format_in: USB format 0x%x, DMA format 0x%x srate %u&bslash;n&quot;
comma
id|u-&gt;format
comma
id|d-&gt;format
comma
id|d-&gt;srate
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_format_out
r_static
r_int
id|set_format_out
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|as-&gt;state-&gt;usbdev
suffix:semicolon
r_struct
id|usb_config_descriptor
op_star
id|config
op_assign
id|dev-&gt;actconfig
suffix:semicolon
r_struct
id|usb_interface_descriptor
op_star
id|alts
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
suffix:semicolon
r_struct
id|usbout
op_star
id|u
op_assign
op_amp
id|as-&gt;usbout
suffix:semicolon
r_struct
id|dmabuf
op_star
id|d
op_assign
op_amp
id|u-&gt;dma
suffix:semicolon
r_struct
id|audioformat
op_star
id|fmt
suffix:semicolon
r_int
r_int
id|ep
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|fmtnr
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;interface
OL
l_int|0
op_logical_or
id|u-&gt;interface
op_ge
id|config-&gt;bNumInterfaces
)paren
r_return
l_int|0
suffix:semicolon
id|iface
op_assign
op_amp
id|config-&gt;interface
(braket
id|u-&gt;interface
)braket
suffix:semicolon
id|fmtnr
op_assign
id|find_format
c_func
(paren
id|as-&gt;fmtout
comma
id|as-&gt;numfmtout
comma
id|d-&gt;format
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fmtnr
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: set_format_out(): failed to find desired format/speed combination.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|fmt
op_assign
id|as-&gt;fmtout
op_plus
id|fmtnr
suffix:semicolon
id|u-&gt;format
op_assign
id|fmt-&gt;format
suffix:semicolon
id|alts
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|fmt-&gt;altsetting
)braket
suffix:semicolon
id|u-&gt;datapipe
op_assign
id|usb_sndisocpipe
c_func
(paren
id|dev
comma
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bEndpointAddress
op_amp
l_int|0xf
)paren
suffix:semicolon
id|u-&gt;syncpipe
op_assign
id|u-&gt;syncinterval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
l_int|0x0c
)paren
op_eq
l_int|0x04
)paren
(brace
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bNumEndpoints 0x%02x endpoint[1].bmAttributes 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;endpoint[1].bSynchAddress 0x%02x endpoint[1].bEndpointAddress 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;endpoint[0].bSynchAddress 0x%02x&bslash;n&quot;
comma
id|alts-&gt;bNumEndpoints
comma
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bmAttributes
comma
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bSynchAddress
comma
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bEndpointAddress
comma
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bSynchAddress
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|alts-&gt;bNumEndpoints
OL
l_int|2
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bmAttributes
op_ne
l_int|0x01
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bSynchAddress
op_ne
l_int|0
op_logical_or
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bEndpointAddress
op_ne
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bSynchAddress
op_or
l_int|0x80
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d interface %d altsetting %d invalid synch pipe&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|u-&gt;syncpipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|dev
comma
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bEndpointAddress
op_amp
l_int|0xf
)paren
suffix:semicolon
id|u-&gt;syncinterval
op_assign
id|alts-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bRefresh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;srate
OL
id|fmt-&gt;sratelo
)paren
id|d-&gt;srate
op_assign
id|fmt-&gt;sratelo
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;srate
OG
id|fmt-&gt;sratehi
)paren
id|d-&gt;srate
op_assign
id|fmt-&gt;sratehi
suffix:semicolon
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio: set_format_out: usb_set_interface %u %u&bslash;n&quot;
comma
id|alts-&gt;bInterfaceNumber
comma
id|fmt-&gt;altsetting
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|dev
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: usb_set_interface failed, device %d interface %d altsetting %d&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt-&gt;sratelo
op_eq
id|fmt-&gt;sratehi
)paren
r_return
l_int|0
suffix:semicolon
id|ep
op_assign
id|usb_pipeendpoint
c_func
(paren
id|u-&gt;datapipe
)paren
op_or
(paren
id|u-&gt;datapipe
op_amp
id|USB_DIR_IN
)paren
suffix:semicolon
multiline_comment|/* if endpoint has pitch control, enable it */
r_if
c_cond
(paren
id|fmt-&gt;attributes
op_amp
l_int|0x02
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_OUT
comma
id|PITCH_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|1
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to set output pitch control device %d interface %u endpoint 0x%x to %u&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* if endpoint has sampling rate control, set it */
r_if
c_cond
(paren
id|fmt-&gt;attributes
op_amp
l_int|0x01
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
id|d-&gt;srate
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|d-&gt;srate
op_rshift
l_int|8
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|d-&gt;srate
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_OUT
comma
id|SAMPLING_FREQ_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|3
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to set output sampling frequency device %d interface %u endpoint 0x%x to %u&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
comma
id|d-&gt;srate
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_ENDPOINT
op_or
id|USB_DIR_IN
comma
id|SAMPLING_FREQ_CONTROL
op_lshift
l_int|8
comma
id|ep
comma
id|data
comma
l_int|3
comma
id|HZ
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: failure (error %d) to get output sampling frequency device %d interface %u endpoint 0x%x&bslash;n&quot;
comma
id|ret
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|ep
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: set_format_out: device %d interface %d altsetting %d srate req: %u real %u&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|u-&gt;interface
comma
id|fmt-&gt;altsetting
comma
id|d-&gt;srate
comma
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
)paren
)paren
suffix:semicolon
id|d-&gt;srate
op_assign
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: set_format_out: USB format 0x%x, DMA format 0x%x srate %u&bslash;n&quot;
comma
id|u-&gt;format
comma
id|d-&gt;format
comma
id|d-&gt;srate
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_format
r_static
r_int
id|set_format
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|s
comma
r_int
r_int
id|fmode
comma
r_int
r_int
id|fmt
comma
r_int
r_int
id|srate
)paren
(brace
r_int
id|ret1
op_assign
l_int|0
comma
id|ret2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fmode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|fmode
op_amp
id|FMODE_READ
)paren
(brace
id|usbin_stop
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;usbin.dma.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fmt
op_eq
id|AFMT_QUERY
)paren
id|fmt
op_assign
id|s-&gt;usbin.dma.format
suffix:semicolon
r_else
id|s-&gt;usbin.dma.format
op_assign
id|fmt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srate
)paren
id|srate
op_assign
id|s-&gt;usbin.dma.srate
suffix:semicolon
r_else
id|s-&gt;usbin.dma.srate
op_assign
id|srate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmode
op_amp
id|FMODE_WRITE
)paren
(brace
id|usbout_stop
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;usbout.dma.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fmt
op_eq
id|AFMT_QUERY
)paren
id|fmt
op_assign
id|s-&gt;usbout.dma.format
suffix:semicolon
r_else
id|s-&gt;usbout.dma.format
op_assign
id|fmt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srate
)paren
id|srate
op_assign
id|s-&gt;usbout.dma.srate
suffix:semicolon
r_else
id|s-&gt;usbout.dma.srate
op_assign
id|srate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmode
op_amp
id|FMODE_READ
)paren
id|ret1
op_assign
id|set_format_in
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fmode
op_amp
id|FMODE_WRITE
)paren
id|ret2
op_assign
id|set_format_out
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|ret1
ques
c_cond
id|ret1
suffix:colon
id|ret2
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|wrmixer
r_static
r_int
id|wrmixer
c_func
(paren
r_struct
id|usb_mixerdev
op_star
id|ms
comma
r_int
id|mixch
comma
r_int
id|value
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|ms-&gt;state-&gt;usbdev
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|mixerchannel
op_star
id|ch
suffix:semicolon
r_int
id|v1
comma
id|v2
comma
id|v3
suffix:semicolon
r_if
c_cond
(paren
id|mixch
op_ge
id|ms-&gt;numch
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|ch
op_assign
op_amp
id|ms-&gt;ch
(braket
id|mixch
)braket
suffix:semicolon
id|v3
op_assign
id|ch-&gt;maxval
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v1
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|v2
op_assign
(paren
id|value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|v1
OG
l_int|100
)paren
id|v1
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|v2
OG
l_int|100
)paren
id|v2
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
)paren
id|v2
op_assign
id|v1
suffix:semicolon
id|ch-&gt;value
op_assign
id|v1
op_or
(paren
id|v2
op_lshift
l_int|8
)paren
suffix:semicolon
id|v1
op_assign
(paren
id|v1
op_star
id|v3
)paren
op_div
l_int|100
op_plus
id|ch-&gt;minval
suffix:semicolon
id|v2
op_assign
(paren
id|v2
op_star
id|v3
)paren
op_div
l_int|100
op_plus
id|ch-&gt;minval
suffix:semicolon
r_switch
c_cond
(paren
id|ch-&gt;selector
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* mixer unit request */
id|data
(braket
l_int|0
)braket
op_assign
id|v1
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|v1
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|ch-&gt;chnum
op_lshift
l_int|8
)paren
op_or
l_int|1
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|v2
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|v2
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
(paren
id|ch-&gt;chnum
op_plus
op_logical_neg
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
id|MIXFLG_STEREOIN
)paren
)paren
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_plus
op_logical_neg
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
id|MIXFLG_STEREOOUT
)paren
)paren
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* various feature unit controls */
r_case
id|VOLUME_CONTROL
suffix:colon
id|data
(braket
l_int|0
)braket
op_assign
id|v1
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|v1
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|v2
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|v2
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
(paren
id|ch-&gt;chnum
op_plus
l_int|1
)paren
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|BASS_CONTROL
suffix:colon
r_case
id|MID_CONTROL
suffix:colon
r_case
id|TREBLE_CONTROL
suffix:colon
id|data
(braket
l_int|0
)braket
op_assign
id|v1
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|v2
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
(paren
id|ch-&gt;chnum
op_plus
l_int|1
)paren
comma
id|ms-&gt;iface
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: mixer request device %u if %u unit %u ch %u selector %u failed&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ms-&gt;iface
comma
id|ch-&gt;unitid
comma
id|ch-&gt;chnum
comma
id|ch-&gt;selector
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|get_rec_src
r_static
r_int
id|get_rec_src
c_func
(paren
r_struct
id|usb_mixerdev
op_star
id|ms
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|ms-&gt;state-&gt;usbdev
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
comma
id|retmask
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|buf
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ms-&gt;numch
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_logical_or
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
l_int|0
comma
id|ms-&gt;iface
op_or
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_lshift
l_int|8
)paren
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: selector read request device %u if %u unit %u failed&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ms-&gt;iface
comma
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_amp
l_int|0xff
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
id|i
suffix:semicolon
id|j
OL
id|ms-&gt;numch
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_xor
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
)paren
op_amp
l_int|0xff
)paren
r_continue
suffix:semicolon
id|mask
op_or_assign
l_int|1
op_lshift
id|j
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_eq
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
op_rshift
l_int|8
)paren
)paren
id|retmask
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
id|retmask
suffix:semicolon
)brace
DECL|function|set_rec_src
r_static
r_int
id|set_rec_src
c_func
(paren
r_struct
id|usb_mixerdev
op_star
id|ms
comma
r_int
id|srcmask
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|ms-&gt;state-&gt;usbdev
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
comma
id|smask
comma
id|bmask
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|buf
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ms-&gt;numch
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_logical_or
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
l_int|0
comma
id|ms-&gt;iface
op_or
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_lshift
l_int|8
)paren
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: selector read request device %u if %u unit %u failed&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ms-&gt;iface
comma
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_amp
l_int|0xff
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* first generate smask */
id|smask
op_assign
id|bmask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
suffix:semicolon
id|j
OL
id|ms-&gt;numch
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_xor
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
)paren
op_amp
l_int|0xff
)paren
r_continue
suffix:semicolon
id|smask
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_eq
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
op_rshift
l_int|8
)paren
)paren
id|bmask
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
suffix:semicolon
id|mask
op_or_assign
l_int|1
op_lshift
id|j
suffix:semicolon
)brace
multiline_comment|/* check for multiple set sources */
id|j
op_assign
id|hweight32
c_func
(paren
id|srcmask
op_amp
id|smask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|j
OG
l_int|1
)paren
id|srcmask
op_and_assign
op_complement
id|bmask
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
suffix:semicolon
id|j
OL
id|ms-&gt;numch
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
op_xor
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
)paren
op_amp
l_int|0xff
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|srcmask
op_amp
(paren
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
)paren
)paren
)paren
r_continue
suffix:semicolon
id|buf
op_assign
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
l_int|0
comma
id|ms-&gt;iface
op_or
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
op_lshift
l_int|8
)paren
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: selector write request device %u if %u unit %u failed&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ms-&gt;iface
comma
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|slctunitid
op_amp
l_int|0xff
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
r_return
id|err
ques
c_cond
op_minus
id|EIO
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * should be called with open_sem hold, so that no new processes&n; * look at the audio device to be destroyed&n; */
DECL|function|release
r_static
r_void
id|release
c_func
(paren
r_struct
id|usb_audio_state
op_star
id|s
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
suffix:semicolon
r_struct
id|usb_mixerdev
op_star
id|ms
suffix:semicolon
id|s-&gt;count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;count
)paren
(brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|open_wait
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|s-&gt;audiolist
)paren
)paren
(brace
id|as
op_assign
id|list_entry
c_func
(paren
id|s-&gt;audiolist.next
comma
r_struct
id|usb_audiodev
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|as-&gt;list
)paren
suffix:semicolon
id|usbin_release
c_func
(paren
id|as
)paren
suffix:semicolon
id|usbout_release
c_func
(paren
id|as
)paren
suffix:semicolon
id|dmabuf_release
c_func
(paren
op_amp
id|as-&gt;usbin.dma
)paren
suffix:semicolon
id|dmabuf_release
c_func
(paren
op_amp
id|as-&gt;usbout.dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|s-&gt;mixerlist
)paren
)paren
(brace
id|ms
op_assign
id|list_entry
c_func
(paren
id|s-&gt;mixerlist.next
comma
r_struct
id|usb_mixerdev
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|ms-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ms
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|prog_dmabuf_in
r_extern
r_inline
r_int
id|prog_dmabuf_in
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
r_return
id|dmabuf_init
c_func
(paren
op_amp
id|as-&gt;usbin.dma
)paren
suffix:semicolon
)brace
DECL|function|prog_dmabuf_out
r_extern
r_inline
r_int
id|prog_dmabuf_out
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
)paren
(brace
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
r_return
id|dmabuf_init
c_func
(paren
op_amp
id|as-&gt;usbout.dma
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|usb_audio_llseek
r_static
id|loff_t
id|usb_audio_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|origin
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|usb_audio_open_mixdev
r_static
r_int
id|usb_audio_open_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|devs
comma
op_star
id|mdevs
suffix:semicolon
r_struct
id|usb_mixerdev
op_star
id|ms
suffix:semicolon
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|devs
op_assign
id|audiodevs.next
suffix:semicolon
id|devs
op_ne
op_amp
id|audiodevs
suffix:semicolon
id|devs
op_assign
id|devs-&gt;next
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|devs
comma
r_struct
id|usb_audio_state
comma
id|audiodev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mdevs
op_assign
id|s-&gt;mixerlist.next
suffix:semicolon
id|mdevs
op_ne
op_amp
id|s-&gt;mixerlist
suffix:semicolon
id|mdevs
op_assign
id|mdevs-&gt;next
)paren
(brace
id|ms
op_assign
id|list_entry
c_func
(paren
id|mdevs
comma
r_struct
id|usb_mixerdev
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ms-&gt;dev_mixer
op_eq
id|minor
)paren
r_goto
id|mixer_found
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
id|mixer_found
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;usbdev
)paren
(brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|file-&gt;private_data
op_assign
id|ms
suffix:semicolon
id|s-&gt;count
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_audio_release_mixdev
r_static
r_int
id|usb_audio_release_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|usb_mixerdev
op_star
id|ms
op_assign
(paren
r_struct
id|usb_mixerdev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|s
op_assign
id|ms-&gt;state
suffix:semicolon
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|release
c_func
(paren
id|s
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_audio_ioctl_mixdev
r_static
r_int
id|usb_audio_ioctl_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|usb_mixerdev
op_star
id|ms
op_assign
(paren
r_struct
id|usb_mixerdev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ms-&gt;state-&gt;usbdev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;USB_AUDIO&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;USB Audio Class Driver&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|ms-&gt;modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;USB_AUDIO&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;USB Audio Class Driver&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_IOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_IOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
id|val
op_assign
id|get_rec_src
c_func
(paren
id|ms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|0
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported device */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ms-&gt;numch
suffix:semicolon
id|i
op_increment
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|osschannel
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ms-&gt;numch
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|slctunitid
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|osschannel
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ms-&gt;numch
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|ms-&gt;ch
(braket
id|i
)braket
dot
id|osschannel
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_CAP_EXCL_INPUT
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ms-&gt;numch
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
op_eq
id|i
)paren
(brace
r_return
id|put_user
c_func
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|value
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
op_ne
(paren
id|_IOC_READ
op_or
id|_IOC_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ms-&gt;modcnt
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|set_rec_src
c_func
(paren
id|ms
comma
id|val
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ms-&gt;numch
op_logical_and
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|osschannel
op_ne
id|i
suffix:semicolon
id|j
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
id|ms-&gt;numch
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|wrmixer
c_func
(paren
id|ms
comma
id|j
comma
id|val
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|ms-&gt;ch
(braket
id|j
)braket
dot
id|value
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
DECL|variable|usb_mixer_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|usb_mixer_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|usb_audio_llseek
comma
id|ioctl
suffix:colon
id|usb_audio_ioctl_mixdev
comma
id|open
suffix:colon
id|usb_audio_open_mixdev
comma
id|release
suffix:colon
id|usb_audio_release_mixdev
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|drain_out
r_static
r_int
id|drain_out
c_func
(paren
r_struct
id|usb_audiodev
op_star
id|as
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.mapped
op_logical_or
op_logical_neg
id|as-&gt;usbout.dma.ready
)paren
r_return
l_int|0
suffix:semicolon
id|usbout_start
c_func
(paren
id|as
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|as-&gt;usbout.dma.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
id|count
op_div
id|as-&gt;usbout.dma.srate
suffix:semicolon
id|tmo
op_rshift_assign
id|AFMT_BYTESSHIFT
c_func
(paren
id|as-&gt;usbout.dma.format
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|usb_audio_read
r_static
id|ssize_t
id|usb_audio_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbin.dma.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbin.dma.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbin.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|as-&gt;usbin.dma.rdptr
suffix:semicolon
id|cnt
op_assign
id|as-&gt;usbin.dma.count
suffix:semicolon
multiline_comment|/* set task state early to avoid wakeup races */
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|usbin_start
c_func
(paren
id|as
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dmabuf_copyout_user
c_func
(paren
op_amp
id|as-&gt;usbin.dma
comma
id|ptr
comma
id|buffer
comma
id|cnt
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
id|err
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|as-&gt;usbin.dma.dmasize
)paren
id|ptr
op_sub_assign
id|as-&gt;usbin.dma.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|as-&gt;usbin.dma.rdptr
op_assign
id|ptr
suffix:semicolon
id|as-&gt;usbin.dma.count
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbin.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|usb_audio_write
r_static
id|ssize_t
id|usb_audio_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|ptr
suffix:semicolon
r_int
r_int
id|start_thr
suffix:semicolon
r_int
id|cnt
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbout.dma.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|start_thr
op_assign
(paren
id|as-&gt;usbout.dma.srate
op_lshift
id|AFMT_BYTESSHIFT
c_func
(paren
id|as-&gt;usbout.dma.format
)paren
)paren
op_div
(paren
l_int|1000
op_div
(paren
l_int|3
op_star
id|DESCFRAMES
)paren
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio_write: count %u dma: count %u rdptr %u wrptr %u dmasize %u fragsize %u flags 0x%02x taskst 0x%lx&bslash;n&quot;
comma
id|count
comma
id|as-&gt;usbout.dma.count
comma
id|as-&gt;usbout.dma.rdptr
comma
id|as-&gt;usbout.dma.wrptr
comma
id|as-&gt;usbout.dma.dmasize
comma
id|as-&gt;usbout.dma.fragsize
comma
id|as-&gt;usbout.flags
comma
id|current-&gt;state
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.count
OL
l_int|0
)paren
(brace
id|as-&gt;usbout.dma.count
op_assign
l_int|0
suffix:semicolon
id|as-&gt;usbout.dma.rdptr
op_assign
id|as-&gt;usbout.dma.wrptr
suffix:semicolon
)brace
id|ptr
op_assign
id|as-&gt;usbout.dma.wrptr
suffix:semicolon
id|cnt
op_assign
id|as-&gt;usbout.dma.dmasize
op_minus
id|as-&gt;usbout.dma.count
suffix:semicolon
multiline_comment|/* set task state early to avoid wakeup races */
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|usbout_start
c_func
(paren
id|as
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dmabuf_copyin_user
c_func
(paren
op_amp
id|as-&gt;usbout.dma
comma
id|ptr
comma
id|buffer
comma
id|cnt
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
id|err
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|as-&gt;usbout.dma.dmasize
)paren
id|ptr
op_sub_assign
id|as-&gt;usbout.dma.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|as-&gt;usbout.dma.wrptr
op_assign
id|ptr
suffix:semicolon
id|as-&gt;usbout.dma.count
op_add_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.count
op_ge
id|start_thr
op_logical_and
id|usbout_start
c_func
(paren
id|as
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Called without the kernel lock - fine */
DECL|function|usb_audio_poll
r_static
r_int
r_int
id|usb_audio_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbout.dma.ready
)paren
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|as-&gt;usbout.dma.wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbin.dma.ready
)paren
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|as-&gt;usbin.dma.wait
comma
id|wait
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|as-&gt;usbin.dma.count
op_ge
(paren
r_int
)paren
id|as-&gt;usbin.dma.fragsize
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|as-&gt;usbout.dma.mapped
)paren
(brace
r_if
c_cond
(paren
id|as-&gt;usbout.dma.count
op_ge
(paren
r_int
)paren
id|as-&gt;usbout.dma.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|as-&gt;usbout.dma.dmasize
op_ge
id|as-&gt;usbout.dma.count
op_plus
(paren
r_int
)paren
id|as-&gt;usbout.dma.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|usb_audio_mmap
r_static
r_int
id|usb_audio_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmabuf
op_star
id|db
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|as-&gt;usbout.dma
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|as-&gt;usbin.dma
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
id|dmabuf_mmap
c_func
(paren
id|db
comma
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|usb_audio_ioctl
r_static
r_int
id|usb_audio_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_audio_state
op_star
id|s
op_assign
id|as-&gt;state
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|val
comma
id|val2
comma
id|mapped
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;usbdev
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|mapped
op_assign
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|as-&gt;usbout.dma.mapped
)paren
op_logical_or
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
op_logical_and
id|as-&gt;usbin.dma.mapped
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
r_return
id|drain_out
c_func
(paren
id|as
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
op_or
id|DSP_CAP_BATCH
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
id|as-&gt;usbout.dma.rdptr
op_assign
id|as-&gt;usbout.dma.wrptr
op_assign
id|as-&gt;usbout.dma.count
op_assign
id|as-&gt;usbout.dma.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
id|as-&gt;usbin.dma.rdptr
op_assign
id|as-&gt;usbin.dma.wrptr
op_assign
id|as-&gt;usbin.dma.count
op_assign
id|as-&gt;usbin.dma.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|val
OL
l_int|4000
)paren
id|val
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|100000
)paren
id|val
op_assign
l_int|100000
suffix:semicolon
r_if
c_cond
(paren
id|set_format
c_func
(paren
id|as
comma
id|file-&gt;f_mode
comma
id|AFMT_QUERY
comma
id|val
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.srate
suffix:colon
id|as-&gt;usbout.dma.srate
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_if
c_cond
(paren
id|set_format
c_func
(paren
id|as
comma
id|file-&gt;f_mode
comma
id|val2
op_or
id|AFMT_STEREO
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|1
)paren
id|val2
op_and_assign
op_complement
id|AFMT_STEREO
suffix:semicolon
r_else
id|val2
op_or_assign
id|AFMT_STEREO
suffix:semicolon
r_if
c_cond
(paren
id|set_format
c_func
(paren
id|as
comma
id|file-&gt;f_mode
comma
id|val2
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|val2
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_U8
op_or
id|AFMT_U16_LE
op_or
id|AFMT_U16_BE
op_or
id|AFMT_S8
op_or
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
r_if
c_cond
(paren
id|hweight32
c_func
(paren
id|val
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
(paren
id|AFMT_U8
op_or
id|AFMT_U16_LE
op_or
id|AFMT_U16_BE
op_or
id|AFMT_S8
op_or
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
id|val
op_or_assign
id|val2
op_amp
id|AFMT_STEREO
suffix:semicolon
r_if
c_cond
(paren
id|set_format
c_func
(paren
id|as
comma
id|file-&gt;f_mode
comma
id|val
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val2
op_amp
op_complement
id|AFMT_STEREO
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|as-&gt;usbin.flags
op_amp
id|FLG_RUNNING
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|as-&gt;usbout.flags
op_amp
id|FLG_RUNNING
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbin.dma.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|usbin_start
c_func
(paren
id|as
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|as-&gt;usbout.dma.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|usbout_start
c_func
(paren
id|as
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|as-&gt;usbout.flags
op_amp
id|FLG_RUNNING
)paren
op_logical_and
(paren
id|val
op_assign
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|as-&gt;usbout.dma.fragsize
suffix:semicolon
id|abinfo.bytes
op_assign
id|as-&gt;usbout.dma.dmasize
op_minus
id|as-&gt;usbout.dma.count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|as-&gt;usbout.dma.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|as-&gt;usbout.dma.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|as-&gt;usbin.flags
op_amp
id|FLG_RUNNING
)paren
op_logical_and
(paren
id|val
op_assign
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|as-&gt;usbin.dma.fragsize
suffix:semicolon
id|abinfo.bytes
op_assign
id|as-&gt;usbin.dma.count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|as-&gt;usbin.dma.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|as-&gt;usbin.dma.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|as-&gt;usbout.dma.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|as-&gt;usbin.dma.total_bytes
suffix:semicolon
id|cinfo.blocks
op_assign
id|as-&gt;usbin.dma.count
op_rshift
id|as-&gt;usbin.dma.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|as-&gt;usbin.dma.wrptr
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbin.dma.mapped
)paren
id|as-&gt;usbin.dma.count
op_and_assign
id|as-&gt;usbin.dma.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|as-&gt;usbout.dma.total_bytes
suffix:semicolon
id|cinfo.blocks
op_assign
id|as-&gt;usbout.dma.count
op_rshift
id|as-&gt;usbout.dma.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|as-&gt;usbout.dma.rdptr
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.mapped
)paren
id|as-&gt;usbout.dma.count
op_and_assign
id|as-&gt;usbout.dma.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|as-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_out
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|as-&gt;usbout.dma.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_in
c_func
(paren
id|as
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|as-&gt;usbin.dma.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|as-&gt;usbin.dma.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|as-&gt;usbin.dma.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbin.dma.ossfragshift
OL
l_int|4
)paren
id|as-&gt;usbin.dma.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbin.dma.ossfragshift
OG
l_int|15
)paren
id|as-&gt;usbin.dma.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbin.dma.ossmaxfrags
OL
l_int|4
)paren
id|as-&gt;usbin.dma.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|as-&gt;usbout.dma.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|as-&gt;usbout.dma.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.ossfragshift
OL
l_int|4
)paren
id|as-&gt;usbout.dma.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.ossfragshift
OG
l_int|15
)paren
id|as-&gt;usbout.dma.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;usbout.dma.ossmaxfrags
OL
l_int|4
)paren
id|as-&gt;usbout.dma.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|as-&gt;usbin.dma.subdivision
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|as-&gt;usbout.dma.subdivision
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|as-&gt;usbin.dma.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|as-&gt;usbout.dma.subdivision
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.srate
suffix:colon
id|as-&gt;usbout.dma.srate
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|AFMT_ISSTEREO
c_func
(paren
id|val2
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
id|val2
op_assign
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|as-&gt;usbin.dma.format
suffix:colon
id|as-&gt;usbout.dma.format
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|AFMT_IS16BIT
c_func
(paren
id|val2
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|function|usb_audio_open
r_static
r_int
id|usb_audio_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|devs
comma
op_star
id|adevs
suffix:semicolon
r_struct
id|usb_audiodev
op_star
id|as
suffix:semicolon
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|devs
op_assign
id|audiodevs.next
suffix:semicolon
id|devs
op_ne
op_amp
id|audiodevs
suffix:semicolon
id|devs
op_assign
id|devs-&gt;next
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|devs
comma
r_struct
id|usb_audio_state
comma
id|audiodev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|adevs
op_assign
id|s-&gt;audiolist.next
suffix:semicolon
id|adevs
op_ne
op_amp
id|s-&gt;audiolist
suffix:semicolon
id|adevs
op_assign
id|adevs-&gt;next
)paren
(brace
id|as
op_assign
id|list_entry
c_func
(paren
id|adevs
comma
r_struct
id|usb_audiodev
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|as-&gt;dev_audio
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_goto
id|device_found
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
id|device_found
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;usbdev
)paren
(brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* wait for device to become free */
r_if
c_cond
(paren
op_logical_neg
(paren
id|as-&gt;open_mode
op_amp
id|file-&gt;f_mode
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|as-&gt;usbin.dma.ossfragshift
op_assign
id|as-&gt;usbin.dma.ossmaxfrags
op_assign
id|as-&gt;usbin.dma.subdivision
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|as-&gt;usbout.dma.ossfragshift
op_assign
id|as-&gt;usbout.dma.ossmaxfrags
op_assign
id|as-&gt;usbout.dma.subdivision
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|set_format
c_func
(paren
id|as
comma
id|file-&gt;f_mode
comma
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
multiline_comment|/* AFMT_ULAW */
comma
l_int|8000
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|file-&gt;private_data
op_assign
id|as
suffix:semicolon
id|as-&gt;open_mode
op_or_assign
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|s-&gt;count
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_audio_release
r_static
r_int
id|usb_audio_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|usb_audiodev
op_star
id|as
op_assign
(paren
r_struct
id|usb_audiodev
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
r_struct
id|usb_device
op_star
id|dev
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|s
op_assign
id|as-&gt;state
suffix:semicolon
id|dev
op_assign
id|s-&gt;usbdev
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|drain_out
c_func
(paren
id|as
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|usbout_stop
c_func
(paren
id|as
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|as-&gt;usbout.interface
op_ge
l_int|0
)paren
(brace
id|iface
op_assign
op_amp
id|dev-&gt;actconfig-&gt;interface
(braket
id|as-&gt;usbout.interface
)braket
suffix:semicolon
id|usb_set_interface
c_func
(paren
id|dev
comma
id|iface-&gt;altsetting-&gt;bInterfaceNumber
comma
l_int|0
)paren
suffix:semicolon
)brace
id|dmabuf_release
c_func
(paren
op_amp
id|as-&gt;usbout.dma
)paren
suffix:semicolon
id|usbout_release
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|usbin_stop
c_func
(paren
id|as
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|as-&gt;usbin.interface
op_ge
l_int|0
)paren
(brace
id|iface
op_assign
op_amp
id|dev-&gt;actconfig-&gt;interface
(braket
id|as-&gt;usbin.interface
)braket
suffix:semicolon
id|usb_set_interface
c_func
(paren
id|dev
comma
id|iface-&gt;altsetting-&gt;bInterfaceNumber
comma
l_int|0
)paren
suffix:semicolon
)brace
id|dmabuf_release
c_func
(paren
op_amp
id|as-&gt;usbin.dma
)paren
suffix:semicolon
id|usbin_release
c_func
(paren
id|as
)paren
suffix:semicolon
)brace
id|as-&gt;open_mode
op_and_assign
(paren
op_complement
id|file-&gt;f_mode
)paren
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|release
c_func
(paren
id|s
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|open_wait
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|usb_audio_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|usb_audio_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|usb_audio_llseek
comma
id|read
suffix:colon
id|usb_audio_read
comma
id|write
suffix:colon
id|usb_audio_write
comma
id|poll
suffix:colon
id|usb_audio_poll
comma
id|ioctl
suffix:colon
id|usb_audio_ioctl
comma
id|mmap
suffix:colon
id|usb_audio_mmap
comma
id|open
suffix:colon
id|usb_audio_open
comma
id|release
suffix:colon
id|usb_audio_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
r_static
r_void
op_star
id|usb_audio_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
suffix:semicolon
r_static
r_void
id|usb_audio_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
suffix:semicolon
DECL|variable|usb_audio_ids
r_static
r_struct
id|usb_device_id
id|usb_audio_ids
(braket
)braket
op_assign
(brace
(brace
id|match_flags
suffix:colon
(paren
id|USB_DEVICE_ID_MATCH_INT_CLASS
op_or
id|USB_DEVICE_ID_MATCH_INT_SUBCLASS
)paren
comma
id|bInterfaceClass
suffix:colon
id|USB_CLASS_AUDIO
comma
id|bInterfaceSubClass
suffix:colon
l_int|1
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|usb_audio_ids
)paren
suffix:semicolon
DECL|variable|usb_audio_driver
r_static
r_struct
id|usb_driver
id|usb_audio_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;audio&quot;
comma
id|probe
suffix:colon
id|usb_audio_probe
comma
id|disconnect
suffix:colon
id|usb_audio_disconnect
comma
id|driver_list
suffix:colon
id|LIST_HEAD_INIT
c_func
(paren
id|usb_audio_driver.driver_list
)paren
comma
id|id_table
suffix:colon
id|usb_audio_ids
comma
)brace
suffix:semicolon
DECL|function|find_descriptor
r_static
r_void
op_star
id|find_descriptor
c_func
(paren
r_void
op_star
id|descstart
comma
r_int
r_int
id|desclen
comma
r_void
op_star
id|after
comma
id|u8
id|dtype
comma
r_int
id|iface
comma
r_int
id|altsetting
)paren
(brace
id|u8
op_star
id|p
comma
op_star
id|end
comma
op_star
id|next
suffix:semicolon
r_int
id|ifc
op_assign
op_minus
l_int|1
comma
id|as
op_assign
op_minus
l_int|1
suffix:semicolon
id|p
op_assign
id|descstart
suffix:semicolon
id|end
op_assign
id|p
op_plus
id|desclen
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|p
OL
id|end
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
OL
l_int|2
)paren
r_return
l_int|NULL
suffix:semicolon
id|next
op_assign
id|p
op_plus
id|p
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|next
OG
id|end
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|p
(braket
l_int|1
)braket
op_eq
id|USB_DT_INTERFACE
)paren
(brace
multiline_comment|/* minimum length of interface descriptor */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
OL
l_int|9
)paren
r_return
l_int|NULL
suffix:semicolon
id|ifc
op_assign
id|p
(braket
l_int|2
)braket
suffix:semicolon
id|as
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
(braket
l_int|1
)braket
op_eq
id|dtype
op_logical_and
(paren
op_logical_neg
id|after
op_logical_or
(paren
r_void
op_star
)paren
id|p
OG
id|after
)paren
op_logical_and
(paren
id|iface
op_eq
op_minus
l_int|1
op_logical_or
id|iface
op_eq
id|ifc
)paren
op_logical_and
(paren
id|altsetting
op_eq
op_minus
l_int|1
op_logical_or
id|altsetting
op_eq
id|as
)paren
)paren
(brace
r_return
id|p
suffix:semicolon
)brace
id|p
op_assign
id|next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|find_csinterface_descriptor
r_static
r_void
op_star
id|find_csinterface_descriptor
c_func
(paren
r_void
op_star
id|descstart
comma
r_int
r_int
id|desclen
comma
r_void
op_star
id|after
comma
id|u8
id|dsubtype
comma
r_int
id|iface
comma
r_int
id|altsetting
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|find_descriptor
c_func
(paren
id|descstart
comma
id|desclen
comma
id|after
comma
id|USB_DT_CS_INTERFACE
comma
id|iface
comma
id|altsetting
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_ge
l_int|3
op_logical_and
id|p
(braket
l_int|2
)braket
op_eq
id|dsubtype
)paren
r_return
id|p
suffix:semicolon
id|p
op_assign
id|find_descriptor
c_func
(paren
id|descstart
comma
id|desclen
comma
id|p
comma
id|USB_DT_CS_INTERFACE
comma
id|iface
comma
id|altsetting
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|find_audiocontrol_unit
r_static
r_void
op_star
id|find_audiocontrol_unit
c_func
(paren
r_void
op_star
id|descstart
comma
r_int
r_int
id|desclen
comma
r_void
op_star
id|after
comma
id|u8
id|unit
comma
r_int
id|iface
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|find_descriptor
c_func
(paren
id|descstart
comma
id|desclen
comma
id|after
comma
id|USB_DT_CS_INTERFACE
comma
id|iface
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_ge
l_int|4
op_logical_and
id|p
(braket
l_int|2
)braket
op_ge
id|INPUT_TERMINAL
op_logical_and
id|p
(braket
l_int|2
)braket
op_le
id|EXTENSION_UNIT
op_logical_and
id|p
(braket
l_int|3
)braket
op_eq
id|unit
)paren
r_return
id|p
suffix:semicolon
id|p
op_assign
id|find_descriptor
c_func
(paren
id|descstart
comma
id|desclen
comma
id|p
comma
id|USB_DT_CS_INTERFACE
comma
id|iface
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|usb_audio_parsestreaming
r_static
r_void
id|usb_audio_parsestreaming
c_func
(paren
r_struct
id|usb_audio_state
op_star
id|s
comma
r_int
r_char
op_star
id|buffer
comma
r_int
r_int
id|buflen
comma
r_int
id|asifin
comma
r_int
id|asifout
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|s-&gt;usbdev
suffix:semicolon
r_struct
id|usb_audiodev
op_star
id|as
suffix:semicolon
r_struct
id|usb_config_descriptor
op_star
id|config
op_assign
id|dev-&gt;actconfig
suffix:semicolon
r_struct
id|usb_interface_descriptor
op_star
id|alts
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
suffix:semicolon
r_struct
id|audioformat
op_star
id|fp
suffix:semicolon
r_int
r_char
op_star
id|fmt
comma
op_star
id|csep
suffix:semicolon
r_int
r_int
id|i
comma
id|j
comma
id|k
comma
id|format
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|as
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|usb_audiodev
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|as
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|usb_audiodev
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|as-&gt;usbin.dma.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbin.durb
(braket
l_int|0
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbin.durb
(braket
l_int|1
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbin.surb
(braket
l_int|0
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbin.surb
(braket
l_int|1
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbout.durb
(braket
l_int|0
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbout.durb
(braket
l_int|1
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbout.surb
(braket
l_int|0
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|as-&gt;usbout.surb
(braket
l_int|1
)braket
dot
id|urb.lock
)paren
suffix:semicolon
id|as-&gt;state
op_assign
id|s
suffix:semicolon
id|as-&gt;usbin.interface
op_assign
id|asifin
suffix:semicolon
id|as-&gt;usbout.interface
op_assign
id|asifout
suffix:semicolon
multiline_comment|/* search for input formats */
r_if
c_cond
(paren
id|asifin
op_ge
l_int|0
)paren
(brace
id|as-&gt;usbin.flags
op_assign
id|FLG_CONNECTED
suffix:semicolon
id|iface
op_assign
op_amp
id|config-&gt;interface
(braket
id|asifin
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|iface-&gt;num_altsetting
suffix:semicolon
id|i
op_increment
)paren
(brace
id|alts
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|alts-&gt;bInterfaceClass
op_ne
id|USB_CLASS_AUDIO
op_logical_or
id|alts-&gt;bInterfaceSubClass
op_ne
l_int|2
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|alts-&gt;bNumEndpoints
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u does not have an endpoint&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
l_int|0x03
)paren
op_ne
l_int|0x01
op_logical_or
op_logical_neg
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bEndpointAddress
op_amp
l_int|0x80
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u first endpoint not isochronous in&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fmt
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|AS_GENERAL
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fmt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not found&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|0
)braket
OL
l_int|7
op_logical_or
id|fmt
(braket
l_int|6
)braket
op_ne
l_int|0
op_logical_or
(paren
id|fmt
(braket
l_int|5
)braket
op_ne
l_int|1
op_logical_and
id|fmt
(braket
l_int|5
)braket
op_ne
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u format not supported&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|format
op_assign
(paren
id|fmt
(braket
l_int|5
)braket
op_eq
l_int|2
)paren
ques
c_cond
(paren
id|AFMT_U16_LE
op_or
id|AFMT_U8
)paren
suffix:colon
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S8
)paren
suffix:semicolon
id|fmt
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|FORMAT_TYPE
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fmt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not found&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|0
)braket
OL
l_int|8
op_plus
l_int|3
op_star
(paren
id|fmt
(braket
l_int|7
)braket
ques
c_cond
id|fmt
(braket
l_int|7
)braket
suffix:colon
l_int|2
)paren
op_logical_or
id|fmt
(braket
l_int|3
)braket
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not supported&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|4
)braket
template_param
l_int|2
op_logical_or
id|fmt
(braket
l_int|5
)braket
template_param
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u unsupported channels %u framesize %u&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
comma
id|fmt
(braket
l_int|4
)braket
comma
id|fmt
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|csep
op_assign
id|find_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|USB_DT_CS_ENDPOINT
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csep
op_logical_or
id|csep
(braket
l_int|0
)braket
OL
l_int|7
op_logical_or
id|csep
(braket
l_int|2
)braket
op_ne
id|EP_GENERAL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u no or invalid class specific endpoint descriptor&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|as-&gt;numfmtin
op_ge
id|MAXFORMATS
)paren
r_continue
suffix:semicolon
id|fp
op_assign
op_amp
id|as-&gt;fmtin
(braket
id|as-&gt;numfmtin
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fmt
(braket
l_int|5
)braket
op_eq
l_int|2
)paren
id|format
op_and_assign
(paren
id|AFMT_U16_LE
op_or
id|AFMT_S16_LE
)paren
suffix:semicolon
r_else
id|format
op_and_assign
(paren
id|AFMT_U8
op_or
id|AFMT_S8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fmt
(braket
l_int|4
)braket
op_eq
l_int|2
)paren
id|format
op_or_assign
id|AFMT_STEREO
suffix:semicolon
id|fp-&gt;format
op_assign
id|format
suffix:semicolon
id|fp-&gt;altsetting
op_assign
id|i
suffix:semicolon
id|fp-&gt;sratelo
op_assign
id|fp-&gt;sratehi
op_assign
id|fmt
(braket
l_int|8
)braket
op_or
(paren
id|fmt
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|fmt
(braket
l_int|10
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|fmt
(braket
l_int|7
)braket
ques
c_cond
(paren
id|fmt
(braket
l_int|7
)braket
op_minus
l_int|1
)paren
suffix:colon
l_int|1
suffix:semicolon
id|j
OG
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|k
op_assign
id|fmt
(braket
l_int|8
op_plus
l_int|3
op_star
id|j
)braket
op_or
(paren
id|fmt
(braket
l_int|9
op_plus
l_int|3
op_star
id|j
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|fmt
(braket
l_int|10
op_plus
l_int|3
op_star
id|j
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
OG
id|fp-&gt;sratehi
)paren
id|fp-&gt;sratehi
op_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
id|k
OL
id|fp-&gt;sratelo
)paren
id|fp-&gt;sratelo
op_assign
id|k
suffix:semicolon
)brace
id|fp-&gt;attributes
op_assign
id|csep
(braket
l_int|3
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: device %u interface %u altsetting %u: format 0x%08x sratelo %u sratehi %u attributes 0x%02x&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifin
comma
id|i
comma
id|fp-&gt;format
comma
id|fp-&gt;sratelo
comma
id|fp-&gt;sratehi
comma
id|fp-&gt;attributes
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* search for output formats */
r_if
c_cond
(paren
id|asifout
op_ge
l_int|0
)paren
(brace
id|as-&gt;usbout.flags
op_assign
id|FLG_CONNECTED
suffix:semicolon
id|iface
op_assign
op_amp
id|config-&gt;interface
(braket
id|asifout
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|iface-&gt;num_altsetting
suffix:semicolon
id|i
op_increment
)paren
(brace
id|alts
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|alts-&gt;bInterfaceClass
op_ne
id|USB_CLASS_AUDIO
op_logical_or
id|alts-&gt;bInterfaceSubClass
op_ne
l_int|2
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|alts-&gt;bNumEndpoints
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u does not have an endpoint&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
l_int|0x03
)paren
op_ne
l_int|0x01
op_logical_or
(paren
id|alts-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bEndpointAddress
op_amp
l_int|0x80
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u first endpoint not isochronous out&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fmt
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|AS_GENERAL
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fmt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not found&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|0
)braket
OL
l_int|7
op_logical_or
id|fmt
(braket
l_int|6
)braket
op_ne
l_int|0
op_logical_or
(paren
id|fmt
(braket
l_int|5
)braket
op_ne
l_int|1
op_logical_and
id|fmt
(braket
l_int|5
)braket
op_ne
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u format not supported&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|format
op_assign
(paren
id|fmt
(braket
l_int|5
)braket
op_eq
l_int|2
)paren
ques
c_cond
(paren
id|AFMT_U16_LE
op_or
id|AFMT_U8
)paren
suffix:colon
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S8
)paren
suffix:semicolon
multiline_comment|/* Dallas DS4201 workaround */
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x04fa
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x4201
)paren
id|format
op_assign
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S8
)paren
suffix:semicolon
id|fmt
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|FORMAT_TYPE
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fmt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not found&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|0
)braket
OL
l_int|8
op_plus
l_int|3
op_star
(paren
id|fmt
(braket
l_int|7
)braket
ques
c_cond
id|fmt
(braket
l_int|7
)braket
suffix:colon
l_int|2
)paren
op_logical_or
id|fmt
(braket
l_int|3
)braket
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u FORMAT_TYPE descriptor not supported&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fmt
(braket
l_int|4
)braket
template_param
l_int|2
op_logical_or
id|fmt
(braket
l_int|5
)braket
template_param
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u unsupported channels %u framesize %u&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
comma
id|fmt
(braket
l_int|4
)braket
comma
id|fmt
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|csep
op_assign
id|find_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|USB_DT_CS_ENDPOINT
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csep
op_logical_or
id|csep
(braket
l_int|0
)braket
OL
l_int|7
op_logical_or
id|csep
(braket
l_int|2
)braket
op_ne
id|EP_GENERAL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %u interface %u altsetting %u no or invalid class specific endpoint descriptor&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|as-&gt;numfmtout
op_ge
id|MAXFORMATS
)paren
r_continue
suffix:semicolon
id|fp
op_assign
op_amp
id|as-&gt;fmtout
(braket
id|as-&gt;numfmtout
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fmt
(braket
l_int|5
)braket
op_eq
l_int|2
)paren
id|format
op_and_assign
(paren
id|AFMT_U16_LE
op_or
id|AFMT_S16_LE
)paren
suffix:semicolon
r_else
id|format
op_and_assign
(paren
id|AFMT_U8
op_or
id|AFMT_S8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fmt
(braket
l_int|4
)braket
op_eq
l_int|2
)paren
id|format
op_or_assign
id|AFMT_STEREO
suffix:semicolon
id|fp-&gt;format
op_assign
id|format
suffix:semicolon
id|fp-&gt;altsetting
op_assign
id|i
suffix:semicolon
id|fp-&gt;sratelo
op_assign
id|fp-&gt;sratehi
op_assign
id|fmt
(braket
l_int|8
)braket
op_or
(paren
id|fmt
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|fmt
(braket
l_int|10
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|fmt
(braket
l_int|7
)braket
ques
c_cond
(paren
id|fmt
(braket
l_int|7
)braket
op_minus
l_int|1
)paren
suffix:colon
l_int|1
suffix:semicolon
id|j
OG
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|k
op_assign
id|fmt
(braket
l_int|8
op_plus
l_int|3
op_star
id|j
)braket
op_or
(paren
id|fmt
(braket
l_int|9
op_plus
l_int|3
op_star
id|j
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|fmt
(braket
l_int|10
op_plus
l_int|3
op_star
id|j
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
OG
id|fp-&gt;sratehi
)paren
id|fp-&gt;sratehi
op_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
id|k
OL
id|fp-&gt;sratelo
)paren
id|fp-&gt;sratelo
op_assign
id|k
suffix:semicolon
)brace
id|fp-&gt;attributes
op_assign
id|csep
(braket
l_int|3
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: device %u interface %u altsetting %u: format 0x%08x sratelo %u sratehi %u attributes 0x%02x&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|asifout
comma
id|i
comma
id|fp-&gt;format
comma
id|fp-&gt;sratelo
comma
id|fp-&gt;sratehi
comma
id|fp-&gt;attributes
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|as-&gt;numfmtin
op_eq
l_int|0
op_logical_and
id|as-&gt;numfmtout
op_eq
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|as
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|as-&gt;dev_audio
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|usb_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot register dsp&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|as
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* everything successful */
id|list_add_tail
c_func
(paren
op_amp
id|as-&gt;list
comma
op_amp
id|s-&gt;audiolist
)paren
suffix:semicolon
)brace
DECL|struct|consmixstate
r_struct
id|consmixstate
(brace
DECL|member|s
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
DECL|member|buffer
r_int
r_char
op_star
id|buffer
suffix:semicolon
DECL|member|buflen
r_int
r_int
id|buflen
suffix:semicolon
DECL|member|ctrlif
r_int
r_int
id|ctrlif
suffix:semicolon
DECL|member|mixch
r_struct
id|mixerchannel
id|mixch
(braket
id|SOUND_MIXER_NRDEVICES
)braket
suffix:semicolon
DECL|member|nrmixch
r_int
r_int
id|nrmixch
suffix:semicolon
DECL|member|mixchmask
r_int
r_int
id|mixchmask
suffix:semicolon
DECL|member|unitbitmap
r_int
r_int
id|unitbitmap
(braket
l_int|32
op_div
r_sizeof
(paren
r_int
r_int
)paren
)braket
suffix:semicolon
multiline_comment|/* return values */
DECL|member|nrchannels
r_int
r_int
id|nrchannels
suffix:semicolon
DECL|member|termtype
r_int
r_int
id|termtype
suffix:semicolon
DECL|member|chconfig
r_int
r_int
id|chconfig
suffix:semicolon
)brace
suffix:semicolon
DECL|function|getmixchannel
r_static
r_struct
id|mixerchannel
op_star
id|getmixchannel
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_int
id|nr
)paren
(brace
r_struct
id|mixerchannel
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|nr
op_ge
id|SOUND_MIXER_NRDEVICES
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: invalid OSS mixer channel %u&bslash;n&quot;
comma
id|nr
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|state-&gt;mixchmask
op_amp
(paren
l_int|1
op_lshift
id|nr
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: OSS mixer channel %u already in use&bslash;n&quot;
comma
id|nr
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|c
op_assign
op_amp
id|state-&gt;mixch
(braket
id|state-&gt;nrmixch
op_increment
)braket
suffix:semicolon
id|c-&gt;osschannel
op_assign
id|nr
suffix:semicolon
id|state-&gt;mixchmask
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|nr
)paren
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
DECL|function|getvolchannel
r_static
r_int
r_int
id|getvolchannel
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
)paren
(brace
r_int
r_int
id|u
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state-&gt;termtype
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x0000
op_logical_and
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_VOLUME
)paren
)paren
r_return
id|SOUND_MIXER_VOLUME
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state-&gt;termtype
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x0100
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_PCM
)paren
r_return
id|SOUND_MIXER_PCM
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_ALTPCM
)paren
r_return
id|SOUND_MIXER_ALTPCM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|state-&gt;termtype
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x0200
op_logical_and
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_MIC
)paren
)paren
r_return
id|SOUND_MIXER_MIC
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state-&gt;termtype
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x0300
op_logical_and
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_SPEAKER
)paren
)paren
r_return
id|SOUND_MIXER_SPEAKER
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state-&gt;termtype
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x0500
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_PHONEIN
)paren
r_return
id|SOUND_MIXER_PHONEIN
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_PHONEOUT
)paren
r_return
id|SOUND_MIXER_PHONEOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;termtype
op_ge
l_int|0x710
op_logical_and
id|state-&gt;termtype
op_le
l_int|0x711
op_logical_and
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_RADIO
)paren
)paren
r_return
id|SOUND_MIXER_RADIO
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;termtype
op_ge
l_int|0x709
op_logical_and
id|state-&gt;termtype
op_le
l_int|0x70f
op_logical_and
(paren
id|state-&gt;mixchmask
op_amp
id|SOUND_MASK_VIDEO
)paren
)paren
r_return
id|SOUND_MIXER_VIDEO
suffix:semicolon
id|u
op_assign
id|ffs
c_func
(paren
id|state-&gt;mixchmask
op_amp
(paren
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_LINE1
op_or
id|SOUND_MASK_LINE2
op_or
id|SOUND_MASK_LINE3
op_or
id|SOUND_MASK_DIGITAL1
op_or
id|SOUND_MASK_DIGITAL2
op_or
id|SOUND_MASK_DIGITAL3
)paren
)paren
suffix:semicolon
r_return
id|u
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|prepmixch
r_static
r_void
id|prepmixch
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|state-&gt;s-&gt;usbdev
suffix:semicolon
r_struct
id|mixerchannel
op_star
id|ch
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
id|__s16
id|v1
suffix:semicolon
r_int
r_int
id|v2
comma
id|v3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;nrmixch
op_logical_or
id|state-&gt;nrmixch
OG
id|SOUND_MIXER_NRDEVICES
)paren
r_return
suffix:semicolon
id|ch
op_assign
op_amp
id|state-&gt;mixch
(braket
id|state-&gt;nrmixch
op_minus
l_int|1
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ch-&gt;selector
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* mixer unit request */
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MIN
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;chnum
op_lshift
l_int|8
)paren
op_or
l_int|1
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;minval
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MAX
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;chnum
op_lshift
l_int|8
)paren
op_or
l_int|1
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;maxval
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|v2
op_assign
id|ch-&gt;maxval
op_minus
id|ch-&gt;minval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|v2
)paren
id|v2
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;chnum
op_lshift
l_int|8
)paren
op_or
l_int|1
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
id|ch-&gt;value
op_assign
id|v3
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
(brace
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
(paren
id|ch-&gt;chnum
op_plus
op_logical_neg
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
id|MIXFLG_STEREOIN
)paren
)paren
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_plus
op_logical_neg
op_logical_neg
(paren
id|ch-&gt;flags
op_amp
id|MIXFLG_STEREOOUT
)paren
)paren
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
)brace
id|ch-&gt;value
op_or_assign
id|v3
op_lshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* various feature unit controls */
r_case
id|VOLUME_CONTROL
suffix:colon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MIN
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;minval
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MAX
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;maxval
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|v2
op_assign
id|ch-&gt;maxval
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|v2
)paren
id|v2
op_assign
l_int|1
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
id|ch-&gt;value
op_assign
id|v3
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
(brace
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
(paren
id|ch-&gt;chnum
op_plus
l_int|1
)paren
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|2
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
)brace
id|ch-&gt;value
op_or_assign
id|v3
op_lshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BASS_CONTROL
suffix:colon
r_case
id|MID_CONTROL
suffix:colon
r_case
id|TREBLE_CONTROL
suffix:colon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MIN
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;minval
op_assign
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_MAX
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|ch-&gt;maxval
op_assign
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
id|ch-&gt;chnum
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|8
suffix:semicolon
id|v2
op_assign
id|ch-&gt;maxval
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|v2
)paren
id|v2
op_assign
l_int|1
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
id|ch-&gt;value
op_assign
id|v3
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;flags
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
(brace
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|GET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_IN
comma
(paren
id|ch-&gt;selector
op_lshift
l_int|8
)paren
op_or
(paren
id|ch-&gt;chnum
op_plus
l_int|1
)paren
comma
id|state-&gt;ctrlif
op_or
(paren
id|ch-&gt;unitid
op_lshift
l_int|8
)paren
comma
id|buf
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|v1
op_assign
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|8
suffix:semicolon
id|v3
op_assign
id|v1
op_minus
id|ch-&gt;minval
suffix:semicolon
id|v3
op_assign
l_int|100
op_star
id|v3
op_div
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|v3
OG
l_int|100
)paren
id|v3
op_assign
l_int|100
suffix:semicolon
)brace
id|ch-&gt;value
op_or_assign
id|v3
op_lshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|err
suffix:semicolon
)brace
r_return
suffix:semicolon
id|err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: mixer request device %u if %u unit %u ch %u selector %u failed&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|state-&gt;ctrlif
comma
id|ch-&gt;unitid
comma
id|ch-&gt;chnum
comma
id|ch-&gt;selector
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;nrmixch
)paren
id|state-&gt;nrmixch
op_decrement
suffix:semicolon
)brace
r_static
r_void
id|usb_audio_recurseunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
id|unitid
)paren
suffix:semicolon
DECL|function|checkmixbmap
r_extern
r_inline
r_int
id|checkmixbmap
c_func
(paren
r_int
r_char
op_star
id|bmap
comma
r_int
r_char
id|flg
comma
r_int
r_int
id|inidx
comma
r_int
r_int
id|numoch
)paren
(brace
r_int
r_int
id|idx
suffix:semicolon
id|idx
op_assign
id|inidx
op_star
id|numoch
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bmap
(braket
op_minus
(paren
id|idx
op_rshift
l_int|3
)paren
)braket
op_amp
(paren
l_int|0x80
op_rshift
(paren
id|idx
op_amp
l_int|7
)paren
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flg
op_amp
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|idx
op_assign
(paren
id|inidx
op_plus
op_logical_neg
op_logical_neg
(paren
id|flg
op_amp
id|MIXFLG_STEREOIN
)paren
)paren
op_star
id|numoch
op_plus
op_logical_neg
op_logical_neg
(paren
id|flg
op_amp
id|MIXFLG_STEREOOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bmap
(braket
op_minus
(paren
id|idx
op_rshift
l_int|3
)paren
)braket
op_amp
(paren
l_int|0x80
op_rshift
(paren
id|idx
op_amp
l_int|7
)paren
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|usb_audio_mixerunit
r_static
r_void
id|usb_audio_mixerunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
op_star
id|mixer
)paren
(brace
r_int
r_int
id|nroutch
op_assign
id|mixer
(braket
l_int|5
op_plus
id|mixer
(braket
l_int|4
)braket
)braket
suffix:semicolon
r_int
r_int
id|chidx
(braket
id|SOUND_MIXER_NRDEVICES
op_plus
l_int|1
)braket
suffix:semicolon
r_int
r_int
id|termt
(braket
id|SOUND_MIXER_NRDEVICES
)braket
suffix:semicolon
r_int
r_char
id|flg
op_assign
(paren
id|nroutch
op_ge
l_int|2
)paren
ques
c_cond
id|MIXFLG_STEREOOUT
suffix:colon
l_int|0
suffix:semicolon
r_int
r_char
op_star
id|bmap
op_assign
op_amp
id|mixer
(braket
l_int|9
op_plus
id|mixer
(braket
l_int|4
)braket
)braket
suffix:semicolon
r_int
r_int
id|bmapsize
suffix:semicolon
r_struct
id|mixerchannel
op_star
id|ch
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mixer
(braket
l_int|4
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u invalid MIXER_UNIT descriptor&bslash;n&quot;
comma
id|mixer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mixer
(braket
l_int|4
)braket
OG
id|SOUND_MIXER_NRDEVICES
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: mixer unit %u: too many input pins&bslash;n&quot;
comma
id|mixer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|chidx
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mixer
(braket
l_int|4
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|mixer
(braket
l_int|5
op_plus
id|i
)braket
)paren
suffix:semicolon
id|chidx
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|chidx
(braket
id|i
)braket
op_plus
id|state-&gt;nrchannels
suffix:semicolon
id|termt
(braket
id|i
)braket
op_assign
id|state-&gt;termtype
suffix:semicolon
)brace
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
id|state-&gt;chconfig
op_assign
id|mixer
(braket
l_int|6
op_plus
id|mixer
(braket
l_int|4
)braket
)braket
op_or
(paren
id|mixer
(braket
l_int|7
op_plus
id|mixer
(braket
l_int|4
)braket
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|bmapsize
op_assign
(paren
id|nroutch
op_star
id|chidx
(braket
id|mixer
(braket
l_int|4
)braket
)braket
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
id|bmap
op_add_assign
id|bmapsize
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mixer
(braket
l_int|0
)braket
OL
l_int|10
op_plus
id|mixer
(braket
l_int|4
)braket
op_plus
id|bmapsize
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u invalid MIXER_UNIT descriptor (bitmap too small)&bslash;n&quot;
comma
id|mixer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mixer
(braket
l_int|4
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|state-&gt;termtype
op_assign
id|termt
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|chidx
(braket
id|i
op_plus
l_int|1
)braket
op_minus
id|chidx
(braket
id|i
)braket
op_ge
l_int|2
)paren
(brace
id|flg
op_or_assign
id|MIXFLG_STEREOIN
suffix:semicolon
r_if
c_cond
(paren
id|checkmixbmap
c_func
(paren
id|bmap
comma
id|flg
comma
id|chidx
(braket
id|i
)braket
comma
id|nroutch
)paren
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|getvolchannel
c_func
(paren
id|state
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|mixer
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;chnum
op_assign
id|chidx
(braket
id|i
)braket
op_plus
l_int|1
suffix:semicolon
id|ch-&gt;flags
op_assign
id|flg
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
)brace
id|flg
op_and_assign
op_complement
id|MIXFLG_STEREOIN
suffix:semicolon
r_if
c_cond
(paren
id|checkmixbmap
c_func
(paren
id|bmap
comma
id|flg
comma
id|chidx
(braket
id|i
)braket
comma
id|nroutch
)paren
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|getvolchannel
c_func
(paren
id|state
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|mixer
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;chnum
op_assign
id|chidx
(braket
id|i
)braket
op_plus
l_int|1
suffix:semicolon
id|ch-&gt;flags
op_assign
id|flg
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
)brace
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|slctsrc_findunit
r_static
r_struct
id|mixerchannel
op_star
id|slctsrc_findunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
id|__u8
id|unitid
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|state-&gt;nrmixch
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|state-&gt;mixch
(braket
id|i
)braket
dot
id|unitid
op_eq
id|unitid
)paren
r_return
op_amp
id|state-&gt;mixch
(braket
id|i
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|usb_audio_selectorunit
r_static
r_void
id|usb_audio_selectorunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
op_star
id|selector
)paren
(brace
r_int
r_int
id|chnum
comma
id|i
comma
id|mixch
suffix:semicolon
r_struct
id|mixerchannel
op_star
id|mch
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|selector
(braket
l_int|4
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u invalid SELECTOR_UNIT descriptor&bslash;n&quot;
comma
id|selector
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mixch
op_assign
id|state-&gt;nrmixch
suffix:semicolon
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|selector
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;nrmixch
op_ne
id|mixch
)paren
(brace
id|mch
op_assign
op_amp
id|state-&gt;mixch
(braket
id|state-&gt;nrmixch
op_minus
l_int|1
)braket
suffix:semicolon
id|mch-&gt;slctunitid
op_assign
id|selector
(braket
l_int|3
)braket
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|mch
op_assign
id|slctsrc_findunit
c_func
(paren
id|state
comma
id|selector
(braket
l_int|5
)braket
)paren
)paren
)paren
(brace
id|mch-&gt;slctunitid
op_assign
id|selector
(braket
l_int|3
)braket
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: selector unit %u: ignoring channel 1&bslash;n&quot;
comma
id|selector
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
id|chnum
op_assign
id|state-&gt;nrchannels
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|selector
(braket
l_int|4
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mixch
op_assign
id|state-&gt;nrmixch
suffix:semicolon
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|selector
(braket
l_int|5
op_plus
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chnum
op_ne
id|state-&gt;nrchannels
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: selector unit %u: input pins with varying channel numbers&bslash;n&quot;
comma
id|selector
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
id|state-&gt;chconfig
op_assign
l_int|0
suffix:semicolon
id|state-&gt;nrchannels
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;nrmixch
op_ne
id|mixch
)paren
(brace
id|mch
op_assign
op_amp
id|state-&gt;mixch
(braket
id|state-&gt;nrmixch
op_minus
l_int|1
)braket
suffix:semicolon
id|mch-&gt;slctunitid
op_assign
id|selector
(braket
l_int|3
)braket
op_or
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|mch
op_assign
id|slctsrc_findunit
c_func
(paren
id|state
comma
id|selector
(braket
l_int|5
op_plus
id|i
)braket
)paren
)paren
)paren
(brace
id|mch-&gt;slctunitid
op_assign
id|selector
(braket
l_int|3
)braket
op_or
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: selector unit %u: ignoring channel %u&bslash;n&quot;
comma
id|selector
(braket
l_int|3
)braket
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
id|state-&gt;chconfig
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* in the future we might try to handle 3D etc. effect units */
DECL|function|usb_audio_processingunit
r_static
r_void
id|usb_audio_processingunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
op_star
id|proc
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|proc
(braket
l_int|6
)braket
suffix:semicolon
id|i
op_increment
)paren
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|proc
(braket
l_int|7
op_plus
id|i
)braket
)paren
suffix:semicolon
id|state-&gt;nrchannels
op_assign
id|proc
(braket
l_int|7
op_plus
id|proc
(braket
l_int|6
)braket
)braket
suffix:semicolon
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
id|state-&gt;chconfig
op_assign
id|proc
(braket
l_int|8
op_plus
id|proc
(braket
l_int|6
)braket
)braket
op_or
(paren
id|proc
(braket
l_int|9
op_plus
id|proc
(braket
l_int|6
)braket
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|usb_audio_featureunit
r_static
r_void
id|usb_audio_featureunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
op_star
id|ftr
)paren
(brace
r_struct
id|mixerchannel
op_star
id|ch
suffix:semicolon
r_int
r_int
id|chftr
comma
id|mchftr
suffix:semicolon
macro_line|#if 0
r_struct
id|usb_device
op_star
id|dev
op_assign
id|state-&gt;s-&gt;usbdev
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#endif
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|ftr
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;nrchannels
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: feature unit %u source has no channels&bslash;n&quot;
comma
id|ftr
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;nrchannels
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: feature unit %u: OSS mixer interface does not support more than 2 channels&bslash;n&quot;
comma
id|ftr
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;nrchannels
op_eq
l_int|1
op_logical_and
id|ftr
(braket
l_int|0
)braket
op_eq
l_int|7
op_plus
id|ftr
(braket
l_int|5
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: workaround for broken Philips Camera Microphone descriptor enabled&bslash;n&quot;
)paren
suffix:semicolon
id|mchftr
op_assign
id|ftr
(braket
l_int|6
)braket
suffix:semicolon
id|chftr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ftr
(braket
l_int|0
)braket
OL
l_int|7
op_plus
id|ftr
(braket
l_int|5
)braket
op_star
(paren
l_int|1
op_plus
id|state-&gt;nrchannels
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid FEATURE_UNIT descriptor&bslash;n&quot;
comma
id|ftr
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mchftr
op_assign
id|ftr
(braket
l_int|6
)braket
suffix:semicolon
id|chftr
op_assign
id|ftr
(braket
l_int|6
op_plus
id|ftr
(braket
l_int|5
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;nrchannels
OG
l_int|1
)paren
id|chftr
op_and_assign
id|ftr
(braket
l_int|6
op_plus
l_int|2
op_star
id|ftr
(braket
l_int|5
)braket
)braket
suffix:semicolon
)brace
multiline_comment|/* volume control */
r_if
c_cond
(paren
id|chftr
op_amp
l_int|2
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|getvolchannel
c_func
(paren
id|state
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|VOLUME_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;flags
op_assign
(paren
id|state-&gt;nrchannels
OG
l_int|1
)paren
ques
c_cond
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
suffix:colon
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|mchftr
op_amp
l_int|2
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|getvolchannel
c_func
(paren
id|state
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|VOLUME_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* bass control */
r_if
c_cond
(paren
id|chftr
op_amp
l_int|4
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|SOUND_MIXER_BASS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|BASS_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;flags
op_assign
(paren
id|state-&gt;nrchannels
OG
l_int|1
)paren
ques
c_cond
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
suffix:colon
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|mchftr
op_amp
l_int|4
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|SOUND_MIXER_BASS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|BASS_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* treble control */
r_if
c_cond
(paren
id|chftr
op_amp
l_int|16
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|SOUND_MIXER_TREBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|TREBLE_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;flags
op_assign
(paren
id|state-&gt;nrchannels
OG
l_int|1
)paren
ques
c_cond
(paren
id|MIXFLG_STEREOIN
op_or
id|MIXFLG_STEREOOUT
)paren
suffix:colon
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|mchftr
op_amp
l_int|16
)paren
(brace
id|ch
op_assign
id|getmixchannel
c_func
(paren
id|state
comma
id|SOUND_MIXER_TREBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|ch-&gt;unitid
op_assign
id|ftr
(braket
l_int|3
)braket
suffix:semicolon
id|ch-&gt;selector
op_assign
id|TREBLE_CONTROL
suffix:semicolon
id|ch-&gt;chnum
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|prepmixch
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
multiline_comment|/* if there are mute controls, unmute them */
multiline_comment|/* does not seem to be necessary, and the Dallas chip does not seem to support the &quot;all&quot; channel (255) */
r_if
c_cond
(paren
(paren
id|chftr
op_amp
l_int|1
)paren
op_logical_or
(paren
id|mchftr
op_amp
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: unmuting feature unit %u interface %u&bslash;n&quot;
comma
id|ftr
(braket
l_int|3
)braket
comma
id|state-&gt;ctrlif
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|SET_CUR
comma
id|USB_RECIP_INTERFACE
op_or
id|USB_TYPE_CLASS
op_or
id|USB_DIR_OUT
comma
(paren
id|MUTE_CONTROL
op_lshift
l_int|8
)paren
op_or
l_int|0xff
comma
id|state-&gt;ctrlif
op_or
(paren
id|ftr
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
comma
id|data
comma
l_int|1
comma
id|HZ
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbaudio: failure to unmute feature unit %u interface %u&bslash;n&quot;
comma
id|ftr
(braket
l_int|3
)braket
comma
id|state-&gt;ctrlif
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|usb_audio_recurseunit
r_static
r_void
id|usb_audio_recurseunit
c_func
(paren
r_struct
id|consmixstate
op_star
id|state
comma
r_int
r_char
id|unitid
)paren
(brace
r_int
r_char
op_star
id|p1
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|unitid
comma
op_amp
id|state-&gt;unitbitmap
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: mixer path revisits unit %d&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p1
op_assign
id|find_audiocontrol_unit
c_func
(paren
id|state-&gt;buffer
comma
id|state-&gt;buflen
comma
l_int|NULL
comma
id|unitid
comma
id|state-&gt;ctrlif
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %d not found!&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|state-&gt;nrchannels
op_assign
l_int|0
suffix:semicolon
id|state-&gt;termtype
op_assign
l_int|0
suffix:semicolon
id|state-&gt;chconfig
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|p1
(braket
l_int|2
)braket
)paren
(brace
r_case
id|INPUT_TERMINAL
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|12
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid INPUT_TERMINAL descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|state-&gt;nrchannels
op_assign
id|p1
(braket
l_int|7
)braket
suffix:semicolon
id|state-&gt;termtype
op_assign
id|p1
(braket
l_int|4
)braket
op_or
(paren
id|p1
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|state-&gt;chconfig
op_assign
id|p1
(braket
l_int|8
)braket
op_or
(paren
id|p1
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|MIXER_UNIT
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|10
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|10
op_plus
id|p1
(braket
l_int|4
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid MIXER_UNIT descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|usb_audio_mixerunit
c_func
(paren
id|state
comma
id|p1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SELECTOR_UNIT
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|6
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|6
op_plus
id|p1
(braket
l_int|4
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid SELECTOR_UNIT descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|usb_audio_selectorunit
c_func
(paren
id|state
comma
id|p1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|FEATURE_UNIT
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|7
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|7
op_plus
id|p1
(braket
l_int|5
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid FEATURE_UNIT descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|usb_audio_featureunit
c_func
(paren
id|state
comma
id|p1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|PROCESSING_UNIT
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_plus
id|p1
(braket
l_int|11
op_plus
id|p1
(braket
l_int|6
)braket
)braket
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_plus
id|p1
(braket
l_int|11
op_plus
id|p1
(braket
l_int|6
)braket
)braket
op_plus
id|p1
(braket
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_plus
id|p1
(braket
l_int|11
op_plus
id|p1
(braket
l_int|6
)braket
)braket
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid PROCESSING_UNIT descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|usb_audio_processingunit
c_func
(paren
id|state
comma
id|p1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|EXTENSION_UNIT
suffix:colon
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_logical_or
id|p1
(braket
l_int|0
)braket
OL
l_int|13
op_plus
id|p1
(braket
l_int|6
)braket
op_plus
id|p1
(braket
l_int|11
op_plus
id|p1
(braket
l_int|6
)braket
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: invalid EXTENSION_UNIT descriptor&bslash;n&quot;
comma
id|unitid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p1
(braket
l_int|6
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|usb_audio_recurseunit
c_func
(paren
id|state
comma
id|p1
(braket
l_int|7
op_plus
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
id|j
op_assign
id|state-&gt;termtype
suffix:semicolon
r_else
r_if
c_cond
(paren
id|j
op_ne
id|state-&gt;termtype
)paren
id|j
op_assign
l_int|0
suffix:semicolon
)brace
id|state-&gt;nrchannels
op_assign
id|p1
(braket
l_int|7
op_plus
id|p1
(braket
l_int|6
)braket
)braket
suffix:semicolon
id|state-&gt;chconfig
op_assign
id|p1
(braket
l_int|8
op_plus
id|p1
(braket
l_int|6
)braket
)braket
op_or
(paren
id|p1
(braket
l_int|9
op_plus
id|p1
(braket
l_int|6
)braket
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|state-&gt;termtype
op_assign
id|j
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: unit %u: unexpected type 0x%02x&bslash;n&quot;
comma
id|unitid
comma
id|p1
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|function|usb_audio_constructmixer
r_static
r_void
id|usb_audio_constructmixer
c_func
(paren
r_struct
id|usb_audio_state
op_star
id|s
comma
r_int
r_char
op_star
id|buffer
comma
r_int
r_int
id|buflen
comma
r_int
r_int
id|ctrlif
comma
r_int
r_char
op_star
id|oterm
)paren
(brace
r_struct
id|usb_mixerdev
op_star
id|ms
suffix:semicolon
r_struct
id|consmixstate
id|state
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|state
comma
l_int|0
comma
r_sizeof
(paren
id|state
)paren
)paren
suffix:semicolon
id|state.s
op_assign
id|s
suffix:semicolon
id|state.nrmixch
op_assign
l_int|0
suffix:semicolon
id|state.mixchmask
op_assign
op_complement
l_int|0
suffix:semicolon
id|state.buffer
op_assign
id|buffer
suffix:semicolon
id|state.buflen
op_assign
id|buflen
suffix:semicolon
id|state.ctrlif
op_assign
id|ctrlif
suffix:semicolon
id|set_bit
c_func
(paren
id|oterm
(braket
l_int|3
)braket
comma
op_amp
id|state.unitbitmap
)paren
suffix:semicolon
multiline_comment|/* mark terminal ID as visited */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: constructing mixer for Terminal %u type 0x%04x&bslash;n&quot;
comma
id|oterm
(braket
l_int|3
)braket
comma
id|oterm
(braket
l_int|4
)braket
op_or
(paren
id|oterm
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|usb_audio_recurseunit
c_func
(paren
op_amp
id|state
comma
id|oterm
(braket
l_int|7
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state.nrmixch
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: no mixer controls found for Terminal %u&bslash;n&quot;
comma
id|oterm
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ms
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|usb_mixerdev
)paren
op_plus
id|state.nrmixch
op_star
r_sizeof
(paren
r_struct
id|mixerchannel
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|ms
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|usb_mixerdev
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ms-&gt;ch
comma
op_amp
id|state.mixch
comma
id|state.nrmixch
op_star
r_sizeof
(paren
r_struct
id|mixerchannel
)paren
)paren
suffix:semicolon
id|ms-&gt;state
op_assign
id|s
suffix:semicolon
id|ms-&gt;iface
op_assign
id|ctrlif
suffix:semicolon
id|ms-&gt;numch
op_assign
id|state.nrmixch
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ms-&gt;dev_mixer
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|usb_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot register mixer&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ms
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|ms-&gt;list
comma
op_amp
id|s-&gt;mixerlist
)paren
suffix:semicolon
)brace
DECL|function|usb_audio_parsecontrol
r_static
r_void
op_star
id|usb_audio_parsecontrol
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_char
op_star
id|buffer
comma
r_int
r_int
id|buflen
comma
r_int
r_int
id|ctrlif
)paren
(brace
r_struct
id|usb_audio_state
op_star
id|s
suffix:semicolon
r_struct
id|usb_config_descriptor
op_star
id|config
op_assign
id|dev-&gt;actconfig
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
suffix:semicolon
r_int
r_char
id|ifin
(braket
id|USB_MAXINTERFACES
)braket
comma
id|ifout
(braket
id|USB_MAXINTERFACES
)braket
suffix:semicolon
r_int
r_char
op_star
id|p1
suffix:semicolon
r_int
r_int
id|i
comma
id|j
comma
id|k
comma
id|numifin
op_assign
l_int|0
comma
id|numifout
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|usb_audio_state
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|usb_audio_state
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;audiolist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;mixerlist
)paren
suffix:semicolon
id|s-&gt;usbdev
op_assign
id|dev
suffix:semicolon
id|s-&gt;count
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* find audiocontrol interface */
r_if
c_cond
(paren
op_logical_neg
(paren
id|p1
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|HEADER
comma
id|ctrlif
comma
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u no HEADER found&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
)paren
suffix:semicolon
r_goto
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
OL
l_int|8
op_plus
id|p1
(braket
l_int|7
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u HEADER error&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
)paren
suffix:semicolon
r_goto
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|p1
(braket
l_int|7
)braket
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: device %d audiocontrol interface %u has no AudioStreaming and MidiStreaming interfaces&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p1
(braket
l_int|7
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
id|p1
(braket
l_int|8
op_plus
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
id|config-&gt;bNumInterfaces
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u interface %u does not exist&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|j
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|iface
op_assign
op_amp
id|config-&gt;interface
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceClass
op_ne
id|USB_CLASS_AUDIO
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u interface %u is not an AudioClass interface&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|j
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceSubClass
op_eq
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: device %d audiocontrol interface %u interface %u MIDIStreaming not supported&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|j
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceSubClass
op_ne
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u interface %u invalid AudioClass subtype&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|j
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;num_altsetting
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u has no working interface.&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;num_altsetting
op_eq
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u has only 1 altsetting.&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bNumEndpoints
OG
l_int|0
)paren
(brace
multiline_comment|/* Check all endpoints; should they all have a bandwidth of 0 ? */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bNumEndpoints
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|endpoint
(braket
id|k
)braket
dot
id|wMaxPacketSize
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u endpoint %d does not have 0 bandwidth at alt[0]&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|k
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|k
OL
id|iface-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bNumEndpoints
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|1
)braket
dot
id|bNumEndpoints
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: device %d audiocontrol interface %u interface %u has no endpoint&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|j
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* note: this requires the data endpoint to be ep0 and the optional sync&n;&t;&t;   ep to be ep1, which seems to be the case */
r_if
c_cond
(paren
id|iface-&gt;altsetting
(braket
l_int|1
)braket
dot
id|endpoint
(braket
l_int|0
)braket
dot
id|bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
(brace
r_if
c_cond
(paren
id|numifin
OL
id|USB_MAXINTERFACES
)paren
(brace
id|ifin
(braket
id|numifin
op_increment
)braket
op_assign
id|j
suffix:semicolon
id|usb_driver_claim_interface
c_func
(paren
op_amp
id|usb_audio_driver
comma
id|iface
comma
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|numifout
OL
id|USB_MAXINTERFACES
)paren
(brace
id|ifout
(braket
id|numifout
op_increment
)braket
op_assign
id|j
suffix:semicolon
id|usb_driver_claim_interface
c_func
(paren
op_amp
id|usb_audio_driver
comma
id|iface
comma
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;usbaudio: device %d audiocontrol interface %u has %u input and %u output AudioStreaming interfaces&bslash;n&quot;
comma
id|dev-&gt;devnum
comma
id|ctrlif
comma
id|numifin
comma
id|numifout
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numifin
op_logical_and
id|i
OL
id|numifout
suffix:semicolon
id|i
op_increment
)paren
id|usb_audio_parsestreaming
c_func
(paren
id|s
comma
id|buffer
comma
id|buflen
comma
id|ifin
(braket
id|i
)braket
comma
id|ifout
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
suffix:semicolon
id|j
OL
id|numifin
suffix:semicolon
id|j
op_increment
)paren
id|usb_audio_parsestreaming
c_func
(paren
id|s
comma
id|buffer
comma
id|buflen
comma
id|ifin
(braket
id|i
)braket
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
suffix:semicolon
id|j
OL
id|numifout
suffix:semicolon
id|j
op_increment
)paren
id|usb_audio_parsestreaming
c_func
(paren
id|s
comma
id|buffer
comma
id|buflen
comma
op_minus
l_int|1
comma
id|ifout
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* now walk through all OUTPUT_TERMINAL descriptors to search for mixers */
id|p1
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
l_int|NULL
comma
id|OUTPUT_TERMINAL
comma
id|ctrlif
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p1
)paren
(brace
r_if
c_cond
(paren
id|p1
(braket
l_int|0
)braket
op_ge
l_int|9
)paren
id|usb_audio_constructmixer
c_func
(paren
id|s
comma
id|buffer
comma
id|buflen
comma
id|ctrlif
comma
id|p1
)paren
suffix:semicolon
id|p1
op_assign
id|find_csinterface_descriptor
c_func
(paren
id|buffer
comma
id|buflen
comma
id|p1
comma
id|OUTPUT_TERMINAL
comma
id|ctrlif
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|ret
suffix:colon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|s-&gt;audiolist
)paren
op_logical_and
id|list_empty
c_func
(paren
op_amp
id|s-&gt;mixerlist
)paren
)paren
(brace
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* everything successful */
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;audiodev
comma
op_amp
id|audiodevs
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio_parsecontrol: usb_audio_state at %p&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
multiline_comment|/* we only care for the currently active configuration */
DECL|function|usb_audio_probe
r_static
r_void
op_star
id|usb_audio_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_config_descriptor
op_star
id|config
op_assign
id|dev-&gt;actconfig
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_int
id|i
comma
id|buflen
suffix:semicolon
r_int
id|ret
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;usbaudio: Probing if %i: IC %x, ISC %x&bslash;n&quot;
comma
id|ifnum
comma
id|config-&gt;interface
(braket
id|ifnum
)braket
dot
id|altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceClass
comma
id|config-&gt;interface
(braket
id|ifnum
)braket
dot
id|altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceSubClass
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * audiocontrol interface found&n;&t; * find which configuration number is active&n;&t; */
id|i
op_assign
id|dev-&gt;actconfig
op_minus
id|config
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_configuration
c_func
(paren
id|dev
comma
id|config-&gt;bConfigurationValue
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: set_configuration failed (ConfigValue 0x%x)&bslash;n&quot;
comma
id|config-&gt;bConfigurationValue
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ret
op_assign
id|usb_get_descriptor
c_func
(paren
id|dev
comma
id|USB_DT_CONFIG
comma
id|i
comma
id|buf
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot get first 8 bytes of config descriptor %d of device %d&bslash;n&quot;
comma
id|i
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf
(braket
l_int|1
)braket
op_ne
id|USB_DT_CONFIG
op_logical_or
id|buf
(braket
l_int|0
)braket
OL
l_int|9
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: invalid config descriptor %d of device %d&bslash;n&quot;
comma
id|i
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|buflen
op_assign
id|buf
(braket
l_int|2
)braket
op_or
(paren
id|buf
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|buffer
op_assign
id|kmalloc
c_func
(paren
id|buflen
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|ret
op_assign
id|usb_get_descriptor
c_func
(paren
id|dev
comma
id|USB_DT_CONFIG
comma
id|i
comma
id|buffer
comma
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbaudio: cannot get config descriptor %d of device %d&bslash;n&quot;
comma
id|i
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|usb_audio_parsecontrol
c_func
(paren
id|dev
comma
id|buffer
comma
id|buflen
comma
id|ifnum
)paren
suffix:semicolon
)brace
multiline_comment|/* a revoke facility would make things simpler */
DECL|function|usb_audio_disconnect
r_static
r_void
id|usb_audio_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|usb_audio_state
op_star
id|s
op_assign
(paren
r_struct
id|usb_audio_state
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|usb_audiodev
op_star
id|as
suffix:semicolon
r_struct
id|usb_mixerdev
op_star
id|ms
suffix:semicolon
multiline_comment|/* we get called with -1 for every audiostreaming interface registered */
r_if
c_cond
(paren
id|s
op_eq
(paren
r_struct
id|usb_audio_state
op_star
)paren
op_minus
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio_disconnect: called with -1&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;usbdev
)paren
(brace
id|dprintk
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;usb_audio_disconnect: already called for %p!&bslash;n&quot;
comma
id|s
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|open_sem
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;audiodev
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;audiodev
)paren
suffix:semicolon
id|s-&gt;usbdev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* deregister all audio and mixer devices, so no new processes can open this device */
r_for
c_loop
(paren
id|list
op_assign
id|s-&gt;audiolist.next
suffix:semicolon
id|list
op_ne
op_amp
id|s-&gt;audiolist
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
id|as
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|usb_audiodev
comma
id|list
)paren
suffix:semicolon
id|usbin_disc
c_func
(paren
id|as
)paren
suffix:semicolon
id|usbout_disc
c_func
(paren
id|as
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|as-&gt;usbin.dma.wait
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|as-&gt;usbout.dma.wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|as-&gt;dev_audio
op_ge
l_int|0
)paren
id|unregister_sound_dsp
c_func
(paren
id|as-&gt;dev_audio
)paren
suffix:semicolon
id|as-&gt;dev_audio
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|list
op_assign
id|s-&gt;mixerlist.next
suffix:semicolon
id|list
op_ne
op_amp
id|s-&gt;mixerlist
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
id|ms
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|usb_mixerdev
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ms-&gt;dev_mixer
op_ge
l_int|0
)paren
id|unregister_sound_mixer
c_func
(paren
id|ms-&gt;dev_mixer
)paren
suffix:semicolon
id|ms-&gt;dev_mixer
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|release
c_func
(paren
id|s
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|open_wait
)paren
suffix:semicolon
)brace
DECL|function|usb_audio_init
r_static
r_int
id|__init
id|usb_audio_init
c_func
(paren
r_void
)paren
(brace
id|usb_register
c_func
(paren
op_amp
id|usb_audio_driver
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_audio_cleanup
r_static
r_void
id|__exit
id|usb_audio_cleanup
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|usb_audio_driver
)paren
suffix:semicolon
)brace
DECL|variable|usb_audio_init
id|module_init
c_func
(paren
id|usb_audio_init
)paren
suffix:semicolon
DECL|variable|usb_audio_cleanup
id|module_exit
c_func
(paren
id|usb_audio_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Alan Cox &lt;alan@lxorguk.ukuu.org.uk&gt;, Thomas Sailer (sailer@ife.ee.ethz.ch)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;USB Audio Class driver&quot;
)paren
suffix:semicolon
eof
