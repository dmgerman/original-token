multiline_comment|/* Driver for Microtek Scanmaker X6 USB scanner, and possibly others.&n; *&n; * (C) Copyright 2000 John Fremlin &lt;vii@penguinpowered.com&gt;&n; * (C) Copyright 2000 Oliver Neukum &lt;Oliver.Neukum@lrz.uni-muenchen.de&gt;&n; *&n; * Parts shamelessly stolen from usb-storage and copyright by their&n; * authors. Thanks to Matt Dharm for giving us permission!&n; *&n; * This driver implements a SCSI host controller driver and a USB&n; * device driver. To avoid confusion, all the USB related stuff is&n; * prefixed by mts_usb_ and all the SCSI stuff by mts_scsi_.&n; * &n; * Microtek (www.microtek.com) did not release the specifications for&n; * their USB protocol to us, so we had to reverse engineer them. We&n; * don&squot;t know for which models they are valid.&n; *&n; * The X6 USB has three bulk endpoints, one output (0x1) down which&n; * commands and outgoing data are sent, and two input: 0x82 from which&n; * normal data is read from the scanner (in packets of maximum 32&n; * bytes) and from which the status byte is read, and 0x83 from which&n; * the results of a scan (or preview) are read in up to 64 * 1024 byte&n; * chunks by the Windows driver. We don&squot;t know how much it is possible&n; * to read at a time from 0x83.&n; *&n; * It seems possible to read (with URB transfers) everything from 0x82&n; * in one go, without bothering to read in 32 byte chunks.&n; *&n; * There seems to be an optimisation of a further READ implicit if&n; * you simply read from 0x83.&n; *&n; * Guessed protocol:&n; *&n; *&t;Send raw SCSI command to EP 0x1&n; *&n; *&t;If there is data to receive:&n; *&t;&t;If the command was READ datatype=image:&n; *&t;&t;&t;Read a lot of data from EP 0x83&n; *&t;&t;Else:&n; *&t;&t;&t;Read data from EP 0x82&n; *&t;Else:&n; *&t;&t;If there is data to transmit:&n; *&t;&t;&t;Write it to EP 0x1&n; *&n; *&t;Read status byte from EP 0x82&n; *&n; * References:&n; *&n; * The SCSI command set for the scanner is available from&n; *&t;ftp://ftp.microtek.com/microtek/devpack/&n; *&n; * Microtek NV sent us a more up to date version of the document. If&n; * you want it, just send mail.&n; *&n; * Status:&n; *&t;&n; *&t;Untested with multiple scanners.&n; *&t;Untested on SMP.&n; *&t;Untested on a bigendian machine.&n; *&n; * History:&n; *&n; *&t;20000417 starting history&n; *&t;20000417 fixed load oops&n; *&t;20000417 fixed unload oops&n; *&t;20000419 fixed READ IMAGE detection&n; *&t;20000424 started conversion to use URBs&n; *&t;20000502 handled short transfers as errors&n; *&t;20000513 rename and organisation of functions (john)&n; *&t;20000513 added IDs for all products supported by Windows driver (john)&n; *&t;20000514 Rewrote mts_scsi_queuecommand to use URBs (john)&n; *&t;20000514 Version 0.0.8j&n; *      20000514 Fix reporting of non-existant devices to SCSI layer (john)&n; *&t;20000514 Added MTS_DEBUG_INT (john)&n; *&t;20000514 Changed &quot;usb-microtek&quot; to &quot;microtek&quot; for consistency (john)&n; *&t;20000514 Stupid bug fixes (john)&n; *&t;20000514 Version 0.0.9j&n; *&t;20000515 Put transfer context and URB in mts_desc (john)&n; *&t;20000515 Added prelim turn off debugging support (john)&n; *&t;20000515 Version 0.0.10j&n; *      20000515 Fixed up URB allocation (clear URB on alloc) (john)&n; *      20000515 Version 0.0.11j&n; *&t;20000516 Removed unnecessary spinlock in mts_transfer_context (john)&n; *&t;20000516 Removed unnecessary up on instance lock in mts_remove_nolock (john)&n; *&t;20000516 Implemented (badly) scsi_abort (john)&n; *&t;20000516 Version 0.0.12j&n; *      20000517 Hopefully removed mts_remove_nolock quasideadlock (john)&n; *      20000517 Added mts_debug_dump to print ll USB info (john)&n; *&t;20000518 Tweaks and documentation updates (john)&n; *&t;20000518 Version 0.0.13j&n; *&t;20000518 Cleaned up abort handling (john)&n; *&t;20000523 Removed scsi_command and various scsi_..._resets (john)&n; *&t;20000523 Added unlink URB on scsi_abort, now OHCI supports it (john)&n; *&t;20000523 Fixed last tiresome compile warning (john)&n; *&t;20000523 Version 0.0.14j (though version 0.1 has come out?)&n; *&t;20000602 Added primitive reset&n; *&t;20000602 Version 0.2.0&n; *&t;20000603 various cosmetic changes&n; *&t;20000603 Version 0.2.1&n; *&t;20000620 minor cosmetic changes&n; *&t;20000620 Version 0.2.2&n; *&t;20000822 Hopefully fixed deadlock in mts_remove_nolock()&n; *&t;20000822 Fixed minor race in mts_transfer_cleanup()&n; *&t;20000822 Fixed deadlock on submission error in queuecommand&n; *&t;20000822 Version 0.2.3&n; *&t;20000913 Reduced module size if debugging is off&n; *&t;20000913 Version 0.2.4&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;../scsi/scsi.h&quot;
macro_line|#include &quot;../scsi/hosts.h&quot;
macro_line|#include &quot;../scsi/sd.h&quot;
macro_line|#include &quot;microtek.h&quot;
multiline_comment|/* Constants */
DECL|macro|MTS_ABORT_TIMEOUT
mdefine_line|#define MTS_ABORT_TIMEOUT HZ /*jiffies*/
multiline_comment|/* Should we do debugging? */
singleline_comment|// #define MTS_DO_DEBUG
multiline_comment|/* USB layer driver interface */
r_static
r_void
op_star
id|mts_usb_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
suffix:semicolon
r_static
r_void
id|mts_usb_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
suffix:semicolon
DECL|variable|mts_usb_ids
r_static
r_struct
id|usb_device_id
id|mts_usb_ids
(braket
)braket
suffix:semicolon
DECL|variable|mts_usb_driver
r_static
r_struct
id|usb_driver
id|mts_usb_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;microtek&quot;
comma
id|probe
suffix:colon
id|mts_usb_probe
comma
id|disconnect
suffix:colon
id|mts_usb_disconnect
comma
id|id_table
suffix:colon
id|mts_usb_ids
comma
)brace
suffix:semicolon
multiline_comment|/* Internal driver stuff */
DECL|macro|MTS_VERSION
mdefine_line|#define MTS_VERSION&t;&quot;0.2.4&quot;
DECL|macro|MTS_NAME
mdefine_line|#define MTS_NAME&t;&quot;microtek usb (rev &quot; MTS_VERSION &quot;): &quot;
DECL|macro|MTS_WARNING
mdefine_line|#define MTS_WARNING(x...) &bslash;&n;&t;printk( KERN_WARNING MTS_NAME x )
DECL|macro|MTS_ERROR
mdefine_line|#define MTS_ERROR(x...) &bslash;&n;&t;printk( KERN_ERR MTS_NAME x )
DECL|macro|MTS_INT_ERROR
mdefine_line|#define MTS_INT_ERROR(x...) &bslash;&n;&t;MTS_ERROR(x)
DECL|macro|MTS_MESSAGE
mdefine_line|#define MTS_MESSAGE(x...) &bslash;&n;&t;printk( KERN_INFO MTS_NAME x )
macro_line|#if defined MTS_DO_DEBUG
DECL|macro|MTS_DEBUG
mdefine_line|#define MTS_DEBUG(x...) &bslash;&n;&t;printk( KERN_DEBUG MTS_NAME x )
DECL|macro|MTS_DEBUG_GOT_HERE
mdefine_line|#define MTS_DEBUG_GOT_HERE() &bslash;&n;&t;MTS_DEBUG(&quot;got to %s:%d (%s)&bslash;n&quot;, __FILE__, (int)__LINE__, __PRETTY_FUNCTION__ )
DECL|macro|MTS_DEBUG_INT
mdefine_line|#define MTS_DEBUG_INT() &bslash;&n;&t;do { MTS_DEBUG_GOT_HERE(); &bslash;&n;&t;     MTS_DEBUG(&quot;transfer = %x context = %x&bslash;n&quot;,(int)transfer,(int)context ); &bslash;&n;&t;     MTS_DEBUG(&quot;status = %x data-length = %x sent = %x&bslash;n&quot;,(int)transfer-&gt;status,(int)context-&gt;data_length, (int)transfer-&gt;actual_length ); &bslash;&n;             mts_debug_dump(context-&gt;instance);&bslash;&n;&t;   } while(0)
macro_line|#else
DECL|macro|MTS_NUL_STATEMENT
mdefine_line|#define MTS_NUL_STATEMENT do { } while(0)
DECL|macro|MTS_DEBUG
mdefine_line|#define MTS_DEBUG(x...)&t;MTS_NUL_STATEMENT
DECL|macro|MTS_DEBUG_GOT_HERE
mdefine_line|#define MTS_DEBUG_GOT_HERE() MTS_NUL_STATEMENT
DECL|macro|MTS_DEBUG_INT
mdefine_line|#define MTS_DEBUG_INT() MTS_NUL_STATEMENT
macro_line|#endif
DECL|macro|MTS_INT_INIT
mdefine_line|#define MTS_INT_INIT()&bslash;&n;&t;do {&bslash;&n;&t;context = (struct mts_transfer_context*)transfer-&gt;context; &bslash;&n;&t;if (atomic_read(&amp;context-&gt;do_abort)) {&bslash;&n;&t;&t;mts_transfer_cleanup(transfer);&bslash;&n;&t;&t;return;&bslash;&n;&t;}&bslash;&n;&t;MTS_DEBUG_INT();&bslash;&n;&t;} while (0)
macro_line|#ifdef MTS_DO_DEBUG
DECL|function|mts_debug_dump
r_static
r_inline
r_void
id|mts_debug_dump
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;desc at 0x%x: halted = %x%x, toggle = %x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|desc
comma
(paren
r_int
)paren
id|desc-&gt;usb_dev-&gt;halted
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|desc-&gt;usb_dev-&gt;halted
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|desc-&gt;usb_dev-&gt;toggle
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|desc-&gt;usb_dev-&gt;toggle
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;ep_out=%x ep_response=%x ep_image=%x&bslash;n&quot;
comma
id|usb_sndbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_out
)paren
comma
id|usb_rcvbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_response
)paren
comma
id|usb_rcvbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_image
)paren
)paren
suffix:semicolon
)brace
DECL|function|mts_show_command
r_static
r_inline
r_void
id|mts_show_command
c_func
(paren
id|Scsi_Cmnd
op_star
id|srb
)paren
(brace
r_char
op_star
id|what
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|srb-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
id|what
op_assign
l_string|&quot;TEST_UNIT_READY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REZERO_UNIT
suffix:colon
id|what
op_assign
l_string|&quot;REZERO_UNIT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REQUEST_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;REQUEST_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FORMAT_UNIT
suffix:colon
id|what
op_assign
l_string|&quot;FORMAT_UNIT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_BLOCK_LIMITS
suffix:colon
id|what
op_assign
l_string|&quot;READ_BLOCK_LIMITS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REASSIGN_BLOCKS
suffix:colon
id|what
op_assign
l_string|&quot;REASSIGN_BLOCKS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_6
suffix:colon
id|what
op_assign
l_string|&quot;READ_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_6
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEEK_6
suffix:colon
id|what
op_assign
l_string|&quot;SEEK_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_REVERSE
suffix:colon
id|what
op_assign
l_string|&quot;READ_REVERSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_FILEMARKS
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_FILEMARKS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPACE
suffix:colon
id|what
op_assign
l_string|&quot;SPACE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INQUIRY
suffix:colon
id|what
op_assign
l_string|&quot;INQUIRY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECOVER_BUFFERED_DATA
suffix:colon
id|what
op_assign
l_string|&quot;RECOVER_BUFFERED_DATA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SELECT
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SELECT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESERVE
suffix:colon
id|what
op_assign
l_string|&quot;RESERVE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RELEASE
suffix:colon
id|what
op_assign
l_string|&quot;RELEASE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COPY
suffix:colon
id|what
op_assign
l_string|&quot;COPY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ERASE
suffix:colon
id|what
op_assign
l_string|&quot;ERASE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|START_STOP
suffix:colon
id|what
op_assign
l_string|&quot;START_STOP&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_DIAGNOSTIC
suffix:colon
id|what
op_assign
l_string|&quot;RECEIVE_DIAGNOSTIC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEND_DIAGNOSTIC
suffix:colon
id|what
op_assign
l_string|&quot;SEND_DIAGNOSTIC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALLOW_MEDIUM_REMOVAL
suffix:colon
id|what
op_assign
l_string|&quot;ALLOW_MEDIUM_REMOVAL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_WINDOW
suffix:colon
id|what
op_assign
l_string|&quot;SET_WINDOW&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_CAPACITY
suffix:colon
id|what
op_assign
l_string|&quot;READ_CAPACITY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_10
suffix:colon
id|what
op_assign
l_string|&quot;READ_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_10
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEEK_10
suffix:colon
id|what
op_assign
l_string|&quot;SEEK_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_HIGH
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_HIGH&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_EQUAL
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_EQUAL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_LOW
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_LOW&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_LIMITS
suffix:colon
id|what
op_assign
l_string|&quot;SET_LIMITS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_POSITION
suffix:colon
id|what
op_assign
l_string|&quot;READ_POSITION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SYNCHRONIZE_CACHE
suffix:colon
id|what
op_assign
l_string|&quot;SYNCHRONIZE_CACHE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOCK_UNLOCK_CACHE
suffix:colon
id|what
op_assign
l_string|&quot;LOCK_UNLOCK_CACHE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_DEFECT_DATA
suffix:colon
id|what
op_assign
l_string|&quot;READ_DEFECT_DATA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEDIUM_SCAN
suffix:colon
id|what
op_assign
l_string|&quot;MEDIUM_SCAN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMPARE
suffix:colon
id|what
op_assign
l_string|&quot;COMPARE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COPY_VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;COPY_VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_BUFFER
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_BUFFER&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_BUFFER
suffix:colon
id|what
op_assign
l_string|&quot;READ_BUFFER&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|UPDATE_BLOCK
suffix:colon
id|what
op_assign
l_string|&quot;UPDATE_BLOCK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_LONG
suffix:colon
id|what
op_assign
l_string|&quot;READ_LONG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_LONG
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_LONG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CHANGE_DEFINITION
suffix:colon
id|what
op_assign
l_string|&quot;CHANGE_DEFINITION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_SAME
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_SAME&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_TOC
suffix:colon
id|what
op_assign
l_string|&quot;READ_TOC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOG_SELECT
suffix:colon
id|what
op_assign
l_string|&quot;LOG_SELECT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOG_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;LOG_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SELECT_10
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SELECT_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE_10
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SENSE_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MOVE_MEDIUM
suffix:colon
id|what
op_assign
l_string|&quot;MOVE_MEDIUM&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_12
suffix:colon
id|what
op_assign
l_string|&quot;READ_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_12
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_VERIFY_12
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_VERIFY_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_HIGH_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_HIGH_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_EQUAL_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_EQUAL_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_LOW_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_LOW_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_ELEMENT_STATUS
suffix:colon
id|what
op_assign
l_string|&quot;READ_ELEMENT_STATUS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEND_VOLUME_TAG
suffix:colon
id|what
op_assign
l_string|&quot;SEND_VOLUME_TAG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_LONG_2
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_LONG_2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;can&squot;t decode command&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
)brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;Command %s (%d bytes)&bslash;n&quot;
comma
id|what
comma
id|srb-&gt;cmd_len
)paren
suffix:semicolon
id|out
suffix:colon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;  %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|srb-&gt;cmnd
(braket
l_int|0
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|1
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|2
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|3
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|4
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|5
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|6
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|7
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|8
)braket
comma
id|srb-&gt;cmnd
(braket
l_int|9
)braket
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|mts_show_command
r_static
r_inline
r_void
id|mts_show_command
c_func
(paren
id|Scsi_Cmnd
op_star
id|srb
)paren
(brace
r_while
c_loop
(paren
l_int|0
)paren
(brace
)brace
)brace
DECL|function|mts_debug_dump
r_static
r_inline
r_void
id|mts_debug_dump
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
r_while
c_loop
(paren
l_int|0
)paren
(brace
)brace
)brace
macro_line|#endif
DECL|function|mts_is_aborting
r_static
r_inline
r_int
id|mts_is_aborting
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
r_return
(paren
id|atomic_read
c_func
(paren
op_amp
id|desc-&gt;context.do_abort
)paren
)paren
suffix:semicolon
)brace
DECL|function|mts_request_abort
r_static
r_inline
r_void
id|mts_request_abort
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_debug_dump
c_func
(paren
id|desc
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|desc-&gt;context.do_abort
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|mts_urb_abort
r_static
r_inline
r_void
id|mts_urb_abort
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_debug_dump
c_func
(paren
id|desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|desc-&gt;urb.status
op_eq
id|USB_ST_URB_PENDING
)paren
(brace
id|usb_unlink_urb
c_func
(paren
op_amp
id|desc-&gt;urb
)paren
suffix:semicolon
)brace
)brace
DECL|function|mts_wait_abort
r_static
r_inline
r_void
id|mts_wait_abort
c_func
(paren
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
id|mts_request_abort
c_func
(paren
id|desc
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|desc-&gt;lock.count
)paren
)paren
(brace
multiline_comment|/* Is there a function to check if the semaphore is locked? */
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|MTS_ABORT_TIMEOUT
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_urb_abort
c_func
(paren
id|desc
)paren
suffix:semicolon
)brace
)brace
DECL|variable|mts_list
r_static
r_struct
id|mts_desc
op_star
id|mts_list
suffix:semicolon
multiline_comment|/* list of active scanners */
DECL|variable|mts_list_semaphore
r_struct
id|semaphore
id|mts_list_semaphore
suffix:semicolon
multiline_comment|/* Internal list operations */
r_static
DECL|function|mts_remove_nolock
r_void
id|mts_remove_nolock
c_func
(paren
r_struct
id|mts_desc
op_star
id|to_remove
)paren
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;removing 0x%x from list&bslash;n&quot;
comma
(paren
r_int
)paren
id|to_remove
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|mts_wait_abort
c_func
(paren
id|to_remove
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|to_remove
op_ne
id|mts_list
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|to_remove-&gt;prev
op_logical_and
id|to_remove-&gt;next
)paren
id|to_remove-&gt;prev-&gt;next
op_assign
id|to_remove-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_list
op_assign
id|to_remove-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|mts_list
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_list-&gt;prev
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|to_remove-&gt;next
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|to_remove-&gt;next-&gt;prev
op_assign
id|to_remove-&gt;prev
suffix:semicolon
)brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|scsi_unregister_module
c_func
(paren
id|MODULE_SCSI_HA
comma
op_amp
(paren
id|to_remove-&gt;ctempl
)paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|to_remove
)paren
suffix:semicolon
)brace
r_static
DECL|function|mts_add_nolock
r_void
id|mts_add_nolock
c_func
(paren
r_struct
id|mts_desc
op_star
id|to_add
)paren
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;adding 0x%x to list&bslash;n&quot;
comma
(paren
r_int
)paren
id|to_add
)paren
suffix:semicolon
id|to_add-&gt;prev
op_assign
l_int|0
suffix:semicolon
id|to_add-&gt;next
op_assign
id|mts_list
suffix:semicolon
r_if
c_cond
(paren
id|mts_list
)paren
(brace
id|mts_list-&gt;prev
op_assign
id|to_add
suffix:semicolon
)brace
id|mts_list
op_assign
id|to_add
suffix:semicolon
)brace
multiline_comment|/* SCSI driver interface */
multiline_comment|/* scsi related functions - dummies for now mostly */
DECL|function|mts_scsi_release
r_static
r_int
id|mts_scsi_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|psh
)paren
(brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mts_scsi_abort
r_static
r_int
id|mts_scsi_abort
(paren
id|Scsi_Cmnd
op_star
id|srb
)paren
multiline_comment|/* interrupt context (!) */
multiline_comment|/* FIXME this is about to become task context */
(brace
r_struct
id|mts_desc
op_star
id|desc
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
(paren
id|srb-&gt;host-&gt;hostdata
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_request_abort
c_func
(paren
id|desc
)paren
suffix:semicolon
id|mts_urb_abort
c_func
(paren
id|desc
)paren
suffix:semicolon
r_return
id|SCSI_ABORT_PENDING
suffix:semicolon
)brace
DECL|function|mts_scsi_host_reset
r_static
r_int
id|mts_scsi_host_reset
(paren
id|Scsi_Cmnd
op_star
id|srb
)paren
(brace
r_struct
id|mts_desc
op_star
id|desc
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
(paren
id|srb-&gt;host-&gt;hostdata
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_debug_dump
c_func
(paren
id|desc
)paren
suffix:semicolon
id|usb_reset_device
c_func
(paren
id|desc-&gt;usb_dev
)paren
suffix:semicolon
multiline_comment|/*FIXME: untested on new reset code */
r_return
l_int|0
suffix:semicolon
multiline_comment|/* RANT why here 0 and not SUCCESS */
)brace
multiline_comment|/* the core of the scsi part */
multiline_comment|/* faking a detection - which can&squot;t fail :-) */
DECL|function|mts_scsi_detect
r_static
r_int
id|mts_scsi_detect
(paren
r_struct
id|SHT
op_star
id|sht
)paren
(brace
multiline_comment|/* Whole function stolen from usb-storage */
r_struct
id|mts_desc
op_star
id|desc
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
id|sht-&gt;proc_dir
suffix:semicolon
multiline_comment|/* What a hideous hack! */
r_char
id|local_name
(braket
l_int|48
)braket
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set up the name of our subdirectory under /proc/scsi/ */
id|sprintf
c_func
(paren
id|local_name
comma
l_string|&quot;microtek-%d&quot;
comma
id|desc-&gt;host_number
)paren
suffix:semicolon
id|sht-&gt;proc_name
op_assign
id|kmalloc
(paren
id|strlen
c_func
(paren
id|local_name
)paren
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
multiline_comment|/* FIXME: where is this freed ? */
r_if
c_cond
(paren
op_logical_neg
id|sht-&gt;proc_name
)paren
(brace
id|MTS_ERROR
c_func
(paren
l_string|&quot;unable to allocate memory for proc interface!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|sht-&gt;proc_name
comma
id|local_name
)paren
suffix:semicolon
id|sht-&gt;proc_dir
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* In host-&gt;hostdata we store a pointer to desc */
id|desc-&gt;host
op_assign
id|scsi_register
c_func
(paren
id|sht
comma
r_sizeof
(paren
id|desc
)paren
)paren
suffix:semicolon
id|desc-&gt;host-&gt;hostdata
(braket
l_int|0
)braket
op_assign
(paren
r_int
r_int
)paren
id|desc
suffix:semicolon
multiline_comment|/* FIXME: what if sizeof(void*) != sizeof(unsigned long)? */
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Main entrypoint: SCSI commands are dispatched to here */
r_static
r_int
id|mts_scsi_queuecommand
(paren
id|Scsi_Cmnd
op_star
id|srb
comma
id|mts_scsi_cmnd_callback
id|callback
)paren
suffix:semicolon
r_static
r_void
id|mts_transfer_cleanup
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
suffix:semicolon
r_inline
r_static
DECL|function|mts_int_submit_urb
r_void
id|mts_int_submit_urb
(paren
r_struct
id|urb
op_star
id|transfer
comma
r_int
id|pipe
comma
r_void
op_star
id|data
comma
r_int
id|length
comma
id|mts_usb_urb_callback
id|callback
)paren
multiline_comment|/* Interrupt context! */
multiline_comment|/* Holding transfer-&gt;context-&gt;lock! */
(brace
r_int
id|res
suffix:semicolon
r_struct
id|mts_transfer_context
op_star
id|context
suffix:semicolon
id|MTS_INT_INIT
c_func
(paren
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
id|transfer
comma
id|context-&gt;instance-&gt;usb_dev
comma
id|pipe
comma
id|data
comma
id|length
comma
id|callback
comma
id|context
)paren
suffix:semicolon
multiline_comment|/*&t;transfer-&gt;transfer_flags = USB_DISABLE_SPD;*/
id|transfer-&gt;transfer_flags
op_assign
id|USB_ASYNC_UNLINK
suffix:semicolon
id|transfer-&gt;status
op_assign
l_int|0
suffix:semicolon
id|transfer-&gt;timeout
op_assign
l_int|100
suffix:semicolon
id|res
op_assign
id|usb_submit_urb
c_func
(paren
id|transfer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
(brace
id|MTS_INT_ERROR
c_func
(paren
l_string|&quot;could not submit URB! Error was %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|res
)paren
suffix:semicolon
id|context-&gt;srb-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
id|context-&gt;state
op_assign
id|mts_con_error
suffix:semicolon
id|mts_transfer_cleanup
c_func
(paren
id|transfer
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|mts_transfer_cleanup
r_static
r_void
id|mts_transfer_cleanup
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
multiline_comment|/* Interrupt context! */
(brace
r_struct
id|mts_transfer_context
op_star
id|context
op_assign
(paren
r_struct
id|mts_transfer_context
op_star
)paren
id|transfer-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|context-&gt;final_callback
)paren
id|context
op_member_access_from_pointer
id|final_callback
c_func
(paren
id|context-&gt;srb
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|context-&gt;instance-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|mts_transfer_done
r_static
r_void
id|mts_transfer_done
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
(brace
r_struct
id|mts_transfer_context
op_star
id|context
suffix:semicolon
id|MTS_INT_INIT
c_func
(paren
)paren
suffix:semicolon
id|context-&gt;srb-&gt;result
op_and_assign
id|MTS_SCSI_ERR_MASK
suffix:semicolon
id|context-&gt;srb-&gt;result
op_or_assign
(paren
r_int
)paren
id|context-&gt;status
op_lshift
l_int|1
suffix:semicolon
id|mts_transfer_cleanup
c_func
(paren
id|transfer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mts_get_status
r_static
r_void
id|mts_get_status
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
multiline_comment|/* Interrupt context! */
(brace
r_struct
id|mts_transfer_context
op_star
id|context
suffix:semicolon
id|MTS_INT_INIT
c_func
(paren
)paren
suffix:semicolon
id|context-&gt;state
op_assign
id|mts_con_status
suffix:semicolon
id|mts_int_submit_urb
c_func
(paren
id|transfer
comma
id|usb_rcvbulkpipe
c_func
(paren
id|context-&gt;instance-&gt;usb_dev
comma
id|context-&gt;instance-&gt;ep_response
)paren
comma
op_amp
id|context-&gt;status
comma
l_int|1
comma
id|mts_transfer_done
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mts_data_done
r_static
r_void
id|mts_data_done
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
multiline_comment|/* Interrupt context! */
(brace
r_struct
id|mts_transfer_context
op_star
id|context
suffix:semicolon
id|MTS_INT_INIT
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|context-&gt;data_length
op_ne
id|transfer-&gt;actual_length
)paren
(brace
id|context-&gt;srb-&gt;resid
op_assign
id|context-&gt;data_length
op_minus
id|transfer-&gt;actual_length
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|transfer-&gt;status
)paren
(brace
id|context-&gt;srb-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
)brace
id|mts_get_status
c_func
(paren
id|transfer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mts_command_done
r_static
r_void
id|mts_command_done
c_func
(paren
r_struct
id|urb
op_star
id|transfer
)paren
multiline_comment|/* Interrupt context! */
(brace
r_struct
id|mts_transfer_context
op_star
id|context
suffix:semicolon
id|MTS_INT_INIT
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|transfer-&gt;status
)paren
(brace
id|context-&gt;srb-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
id|mts_transfer_cleanup
c_func
(paren
id|transfer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|context-&gt;data
)paren
(brace
id|context-&gt;state
op_assign
id|mts_con_data
suffix:semicolon
id|mts_int_submit_urb
c_func
(paren
id|transfer
comma
id|context-&gt;data_pipe
comma
id|context-&gt;data
comma
id|context-&gt;data_length
comma
id|mts_data_done
)paren
suffix:semicolon
)brace
r_else
id|mts_get_status
c_func
(paren
id|transfer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|mts_read_image_sig
r_static
r_const
id|u8
id|mts_read_image_sig
(braket
)braket
op_assign
(brace
l_int|0x28
comma
l_int|00
comma
l_int|00
comma
l_int|00
)brace
suffix:semicolon
DECL|variable|mts_read_image_sig_len
r_static
r_const
id|u8
id|mts_read_image_sig_len
op_assign
l_int|4
suffix:semicolon
DECL|variable|mts_direction
r_static
r_const
r_int
r_char
id|mts_direction
(braket
l_int|256
op_div
l_int|8
)braket
op_assign
(brace
l_int|0x28
comma
l_int|0x81
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x20
comma
l_int|0x01
comma
l_int|0x90
comma
l_int|0x77
comma
l_int|0x0C
comma
l_int|0x20
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|macro|MTS_DIRECTION_IS_IN
mdefine_line|#define MTS_DIRECTION_IS_IN(x) ((mts_direction[x&gt;&gt;3] &gt;&gt; (x &amp; 7)) &amp; 1)
r_static
r_void
DECL|function|mts_build_transfer_context
id|mts_build_transfer_context
c_func
(paren
id|Scsi_Cmnd
op_star
id|srb
comma
r_struct
id|mts_desc
op_star
id|desc
)paren
(brace
r_int
id|pipe
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|desc-&gt;context.instance
op_assign
id|desc
suffix:semicolon
id|desc-&gt;context.srb
op_assign
id|srb
suffix:semicolon
id|desc-&gt;context.state
op_assign
id|mts_con_command
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|desc-&gt;context.do_abort
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srb-&gt;bufflen
)paren
(brace
id|desc-&gt;context.data
op_assign
l_int|0
suffix:semicolon
id|desc-&gt;context.data_length
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|desc-&gt;context.data
op_assign
id|srb-&gt;buffer
suffix:semicolon
id|desc-&gt;context.data_length
op_assign
id|srb-&gt;bufflen
suffix:semicolon
)brace
multiline_comment|/* can&squot;t rely on srb-&gt;sc_data_direction */
multiline_comment|/* Brutally ripped from usb-storage */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|srb-&gt;cmnd
comma
id|mts_read_image_sig
comma
id|mts_read_image_sig_len
)paren
)paren
(brace
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_image
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;transfering from desc-&gt;ep_image == %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|desc-&gt;ep_image
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|MTS_DIRECTION_IS_IN
c_func
(paren
id|srb-&gt;cmnd
(braket
l_int|0
)braket
)paren
)paren
(brace
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_response
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;transfering from desc-&gt;ep_response == %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|desc-&gt;ep_response
)paren
suffix:semicolon
)brace
r_else
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;transfering to desc-&gt;ep_out == %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|desc-&gt;ep_out
)paren
suffix:semicolon
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_out
)paren
suffix:semicolon
)brace
id|desc-&gt;context.data_pipe
op_assign
id|pipe
suffix:semicolon
)brace
r_static
DECL|function|mts_scsi_queuecommand
r_int
id|mts_scsi_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|srb
comma
id|mts_scsi_cmnd_callback
id|callback
)paren
(brace
r_struct
id|mts_desc
op_star
id|desc
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
(paren
id|srb-&gt;host-&gt;hostdata
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|res
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_show_command
c_func
(paren
id|srb
)paren
suffix:semicolon
id|mts_debug_dump
c_func
(paren
id|desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srb-&gt;device-&gt;lun
op_logical_or
id|srb-&gt;device-&gt;id
op_logical_or
id|srb-&gt;device-&gt;channel
)paren
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;Command to LUN=%d ID=%d CHANNEL=%d from SCSI layer&bslash;n&quot;
comma
(paren
r_int
)paren
id|srb-&gt;device-&gt;lun
comma
(paren
r_int
)paren
id|srb-&gt;device-&gt;id
comma
(paren
r_int
)paren
id|srb-&gt;device-&gt;channel
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;this device doesn&squot;t exist&bslash;n&quot;
)paren
suffix:semicolon
id|srb-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
(brace
id|callback
c_func
(paren
id|srb
)paren
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|desc-&gt;lock
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|mts_show_command
c_func
(paren
id|srb
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
op_amp
id|desc-&gt;urb
comma
id|desc-&gt;usb_dev
comma
id|usb_sndbulkpipe
c_func
(paren
id|desc-&gt;usb_dev
comma
id|desc-&gt;ep_out
)paren
comma
id|srb-&gt;cmnd
comma
id|srb-&gt;cmd_len
comma
id|mts_command_done
comma
op_amp
id|desc-&gt;context
)paren
suffix:semicolon
id|mts_build_transfer_context
c_func
(paren
id|srb
comma
id|desc
)paren
suffix:semicolon
id|desc-&gt;context.final_callback
op_assign
id|callback
suffix:semicolon
id|desc-&gt;urb.timeout
op_assign
l_int|100
suffix:semicolon
id|desc-&gt;urb.transfer_flags
op_assign
id|USB_ASYNC_UNLINK
suffix:semicolon
multiline_comment|/*&t;desc-&gt;urb.transfer_flags = USB_DISABLE_SPD;*/
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|desc-&gt;urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
(brace
id|MTS_ERROR
c_func
(paren
l_string|&quot;error %d submitting URB&bslash;n&quot;
comma
(paren
r_int
)paren
id|res
)paren
suffix:semicolon
id|srb-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|callback
)paren
(brace
id|callback
c_func
(paren
id|srb
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|desc-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* no further cleanup is done */
r_goto
id|out
suffix:semicolon
)brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * this defines our &squot;host&squot;&n; */
multiline_comment|/* NOTE: This is taken from usb-storage, should be right. */
DECL|variable|mts_scsi_host_template
r_static
id|Scsi_Host_Template
id|mts_scsi_host_template
op_assign
(brace
id|name
suffix:colon
l_string|&quot;microtek&quot;
comma
id|detect
suffix:colon
id|mts_scsi_detect
comma
id|release
suffix:colon
id|mts_scsi_release
comma
id|command
suffix:colon
l_int|0
comma
id|queuecommand
suffix:colon
id|mts_scsi_queuecommand
comma
id|eh_abort_handler
suffix:colon
id|mts_scsi_abort
comma
id|eh_device_reset_handler
suffix:colon
l_int|0
comma
id|eh_bus_reset_handler
suffix:colon
l_int|0
comma
id|eh_host_reset_handler
suffix:colon
id|mts_scsi_host_reset
comma
id|can_queue
suffix:colon
l_int|1
comma
id|this_id
suffix:colon
op_minus
l_int|1
comma
id|cmd_per_lun
suffix:colon
l_int|1
comma
id|present
suffix:colon
l_int|0
comma
id|unchecked_isa_dma
suffix:colon
id|FALSE
comma
id|use_clustering
suffix:colon
id|FALSE
comma
id|use_new_eh_code
suffix:colon
id|TRUE
comma
id|emulated
suffix:colon
id|TRUE
)brace
suffix:semicolon
multiline_comment|/* USB layer driver interface implementation */
DECL|function|mts_usb_disconnect
r_static
r_void
id|mts_usb_disconnect
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|mts_desc
op_star
id|to_remove
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
id|ptr
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* leave the list - lock it */
id|down
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
id|mts_remove_nolock
c_func
(paren
id|to_remove
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
)brace
DECL|struct|vendor_product
r_struct
id|vendor_product
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
r_enum
(brace
DECL|enumerator|mts_sup_unknown
id|mts_sup_unknown
op_assign
l_int|0
comma
DECL|enumerator|mts_sup_alpha
id|mts_sup_alpha
comma
DECL|enumerator|mts_sup_full
id|mts_sup_full
)brace
DECL|member|support_status
id|support_status
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* These are taken from the msmUSB.inf file on the Windows driver CD */
DECL|variable|mts_supported_products
r_const
r_static
r_struct
id|vendor_product
id|mts_supported_products
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Phantom 336CX&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;Phantom 336CX&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;Scanmaker X6&quot;
comma
id|mts_sup_alpha
)brace
comma
(brace
l_string|&quot;Phantom C6&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;Phantom 336CX&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;ScanMaker V6USL&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;ScanMaker V6USL&quot;
comma
id|mts_sup_unknown
)brace
comma
(brace
l_string|&quot;Scanmaker V6UL&quot;
comma
id|mts_sup_unknown
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* The entries of microtek_table must correspond, line-by-line to&n;   the entries of mts_supported_products[]. */
DECL|variable|mts_usb_ids
r_static
r_struct
id|usb_device_id
id|mts_usb_ids
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x4ce
comma
l_int|0x0300
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x0094
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x0099
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x009a
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x00a0
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x00a3
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x80a3
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x5da
comma
l_int|0x80ac
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|mts_usb_ids
)paren
suffix:semicolon
DECL|function|mts_usb_probe
r_static
r_void
op_star
id|mts_usb_probe
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
id|ep_out
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|ep_in_set
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* this will break if we have more than three endpoints&n;&t;&t;&t;   which is why we check */
r_int
op_star
id|ep_in_current
op_assign
id|ep_in_set
suffix:semicolon
r_struct
id|mts_desc
op_star
id|new_desc
suffix:semicolon
r_struct
id|vendor_product
r_const
op_star
id|p
suffix:semicolon
multiline_comment|/* the altsettting 0 on the interface we&squot;re probing */
r_struct
id|usb_interface_descriptor
op_star
id|altsetting
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;usb-device descriptor at %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|dev
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;product id = 0x%x, vendor id = 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|dev-&gt;descriptor.idProduct
comma
(paren
r_int
)paren
id|dev-&gt;descriptor.idVendor
)paren
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|mts_supported_products
(braket
id|id
op_minus
id|mts_usb_ids
)braket
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;found model %s&bslash;n&quot;
comma
id|p-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;support_status
op_ne
id|mts_sup_full
)paren
id|MTS_MESSAGE
c_func
(paren
l_string|&quot;model %s is not known to be fully supported, reports welcome!&bslash;n&quot;
comma
id|p-&gt;name
)paren
suffix:semicolon
multiline_comment|/* the altsettting 0 on the interface we&squot;re probing */
id|altsetting
op_assign
op_amp
(paren
id|dev-&gt;actconfig-&gt;interface
(braket
id|interface
)braket
dot
id|altsetting
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Check if the config is sane */
r_if
c_cond
(paren
id|altsetting-&gt;bNumEndpoints
op_ne
id|MTS_EP_TOTAL
)paren
(brace
id|MTS_WARNING
c_func
(paren
l_string|&quot;expecting %d got %d endpoints! Bailing out.&bslash;n&quot;
comma
(paren
r_int
)paren
id|MTS_EP_TOTAL
comma
(paren
r_int
)paren
id|altsetting-&gt;bNumEndpoints
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|altsetting-&gt;bNumEndpoints
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|altsetting-&gt;endpoint
(braket
id|i
)braket
dot
id|bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
)paren
(brace
id|MTS_WARNING
c_func
(paren
l_string|&quot;can only deal with bulk endpoints; endpoint %d is not bulk.&bslash;n&quot;
comma
(paren
r_int
)paren
id|altsetting-&gt;endpoint
(braket
id|i
)braket
dot
id|bEndpointAddress
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|altsetting-&gt;endpoint
(braket
id|i
)braket
dot
id|bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
op_star
id|ep_in_current
op_increment
op_assign
id|altsetting-&gt;endpoint
(braket
id|i
)braket
dot
id|bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|ep_out
op_ne
op_minus
l_int|1
)paren
(brace
id|MTS_WARNING
c_func
(paren
l_string|&quot;can only deal with one output endpoints. Bailing out.&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ep_out
op_assign
id|altsetting-&gt;endpoint
(braket
id|i
)braket
dot
id|bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ep_out
op_eq
op_minus
l_int|1
)paren
(brace
id|MTS_WARNING
c_func
(paren
l_string|&quot;couldn&squot;t find an output bulk endpoint. Bailing out.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* I don&squot;t understand the following fully (it&squot;s from usb-storage) -- John */
multiline_comment|/* set the interface -- STALL is an acceptable response here */
id|result
op_assign
id|usb_set_interface
c_func
(paren
id|dev
comma
id|altsetting-&gt;bInterfaceNumber
comma
l_int|0
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;usb_set_interface returned %d.&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|result
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* no error */
r_break
suffix:semicolon
r_case
op_minus
id|EPIPE
suffix:colon
id|usb_clear_halt
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;clearing clearing stall on control interface&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;unknown error %d from usb_set_interface&bslash;n&quot;
comma
(paren
r_int
)paren
id|result
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* allocating a new descriptor */
id|new_desc
op_assign
(paren
r_struct
id|mts_desc
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mts_desc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_desc
op_eq
l_int|NULL
)paren
(brace
id|MTS_ERROR
c_func
(paren
l_string|&quot;couldn&squot;t allocate scanner desc, bailing out!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* As done by usb_alloc_urb */
id|memset
c_func
(paren
id|new_desc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|new_desc
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|new_desc-&gt;urb.lock
)paren
suffix:semicolon
multiline_comment|/* initialising that descriptor */
id|new_desc-&gt;usb_dev
op_assign
id|dev
suffix:semicolon
id|new_desc-&gt;interface
op_assign
id|interface
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|new_desc-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mts_list
)paren
(brace
id|new_desc-&gt;host_number
op_assign
id|mts_list-&gt;host_number
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|new_desc-&gt;host_number
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* endpoints */
id|new_desc-&gt;ep_out
op_assign
id|ep_out
suffix:semicolon
id|new_desc-&gt;ep_response
op_assign
id|ep_in_set
(braket
l_int|0
)braket
suffix:semicolon
id|new_desc-&gt;ep_image
op_assign
id|ep_in_set
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|new_desc-&gt;ep_out
op_ne
id|MTS_EP_OUT
)paren
id|MTS_WARNING
c_func
(paren
l_string|&quot;will this work? Command EP is not usually %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|new_desc-&gt;ep_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_desc-&gt;ep_response
op_ne
id|MTS_EP_RESPONSE
)paren
id|MTS_WARNING
c_func
(paren
l_string|&quot;will this work? Response EP is not usually %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|new_desc-&gt;ep_response
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_desc-&gt;ep_image
op_ne
id|MTS_EP_IMAGE
)paren
id|MTS_WARNING
c_func
(paren
l_string|&quot;will this work? Image data EP is not usually %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|new_desc-&gt;ep_image
)paren
suffix:semicolon
multiline_comment|/* Initialize the host template based on the default one */
id|memcpy
c_func
(paren
op_amp
(paren
id|new_desc-&gt;ctempl
)paren
comma
op_amp
id|mts_scsi_host_template
comma
r_sizeof
(paren
id|mts_scsi_host_template
)paren
)paren
suffix:semicolon
multiline_comment|/* HACK from usb-storage - this is needed for scsi detection */
(paren
r_struct
id|mts_desc
op_star
)paren
id|new_desc-&gt;ctempl.proc_dir
op_assign
id|new_desc
suffix:semicolon
multiline_comment|/* FIXME */
id|MTS_DEBUG
c_func
(paren
l_string|&quot;registering SCSI module&bslash;n&quot;
)paren
suffix:semicolon
id|new_desc-&gt;ctempl.module
op_assign
id|THIS_MODULE
suffix:semicolon
id|result
op_assign
id|scsi_register_module
c_func
(paren
id|MODULE_SCSI_HA
comma
op_amp
(paren
id|new_desc-&gt;ctempl
)paren
)paren
suffix:semicolon
multiline_comment|/* Will get hit back in microtek_detect by this func */
r_if
c_cond
(paren
id|result
)paren
(brace
id|MTS_ERROR
c_func
(paren
l_string|&quot;error %d from scsi_register_module! Help!&bslash;n&quot;
comma
(paren
r_int
)paren
id|result
)paren
suffix:semicolon
multiline_comment|/* FIXME: need more cleanup? */
id|kfree
c_func
(paren
id|new_desc
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* FIXME: the bomb is armed, must the host be registered under lock ? */
multiline_comment|/* join the list - lock it */
id|down
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
id|mts_add_nolock
c_func
(paren
id|new_desc
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
id|MTS_DEBUG
c_func
(paren
l_string|&quot;completed probe and exiting happily&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
r_void
op_star
)paren
id|new_desc
suffix:semicolon
)brace
multiline_comment|/* get us noticed by the rest of the kernel */
DECL|function|microtek_drv_init
r_int
id|__init
id|microtek_drv_init
c_func
(paren
r_void
)paren
(brace
r_int
id|result
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|usb_register
c_func
(paren
op_amp
id|mts_usb_driver
)paren
)paren
OL
l_int|0
)paren
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;usb_register returned %d&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|MTS_DEBUG
c_func
(paren
l_string|&quot;driver registered.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|microtek_drv_exit
r_void
id|__exit
id|microtek_drv_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|mts_desc
op_star
id|next
suffix:semicolon
id|MTS_DEBUG_GOT_HERE
c_func
(paren
)paren
suffix:semicolon
id|usb_deregister
c_func
(paren
op_amp
id|mts_usb_driver
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
r_while
c_loop
(paren
id|mts_list
)paren
(brace
multiline_comment|/* keep track of where the next one is */
id|next
op_assign
id|mts_list-&gt;next
suffix:semicolon
id|mts_remove_nolock
c_func
(paren
id|mts_list
)paren
suffix:semicolon
multiline_comment|/* advance the list pointer */
id|mts_list
op_assign
id|next
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|mts_list_semaphore
)paren
suffix:semicolon
)brace
DECL|variable|microtek_drv_init
id|module_init
c_func
(paren
id|microtek_drv_init
)paren
suffix:semicolon
DECL|variable|microtek_drv_exit
id|module_exit
c_func
(paren
id|microtek_drv_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;John Fremlin &lt;vii@penguinpowered.com&gt;, Oliver Neukum &lt;Oliver.Neukum@lrz.uni-muenchen.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Microtek Scanmaker X6 USB scanner driver&quot;
)paren
suffix:semicolon
eof
