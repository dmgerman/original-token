multiline_comment|/*&n;**&n;**&t;Pegasus: USB 10/100Mbps/HomePNA (1Mbps) Controller&n;**&n;**&t;Copyleft (L) 1999 Petko Manolov - Petkan (petkan@spct.net)&n;** &t;&n;**&t;Distribute under GPL version 2 or later.&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &quot;usb.h&quot;
macro_line|#if LINUX_VERSION_CODE&lt;0x2032d || !defined(__KERNEL__) || !defined(__OPTIMIZE__)
macro_line|#error You can not compile this driver on this kernel with this C options!
macro_line|#endif
DECL|macro|ADMTEK_VENDOR_ID
mdefine_line|#define&t;ADMTEK_VENDOR_ID&t;0x07a6
DECL|macro|ADMTEK_HPNA_PEGASUS
mdefine_line|#define&t;ADMTEK_HPNA_PEGASUS&t;0x0986
DECL|macro|HPNA_MTU
mdefine_line|#define&t;HPNA_MTU&t;&t;1500
DECL|macro|MAX_MTU
mdefine_line|#define MAX_MTU&t;&t;&t;1536
DECL|macro|TX_TIMEOUT
mdefine_line|#define&t;TX_TIMEOUT&t;&t;(HZ*5)
DECL|macro|SOMETHING
mdefine_line|#define&t;SOMETHING&t;&t;(jiffies + TX_TIMEOUT)
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;pegasus.c: v0.2.27 2000/02/29 Written by Petko Manolov (petkan@spct.net)&bslash;n&quot;
suffix:semicolon
DECL|struct|usb_hpna
r_typedef
r_struct
id|usb_hpna
(brace
DECL|member|usb_dev
r_struct
id|usb_device
op_star
id|usb_dev
suffix:semicolon
DECL|member|net_dev
r_struct
id|net_device
op_star
id|net_dev
suffix:semicolon
DECL|member|present
r_int
id|present
suffix:semicolon
DECL|member|active
r_int
id|active
suffix:semicolon
DECL|member|irq_handler
r_void
op_star
id|irq_handler
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|hpna_lock
id|spinlock_t
id|hpna_lock
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|rx_pipe
r_int
r_int
id|rx_pipe
suffix:semicolon
DECL|member|rx_buff
r_int
r_char
op_star
id|rx_buff
suffix:semicolon
DECL|member|rx_urb
id|urb_t
id|rx_urb
suffix:semicolon
DECL|member|tx_pipe
r_int
r_int
id|tx_pipe
suffix:semicolon
DECL|member|tx_buff
r_int
r_char
op_star
id|tx_buff
suffix:semicolon
DECL|member|tx_urb
id|urb_t
id|tx_urb
suffix:semicolon
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
suffix:semicolon
DECL|member|intr_ival
id|__u8
id|intr_ival
suffix:semicolon
DECL|member|intr_pipe
r_int
r_int
id|intr_pipe
suffix:semicolon
DECL|member|intr_buff
r_int
r_char
id|intr_buff
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|intr_urb
id|urb_t
id|intr_urb
suffix:semicolon
DECL|typedef|usb_hpna_t
)brace
id|usb_hpna_t
suffix:semicolon
DECL|variable|usb_dev_hpna
id|usb_hpna_t
id|usb_dev_hpna
suffix:semicolon
DECL|variable|loopback
r_static
r_int
id|loopback
op_assign
l_int|0
suffix:semicolon
DECL|variable|multicast_filter_limit
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|hpna_list
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Petko Manolov &lt;petkan@spct.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ADMtek &bslash;&quot;Pegasus&bslash;&quot; USB Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|loopback
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/*** vendor specific commands ***/
DECL|function|hpna_get_registers
r_static
id|__inline__
r_int
id|hpna_get_registers
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u16
id|indx
comma
id|__u16
id|size
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
l_int|0xf0
comma
l_int|0xc0
comma
l_int|0
comma
id|indx
comma
id|data
comma
id|size
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|hpna_set_register
r_static
id|__inline__
r_int
id|hpna_set_register
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u16
id|indx
comma
id|__u8
id|value
)paren
(brace
id|__u8
id|data
op_assign
id|value
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
l_int|0xf1
comma
l_int|0x40
comma
id|data
comma
id|indx
comma
op_amp
id|data
comma
l_int|1
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|hpna_set_registers
r_static
id|__inline__
r_int
id|hpna_set_registers
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u16
id|indx
comma
id|__u16
id|size
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
l_int|0xf1
comma
l_int|0x40
comma
l_int|0
comma
id|indx
comma
id|data
comma
id|size
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|read_phy_word
r_static
r_int
id|read_phy_word
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u8
id|index
comma
id|__u16
op_star
id|regdata
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x40
op_plus
id|index
suffix:semicolon
id|hpna_set_registers
c_func
(paren
id|dev
comma
l_int|0x25
comma
l_int|4
comma
id|data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hpna_get_registers
c_func
(paren
id|dev
comma
l_int|0x25
comma
l_int|4
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x80
)paren
(brace
op_star
id|regdata
op_assign
op_star
(paren
id|__u16
op_star
)paren
(paren
id|data
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
id|warn
c_func
(paren
l_string|&quot;read_phy_word() failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|write_phy_word
r_static
r_int
id|write_phy_word
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u8
id|index
comma
id|__u16
id|regdata
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|regdata
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|regdata
op_rshift
l_int|8
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x20
op_plus
id|index
suffix:semicolon
id|hpna_set_registers
c_func
(paren
id|dev
comma
l_int|0x25
comma
l_int|4
comma
id|data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hpna_get_registers
c_func
(paren
id|dev
comma
l_int|0x28
comma
l_int|1
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x80
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
id|warn
c_func
(paren
l_string|&quot;write_phy_word() failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|read_srom_word
r_int
id|read_srom_word
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u8
id|index
comma
id|__u16
op_star
id|retdata
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|index
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x02
suffix:semicolon
id|hpna_set_registers
c_func
(paren
id|dev
comma
l_int|0x20
comma
l_int|4
comma
id|data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hpna_get_registers
c_func
(paren
id|dev
comma
l_int|0x23
comma
l_int|1
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_amp
l_int|4
)paren
(brace
id|hpna_get_registers
c_func
(paren
id|dev
comma
l_int|0x21
comma
l_int|2
comma
id|data
)paren
suffix:semicolon
op_star
id|retdata
op_assign
op_star
(paren
id|__u16
op_star
)paren
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|warn
c_func
(paren
l_string|&quot;read_srom_word() failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*** end ***/
DECL|function|get_node_id
r_int
id|get_node_id
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
id|__u8
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|read_srom_word
c_func
(paren
id|dev
comma
id|i
comma
(paren
id|__u16
op_star
)paren
op_amp
id|id
(braket
id|i
op_star
l_int|2
)braket
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|reset_mac
r_static
r_int
id|reset_mac
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
id|__u8
id|data
op_assign
l_int|0x8
suffix:semicolon
r_int
id|i
suffix:semicolon
id|hpna_set_register
c_func
(paren
id|dev
comma
l_int|1
comma
l_int|0x08
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hpna_get_registers
c_func
(paren
id|dev
comma
l_int|1
comma
l_int|1
comma
op_amp
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
l_int|0x08
)paren
)paren
(brace
r_if
c_cond
(paren
id|loopback
op_amp
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|loopback
op_amp
l_int|2
)paren
(brace
id|write_phy_word
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0x4000
)paren
suffix:semicolon
multiline_comment|/*return&t;0;*/
)brace
id|hpna_set_register
c_func
(paren
id|dev
comma
l_int|0x7e
comma
l_int|0x24
)paren
suffix:semicolon
id|hpna_set_register
c_func
(paren
id|dev
comma
l_int|0x7e
comma
l_int|0x27
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|start_net
r_int
id|start_net
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|usb_device
op_star
id|usb_dev
)paren
(brace
id|__u16
id|partmedia
comma
id|temp
suffix:semicolon
id|__u8
id|node_id
(braket
l_int|6
)braket
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|get_node_id
c_func
(paren
id|usb_dev
comma
id|node_id
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hpna_set_registers
c_func
(paren
id|usb_dev
comma
l_int|0x10
comma
l_int|6
comma
id|node_id
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|node_id
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_phy_word
c_func
(paren
id|usb_dev
comma
l_int|1
comma
op_amp
id|temp
)paren
)paren
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp
op_amp
l_int|4
)paren
)paren
(brace
r_if
c_cond
(paren
id|loopback
)paren
r_goto
id|ok
suffix:semicolon
id|err
c_func
(paren
l_string|&quot;link NOT established - %x&quot;
comma
id|temp
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
id|ok
suffix:colon
r_if
c_cond
(paren
id|read_phy_word
c_func
(paren
id|usb_dev
comma
l_int|5
comma
op_amp
id|partmedia
)paren
)paren
r_return
l_int|4
suffix:semicolon
id|temp
op_assign
id|partmedia
suffix:semicolon
id|partmedia
op_and_assign
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|partmedia
op_ne
l_int|1
)paren
(brace
id|err
c_func
(paren
l_string|&quot;party FAIL %x&quot;
comma
id|temp
)paren
suffix:semicolon
r_return
l_int|5
suffix:semicolon
)brace
id|partmedia
op_assign
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|partmedia
op_amp
l_int|0x100
)paren
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x30
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|partmedia
op_amp
l_int|0x80
)paren
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x10
suffix:semicolon
r_else
id|data
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|data
(braket
l_int|0
)braket
op_assign
l_int|0xc9
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|loopback
op_amp
l_int|1
)paren
ques
c_cond
l_int|0x08
suffix:colon
l_int|0x00
suffix:semicolon
id|hpna_set_registers
c_func
(paren
id|usb_dev
comma
l_int|0
comma
l_int|3
comma
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpna_read_irq
r_static
r_void
id|hpna_read_irq
c_func
(paren
id|purb_t
id|urb
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
id|urb-&gt;context
suffix:semicolon
id|usb_hpna_t
op_star
id|hpna
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|count
op_assign
id|urb-&gt;actual_length
comma
id|res
suffix:semicolon
r_int
id|rx_status
op_assign
op_star
(paren
r_int
op_star
)paren
(paren
id|hpna-&gt;rx_buff
op_plus
id|count
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|info
c_func
(paren
l_string|&quot;%s: RX status %d&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_goto
id|goon
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_goto
id|goon
suffix:semicolon
multiline_comment|/*&t;if ( rx_status &amp; 0x00010000 )&n;&t;&t;goto goon;&n;*/
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x000e0000
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: error receiving packet %x&quot;
comma
id|net_dev-&gt;name
comma
id|rx_status
op_amp
l_int|0xe0000
)paren
suffix:semicolon
id|hpna-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x060000
)paren
(brace
id|hpna-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x080000
)paren
(brace
id|hpna-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x100000
)paren
(brace
id|hpna-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u16
id|pkt_len
op_assign
(paren
id|rx_status
op_amp
l_int|0xfff
)paren
op_minus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|net_dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|hpna-&gt;rx_buff
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
)brace
r_else
r_goto
id|goon
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|net_dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|hpna-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|hpna-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
id|goon
suffix:colon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|hpna-&gt;rx_urb
)paren
)paren
)paren
id|warn
c_func
(paren
l_string|&quot;failed rx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
)brace
DECL|function|hpna_irq
r_static
r_void
id|hpna_irq
c_func
(paren
id|urb_t
op_star
id|urb
)paren
(brace
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|__u8
op_star
id|d
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;txst0 %x, txst1 %x, rxst %x, rxlst0 %x, rxlst1 %x, wakest %x&quot;
comma
id|d
(braket
l_int|0
)braket
comma
id|d
(braket
l_int|1
)braket
comma
id|d
(braket
l_int|2
)braket
comma
id|d
(braket
l_int|3
)braket
comma
id|d
(braket
l_int|4
)braket
comma
id|d
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|hpna_write_irq
r_static
r_void
id|hpna_write_irq
c_func
(paren
id|purb_t
id|urb
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
id|urb-&gt;context
suffix:semicolon
id|usb_hpna_t
op_star
id|hpna
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpna-&gt;hpna_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
id|info
c_func
(paren
l_string|&quot;%s: TX status %d&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|urb-&gt;status
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|hpna-&gt;hpna_lock
)paren
suffix:semicolon
)brace
DECL|function|tx_timeout
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|usb_hpna_t
op_star
id|hpna
op_assign
id|dev-&gt;priv
suffix:semicolon
id|warn
c_func
(paren
l_string|&quot;%s: Tx timed out. Reseting...&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|hpna-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|hpna_start_xmit
r_static
r_int
id|hpna_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
id|usb_hpna_t
op_star
id|hpna
op_assign
(paren
id|usb_hpna_t
op_star
)paren
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|count
op_assign
id|skb-&gt;len
op_plus
l_int|2
op_mod
l_int|64
ques
c_cond
id|skb-&gt;len
op_plus
l_int|2
suffix:colon
id|skb-&gt;len
op_plus
l_int|3
suffix:semicolon
r_int
id|res
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpna-&gt;hpna_lock
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
(paren
(paren
id|__u16
op_star
)paren
id|hpna-&gt;tx_buff
)paren
(braket
l_int|0
)braket
op_assign
id|skb-&gt;len
suffix:semicolon
id|memcpy
c_func
(paren
id|hpna-&gt;tx_buff
op_plus
l_int|2
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
(paren
op_amp
id|hpna-&gt;tx_urb
)paren
op_member_access_from_pointer
id|transfer_buffer_length
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|hpna-&gt;tx_urb
)paren
)paren
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;failed tx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
id|hpna-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|hpna-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|hpna-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|net_dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|hpna-&gt;hpna_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpna_netdev_stats
r_static
r_struct
id|net_device_stats
op_star
id|hpna_netdev_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
id|usb_hpna_t
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
DECL|function|hpna_open
r_static
r_int
id|hpna_open
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
id|usb_hpna_t
op_star
id|hpna
op_assign
(paren
id|usb_hpna_t
op_star
)paren
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|hpna-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_else
id|hpna-&gt;active
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|start_net
c_func
(paren
id|net_dev
comma
id|hpna-&gt;usb_dev
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;can&squot;t start_net()&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|hpna-&gt;rx_urb
)paren
)paren
)paren
id|warn
c_func
(paren
l_string|&quot;failed rx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
multiline_comment|/*&t;usb_submit_urb( &amp;hpna-&gt;intr_urb );*/
id|netif_start_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpna_close
r_static
r_int
id|hpna_close
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
id|usb_hpna_t
op_star
id|hpna
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|hpna-&gt;rx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|hpna-&gt;tx_urb
)paren
suffix:semicolon
multiline_comment|/*&t;usb_unlink_urb( hpna-&gt;intr_urb );*/
id|hpna-&gt;active
op_assign
l_int|0
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpna_ioctl
r_static
r_int
id|hpna_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
id|__u16
op_star
id|data
op_assign
(paren
id|__u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
id|usb_hpna_t
op_star
id|hpna
op_assign
id|dev-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
id|read_phy_word
c_func
(paren
id|hpna-&gt;usb_dev
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
op_amp
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|write_phy_word
c_func
(paren
id|hpna-&gt;usb_dev
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
id|usb_hpna_t
op_star
id|hpna
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|info
c_func
(paren
l_string|&quot;%s: Promiscuous mode enabled&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
id|hpna_set_register
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|2
comma
l_int|0x04
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|net_dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
id|hpna_set_register
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|0
comma
l_int|0xfa
)paren
suffix:semicolon
id|hpna_set_register
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|2
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: set Rx mode&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
)brace
id|netif_wake_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
DECL|function|usb_hpna_probe
r_static
r_void
op_star
id|usb_hpna_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
suffix:semicolon
id|usb_hpna_t
op_star
id|hpna
op_assign
op_amp
id|usb_dev_hpna
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_ne
id|ADMTEK_VENDOR_ID
op_logical_or
id|dev-&gt;descriptor.idProduct
op_ne
id|ADMTEK_HPNA_PEGASUS
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;USB HPNA Pegasus found&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_configuration
c_func
(paren
id|dev
comma
id|dev-&gt;config
(braket
l_int|0
)braket
dot
id|bConfigurationValue
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;usb_set_configuration() failed&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|hpna-&gt;usb_dev
op_assign
id|dev
suffix:semicolon
id|hpna-&gt;rx_pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|1
)paren
suffix:semicolon
id|hpna-&gt;tx_pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|2
)paren
suffix:semicolon
id|hpna-&gt;intr_pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|hpna-&gt;usb_dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reset_mac
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;can&squot;t reset MAC&quot;
)paren
suffix:semicolon
)brace
id|hpna-&gt;present
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|hpna-&gt;rx_buff
op_assign
id|kmalloc
c_func
(paren
id|MAX_MTU
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;not enough mem for out buff&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|hpna-&gt;tx_buff
op_assign
id|kmalloc
c_func
(paren
id|MAX_MTU
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|kfree_s
c_func
(paren
id|hpna-&gt;rx_buff
comma
id|MAX_MTU
)paren
suffix:semicolon
id|err
c_func
(paren
l_string|&quot;not enough mem for out buff&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|net_dev
op_assign
id|init_etherdev
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|hpna-&gt;net_dev
op_assign
id|net_dev
suffix:semicolon
id|net_dev-&gt;priv
op_assign
id|hpna
suffix:semicolon
id|net_dev-&gt;open
op_assign
id|hpna_open
suffix:semicolon
id|net_dev-&gt;stop
op_assign
id|hpna_close
suffix:semicolon
id|net_dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|net_dev-&gt;tx_timeout
op_assign
id|tx_timeout
suffix:semicolon
id|net_dev-&gt;do_ioctl
op_assign
id|hpna_ioctl
suffix:semicolon
id|net_dev-&gt;hard_start_xmit
op_assign
id|hpna_start_xmit
suffix:semicolon
id|net_dev-&gt;set_multicast_list
op_assign
id|set_rx_mode
suffix:semicolon
id|net_dev-&gt;get_stats
op_assign
id|hpna_netdev_stats
suffix:semicolon
id|net_dev-&gt;mtu
op_assign
id|HPNA_MTU
suffix:semicolon
id|hpna-&gt;hpna_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
op_amp
id|hpna-&gt;rx_urb
comma
id|hpna-&gt;usb_dev
comma
id|hpna-&gt;rx_pipe
comma
id|hpna-&gt;rx_buff
comma
id|MAX_MTU
comma
id|hpna_read_irq
comma
id|net_dev
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
op_amp
id|hpna-&gt;tx_urb
comma
id|hpna-&gt;usb_dev
comma
id|hpna-&gt;tx_pipe
comma
id|hpna-&gt;tx_buff
comma
id|MAX_MTU
comma
id|hpna_write_irq
comma
id|net_dev
)paren
suffix:semicolon
id|FILL_INT_URB
c_func
(paren
op_amp
id|hpna-&gt;intr_urb
comma
id|hpna-&gt;usb_dev
comma
id|hpna-&gt;intr_pipe
comma
id|hpna-&gt;intr_buff
comma
l_int|8
comma
id|hpna_irq
comma
id|net_dev
comma
l_int|250
)paren
suffix:semicolon
multiline_comment|/*&t;list_add( &amp;hpna-&gt;list, &amp;hpna_list );*/
r_return
id|net_dev
suffix:semicolon
)brace
DECL|function|usb_hpna_disconnect
r_static
r_void
id|usb_hpna_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
id|ptr
suffix:semicolon
r_struct
id|usb_hpna
op_star
id|hpna
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_UP
)paren
id|dev_close
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hpna
)paren
multiline_comment|/* should never happen */
r_return
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|hpna-&gt;rx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|hpna-&gt;tx_urb
)paren
suffix:semicolon
multiline_comment|/*&t;usb_unlink_urb( &amp;hpna-&gt;intr_urb );*/
id|kfree_s
c_func
(paren
id|hpna-&gt;rx_buff
comma
id|MAX_MTU
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|hpna-&gt;tx_buff
comma
id|MAX_MTU
)paren
suffix:semicolon
id|hpna-&gt;usb_dev
op_assign
l_int|NULL
suffix:semicolon
id|hpna-&gt;present
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;USB HPNA disconnected&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|usb_hpna_driver
r_static
r_struct
id|usb_driver
id|usb_hpna_driver
op_assign
(brace
l_string|&quot;ADMtek &bslash;&quot;Pegasus&bslash;&quot; USB Ethernet&quot;
comma
id|usb_hpna_probe
comma
id|usb_hpna_disconnect
comma
(brace
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|start_hpna
r_static
r_int
id|__init
id|start_hpna
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
r_return
id|usb_register
c_func
(paren
op_amp
id|usb_hpna_driver
)paren
suffix:semicolon
)brace
DECL|function|stop_hpna
r_static
r_void
id|__exit
id|stop_hpna
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|usb_hpna_driver
)paren
suffix:semicolon
)brace
DECL|variable|start_hpna
id|module_init
c_func
(paren
id|start_hpna
)paren
suffix:semicolon
DECL|variable|stop_hpna
id|module_exit
c_func
(paren
id|stop_hpna
)paren
suffix:semicolon
eof
