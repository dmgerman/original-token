multiline_comment|/*&n;**&t;Pegasus: USB 10/100Mbps/HomePNA (1Mbps) Controller&n;**&n;**&t;Copyright (c) 1999,2000 Petko Manolov - Petkan (petkan@dce.bg)&n;**&t;&n;**&n;**&t;ChangeLog:&n;**&t;&t;....&t;Most of the time spend reading sources &amp; docs.&n;**&t;&t;v0.2.x&t;First official release for the Linux kernel.&n;**&t;&t;v0.3.0&t;Beutified and structured, some bugs fixed.&n;**&t;&t;v0.3.x&t;URBifying bulk requests and bugfixing. First relatively&n;**&t;&t;&t;stable release. Still can touch device&squot;s registers only&n;**&t;&t;&t;from top-halves.&n;**&t;&t;v0.4.0&t;Control messages remained unurbified are now URBs.&n;**&t;&t;&t;Now we can touch the HW at any time.&n;**&t;&t;v0.4.9&t;Control urbs again use process context to wait. Argh...&n;**&t;&t;&t;Some long standing bugs (enable_net_traffic) fixed.&n;**&t;&t;&t;Also nasty trick about resubmiting control urb from&n;**&t;&t;&t;interrupt context used. Please let me know how it&n;**&t;&t;&t;behaves. Pegasus II support added since this version.&n;**&t;&t;&t;TODO: suppressing HCD warnings spewage on disconnect.&n;**&t;&t;v0.4.13&t;Ethernet address is now set at probe(), not at open()&n;**&t;&t;&t;time as this seems to break dhcpd. &n;*/
multiline_comment|/*&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
id|__FILE__
l_string|&quot;: v0.4.13 2000/10/13 (C) 1999-2000 Petko Manolov (petkan@dce.bg)&quot;
suffix:semicolon
DECL|macro|PEGASUS_USE_INTR
mdefine_line|#define&t;PEGASUS_USE_INTR
DECL|macro|PEGASUS_II
mdefine_line|#define&t;PEGASUS_II&t;&t;0x80000000
DECL|macro|HAS_HOME_PNA
mdefine_line|#define&t;HAS_HOME_PNA&t;&t;0x40000000
DECL|macro|PEGASUS_MTU
mdefine_line|#define&t;PEGASUS_MTU&t;&t;1500
DECL|macro|PEGASUS_MAX_MTU
mdefine_line|#define&t;PEGASUS_MAX_MTU&t;&t;1536
DECL|macro|EPROM_WRITE
mdefine_line|#define&t;EPROM_WRITE&t;&t;0x01
DECL|macro|EPROM_READ
mdefine_line|#define&t;EPROM_READ&t;&t;0x02
DECL|macro|EPROM_DONE
mdefine_line|#define&t;EPROM_DONE&t;&t;0x04
DECL|macro|EPROM_WR_ENABLE
mdefine_line|#define&t;EPROM_WR_ENABLE&t;&t;0x10
DECL|macro|EPROM_LOAD
mdefine_line|#define&t;EPROM_LOAD&t;&t;0x20
DECL|macro|MII_BMCR
mdefine_line|#define&t;MII_BMCR&t;&t;0x00
DECL|macro|MII_BMSR
mdefine_line|#define&t;MII_BMSR&t;&t;0x01
DECL|macro|BMSR_MEDIA
mdefine_line|#define&t;BMSR_MEDIA&t;&t;0x7808
DECL|macro|MII_ANLPA
mdefine_line|#define&t;MII_ANLPA&t;&t;0x05
DECL|macro|ANLPA_100TX_FD
mdefine_line|#define&t;ANLPA_100TX_FD&t;&t;0x0100
DECL|macro|ANLPA_100TX_HD
mdefine_line|#define&t;ANLPA_100TX_HD&t;&t;0x0080
DECL|macro|ANLPA_10T_FD
mdefine_line|#define&t;ANLPA_10T_FD&t;&t;0x0040
DECL|macro|ANLPA_10T_HD
mdefine_line|#define&t;ANLPA_10T_HD&t;&t;0x0020
DECL|macro|PHY_DONE
mdefine_line|#define&t;PHY_DONE&t;&t;0x80
DECL|macro|PHY_READ
mdefine_line|#define&t;PHY_READ&t;&t;0x40
DECL|macro|PHY_WRITE
mdefine_line|#define&t;PHY_WRITE&t;&t;0x20
DECL|macro|DEFAULT_GPIO_RESET
mdefine_line|#define&t;DEFAULT_GPIO_RESET&t;0x24
DECL|macro|LINKSYS_GPIO_RESET
mdefine_line|#define&t;LINKSYS_GPIO_RESET&t;0x24
DECL|macro|DEFAULT_GPIO_SET
mdefine_line|#define&t;DEFAULT_GPIO_SET&t;0x26
DECL|macro|PEGASUS_PRESENT
mdefine_line|#define&t;PEGASUS_PRESENT&t;&t;0x00000001
DECL|macro|PEGASUS_RUNNING
mdefine_line|#define&t;PEGASUS_RUNNING&t;&t;0x00000002
DECL|macro|PEGASUS_TX_BUSY
mdefine_line|#define&t;PEGASUS_TX_BUSY&t;&t;0x00000004
DECL|macro|PEGASUS_RX_BUSY
mdefine_line|#define&t;PEGASUS_RX_BUSY&t;&t;0x00000008
DECL|macro|CTRL_URB_RUNNING
mdefine_line|#define&t;CTRL_URB_RUNNING&t;0x00000010
DECL|macro|CTRL_URB_SLEEP
mdefine_line|#define&t;CTRL_URB_SLEEP&t;&t;0x00000020
DECL|macro|PEGASUS_UNPLUG
mdefine_line|#define&t;PEGASUS_UNPLUG&t;&t;0x00000040
DECL|macro|ETH_REGS_CHANGE
mdefine_line|#define&t;ETH_REGS_CHANGE&t;&t;0x40000000
DECL|macro|ETH_REGS_CHANGED
mdefine_line|#define&t;ETH_REGS_CHANGED&t;0x80000000
DECL|macro|RX_MULTICAST
mdefine_line|#define&t;RX_MULTICAST&t;&t;2
DECL|macro|RX_PROMISCUOUS
mdefine_line|#define&t;RX_PROMISCUOUS&t;&t;4
DECL|macro|REG_TIMEOUT
mdefine_line|#define&t;REG_TIMEOUT&t;&t;(HZ)
DECL|macro|PEGASUS_TX_TIMEOUT
mdefine_line|#define&t;PEGASUS_TX_TIMEOUT&t;(HZ*10)
DECL|macro|TX_UNDERRUN
mdefine_line|#define&t;TX_UNDERRUN&t;&t;0x80
DECL|macro|EXCESSIVE_COL
mdefine_line|#define&t;EXCESSIVE_COL&t;&t;0x40
DECL|macro|LATE_COL
mdefine_line|#define&t;LATE_COL&t;&t;0x20
DECL|macro|NO_CARRIER
mdefine_line|#define&t;NO_CARRIER&t;&t;0x10
DECL|macro|LOSS_CARRIER
mdefine_line|#define&t;LOSS_CARRIER&t;&t;0x08
DECL|macro|JABBER_TIMEOUT
mdefine_line|#define&t;JABBER_TIMEOUT&t;&t;0x04
DECL|macro|PEGASUS_REQT_READ
mdefine_line|#define&t;PEGASUS_REQT_READ&t;0xc0
DECL|macro|PEGASUS_REQT_WRITE
mdefine_line|#define&t;PEGASUS_REQT_WRITE&t;0x40
DECL|macro|PEGASUS_REQ_GET_REGS
mdefine_line|#define&t;PEGASUS_REQ_GET_REGS&t;0xf0
DECL|macro|PEGASUS_REQ_SET_REGS
mdefine_line|#define&t;PEGASUS_REQ_SET_REGS&t;0xf1
DECL|macro|PEGASUS_REQ_SET_REG
mdefine_line|#define&t;PEGASUS_REQ_SET_REG&t;PEGASUS_REQ_SET_REGS
DECL|macro|NUM_CTRL_URBS
mdefine_line|#define&t;NUM_CTRL_URBS&t;&t;0x10
DECL|macro|ALIGN
mdefine_line|#define&t;ALIGN(x)&t;&t;x __attribute__((aligned(L1_CACHE_BYTES)))
DECL|enum|pegasus_registers
r_enum
id|pegasus_registers
(brace
DECL|enumerator|EthCtrl0
id|EthCtrl0
op_assign
l_int|0
comma
DECL|enumerator|EthCtrl1
id|EthCtrl1
op_assign
l_int|1
comma
DECL|enumerator|EthCtrl2
id|EthCtrl2
op_assign
l_int|2
comma
DECL|enumerator|EthID
id|EthID
op_assign
l_int|0x10
comma
DECL|enumerator|Reg1d
id|Reg1d
op_assign
l_int|0x1d
comma
DECL|enumerator|EpromOffset
id|EpromOffset
op_assign
l_int|0x20
comma
DECL|enumerator|EpromData
id|EpromData
op_assign
l_int|0x21
comma
multiline_comment|/* 0x21 low, 0x22 high byte */
DECL|enumerator|EpromCtrl
id|EpromCtrl
op_assign
l_int|0x23
comma
DECL|enumerator|PhyAddr
id|PhyAddr
op_assign
l_int|0x25
comma
DECL|enumerator|PhyData
id|PhyData
op_assign
l_int|0x26
comma
multiline_comment|/* 0x26 low, 0x27 high byte */
DECL|enumerator|PhyCtrl
id|PhyCtrl
op_assign
l_int|0x28
comma
DECL|enumerator|UsbStst
id|UsbStst
op_assign
l_int|0x2a
comma
DECL|enumerator|EthTxStat0
id|EthTxStat0
op_assign
l_int|0x2b
comma
DECL|enumerator|EthTxStat1
id|EthTxStat1
op_assign
l_int|0x2c
comma
DECL|enumerator|EthRxStat
id|EthRxStat
op_assign
l_int|0x2d
comma
DECL|enumerator|Reg7b
id|Reg7b
op_assign
l_int|0x7b
comma
DECL|enumerator|Gpio0
id|Gpio0
op_assign
l_int|0x7e
comma
DECL|enumerator|Gpio1
id|Gpio1
op_assign
l_int|0x7f
comma
DECL|enumerator|Reg81
id|Reg81
op_assign
l_int|0x81
comma
)brace
suffix:semicolon
DECL|struct|pegasus
r_typedef
r_struct
id|pegasus
(brace
DECL|member|usb
r_struct
id|usb_device
op_star
id|usb
suffix:semicolon
DECL|member|net
r_struct
id|net_device
op_star
id|net
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|features
r_int
id|features
suffix:semicolon
DECL|member|intr_interval
r_int
id|intr_interval
suffix:semicolon
DECL|member|ctrl_urb
DECL|member|rx_urb
DECL|member|tx_urb
DECL|member|intr_urb
r_struct
id|urb
id|ctrl_urb
comma
id|rx_urb
comma
id|tx_urb
comma
id|intr_urb
suffix:semicolon
DECL|member|dr
id|devrequest
id|dr
suffix:semicolon
DECL|member|ctrl_wait
id|wait_queue_head_t
id|ctrl_wait
suffix:semicolon
DECL|member|ctrl_sem
r_struct
id|semaphore
id|ctrl_sem
suffix:semicolon
r_int
r_char
id|ALIGN
c_func
(paren
id|rx_buff
(braket
id|PEGASUS_MAX_MTU
)braket
)paren
suffix:semicolon
r_int
r_char
id|ALIGN
c_func
(paren
id|tx_buff
(braket
id|PEGASUS_MAX_MTU
)braket
)paren
suffix:semicolon
r_int
r_char
id|ALIGN
c_func
(paren
id|intr_buff
(braket
l_int|8
)braket
)paren
suffix:semicolon
DECL|member|eth_regs
id|__u8
id|eth_regs
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|phy
id|__u8
id|phy
suffix:semicolon
DECL|member|gpio_res
id|__u8
id|gpio_res
suffix:semicolon
DECL|typedef|pegasus_t
)brace
id|pegasus_t
suffix:semicolon
DECL|struct|usb_eth_dev
r_struct
id|usb_eth_dev
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|vendor
id|__u16
id|vendor
suffix:semicolon
DECL|member|device
id|__u16
id|device
suffix:semicolon
DECL|member|private
id|__u32
r_private
suffix:semicolon
multiline_comment|/* LSB is gpio reset value */
)brace
suffix:semicolon
DECL|variable|loopback
r_static
r_int
id|loopback
op_assign
l_int|0
suffix:semicolon
DECL|variable|mii_mode
r_static
r_int
id|mii_mode
op_assign
l_int|0
suffix:semicolon
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Petko Manolov &lt;petkan@dce.bg&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ADMtek AN986 Pegasus USB Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|loopback
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|loopback
comma
l_string|&quot;Enable MAC loopback mode (bit 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;Enable HomePNA mode (bit 0) - default = MII mode = 0&quot;
)paren
suffix:semicolon
DECL|variable|usb_dev_id
r_static
r_struct
id|usb_eth_dev
id|usb_dev_id
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Billionton USB-100&quot;
comma
l_int|0x08dd
comma
l_int|0x0986
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Corega FEter USB-TX&quot;
comma
l_int|0x7aa
comma
l_int|0x0004
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;MELCO/BUFFALO LUA-TX&quot;
comma
l_int|0x0411
comma
l_int|0x0001
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DSB-650TX&quot;
comma
l_int|0x2001
comma
l_int|0x4001
comma
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DSB-650TX&quot;
comma
l_int|0x2001
comma
l_int|0x4002
comma
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DSB-650TX(PNA)&quot;
comma
l_int|0x2001
comma
l_int|0x4003
comma
id|HAS_HOME_PNA
op_or
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DSB-650&quot;
comma
l_int|0x2001
comma
l_int|0xabc1
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DU-E10&quot;
comma
l_int|0x07b8
comma
l_int|0xabc1
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;D-Link DU-E100&quot;
comma
l_int|0x07b8
comma
l_int|0x4002
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Linksys USB10TX&quot;
comma
l_int|0x066b
comma
l_int|0x2202
comma
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Linksys USB100TX&quot;
comma
l_int|0x066b
comma
l_int|0x2203
comma
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Linksys USB100TX&quot;
comma
l_int|0x066b
comma
l_int|0x2204
comma
id|HAS_HOME_PNA
op_or
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Linksys USB Ethernet Adapter&quot;
comma
l_int|0x066b
comma
l_int|0x2206
comma
id|LINKSYS_GPIO_RESET
)brace
comma
(brace
l_string|&quot;SMC 202 USB Ethernet&quot;
comma
l_int|0x0707
comma
l_int|0x0200
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;ADMtek AN986 &bslash;&quot;Pegasus&bslash;&quot; USB Ethernet (eval board)&quot;
comma
l_int|0x07a6
comma
l_int|0x0986
comma
id|HAS_HOME_PNA
op_or
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;Accton USB 10/100 Ethernet Adapter&quot;
comma
l_int|0x083a
comma
l_int|0x1046
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;IO DATA USB ET/TX&quot;
comma
l_int|0x04bb
comma
l_int|0x0904
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;LANEED USB Ethernet LD-USB/TX&quot;
comma
l_int|0x056e
comma
l_int|0x4002
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;SOHOware NUB100 Ethernet&quot;
comma
l_int|0x15e8
comma
l_int|0x9100
comma
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_string|&quot;ADMtek ADM8511 &bslash;&quot;Pegasus II&bslash;&quot; USB Ethernet&quot;
comma
l_int|0x07a6
comma
l_int|0x8511
comma
id|PEGASUS_II
op_or
id|DEFAULT_GPIO_RESET
)brace
comma
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
r_static
r_int
id|update_eth_regs_async
c_func
(paren
id|pegasus_t
op_star
)paren
suffix:semicolon
multiline_comment|/* Aargh!!! I _really_ hate such tweaks */
DECL|function|ctrl_callback
r_static
r_void
id|ctrl_callback
c_func
(paren
id|urb_t
op_star
id|urb
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_case
id|USB_ST_NOERROR
suffix:colon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|ETH_REGS_CHANGE
)paren
(brace
id|pegasus-&gt;flags
op_and_assign
op_complement
id|ETH_REGS_CHANGE
suffix:semicolon
id|pegasus-&gt;flags
op_or_assign
id|ETH_REGS_CHANGED
suffix:semicolon
id|update_eth_regs_async
c_func
(paren
id|pegasus
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|USB_ST_URB_PENDING
suffix:colon
r_return
suffix:semicolon
r_case
id|USB_ST_URB_KILLED
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; status %d&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_and_assign
op_complement
id|ETH_REGS_CHANGED
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|CTRL_URB_SLEEP
)paren
(brace
id|pegasus-&gt;flags
op_and_assign
op_complement
id|CTRL_URB_SLEEP
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
)brace
)brace
DECL|function|get_registers
r_static
r_int
id|get_registers
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u16
id|indx
comma
id|__u16
id|size
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|ETH_REGS_CHANGED
)paren
(brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
)brace
id|pegasus-&gt;dr.requesttype
op_assign
id|PEGASUS_REQT_READ
suffix:semicolon
id|pegasus-&gt;dr.request
op_assign
id|PEGASUS_REQ_GET_REGS
suffix:semicolon
id|pegasus-&gt;dr.value
op_assign
l_int|0
suffix:semicolon
id|pegasus-&gt;dr.index
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|indx
)paren
suffix:semicolon
id|pegasus-&gt;dr.length
op_assign
id|pegasus-&gt;ctrl_urb.transfer_buffer_length
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|size
)paren
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
comma
id|pegasus-&gt;usb
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|0
)paren
comma
(paren
r_char
op_star
)paren
op_amp
id|pegasus-&gt;dr
comma
id|data
comma
id|size
comma
id|ctrl_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
)paren
)paren
(brace
id|err
c_func
(paren
id|__FUNCTION__
l_string|&quot; BAD CTRLs %d&quot;
comma
id|ret
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|set_registers
r_static
r_int
id|set_registers
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u16
id|indx
comma
id|__u16
id|size
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|ETH_REGS_CHANGED
)paren
(brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
)brace
id|pegasus-&gt;dr.requesttype
op_assign
id|PEGASUS_REQT_WRITE
suffix:semicolon
id|pegasus-&gt;dr.request
op_assign
id|PEGASUS_REQ_SET_REGS
suffix:semicolon
id|pegasus-&gt;dr.value
op_assign
l_int|0
suffix:semicolon
id|pegasus-&gt;dr.index
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|indx
)paren
suffix:semicolon
id|pegasus-&gt;dr.length
op_assign
id|pegasus-&gt;ctrl_urb.transfer_buffer_length
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|size
)paren
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
comma
id|pegasus-&gt;usb
comma
id|usb_sndctrlpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|0
)paren
comma
(paren
r_char
op_star
)paren
op_amp
id|pegasus-&gt;dr
comma
id|data
comma
id|size
comma
id|ctrl_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
)paren
)paren
(brace
id|err
c_func
(paren
id|__FUNCTION__
l_string|&quot; BAD CTRL %d&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|set_register
r_static
r_int
id|set_register
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u16
id|indx
comma
id|__u8
id|data
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|ETH_REGS_CHANGED
)paren
(brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
)brace
id|pegasus-&gt;dr.requesttype
op_assign
id|PEGASUS_REQT_WRITE
suffix:semicolon
id|pegasus-&gt;dr.request
op_assign
id|PEGASUS_REQ_SET_REG
suffix:semicolon
id|pegasus-&gt;dr.value
op_assign
id|data
suffix:semicolon
id|pegasus-&gt;dr.index
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|indx
)paren
suffix:semicolon
id|pegasus-&gt;dr.length
op_assign
id|pegasus-&gt;ctrl_urb.transfer_buffer_length
op_assign
l_int|1
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
comma
id|pegasus-&gt;usb
comma
id|usb_sndctrlpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|0
)paren
comma
(paren
r_char
op_star
)paren
op_amp
id|pegasus-&gt;dr
comma
op_amp
id|data
comma
l_int|1
comma
id|ctrl_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
)paren
)paren
(brace
id|err
c_func
(paren
id|__FUNCTION__
l_string|&quot; BAD CTRL %d&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|CTRL_URB_SLEEP
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|update_eth_regs_async
r_static
r_int
id|update_eth_regs_async
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
r_int
id|ret
suffix:semicolon
id|pegasus-&gt;dr.requesttype
op_assign
id|PEGASUS_REQT_WRITE
suffix:semicolon
id|pegasus-&gt;dr.request
op_assign
id|PEGASUS_REQ_SET_REGS
suffix:semicolon
id|pegasus-&gt;dr.value
op_assign
l_int|0
suffix:semicolon
id|pegasus-&gt;dr.index
op_assign
id|EthCtrl0
suffix:semicolon
id|pegasus-&gt;dr.length
op_assign
id|pegasus-&gt;ctrl_urb.transfer_buffer_length
op_assign
l_int|3
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
comma
id|pegasus-&gt;usb
comma
id|usb_sndctrlpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|0
)paren
comma
(paren
r_char
op_star
)paren
op_amp
id|pegasus-&gt;dr
comma
id|pegasus-&gt;eth_regs
comma
l_int|3
comma
id|ctrl_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
)paren
)paren
id|err
c_func
(paren
id|__FUNCTION__
l_string|&quot; BAD CTRL %d, flags %x&quot;
comma
id|ret
comma
id|pegasus-&gt;flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|read_phy_word
r_static
r_int
id|read_phy_word
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u8
id|phy
comma
id|__u8
id|indx
comma
id|__u16
op_star
id|regd
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
op_assign
(brace
id|phy
comma
l_int|0
comma
l_int|0
comma
id|indx
)brace
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
l_int|0
)paren
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|PhyAddr
comma
r_sizeof
(paren
id|data
)paren
comma
id|data
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
(paren
id|indx
op_or
id|PHY_READ
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
l_int|1
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_amp
id|PHY_DONE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|REG_TIMEOUT
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|PhyData
comma
l_int|2
comma
id|regd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|write_phy_word
r_static
r_int
id|write_phy_word
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u8
id|phy
comma
id|__u8
id|indx
comma
id|__u16
id|regd
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
op_assign
(brace
id|phy
comma
l_int|0
comma
l_int|0
comma
id|indx
)brace
suffix:semicolon
op_star
(paren
id|data
op_plus
l_int|1
)paren
op_assign
id|cpu_to_le16p
c_func
(paren
op_amp
id|regd
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
l_int|0
)paren
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|PhyAddr
comma
l_int|4
comma
id|data
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
(paren
id|indx
op_or
id|PHY_WRITE
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|PhyCtrl
comma
l_int|1
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_amp
id|PHY_DONE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|REG_TIMEOUT
)paren
r_return
l_int|0
suffix:semicolon
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|read_eprom_word
r_static
r_int
id|read_eprom_word
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u8
id|index
comma
id|__u16
op_star
id|retdata
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
l_int|0
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromOffset
comma
id|index
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
id|EPROM_READ
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|EPROM_DONE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|REG_TIMEOUT
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|EpromData
comma
l_int|2
comma
id|retdata
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef&t;PEGASUS_WRITE_EEPROM
DECL|function|enable_eprom_write
r_static
r_inline
r_void
id|enable_eprom_write
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|__u8
id|tmp
suffix:semicolon
id|get_registers
c_func
(paren
id|pegasus
comma
id|EthCtrl2
comma
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EthCtrl2
comma
id|tmp
op_or
id|EPROM_WR_ENABLE
)paren
suffix:semicolon
)brace
DECL|function|disable_eprom_write
r_static
r_inline
r_void
id|disable_eprom_write
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|__u8
id|tmp
suffix:semicolon
id|get_registers
c_func
(paren
id|pegasus
comma
id|EthCtrl2
comma
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
l_int|0
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EthCtrl2
comma
id|tmp
op_amp
op_complement
id|EPROM_WR_ENABLE
)paren
suffix:semicolon
)brace
DECL|function|write_eprom_word
r_static
r_int
id|write_eprom_word
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u8
id|index
comma
id|__u16
id|data
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
id|__u8
id|d
(braket
l_int|4
)braket
op_assign
(brace
l_int|0x3f
comma
l_int|0
comma
l_int|0
comma
id|EPROM_WRITE
)brace
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|EpromOffset
comma
l_int|4
comma
id|d
)paren
suffix:semicolon
id|enable_eprom_write
c_func
(paren
id|pegasus
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromOffset
comma
id|index
)paren
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|EpromData
comma
l_int|2
comma
op_amp
id|data
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
id|EPROM_WRITE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|EpromCtrl
comma
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|EPROM_DONE
)paren
r_break
suffix:semicolon
)brace
id|disable_eprom_write
c_func
(paren
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|REG_TIMEOUT
)paren
r_return
l_int|0
suffix:semicolon
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif&t;/* PEGASUS_WRITE_EEPROM */
DECL|function|get_node_id
r_static
r_inline
r_void
id|get_node_id
c_func
(paren
id|pegasus_t
op_star
id|pegasus
comma
id|__u8
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|read_eprom_word
c_func
(paren
id|pegasus
comma
id|i
comma
(paren
id|__u16
op_star
)paren
op_amp
id|id
(braket
id|i
op_star
l_int|2
)braket
)paren
suffix:semicolon
)brace
DECL|function|set_ethernet_addr
r_static
r_void
id|set_ethernet_addr
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|__u8
id|node_id
(braket
l_int|6
)braket
suffix:semicolon
id|get_node_id
c_func
(paren
id|pegasus
comma
id|node_id
)paren
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|EthID
comma
r_sizeof
(paren
id|node_id
)paren
comma
id|node_id
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|pegasus-&gt;net-&gt;dev_addr
comma
id|node_id
comma
r_sizeof
(paren
id|node_id
)paren
)paren
suffix:semicolon
)brace
DECL|function|reset_mac
r_static
r_inline
r_int
id|reset_mac
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|__u8
id|data
op_assign
l_int|0x8
suffix:semicolon
r_int
id|i
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|EthCtrl1
comma
id|data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|get_registers
c_func
(paren
id|pegasus
comma
id|EthCtrl1
comma
l_int|1
comma
op_amp
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_complement
id|data
op_amp
l_int|0x08
)paren
(brace
r_if
c_cond
(paren
id|loopback
op_amp
l_int|1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mii_mode
op_logical_and
(paren
id|pegasus-&gt;features
op_amp
id|HAS_HOME_PNA
)paren
)paren
id|set_register
c_func
(paren
id|pegasus
comma
id|Gpio1
comma
l_int|0x34
)paren
suffix:semicolon
r_else
id|set_register
c_func
(paren
id|pegasus
comma
id|Gpio1
comma
l_int|0x26
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|Gpio0
comma
id|pegasus-&gt;features
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|Gpio0
comma
id|DEFAULT_GPIO_SET
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|REG_TIMEOUT
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|enable_net_traffic
r_static
r_int
id|enable_net_traffic
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|usb_device
op_star
id|usb
)paren
(brace
id|__u16
id|linkpart
comma
id|bmsr
suffix:semicolon
id|__u8
id|data
(braket
l_int|4
)braket
suffix:semicolon
id|pegasus_t
op_star
id|pegasus
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|read_phy_word
c_func
(paren
id|pegasus
comma
id|pegasus-&gt;phy
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
)paren
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bmsr
op_amp
l_int|0x20
)paren
op_logical_and
op_logical_neg
id|loopback
)paren
id|warn
c_func
(paren
l_string|&quot;%s: link NOT established (0x%x) - check the cable.&quot;
comma
id|dev-&gt;name
comma
id|bmsr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_phy_word
c_func
(paren
id|pegasus
comma
id|pegasus-&gt;phy
comma
id|MII_ANLPA
comma
op_amp
id|linkpart
)paren
)paren
r_return
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|linkpart
op_amp
l_int|1
)paren
)paren
id|warn
c_func
(paren
l_string|&quot;link partner stat %x&quot;
comma
id|linkpart
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0xc9
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|linkpart
op_amp
(paren
id|ANLPA_100TX_FD
op_or
id|ANLPA_10T_FD
)paren
)paren
id|data
(braket
l_int|1
)braket
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* set full duplex */
r_if
c_cond
(paren
id|linkpart
op_amp
(paren
id|ANLPA_100TX_FD
op_or
id|ANLPA_100TX_HD
)paren
)paren
id|data
(braket
l_int|1
)braket
op_or_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* set 100 Mbps */
r_if
c_cond
(paren
id|mii_mode
)paren
id|data
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|loopback
op_amp
l_int|1
)paren
ques
c_cond
l_int|0x09
suffix:colon
l_int|0x01
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|pegasus-&gt;eth_regs
op_assign
op_star
(paren
r_int
op_star
)paren
id|data
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|EthCtrl0
comma
l_int|3
comma
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|read_bulk_callback
r_static
r_void
id|read_bulk_callback
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|net_device
op_star
id|net
suffix:semicolon
r_int
id|count
op_assign
id|urb-&gt;actual_length
comma
id|res
suffix:semicolon
r_int
id|rx_status
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u16
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
op_logical_or
op_logical_neg
(paren
id|pegasus-&gt;flags
op_amp
id|PEGASUS_RUNNING
)paren
)paren
r_return
suffix:semicolon
id|net
op_assign
id|pegasus-&gt;net
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|net
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;flags
op_amp
id|PEGASUS_RX_BUSY
)paren
(brace
id|pegasus-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|PEGASUS_RX_BUSY
suffix:semicolon
id|rx_status
op_assign
op_star
(paren
r_int
op_star
)paren
(paren
id|pegasus-&gt;rx_buff
op_plus
id|count
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: RX status %d&quot;
comma
id|net-&gt;name
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_goto
id|goon
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_goto
id|goon
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x000e0000
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: error receiving packet %x&quot;
comma
id|net-&gt;name
comma
id|rx_status
op_amp
l_int|0xe0000
)paren
suffix:semicolon
id|pegasus-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x060000
)paren
id|pegasus-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x080000
)paren
id|pegasus-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x100000
)paren
id|pegasus-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_goto
id|goon
suffix:semicolon
)brace
id|pkt_len
op_assign
(paren
id|rx_status
op_amp
l_int|0xfff
)paren
op_minus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
)paren
r_goto
id|goon
suffix:semicolon
id|skb-&gt;dev
op_assign
id|net
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|pegasus-&gt;rx_buff
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|net
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|pegasus-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|pegasus-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|goon
suffix:colon
id|FILL_BULK_URB
c_func
(paren
op_amp
id|pegasus-&gt;rx_urb
comma
id|pegasus-&gt;usb
comma
id|usb_rcvbulkpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|1
)paren
comma
id|pegasus-&gt;rx_buff
comma
id|PEGASUS_MAX_MTU
comma
id|read_bulk_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;rx_urb
)paren
)paren
)paren
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed submint rx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
id|pegasus-&gt;flags
op_and_assign
op_complement
id|PEGASUS_RX_BUSY
suffix:semicolon
)brace
DECL|function|write_bulk_callback
r_static
r_void
id|write_bulk_callback
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
op_logical_or
op_logical_neg
(paren
id|pegasus-&gt;flags
op_amp
id|PEGASUS_RUNNING
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|pegasus-&gt;net
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
id|info
c_func
(paren
l_string|&quot;%s: TX status %d&quot;
comma
id|pegasus-&gt;net-&gt;name
comma
id|urb-&gt;status
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|pegasus-&gt;net
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;PEGASUS_USE_INTR
DECL|function|intr_callback
r_static
r_void
id|intr_callback
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|net_device
op_star
id|net
suffix:semicolon
id|__u8
op_star
id|d
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
)paren
r_return
suffix:semicolon
id|d
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
id|net
op_assign
id|pegasus-&gt;net
suffix:semicolon
r_if
c_cond
(paren
id|d
(braket
l_int|0
)braket
op_amp
l_int|0xfc
)paren
(brace
id|pegasus-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
(braket
l_int|0
)braket
op_amp
id|TX_UNDERRUN
)paren
id|pegasus-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
(braket
l_int|0
)braket
op_amp
(paren
id|EXCESSIVE_COL
op_or
id|JABBER_TIMEOUT
)paren
)paren
id|pegasus-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
(braket
l_int|0
)braket
op_amp
id|LATE_COL
)paren
id|pegasus-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
(braket
l_int|0
)braket
op_amp
(paren
id|NO_CARRIER
op_or
id|LOSS_CARRIER
)paren
)paren
id|pegasus-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_case
id|USB_ST_NOERROR
suffix:colon
r_break
suffix:semicolon
r_case
id|USB_ST_URB_KILLED
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|info
c_func
(paren
l_string|&quot;intr status %d&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|pegasus_tx_timeout
r_static
r_void
id|pegasus_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|net-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
)paren
r_return
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|pegasus-&gt;tx_urb
)paren
suffix:semicolon
id|warn
c_func
(paren
l_string|&quot;%s: Tx timed out.&quot;
comma
id|net-&gt;name
)paren
suffix:semicolon
id|pegasus-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|net-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|net
)paren
suffix:semicolon
)brace
DECL|function|pegasus_start_xmit
r_static
r_int
id|pegasus_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|net
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|net-&gt;priv
suffix:semicolon
r_int
id|count
op_assign
(paren
(paren
id|skb-&gt;len
op_plus
l_int|2
)paren
op_amp
l_int|0x3f
)paren
ques
c_cond
id|skb-&gt;len
op_plus
l_int|2
suffix:colon
id|skb-&gt;len
op_plus
l_int|3
suffix:semicolon
r_int
id|res
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net
)paren
suffix:semicolon
(paren
(paren
id|__u16
op_star
)paren
id|pegasus-&gt;tx_buff
)paren
(braket
l_int|0
)braket
op_assign
id|skb-&gt;len
suffix:semicolon
id|memcpy
c_func
(paren
id|pegasus-&gt;tx_buff
op_plus
l_int|2
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
op_amp
id|pegasus-&gt;tx_urb
comma
id|pegasus-&gt;usb
comma
id|usb_sndbulkpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|2
)paren
comma
id|pegasus-&gt;tx_buff
comma
id|PEGASUS_MAX_MTU
comma
id|write_bulk_callback
comma
id|pegasus
)paren
suffix:semicolon
id|pegasus-&gt;tx_urb.transfer_buffer_length
op_assign
id|count
suffix:semicolon
id|pegasus-&gt;tx_urb.transfer_flags
op_or_assign
id|USB_ASYNC_UNLINK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;tx_urb
)paren
)paren
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;failed tx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
id|pegasus-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|net
)paren
suffix:semicolon
)brace
r_else
(brace
id|pegasus-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|pegasus-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|net-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pegasus_netdev_stats
r_static
r_struct
id|net_device_stats
op_star
id|pegasus_netdev_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
id|pegasus_t
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
DECL|function|disable_net_traffic
r_static
r_inline
r_void
id|disable_net_traffic
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
id|set_registers
c_func
(paren
id|pegasus
comma
id|EthCtrl0
comma
l_int|2
comma
op_amp
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|get_interrupt_interval
r_static
r_inline
r_void
id|get_interrupt_interval
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|__u8
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|read_eprom_word
c_func
(paren
id|pegasus
comma
l_int|4
comma
(paren
id|__u16
op_star
)paren
id|data
)paren
suffix:semicolon
id|pegasus-&gt;intr_interval
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
)brace
DECL|function|pegasus_open
r_static
r_int
id|pegasus_open
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
(paren
id|pegasus_t
op_star
)paren
id|net-&gt;priv
suffix:semicolon
r_int
id|res
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|enable_net_traffic
c_func
(paren
id|net
comma
id|pegasus-&gt;usb
)paren
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;can&squot;t enable_net_traffic() - %d&quot;
comma
id|res
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|FILL_BULK_URB
c_func
(paren
op_amp
id|pegasus-&gt;rx_urb
comma
id|pegasus-&gt;usb
comma
id|usb_rcvbulkpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|1
)paren
comma
id|pegasus-&gt;rx_buff
comma
id|PEGASUS_MAX_MTU
comma
id|read_bulk_callback
comma
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;rx_urb
)paren
)paren
)paren
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed rx_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
macro_line|#ifdef&t;PEGASUS_USE_INTR
id|get_interrupt_interval
c_func
(paren
id|pegasus
)paren
suffix:semicolon
id|FILL_INT_URB
c_func
(paren
op_amp
id|pegasus-&gt;intr_urb
comma
id|pegasus-&gt;usb
comma
id|usb_rcvintpipe
c_func
(paren
id|pegasus-&gt;usb
comma
l_int|3
)paren
comma
id|pegasus-&gt;intr_buff
comma
r_sizeof
(paren
id|pegasus-&gt;intr_buff
)paren
comma
id|intr_callback
comma
id|pegasus
comma
id|pegasus-&gt;intr_interval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|usb_submit_urb
c_func
(paren
op_amp
id|pegasus-&gt;intr_urb
)paren
)paren
)paren
id|warn
c_func
(paren
id|__FUNCTION__
l_string|&quot; failed intr_urb %d&quot;
comma
id|res
)paren
suffix:semicolon
macro_line|#endif
id|netif_start_queue
c_func
(paren
id|net
)paren
suffix:semicolon
id|pegasus-&gt;flags
op_or_assign
id|PEGASUS_RUNNING
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pegasus_close
r_static
r_int
id|pegasus_close
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|net-&gt;priv
suffix:semicolon
id|pegasus-&gt;flags
op_and_assign
op_complement
id|PEGASUS_RUNNING
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pegasus-&gt;flags
op_amp
id|PEGASUS_UNPLUG
)paren
)paren
id|disable_net_traffic
c_func
(paren
id|pegasus
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|pegasus-&gt;rx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|pegasus-&gt;tx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|pegasus-&gt;intr_urb
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pegasus_ioctl
r_static
r_int
id|pegasus_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|net
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
id|__u16
op_star
id|data
op_assign
(paren
id|__u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
id|pegasus_t
op_star
id|pegasus
op_assign
id|net-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
id|data
(braket
l_int|0
)braket
op_assign
id|pegasus-&gt;phy
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
id|read_phy_word
c_func
(paren
id|pegasus
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
op_amp
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|write_phy_word
c_func
(paren
id|pegasus
comma
id|pegasus-&gt;phy
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|pegasus_set_multicast
r_static
r_void
id|pegasus_set_multicast
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
id|pegasus_t
op_star
id|pegasus
op_assign
id|net-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|pegasus-&gt;eth_regs
(braket
id|EthCtrl2
)braket
op_or_assign
id|RX_PROMISCUOUS
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;%s: Promiscuous mode enabled&quot;
comma
id|net-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|net-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|net-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
id|pegasus-&gt;eth_regs
(braket
id|EthCtrl0
)braket
op_or_assign
id|RX_MULTICAST
suffix:semicolon
id|pegasus-&gt;eth_regs
(braket
id|EthCtrl2
)braket
op_and_assign
op_complement
id|RX_PROMISCUOUS
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;%s set allmulti&quot;
comma
id|net-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|pegasus-&gt;eth_regs
(braket
id|EthCtrl0
)braket
op_and_assign
op_complement
id|RX_MULTICAST
suffix:semicolon
id|pegasus-&gt;eth_regs
(braket
id|EthCtrl2
)braket
op_and_assign
op_complement
id|RX_PROMISCUOUS
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;%s: set Rx mode&quot;
comma
id|net-&gt;name
)paren
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|ETH_REGS_CHANGE
suffix:semicolon
id|ctrl_callback
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_urb
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|net
)paren
suffix:semicolon
)brace
DECL|function|check_device_ids
r_static
r_int
id|check_device_ids
c_func
(paren
id|__u16
id|vendor
comma
id|__u16
id|product
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|usb_dev_id
(braket
id|i
)braket
dot
id|name
)paren
(brace
r_if
c_cond
(paren
(paren
id|usb_dev_id
(braket
id|i
)braket
dot
id|vendor
op_eq
id|vendor
)paren
op_logical_and
(paren
id|usb_dev_id
(braket
id|i
)braket
dot
id|device
op_eq
id|product
)paren
)paren
r_return
id|i
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|mii_phy_probe
r_static
id|__u8
id|mii_phy_probe
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u16
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|read_phy_word
c_func
(paren
id|pegasus
comma
id|i
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0
op_logical_or
id|tmp
op_eq
l_int|0xffff
op_logical_or
(paren
id|tmp
op_amp
id|BMSR_MEDIA
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_else
r_return
id|i
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|setup_pegasus_II
r_static
r_inline
r_void
id|setup_pegasus_II
c_func
(paren
id|pegasus_t
op_star
id|pegasus
)paren
(brace
id|set_register
c_func
(paren
id|pegasus
comma
id|Reg1d
comma
l_int|0
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|pegasus
comma
id|Reg7b
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;features
op_amp
id|HAS_HOME_PNA
op_logical_and
id|mii_mode
)paren
id|set_register
c_func
(paren
id|pegasus
comma
id|Reg81
comma
l_int|6
)paren
suffix:semicolon
r_else
id|set_register
c_func
(paren
id|pegasus
comma
id|Reg81
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pegasus_probe
r_static
r_void
op_star
id|pegasus_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
)paren
(brace
r_struct
id|net_device
op_star
id|net
suffix:semicolon
id|pegasus_t
op_star
id|pegasus
suffix:semicolon
r_int
id|dev_indx
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev_indx
op_assign
id|check_device_ids
c_func
(paren
id|dev-&gt;descriptor.idVendor
comma
id|dev-&gt;descriptor.idProduct
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usb_set_configuration
c_func
(paren
id|dev
comma
id|dev-&gt;config
(braket
l_int|0
)braket
dot
id|bConfigurationValue
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;usb_set_configuration() failed&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pegasus
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pegasus
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;out of memory allocating device structure&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|usb_inc_dev_use
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pegasus
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pegasus
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|pegasus
op_member_access_from_pointer
id|ctrl_sem
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|pegasus-&gt;ctrl_wait
)paren
suffix:semicolon
id|net
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|net
)paren
(brace
id|kfree
c_func
(paren
id|pegasus
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|pegasus-&gt;usb
op_assign
id|dev
suffix:semicolon
id|pegasus-&gt;net
op_assign
id|net
suffix:semicolon
id|net-&gt;priv
op_assign
id|pegasus
suffix:semicolon
id|net-&gt;open
op_assign
id|pegasus_open
suffix:semicolon
id|net-&gt;stop
op_assign
id|pegasus_close
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,3,48)
id|net-&gt;watchdog_timeo
op_assign
id|PEGASUS_TX_TIMEOUT
suffix:semicolon
id|net-&gt;tx_timeout
op_assign
id|pegasus_tx_timeout
suffix:semicolon
macro_line|#endif
id|net-&gt;do_ioctl
op_assign
id|pegasus_ioctl
suffix:semicolon
id|net-&gt;hard_start_xmit
op_assign
id|pegasus_start_xmit
suffix:semicolon
id|net-&gt;set_multicast_list
op_assign
id|pegasus_set_multicast
suffix:semicolon
id|net-&gt;get_stats
op_assign
id|pegasus_netdev_stats
suffix:semicolon
id|net-&gt;mtu
op_assign
id|PEGASUS_MTU
suffix:semicolon
id|pegasus-&gt;features
op_assign
id|usb_dev_id
(braket
id|dev_indx
)braket
dot
r_private
suffix:semicolon
r_if
c_cond
(paren
id|reset_mac
c_func
(paren
id|pegasus
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;can&squot;t reset MAC&quot;
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|pegasus-&gt;net
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pegasus
)paren
suffix:semicolon
id|pegasus
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|set_ethernet_addr
c_func
(paren
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pegasus-&gt;features
op_amp
id|PEGASUS_II
)paren
(brace
id|info
c_func
(paren
l_string|&quot;setup Pegasus II specific registers&quot;
)paren
suffix:semicolon
id|setup_pegasus_II
c_func
(paren
id|pegasus
)paren
suffix:semicolon
)brace
id|pegasus-&gt;phy
op_assign
id|mii_phy_probe
c_func
(paren
id|pegasus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus-&gt;phy
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;can&squot;t locate MII phy, using default&quot;
)paren
suffix:semicolon
id|pegasus-&gt;phy
op_assign
l_int|1
suffix:semicolon
)brace
id|info
c_func
(paren
l_string|&quot;%s: %s&quot;
comma
id|net-&gt;name
comma
id|usb_dev_id
(braket
id|dev_indx
)braket
dot
id|name
)paren
suffix:semicolon
r_return
id|pegasus
suffix:semicolon
)brace
DECL|function|pegasus_disconnect
r_static
r_void
id|pegasus_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|pegasus
op_star
id|pegasus
op_assign
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pegasus
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;unregistering non-existant device&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pegasus-&gt;flags
op_or_assign
id|PEGASUS_UNPLUG
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|pegasus-&gt;net
)paren
suffix:semicolon
id|usb_dec_dev_use
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pegasus
)paren
suffix:semicolon
id|pegasus
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|pegasus_driver
r_static
r_struct
id|usb_driver
id|pegasus_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;pegasus&quot;
comma
id|probe
suffix:colon
id|pegasus_probe
comma
id|disconnect
suffix:colon
id|pegasus_disconnect
comma
)brace
suffix:semicolon
DECL|function|pegasus_init
r_int
id|__init
id|pegasus_init
c_func
(paren
r_void
)paren
(brace
id|info
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
r_return
id|usb_register
c_func
(paren
op_amp
id|pegasus_driver
)paren
suffix:semicolon
)brace
DECL|function|pegasus_exit
r_void
id|__exit
id|pegasus_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|pegasus_driver
)paren
suffix:semicolon
)brace
DECL|variable|pegasus_init
id|module_init
c_func
(paren
id|pegasus_init
)paren
suffix:semicolon
DECL|variable|pegasus_exit
id|module_exit
c_func
(paren
id|pegasus_exit
)paren
suffix:semicolon
eof
