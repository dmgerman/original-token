multiline_comment|/*&n; * drivers/usb/proc_usb.c&n; * (C) Copyright 1999 Randy Dunlap.&n; * (C) Copyright 1999 Thomas Sailer &lt;sailer@ife.ee.ethz.ch&gt;. (proc file per device)&n; * (C) Copyright 1999 Deti Fliegl (new USB architecture)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; *************************************************************&n; *&n; * This is a /proc/bus/usb filesystem output module for USB.&n; * It creates /proc/bus/usb/drivers and /proc/bus/usb/devices.&n; *&n; * /proc/bus/usb/devices contains USB topology, device, config, class,&n; * interface, &amp; endpoint data.&n; *&n; * I considered using /proc/bus/usb/devices/device# for each device&n; * as it is attached or detached, but I didn&squot;t like this for some&n; * reason -- maybe it&squot;s just too deep of a directory structure.&n; * I also don&squot;t like looking in multiple places to gather and view&n; * the data.  Having only one file for ./devices also prevents race&n; * conditions that could arise if a program was reading device info&n; * for devices that are being removed (unplugged).  (That is, the&n; * program may find a directory for devnum_12 then try to open it,&n; * but it was just unplugged, so the directory is now deleted.&n; * But programs would just have to be prepared for situations like&n; * this in any plug-and-play environment.)&n; *&n; * 1999-12-16: Thomas Sailer &lt;sailer@ife.ee.ethz.ch&gt;&n; *   Converted the whole proc stuff to real&n; *   read methods. Now not the whole device list needs to fit&n; *   into one page, only the device list for one bus.&n; *   Added a poll method to /proc/bus/usb/devices, to wake&n; *   up an eventual usbd&n; *&n; * $Id: proc_usb.c,v 1.14 1999/12/17 10:51:41 fliegl Exp $&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &quot;usb.h&quot;
DECL|macro|MAX_TOPO_LEVEL
mdefine_line|#define MAX_TOPO_LEVEL&t;&t;6
multiline_comment|/* Define ALLOW_SERIAL_NUMBER if you want to see the serial number of devices */
DECL|macro|ALLOW_SERIAL_NUMBER
mdefine_line|#define ALLOW_SERIAL_NUMBER
DECL|variable|format_topo
r_static
r_char
op_star
id|format_topo
op_assign
multiline_comment|/* T:  Lev=dd Prnt=dd Port=dd Cnt=dd Dev#=ddd Spd=ddd MxCh=dd */
l_string|&quot;T:  Lev=%2.2d Prnt=%2.2d Port=%2.2d Cnt=%2.2d Dev#=%3d Spd=%3s MxCh=%2d&bslash;n&quot;
suffix:semicolon
DECL|variable|format_string_manufacturer
r_static
r_char
op_star
id|format_string_manufacturer
op_assign
multiline_comment|/* S:  Manufacturer=xxxx */
l_string|&quot;S:  Manufacturer=%s&bslash;n&quot;
suffix:semicolon
DECL|variable|format_string_product
r_static
r_char
op_star
id|format_string_product
op_assign
multiline_comment|/* S:  Product=xxxx */
l_string|&quot;S:  Product=%s&bslash;n&quot;
suffix:semicolon
macro_line|#ifdef ALLOW_SERIAL_NUMBER
DECL|variable|format_string_serialnumber
r_static
r_char
op_star
id|format_string_serialnumber
op_assign
multiline_comment|/* S:  SerialNumber=xxxx */
l_string|&quot;S:  SerialNumber=%s&bslash;n&quot;
suffix:semicolon
macro_line|#endif
DECL|variable|format_bandwidth
r_static
r_char
op_star
id|format_bandwidth
op_assign
multiline_comment|/* B:  Alloc=ddd/ddd us (xx%), #Int=ddd, #Iso=ddd */
l_string|&quot;B:  Alloc=%3d/%3d us (%2d%%), #Int=%3d, #Iso=%3d&bslash;n&quot;
suffix:semicolon
DECL|variable|format_device1
r_static
r_char
op_star
id|format_device1
op_assign
multiline_comment|/* D:  Ver=xx.xx Cls=xx(sssss) Sub=xx Prot=xx MxPS=dd #Cfgs=dd */
l_string|&quot;D:  Ver=%2x.%02x Cls=%02x(%-5s) Sub=%02x Prot=%02x MxPS=%2d #Cfgs=%3d&bslash;n&quot;
suffix:semicolon
DECL|variable|format_device2
r_static
r_char
op_star
id|format_device2
op_assign
multiline_comment|/* P:  Vendor=xxxx ProdID=xxxx Rev=xx.xx */
l_string|&quot;P:  Vendor=%04x ProdID=%04x Rev=%2x.%02x&bslash;n&quot;
suffix:semicolon
DECL|variable|format_config
r_static
r_char
op_star
id|format_config
op_assign
multiline_comment|/* C:  #Ifs=dd Cfg#=dd Atr=xx MPwr=dddmA */
l_string|&quot;C:%c #Ifs=%2d Cfg#=%2d Atr=%02x MxPwr=%3dmA&bslash;n&quot;
suffix:semicolon
DECL|variable|format_iface
r_static
r_char
op_star
id|format_iface
op_assign
multiline_comment|/* I:  If#=dd Alt=dd #EPs=dd Cls=xx(sssss) Sub=xx Prot=xx Driver=xxxx*/
l_string|&quot;I:  If#=%2d Alt=%2d #EPs=%2d Cls=%02x(%-5s) Sub=%02x Prot=%02x Driver=%s&bslash;n&quot;
suffix:semicolon
DECL|variable|format_endpt
r_static
r_char
op_star
id|format_endpt
op_assign
multiline_comment|/* E:  Ad=xx(s) Atr=xx(ssss) MxPS=dddd Ivl=dddms */
l_string|&quot;E:  Ad=%02x(%c) Atr=%02x(%-4s) MxPS=%4d Ivl=%3dms&bslash;n&quot;
suffix:semicolon
multiline_comment|/*&n; * Need access to the driver and USB bus lists.&n; * extern struct list_head usb_driver_list;&n; * extern struct list_head usb_bus_list;&n; * However, these will come from functions that return ptrs to each of them.&n; */
r_extern
r_struct
id|list_head
op_star
id|usb_driver_get_list
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|list_head
op_star
id|usb_bus_get_list
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|proc_dir_entry
op_star
id|proc_bus
suffix:semicolon
DECL|variable|usbdir
DECL|variable|driversdir
r_static
r_struct
id|proc_dir_entry
op_star
id|usbdir
op_assign
l_int|NULL
comma
op_star
id|driversdir
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|devicesdir
r_static
r_struct
id|proc_dir_entry
op_star
id|devicesdir
op_assign
l_int|NULL
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|deviceconndiscwq
)paren
suffix:semicolon
DECL|variable|conndiscevcnt
r_static
r_int
r_int
id|conndiscevcnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* this struct stores the poll state for /proc/bus/usb/devices pollers */
DECL|struct|usb_device_status
r_struct
id|usb_device_status
(brace
DECL|member|lastev
r_int
r_int
id|lastev
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|class_info
r_struct
id|class_info
(brace
DECL|member|class
r_int
r_class
suffix:semicolon
DECL|member|class_name
r_char
op_star
id|class_name
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|clas_info
r_static
r_const
r_struct
id|class_info
id|clas_info
(braket
)braket
op_assign
(brace
multiline_comment|/* max. 5 chars. per name string */
(brace
id|USB_CLASS_PER_INTERFACE
comma
l_string|&quot;&gt;ifc&quot;
)brace
comma
(brace
id|USB_CLASS_AUDIO
comma
l_string|&quot;audio&quot;
)brace
comma
(brace
id|USB_CLASS_COMM
comma
l_string|&quot;comm.&quot;
)brace
comma
(brace
id|USB_CLASS_HID
comma
l_string|&quot;HID&quot;
)brace
comma
(brace
id|USB_CLASS_HUB
comma
l_string|&quot;hub&quot;
)brace
comma
(brace
id|USB_CLASS_PRINTER
comma
l_string|&quot;print&quot;
)brace
comma
(brace
id|USB_CLASS_MASS_STORAGE
comma
l_string|&quot;stor.&quot;
)brace
comma
(brace
id|USB_CLASS_DATA
comma
l_string|&quot;data&quot;
)brace
comma
(brace
id|USB_CLASS_VENDOR_SPEC
comma
l_string|&quot;vend.&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_string|&quot;unk.&quot;
)brace
multiline_comment|/* leave as last */
)brace
suffix:semicolon
multiline_comment|/*****************************************************************/
DECL|function|conndiscevent
r_extern
r_inline
r_void
id|conndiscevent
c_func
(paren
r_void
)paren
(brace
id|wake_up
c_func
(paren
op_amp
id|deviceconndiscwq
)paren
suffix:semicolon
id|conndiscevcnt
op_increment
suffix:semicolon
)brace
DECL|function|class_decode
r_static
r_const
r_char
op_star
id|class_decode
c_func
(paren
r_const
r_int
r_class
)paren
(brace
r_int
id|ix
suffix:semicolon
r_for
c_loop
(paren
id|ix
op_assign
l_int|0
suffix:semicolon
id|clas_info
(braket
id|ix
)braket
dot
r_class
op_ne
op_minus
l_int|1
suffix:semicolon
id|ix
op_increment
)paren
r_if
c_cond
(paren
id|clas_info
(braket
id|ix
)braket
dot
r_class
op_eq
r_class
)paren
r_break
suffix:semicolon
r_return
(paren
id|clas_info
(braket
id|ix
)braket
dot
id|class_name
)paren
suffix:semicolon
)brace
DECL|function|usb_dump_endpoint_descriptor
r_static
r_char
op_star
id|usb_dump_endpoint_descriptor
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_endpoint_descriptor
op_star
id|desc
)paren
(brace
r_char
op_star
id|EndpointType
(braket
l_int|4
)braket
op_assign
(brace
l_string|&quot;Ctrl&quot;
comma
l_string|&quot;Isoc&quot;
comma
l_string|&quot;Bulk&quot;
comma
l_string|&quot;Int.&quot;
)brace
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
id|format_endpt
comma
id|desc-&gt;bEndpointAddress
comma
(paren
id|desc-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
ques
c_cond
l_char|&squot;I&squot;
suffix:colon
l_char|&squot;O&squot;
comma
id|desc-&gt;bmAttributes
comma
id|EndpointType
(braket
id|desc-&gt;bmAttributes
op_amp
l_int|3
)braket
comma
id|desc-&gt;wMaxPacketSize
comma
id|desc-&gt;bInterval
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_dump_endpoint
r_static
r_char
op_star
id|usb_dump_endpoint
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint
)paren
(brace
r_return
id|usb_dump_endpoint_descriptor
c_func
(paren
id|start
comma
id|end
comma
id|endpoint
)paren
suffix:semicolon
)brace
DECL|function|usb_dump_interface_descriptor
r_static
r_char
op_star
id|usb_dump_interface_descriptor
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_interface
op_star
id|iface
comma
r_int
id|setno
)paren
(brace
r_struct
id|usb_interface_descriptor
op_star
id|desc
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|setno
)braket
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
id|format_iface
comma
id|desc-&gt;bInterfaceNumber
comma
id|desc-&gt;bAlternateSetting
comma
id|desc-&gt;bNumEndpoints
comma
id|desc-&gt;bInterfaceClass
comma
id|class_decode
c_func
(paren
id|desc-&gt;bInterfaceClass
)paren
comma
id|desc-&gt;bInterfaceSubClass
comma
id|desc-&gt;bInterfaceProtocol
comma
id|iface-&gt;driver
ques
c_cond
id|iface-&gt;driver-&gt;name
suffix:colon
l_string|&quot;(none)&quot;
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_dump_interface
r_static
r_char
op_star
id|usb_dump_interface
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_interface
op_star
id|iface
comma
r_int
id|setno
)paren
(brace
r_struct
id|usb_interface_descriptor
op_star
id|desc
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|setno
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|start
op_assign
id|usb_dump_interface_descriptor
c_func
(paren
id|start
comma
id|end
comma
id|iface
comma
id|setno
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|desc-&gt;bNumEndpoints
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|usb_dump_endpoint
c_func
(paren
id|start
comma
id|end
comma
id|desc-&gt;endpoint
op_plus
id|i
)paren
suffix:semicolon
)brace
r_return
id|start
suffix:semicolon
)brace
multiline_comment|/* TBD:&n; * 0. TBDs&n; * 1. marking active config and ifaces (code lists all, but should mark&n; *    which ones are active, if any)&n; * 2. add &lt;halted&gt; status to each endpoint line&n; */
DECL|function|usb_dump_config_descriptor
r_static
r_char
op_star
id|usb_dump_config_descriptor
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_config_descriptor
op_star
id|desc
comma
r_const
r_int
id|active
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
id|format_config
comma
id|active
ques
c_cond
l_char|&squot;*&squot;
suffix:colon
l_char|&squot; &squot;
comma
multiline_comment|/* mark active/actual/current cfg. */
id|desc-&gt;bNumInterfaces
comma
id|desc-&gt;bConfigurationValue
comma
id|desc-&gt;bmAttributes
comma
id|desc-&gt;MaxPower
op_star
l_int|2
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_dump_config
r_static
r_char
op_star
id|usb_dump_config
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_config_descriptor
op_star
id|config
comma
r_const
r_int
id|active
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|usb_interface
op_star
id|interface
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
multiline_comment|/* getting these some in 2.3.7; none in 2.3.6 */
r_return
id|start
op_plus
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;(null Cfg. desc.)&bslash;n&quot;
)paren
suffix:semicolon
id|start
op_assign
id|usb_dump_config_descriptor
c_func
(paren
id|start
comma
id|end
comma
id|config
comma
id|active
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|config-&gt;bNumInterfaces
suffix:semicolon
id|i
op_increment
)paren
(brace
id|interface
op_assign
id|config-&gt;interface
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|interface
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|interface-&gt;num_altsetting
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|usb_dump_interface
c_func
(paren
id|start
comma
id|end
comma
id|interface
comma
id|j
)paren
suffix:semicolon
)brace
)brace
r_return
id|start
suffix:semicolon
)brace
multiline_comment|/*&n; * Dump the different USB descriptors.&n; */
DECL|function|usb_dump_device_descriptor
r_static
r_char
op_star
id|usb_dump_device_descriptor
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_device_descriptor
op_star
id|desc
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
(paren
id|start
comma
id|format_device1
comma
id|desc-&gt;bcdUSB
op_rshift
l_int|8
comma
id|desc-&gt;bcdUSB
op_amp
l_int|0xff
comma
id|desc-&gt;bDeviceClass
comma
id|class_decode
(paren
id|desc-&gt;bDeviceClass
)paren
comma
id|desc-&gt;bDeviceSubClass
comma
id|desc-&gt;bDeviceProtocol
comma
id|desc-&gt;bMaxPacketSize0
comma
id|desc-&gt;bNumConfigurations
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
id|format_device2
comma
id|desc-&gt;idVendor
comma
id|desc-&gt;idProduct
comma
id|desc-&gt;bcdDevice
op_rshift
l_int|8
comma
id|desc-&gt;bcdDevice
op_amp
l_int|0xff
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
multiline_comment|/*&n; * Dump the different strings that this device holds.&n; */
DECL|function|usb_dump_device_strings
r_static
r_char
op_star
id|usb_dump_device_strings
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;descriptor.iManufacturer
)paren
(brace
r_char
op_star
id|string
op_assign
id|usb_string
(paren
(paren
r_struct
id|usb_device
op_star
)paren
id|dev
comma
id|dev-&gt;descriptor.iManufacturer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|string
)paren
(brace
id|start
op_add_assign
id|sprintf
(paren
id|start
comma
id|format_string_manufacturer
comma
id|string
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;descriptor.iProduct
)paren
(brace
r_char
op_star
id|string
op_assign
id|usb_string
(paren
(paren
r_struct
id|usb_device
op_star
)paren
id|dev
comma
id|dev-&gt;descriptor.iProduct
)paren
suffix:semicolon
r_if
c_cond
(paren
id|string
)paren
(brace
id|start
op_add_assign
id|sprintf
(paren
id|start
comma
id|format_string_product
comma
id|string
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
)brace
)brace
macro_line|#ifdef ALLOW_SERIAL_NUMBER
r_if
c_cond
(paren
id|dev-&gt;descriptor.iSerialNumber
)paren
(brace
r_char
op_star
id|string
op_assign
id|usb_string
(paren
(paren
r_struct
id|usb_device
op_star
)paren
id|dev
comma
id|dev-&gt;descriptor.iSerialNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|string
)paren
(brace
id|start
op_add_assign
id|sprintf
(paren
id|start
comma
id|format_string_serialnumber
comma
id|string
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_dump_desc
r_static
r_char
op_star
id|usb_dump_desc
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|usb_dump_device_descriptor
c_func
(paren
id|start
comma
id|end
comma
op_amp
id|dev-&gt;descriptor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|usb_dump_device_strings
(paren
id|start
comma
id|end
comma
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;descriptor.bNumConfigurations
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|usb_dump_config
c_func
(paren
id|start
comma
id|end
comma
id|dev-&gt;config
op_plus
id|i
comma
(paren
id|dev-&gt;config
op_plus
id|i
)paren
op_eq
id|dev-&gt;actconfig
)paren
suffix:semicolon
multiline_comment|/* active ? */
)brace
r_return
id|start
suffix:semicolon
)brace
macro_line|#ifdef PROC_EXTRA /* TBD: may want to add this code later */
DECL|function|usb_dump_hub_descriptor
r_static
r_char
op_star
id|usb_dump_hub_descriptor
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_hub_descriptor
op_star
id|desc
)paren
(brace
r_int
id|leng
op_assign
id|USB_DT_HUB_NONVAR_SIZE
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
id|desc
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;Interface:&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|leng
)paren
(brace
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot; %02x&quot;
comma
op_star
id|ptr
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
id|leng
op_decrement
suffix:semicolon
)brace
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_dump_string
r_static
r_char
op_star
id|usb_dump_string
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_device
op_star
id|dev
comma
r_char
op_star
id|id
comma
r_int
id|index
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;Interface:&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_le
id|dev-&gt;maxstring
op_logical_and
id|dev-&gt;stringindex
op_logical_and
id|dev-&gt;stringindex
(braket
id|index
)braket
)paren
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;%s: %s &quot;
comma
id|id
comma
id|dev-&gt;stringindex
(braket
id|index
)braket
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
macro_line|#endif /* PROC_EXTRA */
multiline_comment|/*****************************************************************/
DECL|function|usb_device_dump
r_static
r_char
op_star
id|usb_device_dump
c_func
(paren
r_char
op_star
id|start
comma
r_char
op_star
id|end
comma
r_const
r_struct
id|usb_device
op_star
id|usbdev
comma
r_int
id|level
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
r_int
id|chix
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_int
id|parent_devnum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
id|MAX_TOPO_LEVEL
)paren
r_return
id|start
suffix:semicolon
r_if
c_cond
(paren
id|usbdev-&gt;parent
op_logical_and
id|usbdev-&gt;parent-&gt;devnum
op_ne
op_minus
l_int|1
)paren
id|parent_devnum
op_assign
id|usbdev-&gt;parent-&gt;devnum
suffix:semicolon
multiline_comment|/*&n;&t; * So the root hub&squot;s parent is 0 and any device that is&n;&t; * plugged into the root hub has a parent of 0.&n;&t; */
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
id|format_topo
comma
id|level
comma
id|parent_devnum
comma
id|index
comma
id|count
comma
id|usbdev-&gt;devnum
comma
id|usbdev-&gt;slow
ques
c_cond
l_string|&quot;1.5&quot;
suffix:colon
l_string|&quot;12 &quot;
comma
id|usbdev-&gt;maxchild
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * level = topology-tier level;&n;&t; * parent_devnum = parent device number;&n;&t; * index = parent&squot;s connector number;&n;&t; * count = device count at this level&n;&t; */
multiline_comment|/* do not dump descriptors for root hub */
r_if
c_cond
(paren
id|usbdev-&gt;devnum
op_ge
l_int|0
)paren
id|start
op_assign
id|usb_dump_desc
c_func
(paren
id|start
comma
id|end
comma
id|usbdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
op_plus
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;(truncated)&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Now look at all of this device&squot;s children. */
r_for
c_loop
(paren
id|chix
op_assign
l_int|0
suffix:semicolon
id|chix
OL
id|usbdev-&gt;maxchild
suffix:semicolon
id|chix
op_increment
)paren
(brace
r_if
c_cond
(paren
id|start
OG
id|end
)paren
r_return
id|start
suffix:semicolon
r_if
c_cond
(paren
id|usbdev-&gt;children
(braket
id|chix
)braket
)paren
id|start
op_assign
id|usb_device_dump
c_func
(paren
id|start
comma
id|end
comma
id|usbdev-&gt;children
(braket
id|chix
)braket
comma
id|level
op_plus
l_int|1
comma
id|chix
comma
op_increment
id|cnt
)paren
suffix:semicolon
)brace
r_return
id|start
suffix:semicolon
)brace
DECL|function|usb_device_read
r_static
id|ssize_t
id|usb_device_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|nbytes
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|list_head
op_star
id|usb_bus_list
comma
op_star
id|buslist
suffix:semicolon
r_struct
id|usb_bus
op_star
id|bus
suffix:semicolon
r_char
op_star
id|page
comma
op_star
id|end
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|pos
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|ppos
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|nbytes
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buf
comma
id|nbytes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pos
op_assign
op_star
id|ppos
suffix:semicolon
id|usb_bus_list
op_assign
id|usb_bus_get_list
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* enumerate busses */
r_for
c_loop
(paren
id|buslist
op_assign
id|usb_bus_list-&gt;next
suffix:semicolon
id|buslist
op_ne
id|usb_bus_list
suffix:semicolon
id|buslist
op_assign
id|buslist-&gt;next
)paren
(brace
multiline_comment|/* print bandwidth allocation */
id|bus
op_assign
id|list_entry
c_func
(paren
id|buslist
comma
r_struct
id|usb_bus
comma
id|bus_list
)paren
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
id|format_bandwidth
comma
id|bus-&gt;bandwidth_allocated
comma
id|FRAME_TIME_MAX_USECS_ALLOC
comma
(paren
l_int|100
op_star
id|bus-&gt;bandwidth_allocated
op_plus
id|FRAME_TIME_MAX_USECS_ALLOC
op_div
l_int|2
)paren
op_div
id|FRAME_TIME_MAX_USECS_ALLOC
comma
id|bus-&gt;bandwidth_int_reqs
comma
id|bus-&gt;bandwidth_isoc_reqs
)paren
suffix:semicolon
id|end
op_assign
id|usb_device_dump
c_func
(paren
id|page
op_plus
id|len
comma
id|page
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|100
)paren
comma
id|bus-&gt;root_hub
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|len
op_assign
id|end
op_minus
id|page
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|pos
)paren
(brace
id|len
op_sub_assign
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|nbytes
)paren
id|len
op_assign
id|nbytes
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|page
op_plus
id|pos
comma
id|len
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|nbytes
op_sub_assign
id|len
suffix:semicolon
id|buf
op_add_assign
id|len
suffix:semicolon
id|ret
op_add_assign
id|len
suffix:semicolon
id|pos
op_assign
l_int|0
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
)brace
r_else
id|pos
op_sub_assign
id|len
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|usb_device_poll
r_static
r_int
r_int
id|usb_device_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|usb_device_status
op_star
id|st
op_assign
(paren
r_struct
id|usb_device_status
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|st
)paren
(brace
id|st
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|usb_device_status
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|st
)paren
r_return
id|POLLIN
suffix:semicolon
multiline_comment|/*&n;&t;&t; * need to prevent the module from being unloaded, since&n;&t;&t; * proc_unregister does not call the release method and&n;&t;&t; * we would have a memory leak&n;&t;&t; */
id|st-&gt;lastev
op_assign
id|conndiscevcnt
suffix:semicolon
id|file-&gt;private_data
op_assign
id|st
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|mask
op_assign
id|POLLIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|deviceconndiscwq
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;lastev
op_ne
id|conndiscevcnt
)paren
id|mask
op_or_assign
id|POLLIN
suffix:semicolon
id|st-&gt;lastev
op_assign
id|conndiscevcnt
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|usb_device_open
r_static
r_int
id|usb_device_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_device_release
r_static
r_int
id|usb_device_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
(brace
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Dump usb_driver_list.&n; *&n; * We now walk the list of registered USB drivers.&n; */
DECL|function|usb_driver_read
r_static
id|ssize_t
id|usb_driver_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|nbytes
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|list_head
op_star
id|usb_driver_list
op_assign
id|usb_driver_get_list
c_func
(paren
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
op_assign
id|usb_driver_list-&gt;next
suffix:semicolon
r_char
op_star
id|page
comma
op_star
id|start
comma
op_star
id|end
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|pos
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|ppos
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|nbytes
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buf
comma
id|nbytes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|start
op_assign
id|page
suffix:semicolon
id|end
op_assign
id|page
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|100
)paren
suffix:semicolon
id|pos
op_assign
op_star
id|ppos
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|tmp
op_ne
id|usb_driver_list
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
)paren
(brace
r_struct
id|usb_driver
op_star
id|driver
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|usb_driver
comma
id|driver_list
)paren
suffix:semicolon
id|start
op_add_assign
id|sprintf
(paren
id|start
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|end
)paren
(brace
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;(truncated)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|start
op_eq
id|page
)paren
id|start
op_add_assign
id|sprintf
c_func
(paren
id|start
comma
l_string|&quot;(none)&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_assign
id|start
op_minus
id|page
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|pos
)paren
(brace
id|len
op_sub_assign
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|nbytes
)paren
id|len
op_assign
id|nbytes
suffix:semicolon
id|ret
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|page
op_plus
id|pos
comma
id|len
)paren
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
r_int
id|usbdev_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|offset
comma
r_int
id|orig
)paren
suffix:semicolon
DECL|variable|proc_usb_devlist_file_operations
r_static
r_struct
id|file_operations
id|proc_usb_devlist_file_operations
op_assign
(brace
id|usbdev_lseek
comma
multiline_comment|/* lseek   */
id|usb_device_read
comma
multiline_comment|/* read    */
l_int|NULL
comma
multiline_comment|/* write   */
l_int|NULL
comma
multiline_comment|/* readdir */
id|usb_device_poll
comma
multiline_comment|/* poll    */
l_int|NULL
comma
multiline_comment|/* ioctl   */
l_int|NULL
comma
multiline_comment|/* mmap    */
id|usb_device_open
comma
multiline_comment|/* open    */
l_int|NULL
comma
multiline_comment|/* flush   */
id|usb_device_release
comma
multiline_comment|/* release */
l_int|NULL
multiline_comment|/* fsync   */
)brace
suffix:semicolon
DECL|variable|proc_usb_devlist_inode_operations
r_static
r_struct
id|inode_operations
id|proc_usb_devlist_inode_operations
op_assign
(brace
op_amp
id|proc_usb_devlist_file_operations
comma
multiline_comment|/* file-ops */
)brace
suffix:semicolon
DECL|variable|proc_usb_drvlist_file_operations
r_static
r_struct
id|file_operations
id|proc_usb_drvlist_file_operations
op_assign
(brace
id|usbdev_lseek
comma
multiline_comment|/* lseek   */
id|usb_driver_read
comma
multiline_comment|/* read    */
l_int|NULL
comma
multiline_comment|/* write   */
l_int|NULL
comma
multiline_comment|/* readdir */
l_int|NULL
comma
multiline_comment|/* poll    */
l_int|NULL
comma
multiline_comment|/* ioctl   */
l_int|NULL
comma
multiline_comment|/* mmap    */
l_int|NULL
comma
multiline_comment|/* no special open code    */
l_int|NULL
comma
multiline_comment|/* flush */
l_int|NULL
comma
multiline_comment|/* no special release code */
l_int|NULL
multiline_comment|/* can&squot;t fsync */
)brace
suffix:semicolon
DECL|variable|proc_usb_drvlist_inode_operations
r_static
r_struct
id|inode_operations
id|proc_usb_drvlist_inode_operations
op_assign
(brace
op_amp
id|proc_usb_drvlist_file_operations
comma
multiline_comment|/* file-ops */
)brace
suffix:semicolon
multiline_comment|/*&n; * proc entry for every device&n; */
DECL|function|usbdev_lseek
r_static
r_int
r_int
id|usbdev_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|offset
comma
r_int
id|orig
)paren
(brace
r_switch
c_cond
(paren
id|orig
)paren
(brace
r_case
l_int|0
suffix:colon
id|file-&gt;f_pos
op_assign
id|offset
suffix:semicolon
r_return
id|file-&gt;f_pos
suffix:semicolon
r_case
l_int|1
suffix:colon
id|file-&gt;f_pos
op_add_assign
id|offset
suffix:semicolon
r_return
id|file-&gt;f_pos
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|usbdev_read
r_static
id|ssize_t
id|usbdev_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|nbytes
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|usb_device
op_star
id|dev
op_assign
(paren
r_struct
id|usb_device
op_star
)paren
id|dp-&gt;data
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|ppos
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_star
id|ppos
OL
r_sizeof
(paren
r_struct
id|usb_device_descriptor
)paren
)paren
(brace
id|len
op_assign
r_sizeof
(paren
r_struct
id|usb_device_descriptor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|nbytes
)paren
id|len
op_assign
id|nbytes
suffix:semicolon
id|copy_to_user_ret
c_func
(paren
id|buf
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|dev-&gt;descriptor
)paren
op_plus
op_star
id|ppos
comma
id|len
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
id|buf
op_add_assign
id|len
suffix:semicolon
id|nbytes
op_sub_assign
id|len
suffix:semicolon
id|ret
op_add_assign
id|len
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* note: this is a compatibility kludge that will vanish soon. */
macro_line|#include &quot;ezusb.h&quot;
DECL|function|usbdev_ioctl_ezusbcompat
r_static
r_int
id|usbdev_ioctl_ezusbcompat
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_static
r_int
id|obsolete_warn
op_assign
l_int|0
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|usb_device
op_star
id|dev
op_assign
(paren
r_struct
id|usb_device
op_star
)paren
id|dp-&gt;data
suffix:semicolon
r_struct
id|ezusb_ctrltransfer
id|ctrl
suffix:semicolon
r_struct
id|ezusb_bulktransfer
id|bulk
suffix:semicolon
r_struct
id|ezusb_old_ctrltransfer
id|octrl
suffix:semicolon
r_struct
id|ezusb_old_bulktransfer
id|obulk
suffix:semicolon
r_struct
id|ezusb_setinterface
id|setintf
suffix:semicolon
r_int
r_int
id|len1
comma
id|ep
comma
id|pipe
comma
id|cfg
suffix:semicolon
r_int
r_int
id|len2
suffix:semicolon
r_int
r_char
op_star
id|tbuf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|EZUSB_CONTROL
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_CONTROL ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|ctrl
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ctrl
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl.length
OG
id|PAGE_SIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|ctrl.requesttype
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|ctrl.length
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|ctrl.data
comma
id|ctrl.length
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|ctrl.request
comma
id|ctrl.requesttype
comma
id|ctrl.value
comma
id|ctrl.index
comma
id|tbuf
comma
id|ctrl.length
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|ctrl.length
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|ctrl.data
comma
id|tbuf
comma
id|ctrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ctrl.length
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|ctrl.data
comma
id|ctrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|ctrl.request
comma
id|ctrl.requesttype
comma
id|ctrl.value
comma
id|ctrl.index
comma
id|tbuf
comma
id|ctrl.length
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;procusb: EZUSB_CONTROL failed rqt %u rq %u len %u ret %d&bslash;n&quot;
comma
id|ctrl.requesttype
comma
id|ctrl.request
comma
id|ctrl.length
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
r_case
id|EZUSB_BULK
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_BULK ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|bulk
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bulk
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|dev
comma
id|bulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|dev
comma
id|bulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
op_logical_neg
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len1
op_assign
id|bulk.len
suffix:semicolon
r_if
c_cond
(paren
id|len1
OG
id|PAGE_SIZE
)paren
id|len1
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|len1
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|bulk.data
comma
id|len1
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|len2
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|bulk.data
comma
id|tbuf
comma
id|len2
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|len1
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|bulk.data
comma
id|len1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;procusb: EZUSB_BULK failed ep 0x%x len %u ret %d&bslash;n&quot;
comma
id|bulk.ep
comma
id|bulk.len
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
id|len2
suffix:semicolon
r_case
id|EZUSB_OLD_CONTROL
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_OLD_CONTROL ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|octrl
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|octrl
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octrl.dlen
OG
id|PAGE_SIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|octrl.requesttype
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|octrl.dlen
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|octrl.data
comma
id|octrl.dlen
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_internal_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
(paren
id|devrequest
op_star
)paren
op_amp
id|octrl
comma
id|tbuf
comma
id|octrl.dlen
comma
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|octrl.dlen
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|octrl.data
comma
id|tbuf
comma
id|octrl.dlen
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|octrl.dlen
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|octrl.data
comma
id|octrl.dlen
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_internal_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
(paren
id|devrequest
op_star
)paren
op_amp
id|octrl
comma
id|tbuf
comma
id|octrl.dlen
comma
id|HZ
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;procusb: EZUSB_OLD_CONTROL failed rqt %u rq %u len %u ret %d&bslash;n&quot;
comma
id|octrl.requesttype
comma
id|octrl.request
comma
id|octrl.length
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
r_case
id|EZUSB_OLD_BULK
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_OLD_BULK ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|obulk
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|obulk
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|dev
comma
id|obulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|dev
comma
id|obulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
op_logical_neg
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len1
op_assign
id|obulk.len
suffix:semicolon
r_if
c_cond
(paren
id|len1
OG
id|PAGE_SIZE
)paren
id|len1
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|len1
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|obulk.data
comma
id|len1
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
id|HZ
op_star
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|len2
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|obulk.data
comma
id|tbuf
comma
id|len2
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|len1
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|obulk.data
comma
id|len1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
id|HZ
op_star
l_int|5
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;procusb: EZUSB_OLD_BULK failed ep 0x%x len %u ret %d&bslash;n&quot;
comma
id|obulk.ep
comma
id|obulk.len
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
id|len2
suffix:semicolon
r_case
id|EZUSB_RESETEP
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_RESETEP ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|get_user_ret
c_func
(paren
id|ep
comma
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ep
op_amp
op_complement
l_int|0x80
)paren
op_ge
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|usb_settoggle
c_func
(paren
id|dev
comma
id|ep
op_amp
l_int|0xf
comma
op_logical_neg
(paren
id|ep
op_amp
l_int|0x80
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EZUSB_SETINTERFACE
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_SETINTERFACE ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|setintf
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|setintf
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|dev
comma
id|setintf.interface
comma
id|setintf.altsetting
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EZUSB_SETCONFIGURATION
suffix:colon
r_if
c_cond
(paren
id|obsolete_warn
OL
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: process %d (%s) used obsolete EZUSB_SETCONFIGURATION ioctl&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|obsolete_warn
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|get_user_ret
c_func
(paren
id|cfg
comma
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_configuration
c_func
(paren
id|dev
comma
id|cfg
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|function|usbdev_ioctl
r_static
r_int
id|usbdev_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|usb_device
op_star
id|dev
op_assign
(paren
r_struct
id|usb_device
op_star
)paren
id|dp-&gt;data
suffix:semicolon
r_struct
id|usb_proc_ctrltransfer
id|ctrl
suffix:semicolon
r_struct
id|usb_proc_bulktransfer
id|bulk
suffix:semicolon
r_struct
id|usb_proc_old_ctrltransfer
id|octrl
suffix:semicolon
r_struct
id|usb_proc_old_bulktransfer
id|obulk
suffix:semicolon
r_struct
id|usb_proc_setinterface
id|setintf
suffix:semicolon
r_int
r_int
id|len1
comma
id|ep
comma
id|pipe
comma
id|cfg
suffix:semicolon
r_int
r_int
id|len2
suffix:semicolon
r_int
r_char
op_star
id|tbuf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|USB_PROC_CONTROL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|ctrl
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ctrl
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl.length
OG
id|PAGE_SIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|ctrl.requesttype
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|ctrl.length
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|ctrl.data
comma
id|ctrl.length
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|ctrl.request
comma
id|ctrl.requesttype
comma
id|ctrl.value
comma
id|ctrl.index
comma
id|tbuf
comma
id|ctrl.length
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|ctrl.length
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|ctrl.data
comma
id|tbuf
comma
id|ctrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ctrl.length
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|ctrl.data
comma
id|ctrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|ctrl.request
comma
id|ctrl.requesttype
comma
id|ctrl.value
comma
id|ctrl.index
comma
id|tbuf
comma
id|ctrl.length
comma
(paren
id|ctrl.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: USB_PROC_CONTROL failed rqt %u rq %u len %u ret %d&bslash;n&quot;
comma
id|ctrl.requesttype
comma
id|ctrl.request
comma
id|ctrl.length
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|USB_PROC_BULK
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|bulk
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bulk
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|dev
comma
id|bulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|dev
comma
id|bulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
op_logical_neg
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len1
op_assign
id|bulk.len
suffix:semicolon
r_if
c_cond
(paren
id|len1
OG
id|PAGE_SIZE
)paren
id|len1
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|bulk.ep
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|len1
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|bulk.data
comma
id|len1
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
(paren
id|bulk.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_and
id|len2
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|bulk.data
comma
id|tbuf
comma
id|len2
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|len1
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|bulk.data
comma
id|len1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
(paren
id|bulk.timeout
op_star
id|HZ
op_plus
l_int|500
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: USB_PROC_BULK failed ep 0x%x len %u ret %d&bslash;n&quot;
comma
id|bulk.ep
comma
id|bulk.len
comma
id|i
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_return
id|len2
suffix:semicolon
r_case
id|USB_PROC_OLD_CONTROL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|octrl
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|octrl
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octrl.length
OG
id|PAGE_SIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|octrl.requesttype
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|octrl.length
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|octrl.data
comma
id|octrl.length
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|octrl.request
comma
id|octrl.requesttype
comma
id|octrl.value
comma
id|octrl.index
comma
id|tbuf
comma
id|octrl.length
comma
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|octrl.length
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|octrl.data
comma
id|tbuf
comma
id|octrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|octrl.length
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|octrl.data
comma
id|octrl.length
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|octrl.request
comma
id|octrl.requesttype
comma
id|octrl.value
comma
id|octrl.index
comma
id|tbuf
comma
id|octrl.length
comma
id|HZ
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: USB_PROC_OLD_CONTROL failed rqt %u rq %u len %u ret %d&bslash;n&quot;
comma
id|octrl.requesttype
comma
id|octrl.request
comma
id|octrl.length
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|USB_PROC_OLD_BULK
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|obulk
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|obulk
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|dev
comma
id|obulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|dev
comma
id|obulk.ep
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
op_logical_neg
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len1
op_assign
id|obulk.len
suffix:semicolon
r_if
c_cond
(paren
id|len1
OG
id|PAGE_SIZE
)paren
id|len1
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|obulk.ep
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|len1
op_logical_and
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|obulk.data
comma
id|len1
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
id|HZ
op_star
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
OG
l_int|0
)paren
op_logical_and
id|len2
)paren
(brace
id|copy_to_user_ret
c_func
(paren
id|obulk.data
comma
id|tbuf
comma
id|len2
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|len1
)paren
(brace
id|copy_from_user_ret
c_func
(paren
id|tbuf
comma
id|obulk.data
comma
id|len1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|i
op_assign
id|usb_bulk_msg
c_func
(paren
id|dev
comma
id|pipe
comma
id|tbuf
comma
id|len1
comma
op_amp
id|len2
comma
id|HZ
op_star
l_int|5
)paren
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;/proc/bus/usb: USB_PROC_OLD_BULK failed ep 0x%x len %u ret %d&bslash;n&quot;
comma
id|obulk.ep
comma
id|obulk.len
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_return
id|len2
suffix:semicolon
r_case
id|USB_PROC_RESETEP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|get_user_ret
c_func
(paren
id|ep
comma
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ep
op_amp
op_complement
l_int|0x80
)paren
op_ge
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|usb_settoggle
c_func
(paren
id|dev
comma
id|ep
op_amp
l_int|0xf
comma
op_logical_neg
(paren
id|ep
op_amp
l_int|0x80
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|USB_PROC_SETINTERFACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|copy_from_user_ret
c_func
(paren
op_amp
id|setintf
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|setintf
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|dev
comma
id|setintf.interface
comma
id|setintf.altsetting
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|USB_PROC_SETCONFIGURATION
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|get_user_ret
c_func
(paren
id|cfg
comma
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_configuration
c_func
(paren
id|dev
comma
id|cfg
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EZUSB_CONTROL
suffix:colon
r_case
id|EZUSB_BULK
suffix:colon
r_case
id|EZUSB_OLD_CONTROL
suffix:colon
r_case
id|EZUSB_OLD_BULK
suffix:colon
r_case
id|EZUSB_RESETEP
suffix:colon
r_case
id|EZUSB_SETINTERFACE
suffix:colon
r_case
id|EZUSB_SETCONFIGURATION
suffix:colon
r_return
id|usbdev_ioctl_ezusbcompat
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|variable|proc_usb_device_file_operations
r_static
r_struct
id|file_operations
id|proc_usb_device_file_operations
op_assign
(brace
id|usbdev_lseek
comma
multiline_comment|/* lseek   */
id|usbdev_read
comma
multiline_comment|/* read    */
l_int|NULL
comma
multiline_comment|/* write   */
l_int|NULL
comma
multiline_comment|/* readdir */
l_int|NULL
comma
multiline_comment|/* poll    */
id|usbdev_ioctl
comma
multiline_comment|/* ioctl   */
l_int|NULL
comma
multiline_comment|/* mmap    */
l_int|NULL
comma
multiline_comment|/* no special open code    */
l_int|NULL
comma
multiline_comment|/* flush */
l_int|NULL
comma
multiline_comment|/* no special release code */
l_int|NULL
multiline_comment|/* can&squot;t fsync */
)brace
suffix:semicolon
DECL|variable|proc_usb_device_inode_operations
r_static
r_struct
id|inode_operations
id|proc_usb_device_inode_operations
op_assign
(brace
op_amp
id|proc_usb_device_file_operations
comma
multiline_comment|/* file-ops */
)brace
suffix:semicolon
DECL|function|proc_usb_add_bus
r_void
id|proc_usb_add_bus
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
)paren
(brace
r_char
id|buf
(braket
l_int|16
)braket
suffix:semicolon
id|bus-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usbdir
)paren
r_return
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%03d&quot;
comma
id|bus-&gt;busnum
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,31)
r_if
c_cond
(paren
op_logical_neg
(paren
id|bus-&gt;proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|buf
comma
id|S_IFDIR
comma
id|usbdir
)paren
)paren
)paren
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
(paren
id|bus-&gt;proc_entry
op_assign
id|proc_mkdir
c_func
(paren
id|buf
comma
id|usbdir
)paren
)paren
)paren
macro_line|#endif
r_return
suffix:semicolon
id|bus-&gt;proc_entry-&gt;data
op_assign
id|bus
suffix:semicolon
id|conndiscevent
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* devices need already be removed! */
DECL|function|proc_usb_remove_bus
r_void
id|proc_usb_remove_bus
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bus-&gt;proc_entry
)paren
r_return
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|bus-&gt;proc_entry-&gt;name
comma
id|usbdir
)paren
suffix:semicolon
id|conndiscevent
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|proc_usb_add_device
r_void
id|proc_usb_add_device
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_char
id|buf
(braket
l_int|16
)braket
suffix:semicolon
id|dev-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;bus-&gt;proc_entry
)paren
r_return
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%03d&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|buf
comma
l_int|0
comma
id|dev-&gt;bus-&gt;proc_entry
)paren
)paren
)paren
r_return
suffix:semicolon
id|dev-&gt;proc_entry-&gt;ops
op_assign
op_amp
id|proc_usb_device_inode_operations
suffix:semicolon
id|dev-&gt;proc_entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|conndiscevent
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|proc_usb_remove_device
r_void
id|proc_usb_remove_device
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;proc_entry
)paren
id|remove_proc_entry
c_func
(paren
id|dev-&gt;proc_entry-&gt;name
comma
id|dev-&gt;bus-&gt;proc_entry
)paren
suffix:semicolon
id|conndiscevent
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|proc_usb_cleanup
r_void
id|proc_usb_cleanup
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|driversdir
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;drivers&quot;
comma
id|usbdir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devicesdir
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;devices&quot;
comma
id|usbdir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usbdir
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;usb&quot;
comma
id|proc_bus
)paren
suffix:semicolon
)brace
DECL|function|proc_usb_init
r_int
id|proc_usb_init
(paren
r_void
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,31)
id|usbdir
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;usb&quot;
comma
id|S_IFDIR
comma
id|proc_bus
)paren
suffix:semicolon
macro_line|#else
id|usbdir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;usb&quot;
comma
id|proc_bus
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
op_logical_neg
id|usbdir
)paren
(brace
id|printk
(paren
l_string|&quot;proc_usb: cannot create /proc/bus/usb entry&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|driversdir
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;drivers&quot;
comma
l_int|0
comma
id|usbdir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driversdir
)paren
(brace
id|printk
(paren
l_string|&quot;proc_usb: cannot create /proc/bus/usb/drivers entry&bslash;n&quot;
)paren
suffix:semicolon
id|proc_usb_cleanup
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|driversdir-&gt;ops
op_assign
op_amp
id|proc_usb_drvlist_inode_operations
suffix:semicolon
id|devicesdir
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;devices&quot;
comma
l_int|0
comma
id|usbdir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devicesdir
)paren
(brace
id|printk
(paren
l_string|&quot;proc_usb: cannot create /proc/bus/usb/devices entry&bslash;n&quot;
)paren
suffix:semicolon
id|proc_usb_cleanup
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|devicesdir-&gt;ops
op_assign
op_amp
id|proc_usb_devlist_inode_operations
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* end proc_usb.c */
eof
