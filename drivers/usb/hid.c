multiline_comment|/*&n; * $Id: hid.c,v 1.16 2000/09/18 21:38:55 vojtech Exp $&n; *&n; *  Copyright (c) 1999 Andreas Gal&n; *  Copyright (c) 2000 Vojtech Pavlik&n; *&n; *  USB HID support for the Linux input drivers&n; *&n; *  Sponsored by SuSE&n; */
multiline_comment|/*&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or &n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; * &n; * Should you need to contact me, the author, you can do so either by&n; * e-mail - mail your message to &lt;vojtech@suse.cz&gt;, or by paper mail:&n; * Vojtech Pavlik, Ucitelska 1576, Prague 8, 182 00 Czech Republic&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
DECL|macro|DEBUG
macro_line|#undef DEBUG
DECL|macro|DEBUG_DATA
macro_line|#undef DEBUG_DATA
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
macro_line|#include &quot;hid.h&quot;
macro_line|#ifdef DEBUG
macro_line|#include &quot;hid-debug.h&quot;
macro_line|#else
DECL|macro|hid_dump_input
mdefine_line|#define hid_dump_input(a,b)&t;do { } while (0)
DECL|macro|hid_dump_device
mdefine_line|#define hid_dump_device(c)&t;do { } while (0)
macro_line|#endif
DECL|macro|unk
mdefine_line|#define unk&t;KEY_UNKNOWN
DECL|variable|hid_keyboard
r_static
r_int
r_char
id|hid_keyboard
(braket
l_int|256
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|30
comma
l_int|48
comma
l_int|46
comma
l_int|32
comma
l_int|18
comma
l_int|33
comma
l_int|34
comma
l_int|35
comma
l_int|23
comma
l_int|36
comma
l_int|37
comma
l_int|38
comma
l_int|50
comma
l_int|49
comma
l_int|24
comma
l_int|25
comma
l_int|16
comma
l_int|19
comma
l_int|31
comma
l_int|20
comma
l_int|22
comma
l_int|47
comma
l_int|17
comma
l_int|45
comma
l_int|21
comma
l_int|44
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|28
comma
l_int|1
comma
l_int|14
comma
l_int|15
comma
l_int|57
comma
l_int|12
comma
l_int|13
comma
l_int|26
comma
l_int|27
comma
l_int|43
comma
l_int|84
comma
l_int|39
comma
l_int|40
comma
l_int|41
comma
l_int|51
comma
l_int|52
comma
l_int|53
comma
l_int|58
comma
l_int|59
comma
l_int|60
comma
l_int|61
comma
l_int|62
comma
l_int|63
comma
l_int|64
comma
l_int|65
comma
l_int|66
comma
l_int|67
comma
l_int|68
comma
l_int|87
comma
l_int|88
comma
l_int|99
comma
l_int|70
comma
l_int|119
comma
l_int|110
comma
l_int|102
comma
l_int|104
comma
l_int|111
comma
l_int|107
comma
l_int|109
comma
l_int|106
comma
l_int|105
comma
l_int|108
comma
l_int|103
comma
l_int|69
comma
l_int|98
comma
l_int|55
comma
l_int|74
comma
l_int|78
comma
l_int|96
comma
l_int|79
comma
l_int|80
comma
l_int|81
comma
l_int|75
comma
l_int|76
comma
l_int|77
comma
l_int|71
comma
l_int|72
comma
l_int|73
comma
l_int|82
comma
l_int|83
comma
l_int|86
comma
l_int|127
comma
l_int|116
comma
l_int|117
comma
l_int|85
comma
l_int|89
comma
l_int|90
comma
l_int|91
comma
l_int|92
comma
l_int|93
comma
l_int|94
comma
l_int|95
comma
l_int|120
comma
l_int|121
comma
l_int|122
comma
l_int|123
comma
l_int|134
comma
l_int|138
comma
l_int|130
comma
l_int|132
comma
l_int|128
comma
l_int|129
comma
l_int|131
comma
l_int|137
comma
l_int|133
comma
l_int|135
comma
l_int|136
comma
l_int|113
comma
l_int|115
comma
l_int|114
comma
id|unk
comma
id|unk
comma
id|unk
comma
l_int|124
comma
id|unk
comma
l_int|181
comma
l_int|182
comma
l_int|183
comma
l_int|184
comma
l_int|185
comma
l_int|186
comma
l_int|187
comma
l_int|188
comma
l_int|189
comma
l_int|190
comma
l_int|191
comma
l_int|192
comma
l_int|193
comma
l_int|194
comma
l_int|195
comma
l_int|196
comma
l_int|197
comma
l_int|198
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
comma
l_int|29
comma
l_int|42
comma
l_int|56
comma
l_int|125
comma
l_int|97
comma
l_int|54
comma
l_int|100
comma
l_int|126
comma
l_int|164
comma
l_int|166
comma
l_int|165
comma
l_int|163
comma
l_int|161
comma
l_int|115
comma
l_int|114
comma
l_int|113
comma
l_int|150
comma
l_int|158
comma
l_int|159
comma
l_int|128
comma
l_int|136
comma
l_int|177
comma
l_int|178
comma
l_int|176
comma
l_int|142
comma
l_int|152
comma
l_int|173
comma
l_int|140
comma
id|unk
comma
id|unk
comma
id|unk
comma
id|unk
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|x
id|__s32
id|x
suffix:semicolon
DECL|member|y
id|__s32
id|y
suffix:semicolon
DECL|variable|hid_hat_to_axis
)brace
id|hid_hat_to_axis
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|1
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|0
comma
l_int|1
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|1
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|0
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|hid_types
r_static
r_char
op_star
id|hid_types
(braket
)braket
op_assign
(brace
l_string|&quot;Device&quot;
comma
l_string|&quot;Pointer&quot;
comma
l_string|&quot;Mouse&quot;
comma
l_string|&quot;Device&quot;
comma
l_string|&quot;Joystick&quot;
comma
l_string|&quot;Gamepad&quot;
comma
l_string|&quot;Keyboard&quot;
comma
l_string|&quot;Keypad&quot;
comma
l_string|&quot;Multi-Axis Controller&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * Register a new report for a device.&n; */
DECL|function|hid_register_report
r_static
r_struct
id|hid_report
op_star
id|hid_register_report
c_func
(paren
r_struct
id|hid_device
op_star
id|device
comma
r_int
id|type
comma
r_int
id|id
)paren
(brace
r_struct
id|hid_report_enum
op_star
id|report_enum
op_assign
id|device-&gt;report_enum
op_plus
id|type
suffix:semicolon
r_struct
id|hid_report
op_star
id|report
suffix:semicolon
r_if
c_cond
(paren
id|report_enum-&gt;report_id_hash
(braket
id|id
)braket
)paren
r_return
id|report_enum-&gt;report_id_hash
(braket
id|id
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|report
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hid_report
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|report
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hid_report
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
l_int|0
)paren
id|report_enum-&gt;numbered
op_assign
l_int|1
suffix:semicolon
id|report-&gt;id
op_assign
id|id
suffix:semicolon
id|report-&gt;type
op_assign
id|type
suffix:semicolon
id|report-&gt;size
op_assign
l_int|0
suffix:semicolon
id|report-&gt;device
op_assign
id|device
suffix:semicolon
id|report_enum-&gt;report_id_hash
(braket
id|id
)braket
op_assign
id|report
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|report-&gt;list
comma
op_amp
id|report_enum-&gt;report_list
)paren
suffix:semicolon
r_return
id|report
suffix:semicolon
)brace
multiline_comment|/*&n; * Register a new field for this report.&n; */
DECL|function|hid_register_field
r_static
r_struct
id|hid_field
op_star
id|hid_register_field
c_func
(paren
r_struct
id|hid_report
op_star
id|report
comma
r_int
id|usages
comma
r_int
id|values
)paren
(brace
r_if
c_cond
(paren
id|report-&gt;maxfield
OL
id|HID_MAX_FIELDS
)paren
(brace
r_struct
id|hid_field
op_star
id|field
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|field
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hid_field
)paren
op_plus
id|usages
op_star
r_sizeof
(paren
r_struct
id|hid_usage
)paren
op_plus
id|values
op_star
r_sizeof
(paren
r_int
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|field
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hid_field
)paren
op_plus
id|usages
op_star
r_sizeof
(paren
r_struct
id|hid_usage
)paren
op_plus
id|values
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|report-&gt;field
(braket
id|report-&gt;maxfield
op_increment
)braket
op_assign
id|field
suffix:semicolon
id|field-&gt;usage
op_assign
(paren
r_struct
id|hid_usage
op_star
)paren
(paren
id|field
op_plus
l_int|1
)paren
suffix:semicolon
id|field-&gt;value
op_assign
(paren
r_int
op_star
)paren
(paren
id|field-&gt;usage
op_plus
id|usages
)paren
suffix:semicolon
id|field-&gt;report
op_assign
id|report
suffix:semicolon
r_return
id|field
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;too many fields in report&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Open a collection. The type/usage is pushed on the stack.&n; */
DECL|function|open_collection
r_static
r_int
id|open_collection
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_int
id|type
)paren
(brace
r_int
id|usage
suffix:semicolon
id|usage
op_assign
id|parser-&gt;local.usage
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|HID_COLLECTION_APPLICATION
op_logical_and
op_logical_neg
id|parser-&gt;device-&gt;application
)paren
id|parser-&gt;device-&gt;application
op_assign
id|usage
suffix:semicolon
r_if
c_cond
(paren
id|parser-&gt;collection_stack_ptr
OL
id|HID_COLLECTION_STACK_SIZE
)paren
(brace
multiline_comment|/* PUSH on stack */
r_struct
id|hid_collection
op_star
id|collection
op_assign
id|parser-&gt;collection_stack
op_plus
id|parser-&gt;collection_stack_ptr
op_increment
suffix:semicolon
id|collection-&gt;type
op_assign
id|type
suffix:semicolon
id|collection-&gt;usage
op_assign
id|usage
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;collection stack overflow&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Close a collection.&n; */
DECL|function|close_collection
r_static
r_int
id|close_collection
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
)paren
(brace
r_if
c_cond
(paren
id|parser-&gt;collection_stack_ptr
OG
l_int|0
)paren
(brace
multiline_comment|/* POP from stack */
id|parser-&gt;collection_stack_ptr
op_decrement
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;collection stack underflow&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Climb up the stack, search for the specified collection type&n; * and return the usage.&n; */
DECL|function|hid_lookup_collection
r_static
r_int
id|hid_lookup_collection
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_int
id|type
)paren
(brace
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
id|parser-&gt;collection_stack_ptr
op_minus
l_int|1
suffix:semicolon
id|n
op_ge
l_int|0
suffix:semicolon
id|n
op_decrement
)paren
r_if
c_cond
(paren
id|parser-&gt;collection_stack
(braket
id|n
)braket
dot
id|type
op_eq
id|type
)paren
r_return
id|parser-&gt;collection_stack
(braket
id|n
)braket
dot
id|usage
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* we know nothing about this usage type */
)brace
multiline_comment|/*&n; * Add a usage to the temporary parser table.&n; */
DECL|function|hid_add_usage
r_static
r_int
id|hid_add_usage
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_int
id|usage
)paren
(brace
r_if
c_cond
(paren
id|parser-&gt;local.usage_index
op_ge
id|HID_MAX_USAGES
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;usage index exceeded&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|parser-&gt;local.usage
(braket
id|parser-&gt;local.usage_index
op_increment
)braket
op_assign
id|usage
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Register a new field for this report.&n; */
DECL|function|hid_add_field
r_static
r_int
id|hid_add_field
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_int
id|report_type
comma
r_int
id|flags
)paren
(brace
r_struct
id|hid_report
op_star
id|report
suffix:semicolon
r_struct
id|hid_field
op_star
id|field
suffix:semicolon
r_int
id|usages
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|report
op_assign
id|hid_register_report
c_func
(paren
id|parser-&gt;device
comma
id|report_type
comma
id|parser-&gt;global.report_id
)paren
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;hid_register_report failed&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HID_MAIN_ITEM_VARIABLE
op_amp
op_complement
id|flags
)paren
(brace
multiline_comment|/* ARRAY */
r_if
c_cond
(paren
id|parser-&gt;global.logical_maximum
op_le
id|parser-&gt;global.logical_minimum
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;logical range invalid %d %d&quot;
comma
id|parser-&gt;global.logical_minimum
comma
id|parser-&gt;global.logical_maximum
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|usages
op_assign
id|parser-&gt;local.usage_index
suffix:semicolon
multiline_comment|/* Hint: we can assume usages &lt; MAX_USAGE here */
)brace
r_else
(brace
multiline_comment|/* VARIABLE */
id|usages
op_assign
id|parser-&gt;global.report_count
suffix:semicolon
)brace
id|offset
op_assign
id|report-&gt;size
suffix:semicolon
id|report-&gt;size
op_add_assign
id|parser-&gt;global.report_size
op_star
id|parser-&gt;global.report_count
suffix:semicolon
r_if
c_cond
(paren
id|usages
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* ignore padding fields */
r_if
c_cond
(paren
(paren
id|field
op_assign
id|hid_register_field
c_func
(paren
id|report
comma
id|usages
comma
id|parser-&gt;global.report_count
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|field-&gt;physical
op_assign
id|hid_lookup_collection
c_func
(paren
id|parser
comma
id|HID_COLLECTION_PHYSICAL
)paren
suffix:semicolon
id|field-&gt;logical
op_assign
id|hid_lookup_collection
c_func
(paren
id|parser
comma
id|HID_COLLECTION_LOGICAL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|usages
suffix:semicolon
id|i
op_increment
)paren
id|field-&gt;usage
(braket
id|i
)braket
dot
id|hid
op_assign
id|parser-&gt;local.usage
(braket
id|i
)braket
suffix:semicolon
id|field-&gt;maxusage
op_assign
id|usages
suffix:semicolon
id|field-&gt;flags
op_assign
id|flags
suffix:semicolon
id|field-&gt;report_offset
op_assign
id|offset
suffix:semicolon
id|field-&gt;report_type
op_assign
id|report_type
suffix:semicolon
id|field-&gt;report_size
op_assign
id|parser-&gt;global.report_size
suffix:semicolon
id|field-&gt;report_count
op_assign
id|parser-&gt;global.report_count
suffix:semicolon
id|field-&gt;logical_minimum
op_assign
id|parser-&gt;global.logical_minimum
suffix:semicolon
id|field-&gt;logical_maximum
op_assign
id|parser-&gt;global.logical_maximum
suffix:semicolon
id|field-&gt;physical_minimum
op_assign
id|parser-&gt;global.physical_minimum
suffix:semicolon
id|field-&gt;physical_maximum
op_assign
id|parser-&gt;global.physical_maximum
suffix:semicolon
id|field-&gt;unit_exponent
op_assign
id|parser-&gt;global.unit_exponent
suffix:semicolon
id|field-&gt;unit
op_assign
id|parser-&gt;global.unit
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Read data value from item.&n; */
DECL|function|item_udata
r_static
id|__inline__
id|__u32
id|item_udata
c_func
(paren
r_struct
id|hid_item
op_star
id|item
)paren
(brace
r_switch
c_cond
(paren
id|item-&gt;size
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
id|item-&gt;data.u8
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
id|item-&gt;data.u16
suffix:semicolon
r_case
l_int|4
suffix:colon
r_return
id|item-&gt;data.u32
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|item_sdata
r_static
id|__inline__
id|__s32
id|item_sdata
c_func
(paren
r_struct
id|hid_item
op_star
id|item
)paren
(brace
r_switch
c_cond
(paren
id|item-&gt;size
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
id|item-&gt;data.s8
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
id|item-&gt;data.s16
suffix:semicolon
r_case
l_int|4
suffix:colon
r_return
id|item-&gt;data.s32
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Process a global item.&n; */
DECL|function|hid_parser_global
r_static
r_int
id|hid_parser_global
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_struct
id|hid_item
op_star
id|item
)paren
(brace
r_switch
c_cond
(paren
id|item-&gt;tag
)paren
(brace
r_case
id|HID_GLOBAL_ITEM_TAG_PUSH
suffix:colon
r_if
c_cond
(paren
id|parser-&gt;global_stack_ptr
OL
id|HID_GLOBAL_STACK_SIZE
)paren
(brace
id|memcpy
c_func
(paren
id|parser-&gt;global_stack
op_plus
id|parser-&gt;global_stack_ptr
op_increment
comma
op_amp
id|parser-&gt;global
comma
r_sizeof
(paren
r_struct
id|hid_global
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;global enviroment stack overflow&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_POP
suffix:colon
r_if
c_cond
(paren
id|parser-&gt;global_stack_ptr
OG
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|parser-&gt;global
comma
id|parser-&gt;global_stack
op_plus
op_decrement
id|parser-&gt;global_stack_ptr
comma
r_sizeof
(paren
r_struct
id|hid_global
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;global enviroment stack underflow&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_USAGE_PAGE
suffix:colon
id|parser-&gt;global.usage_page
op_assign
id|item_udata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_LOGICAL_MINIMUM
suffix:colon
id|parser-&gt;global.logical_minimum
op_assign
id|item_sdata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_LOGICAL_MAXIMUM
suffix:colon
id|parser-&gt;global.logical_maximum
op_assign
id|item_sdata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_PHYSICAL_MINIMUM
suffix:colon
id|parser-&gt;global.physical_minimum
op_assign
id|item_sdata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_PHYSICAL_MAXIMUM
suffix:colon
id|parser-&gt;global.physical_maximum
op_assign
id|item_sdata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_UNIT_EXPONENT
suffix:colon
id|parser-&gt;global.unit_exponent
op_assign
id|item_udata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_UNIT
suffix:colon
id|parser-&gt;global.unit
op_assign
id|item_udata
c_func
(paren
id|item
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_REPORT_SIZE
suffix:colon
r_if
c_cond
(paren
(paren
id|parser-&gt;global.report_size
op_assign
id|item_udata
c_func
(paren
id|item
)paren
)paren
OG
l_int|32
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;invalid report_size %d&quot;
comma
id|parser-&gt;global.report_size
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_REPORT_COUNT
suffix:colon
r_if
c_cond
(paren
(paren
id|parser-&gt;global.report_count
op_assign
id|item_udata
c_func
(paren
id|item
)paren
)paren
OG
id|HID_MAX_USAGES
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;invalid report_count %d&quot;
comma
id|parser-&gt;global.report_count
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|HID_GLOBAL_ITEM_TAG_REPORT_ID
suffix:colon
r_if
c_cond
(paren
(paren
id|parser-&gt;global.report_id
op_assign
id|item_udata
c_func
(paren
id|item
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;report_id 0 is invalid&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|dbg
c_func
(paren
l_string|&quot;unknown global tag 0x%x&quot;
comma
id|item-&gt;tag
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Process a local item.&n; */
DECL|function|hid_parser_local
r_static
r_int
id|hid_parser_local
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_struct
id|hid_item
op_star
id|item
)paren
(brace
id|__u32
id|data
suffix:semicolon
r_if
c_cond
(paren
id|item-&gt;size
op_eq
l_int|0
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;item data expected for local item&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data
op_assign
id|item_udata
c_func
(paren
id|item
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|item-&gt;tag
)paren
(brace
r_case
id|HID_LOCAL_ITEM_TAG_DELIMITER
suffix:colon
r_if
c_cond
(paren
id|data
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * We treat items before the first delimiter&n;&t;&t;&t;&t; * as global to all usage sets (branch 0).&n;&t;&t;&t;&t; * In the moment we process only these global&n;&t;&t;&t;&t; * items and the first delimiter set.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_depth
op_ne
l_int|0
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;nested delimiters&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|parser-&gt;local.delimiter_depth
op_increment
suffix:semicolon
id|parser-&gt;local.delimiter_branch
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_depth
OL
l_int|1
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;bogus close delimiter&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|parser-&gt;local.delimiter_depth
op_decrement
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
r_case
id|HID_LOCAL_ITEM_TAG_USAGE
suffix:colon
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_branch
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|item-&gt;size
op_le
l_int|2
)paren
id|data
op_assign
(paren
id|parser-&gt;global.usage_page
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
r_return
id|hid_add_usage
c_func
(paren
id|parser
comma
id|data
)paren
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;alternative usage ignored&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_LOCAL_ITEM_TAG_USAGE_MINIMUM
suffix:colon
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_branch
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|item-&gt;size
op_le
l_int|2
)paren
id|data
op_assign
(paren
id|parser-&gt;global.usage_page
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|parser-&gt;local.usage_minimum
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;alternative usage ignored&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HID_LOCAL_ITEM_TAG_USAGE_MAXIMUM
suffix:colon
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_branch
OL
l_int|2
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
id|item-&gt;size
op_le
l_int|2
)paren
id|data
op_assign
(paren
id|parser-&gt;global.usage_page
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
id|parser-&gt;local.usage_minimum
suffix:semicolon
id|n
op_le
id|data
suffix:semicolon
id|n
op_increment
)paren
r_if
c_cond
(paren
id|hid_add_usage
c_func
(paren
id|parser
comma
id|n
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;hid_add_usage failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;alternative usage ignored&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|dbg
c_func
(paren
l_string|&quot;unknown local item tag 0x%x&quot;
comma
id|item-&gt;tag
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Process a main item.&n; */
DECL|function|hid_parser_main
r_static
r_int
id|hid_parser_main
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_struct
id|hid_item
op_star
id|item
)paren
(brace
id|__u32
id|data
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|data
op_assign
id|item_udata
c_func
(paren
id|item
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|item-&gt;tag
)paren
(brace
r_case
id|HID_MAIN_ITEM_TAG_BEGIN_COLLECTION
suffix:colon
id|ret
op_assign
id|open_collection
c_func
(paren
id|parser
comma
id|data
op_amp
l_int|3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_MAIN_ITEM_TAG_END_COLLECTION
suffix:colon
id|ret
op_assign
id|close_collection
c_func
(paren
id|parser
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_MAIN_ITEM_TAG_INPUT
suffix:colon
id|ret
op_assign
id|hid_add_field
c_func
(paren
id|parser
comma
id|HID_INPUT_REPORT
comma
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_MAIN_ITEM_TAG_OUTPUT
suffix:colon
id|ret
op_assign
id|hid_add_field
c_func
(paren
id|parser
comma
id|HID_OUTPUT_REPORT
comma
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_MAIN_ITEM_TAG_FEATURE
suffix:colon
id|ret
op_assign
id|hid_add_field
c_func
(paren
id|parser
comma
id|HID_FEATURE_REPORT
comma
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dbg
c_func
(paren
l_string|&quot;unknown main item tag 0x%x&quot;
comma
id|item-&gt;tag
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|parser-&gt;local
comma
l_int|0
comma
r_sizeof
(paren
id|parser-&gt;local
)paren
)paren
suffix:semicolon
multiline_comment|/* Reset the local parser environment */
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Process a reserved item.&n; */
DECL|function|hid_parser_reserved
r_static
r_int
id|hid_parser_reserved
c_func
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_struct
id|hid_item
op_star
id|item
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;reserved item type, tag 0x%x&quot;
comma
id|item-&gt;tag
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Free a report and all registered fields. The field-&gt;usage and&n; * field-&gt;value table&squot;s are allocated behind the field, so we need&n; * only to free(field) itself.&n; */
DECL|function|hid_free_report
r_static
r_void
id|hid_free_report
c_func
(paren
r_struct
id|hid_report
op_star
id|report
)paren
(brace
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|report-&gt;maxfield
suffix:semicolon
id|n
op_increment
)paren
id|kfree
c_func
(paren
id|report-&gt;field
(braket
id|n
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|report
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Free a device structure, all reports, and all fields.&n; */
DECL|function|hid_free_device
r_static
r_void
id|hid_free_device
c_func
(paren
r_struct
id|hid_device
op_star
id|device
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HID_REPORT_TYPES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|hid_report_enum
op_star
id|report_enum
op_assign
id|device-&gt;report_enum
op_plus
id|i
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|256
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|hid_report
op_star
id|report
op_assign
id|report_enum-&gt;report_id_hash
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|report
)paren
id|hid_free_report
c_func
(paren
id|report
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|device-&gt;rdesc
)paren
id|kfree
c_func
(paren
id|device-&gt;rdesc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Fetch a report description item from the data stream. We support long&n; * items, though they are not used yet.&n; */
DECL|function|fetch_item
r_static
id|__u8
op_star
id|fetch_item
c_func
(paren
id|__u8
op_star
id|start
comma
id|__u8
op_star
id|end
comma
r_struct
id|hid_item
op_star
id|item
)paren
(brace
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
OG
l_int|0
)paren
(brace
id|__u8
id|b
op_assign
op_star
id|start
op_increment
suffix:semicolon
id|item-&gt;type
op_assign
(paren
id|b
op_rshift
l_int|2
)paren
op_amp
l_int|3
suffix:semicolon
id|item-&gt;tag
op_assign
(paren
id|b
op_rshift
l_int|4
)paren
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|item-&gt;tag
op_eq
id|HID_ITEM_TAG_LONG
)paren
(brace
id|item-&gt;format
op_assign
id|HID_ITEM_FORMAT_LONG
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
op_ge
l_int|2
)paren
(brace
id|item-&gt;size
op_assign
op_star
id|start
op_increment
suffix:semicolon
id|item-&gt;tag
op_assign
op_star
id|start
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
op_ge
id|item-&gt;size
)paren
(brace
id|item-&gt;data.longdata
op_assign
id|start
suffix:semicolon
id|start
op_add_assign
id|item-&gt;size
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|item-&gt;format
op_assign
id|HID_ITEM_FORMAT_SHORT
suffix:semicolon
id|item-&gt;size
op_assign
id|b
op_amp
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|item-&gt;size
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|start
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
op_ge
l_int|1
)paren
(brace
id|item-&gt;data.u8
op_assign
op_star
id|start
op_increment
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
op_ge
l_int|2
)paren
(brace
id|item-&gt;data.u16
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
(paren
id|__u16
op_star
)paren
id|start
)paren
op_increment
)paren
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
id|item-&gt;size
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
op_ge
l_int|4
)paren
(brace
id|item-&gt;data.u32
op_assign
id|le32_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
(paren
id|__u32
op_star
)paren
id|start
)paren
op_increment
)paren
)paren
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Parse a report description into a hid_device structure. Reports are&n; * enumerated, fields are attached to these reports.&n; */
DECL|function|hid_parse_report
r_static
r_struct
id|hid_device
op_star
id|hid_parse_report
c_func
(paren
id|__u8
op_star
id|start
comma
r_int
id|size
)paren
(brace
r_struct
id|hid_device
op_star
id|device
suffix:semicolon
r_struct
id|hid_parser
op_star
id|parser
suffix:semicolon
r_struct
id|hid_item
id|item
suffix:semicolon
id|__u8
op_star
id|end
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_int
(paren
op_star
id|dispatch_type
(braket
)braket
)paren
(paren
r_struct
id|hid_parser
op_star
id|parser
comma
r_struct
id|hid_item
op_star
id|item
)paren
op_assign
(brace
id|hid_parser_main
comma
id|hid_parser_global
comma
id|hid_parser_local
comma
id|hid_parser_reserved
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|device
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hid_device
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|device
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hid_device
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HID_REPORT_TYPES
suffix:semicolon
id|i
op_increment
)paren
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|device-&gt;report_enum
(braket
id|i
)braket
dot
id|report_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|device-&gt;rdesc
op_assign
(paren
id|__u8
op_star
)paren
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|device
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|device-&gt;rdesc
comma
id|start
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|parser
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hid_parser
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|device-&gt;rdesc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|device
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|parser
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hid_parser
)paren
)paren
suffix:semicolon
id|parser-&gt;device
op_assign
id|device
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|size
suffix:semicolon
r_while
c_loop
(paren
(paren
id|start
op_assign
id|fetch_item
c_func
(paren
id|start
comma
id|end
comma
op_amp
id|item
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|item.format
op_ne
id|HID_ITEM_FORMAT_SHORT
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;unexpected long global item&quot;
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|device
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dispatch_type
(braket
id|item.type
)braket
(paren
id|parser
comma
op_amp
id|item
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;item %u %u %u %u parsing failed&bslash;n&quot;
comma
id|item.format
comma
(paren
r_int
)paren
id|item.size
comma
(paren
r_int
)paren
id|item.type
comma
(paren
r_int
)paren
id|item.tag
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|device
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_eq
id|end
)paren
(brace
r_if
c_cond
(paren
id|parser-&gt;collection_stack_ptr
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;unbalanced collection at end of report description&quot;
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|device
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|parser-&gt;local.delimiter_depth
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;unbalanced delimiter at end of report description&quot;
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|device
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
id|device
suffix:semicolon
)brace
)brace
id|dbg
c_func
(paren
l_string|&quot;item fetching failed at offset %d&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|end
op_minus
id|start
)paren
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|device
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|parser
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert a signed n-bit integer to signed 32-bit integer. Common&n; * cases are done through the compiler, the screwed things has to be&n; * done by hand.&n; */
DECL|function|snto32
r_static
id|__inline__
id|__s32
id|snto32
c_func
(paren
id|__u32
id|value
comma
r_int
id|n
)paren
(brace
r_switch
c_cond
(paren
id|n
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
(paren
(paren
id|__s8
)paren
id|value
)paren
suffix:semicolon
r_case
l_int|16
suffix:colon
r_return
(paren
(paren
id|__s16
)paren
id|value
)paren
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
(paren
(paren
id|__s32
)paren
id|value
)paren
suffix:semicolon
)brace
r_return
id|value
op_amp
(paren
l_int|1
op_lshift
(paren
id|n
op_minus
l_int|1
)paren
)paren
ques
c_cond
id|value
op_or
(paren
op_minus
l_int|1
op_lshift
id|n
)paren
suffix:colon
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert a signed 32-bit integer to a signed n-bit integer. &n; */
DECL|function|s32ton
r_static
id|__inline__
id|__u32
id|s32ton
c_func
(paren
id|__s32
id|value
comma
r_int
id|n
)paren
(brace
id|__s32
id|a
op_assign
id|value
op_rshift
(paren
id|n
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_logical_and
id|a
op_ne
op_minus
l_int|1
)paren
r_return
id|value
OG
l_int|0
ques
c_cond
l_int|1
op_lshift
(paren
id|n
op_minus
l_int|1
)paren
suffix:colon
(paren
l_int|1
op_lshift
id|n
)paren
op_minus
l_int|1
suffix:semicolon
r_return
id|value
op_amp
(paren
(paren
l_int|1
op_lshift
id|n
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract/implement a data field from/to a report. We use 64-bit unsigned,&n; * 32-bit aligned, so that we can possibly have alignment problems on some&n; * odd architectures.&n; */
DECL|function|extract
r_static
id|__inline__
id|__u32
id|extract
c_func
(paren
id|__u8
op_star
id|report
comma
r_int
id|offset
comma
r_int
id|n
)paren
(brace
id|report
op_add_assign
(paren
id|offset
op_rshift
l_int|5
)paren
op_lshift
l_int|2
suffix:semicolon
id|offset
op_and_assign
l_int|31
suffix:semicolon
r_return
(paren
id|le64_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__u64
op_star
)paren
id|report
)paren
)paren
op_rshift
id|offset
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
id|n
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|implement
r_static
id|__inline__
r_void
id|implement
c_func
(paren
id|__u8
op_star
id|report
comma
r_int
id|offset
comma
r_int
id|n
comma
id|__u32
id|value
)paren
(brace
id|report
op_add_assign
(paren
id|offset
op_rshift
l_int|5
)paren
op_lshift
l_int|2
suffix:semicolon
id|offset
op_and_assign
l_int|31
suffix:semicolon
op_star
(paren
id|__u64
op_star
)paren
id|report
op_and_assign
id|cpu_to_le64
c_func
(paren
op_complement
(paren
(paren
(paren
(paren
id|__u64
)paren
l_int|1
op_lshift
id|n
)paren
op_minus
l_int|1
)paren
op_lshift
id|offset
)paren
)paren
suffix:semicolon
op_star
(paren
id|__u64
op_star
)paren
id|report
op_or_assign
id|cpu_to_le64
c_func
(paren
(paren
id|__u64
)paren
id|value
op_lshift
id|offset
)paren
suffix:semicolon
)brace
DECL|function|hid_configure_usage
r_static
r_void
id|hid_configure_usage
c_func
(paren
r_struct
id|hid_device
op_star
id|device
comma
r_struct
id|hid_field
op_star
id|field
comma
r_struct
id|hid_usage
op_star
id|usage
)paren
(brace
r_struct
id|input_dev
op_star
id|input
op_assign
op_amp
id|device-&gt;input
suffix:semicolon
r_int
id|max
suffix:semicolon
r_int
r_int
op_star
id|bit
suffix:semicolon
r_switch
c_cond
(paren
id|usage-&gt;hid
op_amp
id|HID_USAGE_PAGE
)paren
(brace
r_case
id|HID_UP_KEYBOARD
suffix:colon
id|set_bit
c_func
(paren
id|EV_REP
comma
id|input-&gt;evbit
)paren
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_if
c_cond
(paren
(paren
id|usage-&gt;hid
op_amp
id|HID_USAGE
)paren
OL
l_int|256
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|usage-&gt;code
op_assign
id|hid_keyboard
(braket
id|usage-&gt;hid
op_amp
id|HID_USAGE
)braket
)paren
)paren
r_return
suffix:semicolon
id|clear_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
suffix:semicolon
)brace
r_else
id|usage-&gt;code
op_assign
id|KEY_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_UP_BUTTON
suffix:colon
id|usage-&gt;code
op_assign
(paren
(paren
id|usage-&gt;hid
op_minus
l_int|1
)paren
op_amp
l_int|0xf
)paren
op_plus
l_int|0x100
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_switch
c_cond
(paren
id|device-&gt;application
)paren
(brace
r_case
id|HID_GD_GAMEPAD
suffix:colon
id|usage-&gt;code
op_add_assign
l_int|0x10
suffix:semicolon
r_case
id|HID_GD_JOYSTICK
suffix:colon
id|usage-&gt;code
op_add_assign
l_int|0x10
suffix:semicolon
r_case
id|HID_GD_MOUSE
suffix:colon
id|usage-&gt;code
op_add_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|field-&gt;physical
op_eq
id|HID_GD_POINTER
)paren
id|usage-&gt;code
op_add_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HID_UP_GENDESK
suffix:colon
r_if
c_cond
(paren
(paren
id|usage-&gt;hid
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x80
)paren
(brace
multiline_comment|/* SystemControl */
r_switch
c_cond
(paren
id|usage-&gt;hid
op_amp
l_int|0xf
)paren
(brace
r_case
l_int|0x1
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_POWER
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_SLEEP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_WAKEUP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usage-&gt;code
op_assign
id|usage-&gt;hid
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|field-&gt;report_size
op_eq
l_int|1
)paren
(brace
id|usage-&gt;code
op_assign
id|BTN_MISC
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|field-&gt;flags
op_amp
id|HID_MAIN_ITEM_RELATIVE
)paren
(brace
id|usage-&gt;type
op_assign
id|EV_REL
suffix:semicolon
id|bit
op_assign
id|input-&gt;relbit
suffix:semicolon
id|max
op_assign
id|REL_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usage-&gt;type
op_assign
id|EV_ABS
suffix:semicolon
id|bit
op_assign
id|input-&gt;absbit
suffix:semicolon
id|max
op_assign
id|ABS_MAX
suffix:semicolon
r_if
c_cond
(paren
id|usage-&gt;hid
op_eq
id|HID_GD_HATSWITCH
)paren
(brace
id|usage-&gt;code
op_assign
id|ABS_HAT0X
suffix:semicolon
id|usage-&gt;hat
op_assign
l_int|1
op_plus
(paren
id|field-&gt;logical_maximum
op_eq
l_int|4
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HID_UP_LED
suffix:colon
id|usage-&gt;code
op_assign
(paren
id|usage-&gt;hid
op_minus
l_int|1
)paren
op_amp
l_int|0xf
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_LED
suffix:semicolon
id|bit
op_assign
id|input-&gt;ledbit
suffix:semicolon
id|max
op_assign
id|LED_MAX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HID_UP_DIGITIZER
suffix:colon
r_switch
c_cond
(paren
id|usage-&gt;hid
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|0x30
suffix:colon
multiline_comment|/* TipPressure */
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|BTN_TOUCH
comma
id|input-&gt;keybit
)paren
)paren
(brace
id|device-&gt;quirks
op_or_assign
id|HID_QUIRK_NOTOUCH
suffix:semicolon
id|set_bit
c_func
(paren
id|EV_KEY
comma
id|input-&gt;evbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|BTN_TOUCH
comma
id|input-&gt;keybit
)paren
suffix:semicolon
)brace
id|usage-&gt;type
op_assign
id|EV_ABS
suffix:semicolon
id|bit
op_assign
id|input-&gt;absbit
suffix:semicolon
id|max
op_assign
id|ABS_MAX
suffix:semicolon
id|usage-&gt;code
op_assign
id|ABS_PRESSURE
suffix:semicolon
id|clear_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x32
suffix:colon
multiline_comment|/* InRange */
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_switch
c_cond
(paren
id|field-&gt;physical
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|0x21
suffix:colon
id|usage-&gt;code
op_assign
id|BTN_TOOL_MOUSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x22
suffix:colon
id|usage-&gt;code
op_assign
id|BTN_TOOL_FINGER
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|usage-&gt;code
op_assign
id|BTN_TOOL_PEN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x3c
suffix:colon
multiline_comment|/* Invert */
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
id|usage-&gt;code
op_assign
id|BTN_TOOL_RUBBER
suffix:semicolon
id|clear_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x33
suffix:colon
multiline_comment|/* Touch */
r_case
l_int|0x42
suffix:colon
multiline_comment|/* TipSwitch */
r_case
l_int|0x43
suffix:colon
multiline_comment|/* TipSwitch2 */
id|device-&gt;quirks
op_and_assign
op_complement
id|HID_QUIRK_NOTOUCH
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
id|usage-&gt;code
op_assign
id|BTN_TOUCH
suffix:semicolon
id|clear_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x44
suffix:colon
multiline_comment|/* BarrelSwitch */
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
id|usage-&gt;code
op_assign
id|BTN_STYLUS
suffix:semicolon
id|clear_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|unknown
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HID_UP_CONSUMER
suffix:colon
multiline_comment|/* USB HUT v1.1, pages 56-62 */
r_switch
c_cond
(paren
id|usage-&gt;hid
op_amp
id|HID_USAGE
)paren
(brace
r_case
l_int|0x000
suffix:colon
id|usage-&gt;code
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x034
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_SLEEP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x036
suffix:colon
id|usage-&gt;code
op_assign
id|BTN_MISC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08a
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_WWW
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x095
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_HELP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b4
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_REWIND
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b5
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_NEXTSONG
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b6
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_PREVIOUSSONG
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b7
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_STOPCD
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b8
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_EJECTCD
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0cd
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_PLAYPAUSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0e2
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_MUTE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0e9
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_VOLUMEUP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0ea
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_VOLUMEDOWN
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x183
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_CONFIG
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x18a
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_MAIL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x192
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_CALC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x194
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_FILE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x21a
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_UNDO
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x21b
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_COPY
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x21c
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_CUT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x21d
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_PASTE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x221
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_FIND
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x223
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_HOMEPAGE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x224
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_BACK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x225
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_FORWARD
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x226
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_STOP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x227
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_REFRESH
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x22a
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_BOOKMARKS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|usage-&gt;code
op_assign
id|KEY_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
id|unknown
suffix:colon
r_if
c_cond
(paren
id|field-&gt;report_size
op_eq
l_int|1
)paren
(brace
id|usage-&gt;code
op_assign
id|BTN_MISC
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_KEY
suffix:semicolon
id|bit
op_assign
id|input-&gt;keybit
suffix:semicolon
id|max
op_assign
id|KEY_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|field-&gt;flags
op_amp
id|HID_MAIN_ITEM_RELATIVE
)paren
(brace
id|usage-&gt;code
op_assign
id|REL_MISC
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_REL
suffix:semicolon
id|bit
op_assign
id|input-&gt;relbit
suffix:semicolon
id|max
op_assign
id|REL_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usage-&gt;code
op_assign
id|ABS_MISC
suffix:semicolon
id|usage-&gt;type
op_assign
id|EV_ABS
suffix:semicolon
id|bit
op_assign
id|input-&gt;absbit
suffix:semicolon
id|max
op_assign
id|ABS_MAX
suffix:semicolon
r_break
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|usage-&gt;type
comma
id|input-&gt;evbit
)paren
suffix:semicolon
r_while
c_loop
(paren
id|usage-&gt;code
op_le
id|max
op_logical_and
id|test_and_set_bit
c_func
(paren
id|usage-&gt;code
comma
id|bit
)paren
)paren
(brace
id|usage-&gt;code
op_assign
id|find_next_zero_bit
c_func
(paren
id|bit
comma
id|max
op_plus
l_int|1
comma
id|usage-&gt;code
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usage-&gt;code
OG
id|max
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|usage-&gt;type
op_eq
id|EV_ABS
)paren
(brace
r_int
id|a
op_assign
id|field-&gt;logical_minimum
suffix:semicolon
r_int
id|b
op_assign
id|field-&gt;logical_maximum
suffix:semicolon
id|input-&gt;absmin
(braket
id|usage-&gt;code
)braket
op_assign
id|a
suffix:semicolon
id|input-&gt;absmax
(braket
id|usage-&gt;code
)braket
op_assign
id|b
suffix:semicolon
id|input-&gt;absfuzz
(braket
id|usage-&gt;code
)braket
op_assign
(paren
id|b
op_minus
id|a
)paren
op_rshift
l_int|8
suffix:semicolon
id|input-&gt;absflat
(braket
id|usage-&gt;code
)braket
op_assign
(paren
id|b
op_minus
id|a
)paren
op_rshift
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usage-&gt;hat
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|usage-&gt;code
suffix:semicolon
id|i
OL
id|usage-&gt;code
op_plus
l_int|2
op_logical_and
id|i
op_le
id|max
suffix:semicolon
id|i
op_increment
)paren
(brace
id|input-&gt;absmax
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
id|input-&gt;absmin
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|input-&gt;absfuzz
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|input-&gt;absflat
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|usage-&gt;code
op_plus
l_int|1
comma
id|input-&gt;absbit
)paren
suffix:semicolon
)brace
)brace
DECL|function|hid_process_event
r_static
r_void
id|hid_process_event
c_func
(paren
r_struct
id|input_dev
op_star
id|input
comma
r_int
op_star
id|quirks
comma
r_struct
id|hid_field
op_star
id|field
comma
r_struct
id|hid_usage
op_star
id|usage
comma
id|__s32
id|value
)paren
(brace
id|hid_dump_input
c_func
(paren
id|usage
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usage-&gt;hat
)paren
(brace
r_if
c_cond
(paren
id|usage-&gt;hat
op_eq
l_int|2
)paren
id|value
op_assign
id|value
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|8
)paren
id|value
op_assign
l_int|8
suffix:semicolon
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|usage-&gt;code
comma
id|hid_hat_to_axis
(braket
id|value
)braket
dot
id|x
)paren
suffix:semicolon
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|usage-&gt;code
op_plus
l_int|1
comma
id|hid_hat_to_axis
(braket
id|value
)braket
dot
id|y
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usage-&gt;hid
op_eq
(paren
id|HID_UP_DIGITIZER
op_or
l_int|0x003c
)paren
)paren
(brace
multiline_comment|/* Invert */
op_star
id|quirks
op_assign
id|value
ques
c_cond
(paren
op_star
id|quirks
op_or
id|HID_QUIRK_INVERT
)paren
suffix:colon
(paren
op_star
id|quirks
op_amp
op_complement
id|HID_QUIRK_INVERT
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usage-&gt;hid
op_eq
(paren
id|HID_UP_DIGITIZER
op_or
l_int|0x0032
)paren
)paren
(brace
multiline_comment|/* InRange */
r_if
c_cond
(paren
id|value
)paren
(brace
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
(paren
op_star
id|quirks
op_amp
id|HID_QUIRK_INVERT
)paren
ques
c_cond
id|BTN_TOOL_RUBBER
suffix:colon
id|usage-&gt;code
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|usage-&gt;code
comma
l_int|0
)paren
suffix:semicolon
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|BTN_TOOL_RUBBER
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usage-&gt;hid
op_eq
(paren
id|HID_UP_DIGITIZER
op_or
l_int|0x0030
)paren
op_logical_and
(paren
op_star
id|quirks
op_amp
id|HID_QUIRK_NOTOUCH
)paren
)paren
(brace
multiline_comment|/* Pressure */
r_int
id|a
op_assign
id|field-&gt;logical_minimum
suffix:semicolon
r_int
id|b
op_assign
id|field-&gt;logical_maximum
suffix:semicolon
id|input_event
c_func
(paren
id|input
comma
id|EV_KEY
comma
id|BTN_TOUCH
comma
id|value
OG
id|a
op_plus
(paren
(paren
id|b
op_minus
id|a
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|usage-&gt;type
op_eq
id|EV_KEY
)paren
op_logical_and
(paren
id|usage-&gt;code
op_eq
l_int|0
)paren
)paren
(brace
multiline_comment|/* Key 0 is &quot;unassigned&quot;, not KEY_UKNOWN */
r_return
suffix:semicolon
)brace
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|usage-&gt;code
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|field-&gt;flags
op_amp
id|HID_MAIN_ITEM_RELATIVE
)paren
op_logical_and
(paren
id|usage-&gt;type
op_eq
id|EV_KEY
)paren
)paren
id|input_event
c_func
(paren
id|input
comma
id|usage-&gt;type
comma
id|usage-&gt;code
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Search an array for a value.&n; */
DECL|function|search
r_static
id|__inline__
r_int
id|search
c_func
(paren
id|__s32
op_star
id|array
comma
id|__s32
id|value
comma
r_int
id|n
)paren
(brace
r_while
c_loop
(paren
id|n
op_decrement
)paren
r_if
c_cond
(paren
op_star
id|array
op_increment
op_eq
id|value
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Analyse a received field, and fetch the data from it. The field&n; * content is stored for next report processing (we do differential&n; * reporting to the layer).&n; */
DECL|function|hid_input_field
r_static
r_void
id|hid_input_field
c_func
(paren
r_struct
id|hid_device
op_star
id|dev
comma
r_struct
id|hid_field
op_star
id|field
comma
id|__u8
op_star
id|data
)paren
(brace
r_int
id|n
suffix:semicolon
r_int
id|count
op_assign
id|field-&gt;report_count
suffix:semicolon
r_int
id|offset
op_assign
id|field-&gt;report_offset
suffix:semicolon
r_int
id|size
op_assign
id|field-&gt;report_size
suffix:semicolon
id|__s32
id|min
op_assign
id|field-&gt;logical_minimum
suffix:semicolon
id|__s32
id|max
op_assign
id|field-&gt;logical_maximum
suffix:semicolon
id|__s32
id|value
(braket
id|count
)braket
suffix:semicolon
multiline_comment|/* WARNING: gcc specific */
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|count
suffix:semicolon
id|n
op_increment
)paren
id|value
(braket
id|n
)braket
op_assign
id|min
OL
l_int|0
ques
c_cond
id|snto32
c_func
(paren
id|extract
c_func
(paren
id|data
comma
id|offset
op_plus
id|n
op_star
id|size
comma
id|size
)paren
comma
id|size
)paren
suffix:colon
id|extract
c_func
(paren
id|data
comma
id|offset
op_plus
id|n
op_star
id|size
comma
id|size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|count
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|HID_MAIN_ITEM_VARIABLE
op_amp
id|field-&gt;flags
)paren
(brace
r_if
c_cond
(paren
id|field-&gt;flags
op_amp
id|HID_MAIN_ITEM_RELATIVE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
(braket
id|n
)braket
)paren
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|value
(braket
id|n
)braket
op_eq
id|field-&gt;value
(braket
id|n
)braket
)paren
r_continue
suffix:semicolon
)brace
id|hid_process_event
c_func
(paren
op_amp
id|dev-&gt;input
comma
op_amp
id|dev-&gt;quirks
comma
id|field
comma
op_amp
id|field-&gt;usage
(braket
id|n
)braket
comma
id|value
(braket
id|n
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|field-&gt;value
(braket
id|n
)braket
op_ge
id|min
op_logical_and
id|field-&gt;value
(braket
id|n
)braket
op_le
id|max
multiline_comment|/* non-NULL value */
op_logical_and
id|field-&gt;usage
(braket
id|field-&gt;value
(braket
id|n
)braket
op_minus
id|min
)braket
dot
id|hid
multiline_comment|/* nonzero usage */
op_logical_and
id|search
c_func
(paren
id|value
comma
id|field-&gt;value
(braket
id|n
)braket
comma
id|count
)paren
)paren
id|hid_process_event
c_func
(paren
op_amp
id|dev-&gt;input
comma
op_amp
id|dev-&gt;quirks
comma
id|field
comma
op_amp
id|field-&gt;usage
(braket
id|field-&gt;value
(braket
id|n
)braket
op_minus
id|min
)braket
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
(braket
id|n
)braket
op_ge
id|min
op_logical_and
id|value
(braket
id|n
)braket
op_le
id|max
multiline_comment|/* non-NULL value */
op_logical_and
id|field-&gt;usage
(braket
id|value
(braket
id|n
)braket
op_minus
id|min
)braket
dot
id|hid
multiline_comment|/* nonzero usage */
op_logical_and
id|search
c_func
(paren
id|field-&gt;value
comma
id|value
(braket
id|n
)braket
comma
id|count
)paren
)paren
id|hid_process_event
c_func
(paren
op_amp
id|dev-&gt;input
comma
op_amp
id|dev-&gt;quirks
comma
id|field
comma
op_amp
id|field-&gt;usage
(braket
id|value
(braket
id|n
)braket
op_minus
id|min
)braket
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|field-&gt;value
comma
id|value
comma
id|count
op_star
r_sizeof
(paren
id|__s32
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Interrupt input handler - analyse a received report.&n; */
DECL|function|hid_irq
r_static
r_void
id|hid_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|hid_device
op_star
id|device
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|hid_report_enum
op_star
id|report_enum
op_assign
id|device-&gt;report_enum
op_plus
id|HID_INPUT_REPORT
suffix:semicolon
r_struct
id|hid_report
op_star
id|report
suffix:semicolon
id|__u8
op_star
id|data
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|len
op_assign
id|urb-&gt;actual_length
suffix:semicolon
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;nonzero status in irq %d&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;empty report&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_DATA
id|printk
c_func
(paren
id|KERN_DEBUG
id|__FILE__
l_string|&quot;: report (size %u) (%snumbered) = &quot;
comma
id|len
comma
id|report_enum-&gt;numbered
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;un&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|len
suffix:semicolon
id|n
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|data
(braket
id|n
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|n
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Normally report number is 0 */
r_if
c_cond
(paren
id|report_enum-&gt;numbered
)paren
(brace
multiline_comment|/* Device uses numbered reports, data[0] is report number */
id|n
op_assign
op_star
id|data
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|report
op_assign
id|report_enum-&gt;report_id_hash
(braket
id|n
)braket
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;undefined report_id %d received&quot;
comma
id|n
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
id|__FILE__
l_string|&quot;: report (size %u) = &quot;
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|len
suffix:semicolon
id|n
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|data
(braket
id|n
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
(paren
(paren
id|report-&gt;size
op_minus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;report %d is too short, (%d &lt; %d)&quot;
comma
id|report-&gt;id
comma
id|len
comma
(paren
(paren
id|report-&gt;size
op_minus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|report-&gt;maxfield
suffix:semicolon
id|n
op_increment
)paren
id|hid_input_field
c_func
(paren
id|device
comma
id|report-&gt;field
(braket
id|n
)braket
comma
id|data
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * hid_read_report() s intended to read the hid devices values even&n; * before the input device is registered, so that the userland interface&n; * modules start with real values. This is especially important for joydev.c&n; * automagic calibration. Doesn&squot;t work yet, though. Don&squot;t know why, the control&n; * request just times out on most devices I have and returns nonsense on others.&n; */
DECL|function|hid_read_report
r_static
r_void
id|hid_read_report
c_func
(paren
r_struct
id|hid_device
op_star
id|hid
comma
r_struct
id|hid_report
op_star
id|report
)paren
(brace
macro_line|#if 0
r_int
id|rlen
op_assign
(paren
(paren
id|report-&gt;size
op_minus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
r_char
id|rdata
(braket
id|rlen
)braket
suffix:semicolon
r_struct
id|urb
id|urb
suffix:semicolon
r_int
id|read
comma
id|j
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|urb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|urb
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|rdata
comma
l_int|0
comma
id|rlen
)paren
suffix:semicolon
id|urb.transfer_buffer
op_assign
id|rdata
suffix:semicolon
id|urb.actual_length
op_assign
id|rlen
suffix:semicolon
id|urb.context
op_assign
id|hid
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;getting report type %d id %d len %d&quot;
comma
id|report-&gt;type
op_plus
l_int|1
comma
id|report-&gt;id
comma
id|rlen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|read
op_assign
id|usb_get_report
c_func
(paren
id|hid-&gt;dev
comma
id|hid-&gt;ifnum
comma
id|report-&gt;type
op_plus
l_int|1
comma
id|report-&gt;id
comma
id|rdata
comma
id|rlen
)paren
)paren
op_ne
id|rlen
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;reading report failed rlen %d read %d&quot;
comma
id|rlen
comma
id|read
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
id|__FILE__
l_string|&quot;: report = &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|rlen
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|rdata
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|hid_irq
c_func
(paren
op_amp
id|urb
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * Output the field into the report.&n; */
DECL|function|hid_output_field
r_static
r_void
id|hid_output_field
c_func
(paren
r_struct
id|hid_field
op_star
id|field
comma
id|__u8
op_star
id|data
)paren
(brace
r_int
id|count
op_assign
id|field-&gt;report_count
suffix:semicolon
r_int
id|offset
op_assign
id|field-&gt;report_offset
suffix:semicolon
r_int
id|size
op_assign
id|field-&gt;report_size
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|count
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|field-&gt;logical_minimum
OL
l_int|0
)paren
multiline_comment|/* signed values */
id|implement
c_func
(paren
id|data
comma
id|offset
op_plus
id|n
op_star
id|size
comma
id|size
comma
id|s32ton
c_func
(paren
id|field-&gt;value
(braket
id|n
)braket
comma
id|size
)paren
)paren
suffix:semicolon
r_else
multiline_comment|/* unsigned values */
id|implement
c_func
(paren
id|data
comma
id|offset
op_plus
id|n
op_star
id|size
comma
id|size
comma
id|field-&gt;value
(braket
id|n
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Create a report.&n; */
DECL|function|hid_output_report
r_void
id|hid_output_report
c_func
(paren
r_struct
id|hid_report
op_star
id|report
comma
id|__u8
op_star
id|data
)paren
(brace
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|report-&gt;maxfield
suffix:semicolon
id|n
op_increment
)paren
id|hid_output_field
c_func
(paren
id|report-&gt;field
(braket
id|n
)braket
comma
id|data
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Set a field value. The report this field belongs to has to be&n; * created and transfered to the device, to set this value in the&n; * device.&n; */
DECL|function|hid_set_field
r_int
id|hid_set_field
c_func
(paren
r_struct
id|hid_field
op_star
id|field
comma
r_int
id|offset
comma
id|__s32
id|value
)paren
(brace
r_int
id|size
op_assign
id|field-&gt;report_size
suffix:semicolon
id|hid_dump_input
c_func
(paren
id|field-&gt;usage
op_plus
id|offset
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_ge
id|field-&gt;report_count
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;offset exceeds report_count&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|field-&gt;logical_minimum
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|value
op_ne
id|snto32
c_func
(paren
id|s32ton
c_func
(paren
id|value
comma
id|size
)paren
comma
id|size
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;value %d is out of range&quot;
comma
id|value
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|value
OG
id|field-&gt;logical_maximum
)paren
op_logical_or
(paren
id|value
OL
id|field-&gt;logical_minimum
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;value %d is invalid&quot;
comma
id|value
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|field-&gt;value
(braket
id|offset
)braket
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hid_find_field
r_static
r_int
id|hid_find_field
c_func
(paren
r_struct
id|hid_device
op_star
id|hid
comma
r_int
r_int
id|type
comma
r_int
r_int
id|code
comma
r_struct
id|hid_field
op_star
op_star
id|field
)paren
(brace
r_struct
id|hid_report_enum
op_star
id|report_enum
op_assign
id|hid-&gt;report_enum
op_plus
id|HID_OUTPUT_REPORT
suffix:semicolon
r_struct
id|list_head
op_star
id|list
op_assign
id|report_enum-&gt;report_list.next
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|report_enum-&gt;report_list
)paren
(brace
r_struct
id|hid_report
op_star
id|report
op_assign
(paren
r_struct
id|hid_report
op_star
)paren
id|list
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|report-&gt;maxfield
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|field
op_assign
id|report-&gt;field
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
op_star
id|field
)paren
op_member_access_from_pointer
id|maxusage
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
(paren
op_star
id|field
)paren
op_member_access_from_pointer
id|usage
(braket
id|j
)braket
dot
id|type
op_eq
id|type
op_logical_and
(paren
op_star
id|field
)paren
op_member_access_from_pointer
id|usage
(braket
id|j
)braket
dot
id|code
op_eq
id|code
)paren
r_return
id|j
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|hid_submit_out
r_static
r_int
id|hid_submit_out
c_func
(paren
r_struct
id|hid_device
op_star
id|hid
)paren
(brace
id|hid-&gt;urbout.transfer_buffer_length
op_assign
id|hid-&gt;out
(braket
id|hid-&gt;outtail
)braket
dot
id|dr.length
suffix:semicolon
id|hid-&gt;urbout.transfer_buffer
op_assign
id|hid-&gt;out
(braket
id|hid-&gt;outtail
)braket
dot
id|buffer
suffix:semicolon
id|hid-&gt;urbout.setup_packet
op_assign
(paren
r_void
op_star
)paren
op_amp
(paren
id|hid-&gt;out
(braket
id|hid-&gt;outtail
)braket
dot
id|dr
)paren
suffix:semicolon
id|hid-&gt;urbout.dev
op_assign
id|hid-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
op_amp
id|hid-&gt;urbout
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;usb_submit_urb(out) failed&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hid_ctrl
r_static
r_void
id|hid_ctrl
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
id|warn
c_func
(paren
l_string|&quot;ctrl urb status %d received&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
id|hid-&gt;outtail
op_assign
(paren
id|hid-&gt;outtail
op_plus
l_int|1
)paren
op_amp
(paren
id|HID_CONTROL_FIFO_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hid-&gt;outhead
op_ne
id|hid-&gt;outtail
)paren
id|hid_submit_out
c_func
(paren
id|hid
)paren
suffix:semicolon
)brace
DECL|function|hid_event
r_static
r_int
id|hid_event
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_int
r_int
id|code
comma
r_int
id|value
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|hid_field
op_star
id|field
op_assign
l_int|NULL
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|offset
op_assign
id|hid_find_field
c_func
(paren
id|hid
comma
id|type
comma
id|code
comma
op_amp
id|field
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;event field not found&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|hid_set_field
c_func
(paren
id|field
comma
id|offset
comma
id|value
)paren
suffix:semicolon
id|hid_output_report
c_func
(paren
id|field-&gt;report
comma
id|hid-&gt;out
(braket
id|hid-&gt;outhead
)braket
dot
id|buffer
)paren
suffix:semicolon
id|hid-&gt;out
(braket
id|hid-&gt;outhead
)braket
dot
id|dr.value
op_assign
l_int|0x200
op_or
id|field-&gt;report-&gt;id
suffix:semicolon
id|hid-&gt;out
(braket
id|hid-&gt;outhead
)braket
dot
id|dr.length
op_assign
(paren
(paren
id|field-&gt;report-&gt;size
op_minus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
id|hid-&gt;outhead
op_assign
(paren
id|hid-&gt;outhead
op_plus
l_int|1
)paren
op_amp
(paren
id|HID_CONTROL_FIFO_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hid-&gt;outhead
op_eq
id|hid-&gt;outtail
)paren
id|hid-&gt;outtail
op_assign
(paren
id|hid-&gt;outtail
op_plus
l_int|1
)paren
op_amp
(paren
id|HID_CONTROL_FIFO_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hid-&gt;urbout.status
op_ne
op_minus
id|EINPROGRESS
)paren
id|hid_submit_out
c_func
(paren
id|hid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hid_open
r_static
r_int
id|hid_open
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|hid-&gt;open
op_increment
)paren
r_return
l_int|0
suffix:semicolon
id|hid-&gt;urb.dev
op_assign
id|hid-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
op_amp
id|hid-&gt;urb
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hid_close
r_static
r_void
id|hid_close
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|hid-&gt;open
)paren
id|usb_unlink_urb
c_func
(paren
op_amp
id|hid-&gt;urb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Configure the input layer interface&n; * Read all reports and initalize the absoulte field values.&n; */
DECL|function|hid_init_input
r_static
r_void
id|hid_init_input
c_func
(paren
r_struct
id|hid_device
op_star
id|hid
)paren
(brace
r_struct
id|hid_report_enum
op_star
id|report_enum
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|hid-&gt;input
dot
r_private
op_assign
id|hid
suffix:semicolon
id|hid-&gt;input.event
op_assign
id|hid_event
suffix:semicolon
id|hid-&gt;input.open
op_assign
id|hid_open
suffix:semicolon
id|hid-&gt;input.close
op_assign
id|hid_close
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
id|HID_INPUT_REPORT
suffix:semicolon
id|k
op_le
id|HID_OUTPUT_REPORT
suffix:semicolon
id|k
op_increment
)paren
(brace
id|report_enum
op_assign
id|hid-&gt;report_enum
op_plus
id|k
suffix:semicolon
id|list
op_assign
id|report_enum-&gt;report_list.next
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|report_enum-&gt;report_list
)paren
(brace
r_struct
id|hid_report
op_star
id|report
op_assign
(paren
r_struct
id|hid_report
op_star
)paren
id|list
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|report-&gt;maxfield
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|report-&gt;field
(braket
id|i
)braket
op_member_access_from_pointer
id|maxusage
suffix:semicolon
id|j
op_increment
)paren
id|hid_configure_usage
c_func
(paren
id|hid
comma
id|report-&gt;field
(braket
id|i
)braket
comma
id|report-&gt;field
(braket
id|i
)braket
op_member_access_from_pointer
id|usage
op_plus
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
op_eq
id|HID_INPUT_REPORT
)paren
(brace
id|usb_set_idle
c_func
(paren
id|hid-&gt;dev
comma
id|hid-&gt;ifnum
comma
l_int|0
comma
id|report-&gt;id
)paren
suffix:semicolon
id|hid_read_report
c_func
(paren
id|hid
comma
id|report
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|macro|USB_VENDOR_ID_WACOM
mdefine_line|#define USB_VENDOR_ID_WACOM&t;&t;0x056a
DECL|macro|USB_DEVICE_ID_WACOM_GRAPHIRE
mdefine_line|#define USB_DEVICE_ID_WACOM_GRAPHIRE&t;0x0010
DECL|macro|USB_DEVICE_ID_WACOM_INTUOS
mdefine_line|#define USB_DEVICE_ID_WACOM_INTUOS&t;0x0020
DECL|struct|hid_blacklist
r_struct
id|hid_blacklist
(brace
DECL|member|idVendor
id|__u16
id|idVendor
suffix:semicolon
DECL|member|idProduct
id|__u16
id|idProduct
suffix:semicolon
DECL|variable|hid_blacklist
)brace
id|hid_blacklist
(braket
)braket
op_assign
(brace
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_GRAPHIRE
)brace
comma
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_INTUOS
)brace
comma
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_INTUOS
op_plus
l_int|1
)brace
comma
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_INTUOS
op_plus
l_int|2
)brace
comma
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_INTUOS
op_plus
l_int|3
)brace
comma
(brace
id|USB_VENDOR_ID_WACOM
comma
id|USB_DEVICE_ID_WACOM_INTUOS
op_plus
l_int|4
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|usb_hid_configure
r_static
r_struct
id|hid_device
op_star
id|usb_hid_configure
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
id|ifnum
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|usb_interface_descriptor
op_star
id|interface
op_assign
id|dev-&gt;actconfig-&gt;interface
(braket
id|ifnum
)braket
dot
id|altsetting
op_plus
l_int|0
suffix:semicolon
r_struct
id|hid_descriptor
op_star
id|hdesc
suffix:semicolon
r_struct
id|hid_device
op_star
id|hid
suffix:semicolon
r_int
id|rsize
op_assign
l_int|0
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|hid_blacklist
(braket
id|n
)braket
dot
id|idVendor
suffix:semicolon
id|n
op_increment
)paren
r_if
c_cond
(paren
(paren
id|hid_blacklist
(braket
id|n
)braket
dot
id|idVendor
op_eq
id|dev-&gt;descriptor.idVendor
)paren
op_logical_and
(paren
id|hid_blacklist
(braket
id|n
)braket
dot
id|idProduct
op_eq
id|dev-&gt;descriptor.idProduct
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|usb_get_extra_descriptor
c_func
(paren
id|interface
comma
id|USB_DT_HID
comma
op_amp
id|hdesc
)paren
op_logical_and
id|usb_get_extra_descriptor
c_func
(paren
op_amp
id|interface-&gt;endpoint
(braket
l_int|0
)braket
comma
id|USB_DT_HID
comma
op_amp
id|hdesc
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;class descriptor not present&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|hdesc-&gt;bNumDescriptors
suffix:semicolon
id|n
op_increment
)paren
r_if
c_cond
(paren
id|hdesc-&gt;desc
(braket
id|n
)braket
dot
id|bDescriptorType
op_eq
id|USB_DT_REPORT
)paren
id|rsize
op_assign
id|le16_to_cpu
c_func
(paren
id|hdesc-&gt;desc
(braket
id|n
)braket
dot
id|wDescriptorLength
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsize
op_logical_or
id|rsize
OG
id|HID_MAX_DESCRIPTOR_SIZE
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;weird size of report descriptor (%u)&quot;
comma
id|rsize
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
(brace
id|__u8
id|rdesc
(braket
id|rsize
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|usb_get_class_descriptor
c_func
(paren
id|dev
comma
id|interface-&gt;bInterfaceNumber
comma
id|USB_DT_REPORT
comma
l_int|0
comma
id|rdesc
comma
id|rsize
)paren
)paren
OL
l_int|0
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;reading report descriptor failed&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_DATA
id|printk
c_func
(paren
id|KERN_DEBUG
id|__FILE__
l_string|&quot;: report (size %u, read %d) = &quot;
comma
id|rsize
comma
id|n
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|rsize
suffix:semicolon
id|n
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
(paren
r_int
)paren
id|rdesc
(braket
id|n
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|hid
op_assign
id|hid_parse_report
c_func
(paren
id|rdesc
comma
id|rsize
)paren
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;parsing report descriptor failed&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|interface-&gt;bNumEndpoints
suffix:semicolon
id|n
op_increment
)paren
(brace
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint
op_assign
op_amp
id|interface-&gt;endpoint
(braket
id|n
)braket
suffix:semicolon
r_int
id|pipe
comma
id|maxp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|endpoint-&gt;bmAttributes
op_amp
l_int|3
)paren
op_ne
l_int|3
)paren
multiline_comment|/* Not an interrupt endpoint */
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|endpoint-&gt;bEndpointAddress
op_amp
l_int|0x80
)paren
)paren
multiline_comment|/* Not an input endpoint */
r_continue
suffix:semicolon
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|dev
comma
id|endpoint-&gt;bEndpointAddress
)paren
suffix:semicolon
id|maxp
op_assign
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
id|usb_pipeout
c_func
(paren
id|pipe
)paren
)paren
suffix:semicolon
id|FILL_INT_URB
c_func
(paren
op_amp
id|hid-&gt;urb
comma
id|dev
comma
id|pipe
comma
id|hid-&gt;buffer
comma
id|maxp
OG
l_int|32
ques
c_cond
l_int|32
suffix:colon
id|maxp
comma
id|hid_irq
comma
id|hid
comma
id|endpoint-&gt;bInterval
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
op_eq
id|interface-&gt;bNumEndpoints
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;couldn&squot;t find an input interrupt endpoint&quot;
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|hid
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|hid-&gt;version
op_assign
id|hdesc-&gt;bcdHID
suffix:semicolon
id|hid-&gt;country
op_assign
id|hdesc-&gt;bCountryCode
suffix:semicolon
id|hid-&gt;dev
op_assign
id|dev
suffix:semicolon
id|hid-&gt;ifnum
op_assign
id|interface-&gt;bInterfaceNumber
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|HID_CONTROL_FIFO_SIZE
suffix:semicolon
id|n
op_increment
)paren
(brace
id|hid-&gt;out
(braket
id|n
)braket
dot
id|dr.requesttype
op_assign
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_INTERFACE
suffix:semicolon
id|hid-&gt;out
(braket
id|n
)braket
dot
id|dr.request
op_assign
id|USB_REQ_SET_REPORT
suffix:semicolon
id|hid-&gt;out
(braket
id|n
)braket
dot
id|dr.index
op_assign
id|hid-&gt;ifnum
suffix:semicolon
)brace
id|hid-&gt;input.name
op_assign
id|hid-&gt;name
suffix:semicolon
id|hid-&gt;input.idbus
op_assign
id|BUS_USB
suffix:semicolon
id|hid-&gt;input.idvendor
op_assign
id|dev-&gt;descriptor.idVendor
suffix:semicolon
id|hid-&gt;input.idproduct
op_assign
id|dev-&gt;descriptor.idProduct
suffix:semicolon
id|hid-&gt;input.idversion
op_assign
id|dev-&gt;descriptor.bcdDevice
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|name
)paren
)paren
id|strcpy
c_func
(paren
id|hid-&gt;name
comma
id|name
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|hid-&gt;name
comma
l_string|&quot;USB HID %s %04x:%04x&quot;
comma
(paren
(paren
id|hid-&gt;application
op_ge
l_int|0x00010000
)paren
op_logical_and
(paren
id|hid-&gt;application
op_le
l_int|0x00010008
)paren
)paren
ques
c_cond
id|hid_types
(braket
id|hid-&gt;application
op_amp
l_int|0xffff
)braket
suffix:colon
l_string|&quot;Device&quot;
comma
id|hid-&gt;input.idvendor
comma
id|hid-&gt;input.idproduct
)paren
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
op_amp
id|hid-&gt;urbout
comma
id|dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
(paren
r_void
op_star
)paren
op_amp
id|hid-&gt;out
(braket
l_int|0
)braket
dot
id|dr
comma
id|hid-&gt;out
(braket
l_int|0
)braket
dot
id|buffer
comma
l_int|1
comma
id|hid_ctrl
comma
id|hid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|interface-&gt;bInterfaceSubClass
op_eq
l_int|1
)paren
id|usb_set_protocol
c_func
(paren
id|dev
comma
id|hid-&gt;ifnum
comma
l_int|1
)paren
suffix:semicolon
r_return
id|hid
suffix:semicolon
)brace
DECL|function|hid_probe
r_static
r_void
op_star
id|hid_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
suffix:semicolon
r_char
id|name
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;HID probe called for ifnum %d&quot;
comma
id|ifnum
)paren
suffix:semicolon
id|name
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
op_assign
id|kmalloc
c_func
(paren
l_int|63
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;descriptor.iManufacturer
op_logical_and
id|usb_string
c_func
(paren
id|dev
comma
id|dev-&gt;descriptor.iManufacturer
comma
id|buf
comma
l_int|63
)paren
OG
l_int|0
)paren
id|strcat
c_func
(paren
id|name
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;descriptor.iProduct
op_logical_and
id|usb_string
c_func
(paren
id|dev
comma
id|dev-&gt;descriptor.iProduct
comma
id|buf
comma
l_int|63
)paren
OG
l_int|0
)paren
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%s %s&quot;
comma
id|name
comma
id|buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|hid
op_assign
id|usb_hid_configure
c_func
(paren
id|dev
comma
id|ifnum
comma
id|name
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|hid_dump_device
c_func
(paren
id|hid
)paren
suffix:semicolon
id|hid_init_input
c_func
(paren
id|hid
)paren
suffix:semicolon
id|input_register_device
c_func
(paren
op_amp
id|hid-&gt;input
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;input%d: USB HID v%x.%02x %s&quot;
comma
id|hid-&gt;input.number
comma
id|hid-&gt;version
op_rshift
l_int|8
comma
id|hid-&gt;version
op_amp
l_int|0xff
comma
(paren
(paren
id|hid-&gt;application
op_ge
l_int|0x00010000
)paren
op_logical_and
(paren
id|hid-&gt;application
op_le
l_int|0x00010008
)paren
)paren
ques
c_cond
id|hid_types
(braket
id|hid-&gt;application
op_amp
l_int|0xffff
)braket
suffix:colon
l_string|&quot;Device&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|name
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; [%s]&quot;
comma
id|name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; [%04x:%04x]&quot;
comma
id|hid-&gt;input.idvendor
comma
id|hid-&gt;input.idproduct
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; on usb%d:%d.%d&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;busnum
comma
id|dev-&gt;devnum
comma
id|ifnum
)paren
suffix:semicolon
r_return
id|hid
suffix:semicolon
)brace
DECL|function|hid_disconnect
r_static
r_void
id|hid_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|hid_device
op_star
id|hid
op_assign
id|ptr
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;cleanup called&quot;
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
op_amp
id|hid-&gt;urb
)paren
suffix:semicolon
id|input_unregister_device
c_func
(paren
op_amp
id|hid-&gt;input
)paren
suffix:semicolon
id|hid_free_device
c_func
(paren
id|hid
)paren
suffix:semicolon
)brace
DECL|variable|hid_usb_ids
r_static
r_struct
id|usb_device_id
id|hid_usb_ids
(braket
)braket
op_assign
(brace
(brace
id|match_flags
suffix:colon
id|USB_DEVICE_ID_MATCH_INT_CLASS
comma
id|bInterfaceClass
suffix:colon
id|USB_INTERFACE_CLASS_HID
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|hid_usb_ids
)paren
suffix:semicolon
DECL|variable|hid_driver
r_static
r_struct
id|usb_driver
id|hid_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;hid&quot;
comma
id|probe
suffix:colon
id|hid_probe
comma
id|disconnect
suffix:colon
id|hid_disconnect
comma
id|id_table
suffix:colon
id|hid_usb_ids
comma
)brace
suffix:semicolon
DECL|function|hid_init
r_static
r_int
id|__init
id|hid_init
c_func
(paren
r_void
)paren
(brace
id|usb_register
c_func
(paren
op_amp
id|hid_driver
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hid_exit
r_static
r_void
id|__exit
id|hid_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|hid_driver
)paren
suffix:semicolon
)brace
DECL|variable|hid_init
id|module_init
c_func
(paren
id|hid_init
)paren
suffix:semicolon
DECL|variable|hid_exit
id|module_exit
c_func
(paren
id|hid_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Andreas Gal, Vojtech Pavlik &lt;vojtech@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;USB HID support drivers&quot;
)paren
suffix:semicolon
eof
