multiline_comment|/*&n; * UHCI-specific debugging code. Invaluable when something&n; * goes wrong, but don&squot;t get in my face.&n; *&n; * (C) Copyright 1999 Linus Torvalds&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;uhci.h&quot;
DECL|function|show_td
r_void
id|show_td
c_func
(paren
r_struct
id|uhci_td
op_star
id|td
)paren
(brace
r_char
op_star
id|spid
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08x &quot;
comma
id|td-&gt;link
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%se%d %s%s%s%s%s%s%s%s%s%sLength=%x &quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|29
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;SPD &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|27
)paren
op_amp
l_int|3
)paren
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|26
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;LS &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|25
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;IOS &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|24
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;IOC &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|23
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;Active &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|22
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;Stalled &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|21
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;DataBufErr &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|20
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;Babble &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|19
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;NAK &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|18
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;CRC/Timeo &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|td-&gt;status
op_rshift
l_int|17
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;BitStuff &quot;
suffix:colon
l_string|&quot;&quot;
comma
id|td-&gt;status
op_amp
l_int|0x7ff
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|td-&gt;info
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|0x2d
suffix:colon
id|spid
op_assign
l_string|&quot;SETUP&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe1
suffix:colon
id|spid
op_assign
l_string|&quot;OUT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x69
suffix:colon
id|spid
op_assign
l_string|&quot;IN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|spid
op_assign
l_string|&quot;?&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;MaxLen=%x %sEndPt=%x Dev=%x, PID=%x(%s) &quot;
comma
id|td-&gt;info
op_rshift
l_int|21
comma
(paren
(paren
id|td-&gt;info
op_rshift
l_int|19
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;DT &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|td-&gt;info
op_rshift
l_int|15
)paren
op_amp
l_int|15
comma
(paren
id|td-&gt;info
op_rshift
l_int|8
)paren
op_amp
l_int|127
comma
(paren
id|td-&gt;info
op_amp
l_int|0xff
)paren
comma
id|spid
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;(buf=%08x)&bslash;n&quot;
comma
id|td-&gt;buffer
)paren
suffix:semicolon
)brace
DECL|function|show_sc
r_static
r_void
id|show_sc
c_func
(paren
r_int
id|port
comma
r_int
r_int
id|status
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  stat%d     =     %04x   %s%s%s%s%s%s%s%s&bslash;n&quot;
comma
id|port
comma
id|status
comma
(paren
id|status
op_amp
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
ques
c_cond
l_string|&quot; PortSuspend&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
ques
c_cond
l_string|&quot; PortReset&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
ques
c_cond
l_string|&quot; LowSpeed&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; ResumeDetect&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; EnableChange&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; PortEnabled&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; ConnectChange&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|status
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; PortConnected&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
DECL|function|show_status
r_void
id|show_status
c_func
(paren
r_struct
id|uhci
op_star
id|uhci
)paren
(brace
r_int
r_int
id|io_addr
op_assign
id|uhci-&gt;io_addr
suffix:semicolon
r_int
r_int
id|usbcmd
comma
id|usbstat
comma
id|usbint
comma
id|usbfrnum
suffix:semicolon
r_int
r_int
id|flbaseadd
suffix:semicolon
r_int
r_char
id|sof
suffix:semicolon
r_int
r_int
id|portsc1
comma
id|portsc2
suffix:semicolon
id|usbcmd
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|0
)paren
suffix:semicolon
id|usbstat
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|2
)paren
suffix:semicolon
id|usbint
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|4
)paren
suffix:semicolon
id|usbfrnum
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|6
)paren
suffix:semicolon
id|flbaseadd
op_assign
id|inl
c_func
(paren
id|io_addr
op_plus
l_int|8
)paren
suffix:semicolon
id|sof
op_assign
id|inb
c_func
(paren
id|io_addr
op_plus
l_int|12
)paren
suffix:semicolon
id|portsc1
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|16
)paren
suffix:semicolon
id|portsc2
op_assign
id|inw
c_func
(paren
id|io_addr
op_plus
l_int|18
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  usbcmd    =     %04x   %s%s%s%s%s%s%s%s&bslash;n&quot;
comma
id|usbcmd
comma
(paren
id|usbcmd
op_amp
l_int|0x80
)paren
ques
c_cond
l_string|&quot; Maxp64&quot;
suffix:colon
l_string|&quot; Maxp32&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; CF&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; SWDBG&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; FGR&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; EGSM&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; GRESET&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; HCRESET&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbcmd
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; RS&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  usbstat   =     %04x   %s%s%s%s%s%s&bslash;n&quot;
comma
id|usbstat
comma
(paren
id|usbstat
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; HCHalted&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbstat
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; HostControllerProcessError&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbstat
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; HostSystemError&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbstat
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; ResumeDetect&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbstat
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; USBError&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|usbstat
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; USBINT&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  usbint    =     %04x&bslash;n&quot;
comma
id|usbint
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  usbfrnum  =   (%d)%03x&bslash;n&quot;
comma
(paren
id|usbfrnum
op_rshift
l_int|10
)paren
op_amp
l_int|1
comma
l_int|0xfff
op_amp
(paren
l_int|4
op_star
(paren
r_int
r_int
)paren
id|usbfrnum
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  flbaseadd = %08x&bslash;n&quot;
comma
id|flbaseadd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  sof       =       %02x&bslash;n&quot;
comma
id|sof
)paren
suffix:semicolon
id|show_sc
c_func
(paren
l_int|1
comma
id|portsc1
)paren
suffix:semicolon
id|show_sc
c_func
(paren
l_int|2
comma
id|portsc2
)paren
suffix:semicolon
)brace
DECL|macro|uhci_link_to_qh
mdefine_line|#define uhci_link_to_qh(x) ((struct uhci_qh *) uhci_link_to_td(x))
DECL|function|uhci_link_to_td
r_struct
id|uhci_td
op_star
id|uhci_link_to_td
c_func
(paren
r_int
r_int
id|link
)paren
(brace
r_if
c_cond
(paren
id|link
op_amp
l_int|1
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|bus_to_virt
c_func
(paren
id|link
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
)brace
DECL|function|show_queue
r_void
id|show_queue
c_func
(paren
r_struct
id|uhci_qh
op_star
id|qh
)paren
(brace
r_struct
id|uhci_td
op_star
id|td
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;    link = %p, element = %p&bslash;n&quot;
comma
id|qh-&gt;link
comma
id|qh-&gt;element
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|qh-&gt;element
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    td 0 = NULL&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|td
op_assign
id|uhci_link_to_td
c_func
(paren
id|qh-&gt;element
)paren
suffix:semicolon
id|td
suffix:semicolon
id|td
op_assign
id|uhci_link_to_td
c_func
(paren
id|td-&gt;link
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    td %d = %p&bslash;n&quot;
comma
id|i
op_increment
comma
id|td
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;    &quot;
)paren
suffix:semicolon
id|show_td
c_func
(paren
id|td
)paren
suffix:semicolon
)brace
)brace
DECL|function|is_skeleton_qh
r_int
id|is_skeleton_qh
c_func
(paren
r_struct
id|uhci
op_star
id|uhci
comma
r_struct
id|uhci_qh
op_star
id|qh
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|UHCI_MAXQH
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|qh
op_eq
id|uhci-&gt;root_hub-&gt;qh
op_plus
id|j
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|qh_names
r_static
r_const
r_char
op_star
id|qh_names
(braket
)braket
op_assign
(brace
l_string|&quot;isochronous&quot;
comma
l_string|&quot;interrupt2&quot;
comma
l_string|&quot;interrupt4&quot;
comma
l_string|&quot;interrupt8&quot;
comma
l_string|&quot;interrupt16&quot;
comma
l_string|&quot;interrupt32&quot;
comma
l_string|&quot;interrupt64&quot;
comma
l_string|&quot;interrupt128&quot;
comma
l_string|&quot;interrupt256&quot;
comma
l_string|&quot;control&quot;
comma
l_string|&quot;bulk0&quot;
comma
l_string|&quot;bulk1&quot;
comma
l_string|&quot;bulk2&quot;
comma
l_string|&quot;bulk3&quot;
comma
l_string|&quot;unused&quot;
comma
l_string|&quot;unused&quot;
)brace
suffix:semicolon
DECL|function|show_queues
r_void
id|show_queues
c_func
(paren
r_struct
id|uhci
op_star
id|uhci
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|uhci_qh
op_star
id|qh
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UHCI_MAXQH
suffix:semicolon
op_increment
id|i
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  %s:&bslash;n&quot;
comma
id|qh_names
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;  qh #%d, %p&bslash;n&quot;
comma
id|i
comma
id|virt_to_bus
c_func
(paren
id|uhci-&gt;root_hub-&gt;qh
op_plus
id|i
)paren
)paren
suffix:semicolon
id|show_queue
c_func
(paren
id|uhci-&gt;root_hub-&gt;qh
op_plus
id|i
)paren
suffix:semicolon
macro_line|#endif
id|qh
op_assign
id|uhci_link_to_qh
c_func
(paren
id|uhci-&gt;root_hub-&gt;qh
(braket
id|i
)braket
dot
id|link
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|qh
suffix:semicolon
id|qh
op_assign
id|uhci_link_to_qh
c_func
(paren
id|qh-&gt;link
)paren
)paren
(brace
r_if
c_cond
(paren
id|is_skeleton_qh
c_func
(paren
id|uhci
comma
id|qh
)paren
)paren
r_break
suffix:semicolon
id|show_queue
c_func
(paren
id|qh
)paren
suffix:semicolon
)brace
)brace
)brace
eof
