multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&t;inode.c  --  Inode/Dentry functions for the USB device file system.&n; *&n; *&t;Copyright (C) 2000&n; *          Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  $Id: inode.c,v 1.3 2000/01/11 13:58:25 tom Exp $&n; *&n; *  History:&n; *   0.1  04.01.2000  Created&n; */
multiline_comment|/*****************************************************************************/
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/usbdevice_fs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* --------------------------------------------------------------------- */
r_static
id|LIST_HEAD
c_func
(paren
id|superlist
)paren
suffix:semicolon
DECL|struct|special
r_struct
id|special
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|fops
r_struct
id|file_operations
op_star
id|fops
suffix:semicolon
DECL|member|inode
r_struct
id|inode
op_star
id|inode
suffix:semicolon
DECL|member|inodes
r_struct
id|list_head
id|inodes
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|special
r_static
r_struct
id|special
id|special
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;devices&quot;
comma
op_amp
id|usbdevfs_devices_fops
comma
)brace
comma
(brace
l_string|&quot;drivers&quot;
comma
op_amp
id|usbdevfs_drivers_fops
comma
)brace
)brace
suffix:semicolon
DECL|macro|NRSPECIAL
mdefine_line|#define NRSPECIAL (sizeof(special)/sizeof(special[0]))
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|dnumber
r_static
r_int
id|dnumber
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_const
r_char
op_star
id|name
suffix:semicolon
r_int
r_int
id|s
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_name.len
op_ne
l_int|3
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|name
op_assign
id|dentry-&gt;d_name.name
suffix:semicolon
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
template_param
l_char|&squot;9&squot;
op_logical_or
id|name
(braket
l_int|1
)braket
template_param
l_char|&squot;9&squot;
op_logical_or
id|name
(braket
l_int|2
)braket
template_param
l_char|&squot;9&squot;
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|s
op_assign
id|name
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
id|s
op_assign
id|s
op_star
l_int|10
op_plus
id|name
(braket
l_int|1
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
id|s
op_assign
id|s
op_star
l_int|10
op_plus
id|name
(braket
l_int|2
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
multiline_comment|/*&n; * utility functions; should be called with the kernel lock held&n; * to protect against busses/devices appearing/disappearing&n; */
DECL|function|new_dev_inode
r_static
r_void
id|new_dev_inode
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
r_int
id|devnum
op_assign
id|dev-&gt;devnum
suffix:semicolon
r_int
r_int
id|busnum
op_assign
id|dev-&gt;bus-&gt;busnum
suffix:semicolon
r_if
c_cond
(paren
id|devnum
template_param
l_int|127
op_logical_or
id|busnum
OG
l_int|255
)paren
r_return
suffix:semicolon
id|inode
op_assign
id|iget
c_func
(paren
id|sb
comma
id|IDEVICE
op_or
(paren
id|busnum
op_lshift
l_int|8
)paren
op_or
id|devnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbdevfs: cannot create inode for bus %u device %u&bslash;n&quot;
comma
id|busnum
comma
id|devnum
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|sb-&gt;u.usbdevfs_sb.devuid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|sb-&gt;u.usbdevfs_sb.devgid
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|sb-&gt;u.usbdevfs_sb.devmode
op_or
id|S_IFREG
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|usbdevfs_device_file_operations
suffix:semicolon
id|inode-&gt;i_size
op_assign
r_sizeof
(paren
r_struct
id|usb_device_descriptor
)paren
suffix:semicolon
id|inode-&gt;u.usbdev_i.p.dev
op_assign
id|dev
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
comma
op_amp
id|sb-&gt;u.usbdevfs_sb.ilist
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
comma
op_amp
id|dev-&gt;inodes
)paren
suffix:semicolon
)brace
DECL|function|recurse_new_dev_inode
r_static
r_void
id|recurse_new_dev_inode
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
suffix:semicolon
id|new_dev_inode
c_func
(paren
id|dev
comma
id|sb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;maxchild
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;children
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|recurse_new_dev_inode
c_func
(paren
id|dev-&gt;children
(braket
id|i
)braket
comma
id|sb
)paren
suffix:semicolon
)brace
)brace
DECL|function|new_bus_inode
r_static
r_void
id|new_bus_inode
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
comma
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
r_int
id|busnum
op_assign
id|bus-&gt;busnum
suffix:semicolon
r_if
c_cond
(paren
id|busnum
OG
l_int|255
)paren
r_return
suffix:semicolon
id|inode
op_assign
id|iget
c_func
(paren
id|sb
comma
id|IBUS
op_or
(paren
id|busnum
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;usbdevfs: cannot create inode for bus %u&bslash;n&quot;
comma
id|busnum
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|sb-&gt;u.usbdevfs_sb.busuid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|sb-&gt;u.usbdevfs_sb.busgid
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|sb-&gt;u.usbdevfs_sb.busmode
op_or
id|S_IFDIR
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|usbdevfs_bus_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|usbdevfs_bus_file_operations
suffix:semicolon
id|inode-&gt;u.usbdev_i.p.bus
op_assign
id|bus
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
comma
op_amp
id|sb-&gt;u.usbdevfs_sb.ilist
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
comma
op_amp
id|bus-&gt;inodes
)paren
suffix:semicolon
)brace
DECL|function|free_inode
r_static
r_void
id|free_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|inode-&gt;u.usbdev_i.p.bus
op_assign
l_int|NULL
suffix:semicolon
id|inode-&gt;u.usbdev_i.p.dev
op_assign
l_int|NULL
suffix:semicolon
id|inode-&gt;i_mode
op_and_assign
op_complement
id|S_IRWXUGO
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|inode-&gt;i_gid
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
DECL|function|usbdevfs_findbus
r_static
r_struct
id|usb_bus
op_star
id|usbdevfs_findbus
c_func
(paren
r_int
id|busnr
)paren
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|usb_bus
op_star
id|bus
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|usb_bus_list.next
suffix:semicolon
id|list
op_ne
op_amp
id|usb_bus_list
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
id|bus
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|usb_bus
comma
id|bus_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bus-&gt;busnum
op_eq
id|busnr
)paren
r_return
id|bus
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_struct
id|usb_device
op_star
id|finddev
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
id|devnr
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_struct
id|usb_device
op_star
id|d2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;devnum
op_eq
id|devnr
)paren
r_return
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;maxchild
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;children
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|d2
op_assign
id|finddev
c_func
(paren
id|dev-&gt;children
(braket
id|i
)braket
comma
id|devnr
)paren
)paren
)paren
r_return
id|d2
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|usb_device
op_star
id|usbdevfs_finddevice
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
comma
r_int
id|devnr
)paren
(brace
r_return
id|finddev
c_func
(paren
id|bus-&gt;root_hub
comma
id|devnr
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|usbdevfs_revalidate
r_static
r_int
id|usbdevfs_revalidate
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|flags
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ITYPE
c_func
(paren
id|inode-&gt;i_ino
)paren
op_eq
id|IBUS
op_logical_and
op_logical_neg
id|inode-&gt;u.usbdev_i.p.bus
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ITYPE
c_func
(paren
id|inode-&gt;i_ino
)paren
op_eq
id|IDEVICE
op_logical_and
op_logical_neg
id|inode-&gt;u.usbdev_i.p.dev
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|usbdevfs_dentry_operations
r_static
r_struct
id|dentry_operations
id|usbdevfs_dentry_operations
op_assign
(brace
id|d_revalidate
suffix:colon
id|usbdevfs_revalidate
comma
)brace
suffix:semicolon
DECL|function|usbdevfs_root_lookup
r_static
r_struct
id|dentry
op_star
id|usbdevfs_root_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|busnr
suffix:semicolon
r_int
r_int
id|ino
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|dir-&gt;i_ino
op_ne
id|IROOT
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|dentry-&gt;d_op
op_assign
op_amp
id|usbdevfs_dentry_operations
suffix:semicolon
id|busnr
op_assign
id|dnumber
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|busnr
op_ge
l_int|0
op_logical_and
id|busnr
op_le
l_int|255
)paren
id|ino
op_assign
id|IBUS
op_or
(paren
id|busnr
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NRSPECIAL
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|special
(braket
id|i
)braket
dot
id|name
)paren
op_eq
id|dentry-&gt;d_name.len
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|special
(braket
id|i
)braket
dot
id|name
comma
id|dentry-&gt;d_name.name
comma
id|dentry-&gt;d_name.len
)paren
)paren
(brace
id|ino
op_assign
id|ISPECIAL
op_or
(paren
id|i
op_plus
id|IROOT
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|inode
op_assign
id|iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode
op_logical_and
id|ITYPE
c_func
(paren
id|ino
)paren
op_eq
id|IBUS
op_logical_and
id|inode-&gt;u.usbdev_i.p.bus
op_eq
l_int|NULL
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode
op_assign
l_int|NULL
suffix:semicolon
)brace
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|usbdevfs_bus_lookup
r_static
r_struct
id|dentry
op_star
id|usbdevfs_bus_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
id|devnr
suffix:semicolon
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|ITYPE
c_func
(paren
id|dir-&gt;i_ino
)paren
op_ne
id|IBUS
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|dentry-&gt;d_op
op_assign
op_amp
id|usbdevfs_dentry_operations
suffix:semicolon
id|devnr
op_assign
id|dnumber
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devnr
template_param
l_int|127
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|inode
op_assign
id|iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|IDEVICE
op_or
(paren
id|dir-&gt;i_ino
op_amp
(paren
l_int|0xff
op_lshift
l_int|8
)paren
)paren
op_or
id|devnr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode
op_logical_and
id|inode-&gt;u.usbdev_i.p.dev
op_eq
l_int|NULL
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode
op_assign
l_int|NULL
suffix:semicolon
)brace
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|usbdevfs_root_readdir
r_static
r_int
id|usbdevfs_root_readdir
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
r_int
id|ino
op_assign
id|inode-&gt;i_ino
suffix:semicolon
r_struct
id|special
op_star
id|spec
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|usb_bus
op_star
id|bus
suffix:semicolon
r_char
id|numbuf
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|ino
op_ne
id|IROOT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|i
op_assign
id|filp-&gt;f_pos
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|i
comma
id|IROOT
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|i
comma
id|IROOT
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
multiline_comment|/* fall through */
r_default
suffix:colon
(brace
)brace
r_while
c_loop
(paren
id|i
op_ge
l_int|2
op_logical_and
id|i
OL
l_int|2
op_plus
id|NRSPECIAL
)paren
(brace
id|spec
op_assign
op_amp
id|special
(braket
id|filp-&gt;f_pos
op_minus
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
id|spec-&gt;name
comma
id|strlen
c_func
(paren
id|spec-&gt;name
)paren
comma
id|i
comma
id|ISPECIAL
op_or
(paren
id|filp-&gt;f_pos
op_minus
l_int|2
op_plus
id|IROOT
)paren
comma
id|DT_UNKNOWN
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|2
op_plus
id|NRSPECIAL
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_sub_assign
l_int|2
op_plus
id|NRSPECIAL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|usb_bus_list.next
suffix:semicolon
id|list
op_ne
op_amp
id|usb_bus_list
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
(brace
id|i
op_decrement
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|bus
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|usb_bus
comma
id|bus_list
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|numbuf
comma
l_string|&quot;%03d&quot;
comma
id|bus-&gt;busnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
id|numbuf
comma
l_int|3
comma
id|filp-&gt;f_pos
comma
id|IBUS
op_or
(paren
(paren
id|bus-&gt;busnum
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
comma
id|DT_UNKNOWN
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|bus_readdir
r_static
r_int
id|bus_readdir
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ino
comma
r_int
id|pos
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_char
id|numbuf
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
id|pos
suffix:semicolon
id|sprintf
c_func
(paren
id|numbuf
comma
l_string|&quot;%03d&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OG
l_int|0
)paren
id|pos
op_decrement
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
id|numbuf
comma
l_int|3
comma
id|filp-&gt;f_pos
comma
id|ino
op_or
(paren
id|dev-&gt;devnum
op_amp
l_int|0xff
)paren
comma
id|DT_UNKNOWN
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;maxchild
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;children
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|pos
op_assign
id|bus_readdir
c_func
(paren
id|dev-&gt;children
(braket
id|i
)braket
comma
id|ino
comma
id|pos
comma
id|filp
comma
id|dirent
comma
id|filldir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|pos
suffix:semicolon
)brace
DECL|function|usbdevfs_bus_readdir
r_static
r_int
id|usbdevfs_bus_readdir
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
r_int
id|ino
op_assign
id|inode-&gt;i_ino
suffix:semicolon
r_struct
id|usb_bus
op_star
id|bus
suffix:semicolon
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|ITYPE
c_func
(paren
id|ino
)paren
op_ne
id|IBUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
(paren
r_int
r_int
)paren
id|filp-&gt;f_pos
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|filp-&gt;f_pos
comma
id|ino
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|filp-&gt;f_pos
comma
id|IROOT
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fall through */
r_default
suffix:colon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|bus
op_assign
id|usbdevfs_findbus
c_func
(paren
id|IBUSNR
c_func
(paren
id|ino
)paren
)paren
suffix:semicolon
id|bus_readdir
c_func
(paren
id|bus-&gt;root_hub
comma
id|IDEVICE
op_or
(paren
(paren
id|bus-&gt;busnum
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
comma
id|filp-&gt;f_pos
op_minus
l_int|2
comma
id|filp
comma
id|dirent
comma
id|filldir
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|variable|usbdevfs_root_file_operations
r_static
r_struct
id|file_operations
id|usbdevfs_root_file_operations
op_assign
(brace
id|readdir
suffix:colon
id|usbdevfs_root_readdir
comma
)brace
suffix:semicolon
DECL|variable|usbdevfs_root_inode_operations
r_static
r_struct
id|inode_operations
id|usbdevfs_root_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|usbdevfs_root_lookup
comma
)brace
suffix:semicolon
DECL|variable|usbdevfs_bus_file_operations
r_static
r_struct
id|file_operations
id|usbdevfs_bus_file_operations
op_assign
(brace
id|readdir
suffix:colon
id|usbdevfs_bus_readdir
comma
)brace
suffix:semicolon
DECL|variable|usbdevfs_bus_inode_operations
r_static
r_struct
id|inode_operations
id|usbdevfs_bus_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|usbdevfs_bus_lookup
comma
)brace
suffix:semicolon
DECL|function|usbdevfs_read_inode
r_static
r_void
id|usbdevfs_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|special
op_star
id|spec
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_atime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFREG
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|inode-&gt;i_uid
op_assign
l_int|0
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
)paren
suffix:semicolon
id|inode-&gt;u.usbdev_i.p.dev
op_assign
l_int|NULL
suffix:semicolon
id|inode-&gt;u.usbdev_i.p.bus
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|ITYPE
c_func
(paren
id|inode-&gt;i_ino
)paren
)paren
(brace
r_case
id|ISPECIAL
suffix:colon
r_if
c_cond
(paren
id|inode-&gt;i_ino
op_eq
id|IROOT
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|usbdevfs_root_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|usbdevfs_root_file_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode-&gt;i_ino
op_le
id|IROOT
op_logical_or
id|inode-&gt;i_ino
OG
id|IROOT
op_plus
id|NRSPECIAL
)paren
r_return
suffix:semicolon
id|spec
op_assign
op_amp
id|special
(braket
id|inode-&gt;i_ino
op_minus
(paren
id|IROOT
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|inode-&gt;i_fop
op_assign
id|spec-&gt;fops
suffix:semicolon
r_return
suffix:semicolon
r_case
id|IDEVICE
suffix:colon
r_return
suffix:semicolon
r_case
id|IBUS
suffix:colon
r_return
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
)brace
DECL|function|usbdevfs_put_super
r_static
r_void
id|usbdevfs_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|sb-&gt;u.usbdevfs_sb.slist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sb-&gt;u.usbdevfs_sb.slist
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|sb-&gt;u.usbdevfs_sb.ilist
)paren
)paren
id|free_inode
c_func
(paren
id|list_entry
c_func
(paren
id|sb-&gt;u.usbdevfs_sb.ilist.next
comma
r_struct
id|inode
comma
id|u.usbdev_i.slist
)paren
)paren
suffix:semicolon
)brace
DECL|function|usbdevfs_statfs
r_static
r_int
id|usbdevfs_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|buf
)paren
(brace
id|buf-&gt;f_type
op_assign
id|USBDEVICE_SUPER_MAGIC
suffix:semicolon
id|buf-&gt;f_bsize
op_assign
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
multiline_comment|/* ??? */
id|buf-&gt;f_bfree
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_bavail
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_ffree
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_namelen
op_assign
id|NAME_MAX
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|usbdevfs_sops
r_static
r_struct
id|super_operations
id|usbdevfs_sops
op_assign
(brace
id|read_inode
suffix:colon
id|usbdevfs_read_inode
comma
id|put_super
suffix:colon
id|usbdevfs_put_super
comma
id|statfs
suffix:colon
id|usbdevfs_statfs
comma
)brace
suffix:semicolon
DECL|function|usbdevfs_read_super
r_struct
id|super_block
op_star
id|usbdevfs_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|s
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
r_struct
id|inode
op_star
id|root_inode
comma
op_star
id|inode
suffix:semicolon
r_struct
id|list_head
op_star
id|blist
suffix:semicolon
r_struct
id|usb_bus
op_star
id|bus
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|uid_t
id|devuid
op_assign
l_int|0
comma
id|busuid
op_assign
l_int|0
comma
id|listuid
op_assign
l_int|0
suffix:semicolon
id|gid_t
id|devgid
op_assign
l_int|0
comma
id|busgid
op_assign
l_int|0
comma
id|listgid
op_assign
l_int|0
suffix:semicolon
id|umode_t
id|devmode
op_assign
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|busmode
op_assign
id|S_IXUGO
op_or
id|S_IRUGO
comma
id|listmode
op_assign
id|S_IRUGO
suffix:semicolon
r_char
op_star
id|curopt
op_assign
l_int|NULL
comma
op_star
id|value
suffix:semicolon
multiline_comment|/* parse options */
r_if
c_cond
(paren
id|data
)paren
id|curopt
op_assign
id|strtok
c_func
(paren
id|data
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|curopt
suffix:semicolon
id|curopt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_assign
id|strchr
c_func
(paren
id|curopt
comma
l_char|&squot;=&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
op_star
id|value
op_increment
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;devuid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|devuid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;devgid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|devgid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;devmode&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|devmode
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
op_amp
id|S_IRWXUGO
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;busuid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|busuid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;busgid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|busgid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;busmode&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|busmode
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
op_amp
id|S_IRWXUGO
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;listuid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|listuid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;listgid&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|listgid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|curopt
comma
l_string|&quot;listmode&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|value
(braket
l_int|0
)braket
)paren
r_goto
id|opterr
suffix:semicolon
id|listmode
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
op_amp
id|S_IRWXUGO
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
r_goto
id|opterr
suffix:semicolon
)brace
)brace
multiline_comment|/* fill superblock */
id|s-&gt;s_blocksize
op_assign
l_int|1024
suffix:semicolon
id|s-&gt;s_blocksize_bits
op_assign
l_int|10
suffix:semicolon
id|s-&gt;s_magic
op_assign
id|USBDEVICE_SUPER_MAGIC
suffix:semicolon
id|s-&gt;s_op
op_assign
op_amp
id|usbdevfs_sops
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;u.usbdevfs_sb.slist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;u.usbdevfs_sb.ilist
)paren
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.devuid
op_assign
id|devuid
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.devgid
op_assign
id|devgid
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.devmode
op_assign
id|devmode
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.busuid
op_assign
id|busuid
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.busgid
op_assign
id|busgid
suffix:semicolon
id|s-&gt;u.usbdevfs_sb.busmode
op_assign
id|busmode
suffix:semicolon
id|root_inode
op_assign
id|iget
c_func
(paren
id|s
comma
id|IROOT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root_inode
)paren
r_goto
id|out_no_root
suffix:semicolon
id|s-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;s_root
)paren
r_goto
id|out_no_root
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;u.usbdevfs_sb.slist
comma
op_amp
id|superlist
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NRSPECIAL
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode
op_assign
id|iget
c_func
(paren
id|s
comma
id|IROOT
op_plus
l_int|1
op_plus
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|listuid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|listgid
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|listmode
op_or
id|S_IFREG
suffix:semicolon
id|special
(braket
id|i
)braket
dot
id|inode
op_assign
id|inode
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.slist
comma
op_amp
id|s-&gt;u.usbdevfs_sb.ilist
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|inode-&gt;u.usbdev_i.dlist
comma
op_amp
id|special
(braket
id|i
)braket
dot
id|inodes
)paren
suffix:semicolon
)brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|blist
op_assign
id|usb_bus_list.next
suffix:semicolon
id|blist
op_ne
op_amp
id|usb_bus_list
suffix:semicolon
id|blist
op_assign
id|blist-&gt;next
)paren
(brace
id|bus
op_assign
id|list_entry
c_func
(paren
id|blist
comma
r_struct
id|usb_bus
comma
id|bus_list
)paren
suffix:semicolon
id|new_bus_inode
c_func
(paren
id|bus
comma
id|s
)paren
suffix:semicolon
id|recurse_new_dev_inode
c_func
(paren
id|bus-&gt;root_hub
comma
id|s
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
id|out_no_root
suffix:colon
id|printk
c_func
(paren
l_string|&quot;usbdevfs_read_super: get root inode failed&bslash;n&quot;
)paren
suffix:semicolon
id|iput
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
id|opterr
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;usbdevfs: mount parameter error&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
id|DECLARE_FSTYPE
c_func
(paren
id|usbdevice_fs_type
comma
l_string|&quot;usbdevfs&quot;
comma
id|usbdevfs_read_super
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|update_special_inodes
r_static
r_void
id|update_special_inodes
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NRSPECIAL
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|special
(braket
id|i
)braket
dot
id|inode
suffix:semicolon
r_if
c_cond
(paren
id|inode
)paren
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
)brace
)brace
DECL|function|usbdevfs_add_bus
r_void
id|usbdevfs_add_bus
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
)paren
(brace
r_struct
id|list_head
op_star
id|slist
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|slist
op_assign
id|superlist.next
suffix:semicolon
id|slist
op_ne
op_amp
id|superlist
suffix:semicolon
id|slist
op_assign
id|slist-&gt;next
)paren
id|new_bus_inode
c_func
(paren
id|bus
comma
id|list_entry
c_func
(paren
id|slist
comma
r_struct
id|super_block
comma
id|u.usbdevfs_sb.slist
)paren
)paren
suffix:semicolon
id|update_special_inodes
c_func
(paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|usbdevfs_conn_disc_event
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|usbdevfs_remove_bus
r_void
id|usbdevfs_remove_bus
c_func
(paren
r_struct
id|usb_bus
op_star
id|bus
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|bus-&gt;inodes
)paren
)paren
id|free_inode
c_func
(paren
id|list_entry
c_func
(paren
id|bus-&gt;inodes.next
comma
r_struct
id|inode
comma
id|u.usbdev_i.dlist
)paren
)paren
suffix:semicolon
id|update_special_inodes
c_func
(paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|usbdevfs_conn_disc_event
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|usbdevfs_add_device
r_void
id|usbdevfs_add_device
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_struct
id|list_head
op_star
id|slist
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|slist
op_assign
id|superlist.next
suffix:semicolon
id|slist
op_ne
op_amp
id|superlist
suffix:semicolon
id|slist
op_assign
id|slist-&gt;next
)paren
id|new_dev_inode
c_func
(paren
id|dev
comma
id|list_entry
c_func
(paren
id|slist
comma
r_struct
id|super_block
comma
id|u.usbdevfs_sb.slist
)paren
)paren
suffix:semicolon
id|update_special_inodes
c_func
(paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|usbdevfs_conn_disc_event
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|usbdevfs_remove_device
r_void
id|usbdevfs_remove_device
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
)paren
(brace
r_struct
id|dev_state
op_star
id|ds
suffix:semicolon
r_struct
id|siginfo
id|sinfo
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|dev-&gt;inodes
)paren
)paren
id|free_inode
c_func
(paren
id|list_entry
c_func
(paren
id|dev-&gt;inodes.next
comma
r_struct
id|inode
comma
id|u.usbdev_i.dlist
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|dev-&gt;filelist
)paren
)paren
(brace
id|ds
op_assign
id|list_entry
c_func
(paren
id|dev-&gt;filelist.next
comma
r_struct
id|dev_state
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|ds-&gt;list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|ds-&gt;list
)paren
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|ds-&gt;devsem
)paren
suffix:semicolon
id|ds-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|ds-&gt;devsem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ds-&gt;discsignr
)paren
(brace
id|sinfo.si_signo
op_assign
id|SIGPIPE
suffix:semicolon
id|sinfo.si_errno
op_assign
id|EPIPE
suffix:semicolon
id|sinfo.si_code
op_assign
id|SI_ASYNCIO
suffix:semicolon
id|sinfo.si_addr
op_assign
id|ds-&gt;disccontext
suffix:semicolon
id|send_sig_info
c_func
(paren
id|ds-&gt;discsignr
comma
op_amp
id|sinfo
comma
id|ds-&gt;disctask
)paren
suffix:semicolon
)brace
)brace
id|update_special_inodes
c_func
(paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|usbdevfs_conn_disc_event
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifdef CONFIG_PROC_FS&t;&t;
DECL|variable|usbdir
r_static
r_struct
id|proc_dir_entry
op_star
id|usbdir
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif&t;
DECL|function|usbdevfs_init
r_int
id|__init
id|usbdevfs_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|ret
op_assign
l_int|0
suffix:semicolon
id|ret
OL
id|NRSPECIAL
suffix:semicolon
id|ret
op_increment
)paren
(brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|special
(braket
id|ret
)braket
dot
id|inodes
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_register
c_func
(paren
op_amp
id|usbdevfs_driver
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|register_filesystem
c_func
(paren
op_amp
id|usbdevice_fs_type
)paren
)paren
)paren
id|usb_deregister
c_func
(paren
op_amp
id|usbdevfs_driver
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS&t;&t;
multiline_comment|/* create mount point for usbdevfs */
id|usbdir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;usb&quot;
comma
id|proc_bus
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
id|ret
suffix:semicolon
)brace
DECL|function|usbdevfs_cleanup
r_void
id|__exit
id|usbdevfs_cleanup
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|usbdevfs_driver
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|usbdevice_fs_type
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS&t;
r_if
c_cond
(paren
id|usbdir
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;usb&quot;
comma
id|proc_bus
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#if 0
id|module_init
c_func
(paren
id|usbdevfs_init
)paren
suffix:semicolon
id|module_exit
c_func
(paren
id|usbdevfs_cleanup
)paren
suffix:semicolon
macro_line|#endif
eof
