multiline_comment|/*&n; *  linux/drivers/char/console.c&n; *&n; *  Copyright (C) 1991, 1992  Linus Torvalds&n; */
multiline_comment|/*&n; *&t;console.c&n; *&n; * This module exports the console io functions:&n; * &n; *     &squot;void do_keyboard_interrupt(void)&squot;&n; *&n; *     &squot;int vc_allocate(unsigned int console)&squot; &n; *     &squot;int vc_cons_allocated(unsigned int console)&squot;&n; *     &squot;int vc_resize(unsigned long lines, unsigned long cols)&squot;&n; *     &squot;void vc_disallocate(unsigned int currcons)&squot;&n; *&n; *     &squot;long con_init(long)&squot;&n; *     &squot;int con_open(struct tty_struct *tty, struct file * filp)&squot;&n; *     &squot;void con_write(struct tty_struct * tty)&squot;&n; *     &squot;void console_print(const char * b)&squot;&n; *     &squot;void update_screen(int new_console)&squot;&n; *&n; *     &squot;void do_blank_screen(int)&squot;&n; *     &squot;void do_unblank_screen(void)&squot;&n; *     &squot;void poke_blanked_console(void)&squot;&n; *     &squot;void scrollback(int lines)&squot;&n; *     &squot;void scrollfront(int lines)&squot;&n; *     &squot;int do_screendump(int arg, int mode)&squot;&n; *&n; *     &squot;int con_get_font(char *)&squot; &n; *     &squot;int con_set_font(char *)&squot; &n; *     &squot;int con_get_trans(char *)&squot;&n; *     &squot;int con_set_trans(char *)&squot;&n; *&n; *     &squot;int set_selection(const int arg)&squot;&n; *     &squot;int paste_selection(struct tty_struct *tty)&squot;&n; *     &squot;int sel_loadlut(const int arg)&squot;&n; *     &squot;int mouse_reporting(void)&squot;&n; * &n; * Hopefully this will be a rather complete VT102 implementation.&n; *&n; * Beeping thanks to John T Kohl.&n; * &n; * Virtual Consoles, Screen Blanking, Screen Dumping, Color, Graphics&n; *   Chars, and VT100 enhancements by Peter MacDonald.&n; *&n; * Copy and paste function by Andrew Haylett,&n; *   some enhancements by Alessandro Rubini.&n; *&n; * User definable mapping table and font loading by Eugene G. Crosser,&n; * &lt;crosser@pccross.msk.su&gt;&n; *&n; * Code to check for different video-cards mostly by Galen Hunt,&n; * &lt;g-hunt@ee.utah.edu&gt;&n; *&n; * Rudimentary ISO 10646/Unicode/UTF-8 character set support by&n; * Markus Kuhn, &lt;mskuhn@immd4.informatik.uni-erlangen.de&gt;.&n; *&n; * Dynamic allocation of consoles, aeb@cwi.nl, May 1994&n; * Resizing of consoles, aeb, 940926&n; *&n; * Code for xterm like mouse click reporting by Peter Orbaek 20-Jul-94&n; * &lt;poe@daimi.aau.dk&gt;&n; *&n; */
DECL|macro|BLANK
mdefine_line|#define BLANK 0x0020
DECL|macro|CAN_LOAD_EGA_FONTS
mdefine_line|#define CAN_LOAD_EGA_FONTS    /* undefine if the user must not do this */
multiline_comment|/* A bitmap for codes &lt;32. A bit of 1 indicates that the code&n; * corresponding to that bit number invokes some special action&n; * (such as cursor movement) and should not be displayed as a&n; * glyph unless the disp_ctrl mode is explicitly enabled.&n; */
DECL|macro|CTRL_ACTION
mdefine_line|#define CTRL_ACTION 0xd00ff80
multiline_comment|/*&n; *  NOTE!!! We sometimes disable and enable interrupts for a short while&n; * (to put a word in video IO), but this will work even for keyboard&n; * interrupts. We know interrupts aren&squot;t enabled when getting a keyboard&n; * interrupt, as we use trap-gates. Hopefully all is well.&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &quot;kbd_kern.h&quot;
macro_line|#include &quot;vt_kern.h&quot;
macro_line|#ifdef __alpha__
DECL|function|scrwritew
r_static
r_inline
r_void
id|scrwritew
c_func
(paren
r_int
r_int
id|val
comma
r_int
r_int
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|addr
OL
l_int|0
)paren
op_star
id|addr
op_assign
id|val
suffix:semicolon
r_else
id|writew
c_func
(paren
id|val
comma
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|scrreadw
r_static
r_inline
r_int
r_int
id|scrreadw
c_func
(paren
r_int
r_int
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|addr
OL
l_int|0
)paren
r_return
op_star
id|addr
suffix:semicolon
r_return
id|readw
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|scrwritew
r_static
r_inline
r_void
id|scrwritew
c_func
(paren
r_int
r_int
id|val
comma
r_int
r_int
op_star
id|addr
)paren
(brace
op_star
id|addr
op_assign
id|val
suffix:semicolon
)brace
DECL|function|scrreadw
r_static
r_inline
r_int
r_int
id|scrreadw
c_func
(paren
r_int
r_int
op_star
id|addr
)paren
(brace
r_return
op_star
id|addr
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|writew
mdefine_line|#define writew(x,y) scrwritew((x),(y))
DECL|macro|readw
mdefine_line|#define readw(x) scrreadw(x)
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b)&t;((a) &lt; (b) ? (a) : (b))
macro_line|#endif
DECL|variable|console_driver
r_struct
id|tty_driver
id|console_driver
suffix:semicolon
DECL|variable|console_refcount
r_static
r_int
id|console_refcount
suffix:semicolon
DECL|variable|console_table
r_static
r_struct
id|tty_struct
op_star
id|console_table
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|console_termios
r_static
r_struct
id|termios
op_star
id|console_termios
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|console_termios_locked
r_static
r_struct
id|termios
op_star
id|console_termios_locked
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_SELECTION
macro_line|#include &lt;linux/ctype.h&gt;
multiline_comment|/* Routines for selection control. */
r_int
id|set_selection
c_func
(paren
r_const
r_int
id|arg
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
suffix:semicolon
r_int
id|paste_selection
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
suffix:semicolon
r_static
r_void
id|clear_selection
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|highlight_pointer
c_func
(paren
r_const
r_int
id|currcons
comma
r_const
r_int
id|where
)paren
suffix:semicolon
multiline_comment|/* Variables for selection control. */
multiline_comment|/* Use a dynamic buffer, instead of static (Dec 1994) */
DECL|variable|sel_cons
r_static
r_int
id|sel_cons
op_assign
l_int|0
suffix:semicolon
DECL|variable|sel_start
r_static
r_int
id|sel_start
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|sel_end
r_static
r_int
id|sel_end
suffix:semicolon
DECL|variable|sel_buffer
r_static
r_char
op_star
id|sel_buffer
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_SELECTION */
DECL|macro|NPAR
mdefine_line|#define NPAR 16
r_static
r_void
id|con_setsize
c_func
(paren
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
)paren
suffix:semicolon
r_static
r_void
id|vc_init
c_func
(paren
r_int
r_int
id|console
comma
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
comma
r_int
id|do_clear
)paren
suffix:semicolon
r_static
r_void
id|get_scrmem
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|set_scrmem
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
suffix:semicolon
r_static
r_void
id|set_origin
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|blank_screen
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|unblank_screen
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|poke_blanked_console
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|gotoxy
c_func
(paren
r_int
id|currcons
comma
r_int
id|new_x
comma
r_int
id|new_y
)paren
suffix:semicolon
r_static
r_void
id|save_cur
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_inline
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|reset_terminal
c_func
(paren
r_int
id|currcons
comma
r_int
id|do_clear
)paren
suffix:semicolon
r_extern
r_void
id|reset_vc
c_func
(paren
r_int
r_int
id|new_console
)paren
suffix:semicolon
r_extern
r_void
id|vt_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|register_console
c_func
(paren
r_void
(paren
op_star
id|proc
)paren
(paren
r_const
r_char
op_star
)paren
)paren
suffix:semicolon
r_extern
r_void
id|vesa_blank
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|vesa_unblank
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|compute_shiftstate
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|conv_uni_to_pc
c_func
(paren
r_int
r_int
id|ucs
)paren
suffix:semicolon
multiline_comment|/* Description of the hardware situation */
DECL|variable|video_type
r_static
r_int
r_char
id|video_type
suffix:semicolon
multiline_comment|/* Type of display being used&t;*/
DECL|variable|video_mem_base
r_static
r_int
r_int
id|video_mem_base
suffix:semicolon
multiline_comment|/* Base of video memory&t;&t;*/
DECL|variable|video_mem_term
r_static
r_int
r_int
id|video_mem_term
suffix:semicolon
multiline_comment|/* End of video memory&t;&t;*/
DECL|variable|video_page
r_static
r_int
r_char
id|video_page
suffix:semicolon
multiline_comment|/* Initial video page (unused)  */
DECL|variable|video_port_reg
r_int
r_int
id|video_port_reg
suffix:semicolon
multiline_comment|/* Video register select port&t;*/
DECL|variable|video_port_val
r_int
r_int
id|video_port_val
suffix:semicolon
multiline_comment|/* Video register value port&t;*/
DECL|variable|video_num_columns
r_static
r_int
r_int
id|video_num_columns
suffix:semicolon
multiline_comment|/* Number of text columns&t;*/
DECL|variable|video_num_lines
r_static
r_int
r_int
id|video_num_lines
suffix:semicolon
multiline_comment|/* Number of text lines&t;&t;*/
DECL|variable|video_size_row
r_static
r_int
r_int
id|video_size_row
suffix:semicolon
DECL|variable|video_screen_size
r_static
r_int
r_int
id|video_screen_size
suffix:semicolon
DECL|variable|can_do_color
r_static
r_int
id|can_do_color
op_assign
l_int|0
suffix:semicolon
DECL|variable|printable
r_static
r_int
id|printable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Is console ready for printing? */
DECL|variable|vc_scrbuf
r_static
r_int
r_int
op_star
id|vc_scrbuf
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|console_blanked
r_static
r_int
id|console_blanked
op_assign
l_int|0
suffix:semicolon
DECL|variable|blankinterval
r_static
r_int
id|blankinterval
op_assign
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|blank_origin
DECL|variable|blank__origin
DECL|variable|unblank_origin
r_static
r_int
id|blank_origin
comma
id|blank__origin
comma
id|unblank_origin
suffix:semicolon
DECL|struct|vc_data
r_struct
id|vc_data
(brace
DECL|member|vc_screenbuf_size
r_int
r_int
id|vc_screenbuf_size
suffix:semicolon
DECL|member|vc_video_erase_char
r_int
r_int
id|vc_video_erase_char
suffix:semicolon
multiline_comment|/* Background erase character */
DECL|member|vc_attr
r_int
r_char
id|vc_attr
suffix:semicolon
multiline_comment|/* Current attributes */
DECL|member|vc_def_color
r_int
r_char
id|vc_def_color
suffix:semicolon
multiline_comment|/* Default colors */
DECL|member|vc_color
r_int
r_char
id|vc_color
suffix:semicolon
multiline_comment|/* Foreground &amp; background */
DECL|member|vc_s_color
r_int
r_char
id|vc_s_color
suffix:semicolon
multiline_comment|/* Saved foreground &amp; background */
DECL|member|vc_ulcolor
r_int
r_char
id|vc_ulcolor
suffix:semicolon
multiline_comment|/* Colour for underline mode */
DECL|member|vc_halfcolor
r_int
r_char
id|vc_halfcolor
suffix:semicolon
multiline_comment|/* Colour for half intensity mode */
DECL|member|vc_origin
r_int
r_int
id|vc_origin
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|member|vc_scr_end
r_int
r_int
id|vc_scr_end
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|member|vc_pos
r_int
r_int
id|vc_pos
suffix:semicolon
DECL|member|vc_x
DECL|member|vc_y
r_int
r_int
id|vc_x
comma
id|vc_y
suffix:semicolon
DECL|member|vc_top
DECL|member|vc_bottom
r_int
r_int
id|vc_top
comma
id|vc_bottom
suffix:semicolon
DECL|member|vc_state
r_int
r_int
id|vc_state
suffix:semicolon
DECL|member|vc_npar
DECL|member|vc_par
r_int
r_int
id|vc_npar
comma
id|vc_par
(braket
id|NPAR
)braket
suffix:semicolon
DECL|member|vc_video_mem_start
r_int
r_int
id|vc_video_mem_start
suffix:semicolon
multiline_comment|/* Start of video RAM&t;&t;*/
DECL|member|vc_video_mem_end
r_int
r_int
id|vc_video_mem_end
suffix:semicolon
multiline_comment|/* End of video RAM (sort of)&t;*/
DECL|member|vc_saved_x
r_int
r_int
id|vc_saved_x
suffix:semicolon
DECL|member|vc_saved_y
r_int
r_int
id|vc_saved_y
suffix:semicolon
multiline_comment|/* mode flags */
DECL|member|vc_charset
r_int
r_int
id|vc_charset
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Character set G0 / G1 */
DECL|member|vc_s_charset
r_int
r_int
id|vc_s_charset
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Saved character set */
DECL|member|vc_disp_ctrl
r_int
r_int
id|vc_disp_ctrl
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Display chars &lt; 32? */
DECL|member|vc_toggle_meta
r_int
r_int
id|vc_toggle_meta
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Toggle high bit? */
DECL|member|vc_decscnm
r_int
r_int
id|vc_decscnm
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Screen Mode */
DECL|member|vc_decom
r_int
r_int
id|vc_decom
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Origin Mode */
DECL|member|vc_decawm
r_int
r_int
id|vc_decawm
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Autowrap Mode */
DECL|member|vc_deccm
r_int
r_int
id|vc_deccm
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Cursor Visible */
DECL|member|vc_decim
r_int
r_int
id|vc_decim
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Insert Mode */
DECL|member|vc_deccolm
r_int
r_int
id|vc_deccolm
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 80/132 Column Mode */
multiline_comment|/* attribute flags */
DECL|member|vc_intensity
r_int
r_int
id|vc_intensity
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* 0=half-bright, 1=normal, 2=bold */
DECL|member|vc_underline
r_int
r_int
id|vc_underline
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_blink
r_int
r_int
id|vc_blink
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_reverse
r_int
r_int
id|vc_reverse
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_s_intensity
r_int
r_int
id|vc_s_intensity
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* saved rendition */
DECL|member|vc_s_underline
r_int
r_int
id|vc_s_underline
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_s_blink
r_int
r_int
id|vc_s_blink
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_s_reverse
r_int
r_int
id|vc_s_reverse
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* misc */
DECL|member|vc_ques
r_int
r_int
id|vc_ques
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_need_wrap
r_int
r_int
id|vc_need_wrap
suffix:colon
l_int|1
suffix:semicolon
DECL|member|vc_has_scrolled
r_int
r_int
id|vc_has_scrolled
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Info for unblank_screen */
DECL|member|vc_kmalloced
r_int
r_int
id|vc_kmalloced
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* kfree_s() needed */
DECL|member|vc_report_mouse
r_int
r_int
id|vc_report_mouse
suffix:colon
l_int|2
suffix:semicolon
DECL|member|vc_utf
r_int
r_char
id|vc_utf
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Unicode UTF-8 encoding */
DECL|member|vc_utf_count
r_int
r_char
id|vc_utf_count
suffix:semicolon
DECL|member|vc_utf_char
r_int
r_int
id|vc_utf_char
suffix:semicolon
DECL|member|vc_tab_stop
r_int
r_int
id|vc_tab_stop
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Tab stops. 160 columns. */
DECL|member|vc_translate
r_int
r_char
op_star
id|vc_translate
suffix:semicolon
DECL|member|vc_G0_charset
r_int
r_char
op_star
id|vc_G0_charset
suffix:semicolon
DECL|member|vc_G1_charset
r_int
r_char
op_star
id|vc_G1_charset
suffix:semicolon
DECL|member|vc_saved_G0
r_int
r_char
op_star
id|vc_saved_G0
suffix:semicolon
DECL|member|vc_saved_G1
r_int
r_char
op_star
id|vc_saved_G1
suffix:semicolon
multiline_comment|/* additional information is in vt_kern.h */
)brace
suffix:semicolon
DECL|struct|vc
r_static
r_struct
id|vc
(brace
DECL|member|d
r_struct
id|vc_data
op_star
id|d
suffix:semicolon
multiline_comment|/* might add  scrmem, vt_struct, kbd  at some time,&n;&t;   to have everything in one place - the disadvantage&n;&t;   would be that vc_cons etc can no longer be static */
DECL|variable|vc_cons
)brace
id|vc_cons
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|macro|screenbuf_size
mdefine_line|#define screenbuf_size&t;(vc_cons[currcons].d-&gt;vc_screenbuf_size)
DECL|macro|origin
mdefine_line|#define origin&t;&t;(vc_cons[currcons].d-&gt;vc_origin)
DECL|macro|scr_end
mdefine_line|#define scr_end&t;&t;(vc_cons[currcons].d-&gt;vc_scr_end)
DECL|macro|pos
mdefine_line|#define pos&t;&t;(vc_cons[currcons].d-&gt;vc_pos)
DECL|macro|top
mdefine_line|#define top&t;&t;(vc_cons[currcons].d-&gt;vc_top)
DECL|macro|bottom
mdefine_line|#define bottom&t;&t;(vc_cons[currcons].d-&gt;vc_bottom)
DECL|macro|x
mdefine_line|#define x&t;&t;(vc_cons[currcons].d-&gt;vc_x)
DECL|macro|y
mdefine_line|#define y&t;&t;(vc_cons[currcons].d-&gt;vc_y)
DECL|macro|vc_state
mdefine_line|#define vc_state&t;(vc_cons[currcons].d-&gt;vc_state)
DECL|macro|npar
mdefine_line|#define npar&t;&t;(vc_cons[currcons].d-&gt;vc_npar)
DECL|macro|par
mdefine_line|#define par&t;&t;(vc_cons[currcons].d-&gt;vc_par)
DECL|macro|ques
mdefine_line|#define ques&t;&t;(vc_cons[currcons].d-&gt;vc_ques)
DECL|macro|attr
mdefine_line|#define attr&t;&t;(vc_cons[currcons].d-&gt;vc_attr)
DECL|macro|saved_x
mdefine_line|#define saved_x&t;&t;(vc_cons[currcons].d-&gt;vc_saved_x)
DECL|macro|saved_y
mdefine_line|#define saved_y&t;&t;(vc_cons[currcons].d-&gt;vc_saved_y)
DECL|macro|translate
mdefine_line|#define translate&t;(vc_cons[currcons].d-&gt;vc_translate)
DECL|macro|G0_charset
mdefine_line|#define G0_charset&t;(vc_cons[currcons].d-&gt;vc_G0_charset)
DECL|macro|G1_charset
mdefine_line|#define G1_charset&t;(vc_cons[currcons].d-&gt;vc_G1_charset)
DECL|macro|saved_G0
mdefine_line|#define saved_G0&t;(vc_cons[currcons].d-&gt;vc_saved_G0)
DECL|macro|saved_G1
mdefine_line|#define saved_G1&t;(vc_cons[currcons].d-&gt;vc_saved_G1)
DECL|macro|utf
mdefine_line|#define utf&t;&t;(vc_cons[currcons].d-&gt;vc_utf)
DECL|macro|utf_count
mdefine_line|#define utf_count&t;(vc_cons[currcons].d-&gt;vc_utf_count)
DECL|macro|utf_char
mdefine_line|#define utf_char&t;(vc_cons[currcons].d-&gt;vc_utf_char)
DECL|macro|video_mem_start
mdefine_line|#define video_mem_start&t;(vc_cons[currcons].d-&gt;vc_video_mem_start)
DECL|macro|video_mem_end
mdefine_line|#define video_mem_end&t;(vc_cons[currcons].d-&gt;vc_video_mem_end)
DECL|macro|video_erase_char
mdefine_line|#define video_erase_char (vc_cons[currcons].d-&gt;vc_video_erase_char)&t;
DECL|macro|disp_ctrl
mdefine_line|#define disp_ctrl&t;(vc_cons[currcons].d-&gt;vc_disp_ctrl)
DECL|macro|toggle_meta
mdefine_line|#define toggle_meta&t;(vc_cons[currcons].d-&gt;vc_toggle_meta)
DECL|macro|decscnm
mdefine_line|#define decscnm&t;&t;(vc_cons[currcons].d-&gt;vc_decscnm)
DECL|macro|decom
mdefine_line|#define decom&t;&t;(vc_cons[currcons].d-&gt;vc_decom)
DECL|macro|decawm
mdefine_line|#define decawm&t;&t;(vc_cons[currcons].d-&gt;vc_decawm)
DECL|macro|deccm
mdefine_line|#define deccm&t;&t;(vc_cons[currcons].d-&gt;vc_deccm)
DECL|macro|decim
mdefine_line|#define decim&t;&t;(vc_cons[currcons].d-&gt;vc_decim)
DECL|macro|deccolm
mdefine_line|#define deccolm&t; &t;(vc_cons[currcons].d-&gt;vc_deccolm)
DECL|macro|need_wrap
mdefine_line|#define need_wrap&t;(vc_cons[currcons].d-&gt;vc_need_wrap)
DECL|macro|has_scrolled
mdefine_line|#define has_scrolled&t;(vc_cons[currcons].d-&gt;vc_has_scrolled)
DECL|macro|kmalloced
mdefine_line|#define kmalloced&t;(vc_cons[currcons].d-&gt;vc_kmalloced)
DECL|macro|report_mouse
mdefine_line|#define report_mouse&t;(vc_cons[currcons].d-&gt;vc_report_mouse)
DECL|macro|color
mdefine_line|#define color&t;&t;(vc_cons[currcons].d-&gt;vc_color)
DECL|macro|s_color
mdefine_line|#define s_color&t;&t;(vc_cons[currcons].d-&gt;vc_s_color)
DECL|macro|def_color
mdefine_line|#define def_color&t;(vc_cons[currcons].d-&gt;vc_def_color)
DECL|macro|foreground
mdefine_line|#define&t;foreground&t;(color &amp; 0x0f)
DECL|macro|background
mdefine_line|#define background&t;(color &amp; 0xf0)
DECL|macro|charset
mdefine_line|#define charset&t;&t;(vc_cons[currcons].d-&gt;vc_charset)
DECL|macro|s_charset
mdefine_line|#define s_charset&t;(vc_cons[currcons].d-&gt;vc_s_charset)
DECL|macro|intensity
mdefine_line|#define&t;intensity&t;(vc_cons[currcons].d-&gt;vc_intensity)
DECL|macro|underline
mdefine_line|#define&t;underline&t;(vc_cons[currcons].d-&gt;vc_underline)
DECL|macro|blink
mdefine_line|#define&t;blink&t;&t;(vc_cons[currcons].d-&gt;vc_blink)
DECL|macro|reverse
mdefine_line|#define&t;reverse&t;&t;(vc_cons[currcons].d-&gt;vc_reverse)
DECL|macro|s_intensity
mdefine_line|#define&t;s_intensity&t;(vc_cons[currcons].d-&gt;vc_s_intensity)
DECL|macro|s_underline
mdefine_line|#define&t;s_underline&t;(vc_cons[currcons].d-&gt;vc_s_underline)
DECL|macro|s_blink
mdefine_line|#define&t;s_blink&t;&t;(vc_cons[currcons].d-&gt;vc_s_blink)
DECL|macro|s_reverse
mdefine_line|#define&t;s_reverse&t;(vc_cons[currcons].d-&gt;vc_s_reverse)
DECL|macro|ulcolor
mdefine_line|#define&t;ulcolor&t;&t;(vc_cons[currcons].d-&gt;vc_ulcolor)
DECL|macro|halfcolor
mdefine_line|#define&t;halfcolor&t;(vc_cons[currcons].d-&gt;vc_halfcolor)
DECL|macro|tab_stop
mdefine_line|#define tab_stop&t;(vc_cons[currcons].d-&gt;vc_tab_stop)
DECL|macro|vcmode
mdefine_line|#define vcmode&t;&t;(vt_cons[currcons]-&gt;vc_mode)
DECL|macro|structsize
mdefine_line|#define structsize&t;(sizeof(struct vc_data) + sizeof(struct vt_struct))
DECL|function|memsetw
r_static
r_void
id|memsetw
c_func
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|addr
op_assign
(paren
r_int
r_int
op_star
)paren
id|s
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|c
comma
id|addr
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|vc_cons_allocated
r_int
id|vc_cons_allocated
c_func
(paren
r_int
r_int
id|i
)paren
(brace
r_return
(paren
id|i
OL
id|MAX_NR_CONSOLES
op_logical_and
id|vc_cons
(braket
id|i
)braket
dot
id|d
)paren
suffix:semicolon
)brace
DECL|function|vc_allocate
r_int
id|vc_allocate
c_func
(paren
r_int
r_int
id|i
)paren
multiline_comment|/* return 0 on success */
(brace
r_if
c_cond
(paren
id|i
op_ge
id|MAX_NR_CONSOLES
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons
(braket
id|i
)braket
dot
id|d
)paren
(brace
r_int
id|p
comma
id|q
suffix:semicolon
multiline_comment|/* prevent users from taking too much memory */
r_if
c_cond
(paren
id|i
op_ge
id|MAX_NR_USER_CONSOLES
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* due to the granularity of kmalloc, we waste some memory here */
multiline_comment|/* the alloc is done in two steps, to optimize the common situation&n;&t;       of a 25x80 console (structsize=216, video_screen_size=4000) */
id|q
op_assign
(paren
r_int
)paren
id|kmalloc
c_func
(paren
id|video_screen_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p
op_assign
(paren
r_int
)paren
id|kmalloc
c_func
(paren
id|structsize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|kfree_s
c_func
(paren
(paren
r_char
op_star
)paren
id|q
comma
id|video_screen_size
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|vc_cons
(braket
id|i
)braket
dot
id|d
op_assign
(paren
r_struct
id|vc_data
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
r_sizeof
(paren
r_struct
id|vc_data
)paren
suffix:semicolon
id|vt_cons
(braket
id|i
)braket
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|p
suffix:semicolon
id|vc_scrbuf
(braket
id|i
)braket
op_assign
(paren
r_int
r_int
op_star
)paren
id|q
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_kmalloced
op_assign
l_int|1
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_screenbuf_size
op_assign
id|video_screen_size
suffix:semicolon
id|vc_init
(paren
id|i
comma
id|video_num_lines
comma
id|video_num_columns
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Change # of rows and columns (0 means unchanged)&n; * [this is to be used together with some user program&n; * like resize that changes the hardware videomode]&n; */
DECL|function|vc_resize
r_int
id|vc_resize
c_func
(paren
r_int
r_int
id|lines
comma
r_int
r_int
id|cols
)paren
(brace
r_int
r_int
id|cc
comma
id|ll
comma
id|ss
comma
id|sr
suffix:semicolon
r_int
r_int
id|occ
comma
id|oll
comma
id|oss
comma
id|osr
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
r_int
r_int
id|currcons
comma
id|i
suffix:semicolon
r_int
r_int
op_star
id|newscreens
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
r_int
id|ol
comma
id|nl
comma
id|rlth
comma
id|rrem
suffix:semicolon
id|cc
op_assign
(paren
id|cols
ques
c_cond
id|cols
suffix:colon
id|video_num_columns
)paren
suffix:semicolon
id|ll
op_assign
(paren
id|lines
ques
c_cond
id|lines
suffix:colon
id|video_num_lines
)paren
suffix:semicolon
id|sr
op_assign
id|cc
op_lshift
l_int|1
suffix:semicolon
id|ss
op_assign
id|sr
op_star
id|ll
suffix:semicolon
r_if
c_cond
(paren
id|ss
OG
id|video_mem_term
op_minus
id|video_mem_base
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * Some earlier version had all consoles of potentially&n;&t; * different sizes, but that was really messy.&n;&t; * So now we only change if there is room for all consoles&n;&t; * of the same size.&n;&t; */
r_for
c_loop
(paren
id|currcons
op_assign
l_int|0
suffix:semicolon
id|currcons
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
id|newscreens
(braket
id|currcons
)braket
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|ss
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|currcons
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|newscreens
(braket
id|i
)braket
)paren
id|kfree_s
c_func
(paren
id|newscreens
(braket
id|i
)braket
comma
id|ss
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|newscreens
(braket
id|currcons
)braket
op_assign
id|p
suffix:semicolon
)brace
)brace
id|get_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|oll
op_assign
id|video_num_lines
suffix:semicolon
id|occ
op_assign
id|video_num_columns
suffix:semicolon
id|osr
op_assign
id|video_size_row
suffix:semicolon
id|oss
op_assign
id|video_screen_size
suffix:semicolon
id|video_num_lines
op_assign
id|ll
suffix:semicolon
id|video_num_columns
op_assign
id|cc
suffix:semicolon
id|video_size_row
op_assign
id|sr
suffix:semicolon
id|video_screen_size
op_assign
id|ss
suffix:semicolon
r_for
c_loop
(paren
id|currcons
op_assign
l_int|0
suffix:semicolon
id|currcons
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
r_continue
suffix:semicolon
id|rlth
op_assign
id|MIN
c_func
(paren
id|osr
comma
id|sr
)paren
suffix:semicolon
id|rrem
op_assign
id|sr
op_minus
id|rlth
suffix:semicolon
id|ol
op_assign
id|origin
suffix:semicolon
id|nl
op_assign
(paren
r_int
)paren
id|newscreens
(braket
id|currcons
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ll
OL
id|oll
)paren
id|ol
op_add_assign
(paren
id|oll
op_minus
id|ll
)paren
op_star
id|osr
suffix:semicolon
r_while
c_loop
(paren
id|ol
OL
id|scr_end
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|nl
comma
(paren
r_void
op_star
)paren
id|ol
comma
id|rlth
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rrem
)paren
id|memsetw
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|nl
op_plus
id|rlth
)paren
comma
id|video_erase_char
comma
id|rrem
)paren
suffix:semicolon
id|ol
op_add_assign
id|osr
suffix:semicolon
id|nl
op_add_assign
id|sr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kmalloced
)paren
id|kfree_s
c_func
(paren
id|vc_scrbuf
(braket
id|currcons
)braket
comma
id|screenbuf_size
)paren
suffix:semicolon
id|vc_scrbuf
(braket
id|currcons
)braket
op_assign
id|newscreens
(braket
id|currcons
)braket
suffix:semicolon
id|kmalloced
op_assign
l_int|1
suffix:semicolon
id|screenbuf_size
op_assign
id|ss
suffix:semicolon
id|origin
op_assign
id|video_mem_start
op_assign
(paren
r_int
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
suffix:semicolon
id|scr_end
op_assign
id|video_mem_end
op_assign
id|video_mem_start
op_plus
id|ss
suffix:semicolon
r_if
c_cond
(paren
id|scr_end
OG
id|nl
)paren
id|memsetw
c_func
(paren
(paren
r_void
op_star
)paren
id|nl
comma
id|video_erase_char
comma
id|scr_end
op_minus
id|nl
)paren
suffix:semicolon
multiline_comment|/* do part of a reset_terminal() */
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
)paren
suffix:semicolon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
id|set_scrmem
c_func
(paren
id|fg_console
comma
l_int|0
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vc_disallocate
r_void
id|vc_disallocate
c_func
(paren
r_int
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
r_if
c_cond
(paren
id|kmalloced
)paren
id|kfree_s
c_func
(paren
id|vc_scrbuf
(braket
id|currcons
)braket
comma
id|screenbuf_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ge
id|MIN_NR_CONSOLES
)paren
id|kfree_s
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|structsize
)paren
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|macro|set_kbd
mdefine_line|#define set_kbd(x) set_vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|clr_kbd
mdefine_line|#define clr_kbd(x) clr_vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|is_kbd
mdefine_line|#define is_kbd(x) vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|decarm
mdefine_line|#define decarm&t;&t;VC_REPEAT
DECL|macro|decckm
mdefine_line|#define decckm&t;&t;VC_CKMODE
DECL|macro|kbdapplic
mdefine_line|#define kbdapplic&t;VC_APPLIC
DECL|macro|lnm
mdefine_line|#define lnm&t;&t;VC_CRLF
multiline_comment|/*&n; * this is what the terminal answers to a ESC-Z or csi0c query.&n; */
DECL|macro|VT100ID
mdefine_line|#define VT100ID &quot;&bslash;033[?1;2c&quot;
DECL|macro|VT102ID
mdefine_line|#define VT102ID &quot;&bslash;033[?6c&quot;
DECL|variable|translations
r_static
r_int
r_char
op_star
id|translations
(braket
)braket
op_assign
(brace
multiline_comment|/* 8-bit Latin-1 mapped to the PC character set: &squot;&bslash;0&squot; means non-printable */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;376&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^_&quot;
l_string|&quot;`abcdefghijklmnopqrstuvwxyz{|}~&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;377&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;350&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;355&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
comma
multiline_comment|/* vt100 graphics */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;376&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^ &quot;
l_string|&quot;&bslash;004&bslash;261&bslash;007&bslash;007&bslash;007&bslash;007&bslash;370&bslash;361&bslash;007&bslash;007&bslash;331&bslash;277&bslash;332&bslash;300&bslash;305&bslash;304&quot;
l_string|&quot;&bslash;304&bslash;304&bslash;137&bslash;137&bslash;303&bslash;264&bslash;301&bslash;302&bslash;263&bslash;363&bslash;362&bslash;343&bslash;330&bslash;234&bslash;007&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;377&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;376&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
comma
multiline_comment|/* IBM graphics: minimal translations (BS, CR, LF, LL, SO, SI and ESC) */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;000&bslash;001&bslash;002&bslash;003&bslash;004&bslash;005&bslash;006&bslash;007&bslash;000&bslash;011&bslash;000&bslash;013&bslash;000&bslash;000&bslash;000&bslash;000&quot;
l_string|&quot;&bslash;020&bslash;021&bslash;022&bslash;023&bslash;024&bslash;025&bslash;026&bslash;027&bslash;030&bslash;031&bslash;032&bslash;000&bslash;034&bslash;035&bslash;036&bslash;037&quot;
l_string|&quot;&bslash;040&bslash;041&bslash;042&bslash;043&bslash;044&bslash;045&bslash;046&bslash;047&bslash;050&bslash;051&bslash;052&bslash;053&bslash;054&bslash;055&bslash;056&bslash;057&quot;
l_string|&quot;&bslash;060&bslash;061&bslash;062&bslash;063&bslash;064&bslash;065&bslash;066&bslash;067&bslash;070&bslash;071&bslash;072&bslash;073&bslash;074&bslash;075&bslash;076&bslash;077&quot;
l_string|&quot;&bslash;100&bslash;101&bslash;102&bslash;103&bslash;104&bslash;105&bslash;106&bslash;107&bslash;110&bslash;111&bslash;112&bslash;113&bslash;114&bslash;115&bslash;116&bslash;117&quot;
l_string|&quot;&bslash;120&bslash;121&bslash;122&bslash;123&bslash;124&bslash;125&bslash;126&bslash;127&bslash;130&bslash;131&bslash;132&bslash;133&bslash;134&bslash;135&bslash;136&bslash;137&quot;
l_string|&quot;&bslash;140&bslash;141&bslash;142&bslash;143&bslash;144&bslash;145&bslash;146&bslash;147&bslash;150&bslash;151&bslash;152&bslash;153&bslash;154&bslash;155&bslash;156&bslash;157&quot;
l_string|&quot;&bslash;160&bslash;161&bslash;162&bslash;163&bslash;164&bslash;165&bslash;166&bslash;167&bslash;170&bslash;171&bslash;172&bslash;173&bslash;174&bslash;175&bslash;176&bslash;177&quot;
l_string|&quot;&bslash;200&bslash;201&bslash;202&bslash;203&bslash;204&bslash;205&bslash;206&bslash;207&bslash;210&bslash;211&bslash;212&bslash;213&bslash;214&bslash;215&bslash;216&bslash;217&quot;
l_string|&quot;&bslash;220&bslash;221&bslash;222&bslash;223&bslash;224&bslash;225&bslash;226&bslash;227&bslash;230&bslash;231&bslash;232&bslash;233&bslash;234&bslash;235&bslash;236&bslash;237&quot;
l_string|&quot;&bslash;240&bslash;241&bslash;242&bslash;243&bslash;244&bslash;245&bslash;246&bslash;247&bslash;250&bslash;251&bslash;252&bslash;253&bslash;254&bslash;255&bslash;256&bslash;257&quot;
l_string|&quot;&bslash;260&bslash;261&bslash;262&bslash;263&bslash;264&bslash;265&bslash;266&bslash;267&bslash;270&bslash;271&bslash;272&bslash;273&bslash;274&bslash;275&bslash;276&bslash;277&quot;
l_string|&quot;&bslash;300&bslash;301&bslash;302&bslash;303&bslash;304&bslash;305&bslash;306&bslash;307&bslash;310&bslash;311&bslash;312&bslash;313&bslash;314&bslash;315&bslash;316&bslash;317&quot;
l_string|&quot;&bslash;320&bslash;321&bslash;322&bslash;323&bslash;324&bslash;325&bslash;326&bslash;327&bslash;330&bslash;331&bslash;332&bslash;333&bslash;334&bslash;335&bslash;336&bslash;337&quot;
l_string|&quot;&bslash;340&bslash;341&bslash;342&bslash;343&bslash;344&bslash;345&bslash;346&bslash;347&bslash;350&bslash;351&bslash;352&bslash;353&bslash;354&bslash;355&bslash;356&bslash;357&quot;
l_string|&quot;&bslash;360&bslash;361&bslash;362&bslash;363&bslash;364&bslash;365&bslash;366&bslash;367&bslash;370&bslash;371&bslash;372&bslash;373&bslash;374&bslash;375&bslash;376&bslash;377&quot;
comma
multiline_comment|/* USER: customizable mappings, initialized as the previous one (IBM) */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;000&bslash;001&bslash;002&bslash;003&bslash;004&bslash;005&bslash;006&bslash;007&bslash;010&bslash;011&bslash;000&bslash;013&bslash;000&bslash;000&bslash;016&bslash;017&quot;
l_string|&quot;&bslash;020&bslash;021&bslash;022&bslash;023&bslash;024&bslash;025&bslash;026&bslash;027&bslash;030&bslash;031&bslash;032&bslash;000&bslash;034&bslash;035&bslash;036&bslash;037&quot;
l_string|&quot;&bslash;040&bslash;041&bslash;042&bslash;043&bslash;044&bslash;045&bslash;046&bslash;047&bslash;050&bslash;051&bslash;052&bslash;053&bslash;054&bslash;055&bslash;056&bslash;057&quot;
l_string|&quot;&bslash;060&bslash;061&bslash;062&bslash;063&bslash;064&bslash;065&bslash;066&bslash;067&bslash;070&bslash;071&bslash;072&bslash;073&bslash;074&bslash;075&bslash;076&bslash;077&quot;
l_string|&quot;&bslash;100&bslash;101&bslash;102&bslash;103&bslash;104&bslash;105&bslash;106&bslash;107&bslash;110&bslash;111&bslash;112&bslash;113&bslash;114&bslash;115&bslash;116&bslash;117&quot;
l_string|&quot;&bslash;120&bslash;121&bslash;122&bslash;123&bslash;124&bslash;125&bslash;126&bslash;127&bslash;130&bslash;131&bslash;132&bslash;133&bslash;134&bslash;135&bslash;136&bslash;137&quot;
l_string|&quot;&bslash;140&bslash;141&bslash;142&bslash;143&bslash;144&bslash;145&bslash;146&bslash;147&bslash;150&bslash;151&bslash;152&bslash;153&bslash;154&bslash;155&bslash;156&bslash;157&quot;
l_string|&quot;&bslash;160&bslash;161&bslash;162&bslash;163&bslash;164&bslash;165&bslash;166&bslash;167&bslash;170&bslash;171&bslash;172&bslash;173&bslash;174&bslash;175&bslash;176&bslash;177&quot;
l_string|&quot;&bslash;200&bslash;201&bslash;202&bslash;203&bslash;204&bslash;205&bslash;206&bslash;207&bslash;210&bslash;211&bslash;212&bslash;213&bslash;214&bslash;215&bslash;216&bslash;217&quot;
l_string|&quot;&bslash;220&bslash;221&bslash;222&bslash;223&bslash;224&bslash;225&bslash;226&bslash;227&bslash;230&bslash;231&bslash;232&bslash;233&bslash;234&bslash;235&bslash;236&bslash;237&quot;
l_string|&quot;&bslash;240&bslash;241&bslash;242&bslash;243&bslash;244&bslash;245&bslash;246&bslash;247&bslash;250&bslash;251&bslash;252&bslash;253&bslash;254&bslash;255&bslash;256&bslash;257&quot;
l_string|&quot;&bslash;260&bslash;261&bslash;262&bslash;263&bslash;264&bslash;265&bslash;266&bslash;267&bslash;270&bslash;271&bslash;272&bslash;273&bslash;274&bslash;275&bslash;276&bslash;277&quot;
l_string|&quot;&bslash;300&bslash;301&bslash;302&bslash;303&bslash;304&bslash;305&bslash;306&bslash;307&bslash;310&bslash;311&bslash;312&bslash;313&bslash;314&bslash;315&bslash;316&bslash;317&quot;
l_string|&quot;&bslash;320&bslash;321&bslash;322&bslash;323&bslash;324&bslash;325&bslash;326&bslash;327&bslash;330&bslash;331&bslash;332&bslash;333&bslash;334&bslash;335&bslash;336&bslash;337&quot;
l_string|&quot;&bslash;340&bslash;341&bslash;342&bslash;343&bslash;344&bslash;345&bslash;346&bslash;347&bslash;350&bslash;351&bslash;352&bslash;353&bslash;354&bslash;355&bslash;356&bslash;357&quot;
l_string|&quot;&bslash;360&bslash;361&bslash;362&bslash;363&bslash;364&bslash;365&bslash;366&bslash;367&bslash;370&bslash;371&bslash;372&bslash;373&bslash;374&bslash;375&bslash;376&bslash;377&quot;
)brace
suffix:semicolon
DECL|macro|NORM_TRANS
mdefine_line|#define NORM_TRANS (translations[0])
DECL|macro|GRAF_TRANS
mdefine_line|#define GRAF_TRANS (translations[1])
DECL|macro|NULL_TRANS
mdefine_line|#define NULL_TRANS (translations[2])
DECL|macro|USER_TRANS
mdefine_line|#define USER_TRANS (translations[3])
DECL|variable|color_table
r_static
r_int
r_char
id|color_table
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|4
comma
l_int|2
comma
l_int|6
comma
l_int|1
comma
l_int|5
comma
l_int|3
comma
l_int|7
comma
l_int|8
comma
l_int|12
comma
l_int|10
comma
l_int|14
comma
l_int|9
comma
l_int|13
comma
l_int|11
comma
l_int|15
)brace
suffix:semicolon
multiline_comment|/*&n; * gotoxy() must verify all boundaries, because the arguments&n; * might also be negative. If the given position is out of&n; * bounds, the cursor is placed at the nearest margin.&n; */
DECL|function|gotoxy
r_static
r_void
id|gotoxy
c_func
(paren
r_int
id|currcons
comma
r_int
id|new_x
comma
r_int
id|new_y
)paren
(brace
r_int
id|max_y
suffix:semicolon
r_if
c_cond
(paren
id|new_x
OL
l_int|0
)paren
id|x
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_x
op_ge
id|video_num_columns
)paren
id|x
op_assign
id|video_num_columns
op_minus
l_int|1
suffix:semicolon
r_else
id|x
op_assign
id|new_x
suffix:semicolon
r_if
c_cond
(paren
id|decom
)paren
(brace
id|new_y
op_add_assign
id|top
suffix:semicolon
id|max_y
op_assign
id|bottom
suffix:semicolon
)brace
r_else
id|max_y
op_assign
id|video_num_lines
suffix:semicolon
r_if
c_cond
(paren
id|new_y
OL
l_int|0
)paren
id|y
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_y
op_ge
id|max_y
)paren
id|y
op_assign
id|max_y
op_minus
l_int|1
suffix:semicolon
r_else
id|y
op_assign
id|new_y
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * *Very* limited hardware scrollback support..&n; */
DECL|variable|__real_origin
r_static
r_int
r_int
id|__real_origin
suffix:semicolon
DECL|variable|__origin
r_static
r_int
r_int
id|__origin
suffix:semicolon
multiline_comment|/* offset of currently displayed screen */
DECL|function|__set_origin
r_static
r_inline
r_void
id|__set_origin
c_func
(paren
r_int
r_int
id|offset
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef CONFIG_SELECTION
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SELECTION */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|__origin
op_assign
id|offset
suffix:semicolon
id|outb_p
c_func
(paren
l_int|12
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|offset
op_rshift
l_int|8
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|13
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|offset
comma
id|video_port_val
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|scrollback
r_void
id|scrollback
c_func
(paren
r_int
id|lines
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|lines
)paren
id|lines
op_assign
id|video_num_lines
op_div
l_int|2
suffix:semicolon
id|lines
op_mul_assign
id|video_num_columns
suffix:semicolon
id|lines
op_assign
id|__origin
op_minus
id|lines
suffix:semicolon
r_if
c_cond
(paren
id|lines
OL
l_int|0
)paren
id|lines
op_assign
l_int|0
suffix:semicolon
id|__set_origin
c_func
(paren
id|lines
)paren
suffix:semicolon
)brace
DECL|function|scrollfront
r_void
id|scrollfront
c_func
(paren
r_int
id|lines
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|lines
)paren
id|lines
op_assign
id|video_num_lines
op_div
l_int|2
suffix:semicolon
id|lines
op_mul_assign
id|video_num_columns
suffix:semicolon
id|lines
op_assign
id|__origin
op_plus
id|lines
suffix:semicolon
r_if
c_cond
(paren
id|lines
OG
id|__real_origin
)paren
id|lines
op_assign
id|__real_origin
suffix:semicolon
id|__set_origin
c_func
(paren
id|lines
)paren
suffix:semicolon
)brace
DECL|function|set_origin
r_static
r_void
id|set_origin
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|video_type
op_ne
id|VIDEO_TYPE_EGAC
op_logical_and
id|video_type
op_ne
id|VIDEO_TYPE_EGAM
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
op_logical_or
id|console_blanked
op_logical_or
id|vcmode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
id|__real_origin
op_assign
(paren
id|origin
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
id|__set_origin
c_func
(paren
id|__real_origin
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Put the cursor just beyond the end of the display adaptor memory.&n; */
DECL|function|hide_cursor
r_static
r_inline
r_void
id|hide_cursor
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* This is inefficient, we could just put the cursor at 0xffff,&n;     but perhaps the delays due to the inefficiency are useful for&n;     some hardware... */
id|outb_p
c_func
(paren
l_int|14
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|video_mem_term
op_minus
id|video_mem_base
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|15
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|video_mem_term
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
)brace
DECL|function|set_cursor
r_static
r_inline
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
op_logical_or
id|console_blanked
op_logical_or
id|vcmode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|__real_origin
op_ne
id|__origin
)paren
id|__set_origin
c_func
(paren
id|__real_origin
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|deccm
)paren
(brace
id|outb_p
c_func
(paren
l_int|14
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|15
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
)brace
r_else
id|hide_cursor
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|scrup
r_static
r_void
id|scrup
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
)paren
(brace
r_int
id|hardscroll
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|video_type
op_ne
id|VIDEO_TYPE_EGAC
op_logical_and
id|video_type
op_ne
id|VIDEO_TYPE_EGAM
)paren
id|hardscroll
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t
op_logical_or
id|b
op_ne
id|video_num_lines
)paren
id|hardscroll
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hardscroll
)paren
(brace
id|origin
op_add_assign
id|video_size_row
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
id|scr_end
op_add_assign
id|video_size_row
suffix:semicolon
r_if
c_cond
(paren
id|scr_end
OG
id|video_mem_end
)paren
(brace
r_int
r_int
op_star
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_start
suffix:semicolon
r_int
r_int
op_star
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
id|count
op_assign
(paren
id|video_num_lines
op_minus
l_int|1
)paren
op_star
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|s
op_increment
)paren
comma
id|d
op_increment
)paren
suffix:semicolon
)brace
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|d
op_increment
)paren
suffix:semicolon
)brace
id|scr_end
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|pos
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|has_scrolled
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
op_star
id|d
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|scr_end
op_minus
id|video_size_row
)paren
suffix:semicolon
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|d
op_increment
)paren
suffix:semicolon
)brace
)brace
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
op_star
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
id|t
)paren
suffix:semicolon
r_int
r_int
op_star
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|t
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
(paren
id|b
op_minus
id|t
op_minus
l_int|1
)paren
op_star
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|s
op_increment
)paren
comma
id|d
op_increment
)paren
suffix:semicolon
)brace
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|d
op_increment
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|scrdown
r_static
r_void
id|scrdown
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
)paren
(brace
r_int
r_int
op_star
id|d
comma
op_star
id|s
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
)paren
r_return
suffix:semicolon
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
id|b
)paren
suffix:semicolon
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|b
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|count
op_assign
(paren
id|b
op_minus
id|t
op_minus
l_int|1
)paren
op_star
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
op_decrement
id|s
)paren
comma
op_decrement
id|d
)paren
suffix:semicolon
)brace
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
op_decrement
id|d
)paren
suffix:semicolon
)brace
id|has_scrolled
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|lf
r_static
r_void
id|lf
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* don&squot;t scroll if above bottom of scrolling region, or&n;&t; * if below scrolling region&n;&t; */
r_if
c_cond
(paren
id|y
op_plus
l_int|1
op_eq
id|bottom
)paren
id|scrup
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|y
OL
id|video_num_lines
op_minus
l_int|1
)paren
(brace
id|y
op_increment
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ri
r_static
r_void
id|ri
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* don&squot;t scroll if below top of scrolling region, or&n;&t; * if above scrolling region&n;&t; */
r_if
c_cond
(paren
id|y
op_eq
id|top
)paren
id|scrdown
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|y
OG
l_int|0
)paren
(brace
id|y
op_decrement
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|cr
r_static
r_inline
r_void
id|cr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|pos
op_sub_assign
id|x
op_lshift
l_int|1
suffix:semicolon
id|need_wrap
op_assign
id|x
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|bs
r_static
r_inline
r_void
id|bs
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|pos
op_sub_assign
l_int|2
suffix:semicolon
id|x
op_decrement
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|del
r_static
r_inline
r_void
id|del
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* ignored */
)brace
DECL|function|csi_J
r_static
r_void
id|csi_J
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of display */
id|count
op_assign
(paren
id|scr_end
op_minus
id|pos
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start to cursor */
id|count
op_assign
(paren
(paren
id|pos
op_minus
id|origin
)paren
op_rshift
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole display */
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|start
op_increment
)paren
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_K
r_static
r_void
id|csi_K
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of line */
id|count
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start of line to cursor */
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|count
op_assign
id|x
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole line */
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|start
op_increment
)paren
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_X
r_static
r_void
id|csi_X
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
multiline_comment|/* erase the following vpar positions */
(brace
multiline_comment|/* not vt100? */
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vpar
)paren
id|vpar
op_increment
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
id|count
op_assign
(paren
id|vpar
OG
id|video_num_columns
op_minus
id|x
)paren
ques
c_cond
(paren
id|video_num_columns
op_minus
id|x
)paren
suffix:colon
id|vpar
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|writew
c_func
(paren
id|video_erase_char
comma
id|start
op_increment
)paren
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|update_attr
r_static
r_void
id|update_attr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|attr
op_assign
id|color
suffix:semicolon
r_if
c_cond
(paren
id|can_do_color
)paren
(brace
r_if
c_cond
(paren
id|underline
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf0
)paren
op_or
id|ulcolor
suffix:semicolon
r_else
r_if
c_cond
(paren
id|intensity
op_eq
l_int|0
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf0
)paren
op_or
id|halfcolor
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reverse
op_xor
id|decscnm
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0x88
)paren
op_or
(paren
(paren
(paren
id|attr
op_rshift
l_int|4
)paren
op_or
(paren
id|attr
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x77
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blink
)paren
id|attr
op_xor_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|intensity
op_eq
l_int|2
)paren
id|attr
op_xor_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|can_do_color
)paren
(brace
r_if
c_cond
(paren
id|underline
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf8
)paren
op_or
l_int|0x01
suffix:semicolon
r_else
r_if
c_cond
(paren
id|intensity
op_eq
l_int|0
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf0
)paren
op_or
l_int|0x08
suffix:semicolon
)brace
r_if
c_cond
(paren
id|decscnm
)paren
id|video_erase_char
op_assign
(paren
(paren
(paren
id|color
op_amp
l_int|0x88
)paren
op_or
(paren
(paren
(paren
id|color
op_rshift
l_int|4
)paren
op_or
(paren
id|color
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x77
)paren
)paren
op_lshift
l_int|8
)paren
op_or
l_char|&squot; &squot;
suffix:semicolon
r_else
id|video_erase_char
op_assign
(paren
id|color
op_lshift
l_int|8
)paren
op_or
l_char|&squot; &squot;
suffix:semicolon
)brace
DECL|function|default_attr
r_static
r_void
id|default_attr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|intensity
op_assign
l_int|1
suffix:semicolon
id|underline
op_assign
l_int|0
suffix:semicolon
id|reverse
op_assign
l_int|0
suffix:semicolon
id|blink
op_assign
l_int|0
suffix:semicolon
id|color
op_assign
id|def_color
suffix:semicolon
)brace
DECL|function|csi_m
r_static
r_void
id|csi_m
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* all attributes off */
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|intensity
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|intensity
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|underline
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|blink
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|reverse
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select primary font, don&squot;t display&n;&t;&t;&t;&t;  * control chars if defined, don&squot;t set&n;&t;&t;&t;&t;  * bit 8 on output.&n;&t;&t;&t;&t;  */
id|translate
op_assign
(paren
id|charset
op_eq
l_int|0
ques
c_cond
id|G0_charset
suffix:colon
id|G1_charset
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select first alternate font, let&squot;s&n;&t;&t;&t;&t;  * chars &lt; 32 be displayed as ROM chars.&n;&t;&t;&t;&t;  */
id|translate
op_assign
id|NULL_TRANS
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select second alternate font, toggle&n;&t;&t;&t;&t;  * high bit before displaying as ROM char.&n;&t;&t;&t;&t;  */
id|translate
op_assign
id|NULL_TRANS
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
id|toggle_meta
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|21
suffix:colon
r_case
l_int|22
suffix:colon
id|intensity
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|underline
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|25
suffix:colon
id|blink
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|27
suffix:colon
id|reverse
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|38
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Enables underscore, white foreground&n;&t;&t;&t;&t;  * with white underscore (Linux - use&n;&t;&t;&t;&t;  * default foreground).&n;&t;&t;&t;&t;  */
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0x0f
)paren
op_or
id|background
suffix:semicolon
id|underline
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|39
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Disable underline option.&n;&t;&t;&t;&t;  * Reset colour to default? It did this&n;&t;&t;&t;&t;  * before...&n;&t;&t;&t;&t;  */
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0x0f
)paren
op_or
id|background
suffix:semicolon
id|underline
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|49
suffix:colon
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0xf0
)paren
op_or
id|foreground
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|30
op_logical_and
id|par
(braket
id|i
)braket
op_le
l_int|37
)paren
id|color
op_assign
id|color_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|30
)braket
op_or
id|background
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|40
op_logical_and
id|par
(braket
id|i
)braket
op_le
l_int|47
)paren
id|color
op_assign
(paren
id|color_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|40
)braket
op_lshift
l_int|4
)paren
op_or
id|foreground
suffix:semicolon
r_break
suffix:semicolon
)brace
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|respond_string
r_static
r_void
id|respond_string
c_func
(paren
r_char
op_star
id|p
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_while
c_loop
(paren
op_star
id|p
)paren
(brace
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
op_star
id|p
comma
l_int|0
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|tty_schedule_flip
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|cursor_report
r_static
r_void
id|cursor_report
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_char
id|buf
(braket
l_int|40
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;033[%ld;%ldR&quot;
comma
id|y
op_plus
(paren
id|decom
ques
c_cond
id|top
op_plus
l_int|1
suffix:colon
l_int|1
)paren
comma
id|x
op_plus
l_int|1
)paren
suffix:semicolon
id|respond_string
c_func
(paren
id|buf
comma
id|tty
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SELECTION
DECL|function|mouse_report
r_static
r_void
id|mouse_report
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|butt
comma
r_int
id|mrx
comma
r_int
id|mry
)paren
(brace
r_char
id|buf
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;033[M%c%c%c&quot;
comma
(paren
r_char
)paren
(paren
l_char|&squot; &squot;
op_plus
id|butt
)paren
comma
(paren
r_char
)paren
(paren
l_char|&squot;!&squot;
op_plus
id|mrx
)paren
comma
(paren
r_char
)paren
(paren
l_char|&squot;!&squot;
op_plus
id|mry
)paren
)paren
suffix:semicolon
id|respond_string
c_func
(paren
id|buf
comma
id|tty
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|status_report
r_static
r_inline
r_void
id|status_report
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|respond_string
c_func
(paren
l_string|&quot;&bslash;033[0n&quot;
comma
id|tty
)paren
suffix:semicolon
multiline_comment|/* Terminal ok */
)brace
DECL|function|respond_ID
r_static
r_inline
r_void
id|respond_ID
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|respond_string
c_func
(paren
id|VT102ID
comma
id|tty
)paren
suffix:semicolon
)brace
DECL|function|invert_screen
r_static
r_void
id|invert_screen
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|can_do_color
)paren
r_for
c_loop
(paren
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
id|p
OL
(paren
r_int
r_int
op_star
)paren
id|scr_end
suffix:semicolon
id|p
op_increment
)paren
(brace
r_int
r_int
id|old
op_assign
id|readw
c_func
(paren
id|p
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|old
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
(paren
id|old
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|old
op_amp
l_int|0xff00
)paren
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x7700
)paren
comma
id|p
)paren
suffix:semicolon
)brace
r_else
r_for
c_loop
(paren
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
id|p
OL
(paren
r_int
r_int
op_star
)paren
id|scr_end
suffix:semicolon
id|p
op_increment
)paren
(brace
r_int
r_int
id|old
op_assign
id|readw
c_func
(paren
id|p
)paren
suffix:semicolon
id|writew
c_func
(paren
id|old
op_xor
(paren
(paren
id|old
op_amp
l_int|0x0700
op_eq
l_int|0x0100
)paren
ques
c_cond
l_int|0x7000
suffix:colon
l_int|0x7700
)paren
comma
id|p
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_mode
r_static
r_void
id|set_mode
c_func
(paren
r_int
id|currcons
comma
r_int
id|on_off
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ques
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* DEC private modes set/reset */
r_case
l_int|1
suffix:colon
multiline_comment|/* Cursor keys send ^[Ox/^[[x */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* 80/132 mode switch unimplemented */
id|deccolm
op_assign
id|on_off
suffix:semicolon
macro_line|#if 0
(paren
r_void
)paren
id|vc_resize
c_func
(paren
id|video_num_lines
comma
id|deccolm
ques
c_cond
l_int|132
suffix:colon
l_int|80
)paren
suffix:semicolon
multiline_comment|/* this alone does not suffice; some user mode&n;&t;&t;&t;&t;   utility has to change the hardware regs */
macro_line|#endif
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Inverted screen on/off */
r_if
c_cond
(paren
id|decscnm
op_ne
id|on_off
)paren
(brace
id|decscnm
op_assign
id|on_off
suffix:semicolon
id|invert_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* Origin relative/absolute */
id|decom
op_assign
id|on_off
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
multiline_comment|/* Autowrap on/off */
id|decawm
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* Autorepeat on/off */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|report_mouse
op_assign
id|on_off
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|25
suffix:colon
multiline_comment|/* Cursor on/off */
id|deccm
op_assign
id|on_off
suffix:semicolon
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1000
suffix:colon
id|report_mouse
op_assign
id|on_off
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* ANSI modes set/reset */
r_case
l_int|3
suffix:colon
multiline_comment|/* Monitor (display ctrls) */
id|disp_ctrl
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* Insert Mode on/off */
id|decim
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|20
suffix:colon
multiline_comment|/* Lf, Enter == CrLf/Lf */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|setterm_command
r_static
r_void
id|setterm_command
c_func
(paren
r_int
id|currcons
)paren
(brace
r_switch
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* set color for underline mode */
r_if
c_cond
(paren
id|can_do_color
op_logical_and
id|par
(braket
l_int|1
)braket
OL
l_int|16
)paren
(brace
id|ulcolor
op_assign
id|color_table
(braket
id|par
(braket
l_int|1
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|underline
)paren
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* set color for half intensity mode */
r_if
c_cond
(paren
id|can_do_color
op_logical_and
id|par
(braket
l_int|1
)braket
OL
l_int|16
)paren
(brace
id|halfcolor
op_assign
id|color_table
(braket
id|par
(braket
l_int|1
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|intensity
op_eq
l_int|0
)paren
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* store colors as defaults */
id|def_color
op_assign
id|attr
suffix:semicolon
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
multiline_comment|/* set blanking interval */
id|blankinterval
op_assign
(paren
(paren
id|par
(braket
l_int|1
)braket
OL
l_int|60
)paren
ques
c_cond
id|par
(braket
l_int|1
)braket
suffix:colon
l_int|60
)paren
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
id|poke_blanked_console
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|insert_char
r_static
r_void
id|insert_char
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
id|tmp
comma
id|old
op_assign
id|video_erase_char
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
id|video_num_columns
)paren
(brace
id|tmp
op_assign
id|readw
c_func
(paren
id|p
)paren
suffix:semicolon
id|writew
c_func
(paren
id|old
comma
id|p
)paren
suffix:semicolon
id|old
op_assign
id|tmp
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|insert_line
r_static
r_void
id|insert_line
c_func
(paren
r_int
id|currcons
)paren
(brace
id|scrdown
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|delete_char
r_static
r_void
id|delete_char
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|i
OL
id|video_num_columns
)paren
(brace
id|writew
c_func
(paren
id|readw
c_func
(paren
id|p
op_plus
l_int|1
)paren
comma
id|p
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|writew
c_func
(paren
id|video_erase_char
comma
id|p
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|delete_line
r_static
r_void
id|delete_line
c_func
(paren
r_int
id|currcons
)paren
(brace
id|scrup
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_at
r_static
r_void
id|csi_at
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_char
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_L
r_static
r_void
id|csi_L
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_line
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_P
r_static
r_void
id|csi_P
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_char
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_M
r_static
r_void
id|csi_M
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_line
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|save_cur
r_static
r_void
id|save_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|saved_x
op_assign
id|x
suffix:semicolon
id|saved_y
op_assign
id|y
suffix:semicolon
id|s_intensity
op_assign
id|intensity
suffix:semicolon
id|s_underline
op_assign
id|underline
suffix:semicolon
id|s_blink
op_assign
id|blink
suffix:semicolon
id|s_reverse
op_assign
id|reverse
suffix:semicolon
id|s_charset
op_assign
id|charset
suffix:semicolon
id|s_color
op_assign
id|color
suffix:semicolon
id|saved_G0
op_assign
id|G0_charset
suffix:semicolon
id|saved_G1
op_assign
id|G1_charset
suffix:semicolon
)brace
DECL|function|restore_cur
r_static
r_void
id|restore_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|gotoxy
c_func
(paren
id|currcons
comma
id|saved_x
comma
id|saved_y
)paren
suffix:semicolon
id|intensity
op_assign
id|s_intensity
suffix:semicolon
id|underline
op_assign
id|s_underline
suffix:semicolon
id|blink
op_assign
id|s_blink
suffix:semicolon
id|reverse
op_assign
id|s_reverse
suffix:semicolon
id|charset
op_assign
id|s_charset
suffix:semicolon
id|color
op_assign
id|s_color
suffix:semicolon
id|G0_charset
op_assign
id|saved_G0
suffix:semicolon
id|G1_charset
op_assign
id|saved_G1
suffix:semicolon
id|translate
op_assign
id|charset
ques
c_cond
id|G1_charset
suffix:colon
id|G0_charset
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|enumerator|ESnormal
DECL|enumerator|ESesc
DECL|enumerator|ESsquare
DECL|enumerator|ESgetpars
DECL|enumerator|ESgotpars
DECL|enumerator|ESfunckey
r_enum
(brace
id|ESnormal
comma
id|ESesc
comma
id|ESsquare
comma
id|ESgetpars
comma
id|ESgotpars
comma
id|ESfunckey
comma
DECL|enumerator|EShash
DECL|enumerator|ESsetG0
DECL|enumerator|ESsetG1
DECL|enumerator|ESpercent
DECL|enumerator|ESignore
id|EShash
comma
id|ESsetG0
comma
id|ESsetG1
comma
id|ESpercent
comma
id|ESignore
)brace
suffix:semicolon
DECL|function|reset_terminal
r_static
r_void
id|reset_terminal
c_func
(paren
r_int
id|currcons
comma
r_int
id|do_clear
)paren
(brace
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
id|ques
op_assign
l_int|0
suffix:semicolon
id|translate
op_assign
id|NORM_TRANS
suffix:semicolon
id|G0_charset
op_assign
id|NORM_TRANS
suffix:semicolon
id|G1_charset
op_assign
id|GRAF_TRANS
suffix:semicolon
id|charset
op_assign
l_int|0
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
id|report_mouse
op_assign
l_int|0
suffix:semicolon
id|utf
op_assign
l_int|0
suffix:semicolon
id|utf_count
op_assign
l_int|0
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
id|decscnm
op_assign
l_int|0
suffix:semicolon
id|decom
op_assign
l_int|0
suffix:semicolon
id|decawm
op_assign
l_int|1
suffix:semicolon
id|deccm
op_assign
l_int|1
suffix:semicolon
id|decim
op_assign
l_int|0
suffix:semicolon
id|set_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|lockstate
op_assign
l_int|0
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|ledmode
op_assign
id|LED_SHOW_FLAGS
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|ledflagstate
op_assign
id|kbd_table
(braket
id|currcons
)braket
dot
id|default_ledflagstate
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|tab_stop
(braket
l_int|0
)braket
op_assign
l_int|0x01010100
suffix:semicolon
id|tab_stop
(braket
l_int|1
)braket
op_assign
id|tab_stop
(braket
l_int|2
)braket
op_assign
id|tab_stop
(braket
l_int|3
)braket
op_assign
id|tab_stop
(braket
l_int|4
)braket
op_assign
l_int|0x01010101
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_clear
)paren
id|csi_J
c_func
(paren
id|currcons
comma
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Turn the Scroll-Lock LED on when the tty is stopped&n; */
DECL|function|con_stop
r_static
r_void
id|con_stop
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|console_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
id|console_num
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
(paren
id|tty-&gt;driver.minor_start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|console_num
)paren
)paren
r_return
suffix:semicolon
id|set_vc_kbd_led
c_func
(paren
id|kbd_table
op_plus
id|console_num
comma
id|VC_SCROLLOCK
)paren
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Turn the Scroll-Lock LED off when the console is started&n; */
DECL|function|con_start
r_static
r_void
id|con_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|console_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
id|console_num
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
(paren
id|tty-&gt;driver.minor_start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|console_num
)paren
)paren
r_return
suffix:semicolon
id|clr_vc_kbd_led
c_func
(paren
id|kbd_table
op_plus
id|console_num
comma
id|VC_SCROLLOCK
)paren
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|con_write
r_static
r_int
id|con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|c
comma
id|tc
comma
id|ok
comma
id|n
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|currcons
suffix:semicolon
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
id|currcons
op_assign
id|vt-&gt;vc_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
multiline_comment|/* could this happen? */
r_static
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|error
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;con_write: tty %d not allocated&bslash;n&quot;
comma
id|currcons
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SELECTION
multiline_comment|/* clear the selection */
r_if
c_cond
(paren
id|currcons
op_eq
id|sel_cons
)paren
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SELECTION */
id|disable_bh
c_func
(paren
id|KEYBOARD_BH
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|tty-&gt;stopped
op_logical_and
id|count
)paren
(brace
id|c
op_assign
id|from_user
ques
c_cond
id|get_fs_byte
c_func
(paren
id|buf
)paren
suffix:colon
op_star
id|buf
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|n
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|utf
)paren
(brace
multiline_comment|/* Combine UTF-8 into Unicode */
multiline_comment|/* Incomplete characters silently ignored */
r_if
c_cond
(paren
id|c
OG
l_int|0x7f
)paren
(brace
multiline_comment|/* UTF-8 to Latin-1 decoding */
r_if
c_cond
(paren
id|utf_count
OG
l_int|0
op_logical_and
(paren
id|c
op_amp
l_int|0xc0
)paren
op_eq
l_int|0x80
)paren
(brace
id|utf_char
op_assign
(paren
id|utf_char
op_lshift
l_int|6
)paren
op_or
(paren
id|c
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|utf_count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|utf_count
op_eq
l_int|0
)paren
id|c
op_assign
id|utf_char
suffix:semicolon
r_else
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xe0
)paren
op_eq
l_int|0xc0
)paren
(brace
id|utf_count
op_assign
l_int|1
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xf0
)paren
op_eq
l_int|0xe0
)paren
(brace
id|utf_count
op_assign
l_int|2
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_else
id|utf_count
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
id|utf_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now try to find out how to display it */
r_if
c_cond
(paren
id|c
OG
l_int|0xff
)paren
(brace
id|tc
op_assign
id|conv_uni_to_pc
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc
op_eq
op_minus
l_int|2
)paren
r_continue
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_if
c_cond
(paren
id|tc
op_eq
op_minus
l_int|1
)paren
id|tc
op_assign
l_int|0376
suffix:semicolon
multiline_comment|/* small square: symbol not found */
id|ok
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|tc
op_assign
id|NORM_TRANS
(braket
id|c
)braket
suffix:semicolon
id|ok
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* no utf */
id|tc
op_assign
id|translate
(braket
id|toggle_meta
ques
c_cond
(paren
id|c
op_or
l_int|0x80
)paren
suffix:colon
id|c
)braket
suffix:semicolon
id|ok
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* If the original code was &lt; 32 we only allow a&n;&t;&t; * glyph to be displayed if the code is not normally&n;&t;&t; * used (such as for cursor movement) or if the&n;&t;&t; * disp_ctrl mode has been explicitly enabled.&n;&t;&t; * Note: ESC is *never* allowed to be displayed as&n;&t;&t; * that would disable all escape sequences!&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ok
op_logical_and
id|tc
op_logical_and
(paren
id|c
op_ge
l_int|32
op_logical_or
(paren
id|disp_ctrl
op_logical_and
id|c
op_ne
l_int|0x1b
)paren
op_logical_or
op_logical_neg
(paren
(paren
id|CTRL_ACTION
op_rshift
id|c
)paren
op_amp
l_int|1
)paren
)paren
)paren
id|ok
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|vc_state
op_eq
id|ESnormal
op_logical_and
id|ok
)paren
(brace
r_if
c_cond
(paren
id|need_wrap
)paren
(brace
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|decim
)paren
id|insert_char
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|attr
op_lshift
l_int|8
)paren
op_plus
id|tc
comma
(paren
r_int
r_int
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
id|video_num_columns
op_minus
l_int|1
)paren
id|need_wrap
op_assign
id|decawm
suffix:semicolon
r_else
(brace
id|x
op_increment
suffix:semicolon
id|pos
op_add_assign
l_int|2
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *  Control characters can be used in the _middle_&n;&t;&t; *  of an escape sequence.&n;&t;&t; */
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_int|7
suffix:colon
id|kd_mksound
c_func
(paren
l_int|0x637
comma
id|HZ
op_div
l_int|8
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|8
suffix:colon
id|bs
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|9
suffix:colon
id|pos
op_sub_assign
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|x
OL
id|video_num_columns
op_minus
l_int|1
)paren
(brace
id|x
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_amp
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
id|pos
op_add_assign
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|10
suffix:colon
r_case
l_int|11
suffix:colon
r_case
l_int|12
suffix:colon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_kbd
c_func
(paren
id|lnm
)paren
)paren
r_continue
suffix:semicolon
r_case
l_int|13
suffix:colon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|14
suffix:colon
id|charset
op_assign
l_int|1
suffix:semicolon
id|translate
op_assign
id|G1_charset
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|15
suffix:colon
id|charset
op_assign
l_int|0
suffix:semicolon
id|translate
op_assign
id|G0_charset
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|26
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|27
suffix:colon
id|vc_state
op_assign
id|ESesc
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|127
suffix:colon
id|del
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_int|128
op_plus
l_int|27
suffix:colon
id|vc_state
op_assign
id|ESsquare
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vc_state
)paren
(brace
r_case
id|ESesc
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;[&squot;
suffix:colon
id|vc_state
op_assign
id|ESsquare
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;%&squot;
suffix:colon
id|vc_state
op_assign
id|ESpercent
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|ri
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;Z&squot;
suffix:colon
id|respond_ID
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;7&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;8&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;(&squot;
suffix:colon
id|vc_state
op_assign
id|ESsetG0
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;)&squot;
suffix:colon
id|vc_state
op_assign
id|ESsetG1
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;#&squot;
suffix:colon
id|vc_state
op_assign
id|EShash
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
id|reset_terminal
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;&gt;&squot;
suffix:colon
multiline_comment|/* Numeric keypad */
id|clr_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;=&squot;
suffix:colon
multiline_comment|/* Appl. keypad */
id|set_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
id|ESsquare
suffix:colon
r_for
c_loop
(paren
id|npar
op_assign
l_int|0
suffix:semicolon
id|npar
OL
id|NPAR
suffix:semicolon
id|npar
op_increment
)paren
(brace
id|par
(braket
id|npar
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|npar
op_assign
l_int|0
suffix:semicolon
id|vc_state
op_assign
id|ESgetpars
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;[&squot;
)paren
(brace
multiline_comment|/* Function key */
id|vc_state
op_assign
id|ESfunckey
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ques
op_assign
(paren
id|c
op_eq
l_char|&squot;?&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ques
)paren
r_continue
suffix:semicolon
r_case
id|ESgetpars
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;;&squot;
op_logical_and
id|npar
OL
id|NPAR
op_minus
l_int|1
)paren
(brace
id|npar
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
(brace
id|par
(braket
id|npar
)braket
op_mul_assign
l_int|10
suffix:semicolon
id|par
(braket
id|npar
)braket
op_add_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
id|vc_state
op_assign
id|ESgotpars
suffix:semicolon
r_case
id|ESgotpars
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;h&squot;
suffix:colon
id|set_mode
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;l&squot;
suffix:colon
id|set_mode
c_func
(paren
id|currcons
comma
l_int|0
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;n&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|ques
)paren
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|5
)paren
id|status_report
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|6
)paren
id|cursor_report
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ques
)paren
(brace
id|ques
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;G&squot;
suffix:colon
r_case
l_char|&squot;`&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;A&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;e&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
r_case
l_char|&squot;a&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_plus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_minus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
r_case
l_char|&squot;f&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|1
)braket
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;J&squot;
suffix:colon
id|csi_J
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;K&squot;
suffix:colon
id|csi_K
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|csi_L
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|csi_M
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|csi_P
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|respond_ID
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;g&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|3
)paren
(brace
id|tab_stop
(braket
l_int|0
)braket
op_assign
id|tab_stop
(braket
l_int|1
)braket
op_assign
id|tab_stop
(braket
l_int|2
)braket
op_assign
id|tab_stop
(braket
l_int|3
)braket
op_assign
id|tab_stop
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
id|csi_m
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;q&squot;
suffix:colon
multiline_comment|/* DECLL - but only 3 leds */
multiline_comment|/* map 0,1,2,3 to 0,1,2,4 */
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
l_int|4
)paren
id|setledstate
c_func
(paren
id|kbd_table
op_plus
id|currcons
comma
(paren
id|par
(braket
l_int|0
)braket
OL
l_int|3
)paren
ques
c_cond
id|par
(braket
l_int|0
)braket
suffix:colon
l_int|4
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_assign
id|video_num_lines
suffix:semicolon
multiline_comment|/* Minimum allowed region is 2 lines */
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
id|par
(braket
l_int|1
)braket
op_logical_and
id|par
(braket
l_int|1
)braket
op_le
id|video_num_lines
)paren
(brace
id|top
op_assign
id|par
(braket
l_int|0
)braket
op_minus
l_int|1
suffix:semicolon
id|bottom
op_assign
id|par
(braket
l_int|1
)braket
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;u&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;X&squot;
suffix:colon
id|csi_X
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;@&squot;
suffix:colon
id|csi_at
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;]&squot;
suffix:colon
multiline_comment|/* setterm functions */
id|setterm_command
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
id|ESpercent
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;@&squot;
suffix:colon
multiline_comment|/* defined in ISO 2022 */
id|utf
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;8&squot;
suffix:colon
multiline_comment|/* ISO/ECMA hasn&squot;t yet registered an&n;&t;&t;&t;&t;&t;   official ESC sequence for UTF-8,&n;&t;&t;&t;&t;&t;   so this one (ESC %8) will likely&n;&t;&t;&t;&t;&t;   change in the future. */
id|utf
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
id|ESfunckey
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_continue
suffix:semicolon
r_case
id|EShash
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;8&squot;
)paren
(brace
multiline_comment|/* DEC screen alignment test. kludge :-) */
id|video_erase_char
op_assign
(paren
id|video_erase_char
op_amp
l_int|0xff00
)paren
op_or
l_char|&squot;E&squot;
suffix:semicolon
id|csi_J
c_func
(paren
id|currcons
comma
l_int|2
)paren
suffix:semicolon
id|video_erase_char
op_assign
(paren
id|video_erase_char
op_amp
l_int|0xff00
)paren
op_or
l_char|&squot; &squot;
suffix:semicolon
)brace
r_continue
suffix:semicolon
r_case
id|ESsetG0
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;0&squot;
)paren
id|G0_charset
op_assign
id|GRAF_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;B&squot;
)paren
id|G0_charset
op_assign
id|NORM_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;U&squot;
)paren
id|G0_charset
op_assign
id|NULL_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;K&squot;
)paren
id|G0_charset
op_assign
id|USER_TRANS
suffix:semicolon
r_if
c_cond
(paren
id|charset
op_eq
l_int|0
)paren
id|translate
op_assign
id|G0_charset
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_continue
suffix:semicolon
r_case
id|ESsetG1
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;0&squot;
)paren
id|G1_charset
op_assign
id|GRAF_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;B&squot;
)paren
id|G1_charset
op_assign
id|NORM_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;U&squot;
)paren
id|G1_charset
op_assign
id|NULL_TRANS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;K&squot;
)paren
id|G1_charset
op_assign
id|USER_TRANS
suffix:semicolon
r_if
c_cond
(paren
id|charset
op_eq
l_int|1
)paren
id|translate
op_assign
id|G1_charset
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_continue
suffix:semicolon
r_default
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vcmode
op_ne
id|KD_GRAPHICS
)paren
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|enable_bh
c_func
(paren
id|KEYBOARD_BH
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|function|con_write_room
r_static
r_int
id|con_write_room
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;stopped
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|4096
suffix:semicolon
multiline_comment|/* No limit, really; we&squot;re not buffering */
)brace
DECL|function|con_chars_in_buffer
r_static
r_int
id|con_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* we&squot;re not buffering */
)brace
DECL|function|poke_blanked_console
r_void
id|poke_blanked_console
c_func
(paren
r_void
)paren
(brace
id|timer_active
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|BLANK_TIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
l_int|0
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
)brace
DECL|function|console_print
r_void
id|console_print
c_func
(paren
r_const
r_char
op_star
id|b
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_int
r_char
id|c
suffix:semicolon
r_static
r_int
id|printing
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printable
op_logical_or
id|printing
)paren
r_return
suffix:semicolon
multiline_comment|/* console not yet initialized */
id|printing
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
multiline_comment|/* impossible */
id|printk
c_func
(paren
l_string|&quot;console_print: tty %d not allocated ??&bslash;n&quot;
comma
id|currcons
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
(paren
id|b
op_increment
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|13
op_logical_or
id|need_wrap
)paren
(brace
r_if
c_cond
(paren
id|c
op_ne
l_int|13
)paren
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|13
)paren
r_continue
suffix:semicolon
)brace
id|writew
c_func
(paren
(paren
id|attr
op_lshift
l_int|8
)paren
op_plus
id|c
comma
(paren
r_int
r_int
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
id|video_num_columns
op_minus
l_int|1
)paren
(brace
id|need_wrap
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|x
op_increment
suffix:semicolon
id|pos
op_add_assign
l_int|2
suffix:semicolon
)brace
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|poke_blanked_console
c_func
(paren
)paren
suffix:semicolon
id|printing
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * con_throttle and con_unthrottle are only used for&n; * paste_selection(), which has to stuff in a large number of&n; * characters...&n; */
DECL|function|con_throttle
r_static
r_void
id|con_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
)brace
DECL|function|con_unthrottle
r_static
r_void
id|con_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|vt-&gt;paste_wait
)paren
suffix:semicolon
)brace
DECL|function|vc_init
r_static
r_void
id|vc_init
c_func
(paren
r_int
r_int
id|currcons
comma
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
comma
r_int
id|do_clear
)paren
(brace
r_int
id|base
op_assign
(paren
r_int
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
suffix:semicolon
id|video_num_columns
op_assign
id|cols
suffix:semicolon
id|video_num_lines
op_assign
id|rows
suffix:semicolon
id|video_size_row
op_assign
id|cols
op_lshift
l_int|1
suffix:semicolon
id|video_screen_size
op_assign
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|pos
op_assign
id|origin
op_assign
id|video_mem_start
op_assign
id|base
suffix:semicolon
id|scr_end
op_assign
id|base
op_plus
id|video_screen_size
suffix:semicolon
id|video_mem_end
op_assign
id|base
op_plus
id|video_screen_size
suffix:semicolon
id|reset_vc
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|def_color
op_assign
l_int|0x07
suffix:semicolon
multiline_comment|/* white */
id|ulcolor
op_assign
l_int|0x0f
suffix:semicolon
multiline_comment|/* bold white */
id|halfcolor
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* grey */
id|vt_cons
(braket
id|currcons
)braket
op_member_access_from_pointer
id|paste_wait
op_assign
l_int|0
suffix:semicolon
id|reset_terminal
c_func
(paren
id|currcons
comma
id|do_clear
)paren
suffix:semicolon
)brace
DECL|function|con_setsize
r_static
r_void
id|con_setsize
c_func
(paren
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
)paren
(brace
id|video_num_lines
op_assign
id|rows
suffix:semicolon
id|video_num_columns
op_assign
id|cols
suffix:semicolon
id|video_size_row
op_assign
l_int|2
op_star
id|cols
suffix:semicolon
id|video_screen_size
op_assign
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
)brace
multiline_comment|/*&n; *  long con_init(long);&n; *&n; * This routine initializes console interrupts, and does nothing&n; * else. If you want the screen to clear, call tty_write with&n; * the appropriate escape-sequence.&n; *&n; * Reads the information preserved by setup.s to determine the current display&n; * type and sets everything accordingly.&n; */
DECL|function|con_init
r_int
id|con_init
c_func
(paren
r_int
id|kmem_start
)paren
(brace
r_char
op_star
id|display_desc
op_assign
l_string|&quot;????&quot;
suffix:semicolon
r_int
id|currcons
op_assign
l_int|0
suffix:semicolon
r_int
id|orig_x
op_assign
id|ORIG_X
suffix:semicolon
r_int
id|orig_y
op_assign
id|ORIG_Y
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|console_driver
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tty_driver
)paren
)paren
suffix:semicolon
id|console_driver.magic
op_assign
id|TTY_DRIVER_MAGIC
suffix:semicolon
id|console_driver.name
op_assign
l_string|&quot;tty&quot;
suffix:semicolon
id|console_driver.name_base
op_assign
l_int|1
suffix:semicolon
id|console_driver.major
op_assign
id|TTY_MAJOR
suffix:semicolon
id|console_driver.minor_start
op_assign
l_int|1
suffix:semicolon
id|console_driver.num
op_assign
id|MAX_NR_CONSOLES
suffix:semicolon
id|console_driver.type
op_assign
id|TTY_DRIVER_TYPE_CONSOLE
suffix:semicolon
id|console_driver.init_termios
op_assign
id|tty_std_termios
suffix:semicolon
id|console_driver.flags
op_assign
id|TTY_DRIVER_REAL_RAW
suffix:semicolon
id|console_driver.refcount
op_assign
op_amp
id|console_refcount
suffix:semicolon
id|console_driver.table
op_assign
id|console_table
suffix:semicolon
id|console_driver.termios
op_assign
id|console_termios
suffix:semicolon
id|console_driver.termios_locked
op_assign
id|console_termios_locked
suffix:semicolon
id|console_driver.open
op_assign
id|con_open
suffix:semicolon
id|console_driver.write
op_assign
id|con_write
suffix:semicolon
id|console_driver.write_room
op_assign
id|con_write_room
suffix:semicolon
id|console_driver.chars_in_buffer
op_assign
id|con_chars_in_buffer
suffix:semicolon
id|console_driver.ioctl
op_assign
id|vt_ioctl
suffix:semicolon
id|console_driver.stop
op_assign
id|con_stop
suffix:semicolon
id|console_driver.start
op_assign
id|con_start
suffix:semicolon
id|console_driver.throttle
op_assign
id|con_throttle
suffix:semicolon
id|console_driver.unthrottle
op_assign
id|con_unthrottle
suffix:semicolon
r_if
c_cond
(paren
id|tty_register_driver
c_func
(paren
op_amp
id|console_driver
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;Couldn&squot;t register console driver&bslash;n&quot;
)paren
suffix:semicolon
id|con_setsize
c_func
(paren
id|ORIG_VIDEO_LINES
comma
id|ORIG_VIDEO_COLS
)paren
suffix:semicolon
id|video_page
op_assign
id|ORIG_VIDEO_PAGE
suffix:semicolon
multiline_comment|/* never used */
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|blank_screen
suffix:semicolon
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ORIG_VIDEO_MODE
op_eq
l_int|7
)paren
multiline_comment|/* Is this a monochrome display? */
(brace
id|video_mem_base
op_assign
l_int|0xb0000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3b4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3b5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAM
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xb8000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGA+&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_MDA
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xb2000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*MDA&quot;
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* If not, it is color. */
(brace
id|can_do_color
op_assign
l_int|1
suffix:semicolon
id|video_mem_base
op_assign
l_int|0xb8000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3d4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3d5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAC
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xc0000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGA+&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_CGA
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xba000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*CGA&quot;
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize the variables used for scrolling (mostly EGA/VGA)&t;*/
multiline_comment|/* Due to kmalloc roundup allocating statically is more efficient -&n;&t;   so provide MIN_NR_CONSOLES for people with very little memory */
r_for
c_loop
(paren
id|currcons
op_assign
l_int|0
suffix:semicolon
id|currcons
OL
id|MIN_NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
(brace
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
(paren
r_struct
id|vc_data
op_star
)paren
id|kmem_start
suffix:semicolon
id|kmem_start
op_add_assign
r_sizeof
(paren
r_struct
id|vc_data
)paren
suffix:semicolon
id|vt_cons
(braket
id|currcons
)braket
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|kmem_start
suffix:semicolon
id|kmem_start
op_add_assign
r_sizeof
(paren
r_struct
id|vt_struct
)paren
suffix:semicolon
id|vc_scrbuf
(braket
id|currcons
)braket
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmem_start
suffix:semicolon
id|kmem_start
op_add_assign
id|video_screen_size
suffix:semicolon
id|kmalloced
op_assign
l_int|0
suffix:semicolon
id|screenbuf_size
op_assign
id|video_screen_size
suffix:semicolon
id|vc_init
c_func
(paren
id|currcons
comma
id|video_num_lines
comma
id|video_num_columns
comma
id|currcons
)paren
suffix:semicolon
)brace
id|currcons
op_assign
id|fg_console
op_assign
l_int|0
suffix:semicolon
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|scr_end
op_assign
id|video_mem_start
op_plus
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|orig_x
comma
id|orig_y
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|csi_J
c_func
(paren
id|currcons
comma
l_int|0
)paren
suffix:semicolon
id|printable
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Console: %s %s %ldx%ld, %d virtual console%s (max %d)&bslash;n&quot;
comma
id|can_do_color
ques
c_cond
l_string|&quot;colour&quot;
suffix:colon
l_string|&quot;mono&quot;
comma
id|display_desc
comma
id|video_num_columns
comma
id|video_num_lines
comma
id|MIN_NR_CONSOLES
comma
(paren
id|MIN_NR_CONSOLES
op_eq
l_int|1
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;s&quot;
comma
id|MAX_NR_CONSOLES
)paren
suffix:semicolon
id|register_console
c_func
(paren
id|console_print
)paren
suffix:semicolon
r_return
id|kmem_start
suffix:semicolon
)brace
DECL|function|get_scrmem
r_static
r_void
id|get_scrmem
c_func
(paren
r_int
id|currcons
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
comma
(paren
r_void
op_star
)paren
id|origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|origin
op_assign
id|video_mem_start
op_assign
(paren
r_int
r_int
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
suffix:semicolon
id|scr_end
op_assign
id|video_mem_end
op_assign
id|video_mem_start
op_plus
id|video_screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|set_scrmem
r_static
r_void
id|set_scrmem
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
macro_line|#ifdef CONFIG_HGA
multiline_comment|/* This works with XFree86 1.2, 1.3 and 2.0&n;     This code could be extended and made more generally useful if we could&n;     determine the actual video mode. It appears that this should be&n;     possible on a genuine Hercules card, but I (WM) haven&squot;t been able to&n;     read from any of the required registers on my clone card.&n;     */
multiline_comment|/* This code should work with Hercules and MDA cards. */
r_if
c_cond
(paren
id|video_type
op_eq
id|VIDEO_TYPE_MDA
)paren
(brace
r_if
c_cond
(paren
id|vcmode
op_eq
id|KD_TEXT
)paren
(brace
multiline_comment|/* Ensure that the card is in text mode. */
r_int
id|i
suffix:semicolon
r_static
r_char
id|herc_txt_tbl
(braket
l_int|12
)braket
op_assign
(brace
l_int|0x61
comma
l_int|0x50
comma
l_int|0x52
comma
l_int|0x0f
comma
l_int|0x19
comma
l_int|6
comma
l_int|0x19
comma
l_int|0x19
comma
l_int|2
comma
l_int|0x0d
comma
l_int|0x0b
comma
l_int|0x0c
)brace
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3bf
)paren
suffix:semicolon
multiline_comment|/* Back to power-on defaults */
id|outb_p
c_func
(paren
l_int|0
comma
l_int|0x3b8
)paren
suffix:semicolon
multiline_comment|/* Blank the screen, select page 0, etc */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb_p
c_func
(paren
id|i
comma
l_int|0x3b4
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|herc_txt_tbl
(braket
id|i
)braket
comma
l_int|0x3b5
)paren
suffix:semicolon
)brace
)brace
DECL|macro|HGA_BLINKER_ON
mdefine_line|#define HGA_BLINKER_ON 0x20
DECL|macro|HGA_SCREEN_ON
mdefine_line|#define HGA_SCREEN_ON  8
multiline_comment|/* Make sure that the hardware is not blanked */
id|outb_p
c_func
(paren
id|HGA_BLINKER_ON
op_or
id|HGA_SCREEN_ON
comma
l_int|0x3b8
)paren
suffix:semicolon
)brace
macro_line|#endif CONFIG_HGA
r_if
c_cond
(paren
id|video_mem_term
op_minus
id|video_mem_base
OL
id|offset
op_plus
id|video_screen_size
)paren
id|offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* strange ... */
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|video_mem_base
op_plus
id|offset
)paren
comma
(paren
r_void
op_star
)paren
id|origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|origin
op_assign
id|video_mem_base
op_plus
id|offset
suffix:semicolon
id|scr_end
op_assign
id|origin
op_plus
id|video_screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|do_blank_screen
r_void
id|do_blank_screen
c_func
(paren
r_int
id|nopowersave
)paren
(brace
r_int
id|currcons
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
r_return
suffix:semicolon
id|timer_active
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|BLANK_TIMER
)paren
suffix:semicolon
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|unblank_screen
suffix:semicolon
multiline_comment|/* try not to lose information by blanking, and not to waste memory */
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|has_scrolled
op_assign
l_int|0
suffix:semicolon
id|blank__origin
op_assign
id|__origin
suffix:semicolon
id|blank_origin
op_assign
id|origin
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|get_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|unblank_origin
op_assign
id|origin
suffix:semicolon
id|memsetw
c_func
(paren
(paren
r_void
op_star
)paren
id|blank_origin
comma
id|BLANK
comma
id|video_mem_term
op_minus
id|blank_origin
)paren
suffix:semicolon
id|hide_cursor
c_func
(paren
)paren
suffix:semicolon
id|console_blanked
op_assign
id|fg_console
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nopowersave
)paren
(brace
id|vesa_blank
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_unblank_screen
r_void
id|do_unblank_screen
c_func
(paren
r_void
)paren
(brace
r_int
id|currcons
suffix:semicolon
r_int
id|resetorg
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|fg_console
)paren
)paren
(brace
multiline_comment|/* impossible */
id|printk
c_func
(paren
l_string|&quot;unblank_screen: tty %d not allocated ??&bslash;n&quot;
comma
id|fg_console
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|blank_screen
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|resetorg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
op_eq
id|fg_console
op_plus
l_int|1
op_logical_and
id|origin
op_eq
id|unblank_origin
op_logical_and
op_logical_neg
id|has_scrolled
)paren
(brace
multiline_comment|/* try to restore the exact situation before blanking */
id|resetorg
op_assign
l_int|1
suffix:semicolon
id|offset
op_assign
(paren
id|blank_origin
op_minus
id|video_mem_base
)paren
op_minus
(paren
id|unblank_origin
op_minus
id|video_mem_start
)paren
suffix:semicolon
)brace
id|console_blanked
op_assign
l_int|0
suffix:semicolon
id|set_scrmem
c_func
(paren
id|fg_console
comma
id|offset
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resetorg
)paren
id|__set_origin
c_func
(paren
id|blank__origin
)paren
suffix:semicolon
id|vesa_unblank
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * If a blank_screen is due to a timer, then a power save is allowed.&n; * If it is related to console_switching, then avoid vesa_blank().&n; */
DECL|function|blank_screen
r_static
r_void
id|blank_screen
c_func
(paren
r_void
)paren
(brace
id|do_blank_screen
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|unblank_screen
r_static
r_void
id|unblank_screen
c_func
(paren
r_void
)paren
(brace
id|do_unblank_screen
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|update_screen
r_void
id|update_screen
c_func
(paren
r_int
id|new_console
)paren
(brace
r_static
r_int
id|lock
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_console
op_eq
id|fg_console
op_logical_or
id|lock
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|new_console
)paren
)paren
(brace
multiline_comment|/* strange ... */
id|printk
c_func
(paren
l_string|&quot;update_screen: tty %d not allocated ??&bslash;n&quot;
comma
id|new_console
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lock
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_SELECTION
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SELECTION */
r_if
c_cond
(paren
op_logical_neg
id|console_blanked
)paren
id|get_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
r_else
id|console_blanked
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* no longer of the form console+1 */
id|fg_console
op_assign
id|new_console
suffix:semicolon
multiline_comment|/* this is the only (nonzero) assignment to fg_console */
multiline_comment|/* consequently, fg_console will always be allocated */
id|set_scrmem
c_func
(paren
id|fg_console
comma
l_int|0
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
id|compute_shiftstate
c_func
(paren
)paren
suffix:semicolon
id|lock
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * do_screendump is used for three tasks:&n; *   if (mode==0) is the old ioctl(TIOCLINUX,0)&n; *   if (mode==1) dumps wd,hg, cursor position, and all the char-attr pairs&n; *   if (mode==2) restores what mode1 got.&n; * the new modes are needed for a fast and complete dump-restore cycle,&n; * needed to implement root-window menus in text mode (A Rubini Nov 1994)&n; */
DECL|function|do_screendump
r_int
id|do_screendump
c_func
(paren
r_int
r_int
id|arg
comma
r_int
id|mode
)paren
(brace
r_char
op_star
id|sptr
comma
op_star
id|buf
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|currcons
comma
id|l
comma
id|chcount
suffix:semicolon
id|l
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
)paren
r_return
id|l
suffix:semicolon
id|currcons
op_assign
id|get_fs_byte
c_func
(paren
id|buf
op_plus
l_int|1
)paren
suffix:semicolon
id|currcons
op_assign
(paren
id|currcons
ques
c_cond
id|currcons
op_minus
l_int|1
suffix:colon
id|fg_console
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* mode 0 needs 2+wd*ht, modes 1 and 2 need 4+2*wd*ht */
id|chcount
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|l
op_assign
id|verify_area
c_func
(paren
id|mode
op_eq
l_int|2
ques
c_cond
id|VERIFY_READ
suffix:colon
id|VERIFY_WRITE
comma
id|buf
comma
(paren
l_int|2
op_plus
id|chcount
)paren
op_star
(paren
id|mode
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
)paren
r_return
id|l
suffix:semicolon
r_if
c_cond
(paren
id|mode
OL
l_int|2
)paren
(brace
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
(paren
id|video_num_lines
)paren
comma
id|buf
op_increment
)paren
suffix:semicolon
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
(paren
id|video_num_columns
)paren
comma
id|buf
op_increment
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SELECTION
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
l_int|0
suffix:colon
id|sptr
op_assign
(paren
r_char
op_star
)paren
id|origin
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
id|chcount
suffix:semicolon
id|l
OG
l_int|0
suffix:semicolon
id|l
op_decrement
comma
id|sptr
op_increment
)paren
id|put_fs_byte
c_func
(paren
op_star
id|sptr
op_increment
comma
id|buf
op_increment
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
id|x
comma
id|buf
op_increment
)paren
suffix:semicolon
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
id|y
comma
id|buf
op_increment
)paren
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|buf
comma
(paren
r_char
op_star
)paren
id|origin
comma
l_int|2
op_star
id|chcount
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|gotoxy
c_func
(paren
id|currcons
comma
id|get_fs_byte
c_func
(paren
id|buf
op_plus
l_int|2
)paren
comma
id|get_fs_byte
c_func
(paren
id|buf
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|4
suffix:semicolon
multiline_comment|/* ioctl#, console#, x,y */
id|memcpy_fromfs
c_func
(paren
(paren
r_char
op_star
)paren
id|origin
comma
id|buf
comma
l_int|2
op_star
id|chcount
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate the console screen memory.&n; */
DECL|function|con_open
r_int
id|con_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_int
r_int
id|idx
suffix:semicolon
r_int
id|i
suffix:semicolon
id|idx
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
id|tty-&gt;driver.minor_start
suffix:semicolon
id|i
op_assign
id|vc_allocate
c_func
(paren
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|vt_cons
(braket
id|idx
)braket
op_member_access_from_pointer
id|vc_num
op_assign
id|idx
suffix:semicolon
id|tty-&gt;driver_data
op_assign
id|vt_cons
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty-&gt;winsize.ws_row
op_logical_and
op_logical_neg
id|tty-&gt;winsize.ws_col
)paren
(brace
id|tty-&gt;winsize.ws_row
op_assign
id|video_num_lines
suffix:semicolon
id|tty-&gt;winsize.ws_col
op_assign
id|video_num_columns
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SELECTION
multiline_comment|/* correction factor for when screen is hardware-scrolled */
DECL|macro|hwscroll_offset
mdefine_line|#define&t;hwscroll_offset (currcons == fg_console ? ((__real_origin - __origin) &lt;&lt; 1) : 0)
multiline_comment|/* set reverse video on characters s-e of console with selection. */
DECL|function|highlight
r_static
r_void
id|highlight
c_func
(paren
r_const
r_int
id|currcons
comma
r_const
r_int
id|s
comma
r_const
r_int
id|e
)paren
(brace
r_int
r_char
op_star
id|p
comma
op_star
id|p1
comma
op_star
id|p2
suffix:semicolon
id|p1
op_assign
(paren
r_int
r_char
op_star
)paren
id|origin
op_minus
id|hwscroll_offset
op_plus
id|s
op_plus
l_int|1
suffix:semicolon
id|p2
op_assign
(paren
r_int
r_char
op_star
)paren
id|origin
op_minus
id|hwscroll_offset
op_plus
id|e
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|p1
suffix:semicolon
id|p
op_le
id|p2
suffix:semicolon
id|p
op_add_assign
l_int|2
)paren
op_star
id|p
op_assign
(paren
op_star
id|p
op_amp
l_int|0x88
)paren
op_or
(paren
(paren
op_star
id|p
op_lshift
l_int|4
)paren
op_amp
l_int|0x70
)paren
op_or
(paren
(paren
op_star
id|p
op_rshift
l_int|4
)paren
op_amp
l_int|0x07
)paren
suffix:semicolon
)brace
multiline_comment|/* use complementary color to show the pointer */
DECL|function|highlight_pointer
r_static
r_void
id|highlight_pointer
c_func
(paren
r_const
r_int
id|currcons
comma
r_const
r_int
id|where
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
r_static
r_int
r_char
op_star
id|prev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|where
op_eq
op_minus
l_int|1
)paren
multiline_comment|/* remove the pointer */
(brace
r_if
c_cond
(paren
id|prev
)paren
(brace
op_star
id|prev
op_xor_assign
l_int|0x77
suffix:semicolon
id|prev
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|origin
op_minus
id|hwscroll_offset
op_plus
id|where
op_plus
l_int|1
suffix:semicolon
op_star
id|p
op_xor_assign
l_int|0x77
suffix:semicolon
r_if
c_cond
(paren
id|prev
)paren
op_star
id|prev
op_xor_assign
l_int|0x77
suffix:semicolon
multiline_comment|/* remove the previous one */
id|prev
op_assign
id|p
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * This function uses a 128-bit look up table&n; * WARNING: This depends on both endianness and the ascii code&n; */
DECL|variable|inwordLut
r_static
r_int
r_int
id|inwordLut
(braket
l_int|4
)braket
op_assign
initialization_block
suffix:semicolon
DECL|function|inword
r_static
r_inline
r_int
id|inword
c_func
(paren
r_const
r_char
id|c
)paren
(brace
r_return
(paren
id|inwordLut
(braket
(paren
id|c
op_rshift
l_int|5
)paren
op_amp
l_int|3
)braket
op_rshift
(paren
id|c
op_amp
l_int|0x1F
)paren
)paren
op_amp
l_int|1
suffix:semicolon
)brace
multiline_comment|/* set inwordLut contents. Invoked by ioctl(). */
DECL|function|sel_loadlut
r_int
id|sel_loadlut
c_func
(paren
r_const
r_int
id|arg
)paren
(brace
id|memcpy_fromfs
c_func
(paren
id|inwordLut
comma
(paren
r_int
r_int
op_star
)paren
(paren
id|arg
op_plus
l_int|4
)paren
comma
l_int|16
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* does screen address p correspond to character at LH/RH edge of screen? */
DECL|function|atedge
r_static
r_inline
r_int
id|atedge
c_func
(paren
r_const
r_int
id|p
)paren
(brace
r_return
(paren
op_logical_neg
(paren
id|p
op_mod
id|video_size_row
)paren
op_logical_or
op_logical_neg
(paren
(paren
id|p
op_plus
l_int|2
)paren
op_mod
id|video_size_row
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* constrain v such that v &lt;= u */
DECL|function|limit
r_static
r_inline
r_int
r_int
id|limit
c_func
(paren
r_const
r_int
r_int
id|v
comma
r_const
r_int
r_int
id|u
)paren
(brace
multiline_comment|/* gcc miscompiles the ?: operator, so don&squot;t use it.. */
r_if
c_cond
(paren
id|v
OG
id|u
)paren
r_return
id|u
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
multiline_comment|/* invoked via ioctl(TIOCLINUX) */
DECL|function|mouse_reporting
r_int
id|mouse_reporting
c_func
(paren
r_void
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_return
id|report_mouse
suffix:semicolon
)brace
multiline_comment|/* set the current selection. Invoked by ioctl(). */
DECL|function|set_selection
r_int
id|set_selection
c_func
(paren
r_const
r_int
id|arg
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
r_int
op_star
id|args
comma
id|xs
comma
id|ys
comma
id|xe
comma
id|ye
suffix:semicolon
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_int
id|sel_mode
comma
id|new_sel_start
comma
id|new_sel_end
comma
id|spc
suffix:semicolon
r_char
op_star
id|bp
comma
op_star
id|obp
comma
op_star
id|spos
suffix:semicolon
r_int
id|i
comma
id|ps
comma
id|pe
suffix:semicolon
r_char
op_star
id|off
op_assign
(paren
r_char
op_star
)paren
id|origin
op_minus
id|hwscroll_offset
suffix:semicolon
id|unblank_screen
c_func
(paren
)paren
suffix:semicolon
id|args
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|arg
op_plus
l_int|1
)paren
suffix:semicolon
id|xs
op_assign
id|get_fs_word
c_func
(paren
id|args
op_increment
)paren
op_minus
l_int|1
suffix:semicolon
id|ys
op_assign
id|get_fs_word
c_func
(paren
id|args
op_increment
)paren
op_minus
l_int|1
suffix:semicolon
id|xe
op_assign
id|get_fs_word
c_func
(paren
id|args
op_increment
)paren
op_minus
l_int|1
suffix:semicolon
id|ye
op_assign
id|get_fs_word
c_func
(paren
id|args
op_increment
)paren
op_minus
l_int|1
suffix:semicolon
id|sel_mode
op_assign
id|get_fs_word
c_func
(paren
id|args
)paren
suffix:semicolon
id|xs
op_assign
id|limit
c_func
(paren
id|xs
comma
id|video_num_columns
op_minus
l_int|1
)paren
suffix:semicolon
id|ys
op_assign
id|limit
c_func
(paren
id|ys
comma
id|video_num_lines
op_minus
l_int|1
)paren
suffix:semicolon
id|xe
op_assign
id|limit
c_func
(paren
id|xe
comma
id|video_num_columns
op_minus
l_int|1
)paren
suffix:semicolon
id|ye
op_assign
id|limit
c_func
(paren
id|ye
comma
id|video_num_lines
op_minus
l_int|1
)paren
suffix:semicolon
id|ps
op_assign
id|ys
op_star
id|video_size_row
op_plus
(paren
id|xs
op_lshift
l_int|1
)paren
suffix:semicolon
id|pe
op_assign
id|ye
op_star
id|video_size_row
op_plus
(paren
id|xe
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|report_mouse
op_logical_and
(paren
id|sel_mode
op_amp
l_int|16
)paren
)paren
(brace
id|mouse_report
c_func
(paren
id|currcons
comma
id|tty
comma
id|sel_mode
op_amp
l_int|15
comma
id|xs
comma
id|ys
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ps
OG
id|pe
)paren
multiline_comment|/* make sel_start &lt;= sel_end */
(brace
r_int
id|tmp
op_assign
id|ps
suffix:semicolon
id|ps
op_assign
id|pe
suffix:semicolon
id|pe
op_assign
id|tmp
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sel_mode
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* character-by-character selection */
id|new_sel_start
op_assign
id|ps
suffix:semicolon
id|new_sel_end
op_assign
id|pe
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* word-by-word selection */
id|spc
op_assign
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|ps
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|new_sel_start
op_assign
id|ps
suffix:semicolon
suffix:semicolon
id|ps
op_sub_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|spc
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|ps
)paren
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|spc
op_logical_and
op_logical_neg
id|inword
c_func
(paren
op_star
(paren
id|off
op_plus
id|ps
)paren
)paren
)paren
)paren
r_break
suffix:semicolon
id|new_sel_start
op_assign
id|ps
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ps
op_mod
id|video_size_row
)paren
)paren
r_break
suffix:semicolon
)brace
id|spc
op_assign
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|pe
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|new_sel_end
op_assign
id|pe
suffix:semicolon
suffix:semicolon
id|pe
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|spc
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|pe
)paren
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|spc
op_logical_and
op_logical_neg
id|inword
c_func
(paren
op_star
(paren
id|off
op_plus
id|pe
)paren
)paren
)paren
)paren
r_break
suffix:semicolon
id|new_sel_end
op_assign
id|pe
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|pe
op_plus
l_int|2
)paren
op_mod
id|video_size_row
)paren
)paren
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* line-by-line selection */
id|new_sel_start
op_assign
id|ps
op_minus
id|ps
op_mod
id|video_size_row
suffix:semicolon
id|new_sel_end
op_assign
id|pe
op_plus
id|video_size_row
op_minus
id|pe
op_mod
id|video_size_row
op_minus
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* pointer highlight */
r_if
c_cond
(paren
id|sel_cons
op_ne
id|currcons
)paren
(brace
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
id|sel_cons
op_assign
id|currcons
suffix:semicolon
)brace
id|highlight_pointer
c_func
(paren
id|sel_cons
comma
id|pe
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing more */
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* remove the pointer */
id|highlight_pointer
c_func
(paren
id|sel_cons
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* select to end of line if on trailing space */
r_if
c_cond
(paren
id|new_sel_end
OG
id|new_sel_start
op_logical_and
op_logical_neg
id|atedge
c_func
(paren
id|new_sel_end
)paren
op_logical_and
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|new_sel_end
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|pe
op_assign
id|new_sel_end
op_plus
l_int|2
suffix:semicolon
suffix:semicolon
id|pe
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|pe
)paren
)paren
op_logical_or
id|atedge
c_func
(paren
id|pe
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isspace
c_func
(paren
op_star
(paren
id|off
op_plus
id|pe
)paren
)paren
)paren
id|new_sel_end
op_assign
id|pe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sel_cons
op_ne
id|currcons
)paren
(brace
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
id|sel_cons
op_assign
id|currcons
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sel_start
op_eq
op_minus
l_int|1
)paren
multiline_comment|/* no current selection */
id|highlight
c_func
(paren
id|sel_cons
comma
id|new_sel_start
comma
id|new_sel_end
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_sel_start
op_eq
id|sel_start
)paren
(brace
r_if
c_cond
(paren
id|new_sel_end
op_eq
id|sel_end
)paren
multiline_comment|/* no action required */
r_return
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_sel_end
OG
id|sel_end
)paren
multiline_comment|/* extend to right */
id|highlight
c_func
(paren
id|sel_cons
comma
id|sel_end
op_plus
l_int|2
comma
id|new_sel_end
)paren
suffix:semicolon
r_else
multiline_comment|/* contract from right */
id|highlight
c_func
(paren
id|sel_cons
comma
id|new_sel_end
op_plus
l_int|2
comma
id|sel_end
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|new_sel_end
op_eq
id|sel_end
)paren
(brace
r_if
c_cond
(paren
id|new_sel_start
OL
id|sel_start
)paren
multiline_comment|/* extend to left */
id|highlight
c_func
(paren
id|sel_cons
comma
id|new_sel_start
comma
id|sel_start
op_minus
l_int|2
)paren
suffix:semicolon
r_else
multiline_comment|/* contract from left */
id|highlight
c_func
(paren
id|sel_cons
comma
id|sel_start
comma
id|new_sel_start
op_minus
l_int|2
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* some other case; start selection from scratch */
(brace
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
id|highlight
c_func
(paren
id|sel_cons
comma
id|new_sel_start
comma
id|new_sel_end
)paren
suffix:semicolon
)brace
id|sel_start
op_assign
id|new_sel_start
suffix:semicolon
id|sel_end
op_assign
id|new_sel_end
suffix:semicolon
multiline_comment|/* realloc the buffer (it seems to be efficient, anyway) */
r_if
c_cond
(paren
id|sel_buffer
)paren
id|kfree
c_func
(paren
id|sel_buffer
)paren
suffix:semicolon
id|sel_buffer
op_assign
id|kmalloc
c_func
(paren
(paren
id|sel_end
op_minus
id|sel_start
)paren
op_div
l_int|2
op_plus
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sel_buffer
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;selection: kmalloc() failed&bslash;n&quot;
)paren
suffix:semicolon
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* is it right? */
)brace
id|obp
op_assign
id|bp
op_assign
id|sel_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|sel_start
suffix:semicolon
id|i
op_le
id|sel_end
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|spos
op_assign
(paren
r_char
op_star
)paren
id|off
op_plus
id|i
suffix:semicolon
op_star
id|bp
op_increment
op_assign
op_star
id|spos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|spos
)paren
)paren
id|obp
op_assign
id|bp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|i
op_plus
l_int|2
)paren
op_mod
id|video_size_row
)paren
)paren
(brace
multiline_comment|/* strip trailing blanks from line and add newline,&n;&t;&t;&t;   unless non-space at end of line. */
r_if
c_cond
(paren
id|obp
op_ne
id|bp
)paren
(brace
id|bp
op_assign
id|obp
suffix:semicolon
op_star
id|bp
op_increment
op_assign
l_char|&squot;&bslash;r&squot;
suffix:semicolon
)brace
id|obp
op_assign
id|bp
suffix:semicolon
)brace
)brace
op_star
id|bp
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* insert the contents of the selection buffer into the queue of the&n;   tty associated with the current console. Invoked by ioctl(). */
DECL|function|paste_selection
r_int
id|paste_selection
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|wait_queue
id|wait
op_assign
(brace
id|current
comma
l_int|NULL
)brace
suffix:semicolon
r_char
op_star
id|bp
op_assign
id|sel_buffer
suffix:semicolon
r_int
id|c
comma
id|l
suffix:semicolon
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp
op_logical_or
op_logical_neg
id|bp
(braket
l_int|0
)braket
)paren
r_return
l_int|0
suffix:semicolon
id|unblank_screen
c_func
(paren
)paren
suffix:semicolon
id|c
op_assign
id|strlen
c_func
(paren
id|sel_buffer
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|vt-&gt;paste_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|TTY_THROTTLED
comma
op_amp
id|tty-&gt;flags
)paren
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|l
op_assign
id|MIN
c_func
(paren
id|c
comma
id|tty-&gt;ldisc
dot
id|receive_room
c_func
(paren
id|tty
)paren
)paren
suffix:semicolon
id|tty-&gt;ldisc
dot
id|receive_buf
c_func
(paren
id|tty
comma
id|bp
comma
l_int|0
comma
id|l
)paren
suffix:semicolon
id|c
op_sub_assign
id|l
suffix:semicolon
id|bp
op_add_assign
id|l
suffix:semicolon
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* remove the current selection highlight, if any, from the console holding&n;   the selection. */
DECL|function|clear_selection
r_static
r_void
id|clear_selection
c_func
(paren
)paren
(brace
id|highlight_pointer
c_func
(paren
id|sel_cons
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* hide the pointer */
r_if
c_cond
(paren
id|sel_start
op_ne
op_minus
l_int|1
)paren
(brace
id|highlight
c_func
(paren
id|sel_cons
comma
id|sel_start
comma
id|sel_end
)paren
suffix:semicolon
id|sel_start
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_SELECTION */
multiline_comment|/*&n; * PIO_FONT support.&n; *&n; * The font loading code goes back to the codepage package by&n; * Joel Hoffman (joel@wam.umd.edu). (He reports that the original&n; * reference is: &quot;From: p. 307 of _Programmer&squot;s Guide to PC &amp; PS/2&n; * Video Systems_ by Richard Wilton. 1987.  Microsoft Press&quot;.)&n; *&n; * Change for certain monochrome monitors by Yury Shevchuck&n; * (sizif@botik.yaroslavl.su).&n; */
DECL|macro|colourmap
mdefine_line|#define colourmap ((char *)0xa0000)
multiline_comment|/* Pauline Middelink &lt;middelin@polyware.iaf.nl&gt; reports that we&n;   should use 0xA0000 for the bwmap as well.. */
DECL|macro|blackwmap
mdefine_line|#define blackwmap ((char *)0xa0000)
DECL|macro|cmapsz
mdefine_line|#define cmapsz 8192
DECL|macro|seq_port_reg
mdefine_line|#define seq_port_reg (0x3c4)
DECL|macro|seq_port_val
mdefine_line|#define seq_port_val (0x3c5)
DECL|macro|gr_port_reg
mdefine_line|#define gr_port_reg (0x3ce)
DECL|macro|gr_port_val
mdefine_line|#define gr_port_val (0x3cf)
DECL|function|set_get_font
r_static
r_int
id|set_get_font
c_func
(paren
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
macro_line|#ifdef CAN_LOAD_EGA_FONTS
r_int
id|i
suffix:semicolon
r_char
op_star
id|charmap
suffix:semicolon
r_int
id|beg
suffix:semicolon
multiline_comment|/* no use to &quot;load&quot; CGA... */
r_if
c_cond
(paren
id|video_type
op_eq
id|VIDEO_TYPE_EGAC
)paren
(brace
id|charmap
op_assign
id|colourmap
suffix:semicolon
id|beg
op_assign
l_int|0x0e
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|video_type
op_eq
id|VIDEO_TYPE_EGAM
)paren
(brace
id|charmap
op_assign
id|blackwmap
suffix:semicolon
id|beg
op_assign
l_int|0x0a
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|set
ques
c_cond
id|VERIFY_READ
suffix:colon
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|cmapsz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|seq_port_reg
)paren
suffix:semicolon
multiline_comment|/* First, the sequencer */
id|outb_p
c_func
(paren
l_int|0x01
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* Synchronous reset */
id|outb_p
c_func
(paren
l_int|0x02
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x04
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* CPU writes only to map 2 */
id|outb_p
c_func
(paren
l_int|0x04
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x07
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* Sequential addressing */
id|outb_p
c_func
(paren
l_int|0x00
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x03
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* Clear synchronous reset */
id|outb_p
c_func
(paren
l_int|0x04
comma
id|gr_port_reg
)paren
suffix:semicolon
multiline_comment|/* Now, the graphics controller */
id|outb_p
c_func
(paren
l_int|0x02
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* select map 2 */
id|outb_p
c_func
(paren
l_int|0x05
comma
id|gr_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* disable odd-even addressing */
id|outb_p
c_func
(paren
l_int|0x06
comma
id|gr_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* map start at A000:0000 */
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cmapsz
suffix:semicolon
id|i
op_increment
)paren
op_star
(paren
id|charmap
op_plus
id|i
)paren
op_assign
id|get_fs_byte
c_func
(paren
id|arg
op_plus
id|i
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cmapsz
suffix:semicolon
id|i
op_increment
)paren
id|put_fs_byte
c_func
(paren
op_star
(paren
id|charmap
op_plus
id|i
)paren
comma
id|arg
op_plus
id|i
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|seq_port_reg
)paren
suffix:semicolon
multiline_comment|/* First, the sequencer */
id|outb_p
c_func
(paren
l_int|0x01
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* Synchronous reset */
id|outb_p
c_func
(paren
l_int|0x02
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x03
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* CPU writes to maps 0 and 1 */
id|outb_p
c_func
(paren
l_int|0x04
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x03
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* odd-even addressing */
id|outb_p
c_func
(paren
l_int|0x00
comma
id|seq_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x03
comma
id|seq_port_val
)paren
suffix:semicolon
multiline_comment|/* clear synchronous reset */
id|outb_p
c_func
(paren
l_int|0x04
comma
id|gr_port_reg
)paren
suffix:semicolon
multiline_comment|/* Now, the graphics controller */
id|outb_p
c_func
(paren
l_int|0x00
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* select map 0 for CPU */
id|outb_p
c_func
(paren
l_int|0x05
comma
id|gr_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x10
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* enable even-odd addressing */
id|outb_p
c_func
(paren
l_int|0x06
comma
id|gr_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|beg
comma
id|gr_port_val
)paren
suffix:semicolon
multiline_comment|/* map starts at b800:0 or b000:0 */
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * Load font into the EGA/VGA character generator. arg points to a 8192&n; * byte map, 32 bytes per character. Only first H of them are used for&n; * 8xH fonts (0 &lt; H &lt;= 32).&n; */
DECL|function|con_set_font
r_int
id|con_set_font
(paren
r_char
op_star
id|arg
)paren
(brace
r_return
id|set_get_font
(paren
id|arg
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|con_get_font
r_int
id|con_get_font
(paren
r_char
op_star
id|arg
)paren
(brace
r_return
id|set_get_font
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Load customizable translation table (USER_TRANS[]). All checks are here,&n; * so we need only include &squot;return con_set_trans(arg)&squot; in the ioctl handler&n; * arg points to a 256 byte translation table.&n; */
DECL|function|con_set_trans
r_int
id|con_set_trans
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|E_TABSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|E_TABSZ
suffix:semicolon
id|i
op_increment
)paren
id|USER_TRANS
(braket
id|i
)braket
op_assign
id|get_fs_byte
c_func
(paren
id|arg
op_plus
id|i
)paren
suffix:semicolon
id|USER_TRANS
(braket
l_int|012
)braket
op_assign
l_int|0
suffix:semicolon
id|USER_TRANS
(braket
l_int|014
)braket
op_assign
l_int|0
suffix:semicolon
id|USER_TRANS
(braket
l_int|015
)braket
op_assign
l_int|0
suffix:semicolon
id|USER_TRANS
(braket
l_int|033
)braket
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|con_get_trans
r_int
id|con_get_trans
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|E_TABSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|E_TABSZ
suffix:semicolon
id|i
op_increment
)paren
id|put_fs_byte
c_func
(paren
id|USER_TRANS
(braket
id|i
)braket
comma
id|arg
op_plus
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
