multiline_comment|/*&n; *  linux/drivers/char/console.c&n; *&n; *  Copyright (C) 1991, 1992  Linus Torvalds&n; */
multiline_comment|/*&n; * Hopefully this will be a rather complete VT102 implementation.&n; *&n; * Beeping thanks to John T Kohl.&n; *&n; * Virtual Consoles, Screen Blanking, Screen Dumping, Color, Graphics&n; *   Chars, and VT100 enhancements by Peter MacDonald.&n; *&n; * Copy and paste function by Andrew Haylett,&n; *   some enhancements by Alessandro Rubini.&n; *&n; * Code to check for different video-cards mostly by Galen Hunt,&n; * &lt;g-hunt@ee.utah.edu&gt;&n; *&n; * Rudimentary ISO 10646/Unicode/UTF-8 character set support by&n; * Markus Kuhn, &lt;mskuhn@immd4.informatik.uni-erlangen.de&gt;.&n; *&n; * Dynamic allocation of consoles, aeb@cwi.nl, May 1994&n; * Resizing of consoles, aeb, 940926&n; *&n; * Code for xterm like mouse click reporting by Peter Orbaek 20-Jul-94&n; * &lt;poe@daimi.aau.dk&gt;&n; *&n; * User-defined bell sound, new setterm control sequences and printk&n; * redirection by Martin Mares &lt;mj@k332.feld.cvut.cz&gt; 19-Nov-95&n; *&n; * APM screenblank bug fixed Takashi Manabe &lt;manabe@roy.dsl.tutics.tut.jp&gt;&n; *&n; * Merge with the abstract console driver by Geert Uytterhoeven&n; * &lt;geert@linux-m68k.org&gt;, Jan 1997.&n; *&n; *   Original m68k console driver modifications by&n; *&n; *     - Arno Griffioen &lt;arno@usn.nl&gt;&n; *     - David Carter &lt;carter@cs.bris.ac.uk&gt;&n; * &n; *   Note that the abstract console driver allows all consoles to be of&n; *   potentially different sizes, so the following variables depend on the&n; *   current console (currcons):&n; *&n; *     - video_num_columns&n; *     - video_num_lines&n; *     - video_size_row&n; *     - can_do_color&n; *&n; *   The abstract console driver provides a generic interface for a text&n; *   console. It supports VGA text mode, frame buffer based graphical consoles&n; *   and special graphics processors that are only accessible through some&n; *   registers (e.g. a TMS340x0 GSP).&n; *&n; *   The interface to the hardware is specified using a special structure&n; *   (struct consw) which contains function pointers to console operations&n; *   (see &lt;linux/console.h&gt; for more information).&n; *&n; * Support for changeable cursor shape&n; * by Pavel Machek &lt;pavel@atrey.karlin.mff.cuni.cz&gt;, August 1997&n; *&n; * Ported to i386 and con_scrolldelta fixed&n; * by Emmanuel Marty &lt;core@ggi-project.org&gt;, April 1998&n; *&n; * Resurrected character buffers in videoram plus lots of other trickery&n; * by Martin Mares &lt;mj@atrey.karlin.mff.cuni.cz&gt;, July 1998&n; *&n; * Removed old-style timers, introduced console_timer, made timer&n; * deletion SMP-safe.  17Jun00, Andrew Morton &lt;andrewm@uow.edu.au&gt;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &lt;linux/kbd_kern.h&gt;
macro_line|#include &lt;linux/consolemap.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/tqueue.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/linux_logo.h&gt;
macro_line|#include &quot;console_macros.h&quot;
DECL|variable|conswitchp
r_const
r_struct
id|consw
op_star
id|conswitchp
suffix:semicolon
multiline_comment|/* A bitmap for codes &lt;32. A bit of 1 indicates that the code&n; * corresponding to that bit number invokes some special action&n; * (such as cursor movement) and should not be displayed as a&n; * glyph unless the disp_ctrl mode is explicitly enabled.&n; */
DECL|macro|CTRL_ACTION
mdefine_line|#define CTRL_ACTION 0x0d00ff81
DECL|macro|CTRL_ALWAYS
mdefine_line|#define CTRL_ALWAYS 0x0800f501&t;/* Cannot be overridden by disp_ctrl */
multiline_comment|/*&n; * Here is the default bell parameters: 750HZ, 1/8th of a second&n; */
DECL|macro|DEFAULT_BELL_PITCH
mdefine_line|#define DEFAULT_BELL_PITCH&t;750
DECL|macro|DEFAULT_BELL_DURATION
mdefine_line|#define DEFAULT_BELL_DURATION&t;(HZ/8)
r_extern
r_void
id|vcs_make_devfs
(paren
r_int
r_int
id|index
comma
r_int
id|unregister
)paren
suffix:semicolon
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b)&t;((a) &lt; (b) ? (a) : (b))
macro_line|#endif
DECL|variable|console_table
r_static
r_struct
id|tty_struct
op_star
id|console_table
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|console_termios
r_static
r_struct
id|termios
op_star
id|console_termios
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|console_termios_locked
r_static
r_struct
id|termios
op_star
id|console_termios_locked
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|vc_cons
r_struct
id|vc
id|vc_cons
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
macro_line|#ifndef VT_SINGLE_DRIVER
DECL|variable|con_driver_map
r_static
r_const
r_struct
id|consw
op_star
id|con_driver_map
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
macro_line|#endif
r_static
r_int
id|con_open
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_struct
id|file
op_star
)paren
suffix:semicolon
r_static
r_void
id|vc_init
c_func
(paren
r_int
r_int
id|console
comma
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
comma
r_int
id|do_clear
)paren
suffix:semicolon
r_static
r_void
id|blank_screen
c_func
(paren
r_int
r_int
id|dummy
)paren
suffix:semicolon
r_static
r_void
id|gotoxy
c_func
(paren
r_int
id|currcons
comma
r_int
id|new_x
comma
r_int
id|new_y
)paren
suffix:semicolon
r_static
r_void
id|save_cur
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|reset_terminal
c_func
(paren
r_int
id|currcons
comma
r_int
id|do_clear
)paren
suffix:semicolon
r_static
r_void
id|con_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
suffix:semicolon
r_static
r_void
id|set_vesa_blanking
c_func
(paren
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|hide_cursor
c_func
(paren
r_int
id|currcons
)paren
suffix:semicolon
r_static
r_void
id|unblank_screen_t
c_func
(paren
r_int
r_int
id|dummy
)paren
suffix:semicolon
DECL|variable|printable
r_static
r_int
id|printable
suffix:semicolon
multiline_comment|/* Is console ready for printing? */
DECL|variable|do_poke_blanked_console
r_int
id|do_poke_blanked_console
suffix:semicolon
DECL|variable|console_blanked
r_int
id|console_blanked
suffix:semicolon
DECL|variable|vesa_blank_mode
r_static
r_int
id|vesa_blank_mode
suffix:semicolon
multiline_comment|/* 0:none 1:suspendV 2:suspendH 3:powerdown */
DECL|variable|blankinterval
r_static
r_int
id|blankinterval
op_assign
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|vesa_off_interval
r_static
r_int
id|vesa_off_interval
suffix:semicolon
multiline_comment|/*&n; * fg_console is the current virtual console,&n; * last_console is the last used one,&n; * want_console is the console we want to switch to,&n; * kmsg_redirect is the console for kernel messages,&n; */
DECL|variable|fg_console
r_int
id|fg_console
suffix:semicolon
DECL|variable|last_console
r_int
id|last_console
suffix:semicolon
DECL|variable|want_console
r_int
id|want_console
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|kmsg_redirect
r_int
id|kmsg_redirect
suffix:semicolon
multiline_comment|/*&n; * For each existing display, we have a pointer to console currently visible&n; * on that display, allowing consoles other than fg_console to be refreshed&n; * appropriately. Unless the low-level driver supplies its own display_fg&n; * variable, we use this one for the &quot;master display&quot;.&n; */
DECL|variable|master_display_fg
r_static
r_struct
id|vc_data
op_star
id|master_display_fg
suffix:semicolon
multiline_comment|/*&n; * Unfortunately, we need to delay tty echo when we&squot;re currently writing to the&n; * console since the code is (and always was) not re-entrant, so we insert&n; * all filp requests to con_task_queue instead of tq_timer and run it from&n; * the console_tasklet.  The console_tasklet is protected by the IRQ&n; * protected console_lock.&n; */
DECL|variable|con_task_queue
id|DECLARE_TASK_QUEUE
c_func
(paren
id|con_task_queue
)paren
suffix:semicolon
multiline_comment|/*&n; * For the same reason, we defer scrollback to the console tasklet.&n; */
DECL|variable|scrollback_delta
r_static
r_int
id|scrollback_delta
suffix:semicolon
multiline_comment|/*&n; * Hook so that the power management routines can (un)blank&n; * the console on our behalf.&n; */
DECL|variable|console_blank_hook
r_int
(paren
op_star
id|console_blank_hook
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|variable|console_timer
r_static
r_struct
id|timer_list
id|console_timer
suffix:semicolon
multiline_comment|/*&n; *&t;Low-Level Functions&n; */
DECL|macro|IS_FG
mdefine_line|#define IS_FG (currcons == fg_console)
DECL|macro|IS_VISIBLE
mdefine_line|#define IS_VISIBLE CON_IS_VISIBLE(vc_cons[currcons].d)
macro_line|#ifdef VT_BUF_VRAM_ONLY
DECL|macro|DO_UPDATE
mdefine_line|#define DO_UPDATE 0
macro_line|#else
DECL|macro|DO_UPDATE
mdefine_line|#define DO_UPDATE IS_VISIBLE
macro_line|#endif
r_static
r_int
id|pm_con_request
c_func
(paren
r_struct
id|pm_dev
op_star
id|dev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|variable|pm_con
r_static
r_struct
id|pm_dev
op_star
id|pm_con
suffix:semicolon
DECL|function|screenpos
r_static
r_inline
r_int
r_int
op_star
id|screenpos
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
comma
r_int
id|viewed
)paren
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|viewed
)paren
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|offset
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|sw-&gt;con_screen_pos
)paren
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|visible_origin
op_plus
id|offset
)paren
suffix:semicolon
r_else
id|p
op_assign
id|sw
op_member_access_from_pointer
id|con_screen_pos
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|offset
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
DECL|function|scrolldelta
r_static
r_inline
r_void
id|scrolldelta
c_func
(paren
r_int
id|lines
)paren
(brace
id|scrollback_delta
op_add_assign
id|lines
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|console_tasklet
)paren
suffix:semicolon
)brace
DECL|function|scrup
r_static
r_void
id|scrup
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
comma
r_int
id|nr
)paren
(brace
r_int
r_int
op_star
id|d
comma
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|t
op_plus
id|nr
op_ge
id|b
)paren
id|nr
op_assign
id|b
op_minus
id|t
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
op_logical_or
id|nr
OL
l_int|1
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|IS_VISIBLE
op_logical_and
id|sw
op_member_access_from_pointer
id|con_scroll
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|t
comma
id|b
comma
id|SM_UP
comma
id|nr
)paren
)paren
r_return
suffix:semicolon
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
id|t
)paren
suffix:semicolon
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|t
op_plus
id|nr
)paren
)paren
suffix:semicolon
id|scr_memcpyw
c_func
(paren
id|d
comma
id|s
comma
(paren
id|b
op_minus
id|t
op_minus
id|nr
)paren
op_star
id|video_size_row
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
id|d
op_plus
(paren
id|b
op_minus
id|t
op_minus
id|nr
)paren
op_star
id|video_num_columns
comma
id|video_erase_char
comma
id|video_size_row
op_star
id|nr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|scrdown
id|scrdown
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
comma
r_int
id|nr
)paren
(brace
r_int
r_int
op_star
id|s
suffix:semicolon
r_int
r_int
id|step
suffix:semicolon
r_if
c_cond
(paren
id|t
op_plus
id|nr
op_ge
id|b
)paren
id|nr
op_assign
id|b
op_minus
id|t
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
op_logical_or
id|nr
OL
l_int|1
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|IS_VISIBLE
op_logical_and
id|sw
op_member_access_from_pointer
id|con_scroll
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|t
comma
id|b
comma
id|SM_DOWN
comma
id|nr
)paren
)paren
r_return
suffix:semicolon
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|origin
op_plus
id|video_size_row
op_star
id|t
)paren
suffix:semicolon
id|step
op_assign
id|video_num_columns
op_star
id|nr
suffix:semicolon
id|scr_memmovew
c_func
(paren
id|s
op_plus
id|step
comma
id|s
comma
(paren
id|b
op_minus
id|t
op_minus
id|nr
)paren
op_star
id|video_size_row
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
id|s
comma
id|video_erase_char
comma
l_int|2
op_star
id|step
)paren
suffix:semicolon
)brace
DECL|function|do_update_region
r_static
r_void
id|do_update_region
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|start
comma
r_int
id|count
)paren
(brace
macro_line|#ifndef VT_BUF_VRAM_ONLY
r_int
r_int
id|xx
comma
id|yy
comma
id|offset
suffix:semicolon
id|u16
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
id|u16
op_star
)paren
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sw-&gt;con_getxy
)paren
(brace
id|offset
op_assign
(paren
id|start
op_minus
id|origin
)paren
op_div
l_int|2
suffix:semicolon
id|xx
op_assign
id|offset
op_mod
id|video_num_columns
suffix:semicolon
id|yy
op_assign
id|offset
op_div
id|video_num_columns
suffix:semicolon
)brace
r_else
(brace
r_int
id|nxx
comma
id|nyy
suffix:semicolon
id|start
op_assign
id|sw
op_member_access_from_pointer
id|con_getxy
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|start
comma
op_amp
id|nxx
comma
op_amp
id|nyy
)paren
suffix:semicolon
id|xx
op_assign
id|nxx
suffix:semicolon
id|yy
op_assign
id|nyy
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|u16
id|attrib
op_assign
id|scr_readw
c_func
(paren
id|p
)paren
op_amp
l_int|0xff00
suffix:semicolon
r_int
id|startx
op_assign
id|xx
suffix:semicolon
id|u16
op_star
id|q
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
id|xx
OL
id|video_num_columns
op_logical_and
id|count
)paren
(brace
r_if
c_cond
(paren
id|attrib
op_ne
(paren
id|scr_readw
c_func
(paren
id|p
)paren
op_amp
l_int|0xff00
)paren
)paren
(brace
r_if
c_cond
(paren
id|p
OG
id|q
)paren
id|sw
op_member_access_from_pointer
id|con_putcs
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|q
comma
id|p
op_minus
id|q
comma
id|yy
comma
id|startx
)paren
suffix:semicolon
id|startx
op_assign
id|xx
suffix:semicolon
id|q
op_assign
id|p
suffix:semicolon
id|attrib
op_assign
id|scr_readw
c_func
(paren
id|p
)paren
op_amp
l_int|0xff00
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
id|xx
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
OG
id|q
)paren
id|sw
op_member_access_from_pointer
id|con_putcs
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|q
comma
id|p
op_minus
id|q
comma
id|yy
comma
id|startx
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_break
suffix:semicolon
id|xx
op_assign
l_int|0
suffix:semicolon
id|yy
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sw-&gt;con_getxy
)paren
(brace
id|p
op_assign
(paren
id|u16
op_star
)paren
id|start
suffix:semicolon
id|start
op_assign
id|sw
op_member_access_from_pointer
id|con_getxy
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|start
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
DECL|function|update_region
r_void
id|update_region
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|start
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|do_update_region
c_func
(paren
id|currcons
comma
id|start
comma
id|count
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Structure of attributes is hardware-dependent */
DECL|function|build_attr
r_static
id|u8
id|build_attr
c_func
(paren
r_int
id|currcons
comma
id|u8
id|_color
comma
id|u8
id|_intensity
comma
id|u8
id|_blink
comma
id|u8
id|_underline
comma
id|u8
id|_reverse
)paren
(brace
r_if
c_cond
(paren
id|sw-&gt;con_build_attr
)paren
r_return
id|sw
op_member_access_from_pointer
id|con_build_attr
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|_color
comma
id|_intensity
comma
id|_blink
comma
id|_underline
comma
id|_reverse
)paren
suffix:semicolon
macro_line|#ifndef VT_BUF_VRAM_ONLY
multiline_comment|/*&n; * ++roman: I completely changed the attribute format for monochrome&n; * mode (!can_do_color). The formerly used MDA (monochrome display&n; * adapter) format didn&squot;t allow the combination of certain effects.&n; * Now the attribute is just a bit vector:&n; *  Bit 0..1: intensity (0..2)&n; *  Bit 2   : underline&n; *  Bit 3   : reverse&n; *  Bit 7   : blink&n; */
(brace
id|u8
id|a
op_assign
id|color
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|can_do_color
)paren
r_return
id|_intensity
op_or
(paren
id|_underline
ques
c_cond
l_int|4
suffix:colon
l_int|0
)paren
op_or
(paren
id|_reverse
ques
c_cond
l_int|8
suffix:colon
l_int|0
)paren
op_or
(paren
id|_blink
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_underline
)paren
id|a
op_assign
(paren
id|a
op_amp
l_int|0xf0
)paren
op_or
id|ulcolor
suffix:semicolon
r_else
r_if
c_cond
(paren
id|_intensity
op_eq
l_int|0
)paren
id|a
op_assign
(paren
id|a
op_amp
l_int|0xf0
)paren
op_or
id|halfcolor
suffix:semicolon
r_if
c_cond
(paren
id|_reverse
)paren
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x88
)paren
op_or
(paren
(paren
(paren
(paren
id|a
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|a
)paren
op_lshift
l_int|4
)paren
)paren
op_amp
l_int|0x77
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_blink
)paren
id|a
op_xor_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|_intensity
op_eq
l_int|2
)paren
id|a
op_xor_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|hi_font_mask
op_eq
l_int|0x100
)paren
id|a
op_lshift_assign
l_int|1
suffix:semicolon
r_return
id|a
suffix:semicolon
)brace
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|function|update_attr
r_static
r_void
id|update_attr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|attr
op_assign
id|build_attr
c_func
(paren
id|currcons
comma
id|color
comma
id|intensity
comma
id|blink
comma
id|underline
comma
id|reverse
op_xor
id|decscnm
)paren
suffix:semicolon
id|video_erase_char
op_assign
(paren
id|build_attr
c_func
(paren
id|currcons
comma
id|color
comma
l_int|1
comma
id|blink
comma
l_int|0
comma
id|decscnm
)paren
op_lshift
l_int|8
)paren
op_or
l_char|&squot; &squot;
suffix:semicolon
)brace
multiline_comment|/* Note: inverting the screen twice should revert to the original state */
DECL|function|invert_screen
r_void
id|invert_screen
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
comma
r_int
id|count
comma
r_int
id|viewed
)paren
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
id|p
op_assign
id|screenpos
c_func
(paren
id|currcons
comma
id|offset
comma
id|viewed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sw-&gt;con_invert_region
)paren
id|sw
op_member_access_from_pointer
id|con_invert_region
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|p
comma
id|count
)paren
suffix:semicolon
macro_line|#ifndef VT_BUF_VRAM_ONLY
r_else
(brace
id|u16
op_star
id|q
op_assign
id|p
suffix:semicolon
r_int
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|can_do_color
)paren
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
op_star
id|q
op_increment
op_xor_assign
l_int|0x0800
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hi_font_mask
op_eq
l_int|0x100
)paren
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
(brace
id|u16
id|a
op_assign
op_star
id|q
suffix:semicolon
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x11ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0xe000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0e00
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
op_star
id|q
op_increment
op_assign
id|a
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
(brace
id|u16
id|a
op_assign
op_star
id|q
suffix:semicolon
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x7000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0700
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
op_star
id|q
op_increment
op_assign
id|a
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|do_update_region
c_func
(paren
id|currcons
comma
(paren
r_int
r_int
)paren
id|p
comma
id|count
)paren
suffix:semicolon
)brace
multiline_comment|/* used by selection: complement pointer position */
DECL|function|complement_pos
r_void
id|complement_pos
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
r_static
r_int
r_int
op_star
id|p
suffix:semicolon
r_static
r_int
r_int
id|old
suffix:semicolon
r_static
r_int
r_int
id|oldx
comma
id|oldy
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
id|scr_writew
c_func
(paren
id|old
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|old
comma
id|oldy
comma
id|oldx
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
op_eq
op_minus
l_int|1
)paren
id|p
op_assign
l_int|NULL
suffix:semicolon
r_else
(brace
r_int
r_int
r_new
suffix:semicolon
id|p
op_assign
id|screenpos
c_func
(paren
id|currcons
comma
id|offset
comma
l_int|1
)paren
suffix:semicolon
id|old
op_assign
id|scr_readw
c_func
(paren
id|p
)paren
suffix:semicolon
r_new
op_assign
id|old
op_xor
id|complement_mask
suffix:semicolon
id|scr_writew
c_func
(paren
r_new
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
id|oldx
op_assign
(paren
id|offset
op_rshift
l_int|1
)paren
op_mod
id|video_num_columns
suffix:semicolon
id|oldy
op_assign
(paren
id|offset
op_rshift
l_int|1
)paren
op_div
id|video_num_columns
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
r_new
comma
id|oldy
comma
id|oldx
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|insert_char
r_static
r_void
id|insert_char
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_int
r_int
op_star
id|p
comma
op_star
id|q
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
id|p
op_assign
id|q
op_plus
id|video_num_columns
op_minus
id|nr
op_minus
id|x
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|p
op_ge
id|q
)paren
id|scr_writew
c_func
(paren
id|scr_readw
c_func
(paren
id|p
)paren
comma
id|p
op_plus
id|nr
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
id|q
comma
id|video_erase_char
comma
id|nr
op_star
l_int|2
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
r_int
r_int
id|oldattr
op_assign
id|attr
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_bmove
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
id|x
comma
id|y
comma
id|x
op_plus
id|nr
comma
l_int|1
comma
id|video_num_columns
op_minus
id|x
op_minus
id|nr
)paren
suffix:semicolon
id|attr
op_assign
id|video_erase_char
op_rshift
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|video_erase_char
comma
id|y
comma
id|x
op_plus
id|nr
)paren
suffix:semicolon
id|attr
op_assign
id|oldattr
suffix:semicolon
)brace
)brace
DECL|function|delete_char
r_static
r_void
id|delete_char
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_int
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|i
op_le
id|video_num_columns
op_minus
id|nr
)paren
(brace
id|scr_writew
c_func
(paren
id|scr_readw
c_func
(paren
id|p
op_plus
id|nr
)paren
comma
id|p
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|scr_memsetw
c_func
(paren
id|p
comma
id|video_erase_char
comma
id|nr
op_star
l_int|2
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
r_int
r_int
id|oldattr
op_assign
id|attr
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_bmove
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
id|x
op_plus
id|nr
comma
id|y
comma
id|x
comma
l_int|1
comma
id|video_num_columns
op_minus
id|x
op_minus
id|nr
)paren
suffix:semicolon
id|attr
op_assign
id|video_erase_char
op_rshift
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|video_erase_char
comma
id|y
comma
id|video_num_columns
op_minus
l_int|1
op_minus
id|nr
)paren
suffix:semicolon
id|attr
op_assign
id|oldattr
suffix:semicolon
)brace
)brace
DECL|variable|softcursor_original
r_static
r_int
id|softcursor_original
suffix:semicolon
DECL|function|add_softcursor
r_static
r_void
id|add_softcursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|i
op_assign
id|scr_readw
c_func
(paren
(paren
id|u16
op_star
)paren
id|pos
)paren
suffix:semicolon
id|u32
id|type
op_assign
id|cursor_type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|type
op_amp
l_int|0x10
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|softcursor_original
op_ne
op_minus
l_int|1
)paren
r_return
suffix:semicolon
id|softcursor_original
op_assign
id|i
suffix:semicolon
id|i
op_or_assign
(paren
(paren
id|type
op_rshift
l_int|8
)paren
op_amp
l_int|0xff00
)paren
suffix:semicolon
id|i
op_xor_assign
(paren
(paren
id|type
)paren
op_amp
l_int|0xff00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_amp
l_int|0x20
)paren
op_logical_and
(paren
(paren
id|softcursor_original
op_amp
l_int|0x7000
)paren
op_eq
(paren
id|i
op_amp
l_int|0x7000
)paren
)paren
)paren
id|i
op_xor_assign
l_int|0x7000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_amp
l_int|0x40
)paren
op_logical_and
(paren
(paren
id|i
op_amp
l_int|0x700
)paren
op_eq
(paren
(paren
id|i
op_amp
l_int|0x7000
)paren
op_rshift
l_int|4
)paren
)paren
)paren
id|i
op_xor_assign
l_int|0x0700
suffix:semicolon
id|scr_writew
c_func
(paren
id|i
comma
(paren
id|u16
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|i
comma
id|y
comma
id|x
)paren
suffix:semicolon
)brace
DECL|function|hide_cursor
r_static
r_void
id|hide_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|currcons
op_eq
id|sel_cons
)paren
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|softcursor_original
op_ne
op_minus
l_int|1
)paren
(brace
id|scr_writew
c_func
(paren
id|softcursor_original
comma
(paren
id|u16
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_putc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|softcursor_original
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|softcursor_original
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|sw
op_member_access_from_pointer
id|con_cursor
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|CM_ERASE
)paren
suffix:semicolon
)brace
DECL|function|set_cursor
r_static
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_FG
op_logical_or
id|console_blanked
op_logical_or
id|vcmode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|deccm
)paren
(brace
r_if
c_cond
(paren
id|currcons
op_eq
id|sel_cons
)paren
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
id|add_softcursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cursor_type
op_amp
l_int|0x0f
)paren
op_ne
l_int|1
)paren
id|sw
op_member_access_from_pointer
id|con_cursor
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|CM_DRAW
)paren
suffix:semicolon
)brace
r_else
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|set_origin
r_static
r_void
id|set_origin
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_VISIBLE
op_logical_or
op_logical_neg
id|sw-&gt;con_set_origin
op_logical_or
op_logical_neg
id|sw
op_member_access_from_pointer
id|con_set_origin
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
)paren
id|origin
op_assign
(paren
r_int
r_int
)paren
id|screenbuf
suffix:semicolon
id|visible_origin
op_assign
id|origin
suffix:semicolon
id|scr_end
op_assign
id|origin
op_plus
id|screenbuf_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|video_size_row
op_star
id|y
op_plus
l_int|2
op_star
id|x
suffix:semicolon
)brace
DECL|function|save_screen
r_static
r_inline
r_void
id|save_screen
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|sw-&gt;con_save_screen
)paren
id|sw
op_member_access_from_pointer
id|con_save_screen
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Redrawing of screen&n; */
DECL|function|redraw_screen
r_void
id|redraw_screen
c_func
(paren
r_int
id|new_console
comma
r_int
id|is_switch
)paren
(brace
r_int
id|redraw
op_assign
l_int|1
suffix:semicolon
r_int
id|currcons
comma
id|old_console
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|new_console
)paren
)paren
(brace
multiline_comment|/* strange ... */
multiline_comment|/* printk(&quot;redraw_screen: tty %d not allocated ??&bslash;n&quot;, new_console+1); */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is_switch
)paren
(brace
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fg_console
op_ne
id|new_console
)paren
(brace
r_struct
id|vc_data
op_star
op_star
id|display
op_assign
id|vc_cons
(braket
id|new_console
)braket
dot
id|d-&gt;vc_display_fg
suffix:semicolon
id|old_console
op_assign
(paren
op_star
id|display
)paren
ques
c_cond
(paren
op_star
id|display
)paren
op_member_access_from_pointer
id|vc_num
suffix:colon
id|fg_console
suffix:semicolon
op_star
id|display
op_assign
id|vc_cons
(braket
id|new_console
)braket
dot
id|d
suffix:semicolon
id|fg_console
op_assign
id|new_console
suffix:semicolon
id|currcons
op_assign
id|old_console
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_VISIBLE
)paren
(brace
id|save_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
id|currcons
op_assign
id|new_console
suffix:semicolon
r_if
c_cond
(paren
id|old_console
op_eq
id|new_console
)paren
id|redraw
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|currcons
op_assign
id|new_console
suffix:semicolon
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|redraw
)paren
(brace
r_int
id|update
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update
op_assign
id|sw
op_member_access_from_pointer
id|con_switch
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
suffix:semicolon
id|set_palette
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|update
op_logical_and
id|vcmode
op_ne
id|KD_GRAPHICS
)paren
id|do_update_region
c_func
(paren
id|currcons
comma
id|origin
comma
id|screenbuf_size
op_div
l_int|2
)paren
suffix:semicolon
)brace
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_switch
)paren
(brace
id|set_leds
c_func
(paren
)paren
suffix:semicolon
id|compute_shiftstate
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Allocation, freeing and resizing of VTs.&n; */
DECL|function|vc_cons_allocated
r_int
id|vc_cons_allocated
c_func
(paren
r_int
r_int
id|i
)paren
(brace
r_return
(paren
id|i
OL
id|MAX_NR_CONSOLES
op_logical_and
id|vc_cons
(braket
id|i
)braket
dot
id|d
)paren
suffix:semicolon
)brace
DECL|function|visual_init
r_static
r_void
id|visual_init
c_func
(paren
r_int
id|currcons
comma
r_int
id|init
)paren
(brace
multiline_comment|/* ++Geert: sw-&gt;con_init determines console size */
id|sw
op_assign
id|conswitchp
suffix:semicolon
macro_line|#ifndef VT_SINGLE_DRIVER
r_if
c_cond
(paren
id|con_driver_map
(braket
id|currcons
)braket
)paren
id|sw
op_assign
id|con_driver_map
(braket
id|currcons
)braket
suffix:semicolon
macro_line|#endif
id|cons_num
op_assign
id|currcons
suffix:semicolon
id|display_fg
op_assign
op_amp
id|master_display_fg
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_uni_pagedir_loc
op_assign
op_amp
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_uni_pagedir
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_uni_pagedir
op_assign
l_int|0
suffix:semicolon
id|hi_font_mask
op_assign
l_int|0
suffix:semicolon
id|complement_mask
op_assign
l_int|0
suffix:semicolon
id|can_do_color
op_assign
l_int|0
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_init
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|init
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|complement_mask
)paren
id|complement_mask
op_assign
id|can_do_color
ques
c_cond
l_int|0x7700
suffix:colon
l_int|0x0800
suffix:semicolon
id|s_complement_mask
op_assign
id|complement_mask
suffix:semicolon
id|video_size_row
op_assign
id|video_num_columns
op_lshift
l_int|1
suffix:semicolon
id|screenbuf_size
op_assign
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
)brace
DECL|function|vc_allocate
r_int
id|vc_allocate
c_func
(paren
r_int
r_int
id|currcons
)paren
multiline_comment|/* return 0 on success */
(brace
r_if
c_cond
(paren
id|currcons
op_ge
id|MAX_NR_CONSOLES
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
(brace
r_int
id|p
comma
id|q
suffix:semicolon
multiline_comment|/* prevent users from taking too much memory */
r_if
c_cond
(paren
id|currcons
op_ge
id|MAX_NR_USER_CONSOLES
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RESOURCE
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* due to the granularity of kmalloc, we waste some memory here */
multiline_comment|/* the alloc is done in two steps, to optimize the common situation&n;&t;       of a 25x80 console (structsize=216, screenbuf_size=4000) */
multiline_comment|/* although the numbers above are not valid since long ago, the&n;&t;       point is still up-to-date and the comment still has its value&n;&t;       even if only as a historical artifact.  --mj, July 1998 */
id|p
op_assign
(paren
r_int
)paren
id|kmalloc
c_func
(paren
id|structsize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
(paren
r_struct
id|vc_data
op_star
)paren
id|p
suffix:semicolon
id|vt_cons
(braket
id|currcons
)braket
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
(paren
id|p
op_plus
r_sizeof
(paren
r_struct
id|vc_data
)paren
)paren
suffix:semicolon
id|visual_init
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_uni_pagedir_loc
)paren
id|con_set_default_unimap
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|q
op_assign
(paren
r_int
)paren
id|kmalloc
c_func
(paren
id|screenbuf_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|kfree
c_func
(paren
(paren
r_char
op_star
)paren
id|p
)paren
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
l_int|NULL
suffix:semicolon
id|vt_cons
(braket
id|currcons
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|screenbuf
op_assign
(paren
r_int
r_int
op_star
)paren
id|q
suffix:semicolon
id|kmalloced
op_assign
l_int|1
suffix:semicolon
id|vc_init
c_func
(paren
id|currcons
comma
id|video_num_lines
comma
id|video_num_columns
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pm_con
)paren
(brace
id|pm_con
op_assign
id|pm_register
c_func
(paren
id|PM_SYS_DEV
comma
id|PM_SYS_VGA
comma
id|pm_con_request
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Change # of rows and columns (0 means unchanged/the size of fg_console)&n; * [this is to be used together with some user program&n; * like resize that changes the hardware videomode]&n; */
DECL|function|vc_resize
r_int
id|vc_resize
c_func
(paren
r_int
r_int
id|lines
comma
r_int
r_int
id|cols
comma
r_int
r_int
id|first
comma
r_int
r_int
id|last
)paren
(brace
r_int
r_int
id|cc
comma
id|ll
comma
id|ss
comma
id|sr
comma
id|todo
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|currcons
op_assign
id|fg_console
comma
id|i
suffix:semicolon
r_int
r_int
op_star
id|newscreens
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
id|cc
op_assign
(paren
id|cols
ques
c_cond
id|cols
suffix:colon
id|video_num_columns
)paren
suffix:semicolon
id|ll
op_assign
(paren
id|lines
ques
c_cond
id|lines
suffix:colon
id|video_num_lines
)paren
suffix:semicolon
id|sr
op_assign
id|cc
op_lshift
l_int|1
suffix:semicolon
id|ss
op_assign
id|sr
op_star
id|ll
suffix:semicolon
r_for
c_loop
(paren
id|currcons
op_assign
id|first
suffix:semicolon
id|currcons
op_le
id|last
suffix:semicolon
id|currcons
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
op_logical_or
(paren
id|cc
op_eq
id|video_num_columns
op_logical_and
id|ll
op_eq
id|video_num_lines
)paren
)paren
id|newscreens
(braket
id|currcons
)braket
op_assign
l_int|NULL
suffix:semicolon
r_else
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|ss
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|first
suffix:semicolon
id|i
OL
id|currcons
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|newscreens
(braket
id|i
)braket
)paren
id|kfree
c_func
(paren
id|newscreens
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|newscreens
(braket
id|currcons
)braket
op_assign
id|p
suffix:semicolon
id|todo
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|todo
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|currcons
op_assign
id|first
suffix:semicolon
id|currcons
op_le
id|last
suffix:semicolon
id|currcons
op_increment
)paren
(brace
r_int
r_int
id|occ
comma
id|oll
comma
id|oss
comma
id|osr
suffix:semicolon
r_int
r_int
id|ol
comma
id|nl
comma
id|nlend
comma
id|rlth
comma
id|rrem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newscreens
(braket
id|currcons
)braket
op_logical_or
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
r_continue
suffix:semicolon
id|oll
op_assign
id|video_num_lines
suffix:semicolon
id|occ
op_assign
id|video_num_columns
suffix:semicolon
id|osr
op_assign
id|video_size_row
suffix:semicolon
id|oss
op_assign
id|screenbuf_size
suffix:semicolon
id|video_num_lines
op_assign
id|ll
suffix:semicolon
id|video_num_columns
op_assign
id|cc
suffix:semicolon
id|video_size_row
op_assign
id|sr
suffix:semicolon
id|screenbuf_size
op_assign
id|ss
suffix:semicolon
id|rlth
op_assign
id|MIN
c_func
(paren
id|osr
comma
id|sr
)paren
suffix:semicolon
id|rrem
op_assign
id|sr
op_minus
id|rlth
suffix:semicolon
id|ol
op_assign
id|origin
suffix:semicolon
id|nl
op_assign
(paren
r_int
)paren
id|newscreens
(braket
id|currcons
)braket
suffix:semicolon
id|nlend
op_assign
id|nl
op_plus
id|ss
suffix:semicolon
r_if
c_cond
(paren
id|ll
OL
id|oll
)paren
id|ol
op_add_assign
(paren
id|oll
op_minus
id|ll
)paren
op_star
id|osr
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ol
OL
id|scr_end
)paren
(brace
id|scr_memcpyw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|nl
comma
(paren
r_int
r_int
op_star
)paren
id|ol
comma
id|rlth
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rrem
)paren
id|scr_memsetw
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|nl
op_plus
id|rlth
)paren
comma
id|video_erase_char
comma
id|rrem
)paren
suffix:semicolon
id|ol
op_add_assign
id|osr
suffix:semicolon
id|nl
op_add_assign
id|sr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nlend
OG
id|nl
)paren
id|scr_memsetw
c_func
(paren
(paren
r_void
op_star
)paren
id|nl
comma
id|video_erase_char
comma
id|nlend
op_minus
id|nl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kmalloced
)paren
id|kfree
c_func
(paren
id|screenbuf
)paren
suffix:semicolon
id|screenbuf
op_assign
id|newscreens
(braket
id|currcons
)braket
suffix:semicolon
id|kmalloced
op_assign
l_int|1
suffix:semicolon
id|screenbuf_size
op_assign
id|ss
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
multiline_comment|/* do part of a reset_terminal() */
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
)paren
suffix:semicolon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|console_table
(braket
id|currcons
)braket
)paren
(brace
r_struct
id|winsize
id|ws
comma
op_star
id|cws
op_assign
op_amp
id|console_table
(braket
id|currcons
)braket
op_member_access_from_pointer
id|winsize
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ws
comma
l_int|0
comma
r_sizeof
(paren
id|ws
)paren
)paren
suffix:semicolon
id|ws.ws_row
op_assign
id|video_num_lines
suffix:semicolon
id|ws.ws_col
op_assign
id|video_num_columns
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ws.ws_row
op_ne
id|cws-&gt;ws_row
op_logical_or
id|ws.ws_col
op_ne
id|cws-&gt;ws_col
)paren
op_logical_and
id|console_table
(braket
id|currcons
)braket
op_member_access_from_pointer
id|pgrp
OG
l_int|0
)paren
id|kill_pg
c_func
(paren
id|console_table
(braket
id|currcons
)braket
op_member_access_from_pointer
id|pgrp
comma
id|SIGWINCH
comma
l_int|1
)paren
suffix:semicolon
op_star
id|cws
op_assign
id|ws
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IS_VISIBLE
)paren
id|update_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vc_disallocate
r_void
id|vc_disallocate
c_func
(paren
r_int
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
id|sw
op_member_access_from_pointer
id|con_deinit
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kmalloced
)paren
id|kfree
c_func
(paren
id|screenbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ge
id|MIN_NR_CONSOLES
)paren
id|kfree
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
)paren
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;VT102 emulator&n; */
DECL|macro|set_kbd
mdefine_line|#define set_kbd(x) set_vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|clr_kbd
mdefine_line|#define clr_kbd(x) clr_vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|is_kbd
mdefine_line|#define is_kbd(x) vc_kbd_mode(kbd_table+currcons,x)
DECL|macro|decarm
mdefine_line|#define decarm&t;&t;VC_REPEAT
DECL|macro|decckm
mdefine_line|#define decckm&t;&t;VC_CKMODE
DECL|macro|kbdapplic
mdefine_line|#define kbdapplic&t;VC_APPLIC
DECL|macro|lnm
mdefine_line|#define lnm&t;&t;VC_CRLF
multiline_comment|/*&n; * this is what the terminal answers to a ESC-Z or csi0c query.&n; */
DECL|macro|VT100ID
mdefine_line|#define VT100ID &quot;&bslash;033[?1;2c&quot;
DECL|macro|VT102ID
mdefine_line|#define VT102ID &quot;&bslash;033[?6c&quot;
DECL|variable|color_table
r_int
r_char
id|color_table
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|4
comma
l_int|2
comma
l_int|6
comma
l_int|1
comma
l_int|5
comma
l_int|3
comma
l_int|7
comma
l_int|8
comma
l_int|12
comma
l_int|10
comma
l_int|14
comma
l_int|9
comma
l_int|13
comma
l_int|11
comma
l_int|15
)brace
suffix:semicolon
multiline_comment|/* the default colour table, for VGA+ colour systems */
DECL|variable|default_red
r_int
id|default_red
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0xaa
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0x55
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|default_grn
r_int
id|default_grn
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0x55
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x55
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x55
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|default_blu
r_int
id|default_blu
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x55
comma
l_int|0x55
comma
l_int|0x55
comma
l_int|0x55
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/*&n; * gotoxy() must verify all boundaries, because the arguments&n; * might also be negative. If the given position is out of&n; * bounds, the cursor is placed at the nearest margin.&n; */
DECL|function|gotoxy
r_static
r_void
id|gotoxy
c_func
(paren
r_int
id|currcons
comma
r_int
id|new_x
comma
r_int
id|new_y
)paren
(brace
r_int
id|min_y
comma
id|max_y
suffix:semicolon
r_if
c_cond
(paren
id|new_x
OL
l_int|0
)paren
id|x
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_x
op_ge
id|video_num_columns
)paren
id|x
op_assign
id|video_num_columns
op_minus
l_int|1
suffix:semicolon
r_else
id|x
op_assign
id|new_x
suffix:semicolon
r_if
c_cond
(paren
id|decom
)paren
(brace
id|min_y
op_assign
id|top
suffix:semicolon
id|max_y
op_assign
id|bottom
suffix:semicolon
)brace
r_else
(brace
id|min_y
op_assign
l_int|0
suffix:semicolon
id|max_y
op_assign
id|video_num_lines
suffix:semicolon
)brace
r_if
c_cond
(paren
id|new_y
OL
id|min_y
)paren
id|y
op_assign
id|min_y
suffix:semicolon
r_else
r_if
c_cond
(paren
id|new_y
op_ge
id|max_y
)paren
id|y
op_assign
id|max_y
op_minus
l_int|1
suffix:semicolon
r_else
id|y
op_assign
id|new_y
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* for absolute user moves, when decom is set */
DECL|function|gotoxay
r_static
r_void
id|gotoxay
c_func
(paren
r_int
id|currcons
comma
r_int
id|new_x
comma
r_int
id|new_y
)paren
(brace
id|gotoxy
c_func
(paren
id|currcons
comma
id|new_x
comma
id|decom
ques
c_cond
(paren
id|top
op_plus
id|new_y
)paren
suffix:colon
id|new_y
)paren
suffix:semicolon
)brace
DECL|function|scrollback
r_void
id|scrollback
c_func
(paren
r_int
id|lines
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lines
)paren
id|lines
op_assign
id|video_num_lines
op_div
l_int|2
suffix:semicolon
id|scrolldelta
c_func
(paren
op_minus
id|lines
)paren
suffix:semicolon
)brace
DECL|function|scrollfront
r_void
id|scrollfront
c_func
(paren
r_int
id|lines
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lines
)paren
id|lines
op_assign
id|video_num_lines
op_div
l_int|2
suffix:semicolon
id|scrolldelta
c_func
(paren
id|lines
)paren
suffix:semicolon
)brace
DECL|function|lf
r_static
r_void
id|lf
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* don&squot;t scroll if above bottom of scrolling region, or&n;&t; * if below scrolling region&n;&t; */
r_if
c_cond
(paren
id|y
op_plus
l_int|1
op_eq
id|bottom
)paren
id|scrup
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
comma
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|y
OL
id|video_num_lines
op_minus
l_int|1
)paren
(brace
id|y
op_increment
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ri
r_static
r_void
id|ri
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* don&squot;t scroll if below top of scrolling region, or&n;&t; * if above scrolling region&n;&t; */
r_if
c_cond
(paren
id|y
op_eq
id|top
)paren
id|scrdown
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
comma
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|y
OG
l_int|0
)paren
(brace
id|y
op_decrement
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
)brace
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|cr
r_static
r_inline
r_void
id|cr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|pos
op_sub_assign
id|x
op_lshift
l_int|1
suffix:semicolon
id|need_wrap
op_assign
id|x
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|bs
r_static
r_inline
r_void
id|bs
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|pos
op_sub_assign
l_int|2
suffix:semicolon
id|x
op_decrement
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|del
r_static
r_inline
r_void
id|del
c_func
(paren
r_int
id|currcons
)paren
(brace
multiline_comment|/* ignored */
)brace
DECL|function|csi_J
r_static
r_void
id|csi_J
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of display */
id|count
op_assign
(paren
id|scr_end
op_minus
id|pos
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
multiline_comment|/* do in two stages */
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
id|x
comma
l_int|1
comma
id|video_num_columns
op_minus
id|x
)paren
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
op_plus
l_int|1
comma
l_int|0
comma
id|video_num_lines
op_minus
id|y
op_minus
l_int|1
comma
id|video_num_columns
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start to cursor */
id|count
op_assign
(paren
(paren
id|pos
op_minus
id|origin
)paren
op_rshift
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
(brace
multiline_comment|/* do in two stages */
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
l_int|0
comma
l_int|0
comma
id|y
comma
id|video_num_columns
)paren
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
l_int|0
comma
l_int|1
comma
id|x
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole display */
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
l_int|0
comma
l_int|0
comma
id|video_num_lines
comma
id|video_num_columns
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|scr_memsetw
c_func
(paren
id|start
comma
id|video_erase_char
comma
l_int|2
op_star
id|count
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_K
r_static
r_void
id|csi_K
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of line */
id|count
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
id|x
comma
l_int|1
comma
id|video_num_columns
op_minus
id|x
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start of line to cursor */
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|count
op_assign
id|x
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
l_int|0
comma
l_int|1
comma
id|x
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole line */
id|start
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
l_int|0
comma
l_int|1
comma
id|video_num_columns
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|scr_memsetw
c_func
(paren
id|start
comma
id|video_erase_char
comma
l_int|2
op_star
id|count
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_X
r_static
r_void
id|csi_X
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
multiline_comment|/* erase the following vpar positions */
(brace
multiline_comment|/* not vt100? */
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vpar
)paren
id|vpar
op_increment
suffix:semicolon
id|count
op_assign
(paren
id|vpar
OG
id|video_num_columns
op_minus
id|x
)paren
ques
c_cond
(paren
id|video_num_columns
op_minus
id|x
)paren
suffix:colon
id|vpar
suffix:semicolon
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|pos
comma
id|video_erase_char
comma
l_int|2
op_star
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
)paren
id|sw
op_member_access_from_pointer
id|con_clear
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|y
comma
id|x
comma
l_int|1
comma
id|count
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|default_attr
r_static
r_void
id|default_attr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|intensity
op_assign
l_int|1
suffix:semicolon
id|underline
op_assign
l_int|0
suffix:semicolon
id|reverse
op_assign
l_int|0
suffix:semicolon
id|blink
op_assign
l_int|0
suffix:semicolon
id|color
op_assign
id|def_color
suffix:semicolon
)brace
DECL|function|csi_m
r_static
r_void
id|csi_m
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* all attributes off */
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|intensity
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|intensity
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|underline
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|blink
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|reverse
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select primary font, don&squot;t display&n;&t;&t;&t;&t;  * control chars if defined, don&squot;t set&n;&t;&t;&t;&t;  * bit 8 on output.&n;&t;&t;&t;&t;  */
id|translate
op_assign
id|set_translate
c_func
(paren
id|charset
op_eq
l_int|0
ques
c_cond
id|G0_charset
suffix:colon
id|G1_charset
comma
id|currcons
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select first alternate font, lets&n;&t;&t;&t;&t;  * chars &lt; 32 be displayed as ROM chars.&n;&t;&t;&t;&t;  */
id|translate
op_assign
id|set_translate
c_func
(paren
id|IBMPC_MAP
comma
id|currcons
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Select second alternate font, toggle&n;&t;&t;&t;&t;  * high bit before displaying as ROM char.&n;&t;&t;&t;&t;  */
id|translate
op_assign
id|set_translate
c_func
(paren
id|IBMPC_MAP
comma
id|currcons
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
id|toggle_meta
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|21
suffix:colon
r_case
l_int|22
suffix:colon
id|intensity
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|underline
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|25
suffix:colon
id|blink
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|27
suffix:colon
id|reverse
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|38
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Enables underscore, white foreground&n;&t;&t;&t;&t;  * with white underscore (Linux - use&n;&t;&t;&t;&t;  * default foreground).&n;&t;&t;&t;&t;  */
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0x0f
)paren
op_or
id|background
suffix:semicolon
id|underline
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|39
suffix:colon
multiline_comment|/* ANSI X3.64-1979 (SCO-ish?)&n;&t;&t;&t;&t;  * Disable underline option.&n;&t;&t;&t;&t;  * Reset colour to default? It did this&n;&t;&t;&t;&t;  * before...&n;&t;&t;&t;&t;  */
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0x0f
)paren
op_or
id|background
suffix:semicolon
id|underline
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|49
suffix:colon
id|color
op_assign
(paren
id|def_color
op_amp
l_int|0xf0
)paren
op_or
id|foreground
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|30
op_logical_and
id|par
(braket
id|i
)braket
op_le
l_int|37
)paren
id|color
op_assign
id|color_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|30
)braket
op_or
id|background
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|40
op_logical_and
id|par
(braket
id|i
)braket
op_le
l_int|47
)paren
id|color
op_assign
(paren
id|color_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|40
)braket
op_lshift
l_int|4
)paren
op_or
id|foreground
suffix:semicolon
r_break
suffix:semicolon
)brace
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|respond_string
r_static
r_void
id|respond_string
c_func
(paren
r_const
r_char
op_star
id|p
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_while
c_loop
(paren
op_star
id|p
)paren
(brace
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
op_star
id|p
comma
l_int|0
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|con_schedule_flip
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|cursor_report
r_static
r_void
id|cursor_report
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_char
id|buf
(braket
l_int|40
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;033[%d;%dR&quot;
comma
id|y
op_plus
(paren
id|decom
ques
c_cond
id|top
op_plus
l_int|1
suffix:colon
l_int|1
)paren
comma
id|x
op_plus
l_int|1
)paren
suffix:semicolon
id|respond_string
c_func
(paren
id|buf
comma
id|tty
)paren
suffix:semicolon
)brace
DECL|function|status_report
r_static
r_inline
r_void
id|status_report
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|respond_string
c_func
(paren
l_string|&quot;&bslash;033[0n&quot;
comma
id|tty
)paren
suffix:semicolon
multiline_comment|/* Terminal ok */
)brace
DECL|function|respond_ID
r_static
r_inline
r_void
id|respond_ID
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|respond_string
c_func
(paren
id|VT102ID
comma
id|tty
)paren
suffix:semicolon
)brace
DECL|function|mouse_report
r_void
id|mouse_report
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|butt
comma
r_int
id|mrx
comma
r_int
id|mry
)paren
(brace
r_char
id|buf
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;033[M%c%c%c&quot;
comma
(paren
r_char
)paren
(paren
l_char|&squot; &squot;
op_plus
id|butt
)paren
comma
(paren
r_char
)paren
(paren
l_char|&squot;!&squot;
op_plus
id|mrx
)paren
comma
(paren
r_char
)paren
(paren
l_char|&squot;!&squot;
op_plus
id|mry
)paren
)paren
suffix:semicolon
id|respond_string
c_func
(paren
id|buf
comma
id|tty
)paren
suffix:semicolon
)brace
multiline_comment|/* invoked via ioctl(TIOCLINUX) and through set_selection */
DECL|function|mouse_reporting
r_int
id|mouse_reporting
c_func
(paren
r_void
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_return
id|report_mouse
suffix:semicolon
)brace
DECL|function|set_mode
r_static
r_void
id|set_mode
c_func
(paren
r_int
id|currcons
comma
r_int
id|on_off
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ques
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* DEC private modes set/reset */
r_case
l_int|1
suffix:colon
multiline_comment|/* Cursor keys send ^[Ox/^[[x */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* 80/132 mode switch unimplemented */
id|deccolm
op_assign
id|on_off
suffix:semicolon
macro_line|#if 0
(paren
r_void
)paren
id|vc_resize
c_func
(paren
id|video_num_lines
comma
id|deccolm
ques
c_cond
l_int|132
suffix:colon
l_int|80
)paren
suffix:semicolon
multiline_comment|/* this alone does not suffice; some user mode&n;&t;&t;&t;&t;   utility has to change the hardware regs */
macro_line|#endif
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Inverted screen on/off */
r_if
c_cond
(paren
id|decscnm
op_ne
id|on_off
)paren
(brace
id|decscnm
op_assign
id|on_off
suffix:semicolon
id|invert_screen
c_func
(paren
id|currcons
comma
l_int|0
comma
id|screenbuf_size
comma
l_int|0
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* Origin relative/absolute */
id|decom
op_assign
id|on_off
suffix:semicolon
id|gotoxay
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
multiline_comment|/* Autowrap on/off */
id|decawm
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* Autorepeat on/off */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|report_mouse
op_assign
id|on_off
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|25
suffix:colon
multiline_comment|/* Cursor on/off */
id|deccm
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1000
suffix:colon
id|report_mouse
op_assign
id|on_off
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* ANSI modes set/reset */
r_case
l_int|3
suffix:colon
multiline_comment|/* Monitor (display ctrls) */
id|disp_ctrl
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* Insert Mode on/off */
id|decim
op_assign
id|on_off
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|20
suffix:colon
multiline_comment|/* Lf, Enter == CrLf/Lf */
r_if
c_cond
(paren
id|on_off
)paren
id|set_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
r_else
id|clr_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|setterm_command
r_static
r_void
id|setterm_command
c_func
(paren
r_int
id|currcons
)paren
(brace
r_switch
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* set color for underline mode */
r_if
c_cond
(paren
id|can_do_color
op_logical_and
id|par
(braket
l_int|1
)braket
OL
l_int|16
)paren
(brace
id|ulcolor
op_assign
id|color_table
(braket
id|par
(braket
l_int|1
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|underline
)paren
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* set color for half intensity mode */
r_if
c_cond
(paren
id|can_do_color
op_logical_and
id|par
(braket
l_int|1
)braket
OL
l_int|16
)paren
(brace
id|halfcolor
op_assign
id|color_table
(braket
id|par
(braket
l_int|1
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|intensity
op_eq
l_int|0
)paren
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* store colors as defaults */
id|def_color
op_assign
id|attr
suffix:semicolon
r_if
c_cond
(paren
id|hi_font_mask
op_eq
l_int|0x100
)paren
id|def_color
op_rshift_assign
l_int|1
suffix:semicolon
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
multiline_comment|/* set blanking interval */
id|blankinterval
op_assign
(paren
(paren
id|par
(braket
l_int|1
)braket
OL
l_int|60
)paren
ques
c_cond
id|par
(braket
l_int|1
)braket
suffix:colon
l_int|60
)paren
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
id|poke_blanked_console
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
multiline_comment|/* set bell frequency in Hz */
r_if
c_cond
(paren
id|npar
op_ge
l_int|1
)paren
id|bell_pitch
op_assign
id|par
(braket
l_int|1
)braket
suffix:semicolon
r_else
id|bell_pitch
op_assign
id|DEFAULT_BELL_PITCH
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* set bell duration in msec */
r_if
c_cond
(paren
id|npar
op_ge
l_int|1
)paren
id|bell_duration
op_assign
(paren
id|par
(braket
l_int|1
)braket
OL
l_int|2000
)paren
ques
c_cond
id|par
(braket
l_int|1
)braket
op_star
id|HZ
op_div
l_int|1000
suffix:colon
l_int|0
suffix:semicolon
r_else
id|bell_duration
op_assign
id|DEFAULT_BELL_DURATION
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
multiline_comment|/* bring specified console to the front */
r_if
c_cond
(paren
id|par
(braket
l_int|1
)braket
op_ge
l_int|1
op_logical_and
id|vc_cons_allocated
c_func
(paren
id|par
(braket
l_int|1
)braket
op_minus
l_int|1
)paren
)paren
id|set_console
c_func
(paren
id|par
(braket
l_int|1
)braket
op_minus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|13
suffix:colon
multiline_comment|/* unblank the screen */
id|poke_blanked_console
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|14
suffix:colon
multiline_comment|/* set vesa powerdown interval */
id|vesa_off_interval
op_assign
(paren
(paren
id|par
(braket
l_int|1
)braket
OL
l_int|60
)paren
ques
c_cond
id|par
(braket
l_int|1
)braket
suffix:colon
l_int|60
)paren
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|insert_line
r_static
r_void
id|insert_line
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
id|scrdown
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
comma
id|nr
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|delete_line
r_static
r_void
id|delete_line
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
id|scrup
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
comma
id|nr
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|csi_at
r_static
r_void
id|csi_at
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
op_minus
id|x
)paren
id|nr
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
id|insert_char
c_func
(paren
id|currcons
comma
id|nr
)paren
suffix:semicolon
)brace
DECL|function|csi_L
r_static
r_void
id|csi_L
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
op_minus
id|y
)paren
id|nr
op_assign
id|video_num_lines
op_minus
id|y
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
id|insert_line
c_func
(paren
id|currcons
comma
id|nr
)paren
suffix:semicolon
)brace
DECL|function|csi_P
r_static
r_void
id|csi_P
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
op_minus
id|x
)paren
id|nr
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
id|delete_char
c_func
(paren
id|currcons
comma
id|nr
)paren
suffix:semicolon
)brace
DECL|function|csi_M
r_static
r_void
id|csi_M
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
op_minus
id|y
)paren
id|nr
op_assign
id|video_num_lines
op_minus
id|y
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
id|delete_line
c_func
(paren
id|currcons
comma
id|nr
)paren
suffix:semicolon
)brace
DECL|function|save_cur
r_static
r_void
id|save_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|saved_x
op_assign
id|x
suffix:semicolon
id|saved_y
op_assign
id|y
suffix:semicolon
id|s_intensity
op_assign
id|intensity
suffix:semicolon
id|s_underline
op_assign
id|underline
suffix:semicolon
id|s_blink
op_assign
id|blink
suffix:semicolon
id|s_reverse
op_assign
id|reverse
suffix:semicolon
id|s_charset
op_assign
id|charset
suffix:semicolon
id|s_color
op_assign
id|color
suffix:semicolon
id|saved_G0
op_assign
id|G0_charset
suffix:semicolon
id|saved_G1
op_assign
id|G1_charset
suffix:semicolon
)brace
DECL|function|restore_cur
r_static
r_void
id|restore_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|gotoxy
c_func
(paren
id|currcons
comma
id|saved_x
comma
id|saved_y
)paren
suffix:semicolon
id|intensity
op_assign
id|s_intensity
suffix:semicolon
id|underline
op_assign
id|s_underline
suffix:semicolon
id|blink
op_assign
id|s_blink
suffix:semicolon
id|reverse
op_assign
id|s_reverse
suffix:semicolon
id|charset
op_assign
id|s_charset
suffix:semicolon
id|color
op_assign
id|s_color
suffix:semicolon
id|G0_charset
op_assign
id|saved_G0
suffix:semicolon
id|G1_charset
op_assign
id|saved_G1
suffix:semicolon
id|translate
op_assign
id|set_translate
c_func
(paren
id|charset
ques
c_cond
id|G1_charset
suffix:colon
id|G0_charset
comma
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
)brace
DECL|enumerator|ESnormal
DECL|enumerator|ESesc
DECL|enumerator|ESsquare
DECL|enumerator|ESgetpars
DECL|enumerator|ESgotpars
DECL|enumerator|ESfunckey
r_enum
(brace
id|ESnormal
comma
id|ESesc
comma
id|ESsquare
comma
id|ESgetpars
comma
id|ESgotpars
comma
id|ESfunckey
comma
DECL|enumerator|EShash
DECL|enumerator|ESsetG0
DECL|enumerator|ESsetG1
DECL|enumerator|ESpercent
DECL|enumerator|ESignore
DECL|enumerator|ESnonstd
id|EShash
comma
id|ESsetG0
comma
id|ESsetG1
comma
id|ESpercent
comma
id|ESignore
comma
id|ESnonstd
comma
DECL|enumerator|ESpalette
id|ESpalette
)brace
suffix:semicolon
DECL|function|reset_terminal
r_static
r_void
id|reset_terminal
c_func
(paren
r_int
id|currcons
comma
r_int
id|do_clear
)paren
(brace
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
id|ques
op_assign
l_int|0
suffix:semicolon
id|translate
op_assign
id|set_translate
c_func
(paren
id|LAT1_MAP
comma
id|currcons
)paren
suffix:semicolon
id|G0_charset
op_assign
id|LAT1_MAP
suffix:semicolon
id|G1_charset
op_assign
id|GRAF_MAP
suffix:semicolon
id|charset
op_assign
l_int|0
suffix:semicolon
id|need_wrap
op_assign
l_int|0
suffix:semicolon
id|report_mouse
op_assign
l_int|0
suffix:semicolon
id|utf
op_assign
l_int|0
suffix:semicolon
id|utf_count
op_assign
l_int|0
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
id|toggle_meta
op_assign
l_int|0
suffix:semicolon
id|decscnm
op_assign
l_int|0
suffix:semicolon
id|decom
op_assign
l_int|0
suffix:semicolon
id|decawm
op_assign
l_int|1
suffix:semicolon
id|deccm
op_assign
l_int|1
suffix:semicolon
id|decim
op_assign
l_int|0
suffix:semicolon
id|set_kbd
c_func
(paren
id|decarm
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|decckm
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
id|clr_kbd
c_func
(paren
id|lnm
)paren
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|lockstate
op_assign
l_int|0
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|slockstate
op_assign
l_int|0
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|ledmode
op_assign
id|LED_SHOW_FLAGS
suffix:semicolon
id|kbd_table
(braket
id|currcons
)braket
dot
id|ledflagstate
op_assign
id|kbd_table
(braket
id|currcons
)braket
dot
id|default_ledflagstate
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
id|cursor_type
op_assign
id|CUR_DEFAULT
suffix:semicolon
id|complement_mask
op_assign
id|s_complement_mask
suffix:semicolon
id|default_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|tab_stop
(braket
l_int|0
)braket
op_assign
l_int|0x01010100
suffix:semicolon
id|tab_stop
(braket
l_int|1
)braket
op_assign
id|tab_stop
(braket
l_int|2
)braket
op_assign
id|tab_stop
(braket
l_int|3
)braket
op_assign
id|tab_stop
(braket
l_int|4
)braket
op_assign
l_int|0x01010101
suffix:semicolon
id|bell_pitch
op_assign
id|DEFAULT_BELL_PITCH
suffix:semicolon
id|bell_duration
op_assign
id|DEFAULT_BELL_DURATION
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_clear
)paren
id|csi_J
c_func
(paren
id|currcons
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|do_con_trol
r_static
r_void
id|do_con_trol
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_int
id|currcons
comma
r_int
id|c
)paren
(brace
multiline_comment|/*&n;&t; *  Control characters can be used in the _middle_&n;&t; *  of an escape sequence.&n;&t; */
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
suffix:semicolon
r_case
l_int|7
suffix:colon
r_if
c_cond
(paren
id|bell_duration
)paren
id|kd_mksound
c_func
(paren
id|bell_pitch
comma
id|bell_duration
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|8
suffix:colon
id|bs
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|9
suffix:colon
id|pos
op_sub_assign
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|x
OL
id|video_num_columns
op_minus
l_int|1
)paren
(brace
id|x
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_amp
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
id|pos
op_add_assign
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|10
suffix:colon
r_case
l_int|11
suffix:colon
r_case
l_int|12
suffix:colon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_kbd
c_func
(paren
id|lnm
)paren
)paren
r_return
suffix:semicolon
r_case
l_int|13
suffix:colon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|14
suffix:colon
id|charset
op_assign
l_int|1
suffix:semicolon
id|translate
op_assign
id|set_translate
c_func
(paren
id|G1_charset
comma
id|currcons
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|1
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|15
suffix:colon
id|charset
op_assign
l_int|0
suffix:semicolon
id|translate
op_assign
id|set_translate
c_func
(paren
id|G0_charset
comma
id|currcons
)paren
suffix:semicolon
id|disp_ctrl
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|26
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|27
suffix:colon
id|vc_state
op_assign
id|ESesc
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|127
suffix:colon
id|del
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|128
op_plus
l_int|27
suffix:colon
id|vc_state
op_assign
id|ESsquare
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vc_state
)paren
(brace
r_case
id|ESesc
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;[&squot;
suffix:colon
id|vc_state
op_assign
id|ESsquare
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;]&squot;
suffix:colon
id|vc_state
op_assign
id|ESnonstd
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;%&squot;
suffix:colon
id|vc_state
op_assign
id|ESpercent
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|ri
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;Z&squot;
suffix:colon
id|respond_ID
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;7&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;8&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;(&squot;
suffix:colon
id|vc_state
op_assign
id|ESsetG0
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;)&squot;
suffix:colon
id|vc_state
op_assign
id|ESsetG1
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;#&squot;
suffix:colon
id|vc_state
op_assign
id|EShash
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
id|reset_terminal
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;&gt;&squot;
suffix:colon
multiline_comment|/* Numeric keypad */
id|clr_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;=&squot;
suffix:colon
multiline_comment|/* Appl. keypad */
id|set_kbd
c_func
(paren
id|kbdapplic
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|ESnonstd
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;P&squot;
)paren
(brace
multiline_comment|/* palette escape sequence */
r_for
c_loop
(paren
id|npar
op_assign
l_int|0
suffix:semicolon
id|npar
OL
id|NPAR
suffix:semicolon
id|npar
op_increment
)paren
id|par
(braket
id|npar
)braket
op_assign
l_int|0
suffix:semicolon
id|npar
op_assign
l_int|0
suffix:semicolon
id|vc_state
op_assign
id|ESpalette
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;R&squot;
)paren
(brace
multiline_comment|/* reset palette */
id|reset_palette
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
)brace
r_else
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_case
id|ESpalette
suffix:colon
r_if
c_cond
(paren
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
op_logical_or
(paren
id|c
op_ge
l_char|&squot;A&squot;
op_logical_and
id|c
op_le
l_char|&squot;F&squot;
)paren
op_logical_or
(paren
id|c
op_ge
l_char|&squot;a&squot;
op_logical_and
id|c
op_le
l_char|&squot;f&squot;
)paren
)paren
(brace
id|par
(braket
id|npar
op_increment
)braket
op_assign
(paren
id|c
OG
l_char|&squot;9&squot;
ques
c_cond
(paren
id|c
op_amp
l_int|0xDF
)paren
op_minus
l_char|&squot;A&squot;
op_plus
l_int|10
suffix:colon
id|c
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|npar
op_eq
l_int|7
)paren
(brace
r_int
id|i
op_assign
id|par
(braket
l_int|0
)braket
op_star
l_int|3
comma
id|j
op_assign
l_int|1
suffix:semicolon
id|palette
(braket
id|i
)braket
op_assign
l_int|16
op_star
id|par
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette
(braket
id|i
op_increment
)braket
op_add_assign
id|par
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette
(braket
id|i
)braket
op_assign
l_int|16
op_star
id|par
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette
(braket
id|i
op_increment
)braket
op_add_assign
id|par
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette
(braket
id|i
)braket
op_assign
l_int|16
op_star
id|par
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette
(braket
id|i
)braket
op_add_assign
id|par
(braket
id|j
)braket
suffix:semicolon
id|set_palette
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
)brace
)brace
r_else
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_case
id|ESsquare
suffix:colon
r_for
c_loop
(paren
id|npar
op_assign
l_int|0
suffix:semicolon
id|npar
OL
id|NPAR
suffix:semicolon
id|npar
op_increment
)paren
(brace
id|par
(braket
id|npar
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|npar
op_assign
l_int|0
suffix:semicolon
id|vc_state
op_assign
id|ESgetpars
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;[&squot;
)paren
(brace
multiline_comment|/* Function key */
id|vc_state
op_assign
id|ESfunckey
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ques
op_assign
(paren
id|c
op_eq
l_char|&squot;?&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ques
)paren
r_return
suffix:semicolon
r_case
id|ESgetpars
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;;&squot;
op_logical_and
id|npar
OL
id|NPAR
op_minus
l_int|1
)paren
(brace
id|npar
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
(brace
id|par
(braket
id|npar
)braket
op_mul_assign
l_int|10
suffix:semicolon
id|par
(braket
id|npar
)braket
op_add_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|vc_state
op_assign
id|ESgotpars
suffix:semicolon
r_case
id|ESgotpars
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;h&squot;
suffix:colon
id|set_mode
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;l&squot;
suffix:colon
id|set_mode
c_func
(paren
id|currcons
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
r_if
c_cond
(paren
id|ques
)paren
(brace
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|cursor_type
op_assign
id|par
(braket
l_int|0
)braket
op_or
(paren
id|par
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|par
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_else
id|cursor_type
op_assign
id|CUR_DEFAULT
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
r_if
c_cond
(paren
id|ques
)paren
(brace
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|complement_mask
op_assign
id|par
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|par
(braket
l_int|1
)braket
suffix:semicolon
r_else
id|complement_mask
op_assign
id|s_complement_mask
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;n&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|ques
)paren
(brace
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|5
)paren
id|status_report
c_func
(paren
id|tty
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|6
)paren
id|cursor_report
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ques
)paren
(brace
id|ques
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;G&squot;
suffix:colon
r_case
l_char|&squot;`&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;A&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;e&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
r_case
l_char|&squot;a&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_plus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_minus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxay
c_func
(paren
id|currcons
comma
id|x
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
r_case
l_char|&squot;f&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_decrement
suffix:semicolon
id|gotoxay
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|1
)braket
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;J&squot;
suffix:colon
id|csi_J
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;K&squot;
suffix:colon
id|csi_K
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|csi_L
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|csi_M
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|csi_P
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|respond_ID
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;g&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|tab_stop
(braket
id|x
op_rshift
l_int|5
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|x
op_amp
l_int|31
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
op_eq
l_int|3
)paren
(brace
id|tab_stop
(braket
l_int|0
)braket
op_assign
id|tab_stop
(braket
l_int|1
)braket
op_assign
id|tab_stop
(braket
l_int|2
)braket
op_assign
id|tab_stop
(braket
l_int|3
)braket
op_assign
id|tab_stop
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
id|csi_m
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;q&squot;
suffix:colon
multiline_comment|/* DECLL - but only 3 leds */
multiline_comment|/* map 0,1,2,3 to 0,1,2,4 */
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
l_int|4
)paren
id|setledstate
c_func
(paren
id|kbd_table
op_plus
id|currcons
comma
(paren
id|par
(braket
l_int|0
)braket
OL
l_int|3
)paren
ques
c_cond
id|par
(braket
l_int|0
)braket
suffix:colon
l_int|4
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_assign
id|video_num_lines
suffix:semicolon
multiline_comment|/* Minimum allowed region is 2 lines */
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
id|par
(braket
l_int|1
)braket
op_logical_and
id|par
(braket
l_int|1
)braket
op_le
id|video_num_lines
)paren
(brace
id|top
op_assign
id|par
(braket
l_int|0
)braket
op_minus
l_int|1
suffix:semicolon
id|bottom
op_assign
id|par
(braket
l_int|1
)braket
suffix:semicolon
id|gotoxay
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;u&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;X&squot;
suffix:colon
id|csi_X
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;@&squot;
suffix:colon
id|csi_at
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;]&squot;
suffix:colon
multiline_comment|/* setterm functions */
id|setterm_command
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|ESpercent
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;@&squot;
suffix:colon
multiline_comment|/* defined in ISO 2022 */
id|utf
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;G&squot;
suffix:colon
multiline_comment|/* prelim official escape code */
r_case
l_char|&squot;8&squot;
suffix:colon
multiline_comment|/* retained for compatibility */
id|utf
op_assign
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|ESfunckey
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_case
id|EShash
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;8&squot;
)paren
(brace
multiline_comment|/* DEC screen alignment test. kludge :-) */
id|video_erase_char
op_assign
(paren
id|video_erase_char
op_amp
l_int|0xff00
)paren
op_or
l_char|&squot;E&squot;
suffix:semicolon
id|csi_J
c_func
(paren
id|currcons
comma
l_int|2
)paren
suffix:semicolon
id|video_erase_char
op_assign
(paren
id|video_erase_char
op_amp
l_int|0xff00
)paren
op_or
l_char|&squot; &squot;
suffix:semicolon
id|do_update_region
c_func
(paren
id|currcons
comma
id|origin
comma
id|screenbuf_size
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|ESsetG0
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;0&squot;
)paren
id|G0_charset
op_assign
id|GRAF_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;B&squot;
)paren
id|G0_charset
op_assign
id|LAT1_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;U&squot;
)paren
id|G0_charset
op_assign
id|IBMPC_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;K&squot;
)paren
id|G0_charset
op_assign
id|USER_MAP
suffix:semicolon
r_if
c_cond
(paren
id|charset
op_eq
l_int|0
)paren
id|translate
op_assign
id|set_translate
c_func
(paren
id|G0_charset
comma
id|currcons
)paren
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_case
id|ESsetG1
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;0&squot;
)paren
id|G1_charset
op_assign
id|GRAF_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;B&squot;
)paren
id|G1_charset
op_assign
id|LAT1_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;U&squot;
)paren
id|G1_charset
op_assign
id|IBMPC_MAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;K&squot;
)paren
id|G1_charset
op_assign
id|USER_MAP
suffix:semicolon
r_if
c_cond
(paren
id|charset
op_eq
l_int|1
)paren
id|translate
op_assign
id|set_translate
c_func
(paren
id|G1_charset
comma
id|currcons
)paren
suffix:semicolon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|vc_state
op_assign
id|ESnormal
suffix:semicolon
)brace
)brace
multiline_comment|/* This is a temporary buffer used to prepare a tty console write&n; * so that we can easily avoid touching user space while holding the&n; * console spinlock.  It is allocated in con_init and is shared by&n; * this code and the vc_screen read/write tty calls.&n; *&n; * We have to allocate this statically in the kernel data section&n; * since console_init (and thus con_init) are called before any&n; * kernel memory allocation is available.&n; */
DECL|variable|con_buf
r_char
id|con_buf
(braket
id|PAGE_SIZE
)braket
suffix:semicolon
DECL|macro|CON_BUF_SIZE
mdefine_line|#define CON_BUF_SIZE&t;PAGE_SIZE
DECL|variable|con_buf_sem
id|DECLARE_MUTEX
c_func
(paren
id|con_buf_sem
)paren
suffix:semicolon
DECL|function|do_con_write
r_static
r_int
id|do_con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
macro_line|#ifdef VT_BUF_VRAM_ONLY
DECL|macro|FLUSH
mdefine_line|#define FLUSH do { } while(0);
macro_line|#else
mdefine_line|#define FLUSH if (draw_x &gt;= 0) { &bslash;&n;&t;sw-&gt;con_putcs(vc_cons[currcons].d, (u16 *)draw_from, (u16 *)draw_to-(u16 *)draw_from, y, draw_x); &bslash;&n;&t;draw_x = -1; &bslash;&n;&t;}
macro_line|#endif
r_int
id|c
comma
id|tc
comma
id|ok
comma
id|n
op_assign
l_int|0
comma
id|draw_x
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|currcons
suffix:semicolon
r_int
r_int
id|draw_from
op_assign
l_int|0
comma
id|draw_to
op_assign
l_int|0
suffix:semicolon
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
id|u16
id|himask
comma
id|charmask
suffix:semicolon
r_const
r_int
r_char
op_star
id|orig_buf
op_assign
l_int|NULL
suffix:semicolon
r_int
id|orig_count
suffix:semicolon
id|currcons
op_assign
id|vt-&gt;vc_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
multiline_comment|/* could this happen? */
r_static
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|error
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;con_write: tty %d not allocated&bslash;n&quot;
comma
id|currcons
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|orig_buf
op_assign
id|buf
suffix:semicolon
id|orig_count
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|from_user
)paren
(brace
id|down
c_func
(paren
op_amp
id|con_buf_sem
)paren
suffix:semicolon
id|again
suffix:colon
r_if
c_cond
(paren
id|count
OG
id|CON_BUF_SIZE
)paren
id|count
op_assign
id|CON_BUF_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|con_buf
comma
id|buf
comma
id|count
)paren
)paren
(brace
id|n
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ?? are error codes legal here ?? */
r_goto
id|out
suffix:semicolon
)brace
id|buf
op_assign
id|con_buf
suffix:semicolon
)brace
multiline_comment|/* At this point &squot;buf&squot; is guarenteed to be a kernel buffer&n;&t; * and therefore no access to userspace (and therefore sleeping)&n;&t; * will be needed.  The con_buf_sem serializes all tty based&n;&t; * console rendering and vcs write/read operations.  We hold&n;&t; * the console spinlock during the entire write.&n;&t; */
id|spin_lock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
id|himask
op_assign
id|hi_font_mask
suffix:semicolon
id|charmask
op_assign
id|himask
ques
c_cond
l_int|0x1ff
suffix:colon
l_int|0xff
suffix:semicolon
multiline_comment|/* undraw cursor first */
r_if
c_cond
(paren
id|IS_FG
)paren
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|tty-&gt;stopped
op_logical_and
id|count
)paren
(brace
id|c
op_assign
op_star
id|buf
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|n
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|utf
)paren
(brace
multiline_comment|/* Combine UTF-8 into Unicode */
multiline_comment|/* Incomplete characters silently ignored */
r_if
c_cond
(paren
id|c
OG
l_int|0x7f
)paren
(brace
r_if
c_cond
(paren
id|utf_count
OG
l_int|0
op_logical_and
(paren
id|c
op_amp
l_int|0xc0
)paren
op_eq
l_int|0x80
)paren
(brace
id|utf_char
op_assign
(paren
id|utf_char
op_lshift
l_int|6
)paren
op_or
(paren
id|c
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|utf_count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|utf_count
op_eq
l_int|0
)paren
id|tc
op_assign
id|c
op_assign
id|utf_char
suffix:semicolon
r_else
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xe0
)paren
op_eq
l_int|0xc0
)paren
(brace
id|utf_count
op_assign
l_int|1
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xf0
)paren
op_eq
l_int|0xe0
)paren
(brace
id|utf_count
op_assign
l_int|2
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xf8
)paren
op_eq
l_int|0xf0
)paren
(brace
id|utf_count
op_assign
l_int|3
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x07
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xfc
)paren
op_eq
l_int|0xf8
)paren
(brace
id|utf_count
op_assign
l_int|4
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x03
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xfe
)paren
op_eq
l_int|0xfc
)paren
(brace
id|utf_count
op_assign
l_int|5
suffix:semicolon
id|utf_char
op_assign
(paren
id|c
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
r_else
id|utf_count
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
id|tc
op_assign
id|c
suffix:semicolon
id|utf_count
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* no utf */
id|tc
op_assign
id|translate
(braket
id|toggle_meta
ques
c_cond
(paren
id|c
op_or
l_int|0x80
)paren
suffix:colon
id|c
)braket
suffix:semicolon
)brace
multiline_comment|/* If the original code was a control character we&n;                 * only allow a glyph to be displayed if the code is&n;                 * not normally used (such as for cursor movement) or&n;                 * if the disp_ctrl mode has been explicitly enabled.&n;                 * Certain characters (as given by the CTRL_ALWAYS&n;                 * bitmap) are always displayed as control characters,&n;                 * as the console would be pretty useless without&n;                 * them; to display an arbitrary font position use the&n;                 * direct-to-font zone in UTF-8 mode.&n;                 */
id|ok
op_assign
id|tc
op_logical_and
(paren
id|c
op_ge
l_int|32
op_logical_or
(paren
op_logical_neg
id|utf
op_logical_and
op_logical_neg
(paren
(paren
(paren
id|disp_ctrl
ques
c_cond
id|CTRL_ALWAYS
suffix:colon
id|CTRL_ACTION
)paren
op_rshift
id|c
)paren
op_amp
l_int|1
)paren
)paren
)paren
op_logical_and
(paren
id|c
op_ne
l_int|127
op_logical_or
id|disp_ctrl
)paren
op_logical_and
(paren
id|c
op_ne
l_int|128
op_plus
l_int|27
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc_state
op_eq
id|ESnormal
op_logical_and
id|ok
)paren
(brace
multiline_comment|/* Now try to find out how to display it */
id|tc
op_assign
id|conv_uni_to_pc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|tc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc
op_eq
op_minus
l_int|4
)paren
(brace
multiline_comment|/* If we got -4 (not found) then see if we have&n;                                   defined a replacement character (U+FFFD) */
id|tc
op_assign
id|conv_uni_to_pc
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
l_int|0xfffd
)paren
suffix:semicolon
multiline_comment|/* One reason for the -4 can be that we just&n;&t;&t;&t;&t;   did a clear_unimap();&n;&t;&t;&t;&t;   try at least to show something. */
r_if
c_cond
(paren
id|tc
op_eq
op_minus
l_int|4
)paren
id|tc
op_assign
id|c
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tc
op_eq
op_minus
l_int|3
)paren
(brace
multiline_comment|/* Bad hash table -- hope for the best */
id|tc
op_assign
id|c
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tc
op_amp
op_complement
id|charmask
)paren
r_continue
suffix:semicolon
multiline_comment|/* Conversion failed */
r_if
c_cond
(paren
id|need_wrap
op_logical_or
id|decim
)paren
id|FLUSH
r_if
c_cond
(paren
id|need_wrap
)paren
(brace
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|decim
)paren
id|insert_char
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
id|scr_writew
c_func
(paren
id|himask
ques
c_cond
(paren
(paren
id|attr
op_lshift
l_int|8
)paren
op_amp
op_complement
id|himask
)paren
op_plus
(paren
(paren
id|tc
op_amp
l_int|0x100
)paren
ques
c_cond
id|himask
suffix:colon
l_int|0
)paren
op_plus
(paren
id|tc
op_amp
l_int|0xff
)paren
suffix:colon
(paren
id|attr
op_lshift
l_int|8
)paren
op_plus
id|tc
comma
(paren
id|u16
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DO_UPDATE
op_logical_and
id|draw_x
OL
l_int|0
)paren
(brace
id|draw_x
op_assign
id|x
suffix:semicolon
id|draw_from
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_eq
id|video_num_columns
op_minus
l_int|1
)paren
(brace
id|need_wrap
op_assign
id|decawm
suffix:semicolon
id|draw_to
op_assign
id|pos
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|draw_to
op_assign
(paren
id|pos
op_add_assign
l_int|2
)paren
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
id|FLUSH
id|do_con_trol
c_func
(paren
id|tty
comma
id|currcons
comma
id|c
)paren
suffix:semicolon
)brace
id|FLUSH
id|spin_unlock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|from_user
)paren
(brace
multiline_comment|/* If the user requested something larger than&n;&t;&t; * the CON_BUF_SIZE, and the tty is not stopped,&n;&t;&t; * keep going.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|orig_count
OG
id|CON_BUF_SIZE
)paren
op_logical_and
op_logical_neg
id|tty-&gt;stopped
)paren
(brace
id|orig_count
op_sub_assign
id|CON_BUF_SIZE
suffix:semicolon
id|orig_buf
op_add_assign
id|CON_BUF_SIZE
suffix:semicolon
id|count
op_assign
id|orig_count
suffix:semicolon
id|buf
op_assign
id|orig_buf
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|con_buf_sem
)paren
suffix:semicolon
)brace
r_return
id|n
suffix:semicolon
DECL|macro|FLUSH
macro_line|#undef FLUSH
)brace
multiline_comment|/*&n; * This is the console switching tasklet.&n; *&n; * Doing console switching in a tasklet allows&n; * us to do the switches asynchronously (needed when we want&n; * to switch due to a keyboard interrupt).  Synchronization&n; * with other console code and prevention of re-entrancy is&n; * ensured with console_lock.&n; */
DECL|function|console_softint
r_static
r_void
id|console_softint
c_func
(paren
r_int
r_int
id|ignored
)paren
(brace
multiline_comment|/* Runs the task queue outside of the console lock.  These&n;&t; * callbacks can come back into the console code and thus&n;&t; * will perform their own locking.&n;&t; */
id|run_task_queue
c_func
(paren
op_amp
id|con_task_queue
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|want_console
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|want_console
op_ne
id|fg_console
op_logical_and
id|vc_cons_allocated
c_func
(paren
id|want_console
)paren
)paren
(brace
id|hide_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|change_console
c_func
(paren
id|want_console
)paren
suffix:semicolon
multiline_comment|/* we only changed when the console had already&n;&t;&t;&t;   been allocated - a new console is not created&n;&t;&t;&t;   in an interrupt routine */
)brace
id|want_console
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_poke_blanked_console
)paren
(brace
multiline_comment|/* do not unblank for a LED change */
id|do_poke_blanked_console
op_assign
l_int|0
suffix:semicolon
id|poke_blanked_console
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scrollback_delta
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|clear_selection
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcmode
op_eq
id|KD_TEXT
)paren
id|sw
op_member_access_from_pointer
id|con_scrolldelta
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|scrollback_delta
)paren
suffix:semicolon
id|scrollback_delta
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_VT_CONSOLE
multiline_comment|/*&n; *&t;Console on virtual terminal&n; *&n; * The console_lock must be held when we get here.&n; */
DECL|function|vt_console_print
r_void
id|vt_console_print
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|b
comma
r_int
id|count
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_int
r_char
id|c
suffix:semicolon
r_static
r_int
r_int
id|printing
suffix:semicolon
r_const
id|ushort
op_star
id|start
suffix:semicolon
id|ushort
id|cnt
op_assign
l_int|0
suffix:semicolon
id|ushort
id|myx
suffix:semicolon
multiline_comment|/* console busy or not yet initialized */
r_if
c_cond
(paren
op_logical_neg
id|printable
op_logical_or
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|printing
)paren
)paren
r_return
suffix:semicolon
id|pm_access
c_func
(paren
id|pm_con
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kmsg_redirect
op_logical_and
id|vc_cons_allocated
c_func
(paren
id|kmsg_redirect
op_minus
l_int|1
)paren
)paren
id|currcons
op_assign
id|kmsg_redirect
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* read `x&squot; only after setting currecons properly (otherwise&n;&t;   the `x&squot; macro will read the x of the foreground console). */
id|myx
op_assign
id|x
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|currcons
)paren
)paren
(brace
multiline_comment|/* impossible */
multiline_comment|/* printk(&quot;vt_console_print: tty %d not allocated ??&bslash;n&quot;, currcons+1); */
r_goto
id|quit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcmode
op_ne
id|KD_TEXT
)paren
r_goto
id|quit
suffix:semicolon
multiline_comment|/* undraw cursor first */
r_if
c_cond
(paren
id|IS_FG
)paren
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|start
op_assign
(paren
id|ushort
op_star
)paren
id|pos
suffix:semicolon
multiline_comment|/* Contrived structure to try to emulate original need_wrap behaviour&n;&t; * Problems caused when we have need_wrap set on &squot;&bslash;n&squot; character */
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|b
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|13
op_logical_or
id|c
op_eq
l_int|8
op_logical_or
id|need_wrap
)paren
(brace
r_if
c_cond
(paren
id|cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|IS_VISIBLE
)paren
id|sw
op_member_access_from_pointer
id|con_putcs
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|start
comma
id|cnt
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|need_wrap
)paren
id|x
op_decrement
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_eq
l_int|8
)paren
(brace
multiline_comment|/* backspace */
id|bs
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|start
op_assign
(paren
id|ushort
op_star
)paren
id|pos
suffix:semicolon
id|myx
op_assign
id|x
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_ne
l_int|13
)paren
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|start
op_assign
(paren
id|ushort
op_star
)paren
id|pos
suffix:semicolon
id|myx
op_assign
id|x
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|13
)paren
r_continue
suffix:semicolon
)brace
id|scr_writew
c_func
(paren
(paren
id|attr
op_lshift
l_int|8
)paren
op_plus
id|c
comma
(paren
r_int
r_int
op_star
)paren
id|pos
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|myx
op_eq
id|video_num_columns
op_minus
l_int|1
)paren
(brace
id|need_wrap
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pos
op_add_assign
l_int|2
suffix:semicolon
id|myx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|IS_VISIBLE
)paren
id|sw
op_member_access_from_pointer
id|con_putcs
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|start
comma
id|cnt
comma
id|y
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
id|video_num_columns
)paren
(brace
id|x
op_decrement
suffix:semicolon
id|need_wrap
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|quit
suffix:colon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|printing
)paren
suffix:semicolon
)brace
DECL|function|vt_console_device
r_static
id|kdev_t
id|vt_console_device
c_func
(paren
r_struct
id|console
op_star
id|c
)paren
(brace
r_return
id|MKDEV
c_func
(paren
id|TTY_MAJOR
comma
id|c-&gt;index
ques
c_cond
id|c-&gt;index
suffix:colon
id|fg_console
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|vt_console_driver
r_struct
id|console
id|vt_console_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;tty&quot;
comma
id|write
suffix:colon
id|vt_console_print
comma
id|device
suffix:colon
id|vt_console_device
comma
id|wait_key
suffix:colon
id|keyboard_wait_for_keypress
comma
id|unblank
suffix:colon
id|unblank_screen
comma
id|flags
suffix:colon
id|CON_PRINTBUFFER
comma
id|index
suffix:colon
op_minus
l_int|1
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *&t;Handling of Linux-specific VC ioctls&n; */
DECL|function|tioclinux
r_int
id|tioclinux
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_int
id|arg
)paren
(brace
r_char
id|type
comma
id|data
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;driver.type
op_ne
id|TTY_DRIVER_TYPE_CONSOLE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;tty
op_ne
id|tty
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|type
comma
(paren
r_char
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|2
suffix:colon
r_return
id|set_selection
c_func
(paren
id|arg
comma
id|tty
comma
l_int|1
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
id|paste_selection
c_func
(paren
id|tty
)paren
suffix:semicolon
r_case
l_int|4
suffix:colon
id|unblank_screen
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|5
suffix:colon
r_return
id|sel_loadlut
c_func
(paren
id|arg
)paren
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/*&n;&t; * Make it possible to react to Shift+Mousebutton.&n;&t; * Note that &squot;shift_state&squot; is an undocumented&n;&t; * kernel-internal variable; programs not closely&n;&t; * related to the kernel should not use this.&n;&t; */
id|data
op_assign
id|shift_state
suffix:semicolon
r_return
id|__put_user
c_func
(paren
id|data
comma
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
l_int|7
suffix:colon
id|data
op_assign
id|mouse_reporting
c_func
(paren
)paren
suffix:semicolon
r_return
id|__put_user
c_func
(paren
id|data
comma
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
l_int|10
suffix:colon
id|set_vesa_blanking
c_func
(paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* set kmsg redirect */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
r_char
op_star
)paren
id|arg
op_plus
l_int|1
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|kmsg_redirect
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|12
suffix:colon
multiline_comment|/* get fg_console */
r_return
id|fg_console
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;/dev/ttyN handling&n; */
DECL|function|con_write
r_static
r_int
id|con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|retval
suffix:semicolon
id|pm_access
c_func
(paren
id|pm_con
)paren
suffix:semicolon
id|retval
op_assign
id|do_con_write
c_func
(paren
id|tty
comma
id|from_user
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|con_flush_chars
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|con_put_char
r_static
r_void
id|con_put_char
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_char
id|ch
)paren
(brace
id|pm_access
c_func
(paren
id|pm_con
)paren
suffix:semicolon
id|do_con_write
c_func
(paren
id|tty
comma
l_int|0
comma
op_amp
id|ch
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|con_write_room
r_static
r_int
id|con_write_room
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;stopped
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|4096
suffix:semicolon
multiline_comment|/* No limit, really; we&squot;re not buffering */
)brace
DECL|function|con_chars_in_buffer
r_static
r_int
id|con_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* we&squot;re not buffering */
)brace
multiline_comment|/*&n; * con_throttle and con_unthrottle are only used for&n; * paste_selection(), which has to stuff in a large number of&n; * characters...&n; */
DECL|function|con_throttle
r_static
r_void
id|con_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
)brace
DECL|function|con_unthrottle
r_static
r_void
id|con_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|vt-&gt;paste_wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Turn the Scroll-Lock LED on when the tty is stopped&n; */
DECL|function|con_stop
r_static
r_void
id|con_stop
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|console_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
id|console_num
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
(paren
id|tty-&gt;driver.minor_start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|console_num
)paren
)paren
r_return
suffix:semicolon
id|set_vc_kbd_led
c_func
(paren
id|kbd_table
op_plus
id|console_num
comma
id|VC_SCROLLOCK
)paren
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Turn the Scroll-Lock LED off when the console is started&n; */
DECL|function|con_start
r_static
r_void
id|con_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|console_num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
id|console_num
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
(paren
id|tty-&gt;driver.minor_start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|console_num
)paren
)paren
r_return
suffix:semicolon
id|clr_vc_kbd_led
c_func
(paren
id|kbd_table
op_plus
id|console_num
comma
id|VC_SCROLLOCK
)paren
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|con_flush_chars
r_static
r_void
id|con_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|vt_struct
op_star
id|vt
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
id|pm_access
c_func
(paren
id|pm_con
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|console_lock
comma
id|flags
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|vt-&gt;vc_num
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|console_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate the console screen memory.&n; */
DECL|function|con_open
r_static
r_int
id|con_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_int
r_int
id|currcons
suffix:semicolon
r_int
id|i
suffix:semicolon
id|currcons
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
id|tty-&gt;driver.minor_start
suffix:semicolon
id|i
op_assign
id|vc_allocate
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|vt_cons
(braket
id|currcons
)braket
op_member_access_from_pointer
id|vc_num
op_assign
id|currcons
suffix:semicolon
id|tty-&gt;driver_data
op_assign
id|vt_cons
(braket
id|currcons
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty-&gt;winsize.ws_row
op_logical_and
op_logical_neg
id|tty-&gt;winsize.ws_col
)paren
(brace
id|tty-&gt;winsize.ws_row
op_assign
id|video_num_lines
suffix:semicolon
id|tty-&gt;winsize.ws_col
op_assign
id|video_num_columns
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty-&gt;count
op_eq
l_int|1
)paren
id|vcs_make_devfs
(paren
id|currcons
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|con_close
r_static
r_void
id|con_close
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;count
op_ne
l_int|1
)paren
r_return
suffix:semicolon
id|vcs_make_devfs
(paren
id|MINOR
(paren
id|tty-&gt;device
)paren
op_minus
id|tty-&gt;driver.minor_start
comma
l_int|1
)paren
suffix:semicolon
id|tty-&gt;driver_data
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|vc_init
r_static
r_void
id|vc_init
c_func
(paren
r_int
r_int
id|currcons
comma
r_int
r_int
id|rows
comma
r_int
r_int
id|cols
comma
r_int
id|do_clear
)paren
(brace
r_int
id|j
comma
id|k
suffix:semicolon
id|video_num_columns
op_assign
id|cols
suffix:semicolon
id|video_num_lines
op_assign
id|rows
suffix:semicolon
id|video_size_row
op_assign
id|cols
op_lshift
l_int|1
suffix:semicolon
id|screenbuf_size
op_assign
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|pos
op_assign
id|origin
suffix:semicolon
id|reset_vc
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
id|def_color
op_assign
l_int|0x07
suffix:semicolon
multiline_comment|/* white */
id|ulcolor
op_assign
l_int|0x0f
suffix:semicolon
multiline_comment|/* bold white */
id|halfcolor
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* grey */
id|init_waitqueue_head
c_func
(paren
op_amp
id|vt_cons
(braket
id|currcons
)braket
op_member_access_from_pointer
id|paste_wait
)paren
suffix:semicolon
id|reset_terminal
c_func
(paren
id|currcons
comma
id|do_clear
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine initializes console interrupts, and does nothing&n; * else. If you want the screen to clear, call tty_write with&n; * the appropriate escape-sequence.&n; */
DECL|variable|console_driver
r_struct
id|tty_driver
id|console_driver
suffix:semicolon
DECL|variable|console_refcount
r_static
r_int
id|console_refcount
suffix:semicolon
id|DECLARE_TASKLET_DISABLED
c_func
(paren
id|console_tasklet
comma
id|console_softint
comma
l_int|0
)paren
suffix:semicolon
DECL|function|con_init
r_void
id|__init
id|con_init
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|display_desc
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|currcons
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|conswitchp
)paren
id|display_desc
op_assign
id|conswitchp
op_member_access_from_pointer
id|con_startup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|display_desc
)paren
(brace
id|fg_console
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|console_driver
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tty_driver
)paren
)paren
suffix:semicolon
id|console_driver.magic
op_assign
id|TTY_DRIVER_MAGIC
suffix:semicolon
id|console_driver.name
op_assign
l_string|&quot;vc/%d&quot;
suffix:semicolon
id|console_driver.name_base
op_assign
l_int|1
suffix:semicolon
id|console_driver.major
op_assign
id|TTY_MAJOR
suffix:semicolon
id|console_driver.minor_start
op_assign
l_int|1
suffix:semicolon
id|console_driver.num
op_assign
id|MAX_NR_CONSOLES
suffix:semicolon
id|console_driver.type
op_assign
id|TTY_DRIVER_TYPE_CONSOLE
suffix:semicolon
id|console_driver.init_termios
op_assign
id|tty_std_termios
suffix:semicolon
id|console_driver.flags
op_assign
id|TTY_DRIVER_REAL_RAW
op_or
id|TTY_DRIVER_RESET_TERMIOS
suffix:semicolon
multiline_comment|/* Tell tty_register_driver() to skip consoles because they are&n;&t; * registered before kmalloc() is ready. We&squot;ll patch them in later. &n;&t; * See comments at console_init(); see also con_init_devfs(). &n;&t; */
id|console_driver.flags
op_or_assign
id|TTY_DRIVER_NO_DEVFS
suffix:semicolon
id|console_driver.refcount
op_assign
op_amp
id|console_refcount
suffix:semicolon
id|console_driver.table
op_assign
id|console_table
suffix:semicolon
id|console_driver.termios
op_assign
id|console_termios
suffix:semicolon
id|console_driver.termios_locked
op_assign
id|console_termios_locked
suffix:semicolon
id|console_driver.open
op_assign
id|con_open
suffix:semicolon
id|console_driver.close
op_assign
id|con_close
suffix:semicolon
id|console_driver.write
op_assign
id|con_write
suffix:semicolon
id|console_driver.write_room
op_assign
id|con_write_room
suffix:semicolon
id|console_driver.put_char
op_assign
id|con_put_char
suffix:semicolon
id|console_driver.flush_chars
op_assign
id|con_flush_chars
suffix:semicolon
id|console_driver.chars_in_buffer
op_assign
id|con_chars_in_buffer
suffix:semicolon
id|console_driver.ioctl
op_assign
id|vt_ioctl
suffix:semicolon
id|console_driver.stop
op_assign
id|con_stop
suffix:semicolon
id|console_driver.start
op_assign
id|con_start
suffix:semicolon
id|console_driver.throttle
op_assign
id|con_throttle
suffix:semicolon
id|console_driver.unthrottle
op_assign
id|con_unthrottle
suffix:semicolon
r_if
c_cond
(paren
id|tty_register_driver
c_func
(paren
op_amp
id|console_driver
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;Couldn&squot;t register console driver&bslash;n&quot;
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|console_timer
)paren
suffix:semicolon
id|console_timer.function
op_assign
id|blank_screen
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|console_timer
comma
id|jiffies
op_plus
id|blankinterval
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * kmalloc is not running yet - we use the bootmem allocator.&n;&t; */
r_for
c_loop
(paren
id|currcons
op_assign
l_int|0
suffix:semicolon
id|currcons
OL
id|MIN_NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
(brace
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
op_assign
(paren
r_struct
id|vc_data
op_star
)paren
id|alloc_bootmem
c_func
(paren
r_sizeof
(paren
r_struct
id|vc_data
)paren
)paren
suffix:semicolon
id|vt_cons
(braket
id|currcons
)braket
op_assign
(paren
r_struct
id|vt_struct
op_star
)paren
id|alloc_bootmem
c_func
(paren
r_sizeof
(paren
r_struct
id|vt_struct
)paren
)paren
suffix:semicolon
id|visual_init
c_func
(paren
id|currcons
comma
l_int|1
)paren
suffix:semicolon
id|screenbuf
op_assign
(paren
r_int
r_int
op_star
)paren
id|alloc_bootmem
c_func
(paren
id|screenbuf_size
)paren
suffix:semicolon
id|kmalloced
op_assign
l_int|0
suffix:semicolon
id|vc_init
c_func
(paren
id|currcons
comma
id|video_num_lines
comma
id|video_num_columns
comma
id|currcons
op_logical_or
op_logical_neg
id|sw-&gt;con_save_screen
)paren
suffix:semicolon
)brace
id|currcons
op_assign
id|fg_console
op_assign
l_int|0
suffix:semicolon
id|master_display_fg
op_assign
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|save_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
)paren
suffix:semicolon
id|csi_J
c_func
(paren
id|currcons
comma
l_int|0
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Console: %s %s %dx%d&quot;
comma
id|can_do_color
ques
c_cond
l_string|&quot;colour&quot;
suffix:colon
l_string|&quot;mono&quot;
comma
id|display_desc
comma
id|video_num_columns
comma
id|video_num_lines
)paren
suffix:semicolon
id|printable
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_VT_CONSOLE
id|register_console
c_func
(paren
op_amp
id|vt_console_driver
)paren
suffix:semicolon
macro_line|#endif
id|tasklet_enable
c_func
(paren
op_amp
id|console_tasklet
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|console_tasklet
)paren
suffix:semicolon
)brace
macro_line|#ifndef VT_SINGLE_DRIVER
DECL|function|clear_buffer_attributes
r_static
r_void
id|clear_buffer_attributes
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
r_int
id|count
op_assign
id|screenbuf_size
op_div
l_int|2
suffix:semicolon
r_int
id|mask
op_assign
id|hi_font_mask
op_or
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|p
op_increment
)paren
(brace
id|scr_writew
c_func
(paren
(paren
id|scr_readw
c_func
(paren
id|p
)paren
op_amp
id|mask
)paren
op_or
(paren
id|video_erase_char
op_amp
op_complement
id|mask
)paren
comma
id|p
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;If we support more console drivers, this function is used&n; *&t;when a driver wants to take over some existing consoles&n; *&t;and become default driver for newly opened ones.&n; */
DECL|function|take_over_console
r_void
id|take_over_console
c_func
(paren
r_const
r_struct
id|consw
op_star
id|csw
comma
r_int
id|first
comma
r_int
id|last
comma
r_int
id|deflt
)paren
(brace
r_int
id|i
comma
id|j
op_assign
op_minus
l_int|1
suffix:semicolon
r_const
r_char
op_star
id|desc
suffix:semicolon
id|desc
op_assign
id|csw
op_member_access_from_pointer
id|con_startup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|desc
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|deflt
)paren
id|conswitchp
op_assign
id|csw
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|first
suffix:semicolon
id|i
op_le
id|last
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|old_was_color
suffix:semicolon
r_int
id|currcons
op_assign
id|i
suffix:semicolon
id|con_driver_map
(braket
id|i
)braket
op_assign
id|csw
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons
(braket
id|i
)braket
dot
id|d
op_logical_or
op_logical_neg
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_sw
)paren
r_continue
suffix:semicolon
id|j
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|IS_VISIBLE
)paren
id|save_screen
c_func
(paren
id|i
)paren
suffix:semicolon
id|old_was_color
op_assign
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_can_do_color
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_sw
op_member_access_from_pointer
id|con_deinit
c_func
(paren
id|vc_cons
(braket
id|i
)braket
dot
id|d
)paren
suffix:semicolon
id|visual_init
c_func
(paren
id|i
comma
l_int|0
)paren
suffix:semicolon
id|update_attr
c_func
(paren
id|i
)paren
suffix:semicolon
multiline_comment|/* If the console changed between mono &lt;-&gt; color, then&n;&t;&t; * the attributes in the screenbuf will be wrong.  The&n;&t;&t; * following resets all attributes to something sane.&n;&t;&t; */
r_if
c_cond
(paren
id|old_was_color
op_ne
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_can_do_color
)paren
id|clear_buffer_attributes
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_VISIBLE
)paren
id|update_screen
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Console: switching &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|deflt
)paren
id|printk
c_func
(paren
l_string|&quot;consoles %d-%d &quot;
comma
id|first
op_plus
l_int|1
comma
id|last
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;to %s %s %dx%d&bslash;n&quot;
comma
id|vc_cons
(braket
id|j
)braket
dot
id|d-&gt;vc_can_do_color
ques
c_cond
l_string|&quot;colour&quot;
suffix:colon
l_string|&quot;mono&quot;
comma
id|desc
comma
id|vc_cons
(braket
id|j
)braket
dot
id|d-&gt;vc_cols
comma
id|vc_cons
(braket
id|j
)braket
dot
id|d-&gt;vc_rows
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;to %s&bslash;n&quot;
comma
id|desc
)paren
suffix:semicolon
)brace
DECL|function|give_up_console
r_void
id|give_up_console
c_func
(paren
r_const
r_struct
id|consw
op_star
id|csw
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|con_driver_map
(braket
id|i
)braket
op_eq
id|csw
)paren
id|con_driver_map
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Screen blanking&n; */
DECL|function|set_vesa_blanking
r_static
r_void
id|set_vesa_blanking
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_char
op_star
id|argp
op_assign
(paren
r_char
op_star
)paren
id|arg
op_plus
l_int|1
suffix:semicolon
r_int
r_int
id|mode
suffix:semicolon
id|get_user
c_func
(paren
id|mode
comma
id|argp
)paren
suffix:semicolon
id|vesa_blank_mode
op_assign
(paren
id|mode
OL
l_int|4
)paren
ques
c_cond
id|mode
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/* We can&squot;t register the console with devfs during con_init(), because it&n; * is called before kmalloc() works.  This function is called later to&n; * do the registration.&n; */
DECL|function|con_init_devfs
r_void
id|__init
id|con_init_devfs
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|console_driver.num
suffix:semicolon
id|i
op_increment
)paren
id|tty_register_devfs
(paren
op_amp
id|console_driver
comma
id|DEVFS_FL_AOPEN_NOTIFY
comma
id|console_driver.minor_start
op_plus
id|i
)paren
suffix:semicolon
)brace
DECL|function|vesa_powerdown
r_static
r_void
id|vesa_powerdown
c_func
(paren
r_void
)paren
(brace
r_struct
id|vc_data
op_star
id|c
op_assign
id|vc_cons
(braket
id|fg_console
)braket
dot
id|d
suffix:semicolon
multiline_comment|/*&n;     *  Power down if currently suspended (1 or 2),&n;     *  suspend if currently blanked (0),&n;     *  else do nothing (i.e. already powered down (3)).&n;     *  Called only if powerdown features are allowed.&n;     */
r_switch
c_cond
(paren
id|vesa_blank_mode
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
id|c-&gt;vc_sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|c
comma
id|VESA_VSYNC_SUSPEND
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|c-&gt;vc_sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|c
comma
id|VESA_POWERDOWN
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|vesa_powerdown_screen
r_static
r_void
id|vesa_powerdown_screen
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
id|console_timer.function
op_assign
id|unblank_screen_t
suffix:semicolon
multiline_comment|/* I don&squot;t have a clue why this is necessary */
id|vesa_powerdown
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|timer_do_blank_screen
r_static
r_void
id|timer_do_blank_screen
c_func
(paren
r_int
id|entering_gfx
comma
r_int
id|from_timer_handler
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
r_return
suffix:semicolon
multiline_comment|/* entering graphics mode? */
r_if
c_cond
(paren
id|entering_gfx
)paren
(brace
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|save_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|console_blanked
op_assign
id|fg_console
op_plus
l_int|1
suffix:semicolon
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* don&squot;t blank graphics */
r_if
c_cond
(paren
id|vcmode
op_ne
id|KD_TEXT
)paren
(brace
id|console_blanked
op_assign
id|fg_console
op_plus
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hide_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|from_timer_handler
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|console_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vesa_off_interval
)paren
(brace
id|console_timer.function
op_assign
id|vesa_powerdown_screen
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|console_timer
comma
id|jiffies
op_plus
id|vesa_off_interval
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|from_timer_handler
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|console_timer
)paren
suffix:semicolon
id|console_timer.function
op_assign
id|unblank_screen_t
suffix:semicolon
)brace
id|save_screen
c_func
(paren
id|currcons
)paren
suffix:semicolon
multiline_comment|/* In case we need to reset origin, blanking hook returns 1 */
id|i
op_assign
id|sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
l_int|1
)paren
suffix:semicolon
id|console_blanked
op_assign
id|fg_console
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|console_blank_hook
op_logical_and
id|console_blank_hook
c_func
(paren
l_int|1
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vesa_blank_mode
)paren
id|sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|vesa_blank_mode
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|do_blank_screen
r_void
id|do_blank_screen
c_func
(paren
r_int
id|entering_gfx
)paren
(brace
id|timer_do_blank_screen
c_func
(paren
id|entering_gfx
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|unblank_screen_t
r_static
r_void
id|unblank_screen_t
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
id|unblank_screen
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|unblank_screen
r_void
id|unblank_screen
c_func
(paren
r_void
)paren
(brace
r_int
id|currcons
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|fg_console
)paren
)paren
(brace
multiline_comment|/* impossible */
id|printk
c_func
(paren
l_string|&quot;unblank_screen: tty %d not allocated ??&bslash;n&quot;
comma
id|fg_console
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|console_timer.function
op_assign
id|blank_screen
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|console_timer
comma
id|jiffies
op_plus
id|blankinterval
)paren
suffix:semicolon
)brace
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|console_blanked
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|console_blank_hook
)paren
id|console_blank_hook
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|set_palette
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sw
op_member_access_from_pointer
id|con_blank
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
l_int|0
)paren
)paren
multiline_comment|/* Low-level driver cannot restore -&gt; do it ourselves */
id|update_screen
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
)brace
DECL|function|blank_screen
r_static
r_void
id|blank_screen
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
id|timer_do_blank_screen
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|poke_blanked_console
r_void
id|poke_blanked_console
c_func
(paren
r_void
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|console_timer
)paren
suffix:semicolon
multiline_comment|/* Can&squot;t use _sync here: called from tasklet */
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
id|console_timer.function
op_assign
id|unblank_screen_t
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|console_timer
comma
id|jiffies
)paren
suffix:semicolon
multiline_comment|/* Now */
)brace
r_else
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|console_timer
comma
id|jiffies
op_plus
id|blankinterval
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Palettes&n; */
DECL|function|set_palette
r_void
id|set_palette
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|vcmode
op_ne
id|KD_GRAPHICS
)paren
id|sw
op_member_access_from_pointer
id|con_set_palette
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|color_table
)paren
suffix:semicolon
)brace
DECL|function|set_get_cmap
r_static
r_int
id|set_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|set
)paren
(brace
id|get_user
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
id|get_user
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
id|get_user
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
)brace
r_else
(brace
id|put_user
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
id|arg
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|vc_cons_allocated
c_func
(paren
id|i
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
id|set_palette
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Load palette into the DAC registers. arg points to a colour&n; * map, 3 bytes per colour, 16 colours, range from 0 to 255.&n; */
DECL|function|con_set_cmap
r_int
id|con_set_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
)paren
(brace
r_return
id|set_get_cmap
(paren
id|arg
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|con_get_cmap
r_int
id|con_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
)paren
(brace
r_return
id|set_get_cmap
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|reset_palette
r_void
id|reset_palette
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|j
comma
id|k
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|palette
(braket
id|k
op_increment
)braket
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|palette
(braket
id|k
op_increment
)braket
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|palette
(braket
id|k
op_increment
)braket
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
id|set_palette
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Font switching&n; *&n; *  Currently we only support fonts up to 32 pixels wide, at a maximum height&n; *  of 32 pixels. Userspace fontdata is stored with 32 bytes (shorts/ints, &n; *  depending on width) reserved for each character which is kinda wasty, but &n; *  this is done in order to maintain compatibility with the EGA/VGA fonts. It &n; *  is upto the actual low-level console-driver convert data into its favorite&n; *  format (maybe we should add a `fontoffset&squot; field to the `display&squot;&n; *  structure so we wont have to convert the fontdata all the time.&n; *  /Jes&n; */
DECL|macro|max_font_size
mdefine_line|#define max_font_size 65536
DECL|function|con_font_op
r_int
id|con_font_op
c_func
(paren
r_int
id|currcons
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|size
op_assign
id|max_font_size
comma
id|set
suffix:semicolon
id|u8
op_star
id|temp
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|console_font_op
id|old_op
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|currcons
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_goto
id|quit
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|old_op
comma
id|op
comma
r_sizeof
(paren
id|old_op
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;op
op_eq
id|KD_FONT_OP_SET
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;charcount
OG
l_int|512
)paren
r_goto
id|quit
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;height
)paren
(brace
multiline_comment|/* Need to guess font height [compat] */
r_int
id|h
comma
id|i
suffix:semicolon
id|u8
op_star
id|charmap
op_assign
id|op-&gt;data
comma
id|tmp
suffix:semicolon
multiline_comment|/* If from KDFONTOP ioctl, don&squot;t allow things which can be done in userland,&n;&t;&t;&t;   so that we can get rid of this soon */
r_if
c_cond
(paren
op_logical_neg
(paren
id|op-&gt;flags
op_amp
id|KD_FONT_FLAG_OLD
)paren
)paren
r_goto
id|quit
suffix:semicolon
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|32
suffix:semicolon
id|h
OG
l_int|0
suffix:semicolon
id|h
op_decrement
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|op-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|tmp
comma
op_amp
id|charmap
(braket
l_int|32
op_star
id|i
op_plus
id|h
op_minus
l_int|1
)braket
)paren
)paren
r_goto
id|quit
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
r_goto
id|nonzero
suffix:semicolon
)brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|quit
suffix:semicolon
id|nonzero
suffix:colon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|op-&gt;height
op_assign
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op-&gt;width
OG
l_int|32
op_logical_or
id|op-&gt;height
OG
l_int|32
)paren
r_goto
id|quit
suffix:semicolon
id|size
op_assign
(paren
id|op-&gt;width
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
l_int|32
op_star
id|op-&gt;charcount
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|max_font_size
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
id|set
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;op
op_eq
id|KD_FONT_OP_GET
)paren
id|set
op_assign
l_int|0
suffix:semicolon
r_else
r_return
id|sw
op_member_access_from_pointer
id|con_font_op
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;data
)paren
(brace
id|temp
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|set
op_logical_and
id|copy_from_user
c_func
(paren
id|temp
comma
id|op-&gt;data
comma
id|size
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|quit
suffix:semicolon
)brace
id|op-&gt;data
op_assign
id|temp
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
id|rc
op_assign
id|sw
op_member_access_from_pointer
id|con_font_op
c_func
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
comma
id|op
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|console_lock
)paren
suffix:semicolon
id|op-&gt;data
op_assign
id|old_op.data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
op_logical_and
op_logical_neg
id|set
)paren
(brace
r_int
id|c
op_assign
(paren
id|op-&gt;width
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
l_int|32
op_star
id|op-&gt;charcount
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;data
op_logical_and
id|op-&gt;charcount
OG
id|old_op.charcount
)paren
id|rc
op_assign
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|op-&gt;flags
op_amp
id|KD_FONT_FLAG_OLD
)paren
)paren
(brace
r_if
c_cond
(paren
id|op-&gt;width
OG
id|old_op.width
op_logical_or
id|op-&gt;height
OG
id|old_op.height
)paren
id|rc
op_assign
op_minus
id|ENOSPC
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|op-&gt;width
op_ne
l_int|8
)paren
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|old_op.height
op_logical_and
id|op-&gt;height
OG
id|old_op.height
)paren
op_logical_or
id|op-&gt;height
OG
l_int|32
)paren
id|rc
op_assign
op_minus
id|ENOSPC
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rc
op_logical_and
id|op-&gt;data
op_logical_and
id|copy_to_user
c_func
(paren
id|op-&gt;data
comma
id|temp
comma
id|c
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
id|quit
suffix:colon
r_if
c_cond
(paren
id|temp
)paren
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Interface exported to selection and vcs.&n; */
multiline_comment|/* used by selection */
DECL|function|screen_glyph
id|u16
id|screen_glyph
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
id|u16
id|w
op_assign
id|scr_readw
c_func
(paren
id|screenpos
c_func
(paren
id|currcons
comma
id|offset
comma
l_int|1
)paren
)paren
suffix:semicolon
id|u16
id|c
op_assign
id|w
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|w
op_amp
id|hi_font_mask
)paren
id|c
op_or_assign
l_int|0x100
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
multiline_comment|/* used by vcs - note the word offset */
DECL|function|screen_pos
r_int
r_int
op_star
id|screen_pos
c_func
(paren
r_int
id|currcons
comma
r_int
id|w_offset
comma
r_int
id|viewed
)paren
(brace
r_return
id|screenpos
c_func
(paren
id|currcons
comma
l_int|2
op_star
id|w_offset
comma
id|viewed
)paren
suffix:semicolon
)brace
DECL|function|getconsxy
r_void
id|getconsxy
c_func
(paren
r_int
id|currcons
comma
r_char
op_star
id|p
)paren
(brace
id|p
(braket
l_int|0
)braket
op_assign
id|x
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|y
suffix:semicolon
)brace
DECL|function|putconsxy
r_void
id|putconsxy
c_func
(paren
r_int
id|currcons
comma
r_char
op_star
id|p
)paren
(brace
id|gotoxy
c_func
(paren
id|currcons
comma
id|p
(braket
l_int|0
)braket
comma
id|p
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|vcs_scr_readw
id|u16
id|vcs_scr_readw
c_func
(paren
r_int
id|currcons
comma
r_const
id|u16
op_star
id|org
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|org
op_eq
id|pos
op_logical_and
id|softcursor_original
op_ne
op_minus
l_int|1
)paren
r_return
id|softcursor_original
suffix:semicolon
r_return
id|scr_readw
c_func
(paren
id|org
)paren
suffix:semicolon
)brace
DECL|function|vcs_scr_writew
r_void
id|vcs_scr_writew
c_func
(paren
r_int
id|currcons
comma
id|u16
id|val
comma
id|u16
op_star
id|org
)paren
(brace
id|scr_writew
c_func
(paren
id|val
comma
id|org
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|org
op_eq
id|pos
)paren
(brace
id|softcursor_original
op_assign
op_minus
l_int|1
suffix:semicolon
id|add_softcursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
)brace
DECL|function|pm_con_request
r_static
r_int
id|pm_con_request
c_func
(paren
r_struct
id|pm_dev
op_star
id|dev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
(brace
r_switch
c_cond
(paren
id|rqst
)paren
(brace
r_case
id|PM_RESUME
suffix:colon
id|unblank_screen
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM_SUSPEND
suffix:colon
id|do_blank_screen
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Visible symbols for modules&n; */
DECL|variable|color_table
id|EXPORT_SYMBOL
c_func
(paren
id|color_table
)paren
suffix:semicolon
DECL|variable|default_red
id|EXPORT_SYMBOL
c_func
(paren
id|default_red
)paren
suffix:semicolon
DECL|variable|default_grn
id|EXPORT_SYMBOL
c_func
(paren
id|default_grn
)paren
suffix:semicolon
DECL|variable|default_blu
id|EXPORT_SYMBOL
c_func
(paren
id|default_blu
)paren
suffix:semicolon
DECL|variable|video_font_height
id|EXPORT_SYMBOL
c_func
(paren
id|video_font_height
)paren
suffix:semicolon
DECL|variable|video_scan_lines
id|EXPORT_SYMBOL
c_func
(paren
id|video_scan_lines
)paren
suffix:semicolon
DECL|variable|vc_resize
id|EXPORT_SYMBOL
c_func
(paren
id|vc_resize
)paren
suffix:semicolon
DECL|variable|fg_console
id|EXPORT_SYMBOL
c_func
(paren
id|fg_console
)paren
suffix:semicolon
DECL|variable|console_blank_hook
id|EXPORT_SYMBOL
c_func
(paren
id|console_blank_hook
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_VT
DECL|variable|vt_cons
id|EXPORT_SYMBOL
c_func
(paren
id|vt_cons
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef VT_SINGLE_DRIVER
DECL|variable|take_over_console
id|EXPORT_SYMBOL
c_func
(paren
id|take_over_console
)paren
suffix:semicolon
DECL|variable|give_up_console
id|EXPORT_SYMBOL
c_func
(paren
id|give_up_console
)paren
suffix:semicolon
macro_line|#endif
eof
