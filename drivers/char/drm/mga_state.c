multiline_comment|/* mga_state.c -- State support for mga g200/g400 -*- linux-c -*-&n; * Created: Thu Jan 27 02:53:43 2000 by jhartmann@precisioninsight.com&n; *&n; * Copyright 1999 Precision Insight, Inc., Cedar Park, Texas.&n; * Copyright 2000 VA Linux Systems, Inc., Sunnyvale, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors: Jeff Hartmann &lt;jhartmann@valinux.com&gt;&n; * &t;    Keith Whitwell &lt;keithw@valinux.com&gt;&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;mga_drv.h&quot;
macro_line|#include &quot;drm.h&quot;
multiline_comment|/* If you change the functions to set state, PLEASE&n; * change these values&n; */
DECL|macro|MGAEMITCLIP_SIZE
mdefine_line|#define MGAEMITCLIP_SIZE&t;10
DECL|macro|MGAEMITCTX_SIZE
mdefine_line|#define MGAEMITCTX_SIZE&t;&t;20
DECL|macro|MGAG200EMITTEX_SIZE
mdefine_line|#define MGAG200EMITTEX_SIZE &t;20
DECL|macro|MGAG400EMITTEX0_SIZE
mdefine_line|#define MGAG400EMITTEX0_SIZE&t;30
DECL|macro|MGAG400EMITTEX1_SIZE
mdefine_line|#define MGAG400EMITTEX1_SIZE&t;25
DECL|macro|MGAG400EMITPIPE_SIZE
mdefine_line|#define MGAG400EMITPIPE_SIZE&t;50
DECL|macro|MGAG200EMITPIPE_SIZE
mdefine_line|#define MGAG200EMITPIPE_SIZE&t;15
DECL|macro|MAX_STATE_SIZE
mdefine_line|#define MAX_STATE_SIZE ((MGAEMITCLIP_SIZE * MGA_NR_SAREA_CLIPRECTS) + &bslash;&n;&t;&t;&t;MGAEMITCTX_SIZE + MGAG400EMITTEX0_SIZE + &bslash;&n;&t;&t;&t;MGAG400EMITTEX1_SIZE + MGAG400EMITPIPE_SIZE)
DECL|function|mgaEmitClipRect
r_static
r_void
id|mgaEmitClipRect
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
id|drm_clip_rect_t
op_star
id|box
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;ContextState
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
multiline_comment|/* This takes 10 dwords */
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* Force reset of dwgctl on G400 (eliminates clip disable bit) */
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
macro_line|#if 0
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
macro_line|#else
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_LEN
op_plus
id|MGAREG_MGA_EXEC
comma
l_int|0x80000000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_LEN
op_plus
id|MGAREG_MGA_EXEC
comma
l_int|0x80000000
)paren
suffix:semicolon
macro_line|#endif
)brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_CXBNDRY
comma
(paren
(paren
id|box-&gt;x2
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|box-&gt;x1
)paren
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YTOP
comma
id|box-&gt;y1
op_star
id|dev_priv-&gt;stride
op_div
id|dev_priv-&gt;cpp
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YBOT
comma
id|box-&gt;y2
op_star
id|dev_priv-&gt;stride
op_div
id|dev_priv-&gt;cpp
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mgaEmitContext
r_static
r_void
id|mgaEmitContext
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;ContextState
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
multiline_comment|/* This takes a max of 20 dwords */
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|regs
(braket
id|MGA_CTXREG_DSTORG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_MACCESS
comma
id|regs
(braket
id|MGA_CTXREG_MACCESS
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PLNWT
comma
id|regs
(braket
id|MGA_CTXREG_PLNWT
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_ALPHACTRL
comma
id|regs
(braket
id|MGA_CTXREG_ALPHACTRL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FOGCOL
comma
id|regs
(braket
id|MGA_CTXREG_FOGCOLOR
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WFLAG
comma
id|regs
(braket
id|MGA_CTXREG_WFLAG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_ZORG
comma
id|dev_priv-&gt;depthOffset
)paren
suffix:semicolon
multiline_comment|/* invarient */
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WFLAG1
comma
id|regs
(braket
id|MGA_CTXREG_WFLAG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TDUALSTAGE0
comma
id|regs
(braket
id|MGA_CTXREG_TDUAL0
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TDUALSTAGE1
comma
id|regs
(braket
id|MGA_CTXREG_TDUAL1
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FCOL
comma
id|regs
(braket
id|MGA_CTXREG_FCOL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_STENCIL
comma
id|regs
(braket
id|MGA_CTXREG_STENCIL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_STENCILCTL
comma
id|regs
(braket
id|MGA_CTXREG_STENCILCTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FCOL
comma
id|regs
(braket
id|MGA_CTXREG_FCOL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
)brace
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mgaG200EmitTex
r_static
r_void
id|mgaG200EmitTex
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;TexState
(braket
l_int|0
)braket
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* This takes 20 dwords */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
id|regs
(braket
id|MGA_TEXREG_CTL2
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL
comma
id|regs
(braket
id|MGA_TEXREG_CTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXFILTER
comma
id|regs
(braket
id|MGA_TEXREG_FILTER
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXBORDERCOL
comma
id|regs
(braket
id|MGA_TEXREG_BORDERCOL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG
comma
id|regs
(braket
id|MGA_TEXREG_ORG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG1
comma
id|regs
(braket
id|MGA_TEXREG_ORG1
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG2
comma
id|regs
(braket
id|MGA_TEXREG_ORG2
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG3
comma
id|regs
(braket
id|MGA_TEXREG_ORG3
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG4
comma
id|regs
(braket
id|MGA_TEXREG_ORG4
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXWIDTH
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXHEIGHT
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR24
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR34
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANS
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANSHIGH
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|macro|TMC_dualtex_enable
mdefine_line|#define TMC_dualtex_enable &t;&t;0x80
DECL|function|mgaG400EmitTex0
r_static
r_void
id|mgaG400EmitTex0
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;TexState
(braket
l_int|0
)braket
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* This takes 30 dwords */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
id|regs
(braket
id|MGA_TEXREG_CTL2
)braket
op_or
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL
comma
id|regs
(braket
id|MGA_TEXREG_CTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXFILTER
comma
id|regs
(braket
id|MGA_TEXREG_FILTER
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXBORDERCOL
comma
id|regs
(braket
id|MGA_TEXREG_BORDERCOL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG
comma
id|regs
(braket
id|MGA_TEXREG_ORG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG1
comma
id|regs
(braket
id|MGA_TEXREG_ORG1
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG2
comma
id|regs
(braket
id|MGA_TEXREG_ORG2
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG3
comma
id|regs
(braket
id|MGA_TEXREG_ORG3
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG4
comma
id|regs
(braket
id|MGA_TEXREG_ORG4
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXWIDTH
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXHEIGHT
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR49
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR57
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR53
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR61
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR52
comma
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR60
comma
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR54
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
op_or
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR62
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
op_or
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANS
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANSHIGH
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|macro|TMC_map1_enable
mdefine_line|#define TMC_map1_enable &t;&t;0x80000000
DECL|function|mgaG400EmitTex1
r_static
r_void
id|mgaG400EmitTex1
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;TexState
(braket
l_int|1
)braket
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* This takes 25 dwords */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
id|regs
(braket
id|MGA_TEXREG_CTL2
)braket
op_or
id|TMC_map1_enable
op_or
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL
comma
id|regs
(braket
id|MGA_TEXREG_CTL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXFILTER
comma
id|regs
(braket
id|MGA_TEXREG_FILTER
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXBORDERCOL
comma
id|regs
(braket
id|MGA_TEXREG_BORDERCOL
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG
comma
id|regs
(braket
id|MGA_TEXREG_ORG
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG1
comma
id|regs
(braket
id|MGA_TEXREG_ORG1
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG2
comma
id|regs
(braket
id|MGA_TEXREG_ORG2
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG3
comma
id|regs
(braket
id|MGA_TEXREG_ORG3
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXORG4
comma
id|regs
(braket
id|MGA_TEXREG_ORG4
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXWIDTH
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXHEIGHT
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR49
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR57
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR53
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR61
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR52
comma
id|regs
(braket
id|MGA_TEXREG_WIDTH
)braket
op_or
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR60
comma
id|regs
(braket
id|MGA_TEXREG_HEIGHT
)braket
op_or
l_int|0x40
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANS
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXTRANSHIGH
comma
l_int|0xffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
id|regs
(braket
id|MGA_TEXREG_CTL2
)braket
op_or
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|macro|MAGIC_FPARAM_HEX_VALUE
mdefine_line|#define MAGIC_FPARAM_HEX_VALUE 0x46480000
multiline_comment|/* This is the hex value of 12800.0f which is a magic value we must&n; * set in wr56.&n; */
DECL|function|mgaG400EmitPipe
r_static
r_void
id|mgaG400EmitPipe
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|pipe
op_assign
id|sarea_priv-&gt;WarpPipe
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* This takes 50 dwords */
multiline_comment|/* Establish vertex size.  &n;&t; */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WIADDR2
comma
id|WIA_wmode_suspend
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pipe
op_amp
id|MGA_T2
)paren
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WVRTXSZ
comma
l_int|0x00001e09
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0x1e000000
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev_priv-&gt;WarpPipe
op_amp
id|MGA_T2
)paren
(brace
multiline_comment|/* Flush the WARP pipe */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDST
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXLEFT
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXRIGHT
comma
l_int|1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|MGA_FLUSH_CMD
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_LEN
op_plus
id|MGAREG_MGA_EXEC
comma
l_int|1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0x7000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_LEN
op_plus
id|MGAREG_MGA_EXEC
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
l_int|0x80
op_or
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_LEN
op_plus
id|MGAREG_MGA_EXEC
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_TEXCTL2
comma
l_int|0x00008000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
)brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WVRTXSZ
comma
l_int|0x00001807
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WACCEPTSEQ
comma
l_int|0x18000000
)paren
suffix:semicolon
)brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WFLAG
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WFLAG1
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR56
comma
id|MAGIC_FPARAM_HEX_VALUE
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR49
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Tex stage 0 */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR57
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Tex stage 0 */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR53
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Tex stage 1 */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR61
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Tex stage 1 */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR54
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* Tex stage 0 : w */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR62
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* Tex stage 0 : h */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR52
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* Tex stage 1 : w */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR60
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* Tex stage 1 : h */
multiline_comment|/* Dma pading required due to hw bug */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WIADDR2
comma
(paren
id|u32
)paren
(paren
id|dev_priv-&gt;WarpIndex
(braket
id|pipe
)braket
dot
id|phys_addr
op_or
id|WIA_wmode_start
op_or
id|WIA_wagp_agp
)paren
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mgaG200EmitPipe
r_static
r_void
id|mgaG200EmitPipe
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|pipe
op_assign
id|sarea_priv-&gt;WarpPipe
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* This takes 15 dwords */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WIADDR
comma
id|WIA_wmode_suspend
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WVRTXSZ
comma
l_int|7
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WFLAG
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR24
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* tex w/h */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR25
comma
l_int|0x100
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR34
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* tex w/h */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR42
comma
l_int|0xFFFF
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WR60
comma
l_int|0xFFFF
)paren
suffix:semicolon
multiline_comment|/* Dma pading required due to hw bug */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_WIADDR
comma
(paren
id|u32
)paren
(paren
id|dev_priv-&gt;WarpIndex
(braket
id|pipe
)braket
dot
id|phys_addr
op_or
id|WIA_wmode_start
op_or
id|WIA_wagp_agp
)paren
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mgaEmitState
r_static
r_void
id|mgaEmitState
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
r_int
id|multitex
op_assign
id|sarea_priv-&gt;WarpPipe
op_amp
id|MGA_T2
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;WarpPipe
op_ne
id|dev_priv-&gt;WarpPipe
)paren
(brace
id|mgaG400EmitPipe
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|dev_priv-&gt;WarpPipe
op_assign
id|sarea_priv-&gt;WarpPipe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CTX
)paren
(brace
id|mgaEmitContext
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_CTX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
(brace
id|mgaG400EmitTex0
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX1
)paren
op_logical_and
id|multitex
)paren
(brace
id|mgaG400EmitTex1
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sarea_priv-&gt;WarpPipe
op_ne
id|dev_priv-&gt;WarpPipe
)paren
(brace
id|mgaG200EmitPipe
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|dev_priv-&gt;WarpPipe
op_assign
id|sarea_priv-&gt;WarpPipe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CTX
)paren
(brace
id|mgaEmitContext
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_CTX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
(brace
id|mgaG200EmitTex
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Disallow all write destinations except the front and backbuffer.&n; */
DECL|function|mgaVerifyContext
r_static
r_int
id|mgaVerifyContext
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;ContextState
suffix:semicolon
r_if
c_cond
(paren
id|regs
(braket
id|MGA_CTXREG_DSTORG
)braket
op_ne
id|dev_priv-&gt;frontOffset
op_logical_and
id|regs
(braket
id|MGA_CTXREG_DSTORG
)braket
op_ne
id|dev_priv-&gt;backOffset
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;BAD DSTORG: %x (front %x, back %x)&bslash;n&bslash;n&quot;
comma
id|regs
(braket
id|MGA_CTXREG_DSTORG
)braket
comma
id|dev_priv-&gt;frontOffset
comma
id|dev_priv-&gt;backOffset
)paren
suffix:semicolon
id|regs
(braket
id|MGA_CTXREG_DSTORG
)braket
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Disallow texture reads from PCI space.&n; */
DECL|function|mgaVerifyTex
r_static
r_int
id|mgaVerifyTex
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
r_int
id|unit
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sarea_priv-&gt;TexState
(braket
id|unit
)braket
(braket
id|MGA_TEXREG_ORG
)braket
op_amp
l_int|0x3
)paren
op_eq
l_int|0x1
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;BAD TEXREG_ORG: %x, unit %d&bslash;n&quot;
comma
id|sarea_priv-&gt;TexState
(braket
id|unit
)braket
(braket
id|MGA_TEXREG_ORG
)braket
comma
id|unit
)paren
suffix:semicolon
id|sarea_priv-&gt;TexState
(braket
id|unit
)braket
(braket
id|MGA_TEXREG_ORG
)braket
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mgaVerifyState
r_static
r_int
id|mgaVerifyState
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CTX
)paren
id|rv
op_or_assign
id|mgaVerifyContext
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
id|rv
op_or_assign
id|mgaVerifyTex
c_func
(paren
id|dev_priv
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX1
)paren
id|rv
op_or_assign
id|mgaVerifyTex
c_func
(paren
id|dev_priv
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_PIPE
)paren
id|rv
op_or_assign
(paren
id|sarea_priv-&gt;WarpPipe
OG
id|MGA_MAX_G400_PIPES
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_PIPE
)paren
id|rv
op_or_assign
(paren
id|sarea_priv-&gt;WarpPipe
OG
id|MGA_MAX_G200_PIPES
)paren
suffix:semicolon
)brace
r_return
id|rv
op_eq
l_int|0
suffix:semicolon
)brace
DECL|function|mgaVerifyIload
r_static
r_int
id|mgaVerifyIload
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
r_int
r_int
id|bus_address
comma
r_int
r_int
id|dstOrg
comma
r_int
id|length
)paren
(brace
r_if
c_cond
(paren
id|dstOrg
template_param
(paren
id|dev_priv-&gt;textureOffset
op_plus
id|dev_priv-&gt;textureSize
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
op_mod
l_int|64
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* This copies a 64 byte aligned agp region to the frambuffer&n; * with a standard blit, the ioctl needs to do checking */
DECL|function|mga_dma_dispatch_tex_blit
r_static
r_void
id|mga_dma_dispatch_tex_blit
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
r_int
id|bus_address
comma
r_int
id|length
comma
r_int
r_int
id|destOrg
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|use_agp
op_assign
id|PDEA_pagpxfer_enable
op_or
l_int|0x00000001
suffix:semicolon
id|u16
id|y2
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|y2
op_assign
id|length
op_div
l_int|64
suffix:semicolon
id|PRIM_OVERFLOW
c_func
(paren
id|dev
comma
id|dev_priv
comma
l_int|30
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|destOrg
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_MACCESS
comma
l_int|0x00000000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SRCORG
comma
(paren
id|u32
)paren
id|bus_address
op_or
id|use_agp
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR5
comma
l_int|64
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PITCH
comma
l_int|64
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|MGA_COPY_CMD
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR0
comma
l_int|63
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR3
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXBNDRY
comma
(paren
l_int|63
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDSTLEN
op_plus
id|MGAREG_MGA_EXEC
comma
id|y2
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SRCORG
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PITCH
comma
id|dev_priv-&gt;stride
op_div
id|dev_priv-&gt;cpp
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0x7000
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_vertex
r_static
r_void
id|mga_dma_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|address
op_assign
(paren
r_int
r_int
)paren
id|buf-&gt;bus_address
suffix:semicolon
r_int
id|length
op_assign
id|buf-&gt;used
suffix:semicolon
r_int
id|use_agp
op_assign
id|PDEA_pagpxfer_enable
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;used
)paren
(brace
multiline_comment|/* WARNING: if you change any of the state functions verify&n;&t;&t; * these numbers (Overestimating this doesn&squot;t hurt).&n;&t;&t; */
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
id|PRIM_OVERFLOW
c_func
(paren
id|dev
comma
id|dev_priv
comma
(paren
id|MAX_STATE_SIZE
op_plus
(paren
l_int|5
op_star
id|MGA_NR_SAREA_CLIPRECTS
)paren
)paren
)paren
suffix:semicolon
id|mgaEmitState
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#if 0
id|length
op_assign
id|dev_priv-&gt;vertexsize
op_star
l_int|3
op_star
l_int|4
suffix:semicolon
macro_line|#endif
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|mgaEmitClipRect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SECADDRESS
comma
(paren
(paren
id|u32
)paren
id|address
)paren
op_or
id|TT_VERTEX
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SECEND
comma
(paren
(paren
(paren
id|u32
)paren
(paren
id|address
op_plus
id|length
)paren
)paren
op_or
id|use_agp
)paren
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGEBUF
c_func
(paren
id|dev_priv
comma
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
DECL|function|mga_dma_dispatch_indices
r_static
r_void
id|mga_dma_dispatch_indices
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|address
op_assign
(paren
r_int
r_int
)paren
id|buf-&gt;bus_address
suffix:semicolon
r_int
id|use_agp
op_assign
id|PDEA_pagpxfer_enable
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
multiline_comment|/* WARNING: if you change any of the state functions verify&n;&t;&t; * these numbers (Overestimating this doesn&squot;t hurt).&n;&t;&t; */
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
id|PRIM_OVERFLOW
c_func
(paren
id|dev
comma
id|dev_priv
comma
(paren
id|MAX_STATE_SIZE
op_plus
(paren
l_int|5
op_star
id|MGA_NR_SAREA_CLIPRECTS
)paren
)paren
)paren
suffix:semicolon
id|mgaEmitState
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|mgaEmitClipRect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|PRIMGETPTR
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SETUPADDRESS
comma
(paren
(paren
id|address
op_plus
id|start
)paren
op_or
id|SETADD_mode_vertlist
)paren
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SETUPEND
comma
(paren
(paren
id|address
op_plus
id|end
)paren
op_or
id|use_agp
)paren
)paren
suffix:semicolon
multiline_comment|/*  &t;&t;&t;&t;   ((address + start + 12) | use_agp)); */
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGEBUF
c_func
(paren
id|dev_priv
comma
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
DECL|function|mga_dma_dispatch_clear
r_static
r_void
id|mga_dma_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|flags
comma
r_int
r_int
id|clear_color
comma
r_int
r_int
id|clear_zval
comma
r_int
r_int
id|clear_colormask
comma
r_int
r_int
id|clear_depthmask
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;ContextState
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
r_int
id|cmd
suffix:semicolon
r_int
id|i
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;sgram
)paren
id|cmd
op_assign
id|MGA_CLEAR_CMD
op_or
id|DC_atype_blk
suffix:semicolon
r_else
id|cmd
op_assign
id|MGA_CLEAR_CMD
op_or
id|DC_atype_rstr
suffix:semicolon
id|PRIM_OVERFLOW
c_func
(paren
id|dev
comma
id|dev_priv
comma
l_int|35
op_star
id|MGA_NR_SAREA_CLIPRECTS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|height
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MGA_FRONT
)paren
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PLNWT
comma
id|clear_colormask
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDSTLEN
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|y1
op_lshift
l_int|16
)paren
op_or
id|height
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXBNDRY
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|x2
op_lshift
l_int|16
)paren
op_or
id|pbox
(braket
id|i
)braket
dot
id|x1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FCOL
comma
id|clear_color
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|dev_priv-&gt;frontOffset
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
op_plus
id|MGAREG_MGA_EXEC
comma
id|cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MGA_BACK
)paren
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PLNWT
comma
id|clear_colormask
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDSTLEN
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|y1
op_lshift
l_int|16
)paren
op_or
id|height
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXBNDRY
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|x2
op_lshift
l_int|16
)paren
op_or
id|pbox
(braket
id|i
)braket
dot
id|x1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FCOL
comma
id|clear_color
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|dev_priv-&gt;backOffset
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
op_plus
id|MGAREG_MGA_EXEC
comma
id|cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MGA_DEPTH
)paren
(brace
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_PLNWT
comma
id|clear_depthmask
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDSTLEN
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|y1
op_lshift
l_int|16
)paren
op_or
id|height
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXBNDRY
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|x2
op_lshift
l_int|16
)paren
op_or
id|pbox
(braket
id|i
)braket
dot
id|x1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FCOL
comma
id|clear_zval
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|dev_priv-&gt;depthOffset
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
op_plus
id|MGAREG_MGA_EXEC
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Force reset of DWGCTL */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_swap
r_static
r_void
id|mga_dma_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
op_star
id|regs
op_assign
id|sarea_priv-&gt;ContextState
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|pixel_stride
op_assign
id|dev_priv-&gt;stride
op_div
id|dev_priv-&gt;cpp
suffix:semicolon
id|PRIMLOCALS
suffix:semicolon
id|PRIM_OVERFLOW
c_func
(paren
id|dev
comma
id|dev_priv
comma
(paren
id|MGA_NR_SAREA_CLIPRECTS
op_star
l_int|5
)paren
op_plus
l_int|20
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0x7100
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGSYNC
comma
l_int|0x7000
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DSTORG
comma
id|dev_priv-&gt;frontOffset
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_MACCESS
comma
id|dev_priv-&gt;mAccess
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SRCORG
comma
id|dev_priv-&gt;backOffset
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR5
comma
id|pixel_stride
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|MGA_COPY_CMD
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
r_int
id|start
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
op_star
id|pixel_stride
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR0
comma
id|start
op_plus
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
l_int|1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_AR3
comma
id|start
op_plus
id|pbox
(braket
id|i
)braket
dot
id|x1
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_FXBNDRY
comma
id|pbox
(braket
id|i
)braket
dot
id|x1
op_or
(paren
(paren
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_YDSTLEN
op_plus
id|MGAREG_MGA_EXEC
comma
(paren
id|pbox
(braket
id|i
)braket
dot
id|y1
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
)brace
multiline_comment|/* Force reset of DWGCTL */
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DMAPAD
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_SRCORG
comma
l_int|0
)paren
suffix:semicolon
id|PRIMOUTREG
c_func
(paren
id|MGAREG_DWGCTL
comma
id|regs
(braket
id|MGA_CTXREG_DWGCTL
)braket
)paren
suffix:semicolon
id|PRIMADVANCE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
DECL|function|mga_clear_bufs
r_int
id|mga_clear_bufs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_mga_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_clear_t
id|clear
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clear
comma
(paren
id|drm_mga_clear_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clear
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_clear_bufs called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CTX
suffix:semicolon
id|mga_dma_dispatch_clear
c_func
(paren
id|dev
comma
id|clear.flags
comma
id|clear.clear_color
comma
id|clear.clear_depth
comma
id|clear.clear_color_mask
comma
id|clear.clear_depth_mask
)paren
suffix:semicolon
id|PRIMUPDATE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_flush_write_combine
c_func
(paren
)paren
suffix:semicolon
id|mga_dma_schedule
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_swap_bufs
r_int
id|mga_swap_bufs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_mga_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_swap_bufs called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CTX
suffix:semicolon
id|mga_dma_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
id|PRIMUPDATE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|MGA_BUF_SWAP_PENDING
comma
op_amp
id|dev_priv-&gt;current_prim-&gt;buffer_status
)paren
suffix:semicolon
id|mga_flush_write_combine
c_func
(paren
)paren
suffix:semicolon
id|mga_dma_schedule
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_iload
r_int
id|mga_iload
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_mga_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_iload_t
id|iload
suffix:semicolon
r_int
r_int
id|bus_address
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|iload
comma
(paren
id|drm_mga_iload_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|iload
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_iload called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|iload.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|bus_address
op_assign
id|buf-&gt;bus_address
suffix:semicolon
r_if
c_cond
(paren
id|mgaVerifyIload
c_func
(paren
id|dev_priv
comma
id|bus_address
comma
id|iload.destOrg
comma
id|iload.length
)paren
)paren
(brace
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CTX
suffix:semicolon
id|mga_dma_dispatch_tex_blit
c_func
(paren
id|dev
comma
id|bus_address
comma
id|iload.length
comma
id|iload.destOrg
)paren
suffix:semicolon
id|AGEBUF
c_func
(paren
id|dev_priv
comma
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
l_int|1
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|mga_flush_write_combine
c_func
(paren
)paren
suffix:semicolon
id|mga_dma_schedule
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_vertex
r_int
id|mga_vertex
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_mga_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_vertex_t
id|vertex
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_mga_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_vertex called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|buf-&gt;used
op_assign
id|vertex.used
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|vertex.discard
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mgaVerifyState
c_func
(paren
id|dev_priv
)paren
)paren
(brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGEBUF
c_func
(paren
id|dev_priv
comma
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mga_dma_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|PRIMUPDATE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_flush_write_combine
c_func
(paren
)paren
suffix:semicolon
id|mga_dma_schedule
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_indices
r_int
id|mga_indices
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_mga_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_indices_t
id|indices
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|indices
comma
(paren
id|drm_mga_indices_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|indices
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_indices called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|indices.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|indices.discard
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mgaVerifyState
c_func
(paren
id|dev_priv
)paren
)paren
(brace
r_if
c_cond
(paren
id|indices.discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGEBUF
c_func
(paren
id|dev_priv
comma
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mga_dma_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
id|indices.start
comma
id|indices.end
)paren
suffix:semicolon
id|PRIMUPDATE
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_flush_write_combine
c_func
(paren
)paren
suffix:semicolon
id|mga_dma_schedule
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_get_buffers
r_static
r_int
id|mga_dma_get_buffers
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_dma_t
op_star
id|d
)paren
(brace
r_int
id|i
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|d-&gt;granted_count
suffix:semicolon
id|i
OL
id|d-&gt;request_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
op_assign
id|mga_freelist_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_break
suffix:semicolon
id|buf-&gt;pid
op_assign
id|current-&gt;pid
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|d-&gt;request_indices
(braket
id|i
)braket
comma
op_amp
id|buf-&gt;idx
comma
r_sizeof
(paren
id|buf-&gt;idx
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|d-&gt;request_sizes
(braket
id|i
)braket
comma
op_amp
id|buf-&gt;total
comma
r_sizeof
(paren
id|buf-&gt;total
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_increment
id|d-&gt;granted_count
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma
r_int
id|mga_dma
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|drm_dma_t
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|d
comma
(paren
id|drm_dma_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;mga_dma called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Please don&squot;t send us buffers.&n;&t; */
r_if
c_cond
(paren
id|d.send_count
op_ne
l_int|0
)paren
(brace
id|DRM_ERROR
(paren
l_string|&quot;Process %d trying to send %d buffers via drmDMA&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|d.send_count
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* We&squot;ll send you buffers.&n;&t; */
r_if
c_cond
(paren
id|d.request_count
template_param
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
(paren
l_string|&quot;Process %d trying to get %d buffers (of %d max)&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|d.request_count
comma
id|dma-&gt;buf_count
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|d.granted_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|d.request_count
)paren
(brace
id|retcode
op_assign
id|mga_dma_get_buffers
c_func
(paren
id|dev
comma
op_amp
id|d
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|drm_dma_t
op_star
)paren
id|arg
comma
op_amp
id|d
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
eof
