multiline_comment|/* i810_dma.c -- DMA support for the i810 -*- linux-c -*-&n; * Created: Mon Dec 13 01:50:01 1999 by jhartmann@precisioninsight.com&n; *&n; * Copyright 1999 Precision Insight, Inc., Cedar Park, Texas.&n; * Copyright 2000 VA Linux Systems, Inc., Sunnyvale, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; * &n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; * &n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors: Rickard E. (Rik) Faith &lt;faith@valinux.com&gt;&n; *&t;    Jeff Hartmann &lt;jhartmann@valinux.com&gt;&n; *          Keith Whitwell &lt;keithw@valinux.com&gt;&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;i810_drv.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;&t;/* For task queue support */
multiline_comment|/* in case we don&squot;t have a 2.3.99-pre6 kernel or later: */
macro_line|#ifndef VM_DONTCOPY
DECL|macro|VM_DONTCOPY
mdefine_line|#define VM_DONTCOPY 0
macro_line|#endif
DECL|macro|I810_BUF_FREE
mdefine_line|#define I810_BUF_FREE&t;&t;2
DECL|macro|I810_BUF_CLIENT
mdefine_line|#define I810_BUF_CLIENT&t;&t;1
DECL|macro|I810_BUF_HARDWARE
mdefine_line|#define I810_BUF_HARDWARE      &t;0
DECL|macro|I810_BUF_UNMAPPED
mdefine_line|#define I810_BUF_UNMAPPED 0
DECL|macro|I810_BUF_MAPPED
mdefine_line|#define I810_BUF_MAPPED   1
DECL|macro|I810_REG
mdefine_line|#define I810_REG(reg)&t;&t;2
DECL|macro|I810_BASE
mdefine_line|#define I810_BASE(reg)&t;&t;((unsigned long) &bslash;&n;&t;&t;&t;&t;dev-&gt;maplist[I810_REG(reg)]-&gt;handle)
DECL|macro|I810_ADDR
mdefine_line|#define I810_ADDR(reg)&t;&t;(I810_BASE(reg) + reg)
DECL|macro|I810_DEREF
mdefine_line|#define I810_DEREF(reg)&t;&t;*(__volatile__ int *)I810_ADDR(reg)
DECL|macro|I810_READ
mdefine_line|#define I810_READ(reg)&t;&t;I810_DEREF(reg)
DECL|macro|I810_WRITE
mdefine_line|#define I810_WRITE(reg,val) &t;do { I810_DEREF(reg) = val; } while (0)
DECL|macro|I810_DEREF16
mdefine_line|#define I810_DEREF16(reg)&t;*(__volatile__ u16 *)I810_ADDR(reg)
DECL|macro|I810_READ16
mdefine_line|#define I810_READ16(reg)&t;I810_DEREF16(reg)
DECL|macro|I810_WRITE16
mdefine_line|#define I810_WRITE16(reg,val)&t;do { I810_DEREF16(reg) = val; } while (0)
DECL|macro|RING_LOCALS
mdefine_line|#define RING_LOCALS&t;unsigned int outring, ringmask; volatile char *virt;
DECL|macro|BEGIN_LP_RING
mdefine_line|#define BEGIN_LP_RING(n) do {&t;&t;&t;&t;&bslash;&n;&t;if (I810_VERBOSE)&t;&t;&t;&t;&bslash;&n;&t;&t;DRM_DEBUG(&quot;BEGIN_LP_RING(%d) in %s&bslash;n&quot;,&t;&bslash;&n;&t;&t;&t;  n, __FUNCTION__);&t;&t;&bslash;&n;&t;if (dev_priv-&gt;ring.space &lt; n*4) &t;&t;&bslash;&n;&t;&t;i810_wait_ring(dev, n*4);&t;&t;&bslash;&n;&t;dev_priv-&gt;ring.space -= n*4;&t;&t;&t;&bslash;&n;&t;outring = dev_priv-&gt;ring.tail;&t;&t;&t;&bslash;&n;&t;ringmask = dev_priv-&gt;ring.tail_mask;&t;&t;&bslash;&n;&t;virt = dev_priv-&gt;ring.virtual_start;&t;&t;&bslash;&n;} while (0)
DECL|macro|ADVANCE_LP_RING
mdefine_line|#define ADVANCE_LP_RING() do {&t;&t;&t;&t;&t;&bslash;&n;&t;if (I810_VERBOSE) DRM_DEBUG(&quot;ADVANCE_LP_RING&bslash;n&quot;);&t;&bslash;&n;&t;dev_priv-&gt;ring.tail = outring;&t;&t;&t;&t;&bslash;&n;&t;I810_WRITE(LP_RING + RING_TAIL, outring);&t;&t;&bslash;&n;} while(0)
DECL|macro|OUT_RING
mdefine_line|#define OUT_RING(n) do {&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (I810_VERBOSE) DRM_DEBUG(&quot;   OUT_RING %x&bslash;n&quot;, (int)(n));&t;&bslash;&n;&t;*(volatile unsigned int *)(virt + outring) = n;&t;&t;&t;&bslash;&n;&t;outring += 4;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;outring &amp;= ringmask;&t;&t;&t;&t;&t;&t;&bslash;&n;} while (0);
DECL|function|i810_print_status_page
r_static
r_inline
r_void
id|i810_print_status_page
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|u32
op_star
id|temp
op_assign
(paren
id|u32
op_star
)paren
id|dev_priv-&gt;hw_status_page
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw_status: Interrupt Status : %x&bslash;n&quot;
comma
id|temp
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw_status: LpRing Head ptr : %x&bslash;n&quot;
comma
id|temp
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw_status: IRing Head ptr : %x&bslash;n&quot;
comma
id|temp
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw_status: Reserved : %x&bslash;n&quot;
comma
id|temp
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw_status: Driver Counter : %d&bslash;n&quot;
comma
id|temp
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|6
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
op_plus
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;buffer status idx : %d used: %d&bslash;n&quot;
comma
id|i
op_minus
l_int|6
comma
id|temp
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|i810_freelist_get
r_static
id|drm_buf_t
op_star
id|i810_freelist_get
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|used
suffix:semicolon
multiline_comment|/* Linear search might not be the best solution */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_buf_t
op_star
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
multiline_comment|/* In use is already a pointer */
id|used
op_assign
id|cmpxchg
c_func
(paren
id|buf_priv-&gt;in_use
comma
id|I810_BUF_FREE
comma
id|I810_BUF_CLIENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_eq
id|I810_BUF_FREE
)paren
(brace
r_return
id|buf
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* This should only be called if the buffer is not sent to the hardware&n; * yet, the hardware updates in use for us once its on the ring buffer.&n; */
DECL|function|i810_freelist_put
r_static
r_int
id|i810_freelist_put
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_int
id|used
suffix:semicolon
multiline_comment|/* In use is already a pointer */
id|used
op_assign
id|cmpxchg
c_func
(paren
id|buf_priv-&gt;in_use
comma
id|I810_BUF_CLIENT
comma
id|I810_BUF_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_ne
id|I810_BUF_CLIENT
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Freeing buffer thats not in use : %d&bslash;n&quot;
comma
id|buf-&gt;idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|i810_buffer_fops
r_static
r_struct
id|file_operations
id|i810_buffer_fops
op_assign
(brace
id|open
suffix:colon
id|i810_open
comma
id|flush
suffix:colon
id|drm_flush
comma
id|release
suffix:colon
id|i810_release
comma
id|ioctl
suffix:colon
id|i810_ioctl
comma
id|mmap
suffix:colon
id|i810_mmap_buffers
comma
id|read
suffix:colon
id|drm_read
comma
id|fasync
suffix:colon
id|drm_fasync
comma
id|poll
suffix:colon
id|drm_poll
comma
)brace
suffix:semicolon
DECL|function|i810_mmap_buffers
r_int
id|i810_mmap_buffers
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|buf
op_assign
id|dev_priv-&gt;mmap_buffer
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
(paren
id|VM_IO
op_or
id|VM_DONTCOPY
)paren
suffix:semicolon
id|vma-&gt;vm_file
op_assign
id|filp
suffix:semicolon
id|buf_priv-&gt;currently_mapped
op_assign
id|I810_BUF_MAPPED
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|VM_OFFSET
c_func
(paren
id|vma
)paren
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_map_buffer
r_static
r_int
id|i810_map_buffer
c_func
(paren
id|drm_buf_t
op_star
id|buf
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_struct
id|file_operations
op_star
id|old_fops
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|buf_priv-&gt;currently_mapped
op_eq
id|I810_BUF_MAPPED
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|VM_DONTCOPY
op_ne
l_int|0
)paren
(brace
id|down
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
id|old_fops
op_assign
id|filp-&gt;f_op
suffix:semicolon
id|filp-&gt;f_op
op_assign
op_amp
id|i810_buffer_fops
suffix:semicolon
id|dev_priv-&gt;mmap_buffer
op_assign
id|buf
suffix:semicolon
id|buf_priv
op_member_access_from_pointer
r_virtual
op_assign
(paren
r_void
op_star
)paren
id|do_mmap
c_func
(paren
id|filp
comma
l_int|0
comma
id|buf-&gt;total
comma
id|PROT_READ
op_or
id|PROT_WRITE
comma
id|MAP_SHARED
comma
id|buf-&gt;bus_address
)paren
suffix:semicolon
id|dev_priv-&gt;mmap_buffer
op_assign
l_int|NULL
suffix:semicolon
id|filp-&gt;f_op
op_assign
id|old_fops
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
OG
op_minus
l_int|1024UL
)paren
(brace
multiline_comment|/* Real error */
id|DRM_DEBUG
c_func
(paren
l_string|&quot;mmap error&bslash;n&quot;
)paren
suffix:semicolon
id|retcode
op_assign
(paren
r_int
r_int
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
suffix:semicolon
id|buf_priv
op_member_access_from_pointer
r_virtual
op_assign
l_int|0
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
)brace
r_else
(brace
id|buf_priv
op_member_access_from_pointer
r_virtual
op_assign
id|buf_priv-&gt;kernel_virtual
suffix:semicolon
id|buf_priv-&gt;currently_mapped
op_assign
id|I810_BUF_MAPPED
suffix:semicolon
)brace
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|i810_unmap_buffer
r_static
r_int
id|i810_unmap_buffer
c_func
(paren
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|VM_DONTCOPY
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;currently_mapped
op_ne
id|I810_BUF_MAPPED
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; 0x020399
id|retcode
op_assign
id|do_munmap
c_func
(paren
(paren
r_int
r_int
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
comma
(paren
r_int
)paren
id|buf-&gt;total
)paren
suffix:semicolon
macro_line|#else
id|retcode
op_assign
id|do_munmap
c_func
(paren
id|current-&gt;mm
comma
(paren
r_int
r_int
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
comma
(paren
r_int
)paren
id|buf-&gt;total
)paren
suffix:semicolon
macro_line|#endif
id|up
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
)brace
id|buf_priv-&gt;currently_mapped
op_assign
id|I810_BUF_UNMAPPED
suffix:semicolon
id|buf_priv
op_member_access_from_pointer
r_virtual
op_assign
l_int|0
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|i810_dma_get_buffer
r_static
r_int
id|i810_dma_get_buffer
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_i810_dma_t
op_star
id|d
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|buf
op_assign
id|i810_freelist_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|retcode
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;retcode=%d&bslash;n&quot;
comma
id|retcode
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
id|retcode
op_assign
id|i810_map_buffer
c_func
(paren
id|buf
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retcode
)paren
(brace
id|i810_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;mapbuf failed, retcode %d&bslash;n&quot;
comma
id|retcode
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
id|buf-&gt;pid
op_assign
id|priv-&gt;pid
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|d-&gt;granted
op_assign
l_int|1
suffix:semicolon
id|d-&gt;request_idx
op_assign
id|buf-&gt;idx
suffix:semicolon
id|d-&gt;request_size
op_assign
id|buf-&gt;total
suffix:semicolon
id|d
op_member_access_from_pointer
r_virtual
op_assign
id|buf_priv
op_member_access_from_pointer
r_virtual
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|i810_alloc_page
r_static
r_int
r_int
id|i810_alloc_page
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
r_int
r_int
id|address
suffix:semicolon
id|address
op_assign
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|address
op_eq
l_int|0UL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|virt_to_page
c_func
(paren
id|address
)paren
op_member_access_from_pointer
id|count
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|PG_locked
comma
op_amp
id|virt_to_page
c_func
(paren
id|address
)paren
op_member_access_from_pointer
id|flags
)paren
suffix:semicolon
r_return
id|address
suffix:semicolon
)brace
DECL|function|i810_free_page
r_static
r_void
id|i810_free_page
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
r_int
id|page
)paren
(brace
r_if
c_cond
(paren
id|page
op_eq
l_int|0UL
)paren
(brace
r_return
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|virt_to_page
c_func
(paren
id|page
)paren
op_member_access_from_pointer
id|count
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|PG_locked
comma
op_amp
id|virt_to_page
c_func
(paren
id|page
)paren
op_member_access_from_pointer
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|virt_to_page
c_func
(paren
id|page
)paren
op_member_access_from_pointer
id|wait
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|i810_dma_cleanup
r_static
r_int
id|i810_dma_cleanup
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;dev_private
)paren
(brace
r_int
id|i
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;ring.virtual_start
)paren
(brace
id|drm_ioremapfree
c_func
(paren
(paren
r_void
op_star
)paren
id|dev_priv-&gt;ring.virtual_start
comma
id|dev_priv-&gt;ring.Size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_priv-&gt;hw_status_page
op_ne
l_int|0UL
)paren
(brace
id|i810_free_page
c_func
(paren
id|dev
comma
id|dev_priv-&gt;hw_status_page
)paren
suffix:semicolon
multiline_comment|/* Need to rewrite hardware status page */
id|I810_WRITE
c_func
(paren
l_int|0x02080
comma
l_int|0x1ffff000
)paren
suffix:semicolon
)brace
id|drm_free
c_func
(paren
id|dev-&gt;dev_private
comma
r_sizeof
(paren
id|drm_i810_private_t
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
id|dev-&gt;dev_private
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_buf_t
op_star
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_ioremapfree
c_func
(paren
id|buf_priv-&gt;kernel_virtual
comma
id|buf-&gt;total
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_wait_ring
r_static
r_int
id|i810_wait_ring
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|n
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_ring_buffer_t
op_star
id|ring
op_assign
op_amp
(paren
id|dev_priv-&gt;ring
)paren
suffix:semicolon
r_int
id|iters
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_int
r_int
id|last_head
op_assign
id|I810_READ
c_func
(paren
id|LP_RING
op_plus
id|RING_HEAD
)paren
op_amp
id|HEAD_ADDR
suffix:semicolon
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ring-&gt;space
OL
id|n
)paren
(brace
r_int
id|i
suffix:semicolon
id|ring-&gt;head
op_assign
id|I810_READ
c_func
(paren
id|LP_RING
op_plus
id|RING_HEAD
)paren
op_amp
id|HEAD_ADDR
suffix:semicolon
id|ring-&gt;space
op_assign
id|ring-&gt;head
op_minus
(paren
id|ring-&gt;tail
op_plus
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ring-&gt;space
OL
l_int|0
)paren
id|ring-&gt;space
op_add_assign
id|ring-&gt;Size
suffix:semicolon
r_if
c_cond
(paren
id|ring-&gt;head
op_ne
id|last_head
)paren
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|iters
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|end
op_minus
id|jiffies
)paren
op_le
l_int|0
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;space: %d wanted %d&bslash;n&quot;
comma
id|ring-&gt;space
comma
id|n
)paren
suffix:semicolon
id|DRM_ERROR
c_func
(paren
l_string|&quot;lockup&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_wait_ring
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
)brace
id|out_wait_ring
suffix:colon
r_return
id|iters
suffix:semicolon
)brace
DECL|function|i810_kernel_lost_context
r_static
r_void
id|i810_kernel_lost_context
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_ring_buffer_t
op_star
id|ring
op_assign
op_amp
(paren
id|dev_priv-&gt;ring
)paren
suffix:semicolon
id|ring-&gt;head
op_assign
id|I810_READ
c_func
(paren
id|LP_RING
op_plus
id|RING_HEAD
)paren
op_amp
id|HEAD_ADDR
suffix:semicolon
id|ring-&gt;tail
op_assign
id|I810_READ
c_func
(paren
id|LP_RING
op_plus
id|RING_TAIL
)paren
suffix:semicolon
id|ring-&gt;space
op_assign
id|ring-&gt;head
op_minus
(paren
id|ring-&gt;tail
op_plus
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ring-&gt;space
OL
l_int|0
)paren
id|ring-&gt;space
op_add_assign
id|ring-&gt;Size
suffix:semicolon
)brace
DECL|function|i810_freelist_init
r_static
r_int
id|i810_freelist_init
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|my_idx
op_assign
l_int|24
suffix:semicolon
id|u32
op_star
id|hw_status
op_assign
(paren
id|u32
op_star
)paren
(paren
id|dev_priv-&gt;hw_status_page
op_plus
id|my_idx
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;buf_count
OG
l_int|1019
)paren
(brace
multiline_comment|/* Not enough space in the status page for the freelist */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_buf_t
op_star
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|buf_priv-&gt;in_use
op_assign
id|hw_status
op_increment
suffix:semicolon
id|buf_priv-&gt;my_use_idx
op_assign
id|my_idx
suffix:semicolon
id|my_idx
op_add_assign
l_int|4
suffix:semicolon
op_star
id|buf_priv-&gt;in_use
op_assign
id|I810_BUF_FREE
suffix:semicolon
id|buf_priv-&gt;kernel_virtual
op_assign
id|drm_ioremap
c_func
(paren
id|buf-&gt;bus_address
comma
id|buf-&gt;total
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_dma_initialize
r_static
r_int
id|i810_dma_initialize
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_i810_private_t
op_star
id|dev_priv
comma
id|drm_i810_init_t
op_star
id|init
)paren
(brace
id|drm_map_t
op_star
id|sarea_map
suffix:semicolon
id|dev-&gt;dev_private
op_assign
(paren
r_void
op_star
)paren
id|dev_priv
suffix:semicolon
id|memset
c_func
(paren
id|dev_priv
comma
l_int|0
comma
r_sizeof
(paren
id|drm_i810_private_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init-&gt;ring_map_idx
op_ge
id|dev-&gt;map_count
op_logical_or
id|init-&gt;buffer_map_idx
op_ge
id|dev-&gt;map_count
)paren
(brace
id|i810_dma_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DRM_ERROR
c_func
(paren
l_string|&quot;ring_map or buffer_map are invalid&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev_priv-&gt;ring_map_idx
op_assign
id|init-&gt;ring_map_idx
suffix:semicolon
id|dev_priv-&gt;buffer_map_idx
op_assign
id|init-&gt;buffer_map_idx
suffix:semicolon
id|sarea_map
op_assign
id|dev-&gt;maplist
(braket
l_int|0
)braket
suffix:semicolon
id|dev_priv-&gt;sarea_priv
op_assign
(paren
id|drm_i810_sarea_t
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|sarea_map-&gt;handle
op_plus
id|init-&gt;sarea_priv_offset
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
comma
l_int|0
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
)paren
suffix:semicolon
id|dev_priv-&gt;ring.Start
op_assign
id|init-&gt;ring_start
suffix:semicolon
id|dev_priv-&gt;ring.End
op_assign
id|init-&gt;ring_end
suffix:semicolon
id|dev_priv-&gt;ring.Size
op_assign
id|init-&gt;ring_size
suffix:semicolon
id|dev_priv-&gt;ring.virtual_start
op_assign
id|drm_ioremap
c_func
(paren
id|dev-&gt;agp-&gt;base
op_plus
id|init-&gt;ring_start
comma
id|init-&gt;ring_size
)paren
suffix:semicolon
id|dev_priv-&gt;ring.tail_mask
op_assign
id|dev_priv-&gt;ring.Size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;ring.virtual_start
op_eq
l_int|NULL
)paren
(brace
id|i810_dma_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DRM_ERROR
c_func
(paren
l_string|&quot;can not ioremap virtual address for&quot;
l_string|&quot; ring buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|dev_priv-&gt;w
op_assign
id|init-&gt;w
suffix:semicolon
id|dev_priv-&gt;h
op_assign
id|init-&gt;h
suffix:semicolon
id|dev_priv-&gt;pitch
op_assign
id|init-&gt;pitch
suffix:semicolon
id|dev_priv-&gt;back_offset
op_assign
id|init-&gt;back_offset
suffix:semicolon
id|dev_priv-&gt;depth_offset
op_assign
id|init-&gt;depth_offset
suffix:semicolon
id|dev_priv-&gt;front_di1
op_assign
id|init-&gt;front_offset
op_or
id|init-&gt;pitch_bits
suffix:semicolon
id|dev_priv-&gt;back_di1
op_assign
id|init-&gt;back_offset
op_or
id|init-&gt;pitch_bits
suffix:semicolon
id|dev_priv-&gt;zi1
op_assign
id|init-&gt;depth_offset
op_or
id|init-&gt;pitch_bits
suffix:semicolon
multiline_comment|/* Program Hardware Status Page */
id|dev_priv-&gt;hw_status_page
op_assign
id|i810_alloc_page
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|dev_priv-&gt;hw_status_page
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;hw_status_page
op_eq
l_int|0UL
)paren
(brace
id|i810_dma_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DRM_ERROR
c_func
(paren
l_string|&quot;Can not allocate hardware status page&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hw status page @ %lx&bslash;n&quot;
comma
id|dev_priv-&gt;hw_status_page
)paren
suffix:semicolon
id|I810_WRITE
c_func
(paren
l_int|0x02080
comma
id|virt_to_bus
c_func
(paren
(paren
r_void
op_star
)paren
id|dev_priv-&gt;hw_status_page
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;Enabled hardware status page&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Now we need to init our freelist */
r_if
c_cond
(paren
id|i810_freelist_init
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
(brace
id|i810_dma_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DRM_ERROR
c_func
(paren
l_string|&quot;Not enough space in the status page for&quot;
l_string|&quot; the freelist&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_dma_init
r_int
id|i810_dma_init
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
suffix:semicolon
id|drm_i810_init_t
id|init
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|init
comma
(paren
id|drm_i810_init_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|init
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|init.func
)paren
(brace
r_case
id|I810_INIT_DMA
suffix:colon
id|dev_priv
op_assign
id|drm_alloc
c_func
(paren
r_sizeof
(paren
id|drm_i810_private_t
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|retcode
op_assign
id|i810_dma_initialize
c_func
(paren
id|dev
comma
id|dev_priv
comma
op_amp
id|init
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I810_CLEANUP_DMA
suffix:colon
id|retcode
op_assign
id|i810_dma_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retcode
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|retcode
suffix:semicolon
)brace
multiline_comment|/* Most efficient way to verify state for the i810 is as it is&n; * emitted.  Non-conformant state is silently dropped.&n; *&n; * Use &squot;volatile&squot; &amp; local var tmp to force the emitted values to be&n; * identical to the verified ones.&n; */
DECL|function|i810EmitContextVerified
r_static
r_void
id|i810EmitContextVerified
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_volatile
r_int
r_int
op_star
id|code
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|i
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
id|I810_CTX_SETUP_SIZE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_COLOR_FACTOR
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_CTXREG_CF1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_STIPPLE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_CTXREG_ST1
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|4
suffix:semicolon
id|i
OL
id|I810_CTX_SETUP_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
id|code
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
(paren
l_int|7
op_lshift
l_int|29
)paren
)paren
op_eq
(paren
l_int|3
op_lshift
l_int|29
)paren
op_logical_and
(paren
id|tmp
op_amp
(paren
l_int|0x1f
op_lshift
l_int|24
)paren
)paren
OL
(paren
l_int|0x1d
op_lshift
l_int|24
)paren
)paren
(brace
id|OUT_RING
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|j
op_amp
l_int|1
)paren
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|i810EmitTexVerified
r_static
r_void
id|i810EmitTexVerified
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_volatile
r_int
r_int
op_star
id|code
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|i
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
id|I810_TEX_SETUP_SIZE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_MAP_INFO
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_TEXREG_MI1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_TEXREG_MI2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_TEXREG_MI3
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|4
suffix:semicolon
id|i
OL
id|I810_TEX_SETUP_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
id|code
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
(paren
l_int|7
op_lshift
l_int|29
)paren
)paren
op_eq
(paren
l_int|3
op_lshift
l_int|29
)paren
op_logical_and
(paren
id|tmp
op_amp
(paren
l_int|0x1f
op_lshift
l_int|24
)paren
)paren
OL
(paren
l_int|0x1d
op_lshift
l_int|24
)paren
)paren
(brace
id|OUT_RING
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|j
op_amp
l_int|1
)paren
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Need to do some additional checking when setting the dest buffer.&n; */
DECL|function|i810EmitDestVerified
r_static
r_void
id|i810EmitDestVerified
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_volatile
r_int
r_int
op_star
id|code
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
id|I810_DEST_SETUP_SIZE
op_plus
l_int|2
)paren
suffix:semicolon
id|tmp
op_assign
id|code
(braket
id|I810_DESTREG_DI1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
id|dev_priv-&gt;front_di1
op_logical_or
id|tmp
op_eq
id|dev_priv-&gt;back_di1
)paren
(brace
id|OUT_RING
c_func
(paren
id|CMD_OP_DESTBUFFER_INFO
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_else
id|DRM_DEBUG
c_func
(paren
l_string|&quot;bad di1 %x (allow %x or %x)&bslash;n&quot;
comma
id|tmp
comma
id|dev_priv-&gt;front_di1
comma
id|dev_priv-&gt;back_di1
)paren
suffix:semicolon
multiline_comment|/* invarient:&n;&t; */
id|OUT_RING
c_func
(paren
id|CMD_OP_Z_BUFFER_INFO
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;zi1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_DESTBUFFER_VARS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_DESTREG_DV1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_DRAWRECT_INFO
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_DESTREG_DR1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_DESTREG_DR2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_DESTREG_DR3
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|code
(braket
id|I810_DESTREG_DR4
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|i810EmitState
r_static
r_void
id|i810EmitState
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|I810_UPLOAD_BUFFERS
)paren
(brace
id|i810EmitDestVerified
c_func
(paren
id|dev
comma
id|sarea_priv-&gt;BufferState
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|I810_UPLOAD_BUFFERS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|I810_UPLOAD_CTX
)paren
(brace
id|i810EmitContextVerified
c_func
(paren
id|dev
comma
id|sarea_priv-&gt;ContextState
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|I810_UPLOAD_CTX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|I810_UPLOAD_TEX0
)paren
(brace
id|i810EmitTexVerified
c_func
(paren
id|dev
comma
id|sarea_priv-&gt;TexState
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|I810_UPLOAD_TEX0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|I810_UPLOAD_TEX1
)paren
(brace
id|i810EmitTexVerified
c_func
(paren
id|dev
comma
id|sarea_priv-&gt;TexState
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|I810_UPLOAD_TEX1
suffix:semicolon
)brace
)brace
multiline_comment|/* need to verify &n; */
DECL|function|i810_dma_dispatch_clear
r_static
r_void
id|i810_dma_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|flags
comma
r_int
r_int
id|clear_color
comma
r_int
r_int
id|clear_zval
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|pitch
op_assign
id|dev_priv-&gt;pitch
suffix:semicolon
r_int
id|cpp
op_assign
l_int|2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|i810_kernel_lost_context
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nbox
OG
id|I810_NR_SAREA_CLIPRECTS
)paren
id|nbox
op_assign
id|I810_NR_SAREA_CLIPRECTS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
comma
id|pbox
op_increment
)paren
(brace
r_int
r_int
id|x
op_assign
id|pbox-&gt;x1
suffix:semicolon
r_int
r_int
id|y
op_assign
id|pbox-&gt;y1
suffix:semicolon
r_int
r_int
id|width
op_assign
(paren
id|pbox-&gt;x2
op_minus
id|x
)paren
op_star
id|cpp
suffix:semicolon
r_int
r_int
id|height
op_assign
id|pbox-&gt;y2
op_minus
id|y
suffix:semicolon
r_int
r_int
id|start
op_assign
id|y
op_star
id|pitch
op_plus
id|x
op_star
id|cpp
suffix:semicolon
r_if
c_cond
(paren
id|pbox-&gt;x1
OG
id|pbox-&gt;x2
op_logical_or
id|pbox-&gt;y1
OG
id|pbox-&gt;y2
op_logical_or
id|pbox-&gt;x2
OG
id|dev_priv-&gt;w
op_logical_or
id|pbox-&gt;y2
OG
id|dev_priv-&gt;h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|I810_FRONT
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;clear front&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR00_BITBLT_CLIENT
op_or
id|BR00_OP_COLOR_BLT
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR13_SOLID_PATTERN
op_or
(paren
l_int|0xF0
op_lshift
l_int|16
)paren
op_or
id|pitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|width
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|I810_BACK
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;clear back&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR00_BITBLT_CLIENT
op_or
id|BR00_OP_COLOR_BLT
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR13_SOLID_PATTERN
op_or
(paren
l_int|0xF0
op_lshift
l_int|16
)paren
op_or
id|pitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|width
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_offset
op_plus
id|start
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|I810_DEPTH
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;clear depth&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR00_BITBLT_CLIENT
op_or
id|BR00_OP_COLOR_BLT
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR13_SOLID_PATTERN
op_or
(paren
l_int|0xF0
op_lshift
l_int|16
)paren
op_or
id|pitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|width
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;depth_offset
op_plus
id|start
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear_zval
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|i810_dma_dispatch_swap
r_static
r_void
id|i810_dma_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|pitch
op_assign
id|dev_priv-&gt;pitch
suffix:semicolon
r_int
id|cpp
op_assign
l_int|2
suffix:semicolon
r_int
id|ofs
op_assign
id|dev_priv-&gt;back_offset
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;swapbuffers&bslash;n&quot;
)paren
suffix:semicolon
id|i810_kernel_lost_context
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nbox
OG
id|I810_NR_SAREA_CLIPRECTS
)paren
id|nbox
op_assign
id|I810_NR_SAREA_CLIPRECTS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
comma
id|pbox
op_increment
)paren
(brace
r_int
r_int
id|w
op_assign
id|pbox-&gt;x2
op_minus
id|pbox-&gt;x1
suffix:semicolon
r_int
r_int
id|h
op_assign
id|pbox-&gt;y2
op_minus
id|pbox-&gt;y1
suffix:semicolon
r_int
r_int
id|dst
op_assign
id|pbox-&gt;x1
op_star
id|cpp
op_plus
id|pbox-&gt;y1
op_star
id|pitch
suffix:semicolon
r_int
r_int
id|start
op_assign
id|ofs
op_plus
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|pbox-&gt;x1
OG
id|pbox-&gt;x2
op_logical_or
id|pbox-&gt;y1
OG
id|pbox-&gt;y2
op_logical_or
id|pbox-&gt;x2
OG
id|dev_priv-&gt;w
op_logical_or
id|pbox-&gt;y2
OG
id|dev_priv-&gt;h
)paren
r_continue
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch swap %d,%d-%d,%d!&bslash;n&quot;
comma
id|pbox
(braket
id|i
)braket
dot
id|x1
comma
id|pbox
(braket
id|i
)braket
dot
id|y1
comma
id|pbox
(braket
id|i
)braket
dot
id|x2
comma
id|pbox
(braket
id|i
)braket
dot
id|y2
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|BR00_BITBLT_CLIENT
op_or
id|BR00_OP_SRC_COPY_BLT
op_or
l_int|0x4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|pitch
op_or
(paren
l_int|0xCC
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|h
op_lshift
l_int|16
)paren
op_or
(paren
id|w
op_star
id|cpp
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dst
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|pitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|i810_dma_dispatch_vertex
r_static
r_void
id|i810_dma_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
id|discard
comma
r_int
id|used
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_clip_rect_t
op_star
id|box
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
r_int
r_int
id|address
op_assign
(paren
r_int
r_int
)paren
id|buf-&gt;bus_address
suffix:semicolon
r_int
r_int
id|start
op_assign
id|address
op_minus
id|dev-&gt;agp-&gt;base
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|u
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|i810_kernel_lost_context
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nbox
OG
id|I810_NR_SAREA_CLIPRECTS
)paren
id|nbox
op_assign
id|I810_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|discard
)paren
(brace
id|u
op_assign
id|cmpxchg
c_func
(paren
id|buf_priv-&gt;in_use
comma
id|I810_BUF_CLIENT
comma
id|I810_BUF_HARDWARE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u
op_ne
id|I810_BUF_CLIENT
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;xxxx 2&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|used
OG
l_int|4
op_star
l_int|1024
)paren
id|used
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
)paren
id|i810EmitState
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch vertex addr 0x%lx, used 0x%x nbox %d&bslash;n&quot;
comma
id|address
comma
id|used
comma
id|nbox
)paren
suffix:semicolon
id|dev_priv-&gt;counter
op_increment
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch counter : %ld&bslash;n&quot;
comma
id|dev_priv-&gt;counter
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810_dma_dispatch&bslash;n&quot;
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;start : %lx&bslash;n&quot;
comma
id|start
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;used : %d&bslash;n&quot;
comma
id|used
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;start + used - 4 : %ld&bslash;n&quot;
comma
id|start
op_plus
id|used
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf_priv-&gt;currently_mapped
op_eq
id|I810_BUF_MAPPED
)paren
(brace
op_star
(paren
id|u32
op_star
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
op_assign
(paren
id|GFX_OP_PRIMITIVE
op_or
id|sarea_priv-&gt;vertex_prim
op_or
(paren
(paren
id|used
op_div
l_int|4
)paren
op_minus
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_amp
l_int|4
)paren
(brace
op_star
(paren
id|u32
op_star
)paren
(paren
(paren
id|u32
)paren
id|buf_priv
op_member_access_from_pointer
r_virtual
op_plus
id|used
)paren
op_assign
l_int|0
suffix:semicolon
id|used
op_add_assign
l_int|4
suffix:semicolon
)brace
id|i810_unmap_buffer
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|used
)paren
(brace
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|nbox
)paren
(brace
id|BEGIN_LP_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_SCISSOR
op_or
id|SC_UPDATE_SCISSOR
op_or
id|SC_ENABLE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_SCISSOR_INFO
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|box
(braket
id|i
)braket
dot
id|x1
op_or
(paren
id|box
(braket
id|i
)braket
dot
id|y1
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|box
(braket
id|i
)braket
dot
id|x2
op_minus
l_int|1
)paren
op_or
(paren
(paren
id|box
(braket
id|i
)braket
dot
id|y2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
id|BEGIN_LP_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CMD_OP_BATCH_BUFFER
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
id|BB1_PROTECTED
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_plus
id|used
op_minus
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|nbox
)paren
suffix:semicolon
)brace
id|BEGIN_LP_RING
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CMD_STORE_DWORD_IDX
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;counter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|discard
)paren
(brace
id|OUT_RING
c_func
(paren
id|CMD_STORE_DWORD_IDX
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|buf_priv-&gt;my_use_idx
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|I810_BUF_FREE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|OUT_RING
c_func
(paren
id|CMD_REPORT_HEAD
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Interrupts are only for flushing */
DECL|function|i810_dma_service
r_static
r_void
id|i810_dma_service
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|device
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|drm_device_t
op_star
id|dev
op_assign
(paren
id|drm_device_t
op_star
)paren
id|device
suffix:semicolon
id|u16
id|temp
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;total_irq
)paren
suffix:semicolon
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_IDENTITY_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
op_complement
(paren
l_int|0x6000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|0
)paren
(brace
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_IDENTITY_R
comma
id|temp
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear all interrupts */
r_else
r_return
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|dev-&gt;tq
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
DECL|function|i810_dma_task_queue
r_static
r_void
id|i810_dma_task_queue
c_func
(paren
r_void
op_star
id|device
)paren
(brace
id|drm_device_t
op_star
id|dev
op_assign
(paren
id|drm_device_t
op_star
)paren
id|device
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
comma
l_int|1
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
)paren
suffix:semicolon
)brace
DECL|function|i810_irq_install
r_int
id|i810_irq_install
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|irq
)paren
(brace
r_int
id|retcode
suffix:semicolon
id|u16
id|temp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
)paren
(brace
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;Interrupt Install : %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|dev-&gt;context_flag
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt_flag
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;dma_flag
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;dma-&gt;next_buffer
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;dma-&gt;next_queue
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;dma-&gt;this_buffer
op_assign
l_int|NULL
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|dev-&gt;tq.list
)paren
suffix:semicolon
id|dev-&gt;tq.sync
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tq.routine
op_assign
id|i810_dma_task_queue
suffix:semicolon
id|dev-&gt;tq.data
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Before installing handler */
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_HWSTAM
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
l_int|0x6000
suffix:semicolon
id|I810_WRITE16
c_func
(paren
id|I810REG_HWSTAM
comma
id|temp
)paren
suffix:semicolon
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_MASK_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
l_int|0x6000
suffix:semicolon
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_MASK_R
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Unmask interrupts */
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_ENABLE_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
l_int|0x6000
suffix:semicolon
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_ENABLE_R
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Disable all interrupts */
multiline_comment|/* Install handler */
r_if
c_cond
(paren
(paren
id|retcode
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|i810_dma_service
comma
id|SA_SHIRQ
comma
id|dev-&gt;devname
comma
id|dev
)paren
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_ENABLE_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
l_int|0x6000
suffix:semicolon
id|temp
op_assign
id|temp
op_or
l_int|0x0003
suffix:semicolon
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_ENABLE_R
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Enable bp &amp; user interrupts */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_irq_uninstall
r_int
id|i810_irq_uninstall
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
r_int
id|irq
suffix:semicolon
id|u16
id|temp
suffix:semicolon
multiline_comment|/*  &t;return 0; */
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
id|irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;Interrupt UnInstall: %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_IDENTITY_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
op_complement
(paren
l_int|0x6000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|0
)paren
(brace
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_IDENTITY_R
comma
id|temp
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear all interrupts */
id|temp
op_assign
id|I810_READ16
c_func
(paren
id|I810REG_INT_ENABLE_R
)paren
suffix:semicolon
id|temp
op_assign
id|temp
op_amp
l_int|0x6000
suffix:semicolon
id|I810_WRITE16
c_func
(paren
id|I810REG_INT_ENABLE_R
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Disable all interrupts */
id|free_irq
c_func
(paren
id|irq
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_control
r_int
id|i810_control
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_control_t
id|ctl
suffix:semicolon
r_int
id|retcode
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810_control&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ctl
comma
(paren
id|drm_control_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ctl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ctl.func
)paren
(brace
r_case
id|DRM_INST_HANDLER
suffix:colon
r_if
c_cond
(paren
(paren
id|retcode
op_assign
id|i810_irq_install
c_func
(paren
id|dev
comma
id|ctl.irq
)paren
)paren
)paren
r_return
id|retcode
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DRM_UNINST_HANDLER
suffix:colon
r_if
c_cond
(paren
(paren
id|retcode
op_assign
id|i810_irq_uninstall
c_func
(paren
id|dev
)paren
)paren
)paren
r_return
id|retcode
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_dma_emit_flush
r_static
r_inline
r_void
id|i810_dma_emit_flush
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|i810_kernel_lost_context
c_func
(paren
id|dev
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CMD_REPORT_HEAD
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_USER_INTERRUPT
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*  &t;i810_wait_ring( dev, dev_priv-&gt;ring.Size - 8 ); */
multiline_comment|/*     &t;atomic_set(&amp;dev_priv-&gt;flush_done, 1); */
multiline_comment|/*     &t;wake_up_interruptible(&amp;dev_priv-&gt;flush_queue); */
)brace
DECL|function|i810_dma_quiescent_emit
r_static
r_inline
r_void
id|i810_dma_quiescent_emit
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|i810_kernel_lost_context
c_func
(paren
id|dev
)paren
suffix:semicolon
id|BEGIN_LP_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|INST_PARSER_CLIENT
op_or
id|INST_OP_FLUSH
op_or
id|INST_FLUSH_MAP_CACHE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CMD_REPORT_HEAD
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|GFX_OP_USER_INTERRUPT
)paren
suffix:semicolon
id|ADVANCE_LP_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*  &t;i810_wait_ring( dev, dev_priv-&gt;ring.Size - 8 ); */
multiline_comment|/*     &t;atomic_set(&amp;dev_priv-&gt;flush_done, 1); */
multiline_comment|/*     &t;wake_up_interruptible(&amp;dev_priv-&gt;flush_queue); */
)brace
DECL|function|i810_dma_quiescent
r_static
r_void
id|i810_dma_quiescent
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|entry
comma
id|current
)paren
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
comma
l_int|0
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|i810_dma_quiescent_emit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
)paren
op_eq
l_int|1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|end
op_minus
id|jiffies
)paren
op_le
l_int|0
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;lockup&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule_timeout
c_func
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|i810_flush_queue
r_static
r_int
id|i810_flush_queue
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|entry
comma
id|current
)paren
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
comma
l_int|0
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|i810_dma_emit_flush
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|dev_priv-&gt;flush_done
)paren
op_eq
l_int|1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|end
op_minus
id|jiffies
)paren
op_le
l_int|0
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;lockup&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule_timeout
c_func
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINTR
suffix:semicolon
multiline_comment|/* Can&squot;t restart */
r_break
suffix:semicolon
)brace
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|dev_priv-&gt;flush_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_buf_t
op_star
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_int
id|used
op_assign
id|cmpxchg
c_func
(paren
id|buf_priv-&gt;in_use
comma
id|I810_BUF_HARDWARE
comma
id|I810_BUF_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_eq
id|I810_BUF_HARDWARE
)paren
id|DRM_DEBUG
c_func
(paren
l_string|&quot;reclaimed from HARDWARE&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_eq
id|I810_BUF_CLIENT
)paren
id|DRM_DEBUG
c_func
(paren
l_string|&quot;still on client HARDWARE&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Must be called with the lock held */
DECL|function|i810_reclaim_buffers
r_void
id|i810_reclaim_buffers
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|pid_t
id|pid
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dev_private
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;buflist
)paren
r_return
suffix:semicolon
id|i810_flush_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;buf_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_buf_t
op_star
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_eq
id|pid
op_logical_and
id|buf_priv
)paren
(brace
r_int
id|used
op_assign
id|cmpxchg
c_func
(paren
id|buf_priv-&gt;in_use
comma
id|I810_BUF_CLIENT
comma
id|I810_BUF_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used
op_eq
id|I810_BUF_CLIENT
)paren
id|DRM_DEBUG
c_func
(paren
l_string|&quot;reclaimed from client&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf_priv-&gt;currently_mapped
op_eq
id|I810_BUF_MAPPED
)paren
(brace
id|buf_priv-&gt;currently_mapped
op_assign
id|I810_BUF_UNMAPPED
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|i810_lock
r_int
id|i810_lock
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|entry
comma
id|current
)paren
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|drm_lock_t
id|lock
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|lock
comma
(paren
id|drm_lock_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|lock
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|lock.context
op_eq
id|DRM_KERNEL_CONTEXT
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Process %d using kernel context %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|lock.context
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d (pid %d) requests lock (0x%08x), flags = 0x%08x&bslash;n&quot;
comma
id|lock.context
comma
id|current-&gt;pid
comma
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|lock.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lock.context
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Only one queue:&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|add_wait_queue
c_func
(paren
op_amp
id|dev-&gt;lock.lock_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;lock.hw_lock
)paren
(brace
multiline_comment|/* Device has been unregistered */
id|ret
op_assign
op_minus
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|drm_lock_take
c_func
(paren
op_amp
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|lock.context
)paren
)paren
(brace
id|dev-&gt;lock.pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|dev-&gt;lock.lock_time
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;total_locks
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Got lock */
)brace
multiline_comment|/* Contention */
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;total_sleeps
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;Calling lock schedule&bslash;n&quot;
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|dev-&gt;lock.lock_queue
comma
op_amp
id|entry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|sigemptyset
c_func
(paren
op_amp
id|dev-&gt;sigmask
)paren
suffix:semicolon
id|sigaddset
c_func
(paren
op_amp
id|dev-&gt;sigmask
comma
id|SIGSTOP
)paren
suffix:semicolon
id|sigaddset
c_func
(paren
op_amp
id|dev-&gt;sigmask
comma
id|SIGTSTP
)paren
suffix:semicolon
id|sigaddset
c_func
(paren
op_amp
id|dev-&gt;sigmask
comma
id|SIGTTIN
)paren
suffix:semicolon
id|sigaddset
c_func
(paren
op_amp
id|dev-&gt;sigmask
comma
id|SIGTTOU
)paren
suffix:semicolon
id|dev-&gt;sigdata.context
op_assign
id|lock.context
suffix:semicolon
id|dev-&gt;sigdata.lock
op_assign
id|dev-&gt;lock.hw_lock
suffix:semicolon
id|block_all_signals
c_func
(paren
id|drm_notifier
comma
op_amp
id|dev-&gt;sigdata
comma
op_amp
id|dev-&gt;sigmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lock.flags
op_amp
id|_DRM_LOCK_QUIESCENT
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;_DRM_LOCK_QUIESCENT&bslash;n&quot;
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;fred&bslash;n&quot;
)paren
suffix:semicolon
id|i810_dma_quiescent
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d %s&bslash;n&quot;
comma
id|lock.context
comma
id|ret
ques
c_cond
l_string|&quot;interrupted&quot;
suffix:colon
l_string|&quot;has lock&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|i810_flush_ioctl
r_int
id|i810_flush_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810_flush_ioctl&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_flush_ioctl called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i810_flush_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_dma_vertex
r_int
id|i810_dma_vertex
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|u32
op_star
id|hw_status
op_assign
(paren
id|u32
op_star
)paren
id|dev_priv-&gt;hw_status_page
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
(paren
id|drm_i810_sarea_t
op_star
)paren
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_i810_vertex_t
id|vertex
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_i810_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_dma_vertex called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810 dma vertex, idx %d used %d discard %d&bslash;n&quot;
comma
id|vertex.idx
comma
id|vertex.used
comma
id|vertex.discard
)paren
suffix:semicolon
id|i810_dma_dispatch_vertex
c_func
(paren
id|dev
comma
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
comma
id|vertex.discard
comma
id|vertex.used
)paren
suffix:semicolon
id|atomic_add
c_func
(paren
id|vertex.used
comma
op_amp
id|dma-&gt;total_bytes
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dma-&gt;total_dmas
)paren
suffix:semicolon
id|sarea_priv-&gt;last_enqueue
op_assign
id|dev_priv-&gt;counter
op_minus
l_int|1
suffix:semicolon
id|sarea_priv-&gt;last_dispatch
op_assign
(paren
r_int
)paren
id|hw_status
(braket
l_int|5
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_clear_bufs
r_int
id|i810_clear_bufs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_i810_clear_t
id|clear
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clear
comma
(paren
id|drm_i810_clear_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clear
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_clear_bufs called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i810_dma_dispatch_clear
c_func
(paren
id|dev
comma
id|clear.flags
comma
id|clear.clear_color
comma
id|clear.clear_depth
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_swap_bufs
r_int
id|i810_swap_bufs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810_swap_bufs&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_swap_buf called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i810_dma_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_getage
r_int
id|i810_getage
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|u32
op_star
id|hw_status
op_assign
(paren
id|u32
op_star
)paren
id|dev_priv-&gt;hw_status_page
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
(paren
id|drm_i810_sarea_t
op_star
)paren
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|sarea_priv-&gt;last_dispatch
op_assign
(paren
r_int
)paren
id|hw_status
(braket
l_int|5
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_getbuf
r_int
id|i810_getbuf
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|drm_i810_dma_t
id|d
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|u32
op_star
id|hw_status
op_assign
(paren
id|u32
op_star
)paren
id|dev_priv-&gt;hw_status_page
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
(paren
id|drm_i810_sarea_t
op_star
)paren
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;getbuf&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|d
comma
(paren
id|drm_i810_dma_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_dma called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|d.granted
op_assign
l_int|0
suffix:semicolon
id|retcode
op_assign
id|i810_dma_get_buffer
c_func
(paren
id|dev
comma
op_amp
id|d
comma
id|filp
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;i810_dma: %d returning %d, granted = %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|retcode
comma
id|d.granted
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|drm_dma_t
op_star
)paren
id|arg
comma
op_amp
id|d
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|sarea_priv-&gt;last_dispatch
op_assign
(paren
r_int
)paren
id|hw_status
(braket
l_int|5
)braket
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|i810_copybuf
r_int
id|i810_copybuf
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_i810_copy_t
id|d
suffix:semicolon
id|drm_i810_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_i810_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|u32
op_star
id|hw_status
op_assign
(paren
id|u32
op_star
)paren
id|dev_priv-&gt;hw_status_page
suffix:semicolon
id|drm_i810_sarea_t
op_star
id|sarea_priv
op_assign
(paren
id|drm_i810_sarea_t
op_star
)paren
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_i810_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;i810_dma called without lock held&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|d
comma
(paren
id|drm_i810_copy_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|d.idx
OG
id|dma-&gt;buf_count
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|d.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf_priv-&gt;currently_mapped
op_ne
id|I810_BUF_MAPPED
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf_priv
op_member_access_from_pointer
r_virtual
comma
id|d.address
comma
id|d.used
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|sarea_priv-&gt;last_dispatch
op_assign
(paren
r_int
)paren
id|hw_status
(braket
l_int|5
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810_docopy
r_int
id|i810_docopy
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_if
c_cond
(paren
id|VM_DONTCOPY
op_eq
l_int|0
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
