multiline_comment|/*&n; *      Copyright (C) 1993-1996 Bas Laarhoven,&n; *                (C) 1996-1997 Claus-Justus Heine.&n;&n; This program is free software; you can redistribute it and/or modify&n; it under the terms of the GNU General Public License as published by&n; the Free Software Foundation; either version 2, or (at your option)&n; any later version.&n;&n; This program is distributed in the hope that it will be useful,&n; but WITHOUT ANY WARRANTY; without even the implied warranty of&n; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; GNU General Public License for more details.&n;&n; You should have received a copy of the GNU General Public License&n; along with this program; see the file COPYING.  If not, write to&n; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n; *&n; * $Source: /homes/cvs/ftape-stacked/ftape/lowlevel/ftape-tracing.c,v $&n; * $Revision: 1.2 $&n; * $Date: 1997/10/05 19:18:27 $&n; *&n; *      This file contains the reading code&n; *      for the QIC-117 floppy-tape driver for Linux.&n; */
macro_line|#include &lt;linux/ftape.h&gt;
macro_line|#include &quot;../lowlevel/ftape-tracing.h&quot;
multiline_comment|/*      Global vars.&n; */
multiline_comment|/*      tracing&n; *      set it to:     to log :&n; *       0              bugs&n; *       1              + errors&n; *       2              + warnings&n; *       3              + information&n; *       4              + more information&n; *       5              + program flow&n; *       6              + fdc/dma info&n; *       7              + data flow&n; *       8              + everything else&n; */
DECL|variable|ftape_tracing
id|ft_trace_t
id|ftape_tracing
op_assign
id|ft_t_info
suffix:semicolon
multiline_comment|/* Default level: information and up */
DECL|variable|ftape_function_nest_level
r_int
id|ftape_function_nest_level
suffix:semicolon
multiline_comment|/*      Local vars.&n; */
DECL|variable|trace_id
r_static
id|__u8
id|trace_id
suffix:semicolon
DECL|variable|spacing
r_static
r_char
id|spacing
(braket
)braket
op_assign
l_string|&quot;*                              &quot;
suffix:semicolon
DECL|function|ftape_trace_call
r_void
id|ftape_trace_call
c_func
(paren
r_const
r_char
op_star
id|file
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_char
op_star
id|indent
suffix:semicolon
multiline_comment|/*    Since printk seems not to work with &quot;%*s&quot; format&n;&t; *    we&squot;ll use this work-around.&n;&t; */
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;function nest level (%d) &lt; 0&bslash;n&quot;
comma
id|ftape_function_nest_level
)paren
suffix:semicolon
id|ftape_function_nest_level
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
r_sizeof
(paren
id|spacing
)paren
)paren
(brace
id|indent
op_assign
(paren
id|spacing
op_plus
r_sizeof
(paren
id|spacing
)paren
op_minus
l_int|1
op_minus
id|ftape_function_nest_level
)paren
suffix:semicolon
)brace
r_else
(brace
id|indent
op_assign
id|spacing
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;[%03d]%s+%s (%s)&bslash;n&quot;
comma
(paren
r_int
)paren
id|trace_id
op_increment
comma
id|indent
comma
id|file
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|ftape_trace_exit
r_void
id|ftape_trace_exit
c_func
(paren
r_const
r_char
op_star
id|file
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_char
op_star
id|indent
suffix:semicolon
multiline_comment|/*    Since printk seems not to work with &quot;%*s&quot; format&n;&t; *    we&squot;ll use this work-around.&n;&t; */
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;function nest level (%d) &lt; 0&bslash;n&quot;
comma
id|ftape_function_nest_level
)paren
suffix:semicolon
id|ftape_function_nest_level
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
r_sizeof
(paren
id|spacing
)paren
)paren
(brace
id|indent
op_assign
(paren
id|spacing
op_plus
r_sizeof
(paren
id|spacing
)paren
op_minus
l_int|1
op_minus
id|ftape_function_nest_level
)paren
suffix:semicolon
)brace
r_else
(brace
id|indent
op_assign
id|spacing
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;[%03d]%s-%s (%s)&bslash;n&quot;
comma
(paren
r_int
)paren
id|trace_id
op_increment
comma
id|indent
comma
id|file
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|ftape_trace_log
r_void
id|ftape_trace_log
c_func
(paren
r_const
r_char
op_star
id|file
comma
r_const
r_char
op_star
id|function
)paren
(brace
r_char
op_star
id|indent
suffix:semicolon
multiline_comment|/*    Since printk seems not to work with &quot;%*s&quot; format&n;&t; *    we&squot;ll use this work-around.&n;&t; */
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;function nest level (%d) &lt; 0&bslash;n&quot;
comma
id|ftape_function_nest_level
)paren
suffix:semicolon
id|ftape_function_nest_level
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ftape_function_nest_level
OL
r_sizeof
(paren
id|spacing
)paren
)paren
(brace
id|indent
op_assign
(paren
id|spacing
op_plus
r_sizeof
(paren
id|spacing
)paren
op_minus
l_int|1
op_minus
id|ftape_function_nest_level
)paren
suffix:semicolon
)brace
r_else
(brace
id|indent
op_assign
id|spacing
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;[%03d]%s%s (%s) - &quot;
comma
(paren
r_int
)paren
id|trace_id
op_increment
comma
id|indent
comma
id|file
comma
id|function
)paren
suffix:semicolon
)brace
eof
