multiline_comment|/* &n; * Copyright (C) 1996, 1997 Claus-Justus Heine.&n;&n; This program is free software; you can redistribute it and/or modify&n; it under the terms of the GNU General Public License as published by&n; the Free Software Foundation; either version 2, or (at your option)&n; any later version.&n;&n; This program is distributed in the hope that it will be useful,&n; but WITHOUT ANY WARRANTY; without even the implied warranty of&n; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; GNU General Public License for more details.&n;&n; You should have received a copy of the GNU General Public License&n; along with this program; see the file COPYING.  If not, write to&n; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n; *&n; * $Source: /homes/cvs/ftape-stacked/ftape/lowlevel/ftape-setup.c,v $&n; * $Revision: 1.7 $&n; * $Date: 1997/10/10 09:57:06 $&n; *&n; *      This file contains the code for processing the kernel command&n; *      line options for the QIC-40/80/3010/3020 floppy-tape driver&n; *      &quot;ftape&quot; for Linux.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/ftape.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VER(2,1,16)
macro_line|#include &lt;linux/init.h&gt;
macro_line|#else
DECL|macro|__initdata
mdefine_line|#define __initdata
DECL|macro|__initfunc
mdefine_line|#define __initfunc(__arg) __arg
macro_line|#endif
macro_line|#include &quot;../lowlevel/ftape-tracing.h&quot;
macro_line|#include &quot;../lowlevel/fdc-io.h&quot;
DECL|struct|param_table
r_static
r_struct
id|param_table
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|var
r_int
op_star
id|var
suffix:semicolon
DECL|member|def_param
r_int
id|def_param
suffix:semicolon
DECL|member|min
r_int
id|min
suffix:semicolon
DECL|member|max
r_int
id|max
suffix:semicolon
DECL|variable|__initdata
)brace
id|config_params
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifndef CONFIG_FT_NO_TRACE_AT_ALL
(brace
l_string|&quot;tracing&quot;
comma
op_amp
id|ftape_tracing
comma
l_int|3
comma
id|ft_t_bug
comma
id|ft_t_any
)brace
comma
macro_line|#endif
(brace
l_string|&quot;ioport&quot;
comma
op_amp
id|ft_fdc_base
comma
id|CONFIG_FT_FDC_BASE
comma
l_int|0x0
comma
l_int|0xfff
)brace
comma
(brace
l_string|&quot;irq&quot;
comma
op_amp
id|ft_fdc_irq
comma
id|CONFIG_FT_FDC_IRQ
comma
l_int|2
comma
l_int|15
)brace
comma
(brace
l_string|&quot;dma&quot;
comma
op_amp
id|ft_fdc_dma
comma
id|CONFIG_FT_FDC_DMA
comma
l_int|0
comma
l_int|3
)brace
comma
(brace
l_string|&quot;threshold&quot;
comma
op_amp
id|ft_fdc_threshold
comma
id|CONFIG_FT_FDC_THR
comma
l_int|1
comma
l_int|16
)brace
comma
(brace
l_string|&quot;datarate&quot;
comma
op_amp
id|ft_fdc_rate_limit
comma
id|CONFIG_FT_FDC_MAX_RATE
comma
l_int|500
comma
l_int|2000
)brace
comma
(brace
l_string|&quot;fc10&quot;
comma
op_amp
id|ft_probe_fc10
comma
id|CONFIG_FT_PROBE_FC10
comma
l_int|0
comma
l_int|1
)brace
comma
(brace
l_string|&quot;mach2&quot;
comma
op_amp
id|ft_mach2
comma
id|CONFIG_FT_MACH2
comma
l_int|0
comma
l_int|1
)brace
)brace
suffix:semicolon
DECL|function|ftape_setup
r_static
r_int
id|__init
id|ftape_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|param
suffix:semicolon
r_int
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|TRACE_FUN
c_func
(paren
id|ft_t_flow
)paren
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
id|ARRAY_SIZE
c_func
(paren
id|ints
)paren
comma
id|ints
)paren
suffix:semicolon
r_if
c_cond
(paren
id|str
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_ITEMS
c_func
(paren
id|config_params
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|str
comma
id|config_params
(braket
id|i
)braket
dot
id|name
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
id|param
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
(brace
id|param
op_assign
id|config_params
(braket
id|i
)braket
dot
id|def_param
suffix:semicolon
)brace
r_if
c_cond
(paren
id|param
template_param
id|config_params
(braket
id|i
)braket
dot
id|max
)paren
(brace
id|TRACE
c_func
(paren
id|ft_t_err
comma
l_string|&quot;parameter %s out of range %d ... %d&quot;
comma
id|config_params
(braket
id|i
)braket
dot
id|name
comma
id|config_params
(braket
id|i
)braket
dot
id|min
comma
id|config_params
(braket
id|i
)braket
dot
id|max
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|config_params
(braket
id|i
)braket
dot
id|var
)paren
(brace
id|TRACE
c_func
(paren
id|ft_t_info
comma
l_string|&quot;%s=%d&quot;
comma
id|str
comma
id|param
)paren
suffix:semicolon
op_star
id|config_params
(braket
id|i
)braket
dot
id|var
op_assign
id|param
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|str
)paren
(brace
id|TRACE
c_func
(paren
id|ft_t_err
comma
l_string|&quot;unknown ftape option [%s]&quot;
comma
id|str
)paren
suffix:semicolon
id|TRACE
c_func
(paren
id|ft_t_err
comma
l_string|&quot;allowed options are:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_ITEMS
c_func
(paren
id|config_params
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|TRACE
c_func
(paren
id|ft_t_err
comma
l_string|&quot; %s&quot;
comma
id|config_params
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|TRACE
c_func
(paren
id|ft_t_err
comma
l_string|&quot;botched ftape option&quot;
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|TRACE_EXIT
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;ftape=&quot;
comma
id|ftape_setup
)paren
suffix:semicolon
eof
