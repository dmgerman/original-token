multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *      modem.c  --  Linux soundcard HF FSK driver,&n; *                   Modem code.&n; *&n; *      Copyright (C) 1997  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *        Swiss Federal Institute of Technology (ETH), Electronics Lab&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/hfmodem.h&gt;
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * currently this module is supposed to support both module styles, i.e.&n; * the old one present up to about 2.1.9, and the new one functioning&n; * starting with 2.1.21. The reason is I have a kit allowing to compile&n; * this module also under 2.0.x which was requested by several people.&n; * This will go in 2.2&n; */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= 0x20100
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#else
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
DECL|macro|put_user
macro_line|#undef put_user
DECL|macro|get_user
macro_line|#undef get_user
DECL|macro|put_user
mdefine_line|#define put_user(x,ptr) ({ __put_user((unsigned long)(x),(ptr),sizeof(*(ptr))); 0; })
DECL|macro|get_user
mdefine_line|#define get_user(x,ptr) ({ x = ((__typeof__(*(ptr)))__get_user((ptr),sizeof(*(ptr)))); 0; })
DECL|function|copy_from_user
r_extern
r_inline
r_int
id|copy_from_user
c_func
(paren
r_void
op_star
id|to
comma
r_const
r_void
op_star
id|from
comma
r_int
r_int
id|n
)paren
(brace
r_int
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|from
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|memcpy_fromfs
c_func
(paren
id|to
comma
id|from
comma
id|n
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|copy_to_user
r_extern
r_inline
r_int
id|copy_to_user
c_func
(paren
r_void
op_star
id|to
comma
r_const
r_void
op_star
id|from
comma
r_int
r_int
id|n
)paren
(brace
r_int
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|to
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|to
comma
id|from
comma
id|n
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= 0x20123
macro_line|#include &lt;linux/init.h&gt;
macro_line|#else
DECL|macro|__init
mdefine_line|#define __init
DECL|macro|__initdata
mdefine_line|#define __initdata
DECL|macro|__initfunc
mdefine_line|#define __initfunc(x) x
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|hfmodem_correlator_cache
r_struct
id|hfmodem_correlator_cache
id|hfmodem_correlator_cache
(braket
id|HFMODEM_CORRELATOR_CACHE
)braket
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#include &quot;tables.h&quot;
DECL|macro|M_PI
mdefine_line|#define M_PI        3.14159265358979323846      /* pi */
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|isimplecos
r_extern
id|__inline__
r_int
id|isimplecos
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_return
id|isintab
(braket
(paren
(paren
id|arg
op_plus
l_int|0x4000
)paren
op_rshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
op_amp
(paren
id|SINTABSIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
)brace
DECL|function|isimplesin
r_extern
id|__inline__
r_int
id|isimplesin
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_return
id|isintab
(braket
(paren
id|arg
op_rshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
op_amp
(paren
id|SINTABSIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|itblcos
r_extern
id|__inline__
r_int
id|itblcos
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|x
suffix:semicolon
r_int
id|dx
suffix:semicolon
r_int
id|s
comma
id|c
suffix:semicolon
id|x
op_assign
(paren
id|arg
op_plus
(paren
l_int|0x8000
op_rshift
id|SINTABBITS
)paren
)paren
op_amp
(paren
l_int|0xffffu
op_amp
(paren
l_int|0xffffu
op_lshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
)paren
suffix:semicolon
id|dx
op_assign
id|arg
op_minus
id|x
suffix:semicolon
id|x
op_rshift_assign
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
suffix:semicolon
id|c
op_assign
id|isintab
(braket
id|x
op_plus
(paren
l_int|0x4000
op_rshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
)braket
suffix:semicolon
id|s
op_assign
id|isintab
(braket
id|x
)braket
suffix:semicolon
r_return
id|c
op_minus
(paren
(paren
id|s
op_star
id|dx
op_star
(paren
r_int
)paren
(paren
id|M_PI
op_star
l_float|64.0
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|itblcossin
r_extern
id|__inline__
r_void
id|itblcossin
c_func
(paren
r_int
r_int
id|arg
comma
r_int
op_star
id|cos
comma
r_int
op_star
id|sin
)paren
(brace
r_int
r_int
id|x
suffix:semicolon
r_int
id|dx
suffix:semicolon
r_int
id|s
comma
id|c
suffix:semicolon
id|x
op_assign
(paren
id|arg
op_plus
(paren
l_int|0x8000
op_rshift
id|SINTABBITS
)paren
)paren
op_amp
(paren
l_int|0xffffu
op_amp
(paren
l_int|0xffffu
op_lshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
)paren
suffix:semicolon
id|dx
op_assign
id|arg
op_minus
id|x
suffix:semicolon
id|x
op_rshift_assign
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
suffix:semicolon
id|c
op_assign
id|isintab
(braket
id|x
op_plus
(paren
l_int|0x4000
op_rshift
(paren
l_int|16
op_minus
id|SINTABBITS
)paren
)paren
)braket
suffix:semicolon
id|s
op_assign
id|isintab
(braket
id|x
)braket
suffix:semicolon
op_star
id|cos
op_assign
id|c
op_minus
(paren
(paren
id|s
op_star
id|dx
op_star
(paren
r_int
)paren
(paren
id|M_PI
op_star
l_float|64.0
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
op_star
id|sin
op_assign
id|s
op_plus
(paren
(paren
id|c
op_star
id|dx
op_star
(paren
r_int
)paren
(paren
id|M_PI
op_star
l_float|64.0
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|random_seed
r_static
r_int
r_int
id|random_seed
suffix:semicolon
DECL|function|random_num
r_extern
id|__inline__
r_int
r_int
id|random_num
c_func
(paren
r_void
)paren
(brace
id|random_seed
op_assign
l_int|28629
op_star
id|random_seed
op_plus
l_int|157
suffix:semicolon
r_return
id|random_seed
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * correlator cache routines&n; */
DECL|function|cc_lock
r_extern
id|__inline__
r_void
id|cc_lock
c_func
(paren
r_int
r_int
id|u
)paren
(brace
r_if
c_cond
(paren
id|u
op_ge
id|HFMODEM_CORRELATOR_CACHE
)paren
r_return
suffix:semicolon
id|hfmodem_correlator_cache
(braket
id|u
)braket
dot
id|refcnt
op_increment
suffix:semicolon
)brace
DECL|function|cc_unlock
r_extern
id|__inline__
r_void
id|cc_unlock
c_func
(paren
r_int
r_int
id|u
)paren
(brace
r_if
c_cond
(paren
id|u
op_ge
id|HFMODEM_CORRELATOR_CACHE
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
op_decrement
id|hfmodem_correlator_cache
(braket
id|u
)braket
dot
id|refcnt
)paren
op_le
l_int|0
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|hfmodem_correlator_cache
(braket
id|i
)braket
dot
id|lru
OL
l_int|32767
)paren
id|hfmodem_correlator_cache
(braket
id|i
)braket
dot
id|lru
op_increment
suffix:semicolon
id|hfmodem_correlator_cache
(braket
id|u
)braket
dot
id|lru
op_assign
l_int|0
suffix:semicolon
id|hfmodem_correlator_cache
(braket
id|u
)braket
dot
id|refcnt
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|cc_lookup
r_extern
id|__inline__
r_int
r_int
id|cc_lookup
c_func
(paren
r_int
r_int
id|phinc0
comma
r_int
r_int
id|phinc1
)paren
(brace
r_int
r_int
id|j
suffix:semicolon
multiline_comment|/* find correlator cache entry */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|0
)braket
op_eq
id|phinc0
op_logical_and
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|1
)braket
op_eq
id|phinc1
)paren
r_return
id|j
suffix:semicolon
r_return
op_complement
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|cc_replace
r_extern
id|__inline__
r_int
r_int
id|cc_replace
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|j
comma
id|k
op_assign
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
r_int
id|l
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|refcnt
op_le
l_int|0
op_logical_and
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|lru
OG
id|l
)paren
(brace
id|k
op_assign
id|j
suffix:semicolon
id|l
op_assign
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|lru
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
OL
id|HFMODEM_CORRELATOR_CACHE
)paren
r_return
id|k
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: modem: out of filter coefficient cache entries&bslash;n&quot;
comma
id|hfmodem_drvname
)paren
suffix:semicolon
r_return
id|random_num
c_func
(paren
)paren
op_mod
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|SH1
mdefine_line|#define SH1  8     /* min. ceil(log2(L1CORR_LEN)) - (31-(2*15-1)) */
DECL|macro|SH2
mdefine_line|#define SH2  (3*15-2*SH1)
macro_line|#ifdef __i386__
DECL|function|icorr
r_extern
id|__inline__
r_int
id|icorr
c_func
(paren
r_int
id|n
comma
r_const
r_int
op_star
id|coeff
comma
r_const
r_int
op_star
id|inp
)paren
(brace
r_int
id|ret
comma
id|rethi
comma
id|tmp1
op_assign
l_int|0
comma
id|tmp2
op_assign
l_int|0
suffix:semicolon
id|__asm__
c_func
(paren
l_string|&quot;&bslash;n1:&bslash;n&bslash;t&quot;
l_string|&quot;movswl (%0),%%eax&bslash;n&bslash;t&quot;
l_string|&quot;imull (%1)&bslash;n&bslash;t&quot;
l_string|&quot;subl $2,%0&bslash;n&bslash;t&quot;
l_string|&quot;addl $4,%1&bslash;n&bslash;t&quot;
l_string|&quot;addl %%eax,%3&bslash;n&bslash;t&quot;
l_string|&quot;adcl %%edx,%4&bslash;n&bslash;t&quot;
l_string|&quot;decl %2&bslash;n&bslash;t&quot;
l_string|&quot;jne 1b&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;S&quot;
(paren
id|inp
)paren
comma
l_string|&quot;=&amp;D&quot;
(paren
id|coeff
)paren
comma
l_string|&quot;=&amp;c&quot;
(paren
id|n
)paren
comma
l_string|&quot;=m&quot;
(paren
id|tmp1
)paren
comma
l_string|&quot;=m&quot;
(paren
id|tmp2
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|inp
)paren
comma
l_string|&quot;1&quot;
(paren
id|coeff
)paren
comma
l_string|&quot;2&quot;
(paren
id|n
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;dx&quot;
)paren
suffix:semicolon
id|__asm__
c_func
(paren
l_string|&quot;shrdl %2,%1,%0&bslash;n&bslash;t&quot;
l_string|&quot;# sarl %2,%1&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|ret
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|rethi
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|SH1
)paren
comma
l_string|&quot;0&quot;
(paren
id|tmp1
)paren
comma
l_string|&quot;1&quot;
(paren
id|tmp2
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#else /* __i386__ */
DECL|function|icorr
r_extern
id|__inline__
r_int
id|icorr
c_func
(paren
r_int
id|n
comma
r_const
r_int
op_star
id|coeff
comma
r_const
r_int
op_star
id|inp
)paren
(brace
r_int
r_int
id|sum
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|n
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|coeff
op_increment
comma
id|inp
op_decrement
)paren
id|sum
op_add_assign
(paren
op_star
id|coeff
)paren
op_star
(paren
op_star
id|inp
)paren
suffix:semicolon
id|sum
op_rshift_assign
id|SH1
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
macro_line|#endif /* __i386__ */
multiline_comment|/* --------------------------------------------------------------------- */
r_extern
id|__inline__
r_int
r_int
id|isqr
c_func
(paren
r_int
id|x
)paren
id|__attribute__
(paren
(paren
r_const
)paren
)paren
suffix:semicolon
DECL|function|isqr
r_extern
id|__inline__
r_int
r_int
id|isqr
c_func
(paren
r_int
id|x
)paren
(brace
r_return
(paren
(paren
r_int
r_int
)paren
id|x
)paren
op_star
(paren
(paren
r_int
r_int
)paren
id|x
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|do_filter
r_extern
id|__inline__
id|hfmodem_soft_t
id|do_filter
c_func
(paren
r_struct
id|hfmodem_l1_rxslot
op_star
id|slot
comma
r_int
op_star
id|s
)paren
(brace
r_int
r_int
id|cc
op_assign
id|slot-&gt;corr_cache
suffix:semicolon
r_int
r_int
id|ll
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ge
id|HFMODEM_CORRELATOR_CACHE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;do_filter: correlator cache index overrange&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ll
op_assign
id|isqr
c_func
(paren
id|icorr
c_func
(paren
id|slot-&gt;corrlen
comma
id|hfmodem_correlator_cache
(braket
id|cc
)braket
dot
id|correlator
(braket
l_int|1
)braket
(braket
l_int|0
)braket
comma
id|s
)paren
)paren
op_plus
id|isqr
c_func
(paren
id|icorr
c_func
(paren
id|slot-&gt;corrlen
comma
id|hfmodem_correlator_cache
(braket
id|cc
)braket
dot
id|correlator
(braket
l_int|1
)braket
(braket
l_int|1
)braket
comma
id|s
)paren
)paren
op_minus
id|isqr
c_func
(paren
id|icorr
c_func
(paren
id|slot-&gt;corrlen
comma
id|hfmodem_correlator_cache
(braket
id|cc
)braket
dot
id|correlator
(braket
l_int|0
)braket
(braket
l_int|0
)braket
comma
id|s
)paren
)paren
op_minus
id|isqr
c_func
(paren
id|icorr
c_func
(paren
id|slot-&gt;corrlen
comma
id|hfmodem_correlator_cache
(braket
id|cc
)braket
dot
id|correlator
(braket
l_int|0
)braket
(braket
l_int|1
)braket
comma
id|s
)paren
)paren
suffix:semicolon
id|ll
op_rshift_assign
id|SH2
suffix:semicolon
r_return
(paren
id|ll
op_star
id|slot-&gt;scale
)paren
op_rshift
l_int|23
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|cc_prepare
r_static
r_void
id|cc_prepare
c_func
(paren
r_struct
id|hfmodem_l1_rxslot
op_star
id|slot
comma
r_int
r_int
id|phinc0
comma
r_int
r_int
id|phinc1
)paren
(brace
r_int
r_int
id|j
comma
id|k
comma
id|l
comma
id|ph
comma
id|phinc
suffix:semicolon
id|slot-&gt;scale
op_assign
(paren
l_int|1
op_lshift
l_int|23
)paren
op_div
(paren
id|slot-&gt;corrlen
op_star
id|slot-&gt;corrlen
)paren
suffix:semicolon
id|j
op_assign
id|cc_lookup
c_func
(paren
id|phinc0
comma
id|phinc1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
id|HFMODEM_CORRELATOR_CACHE
)paren
(brace
id|j
op_assign
id|cc_replace
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* calculate the correlator values */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: corr cache calc: %u  phases: 0x%04x 0x%04x&bslash;n&quot;
comma
id|hfmodem_drvname
comma
id|j
comma
id|phinc0
comma
id|phinc1
)paren
suffix:semicolon
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|0
)braket
op_assign
id|phinc0
suffix:semicolon
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|1
)braket
op_assign
id|phinc1
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|2
suffix:semicolon
id|k
op_increment
)paren
(brace
id|phinc
op_assign
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
id|k
)braket
suffix:semicolon
r_for
c_loop
(paren
id|ph
op_assign
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
id|HFMODEM_MAXCORRLEN
suffix:semicolon
id|l
op_increment
comma
id|ph
op_assign
(paren
id|ph
op_plus
id|phinc
)paren
op_amp
l_int|0xffff
)paren
id|itblcossin
c_func
(paren
id|ph
comma
op_amp
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
id|k
)braket
(braket
l_int|0
)braket
(braket
id|l
)braket
comma
op_amp
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
id|k
)braket
(braket
l_int|1
)braket
(braket
id|l
)braket
)paren
suffix:semicolon
)brace
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|refcnt
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: corr: %u ph: 0x%04x 0x%04x&bslash;n&quot;
comma
id|hfmodem_drvname
comma
id|j
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|0
)braket
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|phase_incs
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
id|HFMODEM_MAXCORRLEN
suffix:semicolon
id|l
op_increment
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: corr: %6d %6d %6d %6d&bslash;n&quot;
comma
id|hfmodem_drvname
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
l_int|0
)braket
(braket
l_int|0
)braket
(braket
id|l
)braket
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
l_int|0
)braket
(braket
l_int|1
)braket
(braket
id|l
)braket
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
l_int|1
)braket
(braket
l_int|0
)braket
(braket
id|l
)braket
comma
id|hfmodem_correlator_cache
(braket
id|j
)braket
dot
id|correlator
(braket
l_int|1
)braket
(braket
l_int|1
)braket
(braket
id|l
)braket
)paren
suffix:semicolon
macro_line|#endif
)brace
id|slot-&gt;corr_cache
op_assign
id|j
suffix:semicolon
id|cc_lock
c_func
(paren
id|j
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_clear_rq
r_void
id|hfmodem_clear_rq
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_unused
)paren
r_continue
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_assign
id|ss_unused
suffix:semicolon
id|kfree_s
c_func
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|data
comma
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|nbits
op_star
r_sizeof
(paren
id|hfmodem_soft_t
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_unused
)paren
r_continue
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_assign
id|ss_unused
suffix:semicolon
id|kfree_s
c_func
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|data
comma
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|nbits
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_CORRELATOR_CACHE
suffix:semicolon
id|i
op_increment
)paren
id|hfmodem_correlator_cache
(braket
id|i
)braket
dot
id|refcnt
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_ioctl
r_int
id|hfmodem_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|hfmodem_state
op_star
id|dev
op_assign
op_amp
id|hfmodem_state
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|hfmodem_ioctl_fsk_tx_request
id|txrq
suffix:semicolon
r_struct
id|hfmodem_ioctl_fsk_rx_request
id|rxrq
suffix:semicolon
r_struct
id|hfmodem_ioctl_mixer_params
id|mix
suffix:semicolon
r_struct
id|hfmodem_ioctl_sample_params
id|spar
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_int
id|ret
comma
id|i
comma
id|idx
suffix:semicolon
r_void
op_star
id|data
comma
op_star
id|userdata
suffix:semicolon
id|hfmodem_id_t
id|id
suffix:semicolon
id|hfmodem_time_t
id|tm
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|HFMODEM_IOCTL_FSKTXREQUEST
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|txrq
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|txrq
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|txrq.nbits
OG
id|HFMODEM_MAXBITS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len
op_assign
(paren
id|txrq.nbits
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|data
comma
id|txrq.data
comma
id|len
)paren
)paren
(brace
id|kfree_s
c_func
(paren
id|data
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
op_logical_and
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|HFMODEM_NUMTXSLOTS
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|data
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_assign
id|ss_ready
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|tstart
op_assign
id|txrq.tstart
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|tinc
op_assign
id|txrq.tinc
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|data
op_assign
id|data
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|nbits
op_assign
id|txrq.nbits
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|cntbits
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|inv
op_assign
id|txrq.inv
ques
c_cond
l_int|0xff
suffix:colon
l_int|0
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|id
op_assign
id|txrq.id
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|phase_incs
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|txrq.freq
(braket
l_int|0
)braket
op_star
l_int|0x10000
op_plus
(paren
id|HFMODEM_SRATE
op_div
l_int|2
)paren
)paren
op_div
id|HFMODEM_SRATE
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|phase_incs
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|txrq.freq
(braket
l_int|1
)braket
op_star
l_int|0x10000
op_plus
(paren
id|HFMODEM_SRATE
op_div
l_int|2
)paren
)paren
op_div
id|HFMODEM_SRATE
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HFMODEM_IOCTL_FSKRXREQUEST
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|rxrq
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|rxrq
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|rxrq.nbits
OG
id|HFMODEM_MAXBITS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|rxrq.baud
template_param
id|HFMODEM_MAXBAUD
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len
op_assign
id|rxrq.nbits
op_star
r_sizeof
(paren
id|hfmodem_soft_t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|rxrq.data
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
op_logical_and
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|HFMODEM_NUMRXSLOTS
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|data
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_assign
id|ss_ready
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|tstart
op_assign
id|rxrq.tstart
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|tinc
op_assign
id|rxrq.tinc
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|data
op_assign
id|data
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|userdata
op_assign
id|rxrq.data
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|nbits
op_assign
id|rxrq.nbits
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|cntbits
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|id
op_assign
id|rxrq.id
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|corrlen
op_assign
id|HFMODEM_SRATE
op_div
id|rxrq.baud
suffix:semicolon
id|cc_prepare
c_func
(paren
id|dev-&gt;l1.rxslots
op_plus
id|i
comma
(paren
(paren
id|rxrq.freq
(braket
l_int|0
)braket
op_star
l_int|0x10000
op_plus
(paren
id|HFMODEM_SRATE
op_div
l_int|2
)paren
)paren
op_div
id|HFMODEM_SRATE
)paren
op_amp
l_int|0xffff
comma
(paren
(paren
id|rxrq.freq
(braket
l_int|1
)braket
op_star
l_int|0x10000
op_plus
(paren
id|HFMODEM_SRATE
op_div
l_int|2
)paren
)paren
op_div
id|HFMODEM_SRATE
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HFMODEM_IOCTL_CLEARRQ
suffix:colon
id|hfmodem_clear_rq
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HFMODEM_IOCTL_GETCURTIME
suffix:colon
r_return
id|put_user
c_func
(paren
id|dev-&gt;l1.last_time
op_plus
l_int|20000L
comma
(paren
id|hfmodem_time_t
op_star
)paren
id|arg
)paren
suffix:semicolon
multiline_comment|/* heuristic */
r_case
id|HFMODEM_IOCTL_WAITRQ
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
op_minus
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_unused
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_retired
)paren
(brace
id|ret
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
template_param
l_int|0
)paren
(brace
id|idx
op_assign
id|i
suffix:semicolon
id|tm
op_assign
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|tstart
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|idx
op_ge
l_int|0
)paren
(brace
id|cc_unlock
c_func
(paren
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|corr_cache
)paren
suffix:semicolon
id|id
op_assign
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|id
suffix:semicolon
id|data
op_assign
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|data
suffix:semicolon
id|userdata
op_assign
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|userdata
suffix:semicolon
id|len
op_assign
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|nbits
op_star
r_sizeof
(paren
id|hfmodem_soft_t
)paren
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|idx
)braket
dot
id|state
op_assign
id|ss_unused
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|copy_to_user
c_func
(paren
id|userdata
comma
id|data
comma
id|len
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|data
comma
id|len
)paren
suffix:semicolon
r_return
(paren
id|put_user
c_func
(paren
id|id
comma
(paren
id|hfmodem_id_t
op_star
)paren
id|arg
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
id|ret
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
op_minus
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_unused
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_retired
)paren
(brace
id|ret
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
template_param
l_int|0
)paren
(brace
id|idx
op_assign
id|i
suffix:semicolon
id|tm
op_assign
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|tstart
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|idx
op_ge
l_int|0
)paren
(brace
id|id
op_assign
id|dev-&gt;l1.txslots
(braket
id|idx
)braket
dot
id|id
suffix:semicolon
id|data
op_assign
id|dev-&gt;l1.txslots
(braket
id|idx
)braket
dot
id|data
suffix:semicolon
id|len
op_assign
(paren
id|dev-&gt;l1.txslots
(braket
id|idx
)braket
dot
id|nbits
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|idx
)braket
dot
id|state
op_assign
id|ss_unused
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|data
comma
id|len
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|id
comma
(paren
id|hfmodem_id_t
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
op_minus
id|EAGAIN
suffix:colon
op_minus
id|EPIPE
suffix:semicolon
r_case
id|HFMODEM_IOCTL_MIXERPARAMS
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|mix
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|mix
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|dev-&gt;scops
op_member_access_from_pointer
id|mixer
c_func
(paren
id|dev
comma
id|mix.src
comma
id|mix.igain
comma
id|mix.ogain
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HFMODEM_IOCTL_SAMPLESTART
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;sbuf.kbuf
)paren
id|kfree_s
c_func
(paren
id|dev-&gt;sbuf.kbuf
comma
id|dev-&gt;sbuf.size
)paren
suffix:semicolon
id|dev-&gt;sbuf.kbuf
op_assign
id|dev-&gt;sbuf.kptr
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;sbuf.size
op_assign
id|dev-&gt;sbuf.rem
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|spar
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|spar
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|spar.len
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|spar.len
template_param
l_int|8192
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|spar.data
comma
id|spar.len
op_star
r_sizeof
(paren
id|__s16
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;sbuf.kbuf
op_assign
id|kmalloc
c_func
(paren
id|spar.len
op_star
r_sizeof
(paren
id|__s16
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;sbuf.kptr
op_assign
id|dev-&gt;sbuf.kbuf
suffix:semicolon
id|dev-&gt;sbuf.size
op_assign
id|spar.len
op_star
r_sizeof
(paren
id|__s16
)paren
suffix:semicolon
id|dev-&gt;sbuf.rem
op_assign
id|spar.len
suffix:semicolon
id|dev-&gt;sbuf.ubuf
op_assign
id|spar.data
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HFMODEM_IOCTL_SAMPLEFINISHED
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;sbuf.rem
OG
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;sbuf.kbuf
op_logical_or
op_logical_neg
id|dev-&gt;sbuf.size
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EPIPE
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|copy_to_user
c_func
(paren
id|dev-&gt;sbuf.ubuf
comma
id|dev-&gt;sbuf.kbuf
comma
id|dev-&gt;sbuf.size
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|dev-&gt;sbuf.kbuf
comma
id|dev-&gt;sbuf.size
)paren
suffix:semicolon
id|dev-&gt;sbuf.kbuf
op_assign
id|dev-&gt;sbuf.kptr
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;sbuf.size
op_assign
id|dev-&gt;sbuf.rem
op_assign
l_int|0
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#if LINUX_VERSION_CODE &gt;= 0x20100
DECL|function|hfmodem_poll
r_int
r_int
id|hfmodem_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|hfmodem_state
op_star
id|dev
op_assign
op_amp
id|hfmodem_state
(braket
l_int|0
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|cnt1
comma
id|cnt2
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|dev-&gt;wait
comma
id|wait
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cnt1
op_assign
id|cnt2
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt1
op_logical_or
op_logical_neg
id|cnt2
)paren
r_return
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else 
DECL|function|hfmodem_select
r_int
id|hfmodem_select
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
id|sel_type
comma
id|select_table
op_star
id|wait
)paren
(brace
r_struct
id|hfmodem_state
op_star
id|dev
op_assign
op_amp
id|hfmodem_state
(braket
l_int|0
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|cnt1
comma
id|cnt2
suffix:semicolon
r_if
c_cond
(paren
id|sel_type
op_eq
id|SEL_IN
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cnt1
op_assign
id|cnt2
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt1
op_logical_or
op_logical_neg
id|cnt2
)paren
r_return
l_int|1
suffix:semicolon
id|select_wait
c_func
(paren
op_amp
id|dev-&gt;wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|l1fsk_phinc
r_extern
id|__inline__
r_int
r_int
id|l1fsk_phinc
c_func
(paren
r_struct
id|hfmodem_l1_txslot
op_star
id|txs
comma
r_int
r_int
id|nbit
)paren
(brace
r_return
id|txs-&gt;phase_incs
(braket
op_logical_neg
op_logical_neg
(paren
(paren
id|txs-&gt;data
(braket
id|nbit
op_rshift
l_int|3
)braket
op_xor
id|txs-&gt;inv
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|nbit
op_amp
l_int|7
)paren
)paren
)paren
)braket
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_input_samples
r_void
id|hfmodem_input_samples
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
comma
id|hfmodem_time_t
id|tstart
comma
id|hfmodem_time_t
id|tinc
comma
id|__s16
op_star
id|samples
)paren
(brace
id|hfmodem_time_t
id|tst
comma
id|tend
suffix:semicolon
id|__s16
op_star
id|s
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|hfmodem_soft_t
id|sample
suffix:semicolon
id|dev-&gt;l1.last_time
op_assign
id|tstart
op_plus
(paren
id|HFMODEM_FRAGSAMPLES
op_minus
l_int|1
)paren
op_star
id|tinc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|hfmodem_l1_rxslot
op_star
id|rxs
op_assign
id|dev-&gt;l1.rxslots
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|rxs-&gt;state
op_eq
id|ss_unused
op_logical_or
id|rxs-&gt;state
op_eq
id|ss_retired
)paren
r_continue
suffix:semicolon
id|tst
op_assign
id|tstart
op_minus
(paren
id|rxs-&gt;corrlen
op_minus
l_int|1
)paren
op_star
id|tinc
suffix:semicolon
id|tend
op_assign
id|tst
op_plus
(paren
id|HFMODEM_FRAGSAMPLES
op_minus
l_int|1
)paren
op_star
id|tinc
suffix:semicolon
r_if
c_cond
(paren
id|rxs-&gt;state
op_eq
id|ss_ready
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|rxs-&gt;tstart
op_minus
id|tend
)paren
OG
l_int|0
)paren
r_continue
suffix:semicolon
id|rxs-&gt;state
op_assign
id|ss_oper
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
id|samples
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|HFMODEM_FRAGSAMPLES
suffix:semicolon
id|j
op_increment
comma
id|s
op_increment
comma
id|tst
op_add_assign
id|tinc
)paren
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|rxs-&gt;tstart
op_minus
id|tst
)paren
op_le
l_int|0
)paren
(brace
id|sample
op_assign
id|do_filter
c_func
(paren
id|rxs
comma
id|s
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
r_int
)paren
(paren
id|rxs-&gt;tstart
op_minus
id|tst
)paren
op_le
l_int|0
op_logical_and
id|rxs-&gt;cntbits
OL
id|rxs-&gt;nbits
)paren
(brace
id|rxs-&gt;data
(braket
id|rxs-&gt;cntbits
)braket
op_assign
id|sample
suffix:semicolon
id|rxs-&gt;cntbits
op_increment
suffix:semicolon
id|rxs-&gt;tstart
op_add_assign
id|rxs-&gt;tinc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rxs-&gt;cntbits
op_ge
id|rxs-&gt;nbits
)paren
(brace
id|rxs-&gt;state
op_assign
id|ss_retired
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|output_one_sample
r_extern
id|__inline__
r_int
r_int
id|output_one_sample
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
comma
id|hfmodem_time_t
id|tm
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_struct
id|hfmodem_l1_txslot
op_star
id|txs
suffix:semicolon
multiline_comment|/*&n;&t; * first activate new output slots&n;&t; */
r_for
c_loop
(paren
id|j
op_assign
op_minus
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|txs
op_assign
id|dev-&gt;l1.txslots
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|txs-&gt;state
op_eq
id|ss_ready
op_logical_and
(paren
r_int
)paren
(paren
id|txs-&gt;tstart
op_minus
id|tm
)paren
op_le
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|k
)braket
dot
id|state
op_ne
id|ss_oper
)paren
r_continue
suffix:semicolon
id|dev-&gt;l1.txslots
(braket
id|k
)braket
dot
id|state
op_assign
id|ss_retired
suffix:semicolon
)brace
id|txs-&gt;state
op_assign
id|ss_oper
suffix:semicolon
id|txs-&gt;tstart
op_add_assign
id|txs-&gt;tinc
suffix:semicolon
id|txs-&gt;phinc
op_assign
id|l1fsk_phinc
c_func
(paren
id|txs
comma
l_int|0
)paren
suffix:semicolon
id|txs-&gt;cntbits
op_assign
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|txs-&gt;state
op_ne
id|ss_oper
)paren
r_continue
suffix:semicolon
id|j
op_assign
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
OL
l_int|0
op_logical_or
id|j
op_ge
id|HFMODEM_NUMTXSLOTS
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * calculate the current slot&n;&t; */
id|txs
op_assign
id|dev-&gt;l1.txslots
op_plus
id|j
suffix:semicolon
r_while
c_loop
(paren
(paren
r_int
)paren
(paren
id|txs-&gt;tstart
op_minus
id|tm
)paren
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|txs-&gt;cntbits
op_ge
id|txs-&gt;nbits
)paren
(brace
id|txs-&gt;state
op_assign
id|ss_retired
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|txs-&gt;tstart
op_add_assign
id|txs-&gt;tinc
suffix:semicolon
id|txs-&gt;phinc
op_assign
id|l1fsk_phinc
c_func
(paren
id|txs
comma
id|txs-&gt;cntbits
)paren
suffix:semicolon
id|txs-&gt;cntbits
op_increment
suffix:semicolon
)brace
r_return
id|txs-&gt;phinc
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_output_samples
r_int
id|hfmodem_output_samples
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
comma
id|hfmodem_time_t
id|tstart
comma
id|hfmodem_time_t
id|tinc
comma
id|__s16
op_star
id|samples
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|hfmodem_time_t
id|tend
op_assign
id|tstart
op_plus
(paren
id|HFMODEM_FRAGSAMPLES
op_minus
l_int|1
)paren
op_star
id|tinc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_oper
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_ready
op_logical_and
(paren
r_int
)paren
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|tstart
op_minus
id|tend
)paren
op_le
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
id|HFMODEM_NUMTXSLOTS
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|HFMODEM_FRAGSAMPLES
suffix:semicolon
id|j
op_increment
comma
id|tstart
op_add_assign
id|tinc
comma
id|samples
op_increment
)paren
(brace
op_star
id|samples
op_assign
id|isimplecos
c_func
(paren
id|dev-&gt;l1.tx_phase
)paren
suffix:semicolon
id|dev-&gt;l1.tx_phase
op_add_assign
id|output_one_sample
c_func
(paren
id|dev
comma
id|tstart
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_next_tx_event
r_int
id|hfmodem_next_tx_event
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
comma
id|hfmodem_time_t
id|curr
)paren
(brace
r_int
id|diff
op_assign
id|LONG_MAX
comma
id|t
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_oper
)paren
r_if
c_cond
(paren
id|diff
OG
l_int|0
)paren
id|diff
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_ready
)paren
(brace
id|t
op_assign
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|tstart
op_minus
id|curr
suffix:semicolon
r_if
c_cond
(paren
id|t
OL
id|diff
)paren
id|diff
op_assign
id|t
suffix:semicolon
)brace
)brace
r_return
id|diff
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_finish_pending_rx_requests
r_void
id|hfmodem_finish_pending_rx_requests
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_oper
)paren
r_continue
suffix:semicolon
r_while
c_loop
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|cntbits
OL
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|nbits
)paren
(brace
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|data
(braket
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|cntbits
)braket
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|cntbits
op_increment
suffix:semicolon
)brace
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_assign
id|ss_retired
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hfmodem_wakeup
r_void
id|hfmodem_wakeup
c_func
(paren
r_struct
id|hfmodem_state
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|cnt1
comma
id|cnt2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cnt1
op_assign
id|cnt2
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMTXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.txslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HFMODEM_NUMRXSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_eq
id|ss_retired
)paren
id|cnt1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l1.rxslots
(braket
id|i
)braket
dot
id|state
op_ne
id|ss_unused
)paren
id|cnt2
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt1
op_logical_or
op_logical_neg
id|cnt2
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;wait
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
eof
