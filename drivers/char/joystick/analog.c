multiline_comment|/*&n; * $Id: analog.c,v 1.52 2000/06/07 13:07:06 vojtech Exp $&n; *&n; *  Copyright (c) 1996-2000 Vojtech Pavlik&n; *&n; *  Sponsored by SuSE&n; */
multiline_comment|/*&n; * Analog joystick and gamepad driver for Linux&n; */
multiline_comment|/*&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or &n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; * &n; * Should you need to contact me, the author, you can do so either by&n; * e-mail - mail your message to &lt;vojtech@suse.cz&gt;, or by paper mail:&n; * Vojtech Pavlik, Ucitelska 1576, Prague 8, 182 00 Czech Republic&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Vojtech Pavlik &lt;vojtech@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Analog joystick and gamepad driver for Linux&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Option parsing.&n; */
DECL|macro|ANALOG_PORTS
mdefine_line|#define ANALOG_PORTS&t;&t;16
DECL|variable|js
r_static
r_char
op_star
id|js
(braket
id|ANALOG_PORTS
)braket
suffix:semicolon
DECL|variable|analog_options
r_static
r_int
id|analog_options
(braket
id|ANALOG_PORTS
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|js
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|ANALOG_PORTS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|js
comma
l_string|&quot;Analog joystick options&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Times, feature definitions.&n; */
DECL|macro|ANALOG_RUDDER
mdefine_line|#define ANALOG_RUDDER&t;&t;0x00004
DECL|macro|ANALOG_THROTTLE
mdefine_line|#define ANALOG_THROTTLE&t;&t;0x00008
DECL|macro|ANALOG_AXES_STD
mdefine_line|#define ANALOG_AXES_STD&t;&t;0x0000f
DECL|macro|ANALOG_BTNS_STD
mdefine_line|#define ANALOG_BTNS_STD&t;&t;0x000f0
DECL|macro|ANALOG_BTNS_CHF
mdefine_line|#define ANALOG_BTNS_CHF&t;&t;0x00100
DECL|macro|ANALOG_HAT1_CHF
mdefine_line|#define ANALOG_HAT1_CHF&t;&t;0x00200
DECL|macro|ANALOG_HAT2_CHF
mdefine_line|#define ANALOG_HAT2_CHF&t;&t;0x00400
DECL|macro|ANALOG_HAT_FCS
mdefine_line|#define ANALOG_HAT_FCS&t;&t;0x00800
DECL|macro|ANALOG_HATS_ALL
mdefine_line|#define ANALOG_HATS_ALL&t;&t;0x00e00
DECL|macro|ANALOG_BTN_TL
mdefine_line|#define ANALOG_BTN_TL&t;&t;0x01000
DECL|macro|ANALOG_BTN_TR
mdefine_line|#define ANALOG_BTN_TR&t;&t;0x02000
DECL|macro|ANALOG_BTN_TL2
mdefine_line|#define ANALOG_BTN_TL2&t;&t;0x04000
DECL|macro|ANALOG_BTN_TR2
mdefine_line|#define ANALOG_BTN_TR2&t;&t;0x08000
DECL|macro|ANALOG_BTNS_TLR
mdefine_line|#define ANALOG_BTNS_TLR&t;&t;0x03000
DECL|macro|ANALOG_BTNS_TLR2
mdefine_line|#define ANALOG_BTNS_TLR2&t;0x0c000
DECL|macro|ANALOG_BTNS_GAMEPAD
mdefine_line|#define ANALOG_BTNS_GAMEPAD&t;0x0f000
DECL|macro|ANALOG_HBTN_CHF
mdefine_line|#define ANALOG_HBTN_CHF&t;&t;0x10000
DECL|macro|ANALOG_ANY_CHF
mdefine_line|#define ANALOG_ANY_CHF&t;&t;0x10700
DECL|macro|ANALOG_SAITEK
mdefine_line|#define ANALOG_SAITEK&t;&t;0x20000
DECL|macro|ANALOG_EXTENSIONS
mdefine_line|#define ANALOG_EXTENSIONS&t;0x7ff00
DECL|macro|ANALOG_GAMEPAD
mdefine_line|#define ANALOG_GAMEPAD&t;&t;0x80000
DECL|macro|ANALOG_MAX_TIME
mdefine_line|#define ANALOG_MAX_TIME&t;&t;3&t;/* 3 ms */
DECL|macro|ANALOG_LOOP_TIME
mdefine_line|#define ANALOG_LOOP_TIME&t;2000&t;/* 2 * loop */
DECL|macro|ANALOG_REFRESH_TIME
mdefine_line|#define ANALOG_REFRESH_TIME&t;HZ/100&t;/* 10 ms */
DECL|macro|ANALOG_SAITEK_DELAY
mdefine_line|#define ANALOG_SAITEK_DELAY&t;200&t;/* 200 us */
DECL|macro|ANALOG_SAITEK_TIME
mdefine_line|#define ANALOG_SAITEK_TIME&t;2000&t;/* 2000 us */
DECL|macro|ANALOG_AXIS_TIME
mdefine_line|#define ANALOG_AXIS_TIME&t;2&t;/* 2 * refresh */
DECL|macro|ANALOG_INIT_RETRIES
mdefine_line|#define ANALOG_INIT_RETRIES&t;8&t;/* 8 times */
DECL|macro|ANALOG_FUZZ_BITS
mdefine_line|#define ANALOG_FUZZ_BITS&t;2&t;/* 2 bit more */
DECL|macro|ANALOG_FUZZ_MAGIC
mdefine_line|#define ANALOG_FUZZ_MAGIC&t;36&t;/* 36 u*ms/loop */
DECL|macro|ANALOG_MAX_NAME_LENGTH
mdefine_line|#define ANALOG_MAX_NAME_LENGTH  128
DECL|variable|analog_axes
r_static
r_int
id|analog_axes
(braket
)braket
op_assign
(brace
id|ABS_X
comma
id|ABS_Y
comma
id|ABS_RUDDER
comma
id|ABS_THROTTLE
)brace
suffix:semicolon
DECL|variable|analog_hats
r_static
r_int
id|analog_hats
(braket
)braket
op_assign
(brace
id|ABS_HAT0X
comma
id|ABS_HAT0Y
comma
id|ABS_HAT1X
comma
id|ABS_HAT1Y
comma
id|ABS_HAT2X
comma
id|ABS_HAT2Y
)brace
suffix:semicolon
DECL|variable|analog_pads
r_static
r_int
id|analog_pads
(braket
)braket
op_assign
(brace
id|BTN_Y
comma
id|BTN_Z
comma
id|BTN_TL
comma
id|BTN_TR
)brace
suffix:semicolon
DECL|variable|analog_exts
r_static
r_int
id|analog_exts
(braket
)braket
op_assign
(brace
id|ANALOG_HAT1_CHF
comma
id|ANALOG_HAT2_CHF
comma
id|ANALOG_HAT_FCS
)brace
suffix:semicolon
DECL|variable|analog_pad_btn
r_static
r_int
id|analog_pad_btn
(braket
)braket
op_assign
(brace
id|BTN_A
comma
id|BTN_B
comma
id|BTN_C
comma
id|BTN_X
comma
id|BTN_TL2
comma
id|BTN_TR2
comma
id|BTN_SELECT
comma
id|BTN_START
comma
id|BTN_MODE
comma
id|BTN_BASE
)brace
suffix:semicolon
DECL|variable|analog_joy_btn
r_static
r_int
id|analog_joy_btn
(braket
)braket
op_assign
(brace
id|BTN_TRIGGER
comma
id|BTN_THUMB
comma
id|BTN_TOP
comma
id|BTN_TOP2
comma
id|BTN_BASE
comma
id|BTN_BASE2
comma
id|BTN_BASE3
comma
id|BTN_BASE4
comma
id|BTN_BASE5
comma
id|BTN_BASE6
)brace
suffix:semicolon
DECL|variable|analog_chf
r_static
r_int
r_char
id|analog_chf
(braket
)braket
op_assign
(brace
l_int|0xf
comma
l_int|0x0
comma
l_int|0x1
comma
l_int|0x9
comma
l_int|0x2
comma
l_int|0x4
comma
l_int|0xc
comma
l_int|0x8
comma
l_int|0x3
comma
l_int|0x5
comma
l_int|0xb
comma
l_int|0x7
comma
l_int|0xd
comma
l_int|0xe
comma
l_int|0xa
comma
l_int|0x6
)brace
suffix:semicolon
DECL|struct|analog
r_struct
id|analog
(brace
DECL|member|dev
r_struct
id|input_dev
id|dev
suffix:semicolon
DECL|member|mask
r_int
id|mask
suffix:semicolon
DECL|member|buttons
r_int
op_star
id|buttons
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
id|ANALOG_MAX_NAME_LENGTH
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|analog_port
r_struct
id|analog_port
(brace
DECL|member|gameport
r_struct
id|gameport
op_star
id|gameport
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|analog
r_struct
id|analog
id|analog
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|mask
r_int
r_char
id|mask
suffix:semicolon
DECL|member|saitek
r_char
id|saitek
suffix:semicolon
DECL|member|cooked
r_char
id|cooked
suffix:semicolon
DECL|member|bads
r_int
id|bads
suffix:semicolon
DECL|member|reads
r_int
id|reads
suffix:semicolon
DECL|member|speed
r_int
id|speed
suffix:semicolon
DECL|member|loop
r_int
id|loop
suffix:semicolon
DECL|member|fuzz
r_int
id|fuzz
suffix:semicolon
DECL|member|axes
r_int
id|axes
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|buttons
r_int
id|buttons
suffix:semicolon
DECL|member|initial
r_int
id|initial
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|used
r_int
id|used
suffix:semicolon
DECL|member|axtime
r_int
id|axtime
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Time macros.&n; */
macro_line|#ifdef __i386__
macro_line|#ifdef CONFIG_X86_TSC
DECL|macro|GET_TIME
mdefine_line|#define GET_TIME(x)&t;__asm__ __volatile__ ( &quot;rdtsc&quot; : &quot;=a&quot; (x) : : &quot;dx&quot; )
DECL|macro|DELTA
mdefine_line|#define DELTA(x,y)&t;((y)-(x))
DECL|macro|TIME_NAME
mdefine_line|#define TIME_NAME &quot;TSC&quot;
macro_line|#else
DECL|macro|GET_TIME
mdefine_line|#define GET_TIME(x)&t;do { outb(0, 0x43); x = inb(0x40); x |= inb(0x40) &lt;&lt; 8; } while (0)
DECL|macro|DELTA
mdefine_line|#define DELTA(x,y)&t;((x)-(y)+((x)&lt;(y)?1193180L/HZ:0))
DECL|macro|TIME_NAME
mdefine_line|#define TIME_NAME &quot;PIT&quot;
macro_line|#endif
macro_line|#elif __alpha__
DECL|macro|GET_TIME
mdefine_line|#define GET_TIME(x)&t;__asm__ __volatile__ ( &quot;rpcc %0&quot; : &quot;=r&quot; (x) )
DECL|macro|DELTA
mdefine_line|#define DELTA(x,y)&t;((y)-(x))
DECL|macro|TIME_NAME
mdefine_line|#define TIME_NAME &quot;PCC&quot;
macro_line|#endif
macro_line|#ifndef GET_TIME
DECL|macro|FAKE_TIME
mdefine_line|#define FAKE_TIME
DECL|variable|analog_faketime
r_static
r_int
r_int
id|analog_faketime
op_assign
l_int|0
suffix:semicolon
DECL|macro|GET_TIME
mdefine_line|#define GET_TIME(x)     do { x = analog_faketime++; } while(0)
DECL|macro|DELTA
mdefine_line|#define DELTA(x,y)&t;((y)-(x))
DECL|macro|TIME_NAME
mdefine_line|#define TIME_NAME &quot;Unreliable&quot;
macro_line|#endif
multiline_comment|/*&n; * analog_decode() decodes analog joystick data and reports input events.&n; */
DECL|function|analog_decode
r_static
r_void
id|analog_decode
c_func
(paren
r_struct
id|analog
op_star
id|analog
comma
r_int
op_star
id|axes
comma
r_int
op_star
id|initial
comma
r_int
id|buttons
)paren
(brace
r_struct
id|input_dev
op_star
id|dev
op_assign
op_amp
id|analog-&gt;dev
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HAT_FCS
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|axes
(braket
l_int|3
)braket
OL
(paren
(paren
id|initial
(braket
l_int|3
)braket
op_star
(paren
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)paren
)paren
op_rshift
l_int|3
)paren
)paren
(brace
id|buttons
op_or_assign
l_int|1
op_lshift
(paren
id|i
op_plus
l_int|14
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
(paren
l_int|0x10
op_lshift
id|i
)paren
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog-&gt;buttons
(braket
id|j
op_increment
)braket
comma
(paren
id|buttons
op_rshift
id|i
)paren
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HBTN_CHF
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog-&gt;buttons
(braket
id|j
op_increment
)braket
comma
(paren
id|buttons
op_rshift
(paren
id|i
op_plus
l_int|10
)paren
)paren
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTN_TL
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog_pads
(braket
l_int|0
)braket
comma
id|axes
(braket
l_int|2
)braket
OL
(paren
id|initial
(braket
l_int|2
)braket
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTN_TR
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog_pads
(braket
l_int|1
)braket
comma
id|axes
(braket
l_int|3
)braket
OL
(paren
id|initial
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTN_TL2
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog_pads
(braket
l_int|2
)braket
comma
id|axes
(braket
l_int|2
)braket
OG
(paren
id|initial
(braket
l_int|2
)braket
op_plus
(paren
id|initial
(braket
l_int|2
)braket
op_rshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTN_TR2
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|analog_pads
(braket
l_int|3
)braket
comma
id|axes
(braket
l_int|3
)braket
OG
(paren
id|initial
(braket
l_int|3
)braket
op_plus
(paren
id|initial
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|input_report_abs
c_func
(paren
id|dev
comma
id|analog_axes
(braket
id|j
op_increment
)braket
comma
id|axes
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|analog_exts
(braket
id|i
)braket
)paren
(brace
id|input_report_abs
c_func
(paren
id|dev
comma
id|analog_hats
(braket
id|j
op_increment
)braket
comma
(paren
(paren
id|buttons
op_rshift
(paren
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|7
)paren
)paren
op_amp
l_int|1
)paren
op_minus
(paren
(paren
id|buttons
op_rshift
(paren
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|9
)paren
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|dev
comma
id|analog_hats
(braket
id|j
op_increment
)braket
comma
(paren
(paren
id|buttons
op_rshift
(paren
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|8
)paren
)paren
op_amp
l_int|1
)paren
op_minus
(paren
(paren
id|buttons
op_rshift
(paren
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|6
)paren
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * analog_cooked_read() reads analog joystick data.&n; */
DECL|function|analog_cooked_read
r_static
r_int
id|analog_cooked_read
c_func
(paren
r_struct
id|analog_port
op_star
id|port
)paren
(brace
r_struct
id|gameport
op_star
id|gameport
op_assign
id|port-&gt;gameport
suffix:semicolon
r_int
r_int
id|time
(braket
l_int|4
)braket
comma
id|start
comma
id|loop
comma
id|now
comma
id|loopout
comma
id|timeout
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|4
)braket
comma
id|this
comma
id|last
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|loopout
op_assign
(paren
id|ANALOG_LOOP_TIME
op_star
id|port-&gt;loop
)paren
op_div
l_int|1000
suffix:semicolon
id|timeout
op_assign
id|ANALOG_MAX_TIME
op_star
id|port-&gt;speed
suffix:semicolon
id|__save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
id|gameport_trigger
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|now
)paren
suffix:semicolon
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|start
op_assign
id|now
suffix:semicolon
id|this
op_assign
id|port-&gt;mask
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|loop
op_assign
id|now
suffix:semicolon
id|last
op_assign
id|this
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
id|this
op_assign
id|gameport_read
c_func
(paren
id|gameport
)paren
op_amp
id|port-&gt;mask
suffix:semicolon
id|GET_TIME
c_func
(paren
id|now
)paren
suffix:semicolon
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|last
op_xor
id|this
)paren
op_logical_and
(paren
id|DELTA
c_func
(paren
id|loop
comma
id|now
)paren
OL
id|loopout
)paren
)paren
(brace
id|data
(braket
id|i
)braket
op_assign
id|last
op_xor
id|this
suffix:semicolon
id|time
(braket
id|i
)braket
op_assign
id|now
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|this
op_logical_and
(paren
id|i
OL
l_int|4
)paren
op_logical_and
(paren
id|DELTA
c_func
(paren
id|start
comma
id|now
)paren
OL
id|timeout
)paren
)paren
suffix:semicolon
id|this
op_lshift_assign
l_int|4
suffix:semicolon
r_for
c_loop
(paren
op_decrement
id|i
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|this
op_or_assign
id|data
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|data
(braket
id|i
)braket
op_amp
(paren
l_int|1
op_lshift
id|j
)paren
)paren
id|port-&gt;axes
(braket
id|j
)braket
op_assign
(paren
id|DELTA
c_func
(paren
id|start
comma
id|time
(braket
id|i
)braket
)paren
op_lshift
id|ANALOG_FUZZ_BITS
)paren
op_div
id|port-&gt;loop
suffix:semicolon
)brace
r_return
op_minus
(paren
id|this
op_ne
id|port-&gt;mask
)paren
suffix:semicolon
)brace
DECL|function|analog_button_read
r_static
r_int
id|analog_button_read
c_func
(paren
r_struct
id|analog_port
op_star
id|port
comma
r_char
id|saitek
comma
r_char
id|chf
)paren
(brace
r_int
r_char
id|u
suffix:semicolon
r_int
id|t
op_assign
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|strobe
op_assign
id|gameport_time
c_func
(paren
id|port-&gt;gameport
comma
id|ANALOG_SAITEK_TIME
)paren
suffix:semicolon
id|u
op_assign
id|gameport_read
c_func
(paren
id|port-&gt;gameport
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chf
)paren
(brace
id|port-&gt;buttons
op_assign
(paren
op_complement
id|u
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|port-&gt;buttons
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
op_complement
id|u
op_amp
l_int|0xf0
)paren
op_logical_and
(paren
id|i
OL
l_int|16
)paren
op_logical_and
id|t
)paren
(brace
id|port-&gt;buttons
op_or_assign
l_int|1
op_lshift
id|analog_chf
(braket
(paren
op_complement
id|u
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|saitek
)paren
r_return
l_int|0
suffix:semicolon
id|udelay
c_func
(paren
id|ANALOG_SAITEK_DELAY
)paren
suffix:semicolon
id|t
op_assign
id|strobe
suffix:semicolon
id|gameport_trigger
c_func
(paren
id|port-&gt;gameport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|u
op_assign
id|gameport_read
c_func
(paren
id|port-&gt;gameport
)paren
)paren
op_amp
id|port-&gt;mask
)paren
op_logical_and
id|t
)paren
id|t
op_decrement
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
op_minus
(paren
op_logical_neg
id|t
op_logical_or
(paren
id|i
op_eq
l_int|16
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_timer() repeatedly polls the Analog joysticks.&n; */
DECL|function|analog_timer
r_static
r_void
id|analog_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|analog_port
op_star
id|port
op_assign
(paren
r_void
op_star
)paren
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|saitek
op_assign
op_logical_neg
op_logical_neg
(paren
id|port-&gt;analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_SAITEK
)paren
suffix:semicolon
r_char
id|chf
op_assign
op_logical_neg
op_logical_neg
(paren
id|port-&gt;analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_ANY_CHF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;cooked
)paren
(brace
id|port-&gt;bads
op_sub_assign
id|gameport_cooked_read
c_func
(paren
id|port-&gt;gameport
comma
id|port-&gt;axes
comma
op_amp
id|port-&gt;buttons
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chf
)paren
id|port-&gt;buttons
op_assign
id|port-&gt;buttons
ques
c_cond
(paren
l_int|1
op_lshift
id|analog_chf
(braket
id|port-&gt;buttons
)braket
)paren
suffix:colon
l_int|0
suffix:semicolon
id|port-&gt;reads
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;axtime
op_decrement
)paren
(brace
id|port-&gt;bads
op_sub_assign
id|analog_cooked_read
c_func
(paren
id|port
)paren
suffix:semicolon
id|port-&gt;bads
op_sub_assign
id|analog_button_read
c_func
(paren
id|port
comma
id|saitek
comma
id|chf
)paren
suffix:semicolon
id|port-&gt;reads
op_increment
suffix:semicolon
id|port-&gt;axtime
op_assign
id|ANALOG_AXIS_TIME
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|saitek
)paren
id|analog_button_read
c_func
(paren
id|port
comma
id|saitek
comma
id|chf
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|port-&gt;analog
(braket
id|i
)braket
dot
id|mask
)paren
id|analog_decode
c_func
(paren
id|port-&gt;analog
op_plus
id|i
comma
id|port-&gt;axes
comma
id|port-&gt;initial
comma
id|port-&gt;buttons
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|port-&gt;timer
comma
id|jiffies
op_plus
id|ANALOG_REFRESH_TIME
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_open() is a callback from the input open routine.&n; */
DECL|function|analog_open
r_static
r_int
id|analog_open
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
)paren
(brace
r_struct
id|analog_port
op_star
id|port
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;used
op_increment
)paren
id|mod_timer
c_func
(paren
op_amp
id|port-&gt;timer
comma
id|jiffies
op_plus
id|ANALOG_REFRESH_TIME
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_close() is a callback from the input close routine.&n; */
DECL|function|analog_close
r_static
r_void
id|analog_close
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
)paren
(brace
r_struct
id|analog_port
op_star
id|port
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|port-&gt;used
)paren
id|del_timer
c_func
(paren
op_amp
id|port-&gt;timer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_calibrate_timer() calibrates the timer and computes loop&n; * and timeout values for a joystick port.&n; */
DECL|function|analog_calibrate_timer
r_static
r_void
id|analog_calibrate_timer
c_func
(paren
r_struct
id|analog_port
op_star
id|port
)paren
(brace
r_struct
id|gameport
op_star
id|gameport
op_assign
id|port-&gt;gameport
suffix:semicolon
r_int
r_int
id|i
comma
id|t
comma
id|tx
comma
id|t1
comma
id|t2
comma
id|t3
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|t1
)paren
suffix:semicolon
macro_line|#ifdef FAKE_TIME
id|analog_faketime
op_add_assign
l_int|830
suffix:semicolon
macro_line|#endif
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|t2
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|t3
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|port-&gt;speed
op_assign
id|DELTA
c_func
(paren
id|t1
comma
id|t2
)paren
op_minus
id|DELTA
c_func
(paren
id|t2
comma
id|t3
)paren
suffix:semicolon
id|tx
op_assign
op_complement
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|50
suffix:semicolon
id|i
op_increment
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|t1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
l_int|50
suffix:semicolon
id|t
op_increment
)paren
(brace
id|gameport_read
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|GET_TIME
c_func
(paren
id|t2
)paren
suffix:semicolon
)brace
id|GET_TIME
c_func
(paren
id|t3
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|i
)paren
suffix:semicolon
id|t
op_assign
id|DELTA
c_func
(paren
id|t1
comma
id|t2
)paren
op_minus
id|DELTA
c_func
(paren
id|t2
comma
id|t3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OL
id|tx
)paren
id|tx
op_assign
id|t
suffix:semicolon
)brace
id|port-&gt;loop
op_assign
id|tx
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_name() constructs a name for an analog joystick.&n; */
DECL|function|analog_name
r_static
r_void
id|analog_name
c_func
(paren
r_struct
id|analog
op_star
id|analog
)paren
(brace
id|sprintf
c_func
(paren
id|analog-&gt;name
comma
l_string|&quot;Analog %d-axis %d-button&quot;
comma
id|hweight8
c_func
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_AXES_STD
)paren
comma
id|hweight8
c_func
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTNS_STD
)paren
op_plus
op_logical_neg
op_logical_neg
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTNS_CHF
)paren
op_star
l_int|2
op_plus
id|hweight16
c_func
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTNS_GAMEPAD
)paren
op_plus
op_logical_neg
op_logical_neg
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HBTN_CHF
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HATS_ALL
)paren
id|sprintf
c_func
(paren
id|analog-&gt;name
comma
l_string|&quot;%s %d-hat&quot;
comma
id|analog-&gt;name
comma
id|hweight16
c_func
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HATS_ALL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HAT_FCS
)paren
id|strcat
c_func
(paren
id|analog-&gt;name
comma
l_string|&quot; FCS&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_ANY_CHF
)paren
id|strcat
c_func
(paren
id|analog-&gt;name
comma
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_SAITEK
)paren
ques
c_cond
l_string|&quot; Saitek&quot;
suffix:colon
l_string|&quot; CHF&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|analog-&gt;name
comma
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_GAMEPAD
)paren
ques
c_cond
l_string|&quot; gamepad&quot;
suffix:colon
l_string|&quot; joystick&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_init_device()&n; */
DECL|function|analog_init_device
r_static
r_void
id|analog_init_device
c_func
(paren
r_struct
id|analog_port
op_star
id|port
comma
r_struct
id|analog
op_star
id|analog
comma
r_int
id|index
)paren
(brace
r_int
id|i
comma
id|j
comma
id|t
comma
id|v
comma
id|w
comma
id|x
comma
id|y
comma
id|z
suffix:semicolon
id|analog_name
c_func
(paren
id|analog
)paren
suffix:semicolon
id|analog-&gt;buttons
op_assign
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_GAMEPAD
)paren
ques
c_cond
id|analog_pad_btn
suffix:colon
id|analog_joy_btn
suffix:semicolon
id|analog-&gt;dev.name
op_assign
id|analog-&gt;name
suffix:semicolon
id|analog-&gt;dev.idbus
op_assign
id|BUS_GAMEPORT
suffix:semicolon
id|analog-&gt;dev.idvendor
op_assign
id|GAMEPORT_ID_VENDOR_ANALOG
suffix:semicolon
id|analog-&gt;dev.idproduct
op_assign
id|analog-&gt;mask
op_rshift
l_int|4
suffix:semicolon
id|analog-&gt;dev.idversion
op_assign
l_int|0x0100
suffix:semicolon
id|analog-&gt;dev.open
op_assign
id|analog_open
suffix:semicolon
id|analog-&gt;dev.close
op_assign
id|analog_close
suffix:semicolon
id|analog-&gt;dev
dot
r_private
op_assign
id|port
suffix:semicolon
id|analog-&gt;dev.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_ABS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|t
op_assign
id|analog_axes
(braket
id|j
)braket
suffix:semicolon
id|x
op_assign
id|port-&gt;axes
(braket
id|i
)braket
suffix:semicolon
id|y
op_assign
(paren
id|port-&gt;axes
(braket
l_int|0
)braket
op_plus
id|port-&gt;axes
(braket
l_int|1
)braket
)paren
op_rshift
l_int|1
suffix:semicolon
id|z
op_assign
id|y
op_minus
id|port-&gt;axes
(braket
id|i
)braket
suffix:semicolon
id|z
op_assign
id|z
OG
l_int|0
ques
c_cond
id|z
suffix:colon
op_minus
id|z
suffix:semicolon
id|v
op_assign
(paren
id|x
op_rshift
l_int|3
)paren
suffix:semicolon
id|w
op_assign
(paren
id|x
op_rshift
l_int|3
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|t
comma
id|analog-&gt;dev.absbit
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_eq
l_int|2
op_logical_or
id|i
op_eq
l_int|3
)paren
op_logical_and
(paren
id|j
op_eq
l_int|2
op_logical_or
id|j
op_eq
l_int|3
)paren
op_logical_and
(paren
id|z
OG
(paren
id|y
op_rshift
l_int|3
)paren
)paren
)paren
id|x
op_assign
id|y
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_SAITEK
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
l_int|2
)paren
id|x
op_assign
id|port-&gt;axes
(braket
id|i
)braket
suffix:semicolon
id|v
op_assign
id|x
op_minus
(paren
id|x
op_rshift
l_int|2
)paren
suffix:semicolon
id|w
op_assign
(paren
id|x
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
id|analog-&gt;dev.absmax
(braket
id|t
)braket
op_assign
(paren
id|x
op_lshift
l_int|1
)paren
op_minus
id|v
suffix:semicolon
id|analog-&gt;dev.absmin
(braket
id|t
)braket
op_assign
id|v
suffix:semicolon
id|analog-&gt;dev.absfuzz
(braket
id|t
)braket
op_assign
id|port-&gt;fuzz
suffix:semicolon
id|analog-&gt;dev.absflat
(braket
id|t
)braket
op_assign
id|w
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|analog_exts
(braket
id|i
)braket
)paren
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
l_int|2
suffix:semicolon
id|x
op_increment
)paren
(brace
id|t
op_assign
id|analog_hats
(braket
id|j
op_increment
)braket
suffix:semicolon
id|set_bit
c_func
(paren
id|t
comma
id|analog-&gt;dev.absbit
)paren
suffix:semicolon
id|analog-&gt;dev.absmax
(braket
id|t
)braket
op_assign
l_int|1
suffix:semicolon
id|analog-&gt;dev.absmin
(braket
id|t
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
(paren
l_int|0x10
op_lshift
id|i
)paren
)paren
id|set_bit
c_func
(paren
id|analog-&gt;buttons
(braket
id|j
op_increment
)braket
comma
id|analog-&gt;dev.keybit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_BTNS_CHF
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|set_bit
c_func
(paren
id|analog-&gt;buttons
(braket
id|j
op_increment
)braket
comma
id|analog-&gt;dev.keybit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
id|ANALOG_HBTN_CHF
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|set_bit
c_func
(paren
id|analog-&gt;buttons
(braket
id|j
op_increment
)braket
comma
id|analog-&gt;dev.keybit
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|analog-&gt;mask
op_amp
(paren
id|ANALOG_BTN_TL
op_lshift
id|i
)paren
)paren
id|set_bit
c_func
(paren
id|analog_pads
(braket
id|i
)braket
comma
id|analog-&gt;dev.keybit
)paren
suffix:semicolon
id|analog_decode
c_func
(paren
id|analog
comma
id|port-&gt;axes
comma
id|port-&gt;initial
comma
id|port-&gt;buttons
)paren
suffix:semicolon
id|input_register_device
c_func
(paren
op_amp
id|analog-&gt;dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;input%d: %s at gameport%d.%d&quot;
comma
id|analog-&gt;dev.number
comma
id|analog-&gt;name
comma
id|port-&gt;gameport-&gt;number
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;cooked
)paren
id|printk
c_func
(paren
l_string|&quot; [ADC port]&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; [&quot;
id|TIME_NAME
l_string|&quot; timer, %d %sHz clock, %d ns res]&bslash;n&quot;
comma
id|port-&gt;speed
OG
l_int|10000
ques
c_cond
(paren
id|port-&gt;speed
op_plus
l_int|800
)paren
op_div
l_int|1000
suffix:colon
id|port-&gt;speed
comma
id|port-&gt;speed
OG
l_int|10000
ques
c_cond
l_string|&quot;M&quot;
suffix:colon
l_string|&quot;k&quot;
comma
(paren
id|port-&gt;loop
op_star
l_int|1000000
)paren
op_div
id|port-&gt;speed
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * analog_init_devices() sets up device-specific values and registers the input devices.&n; */
DECL|function|analog_init_masks
r_static
r_int
id|analog_init_masks
c_func
(paren
r_struct
id|analog_port
op_star
id|port
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|analog
op_star
id|analog
op_assign
id|port-&gt;analog
suffix:semicolon
r_int
id|max
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;mask
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port-&gt;mask
op_amp
l_int|3
)paren
op_ne
l_int|3
op_logical_and
id|port-&gt;mask
op_ne
l_int|0xc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;analog.c: Unknown joystick device found  &quot;
l_string|&quot;(data=%#x, gameport%d), probably not analog joystick.&bslash;n&quot;
comma
id|port-&gt;mask
comma
id|port-&gt;gameport-&gt;number
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|i
op_assign
id|port-&gt;gameport-&gt;number
OL
id|ANALOG_PORTS
ques
c_cond
id|analog_options
(braket
id|port-&gt;gameport-&gt;number
)braket
suffix:colon
l_int|0xff
suffix:semicolon
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_assign
id|i
op_amp
l_int|0xfffff
suffix:semicolon
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_and_assign
op_complement
(paren
id|ANALOG_AXES_STD
op_or
id|ANALOG_HAT_FCS
op_or
id|ANALOG_BTNS_GAMEPAD
)paren
op_or
id|port-&gt;mask
op_or
(paren
(paren
id|port-&gt;mask
op_lshift
l_int|8
)paren
op_amp
id|ANALOG_HAT_FCS
)paren
op_or
(paren
(paren
id|port-&gt;mask
op_lshift
l_int|10
)paren
op_amp
id|ANALOG_BTNS_TLR
)paren
op_or
(paren
(paren
id|port-&gt;mask
op_lshift
l_int|12
)paren
op_amp
id|ANALOG_BTNS_TLR2
)paren
suffix:semicolon
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_and_assign
op_complement
(paren
id|ANALOG_HAT2_CHF
)paren
op_or
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_HBTN_CHF
)paren
ques
c_cond
l_int|0
suffix:colon
id|ANALOG_HAT2_CHF
)paren
suffix:semicolon
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_and_assign
op_complement
(paren
id|ANALOG_THROTTLE
op_or
id|ANALOG_BTN_TR
op_or
id|ANALOG_BTN_TR2
)paren
op_or
(paren
(paren
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_HAT_FCS
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_HAT_FCS
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_HAT_FCS
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_and_assign
op_complement
(paren
id|ANALOG_THROTTLE
op_or
id|ANALOG_RUDDER
)paren
op_or
(paren
(paren
(paren
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTNS_TLR
)paren
op_rshift
l_int|10
)paren
op_amp
(paren
(paren
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTNS_TLR2
)paren
op_rshift
l_int|12
)paren
)paren
suffix:semicolon
id|analog
(braket
l_int|1
)braket
dot
id|mask
op_assign
(paren
(paren
id|i
op_rshift
l_int|20
)paren
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|i
op_rshift
l_int|12
)paren
op_amp
l_int|0xf0000
)paren
suffix:semicolon
id|analog
(braket
l_int|1
)braket
dot
id|mask
op_and_assign
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_EXTENSIONS
)paren
ques
c_cond
id|ANALOG_GAMEPAD
suffix:colon
(paren
(paren
(paren
id|ANALOG_BTNS_STD
op_or
id|port-&gt;mask
)paren
op_amp
op_complement
id|analog
(braket
l_int|0
)braket
dot
id|mask
)paren
op_or
id|ANALOG_GAMEPAD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;cooked
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|max
(braket
id|i
)braket
op_assign
id|port-&gt;axes
(braket
id|i
)braket
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
l_int|0x7
)paren
op_eq
l_int|0x7
)paren
id|max
(braket
l_int|2
)braket
op_assign
(paren
id|max
(braket
l_int|0
)braket
op_plus
id|max
(braket
l_int|1
)braket
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
l_int|0xb
)paren
op_eq
l_int|0xb
)paren
id|max
(braket
l_int|3
)braket
op_assign
(paren
id|max
(braket
l_int|0
)braket
op_plus
id|max
(braket
l_int|1
)braket
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTN_TL
)paren
op_logical_and
op_logical_neg
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTN_TL2
)paren
)paren
id|max
(braket
l_int|2
)braket
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTN_TR
)paren
op_logical_and
op_logical_neg
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_BTN_TR2
)paren
)paren
id|max
(braket
l_int|3
)braket
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_amp
id|ANALOG_HAT_FCS
)paren
)paren
id|max
(braket
l_int|3
)braket
op_rshift_assign
l_int|1
suffix:semicolon
id|gameport_calibrate
c_func
(paren
id|port-&gt;gameport
comma
id|port-&gt;axes
comma
id|max
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|port-&gt;initial
(braket
id|i
)braket
op_assign
id|port-&gt;axes
(braket
id|i
)braket
suffix:semicolon
r_return
op_minus
op_logical_neg
(paren
id|analog
(braket
l_int|0
)braket
dot
id|mask
op_logical_or
id|analog
(braket
l_int|1
)braket
dot
id|mask
)paren
suffix:semicolon
)brace
DECL|function|analog_init_port
r_static
r_int
id|analog_init_port
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_struct
id|gameport_dev
op_star
id|dev
comma
r_struct
id|analog_port
op_star
id|port
)paren
(brace
r_int
id|i
comma
id|t
comma
id|u
comma
id|v
suffix:semicolon
id|gameport
op_member_access_from_pointer
r_private
op_assign
id|port
suffix:semicolon
id|port-&gt;gameport
op_assign
id|gameport
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|port-&gt;timer
)paren
suffix:semicolon
id|port-&gt;timer.data
op_assign
(paren
r_int
)paren
id|port
suffix:semicolon
id|port-&gt;timer.function
op_assign
id|analog_timer
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gameport_open
c_func
(paren
id|gameport
comma
id|dev
comma
id|GAMEPORT_MODE_RAW
)paren
)paren
(brace
id|analog_calibrate_timer
c_func
(paren
id|port
)paren
suffix:semicolon
id|gameport_trigger
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|t
op_assign
id|gameport_read
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|wait_ms
c_func
(paren
id|ANALOG_MAX_TIME
)paren
suffix:semicolon
id|port-&gt;mask
op_assign
(paren
id|gameport_read
c_func
(paren
id|gameport
)paren
op_xor
id|t
)paren
op_amp
id|t
op_amp
l_int|0xf
suffix:semicolon
id|port-&gt;fuzz
op_assign
(paren
id|port-&gt;speed
op_star
id|ANALOG_FUZZ_MAGIC
)paren
op_div
id|port-&gt;loop
op_div
l_int|1000
op_plus
id|ANALOG_FUZZ_BITS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ANALOG_INIT_RETRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|analog_cooked_read
c_func
(paren
id|port
)paren
)paren
r_break
suffix:semicolon
id|wait_ms
c_func
(paren
id|ANALOG_MAX_TIME
)paren
suffix:semicolon
)brace
id|u
op_assign
id|v
op_assign
l_int|0
suffix:semicolon
id|wait_ms
c_func
(paren
id|ANALOG_MAX_TIME
)paren
suffix:semicolon
id|t
op_assign
id|gameport_time
c_func
(paren
id|gameport
comma
id|ANALOG_MAX_TIME
op_star
l_int|1000
)paren
suffix:semicolon
id|gameport_trigger
c_func
(paren
id|gameport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|gameport_read
c_func
(paren
id|port-&gt;gameport
)paren
op_amp
id|port-&gt;mask
)paren
op_logical_and
(paren
id|u
OL
id|t
)paren
)paren
id|u
op_increment
suffix:semicolon
id|udelay
c_func
(paren
id|ANALOG_SAITEK_DELAY
)paren
suffix:semicolon
id|t
op_assign
id|gameport_time
c_func
(paren
id|gameport
comma
id|ANALOG_SAITEK_TIME
)paren
suffix:semicolon
id|gameport_trigger
c_func
(paren
id|gameport
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|gameport_read
c_func
(paren
id|port-&gt;gameport
)paren
op_amp
id|port-&gt;mask
)paren
op_logical_and
(paren
id|v
OL
id|t
)paren
)paren
id|v
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|v
OL
(paren
id|u
op_rshift
l_int|1
)paren
op_logical_and
id|port-&gt;gameport-&gt;number
OL
id|ANALOG_PORTS
)paren
(brace
id|analog_options
(braket
id|port-&gt;gameport-&gt;number
)braket
op_or_assign
id|ANALOG_SAITEK
op_or
id|ANALOG_BTNS_CHF
op_or
id|ANALOG_HBTN_CHF
op_or
id|ANALOG_HAT1_CHF
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gameport_close
c_func
(paren
id|gameport
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gameport_open
c_func
(paren
id|gameport
comma
id|dev
comma
id|GAMEPORT_MODE_COOKED
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ANALOG_INIT_RETRIES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|gameport_cooked_read
c_func
(paren
id|gameport
comma
id|port-&gt;axes
comma
op_amp
id|port-&gt;buttons
)paren
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|port-&gt;axes
(braket
id|i
)braket
op_ne
op_minus
l_int|1
)paren
id|port-&gt;mask
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
id|port-&gt;fuzz
op_assign
id|gameport-&gt;fuzz
suffix:semicolon
id|port-&gt;cooked
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gameport_open
c_func
(paren
id|gameport
comma
id|dev
comma
id|GAMEPORT_MODE_RAW
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|analog_connect
r_static
r_void
id|analog_connect
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_struct
id|gameport_dev
op_star
id|dev
)paren
(brace
r_struct
id|analog_port
op_star
id|port
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|port
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|analog_port
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|port
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|analog_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|analog_init_port
c_func
(paren
id|gameport
comma
id|dev
comma
id|port
)paren
)paren
(brace
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|analog_init_masks
c_func
(paren
id|port
)paren
)paren
(brace
id|gameport_close
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|port-&gt;analog
(braket
id|i
)braket
dot
id|mask
)paren
id|analog_init_device
c_func
(paren
id|port
comma
id|port-&gt;analog
op_plus
id|i
comma
id|i
)paren
suffix:semicolon
)brace
DECL|function|analog_disconnect
r_static
r_void
id|analog_disconnect
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|analog_port
op_star
id|port
op_assign
id|gameport
op_member_access_from_pointer
r_private
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|port-&gt;analog
(braket
id|i
)braket
dot
id|mask
)paren
id|input_unregister_device
c_func
(paren
op_amp
id|port-&gt;analog
(braket
id|i
)braket
dot
id|dev
)paren
suffix:semicolon
id|gameport_close
c_func
(paren
id|gameport
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;analog.c: %d out of %d reads (%d%%) on gameport%d failed&bslash;n&quot;
comma
id|port-&gt;bads
comma
id|port-&gt;reads
comma
id|port-&gt;reads
ques
c_cond
(paren
id|port-&gt;bads
op_star
l_int|100
op_div
id|port-&gt;reads
)paren
suffix:colon
l_int|0
comma
id|port-&gt;gameport-&gt;number
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|struct|analog_types
r_struct
id|analog_types
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|value
r_int
id|value
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|analog_types
r_struct
id|analog_types
id|analog_types
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;none&quot;
comma
l_int|0x00000000
)brace
comma
(brace
l_string|&quot;auto&quot;
comma
l_int|0x000000ff
)brace
comma
(brace
l_string|&quot;2btn&quot;
comma
l_int|0x0000003f
)brace
comma
(brace
l_string|&quot;y-joy&quot;
comma
l_int|0x0cc00033
)brace
comma
(brace
l_string|&quot;y-pad&quot;
comma
l_int|0x8cc80033
)brace
comma
(brace
l_string|&quot;fcs&quot;
comma
l_int|0x000008f7
)brace
comma
(brace
l_string|&quot;chf&quot;
comma
l_int|0x000002ff
)brace
comma
(brace
l_string|&quot;fullchf&quot;
comma
l_int|0x000007ff
)brace
comma
(brace
l_string|&quot;gamepad&quot;
comma
l_int|0x000830f3
)brace
comma
(brace
l_string|&quot;gamepad8&quot;
comma
l_int|0x0008f0f3
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|analog_parse_options
r_static
r_void
id|analog_parse_options
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_char
op_star
id|end
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ANALOG_PORTS
op_logical_and
id|js
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|analog_types
(braket
id|j
)braket
dot
id|name
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|analog_types
(braket
id|j
)braket
dot
id|name
comma
id|js
(braket
id|i
)braket
)paren
)paren
(brace
id|analog_options
(braket
id|i
)braket
op_assign
id|analog_types
(braket
id|j
)braket
dot
id|value
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|analog_types
(braket
id|j
)braket
dot
id|name
)paren
r_continue
suffix:semicolon
id|analog_options
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|js
(braket
id|i
)braket
comma
op_amp
id|end
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|end
op_ne
id|js
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|analog_options
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|js
(braket
id|i
)braket
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;analog.c: Bad config for port %d - &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|i
comma
id|js
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|ANALOG_PORTS
suffix:semicolon
id|i
op_increment
)paren
id|analog_options
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/*&n; * The gameport device structure.&n; */
DECL|variable|analog_dev
r_static
r_struct
id|gameport_dev
id|analog_dev
op_assign
(brace
id|connect
suffix:colon
id|analog_connect
comma
id|disconnect
suffix:colon
id|analog_disconnect
comma
)brace
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|analog_setup
r_static
r_int
id|__init
id|analog_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|s
op_assign
id|str
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|str
op_logical_or
op_logical_neg
op_star
id|str
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|str
op_assign
id|s
)paren
op_logical_and
(paren
id|i
OL
id|ANALOG_PORTS
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|s
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|s
op_increment
op_assign
l_int|0
suffix:semicolon
id|js
(braket
id|i
op_increment
)braket
op_assign
id|str
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;js=&quot;
comma
id|analog_setup
)paren
suffix:semicolon
macro_line|#endif
DECL|function|analog_init
r_int
id|__init
id|analog_init
c_func
(paren
r_void
)paren
(brace
id|analog_parse_options
c_func
(paren
)paren
suffix:semicolon
id|gameport_register_device
c_func
(paren
op_amp
id|analog_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|analog_exit
r_void
id|__exit
id|analog_exit
c_func
(paren
r_void
)paren
(brace
id|gameport_unregister_device
c_func
(paren
op_amp
id|analog_dev
)paren
suffix:semicolon
)brace
DECL|variable|analog_init
id|module_init
c_func
(paren
id|analog_init
)paren
suffix:semicolon
DECL|variable|analog_exit
id|module_exit
c_func
(paren
id|analog_exit
)paren
suffix:semicolon
eof
