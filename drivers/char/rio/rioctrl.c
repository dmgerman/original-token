multiline_comment|/*&n;** -----------------------------------------------------------------------------&n;**&n;**  Perle Specialix driver for Linux&n;**  Ported from existing RIO Driver for SCO sources.&n; *&n; *  (C) 1990 - 2000 Specialix International Ltd., Byfleet, Surrey, UK.&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;**&n;**&t;Module&t;&t;: rioctrl.c&n;**&t;SID&t;&t;: 1.3&n;**&t;Last Modified&t;: 11/6/98 10:33:42&n;**&t;Retrieved&t;: 11/6/98 10:33:49&n;**&n;**  ident @(#)rioctrl.c&t;1.3&n;**&n;** -----------------------------------------------------------------------------&n;*/
macro_line|#ifdef SCCS_LABELS
DECL|variable|_rioctrl_c_sccs_
r_static
r_char
op_star
id|_rioctrl_c_sccs_
op_assign
l_string|&quot;@(#)rioctrl.c&t;1.3&quot;
suffix:semicolon
macro_line|#endif
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/compatmac.h&gt;
macro_line|#include &lt;linux/generic_serial.h&gt;
macro_line|#include &quot;linux_compat.h&quot;
macro_line|#include &quot;rio_linux.h&quot;
macro_line|#include &quot;typdef.h&quot;
macro_line|#include &quot;pkt.h&quot;
macro_line|#include &quot;daemon.h&quot;
macro_line|#include &quot;rio.h&quot;
macro_line|#include &quot;riospace.h&quot;
macro_line|#include &quot;top.h&quot;
macro_line|#include &quot;cmdpkt.h&quot;
macro_line|#include &quot;map.h&quot;
macro_line|#include &quot;riotypes.h&quot;
macro_line|#include &quot;rup.h&quot;
macro_line|#include &quot;port.h&quot;
macro_line|#include &quot;riodrvr.h&quot;
macro_line|#include &quot;rioinfo.h&quot;
macro_line|#include &quot;func.h&quot;
macro_line|#include &quot;errors.h&quot;
macro_line|#include &quot;pci.h&quot;
macro_line|#include &quot;parmmap.h&quot;
macro_line|#include &quot;unixrup.h&quot;
macro_line|#include &quot;board.h&quot;
macro_line|#include &quot;host.h&quot;
macro_line|#include &quot;error.h&quot;
macro_line|#include &quot;phb.h&quot;
macro_line|#include &quot;link.h&quot;
macro_line|#include &quot;cmdblk.h&quot;
macro_line|#include &quot;route.h&quot;
macro_line|#include &quot;control.h&quot;
macro_line|#include &quot;cirrus.h&quot;
macro_line|#include &quot;rioioctl.h&quot;
DECL|variable|LpbReq
r_static
r_struct
id|LpbReq
id|LpbReq
suffix:semicolon
DECL|variable|RupReq
r_static
r_struct
id|RupReq
id|RupReq
suffix:semicolon
DECL|variable|PortReq
r_static
r_struct
id|PortReq
id|PortReq
suffix:semicolon
DECL|variable|HostReq
r_static
r_struct
id|HostReq
id|HostReq
suffix:semicolon
DECL|variable|HostDpRam
r_static
r_struct
id|HostDpRam
id|HostDpRam
suffix:semicolon
DECL|variable|DebugCtrl
r_static
r_struct
id|DebugCtrl
id|DebugCtrl
suffix:semicolon
DECL|variable|MapEnt
r_static
r_struct
id|Map
id|MapEnt
suffix:semicolon
DECL|variable|PortSetup
r_static
r_struct
id|PortSetup
id|PortSetup
suffix:semicolon
DECL|variable|DownLoad
r_static
r_struct
id|DownLoad
id|DownLoad
suffix:semicolon
DECL|variable|SendPack
r_static
r_struct
id|SendPack
id|SendPack
suffix:semicolon
multiline_comment|/* static struct StreamInfo&t;StreamInfo; */
multiline_comment|/* static char modemtable[RIO_PORTS]; */
DECL|variable|SpecialRupCmd
r_static
r_struct
id|SpecialRupCmd
id|SpecialRupCmd
suffix:semicolon
DECL|variable|PortParams
r_static
r_struct
id|PortParams
id|PortParams
suffix:semicolon
DECL|variable|portStats
r_static
r_struct
id|portStats
id|portStats
suffix:semicolon
DECL|struct|SubCmdStruct
r_static
r_struct
id|SubCmdStruct
(brace
DECL|member|Host
id|ushort
id|Host
suffix:semicolon
DECL|member|Rup
id|ushort
id|Rup
suffix:semicolon
DECL|member|Port
id|ushort
id|Port
suffix:semicolon
DECL|member|Addr
id|ushort
id|Addr
suffix:semicolon
DECL|variable|SubCmd
)brace
id|SubCmd
suffix:semicolon
DECL|struct|PortTty
r_struct
id|PortTty
(brace
DECL|member|port
id|uint
id|port
suffix:semicolon
DECL|member|Tty
r_struct
id|ttystatics
id|Tty
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|PortTty
r_static
r_struct
id|PortTty
id|PortTty
suffix:semicolon
DECL|typedef|TERMIO
r_typedef
r_struct
id|ttystatics
id|TERMIO
suffix:semicolon
multiline_comment|/*&n;** This table is used when the config.rio downloads bin code to the&n;** driver. We index the table using the product code, 0-F, and call&n;** the function pointed to by the entry, passing the information&n;** about the boot.&n;** The RIOBootCodeUNKNOWN entry is there to politely tell the calling&n;** process to bog off.&n;*/
r_static
r_int
DECL|variable|RIOBootTable
(paren
op_star
id|RIOBootTable
(braket
id|MAX_PRODUCT
)braket
)paren
(paren
r_struct
id|rio_info
op_star
comma
r_struct
id|DownLoad
op_star
)paren
op_assign
(brace
multiline_comment|/* 0 */
id|RIOBootCodeHOST
comma
multiline_comment|/* Host Card */
multiline_comment|/* 1 */
id|RIOBootCodeRTA
comma
multiline_comment|/* RTA */
)brace
suffix:semicolon
DECL|macro|drv_makedev
mdefine_line|#define drv_makedev(maj, min) ((((uint) maj &amp; 0xff) &lt;&lt; 8) | ((uint) min &amp; 0xff))
macro_line|#ifdef linux
DECL|function|copyin
r_int
id|copyin
(paren
r_int
id|arg
comma
id|caddr_t
id|dp
comma
r_int
id|siz
)paren
(brace
r_int
id|rv
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copying %d bytes from user %p to %p.&bslash;n&quot;
comma
id|siz
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|dp
)paren
suffix:semicolon
id|rv
op_assign
id|copy_from_user
(paren
id|dp
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|siz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
OL
l_int|0
)paren
r_return
id|COPYFAIL
suffix:semicolon
r_else
r_return
id|rv
suffix:semicolon
)brace
DECL|function|copyout
r_int
id|copyout
(paren
id|caddr_t
id|dp
comma
r_int
id|arg
comma
r_int
id|siz
)paren
(brace
r_int
id|rv
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copying %d bytes to user %p from %p.&bslash;n&quot;
comma
id|siz
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|dp
)paren
suffix:semicolon
id|rv
op_assign
id|copy_to_user
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|dp
comma
id|siz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
OL
l_int|0
)paren
r_return
id|COPYFAIL
suffix:semicolon
r_else
r_return
id|rv
suffix:semicolon
)brace
macro_line|#else
r_int
DECL|function|copyin
id|copyin
c_func
(paren
id|arg
comma
id|dp
comma
id|siz
)paren
r_int
id|arg
suffix:semicolon
id|caddr_t
id|dp
suffix:semicolon
r_int
id|siz
suffix:semicolon
(brace
r_if
c_cond
(paren
id|rbounds
(paren
(paren
r_int
r_int
)paren
id|arg
)paren
op_ge
id|siz
)paren
(brace
id|bcopy
(paren
id|arg
comma
id|dp
comma
id|siz
)paren
suffix:semicolon
r_return
id|OK
suffix:semicolon
)brace
r_else
r_return
(paren
id|COPYFAIL
)paren
suffix:semicolon
)brace
r_int
DECL|function|copyout
id|copyout
(paren
id|dp
comma
id|arg
comma
id|siz
)paren
id|caddr_t
id|dp
suffix:semicolon
r_int
id|arg
suffix:semicolon
r_int
id|siz
suffix:semicolon
(brace
r_if
c_cond
(paren
id|wbounds
(paren
(paren
r_int
r_int
)paren
id|arg
)paren
op_ge
id|siz
)paren
(brace
id|bcopy
(paren
id|dp
comma
id|arg
comma
id|siz
)paren
suffix:semicolon
r_return
id|OK
suffix:semicolon
)brace
r_else
r_return
(paren
id|COPYFAIL
)paren
suffix:semicolon
)brace
macro_line|#endif
r_int
DECL|function|riocontrol
id|riocontrol
c_func
(paren
id|p
comma
id|dev
comma
id|cmd
comma
id|arg
comma
id|su
)paren
r_struct
id|rio_info
op_star
id|p
suffix:semicolon
id|dev_t
id|dev
suffix:semicolon
r_int
id|cmd
suffix:semicolon
id|caddr_t
id|arg
suffix:semicolon
r_int
id|su
suffix:semicolon
(brace
id|uint
id|Host
suffix:semicolon
multiline_comment|/* leave me unsigned! */
id|uint
id|port
suffix:semicolon
multiline_comment|/* and me! */
r_struct
id|Host
op_star
id|HostP
suffix:semicolon
id|ushort
id|loop
suffix:semicolon
r_int
id|Entry
suffix:semicolon
r_struct
id|Port
op_star
id|PortP
suffix:semicolon
id|PKT
op_star
id|PacketP
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|func_enter
(paren
)paren
suffix:semicolon
multiline_comment|/* Confuse teh compiler to think that we&squot;ve initialized these */
id|Host
op_assign
l_int|0
suffix:semicolon
id|PortP
op_assign
l_int|NULL
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;control ioctl cmd: 0x%x arg: 0x%x&bslash;n&quot;
comma
id|cmd
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/*&n;&t;&t;** RIO_SET_TIMER&n;&t;&t;**&n;&t;&t;** Change the value of the host card interrupt timer.&n;&t;&t;** If the host card number is -1 then all host cards are changed&n;&t;&t;** otherwise just the specified host card will be changed.&n;&t;&t;*/
r_case
id|RIO_SET_TIMER
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET_TIMER to %dms&bslash;n&quot;
comma
(paren
id|uint
)paren
id|arg
)paren
suffix:semicolon
(brace
r_int
id|host
comma
id|value
suffix:semicolon
id|host
op_assign
(paren
id|uint
)paren
id|arg
op_rshift
l_int|16
suffix:semicolon
id|value
op_assign
(paren
id|uint
)paren
id|arg
op_amp
l_int|0x0000ffff
suffix:semicolon
r_if
c_cond
(paren
id|host
op_eq
op_minus
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|host
op_assign
l_int|0
suffix:semicolon
id|host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|host
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|host
)braket
dot
id|Flags
op_eq
id|RC_RUNNING
)paren
(brace
id|WWORD
c_func
(paren
id|p-&gt;RIOHosts
(braket
id|host
)braket
dot
id|ParmMapP-&gt;timer
comma
id|value
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|host
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
r_return
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|host
)braket
dot
id|Flags
op_eq
id|RC_RUNNING
)paren
(brace
id|WWORD
c_func
(paren
id|p-&gt;RIOHosts
(braket
id|host
)braket
dot
id|ParmMapP-&gt;timer
comma
id|value
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_IDENTIFY_DRIVER
suffix:colon
multiline_comment|/*&n;&t;&t;&t;** 15.10.1998 ARG - ESIL 0760 part fix&n;&t;&t;&t;** Added driver ident string output.&n;&t;&t;&t;**&n;#ifndef __THIS_RELEASE__&n;#warning Driver Version string not defined !&n;#endif&n;&t;&t;&t;cprintf(&quot;%s %s %s %s&bslash;n&quot;,&n;&t;&t;&t;&t;RIO_DRV_STR,&n;&t;&t;&t;&t;__THIS_RELEASE__,&n;&t;&t;&t;&t;__DATE__, __TIME__ );&n;&n;&t;&t;&t;return 0;&n;&n;&t;&t;case RIO_DISPLAY_HOST_CFG:&n;&t;&t;&t;**&n;&t;&t;&t;** 15.10.1998 ARG - ESIL 0760 part fix&n;&t;&t;&t;** Added driver host card ident string output.&n;&t;&t;&t;**&n;&t;&t;&t;** Note that the only types currently supported&n;&t;&t;&t;** are ISA and PCI. Also this driver does not&n;&t;&t;&t;** (yet) distinguish between the Old PCI card&n;&t;&t;&t;** and the Jet PCI card. In fact I think this&n;&t;&t;&t;** driver only supports JET PCI !&n;&t;&t;&t;**&n;&n;&t;&t;&t;for (Host = 0; Host &lt; p-&gt;RIONumHosts; Host++)&n;&t;&t;&t;{&n;&t;&t;&t;&t;HostP = &amp;(p-&gt;RIOHosts[Host]);&n;&n;&t;&t;&t;&t;switch ( HostP-&gt;Type )&n;&t;&t;&t;&t;{&n;&t;&t;&t;&t;    case RIO_AT :&n;&t;&t;&t;&t;&t;strcpy( host_type, RIO_AT_HOST_STR );&n;&t;&t;&t;&t;&t;break;&n;&n;&t;&t;&t;&t;    case RIO_PCI :&n;&t;&t;&t;&t;&t;strcpy( host_type, RIO_PCI_HOST_STR );&n;&t;&t;&t;&t;&t;break;&n;&n;&t;&t;&t;&t;    default :&n;&t;&t;&t;&t;&t;strcpy( host_type, &quot;Unknown&quot; );&n;&t;&t;&t;&t;&t;break;&n;&t;&t;&t;&t;}&n;&n;&t;&t;&t;&t;cprintf(&n;&t;&t;&t;&t;  &quot;RIO Host %d - Type:%s Addr:%X IRQ:%d&bslash;n&quot;,&n;&t;&t;&t;&t;&t;Host, host_type,&n;&t;&t;&t;&t;&t;(uint)HostP-&gt;PaddrP,&n;&t;&t;&t;&t;&t;(int)HostP-&gt;Ivec - 32  );&n;&t;&t;&t;}&n;&t;&t;&t;return 0;&n;&t;&t;&t;**&n;&t;&t;&t;*/
r_case
id|RIO_FOAD_RTA
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_FOAD_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RIOCommandRta
c_func
(paren
id|p
comma
(paren
id|uint
)paren
id|arg
comma
id|RIOFoadRta
)paren
suffix:semicolon
r_case
id|RIO_ZOMBIE_RTA
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_ZOMBIE_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RIOCommandRta
c_func
(paren
id|p
comma
(paren
id|uint
)paren
id|arg
comma
id|RIOZombieRta
)paren
suffix:semicolon
r_case
id|RIO_IDENTIFY_RTA
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_IDENTIFY_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RIOIdentifyRta
c_func
(paren
id|p
comma
id|arg
)paren
suffix:semicolon
r_case
id|RIO_KILL_NEIGHBOUR
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_KILL_NEIGHBOUR&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RIOKillNeighbour
c_func
(paren
id|p
comma
id|arg
)paren
suffix:semicolon
r_case
id|SPECIAL_RUP_CMD
suffix:colon
(brace
r_struct
id|CmdBlk
op_star
id|CmdBlkP
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;SPECIAL_RUP_CMD&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|SpecialRupCmd
comma
r_sizeof
(paren
id|SpecialRupCmd
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;SPECIAL_RUP_CMD copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|CmdBlkP
op_assign
id|RIOGetCmdBlk
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CmdBlkP
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;SPECIAL_RUP_CMD GetCmdBlk failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|CmdBlkP-&gt;Packet
op_assign
id|SpecialRupCmd.Packet
suffix:semicolon
r_if
c_cond
(paren
id|SpecialRupCmd.Host
op_ge
id|p-&gt;RIONumHosts
)paren
id|SpecialRupCmd.Host
op_assign
l_int|0
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue special rup command for host %d rup %d&bslash;n&quot;
comma
id|SpecialRupCmd.Host
comma
id|SpecialRupCmd.RupNum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RIOQueueCmdBlk
c_func
(paren
op_amp
id|p-&gt;RIOHosts
(braket
id|SpecialRupCmd.Host
)braket
comma
id|SpecialRupCmd.RupNum
comma
id|CmdBlkP
)paren
op_eq
id|RIO_FAIL
)paren
(brace
id|cprintf
c_func
(paren
l_string|&quot;FAILED TO QUEUE SPECIAL RUP COMMAND&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|RIO_DEBUG_MEM
suffix:colon
macro_line|#ifdef DEBUG_MEM_SUPPORT
id|RIO_DEBUG_CTRL
comma
r_if
c_cond
(paren
id|su
)paren
r_return
id|rio_RIODebugMemory
c_func
(paren
id|RIO_DEBUG_CTRL
comma
id|arg
)paren
suffix:semicolon
r_else
macro_line|#endif
r_return
id|EPERM
suffix:semicolon
r_case
id|RIO_ALL_MODEM
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_ALL_MODEM&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|IOCTL_COMMAND_UNKNOWN
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
r_case
id|RIO_GET_TABLE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Read the routing table from the device driver to user space&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_TABLE&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|RIOApel
c_func
(paren
id|p
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOConnectTable
comma
(paren
r_int
)paren
id|arg
comma
id|TOTAL_MAP_ENTRIES
op_star
r_sizeof
(paren
r_struct
id|Map
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_TABLE copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
(brace
r_int
id|entry
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;*****&bslash;nMAP ENTRIES&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|entry
op_assign
l_int|0
suffix:semicolon
id|entry
OL
id|TOTAL_MAP_ENTRIES
suffix:semicolon
id|entry
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|ID
op_eq
l_int|0
)paren
op_logical_and
(paren
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|HostUniqueNum
op_eq
l_int|0
)paren
op_logical_and
(paren
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|RtaUniqueNum
op_eq
l_int|0
)paren
)paren
r_continue
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.HostUniqueNum = 0x%x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|HostUniqueNum
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.RtaUniqueNum = 0x%x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|RtaUniqueNum
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.ID = 0x%x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|ID
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.ID2 = 0x%x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|ID2
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Flags = 0x%x&bslash;n&quot;
comma
id|entry
comma
(paren
r_int
)paren
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Flags
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.SysPort = 0x%x&bslash;n&quot;
comma
id|entry
comma
(paren
r_int
)paren
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|SysPort
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[0].Unit = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|0
)braket
dot
id|Unit
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[0].Link = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|0
)braket
dot
id|Link
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[1].Unit = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|1
)braket
dot
id|Unit
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[1].Link = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|1
)braket
dot
id|Link
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[2].Unit = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|2
)braket
dot
id|Unit
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[2].Link = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|2
)braket
dot
id|Link
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[3].Unit = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|3
)braket
dot
id|Unit
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Top[4].Link = %x&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Topology
(braket
l_int|3
)braket
dot
id|Link
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Map entry %d.Name = %s&bslash;n&quot;
comma
id|entry
comma
id|p-&gt;RIOConnectTable
(braket
id|entry
)braket
dot
id|Name
)paren
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;*****&bslash;nEND MAP ENTRIES&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|p-&gt;RIOQuickCheck
op_assign
id|NOT_CHANGED
suffix:semicolon
multiline_comment|/* a table has been gotten */
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_PUT_TABLE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Write the routing table to the device driver from user space&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_TABLE&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_TABLE !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOConnectTable
(braket
l_int|0
)braket
comma
id|TOTAL_MAP_ENTRIES
op_star
r_sizeof
(paren
r_struct
id|Map
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_TABLE copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/*&n;***********************************&n;&t;&t;&t;&t;{&n;&t;&t;&t;&t;&t;int entry;&n;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;*****&bslash;nMAP ENTRIES&bslash;n&quot;) );&n;&t;&t;&t;&t;&t;for ( entry=0; entry&lt;TOTAL_MAP_ENTRIES; entry++ )&n;&t;&t;&t;&t;&t;{&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.HostUniqueNum = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].HostUniqueNum ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.RtaUniqueNum = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].RtaUniqueNum ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.ID = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].ID ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.ID2 = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].ID2 ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Flags = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Flags ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.SysPort = 0x%x&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].SysPort ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[0].Unit = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[0].Unit ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[0].Link = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[0].Link ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[1].Unit = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[1].Unit ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[1].Link = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[1].Link ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[2].Unit = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[2].Unit ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[2].Link = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[2].Link ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[3].Unit = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[3].Unit ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Top[4].Link = %b&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Topology[3].Link ) );&n;&t;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;Map entry %d.Name = %s&bslash;n&quot;, entry, p-&gt;RIOConnectTable[entry].Name ) );&n;&t;&t;&t;&t;&t;}&n;&t;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL,  (&quot;*****&bslash;nEND MAP ENTRIES&bslash;n&quot;) );&n;&t;&t;&t;&t;}&n;***********************************&n;*/
r_return
id|RIONewTable
c_func
(paren
id|p
)paren
suffix:semicolon
r_case
id|RIO_GET_BINDINGS
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Send bindings table, containing unique numbers of RTAs owned&n;&t;&t;&t;&t;** by this system to user space&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_BINDINGS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_BINDINGS !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOBindTab
comma
(paren
r_int
)paren
id|arg
comma
(paren
r_sizeof
(paren
id|ulong
)paren
op_star
id|MAX_RTA_BINDINGS
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_BINDINGS copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_PUT_BINDINGS
suffix:colon
multiline_comment|/*&n;&t;&t;&t;** Receive a bindings table, containing unique numbers of RTAs owned&n;&t;&t;&t;** by this system&n;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_BINDINGS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_BINDINGS !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOBindTab
(braket
l_int|0
)braket
comma
(paren
r_sizeof
(paren
id|ulong
)paren
op_star
id|MAX_RTA_BINDINGS
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PUT_BINDINGS copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_BIND_RTA
suffix:colon
(brace
r_int
id|EmptySlot
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;** Bind this RTA to host, so that it will be booted by &n;&t;&t;&t;&t;&t;** host in &squot;boot owned RTAs&squot; mode.&n;&t;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_BIND_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_BIND_RTA !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Entry
op_assign
l_int|0
suffix:semicolon
id|Entry
OL
id|MAX_RTA_BINDINGS
suffix:semicolon
id|Entry
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|EmptySlot
op_eq
op_minus
l_int|1
)paren
op_logical_and
(paren
id|p-&gt;RIOBindTab
(braket
id|Entry
)braket
op_eq
l_int|0L
)paren
)paren
id|EmptySlot
op_assign
id|Entry
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;RIOBindTab
(braket
id|Entry
)braket
op_eq
(paren
r_int
)paren
id|arg
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t;** Already exists - delete&n;&t;&t;&t;&t;&t;&t;&t;*/
id|p-&gt;RIOBindTab
(braket
id|Entry
)braket
op_assign
l_int|0L
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Removing Rta %x from p-&gt;RIOBindTab&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t;&t;&t;&t;** Dosen&squot;t exist - add&n;&t;&t;&t;&t;&t;*/
r_if
c_cond
(paren
id|EmptySlot
op_ne
op_minus
l_int|1
)paren
(brace
id|p-&gt;RIOBindTab
(braket
id|EmptySlot
)braket
op_assign
(paren
r_int
)paren
id|arg
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Adding Rta %x to p-&gt;RIOBindTab&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;p-&gt;RIOBindTab full! - Rta %x not added&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|RIO_RESUME
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME&bslash;n&quot;
)paren
suffix:semicolon
id|port
op_assign
(paren
id|uint
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port
OL
l_int|0
)paren
op_logical_or
(paren
id|port
OG
l_int|511
)paren
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME: Bad port number %d&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|PortP
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PortP-&gt;Mapped
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME: Port %d not mapped&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NOT_MAPPED_INTO_SYSTEM
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|PortP-&gt;State
op_amp
(paren
id|RIO_LOPEN
op_or
id|RIO_MOPEN
)paren
)paren
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME: Port %d not open&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RIOPreemptiveCmd
c_func
(paren
id|p
comma
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
)paren
comma
id|RESUME
)paren
op_eq
id|RIO_FAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME failed&bslash;n&quot;
)paren
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|EBUSY
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESUME: Port %d resumed&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|PortP-&gt;State
op_or_assign
id|RIO_BUSY
suffix:semicolon
)brace
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_ASSIGN_RTA
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_ASSIGN_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_ASSIGN_RTA !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|MapEnt
comma
r_sizeof
(paren
id|MapEnt
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copy from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|RIOAssignRta
c_func
(paren
id|p
comma
op_amp
id|MapEnt
)paren
suffix:semicolon
r_case
id|RIO_CHANGE_NAME
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_CHANGE_NAME&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_CHANGE_NAME !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|MapEnt
comma
r_sizeof
(paren
id|MapEnt
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copy from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|RIOChangeName
c_func
(paren
id|p
comma
op_amp
id|MapEnt
)paren
suffix:semicolon
r_case
id|RIO_DELETE_RTA
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DELETE_RTA&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DELETE_RTA !Root&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|MapEnt
comma
r_sizeof
(paren
id|MapEnt
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copy from data space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|RIODeleteRta
c_func
(paren
id|p
comma
op_amp
id|MapEnt
)paren
suffix:semicolon
r_case
id|RIO_QUICK_CHECK
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** 09.12.1998 ARG - ESIL 0776 part fix&n;&t;&t;&t;&t;** A customer was using this to get the RTAs&n;&t;&t;&t;&t;** connect/disconnect status.&n;&t;&t;&t;&t;** RIOConCon() had been botched use RIOHalted&n;&t;&t;&t;&t;** to keep track of RTA connections and&n;&t;&t;&t;&t;** disconnections. That has been changed and&n;&t;&t;&t;&t;** RIORtaDisCons in the rio_info struct now&n;&t;&t;&t;&t;** does the job. So we need to return the value&n;&t;&t;&t;&t;** of RIORtaCons instead of RIOHalted.&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;if (copyout((caddr_t)&amp;p-&gt;RIOHalted,(int)arg,&n;&t;&t;&t;&t;&t;&t;&t;sizeof(uint))==COPYFAIL) {&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;*/
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIORtaDisCons
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|uint
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_LAST_ERROR
suffix:colon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOError
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|Error
)paren
)paren
op_eq
id|COPYFAIL
)paren
r_return
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_GET_LOG
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_LOG&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef LOGGING
id|RIOGetLog
c_func
(paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
id|EINVAL
suffix:semicolon
macro_line|#endif
r_case
id|RIO_GET_MODTYPE
suffix:colon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|port
comma
r_sizeof
(paren
id|uint
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Get module type for port %d&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
template_param
l_int|511
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_MODTYPE: Bad port number %d&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PortP-&gt;Mapped
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_MODTYPE: Port %d not mapped&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NOT_MAPPED_INTO_SYSTEM
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;** Return module type of port&n;&t;&t;&t;&t;*/
id|port
op_assign
id|PortP-&gt;HostP-&gt;UnixRups
(braket
id|PortP-&gt;RupNum
)braket
dot
id|ModTypes
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|port
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|uint
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;** 02.03.1999 ARG - ESIL 0820 fix&n;&t;&t;&t;** We are no longer using &quot;Boot Mode&quot;, so these ioctls&n;&t;&t;&t;** are not required :&n;&t;&t;&t;**&n;&t; &t;&t;case RIO_GET_BOOT_MODE :&n;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL, (&quot;Get boot mode - %x&bslash;n&quot;, p-&gt;RIOBootMode));&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;** Return boot state of system - BOOT_ALL, BOOT_OWN or BOOT_NONE&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;if (copyout((caddr_t)&amp;p-&gt;RIOBootMode, (int)arg, &n;&t;&t;&t;&t;&t;&t;sizeof(p-&gt;RIOBootMode)) == COPYFAIL) {&n;&t;&t; &t;&t;&t;p-&gt;RIOError.Error = COPYOUT_FAILED;&n;&t;&t; &t;&t;&t;return EFAULT;&n;&t;&t;&t;&t;}&n;&t;&t;&t;&t;return(0);&n;&t;&t;&t;&n; &t;&t;&t;case RIO_SET_BOOT_MODE :&n;&t;&t;&t;&t;p-&gt;RIOBootMode = (uint) arg;&n;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL, (&quot;Set boot mode to 0x%x&bslash;n&quot;, p-&gt;RIOBootMode));&n;&t;&t;&t;&t;return(0);&n;&t;&t;&t;**&n;&t;&t;&t;** End ESIL 0820 fix&n;&t;&t;&t;*/
r_case
id|RIO_BLOCK_OPENS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Opens block until booted&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Entry
op_assign
l_int|0
suffix:semicolon
id|Entry
OL
id|RIO_PORTS
suffix:semicolon
id|Entry
op_increment
)paren
(brace
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|p-&gt;RIOPortp
(braket
id|Entry
)braket
op_member_access_from_pointer
id|WaitUntilBooted
op_assign
l_int|1
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_SETUP_PORTS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Setup ports&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortSetup
comma
r_sizeof
(paren
id|PortSetup
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;EFAULT&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortSetup.From
OG
id|PortSetup.To
op_logical_or
id|PortSetup.To
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;ENXIO&quot;
)paren
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortSetup.XpCps
OG
id|p-&gt;RIOConf.MaxXpCps
op_logical_or
id|PortSetup.XpCps
OL
id|p-&gt;RIOConf.MinXpCps
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|XPRINT_CPS_OUT_OF_RANGE
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;EINVAL&quot;
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;RIOPortp
)paren
(brace
id|cprintf
c_func
(paren
l_string|&quot;No p-&gt;RIOPortp array!&bslash;n&quot;
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;No p-&gt;RIOPortp array!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;entering loop (%d %d)!&bslash;n&quot;
comma
id|PortSetup.From
comma
id|PortSetup.To
)paren
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
id|PortSetup.From
suffix:semicolon
id|loop
op_le
id|PortSetup.To
suffix:semicolon
id|loop
op_increment
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;in loop (%d)!&bslash;n&quot;
comma
id|loop
)paren
suffix:semicolon
macro_line|#if 0
id|PortP
op_assign
id|p-&gt;RIOPortp
(braket
id|loop
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PortP-&gt;TtyP
)paren
id|PortP-&gt;TtyP
op_assign
op_amp
id|p-&gt;channel
(braket
id|loop
)braket
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PortSetup.IxAny
)paren
id|PortP-&gt;Config
op_or_assign
id|RIO_IXANY
suffix:semicolon
r_else
id|PortP-&gt;Config
op_and_assign
op_complement
id|RIO_IXANY
suffix:semicolon
r_if
c_cond
(paren
id|PortSetup.IxOn
)paren
id|PortP-&gt;Config
op_or_assign
id|RIO_IXON
suffix:semicolon
r_else
id|PortP-&gt;Config
op_and_assign
op_complement
id|RIO_IXON
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; ** If the port needs to wait for all a processes output&n;&t;&t;&t;&t;&t; ** to drain before closing then this flag will be set.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|PortSetup.Drain
)paren
(brace
id|PortP-&gt;Config
op_or_assign
id|RIO_WAITDRAIN
suffix:semicolon
)brace
r_else
(brace
id|PortP-&gt;Config
op_and_assign
op_complement
id|RIO_WAITDRAIN
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; ** Store setings if locking or unlocking port or if the&n;&t;&t;&t;&t;&t; ** port is not locked, when setting the store option.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|PortP-&gt;Mapped
op_logical_and
(paren
(paren
id|PortSetup.Lock
op_logical_and
op_logical_neg
id|PortP-&gt;Lock
)paren
op_logical_or
(paren
op_logical_neg
id|PortP-&gt;Lock
op_logical_and
(paren
id|PortSetup.Store
op_logical_and
op_logical_neg
id|PortP-&gt;Store
)paren
)paren
)paren
)paren
(brace
id|PortP-&gt;StoredTty.iflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_iflag
suffix:semicolon
id|PortP-&gt;StoredTty.oflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_oflag
suffix:semicolon
id|PortP-&gt;StoredTty.cflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_cflag
suffix:semicolon
id|PortP-&gt;StoredTty.lflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_lflag
suffix:semicolon
id|PortP-&gt;StoredTty.line
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_line
suffix:semicolon
id|bcopy
c_func
(paren
id|PortP-&gt;TtyP-&gt;tm.c_cc
comma
id|PortP-&gt;StoredTty.cc
comma
id|NCC
op_plus
l_int|5
)paren
suffix:semicolon
)brace
id|PortP-&gt;Lock
op_assign
id|PortSetup.Lock
suffix:semicolon
id|PortP-&gt;Store
op_assign
id|PortSetup.Store
suffix:semicolon
id|PortP-&gt;Xprint.XpCps
op_assign
id|PortSetup.XpCps
suffix:semicolon
id|bcopy
c_func
(paren
id|PortSetup.XpOn
comma
id|PortP-&gt;Xprint.XpOn
comma
id|MAX_XP_CTRL_LEN
)paren
suffix:semicolon
id|bcopy
c_func
(paren
id|PortSetup.XpOff
comma
id|PortP-&gt;Xprint.XpOff
comma
id|MAX_XP_CTRL_LEN
)paren
suffix:semicolon
id|PortP-&gt;Xprint.XpOn
(braket
id|MAX_XP_CTRL_LEN
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|PortP-&gt;Xprint.XpOff
(braket
id|MAX_XP_CTRL_LEN
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|PortP-&gt;Xprint.XpLen
op_assign
id|RIOStrlen
c_func
(paren
id|PortP-&gt;Xprint.XpOn
)paren
op_plus
id|RIOStrlen
c_func
(paren
id|PortP-&gt;Xprint.XpOff
)paren
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;after loop (%d)!&bslash;n&quot;
comma
id|loop
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Retval:%x&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_GET_PORT_SETUP
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Get port setup&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortSetup
comma
r_sizeof
(paren
id|PortSetup
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortSetup.From
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|port
op_assign
id|PortSetup.To
op_assign
id|PortSetup.From
suffix:semicolon
id|PortSetup.IxAny
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_amp
id|RIO_IXANY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|PortSetup.IxOn
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_amp
id|RIO_IXON
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|PortSetup.Drain
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_amp
id|RIO_WAITDRAIN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|PortSetup.Store
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Store
suffix:semicolon
id|PortSetup.Lock
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Lock
suffix:semicolon
id|PortSetup.XpCps
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Xprint.XpCps
suffix:semicolon
id|bcopy
c_func
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Xprint.XpOn
comma
id|PortSetup.XpOn
comma
id|MAX_XP_CTRL_LEN
)paren
suffix:semicolon
id|bcopy
c_func
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Xprint.XpOff
comma
id|PortSetup.XpOff
comma
id|MAX_XP_CTRL_LEN
)paren
suffix:semicolon
id|PortSetup.XpOn
(braket
id|MAX_XP_CTRL_LEN
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|PortSetup.XpOff
(braket
id|MAX_XP_CTRL_LEN
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|PortSetup
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|PortSetup
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_GET_PORT_PARAMS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Get port params&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortParams
comma
r_sizeof
(paren
r_struct
id|PortParams
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortParams.Port
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|PortParams.Port
)braket
)paren
suffix:semicolon
id|PortParams.Config
op_assign
id|PortP-&gt;Config
suffix:semicolon
id|PortParams.State
op_assign
id|PortP-&gt;State
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Port %d&bslash;n&quot;
comma
id|PortParams.Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|PortParams
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|PortParams
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_GET_PORT_TTY
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Get port tty&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortTty
comma
r_sizeof
(paren
r_struct
id|PortTty
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortTty.port
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Port %d&bslash;n&quot;
comma
id|PortTty.port
)paren
suffix:semicolon
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|PortTty.port
)braket
)paren
suffix:semicolon
macro_line|#if 0
id|PortTty.Tty.tm.c_iflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_iflag
suffix:semicolon
id|PortTty.Tty.tm.c_oflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_oflag
suffix:semicolon
id|PortTty.Tty.tm.c_cflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_cflag
suffix:semicolon
id|PortTty.Tty.tm.c_lflag
op_assign
id|PortP-&gt;TtyP-&gt;tm.c_lflag
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|PortTty
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|PortTty
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_PORT_TTY
suffix:colon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortTty
comma
r_sizeof
(paren
r_struct
id|PortTty
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Set port %d tty&bslash;n&quot;
comma
id|PortTty.port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PortTty.port
op_ge
(paren
id|ushort
)paren
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|PortTty.port
)braket
)paren
suffix:semicolon
macro_line|#if 0
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|PortP-&gt;TtyP-&gt;tm.c_iflag
op_assign
id|PortTty.Tty.tm.c_iflag
suffix:semicolon
id|PortP-&gt;TtyP-&gt;tm.c_oflag
op_assign
id|PortTty.Tty.tm.c_oflag
suffix:semicolon
id|PortP-&gt;TtyP-&gt;tm.c_cflag
op_assign
id|PortTty.Tty.tm.c_cflag
suffix:semicolon
id|PortP-&gt;TtyP-&gt;tm.c_lflag
op_assign
id|PortTty.Tty.tm.c_lflag
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
id|RIOParam
c_func
(paren
id|PortP
comma
id|CONFIG
comma
id|PortP-&gt;State
op_amp
id|RIO_MODEM
comma
id|OK_TO_SLEEP
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_PORT_PARAMS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Set port params&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortParams
comma
r_sizeof
(paren
id|PortParams
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortParams.Port
op_ge
(paren
id|ushort
)paren
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|PortParams.Port
)braket
)paren
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|PortP-&gt;Config
op_assign
id|PortParams.Config
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_GET_PORT_STATS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GET_PORT_STATS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|portStats
comma
r_sizeof
(paren
r_struct
id|portStats
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|portStats.port
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|portStats.port
)braket
)paren
suffix:semicolon
id|portStats.gather
op_assign
id|PortP-&gt;statsGather
suffix:semicolon
id|portStats.txchars
op_assign
id|PortP-&gt;txchars
suffix:semicolon
id|portStats.rxchars
op_assign
id|PortP-&gt;rxchars
suffix:semicolon
id|portStats.opens
op_assign
id|PortP-&gt;opens
suffix:semicolon
id|portStats.closes
op_assign
id|PortP-&gt;closes
suffix:semicolon
id|portStats.ioctls
op_assign
id|PortP-&gt;ioctls
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|portStats
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|portStats
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_RESET_PORT_STATS
suffix:colon
id|port
op_assign
(paren
id|uint
)paren
id|arg
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_RESET_PORT_STATS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|port
)braket
)paren
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|PortP-&gt;txchars
op_assign
l_int|0
suffix:semicolon
id|PortP-&gt;rxchars
op_assign
l_int|0
suffix:semicolon
id|PortP-&gt;opens
op_assign
l_int|0
suffix:semicolon
id|PortP-&gt;closes
op_assign
l_int|0
suffix:semicolon
id|PortP-&gt;ioctls
op_assign
l_int|0
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_GATHER_PORT_STATS
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GATHER_PORT_STATS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|portStats
comma
r_sizeof
(paren
r_struct
id|portStats
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|portStats.port
op_ge
id|RIO_PORTS
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
(paren
id|p-&gt;RIOPortp
(braket
id|portStats.port
)braket
)paren
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|PortP-&gt;statsGather
op_assign
id|portStats.gather
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
macro_line|#ifdef DEBUG_SUPPORTED
r_case
id|RIO_READ_LEVELS
suffix:colon
(brace
r_int
id|num
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_READ_LEVELS&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|num
op_assign
l_int|0
suffix:semicolon
id|RIODbInf
(braket
id|num
)braket
dot
id|Flag
suffix:semicolon
id|num
op_increment
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;%d levels to copy&bslash;n&quot;
comma
id|num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|RIODbInf
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|DbInf
)paren
op_star
(paren
id|num
op_plus
l_int|1
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;ReadLevels Copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;%d levels to copied&bslash;n&quot;
comma
id|num
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#endif
r_case
id|RIO_READ_CONFIG
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_READ_CONFIG&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOConf
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|Conf
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_CONFIG
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET_CONFIG&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOConf
comma
r_sizeof
(paren
r_struct
id|Conf
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;** move a few value around&n;&t;&t;&t;&t;*/
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
r_if
c_cond
(paren
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Flags
op_amp
id|RUN_STATE
)paren
op_eq
id|RC_RUNNING
)paren
id|WWORD
c_func
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|ParmMapP-&gt;timer
comma
id|p-&gt;RIOConf.Timer
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_START_POLLER
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_START_POLLER&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
r_case
id|RIO_STOP_POLLER
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_STOP_POLLER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
id|p-&gt;RIOPolling
op_assign
id|NOT_POLLING
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SETDEBUG
suffix:colon
r_case
id|RIO_GETDEBUG
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SETDEBUG/RIO_GETDEBUG&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|DebugCtrl
comma
r_sizeof
(paren
id|DebugCtrl
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DebugCtrl.SysPort
op_eq
id|NO_PORT
)paren
(brace
r_if
c_cond
(paren
id|cmd
op_eq
id|RIO_SETDEBUG
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
id|p-&gt;rio_debug
op_assign
id|DebugCtrl.Debug
suffix:semicolon
id|p-&gt;RIODebugWait
op_assign
id|DebugCtrl.Wait
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Set global debug to 0x%x set wait to 0x%x&bslash;n&quot;
comma
id|p-&gt;rio_debug
comma
id|p-&gt;RIODebugWait
)paren
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Get global debug 0x%x wait 0x%x&bslash;n&quot;
comma
id|p-&gt;rio_debug
comma
id|p-&gt;RIODebugWait
)paren
suffix:semicolon
id|DebugCtrl.Debug
op_assign
id|p-&gt;rio_debug
suffix:semicolon
id|DebugCtrl.Wait
op_assign
id|p-&gt;RIODebugWait
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|DebugCtrl
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|DebugCtrl
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET/GET DEBUG: bad port number %d&bslash;n&quot;
comma
id|DebugCtrl.SysPort
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|DebugCtrl.SysPort
op_ge
id|RIO_PORTS
op_logical_and
id|DebugCtrl.SysPort
op_ne
id|NO_PORT
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET/GET DEBUG: bad port number %d&bslash;n&quot;
comma
id|DebugCtrl.SysPort
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|RIO_SETDEBUG
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|p-&gt;RIOPortp
(braket
id|DebugCtrl.SysPort
)braket
op_member_access_from_pointer
id|Debug
op_assign
id|DebugCtrl.Debug
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SETDEBUG 0x%x&bslash;n&quot;
comma
id|p-&gt;RIOPortp
(braket
id|DebugCtrl.SysPort
)braket
op_member_access_from_pointer
id|Debug
)paren
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GETDEBUG 0x%x&bslash;n&quot;
comma
id|p-&gt;RIOPortp
(braket
id|DebugCtrl.SysPort
)braket
op_member_access_from_pointer
id|Debug
)paren
suffix:semicolon
id|DebugCtrl.Debug
op_assign
id|p-&gt;RIOPortp
(braket
id|DebugCtrl.SysPort
)braket
op_member_access_from_pointer
id|Debug
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|DebugCtrl
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|DebugCtrl
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_GETDEBUG: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_VERSID
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Enquire about the release and version.&n;&t;&t;&t;&t;** We return MAX_VERSION_LEN bytes, being a&n;&t;&t;&t;&t;** textual null terminated string.&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_VERSID&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|RIOVersid
c_func
(paren
)paren
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|rioVersion
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_VERSID: Bad copy to user space (host=%d)&bslash;n&quot;
comma
id|Host
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;** !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&n;&t;&t;&t;** !! commented out previous &squot;RIO_VERSID&squot; functionality !!&n;&t;&t;&t;** !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&n;&t;&t;&t;**&n;&t;&t;&t;case RIO_VERSID:&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;** Enquire about the release and version.&n;&t;&t;&t;&t;** We return MAX_VERSION_LEN bytes, being a textual null&n;&t;&t;&t;&t;** terminated string.&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;rio_dprint(RIO_DEBUG_CTRL, (&quot;RIO_VERSID&bslash;n&quot;));&n;&t;&t;&t;&t;if (copyout((caddr_t)RIOVersid(), &n;&t;&t;&t;&t;&t;&t;(int)arg, MAX_VERSION_LEN ) == COPYFAIL ) {&n;&t;&t;&t;&t;&t; rio_dprint(RIO_DEBUG_CTRL, (&quot;RIO_VERSID: Bad copy to user space&bslash;n&quot;,Host));&n;&t;&t;&t;&t;&t; p-&gt;RIOError.Error = COPYOUT_FAILED;&n;&t;&t;&t;&t;&t; return EFAULT;&n;&t;&t;&t;&t;}&n;&t;&t;&t;&t;return retval;&n;&t;&t;&t;**&n;&t;&t;&t;** !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&n;&t;&t;&t;*/
r_case
id|RIO_NUM_HOSTS
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Enquire as to the number of hosts located&n;&t;&t;&t;&t;** at init time.&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_NUM_HOSTS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIONumHosts
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|p-&gt;RIONumHosts
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_NUM_HOSTS: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_FOAD
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** Kill host. This may not be in the final version...&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_FOAD %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_FOAD: Not super user&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
id|p-&gt;RIOHalted
op_assign
l_int|1
suffix:semicolon
id|p-&gt;RIOSystemUp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
(brace
(paren
r_void
)paren
id|RIOBoardTest
c_func
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|PaddrP
comma
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Caddr
comma
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Type
comma
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Slot
)paren
suffix:semicolon
id|bzero
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Flags
comma
(paren
(paren
r_int
)paren
op_amp
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|____end_marker____
)paren
op_minus
(paren
(paren
r_int
)paren
op_amp
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Flags
)paren
)paren
suffix:semicolon
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Flags
op_assign
id|RC_WAITING
suffix:semicolon
macro_line|#if 0
id|RIOSetupDataStructs
c_func
(paren
id|p
)paren
suffix:semicolon
macro_line|#endif
)brace
id|RIOFoadWakeup
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;RIONumBootPkts
op_assign
l_int|0
suffix:semicolon
id|p-&gt;RIOBooting
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef RINGBUFFER_SUPPORT
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
id|RIO_PORTS
suffix:semicolon
id|loop
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;RIOPortp
(braket
id|loop
)braket
op_member_access_from_pointer
id|TxRingBuffer
)paren
id|sysfree
c_func
(paren
(paren
r_void
op_star
)paren
id|p-&gt;RIOPortp
(braket
id|loop
)braket
op_member_access_from_pointer
id|TxRingBuffer
comma
id|RIOBufferSize
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if 0
id|bzero
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOPortp
(braket
l_int|0
)braket
comma
id|RIO_PORTS
op_star
r_sizeof
(paren
r_struct
id|Port
)paren
)paren
suffix:semicolon
macro_line|#else
id|printk
(paren
l_string|&quot;HEEEEELP!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
id|RIO_PORTS
suffix:semicolon
id|loop
op_increment
)paren
(brace
macro_line|#if 0
id|p-&gt;RIOPortp
(braket
id|loop
)braket
op_member_access_from_pointer
id|TtyP
op_assign
op_amp
id|p-&gt;channel
(braket
id|loop
)braket
suffix:semicolon
macro_line|#endif
id|p-&gt;RIOPortp
(braket
id|loop
)braket
op_member_access_from_pointer
id|portSem
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|p-&gt;RIOPortp
(braket
id|loop
)braket
op_member_access_from_pointer
id|InUse
op_assign
id|NOT_INUSE
suffix:semicolon
)brace
id|p-&gt;RIOSystemUp
op_assign
l_int|0
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_DOWNLOAD
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DOWNLOAD&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|su
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DOWNLOAD: Not super user&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NOT_SUPER_USER
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|DownLoad
comma
r_sizeof
(paren
id|DownLoad
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DOWNLOAD: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Copied in download code for product code 0x%x&bslash;n&quot;
comma
id|DownLoad.ProductCode
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;** It is important that the product code is an unsigned object!&n;&t;&t;&t;&t;*/
r_if
c_cond
(paren
id|DownLoad.ProductCode
OG
id|MAX_PRODUCT
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_DOWNLOAD: Bad product code %d passed&bslash;n&quot;
comma
id|DownLoad.ProductCode
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|NO_SUCH_PRODUCT
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;** do something!&n;&t;&t;&t;&t;*/
id|retval
op_assign
(paren
op_star
(paren
id|RIOBootTable
(braket
id|DownLoad.ProductCode
)braket
)paren
)paren
(paren
id|p
comma
op_amp
id|DownLoad
)paren
suffix:semicolon
multiline_comment|/* &lt;-- Panic */
id|p-&gt;RIOHalted
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;** and go back, content with a job well completed.&n;&t;&t;&t;&t;*/
r_return
id|retval
suffix:semicolon
r_case
id|RIO_PARMS
suffix:colon
(brace
id|uint
id|host
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|host
comma
r_sizeof
(paren
id|host
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_REQ: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;&t;** Fetch the parmmap&n;&t;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PARMS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOHosts
(braket
id|host
)braket
dot
id|ParmMapP
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|PARM_MAP
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_PARMS: Copy out to user space failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_REQ
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_REQ&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|HostReq
comma
r_sizeof
(paren
id|HostReq
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_REQ: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HostReq.HostNum
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_REQ: Illegal host number %d&bslash;n&quot;
comma
id|HostReq.HostNum
)paren
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for host %d&bslash;n&quot;
comma
id|HostReq.HostNum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOHosts
(braket
id|HostReq.HostNum
)braket
comma
(paren
r_int
)paren
id|HostReq.HostP
comma
r_sizeof
(paren
r_struct
id|Host
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_REQ: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_DPRAM
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for DPRAM&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|HostDpRam
comma
r_sizeof
(paren
id|HostDpRam
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_DPRAM: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HostDpRam.HostNum
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_DPRAM: Illegal host number %d&bslash;n&quot;
comma
id|HostDpRam.HostNum
)paren
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for host %d&bslash;n&quot;
comma
id|HostDpRam.HostNum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|HostDpRam.HostNum
)braket
dot
id|Type
op_eq
id|RIO_PCI
)paren
(brace
r_int
id|off
suffix:semicolon
multiline_comment|/* It&squot;s hardware like this that really gets on my tits. */
r_static
r_int
r_char
id|copy
(braket
r_sizeof
(paren
r_struct
id|DpRam
)paren
)braket
suffix:semicolon
r_for
c_loop
(paren
id|off
op_assign
l_int|0
suffix:semicolon
id|off
OL
r_sizeof
(paren
r_struct
id|DpRam
)paren
suffix:semicolon
id|off
op_increment
)paren
id|copy
(braket
id|off
)braket
op_assign
id|p-&gt;RIOHosts
(braket
id|HostDpRam.HostNum
)braket
dot
id|Caddr
(braket
id|off
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|copy
comma
(paren
r_int
)paren
id|HostDpRam.DpRamP
comma
r_sizeof
(paren
r_struct
id|DpRam
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_DPRAM: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOHosts
(braket
id|HostDpRam.HostNum
)braket
dot
id|Caddr
comma
(paren
r_int
)paren
id|HostDpRam.DpRamP
comma
r_sizeof
(paren
r_struct
id|DpRam
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_DPRAM: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_BUSY
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET_BUSY&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|arg
template_param
l_int|511
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SET_BUSY: Bad port number %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
id|p-&gt;RIOPortp
(braket
(paren
r_int
)paren
id|arg
)braket
op_member_access_from_pointer
id|State
op_or_assign
id|RIO_BUSY
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_PORT
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** The daemon want port information&n;&t;&t;&t;&t;** (probably for debug reasons)&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_PORT&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|PortReq
comma
r_sizeof
(paren
id|PortReq
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_PORT: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PortReq.SysPort
op_ge
id|RIO_PORTS
)paren
(brace
multiline_comment|/* SysPort is unsigned */
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_PORT: Illegal port number %d&bslash;n&quot;
comma
id|PortReq.SysPort
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for port %d&bslash;n&quot;
comma
id|PortReq.SysPort
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOPortp
(braket
id|PortReq.SysPort
)braket
comma
(paren
r_int
)paren
id|PortReq.PortP
comma
r_sizeof
(paren
r_struct
id|Port
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_PORT: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_RUP
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** The daemon want rup information&n;&t;&t;&t;&t;** (probably for debug reasons)&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|RupReq
comma
r_sizeof
(paren
id|RupReq
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP: Copy in from user space failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RupReq.HostNum
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
multiline_comment|/* host is unsigned */
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP: Illegal host number %d&bslash;n&quot;
comma
id|RupReq.HostNum
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RupReq.RupNum
op_ge
id|MAX_RUP
op_plus
id|LINKS_PER_UNIT
)paren
(brace
multiline_comment|/* eek! */
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP: Illegal rup number %d&bslash;n&quot;
comma
id|RupReq.RupNum
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|RUP_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|HostP
op_assign
op_amp
id|p-&gt;RIOHosts
(braket
id|RupReq.HostNum
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|HostP-&gt;Flags
op_amp
id|RUN_STATE
)paren
op_ne
id|RC_RUNNING
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP: Host %d not running&bslash;n&quot;
comma
id|RupReq.HostNum
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|HOST_NOT_RUNNING
suffix:semicolon
r_return
id|EIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for rup %d from host %d&bslash;n&quot;
comma
id|RupReq.RupNum
comma
id|RupReq.HostNum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|HostP-&gt;UnixRups
(braket
id|RupReq.RupNum
)braket
dot
id|RupP
comma
(paren
r_int
)paren
id|RupReq.RupP
comma
r_sizeof
(paren
r_struct
id|RUP
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_RUP: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_case
id|RIO_HOST_LPB
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;** The daemon want lpb information&n;&t;&t;&t;&t;** (probably for debug reasons)&n;&t;&t;&t;&t;*/
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|LpbReq
comma
r_sizeof
(paren
id|LpbReq
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB: Bad copy from user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LpbReq.Host
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
multiline_comment|/* host is unsigned */
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB: Illegal host number %d&bslash;n&quot;
comma
id|LpbReq.Host
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LpbReq.Link
op_ge
id|LINKS_PER_UNIT
)paren
(brace
multiline_comment|/* eek! */
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB: Illegal link number %d&bslash;n&quot;
comma
id|LpbReq.Link
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|LINK_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|HostP
op_assign
op_amp
id|p-&gt;RIOHosts
(braket
id|LpbReq.Host
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|HostP-&gt;Flags
op_amp
id|RUN_STATE
)paren
op_ne
id|RC_RUNNING
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB: Host %d not running&bslash;n&quot;
comma
id|LpbReq.Host
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|HOST_NOT_RUNNING
suffix:semicolon
r_return
id|EIO
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Request for lpb %d from host %d&bslash;n&quot;
comma
id|LpbReq.Link
comma
id|LpbReq.Host
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|HostP-&gt;LinkStrP
(braket
id|LpbReq.Link
)braket
comma
(paren
r_int
)paren
id|LpbReq.LpbP
comma
r_sizeof
(paren
r_struct
id|LPB
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_HOST_LPB: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;** Here 3 IOCTL&squot;s that allow us to change the way in which&n;&t;&t;&t;&t;** rio logs errors. send them just to syslog or send them&n;&t;&t;&t;&t;** to both syslog and console or send them to just the console.&n;&t;&t;&t;&t;**&n;&t;&t;&t;&t;** See RioStrBuf() in util.c for the other half.&n;&t;&t;&t;&t;*/
r_case
id|RIO_SYSLOG_ONLY
suffix:colon
id|p-&gt;RIOPrintLogState
op_assign
id|PRINT_TO_LOG
suffix:semicolon
multiline_comment|/* Just syslog */
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_SYSLOG_CONS
suffix:colon
id|p-&gt;RIOPrintLogState
op_assign
id|PRINT_TO_LOG_CONS
suffix:semicolon
multiline_comment|/* syslog and console */
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_CONS_ONLY
suffix:colon
id|p-&gt;RIOPrintLogState
op_assign
id|PRINT_TO_CONS
suffix:semicolon
multiline_comment|/* Just console */
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_SIGNALS_ON
suffix:colon
r_if
c_cond
(paren
id|p-&gt;RIOSignalProcess
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|SIGNALS_ALREADY_SET
suffix:semicolon
r_return
id|EBUSY
suffix:semicolon
)brace
id|p-&gt;RIOSignalProcess
op_assign
id|getpid
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;RIOPrintDisabled
op_assign
id|DONT_PRINT
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SIGNALS_OFF
suffix:colon
r_if
c_cond
(paren
id|p-&gt;RIOSignalProcess
op_ne
id|getpid
c_func
(paren
)paren
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|NOT_RECEIVING_PROCESS
suffix:semicolon
r_return
id|EPERM
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Clear signal process to zero&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOSignalProcess
op_assign
l_int|0
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_BYTE_MODE
suffix:colon
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Type
op_eq
id|RIO_AT
)paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Mode
op_and_assign
op_complement
id|WORD_OPERATION
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_WORD_MODE
suffix:colon
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Type
op_eq
id|RIO_AT
)paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Mode
op_or_assign
id|WORD_OPERATION
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_FAST_BUS
suffix:colon
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Type
op_eq
id|RIO_AT
)paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Mode
op_or_assign
id|FAST_AT_BUS
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_SET_SLOW_BUS
suffix:colon
r_for
c_loop
(paren
id|Host
op_assign
l_int|0
suffix:semicolon
id|Host
OL
id|p-&gt;RIONumHosts
suffix:semicolon
id|Host
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Type
op_eq
id|RIO_AT
)paren
id|p-&gt;RIOHosts
(braket
id|Host
)braket
dot
id|Mode
op_and_assign
op_complement
id|FAST_AT_BUS
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_MAP_B50_TO_50
suffix:colon
r_case
id|RIO_MAP_B50_TO_57600
suffix:colon
r_case
id|RIO_MAP_B110_TO_110
suffix:colon
r_case
id|RIO_MAP_B110_TO_115200
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Baud rate mapping&bslash;n&quot;
)paren
suffix:semicolon
id|port
op_assign
(paren
id|uint
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|port
template_param
l_int|511
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Baud rate mapping: Bad port number %d&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|RIO_MAP_B50_TO_50
suffix:colon
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_or_assign
id|RIO_MAP_50_TO_50
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RIO_MAP_B50_TO_57600
suffix:colon
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_and_assign
op_complement
id|RIO_MAP_50_TO_50
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RIO_MAP_B110_TO_110
suffix:colon
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_or_assign
id|RIO_MAP_110_TO_110
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RIO_MAP_B110_TO_115200
suffix:colon
id|p-&gt;RIOPortp
(braket
id|port
)braket
op_member_access_from_pointer
id|Config
op_and_assign
op_complement
id|RIO_MAP_110_TO_110
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_STREAM_INFO
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_STREAM_INFO&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
r_case
id|RIO_SEND_PACKET
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SEND_PACKET&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|SendPack
comma
r_sizeof
(paren
id|SendPack
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_SEND_PACKET: Bad copy from user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SendPack.PortNum
op_ge
l_int|128
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
id|PortP
op_assign
id|p-&gt;RIOPortp
(braket
id|SendPack.PortNum
)braket
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|can_add_transmit
c_func
(paren
op_amp
id|PacketP
comma
id|PortP
)paren
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|UNIT_IS_IN_USE
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|ENOSPC
suffix:semicolon
)brace
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
(paren
id|ushort
)paren
(paren
id|SendPack.Len
op_amp
l_int|127
)paren
suffix:semicolon
id|loop
op_increment
)paren
id|WBYTE
c_func
(paren
id|PacketP-&gt;data
(braket
id|loop
)braket
comma
id|SendPack.Data
(braket
id|loop
)braket
)paren
suffix:semicolon
id|WBYTE
c_func
(paren
id|PacketP-&gt;len
comma
id|SendPack.Len
)paren
suffix:semicolon
id|add_transmit
c_func
(paren
id|PortP
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;** Count characters transmitted for port statistics reporting&n;&t;&t;&t;&t;*/
r_if
c_cond
(paren
id|PortP-&gt;statsGather
)paren
id|PortP-&gt;txchars
op_add_assign
(paren
id|SendPack.Len
op_amp
l_int|127
)paren
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
id|RIO_NO_MESG
suffix:colon
r_if
c_cond
(paren
id|su
)paren
id|p-&gt;RIONoMessage
op_assign
l_int|1
suffix:semicolon
r_return
id|su
ques
c_cond
l_int|0
suffix:colon
id|EPERM
suffix:semicolon
r_case
id|RIO_MESG
suffix:colon
r_if
c_cond
(paren
id|su
)paren
id|p-&gt;RIONoMessage
op_assign
l_int|0
suffix:semicolon
r_return
id|su
ques
c_cond
l_int|0
suffix:colon
id|EPERM
suffix:semicolon
r_case
id|RIO_WHAT_MESG
suffix:colon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIONoMessage
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|p-&gt;RIONoMessage
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_WHAT_MESG: Bad copy to user space&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_MEM_DUMP
suffix:colon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|SubCmd
comma
r_sizeof
(paren
r_struct
id|SubCmdStruct
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_MEM_DUMP host %d rup %d addr %x&bslash;n&quot;
comma
id|SubCmd.Host
comma
id|SubCmd.Rup
comma
id|SubCmd.Addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SubCmd.Rup
op_ge
id|MAX_RUP
op_plus
id|LINKS_PER_UNIT
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|RUP_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SubCmd.Host
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|port
op_assign
id|p-&gt;RIOHosts
(braket
id|SubCmd.Host
)braket
dot
id|UnixRups
(braket
id|SubCmd.Rup
)braket
dot
id|BaseSysPort
suffix:semicolon
id|PortP
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RIOPreemptiveCmd
c_func
(paren
id|p
comma
id|PortP
comma
id|MEMDUMP
)paren
op_eq
id|RIO_FAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_MEM_DUMP failed&bslash;n&quot;
)paren
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|EBUSY
suffix:semicolon
)brace
r_else
id|PortP-&gt;State
op_or_assign
id|RIO_BUSY
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
id|p-&gt;RIOMemDump
comma
(paren
r_int
)paren
id|arg
comma
id|MEMDUMP_SIZE
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_MEM_DUMP copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_TICK
suffix:colon
r_if
c_cond
(paren
(paren
r_int
)paren
id|arg
OL
l_int|0
op_logical_or
(paren
r_int
)paren
id|arg
op_ge
id|p-&gt;RIONumHosts
)paren
r_return
id|EINVAL
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Set interrupt for host %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|WBYTE
c_func
(paren
id|p-&gt;RIOHosts
(braket
(paren
r_int
)paren
id|arg
)braket
dot
id|SetInt
comma
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_TOCK
suffix:colon
r_if
c_cond
(paren
(paren
r_int
)paren
id|arg
OL
l_int|0
op_logical_or
(paren
r_int
)paren
id|arg
op_ge
id|p-&gt;RIONumHosts
)paren
r_return
id|EINVAL
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Clear interrupt for host %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|WBYTE
c_func
(paren
(paren
id|p-&gt;RIOHosts
(braket
(paren
r_int
)paren
id|arg
)braket
dot
id|ResetInt
)paren
comma
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_READ_CHECK
suffix:colon
multiline_comment|/* Check reads for pkts with data[0] the same */
id|p-&gt;RIOReadCheck
op_assign
op_logical_neg
id|p-&gt;RIOReadCheck
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;RIOReadCheck
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|uint
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|RIO_READ_REGISTER
suffix:colon
r_if
c_cond
(paren
id|copyin
c_func
(paren
(paren
r_int
)paren
id|arg
comma
(paren
id|caddr_t
)paren
op_amp
id|SubCmd
comma
r_sizeof
(paren
r_struct
id|SubCmdStruct
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|COPYIN_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_READ_REGISTER host %d rup %d port %d reg %x&bslash;n&quot;
comma
id|SubCmd.Host
comma
id|SubCmd.Rup
comma
id|SubCmd.Port
comma
id|SubCmd.Addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SubCmd.Port
OG
l_int|511
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Baud rate mapping: Bad port number %d&bslash;n&quot;
comma
id|SubCmd.Port
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|PORT_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SubCmd.Rup
op_ge
id|MAX_RUP
op_plus
id|LINKS_PER_UNIT
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|RUP_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SubCmd.Host
op_ge
id|p-&gt;RIONumHosts
)paren
(brace
id|p-&gt;RIOError.Error
op_assign
id|HOST_NUMBER_OUT_OF_RANGE
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
id|port
op_assign
id|p-&gt;RIOHosts
(braket
id|SubCmd.Host
)braket
dot
id|UnixRups
(braket
id|SubCmd.Rup
)braket
dot
id|BaseSysPort
op_plus
id|SubCmd.Port
suffix:semicolon
id|PortP
op_assign
id|p-&gt;RIOPortp
(braket
id|port
)braket
suffix:semicolon
id|rio_spin_lock_irqsave
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RIOPreemptiveCmd
c_func
(paren
id|p
comma
id|PortP
comma
id|READ_REGISTER
)paren
op_eq
id|RIO_FAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_READ_REGISTER failed&bslash;n&quot;
)paren
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_return
id|EBUSY
suffix:semicolon
)brace
r_else
id|PortP-&gt;State
op_or_assign
id|RIO_BUSY
suffix:semicolon
id|rio_spin_unlock_irqrestore
c_func
(paren
op_amp
id|PortP-&gt;portSem
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copyout
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|p-&gt;CdRegister
comma
(paren
r_int
)paren
id|arg
comma
r_sizeof
(paren
id|uint
)paren
)paren
op_eq
id|COPYFAIL
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;RIO_READ_REGISTER copy failed&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|COPYOUT_FAILED
suffix:semicolon
r_return
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;** rio_make_dev: given port number (0-511) ORed with port type&n;&t;&t;&t;&t;** (RIO_DEV_DIRECT, RIO_DEV_MODEM, RIO_DEV_XPRINT) return dev_t&n;&t;&t;&t;&t;** value to pass to mknod to create the correct device node.&n;&t;&t;&t;&t;*/
r_case
id|RIO_MAKE_DEV
suffix:colon
(brace
id|uint
id|port
op_assign
(paren
id|uint
)paren
id|arg
op_amp
id|RIO_MODEM_MASK
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|uint
)paren
id|arg
op_amp
id|RIO_DEV_MASK
)paren
(brace
r_case
id|RIO_DEV_DIRECT
suffix:colon
id|arg
op_assign
(paren
id|caddr_t
)paren
id|drv_makedev
c_func
(paren
id|major
c_func
(paren
id|dev
)paren
comma
id|port
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Makedev direct 0x%x is 0x%x&bslash;n&quot;
comma
id|port
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|arg
suffix:semicolon
r_case
id|RIO_DEV_MODEM
suffix:colon
id|arg
op_assign
(paren
id|caddr_t
)paren
id|drv_makedev
c_func
(paren
id|major
c_func
(paren
id|dev
)paren
comma
(paren
id|port
op_or
id|RIO_MODEM_BIT
)paren
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Makedev modem 0x%x is 0x%x&bslash;n&quot;
comma
id|port
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|arg
suffix:semicolon
r_case
id|RIO_DEV_XPRINT
suffix:colon
id|arg
op_assign
(paren
id|caddr_t
)paren
id|drv_makedev
c_func
(paren
id|major
c_func
(paren
id|dev
)paren
comma
id|port
)paren
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Makedev printer 0x%x is 0x%x&bslash;n&quot;
comma
id|port
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|arg
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;MAKE Device is called&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;** rio_minor: given a dev_t from a stat() call, return&n;&t;&t;&t;&t;** the port number (0-511) ORed with the port type&n;&t;&t;&t;&t;** ( RIO_DEV_DIRECT, RIO_DEV_MODEM, RIO_DEV_XPRINT )&n;&t;&t;&t;&t;*/
r_case
id|RIO_MINOR
suffix:colon
(brace
id|dev_t
id|dv
suffix:semicolon
r_int
id|mino
suffix:semicolon
id|dv
op_assign
(paren
id|dev_t
)paren
(paren
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|mino
op_assign
id|RIO_UNMODEM
c_func
(paren
id|dv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RIO_ISMODEM
c_func
(paren
id|dv
)paren
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Minor for device 0x%x: modem %d&bslash;n&quot;
comma
id|dv
comma
id|mino
)paren
suffix:semicolon
id|arg
op_assign
(paren
id|caddr_t
)paren
(paren
id|mino
op_or
id|RIO_DEV_MODEM
)paren
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Minor for device 0x%x: direct %d&bslash;n&quot;
comma
id|dv
comma
id|mino
)paren
suffix:semicolon
id|arg
op_assign
(paren
id|caddr_t
)paren
(paren
id|mino
op_or
id|RIO_DEV_DIRECT
)paren
suffix:semicolon
)brace
r_return
(paren
r_int
)paren
id|arg
suffix:semicolon
)brace
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;INVALID DAEMON IOCTL 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
id|p-&gt;RIOError.Error
op_assign
id|IOCTL_COMMAND_UNKNOWN
suffix:semicolon
id|func_exit
(paren
)paren
suffix:semicolon
r_return
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;** Pre-emptive commands go on RUPs and are only one byte long.&n;*/
r_int
DECL|function|RIOPreemptiveCmd
id|RIOPreemptiveCmd
c_func
(paren
id|p
comma
id|PortP
comma
id|Cmd
)paren
r_struct
id|rio_info
op_star
id|p
suffix:semicolon
r_struct
id|Port
op_star
id|PortP
suffix:semicolon
id|uchar
id|Cmd
suffix:semicolon
(brace
r_struct
id|CmdBlk
op_star
id|CmdBlkP
suffix:semicolon
r_struct
id|PktCmd_M
op_star
id|PktCmdP
suffix:semicolon
r_int
id|Ret
suffix:semicolon
id|ushort
id|rup
suffix:semicolon
r_int
id|port
suffix:semicolon
macro_line|#ifdef CHECK
id|CheckPortP
c_func
(paren
id|PortP
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|PortP-&gt;State
op_amp
id|RIO_DELETED
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Preemptive command to deleted RTA ignored&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RIO_FAIL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
r_int
)paren
(paren
(paren
r_char
)paren
id|PortP-&gt;InUse
)paren
op_eq
op_minus
l_int|1
)paren
op_logical_or
op_logical_neg
(paren
id|CmdBlkP
op_assign
id|RIOGetCmdBlk
c_func
(paren
)paren
)paren
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Cannot allocate command block for command %d on port %d&bslash;n&quot;
comma
id|Cmd
comma
id|PortP-&gt;PortNum
)paren
suffix:semicolon
r_return
id|RIO_FAIL
suffix:semicolon
)brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Command blk 0x%x - InUse now %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
comma
id|PortP-&gt;InUse
)paren
suffix:semicolon
id|PktCmdP
op_assign
(paren
r_struct
id|PktCmd_M
op_star
)paren
op_amp
id|CmdBlkP-&gt;Packet.data
(braket
l_int|0
)braket
suffix:semicolon
id|CmdBlkP-&gt;Packet.src_unit
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|PortP-&gt;SecondBlock
)paren
id|rup
op_assign
id|PortP-&gt;ID2
suffix:semicolon
r_else
id|rup
op_assign
id|PortP-&gt;RupNum
suffix:semicolon
id|CmdBlkP-&gt;Packet.dest_unit
op_assign
id|rup
suffix:semicolon
id|CmdBlkP-&gt;Packet.src_port
op_assign
id|COMMAND_RUP
suffix:semicolon
id|CmdBlkP-&gt;Packet.dest_port
op_assign
id|COMMAND_RUP
suffix:semicolon
id|CmdBlkP-&gt;Packet.len
op_assign
id|PKT_CMD_BIT
op_or
l_int|2
suffix:semicolon
id|CmdBlkP-&gt;PostFuncP
op_assign
id|RIOUnUse
suffix:semicolon
id|CmdBlkP-&gt;PostArg
op_assign
(paren
r_int
)paren
id|PortP
suffix:semicolon
id|PktCmdP-&gt;Command
op_assign
id|Cmd
suffix:semicolon
id|port
op_assign
id|PortP-&gt;HostPort
op_mod
(paren
id|ushort
)paren
id|PORTS_PER_RTA
suffix:semicolon
multiline_comment|/*&n;&t;** Index ports 8-15 for 2nd block of 16 port RTA.&n;&t;*/
r_if
c_cond
(paren
id|PortP-&gt;SecondBlock
)paren
id|port
op_add_assign
(paren
id|ushort
)paren
id|PORTS_PER_RTA
suffix:semicolon
id|PktCmdP-&gt;PhbNum
op_assign
id|port
suffix:semicolon
r_switch
c_cond
(paren
id|Cmd
)paren
(brace
r_case
id|MEMDUMP
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue MEMDUMP command blk 0x%x (addr 0x%x)&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
comma
(paren
r_int
)paren
id|SubCmd.Addr
)paren
suffix:semicolon
id|PktCmdP-&gt;SubCommand
op_assign
id|MEMDUMP
suffix:semicolon
id|PktCmdP-&gt;SubAddr
op_assign
id|SubCmd.Addr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FCLOSE
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue FCLOSE command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_REGISTER
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue READ_REGISTER (0x%x) command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|SubCmd.Addr
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
id|PktCmdP-&gt;SubCommand
op_assign
id|READ_REGISTER
suffix:semicolon
id|PktCmdP-&gt;SubAddr
op_assign
id|SubCmd.Addr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESUME
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue RESUME command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFLUSH
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue RFLUSH command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
id|CmdBlkP-&gt;PostFuncP
op_assign
id|RIORFlushEnable
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUSPEND
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue SUSPEND command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MGET
suffix:colon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue MGET command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSET
suffix:colon
r_case
id|MBIC
suffix:colon
r_case
id|MBIS
suffix:colon
id|CmdBlkP-&gt;Packet.data
(braket
l_int|4
)braket
op_assign
(paren
r_char
)paren
id|PortP-&gt;ModemLines
suffix:semicolon
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue MSET/MBIC/MBIS command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WFLUSH
suffix:colon
multiline_comment|/*&n;&t;&t;&t;** If we have queued up the maximum number of Write flushes&n;&t;&t;&t;** allowed then we should not bother sending any more to the&n;&t;&t;&t;** RTA.&n;&t;&t;&t;*/
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
(paren
r_char
)paren
id|PortP-&gt;WflushFlag
)paren
op_eq
(paren
r_int
)paren
op_minus
l_int|1
)paren
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Trashed WFLUSH, WflushFlag about to wrap!&quot;
)paren
suffix:semicolon
id|RIOFreeCmdBlk
c_func
(paren
id|CmdBlkP
)paren
suffix:semicolon
r_return
id|RIO_FAIL
suffix:semicolon
)brace
r_else
(brace
id|rio_dprintk
(paren
id|RIO_DEBUG_CTRL
comma
l_string|&quot;Queue WFLUSH command blk 0x%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|CmdBlkP
)paren
suffix:semicolon
id|CmdBlkP-&gt;PostFuncP
op_assign
id|RIOWFlushMark
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|PortP-&gt;InUse
op_increment
suffix:semicolon
id|Ret
op_assign
id|RIOQueueCmdBlk
c_func
(paren
id|PortP-&gt;HostP
comma
id|rup
comma
id|CmdBlkP
)paren
suffix:semicolon
r_return
id|Ret
suffix:semicolon
)brace
eof
