multiline_comment|/*&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Original driver code supplied by Multi-Tech&n; *&n; *&t;Changes&n; *&t;1/9/98&t;alan@redhat.com&t;&t;Merge to 2.0.x kernel tree&n; *&t;&t;&t;&t;&t;Obtain and use official major/minors&n; *&t;&t;&t;&t;&t;Loader switched to a misc device&n; *&t;&t;&t;&t;&t;(fixed range check bug as a side effect)&n; *&t;&t;&t;&t;&t;Printk clean up&n; *&t;9/12/98&t;alan@redhat.com&t;&t;Rough port to 2.1.x&n; *&n; *&t;10/6/99 sameer&t;&t;&t;Merged the ISA and PCI drivers to&n; *&t;&t;&t;&t;&t;a new unified driver.&n; *&t;***********************************************************&n; *&n; *&t;To use this driver you also need the support package. You &n; *&t;can find this in RPM format on&n; *&t;&t;ftp://ftp.linux.org.uk/pub/linux/alan&n; * &t;&n; *&t;You can find the original tools for this direct from Multitech&n; *&t;&t;ftp://ftp.multitech.com/ISI-Cards/&n; *&n; *&t;Having installed the cards the module options (/etc/modules.conf)&n; *&n; *&t;options isicom   io=card1,card2,card3,card4 irq=card1,card2,card3,card4&n; *&n; *&t;Omit those entries for boards you don&squot;t have installed.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/miscdevice.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/isicom.h&gt;
DECL|variable|device_id
r_static
r_int
id|device_id
(braket
)braket
op_assign
(brace
l_int|0x2028
comma
l_int|0x2051
comma
l_int|0x2052
comma
l_int|0x2053
comma
l_int|0x2054
comma
l_int|0x2055
comma
l_int|0x2056
comma
l_int|0x2057
comma
l_int|0x2058
)brace
suffix:semicolon
DECL|variable|isicom_refcount
r_static
r_int
id|isicom_refcount
op_assign
l_int|0
suffix:semicolon
DECL|variable|prev_card
r_static
r_int
id|prev_card
op_assign
l_int|3
suffix:semicolon
multiline_comment|/*&t;start servicing isi_card[0]&t;*/
DECL|variable|irq_to_board
r_static
r_struct
id|isi_board
op_star
id|irq_to_board
(braket
l_int|16
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|isicom_normal
DECL|variable|isicom_callout
r_static
r_struct
id|tty_driver
id|isicom_normal
comma
id|isicom_callout
suffix:semicolon
DECL|variable|isicom_table
r_static
r_struct
id|tty_struct
op_star
id|isicom_table
(braket
id|PORT_COUNT
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|isicom_termios
r_static
r_struct
id|termios
op_star
id|isicom_termios
(braket
id|PORT_COUNT
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|isicom_termios_locked
r_static
r_struct
id|termios
op_star
id|isicom_termios_locked
(braket
id|PORT_COUNT
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|isi_card
r_static
r_struct
id|isi_board
id|isi_card
(braket
id|BOARD_COUNT
)braket
suffix:semicolon
DECL|variable|isi_ports
r_static
r_struct
id|isi_port
id|isi_ports
(braket
id|PORT_COUNT
)braket
suffix:semicolon
DECL|variable|tq_isicom
id|DECLARE_TASK_QUEUE
c_func
(paren
id|tq_isicom
)paren
suffix:semicolon
DECL|variable|tx
r_static
r_struct
id|timer_list
id|tx
suffix:semicolon
DECL|variable|re_schedule
r_static
r_char
id|re_schedule
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
DECL|variable|tx_count
r_static
r_int
r_int
id|tx_count
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_static
r_int
id|ISILoad_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|isicom_tx
c_func
(paren
r_int
r_int
id|_data
)paren
suffix:semicolon
r_static
r_void
id|isicom_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
suffix:semicolon
DECL|variable|tmp_buf
r_static
r_int
r_char
op_star
id|tmp_buf
op_assign
l_int|0
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|tmp_buf_sem
)paren
suffix:semicolon
multiline_comment|/*   baud index mappings from linux defns to isi */
DECL|variable|linuxb_to_isib
r_static
r_int
r_char
id|linuxb_to_isib
(braket
)braket
op_assign
(brace
op_minus
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|11
comma
l_int|13
comma
l_int|15
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
)brace
suffix:semicolon
multiline_comment|/* &n; *  Firmware loader driver specific routines&n; *&n; */
DECL|variable|ISILoad_fops
r_static
r_struct
id|file_operations
id|ISILoad_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|ioctl
suffix:colon
id|ISILoad_ioctl
comma
)brace
suffix:semicolon
DECL|variable|isiloader_device
r_struct
id|miscdevice
id|isiloader_device
op_assign
(brace
id|ISILOAD_MISC_MINOR
comma
l_string|&quot;isictl&quot;
comma
op_amp
id|ISILoad_fops
)brace
suffix:semicolon
DECL|function|WaitTillCardIsFree
r_extern
r_inline
r_int
id|WaitTillCardIsFree
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
op_amp
l_int|0x1
)paren
)paren
op_logical_and
(paren
id|count
op_increment
OL
l_int|6000000
)paren
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
op_amp
l_int|0x1
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|ISILoad_ioctl
r_static
r_int
id|ISILoad_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|card
comma
id|i
comma
id|j
comma
id|signature
comma
id|status
comma
id|portcount
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|word_count
comma
id|base
suffix:semicolon
id|bin_frame
id|frame
suffix:semicolon
multiline_comment|/* exec_record exec_rec; */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|card
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card
OL
l_int|0
op_logical_or
id|card
op_ge
id|BOARD_COUNT
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|base
op_assign
id|isi_card
(braket
id|card
)braket
dot
id|base
suffix:semicolon
r_if
c_cond
(paren
id|base
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/* disabled or not used */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|MIOCTL_RESET_CARD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISILoad:Resetting Card%d at 0x%x &quot;
comma
id|card
op_plus
l_int|1
comma
id|base
)paren
suffix:semicolon
id|inw
c_func
(paren
id|base
op_plus
l_int|0x8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|100
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|i
)paren
suffix:semicolon
)paren
(brace
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0
comma
id|base
op_plus
l_int|0x8
)paren
suffix:semicolon
multiline_comment|/* Reset */
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
op_le
l_int|3
suffix:semicolon
id|j
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|i
)paren
suffix:semicolon
)paren
(brace
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
)brace
id|signature
op_assign
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x4
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|isi_card
(braket
id|card
)braket
dot
id|isa
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
op_amp
l_int|0x1
)paren
op_logical_or
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x2
)paren
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;&t;
id|printk
c_func
(paren
l_string|&quot;&bslash;nbase+0x2=0x%x , base+0xe=0x%x&quot;
comma
id|inw
c_func
(paren
id|base
op_plus
l_int|0x2
)paren
comma
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
id|printk
c_func
(paren
l_string|&quot;&bslash;nISILoad:ISA Card%d reset failure (Possible bad I/O Port Address 0x%x).&bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|base
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
(brace
id|portcount
op_assign
id|inw
c_func
(paren
id|base
op_plus
l_int|0x2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
op_amp
l_int|0x1
)paren
op_logical_or
(paren
(paren
id|portcount
op_ne
l_int|0
)paren
op_logical_and
(paren
id|portcount
op_ne
l_int|4
)paren
op_logical_and
(paren
id|portcount
op_ne
l_int|8
)paren
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
l_string|&quot;&bslash;nbase+0x2=0x%x , base+0xe=0x%x&quot;
comma
id|inw
c_func
(paren
id|base
op_plus
l_int|0x2
)paren
comma
id|inw
c_func
(paren
id|base
op_plus
l_int|0xe
)paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;&bslash;nISILoad:PCI Card%d reset failure (Possible bad I/O Port Address 0x%x).&bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|base
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|signature
)paren
(brace
r_case
l_int|0xa5
suffix:colon
r_case
l_int|0xbb
suffix:colon
r_case
l_int|0xdd
suffix:colon
r_if
c_cond
(paren
id|isi_card
(braket
id|card
)braket
dot
id|isa
)paren
id|isi_card
(braket
id|card
)braket
dot
id|port_count
op_assign
l_int|8
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|portcount
op_eq
l_int|4
)paren
id|isi_card
(braket
id|card
)braket
dot
id|port_count
op_assign
l_int|4
suffix:semicolon
r_else
id|isi_card
(braket
id|card
)braket
dot
id|port_count
op_assign
l_int|8
suffix:semicolon
)brace
id|isi_card
(braket
id|card
)braket
dot
id|shift_count
op_assign
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xcc
suffix:colon
id|isi_card
(braket
id|card
)braket
dot
id|port_count
op_assign
l_int|16
suffix:semicolon
id|isi_card
(braket
id|card
)braket
dot
id|shift_count
op_assign
l_int|11
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ISILoad:Card%d reset failure (Possible bad I/O Port Address 0x%x).&bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|base
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;
id|printk
c_func
(paren
l_string|&quot;Sig=0x%x&bslash;n&quot;
comma
id|signature
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t; 
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;-Done&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|signature
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|MIOCTL_LOAD_FIRMWARE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|frame
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bin_frame
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|outw
c_func
(paren
l_int|0xf0
comma
id|base
)paren
suffix:semicolon
multiline_comment|/* start upload sequence */
id|outw
c_func
(paren
l_int|0x00
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|frame.addr
)paren
comma
id|base
)paren
suffix:semicolon
multiline_comment|/*      lsb of adderess    */
id|word_count
op_assign
(paren
id|frame.count
op_rshift
l_int|1
)paren
op_plus
id|frame.count
op_mod
l_int|2
suffix:semicolon
id|outw
c_func
(paren
id|word_count
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x2f
suffix:semicolon
id|i
op_increment
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* a wee bit of delay */
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|base
op_plus
l_int|0x4
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISILoad:Card%d rejected load header:&bslash;nAddress:0x%x &bslash;nCount:0x%x &bslash;nStatus:0x%x &bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|frame.addr
comma
id|frame.count
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|outsw
c_func
(paren
id|base
comma
(paren
r_void
op_star
)paren
id|frame.bin_data
comma
id|word_count
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x0f
suffix:semicolon
id|i
op_increment
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* another wee bit of delay */
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|base
op_plus
l_int|0x4
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISILoad:Card%d got out of sync.Card Status:0x%x&bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|MIOCTL_READ_FIRMWARE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|frame
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bin_header
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|outw
c_func
(paren
l_int|0xf1
comma
id|base
)paren
suffix:semicolon
multiline_comment|/* start download sequence */
id|outw
c_func
(paren
l_int|0x00
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|frame.addr
)paren
comma
id|base
)paren
suffix:semicolon
multiline_comment|/*      lsb of adderess    */
id|word_count
op_assign
(paren
id|frame.count
op_rshift
l_int|1
)paren
op_plus
id|frame.count
op_mod
l_int|2
suffix:semicolon
id|outw
c_func
(paren
id|word_count
op_plus
l_int|1
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0xf
suffix:semicolon
id|i
op_increment
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* a wee bit of delay */
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|base
op_plus
l_int|0x4
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISILoad:Card%d rejected verify header:&bslash;nAddress:0x%x &bslash;nCount:0x%x &bslash;nStatus:0x%x &bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|frame.addr
comma
id|frame.count
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|inw
c_func
(paren
id|base
)paren
suffix:semicolon
id|insw
c_func
(paren
id|base
comma
id|frame.bin_data
comma
id|word_count
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x0f
suffix:semicolon
id|i
op_increment
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* another wee bit of delay */
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|base
op_plus
l_int|0x4
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISILoad:Card%d verify got out of sync.Card Status:0x%x&bslash;n&quot;
comma
id|card
op_plus
l_int|1
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|frame
comma
r_sizeof
(paren
id|bin_frame
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|MIOCTL_XFER_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|WaitTillCardIsFree
c_func
(paren
id|base
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|outw
c_func
(paren
l_int|0xf2
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x800
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x0
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x0
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x0
comma
id|base
op_plus
l_int|0x4
)paren
suffix:semicolon
multiline_comment|/* for ISI4608 cards */
id|isi_card
(braket
id|card
)braket
dot
id|status
op_or_assign
id|FIRMWARE_LOADED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISILoad: Received Ioctl cmd 0x%x.&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;ISICOM Driver specific routines ...&n; *&n; */
DECL|function|isicom_paranoia_check
r_static
r_inline
r_int
id|isicom_paranoia_check
c_func
(paren
r_struct
id|isi_port
r_const
op_star
id|port
comma
id|kdev_t
id|dev
comma
r_const
r_char
op_star
id|routine
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG 
r_static
r_const
r_char
op_star
id|badmagic
op_assign
id|KERN_WARNING
l_string|&quot;ISICOM: Warning: bad isicom magic for dev %s in %s.&bslash;n&quot;
suffix:semicolon
r_static
r_const
r_char
op_star
id|badport
op_assign
id|KERN_WARNING
l_string|&quot;ISICOM: Warning: NULL isicom port for dev %s in %s.&bslash;n&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
(brace
id|printk
c_func
(paren
id|badport
comma
id|kdevname
c_func
(paren
id|dev
)paren
comma
id|routine
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;magic
op_ne
id|ISICOM_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|badmagic
comma
id|kdevname
c_func
(paren
id|dev
)paren
comma
id|routine
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif&t;
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|schedule_bh
r_extern
r_inline
r_void
id|schedule_bh
c_func
(paren
r_struct
id|isi_port
op_star
id|port
)paren
(brace
id|queue_task
c_func
(paren
op_amp
id|port-&gt;bh_tqueue
comma
op_amp
id|tq_isicom
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|ISICOM_BH
)paren
suffix:semicolon
)brace
multiline_comment|/*&t;Transmitter&t;*/
DECL|function|isicom_tx
r_static
r_void
id|isicom_tx
c_func
(paren
r_int
r_int
id|_data
)paren
(brace
r_int
id|count
op_assign
(paren
id|BOARD_COUNT
op_minus
l_int|1
)paren
comma
id|card
comma
id|base
suffix:semicolon
r_int
id|txcount
comma
id|wait
comma
id|wrd
comma
id|residue
comma
id|word_count
comma
id|cnt
suffix:semicolon
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
op_increment
id|tx_count
suffix:semicolon
macro_line|#endif&t;
multiline_comment|/*&t;find next active board&t;*/
id|card
op_assign
(paren
id|prev_card
op_plus
l_int|1
)paren
op_amp
l_int|0x0003
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|card
)braket
dot
id|status
op_amp
id|BOARD_ACTIVE
)paren
r_break
suffix:semicolon
id|card
op_assign
(paren
id|card
op_plus
l_int|1
)paren
op_amp
l_int|0x0003
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|isi_card
(braket
id|card
)braket
dot
id|status
op_amp
id|BOARD_ACTIVE
)paren
)paren
r_goto
id|sched_again
suffix:semicolon
id|prev_card
op_assign
id|card
suffix:semicolon
id|count
op_assign
id|isi_card
(braket
id|card
)braket
dot
id|port_count
suffix:semicolon
id|port
op_assign
id|isi_card
(braket
id|card
)braket
dot
id|ports
suffix:semicolon
id|base
op_assign
id|isi_card
(braket
id|card
)braket
dot
id|base
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|port
op_increment
)paren
(brace
multiline_comment|/* port not active or tx disabled to force flow control */
r_if
c_cond
(paren
op_logical_neg
(paren
id|port-&gt;status
op_amp
id|ISI_TXOK
)paren
)paren
r_continue
suffix:semicolon
id|tty
op_assign
id|port-&gt;tty
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|txcount
op_assign
id|MIN
c_func
(paren
id|TX_SIZE
comma
id|port-&gt;xmit_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|txcount
op_le
l_int|0
)paren
op_logical_or
id|tty-&gt;stopped
op_logical_or
id|tty-&gt;hw_stopped
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|wait
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x0e
)paren
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|wait
op_decrement
OG
l_int|0
)paren
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wait
op_le
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_tx:Card(0x%x) found busy.&bslash;n&quot;
comma
id|card
)paren
suffix:semicolon
macro_line|#endif
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x02
)paren
op_amp
(paren
l_int|1
op_lshift
id|port-&gt;channel
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_tx: cannot tx to 0x%x:%d.&bslash;n&quot;
comma
id|base
comma
id|port-&gt;channel
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;&t;
r_continue
suffix:semicolon
)brace
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: txing %d bytes, port%d.&bslash;n&quot;
comma
id|txcount
comma
id|port-&gt;channel
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;
id|outw
c_func
(paren
(paren
id|port-&gt;channel
op_lshift
id|isi_card
(braket
id|card
)braket
dot
id|shift_count
)paren
op_or
id|txcount
comma
id|base
)paren
suffix:semicolon
id|residue
op_assign
id|NO
suffix:semicolon
id|wrd
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|cnt
op_assign
id|MIN
c_func
(paren
id|txcount
comma
(paren
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_tail
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|residue
op_eq
id|YES
)paren
(brace
id|residue
op_assign
id|NO
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
l_int|0
)paren
(brace
id|wrd
op_or_assign
(paren
id|port-&gt;xmit_buf
(braket
id|port-&gt;xmit_tail
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|port-&gt;xmit_tail
op_assign
(paren
id|port-&gt;xmit_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_decrement
suffix:semicolon
id|txcount
op_decrement
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|outw
c_func
(paren
id|wrd
comma
id|base
)paren
suffix:semicolon
)brace
r_else
(brace
id|outw
c_func
(paren
id|wrd
comma
id|base
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
r_break
suffix:semicolon
id|word_count
op_assign
id|cnt
op_rshift
l_int|1
suffix:semicolon
id|outsw
c_func
(paren
id|base
comma
id|port-&gt;xmit_buf
op_plus
id|port-&gt;xmit_tail
comma
id|word_count
)paren
suffix:semicolon
id|port-&gt;xmit_tail
op_assign
(paren
id|port-&gt;xmit_tail
op_plus
(paren
id|word_count
op_lshift
l_int|1
)paren
)paren
op_amp
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|txcount
op_sub_assign
(paren
id|word_count
op_lshift
l_int|1
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_sub_assign
(paren
id|word_count
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_amp
l_int|0x0001
)paren
(brace
id|residue
op_assign
id|YES
suffix:semicolon
id|wrd
op_assign
id|port-&gt;xmit_buf
(braket
id|port-&gt;xmit_tail
)braket
suffix:semicolon
id|port-&gt;xmit_tail
op_assign
(paren
id|port-&gt;xmit_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_decrement
suffix:semicolon
id|txcount
op_decrement
suffix:semicolon
)brace
)brace
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_cnt
op_le
l_int|0
)paren
id|port-&gt;status
op_and_assign
op_complement
id|ISI_TXOK
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_cnt
op_le
id|WAKEUP_CHARS
)paren
id|schedule_bh
c_func
(paren
id|port
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&t;schedule another tx for hopefully in about 10ms&t;*/
id|sched_again
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|re_schedule
)paren
r_return
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|tx
)paren
suffix:semicolon
id|tx.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|100
suffix:semicolon
id|tx.data
op_assign
l_int|0
suffix:semicolon
id|tx.function
op_assign
id|isicom_tx
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tx
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* &t;Interrupt handlers &t;*/
DECL|function|do_isicom_bh
r_static
r_void
id|do_isicom_bh
c_func
(paren
r_void
)paren
(brace
id|run_task_queue
c_func
(paren
op_amp
id|tq_isicom
)paren
suffix:semicolon
)brace
DECL|function|isicom_bottomhalf
r_static
r_void
id|isicom_bottomhalf
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|data
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|port-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_DO_WRITE_WAKEUP
)paren
)paren
op_logical_and
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|tty-&gt;write_wait
)paren
suffix:semicolon
)brace
multiline_comment|/* main interrupt handler routine */
DECL|function|isicom_interrupt
r_static
r_void
id|isicom_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|isi_board
op_star
id|card
suffix:semicolon
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_int
r_int
id|base
comma
id|header
comma
id|word_count
comma
id|count
suffix:semicolon
r_int
r_char
id|channel
suffix:semicolon
r_int
id|byte_count
suffix:semicolon
multiline_comment|/*&n;&t; *      find the source of interrupt&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
(brace
id|card
op_assign
op_amp
id|isi_card
(braket
id|count
)braket
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;base
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|card-&gt;isa
op_eq
id|YES
)paren
op_logical_and
(paren
id|card-&gt;irq
op_eq
id|irq
)paren
)paren
op_logical_or
(paren
(paren
id|card-&gt;isa
op_eq
id|NO
)paren
op_logical_and
(paren
id|card-&gt;irq
op_eq
id|irq
)paren
op_logical_and
(paren
id|inw
c_func
(paren
id|card-&gt;base
op_plus
l_int|0x0e
)paren
op_amp
l_int|0x02
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
id|card
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|card
op_logical_or
op_logical_neg
(paren
id|card-&gt;status
op_amp
id|FIRMWARE_LOADED
)paren
)paren
(brace
multiline_comment|/*&t;&t;printk(KERN_DEBUG &quot;ISICOM: interrupt: not handling irq%d!.&bslash;n&quot;, irq);*/
r_return
suffix:semicolon
)brace
id|base
op_assign
id|card-&gt;base
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;isa
op_eq
id|NO
)paren
(brace
multiline_comment|/*&n;&t; *      disable any interrupts from the PCI card and lower the&n;&t; *      interrupt line&n;&t; */
id|outw
c_func
(paren
l_int|0x8000
comma
id|base
op_plus
l_int|0x04
)paren
suffix:semicolon
id|ClearInterrupt
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
id|inw
c_func
(paren
id|base
)paren
suffix:semicolon
multiline_comment|/* get the dummy word out */
id|header
op_assign
id|inw
c_func
(paren
id|base
)paren
suffix:semicolon
id|channel
op_assign
(paren
id|header
op_amp
l_int|0x7800
)paren
op_rshift
id|card-&gt;shift_count
suffix:semicolon
id|byte_count
op_assign
id|header
op_amp
l_int|0xff
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM:Intr:(0x%x:%d).&bslash;n&quot;
comma
id|base
comma
id|channel
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|channel
op_plus
l_int|1
)paren
OG
id|card-&gt;port_count
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM: isicom_interrupt(0x%x): %d(channel) &gt; port_count.&bslash;n&quot;
comma
id|base
comma
id|channel
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;isa
)paren
id|ClearInterrupt
c_func
(paren
id|base
)paren
suffix:semicolon
r_else
id|outw
c_func
(paren
l_int|0x0000
comma
id|base
op_plus
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
suffix:semicolon
)brace
id|port
op_assign
id|card-&gt;ports
op_plus
id|channel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_INITIALIZED
)paren
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;isa
)paren
id|ClearInterrupt
c_func
(paren
id|base
)paren
suffix:semicolon
r_else
id|outw
c_func
(paren
l_int|0x0000
comma
id|base
op_plus
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
suffix:semicolon
)brace
id|tty
op_assign
id|port-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
id|header
op_amp
l_int|0x8000
)paren
(brace
multiline_comment|/* Status Packet */
id|header
op_assign
id|inw
c_func
(paren
id|base
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|header
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Change in EIA signals */
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CHECK_CD
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;status
op_amp
id|ISI_DCD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|header
op_amp
id|ISI_DCD
)paren
)paren
(brace
multiline_comment|/* Carrier has been lost  */
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: interrupt: DCD-&gt;low.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;&t;&t;&t;
id|port-&gt;status
op_and_assign
op_complement
id|ISI_DCD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_logical_and
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_NOHUP
)paren
)paren
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|schedule_task
c_func
(paren
op_amp
id|port-&gt;hangup_tq
)paren
op_eq
l_int|0
)paren
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|header
op_amp
id|ISI_DCD
)paren
(brace
multiline_comment|/* Carrier has been detected */
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: interrupt: DCD-&gt;high.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;&t;&t;&t;
id|port-&gt;status
op_or_assign
id|ISI_DCD
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|port-&gt;open_wait
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|header
op_amp
id|ISI_DCD
)paren
id|port-&gt;status
op_or_assign
id|ISI_DCD
suffix:semicolon
r_else
id|port-&gt;status
op_and_assign
op_complement
id|ISI_DCD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CTS_FLOW
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;tty-&gt;hw_stopped
)paren
(brace
r_if
c_cond
(paren
id|header
op_amp
id|ISI_CTS
)paren
(brace
id|port-&gt;tty-&gt;hw_stopped
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* start tx ing */
id|port-&gt;status
op_or_assign
(paren
id|ISI_TXOK
op_or
id|ISI_CTS
)paren
suffix:semicolon
id|schedule_bh
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|header
op_amp
id|ISI_CTS
)paren
)paren
(brace
id|port-&gt;tty-&gt;hw_stopped
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* stop tx ing */
id|port-&gt;status
op_and_assign
op_complement
(paren
id|ISI_TXOK
op_or
id|ISI_CTS
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|header
op_amp
id|ISI_CTS
)paren
id|port-&gt;status
op_or_assign
id|ISI_CTS
suffix:semicolon
r_else
id|port-&gt;status
op_and_assign
op_complement
id|ISI_CTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|header
op_amp
id|ISI_DSR
)paren
id|port-&gt;status
op_or_assign
id|ISI_DSR
suffix:semicolon
r_else
id|port-&gt;status
op_and_assign
op_complement
id|ISI_DSR
suffix:semicolon
r_if
c_cond
(paren
id|header
op_amp
id|ISI_RI
)paren
id|port-&gt;status
op_or_assign
id|ISI_RI
suffix:semicolon
r_else
id|port-&gt;status
op_and_assign
op_complement
id|ISI_RI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Received Break !!!&t; */
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
r_break
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_increment
op_assign
id|TTY_BREAK
suffix:semicolon
multiline_comment|/* dunno if this is right */
op_star
id|tty-&gt;flip.char_buf_ptr
op_increment
op_assign
l_int|0
suffix:semicolon
id|tty-&gt;flip.count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SAK
)paren
id|do_SAK
c_func
(paren
id|tty
)paren
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|tty-&gt;flip.tqueue
comma
op_amp
id|tq_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Statistics&t;&t; */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_interrupt: stats!!!.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM: Intr: Unknown code in status packet.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Data   Packet */
id|count
op_assign
id|MIN
c_func
(paren
id|byte_count
comma
(paren
id|TTY_FLIPBUF_SIZE
op_minus
id|tty-&gt;flip.count
)paren
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Intr: Can rx %d of %d bytes.&bslash;n&quot;
comma
id|count
comma
id|byte_count
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
id|word_count
op_assign
id|count
op_rshift
l_int|1
suffix:semicolon
id|insw
c_func
(paren
id|base
comma
id|tty-&gt;flip.char_buf_ptr
comma
id|word_count
)paren
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_add_assign
(paren
id|word_count
op_lshift
l_int|1
)paren
suffix:semicolon
id|byte_count
op_sub_assign
(paren
id|word_count
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_amp
l_int|0x0001
)paren
(brace
op_star
id|tty-&gt;flip.char_buf_ptr
op_increment
op_assign
(paren
r_char
)paren
(paren
id|inw
c_func
(paren
id|base
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|byte_count
op_sub_assign
l_int|2
suffix:semicolon
)brace
id|memset
c_func
(paren
id|tty-&gt;flip.flag_buf_ptr
comma
l_int|0
comma
id|count
)paren
suffix:semicolon
id|tty-&gt;flip.flag_buf_ptr
op_add_assign
id|count
suffix:semicolon
id|tty-&gt;flip.count
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|byte_count
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Intr(0x%x:%d): Flip buffer overflow! dropping bytes...&bslash;n&quot;
comma
id|base
comma
id|channel
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|byte_count
OG
l_int|0
)paren
(brace
multiline_comment|/* drain out unread xtra data */
id|inw
c_func
(paren
id|base
)paren
suffix:semicolon
id|byte_count
op_sub_assign
l_int|2
suffix:semicolon
)brace
)brace
id|queue_task
c_func
(paren
op_amp
id|tty-&gt;flip.tqueue
comma
op_amp
id|tq_timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;isa
op_eq
id|YES
)paren
id|ClearInterrupt
c_func
(paren
id|base
)paren
suffix:semicolon
r_else
id|outw
c_func
(paren
l_int|0x0000
comma
id|base
op_plus
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
suffix:semicolon
)brace
multiline_comment|/* called with interrupts disabled */
DECL|function|isicom_config_port
r_static
r_void
id|isicom_config_port
c_func
(paren
r_struct
id|isi_port
op_star
id|port
)paren
(brace
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_int
r_int
id|baud
suffix:semicolon
r_int
r_int
id|channel_setup
comma
id|wait
comma
id|base
op_assign
id|card-&gt;base
suffix:semicolon
r_int
r_int
id|channel
op_assign
id|port-&gt;channel
comma
id|shift_count
op_assign
id|card-&gt;shift_count
suffix:semicolon
r_int
r_char
id|flow_ctrl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tty
op_assign
id|port-&gt;tty
)paren
op_logical_or
op_logical_neg
id|tty-&gt;termios
)paren
r_return
suffix:semicolon
id|baud
op_assign
id|C_BAUD
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|baud
op_amp
id|CBAUDEX
)paren
(brace
id|baud
op_and_assign
op_complement
id|CBAUDEX
suffix:semicolon
multiline_comment|/*  if CBAUDEX bit is on and the baud is set to either 50 or 75&n;&t;&t; *  then the card is programmed for 57.6Kbps or 115Kbps&n;&t;&t; *  respectively.&n;&t;&t; */
r_if
c_cond
(paren
id|baud
template_param
l_int|2
)paren
id|port-&gt;tty-&gt;termios-&gt;c_cflag
op_and_assign
op_complement
id|CBAUDEX
suffix:semicolon
r_else
id|baud
op_add_assign
l_int|15
suffix:semicolon
)brace
r_if
c_cond
(paren
id|baud
op_eq
l_int|15
)paren
(brace
multiline_comment|/*  the ASYNC_SPD_HI and ASYNC_SPD_VHI options are set &n;&t;&t; *  by the set_serial_info ioctl ... this is done by&n;&t;&t; *  the &squot;setserial&squot; utility.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_HI
)paren
id|baud
op_increment
suffix:semicolon
multiline_comment|/*  57.6 Kbps */
r_if
c_cond
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_VHI
)paren
id|baud
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/*  115  Kbps */
)brace
r_if
c_cond
(paren
id|linuxb_to_isib
(braket
id|baud
)braket
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* hang up */
id|drop_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|raise_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
id|wait
op_assign
l_int|100
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x0e
)paren
op_amp
l_int|0x0001
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|wait
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wait
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM: Card found busy in isicom_config_port at channel setup.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0x8000
op_or
(paren
id|channel
op_lshift
id|shift_count
)paren
op_or
l_int|0x03
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
id|linuxb_to_isib
(braket
id|baud
)braket
op_lshift
l_int|8
op_or
l_int|0x03
comma
id|base
)paren
suffix:semicolon
id|channel_setup
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|C_CSIZE
c_func
(paren
id|tty
)paren
)paren
(brace
r_case
id|CS5
suffix:colon
id|channel_setup
op_or_assign
id|ISICOM_CS5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|channel_setup
op_or_assign
id|ISICOM_CS6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|channel_setup
op_or_assign
id|ISICOM_CS7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
id|channel_setup
op_or_assign
id|ISICOM_CS8
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|C_CSTOPB
c_func
(paren
id|tty
)paren
)paren
id|channel_setup
op_or_assign
id|ISICOM_2SB
suffix:semicolon
r_if
c_cond
(paren
id|C_PARENB
c_func
(paren
id|tty
)paren
)paren
id|channel_setup
op_or_assign
id|ISICOM_EVPAR
suffix:semicolon
r_if
c_cond
(paren
id|C_PARODD
c_func
(paren
id|tty
)paren
)paren
id|channel_setup
op_or_assign
id|ISICOM_ODPAR
suffix:semicolon
id|outw
c_func
(paren
id|channel_setup
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|C_CLOCAL
c_func
(paren
id|tty
)paren
)paren
id|port-&gt;flags
op_and_assign
op_complement
id|ASYNC_CHECK_CD
suffix:semicolon
r_else
id|port-&gt;flags
op_or_assign
id|ASYNC_CHECK_CD
suffix:semicolon
multiline_comment|/* flow control settings ...*/
id|flow_ctrl
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_and_assign
op_complement
id|ASYNC_CTS_FLOW
suffix:semicolon
r_if
c_cond
(paren
id|C_CRTSCTS
c_func
(paren
id|tty
)paren
)paren
(brace
id|port-&gt;flags
op_or_assign
id|ASYNC_CTS_FLOW
suffix:semicolon
id|flow_ctrl
op_or_assign
id|ISICOM_CTSRTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I_IXON
c_func
(paren
id|tty
)paren
)paren
id|flow_ctrl
op_or_assign
id|ISICOM_RESPOND_XONXOFF
suffix:semicolon
r_if
c_cond
(paren
id|I_IXOFF
c_func
(paren
id|tty
)paren
)paren
id|flow_ctrl
op_or_assign
id|ISICOM_INITIATE_XONXOFF
suffix:semicolon
id|wait
op_assign
l_int|100
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x0e
)paren
op_amp
l_int|0x0001
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|wait
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wait
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM: Card found busy in isicom_config_port at flow setup.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0x8000
op_or
(paren
id|channel
op_lshift
id|shift_count
)paren
op_or
l_int|0x04
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
id|flow_ctrl
op_lshift
l_int|8
op_or
l_int|0x05
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|STOP_CHAR
c_func
(paren
id|tty
)paren
)paren
op_lshift
l_int|8
op_or
(paren
id|START_CHAR
c_func
(paren
id|tty
)paren
)paren
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
multiline_comment|/*&t;rx enabled -&gt; enable port for rx on the card&t;*/
r_if
c_cond
(paren
id|C_CREAD
c_func
(paren
id|tty
)paren
)paren
(brace
id|card-&gt;port_status
op_or_assign
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
id|outw
c_func
(paren
id|card-&gt;port_status
comma
id|base
op_plus
l_int|0x02
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* open et all */
DECL|function|isicom_setup_board
r_extern
r_inline
r_void
id|isicom_setup_board
c_func
(paren
r_struct
id|isi_board
op_star
id|bp
)paren
(brace
r_int
id|channel
suffix:semicolon
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;status
op_amp
id|BOARD_ACTIVE
)paren
r_return
suffix:semicolon
id|port
op_assign
id|bp-&gt;ports
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: setup_board: drop_dtr_rts start, port_count %d...&bslash;n&quot;
comma
id|bp-&gt;port_count
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|bp-&gt;port_count
suffix:semicolon
id|channel
op_increment
comma
id|port
op_increment
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|drop_dtr_rts
c_func
(paren
id|port
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: setup_board: drop_dtr_rts stop...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|bp-&gt;status
op_or_assign
id|BOARD_ACTIVE
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|isicom_setup_port
r_static
r_int
id|isicom_setup_port
c_func
(paren
r_struct
id|isi_port
op_star
id|port
)paren
(brace
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_INITIALIZED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;xmit_buf
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_buf
)paren
(brace
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|port-&gt;xmit_buf
op_assign
(paren
r_int
r_char
op_star
)paren
id|page
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;tty
)paren
id|clear_bit
c_func
(paren
id|TTY_IO_ERROR
comma
op_amp
id|port-&gt;tty-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;count
op_eq
l_int|1
)paren
id|card-&gt;count
op_increment
suffix:semicolon
id|port-&gt;xmit_cnt
op_assign
id|port-&gt;xmit_head
op_assign
id|port-&gt;xmit_tail
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&t;discard any residual data&t;*/
id|kill_queue
c_func
(paren
id|port
comma
id|ISICOM_KILLTX
op_or
id|ISICOM_KILLRX
)paren
suffix:semicolon
id|isicom_config_port
c_func
(paren
id|port
)paren
suffix:semicolon
id|port-&gt;flags
op_or_assign
id|ASYNC_INITIALIZED
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|block_til_ready
r_static
r_int
id|block_til_ready
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
comma
r_struct
id|isi_port
op_star
id|port
)paren
(brace
r_int
id|do_clocal
op_assign
l_int|0
comma
id|retval
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
multiline_comment|/* block if port is in the process of being closed */
r_if
c_cond
(paren
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
op_logical_or
id|port-&gt;flags
op_amp
id|ASYNC_CLOSING
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: close in progress.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|interruptible_sleep_on
c_func
(paren
op_amp
id|port-&gt;close_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_HUP_NOTIFY
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_else
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
multiline_comment|/* trying to open a callout device... check for constraints */
r_if
c_cond
(paren
id|tty-&gt;driver.subtype
op_eq
id|SERIAL_TYPE_CALLOUT
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: bl_ti_rdy: callout open.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_NORMAL_ACTIVE
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_logical_and
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SESSION_LOCKOUT
)paren
op_logical_and
(paren
id|port-&gt;session
op_ne
id|current-&gt;session
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_logical_and
(paren
id|port-&gt;flags
op_amp
id|ASYNC_PGRP_LOCKOUT
)paren
op_logical_and
(paren
id|port-&gt;pgrp
op_ne
id|current-&gt;pgrp
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|port-&gt;flags
op_or_assign
id|ASYNC_CALLOUT_ACTIVE
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|raise_dtr_rts
c_func
(paren
id|port
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if non-blocking mode is set ... */
r_if
c_cond
(paren
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
op_logical_or
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_IO_ERROR
)paren
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: non-block mode.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|port-&gt;flags
op_or_assign
id|ASYNC_NORMAL_ACTIVE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;normal_termios.c_cflag
op_amp
id|CLOCAL
)paren
id|do_clocal
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|C_CLOCAL
c_func
(paren
id|tty
)paren
)paren
id|do_clocal
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef ISICOM_DEBUG&t;
r_if
c_cond
(paren
id|do_clocal
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: CLOCAL set.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif &t;&t;
multiline_comment|/* block waiting for DCD to be asserted, and while &n;&t;&t;&t;&t;&t;&t;callout dev is busy */
id|retval
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|port-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
)paren
id|port-&gt;count
op_decrement
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|port-&gt;blocked_open
op_increment
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: waiting for DCD...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
)paren
id|raise_dtr_rts
c_func
(paren
id|port
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
op_logical_or
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_INITIALIZED
)paren
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_HUP_NOTIFY
)paren
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: tty_hung_up_p || not init.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_logical_and
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CLOSING
)paren
op_logical_and
(paren
id|do_clocal
op_logical_or
(paren
id|port-&gt;status
op_amp
id|ISI_DCD
)paren
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;&t;    
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: do_clocal || DCD.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t; &t;
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready: sig blocked.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|port-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
)paren
id|port-&gt;count
op_increment
suffix:semicolon
id|port-&gt;blocked_open
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|port-&gt;flags
op_or_assign
id|ASYNC_NORMAL_ACTIVE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isicom_open
r_static
r_int
id|isicom_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_struct
id|isi_board
op_star
id|card
suffix:semicolon
r_int
r_int
id|line
comma
id|board
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|error
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: open start!!!.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|line
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
id|tty-&gt;driver.minor_start
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;line = %d.&bslash;n&quot;
comma
id|line
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|line
OL
l_int|0
)paren
op_logical_or
(paren
id|line
OG
(paren
id|PORT_COUNT
op_minus
l_int|1
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|board
op_assign
id|BOARD
c_func
(paren
id|line
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;board = %d.&bslash;n&quot;
comma
id|board
)paren
suffix:semicolon
macro_line|#endif&t;
id|card
op_assign
op_amp
id|isi_card
(braket
id|board
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;status
op_amp
id|FIRMWARE_LOADED
)paren
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Firmware not loaded to card%d.&bslash;n&quot;
comma
id|board
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*  open on a port greater than the port count for the card !!! */
r_if
c_cond
(paren
id|line
OG
(paren
(paren
id|board
op_star
l_int|16
)paren
op_plus
id|card-&gt;port_count
op_minus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Open on a port which exceeds the port_count of the card!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|port
op_assign
op_amp
id|isi_ports
(braket
id|line
)braket
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_open&quot;
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_setup_board ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|isicom_setup_board
c_func
(paren
id|card
)paren
suffix:semicolon
id|port-&gt;count
op_increment
suffix:semicolon
id|tty-&gt;driver_data
op_assign
id|port
suffix:semicolon
id|port-&gt;tty
op_assign
id|tty
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_setup_port ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|error
op_assign
id|isicom_setup_port
c_func
(paren
id|port
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|error
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: block_til_ready ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|error
op_assign
id|block_til_ready
c_func
(paren
id|tty
comma
id|filp
comma
id|port
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port-&gt;count
op_eq
l_int|1
)paren
op_logical_and
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SPLIT_TERMIOS
)paren
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;driver.subtype
op_eq
id|SERIAL_TYPE_NORMAL
)paren
op_star
id|tty-&gt;termios
op_assign
id|port-&gt;normal_termios
suffix:semicolon
r_else
op_star
id|tty-&gt;termios
op_assign
id|port-&gt;callout_termios
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isicom_config_port
c_func
(paren
id|port
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|port-&gt;session
op_assign
id|current-&gt;session
suffix:semicolon
id|port-&gt;pgrp
op_assign
id|current-&gt;pgrp
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: open end!!!.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close et all */
DECL|function|isicom_shutdown_board
r_extern
r_inline
r_void
id|isicom_shutdown_board
c_func
(paren
r_struct
id|isi_board
op_star
id|bp
)paren
(brace
r_int
id|channel
suffix:semicolon
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;status
op_amp
id|BOARD_ACTIVE
)paren
)paren
r_return
suffix:semicolon
id|bp-&gt;status
op_and_assign
op_complement
id|BOARD_ACTIVE
suffix:semicolon
id|port
op_assign
id|bp-&gt;ports
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|bp-&gt;port_count
suffix:semicolon
id|channel
op_increment
comma
id|port
op_increment
)paren
(brace
id|drop_dtr_rts
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|isicom_shutdown_port
r_static
r_void
id|isicom_shutdown_port
c_func
(paren
r_struct
id|isi_port
op_star
id|port
)paren
(brace
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|port-&gt;flags
op_amp
id|ASYNC_INITIALIZED
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_buf
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|port-&gt;xmit_buf
)paren
suffix:semicolon
id|port-&gt;xmit_buf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tty
op_assign
id|port-&gt;tty
)paren
op_logical_or
id|C_HUPCL
c_func
(paren
id|tty
)paren
)paren
multiline_comment|/* drop dtr on this port */
id|drop_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/* any other port uninits  */
r_if
c_cond
(paren
id|tty
)paren
id|set_bit
c_func
(paren
id|TTY_IO_ERROR
comma
op_amp
id|tty-&gt;flags
)paren
suffix:semicolon
id|port-&gt;flags
op_and_assign
op_complement
id|ASYNC_INITIALIZED
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|card-&gt;count
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_shutdown_port: bad board(0x%x) count %d.&bslash;n&quot;
comma
id|card-&gt;base
comma
id|card-&gt;count
)paren
suffix:semicolon
id|card-&gt;count
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* last port was closed , shutdown that boad too */
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;count
)paren
id|isicom_shutdown_board
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|isicom_close
r_static
r_void
id|isicom_close
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_close&quot;
)paren
)paren
r_return
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Close start!!!.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tty-&gt;count
op_eq
l_int|1
)paren
op_logical_and
(paren
id|port-&gt;count
op_ne
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM:(0x%x) isicom_close: bad port count&quot;
l_string|&quot;tty-&gt;count = 1&t;port count = %d.&bslash;n&quot;
comma
id|card-&gt;base
comma
id|port-&gt;count
)paren
suffix:semicolon
id|port-&gt;count
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|port-&gt;count
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM:(0x%x) isicom_close: bad port count for&quot;
l_string|&quot;channel%d = %d&quot;
comma
id|card-&gt;base
comma
id|port-&gt;channel
comma
id|port-&gt;count
)paren
suffix:semicolon
id|port-&gt;count
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;count
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|port-&gt;flags
op_or_assign
id|ASYNC_CLOSING
suffix:semicolon
multiline_comment|/* &n;&t; * save termios struct since callout and dialin termios may be &n;&t; * different.&n;&t; */
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_NORMAL_ACTIVE
)paren
id|port-&gt;normal_termios
op_assign
op_star
id|tty-&gt;termios
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
id|port-&gt;callout_termios
op_assign
op_star
id|tty-&gt;termios
suffix:semicolon
id|tty-&gt;closing
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;closing_wait
op_ne
id|ASYNC_CLOSING_WAIT_NONE
)paren
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
id|port-&gt;closing_wait
)paren
suffix:semicolon
multiline_comment|/* indicate to the card that no more data can be received &n;&t;   on this port */
r_if
c_cond
(paren
id|port-&gt;flags
op_amp
id|ASYNC_INITIALIZED
)paren
(brace
id|card-&gt;port_status
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|port-&gt;channel
)paren
suffix:semicolon
id|outw
c_func
(paren
id|card-&gt;port_status
comma
id|card-&gt;base
op_plus
l_int|0x02
)paren
suffix:semicolon
)brace
id|isicom_shutdown_port
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;driver.flush_buffer
)paren
id|tty-&gt;driver
dot
id|flush_buffer
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;ldisc.flush_buffer
)paren
id|tty-&gt;ldisc
dot
id|flush_buffer
c_func
(paren
id|tty
)paren
suffix:semicolon
id|tty-&gt;closing
op_assign
l_int|0
suffix:semicolon
id|port-&gt;tty
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;blocked_open
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;close_delay
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: scheduling until time out.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
id|schedule_timeout
c_func
(paren
id|port-&gt;close_delay
)paren
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|port-&gt;open_wait
)paren
suffix:semicolon
)brace
id|port-&gt;flags
op_and_assign
op_complement
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
op_or
id|ASYNC_CLOSING
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|port-&gt;close_wait
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Close end!!!.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
)brace
multiline_comment|/* write et all */
DECL|function|isicom_write
r_static
r_int
id|isicom_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cnt
comma
id|total
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_write for port%d: %d bytes.&bslash;n&quot;
comma
id|port-&gt;channel
op_plus
l_int|1
comma
id|count
)paren
suffix:semicolon
macro_line|#endif&t;  &t;
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_write&quot;
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
op_logical_or
op_logical_neg
id|port-&gt;xmit_buf
op_logical_or
op_logical_neg
id|tmp_buf
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|from_user
)paren
id|down
c_func
(paren
op_amp
id|tmp_buf_sem
)paren
suffix:semicolon
multiline_comment|/* acquire xclusive access to tmp_buf */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cnt
op_assign
id|MIN
c_func
(paren
id|count
comma
id|MIN
c_func
(paren
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_cnt
op_minus
l_int|1
comma
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_head
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|from_user
)paren
(brace
multiline_comment|/* the following may block for paging... hence &n;&t;&t;&t;   enabling interrupts but tx routine may have &n;&t;&t;&t;   created more space in xmit_buf when the ctrl &n;&t;&t;&t;   gets back here  */
id|sti
c_func
(paren
)paren
suffix:semicolon
id|copy_from_user
c_func
(paren
id|tmp_buf
comma
id|buf
comma
id|cnt
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cnt
op_assign
id|MIN
c_func
(paren
id|cnt
comma
id|MIN
c_func
(paren
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_cnt
op_minus
l_int|1
comma
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_head
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|port-&gt;xmit_buf
op_plus
id|port-&gt;xmit_head
comma
id|tmp_buf
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|port-&gt;xmit_buf
op_plus
id|port-&gt;xmit_head
comma
id|buf
comma
id|cnt
)paren
suffix:semicolon
id|port-&gt;xmit_head
op_assign
(paren
id|port-&gt;xmit_head
op_plus
id|cnt
)paren
op_amp
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_add_assign
id|cnt
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|buf
op_add_assign
id|cnt
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|total
op_add_assign
id|cnt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|from_user
)paren
id|up
c_func
(paren
op_amp
id|tmp_buf_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_cnt
op_logical_and
op_logical_neg
id|tty-&gt;stopped
op_logical_and
op_logical_neg
id|tty-&gt;hw_stopped
)paren
id|port-&gt;status
op_or_assign
id|ISI_TXOK
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: isicom_write %d bytes written.&bslash;n&quot;
comma
id|total
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_return
id|total
suffix:semicolon
)brace
multiline_comment|/* put_char et all */
DECL|function|isicom_put_char
r_static
r_void
id|isicom_put_char
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_char
id|ch
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_put_char&quot;
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
op_logical_or
op_logical_neg
id|port-&gt;xmit_buf
)paren
r_return
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: put_char, port %d, char %c.&bslash;n&quot;
comma
id|port-&gt;channel
op_plus
l_int|1
comma
id|ch
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_cnt
op_ge
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|port-&gt;xmit_buf
(braket
id|port-&gt;xmit_head
op_increment
)braket
op_assign
id|ch
suffix:semicolon
id|port-&gt;xmit_head
op_and_assign
(paren
id|SERIAL_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_increment
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* flush_chars et all */
DECL|function|isicom_flush_chars
r_static
r_void
id|isicom_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_flush_chars&quot;
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;xmit_cnt
op_le
l_int|0
op_logical_or
id|tty-&gt;stopped
op_logical_or
id|tty-&gt;hw_stopped
op_logical_or
op_logical_neg
id|port-&gt;xmit_buf
)paren
r_return
suffix:semicolon
multiline_comment|/* this tells the transmitter to consider this port for&n;&t;   data output to the card ... that&squot;s the best we can do. */
id|port-&gt;status
op_or_assign
id|ISI_TXOK
suffix:semicolon
)brace
multiline_comment|/* write_room et all */
DECL|function|isicom_write_room
r_static
r_int
id|isicom_write_room
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
id|free
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_write_room&quot;
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|free
op_assign
id|SERIAL_XMIT_SIZE
op_minus
id|port-&gt;xmit_cnt
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|free
OL
l_int|0
)paren
id|free
op_assign
l_int|0
suffix:semicolon
r_return
id|free
suffix:semicolon
)brace
multiline_comment|/* chars_in_buffer et all */
DECL|function|isicom_chars_in_buffer
r_static
r_int
id|isicom_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_chars_in_buffer&quot;
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|port-&gt;xmit_cnt
suffix:semicolon
)brace
multiline_comment|/* ioctl et all */
DECL|function|isicom_send_break
r_extern
r_inline
r_void
id|isicom_send_break
c_func
(paren
r_struct
id|isi_port
op_star
id|port
comma
r_int
r_int
id|length
)paren
(brace
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_int
id|wait
op_assign
l_int|10
suffix:semicolon
r_int
r_int
id|base
op_assign
id|card-&gt;base
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|inw
c_func
(paren
id|base
op_plus
l_int|0x0e
)paren
op_amp
l_int|0x0001
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|wait
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wait
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Card found busy in isicom_send_break.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0x8000
op_or
(paren
(paren
id|port-&gt;channel
)paren
op_lshift
(paren
id|card-&gt;shift_count
)paren
)paren
op_or
l_int|0x3
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|length
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
op_or
l_int|0x00
comma
id|base
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|length
op_amp
l_int|0xff00
)paren
comma
id|base
)paren
suffix:semicolon
id|InterruptTheCard
c_func
(paren
id|base
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|isicom_get_modem_info
r_static
r_int
id|isicom_get_modem_info
c_func
(paren
r_struct
id|isi_port
op_star
id|port
comma
r_int
r_int
op_star
id|value
)paren
(brace
multiline_comment|/* just send the port status */
r_int
r_int
id|info
suffix:semicolon
r_int
r_int
id|status
op_assign
id|port-&gt;status
suffix:semicolon
id|info
op_assign
(paren
(paren
id|status
op_amp
id|ISI_RTS
)paren
ques
c_cond
id|TIOCM_RTS
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ISI_DTR
)paren
ques
c_cond
id|TIOCM_DTR
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ISI_DCD
)paren
ques
c_cond
id|TIOCM_CAR
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ISI_DSR
)paren
ques
c_cond
id|TIOCM_DSR
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ISI_CTS
)paren
ques
c_cond
id|TIOCM_CTS
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ISI_RI
)paren
ques
c_cond
id|TIOCM_RI
suffix:colon
l_int|0
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|info
comma
(paren
r_int
r_int
op_star
)paren
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isicom_set_modem_info
r_static
r_int
id|isicom_set_modem_info
c_func
(paren
r_struct
id|isi_port
op_star
id|port
comma
r_int
r_int
id|cmd
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_int
r_int
id|arg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|arg
comma
id|value
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCMBIS
suffix:colon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_RTS
)paren
id|raise_rts
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_DTR
)paren
id|raise_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMBIC
suffix:colon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_RTS
)paren
id|drop_rts
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_DTR
)paren
id|drop_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMSET
suffix:colon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_RTS
)paren
id|raise_rts
c_func
(paren
id|port
)paren
suffix:semicolon
r_else
id|drop_rts
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_amp
id|TIOCM_DTR
)paren
id|raise_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
r_else
id|drop_dtr
c_func
(paren
id|port
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isicom_set_serial_info
r_static
r_int
id|isicom_set_serial_info
c_func
(paren
r_struct
id|isi_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|info
)paren
(brace
r_struct
id|serial_struct
id|newinfo
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reconfig_port
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|newinfo
comma
id|info
comma
r_sizeof
(paren
id|newinfo
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|reconfig_port
op_assign
(paren
(paren
id|port-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_ne
(paren
id|newinfo.flags
op_amp
id|ASYNC_SPD_MASK
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|newinfo.close_delay
op_ne
id|port-&gt;close_delay
)paren
op_logical_or
(paren
id|newinfo.closing_wait
op_ne
id|port-&gt;closing_wait
)paren
op_logical_or
(paren
(paren
id|newinfo.flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
op_ne
(paren
id|port-&gt;flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|port-&gt;flags
op_assign
(paren
(paren
id|port-&gt;flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
op_or
(paren
id|newinfo.flags
op_amp
id|ASYNC_USR_MASK
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|port-&gt;close_delay
op_assign
id|newinfo.close_delay
suffix:semicolon
id|port-&gt;closing_wait
op_assign
id|newinfo.closing_wait
suffix:semicolon
id|port-&gt;flags
op_assign
(paren
(paren
id|port-&gt;flags
op_amp
op_complement
id|ASYNC_FLAGS
)paren
op_or
(paren
id|newinfo.flags
op_amp
id|ASYNC_FLAGS
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reconfig_port
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isicom_config_port
c_func
(paren
id|port
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isicom_get_serial_info
r_static
r_int
id|isicom_get_serial_info
c_func
(paren
r_struct
id|isi_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|info
)paren
(brace
r_struct
id|serial_struct
id|out_info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|out_info
comma
l_int|0
comma
r_sizeof
(paren
id|out_info
)paren
)paren
suffix:semicolon
multiline_comment|/*&t;out_info.type = ? */
id|out_info.line
op_assign
id|port
op_minus
id|isi_ports
suffix:semicolon
id|out_info.port
op_assign
id|port-&gt;card-&gt;base
suffix:semicolon
id|out_info.irq
op_assign
id|port-&gt;card-&gt;irq
suffix:semicolon
id|out_info.flags
op_assign
id|port-&gt;flags
suffix:semicolon
multiline_comment|/*&t;out_info.baud_base = ? */
id|out_info.close_delay
op_assign
id|port-&gt;close_delay
suffix:semicolon
id|out_info.closing_wait
op_assign
id|port-&gt;closing_wait
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|info
comma
op_amp
id|out_info
comma
r_sizeof
(paren
id|out_info
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isicom_ioctl
r_static
r_int
id|isicom_ioctl
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_ioctl&quot;
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TCSBRK
suffix:colon
id|retval
op_assign
id|tty_check_change
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
id|isicom_send_break
c_func
(paren
id|port
comma
id|HZ
op_div
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TCSBRKP
suffix:colon
id|retval
op_assign
id|tty_check_change
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|0
)paren
suffix:semicolon
id|isicom_send_break
c_func
(paren
id|port
comma
id|arg
ques
c_cond
id|arg
op_star
(paren
id|HZ
op_div
l_int|10
)paren
suffix:colon
id|HZ
op_div
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TIOCGSOFTCAR
suffix:colon
r_return
id|put_user
c_func
(paren
id|C_CLOCAL
c_func
(paren
id|tty
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCSSOFTCAR
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|arg
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|tty-&gt;termios-&gt;c_cflag
op_assign
(paren
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
op_complement
id|CLOCAL
)paren
op_or
(paren
id|arg
ques
c_cond
id|CLOCAL
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TIOCMGET
suffix:colon
r_return
id|isicom_get_modem_info
c_func
(paren
id|port
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCMBIS
suffix:colon
r_case
id|TIOCMBIC
suffix:colon
r_case
id|TIOCMSET
suffix:colon
r_return
id|isicom_set_modem_info
c_func
(paren
id|port
comma
id|cmd
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCGSERIAL
suffix:colon
r_return
id|isicom_get_serial_info
c_func
(paren
id|port
comma
(paren
r_struct
id|serial_struct
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCSSERIAL
suffix:colon
r_return
id|isicom_set_serial_info
c_func
(paren
id|port
comma
(paren
r_struct
id|serial_struct
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set_termios et all */
DECL|function|isicom_set_termios
r_static
r_void
id|isicom_set_termios
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_set_termios&quot;
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;termios-&gt;c_cflag
op_eq
id|old_termios-&gt;c_cflag
op_logical_and
id|tty-&gt;termios-&gt;c_iflag
op_eq
id|old_termios-&gt;c_iflag
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isicom_config_port
c_func
(paren
id|port
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_termios-&gt;c_cflag
op_amp
id|CRTSCTS
)paren
op_logical_and
op_logical_neg
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
id|CRTSCTS
)paren
)paren
(brace
id|tty-&gt;hw_stopped
op_assign
l_int|0
suffix:semicolon
id|isicom_start
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* throttle et all */
DECL|function|isicom_throttle
r_static
r_void
id|isicom_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_throttle&quot;
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* tell the card that this port cannot handle any more data for now */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;port_status
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|port-&gt;channel
)paren
suffix:semicolon
id|outw
c_func
(paren
id|card-&gt;port_status
comma
id|card-&gt;base
op_plus
l_int|0x02
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* unthrottle et all */
DECL|function|isicom_unthrottle
r_static
r_void
id|isicom_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_struct
id|isi_board
op_star
id|card
op_assign
id|port-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_unthrottle&quot;
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* tell the card that this port is ready to accept more data */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;port_status
op_or_assign
(paren
l_int|1
op_lshift
id|port-&gt;channel
)paren
suffix:semicolon
id|outw
c_func
(paren
id|card-&gt;port_status
comma
id|card-&gt;base
op_plus
l_int|0x02
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* stop et all */
DECL|function|isicom_stop
r_static
r_void
id|isicom_stop
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_stop&quot;
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* this tells the transmitter not to consider this port for&n;&t;   data output to the card. */
id|port-&gt;status
op_and_assign
op_complement
id|ISI_TXOK
suffix:semicolon
)brace
multiline_comment|/* start et all */
DECL|function|isicom_start
r_static
r_void
id|isicom_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_start&quot;
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* this tells the transmitter to consider this port for&n;&t;   data output to the card. */
id|port-&gt;status
op_or_assign
id|ISI_TXOK
suffix:semicolon
)brace
multiline_comment|/* hangup et all */
DECL|function|do_isicom_hangup
r_static
r_void
id|do_isicom_hangup
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|data
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
id|tty
op_assign
id|port-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
id|tty
)paren
id|tty_hangup
c_func
(paren
id|tty
)paren
suffix:semicolon
multiline_comment|/* FIXME: module removal race here - AKPM */
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|isicom_hangup
r_static
r_void
id|isicom_hangup
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_hangup&quot;
)paren
)paren
r_return
suffix:semicolon
id|isicom_shutdown_port
c_func
(paren
id|port
)paren
suffix:semicolon
id|port-&gt;count
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_and_assign
op_complement
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
)paren
suffix:semicolon
id|port-&gt;tty
op_assign
l_int|0
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|port-&gt;open_wait
)paren
suffix:semicolon
)brace
multiline_comment|/* flush_buffer et all */
DECL|function|isicom_flush_buffer
r_static
r_void
id|isicom_flush_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|isi_port
op_star
id|port
op_assign
(paren
r_struct
id|isi_port
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isicom_paranoia_check
c_func
(paren
id|port
comma
id|tty-&gt;device
comma
l_string|&quot;isicom_flush_buffer&quot;
)paren
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|port-&gt;xmit_cnt
op_assign
id|port-&gt;xmit_head
op_assign
id|port-&gt;xmit_tail
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|tty-&gt;write_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_DO_WRITE_WAKEUP
)paren
)paren
op_logical_and
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|register_ioregion
r_static
r_int
id|register_ioregion
c_func
(paren
r_void
)paren
(brace
r_int
id|count
comma
id|done
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: I/O Region 0x%x-0x%x is busy. Card%d will be disabled.&bslash;n&quot;
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
op_plus
l_int|15
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
id|isi_card
(braket
id|count
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|request_region
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
l_int|16
comma
id|ISICOM_NAME
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: I/O Region 0x%x-0x%x requested for Card%d.&bslash;n&quot;
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
op_plus
l_int|15
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
id|done
op_increment
suffix:semicolon
)brace
)brace
)brace
r_return
id|done
suffix:semicolon
)brace
DECL|function|unregister_ioregion
r_static
r_void
id|unregister_ioregion
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
)paren
(brace
id|release_region
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
l_int|16
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: I/O Region 0x%x-0x%x released for Card%d.&bslash;n&quot;
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
op_plus
l_int|15
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
)brace
)brace
DECL|function|register_drivers
r_static
r_int
id|register_drivers
c_func
(paren
r_void
)paren
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/* tty driver structure initialization */
id|memset
c_func
(paren
op_amp
id|isicom_normal
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tty_driver
)paren
)paren
suffix:semicolon
id|isicom_normal.magic
op_assign
id|TTY_DRIVER_MAGIC
suffix:semicolon
id|isicom_normal.name
op_assign
l_string|&quot;ttyM&quot;
suffix:semicolon
id|isicom_normal.major
op_assign
id|ISICOM_NMAJOR
suffix:semicolon
id|isicom_normal.minor_start
op_assign
l_int|0
suffix:semicolon
id|isicom_normal.num
op_assign
id|PORT_COUNT
suffix:semicolon
id|isicom_normal.type
op_assign
id|TTY_DRIVER_TYPE_SERIAL
suffix:semicolon
id|isicom_normal.subtype
op_assign
id|SERIAL_TYPE_NORMAL
suffix:semicolon
id|isicom_normal.init_termios
op_assign
id|tty_std_termios
suffix:semicolon
id|isicom_normal.init_termios.c_cflag
op_assign
id|B9600
op_or
id|CS8
op_or
id|CREAD
op_or
id|HUPCL
op_or
id|CLOCAL
suffix:semicolon
id|isicom_normal.flags
op_assign
id|TTY_DRIVER_REAL_RAW
suffix:semicolon
id|isicom_normal.refcount
op_assign
op_amp
id|isicom_refcount
suffix:semicolon
id|isicom_normal.table
op_assign
id|isicom_table
suffix:semicolon
id|isicom_normal.termios
op_assign
id|isicom_termios
suffix:semicolon
id|isicom_normal.termios_locked
op_assign
id|isicom_termios_locked
suffix:semicolon
id|isicom_normal.open
op_assign
id|isicom_open
suffix:semicolon
id|isicom_normal.close
op_assign
id|isicom_close
suffix:semicolon
id|isicom_normal.write
op_assign
id|isicom_write
suffix:semicolon
id|isicom_normal.put_char
op_assign
id|isicom_put_char
suffix:semicolon
id|isicom_normal.flush_chars
op_assign
id|isicom_flush_chars
suffix:semicolon
id|isicom_normal.write_room
op_assign
id|isicom_write_room
suffix:semicolon
id|isicom_normal.chars_in_buffer
op_assign
id|isicom_chars_in_buffer
suffix:semicolon
id|isicom_normal.ioctl
op_assign
id|isicom_ioctl
suffix:semicolon
id|isicom_normal.set_termios
op_assign
id|isicom_set_termios
suffix:semicolon
id|isicom_normal.throttle
op_assign
id|isicom_throttle
suffix:semicolon
id|isicom_normal.unthrottle
op_assign
id|isicom_unthrottle
suffix:semicolon
id|isicom_normal.stop
op_assign
id|isicom_stop
suffix:semicolon
id|isicom_normal.start
op_assign
id|isicom_start
suffix:semicolon
id|isicom_normal.hangup
op_assign
id|isicom_hangup
suffix:semicolon
id|isicom_normal.flush_buffer
op_assign
id|isicom_flush_buffer
suffix:semicolon
multiline_comment|/*&t;callout device&t;*/
id|isicom_callout
op_assign
id|isicom_normal
suffix:semicolon
id|isicom_callout.name
op_assign
l_string|&quot;cum&quot;
suffix:semicolon
id|isicom_callout.major
op_assign
id|ISICOM_CMAJOR
suffix:semicolon
id|isicom_callout.subtype
op_assign
id|SERIAL_TYPE_CALLOUT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|tty_register_driver
c_func
(paren
op_amp
id|isicom_normal
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Couldn&squot;t register the dialin driver, error=%d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|tty_register_driver
c_func
(paren
op_amp
id|isicom_callout
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|tty_unregister_driver
c_func
(paren
op_amp
id|isicom_normal
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Couldn&squot;t register the callout driver, error=%d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unregister_drivers
r_static
r_void
id|unregister_drivers
c_func
(paren
r_void
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|tty_unregister_driver
c_func
(paren
op_amp
id|isicom_callout
)paren
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: couldn&squot;t unregister callout driver error=%d.&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|isicom_normal
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: couldn&squot;t unregister normal driver error=%d.&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
)brace
DECL|function|register_isr
r_static
r_int
id|register_isr
c_func
(paren
r_void
)paren
(brace
r_int
id|count
comma
id|done
op_assign
l_int|0
comma
id|card
suffix:semicolon
r_int
id|flag
suffix:semicolon
r_int
r_char
id|request
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
)paren
(brace
multiline_comment|/*&n;&t;&t; * verify if the required irq has already been requested for&n;&t;&t; * another ISI Card, if so we already have it, else request it&n;&t;&t; */
id|request
op_assign
id|YES
suffix:semicolon
r_for
c_loop
(paren
id|card
op_assign
l_int|0
suffix:semicolon
id|card
OL
id|count
suffix:semicolon
id|card
op_increment
)paren
r_if
c_cond
(paren
(paren
id|isi_card
(braket
id|card
)braket
dot
id|base
)paren
op_logical_and
(paren
id|isi_card
(braket
id|card
)braket
dot
id|irq
op_eq
id|isi_card
(braket
id|count
)braket
dot
id|irq
)paren
)paren
(brace
id|request
op_assign
id|NO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|isi_card
(braket
id|count
)braket
dot
id|isa
op_eq
id|NO
)paren
op_logical_and
(paren
id|isi_card
(braket
id|card
)braket
dot
id|isa
op_eq
id|NO
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * ISA cards cannot share interrupts with other&n;&t;&t;&t;&t; * PCI or ISA devices hence disable this card.&n;&t;&t;&t;&t; */
id|release_region
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
l_int|16
)paren
suffix:semicolon
id|isi_card
(braket
id|count
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|flag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|isa
op_eq
id|NO
)paren
(brace
id|flag
op_or_assign
id|SA_SHIRQ
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request
op_eq
id|YES
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|irq
comma
id|isicom_interrupt
comma
id|SA_INTERRUPT
op_or
id|flag
comma
id|ISICOM_NAME
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISICOM: Could not install handler at Irq %d. Card%d will be disabled.&bslash;n&quot;
comma
id|isi_card
(braket
id|count
)braket
dot
id|irq
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
l_int|16
)paren
suffix:semicolon
id|isi_card
(braket
id|count
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ISICOM: Card%d at 0x%x using irq %d.&bslash;n&quot;
comma
id|count
op_plus
l_int|1
comma
id|isi_card
(braket
id|count
)braket
dot
id|base
comma
id|isi_card
(braket
id|count
)braket
dot
id|irq
)paren
suffix:semicolon
id|irq_to_board
(braket
id|isi_card
(braket
id|count
)braket
dot
id|irq
)braket
op_assign
op_amp
id|isi_card
(braket
id|count
)braket
suffix:semicolon
id|done
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
id|done
suffix:semicolon
)brace
DECL|function|unregister_isr
r_static
r_void
id|unregister_isr
c_func
(paren
r_void
)paren
(brace
r_int
id|count
comma
id|card
suffix:semicolon
r_int
r_char
id|freeirq
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
)paren
(brace
id|freeirq
op_assign
id|YES
suffix:semicolon
r_for
c_loop
(paren
id|card
op_assign
l_int|0
suffix:semicolon
id|card
OL
id|count
suffix:semicolon
id|card
op_increment
)paren
r_if
c_cond
(paren
(paren
id|isi_card
(braket
id|card
)braket
dot
id|base
)paren
op_logical_and
(paren
id|isi_card
(braket
id|card
)braket
dot
id|irq
op_eq
id|isi_card
(braket
id|count
)braket
dot
id|irq
)paren
)paren
(brace
id|freeirq
op_assign
id|NO
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freeirq
op_eq
id|YES
)paren
(brace
id|free_irq
c_func
(paren
id|isi_card
(braket
id|count
)braket
dot
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;&t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Irq %d released for Card%d.&bslash;n&quot;
comma
id|isi_card
(braket
id|count
)braket
dot
id|irq
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif&t;
)brace
)brace
)brace
)brace
DECL|function|isicom_init
r_static
r_int
id|isicom_init
c_func
(paren
r_void
)paren
(brace
r_int
id|card
comma
id|channel
comma
id|base
suffix:semicolon
r_struct
id|isi_port
op_star
id|port
suffix:semicolon
r_int
r_int
id|page
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp_buf
)paren
(brace
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
macro_line|#ifdef ISICOM_DEBUG&t;      &t;
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISICOM: Couldn&squot;t allocate page for tmp_buf.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Not enough memory...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;      
r_return
l_int|0
suffix:semicolon
)brace
id|tmp_buf
op_assign
(paren
r_int
r_char
op_star
)paren
id|page
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|register_ioregion
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: All required I/O space found busy.&bslash;n&quot;
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tmp_buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_drivers
c_func
(paren
)paren
)paren
(brace
id|unregister_ioregion
c_func
(paren
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tmp_buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|register_isr
c_func
(paren
)paren
)paren
(brace
id|unregister_drivers
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*  ioports already uregistered in register_isr */
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tmp_buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* initialize bottom half  */
id|init_bh
c_func
(paren
id|ISICOM_BH
comma
id|do_isicom_bh
)paren
suffix:semicolon
id|memset
c_func
(paren
id|isi_ports
comma
l_int|0
comma
r_sizeof
(paren
id|isi_ports
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|card
op_assign
l_int|0
suffix:semicolon
id|card
OL
id|BOARD_COUNT
suffix:semicolon
id|card
op_increment
)paren
(brace
id|port
op_assign
op_amp
id|isi_ports
(braket
id|card
op_star
l_int|16
)braket
suffix:semicolon
id|isi_card
(braket
id|card
)braket
dot
id|ports
op_assign
id|port
suffix:semicolon
id|base
op_assign
id|isi_card
(braket
id|card
)braket
dot
id|base
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
l_int|16
suffix:semicolon
id|channel
op_increment
comma
id|port
op_increment
)paren
(brace
id|port-&gt;magic
op_assign
id|ISICOM_MAGIC
suffix:semicolon
id|port-&gt;card
op_assign
op_amp
id|isi_card
(braket
id|card
)braket
suffix:semicolon
id|port-&gt;channel
op_assign
id|channel
suffix:semicolon
id|port-&gt;normal_termios
op_assign
id|isicom_normal.init_termios
suffix:semicolon
id|port-&gt;callout_termios
op_assign
id|isicom_callout.init_termios
suffix:semicolon
id|port-&gt;close_delay
op_assign
l_int|50
op_star
id|HZ
op_div
l_int|100
suffix:semicolon
id|port-&gt;closing_wait
op_assign
l_int|3000
op_star
id|HZ
op_div
l_int|100
suffix:semicolon
id|port-&gt;hangup_tq.routine
op_assign
id|do_isicom_hangup
suffix:semicolon
id|port-&gt;hangup_tq.data
op_assign
id|port
suffix:semicolon
id|port-&gt;bh_tqueue.routine
op_assign
id|isicom_bottomhalf
suffix:semicolon
id|port-&gt;bh_tqueue.data
op_assign
id|port
suffix:semicolon
id|port-&gt;status
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|port-&gt;open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|port-&gt;close_wait
)paren
suffix:semicolon
multiline_comment|/*  . . .  */
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Insmod can set static symbols so keep these static&n; */
DECL|variable|io
r_static
r_int
id|io
(braket
l_int|4
)braket
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
l_int|4
)braket
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;MultiTech&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver for the ISI series of cards by MultiTech&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|io
comma
l_string|&quot;I/O ports for the cards&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;Interrupts for the cards&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retval
comma
id|card
comma
id|idx
comma
id|count
suffix:semicolon
r_int
r_char
id|pciirq
suffix:semicolon
r_int
r_int
id|ioaddr
suffix:semicolon
id|card
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|BOARD_COUNT
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|io
(braket
id|idx
)braket
)paren
(brace
id|isi_card
(braket
id|idx
)braket
dot
id|base
op_assign
id|io
(braket
id|idx
)braket
suffix:semicolon
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_assign
id|irq
(braket
id|idx
)braket
suffix:semicolon
id|isi_card
(braket
id|idx
)braket
dot
id|isa
op_assign
id|YES
suffix:semicolon
id|card
op_increment
suffix:semicolon
)brace
r_else
(brace
id|isi_card
(braket
id|idx
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|card
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|2
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|3
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|4
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|5
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|7
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|10
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|11
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|12
)paren
op_logical_or
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|irq
op_eq
l_int|15
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|idx
)braket
dot
id|base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Irq %d unsupported. Disabling Card%d...&bslash;n&quot;
comma
id|isi_card
(braket
id|idx
)braket
dot
id|irq
comma
id|idx
op_plus
l_int|1
)paren
suffix:semicolon
id|isi_card
(braket
id|idx
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
id|card
op_decrement
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
op_logical_and
(paren
id|card
OL
id|BOARD_COUNT
)paren
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVID_COUNT
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|VENDOR_ID
comma
id|device_id
(braket
id|idx
)braket
comma
id|dev
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|card
op_ge
id|BOARD_COUNT
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* found a PCI ISI card! */
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|dev
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* i.e at offset 0x1c in the&n;&t;&t;&t;&t;&t;&t;&t;&t;       * PCI configuration register&n;&t;&t;&t;&t;&t;&t;&t;&t;       * space.&n;&t;&t;&t;&t;&t;&t;&t;&t;       */
id|pciirq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ISI PCI Card(Device ID 0x%x)&bslash;n&quot;
comma
id|device_id
(braket
id|idx
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * allot the first empty slot in the array&n;&t;&t;&t;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|BOARD_COUNT
suffix:semicolon
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isi_card
(braket
id|count
)braket
dot
id|base
op_eq
l_int|0
)paren
(brace
id|isi_card
(braket
id|count
)braket
dot
id|base
op_assign
id|ioaddr
suffix:semicolon
id|isi_card
(braket
id|count
)braket
dot
id|irq
op_assign
id|pciirq
suffix:semicolon
id|isi_card
(braket
id|count
)braket
dot
id|isa
op_assign
id|NO
suffix:semicolon
id|card
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|card
op_ge
id|BOARD_COUNT
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|isi_card
(braket
l_int|0
)braket
dot
id|base
op_logical_or
id|isi_card
(braket
l_int|1
)braket
dot
id|base
op_logical_or
id|isi_card
(braket
l_int|2
)braket
dot
id|base
op_logical_or
id|isi_card
(braket
l_int|3
)braket
dot
id|base
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: No valid card configuration. Driver cannot be initialized...&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|retval
op_assign
id|misc_register
c_func
(paren
op_amp
id|isiloader_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Unable to register firmware loader driver.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|isicom_init
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|misc_deregister
c_func
(paren
op_amp
id|isiloader_device
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Unable to unregister Firmware Loader driver&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|tx
)paren
suffix:semicolon
id|tx.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|tx.data
op_assign
l_int|0
suffix:semicolon
id|tx.function
op_assign
id|isicom_tx
suffix:semicolon
id|re_schedule
op_assign
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tx
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|re_schedule
op_assign
l_int|0
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
)paren
suffix:semicolon
id|remove_bh
c_func
(paren
id|ISICOM_BH
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;ISICOM: isicom_tx tx_count = %ld.&bslash;n&quot;
comma
id|tx_count
)paren
suffix:semicolon
macro_line|#endif&t;
macro_line|#ifdef ISICOM_DEBUG
id|printk
c_func
(paren
l_string|&quot;ISICOM: uregistering isr ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|unregister_isr
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;ISICOM: unregistering drivers ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|unregister_drivers
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;ISICOM: unregistering ioregion ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|unregister_ioregion
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;ISICOM: freeing tmp_buf ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tmp_buf
)paren
suffix:semicolon
macro_line|#ifdef ISICOM_DEBUG&t;&t;
id|printk
c_func
(paren
l_string|&quot;ISICOM: unregistering firmware loader ...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|misc_deregister
c_func
(paren
op_amp
id|isiloader_device
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ISICOM: Unable to unregister Firmware Loader driver&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
