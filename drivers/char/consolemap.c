multiline_comment|/*&n; * consolemap.c&n; *&n; * Mapping from internal code (such as Latin-1 or Unicode or IBM PC code)&n; * to font positions.&n; *&n; * aeb, 950210&n; */
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &quot;consolemap.h&quot;
DECL|variable|translations
r_static
r_int
r_char
op_star
id|translations
(braket
)braket
op_assign
(brace
multiline_comment|/* 8-bit Latin-1 mapped to the PC character set: &squot;&bslash;0&squot; means non-printable */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;376&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^_&quot;
l_string|&quot;`abcdefghijklmnopqrstuvwxyz{|}~&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;377&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;350&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;355&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
comma
multiline_comment|/* vt100 graphics */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;376&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^ &quot;
l_string|&quot;&bslash;004&bslash;261&bslash;007&bslash;007&bslash;007&bslash;007&bslash;370&bslash;361&bslash;007&bslash;007&bslash;331&bslash;277&bslash;332&bslash;300&bslash;305&bslash;304&quot;
l_string|&quot;&bslash;304&bslash;304&bslash;137&bslash;137&bslash;303&bslash;264&bslash;301&bslash;302&bslash;263&bslash;363&bslash;362&bslash;343&bslash;330&bslash;234&bslash;007&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;377&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;376&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
comma
multiline_comment|/* IBM graphics: minimal translations (BS, CR, LF, LL, SO, SI and ESC) */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;000&bslash;001&bslash;002&bslash;003&bslash;004&bslash;005&bslash;006&bslash;007&bslash;000&bslash;011&bslash;000&bslash;013&bslash;000&bslash;000&bslash;000&bslash;000&quot;
l_string|&quot;&bslash;020&bslash;021&bslash;022&bslash;023&bslash;024&bslash;025&bslash;026&bslash;027&bslash;030&bslash;031&bslash;032&bslash;000&bslash;034&bslash;035&bslash;036&bslash;037&quot;
l_string|&quot;&bslash;040&bslash;041&bslash;042&bslash;043&bslash;044&bslash;045&bslash;046&bslash;047&bslash;050&bslash;051&bslash;052&bslash;053&bslash;054&bslash;055&bslash;056&bslash;057&quot;
l_string|&quot;&bslash;060&bslash;061&bslash;062&bslash;063&bslash;064&bslash;065&bslash;066&bslash;067&bslash;070&bslash;071&bslash;072&bslash;073&bslash;074&bslash;075&bslash;076&bslash;077&quot;
l_string|&quot;&bslash;100&bslash;101&bslash;102&bslash;103&bslash;104&bslash;105&bslash;106&bslash;107&bslash;110&bslash;111&bslash;112&bslash;113&bslash;114&bslash;115&bslash;116&bslash;117&quot;
l_string|&quot;&bslash;120&bslash;121&bslash;122&bslash;123&bslash;124&bslash;125&bslash;126&bslash;127&bslash;130&bslash;131&bslash;132&bslash;133&bslash;134&bslash;135&bslash;136&bslash;137&quot;
l_string|&quot;&bslash;140&bslash;141&bslash;142&bslash;143&bslash;144&bslash;145&bslash;146&bslash;147&bslash;150&bslash;151&bslash;152&bslash;153&bslash;154&bslash;155&bslash;156&bslash;157&quot;
l_string|&quot;&bslash;160&bslash;161&bslash;162&bslash;163&bslash;164&bslash;165&bslash;166&bslash;167&bslash;170&bslash;171&bslash;172&bslash;173&bslash;174&bslash;175&bslash;176&bslash;177&quot;
l_string|&quot;&bslash;200&bslash;201&bslash;202&bslash;203&bslash;204&bslash;205&bslash;206&bslash;207&bslash;210&bslash;211&bslash;212&bslash;213&bslash;214&bslash;215&bslash;216&bslash;217&quot;
l_string|&quot;&bslash;220&bslash;221&bslash;222&bslash;223&bslash;224&bslash;225&bslash;226&bslash;227&bslash;230&bslash;231&bslash;232&bslash;233&bslash;234&bslash;235&bslash;236&bslash;237&quot;
l_string|&quot;&bslash;240&bslash;241&bslash;242&bslash;243&bslash;244&bslash;245&bslash;246&bslash;247&bslash;250&bslash;251&bslash;252&bslash;253&bslash;254&bslash;255&bslash;256&bslash;257&quot;
l_string|&quot;&bslash;260&bslash;261&bslash;262&bslash;263&bslash;264&bslash;265&bslash;266&bslash;267&bslash;270&bslash;271&bslash;272&bslash;273&bslash;274&bslash;275&bslash;276&bslash;277&quot;
l_string|&quot;&bslash;300&bslash;301&bslash;302&bslash;303&bslash;304&bslash;305&bslash;306&bslash;307&bslash;310&bslash;311&bslash;312&bslash;313&bslash;314&bslash;315&bslash;316&bslash;317&quot;
l_string|&quot;&bslash;320&bslash;321&bslash;322&bslash;323&bslash;324&bslash;325&bslash;326&bslash;327&bslash;330&bslash;331&bslash;332&bslash;333&bslash;334&bslash;335&bslash;336&bslash;337&quot;
l_string|&quot;&bslash;340&bslash;341&bslash;342&bslash;343&bslash;344&bslash;345&bslash;346&bslash;347&bslash;350&bslash;351&bslash;352&bslash;353&bslash;354&bslash;355&bslash;356&bslash;357&quot;
l_string|&quot;&bslash;360&bslash;361&bslash;362&bslash;363&bslash;364&bslash;365&bslash;366&bslash;367&bslash;370&bslash;371&bslash;372&bslash;373&bslash;374&bslash;375&bslash;376&bslash;377&quot;
comma
multiline_comment|/* USER: customizable mappings, initialized as the previous one (IBM) */
(paren
r_int
r_char
op_star
)paren
l_string|&quot;&bslash;000&bslash;001&bslash;002&bslash;003&bslash;004&bslash;005&bslash;006&bslash;007&bslash;010&bslash;011&bslash;000&bslash;013&bslash;000&bslash;000&bslash;016&bslash;017&quot;
l_string|&quot;&bslash;020&bslash;021&bslash;022&bslash;023&bslash;024&bslash;025&bslash;026&bslash;027&bslash;030&bslash;031&bslash;032&bslash;000&bslash;034&bslash;035&bslash;036&bslash;037&quot;
l_string|&quot;&bslash;040&bslash;041&bslash;042&bslash;043&bslash;044&bslash;045&bslash;046&bslash;047&bslash;050&bslash;051&bslash;052&bslash;053&bslash;054&bslash;055&bslash;056&bslash;057&quot;
l_string|&quot;&bslash;060&bslash;061&bslash;062&bslash;063&bslash;064&bslash;065&bslash;066&bslash;067&bslash;070&bslash;071&bslash;072&bslash;073&bslash;074&bslash;075&bslash;076&bslash;077&quot;
l_string|&quot;&bslash;100&bslash;101&bslash;102&bslash;103&bslash;104&bslash;105&bslash;106&bslash;107&bslash;110&bslash;111&bslash;112&bslash;113&bslash;114&bslash;115&bslash;116&bslash;117&quot;
l_string|&quot;&bslash;120&bslash;121&bslash;122&bslash;123&bslash;124&bslash;125&bslash;126&bslash;127&bslash;130&bslash;131&bslash;132&bslash;133&bslash;134&bslash;135&bslash;136&bslash;137&quot;
l_string|&quot;&bslash;140&bslash;141&bslash;142&bslash;143&bslash;144&bslash;145&bslash;146&bslash;147&bslash;150&bslash;151&bslash;152&bslash;153&bslash;154&bslash;155&bslash;156&bslash;157&quot;
l_string|&quot;&bslash;160&bslash;161&bslash;162&bslash;163&bslash;164&bslash;165&bslash;166&bslash;167&bslash;170&bslash;171&bslash;172&bslash;173&bslash;174&bslash;175&bslash;176&bslash;177&quot;
l_string|&quot;&bslash;200&bslash;201&bslash;202&bslash;203&bslash;204&bslash;205&bslash;206&bslash;207&bslash;210&bslash;211&bslash;212&bslash;213&bslash;214&bslash;215&bslash;216&bslash;217&quot;
l_string|&quot;&bslash;220&bslash;221&bslash;222&bslash;223&bslash;224&bslash;225&bslash;226&bslash;227&bslash;230&bslash;231&bslash;232&bslash;233&bslash;234&bslash;235&bslash;236&bslash;237&quot;
l_string|&quot;&bslash;240&bslash;241&bslash;242&bslash;243&bslash;244&bslash;245&bslash;246&bslash;247&bslash;250&bslash;251&bslash;252&bslash;253&bslash;254&bslash;255&bslash;256&bslash;257&quot;
l_string|&quot;&bslash;260&bslash;261&bslash;262&bslash;263&bslash;264&bslash;265&bslash;266&bslash;267&bslash;270&bslash;271&bslash;272&bslash;273&bslash;274&bslash;275&bslash;276&bslash;277&quot;
l_string|&quot;&bslash;300&bslash;301&bslash;302&bslash;303&bslash;304&bslash;305&bslash;306&bslash;307&bslash;310&bslash;311&bslash;312&bslash;313&bslash;314&bslash;315&bslash;316&bslash;317&quot;
l_string|&quot;&bslash;320&bslash;321&bslash;322&bslash;323&bslash;324&bslash;325&bslash;326&bslash;327&bslash;330&bslash;331&bslash;332&bslash;333&bslash;334&bslash;335&bslash;336&bslash;337&quot;
l_string|&quot;&bslash;340&bslash;341&bslash;342&bslash;343&bslash;344&bslash;345&bslash;346&bslash;347&bslash;350&bslash;351&bslash;352&bslash;353&bslash;354&bslash;355&bslash;356&bslash;357&quot;
l_string|&quot;&bslash;360&bslash;361&bslash;362&bslash;363&bslash;364&bslash;365&bslash;366&bslash;367&bslash;370&bslash;371&bslash;372&bslash;373&bslash;374&bslash;375&bslash;376&bslash;377&quot;
)brace
suffix:semicolon
multiline_comment|/* the above mappings are not invertible - this is just a best effort */
DECL|variable|inv_translate
r_static
r_int
r_char
op_star
id|inv_translate
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|inv_norm_transl
r_static
r_int
r_char
id|inv_norm_transl
(braket
id|E_TABSZ
)braket
suffix:semicolon
DECL|variable|inverse_translations
r_static
r_int
r_char
op_star
id|inverse_translations
(braket
l_int|4
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|set_inverse_transl
r_static
r_void
id|set_inverse_transl
c_func
(paren
r_int
id|i
)paren
(brace
r_int
id|j
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|translations
(braket
id|i
)braket
suffix:semicolon
r_int
r_char
op_star
id|q
op_assign
id|inverse_translations
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
multiline_comment|/* slightly messy to avoid calling kmalloc too early */
id|q
op_assign
id|inverse_translations
(braket
id|i
)braket
op_assign
(paren
(paren
id|i
op_eq
id|NORM_MAP
)paren
ques
c_cond
id|inv_norm_transl
suffix:colon
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|E_TABSZ
comma
id|GFP_KERNEL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|E_TABSZ
suffix:semicolon
id|j
op_increment
)paren
id|q
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|E_TABSZ
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|q
(braket
id|p
(braket
id|j
)braket
)braket
OL
l_int|32
)paren
multiline_comment|/* prefer &squot;-&squot; above SHY etc. */
id|q
(braket
id|p
(braket
id|j
)braket
)braket
op_assign
id|j
suffix:semicolon
)brace
DECL|function|set_translate
r_int
r_char
op_star
id|set_translate
c_func
(paren
r_int
id|m
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inverse_translations
(braket
id|m
)braket
)paren
id|set_inverse_transl
c_func
(paren
id|m
)paren
suffix:semicolon
id|inv_translate
op_assign
id|inverse_translations
(braket
id|m
)braket
suffix:semicolon
r_return
id|translations
(braket
id|m
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * Inverse translation is impossible for several reasons:&n; * 1. The translation maps are not 1-1&n; * 2. The text may have been written while a different translation map&n; *    was active&n; * Still, it is now possible to a certain extent to cut and paste non-ASCII.&n; */
DECL|function|inverse_translate
r_int
r_char
id|inverse_translate
c_func
(paren
r_int
r_char
id|c
)paren
(brace
r_return
(paren
(paren
id|inv_translate
op_logical_and
id|inv_translate
(braket
id|c
)braket
)paren
ques
c_cond
id|inv_translate
(braket
id|c
)braket
suffix:colon
id|c
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Load customizable translation table&n; * arg points to a 256 byte translation table.&n; */
DECL|function|con_set_trans
r_int
id|con_set_trans
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|translations
(braket
id|USER_MAP
)braket
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|E_TABSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|E_TABSZ
suffix:semicolon
id|i
op_increment
)paren
id|p
(braket
id|i
)braket
op_assign
id|get_fs_byte
c_func
(paren
id|arg
op_plus
id|i
)paren
suffix:semicolon
id|p
(braket
l_int|012
)braket
op_assign
id|p
(braket
l_int|014
)braket
op_assign
id|p
(braket
l_int|015
)braket
op_assign
id|p
(braket
l_int|033
)braket
op_assign
l_int|0
suffix:semicolon
id|set_inverse_transl
c_func
(paren
id|USER_MAP
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|con_get_trans
r_int
id|con_get_trans
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|translations
(braket
id|USER_MAP
)braket
suffix:semicolon
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|E_TABSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|E_TABSZ
suffix:semicolon
id|i
op_increment
)paren
id|put_fs_byte
c_func
(paren
id|p
(braket
id|i
)braket
comma
id|arg
op_plus
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Unicode -&gt; current font conversion &n; *&n; * A font has at most 512 chars, usually 256.&n; * But one font position may represent several Unicode chars&n; * (and moreover, hashtables work best when they are not too full),&n; * so pick HASHSIZE somewhat larger than 512.&n; * Since there are likely to be long consecutive stretches&n; * (like U+0000 to U+00FF), HASHSTEP should not be too small.&n; * Searches longer than MAXHASHLEVEL steps are refused, unless&n; * requested explicitly.&n; *&n; * Note: no conversion tables are compiled in, so the user&n; * must supply an explicit mapping herself. See kbd-0.90 (or an&n; * earlier kernel version) for the default Unicode-to-PC mapping.&n; * Usually, the mapping will be loaded simultaneously with the font.&n; */
DECL|macro|HASHSIZE
mdefine_line|#define HASHSIZE   641
DECL|macro|HASHSTEP
mdefine_line|#define HASHSTEP   189&t;&t;/* yields hashlevel = 3 initially */
DECL|macro|MAXHASHLEVEL
mdefine_line|#define MAXHASHLEVEL 6
DECL|variable|hashtable
r_static
r_struct
id|unipair
id|hashtable
(braket
id|HASHSIZE
)braket
suffix:semicolon
DECL|variable|hashtable_contents_valid
r_int
id|hashtable_contents_valid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* cleared by setfont */
DECL|variable|hashsize
r_static
r_int
r_int
id|hashsize
suffix:semicolon
DECL|variable|hashstep
r_static
r_int
r_int
id|hashstep
suffix:semicolon
DECL|variable|hashlevel
r_static
r_int
r_int
id|hashlevel
suffix:semicolon
DECL|variable|maxhashlevel
r_static
r_int
r_int
id|maxhashlevel
suffix:semicolon
r_void
DECL|function|con_clear_unimap
id|con_clear_unimap
c_func
(paren
r_struct
id|unimapinit
op_star
id|ui
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* read advisory values for hash algorithm */
id|hashsize
op_assign
id|ui-&gt;advised_hashsize
suffix:semicolon
r_if
c_cond
(paren
id|hashsize
template_param
id|HASHSIZE
)paren
id|hashsize
op_assign
id|HASHSIZE
suffix:semicolon
id|hashstep
op_assign
(paren
id|ui-&gt;advised_hashstep
op_mod
id|hashsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hashstep
OL
l_int|64
)paren
id|hashstep
op_assign
id|HASHSTEP
suffix:semicolon
id|maxhashlevel
op_assign
id|ui-&gt;advised_hashlevel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|maxhashlevel
)paren
id|maxhashlevel
op_assign
id|MAXHASHLEVEL
suffix:semicolon
r_if
c_cond
(paren
id|maxhashlevel
OG
id|hashsize
)paren
id|maxhashlevel
op_assign
id|hashsize
suffix:semicolon
multiline_comment|/* initialize */
id|hashlevel
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hashsize
suffix:semicolon
id|i
op_increment
)paren
id|hashtable
(braket
id|i
)braket
dot
id|unicode
op_assign
l_int|0xffff
suffix:semicolon
id|hashtable_contents_valid
op_assign
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|con_set_unimap
(def_block
id|con_set_unimap
c_func
(paren
id|ushort
id|ct
comma
r_struct
id|unipair
op_star
id|list
)paren
(brace
r_int
id|i
comma
id|lct
suffix:semicolon
id|ushort
id|u
comma
id|hu
suffix:semicolon
r_struct
id|unimapinit
id|hashdefaults
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hashtable_contents_valid
)paren
id|con_clear_unimap
c_func
(paren
op_amp
id|hashdefaults
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ct
)paren
(brace
id|u
op_assign
id|get_fs_word
c_func
(paren
op_amp
id|list-&gt;unicode
)paren
suffix:semicolon
id|i
op_assign
id|u
op_mod
id|hashsize
suffix:semicolon
id|lct
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|hu
op_assign
id|hashtable
(braket
id|i
)braket
dot
id|unicode
)paren
op_ne
l_int|0xffff
op_logical_and
id|hu
op_ne
id|u
)paren
(brace
r_if
c_cond
(paren
id|lct
op_increment
op_ge
id|maxhashlevel
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|i
op_add_assign
id|hashstep
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|hashsize
)paren
id|i
op_sub_assign
id|hashsize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lct
OG
id|hashlevel
)paren
id|hashlevel
op_assign
id|lct
suffix:semicolon
id|hashtable
(braket
id|i
)braket
dot
id|unicode
op_assign
id|u
suffix:semicolon
id|hashtable
(braket
id|i
)braket
dot
id|fontpos
op_assign
id|get_fs_word
c_func
(paren
op_amp
id|list-&gt;fontpos
)paren
suffix:semicolon
id|list
op_increment
suffix:semicolon
id|ct
op_decrement
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)def_block
r_int
DECL|function|con_get_unimap
(def_block
id|con_get_unimap
c_func
(paren
id|ushort
id|ct
comma
id|ushort
op_star
id|uct
comma
r_struct
id|unipair
op_star
id|list
)paren
(brace
r_int
id|i
comma
id|ect
suffix:semicolon
id|ect
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hashtable_contents_valid
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hashsize
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|hashtable
(braket
id|i
)braket
dot
id|unicode
op_ne
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
id|ect
op_increment
OL
id|ct
)paren
(brace
id|put_fs_word
c_func
(paren
id|hashtable
(braket
id|i
)braket
dot
id|unicode
comma
op_amp
id|list-&gt;unicode
)paren
suffix:semicolon
id|put_fs_word
c_func
(paren
id|hashtable
(braket
id|i
)braket
dot
id|fontpos
comma
op_amp
id|list-&gt;fontpos
)paren
suffix:semicolon
id|list
op_increment
suffix:semicolon
)brace
)brace
id|put_fs_word
c_func
(paren
id|ect
comma
id|uct
)paren
suffix:semicolon
r_return
(paren
(paren
id|ect
op_le
id|ct
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
)def_block
r_int
DECL|function|conv_uni_to_pc
id|conv_uni_to_pc
c_func
(paren
r_int
r_int
id|ucs
)paren
(brace
r_int
id|i
comma
id|h
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hashtable_contents_valid
op_logical_or
id|ucs
OL
l_int|0x20
)paren
r_return
op_minus
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|ucs
op_eq
l_int|0xffff
op_logical_or
id|ucs
op_eq
l_int|0xfffe
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ucs
op_eq
l_int|0xfeff
op_logical_or
(paren
id|ucs
op_ge
l_int|0x200a
op_logical_and
id|ucs
op_le
l_int|0x200f
)paren
)paren
r_return
op_minus
l_int|2
suffix:semicolon
id|h
op_assign
id|ucs
op_mod
id|hashsize
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hashlevel
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|hashtable
(braket
id|h
)braket
dot
id|unicode
op_eq
id|ucs
)paren
r_return
id|hashtable
(braket
id|h
)braket
dot
id|fontpos
suffix:semicolon
r_if
c_cond
(paren
(paren
id|h
op_add_assign
id|hashstep
)paren
op_ge
id|hashsize
)paren
id|h
op_sub_assign
id|hashsize
suffix:semicolon
)brace
r_return
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* not found */
)brace
eof
