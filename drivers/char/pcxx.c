multiline_comment|/*&n; *  linux/drivers/char/pcxx.c&n; * &n; *  Written by Troy De Jongh, November, 1994&n; *&n; *  Copyright (C) 1994,1995 Troy De Jongh&n; *  This software may be used and distributed according to the terms &n; *  of the GNU Public License.&n; *&n; *  This driver is for the DigiBoard PC/Xe and PC/Xi line of products.&n; *&n; *  This driver does NOT support DigiBoard&squot;s fastcook FEP option and&n; *  does not support the transparent print (i.e. digiprint) option.&n; *&n; * This Driver is currently maintained by Christoph Lameter (christoph@lameter.com)&n; *&n; * Please contact digi for support issues at digilnux@dgii.com.&n; * Some more information can be found at&n; * http://lameter.com/digi.&n; *&n; *  1.5.2 Fall 1995 Bug fixes by David Nugent&n; *  1.5.3 March 9, 1996 Christoph Lameter: Fixed 115.2K Support. Memory&n; *&t;&t;allocation harmonized with 1.3.X Series.&n; *  1.5.4 March 30, 1996 Christoph Lameter: Fixup for 1.3.81. Use init_bh&n; *&t;&t;instead of direct assignment to kernel arrays.&n; *  1.5.5 April 5, 1996 Major device numbers corrected.&n; *              Mike McLagan&lt;mike.mclagan@linux.org&gt;: Add setup&n; *              variable handling, instead of using the old pcxxconfig.h&n; *  1.5.6 April 16, 1996 Christoph Lameter: Pointer cleanup, macro cleanup.&n; *&t;&t;Call out devices changed to /dev/cudxx.&n; *  1.5.7 July 22, 1996 Martin Mares: CLOCAL fix, pcxe_table clearing.&n; *&t;&t;David Nugent: Bug in pcxe_open.&n; *&t;&t;Brian J. Murrell: Modem Control fixes, Majors correctly assigned&n; *  1.6.1 April 6, 1997 Bernhard Kaindl: fixed virtual memory access for 2.1&n; *              i386-kernels and use on other archtitectures, Allowing use&n; *              as module, added module parameters, added switch to enable&n; *              verbose messages to assist user during card configuration.&n; *              Currently only tested on a PC/Xi card, but should work on Xe&n; *              and Xeve also.&n; *  1.6.2 August, 7, 2000: Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; *  &t;&t;get rid of panics, release previously allocated resources&n; *  1.6.3 August, 23, 2000: Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; *  &t;&t;cleaned up wrt verify_area.&n; *              Christoph Lameter: Update documentation, email addresses&n; *              and URLs. Remove some obsolete code.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/tty_driver.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#ifndef MODULE
macro_line|#include &lt;linux/ctype.h&gt; /* We only need it for parsing the &quot;digi=&quot;-line */
macro_line|#endif
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
DECL|macro|VERSION
mdefine_line|#define VERSION &t;&quot;1.6.3&quot;
macro_line|#include &quot;digi.h&quot;
macro_line|#include &quot;fep.h&quot;
macro_line|#include &quot;pcxx.h&quot;
macro_line|#include &quot;digi_fep.h&quot;
macro_line|#include &quot;digi_bios.h&quot;
multiline_comment|/*&n; * Define one default setting if no digi= config line is used.&n; * Default is altpin = disabled, 16 ports, I/O 200h, Memory 0D0000h&n; */
DECL|variable|boards
r_static
r_struct
id|board_info
id|boards
(braket
id|MAX_DIGI_BOARDS
)braket
op_assign
(brace
(brace
multiline_comment|/* Board is enabled       */
id|ENABLED
comma
multiline_comment|/* Type is auto-detected  */
l_int|0
comma
multiline_comment|/* altping is disabled    */
id|DISABLED
comma
multiline_comment|/* number of ports = 16   */
l_int|16
comma
multiline_comment|/* io address is 0x200    */
l_int|0x200
comma
multiline_comment|/* card memory at 0xd0000 */
l_int|0xd0000
comma
multiline_comment|/* first minor device no. */
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|verbose
r_static
r_int
id|verbose
op_assign
l_int|0
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/* Variables for insmod */
DECL|variable|io
r_static
r_int
id|io
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|membase
r_static
r_int
id|membase
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|memsize
r_static
r_int
id|memsize
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|altpin
r_static
r_int
id|altpin
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|numports
r_static
r_int
id|numports
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
macro_line|# if (LINUX_VERSION_CODE &gt; 0x020111)
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Bernhard Kaindl&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Digiboard PC/X{i,e,eve} driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|verbose
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|membase
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|memsize
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|altpin
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|numports
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
macro_line|# endif
macro_line|#endif MODULE
DECL|variable|numcards
r_static
r_int
id|numcards
op_assign
l_int|1
suffix:semicolon
DECL|variable|nbdevs
r_static
r_int
id|nbdevs
op_assign
l_int|0
suffix:semicolon
DECL|variable|digi_channels
r_static
r_struct
id|channel
op_star
id|digi_channels
suffix:semicolon
DECL|variable|pcxe_table
r_static
r_struct
id|tty_struct
op_star
op_star
id|pcxe_table
suffix:semicolon
DECL|variable|pcxe_termios
r_static
r_struct
id|termios
op_star
op_star
id|pcxe_termios
suffix:semicolon
DECL|variable|pcxe_termios_locked
r_static
r_struct
id|termios
op_star
op_star
id|pcxe_termios_locked
suffix:semicolon
DECL|variable|pcxx_ncook
r_int
id|pcxx_ncook
op_assign
r_sizeof
(paren
id|pcxx_cook
)paren
suffix:semicolon
DECL|variable|pcxx_nbios
r_int
id|pcxx_nbios
op_assign
r_sizeof
(paren
id|pcxx_bios
)paren
suffix:semicolon
DECL|macro|MIN
mdefine_line|#define MIN(a,b)&t;((a) &lt; (b) ? (a) : (b))
DECL|macro|pcxxassert
mdefine_line|#define pcxxassert(x, msg)  if(!(x)) pcxx_error(__LINE__, msg)
DECL|macro|FEPTIMEOUT
mdefine_line|#define FEPTIMEOUT 200000  
DECL|macro|SERIAL_TYPE_NORMAL
mdefine_line|#define SERIAL_TYPE_NORMAL&t;1
DECL|macro|SERIAL_TYPE_CALLOUT
mdefine_line|#define SERIAL_TYPE_CALLOUT&t;2
DECL|macro|PCXE_EVENT_HANGUP
mdefine_line|#define PCXE_EVENT_HANGUP   1
DECL|variable|pcxe_driver
r_struct
id|tty_driver
id|pcxe_driver
suffix:semicolon
DECL|variable|pcxe_callout
r_struct
id|tty_driver
id|pcxe_callout
suffix:semicolon
DECL|variable|pcxe_refcount
r_static
r_int
id|pcxe_refcount
suffix:semicolon
DECL|variable|pcxx_timer
r_static
r_struct
id|timer_list
id|pcxx_timer
suffix:semicolon
DECL|variable|tq_pcxx
id|DECLARE_TASK_QUEUE
c_func
(paren
id|tq_pcxx
)paren
suffix:semicolon
r_static
r_void
id|pcxxpoll
c_func
(paren
r_int
r_int
id|dummy
)paren
suffix:semicolon
r_static
r_void
id|pcxxdelay
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_void
id|fepcmd
c_func
(paren
r_struct
id|channel
op_star
comma
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|pcxe_put_char
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_int
r_char
)paren
suffix:semicolon
r_static
r_void
id|pcxe_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxx_error
c_func
(paren
r_int
comma
r_char
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxe_close
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_struct
id|file
op_star
)paren
suffix:semicolon
r_static
r_int
id|pcxe_ioctl
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|pcxe_set_termios
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_struct
id|termios
op_star
)paren
suffix:semicolon
r_static
r_int
id|pcxe_write
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_int
comma
r_const
r_int
r_char
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|pcxe_write_room
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|pcxe_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxe_flush_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|doevent
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_void
id|receive_data
c_func
(paren
r_struct
id|channel
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxxparam
c_func
(paren
r_struct
id|tty_struct
op_star
comma
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_void
id|do_softint
c_func
(paren
r_void
op_star
)paren
suffix:semicolon
r_static
r_inline
r_void
id|pcxe_sched_event
c_func
(paren
r_struct
id|channel
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|do_pcxe_bh
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|pcxe_start
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxe_stop
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxe_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|pcxe_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
)paren
suffix:semicolon
r_static
r_void
id|digi_send_break
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|msec
)paren
suffix:semicolon
r_static
r_void
id|shutdown
c_func
(paren
r_struct
id|channel
op_star
)paren
suffix:semicolon
r_static
r_void
id|setup_empty_event
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|memwinon
c_func
(paren
r_struct
id|board_info
op_star
id|b
comma
r_int
r_int
id|win
)paren
suffix:semicolon
r_static
r_inline
r_void
id|memwinoff
c_func
(paren
r_struct
id|board_info
op_star
id|b
comma
r_int
r_int
id|win
)paren
suffix:semicolon
r_static
r_inline
r_void
id|globalwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|rxwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|txwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|memoff
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|assertgwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
r_static
r_inline
r_void
id|assertmemoff
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
suffix:semicolon
DECL|macro|TZ_BUFSZ
mdefine_line|#define TZ_BUFSZ 4096
multiline_comment|/* function definitions */
multiline_comment|/*****************************************************************************/
DECL|function|cleanup_board_resources
r_static
r_void
id|cleanup_board_resources
c_func
(paren
r_void
)paren
(brace
r_int
id|crd
comma
id|i
suffix:semicolon
r_struct
id|board_info
op_star
id|bd
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_for
c_loop
(paren
id|crd
op_assign
l_int|0
suffix:semicolon
id|crd
OL
id|numcards
suffix:semicolon
id|crd
op_increment
)paren
(brace
id|bd
op_assign
op_amp
id|boards
(braket
id|crd
)braket
suffix:semicolon
id|ch
op_assign
id|digi_channels
op_plus
id|bd-&gt;first_minor
suffix:semicolon
r_if
c_cond
(paren
id|bd-&gt;region
)paren
id|release_region
c_func
(paren
id|bd-&gt;port
comma
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bd-&gt;numports
suffix:semicolon
id|i
op_increment
comma
id|ch
op_increment
)paren
r_if
c_cond
(paren
id|ch-&gt;tmp_buf
)paren
id|kfree
c_func
(paren
id|ch-&gt;tmp_buf
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************/
macro_line|#ifdef MODULE
multiline_comment|/*&n; * pcxe_init() is our init_module():&n; */
DECL|macro|pcxe_init
mdefine_line|#define pcxe_init init_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*****************************************************************************/
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|e1
comma
id|e2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Unloading PC/Xx version %s&bslash;n&quot;
comma
id|VERSION
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|pcxx_timer
)paren
suffix:semicolon
id|remove_bh
c_func
(paren
id|DIGI_BH
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|e1
op_assign
id|tty_unregister_driver
c_func
(paren
op_amp
id|pcxe_driver
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;SERIAL: failed to unregister serial driver (%d)&bslash;n&quot;
comma
id|e1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|e2
op_assign
id|tty_unregister_driver
c_func
(paren
op_amp
id|pcxe_callout
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;SERIAL: failed to unregister callout driver (%d)&bslash;n&quot;
comma
id|e2
)paren
suffix:semicolon
id|cleanup_board_resources
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|digi_channels
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pcxe_termios_locked
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pcxe_termios
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pcxe_table
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|chan
r_static
r_inline
r_struct
id|channel
op_star
id|chan
c_func
(paren
r_register
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_if
c_cond
(paren
id|tty
)paren
(brace
r_register
r_struct
id|channel
op_star
id|ch
op_assign
(paren
r_struct
id|channel
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|ch
op_ge
id|digi_channels
op_logical_and
id|ch
OL
id|digi_channels
op_plus
id|nbdevs
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;magic
op_eq
id|PCXX_MAGIC
)paren
r_return
id|ch
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* These inline routines are to turn board memory on and off */
DECL|function|memwinon
r_static
r_inline
r_void
id|memwinon
c_func
(paren
r_struct
id|board_info
op_star
id|b
comma
r_int
r_int
id|win
)paren
(brace
r_if
c_cond
(paren
id|b-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|outb_p
c_func
(paren
id|FEPWIN
op_or
id|win
comma
id|b-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|outb_p
c_func
(paren
id|inb
c_func
(paren
id|b-&gt;port
)paren
op_or
id|FEPMEM
comma
id|b-&gt;port
)paren
suffix:semicolon
)brace
DECL|function|memwinoff
r_static
r_inline
r_void
id|memwinoff
c_func
(paren
r_struct
id|board_info
op_star
id|b
comma
r_int
r_int
id|win
)paren
(brace
id|outb_p
c_func
(paren
id|inb
c_func
(paren
id|b-&gt;port
)paren
op_amp
op_complement
id|FEPMEM
comma
id|b-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|outb_p
c_func
(paren
l_int|0
comma
id|b-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|globalwinon
r_static
r_inline
r_void
id|globalwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;board-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|outb_p
c_func
(paren
id|FEPWIN
comma
id|ch-&gt;board-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|outb_p
c_func
(paren
id|FEPMEM
comma
id|ch-&gt;board-&gt;port
)paren
suffix:semicolon
)brace
DECL|function|rxwinon
r_static
r_inline
r_void
id|rxwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;rxwin
op_eq
l_int|0
)paren
(brace
id|outb_p
c_func
(paren
id|FEPMEM
comma
id|ch-&gt;board-&gt;port
)paren
suffix:semicolon
)brace
r_else
id|outb_p
c_func
(paren
id|ch-&gt;rxwin
comma
id|ch-&gt;board-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|txwinon
r_static
r_inline
r_void
id|txwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;txwin
op_eq
l_int|0
)paren
(brace
id|outb_p
c_func
(paren
id|FEPMEM
comma
id|ch-&gt;board-&gt;port
)paren
suffix:semicolon
)brace
r_else
id|outb_p
c_func
(paren
id|ch-&gt;txwin
comma
id|ch-&gt;board-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|memoff
r_static
r_inline
r_void
id|memoff
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
id|outb_p
c_func
(paren
l_int|0
comma
id|ch-&gt;board-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;board-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|outb_p
c_func
(paren
l_int|0
comma
id|ch-&gt;board-&gt;port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|assertgwinon
r_static
r_inline
r_void
id|assertgwinon
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;board-&gt;type
op_ne
id|PCXEVE
)paren
(brace
id|pcxxassert
c_func
(paren
id|inb
c_func
(paren
id|ch-&gt;board-&gt;port
)paren
op_amp
id|FEPMEM
comma
l_string|&quot;Global memory off&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|assertmemoff
r_static
r_inline
r_void
id|assertmemoff
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;board-&gt;type
op_ne
id|PCXEVE
)paren
(brace
id|pcxxassert
c_func
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|ch-&gt;board-&gt;port
)paren
op_amp
id|FEPMEM
)paren
comma
l_string|&quot;Memory on&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_sched_event
r_static
r_inline
r_void
id|pcxe_sched_event
c_func
(paren
r_struct
id|channel
op_star
id|info
comma
r_int
id|event
)paren
(brace
id|info-&gt;event
op_or_assign
l_int|1
op_lshift
id|event
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|info-&gt;tqueue
comma
op_amp
id|tq_pcxx
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|DIGI_BH
)paren
suffix:semicolon
)brace
DECL|function|pcxx_error
r_static
r_void
id|pcxx_error
c_func
(paren
r_int
id|line
comma
r_char
op_star
id|msg
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcxx_error (DigiBoard): line=%d %s&bslash;n&quot;
comma
id|line
comma
id|msg
)paren
suffix:semicolon
)brace
DECL|function|pcxx_waitcarrier
r_static
r_int
id|pcxx_waitcarrier
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
comma
r_struct
id|channel
op_star
id|info
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|do_clocal
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;normal_termios.c_cflag
op_amp
id|CLOCAL
)paren
id|do_clocal
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
id|CLOCAL
)paren
id|do_clocal
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Block waiting for the carrier detect and the line to become free&n;&t; */
id|retval
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|info-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|info-&gt;count
op_decrement
suffix:semicolon
id|info-&gt;blocked_open
op_increment
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_eq
l_int|0
)paren
(brace
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|info-&gt;omodem
op_or_assign
id|DTR
op_or
id|RTS
suffix:semicolon
id|fepcmd
c_func
(paren
id|info
comma
id|SETMODEM
comma
id|DTR
op_or
id|RTS
comma
l_int|0
comma
l_int|10
comma
l_int|1
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
op_logical_or
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_INITIALIZED
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_HUP_NOTIFY
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_else
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
op_eq
l_int|0
op_logical_and
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_CLOSING
)paren
op_eq
l_int|0
op_logical_and
(paren
id|do_clocal
op_logical_or
(paren
id|info-&gt;imodem
op_amp
id|info-&gt;dcd
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|info-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
)paren
(brace
id|info-&gt;count
op_increment
suffix:semicolon
)brace
id|info-&gt;blocked_open
op_decrement
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|pcxe_open
r_int
id|pcxe_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|line
suffix:semicolon
r_int
id|boardnum
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|line
op_assign
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
op_minus
id|tty-&gt;driver.minor_start
suffix:semicolon
r_if
c_cond
(paren
id|line
OL
l_int|0
op_logical_or
id|line
op_ge
id|nbdevs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;line out of range in pcxe_open&bslash;n&quot;
)paren
suffix:semicolon
id|tty-&gt;driver_data
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|boardnum
op_assign
l_int|0
suffix:semicolon
id|boardnum
OL
id|numcards
suffix:semicolon
id|boardnum
op_increment
)paren
r_if
c_cond
(paren
(paren
id|line
op_ge
id|boards
(braket
id|boardnum
)braket
dot
id|first_minor
)paren
op_logical_and
(paren
id|line
OL
id|boards
(braket
id|boardnum
)braket
dot
id|first_minor
op_plus
id|boards
(braket
id|boardnum
)braket
dot
id|numports
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|boardnum
op_ge
id|numcards
op_logical_or
id|boards
(braket
id|boardnum
)braket
dot
id|status
op_eq
id|DISABLED
op_logical_or
(paren
id|line
op_minus
id|boards
(braket
id|boardnum
)braket
dot
id|first_minor
)paren
op_ge
id|boards
(braket
id|boardnum
)braket
dot
id|numports
)paren
(brace
id|tty-&gt;driver_data
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Mark this device as &squot;down&squot; */
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ch
op_assign
id|digi_channels
op_plus
id|line
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;brdchan
op_eq
l_int|0
)paren
(brace
id|tty-&gt;driver_data
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* flag the kernel that there is somebody using this guy */
id|MOD_INC_USE_COUNT
suffix:semicolon
multiline_comment|/*&n;&t; * If the device is in the middle of being closed, then block&n;&t; * until it&squot;s done, and then try again.&n;&t; */
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_CLOSING
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
op_amp
id|ch-&gt;close_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_HUP_NOTIFY
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ch-&gt;count
op_increment
suffix:semicolon
id|tty-&gt;driver_data
op_assign
id|ch
suffix:semicolon
id|ch-&gt;tty
op_assign
id|tty
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_INITIALIZED
)paren
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|head
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|ch-&gt;statusflags
op_assign
l_int|0
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|ch-&gt;imodem
op_assign
id|bc-&gt;mstat
suffix:semicolon
id|head
op_assign
id|bc-&gt;rin
suffix:semicolon
id|bc-&gt;rout
op_assign
id|head
suffix:semicolon
id|ch-&gt;tty
op_assign
id|tty
suffix:semicolon
id|pcxxparam
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|ch-&gt;imodem
op_assign
id|bc-&gt;mstat
suffix:semicolon
id|bc-&gt;idata
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;omodem
op_assign
id|DTR
op_or
id|RTS
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETMODEM
comma
id|DTR
op_or
id|RTS
comma
l_int|0
comma
l_int|10
comma
l_int|1
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|ch-&gt;asyncflags
op_or_assign
id|ASYNC_INITIALIZED
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_CLOSING
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
op_amp
id|ch-&gt;close_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_HUP_NOTIFY
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If this is a callout device, then just make sure the normal&n;&t; * device isn&squot;t being used.&n;&t; */
r_if
c_cond
(paren
id|tty-&gt;driver.subtype
op_eq
id|SERIAL_TYPE_CALLOUT
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_NORMAL_ACTIVE
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_SESSION_LOCKOUT
)paren
op_logical_and
(paren
id|ch-&gt;session
op_ne
id|current-&gt;session
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_PGRP_LOCKOUT
)paren
op_logical_and
(paren
id|ch-&gt;pgrp
op_ne
id|current-&gt;pgrp
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|ch-&gt;asyncflags
op_or_assign
id|ASYNC_CALLOUT_ACTIVE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* this has to be set in order for the &quot;block until&n;&t;&t;&t; * CD&quot; code to work correctly.  i&squot;m not sure under&n;&t;&t;&t; * what circumstances asyncflags should be set to&n;&t;&t;&t; * ASYNC_NORMAL_ACTIVE though&n;&t;&t;&t; * brian@ilinx.com&n;&t;&t;&t; */
id|ch-&gt;asyncflags
op_or_assign
id|ASYNC_NORMAL_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|pcxx_waitcarrier
c_func
(paren
id|tty
comma
id|filp
comma
id|ch
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
)brace
id|ch-&gt;asyncflags
op_or_assign
id|ASYNC_NORMAL_ACTIVE
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;count
op_eq
l_int|1
)paren
op_logical_and
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_SPLIT_TERMIOS
)paren
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;driver.subtype
op_eq
id|SERIAL_TYPE_NORMAL
)paren
(brace
op_star
id|tty-&gt;termios
op_assign
id|ch-&gt;normal_termios
suffix:semicolon
)brace
r_else
op_star
id|tty-&gt;termios
op_assign
id|ch-&gt;callout_termios
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|pcxxparam
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
)brace
id|ch-&gt;session
op_assign
id|current-&gt;session
suffix:semicolon
id|ch-&gt;pgrp
op_assign
id|current-&gt;pgrp
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|shutdown
r_static
r_void
id|shutdown
c_func
(paren
r_struct
id|channel
op_star
id|info
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_INITIALIZED
)paren
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|bc
op_assign
id|info-&gt;brdchan
suffix:semicolon
r_if
c_cond
(paren
id|bc
)paren
(brace
id|bc-&gt;idata
op_assign
l_int|0
suffix:semicolon
)brace
id|tty
op_assign
id|info-&gt;tty
suffix:semicolon
multiline_comment|/*&n;&t; * If we&squot;re a modem control device and HUPCL is on, drop RTS &amp; DTR.&n;&t; */
r_if
c_cond
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
id|HUPCL
)paren
(brace
id|info-&gt;omodem
op_and_assign
op_complement
(paren
id|RTS
op_or
id|DTR
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|info
comma
id|SETMODEM
comma
l_int|0
comma
id|DTR
op_or
id|RTS
comma
l_int|10
comma
l_int|1
)paren
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
id|info-&gt;asyncflags
op_and_assign
op_complement
id|ASYNC_INITIALIZED
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|pcxe_close
r_static
r_void
id|pcxe_close
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty_hung_up_p
c_func
(paren
id|filp
)paren
)paren
(brace
multiline_comment|/* flag that somebody is done with this module */
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* this check is in serial.c, it won&squot;t hurt to do it here too */
r_if
c_cond
(paren
(paren
id|tty-&gt;count
op_eq
l_int|1
)paren
op_logical_and
(paren
id|info-&gt;count
op_ne
l_int|1
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Uh, oh.  tty-&gt;count is 1, which means that the tty&n;&t;&t;&t; * structure will be freed.  Info-&gt;count should always&n;&t;&t;&t; * be one in these conditions.  If it&squot;s greater than&n;&t;&t;&t; * one, we&squot;ve got real problems, since it means the&n;&t;&t;&t; * serial port won&squot;t be shutdown.&n;&t;&t;&t; */
id|printk
c_func
(paren
l_string|&quot;pcxe_close: bad serial port count; tty-&gt;count is 1, info-&gt;count is %d&bslash;n&quot;
comma
id|info-&gt;count
)paren
suffix:semicolon
id|info-&gt;count
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;count
op_decrement
OG
l_int|1
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;count
OL
l_int|0
)paren
(brace
id|info-&gt;count
op_assign
l_int|0
suffix:semicolon
)brace
id|info-&gt;asyncflags
op_or_assign
id|ASYNC_CLOSING
suffix:semicolon
multiline_comment|/*&n;&t;&t;* Save the termios structure, since this port may have&n;&t;&t;* separate termios for callout and dialin.&n;&t;&t;*/
r_if
c_cond
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_NORMAL_ACTIVE
)paren
(brace
id|info-&gt;normal_termios
op_assign
op_star
id|tty-&gt;termios
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_CALLOUT_ACTIVE
)paren
(brace
id|info-&gt;callout_termios
op_assign
op_star
id|tty-&gt;termios
suffix:semicolon
)brace
id|tty-&gt;closing
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;asyncflags
op_amp
id|ASYNC_INITIALIZED
)paren
(brace
id|setup_empty_event
c_func
(paren
id|tty
comma
id|info
)paren
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|3000
)paren
suffix:semicolon
multiline_comment|/* 30 seconds timeout */
)brace
r_if
c_cond
(paren
id|tty-&gt;driver.flush_buffer
)paren
(brace
id|tty-&gt;driver
dot
id|flush_buffer
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty-&gt;ldisc.flush_buffer
)paren
(brace
id|tty-&gt;ldisc
dot
id|flush_buffer
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
id|shutdown
c_func
(paren
id|info
)paren
suffix:semicolon
id|tty-&gt;closing
op_assign
l_int|0
suffix:semicolon
id|info-&gt;event
op_assign
l_int|0
suffix:semicolon
id|info-&gt;tty
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifndef MODULE
multiline_comment|/* ldiscs[] is not available in a MODULE&n;** worth noting that while I&squot;m not sure what this hunk of code is supposed&n;** to do, it is not present in the serial.c driver.  Hmmm.  If you know,&n;** please send me a note.  brian@ilinx.com&n;** Don&squot;t know either what this is supposed to do christoph@lameter.com.&n;*/
r_if
c_cond
(paren
id|tty-&gt;ldisc.num
op_ne
id|ldiscs
(braket
id|N_TTY
)braket
dot
id|num
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;ldisc.close
)paren
(brace
(paren
id|tty-&gt;ldisc.close
)paren
(paren
id|tty
)paren
suffix:semicolon
)brace
id|tty-&gt;ldisc
op_assign
id|ldiscs
(braket
id|N_TTY
)braket
suffix:semicolon
id|tty-&gt;termios-&gt;c_line
op_assign
id|N_TTY
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;ldisc.open
)paren
(brace
(paren
id|tty-&gt;ldisc.open
)paren
(paren
id|tty
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|info-&gt;blocked_open
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;close_delay
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|info-&gt;close_delay
)paren
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|info-&gt;open_wait
)paren
suffix:semicolon
)brace
id|info-&gt;asyncflags
op_and_assign
op_complement
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
op_or
id|ASYNC_CLOSING
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|info-&gt;close_wait
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_hangup
r_void
id|pcxe_hangup
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|shutdown
c_func
(paren
id|ch
)paren
suffix:semicolon
id|ch-&gt;event
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;count
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;tty
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;asyncflags
op_and_assign
op_complement
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|ch-&gt;open_wait
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_write
r_static
r_int
id|pcxe_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_int
id|total
comma
id|remain
comma
id|size
comma
id|stlen
suffix:semicolon
r_int
r_int
id|head
comma
id|tail
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* printk(&quot;Entering pcxe_write()&bslash;n&quot;); */
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|size
op_assign
id|ch-&gt;txbufsize
suffix:semicolon
r_if
c_cond
(paren
id|from_user
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|head
op_assign
id|bc-&gt;tin
op_amp
(paren
id|size
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* It seems to be necessary to make sure that the value is stable here somehow&n;&t;&t;   This is a rather odd pice of code here. */
r_do
(brace
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
)brace
r_while
c_loop
(paren
id|tail
op_ne
id|bc-&gt;tout
)paren
suffix:semicolon
id|tail
op_and_assign
(paren
id|size
op_minus
l_int|1
)paren
suffix:semicolon
id|stlen
op_assign
(paren
id|head
op_ge
id|tail
)paren
ques
c_cond
(paren
id|size
op_minus
(paren
id|head
op_minus
id|tail
)paren
op_minus
l_int|1
)paren
suffix:colon
(paren
id|tail
op_minus
id|head
op_minus
l_int|1
)paren
suffix:semicolon
id|count
op_assign
id|MIN
c_func
(paren
id|stlen
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|ch-&gt;tmp_buf
comma
id|buf
comma
id|count
)paren
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|buf
op_assign
id|ch-&gt;tmp_buf
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * All data is now local&n;&t; */
id|total
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|head
op_assign
id|bc-&gt;tin
op_amp
(paren
id|size
op_minus
l_int|1
)paren
suffix:semicolon
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
r_if
c_cond
(paren
id|tail
op_ne
id|bc-&gt;tout
)paren
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
id|tail
op_and_assign
(paren
id|size
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|head
op_ge
id|tail
)paren
(brace
id|remain
op_assign
id|size
op_minus
(paren
id|head
op_minus
id|tail
)paren
op_minus
l_int|1
suffix:semicolon
id|stlen
op_assign
id|size
op_minus
id|head
suffix:semicolon
)brace
r_else
(brace
id|remain
op_assign
id|tail
op_minus
id|head
op_minus
l_int|1
suffix:semicolon
id|stlen
op_assign
id|remain
suffix:semicolon
)brace
id|count
op_assign
id|MIN
c_func
(paren
id|remain
comma
id|count
)paren
suffix:semicolon
id|txwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|stlen
op_assign
id|MIN
c_func
(paren
id|count
comma
id|stlen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ch-&gt;txptr
op_plus
id|head
comma
id|buf
comma
id|stlen
)paren
suffix:semicolon
id|buf
op_add_assign
id|stlen
suffix:semicolon
id|count
op_sub_assign
id|stlen
suffix:semicolon
id|total
op_add_assign
id|stlen
suffix:semicolon
id|head
op_add_assign
id|stlen
suffix:semicolon
r_if
c_cond
(paren
id|head
op_ge
id|size
)paren
(brace
id|head
op_assign
l_int|0
suffix:semicolon
id|stlen
op_assign
id|tail
suffix:semicolon
)brace
)brace
id|ch-&gt;statusflags
op_or_assign
id|TXBUSY
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|bc-&gt;tin
op_assign
id|head
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;statusflags
op_amp
id|LOWWAIT
)paren
op_eq
l_int|0
)paren
(brace
id|ch-&gt;statusflags
op_or_assign
id|LOWWAIT
suffix:semicolon
id|bc-&gt;ilow
op_assign
l_int|1
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|total
suffix:semicolon
)brace
DECL|function|pcxe_put_char
r_static
r_void
id|pcxe_put_char
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_char
id|c
)paren
(brace
id|pcxe_write
c_func
(paren
id|tty
comma
l_int|0
comma
op_amp
id|c
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pcxe_write_room
r_static
r_int
id|pcxe_write_room
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_int
id|remain
suffix:semicolon
id|remain
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_int
r_int
id|head
comma
id|tail
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|head
op_assign
id|bc-&gt;tin
op_amp
(paren
id|ch-&gt;txbufsize
op_minus
l_int|1
)paren
suffix:semicolon
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
r_if
c_cond
(paren
id|tail
op_ne
id|bc-&gt;tout
)paren
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
id|tail
op_and_assign
(paren
id|ch-&gt;txbufsize
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|remain
op_assign
id|tail
op_minus
id|head
op_minus
l_int|1
)paren
OL
l_int|0
)paren
(brace
id|remain
op_add_assign
id|ch-&gt;txbufsize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|remain
op_logical_and
(paren
id|ch-&gt;statusflags
op_amp
id|LOWWAIT
)paren
op_eq
l_int|0
)paren
(brace
id|ch-&gt;statusflags
op_or_assign
id|LOWWAIT
suffix:semicolon
id|bc-&gt;ilow
op_assign
l_int|1
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
id|remain
suffix:semicolon
)brace
DECL|function|pcxe_chars_in_buffer
r_static
r_int
id|pcxe_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|chars
suffix:semicolon
r_int
r_int
id|ctail
comma
id|head
comma
id|tail
suffix:semicolon
r_int
id|remain
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
id|head
op_assign
id|bc-&gt;tin
suffix:semicolon
id|ctail
op_assign
id|ch-&gt;mailbox-&gt;cout
suffix:semicolon
r_if
c_cond
(paren
id|tail
op_eq
id|head
op_logical_and
id|ch-&gt;mailbox-&gt;cin
op_eq
id|ctail
op_logical_and
id|bc-&gt;tbusy
op_eq
l_int|0
)paren
(brace
id|chars
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|head
op_assign
id|bc-&gt;tin
op_amp
(paren
id|ch-&gt;txbufsize
op_minus
l_int|1
)paren
suffix:semicolon
id|tail
op_and_assign
(paren
id|ch-&gt;txbufsize
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|remain
op_assign
id|tail
op_minus
id|head
op_minus
l_int|1
)paren
OL
l_int|0
)paren
(brace
id|remain
op_add_assign
id|ch-&gt;txbufsize
suffix:semicolon
)brace
id|chars
op_assign
(paren
r_int
)paren
(paren
id|ch-&gt;txbufsize
op_minus
id|remain
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Make it possible to wakeup anything waiting for output&n;&t;&t; * in tty_ioctl.c, etc.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;statusflags
op_amp
id|EMPTYWAIT
)paren
)paren
(brace
id|setup_empty_event
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|chars
suffix:semicolon
)brace
DECL|function|pcxe_flush_buffer
r_static
r_void
id|pcxe_flush_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
r_int
id|tail
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|tail
op_assign
id|bc-&gt;tout
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|STOUT
comma
(paren
r_int
)paren
id|tail
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|tty-&gt;write_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_DO_WRITE_WAKEUP
)paren
)paren
op_logical_and
id|tty-&gt;ldisc.write_wakeup
)paren
(brace
(paren
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_flush_chars
r_static
r_void
id|pcxe_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;statusflags
op_amp
id|TXBUSY
)paren
op_logical_and
op_logical_neg
(paren
id|ch-&gt;statusflags
op_amp
id|EMPTYWAIT
)paren
)paren
id|setup_empty_event
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef MODULE
multiline_comment|/*&n; * Driver setup function when linked into the kernel to optionally parse multible&n; * &quot;digi=&quot;-lines and initialize the driver at boot time. No probing.&n; */
DECL|function|pcxx_setup
r_void
id|__init
id|pcxx_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
r_struct
id|board_info
id|board
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|last
suffix:semicolon
r_char
op_star
id|temp
comma
op_star
id|t2
suffix:semicolon
r_int
id|len
suffix:semicolon
id|numcards
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|board
comma
l_int|0
comma
r_sizeof
(paren
id|board
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|last
op_assign
l_int|0
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|ints
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|1
suffix:colon
id|board.status
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|board.type
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|board.altpin
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|board.numports
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|board.port
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|board.membase
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Too many integer parms&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|str
op_logical_and
op_star
id|str
)paren
(brace
multiline_comment|/* find the next comma or terminator */
id|temp
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
op_star
id|temp
op_logical_and
(paren
op_star
id|temp
op_ne
l_char|&squot;,&squot;
)paren
)paren
id|temp
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|temp
)paren
id|temp
op_assign
l_int|NULL
suffix:semicolon
r_else
op_star
id|temp
op_increment
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
id|last
op_plus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|1
suffix:colon
id|len
op_assign
id|strlen
c_func
(paren
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;Disable&quot;
comma
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
id|board.status
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;Enable&quot;
comma
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
id|board.status
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid status %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|PCXX_NUM_TYPES
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|board_desc
(braket
id|j
)braket
comma
id|str
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PCXX_NUM_TYPES
)paren
id|board.type
op_assign
id|j
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid board name: %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|len
op_assign
id|strlen
c_func
(paren
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;Disable&quot;
comma
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
id|board.altpin
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;Enable&quot;
comma
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
id|board.altpin
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid altpin %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|t2
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
id|isdigit
c_func
(paren
op_star
id|t2
)paren
)paren
id|t2
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid port count %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|board.numports
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|t2
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
id|isxdigit
c_func
(paren
op_star
id|t2
)paren
)paren
id|t2
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid io port address %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|board.port
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|16
)paren
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|t2
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
id|isxdigit
c_func
(paren
op_star
id|t2
)paren
)paren
id|t2
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Invalid memory base %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|board.membase
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|16
)paren
suffix:semicolon
id|last
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Too many string parms&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|str
op_assign
id|temp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|last
OL
l_int|6
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Insufficient parms specified&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* I should REALLY validate the stuff here */
id|memcpy
c_func
(paren
op_amp
id|boards
(braket
id|numcards
)braket
comma
op_amp
id|board
comma
r_sizeof
(paren
id|board
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Added board %i, %s %s %i ports at 0x%4.4X base 0x%6.6X&bslash;n&quot;
comma
id|numcards
comma
id|board_desc
(braket
id|board.type
)braket
comma
id|board_mem
(braket
id|board.type
)braket
comma
id|board.numports
comma
id|board.port
comma
(paren
r_int
r_int
)paren
id|board.membase
)paren
suffix:semicolon
multiline_comment|/* keep track of my initial minor number */
r_if
c_cond
(paren
id|numcards
)paren
id|boards
(braket
id|numcards
)braket
dot
id|first_minor
op_assign
id|boards
(braket
id|numcards
op_minus
l_int|1
)braket
dot
id|first_minor
op_plus
id|boards
(braket
id|numcards
op_minus
l_int|1
)braket
dot
id|numports
suffix:semicolon
r_else
id|boards
(braket
id|numcards
)braket
dot
id|first_minor
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* yeha!  string parameter was successful! */
id|numcards
op_increment
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * function to initialize the driver with the given parameters, which are either&n; * the default values from this file or the parameters given at boot.&n; */
DECL|function|pcxe_init
r_int
id|__init
id|pcxe_init
c_func
(paren
r_void
)paren
(brace
id|ulong
id|memory_seg
op_assign
l_int|0
comma
id|memory_size
op_assign
l_int|0
suffix:semicolon
r_int
id|lowwater
comma
id|enabled_cards
op_assign
l_int|0
comma
id|i
comma
id|crd
comma
id|shrinkmem
op_assign
l_int|0
comma
id|topwin
op_assign
l_int|0xff00L
comma
id|botwin
op_assign
l_int|0x100L
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|unchar
op_star
id|fepos
comma
op_star
id|memaddr
comma
op_star
id|bios
comma
id|v
suffix:semicolon
r_volatile
r_struct
id|global_data
op_star
id|gd
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_struct
id|board_info
op_star
id|bd
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Digiboard PC/X{i,e,eve} driver v%s&bslash;n&quot;
comma
id|VERSION
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_DIGI_BOARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|io
(braket
id|i
)braket
)paren
(brace
id|numcards
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|numcards
op_eq
l_int|0
)paren
(brace
r_int
id|first_minor
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_DIGI_BOARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|io
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
id|boards
(braket
id|i
)braket
dot
id|port
op_assign
l_int|0
suffix:semicolon
id|boards
(braket
id|i
)braket
dot
id|status
op_assign
id|DISABLED
suffix:semicolon
)brace
r_else
(brace
id|boards
(braket
id|i
)braket
dot
id|port
op_assign
(paren
id|ushort
)paren
id|io
(braket
id|i
)braket
suffix:semicolon
id|boards
(braket
id|i
)braket
dot
id|status
op_assign
id|ENABLED
suffix:semicolon
id|boards
(braket
id|i
)braket
dot
id|first_minor
op_assign
id|first_minor
suffix:semicolon
id|numcards
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|membase
(braket
id|i
)braket
)paren
id|boards
(braket
id|i
)braket
dot
id|membase
op_assign
(paren
id|ulong
)paren
id|membase
(braket
id|i
)braket
suffix:semicolon
r_else
id|boards
(braket
id|i
)braket
dot
id|membase
op_assign
l_int|0xD0000
suffix:semicolon
r_if
c_cond
(paren
id|memsize
(braket
id|i
)braket
)paren
id|boards
(braket
id|i
)braket
dot
id|memsize
op_assign
(paren
id|ulong
)paren
(paren
id|memsize
(braket
id|i
)braket
op_star
l_int|1024
)paren
suffix:semicolon
r_else
id|boards
(braket
id|i
)braket
dot
id|memsize
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|altpin
(braket
id|i
)braket
)paren
id|boards
(braket
id|i
)braket
dot
id|altpin
op_assign
id|ON
suffix:semicolon
r_else
id|boards
(braket
id|i
)braket
dot
id|altpin
op_assign
id|OFF
suffix:semicolon
r_if
c_cond
(paren
id|numports
(braket
id|i
)braket
)paren
id|boards
(braket
id|i
)braket
dot
id|numports
op_assign
(paren
id|ushort
)paren
id|numports
(braket
id|i
)braket
suffix:semicolon
r_else
id|boards
(braket
id|i
)braket
dot
id|numports
op_assign
l_int|16
suffix:semicolon
id|boards
(braket
id|i
)braket
dot
id|region
op_assign
l_int|NULL
suffix:semicolon
id|first_minor
op_add_assign
id|boards
(braket
id|i
)braket
dot
id|numports
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|numcards
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: No cards configured, driver not active.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#if 1
r_if
c_cond
(paren
id|debug
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numcards
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Card %d:status=%d, port=0x%x, membase=0x%lx, memsize=0x%lx, altpin=%d, numports=%d, first_minor=%d&bslash;n&quot;
comma
id|i
op_plus
l_int|1
comma
id|boards
(braket
id|i
)braket
dot
id|status
comma
id|boards
(braket
id|i
)braket
dot
id|port
comma
id|boards
(braket
id|i
)braket
dot
id|membase
comma
id|boards
(braket
id|i
)braket
dot
id|memsize
comma
id|boards
(braket
id|i
)braket
dot
id|altpin
comma
id|boards
(braket
id|i
)braket
dot
id|numports
comma
id|boards
(braket
id|i
)braket
dot
id|first_minor
)paren
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numcards
suffix:semicolon
id|i
op_increment
)paren
id|nbdevs
op_add_assign
id|boards
(braket
id|i
)braket
dot
id|numports
suffix:semicolon
r_if
c_cond
(paren
id|nbdevs
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: No devices activated, driver not active.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * this turns out to be more memory efficient, as there are no &n;&t; * unused spaces.&n;&t; */
id|digi_channels
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|channel
)paren
op_star
id|nbdevs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|digi_channels
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate digi_channel struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|digi_channels
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|channel
)paren
op_star
id|nbdevs
)paren
suffix:semicolon
id|pcxe_table
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|tty_struct
op_star
)paren
op_star
id|nbdevs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcxe_table
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate pcxe_table struct&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_digi_channels
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pcxe_table
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tty_struct
op_star
)paren
op_star
id|nbdevs
)paren
suffix:semicolon
id|pcxe_termios
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|termios
op_star
)paren
op_star
id|nbdevs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcxe_termios
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate pcxe_termios struct&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_pcxe_table
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pcxe_termios
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|termios
op_star
)paren
op_star
id|nbdevs
)paren
suffix:semicolon
id|pcxe_termios_locked
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|termios
op_star
)paren
op_star
id|nbdevs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcxe_termios_locked
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate pcxe_termios_locked struct&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_pcxe_termios
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pcxe_termios_locked
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|termios
op_star
)paren
op_star
id|nbdevs
)paren
suffix:semicolon
id|init_bh
c_func
(paren
id|DIGI_BH
comma
id|do_pcxe_bh
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|pcxx_timer
)paren
suffix:semicolon
id|pcxx_timer.function
op_assign
id|pcxxpoll
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pcxe_driver
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tty_driver
)paren
)paren
suffix:semicolon
id|pcxe_driver.magic
op_assign
id|TTY_DRIVER_MAGIC
suffix:semicolon
id|pcxe_driver.name
op_assign
l_string|&quot;ttyD&quot;
suffix:semicolon
id|pcxe_driver.major
op_assign
id|DIGI_MAJOR
suffix:semicolon
id|pcxe_driver.minor_start
op_assign
l_int|0
suffix:semicolon
id|pcxe_driver.num
op_assign
id|nbdevs
suffix:semicolon
id|pcxe_driver.type
op_assign
id|TTY_DRIVER_TYPE_SERIAL
suffix:semicolon
id|pcxe_driver.subtype
op_assign
id|SERIAL_TYPE_NORMAL
suffix:semicolon
id|pcxe_driver.init_termios
op_assign
id|tty_std_termios
suffix:semicolon
id|pcxe_driver.init_termios.c_cflag
op_assign
id|B9600
op_or
id|CS8
op_or
id|CREAD
op_or
id|HUPCL
suffix:semicolon
id|pcxe_driver.flags
op_assign
id|TTY_DRIVER_REAL_RAW
suffix:semicolon
id|pcxe_driver.refcount
op_assign
op_amp
id|pcxe_refcount
suffix:semicolon
id|pcxe_driver.table
op_assign
id|pcxe_table
suffix:semicolon
id|pcxe_driver.termios
op_assign
id|pcxe_termios
suffix:semicolon
id|pcxe_driver.termios_locked
op_assign
id|pcxe_termios_locked
suffix:semicolon
id|pcxe_driver.open
op_assign
id|pcxe_open
suffix:semicolon
id|pcxe_driver.close
op_assign
id|pcxe_close
suffix:semicolon
id|pcxe_driver.write
op_assign
id|pcxe_write
suffix:semicolon
id|pcxe_driver.put_char
op_assign
id|pcxe_put_char
suffix:semicolon
id|pcxe_driver.flush_chars
op_assign
id|pcxe_flush_chars
suffix:semicolon
id|pcxe_driver.write_room
op_assign
id|pcxe_write_room
suffix:semicolon
id|pcxe_driver.chars_in_buffer
op_assign
id|pcxe_chars_in_buffer
suffix:semicolon
id|pcxe_driver.flush_buffer
op_assign
id|pcxe_flush_buffer
suffix:semicolon
id|pcxe_driver.ioctl
op_assign
id|pcxe_ioctl
suffix:semicolon
id|pcxe_driver.throttle
op_assign
id|pcxe_throttle
suffix:semicolon
id|pcxe_driver.unthrottle
op_assign
id|pcxe_unthrottle
suffix:semicolon
id|pcxe_driver.set_termios
op_assign
id|pcxe_set_termios
suffix:semicolon
id|pcxe_driver.stop
op_assign
id|pcxe_stop
suffix:semicolon
id|pcxe_driver.start
op_assign
id|pcxe_start
suffix:semicolon
id|pcxe_driver.hangup
op_assign
id|pcxe_hangup
suffix:semicolon
id|pcxe_callout
op_assign
id|pcxe_driver
suffix:semicolon
id|pcxe_callout.name
op_assign
l_string|&quot;cud&quot;
suffix:semicolon
id|pcxe_callout.major
op_assign
id|DIGICU_MAJOR
suffix:semicolon
id|pcxe_callout.subtype
op_assign
id|SERIAL_TYPE_CALLOUT
suffix:semicolon
id|pcxe_callout.init_termios.c_cflag
op_assign
id|B9600
op_or
id|CS8
op_or
id|CREAD
op_or
id|HUPCL
op_or
id|CLOCAL
suffix:semicolon
r_for
c_loop
(paren
id|crd
op_assign
l_int|0
suffix:semicolon
id|crd
OL
id|numcards
suffix:semicolon
id|crd
op_increment
)paren
(brace
id|bd
op_assign
op_amp
id|boards
(braket
id|crd
)braket
suffix:semicolon
id|outb
c_func
(paren
id|FEPRST
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|pcxxdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|inb
c_func
(paren
id|bd-&gt;port
)paren
op_amp
id|FEPMASK
)paren
op_ne
id|FEPRST
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|100
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Board not found at port 0x%x! Check switch settings.&bslash;n&quot;
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_continue
suffix:semicolon
)brace
id|v
op_assign
id|inb
c_func
(paren
id|bd-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x1
)paren
op_eq
l_int|0x1
)paren
(brace
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x30
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* PC/Xi 64K card */
id|memory_seg
op_assign
l_int|0xf000
suffix:semicolon
id|memory_size
op_assign
l_int|0x10000
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x30
)paren
op_eq
l_int|0x10
)paren
(brace
multiline_comment|/* PC/Xi 128K card */
id|memory_seg
op_assign
l_int|0xe000
suffix:semicolon
id|memory_size
op_assign
l_int|0x20000
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x30
)paren
op_eq
l_int|0x20
)paren
(brace
multiline_comment|/* PC/Xi 256K card */
id|memory_seg
op_assign
l_int|0xc000
suffix:semicolon
id|memory_size
op_assign
l_int|0x40000
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x30
)paren
op_eq
l_int|0x30
)paren
(brace
multiline_comment|/* PC/Xi 512K card */
id|memory_seg
op_assign
l_int|0x8000
suffix:semicolon
id|memory_size
op_assign
l_int|0x80000
suffix:semicolon
)brace
id|bd-&gt;type
op_assign
id|PCXI
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|v
op_amp
l_int|0x1
)paren
op_eq
l_int|0x1
)paren
(brace
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
multiline_comment|/* PC/Xm unsupported card */
id|printk
c_func
(paren
l_string|&quot;PC/Xx: PC/Xm at 0x%x not supported!!&bslash;n&quot;
comma
id|bd-&gt;port
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|v
op_amp
l_int|0xC0
)paren
(brace
id|topwin
op_assign
l_int|0x1f00L
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
(paren
id|ulong
)paren
id|bd-&gt;membase
op_rshift
l_int|8
)paren
op_amp
l_int|0xe0
)paren
op_or
l_int|0x10
comma
id|bd-&gt;port
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|ulong
)paren
id|bd-&gt;membase
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
comma
id|bd-&gt;port
op_plus
l_int|3
)paren
suffix:semicolon
id|bd-&gt;type
op_assign
id|PCXEVE
suffix:semicolon
multiline_comment|/* PC/Xe 8K card */
)brace
r_else
(brace
id|bd-&gt;type
op_assign
id|PCXE
suffix:semicolon
multiline_comment|/* PC/Xe 64K card */
)brace
id|memory_seg
op_assign
l_int|0xf000
suffix:semicolon
id|memory_size
op_assign
l_int|0x10000
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Configuring card %d as a %s %ldK card. io=0x%x, mem=%lx-%lx&bslash;n&quot;
comma
id|crd
op_plus
l_int|1
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|memory_size
op_div
l_int|1024
comma
id|bd-&gt;port
comma
id|bd-&gt;membase
comma
id|bd-&gt;membase
op_plus
id|memory_size
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|boards
(braket
id|crd
)braket
dot
id|memsize
op_eq
l_int|0
)paren
id|boards
(braket
id|crd
)braket
dot
id|memsize
op_assign
id|memory_size
suffix:semicolon
r_else
r_if
c_cond
(paren
id|boards
(braket
id|crd
)braket
dot
id|memsize
op_ne
id|memory_size
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: memory size mismatch:supplied=%lx(%ldK) probed=%ld(%ldK)&bslash;n&quot;
comma
id|boards
(braket
id|crd
)braket
dot
id|memsize
comma
id|boards
(braket
id|crd
)braket
dot
id|memsize
op_div
l_int|1024
comma
id|memory_size
comma
id|memory_size
op_div
l_int|1024
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|memaddr
op_assign
(paren
id|unchar
op_star
)paren
id|phys_to_virt
c_func
(paren
id|bd-&gt;membase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Resetting board and testing memory access:&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FEPRST
op_or
id|FEPMEM
comma
id|bd-&gt;port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|inb
c_func
(paren
id|bd-&gt;port
)paren
op_amp
id|FEPMASK
)paren
op_ne
(paren
id|FEPRST
op_or
id|FEPMEM
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|1000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nPC/Xx: %s not resetting at port 0x%x! Check switch settings.&bslash;n&quot;
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_continue
suffix:semicolon
)brace
id|memwinon
c_func
(paren
id|bd
comma
l_int|0
)paren
suffix:semicolon
op_star
(paren
id|ulong
op_star
)paren
(paren
id|memaddr
op_plus
id|botwin
)paren
op_assign
l_int|0xa55a3cc3
suffix:semicolon
op_star
(paren
id|ulong
op_star
)paren
(paren
id|memaddr
op_plus
id|topwin
)paren
op_assign
l_int|0x5aa5c33c
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|ulong
op_star
)paren
(paren
id|memaddr
op_plus
id|botwin
)paren
op_ne
l_int|0xa55a3cc3
op_logical_or
op_star
(paren
id|ulong
op_star
)paren
(paren
id|memaddr
op_plus
id|topwin
)paren
op_ne
l_int|0x5aa5c33c
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Failed memory test at %lx for %s at port %x, check switch settings.&bslash;n&quot;
comma
id|bd-&gt;membase
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot; done.&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memaddr
(braket
id|MISCGLOBAL
op_plus
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;type
op_eq
id|PCXI
op_logical_or
id|bd-&gt;type
op_eq
id|PCXE
)paren
(brace
id|bios
op_assign
id|memaddr
op_plus
id|BIOSCODE
op_plus
(paren
(paren
l_int|0xf000
op_minus
id|memory_seg
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Downloading BIOS to 0x%lx:&quot;
comma
id|virt_to_phys
c_func
(paren
id|bios
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|bios
comma
id|pcxx_bios
comma
id|pcxx_nbios
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot; done.&bslash;n&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FEPMEM
comma
id|bd-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Waiting for BIOS to become ready&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|30
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MISCGLOBAL
)paren
op_eq
op_star
(paren
id|ushort
op_star
)paren
l_string|&quot;GD&quot;
)paren
(brace
r_goto
id|load_fep
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|50
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nPC/Xx: BIOS download failed for board at 0x%x(addr=%lx-%lx)!&bslash;n&quot;
comma
id|bd-&gt;port
comma
id|bd-&gt;membase
comma
id|bd-&gt;membase
op_plus
id|bd-&gt;memsize
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|bios
op_assign
id|memaddr
op_plus
(paren
id|BIOSCODE
op_amp
l_int|0x1fff
)paren
suffix:semicolon
id|memwinon
c_func
(paren
id|bd
comma
l_int|0xff
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|bios
comma
id|pcxx_bios
comma
id|pcxx_nbios
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FEPCLR
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|memwinon
c_func
(paren
id|bd
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MISCGLOBAL
)paren
op_eq
op_star
(paren
id|ushort
op_star
)paren
l_string|&quot;GD&quot;
)paren
(brace
r_goto
id|load_fep
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|50
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nPC/Xx: BIOS download failed on the %s at 0x%x!&bslash;n&quot;
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|load_fep
suffix:colon
id|fepos
op_assign
id|memaddr
op_plus
id|FEPCODE
suffix:semicolon
r_if
c_cond
(paren
id|bd-&gt;type
op_eq
id|PCXEVE
)paren
(brace
id|fepos
op_assign
id|memaddr
op_plus
(paren
id|FEPCODE
op_amp
l_int|0x1fff
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot; ok.&bslash;nDownloading FEP/OS to 0x%lx:&quot;
comma
id|virt_to_phys
c_func
(paren
id|fepos
)paren
)paren
suffix:semicolon
id|memwinon
c_func
(paren
id|bd
comma
(paren
id|FEPCODE
op_rshift
l_int|13
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fepos
comma
id|pcxx_cook
comma
id|pcxx_ncook
)paren
suffix:semicolon
id|memwinon
c_func
(paren
id|bd
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot; done.&bslash;n&quot;
)paren
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|0
)paren
op_assign
l_int|2
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|2
)paren
op_assign
id|memory_seg
op_plus
id|FEPCODESEG
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|4
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|6
)paren
op_assign
id|FEPCODESEG
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|8
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|10
)paren
op_assign
id|pcxx_ncook
suffix:semicolon
id|outb
c_func
(paren
id|FEPMEM
op_or
id|FEPINT
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FEPMEM
comma
id|bd-&gt;port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|MBOX
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|2000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC/Xx: Command failed for the %s at 0x%x!&bslash;n&quot;
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Waiting for FEP/OS to become ready&quot;
)paren
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
id|memaddr
op_plus
id|FEPSTAT
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|0
)paren
op_assign
l_int|1
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|2
)paren
op_assign
id|FEPCODESEG
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
id|memaddr
op_plus
id|MBOX
op_plus
l_int|4
)paren
op_assign
l_int|0x4L
suffix:semicolon
id|outb
c_func
(paren
id|FEPINT
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FEPCLR
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|memwinon
c_func
(paren
id|bd
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|FEPSTAT
)paren
op_ne
op_star
(paren
id|ushort
op_star
)paren
l_string|&quot;OS&quot;
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|1000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nPC/Xx: FEP/OS download failed on the %s at 0x%x!&bslash;n&quot;
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|bd-&gt;status
op_assign
id|DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|50
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n%5d&quot;
comma
id|i
op_div
l_int|50
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|pcxxdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot; ok.&bslash;n&quot;
)paren
suffix:semicolon
id|ch
op_assign
id|digi_channels
op_plus
id|bd-&gt;first_minor
suffix:semicolon
id|pcxxassert
c_func
(paren
id|ch
OL
id|digi_channels
op_plus
id|nbdevs
comma
l_string|&quot;ch out of range&quot;
)paren
suffix:semicolon
id|bc
op_assign
(paren
r_volatile
r_struct
id|board_chan
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|CHANSTRUCT
)paren
suffix:semicolon
id|gd
op_assign
(paren
r_volatile
r_struct
id|global_data
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|GLOBAL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bd-&gt;type
op_eq
id|PCXEVE
)paren
op_logical_and
(paren
op_star
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|NPORT
)paren
OL
l_int|3
)paren
)paren
(brace
id|shrinkmem
op_assign
l_int|1
suffix:semicolon
)brace
id|bd-&gt;region
op_assign
id|request_region
c_func
(paren
id|bd-&gt;port
comma
l_int|4
comma
l_string|&quot;PC/Xx&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bd-&gt;region
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;I/O port 0x%x is already used&bslash;n&quot;
comma
id|bd-&gt;port
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|cleanup_boards
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bd-&gt;numports
suffix:semicolon
id|i
op_increment
comma
id|ch
op_increment
comma
id|bc
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|ushort
op_star
)paren
(paren
(paren
id|ulong
)paren
id|memaddr
op_plus
id|PORTBASE
)paren
)paren
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
id|ch-&gt;brdchan
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ch-&gt;brdchan
op_assign
id|bc
suffix:semicolon
id|ch-&gt;mailbox
op_assign
id|gd
suffix:semicolon
id|ch-&gt;tqueue.routine
op_assign
id|do_softint
suffix:semicolon
id|ch-&gt;tqueue.data
op_assign
id|ch
suffix:semicolon
id|ch-&gt;board
op_assign
op_amp
id|boards
(braket
id|crd
)braket
suffix:semicolon
macro_line|#ifdef DEFAULT_HW_FLOW
id|ch-&gt;digiext.digi_flags
op_assign
id|RTSPACE
op_or
id|CTSPACE
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|boards
(braket
id|crd
)braket
dot
id|altpin
)paren
(brace
id|ch-&gt;dsr
op_assign
id|CD
suffix:semicolon
id|ch-&gt;dcd
op_assign
id|DSR
suffix:semicolon
id|ch-&gt;digiext.digi_flags
op_or_assign
id|DIGI_ALTPIN
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;dcd
op_assign
id|CD
suffix:semicolon
id|ch-&gt;dsr
op_assign
id|DSR
suffix:semicolon
)brace
id|ch-&gt;magic
op_assign
id|PCXX_MAGIC
suffix:semicolon
id|ch-&gt;boardnum
op_assign
id|crd
suffix:semicolon
id|ch-&gt;channelnum
op_assign
id|i
suffix:semicolon
id|ch-&gt;dev
op_assign
id|bd-&gt;first_minor
op_plus
id|i
suffix:semicolon
id|ch-&gt;tty
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|shrinkmem
)paren
(brace
id|fepcmd
c_func
(paren
id|ch
comma
id|SETBUFFER
comma
l_int|32
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|shrinkmem
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd-&gt;type
op_ne
id|PCXEVE
)paren
(brace
id|ch-&gt;txptr
op_assign
id|memaddr
op_plus
(paren
(paren
id|bc-&gt;tseg
op_minus
id|memory_seg
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|ch-&gt;rxptr
op_assign
id|memaddr
op_plus
(paren
(paren
id|bc-&gt;rseg
op_minus
id|memory_seg
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|ch-&gt;txwin
op_assign
id|ch-&gt;rxwin
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;txptr
op_assign
id|memaddr
op_plus
(paren
(paren
(paren
id|bc-&gt;tseg
op_minus
id|memory_seg
)paren
op_lshift
l_int|4
)paren
op_amp
l_int|0x1fff
)paren
suffix:semicolon
id|ch-&gt;txwin
op_assign
id|FEPWIN
op_or
(paren
(paren
id|bc-&gt;tseg
op_minus
id|memory_seg
)paren
op_rshift
l_int|9
)paren
suffix:semicolon
id|ch-&gt;rxptr
op_assign
id|memaddr
op_plus
(paren
(paren
(paren
id|bc-&gt;rseg
op_minus
id|memory_seg
)paren
op_lshift
l_int|4
)paren
op_amp
l_int|0x1fff
)paren
suffix:semicolon
id|ch-&gt;rxwin
op_assign
id|FEPWIN
op_or
(paren
(paren
id|bc-&gt;rseg
op_minus
id|memory_seg
)paren
op_rshift
l_int|9
)paren
suffix:semicolon
)brace
id|ch-&gt;txbufsize
op_assign
id|bc-&gt;tmax
op_plus
l_int|1
suffix:semicolon
id|ch-&gt;rxbufsize
op_assign
id|bc-&gt;rmax
op_plus
l_int|1
suffix:semicolon
id|ch-&gt;tmp_buf
op_assign
id|kmalloc
c_func
(paren
id|ch-&gt;txbufsize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;tmp_buf
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate memory for temp buffers&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_boards
suffix:semicolon
)brace
id|lowwater
op_assign
id|ch-&gt;txbufsize
op_ge
l_int|2000
ques
c_cond
l_int|1024
suffix:colon
id|ch-&gt;txbufsize
op_div
l_int|2
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|STXLWATER
comma
id|lowwater
comma
l_int|0
comma
l_int|10
comma
l_int|0
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SRXLWATER
comma
id|ch-&gt;rxbufsize
op_div
l_int|4
comma
l_int|0
comma
l_int|10
comma
l_int|0
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SRXHWATER
comma
l_int|3
op_star
id|ch-&gt;rxbufsize
op_div
l_int|4
comma
l_int|0
comma
l_int|10
comma
l_int|0
)paren
suffix:semicolon
id|bc-&gt;edelay
op_assign
l_int|100
suffix:semicolon
id|bc-&gt;idata
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;startc
op_assign
id|bc-&gt;startc
suffix:semicolon
id|ch-&gt;stopc
op_assign
id|bc-&gt;stopc
suffix:semicolon
id|ch-&gt;startca
op_assign
id|bc-&gt;startca
suffix:semicolon
id|ch-&gt;stopca
op_assign
id|bc-&gt;stopca
suffix:semicolon
id|ch-&gt;fepcflag
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepiflag
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepoflag
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepstartc
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepstopc
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepstartca
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;fepstopca
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;close_delay
op_assign
l_int|50
suffix:semicolon
id|ch-&gt;count
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;blocked_open
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;callout_termios
op_assign
id|pcxe_callout.init_termios
suffix:semicolon
id|ch-&gt;normal_termios
op_assign
id|pcxe_driver.init_termios
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ch-&gt;open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ch-&gt;close_wait
)paren
suffix:semicolon
id|ch-&gt;asyncflags
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;Card No. %d ready: %s (%s) I/O=0x%x Mem=0x%lx Ports=%d&bslash;n&quot;
comma
id|crd
op_plus
l_int|1
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|board_mem
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
comma
id|bd-&gt;membase
comma
id|bd-&gt;numports
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;PC/Xx: %s (%s) I/O=0x%x Mem=0x%lx Ports=%d&bslash;n&quot;
comma
id|board_desc
(braket
id|bd-&gt;type
)braket
comma
id|board_mem
(braket
id|bd-&gt;type
)braket
comma
id|bd-&gt;port
comma
id|bd-&gt;membase
comma
id|bd-&gt;numports
)paren
suffix:semicolon
id|memwinoff
c_func
(paren
id|bd
comma
l_int|0
)paren
suffix:semicolon
id|enabled_cards
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|enabled_cards
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;PC/Xx: No cards enabled, no driver.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|cleanup_boards
suffix:semicolon
)brace
id|ret
op_assign
id|tty_register_driver
c_func
(paren
op_amp
id|pcxe_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Couldn&squot;t register PC/Xe driver&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_boards
suffix:semicolon
)brace
id|ret
op_assign
id|tty_register_driver
c_func
(paren
op_amp
id|pcxe_callout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Couldn&squot;t register PC/Xe callout&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|cleanup_pcxe_driver
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Start up the poller to check for events on all enabled boards&n;&t; */
id|mod_timer
c_func
(paren
op_amp
id|pcxx_timer
comma
id|HZ
op_div
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;PC/Xx: Driver with %d card(s) ready.&bslash;n&quot;
comma
id|enabled_cards
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_pcxe_driver
suffix:colon
id|tty_unregister_driver
c_func
(paren
op_amp
id|pcxe_driver
)paren
suffix:semicolon
id|cleanup_boards
suffix:colon
id|cleanup_board_resources
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pcxe_termios_locked
)paren
suffix:semicolon
id|cleanup_pcxe_termios
suffix:colon
id|kfree
c_func
(paren
id|pcxe_termios
)paren
suffix:semicolon
id|cleanup_pcxe_table
suffix:colon
id|kfree
c_func
(paren
id|pcxe_table
)paren
suffix:semicolon
id|cleanup_digi_channels
suffix:colon
id|kfree
c_func
(paren
id|digi_channels
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|pcxxpoll
r_static
r_void
id|pcxxpoll
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|crd
suffix:semicolon
r_volatile
r_int
r_int
id|head
comma
id|tail
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_struct
id|board_info
op_star
id|bd
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|crd
op_assign
l_int|0
suffix:semicolon
id|crd
OL
id|numcards
suffix:semicolon
id|crd
op_increment
)paren
(brace
id|bd
op_assign
op_amp
id|boards
(braket
id|crd
)braket
suffix:semicolon
id|ch
op_assign
id|digi_channels
op_plus
id|bd-&gt;first_minor
suffix:semicolon
r_if
c_cond
(paren
id|bd-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_continue
suffix:semicolon
)brace
id|assertmemoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|head
op_assign
id|ch-&gt;mailbox-&gt;ein
suffix:semicolon
id|tail
op_assign
id|ch-&gt;mailbox-&gt;eout
suffix:semicolon
r_if
c_cond
(paren
id|head
op_ne
id|tail
)paren
(brace
id|doevent
c_func
(paren
id|crd
)paren
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
)brace
id|mod_timer
c_func
(paren
op_amp
id|pcxx_timer
comma
id|jiffies
op_plus
id|HZ
op_div
l_int|25
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|doevent
r_static
r_void
id|doevent
c_func
(paren
r_int
id|crd
)paren
(brace
r_volatile
r_struct
id|board_info
op_star
id|bd
suffix:semicolon
r_static
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_volatile
id|unchar
op_star
id|eventbuf
suffix:semicolon
r_volatile
r_int
r_int
id|head
suffix:semicolon
r_volatile
r_int
r_int
id|tail
suffix:semicolon
r_struct
id|channel
op_star
id|ch
suffix:semicolon
r_struct
id|channel
op_star
id|chan0
suffix:semicolon
r_int
id|channel
comma
id|event
comma
id|mstat
comma
id|lstat
suffix:semicolon
id|bd
op_assign
op_amp
id|boards
(braket
id|crd
)braket
suffix:semicolon
id|chan0
op_assign
id|digi_channels
op_plus
id|bd-&gt;first_minor
suffix:semicolon
id|pcxxassert
c_func
(paren
id|chan0
OL
id|digi_channels
op_plus
id|nbdevs
comma
l_string|&quot;ch out of range&quot;
)paren
suffix:semicolon
id|assertgwinon
c_func
(paren
id|chan0
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tail
op_assign
id|chan0-&gt;mailbox-&gt;eout
)paren
op_ne
(paren
id|head
op_assign
id|chan0-&gt;mailbox-&gt;ein
)paren
)paren
(brace
id|assertgwinon
c_func
(paren
id|chan0
)paren
suffix:semicolon
id|eventbuf
op_assign
(paren
r_volatile
id|unchar
op_star
)paren
id|phys_to_virt
c_func
(paren
id|bd-&gt;membase
op_plus
id|tail
op_plus
id|ISTART
)paren
suffix:semicolon
id|channel
op_assign
id|eventbuf
(braket
l_int|0
)braket
suffix:semicolon
id|event
op_assign
id|eventbuf
(braket
l_int|1
)braket
suffix:semicolon
id|mstat
op_assign
id|eventbuf
(braket
l_int|2
)braket
suffix:semicolon
id|lstat
op_assign
id|eventbuf
(braket
l_int|3
)braket
suffix:semicolon
id|ch
op_assign
id|chan0
op_plus
id|channel
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|channel
op_ge
id|bd-&gt;numports
op_logical_or
op_logical_neg
id|ch
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;physmem=%lx, tail=%x, head=%x&bslash;n&quot;
comma
id|bd-&gt;membase
comma
id|tail
comma
id|head
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;doevent(%x) channel %x, event %x, mstat %x, lstat %x&bslash;n&quot;
comma
id|crd
comma
(paren
r_int
)paren
id|channel
comma
id|event
comma
(paren
r_int
)paren
id|mstat
comma
id|lstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_ge
id|bd-&gt;numports
)paren
(brace
id|ch
op_assign
id|chan0
suffix:semicolon
)brace
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bc
op_assign
id|ch-&gt;brdchan
)paren
op_eq
l_int|NULL
)paren
r_goto
id|next
suffix:semicolon
r_if
c_cond
(paren
id|event
op_amp
id|DATA_IND
)paren
(brace
id|receive_data
c_func
(paren
id|ch
)paren
suffix:semicolon
id|assertgwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|event
op_amp
id|MODEMCHG_IND
)paren
(brace
id|ch-&gt;imodem
op_assign
id|mstat
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
)paren
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_CHECK_CD
)paren
(brace
r_if
c_cond
(paren
id|mstat
op_amp
id|ch-&gt;dcd
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|ch-&gt;open_wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|pcxe_sched_event
c_func
(paren
id|ch
comma
id|PCXE_EVENT_HANGUP
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|tty
op_assign
id|ch-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
id|tty
)paren
(brace
r_if
c_cond
(paren
id|event
op_amp
id|BREAK_IND
)paren
(brace
id|tty-&gt;flip.count
op_increment
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_increment
op_assign
id|TTY_BREAK
suffix:semicolon
op_star
id|tty-&gt;flip.char_buf_ptr
op_increment
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|ch-&gt;asyncflags
op_amp
id|ASYNC_SAK
)paren
id|do_SAK
c_func
(paren
id|tty
)paren
suffix:semicolon
macro_line|#endif
id|tty_schedule_flip
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|event
op_amp
id|LOWTX_IND
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;statusflags
op_amp
id|LOWWAIT
)paren
(brace
id|ch-&gt;statusflags
op_and_assign
op_complement
id|LOWWAIT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_DO_WRITE_WAKEUP
)paren
)paren
op_logical_and
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|tty-&gt;write_wait
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|event
op_amp
id|EMPTYTX_IND
)paren
(brace
id|ch-&gt;statusflags
op_and_assign
op_complement
id|TXBUSY
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;statusflags
op_amp
id|EMPTYWAIT
)paren
(brace
id|ch-&gt;statusflags
op_and_assign
op_complement
id|EMPTYWAIT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tty-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|TTY_DO_WRITE_WAKEUP
)paren
)paren
op_logical_and
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty-&gt;ldisc.write_wakeup
)paren
(paren
id|tty
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|tty-&gt;write_wait
)paren
suffix:semicolon
)brace
)brace
)brace
id|next
suffix:colon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;bc == NULL in doevent!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|bc-&gt;idata
op_assign
l_int|1
suffix:semicolon
id|chan0-&gt;mailbox-&gt;eout
op_assign
(paren
id|tail
op_plus
l_int|4
)paren
op_amp
(paren
id|IMAX
op_minus
id|ISTART
op_minus
l_int|4
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|chan0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * pcxxdelay - delays a specified number of milliseconds&n; */
DECL|function|pcxxdelay
r_static
r_void
id|pcxxdelay
c_func
(paren
r_int
id|msec
)paren
(brace
id|mdelay
c_func
(paren
id|msec
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|fepcmd
id|fepcmd
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|cmd
comma
r_int
id|word_or_byte
comma
r_int
id|byte2
comma
r_int
id|ncmds
comma
r_int
id|bytecmd
)paren
(brace
id|unchar
op_star
id|memaddr
suffix:semicolon
r_int
r_int
id|head
comma
id|tail
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;board-&gt;status
op_eq
id|DISABLED
)paren
(brace
r_return
suffix:semicolon
)brace
id|assertgwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|memaddr
op_assign
(paren
id|unchar
op_star
)paren
id|phys_to_virt
c_func
(paren
id|ch-&gt;board-&gt;membase
)paren
suffix:semicolon
id|head
op_assign
id|ch-&gt;mailbox-&gt;cin
suffix:semicolon
r_if
c_cond
(paren
id|head
op_ge
(paren
id|CMAX
op_minus
id|CSTART
)paren
op_logical_or
(paren
id|head
op_amp
l_int|03
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;line %d: Out of range, cmd=%x, head=%x&bslash;n&quot;
comma
id|__LINE__
comma
id|cmd
comma
id|head
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bytecmd
)paren
(brace
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|0
)paren
op_assign
id|cmd
suffix:semicolon
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|1
)paren
op_assign
id|ch-&gt;dev
op_minus
id|ch-&gt;board-&gt;first_minor
suffix:semicolon
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|2
)paren
op_assign
id|word_or_byte
suffix:semicolon
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|3
)paren
op_assign
id|byte2
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|0
)paren
op_assign
id|cmd
suffix:semicolon
op_star
(paren
id|unchar
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|1
)paren
op_assign
id|ch-&gt;dev
op_minus
id|ch-&gt;board-&gt;first_minor
suffix:semicolon
op_star
(paren
id|ushort
op_star
)paren
(paren
id|memaddr
op_plus
id|head
op_plus
id|CSTART
op_plus
l_int|2
)paren
op_assign
id|word_or_byte
suffix:semicolon
)brace
id|head
op_assign
(paren
id|head
op_plus
l_int|4
)paren
op_amp
(paren
id|CMAX
op_minus
id|CSTART
op_minus
l_int|4
)paren
suffix:semicolon
id|ch-&gt;mailbox-&gt;cin
op_assign
id|head
suffix:semicolon
id|count
op_assign
id|FEPTIMEOUT
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Fep not responding in fepcmd()&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|head
op_assign
id|ch-&gt;mailbox-&gt;cin
suffix:semicolon
id|tail
op_assign
id|ch-&gt;mailbox-&gt;cout
suffix:semicolon
id|n
op_assign
(paren
id|head
op_minus
id|tail
)paren
op_amp
(paren
id|CMAX
op_minus
id|CSTART
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_le
id|ncmds
op_star
(paren
r_sizeof
(paren
r_int
)paren
op_star
l_int|4
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* Seems not to be good here: schedule(); */
)brace
)brace
DECL|function|termios2digi_c
r_static
r_int
id|termios2digi_c
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|cflag
)paren
(brace
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CBAUDEX
)paren
(brace
id|ch-&gt;digiext.digi_flags
op_or_assign
id|DIGI_FAST
suffix:semicolon
id|res
op_or_assign
id|FEP_HUPCL
suffix:semicolon
multiline_comment|/* This gets strange but if we don&squot;t do this we will get 78600&n;&t;&t; * instead of 115200. 57600 is mapped to 50 baud yielding 57600 in&n;&t;&t; * FAST mode. 115200 is mapped to 75. We need to map it to 110 to&n;&t;&t; * do 115K&n;&t;&t; */
r_if
c_cond
(paren
id|cflag
op_amp
id|B115200
)paren
id|res
op_or_assign
l_int|1
suffix:semicolon
)brace
r_else
id|ch-&gt;digiext.digi_flags
op_and_assign
op_complement
id|DIGI_FAST
suffix:semicolon
id|res
op_or_assign
id|cflag
op_amp
(paren
id|CBAUD
op_or
id|PARODD
op_or
id|PARENB
op_or
id|CSTOPB
op_or
id|CSIZE
op_or
id|CLOCAL
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|termios2digi_i
r_static
r_int
id|termios2digi_i
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|iflag
)paren
(brace
r_int
id|res
op_assign
id|iflag
op_amp
(paren
id|IGNBRK
op_or
id|BRKINT
op_or
id|IGNPAR
op_or
id|PARMRK
op_or
id|INPCK
op_or
id|ISTRIP
op_or
id|IXON
op_or
id|IXANY
op_or
id|IXOFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DIGI_AIXON
)paren
(brace
id|res
op_or_assign
id|IAIXON
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|termios2digi_h
r_static
r_int
id|termios2digi_h
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|cflag
)paren
(brace
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CRTSCTS
)paren
(brace
id|ch-&gt;digiext.digi_flags
op_or_assign
(paren
id|RTSPACE
op_or
id|CTSPACE
)paren
suffix:semicolon
id|res
op_or_assign
(paren
id|CTS
op_or
id|RTS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|RTSPACE
)paren
(brace
id|res
op_or_assign
id|RTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DTRPACE
)paren
(brace
id|res
op_or_assign
id|DTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|CTSPACE
)paren
(brace
id|res
op_or_assign
id|CTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DSRPACE
)paren
(brace
id|res
op_or_assign
id|ch-&gt;dsr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DCDPACE
)paren
(brace
id|res
op_or_assign
id|ch-&gt;dcd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|res
op_amp
id|RTS
)paren
id|ch-&gt;digiext.digi_flags
op_or_assign
id|RTSPACE
suffix:semicolon
r_if
c_cond
(paren
id|res
op_amp
id|CTS
)paren
id|ch-&gt;digiext.digi_flags
op_or_assign
id|CTSPACE
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|pcxxparam
r_static
r_void
id|pcxxparam
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_int
r_int
id|head
suffix:semicolon
r_int
id|mval
comma
id|hflow
comma
id|cflag
comma
id|iflag
suffix:semicolon
r_struct
id|termios
op_star
id|ts
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|assertgwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|ts
op_assign
id|tty-&gt;termios
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ts-&gt;c_cflag
op_amp
id|CBAUD
)paren
op_eq
l_int|0
)paren
(brace
id|head
op_assign
id|bc-&gt;rin
suffix:semicolon
id|bc-&gt;rout
op_assign
id|head
suffix:semicolon
id|head
op_assign
id|bc-&gt;tin
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|STOUT
comma
(paren
r_int
)paren
id|head
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|mval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cflag
op_assign
id|termios2digi_c
c_func
(paren
id|ch
comma
id|ts-&gt;c_cflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_ne
id|ch-&gt;fepcflag
)paren
(brace
id|ch-&gt;fepcflag
op_assign
id|cflag
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETCTRLFLAGS
comma
(paren
r_int
)paren
id|cflag
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|CLOCAL
)paren
(brace
id|ch-&gt;asyncflags
op_and_assign
op_complement
id|ASYNC_CHECK_CD
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;asyncflags
op_or_assign
id|ASYNC_CHECK_CD
suffix:semicolon
)brace
id|mval
op_assign
id|DTR
op_or
id|RTS
suffix:semicolon
)brace
id|iflag
op_assign
id|termios2digi_i
c_func
(paren
id|ch
comma
id|ts-&gt;c_iflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_ne
id|ch-&gt;fepiflag
)paren
(brace
id|ch-&gt;fepiflag
op_assign
id|iflag
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETIFLAGS
comma
(paren
r_int
r_int
)paren
id|ch-&gt;fepiflag
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|bc-&gt;mint
op_assign
id|ch-&gt;dcd
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ts-&gt;c_cflag
op_amp
id|CLOCAL
)paren
op_logical_or
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DIGI_FORCEDCD
)paren
)paren
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DIGI_FORCEDCD
)paren
(brace
id|bc-&gt;mint
op_assign
l_int|0
suffix:semicolon
)brace
id|ch-&gt;imodem
op_assign
id|bc-&gt;mstat
suffix:semicolon
id|hflow
op_assign
id|termios2digi_h
c_func
(paren
id|ch
comma
id|ts-&gt;c_cflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hflow
op_ne
id|ch-&gt;hflow
)paren
(brace
id|ch-&gt;hflow
op_assign
id|hflow
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETHFLOW
comma
id|hflow
comma
l_int|0xff
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* mval ^= ch-&gt;modemfake &amp; (mval ^ ch-&gt;modem); */
r_if
c_cond
(paren
id|ch-&gt;omodem
op_ne
id|mval
)paren
(brace
id|ch-&gt;omodem
op_assign
id|mval
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETMODEM
comma
id|mval
comma
id|RTS
op_or
id|DTR
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;startc
op_ne
id|ch-&gt;fepstartc
op_logical_or
id|ch-&gt;stopc
op_ne
id|ch-&gt;fepstopc
)paren
(brace
id|ch-&gt;fepstartc
op_assign
id|ch-&gt;startc
suffix:semicolon
id|ch-&gt;fepstopc
op_assign
id|ch-&gt;stopc
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SONOFFC
comma
id|ch-&gt;fepstartc
comma
id|ch-&gt;fepstopc
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;startca
op_ne
id|ch-&gt;fepstartca
op_logical_or
id|ch-&gt;stopca
op_ne
id|ch-&gt;fepstopca
)paren
(brace
id|ch-&gt;fepstartca
op_assign
id|ch-&gt;startca
suffix:semicolon
id|ch-&gt;fepstopca
op_assign
id|ch-&gt;stopca
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SAUXONOFFC
comma
id|ch-&gt;fepstartca
comma
id|ch-&gt;fepstopca
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|receive_data
r_static
r_void
id|receive_data
c_func
(paren
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_int
r_int
id|tail
comma
id|head
comma
id|wrapmask
suffix:semicolon
r_int
id|n
suffix:semicolon
r_int
id|piece
suffix:semicolon
r_struct
id|termios
op_star
id|ts
op_assign
l_int|0
suffix:semicolon
id|unchar
op_star
id|rptr
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
id|wrapgap
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;statusflags
op_amp
id|RXSTOPPED
)paren
r_return
suffix:semicolon
id|tty
op_assign
id|ch-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
id|tty
)paren
(brace
id|ts
op_assign
id|tty-&gt;termios
suffix:semicolon
)brace
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;bc is NULL in receive_data!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|wrapmask
op_assign
id|ch-&gt;rxbufsize
op_minus
l_int|1
suffix:semicolon
id|head
op_assign
id|bc-&gt;rin
suffix:semicolon
id|head
op_and_assign
id|wrapmask
suffix:semicolon
id|tail
op_assign
id|bc-&gt;rout
op_amp
id|wrapmask
suffix:semicolon
id|n
op_assign
(paren
id|head
op_minus
id|tail
)paren
op_amp
id|wrapmask
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
l_int|0
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If CREAD bit is off or device not open, set TX tail to head&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|tty
op_logical_or
op_logical_neg
id|ts
op_logical_or
op_logical_neg
(paren
id|ts-&gt;c_cflag
op_amp
id|CREAD
)paren
)paren
(brace
id|bc-&gt;rout
op_assign
id|head
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_eq
id|TTY_FLIPBUF_SIZE
)paren
(brace
multiline_comment|/* printk(&quot;tty-&gt;flip.count = TTY_FLIPBUF_SIZE&bslash;n&quot;); */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bc-&gt;orun
)paren
(brace
id|bc-&gt;orun
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;overrun! DigiBoard device minor=%d&bslash;n&quot;
comma
id|MINOR
c_func
(paren
id|tty-&gt;device
)paren
)paren
suffix:semicolon
)brace
id|rxwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|rptr
op_assign
id|tty-&gt;flip.char_buf_ptr
suffix:semicolon
id|rc
op_assign
id|tty-&gt;flip.count
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
)paren
(brace
id|wrapgap
op_assign
(paren
id|head
op_ge
id|tail
)paren
ques
c_cond
id|head
op_minus
id|tail
suffix:colon
id|ch-&gt;rxbufsize
op_minus
id|tail
suffix:semicolon
id|piece
op_assign
(paren
id|wrapgap
OL
id|n
)paren
ques
c_cond
id|wrapgap
suffix:colon
id|n
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Make sure we don&squot;t overflow the buffer&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|rc
op_plus
id|piece
)paren
OG
id|TTY_FLIPBUF_SIZE
)paren
id|piece
op_assign
id|TTY_FLIPBUF_SIZE
op_minus
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|piece
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
id|rptr
comma
id|ch-&gt;rxptr
op_plus
id|tail
comma
id|piece
)paren
suffix:semicolon
id|rptr
op_add_assign
id|piece
suffix:semicolon
id|rc
op_add_assign
id|piece
suffix:semicolon
id|tail
op_assign
(paren
id|tail
op_plus
id|piece
)paren
op_amp
id|wrapmask
suffix:semicolon
id|n
op_sub_assign
id|piece
suffix:semicolon
)brace
id|tty-&gt;flip.count
op_assign
id|rc
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_assign
id|rptr
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|bc-&gt;rout
op_assign
id|tail
suffix:semicolon
multiline_comment|/* Must be called with global data */
id|tty_schedule_flip
c_func
(paren
id|ch-&gt;tty
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pcxe_ioctl
r_static
r_int
id|pcxe_ioctl
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|channel
op_star
id|ch
op_assign
(paren
r_struct
id|channel
op_star
)paren
id|tty-&gt;driver_data
suffix:semicolon
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_int
id|mflag
comma
id|mstat
suffix:semicolon
r_int
r_char
id|startc
comma
id|stopc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|digiflow_t
id|dflow
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;ch is NULL in pcxe_ioctl!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TCSBRK
suffix:colon
multiline_comment|/* SVID version: non-zero arg --&gt; no break */
id|retval
op_assign
id|tty_check_change
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
r_return
id|retval
suffix:semicolon
)brace
id|setup_empty_event
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
(brace
id|digi_send_break
c_func
(paren
id|ch
comma
id|HZ
op_div
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/* 1/4 second */
r_return
l_int|0
suffix:semicolon
r_case
id|TCSBRKP
suffix:colon
multiline_comment|/* support for POSIX tcsendbreak() */
id|retval
op_assign
id|tty_check_change
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
r_return
id|retval
suffix:semicolon
)brace
id|setup_empty_event
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|0
)paren
suffix:semicolon
id|digi_send_break
c_func
(paren
id|ch
comma
id|arg
ques
c_cond
id|arg
op_star
(paren
id|HZ
op_div
l_int|10
)paren
suffix:colon
id|HZ
op_div
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TIOCGSOFTCAR
suffix:colon
r_return
id|put_user
c_func
(paren
id|C_CLOCAL
c_func
(paren
id|tty
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCSSOFTCAR
suffix:colon
(brace
r_int
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|value
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|tty-&gt;termios-&gt;c_cflag
op_assign
(paren
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
op_complement
id|CLOCAL
)paren
op_or
(paren
id|value
ques
c_cond
id|CLOCAL
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|TIOCMODG
suffix:colon
r_case
id|TIOCMGET
suffix:colon
id|mflag
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|mstat
op_assign
id|bc-&gt;mstat
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mstat
op_amp
id|DTR
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_DTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|RTS
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_RTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|CTS
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_CTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|ch-&gt;dsr
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_DSR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|RI
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_RI
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|ch-&gt;dcd
)paren
(brace
id|mflag
op_or_assign
id|TIOCM_CD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|mflag
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMBIS
suffix:colon
r_case
id|TIOCMBIC
suffix:colon
r_case
id|TIOCMODS
suffix:colon
r_case
id|TIOCMSET
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|mstat
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|mflag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mstat
op_amp
id|TIOCM_DTR
)paren
(brace
id|mflag
op_or_assign
id|DTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstat
op_amp
id|TIOCM_RTS
)paren
(brace
id|mflag
op_or_assign
id|RTS
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCMODS
suffix:colon
r_case
id|TIOCMSET
suffix:colon
id|ch-&gt;modemfake
op_assign
id|DTR
op_or
id|RTS
suffix:semicolon
id|ch-&gt;modem
op_assign
id|mflag
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMBIS
suffix:colon
id|ch-&gt;modemfake
op_or_assign
id|mflag
suffix:semicolon
id|ch-&gt;modem
op_or_assign
id|mflag
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMBIC
suffix:colon
id|ch-&gt;modemfake
op_and_assign
op_complement
id|mflag
suffix:semicolon
id|ch-&gt;modem
op_and_assign
op_complement
id|mflag
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|pcxxparam
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCSDTR
suffix:colon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ch-&gt;omodem
op_or_assign
id|DTR
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETMODEM
comma
id|DTR
comma
l_int|0
comma
l_int|10
comma
l_int|1
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCCDTR
suffix:colon
id|ch-&gt;omodem
op_and_assign
op_complement
id|DTR
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SETMODEM
comma
l_int|0
comma
id|DTR
comma
l_int|10
comma
l_int|1
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIGI_GETA
suffix:colon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|ch-&gt;digiext
comma
r_sizeof
(paren
id|digi_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIGI_SETAW
suffix:colon
r_case
id|DIGI_SETAF
suffix:colon
r_if
c_cond
(paren
id|cmd
op_eq
id|DIGI_SETAW
)paren
(brace
id|setup_empty_event
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|tty_wait_until_sent
c_func
(paren
id|tty
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tty-&gt;ldisc.flush_buffer
)paren
(brace
id|tty-&gt;ldisc
dot
id|flush_buffer
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Fall Thru */
r_case
id|DIGI_SETA
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ch-&gt;digiext
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|digi_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
macro_line|#ifdef DEBUG_IOCTL
id|printk
c_func
(paren
l_string|&quot;ioctl(DIGI_SETA): flags = %x&bslash;n&quot;
comma
id|ch-&gt;digiext.digi_flags
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ch-&gt;digiext.digi_flags
op_amp
id|DIGI_ALTPIN
)paren
(brace
id|ch-&gt;dcd
op_assign
id|DSR
suffix:semicolon
id|ch-&gt;dsr
op_assign
id|CD
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;dcd
op_assign
id|CD
suffix:semicolon
id|ch-&gt;dsr
op_assign
id|DSR
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|pcxxparam
c_func
(paren
id|tty
comma
id|ch
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIGI_GETFLOW
suffix:colon
r_case
id|DIGI_GETAFLOW
suffix:colon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|DIGI_GETFLOW
)paren
(brace
id|dflow.startc
op_assign
id|bc-&gt;startc
suffix:semicolon
id|dflow.stopc
op_assign
id|bc-&gt;stopc
suffix:semicolon
)brace
r_else
(brace
id|dflow.startc
op_assign
id|bc-&gt;startca
suffix:semicolon
id|dflow.stopc
op_assign
id|bc-&gt;stopca
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|dflow
comma
r_sizeof
(paren
id|dflow
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIGI_SETAFLOW
suffix:colon
r_case
id|DIGI_SETFLOW
suffix:colon
r_if
c_cond
(paren
id|cmd
op_eq
id|DIGI_SETFLOW
)paren
(brace
id|startc
op_assign
id|ch-&gt;startc
suffix:semicolon
id|stopc
op_assign
id|ch-&gt;stopc
suffix:semicolon
)brace
r_else
(brace
id|startc
op_assign
id|ch-&gt;startca
suffix:semicolon
id|stopc
op_assign
id|ch-&gt;stopca
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|dflow
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|dflow
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|dflow.startc
op_ne
id|startc
op_logical_or
id|dflow.stopc
op_ne
id|stopc
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|DIGI_SETFLOW
)paren
(brace
id|ch-&gt;fepstartc
op_assign
id|ch-&gt;startc
op_assign
id|dflow.startc
suffix:semicolon
id|ch-&gt;fepstopc
op_assign
id|ch-&gt;stopc
op_assign
id|dflow.stopc
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SONOFFC
comma
id|ch-&gt;fepstartc
comma
id|ch-&gt;fepstopc
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;fepstartca
op_assign
id|ch-&gt;startca
op_assign
id|dflow.startc
suffix:semicolon
id|ch-&gt;fepstopca
op_assign
id|ch-&gt;stopca
op_assign
id|dflow.stopc
suffix:semicolon
id|fepcmd
c_func
(paren
id|ch
comma
id|SAUXONOFFC
comma
id|ch-&gt;fepstartca
comma
id|ch-&gt;fepstopca
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;statusflags
op_amp
id|TXSTOPPED
)paren
(brace
id|pcxe_start
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcxe_set_termios
r_static
r_void
id|pcxe_set_termios
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|pcxxparam
c_func
(paren
id|tty
comma
id|info
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_termios-&gt;c_cflag
op_amp
id|CRTSCTS
)paren
op_logical_and
(paren
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
id|CRTSCTS
)paren
op_eq
l_int|0
)paren
)paren
id|tty-&gt;hw_stopped
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|old_termios-&gt;c_cflag
op_amp
id|CLOCAL
)paren
op_logical_and
(paren
id|tty-&gt;termios-&gt;c_cflag
op_amp
id|CLOCAL
)paren
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|info-&gt;open_wait
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_pcxe_bh
r_static
r_void
id|do_pcxe_bh
c_func
(paren
r_void
)paren
(brace
id|run_task_queue
c_func
(paren
op_amp
id|tq_pcxx
)paren
suffix:semicolon
)brace
DECL|function|do_softint
r_static
r_void
id|do_softint
c_func
(paren
r_void
op_star
id|private_
)paren
(brace
r_struct
id|channel
op_star
id|info
op_assign
(paren
r_struct
id|channel
op_star
)paren
id|private_
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
id|info-&gt;magic
op_eq
id|PCXX_MAGIC
)paren
(brace
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|info-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
id|tty
op_logical_and
id|tty-&gt;driver_data
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|PCXE_EVENT_HANGUP
comma
op_amp
id|info-&gt;event
)paren
)paren
(brace
id|tty_hangup
c_func
(paren
id|tty
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|info-&gt;open_wait
)paren
suffix:semicolon
id|info-&gt;asyncflags
op_and_assign
op_complement
(paren
id|ASYNC_NORMAL_ACTIVE
op_or
id|ASYNC_CALLOUT_ACTIVE
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|pcxe_stop
r_static
r_void
id|pcxe_stop
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;statusflags
op_amp
id|TXSTOPPED
)paren
op_eq
l_int|0
)paren
(brace
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|info
comma
id|PAUSETX
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;statusflags
op_or_assign
id|TXSTOPPED
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_throttle
r_static
r_void
id|pcxe_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;statusflags
op_amp
id|RXSTOPPED
)paren
op_eq
l_int|0
)paren
(brace
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|fepcmd
c_func
(paren
id|info
comma
id|PAUSERX
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;statusflags
op_or_assign
id|RXSTOPPED
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_unthrottle
r_static
r_void
id|pcxe_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Just in case output was resumed because of a change in Digi-flow */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;statusflags
op_amp
id|RXSTOPPED
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|bc
op_assign
id|info-&gt;brdchan
suffix:semicolon
id|fepcmd
c_func
(paren
id|info
comma
id|RESUMERX
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;statusflags
op_and_assign
op_complement
id|RXSTOPPED
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcxe_start
r_static
r_void
id|pcxe_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_struct
id|channel
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info
op_assign
id|chan
c_func
(paren
id|tty
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Just in case output was resumed because of a change in Digi-flow */
r_if
c_cond
(paren
id|info-&gt;statusflags
op_amp
id|TXSTOPPED
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
id|globalwinon
c_func
(paren
id|info
)paren
suffix:semicolon
id|bc
op_assign
id|info-&gt;brdchan
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;statusflags
op_amp
id|LOWWAIT
)paren
(brace
id|bc-&gt;ilow
op_assign
l_int|1
suffix:semicolon
)brace
id|fepcmd
c_func
(paren
id|info
comma
id|RESUMETX
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;statusflags
op_and_assign
op_complement
id|TXSTOPPED
suffix:semicolon
id|memoff
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|digi_send_break
r_void
id|digi_send_break
c_func
(paren
r_struct
id|channel
op_star
id|ch
comma
r_int
id|msec
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Maybe I should send an infinite break here, schedule() for&n;&t; * msec amount of time, and then stop the break.  This way,&n;&t; * the user can&squot;t screw up the FEP by causing digi_send_break()&n;&t; * to be called (i.e. via an ioctl()) more than once in msec amount &n;&t; * of time.  Try this for now...&n;&t; */
id|fepcmd
c_func
(paren
id|ch
comma
id|SENDBREAK
comma
id|msec
comma
l_int|0
comma
l_int|10
comma
l_int|0
)paren
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|setup_empty_event
r_static
r_void
id|setup_empty_event
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|channel
op_star
id|ch
)paren
(brace
r_volatile
r_struct
id|board_chan
op_star
id|bc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|globalwinon
c_func
(paren
id|ch
)paren
suffix:semicolon
id|ch-&gt;statusflags
op_or_assign
id|EMPTYWAIT
suffix:semicolon
id|bc
op_assign
id|ch-&gt;brdchan
suffix:semicolon
id|bc-&gt;iempty
op_assign
l_int|1
suffix:semicolon
id|memoff
c_func
(paren
id|ch
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
eof
