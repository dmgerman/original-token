macro_line|#include &lt;sys/types.h&gt;
macro_line|#include &lt;sys/stat.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;fcntl.h&gt;
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &quot;ip2.h&quot;
macro_line|#include &quot;i2ellis.h&quot;
DECL|variable|nm
r_char
id|nm
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|Board
id|i2eBordStr
id|Board
(braket
l_int|2
)braket
suffix:semicolon
r_static
r_void
id|ex_details
c_func
(paren
id|i2eBordStrPtr
)paren
suffix:semicolon
DECL|function|main
r_int
id|main
(paren
r_int
id|argc
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
r_int
id|board
comma
id|box
comma
id|port
suffix:semicolon
r_int
id|fd
suffix:semicolon
r_int
id|dev
suffix:semicolon
id|i2eBordStrPtr
id|pB
op_assign
id|Board
suffix:semicolon
singleline_comment|// Remove all IP2 devices
r_for
c_loop
(paren
id|board
op_assign
l_int|0
suffix:semicolon
id|board
OL
l_int|4
suffix:semicolon
op_increment
id|board
)paren
(brace
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ip2ipl%d&quot;
comma
id|board
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ip2stat%d&quot;
comma
id|board
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|port
op_assign
l_int|0
suffix:semicolon
id|port
OL
l_int|256
suffix:semicolon
op_increment
id|port
)paren
(brace
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ttyF%d&quot;
comma
id|port
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/cuf%d&quot;
comma
id|port
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
)brace
singleline_comment|// Now create management devices, and use the status device to determine how
singleline_comment|// port devices need to exist, and then create them.
r_for
c_loop
(paren
id|board
op_assign
l_int|0
suffix:semicolon
id|board
OL
l_int|4
suffix:semicolon
op_increment
id|board
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;Board %d: &quot;
comma
id|board
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ip2ipl%d&quot;
comma
id|board
)paren
suffix:semicolon
id|mknod
(paren
id|nm
comma
id|S_IFCHR
op_or
l_int|0666
comma
(paren
id|IP2_IPL_MAJOR
op_lshift
l_int|8
)paren
op_or
id|board
op_star
l_int|4
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ip2stat%d&quot;
comma
id|board
)paren
suffix:semicolon
id|mknod
(paren
id|nm
comma
id|S_IFCHR
op_or
l_int|0666
comma
(paren
id|IP2_IPL_MAJOR
op_lshift
l_int|8
)paren
op_or
id|board
op_star
l_int|4
op_plus
l_int|1
)paren
suffix:semicolon
id|fd
op_assign
id|open
(paren
id|nm
comma
id|O_RDONLY
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fd
)paren
(brace
id|printf
(paren
l_string|&quot;Unable to open status device %s&bslash;n&quot;
comma
id|nm
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ioctl
(paren
id|fd
comma
l_int|65
comma
id|Board
)paren
OL
l_int|0
)paren
(brace
id|printf
(paren
l_string|&quot;not present&bslash;n&quot;
)paren
suffix:semicolon
id|close
(paren
id|fd
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ip2ipl%d&quot;
comma
id|board
)paren
suffix:semicolon
id|unlink
(paren
id|nm
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|pB-&gt;i2ePom.e.porID
op_amp
op_complement
id|POR_ID_RESERVED
)paren
(brace
r_case
id|POR_ID_FIIEX
suffix:colon
id|ex_details
(paren
id|pB
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|POR_ID_II_4
suffix:colon
id|printf
(paren
l_string|&quot;ISA-4&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|POR_ID_II_8
suffix:colon
id|printf
(paren
l_string|&quot;ISA-8 std&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|POR_ID_II_8R
suffix:colon
id|printf
(paren
l_string|&quot;ISA-8 RJ11&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printf
(paren
l_string|&quot;Unknown board type, ID = %x&quot;
comma
id|pB-&gt;i2ePom.e.porID
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|box
op_assign
l_int|0
suffix:semicolon
id|box
OL
id|ABS_MAX_BOXES
suffix:semicolon
op_increment
id|box
)paren
(brace
r_for
c_loop
(paren
id|port
op_assign
l_int|0
suffix:semicolon
id|port
OL
id|ABS_BIGGEST_BOX
suffix:semicolon
op_increment
id|port
)paren
(brace
r_if
c_cond
(paren
id|pB-&gt;i2eChannelMap
(braket
id|box
)braket
op_amp
(paren
l_int|1
op_lshift
id|port
)paren
)paren
(brace
id|dev
op_assign
id|port
op_plus
id|box
op_star
id|ABS_BIGGEST_BOX
op_plus
id|board
op_star
id|ABS_BIGGEST_BOX
op_star
id|ABS_MAX_BOXES
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/ttyF%d&quot;
comma
id|dev
)paren
suffix:semicolon
id|mknod
(paren
id|nm
comma
id|S_IFCHR
op_or
l_int|0666
comma
(paren
id|IP2_TTY_MAJOR
op_lshift
l_int|8
)paren
op_or
id|dev
)paren
suffix:semicolon
id|sprintf
(paren
id|nm
comma
l_string|&quot;/dev/cuf%d&quot;
comma
id|dev
)paren
suffix:semicolon
id|mknod
(paren
id|nm
comma
id|S_IFCHR
op_or
l_int|0666
comma
(paren
id|IP2_CALLOUT_MAJOR
op_lshift
l_int|8
)paren
op_or
id|dev
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
id|printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|ex_details
r_static
r_void
id|ex_details
(paren
id|i2eBordStrPtr
id|pB
)paren
(brace
r_int
id|box
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ports
op_assign
l_int|0
suffix:semicolon
r_int
id|boxes
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|box
op_assign
l_int|0
suffix:semicolon
id|box
OL
id|ABS_MAX_BOXES
suffix:semicolon
op_increment
id|box
)paren
(brace
r_if
c_cond
(paren
id|pB-&gt;i2eChannelMap
(braket
id|box
)braket
op_ne
l_int|0
)paren
(brace
op_increment
id|boxes
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ABS_BIGGEST_BOX
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|pB-&gt;i2eChannelMap
(braket
id|box
)braket
op_amp
l_int|1
op_lshift
id|i
)paren
(brace
op_increment
id|ports
suffix:semicolon
)brace
)brace
)brace
id|printf
c_func
(paren
l_string|&quot;EX bx=%d pt=%d %d bit&quot;
comma
id|boxes
comma
id|ports
comma
id|pB-&gt;i2eDataWidth16
ques
c_cond
l_int|16
suffix:colon
l_int|8
)paren
suffix:semicolon
)brace
eof
