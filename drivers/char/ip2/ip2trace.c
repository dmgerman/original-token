multiline_comment|/*******************************************************************************&n;*&n;*   (c) 1998 by Computone Corporation&n;*&n;********************************************************************************&n;*&n;*&n;*   PACKAGE:     Linux tty Device Driver for IntelliPort family of multiport&n;*                serial I/O controllers.&n;*&n;*   DESCRIPTION: Interpretive trace dump utility&n;*&n;*******************************************************************************/
macro_line|#include &lt;sys/time.h&gt;
macro_line|#include &lt;sys/types.h&gt;
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;signal.h&gt;
macro_line|#include &lt;sys/stat.h&gt;
macro_line|#include &lt;fcntl.h&gt;
macro_line|#include &lt;ctype.h&gt;
macro_line|#include &quot;ip2trace.h&quot;
DECL|variable|namebuf
r_int
r_int
id|namebuf
(braket
l_int|100
)braket
suffix:semicolon
r_struct
(brace
DECL|member|wrap
r_int
id|wrap
comma
DECL|member|size
id|size
comma
DECL|member|o_strip
id|o_strip
comma
DECL|member|o_stuff
id|o_stuff
comma
DECL|member|strip
id|strip
comma
DECL|member|stuff
id|stuff
suffix:semicolon
DECL|member|buf
r_int
r_int
id|buf
(braket
l_int|1000
)braket
suffix:semicolon
DECL|variable|tbuf
)brace
id|tbuf
suffix:semicolon
DECL|variable|act
r_struct
id|sigaction
id|act
suffix:semicolon
DECL|enumerator|kChar
DECL|enumerator|kInt
DECL|enumerator|kAddr
DECL|enumerator|kHex
DECL|typedef|eFormat
r_typedef
r_enum
(brace
id|kChar
comma
id|kInt
comma
id|kAddr
comma
id|kHex
)brace
id|eFormat
suffix:semicolon
DECL|variable|active
r_int
id|active
op_assign
l_int|1
suffix:semicolon
DECL|function|quit
r_void
id|quit
c_func
(paren
)paren
(brace
id|active
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|main
r_int
id|main
(paren
r_int
id|argc
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
r_int
id|fd
op_assign
id|open
(paren
l_string|&quot;/dev/ip2trace&quot;
comma
id|O_RDONLY
)paren
suffix:semicolon
r_int
id|cnt
comma
id|i
suffix:semicolon
r_int
r_int
id|ts
comma
id|td
suffix:semicolon
r_struct
id|timeval
id|timeout
suffix:semicolon
r_union
id|ip2breadcrumb
id|bc
suffix:semicolon
id|eFormat
id|fmt
op_assign
id|kHex
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
(brace
id|printf
(paren
l_string|&quot;Can&squot;t open device /dev/ip2trace&bslash;n&quot;
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|act.sa_handler
op_assign
id|quit
suffix:semicolon
multiline_comment|/*act.sa_mask = 0;*/
id|sigemptyset
c_func
(paren
op_amp
id|act.sa_mask
)paren
suffix:semicolon
id|act.sa_flags
op_assign
l_int|0
suffix:semicolon
id|act.sa_restorer
op_assign
l_int|NULL
suffix:semicolon
id|sigaction
(paren
id|SIGTERM
comma
op_amp
id|act
comma
l_int|NULL
)paren
suffix:semicolon
id|ioctl
(paren
id|fd
comma
l_int|1
comma
id|namebuf
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;iiSendPendingMail %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2InitChannels %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2QueueNeeds %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2QueueCommands %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2GetStatus %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2Input %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2InputFlush %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2Output %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2FlushOutput %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2DrainWakeup %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2DrainOutput %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|10
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2OutputFree %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2StripFifo %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|12
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2StuffFifoBypass %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|13
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2StuffFifoFlow %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2StuffFifoInline %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;i2ServiceBoard %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;serviceOutgoingFifo %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|17
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_init %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|18
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_init_board %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;find_eisa_board %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;set_irq %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|21
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ex_details %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|22
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_interrupt %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|23
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_poll %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|24
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;service_all_boards %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|25
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;do_input %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|27
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;do_status %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|26
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;open_sanity_check %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|27
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;open_block_til_ready %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|28
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_open %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|29
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_close %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_hangup %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_write %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_putchar %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_flush_chars %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|34
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_write_room %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|35
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_chars_in_buf %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|36
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_flush_buffer %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|37
)braket
)paren
suffix:semicolon
singleline_comment|//printf ( &quot;ip2_wait_until_sent %p&bslash;n&quot;,      namebuf[38] );  
id|printf
(paren
l_string|&quot;ip2_throttle %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|39
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_unthrottle %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|40
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_ioctl %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|41
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;get_modem_info %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|42
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;set_modem_info %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|43
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;get_serial_info %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|44
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;set_serial_info %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|45
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_set_termios %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|46
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;ip2_set_line_discipline %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|47
)braket
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;set_line_characteristics %p&bslash;n&quot;
comma
id|namebuf
(braket
l_int|48
)braket
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;n-------------------------&bslash;n&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Start of trace&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|active
)paren
(brace
id|cnt
op_assign
id|read
(paren
id|fd
comma
op_amp
id|tbuf
comma
r_sizeof
id|tbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
)paren
(brace
r_if
c_cond
(paren
id|tbuf.wrap
)paren
(brace
id|printf
(paren
l_string|&quot;&bslash;nTrace buffer: wrap=%d, strip=%d, stuff=%d&bslash;n&quot;
comma
id|tbuf.wrap
comma
id|tbuf.strip
comma
id|tbuf.stuff
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|bc.value
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bc.hdr.codes
)paren
(brace
id|td
op_assign
id|tbuf.buf
(braket
id|i
)braket
op_minus
id|ts
suffix:semicolon
id|ts
op_assign
id|tbuf.buf
(braket
id|i
op_increment
)braket
suffix:semicolon
id|bc.value
op_assign
id|tbuf.buf
(braket
id|i
)braket
suffix:semicolon
id|printf
(paren
l_string|&quot;&bslash;n(%d) Port %3d &quot;
comma
id|ts
comma
id|bc.hdr.port
)paren
suffix:semicolon
id|fmt
op_assign
id|kHex
suffix:semicolon
r_switch
c_cond
(paren
id|bc.hdr.cat
)paren
(brace
r_case
id|ITRC_INIT
suffix:colon
id|printf
(paren
l_string|&quot;Init       %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_OPEN
suffix:colon
id|printf
(paren
l_string|&quot;Open       %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_CLOSE
suffix:colon
id|printf
(paren
l_string|&quot;Close      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_DRAIN
suffix:colon
id|printf
(paren
l_string|&quot;Drain      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_IOCTL
suffix:colon
id|printf
(paren
l_string|&quot;Ioctl      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_FLUSH
suffix:colon
id|printf
(paren
l_string|&quot;Flush      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_STATUS
suffix:colon
id|printf
(paren
l_string|&quot;GetS       %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_HANGUP
suffix:colon
id|printf
(paren
l_string|&quot;Hangup     %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_INTR
suffix:colon
id|printf
(paren
l_string|&quot;*Intr      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_SFLOW
suffix:colon
id|printf
(paren
l_string|&quot;SFlow      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_SBCMD
suffix:colon
id|printf
(paren
l_string|&quot;Bypass CMD %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_SICMD
suffix:colon
id|printf
(paren
l_string|&quot;Inline CMD %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_MODEM
suffix:colon
id|printf
(paren
l_string|&quot;Modem      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_INPUT
suffix:colon
id|printf
(paren
l_string|&quot;Input      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_OUTPUT
suffix:colon
id|printf
(paren
l_string|&quot;Output     %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_PUTC
suffix:colon
id|printf
(paren
l_string|&quot;Put char   %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kChar
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_QUEUE
suffix:colon
id|printf
(paren
l_string|&quot;Queue CMD  %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_STFLW
suffix:colon
id|printf
(paren
l_string|&quot;Stat Flow  %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_SFIFO
suffix:colon
id|printf
(paren
l_string|&quot;SFifo      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_VERIFY
suffix:colon
id|printf
(paren
l_string|&quot;Verfy      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kHex
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_WRITE
suffix:colon
id|printf
(paren
l_string|&quot;Write      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kChar
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITRC_ERROR
suffix:colon
id|printf
(paren
l_string|&quot;ERROR      %d: &quot;
comma
id|bc.hdr.label
)paren
suffix:semicolon
id|fmt
op_assign
id|kInt
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printf
(paren
l_string|&quot;%08x          &quot;
comma
id|tbuf.buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
op_decrement
id|bc.hdr.codes
suffix:semicolon
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
id|kChar
suffix:colon
id|printf
(paren
l_string|&quot;%c (0x%02x) &quot;
comma
id|isprint
(paren
id|tbuf.buf
(braket
id|i
)braket
)paren
ques
c_cond
id|tbuf.buf
(braket
id|i
)braket
suffix:colon
l_char|&squot;.&squot;
comma
id|tbuf.buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|kInt
suffix:colon
id|printf
(paren
l_string|&quot;%d &quot;
comma
id|tbuf.buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|kAddr
suffix:colon
r_case
id|kHex
suffix:colon
id|printf
(paren
l_string|&quot;0x%x &quot;
comma
id|tbuf.buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
id|fflush
(paren
id|stdout
)paren
suffix:semicolon
id|timeout.tv_sec
op_assign
l_int|0
suffix:semicolon
id|timeout.tv_usec
op_assign
l_int|250
suffix:semicolon
id|select
(paren
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|timeout
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;&bslash;n-------------------------&bslash;n&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;End of trace&bslash;n&quot;
)paren
suffix:semicolon
id|close
(paren
id|fd
)paren
suffix:semicolon
)brace
eof
