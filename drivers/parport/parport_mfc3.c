multiline_comment|/* Low-level parallel port routines for the Multiface 3 card&n; *&n; * Author: Joerg Dorchain &lt;joerg@dorchain.net&gt;&n; *&n; * (C) The elitist m68k Users(TM)&n; *&n; * based on the existing parport_amiga and lp_mfc&n; *&n; *&n; * From the MFC3 documentation:&n; * &n; * Miscellaneous PIA Details&n; * -------------------------&n; * &n; * &t;The two open-drain interrupt outputs /IRQA and /IRQB are routed to&n; * /INT2 of the Z2 bus.&n; * &n; * &t;The CPU data bus of the PIA (D0-D7) is connected to D8-D15 on the Z2&n; * bus. This means that any PIA registers are accessed at even addresses.&n; * &n; * Centronics Pin Connections for the PIA&n; * --------------------------------------&n; * &n; * &t;The following table shows the connections between the PIA and the&n; * Centronics interface connector. These connections implement a single, but&n; * very complete, Centronics type interface. The Pin column gives the pin&n; * numbers of the PIA. The Centronics pin numbers can be found in the section&n; * &quot;Parallel Connectors&quot;.&n; * &n; * &n; *    Pin | PIA | Dir | Centronics Names&n; * -------+-----+-----+---------------------------------------------------------&n; *     19 | CB2 | --&gt; | /STROBE (aka /DRDY)&n; *  10-17 | PBx | &lt;-&gt; | DATA0 - DATA7&n; *     18 | CB1 | &lt;-- | /ACK&n; *     40 | CA1 | &lt;-- | BUSY&n; *      3 | PA1 | &lt;-- | PAPER-OUT (aka POUT)&n; *      4 | PA2 | &lt;-- | SELECTED (aka SEL)&n; *      9 | PA7 | --&gt; | /INIT (aka /RESET or /INPUT-PRIME)&n; *      6 | PA4 | &lt;-- | /ERROR (aka /FAULT)&n; *      7 | PA5 | --&gt; | DIR (aka /SELECT-IN)&n; *      8 | PA6 | --&gt; | /AUTO-FEED-XT&n; *     39 | CA2 | --&gt; | open&n; *      5 | PA3 | &lt;-- | /ACK (same as CB1!)&n; *      2 | PA0 | &lt;-- | BUSY (same as CA1!)&n; * -------+-----+-----+---------------------------------------------------------&n; * &n; * Should be enough to understand some of the driver.&n; *&n; * Per convention for normal use the port registers are visible.&n; * If you need the data direction registers, restore the value in the&n; * control register.&n; */
macro_line|#include &quot;multiface.h&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/parport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mc6821.h&gt;
macro_line|#include &lt;linux/zorro.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
multiline_comment|/* Maximum Number of Cards supported */
DECL|macro|MAX_MFC
mdefine_line|#define MAX_MFC 5
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#ifdef DEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK printk
macro_line|#else
DECL|function|DPRINTK
r_static
r_inline
r_int
id|DPRINTK
c_func
(paren
r_void
op_star
id|nothing
comma
dot
dot
dot
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|this_port
r_static
r_struct
id|parport
op_star
id|this_port
(braket
id|MAX_MFC
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|dummy
r_static
r_volatile
r_int
id|dummy
suffix:semicolon
multiline_comment|/* for trigger readds */
DECL|macro|pia
mdefine_line|#define pia(dev) ((struct pia *)(dev-&gt;base))
DECL|variable|pp_mfc3_ops
r_static
r_struct
id|parport_operations
id|pp_mfc3_ops
suffix:semicolon
DECL|function|mfc3_write_data
r_static
r_void
id|mfc3_write_data
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_int
r_char
id|data
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;write_data %c&bslash;n&quot;
comma
id|data
)paren
suffix:semicolon
id|dummy
op_assign
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pprb
suffix:semicolon
multiline_comment|/* clears irq bit */
multiline_comment|/* Triggers also /STROBE.*/
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pprb
op_assign
id|data
suffix:semicolon
)brace
DECL|function|mfc3_read_data
r_static
r_int
r_char
id|mfc3_read_data
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
multiline_comment|/* clears interupt bit. Triggers also /STROBE. */
r_return
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pprb
suffix:semicolon
)brace
DECL|function|control_pc_to_mfc3
r_static
r_int
r_char
id|control_pc_to_mfc3
c_func
(paren
r_int
r_char
id|control
)paren
(brace
r_int
r_char
id|ret
op_assign
l_int|32
op_or
l_int|64
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
id|PARPORT_CONTROL_SELECT
)paren
multiline_comment|/* XXX: What is SELECP? */
id|ret
op_and_assign
op_complement
l_int|32
suffix:semicolon
multiline_comment|/* /SELECT_IN */
r_if
c_cond
(paren
id|control
op_amp
id|PARPORT_CONTROL_INIT
)paren
multiline_comment|/* INITP */
id|ret
op_or_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
id|PARPORT_CONTROL_AUTOFD
)paren
multiline_comment|/* AUTOLF */
id|ret
op_and_assign
op_complement
l_int|64
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
id|PARPORT_CONTROL_STROBE
)paren
multiline_comment|/* Strobe */
multiline_comment|/* Handled directly by hardware */
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|control_mfc3_to_pc
r_static
r_int
r_char
id|control_mfc3_to_pc
c_func
(paren
r_int
r_char
id|control
)paren
(brace
r_int
r_char
id|ret
op_assign
id|PARPORT_CONTROL_STROBE
op_or
id|PARPORT_CONTROL_AUTOFD
op_or
id|PARPORT_CONTROL_SELECT
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
l_int|128
)paren
multiline_comment|/* /INITP */
id|ret
op_or_assign
id|PARPORT_CONTROL_INIT
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
l_int|64
)paren
multiline_comment|/* /AUTOLF */
id|ret
op_and_assign
op_complement
id|PARPORT_CONTROL_AUTOFD
suffix:semicolon
r_if
c_cond
(paren
id|control
op_amp
l_int|32
)paren
multiline_comment|/* /SELECT_IN */
id|ret
op_and_assign
op_complement
id|PARPORT_CONTROL_SELECT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|mfc3_write_control
r_static
r_void
id|mfc3_write_control
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_int
r_char
id|control
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;write_control %02x&bslash;n&quot;
comma
id|control
)paren
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_assign
(paren
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_amp
l_int|0x1f
)paren
op_or
id|control_pc_to_mfc3
c_func
(paren
id|control
)paren
suffix:semicolon
)brace
DECL|function|mfc3_read_control
r_static
r_int
r_char
id|mfc3_read_control
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;read_control &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|control_mfc3_to_pc
c_func
(paren
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_amp
l_int|0xe0
)paren
suffix:semicolon
)brace
DECL|function|mfc3_frob_control
r_static
r_int
r_char
id|mfc3_frob_control
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|old
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;frob_control mask %02x, value %02x&bslash;n&quot;
comma
id|mask
comma
id|val
)paren
suffix:semicolon
id|old
op_assign
id|mfc3_read_control
c_func
(paren
id|p
)paren
suffix:semicolon
id|mfc3_write_control
c_func
(paren
id|p
comma
(paren
id|old
op_amp
op_complement
id|mask
)paren
op_xor
id|val
)paren
suffix:semicolon
r_return
id|old
suffix:semicolon
)brace
macro_line|#if 0 /* currently unused */
r_static
r_int
r_char
id|status_pc_to_mfc3
c_func
(paren
r_int
r_char
id|status
)paren
(brace
r_int
r_char
id|ret
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PARPORT_STATUS_BUSY
)paren
multiline_comment|/* Busy */
id|ret
op_and_assign
op_complement
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PARPORT_STATUS_ACK
)paren
multiline_comment|/* Ack */
id|ret
op_or_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PARPORT_STATUS_PAPEROUT
)paren
multiline_comment|/* PaperOut */
id|ret
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PARPORT_STATUS_SELECT
)paren
multiline_comment|/* select */
id|ret
op_or_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PARPORT_STATUS_ERROR
)paren
multiline_comment|/* error */
id|ret
op_or_assign
l_int|16
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif
DECL|function|status_mfc3_to_pc
r_static
r_int
r_char
id|status_mfc3_to_pc
c_func
(paren
r_int
r_char
id|status
)paren
(brace
r_int
r_char
id|ret
op_assign
id|PARPORT_STATUS_BUSY
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|1
)paren
multiline_comment|/* Busy */
id|ret
op_and_assign
op_complement
id|PARPORT_STATUS_BUSY
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|2
)paren
multiline_comment|/* PaperOut */
id|ret
op_or_assign
id|PARPORT_STATUS_PAPEROUT
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|4
)paren
multiline_comment|/* Selected */
id|ret
op_or_assign
id|PARPORT_STATUS_SELECT
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|8
)paren
multiline_comment|/* Ack */
id|ret
op_or_assign
id|PARPORT_STATUS_ACK
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|16
)paren
multiline_comment|/* /ERROR */
id|ret
op_or_assign
id|PARPORT_STATUS_ERROR
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#if 0 /* currently unused */
r_static
r_void
id|mfc3_write_status
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_int
r_char
id|status
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;write_status %02x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_assign
(paren
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_amp
l_int|0xe0
)paren
op_or
id|status_pc_to_mfc3
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|mfc3_read_status
r_static
r_int
r_char
id|mfc3_read_status
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
r_int
r_char
id|status
suffix:semicolon
id|status
op_assign
id|status_mfc3_to_pc
c_func
(paren
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;read_status %02x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
macro_line|#if 0 /* currently unused */
r_static
r_void
id|mfc3_change_mode
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_int
id|m
)paren
(brace
multiline_comment|/* XXX: This port only has one mode, and I am&n;&t;not sure about the corresponding PC-style mode*/
)brace
macro_line|#endif
DECL|variable|use_cnt
r_static
r_int
id|use_cnt
op_assign
l_int|0
suffix:semicolon
DECL|function|mfc3_interrupt
r_static
r_void
id|mfc3_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_MFC
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|this_port
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|pia
c_func
(paren
id|this_port
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|crb
op_amp
l_int|128
)paren
(brace
multiline_comment|/* Board caused interrupt */
id|dummy
op_assign
id|pia
c_func
(paren
id|this_port
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|pprb
suffix:semicolon
multiline_comment|/* clear irq bit */
id|parport_generic_irq
c_func
(paren
id|irq
comma
id|this_port
(braket
id|i
)braket
comma
id|regs
)paren
suffix:semicolon
)brace
)brace
DECL|function|mfc3_enable_irq
r_static
r_void
id|mfc3_enable_irq
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_or_assign
id|PIA_C1_ENABLE_IRQ
suffix:semicolon
)brace
DECL|function|mfc3_disable_irq
r_static
r_void
id|mfc3_disable_irq
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_and_assign
op_complement
id|PIA_C1_ENABLE_IRQ
suffix:semicolon
)brace
DECL|function|mfc3_data_forward
r_static
r_void
id|mfc3_data_forward
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;forward&bslash;n&quot;
)paren
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
multiline_comment|/* make data direction register visible */
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* all pins output */
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_or_assign
id|PIA_DDR
suffix:semicolon
multiline_comment|/* make data register visible - default */
)brace
DECL|function|mfc3_data_reverse
r_static
r_void
id|mfc3_data_reverse
c_func
(paren
r_struct
id|parport
op_star
id|p
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;reverse&bslash;n&quot;
)paren
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
multiline_comment|/* make data direction register visible */
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* all pins input */
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_or_assign
id|PIA_DDR
suffix:semicolon
multiline_comment|/* make data register visible - default */
)brace
DECL|function|mfc3_init_state
r_static
r_void
id|mfc3_init_state
c_func
(paren
r_struct
id|pardevice
op_star
id|dev
comma
r_struct
id|parport_state
op_star
id|s
)paren
(brace
id|s-&gt;u.amiga.data
op_assign
l_int|0
suffix:semicolon
id|s-&gt;u.amiga.datadir
op_assign
l_int|255
suffix:semicolon
id|s-&gt;u.amiga.status
op_assign
l_int|0
suffix:semicolon
id|s-&gt;u.amiga.statusdir
op_assign
l_int|0xe0
suffix:semicolon
)brace
DECL|function|mfc3_save_state
r_static
r_void
id|mfc3_save_state
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_struct
id|parport_state
op_star
id|s
)paren
(brace
id|s-&gt;u.amiga.data
op_assign
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pprb
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
id|s-&gt;u.amiga.datadir
op_assign
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_or_assign
id|PIA_DDR
suffix:semicolon
id|s-&gt;u.amiga.status
op_assign
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|cra
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
id|s-&gt;u.amiga.statusdir
op_assign
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|cra
op_or_assign
id|PIA_DDR
suffix:semicolon
)brace
DECL|function|mfc3_restore_state
r_static
r_void
id|mfc3_restore_state
c_func
(paren
r_struct
id|parport
op_star
id|p
comma
r_struct
id|parport_state
op_star
id|s
)paren
(brace
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pprb
op_assign
id|s-&gt;u.amiga.data
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
op_assign
id|s-&gt;u.amiga.datadir
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|crb
op_or_assign
id|PIA_DDR
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|ppra
op_assign
id|s-&gt;u.amiga.status
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|cra
op_and_assign
op_complement
id|PIA_DDR
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pddrb
op_assign
id|s-&gt;u.amiga.statusdir
suffix:semicolon
id|pia
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|cra
op_or_assign
id|PIA_DDR
suffix:semicolon
)brace
DECL|function|mfc3_inc_use_count
r_static
r_void
id|mfc3_inc_use_count
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|mfc3_dec_use_count
r_static
r_void
id|mfc3_dec_use_count
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|variable|pp_mfc3_ops
r_static
r_struct
id|parport_operations
id|pp_mfc3_ops
op_assign
(brace
id|mfc3_write_data
comma
id|mfc3_read_data
comma
id|mfc3_write_control
comma
id|mfc3_read_control
comma
id|mfc3_frob_control
comma
id|mfc3_read_status
comma
id|mfc3_enable_irq
comma
id|mfc3_disable_irq
comma
id|mfc3_data_forward
comma
id|mfc3_data_reverse
comma
id|mfc3_init_state
comma
id|mfc3_save_state
comma
id|mfc3_restore_state
comma
id|mfc3_inc_use_count
comma
id|mfc3_dec_use_count
comma
id|parport_ieee1284_epp_write_data
comma
id|parport_ieee1284_epp_read_data
comma
id|parport_ieee1284_epp_write_addr
comma
id|parport_ieee1284_epp_read_addr
comma
id|parport_ieee1284_ecp_write_data
comma
id|parport_ieee1284_ecp_read_data
comma
id|parport_ieee1284_ecp_write_addr
comma
id|parport_ieee1284_write_compat
comma
id|parport_ieee1284_read_nibble
comma
id|parport_ieee1284_read_byte
comma
)brace
suffix:semicolon
multiline_comment|/* ----------- Initialisation code --------------------------------- */
DECL|function|parport_mfc3_init
r_int
id|__init
id|parport_mfc3_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|parport
op_star
id|p
suffix:semicolon
r_int
id|pias
suffix:semicolon
r_struct
id|pia
op_star
id|pp
suffix:semicolon
r_struct
id|zorro_dev
op_star
id|z
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACH_IS_AMIGA
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_while
c_loop
(paren
(paren
id|z
op_assign
id|zorro_find_device
c_func
(paren
id|ZORRO_PROD_BSC_MULTIFACE_III
comma
id|z
)paren
)paren
)paren
(brace
r_int
r_int
id|piabase
op_assign
id|z-&gt;resource.start
op_plus
id|PIABASE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|piabase
comma
r_sizeof
(paren
r_struct
id|pia
)paren
comma
l_string|&quot;PIA&quot;
)paren
)paren
r_continue
suffix:semicolon
id|pp
op_assign
(paren
r_struct
id|pia
op_star
)paren
id|ZTWO_VADDR
c_func
(paren
id|piabase
)paren
suffix:semicolon
id|pp-&gt;crb
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;pddrb
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* all data pins output */
id|pp-&gt;crb
op_assign
id|PIA_DDR
op_or
l_int|32
op_or
l_int|8
suffix:semicolon
id|dummy
op_assign
id|pp-&gt;pddrb
suffix:semicolon
multiline_comment|/* reading clears interrupt */
id|pp-&gt;cra
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;pddra
op_assign
l_int|0xe0
suffix:semicolon
multiline_comment|/* /RESET,  /DIR ,/AUTO-FEED output */
id|pp-&gt;cra
op_assign
id|PIA_DDR
suffix:semicolon
id|pp-&gt;ppra
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset printer */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|pp-&gt;ppra
op_assign
l_int|128
suffix:semicolon
id|p
op_assign
id|parport_register_port
c_func
(paren
(paren
r_int
r_int
)paren
id|pp
comma
id|IRQ_AMIGA_PORTS
comma
id|PARPORT_DMA_NONE
comma
op_amp
id|pp_mfc3_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_goto
id|out_port
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;irq
op_ne
id|PARPORT_IRQ_NONE
)paren
(brace
r_if
c_cond
(paren
id|use_cnt
op_increment
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_AMIGA_PORTS
comma
id|mfc3_interrupt
comma
id|SA_SHIRQ
comma
id|p-&gt;name
comma
op_amp
id|pp_mfc3_ops
)paren
)paren
r_goto
id|out_irq
suffix:semicolon
)brace
id|this_port
(braket
id|pias
op_increment
)braket
op_assign
id|p
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Multiface III port using irq&bslash;n&quot;
comma
id|p-&gt;name
)paren
suffix:semicolon
multiline_comment|/* XXX: set operating mode */
id|parport_proc_register
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;private_data
op_assign
(paren
r_void
op_star
)paren
id|piabase
suffix:semicolon
id|parport_announce_port
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pias
op_ge
id|MAX_MFC
)paren
r_break
suffix:semicolon
r_continue
suffix:semicolon
id|out_irq
suffix:colon
id|parport_unregister_port
c_func
(paren
id|p
)paren
suffix:semicolon
id|out_port
suffix:colon
id|release_mem_region
c_func
(paren
id|piabase
comma
r_sizeof
(paren
r_struct
id|pia
)paren
)paren
suffix:semicolon
)brace
r_return
id|pias
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|parport_mfc3_exit
r_void
id|__exit
id|parport_mfc3_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_MFC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|this_port
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|this_port
(braket
id|i
)braket
op_member_access_from_pointer
id|irq
op_ne
id|PARPORT_IRQ_NONE
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|use_cnt
op_eq
l_int|0
)paren
id|free_irq
c_func
(paren
id|IRQ_AMIGA_PORTS
comma
op_amp
id|pp_mfc3_ops
)paren
suffix:semicolon
)brace
id|parport_proc_unregister
c_func
(paren
id|this_port
(braket
id|i
)braket
)paren
suffix:semicolon
id|parport_unregister_port
c_func
(paren
id|this_port
(braket
id|i
)braket
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ZTWO_PADDR
c_func
(paren
id|this_port
(braket
id|i
)braket
op_member_access_from_pointer
id|private_data
)paren
comma
r_sizeof
(paren
r_struct
id|pia
)paren
)paren
suffix:semicolon
)brace
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Joerg Dorchain &lt;joerg@dorchain.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Parport Driver for Multiface 3 expansion cards Paralllel Port&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;Multiface 3 Parallel Port&quot;
)paren
suffix:semicolon
id|module_init
c_func
(paren
id|parport_mfc3_init
)paren
id|module_exit
c_func
(paren
id|parport_mfc3_exit
)paren
eof
