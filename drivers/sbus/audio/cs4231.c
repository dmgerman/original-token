multiline_comment|/* $Id: cs4231.c,v 1.43 2000/02/18 13:49:39 davem Exp $&n; * drivers/sbus/audio/cs4231.c&n; *&n; * Copyright 1996, 1997, 1998, 1999 Derrick J Brashear (shadow@andrew.cmu.edu)&n; * The 4231/ebus support was written by David Miller, who didn&squot;t bother&n; * crediting himself here, so I will.&n; *&n; * Based on the AMD7930 driver:&n; * Copyright 1996 Thomas K. Dyas (tdyas@noc.rutgers.edu)&n; *&n; * This is the lowlevel driver for the CS4231 audio chip found on some&n; * sun4m and sun4u machines.&n; * &n; * This was culled from the Crystal docs on the 4231a, and the addendum they&n; * faxed me on the 4231.&n; * The APC DMA controller support unfortunately is not documented. Thanks, Sun.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#if defined (LINUX_VERSION_CODE) &amp;&amp; LINUX_VERSION_CODE &gt; 0x200ff &amp;&amp; defined(CONFIG_PCI)
DECL|macro|EB4231_SUPPORT
mdefine_line|#define EB4231_SUPPORT
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#include &lt;asm/pbm.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/audioio.h&gt;
macro_line|#include &quot;cs4231.h&quot;
DECL|macro|__CS4231_DEBUG
macro_line|#undef __CS4231_DEBUG
DECL|macro|__CS4231_TRACE
macro_line|#undef __CS4231_TRACE
DECL|macro|__CS4231_ERROR
mdefine_line|#define __CS4231_ERROR
macro_line|#ifdef __CS4231_ERROR
DECL|macro|eprintk
mdefine_line|#define eprintk(x) printk x
macro_line|#else
DECL|macro|eprintk
mdefine_line|#define eprintk(x)
macro_line|#endif
macro_line|#ifdef __CS4231_TRACE
DECL|macro|tprintk
mdefine_line|#define tprintk(x) printk x
macro_line|#else
DECL|macro|tprintk
mdefine_line|#define tprintk(x)
macro_line|#endif
macro_line|#ifdef __CS4231_DEBUG
DECL|macro|dprintk
mdefine_line|#define dprintk(x) printk x
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(x)
macro_line|#endif
DECL|macro|MAX_DRIVERS
mdefine_line|#define MAX_DRIVERS 1
DECL|variable|drivers
r_static
r_struct
id|sparcaudio_driver
id|drivers
(braket
id|MAX_DRIVERS
)braket
suffix:semicolon
DECL|variable|num_drivers
r_static
r_int
id|num_drivers
suffix:semicolon
r_static
r_int
id|cs4231_record_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
suffix:semicolon
r_static
r_int
id|cs4231_play_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
suffix:semicolon
r_static
r_void
id|cs4231_ready
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_void
id|cs4231_playintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|cs4231_recintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_int
id|cs4231_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|cs4231_pollinput
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_int
id|cs4231_length_to_samplecount
c_func
(paren
r_struct
id|audio_prinfo
op_star
id|thisdir
comma
r_int
r_int
id|length
)paren
suffix:semicolon
r_static
r_void
id|cs4231_getsamplecount
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
r_int
id|length
comma
r_int
r_int
id|value
)paren
suffix:semicolon
macro_line|#ifdef EB4231_SUPPORT
r_static
r_void
id|eb4231_pollinput
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Serveral shorthands save typing... */
DECL|macro|CHIP_READY
mdefine_line|#define CHIP_READY() &bslash;&n;do { udelay(100); cs4231_ready(drv); udelay(1000); } while(0)
DECL|macro|WRITE_IAR
mdefine_line|#define WRITE_IAR(__VAL) &bslash;&n;&t;CS4231_WRITE8(cs4231_chip, cs4231_chip-&gt;regs + IAR, __VAL)
DECL|macro|WRITE_IDR
mdefine_line|#define WRITE_IDR(__VAL) &bslash;&n;&t;CS4231_WRITE8(cs4231_chip, cs4231_chip-&gt;regs + IDR, __VAL)
DECL|macro|READ_IAR
mdefine_line|#define READ_IAR() &bslash;&n;&t;CS4231_READ8(cs4231_chip, cs4231_chip-&gt;regs + IAR)
DECL|macro|READ_IDR
mdefine_line|#define READ_IDR() &bslash;&n;&t;CS4231_READ8(cs4231_chip, cs4231_chip-&gt;regs + IDR)
multiline_comment|/* Enable cs4231 interrupts atomically. */
DECL|function|cs4231_enable_interrupts
r_static
r_void
id|cs4231_enable_interrupts
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;enabling interrupts&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_INTS_ON
)paren
op_eq
l_int|0
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0xa
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|INTR_ON
)paren
suffix:semicolon
id|cs4231_chip-&gt;status
op_or_assign
id|CS_STATUS_INTS_ON
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable cs4231 interrupts atomically. */
DECL|function|cs4231_disable_interrupts
r_static
r_void
id|cs4231_disable_interrupts
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;disabling interrupts&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_INTS_ON
)paren
op_ne
l_int|0
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0xa
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|INTR_OFF
)paren
suffix:semicolon
id|cs4231_chip-&gt;status
op_and_assign
op_complement
id|CS_STATUS_INTS_ON
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cs4231_enable_play
r_static
r_void
id|cs4231_enable_play
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;enabling play&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x9
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|PEN_ENABLE
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cs4231_disable_play
r_static
r_void
id|cs4231_disable_play
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;disabling play&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x9
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
id|PEN_DISABLE
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cs4231_enable_rec
r_static
r_void
id|cs4231_enable_rec
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;enabling rec&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x9
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|CEN_ENABLE
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cs4231_disable_rec
r_static
r_void
id|cs4231_disable_rec
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;disabling rec&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x9
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
id|CEN_DISABLE
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|struct|cs4231_rates
r_static
r_struct
id|cs4231_rates
(brace
DECL|member|speed
DECL|member|bits
r_int
id|speed
comma
id|bits
suffix:semicolon
DECL|variable|cs4231_rate_table
)brace
id|cs4231_rate_table
(braket
)braket
op_assign
(brace
(brace
l_int|5512
comma
id|CS4231_DFR_5512
)brace
comma
(brace
l_int|6615
comma
id|CS4231_DFR_6615
)brace
comma
(brace
l_int|8000
comma
id|CS4231_DFR_8000
)brace
comma
(brace
l_int|9600
comma
id|CS4231_DFR_9600
)brace
comma
(brace
l_int|11025
comma
id|CS4231_DFR_11025
)brace
comma
(brace
l_int|16000
comma
id|CS4231_DFR_16000
)brace
comma
(brace
l_int|18900
comma
id|CS4231_DFR_18900
)brace
comma
(brace
l_int|22050
comma
id|CS4231_DFR_22050
)brace
comma
(brace
l_int|27429
comma
id|CS4231_DFR_27429
)brace
comma
(brace
l_int|32000
comma
id|CS4231_DFR_32000
)brace
comma
(brace
l_int|33075
comma
id|CS4231_DFR_33075
)brace
comma
(brace
l_int|37800
comma
id|CS4231_DFR_37800
)brace
comma
(brace
l_int|44100
comma
id|CS4231_DFR_44100
)brace
comma
(brace
l_int|48000
comma
id|CS4231_DFR_48000
)brace
)brace
suffix:semicolon
DECL|macro|NUM_RATES
mdefine_line|#define NUM_RATES&t;(sizeof(cs4231_rate_table) / sizeof(struct cs4231_rates))
DECL|function|cs4231_rate_to_bits
r_static
r_int
id|cs4231_rate_to_bits
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
op_star
id|value
)paren
(brace
r_struct
id|cs4231_rates
op_star
id|p
op_assign
op_amp
id|cs4231_rate_table
(braket
l_int|0
)braket
suffix:semicolon
r_int
id|i
comma
id|wanted
op_assign
op_star
id|value
suffix:semicolon
multiline_comment|/* We try to be nice and approximate what the user asks for. */
r_if
c_cond
(paren
id|wanted
OL
l_int|5512
)paren
id|wanted
op_assign
l_int|5512
suffix:semicolon
r_if
c_cond
(paren
id|wanted
OG
l_int|48000
)paren
id|wanted
op_assign
l_int|48000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RATES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
multiline_comment|/* Exact match? */
r_if
c_cond
(paren
id|wanted
op_eq
id|p-&gt;speed
)paren
r_break
suffix:semicolon
multiline_comment|/* If we&squot;re inbetween two entries, and neither is exact,&n;                 * pick the closest one.&n;                 */
r_if
c_cond
(paren
id|wanted
op_eq
id|p
(braket
l_int|1
)braket
dot
id|speed
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|wanted
OG
id|p-&gt;speed
op_logical_and
id|wanted
OL
id|p
(braket
l_int|1
)braket
dot
id|speed
)paren
(brace
r_int
id|diff1
comma
id|diff2
suffix:semicolon
id|diff1
op_assign
id|wanted
op_minus
id|p-&gt;speed
suffix:semicolon
id|diff2
op_assign
id|p
(braket
l_int|1
)braket
dot
id|speed
op_minus
id|wanted
suffix:semicolon
r_if
c_cond
(paren
id|diff2
OL
id|diff1
)paren
id|p
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
op_star
id|value
op_assign
id|p-&gt;speed
suffix:semicolon
r_return
id|p-&gt;bits
suffix:semicolon
)brace
DECL|function|cs4231_encoding_to_bits
r_static
r_int
id|cs4231_encoding_to_bits
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_int
id|set_bits
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
id|AUDIO_ENCODING_ULAW
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_ULAW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_ALAW
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_ALAW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_DVI
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_ADPCM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_LINEARLE
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_LINEARLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_LINEAR
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_LINEARBE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_LINEAR8
suffix:colon
id|set_bits
op_assign
id|CS4231_DFR_LINEAR8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|set_bits
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|set_bits
suffix:semicolon
)brace
DECL|function|cs4231_set_output_encoding
r_static
r_int
id|cs4231_set_output_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
comma
id|set_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;output encoding %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|set_bits
op_assign
id|cs4231_encoding_to_bits
c_func
(paren
id|drv
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bits
op_ge
l_int|0
)paren
(brace
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x8
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CHANGE_ENCODING
c_func
(paren
id|tmp_bits
comma
id|set_bits
)paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.encoding
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;output enc failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs4231_get_output_encoding
r_static
r_int
id|cs4231_get_output_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.encoding
suffix:semicolon
)brace
DECL|function|cs4231_set_input_encoding
r_static
r_int
id|cs4231_set_input_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
comma
id|set_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;input encoding %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|set_bits
op_assign
id|cs4231_encoding_to_bits
c_func
(paren
id|drv
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bits
op_ge
l_int|0
)paren
(brace
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x1c
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CHANGE_ENCODING
c_func
(paren
id|tmp_bits
comma
id|set_bits
)paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.encoding
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;input enc failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs4231_get_input_encoding
r_static
r_int
id|cs4231_get_input_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.encoding
suffix:semicolon
)brace
DECL|function|cs4231_set_output_rate
r_static
r_int
id|cs4231_set_output_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
comma
id|set_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;output rate %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|set_bits
op_assign
id|cs4231_rate_to_bits
c_func
(paren
id|drv
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bits
op_ge
l_int|0
)paren
(brace
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x8
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CHANGE_DFR
c_func
(paren
id|tmp_bits
comma
id|set_bits
)paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.sample_rate
op_assign
id|value
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;tmp_bits[%02x] set_bits[%02x] CHANGE_DFR[%02x]&bslash;n&quot;
comma
id|tmp_bits
comma
id|set_bits
comma
id|CHANGE_DFR
c_func
(paren
id|tmp_bits
comma
id|set_bits
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;output rate failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs4231_get_output_rate
r_static
r_int
id|cs4231_get_output_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.sample_rate
suffix:semicolon
)brace
DECL|function|cs4231_set_input_rate
r_static
r_int
id|cs4231_set_input_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
comma
id|set_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;input rate %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|set_bits
op_assign
id|cs4231_rate_to_bits
c_func
(paren
id|drv
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bits
op_ge
l_int|0
)paren
(brace
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x1c
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CHANGE_DFR
c_func
(paren
id|tmp_bits
comma
id|set_bits
)paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.sample_rate
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;input rate failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs4231_get_input_rate
r_static
r_int
id|cs4231_get_input_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.sample_rate
suffix:semicolon
)brace
multiline_comment|/* Generically we support 4 channels. This hardware does 2 */
DECL|function|cs4231_set_input_channels
r_static
r_int
id|cs4231_set_input_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;input channels %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x1c
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
l_int|1
suffix:colon
id|WRITE_IDR
c_func
(paren
id|CS4231_MONO_ON
c_func
(paren
id|tmp_bits
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|WRITE_IDR
c_func
(paren
id|CS4231_STEREO_ON
c_func
(paren
id|tmp_bits
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dprintk
c_func
(paren
(paren
l_string|&quot;input chan failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.channels
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_input_channels
r_static
r_int
id|cs4231_get_input_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.channels
suffix:semicolon
)brace
multiline_comment|/* Generically we support 4 channels. This hardware does 2 */
DECL|function|cs4231_set_output_channels
r_static
r_int
id|cs4231_set_output_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp_bits
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;output channels %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x8
)paren
suffix:semicolon
id|tmp_bits
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
l_int|1
suffix:colon
id|WRITE_IDR
c_func
(paren
id|CS4231_MONO_ON
c_func
(paren
id|tmp_bits
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|WRITE_IDR
c_func
(paren
id|CS4231_STEREO_ON
c_func
(paren
id|tmp_bits
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dprintk
c_func
(paren
(paren
l_string|&quot;output chan failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.channels
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_output_channels
r_static
r_int
id|cs4231_get_output_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.channels
suffix:semicolon
)brace
DECL|function|cs4231_get_input_precision
r_static
r_int
id|cs4231_get_input_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.precision
suffix:semicolon
)brace
DECL|function|cs4231_get_output_precision
r_static
r_int
id|cs4231_get_output_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.precision
suffix:semicolon
)brace
DECL|function|cs4231_set_input_precision
r_static
r_int
id|cs4231_set_input_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|val
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.precision
op_assign
id|val
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.precision
suffix:semicolon
)brace
DECL|function|cs4231_set_output_precision
r_static
r_int
id|cs4231_set_output_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|val
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.precision
op_assign
id|val
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.precision
suffix:semicolon
)brace
multiline_comment|/* Wait until the auto calibration process has finished */
DECL|function|cs4231_ready
r_static
r_void
id|cs4231_ready
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_END
)paren
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|READ_IDR
c_func
(paren
)paren
op_ne
id|IAR_NOT_READY
)paren
r_break
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|x
op_le
id|CS_TIMEOUT
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0b
)paren
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|READ_IDR
c_func
(paren
)paren
op_ne
id|AUTOCAL_IN_PROGRESS
)paren
r_break
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|x
op_le
id|CS_TIMEOUT
)paren
suffix:semicolon
)brace
multiline_comment|/* Set output mute */
DECL|function|cs4231_output_muted
r_static
r_int
id|cs4231_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;in cs4231_output_muted: %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
id|OUTCR_UNMUTE
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x6
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
id|OUTCR_UNMUTE
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.output_muted
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|OUTCR_MUTE
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x6
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|OUTCR_MUTE
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.output_muted
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_output_muted
r_static
r_int
id|cs4231_get_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.output_muted
suffix:semicolon
)brace
DECL|function|cs4231_get_formats
r_static
r_int
id|cs4231_get_formats
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
(paren
id|AFMT_MU_LAW
op_or
id|AFMT_A_LAW
op_or
id|AFMT_U8
op_or
id|AFMT_IMA_ADPCM
op_or
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
)paren
suffix:semicolon
)brace
DECL|function|cs4231_get_output_ports
r_static
r_int
id|cs4231_get_output_ports
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
(paren
id|AUDIO_LINE_OUT
op_or
id|AUDIO_SPEAKER
op_or
id|AUDIO_HEADPHONE
)paren
suffix:semicolon
)brace
DECL|function|cs4231_get_input_ports
r_static
r_int
id|cs4231_get_input_ports
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
multiline_comment|/* This apparently applies only to APC ultras, not ebus ultras */
r_if
c_cond
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_ULTRA
)paren
r_return
(paren
id|AUDIO_LINE_IN
op_or
id|AUDIO_MICROPHONE
op_or
id|AUDIO_ANALOG_LOOPBACK
)paren
suffix:semicolon
r_else
r_return
(paren
id|AUDIO_INTERNAL_CD_IN
op_or
id|AUDIO_LINE_IN
op_or
id|AUDIO_MICROPHONE
op_or
id|AUDIO_ANALOG_LOOPBACK
)paren
suffix:semicolon
)brace
multiline_comment|/* Set chip &quot;output&quot; port */
DECL|function|cs4231_set_output_port
r_static
r_int
id|cs4231_set_output_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;output port: %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* Aaaaaah! It&squot;s all coming so fast! Turn it all off, then selectively&n;         * enable things.&n;         */
id|WRITE_IAR
c_func
(paren
l_int|0x1a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|MONO_IOCR_MUTE
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|PINCR_LINE_MUTE
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_or
id|PINCR_HDPH_MUTE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_SPEAKER
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x1a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
op_complement
id|MONO_IOCR_MUTE
)paren
suffix:semicolon
id|retval
op_or_assign
id|AUDIO_SPEAKER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_HEADPHONE
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x0a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
op_complement
id|PINCR_HDPH_MUTE
)paren
suffix:semicolon
id|retval
op_or_assign
id|AUDIO_HEADPHONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_LINE_OUT
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x0a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
op_complement
id|PINCR_LINE_MUTE
)paren
suffix:semicolon
id|retval
op_or_assign
id|AUDIO_LINE_OUT
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.play.port
op_assign
id|retval
suffix:semicolon
r_return
(paren
id|retval
)paren
suffix:semicolon
)brace
DECL|function|cs4231_get_output_port
r_static
r_int
id|cs4231_get_output_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.port
suffix:semicolon
)brace
multiline_comment|/* Set chip &quot;input&quot; port */
DECL|function|cs4231_set_input_port
r_static
r_int
id|cs4231_set_input_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;input port: %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* You can have one and only one. This is probably wrong, but&n;         * appears to be how SunOS is doing it. Should be able to mix.&n;         * More work to be done. CD input mixable, analog loopback may be.&n;         */
multiline_comment|/* Ultra systems do not support AUDIO_INTERNAL_CD_IN */
multiline_comment|/* This apparently applies only to APC ultras, not ebus ultras */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_ULTRA
)paren
)paren
(brace
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_INTERNAL_CD_IN
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CDROM_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|CDROM_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|retval
op_assign
id|AUDIO_INTERNAL_CD_IN
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|value
op_amp
id|AUDIO_LINE_IN
)paren
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|LINE_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|LINE_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|retval
op_assign
id|AUDIO_LINE_IN
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_MICROPHONE
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|MIC_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|MIC_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|retval
op_assign
id|AUDIO_MICROPHONE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_amp
id|AUDIO_ANALOG_LOOPBACK
)paren
(brace
id|WRITE_IAR
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|OUTPUTLOOP_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|OUTPUTLOOP_ENABLE
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|retval
op_assign
id|AUDIO_ANALOG_LOOPBACK
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.record.port
op_assign
id|retval
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|cs4231_get_input_port
r_static
r_int
id|cs4231_get_input_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.record.port
suffix:semicolon
)brace
multiline_comment|/* Set chip &quot;monitor&quot; gain */
DECL|function|cs4231_set_monitor_volume
r_static
r_int
id|cs4231_set_monitor_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|a
op_assign
l_int|0
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;monitor gain: %d&bslash;n&quot;
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* This interpolation really sucks. The question is, be compatible &n;         * with ScumOS/Sloaris or not?&n;         */
id|a
op_assign
id|CS4231_MON_MAX_ATEN
op_minus
(paren
id|value
op_star
(paren
id|CS4231_MON_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ge
id|CS4231_MON_MAX_ATEN
)paren
id|WRITE_IDR
c_func
(paren
id|LOOPB_OFF
)paren
suffix:semicolon
r_else
id|WRITE_IDR
c_func
(paren
(paren
id|a
op_lshift
l_int|2
)paren
op_or
id|LOOPB_ON
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_eq
id|AUDIO_MAX_GAIN
)paren
id|cs4231_chip-&gt;perchip_info.monitor_gain
op_assign
id|AUDIO_MAX_GAIN
suffix:semicolon
r_else
id|cs4231_chip-&gt;perchip_info.monitor_gain
op_assign
(paren
(paren
id|CS4231_MAX_DEV_ATEN
op_minus
id|a
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|CS4231_MAX_DEV_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_monitor_volume
r_static
r_int
id|cs4231_get_monitor_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.monitor_gain
suffix:semicolon
)brace
DECL|function|cs4231_get_output_error
r_static
r_int
id|cs4231_get_output_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.play.error
suffix:semicolon
)brace
DECL|function|cs4231_get_input_error
r_static
r_int
id|cs4231_get_input_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.record.error
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_get_output_samples
r_static
r_int
id|eb4231_get_output_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dbcr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
r_int
id|count
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
id|cs4231_chip-&gt;perchip_info.play
comma
id|dbcr
)paren
suffix:semicolon
r_return
(paren
id|cs4231_chip-&gt;perchip_info.play.samples
op_minus
(paren
(paren
id|count
OG
id|cs4231_chip-&gt;perchip_info.play.samples
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
)paren
suffix:semicolon
)brace
DECL|function|eb4231_get_input_samples
r_static
r_int
id|eb4231_get_input_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dbcr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
r_int
id|count
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
id|cs4231_chip-&gt;perchip_info.record
comma
id|dbcr
)paren
suffix:semicolon
r_return
(paren
id|cs4231_chip-&gt;perchip_info.record.samples
op_minus
(paren
(paren
id|count
OG
id|cs4231_chip-&gt;perchip_info.record.samples
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_get_output_samples
r_static
r_int
id|cs4231_get_output_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dmapc
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCPC
)paren
suffix:semicolon
r_int
id|count
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
id|cs4231_chip-&gt;perchip_info.play
comma
id|dmapc
)paren
suffix:semicolon
r_return
(paren
id|cs4231_chip-&gt;perchip_info.play.samples
op_minus
(paren
(paren
id|count
OG
id|cs4231_chip-&gt;perchip_info.play.samples
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
)paren
suffix:semicolon
)brace
DECL|function|cs4231_get_input_samples
r_static
r_int
id|cs4231_get_input_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dmacc
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCC
)paren
suffix:semicolon
r_int
id|count
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
id|cs4231_chip-&gt;perchip_info.record
comma
id|dmacc
)paren
suffix:semicolon
r_return
(paren
id|cs4231_chip-&gt;perchip_info.record.samples
op_minus
(paren
(paren
id|count
OG
id|cs4231_chip-&gt;perchip_info.record.samples
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
)paren
suffix:semicolon
)brace
DECL|function|cs4231_get_output_pause
r_static
r_int
id|cs4231_get_output_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.play.pause
suffix:semicolon
)brace
DECL|function|cs4231_get_input_pause
r_static
r_int
id|cs4231_get_input_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.record.pause
suffix:semicolon
)brace
multiline_comment|/* But for play/record we have these cheesy jacket routines because of &n; * how this crap gets set.&n; */
DECL|function|cs4231_set_input_volume
r_static
r_int
id|cs4231_set_input_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_record_gain
c_func
(paren
id|drv
comma
id|value
comma
id|cs4231_chip-&gt;perchip_info.record.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_input_volume
r_static
r_int
id|cs4231_get_input_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.record.gain
suffix:semicolon
)brace
DECL|function|cs4231_set_output_volume
r_static
r_int
id|cs4231_set_output_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_play_gain
c_func
(paren
id|drv
comma
id|value
comma
id|cs4231_chip-&gt;perchip_info.play.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_output_volume
r_static
r_int
id|cs4231_get_output_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|cs4231_chip-&gt;perchip_info.play.gain
suffix:semicolon
)brace
multiline_comment|/* Likewise for balance */
DECL|function|cs4231_set_input_balance
r_static
r_int
id|cs4231_set_input_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.balance
op_assign
id|value
suffix:semicolon
id|cs4231_record_gain
c_func
(paren
id|drv
comma
id|cs4231_chip-&gt;perchip_info.record.gain
comma
id|cs4231_chip-&gt;perchip_info.record.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_input_balance
r_static
r_int
id|cs4231_get_input_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.record.balance
suffix:semicolon
)brace
DECL|function|cs4231_set_output_balance
r_static
r_int
id|cs4231_set_output_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.balance
op_assign
id|value
suffix:semicolon
id|cs4231_play_gain
c_func
(paren
id|drv
comma
id|cs4231_chip-&gt;perchip_info.play.gain
comma
id|cs4231_chip-&gt;perchip_info.play.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_get_output_balance
r_static
r_int
id|cs4231_get_output_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|cs4231_chip-&gt;perchip_info.play.balance
suffix:semicolon
)brace
multiline_comment|/* Set chip record gain */
DECL|function|cs4231_record_gain
r_static
r_int
id|cs4231_record_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
comma
id|r
comma
id|l
comma
id|r_adj
comma
id|l_adj
suffix:semicolon
r_int
r_char
id|old_gain
suffix:semicolon
id|r
op_assign
id|l
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|balance
OL
id|AUDIO_MID_BALANCE
)paren
(brace
id|r
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|AUDIO_MID_BALANCE
op_minus
id|balance
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
)paren
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|balance
OG
id|AUDIO_MID_BALANCE
)paren
(brace
id|l
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|balance
op_minus
id|AUDIO_MID_BALANCE
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|0
)paren
id|l
op_assign
l_int|0
suffix:semicolon
)brace
id|l_adj
op_assign
id|l
op_star
(paren
id|CS4231_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
suffix:semicolon
id|r_adj
op_assign
id|r
op_star
(paren
id|CS4231_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|old_gain
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|RECGAIN_SET
c_func
(paren
id|old_gain
comma
id|l_adj
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
id|old_gain
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|RECGAIN_SET
c_func
(paren
id|old_gain
comma
id|r_adj
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
op_eq
id|value
)paren
(brace
(paren
id|l
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|tmp
op_assign
l_int|0
)paren
suffix:colon
(paren
id|tmp
op_assign
(paren
(paren
id|l_adj
op_plus
l_int|1
)paren
op_star
id|AUDIO_MAX_GAIN
)paren
op_div
(paren
id|CS4231_MAX_GAIN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|r
op_eq
id|value
)paren
(brace
(paren
id|r
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|tmp
op_assign
l_int|0
)paren
suffix:colon
(paren
id|tmp
op_assign
(paren
(paren
id|r_adj
op_plus
l_int|1
)paren
op_star
id|AUDIO_MAX_GAIN
)paren
op_div
(paren
id|CS4231_MAX_GAIN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.record.gain
op_assign
id|tmp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set chip play gain */
DECL|function|cs4231_play_gain
r_static
r_int
id|cs4231_play_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
comma
id|r
comma
id|l
comma
id|r_adj
comma
id|l_adj
suffix:semicolon
r_int
r_char
id|old_gain
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;in play_gain: %d %c&bslash;n&quot;
comma
id|value
comma
id|balance
)paren
)paren
suffix:semicolon
id|r
op_assign
id|l
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|balance
OL
id|AUDIO_MID_BALANCE
)paren
(brace
id|r
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|AUDIO_MID_BALANCE
op_minus
id|balance
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
)paren
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|balance
OG
id|AUDIO_MID_BALANCE
)paren
(brace
id|l
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|balance
op_minus
id|AUDIO_MID_BALANCE
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|0
)paren
id|l
op_assign
l_int|0
suffix:semicolon
)brace
(paren
id|l
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|l_adj
op_assign
id|CS4231_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|l_adj
op_assign
id|CS4231_MAX_ATEN
op_minus
(paren
id|l
op_star
(paren
id|CS4231_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
(paren
id|r
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|r_adj
op_assign
id|CS4231_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|r_adj
op_assign
id|CS4231_MAX_ATEN
op_minus
(paren
id|r
op_star
(paren
id|CS4231_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x6
)paren
suffix:semicolon
id|old_gain
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|GAIN_SET
c_func
(paren
id|old_gain
comma
id|l_adj
)paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|old_gain
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|GAIN_SET
c_func
(paren
id|old_gain
comma
id|r_adj
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_eq
l_int|0
)paren
op_logical_or
(paren
id|value
op_eq
id|AUDIO_MAX_GAIN
)paren
)paren
(brace
id|tmp
op_assign
id|value
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|value
op_eq
id|l
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|CS4231_MAX_ATEN
op_minus
id|l_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|CS4231_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_eq
id|r
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|CS4231_MAX_ATEN
op_minus
id|r_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|CS4231_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
id|cs4231_chip-&gt;perchip_info.play.gain
op_assign
id|tmp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Reset the audio chip to a sane state. */
DECL|function|cs4231_chip_reset
r_static
r_void
id|cs4231_chip_reset
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_char
id|vers
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;in cs4231_chip_reset&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_EBUS
)paren
(brace
macro_line|#ifdef EB4231_SUPPORT
id|writel
c_func
(paren
id|EBUS_DCSR_RESET
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_RESET
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|u32
id|tmp
suffix:semicolon
id|sbus_writel
c_func
(paren
id|APC_CHIP_RESET
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|tmp
op_or_assign
id|APC_CDC_RESET
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|APC_CDC_RESET
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
)brace
id|WRITE_IAR
c_func
(paren
id|READ_IAR
c_func
(paren
)paren
op_or
id|IAR_AUTOCAL_BEGIN
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x0c
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|MISC_IR_MODE2
)paren
suffix:semicolon
multiline_comment|/* This is the equivalent of DEFAULT_DATA_FMAT */
id|cs4231_set_input_encoding
c_func
(paren
id|drv
comma
id|AUDIO_ENCODING_ULAW
)paren
suffix:semicolon
id|cs4231_set_input_rate
c_func
(paren
id|drv
comma
id|CS4231_RATE
)paren
suffix:semicolon
id|cs4231_set_input_channels
c_func
(paren
id|drv
comma
id|CS4231_CHANNELS
)paren
suffix:semicolon
id|cs4231_set_input_precision
c_func
(paren
id|drv
comma
id|CS4231_PRECISION
)paren
suffix:semicolon
id|cs4231_set_output_encoding
c_func
(paren
id|drv
comma
id|AUDIO_ENCODING_ULAW
)paren
suffix:semicolon
id|cs4231_set_output_rate
c_func
(paren
id|drv
comma
id|CS4231_RATE
)paren
suffix:semicolon
id|cs4231_set_output_channels
c_func
(paren
id|drv
comma
id|CS4231_CHANNELS
)paren
suffix:semicolon
id|cs4231_set_output_precision
c_func
(paren
id|drv
comma
id|CS4231_PRECISION
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x19
)paren
suffix:semicolon
multiline_comment|/* see what we can turn on */
id|vers
op_assign
id|READ_IDR
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vers
op_amp
id|CS4231A
)paren
(brace
id|tprintk
c_func
(paren
(paren
l_string|&quot;This is a CS4231A&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;status
op_or_assign
id|CS_STATUS_REV_A
suffix:semicolon
)brace
r_else
(brace
id|cs4231_chip-&gt;status
op_and_assign
op_complement
id|CS_STATUS_REV_A
suffix:semicolon
)brace
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x10
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|OLB_ENABLE
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x11
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_REV_A
)paren
id|WRITE_IDR
c_func
(paren
id|HPF_ON
op_or
id|XTALE_ON
)paren
suffix:semicolon
r_else
id|WRITE_IDR
c_func
(paren
id|HPF_ON
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x1a
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Now set things up for defaults */
id|cs4231_set_input_balance
c_func
(paren
id|drv
comma
id|AUDIO_MID_BALANCE
)paren
suffix:semicolon
id|cs4231_set_output_balance
c_func
(paren
id|drv
comma
id|AUDIO_MID_BALANCE
)paren
suffix:semicolon
id|cs4231_set_input_volume
c_func
(paren
id|drv
comma
id|CS4231_DEFAULT_RECGAIN
)paren
suffix:semicolon
id|cs4231_set_output_volume
c_func
(paren
id|drv
comma
id|CS4231_DEFAULT_PLAYGAIN
)paren
suffix:semicolon
id|cs4231_set_input_port
c_func
(paren
id|drv
comma
id|AUDIO_MICROPHONE
)paren
suffix:semicolon
id|cs4231_set_output_port
c_func
(paren
id|drv
comma
id|AUDIO_SPEAKER
)paren
suffix:semicolon
id|cs4231_set_monitor_volume
c_func
(paren
id|drv
comma
id|LOOPB_OFF
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_END
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_BEGIN
op_or
l_int|0x09
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|READ_IDR
c_func
(paren
)paren
op_amp
id|ACAL_DISABLE
)paren
suffix:semicolon
id|WRITE_IAR
c_func
(paren
id|IAR_AUTOCAL_END
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_output_muted
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|cs4231_length_to_samplecount
id|cs4231_length_to_samplecount
c_func
(paren
r_struct
id|audio_prinfo
op_star
id|thisdir
comma
r_int
r_int
id|length
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
id|thisdir-&gt;channels
op_eq
l_int|2
)paren
id|count
op_assign
(paren
id|length
op_div
l_int|2
)paren
suffix:semicolon
r_else
id|count
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|thisdir-&gt;encoding
op_eq
id|AUDIO_ENCODING_LINEAR
)paren
id|count
op_assign
(paren
id|count
op_div
l_int|2
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|thisdir-&gt;encoding
op_eq
id|AUDIO_ENCODING_DVI
)paren
id|count
op_assign
(paren
id|count
op_div
l_int|4
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_getsamplecount
r_static
r_void
id|eb4231_getsamplecount
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
r_int
id|length
comma
r_int
r_int
id|direction
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|audio_prinfo
op_star
id|thisdir
suffix:semicolon
r_int
r_int
id|count
comma
id|curcount
comma
id|nextcount
comma
id|dbcr
suffix:semicolon
r_if
c_cond
(paren
id|direction
op_eq
l_int|1
)paren
(brace
id|thisdir
op_assign
op_amp
id|cs4231_chip-&gt;perchip_info.record
suffix:semicolon
id|dbcr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
id|nextcount
op_assign
id|cs4231_chip-&gt;input_next_dma_size
suffix:semicolon
)brace
r_else
(brace
id|thisdir
op_assign
op_amp
id|cs4231_chip-&gt;perchip_info.play
suffix:semicolon
id|dbcr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
id|nextcount
op_assign
id|cs4231_chip-&gt;output_next_dma_size
suffix:semicolon
)brace
id|curcount
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|dbcr
)paren
suffix:semicolon
id|count
op_assign
id|thisdir-&gt;samples
suffix:semicolon
id|length
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|length
)paren
suffix:semicolon
multiline_comment|/* normalize for where we are. */
id|thisdir-&gt;samples
op_assign
(paren
(paren
id|count
op_minus
id|nextcount
)paren
op_plus
(paren
id|length
op_minus
id|curcount
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_getsamplecount
r_static
r_void
id|cs4231_getsamplecount
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
r_int
id|length
comma
r_int
r_int
id|direction
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|audio_prinfo
op_star
id|thisdir
suffix:semicolon
r_int
r_int
id|count
comma
id|nextcount
comma
id|curcount
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|direction
op_eq
l_int|1
)paren
(brace
multiline_comment|/* record */
id|thisdir
op_assign
op_amp
id|cs4231_chip-&gt;perchip_info.record
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCC
)paren
suffix:semicolon
id|curcount
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCNC
)paren
suffix:semicolon
id|nextcount
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|tmp
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* play */
id|thisdir
op_assign
op_amp
id|cs4231_chip-&gt;perchip_info.play
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCPC
)paren
suffix:semicolon
id|curcount
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCPNC
)paren
suffix:semicolon
id|nextcount
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|tmp
)paren
suffix:semicolon
)brace
id|count
op_assign
id|thisdir-&gt;samples
suffix:semicolon
id|length
op_assign
id|cs4231_length_to_samplecount
c_func
(paren
id|thisdir
comma
id|length
)paren
suffix:semicolon
multiline_comment|/* normalize for where we are. */
id|thisdir-&gt;samples
op_assign
(paren
(paren
id|count
op_minus
id|nextcount
)paren
op_plus
(paren
id|length
op_minus
id|curcount
)paren
)paren
suffix:semicolon
)brace
DECL|function|cs4231_open
r_static
r_int
id|cs4231_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
multiline_comment|/* Set the default audio parameters if not already in use. */
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|drv-&gt;flags
op_amp
id|SDF_OPEN_WRITE
)paren
op_logical_and
(paren
id|cs4231_chip-&gt;perchip_info.play.active
op_eq
l_int|0
)paren
)paren
(brace
id|cs4231_chip-&gt;perchip_info.play.open
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.samples
op_assign
id|cs4231_chip-&gt;perchip_info.play.error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|drv-&gt;flags
op_amp
id|SDF_OPEN_READ
)paren
op_logical_and
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_eq
l_int|0
)paren
)paren
(brace
id|cs4231_chip-&gt;perchip_info.record.open
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.samples
op_assign
id|cs4231_chip-&gt;perchip_info.record.error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|CHIP_READY
c_func
(paren
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_release
r_static
r_void
id|cs4231_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_void
(paren
op_star
id|dma_unmap_single
)paren
(paren
r_struct
id|sbus_dev
op_star
comma
id|dma_addr_t
comma
r_int
comma
r_int
)paren
op_assign
id|sbus_unmap_single
suffix:semicolon
macro_line|#ifdef EB4231_SUPPORT
r_if
c_cond
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_EBUS
)paren
id|dma_unmap_single
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_struct
id|sbus_dev
op_star
comma
id|dma_addr_t
comma
r_int
comma
r_int
)paren
)paren
id|pci_unmap_single
suffix:semicolon
macro_line|#endif
multiline_comment|/* zero out any info about what data we have as well */
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
multiline_comment|/* stop capture here or midlevel? */
id|cs4231_chip-&gt;perchip_info.record.open
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_dma_handle
)paren
(brace
id|dma_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_dma_handle
comma
id|cs4231_chip-&gt;input_dma_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_next_dma_handle
)paren
(brace
id|dma_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_next_dma_handle
comma
id|cs4231_chip-&gt;input_next_dma_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
id|cs4231_chip-&gt;perchip_info.play.open
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_dma_handle
)paren
(brace
id|dma_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_dma_handle
comma
id|cs4231_chip-&gt;output_dma_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|dma_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;output_next_dma_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|cs4231_chip-&gt;perchip_info.play.open
op_logical_and
op_logical_neg
id|cs4231_chip-&gt;perchip_info.record.open
op_logical_and
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_INIT_ON_CLOSE
)paren
)paren
(brace
id|cs4231_chip_reset
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;status
op_and_assign
op_complement
id|CS_STATUS_INIT_ON_CLOSE
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|cs4231_playintr
r_static
r_void
id|cs4231_playintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|push
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|push
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cs4231_chip-&gt;perchip_info.play.active
)paren
(brace
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNVA
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_size
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNC
)paren
suffix:semicolon
)brace
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;playlen
op_eq
l_int|0
op_logical_and
id|cs4231_chip-&gt;output_size
OG
l_int|0
)paren
id|cs4231_chip-&gt;playlen
op_assign
id|cs4231_chip-&gt;output_size
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_dma_handle
comma
id|cs4231_chip-&gt;output_dma_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_decrement
suffix:semicolon
id|status
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|cs4231_chip-&gt;output_dma_handle
op_assign
id|cs4231_chip-&gt;output_next_dma_handle
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
id|cs4231_chip-&gt;output_next_dma_size
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;output_ptr
op_logical_and
id|cs4231_chip-&gt;output_size
OG
l_int|0
)paren
op_logical_and
op_logical_neg
(paren
id|cs4231_chip-&gt;perchip_info.play.pause
)paren
)paren
(brace
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
id|sbus_map_single
c_func
(paren
id|drv-&gt;dev
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;output_ptr
comma
id|cs4231_chip-&gt;output_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
id|cs4231_chip-&gt;output_size
suffix:semicolon
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNVA
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_size
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNC
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_increment
suffix:semicolon
id|status
op_add_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|sbus_writel
c_func
(paren
l_int|0
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNVA
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCPNC
)paren
suffix:semicolon
)brace
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
id|status
)paren
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_playintr
r_static
r_void
id|eb4231_playintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;playlen
op_eq
l_int|0
op_logical_and
id|cs4231_chip-&gt;output_size
OG
l_int|0
)paren
id|cs4231_chip-&gt;playlen
op_assign
id|cs4231_chip-&gt;output_size
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_dma_handle
comma
id|cs4231_chip-&gt;output_dma_size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_decrement
suffix:semicolon
id|status
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|cs4231_chip-&gt;output_dma_handle
op_assign
id|cs4231_chip-&gt;output_next_dma_handle
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
id|cs4231_chip-&gt;output_next_dma_size
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;output_ptr
op_logical_and
id|cs4231_chip-&gt;output_size
OG
l_int|0
)paren
op_logical_and
op_logical_neg
(paren
id|cs4231_chip-&gt;perchip_info.play.pause
)paren
)paren
(brace
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
id|pci_map_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;output_ptr
comma
id|cs4231_chip-&gt;output_size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
id|cs4231_chip-&gt;output_size
suffix:semicolon
id|writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_size
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_ADDR
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_increment
suffix:semicolon
id|status
op_add_assign
l_int|2
suffix:semicolon
)brace
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_recclear
r_static
r_void
id|cs4231_recclear
c_func
(paren
r_int
id|fmt
comma
r_char
op_star
id|dmabuf
comma
r_int
id|length
)paren
(brace
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
id|AUDIO_ENCODING_LINEAR
suffix:colon
id|memset
c_func
(paren
id|dmabuf
comma
l_int|0x00
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_ALAW
suffix:colon
id|memset
c_func
(paren
id|dmabuf
comma
l_int|0xd5
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_ENCODING_ULAW
suffix:colon
id|memset
c_func
(paren
id|dmabuf
comma
l_int|0xff
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|cs4231_recintr
r_static
r_int
id|cs4231_recintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;going inactive&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cs4231_pollinput
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_disable_rec
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_dma_handle
comma
id|cs4231_chip-&gt;input_dma_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_decrement
suffix:semicolon
id|status
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_next_dma_handle
)paren
(brace
id|cs4231_chip-&gt;input_dma_handle
op_assign
id|cs4231_chip-&gt;input_next_dma_handle
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
id|cs4231_chip-&gt;input_next_dma_size
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;input_ptr
op_logical_and
id|cs4231_chip-&gt;input_size
OG
l_int|0
)paren
op_logical_and
op_logical_neg
(paren
id|cs4231_chip-&gt;perchip_info.record.pause
)paren
)paren
(brace
id|cs4231_recclear
c_func
(paren
id|cs4231_chip-&gt;perchip_info.record.encoding
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;input_ptr
comma
id|cs4231_chip-&gt;input_size
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
id|sbus_map_single
c_func
(paren
id|drv-&gt;dev
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;input_ptr
comma
id|cs4231_chip-&gt;input_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
id|cs4231_chip-&gt;input_size
suffix:semicolon
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;input_next_dma_handle
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCNVA
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|cs4231_chip-&gt;input_next_dma_size
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCNC
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_increment
suffix:semicolon
id|status
op_add_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|sbus_writel
c_func
(paren
l_int|0
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCNVA
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCNC
)paren
suffix:semicolon
)brace
id|sparcaudio_input_done
c_func
(paren
id|drv
comma
id|status
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_recintr
r_static
r_int
id|eb4231_recintr
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
(paren
l_string|&quot;going inactive&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|eb4231_pollinput
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_disable_rec
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_dma_handle
comma
id|cs4231_chip-&gt;input_dma_size
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_decrement
suffix:semicolon
id|status
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_next_dma_handle
)paren
(brace
id|cs4231_chip-&gt;input_dma_handle
op_assign
id|cs4231_chip-&gt;input_next_dma_handle
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
id|cs4231_chip-&gt;input_next_dma_size
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cs4231_chip-&gt;input_ptr
op_logical_and
id|cs4231_chip-&gt;input_size
OG
l_int|0
)paren
op_logical_and
op_logical_neg
(paren
id|cs4231_chip-&gt;perchip_info.record.pause
)paren
)paren
(brace
id|cs4231_recclear
c_func
(paren
id|cs4231_chip-&gt;perchip_info.record.encoding
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;input_ptr
comma
id|cs4231_chip-&gt;input_size
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
id|pci_map_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
(paren
r_char
op_star
)paren
id|cs4231_chip-&gt;input_ptr
comma
id|cs4231_chip-&gt;input_size
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
id|cs4231_chip-&gt;input_size
suffix:semicolon
id|writel
c_func
(paren
id|cs4231_chip-&gt;input_next_dma_size
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_COUNT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|cs4231_chip-&gt;input_next_dma_handle
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_ADDR
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_increment
suffix:semicolon
id|status
op_add_assign
l_int|2
suffix:semicolon
)brace
id|sparcaudio_input_done
c_func
(paren
id|drv
comma
id|status
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_start_output
r_static
r_void
id|eb4231_start_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dcsr
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
id|buffer
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.play.active
op_logical_or
(paren
id|cs4231_chip-&gt;perchip_info.play.pause
)paren
)paren
r_return
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_assign
l_int|0
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dcsr
op_amp
id|EBUS_DCSR_EN_DMA
)paren
)paren
(brace
id|writel
c_func
(paren
id|EBUS_DCSR_RESET
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|eb4231_playintr
c_func
(paren
id|drv
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
op_or
(paren
id|EBUS_DCSR_EN_DMA
op_or
id|EBUS_DCSR_INT_EN
op_or
id|EBUS_DCSR_EN_CNT
op_or
id|EBUS_DCSR_EN_NEXT
)paren
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|cs4231_enable_play
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_else
(brace
id|eb4231_playintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|cs4231_start_output
r_static
r_void
id|cs4231_start_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|csr
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;in 4231 start output&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
id|buffer
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.play.active
op_logical_or
(paren
id|cs4231_chip-&gt;perchip_info.play.pause
)paren
)paren
r_return
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;playing_count
op_assign
l_int|0
suffix:semicolon
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|csr
op_amp
id|APC_PPAUSE
)paren
op_logical_or
op_logical_neg
(paren
id|csr
op_amp
id|APC_PDMA_READY
)paren
)paren
(brace
id|u32
id|pnva
suffix:semicolon
id|csr
op_and_assign
op_complement
id|APC_XINT_PLAY
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|csr
op_and_assign
op_complement
id|APC_PPAUSE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|pnva
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCPNVA
)paren
suffix:semicolon
id|cs4231_playintr
c_func
(paren
id|drv
comma
(paren
id|pnva
op_eq
l_int|0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|csr
op_or_assign
id|APC_PLAY_SETUP
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|cs4231_enable_play
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_stop_output
r_static
r_void
id|eb4231_stop_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dcsr
suffix:semicolon
id|dprintk
c_func
(paren
(paren
l_string|&quot;eb4231_stop_output: dcsr 0x%x dacr 0x%x dbcr %d&bslash;n&quot;
comma
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
comma
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_ADDR
)paren
comma
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_COUNT
)paren
)paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_dma_handle
comma
id|cs4231_chip-&gt;output_dma_size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;output_next_dma_size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
id|dcsr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dcsr
op_amp
id|EBUS_DCSR_EN_DMA
)paren
(brace
id|writel
c_func
(paren
id|dcsr
op_amp
op_complement
id|EBUS_DCSR_EN_DMA
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
)brace
multiline_comment|/* Else subsequent speed setting changes are ignored by the chip. */
id|cs4231_disable_play
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_stop_output
r_static
r_void
id|cs4231_stop_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|tprintk
c_func
(paren
(paren
l_string|&quot;in cs4231_stop_output&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_dma_handle
comma
id|cs4231_chip-&gt;output_dma_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;output_next_dma_handle
comma
id|cs4231_chip-&gt;output_next_dma_size
comma
id|SBUS_DMA_TODEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;output_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if 0 /* Not safe without shutting off the DMA controller as well. -DaveM */
multiline_comment|/* Else subsequent speed setting changes are ignored by the chip. */
id|cs4231_disable_play
c_func
(paren
id|drv
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_pollinput
r_static
r_void
id|eb4231_pollinput
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|x
suffix:semicolon
id|u32
id|dcsr
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|dcsr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dcsr
op_amp
id|EBUS_DCSR_TC
)paren
r_break
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|x
op_le
id|CS_TIMEOUT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
op_or
id|EBUS_DCSR_TC
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_pollinput
r_static
r_void
id|cs4231_pollinput
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|x
suffix:semicolon
id|u32
id|csr
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr
op_amp
id|APC_XINT_COVF
)paren
r_break
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|x
op_le
id|CS_TIMEOUT
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
op_or
id|APC_XINT_CEMP
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
)brace
DECL|function|cs4231_start_input
r_static
r_void
id|cs4231_start_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|csr
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
id|buffer
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_logical_or
(paren
id|cs4231_chip-&gt;perchip_info.record.pause
)paren
)paren
r_return
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_assign
l_int|0
suffix:semicolon
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|csr
op_amp
id|APC_CPAUSE
)paren
op_logical_or
op_logical_neg
(paren
id|csr
op_amp
id|APC_CDMA_READY
)paren
)paren
(brace
id|csr
op_and_assign
op_complement
id|APC_XINT_CAPT
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|csr
op_and_assign
op_complement
id|APC_CPAUSE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|cs4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
id|csr
op_or_assign
id|APC_CAPT_SETUP
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|cs4231_enable_rec
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_else
(brace
id|cs4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
DECL|function|cs4231_stop_input
r_static
r_void
id|cs4231_stop_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|csr
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|0
suffix:semicolon
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|csr
op_or_assign
id|APC_CPAUSE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_dma_handle
comma
id|cs4231_chip-&gt;input_dma_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_next_dma_handle
)paren
(brace
id|sbus_unmap_single
c_func
(paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_next_dma_handle
comma
id|cs4231_chip-&gt;input_next_dma_size
comma
id|SBUS_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
id|cs4231_pollinput
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
DECL|function|eb4231_start_input
r_static
r_void
id|eb4231_start_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dcsr
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
id|buffer
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_logical_or
(paren
id|cs4231_chip-&gt;perchip_info.record.pause
)paren
)paren
r_return
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|1
suffix:semicolon
id|cs4231_chip-&gt;recording_count
op_assign
l_int|0
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dcsr
op_amp
id|EBUS_DCSR_EN_DMA
)paren
)paren
(brace
id|writel
c_func
(paren
id|EBUS_DCSR_RESET
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|eb4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_BURST_SZ_16
op_or
(paren
id|EBUS_DCSR_EN_DMA
op_or
id|EBUS_DCSR_INT_EN
op_or
id|EBUS_DCSR_EN_CNT
op_or
id|EBUS_DCSR_EN_NEXT
)paren
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|cs4231_enable_rec
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_ready
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_else
(brace
id|eb4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
DECL|function|eb4231_stop_input
r_static
r_void
id|eb4231_stop_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dcsr
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_dma_handle
comma
id|cs4231_chip-&gt;input_dma_size
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;input_next_dma_handle
)paren
(brace
id|pci_unmap_single
c_func
(paren
(paren
r_struct
id|pci_dev
op_star
)paren
id|drv-&gt;dev
comma
id|cs4231_chip-&gt;input_next_dma_handle
comma
id|cs4231_chip-&gt;input_next_dma_size
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_handle
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;input_next_dma_size
op_assign
l_int|0
suffix:semicolon
)brace
id|dcsr
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dcsr
op_amp
id|EBUS_DCSR_EN_DMA
)paren
id|writel
c_func
(paren
id|dcsr
op_amp
op_complement
id|EBUS_DCSR_EN_DMA
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|cs4231_disable_rec
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_set_output_pause
r_static
r_int
id|cs4231_set_output_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.pause
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|cs4231_set_output_error
r_static
r_int
id|cs4231_set_output_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|cs4231_chip-&gt;perchip_info.play.error
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.error
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|cs4231_set_input_error
r_static
r_int
id|cs4231_set_input_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|cs4231_chip-&gt;perchip_info.record.error
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.error
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|cs4231_set_output_samples
r_static
r_int
id|cs4231_set_output_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|cs4231_chip-&gt;perchip_info.play.samples
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.samples
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|cs4231_set_input_samples
r_static
r_int
id|cs4231_set_input_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|cs4231_chip-&gt;perchip_info.record.samples
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.samples
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|cs4231_set_input_pause
r_static
r_int
id|cs4231_set_input_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.pause
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|value
)paren
id|cs4231_stop_input
c_func
(paren
id|drv
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|cs4231_audio_getdev
r_static
r_void
id|cs4231_audio_getdev
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|audio_device_t
op_star
id|audinfo
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|strncpy
c_func
(paren
id|audinfo-&gt;name
comma
l_string|&quot;SUNW,CS4231&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;name
)paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* versions */
multiline_comment|/* a: SPARCstation 4/5          b: Ultra 1/2 (electron)       */
multiline_comment|/* c: Ultra 1/2 PCI? (positron) d: ppc                        */
multiline_comment|/* e: x86                       f: Ultra Enterprise? (tazmo)  */
multiline_comment|/* g: Ultra 30? (quark)         h: Ultra 5/10? (darwin)       */
multiline_comment|/* apparently Ultra 1, Ultra 2 don&squot;t have internal CD input */
r_if
c_cond
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_ULTRA
)paren
id|strncpy
c_func
(paren
id|audinfo-&gt;version
comma
l_string|&quot;b&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;version
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_else
id|strncpy
c_func
(paren
id|audinfo-&gt;version
comma
l_string|&quot;a&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;version
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|audinfo-&gt;config
comma
l_string|&quot;onboard1&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;config
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|cs4231_audio_getdev_sunos
r_static
r_int
id|cs4231_audio_getdev_sunos
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
id|AUDIO_DEV_CS4231
suffix:semicolon
)brace
DECL|function|cs4231_loopback
r_static
r_void
id|cs4231_loopback
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
r_int
id|value
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|WRITE_IAR
c_func
(paren
l_int|0x0d
)paren
suffix:semicolon
id|WRITE_IDR
c_func
(paren
id|value
ques
c_cond
id|LOOPB_ON
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cs4231_ioctl
r_static
r_int
id|cs4231_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|AUDIO_DIAG_LOOPBACK
suffix:colon
id|cs4231_chip-&gt;status
op_or_assign
id|CS_STATUS_INIT_ON_CLOSE
suffix:semicolon
id|cs4231_loopback
c_func
(paren
id|drv
comma
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
multiline_comment|/* ebus audio capture interrupt handler. */
DECL|function|eb4231_cinterrupt
r_void
id|eb4231_cinterrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sparcaudio_driver
op_star
id|drv
op_assign
(paren
r_struct
id|sparcaudio_driver
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dummy
suffix:semicolon
multiline_comment|/* Clear the interrupt. */
id|dummy
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dummy
comma
id|cs4231_chip-&gt;eb2c
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dummy
op_amp
id|EBUS_DCSR_TC
)paren
op_ne
l_int|0
multiline_comment|/*&amp;&amp; (dummy &amp; EBUS_DCSR_A_LOADED) != 0*/
)paren
(brace
id|cs4231_chip-&gt;perchip_info.record.samples
op_add_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
(paren
id|cs4231_chip-&gt;perchip_info.record
)paren
comma
id|cs4231_chip-&gt;reclen
)paren
suffix:semicolon
id|eb4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dummy
op_amp
id|EBUS_DCSR_A_LOADED
)paren
op_eq
l_int|0
)paren
(brace
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|0
suffix:semicolon
id|eb4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
id|eb4231_getsamplecount
c_func
(paren
id|drv
comma
id|cs4231_chip-&gt;reclen
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ebus audio play interrupt handler. */
DECL|function|eb4231_pinterrupt
r_void
id|eb4231_pinterrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sparcaudio_driver
op_star
id|drv
op_assign
(paren
r_struct
id|sparcaudio_driver
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|u32
id|dummy
suffix:semicolon
multiline_comment|/* Clear the interrupt.  Bleh, when not using the next-address&n;         * feature, TC can only be cleared by a reset.&n;         */
id|dummy
op_assign
id|readl
c_func
(paren
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dummy
comma
id|cs4231_chip-&gt;eb2p
op_plus
id|EBDMA_CSR
)paren
suffix:semicolon
multiline_comment|/* If we get a terminal count and address loaded condition,&n;         * this means the DNAR was copied into DACR.&n;         */
r_if
c_cond
(paren
(paren
id|dummy
op_amp
id|EBUS_DCSR_TC
)paren
op_ne
l_int|0
multiline_comment|/*&amp;&amp; (dummy &amp; EBUS_DCSR_A_LOADED) != 0*/
)paren
(brace
id|cs4231_chip-&gt;perchip_info.play.samples
op_add_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
(paren
id|cs4231_chip-&gt;perchip_info.play
)paren
comma
id|cs4231_chip-&gt;playlen
)paren
suffix:semicolon
id|eb4231_playintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dummy
op_amp
id|EBUS_DCSR_A_LOADED
)paren
op_eq
l_int|0
)paren
(brace
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
l_int|0
suffix:semicolon
id|eb4231_playintr
c_func
(paren
id|drv
)paren
suffix:semicolon
id|eb4231_getsamplecount
c_func
(paren
id|drv
comma
id|cs4231_chip-&gt;playlen
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Audio interrupt handler. */
DECL|function|cs4231_interrupt
r_void
id|cs4231_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sparcaudio_driver
op_star
id|drv
op_assign
(paren
r_struct
id|sparcaudio_driver
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|__u32
id|dummy
suffix:semicolon
id|dprintk
c_func
(paren
(paren
l_string|&quot;in cs4231_interrupt&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear the interrupt. */
id|dummy
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|dummy
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
multiline_comment|/* now go through and figure out what gets to claim the interrupt &n;         * if anything since we may be doing shared interrupts &n;         */
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_PLAY_INT
)paren
(brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_XINT_PNVA
)paren
(brace
id|cs4231_chip-&gt;perchip_info.play.samples
op_add_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
(paren
id|cs4231_chip-&gt;perchip_info.play
)paren
comma
id|cs4231_chip-&gt;playlen
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dummy
op_amp
id|APC_XINT_EMPT
)paren
)paren
id|cs4231_playintr
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Any other conditions we need worry about? */
)brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_CAPT_INT
)paren
(brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_XINT_CNVA
)paren
(brace
id|cs4231_chip-&gt;perchip_info.record.samples
op_add_assign
id|cs4231_length_to_samplecount
c_func
(paren
op_amp
(paren
id|cs4231_chip-&gt;perchip_info.record
)paren
comma
id|cs4231_chip-&gt;reclen
)paren
suffix:semicolon
id|cs4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
multiline_comment|/* Any other conditions we need worry about? */
)brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_XINT_CEMP
)paren
(brace
r_if
c_cond
(paren
id|cs4231_chip-&gt;perchip_info.record.active
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Fix me */
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.error
op_assign
l_int|1
suffix:semicolon
id|cs4231_recintr
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_XINT_EMPT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cs4231_chip-&gt;output_next_dma_handle
)paren
(brace
id|u32
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|csr
op_or_assign
id|APC_PPAUSE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|csr
comma
id|cs4231_chip-&gt;regs
op_plus
id|APCCSR
)paren
suffix:semicolon
id|cs4231_disable_play
c_func
(paren
id|drv
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.error
op_assign
l_int|1
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
l_int|0
suffix:semicolon
id|cs4231_playintr
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
id|cs4231_getsamplecount
c_func
(paren
id|drv
comma
id|cs4231_chip-&gt;playlen
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dummy
op_amp
id|APC_GENL_INT
)paren
(brace
multiline_comment|/* If we get here we must be sharing an interrupt, but I haven&squot;t code &n;                 * to handle this right now.&n;                 */
)brace
)brace
DECL|variable|cs4231_ops
r_static
r_struct
id|sparcaudio_operations
id|cs4231_ops
op_assign
(brace
id|cs4231_open
comma
id|cs4231_release
comma
id|cs4231_ioctl
comma
id|cs4231_start_output
comma
id|cs4231_stop_output
comma
id|cs4231_start_input
comma
id|cs4231_stop_input
comma
id|cs4231_audio_getdev
comma
id|cs4231_set_output_volume
comma
id|cs4231_get_output_volume
comma
id|cs4231_set_input_volume
comma
id|cs4231_get_input_volume
comma
id|cs4231_set_monitor_volume
comma
id|cs4231_get_monitor_volume
comma
id|cs4231_set_output_balance
comma
id|cs4231_get_output_balance
comma
id|cs4231_set_input_balance
comma
id|cs4231_get_input_balance
comma
id|cs4231_set_output_channels
comma
id|cs4231_get_output_channels
comma
id|cs4231_set_input_channels
comma
id|cs4231_get_input_channels
comma
id|cs4231_set_output_precision
comma
id|cs4231_get_output_precision
comma
id|cs4231_set_input_precision
comma
id|cs4231_get_input_precision
comma
id|cs4231_set_output_port
comma
id|cs4231_get_output_port
comma
id|cs4231_set_input_port
comma
id|cs4231_get_input_port
comma
id|cs4231_set_output_encoding
comma
id|cs4231_get_output_encoding
comma
id|cs4231_set_input_encoding
comma
id|cs4231_get_input_encoding
comma
id|cs4231_set_output_rate
comma
id|cs4231_get_output_rate
comma
id|cs4231_set_input_rate
comma
id|cs4231_get_input_rate
comma
id|cs4231_audio_getdev_sunos
comma
id|cs4231_get_output_ports
comma
id|cs4231_get_input_ports
comma
id|cs4231_output_muted
comma
id|cs4231_get_output_muted
comma
id|cs4231_set_output_pause
comma
id|cs4231_get_output_pause
comma
id|cs4231_set_input_pause
comma
id|cs4231_get_input_pause
comma
id|cs4231_set_output_samples
comma
id|cs4231_get_output_samples
comma
id|cs4231_set_input_samples
comma
id|cs4231_get_input_samples
comma
id|cs4231_set_output_error
comma
id|cs4231_get_output_error
comma
id|cs4231_set_input_error
comma
id|cs4231_get_input_error
comma
id|cs4231_get_formats
comma
)brace
suffix:semicolon
macro_line|#ifdef EB4231_SUPPORT
DECL|variable|eb4231_ops
r_static
r_struct
id|sparcaudio_operations
id|eb4231_ops
op_assign
(brace
id|cs4231_open
comma
id|cs4231_release
comma
id|cs4231_ioctl
comma
id|eb4231_start_output
comma
id|eb4231_stop_output
comma
id|eb4231_start_input
comma
id|eb4231_stop_input
comma
id|cs4231_audio_getdev
comma
id|cs4231_set_output_volume
comma
id|cs4231_get_output_volume
comma
id|cs4231_set_input_volume
comma
id|cs4231_get_input_volume
comma
id|cs4231_set_monitor_volume
comma
id|cs4231_get_monitor_volume
comma
id|cs4231_set_output_balance
comma
id|cs4231_get_output_balance
comma
id|cs4231_set_input_balance
comma
id|cs4231_get_input_balance
comma
id|cs4231_set_output_channels
comma
id|cs4231_get_output_channels
comma
id|cs4231_set_input_channels
comma
id|cs4231_get_input_channels
comma
id|cs4231_set_output_precision
comma
id|cs4231_get_output_precision
comma
id|cs4231_set_input_precision
comma
id|cs4231_get_input_precision
comma
id|cs4231_set_output_port
comma
id|cs4231_get_output_port
comma
id|cs4231_set_input_port
comma
id|cs4231_get_input_port
comma
id|cs4231_set_output_encoding
comma
id|cs4231_get_output_encoding
comma
id|cs4231_set_input_encoding
comma
id|cs4231_get_input_encoding
comma
id|cs4231_set_output_rate
comma
id|cs4231_get_output_rate
comma
id|cs4231_set_input_rate
comma
id|cs4231_get_input_rate
comma
id|cs4231_audio_getdev_sunos
comma
id|cs4231_get_output_ports
comma
id|cs4231_get_input_ports
comma
id|cs4231_output_muted
comma
id|cs4231_get_output_muted
comma
id|cs4231_set_output_pause
comma
id|cs4231_get_output_pause
comma
id|cs4231_set_input_pause
comma
id|cs4231_get_input_pause
comma
id|cs4231_set_output_samples
comma
id|eb4231_get_output_samples
comma
id|cs4231_set_input_samples
comma
id|eb4231_get_input_samples
comma
id|cs4231_set_output_error
comma
id|cs4231_get_output_error
comma
id|cs4231_set_input_error
comma
id|cs4231_get_input_error
comma
id|cs4231_get_formats
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* Attach to an cs4231 chip given its PROM node. */
DECL|function|cs4231_attach
r_static
r_int
id|cs4231_attach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
macro_line|#if defined (LINUX_VERSION_CODE) &amp;&amp; LINUX_VERSION_CODE &lt; 0x20100
r_struct
id|linux_prom_irqs
id|irq
suffix:semicolon
macro_line|#endif
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Allocate our private information structure. */
id|drv
op_member_access_from_pointer
r_private
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cs4231_chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drv
op_member_access_from_pointer
r_private
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Point at the information structure and initialize it. */
id|drv-&gt;ops
op_assign
op_amp
id|cs4231_ops
suffix:semicolon
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;status
op_assign
l_int|0
suffix:semicolon
id|drv-&gt;dev
op_assign
id|sdev
suffix:semicolon
multiline_comment|/* Map the registers into memory. */
id|cs4231_chip-&gt;regs_size
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|reg_size
suffix:semicolon
id|cs4231_chip-&gt;regs
op_assign
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
l_int|0
comma
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|reg_size
comma
l_string|&quot;cs4231&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs4231_chip-&gt;regs
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs4231: could not remap registers&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Attach the interrupt handler to the audio interrupt. */
id|cs4231_chip-&gt;irq
op_assign
id|sdev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|request_irq
c_func
(paren
id|cs4231_chip-&gt;irq
comma
id|cs4231_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;cs4231&quot;
comma
id|drv
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
suffix:semicolon
id|cs4231_chip-&gt;nirqs
op_assign
l_int|1
suffix:semicolon
id|cs4231_enable_interrupts
c_func
(paren
id|drv
)paren
suffix:semicolon
multiline_comment|/* Reset the audio chip. */
id|cs4231_chip_reset
c_func
(paren
id|drv
)paren
suffix:semicolon
multiline_comment|/* Register ourselves with the midlevel audio driver. */
id|err
op_assign
id|register_sparcaudio_driver
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs4231: unable to register&bslash;n&quot;
)paren
suffix:semicolon
id|cs4231_disable_interrupts
c_func
(paren
id|drv
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cs4231_chip-&gt;irq
comma
id|drv
)paren
suffix:semicolon
id|sbus_iounmap
c_func
(paren
id|cs4231_chip-&gt;regs
comma
id|cs4231_chip-&gt;regs_size
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
id|cs4231_chip-&gt;perchip_info.play.pause
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
id|cs4231_chip-&gt;perchip_info.record.pause
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.avail_ports
op_assign
(paren
id|AUDIO_HEADPHONE
op_or
id|AUDIO_SPEAKER
op_or
id|AUDIO_LINE_OUT
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.avail_ports
op_assign
(paren
id|AUDIO_INTERNAL_CD_IN
op_or
id|AUDIO_LINE_IN
op_or
id|AUDIO_MICROPHONE
op_or
id|AUDIO_ANALOG_LOOPBACK
)paren
suffix:semicolon
multiline_comment|/* Announce the hardware to the user. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;audio%d: cs4231%c at %lx irq %s&bslash;n&quot;
comma
id|drv-&gt;index
comma
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_REV_A
)paren
ques
c_cond
l_char|&squot;a&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|cs4231_chip-&gt;regs
comma
id|__irq_itoa
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
)paren
suffix:semicolon
multiline_comment|/* Success! */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef EB4231_SUPPORT
multiline_comment|/* Attach to an cs4231 chip given its PROM node. */
DECL|function|eb4231_attach
r_static
r_int
id|eb4231_attach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_struct
id|linux_ebus_device
op_star
id|edev
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
suffix:semicolon
r_int
id|len
comma
id|err
comma
id|nregs
suffix:semicolon
r_struct
id|linux_prom_registers
id|regs
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* Allocate our private information structure. */
id|drv
op_member_access_from_pointer
r_private
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cs4231_chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drv
op_member_access_from_pointer
r_private
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Point at the information structure and initialize it. */
id|drv-&gt;ops
op_assign
op_amp
id|eb4231_ops
suffix:semicolon
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_chip-&gt;input_ptr
op_assign
id|cs4231_chip-&gt;output_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs4231_chip-&gt;input_size
op_assign
id|cs4231_chip-&gt;output_size
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;status
op_assign
l_int|0
suffix:semicolon
id|drv-&gt;dev
op_assign
(paren
r_struct
id|sbus_dev
op_star
)paren
id|edev-&gt;bus-&gt;self
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|edev-&gt;prom_node
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_mod
r_sizeof
(paren
id|regs
(braket
l_int|0
)braket
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;eb4231: Strange reg property size %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|nregs
op_assign
id|len
op_div
r_sizeof
(paren
id|regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|cs4231_chip-&gt;regs
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
id|cs4231_chip-&gt;eb2p
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
id|cs4231_chip-&gt;eb2c
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|2
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
id|cs4231_chip-&gt;status
op_or_assign
id|CS_STATUS_IS_EBUS
suffix:semicolon
multiline_comment|/* Attach the interrupt handler to the audio interrupt. */
id|cs4231_chip-&gt;irq
op_assign
id|edev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|cs4231_chip-&gt;irq2
op_assign
id|edev-&gt;irqs
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|cs4231_chip-&gt;irq
comma
id|eb4231_cinterrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;cs4231&quot;
comma
id|drv
)paren
op_logical_or
id|request_irq
c_func
(paren
id|cs4231_chip-&gt;irq2
comma
id|eb4231_pinterrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;cs4231&quot;
comma
id|drv
)paren
)paren
(brace
r_goto
id|bail
suffix:semicolon
)brace
id|cs4231_chip-&gt;nirqs
op_assign
l_int|2
suffix:semicolon
id|cs4231_enable_interrupts
c_func
(paren
id|drv
)paren
suffix:semicolon
multiline_comment|/* Reset the audio chip. */
id|cs4231_chip_reset
c_func
(paren
id|drv
)paren
suffix:semicolon
multiline_comment|/* Register ourselves with the midlevel audio driver. */
id|err
op_assign
id|register_sparcaudio_driver
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|bail
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs4231: unable to register&bslash;n&quot;
)paren
suffix:semicolon
id|cs4231_disable_interrupts
c_func
(paren
id|drv
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cs4231_chip-&gt;irq
comma
id|drv
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|cs4231_chip-&gt;irq2
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cs4231_chip-&gt;irq2
comma
id|drv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|cs4231_chip-&gt;perchip_info.play.active
op_assign
id|cs4231_chip-&gt;perchip_info.play.pause
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.active
op_assign
id|cs4231_chip-&gt;perchip_info.record.pause
op_assign
l_int|0
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.play.avail_ports
op_assign
(paren
id|AUDIO_HEADPHONE
op_or
id|AUDIO_SPEAKER
op_or
id|AUDIO_LINE_OUT
)paren
suffix:semicolon
id|cs4231_chip-&gt;perchip_info.record.avail_ports
op_assign
(paren
id|AUDIO_INTERNAL_CD_IN
op_or
id|AUDIO_LINE_IN
op_or
id|AUDIO_MICROPHONE
op_or
id|AUDIO_ANALOG_LOOPBACK
)paren
suffix:semicolon
multiline_comment|/* Announce the hardware to the user. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;audio%d: cs4231%c(eb2) at %lx irq %s&bslash;n&quot;
comma
id|drv-&gt;index
comma
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_REV_A
)paren
ques
c_cond
l_char|&squot;a&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|cs4231_chip-&gt;regs
comma
id|__irq_itoa
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
)paren
suffix:semicolon
multiline_comment|/* Success! */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Probe for the cs4231 chip and then attach the driver. */
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
macro_line|#else
r_int
id|__init
id|cs4231_init
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
macro_line|#ifdef EB4231_SUPPORT
r_struct
id|linux_ebus
op_star
id|ebus
suffix:semicolon
r_struct
id|linux_ebus_device
op_star
id|edev
suffix:semicolon
macro_line|#endif
id|num_drivers
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Probe each SBUS for cs4231 chips. */
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;SUNW,CS4231&quot;
)paren
)paren
(brace
multiline_comment|/* Don&squot;t go over the max number of drivers. */
r_if
c_cond
(paren
id|num_drivers
op_ge
id|MAX_DRIVERS
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|cs4231_attach
c_func
(paren
op_amp
id|drivers
(braket
id|num_drivers
)braket
comma
id|sdev
)paren
op_eq
l_int|0
)paren
id|num_drivers
op_increment
suffix:semicolon
)brace
)brace
macro_line|#ifdef EB4231_SUPPORT
id|for_each_ebus
c_func
(paren
id|ebus
)paren
(brace
id|for_each_ebusdev
c_func
(paren
id|edev
comma
id|ebus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;SUNW,CS4231&quot;
)paren
)paren
(brace
multiline_comment|/* Don&squot;t go over the max number of drivers. */
r_if
c_cond
(paren
id|num_drivers
op_ge
id|MAX_DRIVERS
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|eb4231_attach
c_func
(paren
op_amp
id|drivers
(braket
id|num_drivers
)braket
comma
id|edev
)paren
op_eq
l_int|0
)paren
id|num_drivers
op_increment
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
multiline_comment|/* Only return success if we found some cs4231 chips. */
r_return
(paren
id|num_drivers
OG
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/* Detach from an cs4231 chip given the device structure. */
DECL|function|cs4231_detach
r_static
r_void
id|cs4231_detach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|cs4231_chip
op_star
id|cs4231_chip
op_assign
(paren
r_struct
id|cs4231_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|cs4231_disable_interrupts
c_func
(paren
id|drv
)paren
suffix:semicolon
id|unregister_sparcaudio_driver
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|cs4231_chip-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cs4231_chip-&gt;irq
comma
id|drv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs4231_chip-&gt;status
op_amp
id|CS_STATUS_IS_EBUS
)paren
)paren
(brace
id|sbus_iounmap
c_func
(paren
id|cs4231_chip-&gt;regs
comma
id|cs4231_chip-&gt;regs_size
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef EB4231_SUPPORT
id|iounmap
c_func
(paren
id|cs4231_chip-&gt;regs
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|cs4231_chip-&gt;eb2p
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|cs4231_chip-&gt;eb2c
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|cs4231_chip-&gt;irq2
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cs4231_chip-&gt;irq2
comma
id|drv
)paren
suffix:semicolon
macro_line|#endif
)brace
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_register
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_drivers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cs4231_detach
c_func
(paren
op_amp
id|drivers
(braket
id|i
)braket
)paren
suffix:semicolon
id|num_drivers
op_decrement
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-indent-level: 4&n; * c-brace-imaginary-offset: 0&n; * c-brace-offset: -4&n; * c-argdecl-indent: 4&n; * c-label-offset: -4&n; * c-continued-statement-offset: 4&n; * c-continued-brace-offset: 0&n; * indent-tabs-mode: nil&n; * tab-width: 8&n; * End:&n; */
eof
