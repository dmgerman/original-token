multiline_comment|/* $Id: dmy.c,v 1.6 2000/12/13 05:06:26 davem Exp $&n; * drivers/sbus/audio/dummy.c&n; *&n; * Copyright 1998 Derrick J Brashear (shadow@andrew.cmu.edu)&n; *&n; * This is a dummy lowlevel driver. Consider it a distant cousin of &n; * /proc/audio; It pretends to be a piece of audio hardware, and writes&n; * to a file instead. (or will shortly)&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/audioio.h&gt;
macro_line|#include &quot;dummy.h&quot;
DECL|macro|MAX_DRIVERS
mdefine_line|#define MAX_DRIVERS 1
DECL|variable|drivers
r_static
r_struct
id|sparcaudio_driver
id|drivers
(braket
id|MAX_DRIVERS
)braket
suffix:semicolon
DECL|variable|num_drivers
r_static
r_int
id|num_drivers
suffix:semicolon
r_static
r_int
id|dummy_play_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
suffix:semicolon
r_static
r_int
id|dummy_record_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
suffix:semicolon
r_static
r_int
id|dummy_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|dummy_attach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_int
DECL|function|dummy_set_output_encoding
id|dummy_set_output_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|dummy_chip-&gt;perchip_info.play.encoding
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|dummy_set_input_encoding
id|dummy_set_input_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|dummy_chip-&gt;perchip_info.record.encoding
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dummy_get_output_encoding
r_static
r_int
id|dummy_get_output_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.encoding
suffix:semicolon
)brace
DECL|function|dummy_get_input_encoding
r_static
r_int
id|dummy_get_input_encoding
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.encoding
suffix:semicolon
)brace
r_static
r_int
DECL|function|dummy_set_output_rate
id|dummy_set_output_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|dummy_chip-&gt;perchip_info.play.sample_rate
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|dummy_set_input_rate
id|dummy_set_input_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0
)paren
(brace
id|dummy_chip-&gt;perchip_info.record.sample_rate
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dummy_get_output_rate
r_static
r_int
id|dummy_get_output_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.sample_rate
suffix:semicolon
)brace
DECL|function|dummy_get_input_rate
r_static
r_int
id|dummy_get_input_rate
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.sample_rate
suffix:semicolon
)brace
multiline_comment|/* Generically we support 4 channels. This does 2 */
r_static
r_int
DECL|function|dummy_set_output_channels
id|dummy_set_output_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.channels
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Generically we support 4 channels. This does 2 */
r_static
r_int
DECL|function|dummy_set_input_channels
id|dummy_set_input_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.channels
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_input_channels
r_static
r_int
id|dummy_get_input_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.channels
suffix:semicolon
)brace
DECL|function|dummy_get_output_channels
r_static
r_int
id|dummy_get_output_channels
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.channels
suffix:semicolon
)brace
DECL|function|dummy_get_output_precision
r_static
r_int
id|dummy_get_output_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.precision
suffix:semicolon
)brace
DECL|function|dummy_get_input_precision
r_static
r_int
id|dummy_get_input_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.precision
suffix:semicolon
)brace
DECL|function|dummy_set_output_precision
r_static
r_int
id|dummy_set_output_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|val
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.precision
op_assign
id|val
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.precision
suffix:semicolon
)brace
DECL|function|dummy_set_input_precision
r_static
r_int
id|dummy_set_input_precision
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|val
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.precision
op_assign
id|val
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.precision
suffix:semicolon
)brace
multiline_comment|/* Set output mute */
DECL|function|dummy_output_muted
r_static
r_int
id|dummy_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
id|dummy_chip-&gt;perchip_info.output_muted
op_assign
l_int|0
suffix:semicolon
r_else
id|dummy_chip-&gt;perchip_info.output_muted
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_output_muted
r_static
r_int
id|dummy_get_output_muted
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.output_muted
suffix:semicolon
)brace
DECL|function|dummy_get_formats
r_static
r_int
id|dummy_get_formats
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
(paren
id|AFMT_MU_LAW
op_or
id|AFMT_A_LAW
op_or
id|AFMT_U8
op_or
id|AFMT_IMA_ADPCM
op_or
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
)paren
suffix:semicolon
)brace
DECL|function|dummy_get_output_ports
r_static
r_int
id|dummy_get_output_ports
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
(paren
id|AUDIO_LINE_OUT
op_or
id|AUDIO_SPEAKER
op_or
id|AUDIO_HEADPHONE
)paren
suffix:semicolon
)brace
DECL|function|dummy_get_input_ports
r_static
r_int
id|dummy_get_input_ports
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
(paren
id|AUDIO_ANALOG_LOOPBACK
)paren
suffix:semicolon
)brace
multiline_comment|/* Set chip &quot;output&quot; port */
DECL|function|dummy_set_output_port
r_static
r_int
id|dummy_set_output_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.port
op_assign
id|value
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|dummy_set_input_port
r_static
r_int
id|dummy_set_input_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.port
op_assign
id|value
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|dummy_get_output_port
r_static
r_int
id|dummy_get_output_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.port
suffix:semicolon
)brace
DECL|function|dummy_get_input_port
r_static
r_int
id|dummy_get_input_port
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.port
suffix:semicolon
)brace
DECL|function|dummy_get_output_error
r_static
r_int
id|dummy_get_output_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.play.error
suffix:semicolon
)brace
DECL|function|dummy_get_input_error
r_static
r_int
id|dummy_get_input_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.record.error
suffix:semicolon
)brace
DECL|function|dummy_get_output_samples
r_static
r_int
id|dummy_get_output_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.samples
suffix:semicolon
)brace
DECL|function|dummy_get_output_pause
r_static
r_int
id|dummy_get_output_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.play.pause
suffix:semicolon
)brace
DECL|function|dummy_set_output_volume
r_static
r_int
id|dummy_set_output_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_play_gain
c_func
(paren
id|drv
comma
id|value
comma
id|dummy_chip-&gt;perchip_info.play.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_output_volume
r_static
r_int
id|dummy_get_output_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.play.gain
suffix:semicolon
)brace
DECL|function|dummy_set_output_balance
r_static
r_int
id|dummy_set_output_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.balance
op_assign
id|value
suffix:semicolon
id|dummy_play_gain
c_func
(paren
id|drv
comma
id|dummy_chip-&gt;perchip_info.play.gain
comma
id|dummy_chip-&gt;perchip_info.play.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_output_balance
r_static
r_int
id|dummy_get_output_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.play.balance
suffix:semicolon
)brace
multiline_comment|/* Set chip play gain */
DECL|function|dummy_play_gain
r_static
r_int
id|dummy_play_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
comma
id|r
comma
id|l
comma
id|r_adj
comma
id|l_adj
suffix:semicolon
id|r
op_assign
id|l
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|balance
OL
id|AUDIO_MID_BALANCE
)paren
(brace
id|r
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|AUDIO_MID_BALANCE
op_minus
id|balance
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
)paren
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|balance
OG
id|AUDIO_MID_BALANCE
)paren
(brace
id|l
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|balance
op_minus
id|AUDIO_MID_BALANCE
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|0
)paren
id|l
op_assign
l_int|0
suffix:semicolon
)brace
(paren
id|l
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|l_adj
op_assign
id|DUMMY_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|l_adj
op_assign
id|DUMMY_MAX_ATEN
op_minus
(paren
id|l
op_star
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
(paren
id|r
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|r_adj
op_assign
id|DUMMY_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|r_adj
op_assign
id|DUMMY_MAX_ATEN
op_minus
(paren
id|r
op_star
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_eq
l_int|0
)paren
op_logical_or
(paren
id|value
op_eq
id|AUDIO_MAX_GAIN
)paren
)paren
(brace
id|tmp
op_assign
id|value
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|value
op_eq
id|l
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|DUMMY_MAX_ATEN
op_minus
id|l_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_eq
id|r
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|DUMMY_MAX_ATEN
op_minus
id|r_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
id|dummy_chip-&gt;perchip_info.play.gain
op_assign
id|tmp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_input_samples
r_static
r_int
id|dummy_get_input_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.samples
suffix:semicolon
)brace
DECL|function|dummy_get_input_pause
r_static
r_int
id|dummy_get_input_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.record.pause
suffix:semicolon
)brace
DECL|function|dummy_set_monitor_volume
r_static
r_int
id|dummy_set_monitor_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_monitor_volume
r_static
r_int
id|dummy_get_monitor_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_set_input_volume
r_static
r_int
id|dummy_set_input_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_record_gain
c_func
(paren
id|drv
comma
id|value
comma
id|dummy_chip-&gt;perchip_info.record.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_input_volume
r_static
r_int
id|dummy_get_input_volume
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
id|dummy_chip-&gt;perchip_info.record.gain
suffix:semicolon
)brace
DECL|function|dummy_set_input_balance
r_static
r_int
id|dummy_set_input_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.balance
op_assign
id|value
suffix:semicolon
id|dummy_record_gain
c_func
(paren
id|drv
comma
id|dummy_chip-&gt;perchip_info.record.gain
comma
id|dummy_chip-&gt;perchip_info.play.balance
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_get_input_balance
r_static
r_int
id|dummy_get_input_balance
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_return
(paren
r_int
)paren
id|dummy_chip-&gt;perchip_info.record.balance
suffix:semicolon
)brace
DECL|function|dummy_record_gain
r_static
r_int
id|dummy_record_gain
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
comma
r_int
r_char
id|balance
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
comma
id|r
comma
id|l
comma
id|r_adj
comma
id|l_adj
suffix:semicolon
id|r
op_assign
id|l
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|balance
OL
id|AUDIO_MID_BALANCE
)paren
(brace
id|r
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|AUDIO_MID_BALANCE
op_minus
id|balance
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
)paren
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|balance
OG
id|AUDIO_MID_BALANCE
)paren
(brace
id|l
op_assign
(paren
r_int
)paren
(paren
id|value
op_minus
(paren
(paren
id|balance
op_minus
id|AUDIO_MID_BALANCE
)paren
op_lshift
id|AUDIO_BALANCE_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|0
)paren
id|l
op_assign
l_int|0
suffix:semicolon
)brace
(paren
id|l
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|l_adj
op_assign
id|DUMMY_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|l_adj
op_assign
id|DUMMY_MAX_ATEN
op_minus
(paren
id|l
op_star
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
(paren
id|r
op_eq
l_int|0
)paren
ques
c_cond
(paren
id|r_adj
op_assign
id|DUMMY_MAX_DEV_ATEN
)paren
suffix:colon
(paren
id|r_adj
op_assign
id|DUMMY_MAX_ATEN
op_minus
(paren
id|r
op_star
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
op_div
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_eq
l_int|0
)paren
op_logical_or
(paren
id|value
op_eq
id|AUDIO_MAX_GAIN
)paren
)paren
(brace
id|tmp
op_assign
id|value
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|value
op_eq
id|l
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|DUMMY_MAX_ATEN
op_minus
id|l_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_eq
id|r
)paren
(brace
id|tmp
op_assign
(paren
(paren
id|DUMMY_MAX_ATEN
op_minus
id|r_adj
)paren
op_star
(paren
id|AUDIO_MAX_GAIN
op_plus
l_int|1
)paren
op_div
(paren
id|DUMMY_MAX_ATEN
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
id|dummy_chip-&gt;perchip_info.record.gain
op_assign
id|tmp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Reset the audio chip to a sane state. */
DECL|function|dummy_chip_reset
r_static
r_void
id|dummy_chip_reset
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
id|dummy_set_output_encoding
c_func
(paren
id|drv
comma
id|AUDIO_ENCODING_ULAW
)paren
suffix:semicolon
id|dummy_set_output_rate
c_func
(paren
id|drv
comma
id|DUMMY_RATE
)paren
suffix:semicolon
id|dummy_set_output_channels
c_func
(paren
id|drv
comma
id|DUMMY_CHANNELS
)paren
suffix:semicolon
id|dummy_set_output_precision
c_func
(paren
id|drv
comma
id|DUMMY_PRECISION
)paren
suffix:semicolon
id|dummy_set_output_balance
c_func
(paren
id|drv
comma
id|AUDIO_MID_BALANCE
)paren
suffix:semicolon
id|dummy_set_output_volume
c_func
(paren
id|drv
comma
id|DUMMY_DEFAULT_PLAYGAIN
)paren
suffix:semicolon
id|dummy_set_output_port
c_func
(paren
id|drv
comma
id|AUDIO_SPEAKER
)paren
suffix:semicolon
id|dummy_output_muted
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
id|dummy_set_input_encoding
c_func
(paren
id|drv
comma
id|AUDIO_ENCODING_ULAW
)paren
suffix:semicolon
id|dummy_set_input_rate
c_func
(paren
id|drv
comma
id|DUMMY_RATE
)paren
suffix:semicolon
id|dummy_set_input_channels
c_func
(paren
id|drv
comma
id|DUMMY_CHANNELS
)paren
suffix:semicolon
id|dummy_set_input_precision
c_func
(paren
id|drv
comma
id|DUMMY_PRECISION
)paren
suffix:semicolon
id|dummy_set_input_balance
c_func
(paren
id|drv
comma
id|AUDIO_MID_BALANCE
)paren
suffix:semicolon
id|dummy_set_input_volume
c_func
(paren
id|drv
comma
id|DUMMY_DEFAULT_PLAYGAIN
)paren
suffix:semicolon
id|dummy_set_input_port
c_func
(paren
id|drv
comma
id|AUDIO_SPEAKER
)paren
suffix:semicolon
)brace
DECL|function|dummy_open
r_static
r_int
id|dummy_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
multiline_comment|/* Set the default audio parameters if not already in use. */
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|drv-&gt;flags
op_amp
id|SDF_OPEN_WRITE
)paren
op_logical_and
(paren
id|dummy_chip-&gt;perchip_info.play.active
op_eq
l_int|0
)paren
)paren
(brace
id|dummy_chip-&gt;perchip_info.play.open
op_assign
l_int|1
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.samples
op_assign
id|dummy_chip-&gt;perchip_info.play.error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|drv-&gt;flags
op_amp
id|SDF_OPEN_READ
)paren
op_logical_and
(paren
id|dummy_chip-&gt;perchip_info.record.active
op_eq
l_int|0
)paren
)paren
(brace
id|dummy_chip-&gt;perchip_info.record.open
op_assign
l_int|1
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.samples
op_assign
id|dummy_chip-&gt;perchip_info.record.error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_release
r_static
r_void
id|dummy_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|dummy_chip-&gt;perchip_info.play.active
op_assign
id|dummy_chip-&gt;perchip_info.play.open
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|dummy_chip-&gt;perchip_info.record.active
op_assign
id|dummy_chip-&gt;perchip_info.record.open
op_assign
l_int|0
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|dummy_output_done_task
r_static
r_void
id|dummy_output_done_task
c_func
(paren
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sparcaudio_driver
op_star
id|drv
op_assign
(paren
r_struct
id|sparcaudio_driver
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy_chip-&gt;perchip_info.record.active
)paren
id|sparcaudio_input_done
c_func
(paren
id|drv
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dummy_start_output
r_static
r_void
id|dummy_start_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|dummy_chip-&gt;perchip_info.play.pause
op_logical_or
op_logical_neg
id|count
)paren
r_return
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.active
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* fake an &quot;interrupt&quot; to deal with this block */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|dummy_chip-&gt;tqueue.list
)paren
suffix:semicolon
id|dummy_chip-&gt;tqueue.sync
op_assign
l_int|0
suffix:semicolon
id|dummy_chip-&gt;tqueue.routine
op_assign
id|dummy_output_done_task
suffix:semicolon
id|dummy_chip-&gt;tqueue.data
op_assign
id|drv
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|dummy_chip-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
DECL|function|dummy_start_input
r_static
r_void
id|dummy_start_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|__u8
op_star
id|buffer
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|dummy_stop_output
r_static
r_void
id|dummy_stop_output
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.active
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_stop_input
r_static
r_void
id|dummy_stop_input
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.active
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_set_output_pause
r_static
r_int
id|dummy_set_output_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.pause
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
id|sparcaudio_output_done
c_func
(paren
id|drv
comma
l_int|0
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|dummy_set_input_pause
r_static
r_int
id|dummy_set_input_pause
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.pause
op_assign
id|value
suffix:semicolon
multiline_comment|/* This should probably cause play pause. */
r_return
id|value
suffix:semicolon
)brace
DECL|function|dummy_set_input_error
r_static
r_int
id|dummy_set_input_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dummy_set_output_error
r_static
r_int
id|dummy_set_output_error
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|dummy_chip-&gt;perchip_info.play.error
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.error
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|dummy_set_output_samples
r_static
r_int
id|dummy_set_output_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|dummy_chip-&gt;perchip_info.play.samples
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.samples
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|dummy_set_input_samples
r_static
r_int
id|dummy_set_input_samples
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
r_int
id|value
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
id|dummy_chip-&gt;perchip_info.play.samples
suffix:semicolon
id|dummy_chip-&gt;perchip_info.record.samples
op_assign
id|value
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/* In order to fake things which care out, play we&squot;re a 4231 */
DECL|function|dummy_audio_getdev
r_static
r_void
id|dummy_audio_getdev
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
comma
id|audio_device_t
op_star
id|audinfo
)paren
(brace
id|strncpy
c_func
(paren
id|audinfo-&gt;name
comma
l_string|&quot;SUNW,cs4231&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;name
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|audinfo-&gt;version
comma
l_string|&quot;a&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;version
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|audinfo-&gt;config
comma
l_string|&quot;onboard1&quot;
comma
r_sizeof
(paren
id|audinfo-&gt;config
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dummy_audio_getdev_sunos
r_static
r_int
id|dummy_audio_getdev_sunos
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_return
l_int|5
suffix:semicolon
)brace
DECL|variable|dummy_ops
r_static
r_struct
id|sparcaudio_operations
id|dummy_ops
op_assign
(brace
id|dummy_open
comma
id|dummy_release
comma
l_int|NULL
comma
id|dummy_start_output
comma
id|dummy_stop_output
comma
id|dummy_start_input
comma
id|dummy_stop_input
comma
id|dummy_audio_getdev
comma
id|dummy_set_output_volume
comma
id|dummy_get_output_volume
comma
id|dummy_set_input_volume
comma
id|dummy_get_input_volume
comma
id|dummy_set_monitor_volume
comma
id|dummy_get_monitor_volume
comma
id|dummy_set_output_balance
comma
id|dummy_get_output_balance
comma
id|dummy_set_input_balance
comma
id|dummy_get_input_balance
comma
id|dummy_set_output_channels
comma
id|dummy_get_output_channels
comma
id|dummy_set_input_channels
comma
id|dummy_get_input_channels
comma
id|dummy_set_output_precision
comma
id|dummy_get_output_precision
comma
id|dummy_set_input_precision
comma
id|dummy_get_input_precision
comma
id|dummy_set_output_port
comma
id|dummy_get_output_port
comma
id|dummy_set_input_port
comma
id|dummy_get_input_port
comma
id|dummy_set_output_encoding
comma
id|dummy_get_output_encoding
comma
id|dummy_set_input_encoding
comma
id|dummy_get_input_encoding
comma
id|dummy_set_output_rate
comma
id|dummy_get_output_rate
comma
id|dummy_set_input_rate
comma
id|dummy_get_input_rate
comma
id|dummy_audio_getdev_sunos
comma
id|dummy_get_output_ports
comma
id|dummy_get_input_ports
comma
id|dummy_output_muted
comma
id|dummy_get_output_muted
comma
id|dummy_set_output_pause
comma
id|dummy_get_output_pause
comma
id|dummy_set_input_pause
comma
id|dummy_get_input_pause
comma
id|dummy_set_output_samples
comma
id|dummy_get_output_samples
comma
id|dummy_set_input_samples
comma
id|dummy_get_input_samples
comma
id|dummy_set_output_error
comma
id|dummy_get_output_error
comma
id|dummy_set_input_error
comma
id|dummy_get_input_error
comma
id|dummy_get_formats
comma
)brace
suffix:semicolon
multiline_comment|/* Probe for the dummy chip and then attach the driver. */
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
macro_line|#else
r_int
id|__init
id|dummy_init
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
id|num_drivers
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Add support here for specifying multiple dummies to attach at once. */
r_if
c_cond
(paren
id|dummy_attach
c_func
(paren
op_amp
id|drivers
(braket
id|num_drivers
)braket
)paren
op_eq
l_int|0
)paren
id|num_drivers
op_increment
suffix:semicolon
multiline_comment|/* Only return success if we found some dummy chips. */
r_return
(paren
id|num_drivers
OG
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Attach to an dummy chip given its PROM node. */
DECL|function|dummy_attach
r_static
r_int
id|dummy_attach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
r_struct
id|dummy_chip
op_star
id|dummy_chip
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Allocate our private information structure. */
id|drv
op_member_access_from_pointer
r_private
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dummy_chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drv
op_member_access_from_pointer
r_private
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Point at the information structure and initialize it. */
id|drv-&gt;ops
op_assign
op_amp
id|dummy_ops
suffix:semicolon
id|dummy_chip
op_assign
(paren
r_struct
id|dummy_chip
op_star
)paren
id|drv
op_member_access_from_pointer
r_private
suffix:semicolon
multiline_comment|/* Reset parameters. */
id|dummy_chip_reset
c_func
(paren
id|drv
)paren
suffix:semicolon
multiline_comment|/* Register ourselves with the midlevel audio driver. */
id|err
op_assign
id|register_sparcaudio_driver
c_func
(paren
id|drv
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dummy: unable to register&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|dummy_chip-&gt;perchip_info.play.active
op_assign
id|dummy_chip-&gt;perchip_info.play.pause
op_assign
l_int|0
suffix:semicolon
id|dummy_chip-&gt;perchip_info.play.avail_ports
op_assign
(paren
id|AUDIO_HEADPHONE
op_or
id|AUDIO_SPEAKER
op_or
id|AUDIO_LINE_OUT
)paren
suffix:semicolon
multiline_comment|/* Announce the hardware to the user. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;audio%d: dummy at 0x0 irq 0&bslash;n&quot;
comma
id|drv-&gt;index
)paren
suffix:semicolon
multiline_comment|/* Success! */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/* Detach from an dummy chip given the device structure. */
DECL|function|dummy_detach
r_static
r_void
id|dummy_detach
c_func
(paren
r_struct
id|sparcaudio_driver
op_star
id|drv
)paren
(brace
id|unregister_sparcaudio_driver
c_func
(paren
id|drv
comma
l_int|2
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_drivers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dummy_detach
c_func
(paren
op_amp
id|drivers
(braket
id|i
)braket
)paren
suffix:semicolon
id|num_drivers
op_decrement
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-indent-level: 4&n; * c-brace-imaginary-offset: 0&n; * c-brace-offset: -4&n; * c-argdecl-indent: 4&n; * c-label-offset: -4&n; * c-continued-statement-offset: 4&n; * c-continued-brace-offset: 0&n; * indent-tabs-mode: nil&n; * tab-width: 8&n; * End:&n; */
eof
