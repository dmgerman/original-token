multiline_comment|/* $Id: suncons.c,v 1.77 1997/12/19 07:32:59 ecd Exp $&n; * suncons.c: Sparc platform console generic layer.&n; *&n; * Copyright (C) 1997 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/vt.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &quot;fb.h&quot;
macro_line|#include &lt;asm/linux_logo.h&gt;
DECL|variable|fbinfo
id|fbinfo_t
op_star
id|fbinfo
suffix:semicolon
DECL|variable|fbinfos
r_int
id|fbinfos
suffix:semicolon
DECL|variable|__initdata
r_int
r_int
id|linux_logo_colors
id|__initdata
op_assign
id|LINUX_LOGO_COLORS
suffix:semicolon
DECL|variable|__initdata
r_char
id|logo_banner
(braket
)braket
id|__initdata
op_assign
id|linux_logo_banner
suffix:semicolon
r_extern
r_struct
id|console
id|vt_console_driver
suffix:semicolon
multiline_comment|/* Infrastructure. */
DECL|function|nop_memsetw
r_static
r_void
id|nop_memsetw
c_func
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
r_int
id|count
)paren
(brace
)brace
DECL|function|nop_memcpyw
r_static
r_void
id|nop_memcpyw
c_func
(paren
r_int
r_int
op_star
id|to
comma
r_int
r_int
op_star
id|from
comma
r_int
r_int
id|count
)paren
(brace
)brace
DECL|function|nop_scr_writew
r_static
r_void
id|nop_scr_writew
c_func
(paren
r_int
r_int
id|val
comma
r_int
r_int
op_star
id|addr
)paren
(brace
)brace
DECL|function|nop_scr_readw
r_static
r_int
r_int
id|nop_scr_readw
c_func
(paren
r_int
r_int
op_star
id|addr
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nop_get_scrmem
r_static
r_void
id|nop_get_scrmem
c_func
(paren
r_int
id|a
)paren
(brace
)brace
DECL|function|nop_set_scrmem
r_static
r_void
id|nop_set_scrmem
c_func
(paren
r_int
id|a
comma
r_int
id|b
)paren
(brace
)brace
DECL|function|nop_set_origin
r_static
r_void
id|nop_set_origin
c_func
(paren
r_int
r_int
id|offset
)paren
(brace
)brace
DECL|function|nop_hide_cursor
r_static
r_void
id|nop_hide_cursor
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_set_cursor
r_static
r_void
id|nop_set_cursor
c_func
(paren
r_int
id|c
)paren
(brace
)brace
DECL|function|nop_set_get_font
r_static
r_int
id|nop_set_get_font
c_func
(paren
r_char
op_star
id|a
comma
r_int
id|b
comma
r_int
id|c
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nop_con_adjust_height
r_static
r_int
id|nop_con_adjust_height
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|nop_set_get_cmap
r_static
r_int
id|nop_set_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|a
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nop_set_palette
r_static
r_void
id|nop_set_palette
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_set_other_palette
r_static
r_void
id|nop_set_other_palette
c_func
(paren
r_int
id|a
)paren
(brace
)brace
DECL|function|nop_console_restore_palette
r_static
r_void
id|nop_console_restore_palette
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_con_type_init
r_static
r_int
r_int
id|nop_con_type_init
c_func
(paren
r_int
r_int
id|mem_start
comma
r_const
r_char
op_star
op_star
id|display_desc
)paren
(brace
r_return
id|mem_start
suffix:semicolon
)brace
DECL|function|nop_con_type_init_finish
r_static
r_void
id|nop_con_type_init_finish
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_vesa_blank
r_static
r_void
id|nop_vesa_blank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_vesa_unblank
r_static
r_void
id|nop_vesa_unblank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_set_vesa_blanking
r_static
r_void
id|nop_set_vesa_blanking
c_func
(paren
r_const
r_int
r_int
id|arg
)paren
(brace
)brace
DECL|function|nop_vesa_powerdown
r_static
r_void
id|nop_vesa_powerdown
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_clear_screen
r_static
r_void
id|nop_clear_screen
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_render_screen
r_static
r_void
id|nop_render_screen
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|nop_clear_margin
r_static
r_void
id|nop_clear_margin
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|suncons_ops
r_struct
id|suncons_operations
id|suncons_ops
op_assign
(brace
id|nop_memsetw
comma
id|nop_memcpyw
comma
id|nop_scr_writew
comma
id|nop_scr_readw
comma
id|nop_get_scrmem
comma
id|nop_set_scrmem
comma
id|nop_set_origin
comma
id|nop_hide_cursor
comma
id|nop_set_cursor
comma
id|nop_set_get_font
comma
id|nop_con_adjust_height
comma
id|nop_set_get_cmap
comma
id|nop_set_palette
comma
id|nop_set_other_palette
comma
id|nop_console_restore_palette
comma
id|nop_con_type_init
comma
id|nop_con_type_init_finish
comma
id|nop_vesa_blank
comma
id|nop_vesa_unblank
comma
id|nop_set_vesa_blanking
comma
id|nop_vesa_powerdown
comma
id|nop_clear_screen
comma
id|nop_render_screen
comma
id|nop_clear_margin
)brace
suffix:semicolon
multiline_comment|/* Entry points. */
DECL|function|get_scrmem
r_void
id|get_scrmem
c_func
(paren
r_int
id|a
)paren
(brace
id|suncons_ops
dot
id|get_scrmem
c_func
(paren
id|a
)paren
suffix:semicolon
)brace
DECL|function|set_scrmem
r_void
id|set_scrmem
c_func
(paren
r_int
id|a
comma
r_int
id|b
)paren
(brace
id|suncons_ops
dot
id|set_scrmem
c_func
(paren
id|a
comma
id|b
)paren
suffix:semicolon
)brace
DECL|function|__set_origin
r_void
id|__set_origin
c_func
(paren
r_int
r_int
id|offset
)paren
(brace
id|suncons_ops
dot
id|set_origin
c_func
(paren
id|offset
)paren
suffix:semicolon
)brace
DECL|function|hide_cursor
r_void
id|hide_cursor
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|hide_cursor
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|set_cursor
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
id|suncons_ops
dot
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|set_get_font
r_int
id|set_get_font
c_func
(paren
r_char
op_star
id|arg
comma
r_int
id|set
comma
r_int
id|ch512
)paren
(brace
r_return
id|suncons_ops
dot
id|set_get_font
c_func
(paren
id|arg
comma
id|set
comma
id|ch512
)paren
suffix:semicolon
)brace
DECL|function|con_adjust_height
r_int
id|con_adjust_height
c_func
(paren
r_int
r_int
id|fontheight
)paren
(brace
r_return
id|suncons_ops
dot
id|con_adjust_height
c_func
(paren
id|fontheight
)paren
suffix:semicolon
)brace
DECL|function|set_get_cmap
r_int
id|set_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
r_return
id|suncons_ops
dot
id|set_get_cmap
c_func
(paren
id|arg
comma
id|set
)paren
suffix:semicolon
)brace
DECL|function|set_palette
r_void
id|set_palette
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|set_palette
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|set_other_palette
r_void
id|set_other_palette
c_func
(paren
r_int
id|n
)paren
(brace
id|suncons_ops
dot
id|set_other_palette
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
DECL|function|console_restore_palette
r_void
id|console_restore_palette
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|console_restore_palette
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|con_type_init
r_int
r_int
id|con_type_init
c_func
(paren
r_int
r_int
id|mem_start
comma
r_const
r_char
op_star
op_star
id|disp_desc
)paren
(brace
r_return
id|suncons_ops
dot
id|con_type_init
c_func
(paren
id|mem_start
comma
id|disp_desc
)paren
suffix:semicolon
)brace
DECL|function|con_type_init_finish
r_void
id|con_type_init_finish
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|con_type_init_finish
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|vesa_blank
r_void
id|vesa_blank
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|vesa_blank
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|vesa_unblank
r_void
id|vesa_unblank
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|vesa_unblank
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|set_vesa_blanking
r_void
id|set_vesa_blanking
c_func
(paren
r_const
r_int
r_int
id|arg
)paren
(brace
id|suncons_ops
dot
id|set_vesa_blanking
c_func
(paren
id|arg
)paren
suffix:semicolon
)brace
DECL|function|vesa_powerdown
r_void
id|vesa_powerdown
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|vesa_powerdown
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|render_screen
r_void
id|render_screen
c_func
(paren
r_void
)paren
(brace
id|suncons_ops
dot
id|render_screen
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * We permutate the colors, so we match the PROM&squot;s idea of&n; * black and white.&n; */
DECL|variable|reverse_color_table
r_int
r_char
id|reverse_color_table
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|sparc_color_table
r_int
r_char
id|sparc_color_table
(braket
)braket
op_assign
(brace
l_int|15
comma
l_int|0
comma
l_int|4
comma
l_int|2
comma
l_int|6
comma
l_int|1
comma
l_int|5
comma
l_int|3
comma
l_int|7
comma
l_int|8
comma
l_int|12
comma
l_int|10
comma
l_int|14
comma
l_int|9
comma
l_int|13
comma
l_int|11
)brace
suffix:semicolon
multiline_comment|/* Probing engine. */
DECL|variable|console_fb_path
r_char
op_star
id|console_fb_path
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|fb_restore_palette
r_void
(paren
op_star
id|fb_restore_palette
)paren
(paren
id|fbinfo_t
op_star
id|fbinfo
)paren
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
DECL|function|get_phys
id|get_phys
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|__get_phys
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
r_extern
r_int
id|sbus_console_probe
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|serial_console
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
r_int
id|finish_console_init
c_func
(paren
r_int
r_int
id|memory_start
)paren
)paren
(brace
r_static
r_int
id|confinish_has_run
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|confinish_has_run
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;finish_console_init: Someone tries to run me twice.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|FRAME_BUFFERS
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|i
op_minus
l_int|1
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
(brace
r_break
suffix:semicolon
)brace
id|fbinfos
op_assign
id|i
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|postsetup
)paren
id|memory_start
op_assign
(paren
op_star
id|fbinfo
(braket
id|j
)braket
dot
id|postsetup
)paren
(paren
id|fbinfo
op_plus
id|j
comma
id|memory_start
)paren
suffix:semicolon
id|suncons_ops
dot
id|clear_screen
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
(brace
id|fbinfo
(braket
id|j
)braket
dot
id|clear_fb
c_func
(paren
id|j
)paren
suffix:semicolon
id|fbinfo
(braket
id|j
)braket
dot
id|set_other_palette
c_func
(paren
id|j
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; &bslash;&n;    ( defined(CONFIG_SUN_OPENPROMFS) || defined(CONFIG_SUN_OPENPROMFS_MODULE) )
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
id|proc_openprom_regdev
(paren
op_amp
id|fbinfo
(braket
id|j
)braket
dot
id|proc_entry
)paren
suffix:semicolon
macro_line|#endif
id|confinish_has_run
op_assign
l_int|1
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
r_extern
r_void
id|pci_console_inithook
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|con_is_present
c_func
(paren
r_void
)paren
)paren
(brace
r_return
id|serial_console
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|sun_console_init
c_func
(paren
r_int
r_int
id|memory_start
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Nothing to do in this case. */
r_if
c_cond
(paren
op_logical_neg
id|con_is_present
c_func
(paren
)paren
)paren
r_return
id|memory_start
suffix:semicolon
id|fbinfo
op_assign
(paren
id|fbinfo_t
op_star
)paren
id|memory_start
suffix:semicolon
id|memset
c_func
(paren
id|fbinfo
comma
l_int|0
comma
id|FRAME_BUFFERS
op_star
r_sizeof
(paren
id|fbinfo_t
)paren
)paren
suffix:semicolon
id|memory_start
op_add_assign
(paren
id|FRAME_BUFFERS
op_star
r_sizeof
(paren
id|fbinfo_t
)paren
)paren
suffix:semicolon
id|fbinfos
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FRAME_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
id|fbinfo
(braket
id|i
)braket
dot
id|type.fb_type
op_assign
id|FBTYPE_NOTYPE
suffix:semicolon
r_if
c_cond
(paren
id|sbus_console_probe
c_func
(paren
)paren
)paren
(brace
macro_line|#ifdef CONFIG_PCI
id|pci_console_inithook
c_func
(paren
)paren
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
macro_line|#else
multiline_comment|/* XXX We need to write PROM console fallback driver... */
id|prom_printf
c_func
(paren
l_string|&quot;Could not probe SBUS console, bailing out...&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
id|finish_console_init
c_func
(paren
id|memory_start
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
r_extern
r_int
id|pci_console_probe
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|pci_console_init
c_func
(paren
r_int
r_int
id|memory_start
)paren
)paren
(brace
multiline_comment|/* Nothing to do in this case. */
r_if
c_cond
(paren
op_logical_neg
id|con_is_present
c_func
(paren
)paren
)paren
r_return
id|memory_start
suffix:semicolon
r_if
c_cond
(paren
id|pci_console_probe
c_func
(paren
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Could not probe PCI console, bailing out...&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|memory_start
op_assign
id|finish_console_init
c_func
(paren
id|memory_start
)paren
suffix:semicolon
id|con_type_init_finish
c_func
(paren
)paren
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
)brace
macro_line|#endif
eof
