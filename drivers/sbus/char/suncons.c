multiline_comment|/* $Id: suncons.c,v 1.67 1997/07/20 05:59:42 davem Exp $&n; *&n; * suncons.c: Sun SparcStation console support.&n; *&n; * Copyright (C) 1995 Peter Zaitcev (zaitcev@lab.ipmce.su)&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1995, 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1996 Dave Redman (djhr@tadpole.co.uk)&n; * Copyright (C) 1996 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)&n; *&n; * Added font loading Nov/21, Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Added render_screen and faster scrolling Nov/27, miguel&n; * Added console palette code for cg6 Dec/13/95, miguel&n; * Added generic frame buffer support Dec/14/95, miguel&n; * Added cgsix and bwtwo drivers Jan/96, miguel&n; * Added 4m, and cg3 driver Feb/96, miguel&n; * Fixed the cursor on color displays Feb/96, miguel.&n; * Cleaned up the detection code, generic 8bit depth display &n; *   code, Mar/96 miguel&n; * Hacked support for cg14 video cards -- Apr/96, miguel.&n; * Color support for cg14 video cards -- May/96, miguel.&n; * Code split, Dave Redman, May/96&n; * Be more VT change friendly, May/96, miguel.&n; * Support for hw cursor and graphics acceleration, Jun/96, jj.&n; * Added TurboGX+ detection (cgthree+), Aug/96, Iain Lea (iain@sbs.de)&n; * Added TCX support (8/24bit), Aug/96, jj.&n; * Support for multiple framebuffers, Sep/96, jj.&n; * Fix bwtwo inversion and handle inverse monochrome cells in&n; *   sun_blitc, Nov/96, ecd.&n; * Fix sun_blitc and screen size on displays other than 1152x900, &n; *   128x54 chars, Nov/96, jj.&n; * Fix cursor spots left on some non-accelerated fbs, changed&n; *   software cursor to be like the hw one, Nov/96, jj.&n; * &n; * Much of this driver is derived from the DEC TGA driver by&n; * Jay Estabrook who has done a nice job with the console&n; * driver abstraction btw.&n; *&n; * We try to make everything a power of two if possible to&n; * speed up the bit blit.  Doing multiplies, divides, and&n; * remainder routines end up calling software library routines&n; * since not all Sparcs have the hardware to do it.&n; *&n; * TODO:&n; * do not blank the screen when frame buffer is mapped.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;linux/kbd_kern.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/consolemap.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &quot;fb.h&quot;
DECL|macro|cmapsz
mdefine_line|#define cmapsz 8192
macro_line|#include &quot;suncons_font.h&quot;
macro_line|#include &lt;asm/linux_logo.h&gt;
DECL|variable|fbinfo
id|fbinfo_t
op_star
id|fbinfo
suffix:semicolon
DECL|variable|fbinfos
r_int
id|fbinfos
suffix:semicolon
DECL|macro|ASM_BLITC
mdefine_line|#define ASM_BLITC
DECL|variable|sun_hw_cursor_shown
r_int
id|sun_hw_cursor_shown
op_assign
l_int|0
suffix:semicolon
r_void
id|sun_hw_hide_cursor
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|sun_hw_set_cursor
c_func
(paren
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_void
id|register_console
c_func
(paren
r_void
(paren
op_star
id|proc
)paren
(paren
r_const
r_char
op_star
)paren
)paren
suffix:semicolon
r_extern
r_void
id|console_print
c_func
(paren
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|putconsxy
c_func
(paren
r_int
comma
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_char
id|vga_font
(braket
)braket
suffix:semicolon
r_extern
r_int
id|serial_console
suffix:semicolon
DECL|variable|console_fb_path
r_char
op_star
id|console_fb_path
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Set in setup.c */
multiline_comment|/* The following variables describe a Sparc console. */
multiline_comment|/* Screen dimensions and color depth. */
DECL|variable|con_depth
DECL|variable|con_width
DECL|variable|con_height
DECL|variable|con_type
r_static
r_int
id|con_depth
comma
id|con_width
comma
id|con_height
comma
id|con_type
suffix:semicolon
multiline_comment|/* Base address of first line. */
DECL|variable|con_fb_base
r_static
r_int
r_char
op_star
id|con_fb_base
suffix:semicolon
multiline_comment|/* Screen parameters: we compute those at startup to make the code faster */
DECL|variable|chars_per_line
r_static
r_int
id|chars_per_line
suffix:semicolon
multiline_comment|/* number of bytes per line */
DECL|variable|ints_per_line
r_static
r_int
id|ints_per_line
suffix:semicolon
multiline_comment|/* number of ints per  line */
DECL|variable|ints_per_cursor
r_static
r_int
id|ints_per_cursor
suffix:semicolon
multiline_comment|/* 14 * ints_per_line */
DECL|variable|skip_bytes
r_static
r_int
id|skip_bytes
suffix:semicolon
multiline_comment|/* number of bytes we skip for the y margin + x_margin */
DECL|variable|x_margin
DECL|variable|y_margin
r_static
r_int
id|x_margin
comma
id|y_margin
suffix:semicolon
multiline_comment|/* the x and y margins */
DECL|variable|bytes_per_row
r_static
r_int
id|bytes_per_row
suffix:semicolon
multiline_comment|/* bytes used by one screen line (of 16 scan lines)  */
DECL|variable|sun_prom_console_id
r_int
id|sun_prom_console_id
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Functions used by the SPARC dependent console code&n; * to perform the fb_restore_palette function.&n; */
DECL|variable|fb_restore_palette
r_void
(paren
op_star
id|fb_restore_palette
)paren
(paren
id|fbinfo_t
op_star
id|fbinfo
)paren
suffix:semicolon
r_void
id|set_palette
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Our screen looks like at 1152 X 900:&n; *&n; *  0,0&n; *      ------------------------------------------------------------------&n; *      |                          ^^^^^^^^^^^                           |&n; *      |                          18 y-pixels                           |&n; *      |                          ^^^^^^^^^^^                           |&n; *   13 | &lt;-64 pixels-&gt;|  &lt;-- 128 8x16 characters --&gt;    | &lt;-64 pixels-&gt; |&n; *    ....&n; *                         54 chars from top to bottom&n; *    ....&n; *  888 | &lt;-64 pixels-&gt;|  &lt;-- 128 8x16 characters --&gt;    | &lt;-64 pixels-&gt; |&n; *      |                          ^^^^^^^^^^^                           |&n; *      |                          18 y-pixels                           |&n; *      |                          ^^^^^^^^^^^                           |&n; *      ------------------------------------------------------------------&n; */
multiline_comment|/* First for MONO displays. */
DECL|macro|SCREEN_WIDTH
mdefine_line|#define SCREEN_WIDTH     1152     /* Screen width in pixels  */
DECL|macro|SCREEN_HEIGHT
mdefine_line|#define SCREEN_HEIGHT    900      /* Screen height in pixels */
DECL|macro|CHARS_PER_LINE
mdefine_line|#define CHARS_PER_LINE   144      /* Make this empirical for speed */
DECL|macro|NICE_Y_MARGIN
mdefine_line|#define NICE_Y_MARGIN    18       /* We skip 18 y-pixels at top/bottom */
DECL|macro|NICE_X_MARGIN
mdefine_line|#define NICE_X_MARGIN    8        /* We skip 64 x-pixels at left/right */
DECL|macro|FBUF_TOP_SKIP
mdefine_line|#define FBUF_TOP_SKIP    2592     /* Empirical, (CHARS_PER_LINE * NICE_Y_MARGIN) */
DECL|macro|CHAR_HEIGHT
mdefine_line|#define CHAR_HEIGHT      16
DECL|macro|ONE_ROW
mdefine_line|#define ONE_ROW          2304     /* CHARS_PER_LINE * CHAR_HEIGHT */
multiline_comment|/* Now we have this, to compute the base frame buffer position&n; * for a new character to be rendered. 1 and 8 bit depth.&n; */
DECL|macro|FBUF_OFFSET
mdefine_line|#define FBUF_OFFSET(cindex) &bslash;&n;        (((FBUF_TOP_SKIP) + (((cindex)&gt;&gt;7) * ONE_ROW)) + &bslash;&n;&t; ((NICE_X_MARGIN) + (((cindex)&amp;127))))
DECL|macro|COLOR_FBUF_OFFSET
mdefine_line|#define COLOR_FBUF_OFFSET(cindex) (*color_fbuf_offset)(cindex)
multiline_comment|/* These four routines are optimizations for the _generic routine for&n; * the most common cases.&n; * I guess doing twice sll is much faster than doing .mul, sra faster&n; * than doing .div, and the disadvantage that someone has to call it&n; * (it cannot be inline) runs away, &squot;cause otherwise it would have to&n; * call .mul anyway. &n; * The shifting + addition only routines won&squot;t eat any stack frame :))&n; * Names come from width, screen_num_columns.&n; */
r_static
r_int
DECL|function|color_fbuf_offset_1280_144
id|color_fbuf_offset_1280_144
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|144
)paren
suffix:semicolon
multiline_comment|/* (1280 * CHAR_HEIGHT) == 101.0000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
id|i
op_lshift
l_int|12
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|144
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|color_fbuf_offset_1152_128
id|color_fbuf_offset_1152_128
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_rshift
l_int|7
)paren
suffix:semicolon
multiline_comment|/* (1152 * CHAR_HEIGHT) == 100.1000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
id|i
op_lshift
l_int|11
)paren
op_plus
(paren
(paren
id|cindex
op_amp
l_int|127
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|color_fbuf_offset_1024_128
id|color_fbuf_offset_1024_128
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_rshift
l_int|7
)paren
suffix:semicolon
multiline_comment|/* (1024 * CHAR_HEIGHT) == 100.0000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
(paren
id|cindex
op_amp
l_int|127
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|color_fbuf_offset_800_96
id|color_fbuf_offset_800_96
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|96
)paren
suffix:semicolon
multiline_comment|/* (800 * CHAR_HEIGHT) == 11.0010.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|13
)paren
op_plus
(paren
id|i
op_lshift
l_int|12
)paren
op_plus
(paren
id|i
op_lshift
l_int|9
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|96
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|color_fbuf_offset_640_80
id|color_fbuf_offset_640_80
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|80
)paren
suffix:semicolon
multiline_comment|/* (640 * CHAR_HEIGHT) == 10.1000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|13
)paren
op_plus
(paren
id|i
op_lshift
l_int|11
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|80
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|color_fbuf_offset_generic
id|color_fbuf_offset_generic
(paren
r_int
id|cindex
)paren
(brace
r_return
id|skip_bytes
op_plus
(paren
id|cindex
op_div
id|video_num_columns
)paren
op_star
id|bytes_per_row
op_plus
(paren
(paren
id|cindex
op_mod
id|video_num_columns
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|variable|color_fbuf_offset
r_static
r_int
(paren
op_star
id|color_fbuf_offset
)paren
(paren
r_int
)paren
op_assign
id|color_fbuf_offset_generic
suffix:semicolon
DECL|variable|do_accel
r_static
r_int
id|do_accel
op_assign
l_int|0
suffix:semicolon
r_void
DECL|function|__set_origin
id|__set_origin
c_func
(paren
r_int
r_int
id|offset
)paren
(brace
multiline_comment|/*&n;&t; * should not be called, but if so, do nothing...&n;&t; */
)brace
multiline_comment|/* For the cursor, we just invert the 8x16 block at the cursor&n; * location.  Easy enough...&n; *&n; * Hide the cursor from view, during blanking, usually...&n; */
DECL|variable|cursor_pos
r_static
r_int
id|cursor_pos
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|under_cursor
r_static
r_int
r_int
id|under_cursor
(braket
l_int|4
)braket
suffix:semicolon
r_void
DECL|function|hide_cursor
id|hide_cursor
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcursor
)paren
(brace
id|sun_hw_hide_cursor
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
multiline_comment|/* Don&squot;t paint anything on fb which is not ours,&n;&t;&t;&t;   but turn off the hw cursor in such case */
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cursor_pos
op_eq
op_minus
l_int|1
)paren
(brace
id|__restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|con_depth
)paren
(brace
r_case
l_int|1
suffix:colon
(brace
r_int
r_char
op_star
id|dst
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|FBUF_OFFSET
c_func
(paren
id|cursor_pos
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
suffix:semicolon
id|j
op_increment
comma
id|dst
op_add_assign
id|CHARS_PER_LINE
)paren
(brace
op_star
id|dst
op_assign
op_complement
(paren
op_star
id|dst
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
(brace
r_int
r_int
op_star
id|dst
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|COLOR_FBUF_OFFSET
c_func
(paren
id|cursor_pos
)paren
)paren
op_plus
id|ints_per_cursor
suffix:semicolon
id|dst
(braket
l_int|0
)braket
op_assign
id|under_cursor
(braket
l_int|0
)braket
suffix:semicolon
id|dst
(braket
l_int|1
)braket
op_assign
id|under_cursor
(braket
l_int|1
)braket
suffix:semicolon
id|dst
(braket
id|ints_per_line
)braket
op_assign
id|under_cursor
(braket
l_int|2
)braket
suffix:semicolon
id|dst
(braket
id|ints_per_line
op_plus
l_int|1
)braket
op_assign
id|under_cursor
(braket
l_int|3
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|cursor_pos
op_assign
op_minus
l_int|1
suffix:semicolon
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|set_cursor
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|j
comma
id|idx
comma
id|oldpos
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
op_logical_or
id|console_blanked
op_logical_or
id|vcmode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
macro_line|#if 0
multiline_comment|/* This is a nop anyway */
r_if
c_cond
(paren
id|__real_origin
op_ne
id|__origin
)paren
id|__set_origin
c_func
(paren
id|__real_origin
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcursor
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|deccm
)paren
id|hide_cursor
c_func
(paren
)paren
suffix:semicolon
r_else
(brace
id|idx
op_assign
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
id|sun_hw_set_cursor
c_func
(paren
id|x_margin
op_plus
(paren
(paren
id|idx
op_mod
id|video_num_columns
)paren
op_lshift
l_int|3
)paren
comma
id|y_margin
op_plus
(paren
(paren
id|idx
op_div
id|video_num_columns
)paren
op_star
id|CHAR_HEIGHT
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|idx
op_assign
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
id|oldpos
op_assign
id|cursor_pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|deccm
)paren
(brace
id|hide_cursor
(paren
)paren
suffix:semicolon
id|__restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cursor_pos
op_assign
id|idx
suffix:semicolon
r_switch
c_cond
(paren
id|con_depth
)paren
(brace
r_case
l_int|1
suffix:colon
(brace
r_int
r_char
op_star
id|dst
comma
op_star
id|opos
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|FBUF_OFFSET
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
id|opos
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|FBUF_OFFSET
c_func
(paren
id|oldpos
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|oldpos
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Restore what was at the old position */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
suffix:semicolon
id|j
op_increment
comma
id|opos
op_add_assign
id|CHARS_PER_LINE
)paren
(brace
op_star
id|opos
op_assign
op_complement
op_star
id|opos
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
comma
id|dst
op_add_assign
id|CHARS_PER_LINE
)paren
(brace
op_star
id|dst
op_assign
op_complement
op_star
id|dst
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
(brace
r_int
r_int
op_star
id|dst
comma
op_star
id|opos
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|COLOR_FBUF_OFFSET
c_func
(paren
id|idx
)paren
)paren
op_plus
id|ints_per_cursor
suffix:semicolon
r_if
c_cond
(paren
id|oldpos
op_ne
op_minus
l_int|1
)paren
(brace
id|opos
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
op_plus
id|COLOR_FBUF_OFFSET
c_func
(paren
id|oldpos
)paren
)paren
op_plus
id|ints_per_cursor
suffix:semicolon
id|opos
(braket
l_int|0
)braket
op_assign
id|under_cursor
(braket
l_int|0
)braket
suffix:semicolon
id|opos
(braket
l_int|1
)braket
op_assign
id|under_cursor
(braket
l_int|1
)braket
suffix:semicolon
id|opos
(braket
id|ints_per_line
)braket
op_assign
id|under_cursor
(braket
l_int|2
)braket
suffix:semicolon
id|opos
(braket
id|ints_per_line
op_plus
l_int|1
)braket
op_assign
id|under_cursor
(braket
l_int|3
)braket
suffix:semicolon
)brace
id|under_cursor
(braket
l_int|0
)braket
op_assign
id|dst
(braket
l_int|0
)braket
suffix:semicolon
id|under_cursor
(braket
l_int|1
)braket
op_assign
id|dst
(braket
l_int|1
)braket
suffix:semicolon
id|under_cursor
(braket
l_int|2
)braket
op_assign
id|dst
(braket
id|ints_per_line
)braket
suffix:semicolon
id|under_cursor
(braket
l_int|3
)braket
op_assign
id|dst
(braket
id|ints_per_line
op_plus
l_int|1
)braket
suffix:semicolon
id|dst
(braket
l_int|0
)braket
op_assign
l_int|0x00000000
suffix:semicolon
id|dst
(braket
l_int|1
)braket
op_assign
l_int|0x00000000
suffix:semicolon
id|dst
(braket
id|ints_per_line
)braket
op_assign
l_int|0x00000000
suffix:semicolon
id|dst
(braket
id|ints_per_line
op_plus
l_int|1
)braket
op_assign
l_int|0x00000000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
)brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Render the current screen&n; * Only used at startup and when switching from KD_GRAPHICS to KD_TEXT&n; * to avoid the caching that is being done in selection.h&n; */
r_void
DECL|function|render_screen
id|render_screen
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|contents
suffix:semicolon
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|contents
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|contents
op_increment
)paren
id|sun_blitc
(paren
op_star
id|contents
comma
(paren
r_int
r_int
)paren
id|contents
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|serial_finish_init
c_func
(paren
r_void
(paren
op_star
id|printfunc
)paren
(paren
r_const
r_char
op_star
comma
r_int
)paren
)paren
)paren
(brace
r_char
id|buffer
(braket
l_int|2048
)braket
suffix:semicolon
id|sprintf
(paren
id|buffer
comma
id|linux_serial_image
comma
id|UTS_RELEASE
)paren
suffix:semicolon
(paren
op_star
id|printfunc
)paren
(paren
id|buffer
comma
id|strlen
c_func
(paren
id|buffer
)paren
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|con_type_init_finish
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|i
comma
id|cpu
suffix:semicolon
r_char
op_star
id|p
op_assign
id|con_fb_base
op_plus
id|skip_bytes
suffix:semicolon
r_char
id|q
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|5
)brace
suffix:semicolon
r_int
id|currcons
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|ush
suffix:semicolon
r_if
c_cond
(paren
id|serial_console
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|con_type
op_eq
id|FBTYPE_SUNLEO
)paren
(brace
r_int
id|rects
(braket
l_int|4
)braket
suffix:semicolon
id|rects
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|2
)braket
op_assign
id|con_width
suffix:semicolon
id|rects
(braket
l_int|3
)braket
op_assign
id|con_height
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|fill
)paren
(paren
id|reverse_color_table
(braket
l_int|0
)braket
comma
l_int|1
comma
id|rects
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Dunno how to display logo on leo/zx yet */
)brace
r_if
c_cond
(paren
id|con_depth
op_eq
l_int|8
op_logical_and
id|fbinfo
(braket
l_int|0
)braket
dot
id|loadcmap
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LINUX_LOGO_COLORS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|0
)paren
op_assign
id|linux_logo_red
(braket
id|i
)braket
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|1
)paren
op_assign
id|linux_logo_green
(braket
id|i
)braket
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|2
)paren
op_assign
id|linux_logo_blue
(braket
id|i
)braket
suffix:semicolon
)brace
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|loadcmap
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
comma
l_int|0
comma
id|LINUX_LOGO_COLORS
op_plus
l_int|32
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|chars_per_line
)paren
(brace
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|linux_num_cpus
suffix:semicolon
id|cpu
op_increment
)paren
(brace
id|memcpy
(paren
id|p
op_plus
(paren
id|cpu
op_star
l_int|88
)paren
comma
id|linux_logo
op_plus
l_int|80
op_star
id|i
comma
l_int|80
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|con_depth
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|chars_per_line
)paren
id|memcpy
(paren
id|p
comma
id|linux_logo_bw
op_plus
l_int|10
op_star
id|i
comma
l_int|10
)paren
suffix:semicolon
)brace
id|putconsxy
c_func
(paren
l_int|0
comma
id|q
)paren
suffix:semicolon
id|ush
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_plus
id|video_num_columns
op_star
l_int|2
op_plus
l_int|20
op_plus
l_int|11
op_star
(paren
id|linux_num_cpus
op_minus
l_int|1
)paren
suffix:semicolon
id|p
op_assign
id|linux_logo_banner
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
comma
id|ush
op_increment
)paren
(brace
op_star
id|ush
op_assign
(paren
id|attr
op_lshift
l_int|8
)paren
op_plus
op_star
id|p
suffix:semicolon
id|sun_blitc
(paren
op_star
id|ush
comma
(paren
r_int
r_int
)paren
id|ush
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ush
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_plus
id|i
op_star
id|video_num_columns
suffix:semicolon
id|memset
(paren
id|ush
comma
l_int|0
comma
l_int|20
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|con_type_init
c_func
(paren
r_int
r_int
id|kmem_start
comma
r_const
r_char
op_star
op_star
id|display_desc
)paren
)paren
(brace
id|can_do_color
op_assign
(paren
id|con_type
op_ne
id|FBTYPE_SUN2BW
)paren
suffix:semicolon
id|video_type
op_assign
id|VIDEO_TYPE_SUN
suffix:semicolon
op_star
id|display_desc
op_assign
l_string|&quot;SUN&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|serial_console
)paren
(brace
multiline_comment|/* If we fall back to PROM then our output have to remain readable. */
id|prom_putchar
c_func
(paren
l_char|&squot;&bslash;033&squot;
)paren
suffix:semicolon
id|prom_putchar
c_func
(paren
l_char|&squot;[&squot;
)paren
suffix:semicolon
id|prom_putchar
c_func
(paren
l_char|&squot;H&squot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * fake the screen memory with some CPU memory&n;&t;&t; */
id|video_mem_base
op_assign
id|kmem_start
suffix:semicolon
id|kmem_start
op_add_assign
id|video_screen_size
suffix:semicolon
id|video_mem_term
op_assign
id|kmem_start
suffix:semicolon
)brace
r_return
id|kmem_start
suffix:semicolon
)brace
multiline_comment|/*&n; * NOTE: get_scrmem() and set_scrmem() are here only because&n; * the VGA version of set_scrmem() has some direct VGA references.&n; */
r_void
DECL|function|get_scrmem
id|get_scrmem
c_func
(paren
r_int
id|currcons
)paren
(brace
id|memcpyw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|origin
op_assign
id|video_mem_start
op_assign
(paren
r_int
r_int
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
suffix:semicolon
id|scr_end
op_assign
id|video_mem_end
op_assign
id|video_mem_start
op_plus
id|video_screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_void
DECL|function|set_scrmem
id|set_scrmem
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
r_if
c_cond
(paren
id|video_mem_term
op_minus
id|video_mem_base
OL
id|offset
op_plus
id|video_screen_size
)paren
id|offset
op_assign
l_int|0
suffix:semicolon
id|memcpyw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|video_mem_base
op_plus
id|offset
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|origin
op_assign
id|video_mem_base
op_plus
id|offset
suffix:semicolon
id|scr_end
op_assign
id|origin
op_plus
id|video_screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * PIO_FONT support.&n; */
r_int
DECL|function|set_get_font
id|set_get_font
c_func
(paren
r_char
op_star
id|arg
comma
r_int
id|set
comma
r_int
id|ch512
)paren
(brace
r_int
id|i
comma
id|line
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* download the current font */
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
(brace
r_if
c_cond
(paren
id|clear_user
c_func
(paren
id|arg
comma
id|cmapsz
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
(brace
r_int
r_char
id|value
op_assign
id|vga_font
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Access checked by the above clear_user */
id|__put_user_ret
(paren
id|value
comma
(paren
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set the font */
r_if
c_cond
(paren
id|verify_area
(paren
id|VERIFY_READ
comma
id|arg
comma
l_int|256
op_star
id|CHAR_HEIGHT
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
(brace
r_int
r_char
id|value
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|value
comma
(paren
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|vga_font
(braket
id|i
op_star
id|CHAR_HEIGHT
op_plus
id|line
)braket
op_assign
id|value
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Adjust the screen to fit a font of a certain height&n; *&n; * Returns &lt; 0 for error, 0 if nothing changed, and the number&n; * of lines on the adjusted console if changed.&n; *&n; * for now, we only support the built-in font...&n; */
r_int
DECL|function|con_adjust_height
id|con_adjust_height
c_func
(paren
r_int
r_int
id|fontheight
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_int
DECL|function|set_get_cmap
id|set_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|set
)paren
(brace
id|i
op_assign
id|VERIFY_READ
suffix:semicolon
)brace
r_else
id|i
op_assign
id|VERIFY_WRITE
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|i
comma
id|arg
comma
(paren
l_int|16
op_star
l_int|3
op_star
r_sizeof
(paren
r_int
r_char
)paren
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|set
)paren
(brace
id|__get_user_ret
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|0
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|1
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|2
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
r_else
(brace
id|__put_user_ret
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|0
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|1
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|2
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|arg
op_add_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|vc_cons_allocated
c_func
(paren
id|i
)paren
)paren
(brace
r_int
id|j
comma
id|k
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
)brace
id|set_palette
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|sun_clear_screen
id|sun_clear_screen
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|fill
)paren
(brace
r_int
id|rects
(braket
l_int|4
)braket
suffix:semicolon
id|rects
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|2
)braket
op_assign
id|con_width
suffix:semicolon
id|rects
(braket
l_int|3
)braket
op_assign
id|con_height
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|fill
)paren
(paren
id|reverse_color_table
(braket
l_int|0
)braket
comma
l_int|1
comma
id|rects
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|base
op_logical_and
id|fbinfo
(braket
l_int|0
)braket
dot
id|base_depth
)paren
id|memset
(paren
id|con_fb_base
comma
(paren
id|con_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
(paren
id|con_depth
op_star
id|con_height
op_star
id|con_width
)paren
op_div
l_int|8
)paren
suffix:semicolon
multiline_comment|/* also clear out the &quot;shadow&quot; screen memory */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|video_mem_base
comma
l_int|0
comma
(paren
id|video_mem_term
op_minus
id|video_mem_base
)paren
)paren
suffix:semicolon
id|cursor_pos
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|sun_clear_fb
id|sun_clear_fb
c_func
(paren
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
id|sun_clear_screen
(paren
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* This makes in some configurations serious problems. &n; * Who cares if other screens are cleared?&n; */
r_else
r_if
c_cond
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|fill
)paren
(brace
r_int
id|rects
(braket
l_int|4
)braket
suffix:semicolon
id|rects
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|rects
(braket
l_int|2
)braket
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_width
suffix:semicolon
id|rects
(braket
l_int|3
)braket
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_height
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
id|n
)braket
dot
id|fill
)paren
(paren
id|reverse_color_table
(braket
l_int|0
)braket
comma
l_int|1
comma
id|rects
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;
r_else
r_if
c_cond
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|base
op_logical_and
id|fbinfo
(braket
id|n
)braket
dot
id|base_depth
)paren
(brace
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|fbinfo
(braket
id|n
)braket
dot
id|base
comma
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|base_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|base_depth
op_star
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_height
op_star
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_width
)paren
op_div
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|sun_clear_margin
id|sun_clear_margin
c_func
(paren
r_void
)paren
(brace
r_int
id|h
comma
id|he
comma
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|fill
)paren
(brace
r_int
id|rects
(braket
l_int|16
)braket
suffix:semicolon
id|memset
(paren
id|rects
comma
l_int|0
comma
r_sizeof
(paren
id|rects
)paren
)paren
suffix:semicolon
id|rects
(braket
l_int|2
)braket
op_assign
id|con_width
suffix:semicolon
id|rects
(braket
l_int|3
)braket
op_assign
id|y_margin
suffix:semicolon
id|rects
(braket
l_int|5
)braket
op_assign
id|y_margin
suffix:semicolon
id|rects
(braket
l_int|6
)braket
op_assign
id|x_margin
suffix:semicolon
id|rects
(braket
l_int|7
)braket
op_assign
id|con_height
suffix:semicolon
id|rects
(braket
l_int|8
)braket
op_assign
id|con_width
op_minus
id|x_margin
suffix:semicolon
id|rects
(braket
l_int|9
)braket
op_assign
id|y_margin
suffix:semicolon
id|rects
(braket
l_int|10
)braket
op_assign
id|con_width
suffix:semicolon
id|rects
(braket
l_int|11
)braket
op_assign
id|con_height
suffix:semicolon
id|rects
(braket
l_int|12
)braket
op_assign
id|x_margin
suffix:semicolon
id|rects
(braket
l_int|13
)braket
op_assign
id|con_height
op_minus
id|y_margin
suffix:semicolon
id|rects
(braket
l_int|14
)braket
op_assign
id|con_width
op_minus
id|x_margin
suffix:semicolon
id|rects
(braket
l_int|15
)braket
op_assign
id|con_height
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|fill
)paren
(paren
id|reverse_color_table
(braket
l_int|0
)braket
comma
l_int|4
comma
id|rects
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
(paren
id|con_fb_base
comma
(paren
id|con_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|memset
(paren
id|con_fb_base
op_plus
id|chars_per_line
op_star
id|con_height
op_minus
id|skip_bytes
op_plus
(paren
id|x_margin
op_lshift
l_int|1
)paren
comma
(paren
id|con_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|he
op_assign
id|con_height
op_minus
l_int|2
op_star
id|y_margin
suffix:semicolon
id|i
op_assign
l_int|2
op_star
id|x_margin
suffix:semicolon
r_if
c_cond
(paren
id|con_depth
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|con_fb_base
op_plus
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
comma
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|he
suffix:semicolon
id|p
op_add_assign
id|chars_per_line
comma
id|h
op_increment
)paren
id|memset
(paren
id|p
comma
op_complement
(paren
l_int|0
)paren
comma
id|i
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|p
op_assign
id|con_fb_base
op_plus
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
comma
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|he
suffix:semicolon
id|p
op_add_assign
id|chars_per_line
comma
id|h
op_increment
)paren
id|memset
(paren
id|p
comma
id|reverse_color_table
(braket
l_int|0
)braket
comma
id|i
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|switch_from_graph
)paren
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|switch_from_graph
)paren
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * dummy routines for the VESA blanking code, which is VGA only,&n; * so we don&squot;t have to carry that stuff around for the Sparc...&n; */
DECL|function|vesa_blank
r_void
id|vesa_blank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|vesa_unblank
r_void
id|vesa_unblank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|set_vesa_blanking
r_void
id|set_vesa_blanking
c_func
(paren
r_const
r_int
r_int
id|arg
)paren
(brace
)brace
DECL|function|vesa_powerdown
r_void
id|vesa_powerdown
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/*&n; * We permutate the colors, so we match the PROM&squot;s idea of&n; * black and white.&n; */
DECL|variable|reverse_color_table
r_int
r_char
id|reverse_color_table
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|sparc_color_table
r_static
r_int
r_char
id|sparc_color_table
(braket
)braket
op_assign
(brace
l_int|15
comma
l_int|0
comma
l_int|4
comma
l_int|2
comma
l_int|6
comma
l_int|1
comma
l_int|5
comma
l_int|3
comma
l_int|7
comma
l_int|8
comma
l_int|12
comma
l_int|10
comma
l_int|14
comma
l_int|9
comma
l_int|13
comma
l_int|11
)brace
suffix:semicolon
multiline_comment|/* Call the frame buffer routine for setting the palette */
r_void
DECL|function|set_palette
id|set_palette
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|console_blanked
op_logical_or
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|loadcmap
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
multiline_comment|/* First keep color_map with the palette colors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
id|sparc_color_table
(braket
id|i
)braket
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|loadcmap
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|set_other_palette
id|set_other_palette
(paren
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
(brace
id|set_palette
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|loadcmap
)paren
(brace
id|fbinfo
(braket
id|n
)braket
dot
id|color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|0
)paren
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|2
)paren
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
id|n
)braket
dot
id|loadcmap
)paren
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Called when returning to prom */
r_void
DECL|function|console_restore_palette
id|console_restore_palette
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|fb_restore_palette
)paren
(paren
op_star
id|fb_restore_palette
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|get_phys
id|get_phys
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|__get_phys
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
r_int
DECL|function|get_iospace
id|get_iospace
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|__get_iospace
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|sun_cg_postsetup
c_func
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
r_int
id|start_mem
)paren
)paren
(brace
id|fb-&gt;color_map
op_assign
(paren
r_char
op_star
)paren
id|start_mem
suffix:semicolon
r_return
id|start_mem
op_plus
l_int|256
op_star
l_int|3
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_char
op_star
id|known_cards
(braket
)braket
id|__initdata
op_assign
(brace
l_string|&quot;cgsix&quot;
comma
l_string|&quot;cgthree&quot;
comma
l_string|&quot;cgRDI&quot;
comma
l_string|&quot;cgthree+&quot;
comma
l_string|&quot;bwtwo&quot;
comma
l_string|&quot;SUNW,tcx&quot;
comma
l_string|&quot;cgfourteen&quot;
comma
l_string|&quot;SUNW,leo&quot;
comma
l_string|&quot;SUNW,ffb&quot;
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
op_star
id|v0_known_cards
(braket
)braket
id|__initdata
op_assign
(brace
l_string|&quot;cgsix&quot;
comma
l_string|&quot;cgthree&quot;
comma
l_string|&quot;cgRDI&quot;
comma
l_string|&quot;cgthree+&quot;
comma
l_string|&quot;bwtwo&quot;
comma
l_int|0
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|known_card
(paren
r_char
op_star
id|name
comma
r_char
op_star
op_star
id|known_cards
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|known_cards
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|strcmp
(paren
id|name
comma
id|known_cards
(braket
id|i
)braket
)paren
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|depth
r_int
id|depth
suffix:semicolon
DECL|member|resx
DECL|member|resy
r_int
id|resx
comma
id|resy
suffix:semicolon
DECL|member|x_margin
DECL|member|y_margin
r_int
id|x_margin
comma
id|y_margin
suffix:semicolon
DECL|variable|scr_def
)brace
id|scr_def
(braket
)braket
op_assign
(brace
(brace
l_int|8
comma
l_int|1280
comma
l_int|1024
comma
l_int|64
comma
l_int|80
)brace
comma
(brace
l_int|8
comma
l_int|1152
comma
l_int|1024
comma
l_int|64
comma
l_int|80
)brace
comma
(brace
l_int|8
comma
l_int|1152
comma
l_int|900
comma
l_int|64
comma
l_int|18
)brace
comma
(brace
l_int|8
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|800
comma
l_int|600
comma
l_int|16
comma
l_int|12
)brace
comma
(brace
l_int|8
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|1
comma
l_int|1152
comma
l_int|900
comma
l_int|8
comma
l_int|18
)brace
comma
(brace
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|cg14_present
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|root
comma
id|n
suffix:semicolon
id|root
op_assign
id|prom_getchild
(paren
id|prom_root_node
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|prom_searchsiblings
(paren
id|root
comma
l_string|&quot;obio&quot;
)paren
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|n
op_assign
id|prom_getchild
(paren
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|prom_searchsiblings
(paren
id|n
comma
l_string|&quot;cgfourteen&quot;
)paren
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|creator_present
(paren
r_void
)paren
)paren
(brace
r_int
id|root
comma
id|n
suffix:semicolon
macro_line|#ifdef __sparc_v9__
id|root
op_assign
id|prom_getchild
(paren
id|prom_root_node
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|prom_searchsiblings
(paren
id|root
comma
l_string|&quot;SUNW,ffb&quot;
)paren
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|n
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sparc_framebuffer_setup
c_func
(paren
r_int
id|primary
comma
r_int
id|con_node
comma
r_int
id|type
comma
r_struct
id|linux_sbus_device
op_star
id|sbdp
comma
id|uint
id|base
comma
r_int
r_int
id|con_base
comma
r_int
id|prom_fb
comma
r_int
id|parent_node
)paren
)paren
(brace
r_static
r_int
id|frame_buffers
op_assign
l_int|1
suffix:semicolon
r_int
id|n
comma
id|i
suffix:semicolon
r_int
id|linebytes
suffix:semicolon
id|uint
id|io
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|primary
)paren
id|n
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|frame_buffers
op_eq
id|FRAME_BUFFERS
)paren
r_return
suffix:semicolon
multiline_comment|/* Silently ignore */
id|n
op_assign
id|frame_buffers
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prom_fb
)paren
id|sun_prom_console_id
op_assign
id|n
suffix:semicolon
r_if
c_cond
(paren
id|sbdp
)paren
id|io
op_assign
id|sbdp-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
suffix:semicolon
multiline_comment|/* Fill in common fb information */
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_type
op_assign
id|type
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|real_type
op_assign
id|type
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|prom_node
op_assign
id|con_node
suffix:semicolon
id|memset
(paren
op_amp
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|emulations
)paren
comma
l_int|0xff
comma
r_sizeof
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|emulations
)paren
)paren
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_height
op_assign
id|prom_getintdefault
c_func
(paren
id|con_node
comma
l_string|&quot;height&quot;
comma
l_int|900
)paren
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_width
op_assign
id|prom_getintdefault
c_func
(paren
id|con_node
comma
l_string|&quot;width&quot;
comma
l_int|1152
)paren
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_depth
op_assign
(paren
id|type
op_eq
id|FBTYPE_SUN2BW
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|8
suffix:semicolon
id|linebytes
op_assign
id|prom_getint
c_func
(paren
id|con_node
comma
l_string|&quot;linebytes&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|linebytes
op_eq
op_minus
l_int|1
)paren
id|linebytes
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_width
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_size
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|linebytes
)paren
op_star
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_height
)paren
)paren
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|space
op_assign
id|io
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|blanked
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|con_base
op_ge
id|PAGE_OFFSET
)paren
id|fbinfo
(braket
id|n
)braket
dot
id|base
op_assign
id|con_base
suffix:semicolon
r_else
id|fbinfo
(braket
id|n
)braket
dot
id|base
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|cursor.hwsize.fbx
op_assign
l_int|32
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|cursor.hwsize.fby
op_assign
l_int|32
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|proc_entry.node
op_assign
id|parent_node
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|proc_entry.rdev
op_assign
id|MKDEV
c_func
(paren
id|GRAPHDEV_MAJOR
comma
id|n
)paren
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|proc_entry.mode
op_assign
id|S_IFCHR
op_or
id|S_IRUSR
op_or
id|S_IWUSR
suffix:semicolon
id|prom_getname
(paren
id|con_node
comma
id|fbinfo
(braket
id|n
)braket
dot
id|proc_entry.name
comma
l_int|32
op_minus
l_int|3
)paren
suffix:semicolon
id|p
op_assign
id|strchr
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|proc_entry.name
comma
l_int|0
)paren
suffix:semicolon
id|sprintf
(paren
id|p
comma
l_string|&quot;:%d&quot;
comma
id|n
)paren
suffix:semicolon
multiline_comment|/* Should be filled in for supported video cards */
id|fbinfo
(braket
id|n
)braket
dot
id|mmap
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|loadcmap
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|ioctl
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|reset
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|blank
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|unblank
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|setcursor
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
id|n
)braket
dot
id|base_depth
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_depth
suffix:semicolon
multiline_comment|/* Per card setup */
r_switch
c_cond
(paren
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_type
)paren
(brace
macro_line|#ifdef SUN_FB_CGTHREE
r_case
id|FBTYPE_SUN3COLOR
suffix:colon
id|cg3_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|base
comma
id|io
comma
id|sbdp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUN_FB_TCX
r_case
id|FBTYPE_TCXCOLOR
suffix:colon
id|tcx_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|con_node
comma
id|base
comma
id|sbdp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUN_FB_CGSIX
r_case
id|FBTYPE_SUNFAST_COLOR
suffix:colon
id|cg6_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|base
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUN_FB_BWTWO
r_case
id|FBTYPE_SUN2BW
suffix:colon
id|bwtwo_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|base
comma
id|io
comma
id|sbdp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUN_FB_CGFOURTEEN
r_case
id|FBTYPE_MDICOLOR
suffix:colon
id|cg14_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|con_node
comma
id|base
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUN_FB_LEO
r_case
id|FBTYPE_SUNLEO
suffix:colon
id|leo_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|base
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if defined(SUN_FB_CREATOR) &amp;&amp; defined(__sparc_v9__)
r_case
id|FBTYPE_CREATOR
suffix:colon
id|creator_setup
(paren
op_amp
id|fbinfo
(braket
id|n
)braket
comma
id|n
comma
id|con_node
comma
id|base
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_type
op_assign
id|FBTYPE_NOTYPE
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
)paren
r_return
suffix:semicolon
multiline_comment|/* Code below here is just executed for the first frame buffer */
id|con_type
op_assign
id|type
suffix:semicolon
id|con_height
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_height
suffix:semicolon
id|con_width
op_assign
id|fbinfo
(braket
id|n
)braket
dot
id|type.fb_width
suffix:semicolon
id|con_depth
op_assign
(paren
id|type
op_eq
id|FBTYPE_SUN2BW
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|scr_def
(braket
id|i
)braket
dot
id|depth
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resx
op_ne
id|con_width
)paren
op_logical_or
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resy
op_ne
id|con_height
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|scr_def
(braket
id|i
)braket
dot
id|depth
op_ne
id|con_depth
)paren
r_continue
suffix:semicolon
id|x_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|x_margin
suffix:semicolon
id|y_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|y_margin
suffix:semicolon
id|chars_per_line
op_assign
(paren
id|con_width
op_star
id|con_depth
)paren
op_div
l_int|8
suffix:semicolon
id|skip_bytes
op_assign
id|chars_per_line
op_star
id|y_margin
op_plus
id|x_margin
suffix:semicolon
id|ints_per_line
op_assign
id|chars_per_line
op_div
l_int|4
suffix:semicolon
id|ints_per_cursor
op_assign
l_int|14
op_star
id|ints_per_line
suffix:semicolon
id|bytes_per_row
op_assign
id|CHAR_HEIGHT
op_star
id|chars_per_line
suffix:semicolon
id|ORIG_VIDEO_COLS
op_assign
id|con_width
op_div
l_int|8
op_minus
l_int|2
op_star
id|x_margin
op_div
id|con_depth
suffix:semicolon
id|ORIG_VIDEO_LINES
op_assign
(paren
id|con_height
op_minus
l_int|2
op_star
id|y_margin
)paren
op_div
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|chars_per_line
)paren
(brace
r_case
l_int|1280
suffix:colon
r_if
c_cond
(paren
id|ORIG_VIDEO_COLS
op_eq
l_int|144
)paren
id|color_fbuf_offset
op_assign
id|color_fbuf_offset_1280_144
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1152
suffix:colon
r_if
c_cond
(paren
id|ORIG_VIDEO_COLS
op_eq
l_int|128
)paren
id|color_fbuf_offset
op_assign
id|color_fbuf_offset_1152_128
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
id|ORIG_VIDEO_COLS
op_eq
l_int|128
)paren
id|color_fbuf_offset
op_assign
id|color_fbuf_offset_1024_128
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
r_if
c_cond
(paren
id|ORIG_VIDEO_COLS
op_eq
l_int|96
)paren
id|color_fbuf_offset
op_assign
id|color_fbuf_offset_800_96
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
r_if
c_cond
(paren
id|ORIG_VIDEO_COLS
op_eq
l_int|80
)paren
id|color_fbuf_offset
op_assign
id|color_fbuf_offset_640_80
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|scr_def
(braket
id|i
)braket
dot
id|depth
)paren
(brace
id|x_margin
op_assign
id|y_margin
op_assign
l_int|0
suffix:semicolon
id|prom_printf
(paren
l_string|&quot;console: unknown video resolution %dx%d,&quot;
l_string|&quot; depth %d&bslash;n&quot;
comma
id|con_width
comma
id|con_height
comma
id|con_depth
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* P3: I fear this strips 15inch 1024/768 PC-like&n;&t; * monitors out. */
r_if
c_cond
(paren
(paren
id|linebytes
op_star
l_int|8
)paren
op_div
id|con_depth
op_ne
id|con_width
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;console: unusual video, linebytes=%d, &quot;
l_string|&quot;width=%d, height=%d depth=%d&bslash;n&quot;
comma
id|linebytes
comma
id|con_width
comma
id|con_height
comma
id|con_depth
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|sparc_console_probe
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|propl
comma
id|con_node
comma
id|default_node
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_char
id|prop
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|linux_sbus_device
op_star
id|sbdp
comma
op_star
id|sbdprom
suffix:semicolon
r_struct
id|linux_sbus
op_star
id|sbus
suffix:semicolon
r_int
id|creator
op_assign
l_int|0
comma
id|cg14
op_assign
l_int|0
suffix:semicolon
r_char
id|prom_name
(braket
l_int|40
)braket
suffix:semicolon
r_int
id|type
comma
id|card_found
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|con_base
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|u32
id|prom_console_node
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FRAME_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
id|fbinfo
(braket
id|i
)braket
dot
id|type.fb_type
op_assign
id|FBTYPE_NOTYPE
suffix:semicolon
id|sbdprom
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|prom_vers
)paren
(brace
r_case
id|PROM_V0
suffix:colon
multiline_comment|/* V0 proms are at sun4c only. Can skip many checks. */
id|con_type
op_assign
id|FBTYPE_NOTYPE
suffix:semicolon
r_if
c_cond
(paren
id|SBus_chain
op_eq
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;SBUS chain is NULL, bailing out...&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|for_each_sbusdev
c_func
(paren
id|sbdp
comma
id|SBus_chain
)paren
(brace
multiline_comment|/* If no &quot;address&quot; than it is not the PROM console. */
r_if
c_cond
(paren
id|sbdp-&gt;num_vaddrs
)paren
(brace
r_if
c_cond
(paren
id|known_card
c_func
(paren
id|sbdp-&gt;prom_name
comma
id|v0_known_cards
)paren
)paren
(brace
id|sbdprom
op_assign
id|sbdp
suffix:semicolon
id|strncpy
c_func
(paren
id|prom_name
comma
id|sbdp-&gt;prom_name
comma
r_sizeof
(paren
id|prom_name
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|sbdprom
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|for_each_sbusdev
c_func
(paren
id|sbdp
comma
id|SBus_chain
)paren
(brace
id|con_node
op_assign
id|sbdp-&gt;prom_node
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgsix&quot;
comma
l_int|5
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgthree+&quot;
comma
l_int|8
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUNFAST_COLOR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgthree&quot;
comma
l_int|7
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgRDI&quot;
comma
l_int|5
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUN3COLOR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;bwtwo&quot;
comma
l_int|5
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUN2BW
suffix:semicolon
)brace
r_else
r_continue
suffix:semicolon
id|sparc_framebuffer_setup
(paren
id|sbdprom
op_eq
id|sbdp
comma
id|con_node
comma
id|type
comma
id|sbdp
comma
(paren
id|uint
)paren
id|sbdp-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
id|sbdp-&gt;sbus_vaddrs
(braket
l_int|0
)braket
comma
l_int|0
comma
id|sbdp-&gt;my_bus-&gt;prom_node
)paren
suffix:semicolon
multiline_comment|/* XXX HACK */
r_if
c_cond
(paren
id|sbdprom
op_eq
id|sbdp
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgRDI&quot;
comma
l_int|5
)paren
)paren
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PROM_V2
suffix:colon
r_case
id|PROM_V3
suffix:colon
r_case
id|PROM_P1275
suffix:colon
r_if
c_cond
(paren
id|console_fb_path
)paren
(brace
r_char
op_star
id|q
comma
id|c
suffix:semicolon
r_for
c_loop
(paren
id|q
op_assign
id|console_fb_path
suffix:semicolon
op_star
id|q
op_logical_and
op_star
id|q
op_ne
l_char|&squot; &squot;
suffix:semicolon
id|q
op_increment
)paren
suffix:semicolon
id|c
op_assign
op_star
id|q
suffix:semicolon
op_star
id|q
op_assign
l_int|0
suffix:semicolon
id|default_node
op_assign
id|prom_pathtoinode
c_func
(paren
id|console_fb_path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_node
)paren
(brace
id|prom_printf
(paren
l_string|&quot;Using %s for console&bslash;n&quot;
comma
id|console_fb_path
)paren
suffix:semicolon
id|prom_console_node
op_assign
id|prom_inst2pkg
c_func
(paren
id|prom_stdout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prom_console_node
op_eq
id|default_node
)paren
id|prom_console_node
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|default_node
)paren
id|default_node
op_assign
id|prom_inst2pkg
c_func
(paren
id|prom_stdout
)paren
suffix:semicolon
id|propl
op_assign
id|prom_getproperty
c_func
(paren
id|default_node
comma
l_string|&quot;device_type&quot;
comma
id|prop
comma
r_sizeof
(paren
id|prop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|propl
OL
l_int|0
)paren
(brace
id|prom_printf
(paren
l_string|&quot;output-device doesn&squot;t have device_type property&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|propl
op_ne
r_sizeof
(paren
l_string|&quot;display&quot;
)paren
op_logical_or
id|strncmp
c_func
(paren
l_string|&quot;display&quot;
comma
id|prop
comma
r_sizeof
(paren
l_string|&quot;display&quot;
)paren
)paren
)paren
(brace
id|prop
(braket
id|propl
)braket
op_assign
l_int|0
suffix:semicolon
id|prom_printf
(paren
l_string|&quot;console_probe: output-device is %s&quot;
l_string|&quot; (not &bslash;&quot;display&bslash;&quot;)&bslash;n&quot;
comma
id|prop
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
id|for_all_sbusdev
c_func
(paren
id|sbdp
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
(paren
id|sbdp-&gt;prom_node
op_eq
id|default_node
)paren
op_logical_and
id|known_card
(paren
id|sbdp-&gt;prom_name
comma
id|known_cards
)paren
)paren
(brace
id|sbdprom
op_assign
id|sbdp
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sbdprom
)paren
id|card_found
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card_found
)paren
id|card_found
op_assign
id|cg14
op_assign
id|cg14_present
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card_found
)paren
(brace
id|card_found
op_assign
id|creator
op_assign
id|creator_present
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|card_found
)paren
(brace
id|prom_printf
(paren
l_string|&quot;Could not find a known video card on this machine&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
id|for_all_sbusdev
c_func
(paren
id|sbdp
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|known_card
(paren
id|sbdp-&gt;prom_name
comma
id|known_cards
)paren
)paren
r_continue
suffix:semicolon
id|con_node
op_assign
id|sbdp-&gt;prom_node
suffix:semicolon
id|prom_apply_sbus_ranges
(paren
id|sbdp-&gt;my_bus
comma
op_amp
id|sbdp-&gt;reg_addrs
(braket
l_int|0
)braket
comma
id|sbdp-&gt;num_registers
comma
id|sbdp
)paren
suffix:semicolon
id|propl
op_assign
id|prom_getproperty
c_func
(paren
id|con_node
comma
l_string|&quot;address&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|tmp
comma
l_int|4
)paren
suffix:semicolon
id|con_base
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|propl
op_ne
l_int|4
)paren
id|con_base
op_assign
l_int|0
suffix:semicolon
id|propl
op_assign
id|prom_getproperty
c_func
(paren
id|con_node
comma
l_string|&quot;emulation&quot;
comma
id|prom_name
comma
r_sizeof
(paren
id|prom_name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|propl
OL
l_int|0
op_logical_or
id|propl
op_ge
r_sizeof
(paren
id|prom_name
)paren
)paren
(brace
multiline_comment|/* Early cg3s had no &quot;emulation&quot;. */
id|propl
op_assign
id|prom_getproperty
c_func
(paren
id|con_node
comma
l_string|&quot;name&quot;
comma
id|prom_name
comma
r_sizeof
(paren
id|prom_name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|propl
OL
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;console: no device name!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|prom_name
(braket
r_sizeof
(paren
id|prom_name
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;cgsix&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;cgthree+&quot;
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUNFAST_COLOR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;cgthree&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;cgRDI&quot;
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUN3COLOR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;cgfourteen&quot;
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_MDICOLOR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;SUNW,leo&quot;
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUNLEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;bwtwo&quot;
)paren
)paren
(brace
id|type
op_assign
id|FBTYPE_SUN2BW
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|prom_name
comma
l_string|&quot;SUNW,tcx&quot;
)paren
)paren
(brace
id|sparc_framebuffer_setup
(paren
id|sbdprom
op_eq
id|sbdp
comma
id|con_node
comma
id|FBTYPE_TCXCOLOR
comma
id|sbdp
comma
(paren
id|uint
)paren
id|sbdp-&gt;reg_addrs
(braket
l_int|10
)braket
dot
id|phys_addr
comma
id|con_base
comma
id|prom_console_node
op_eq
id|con_node
comma
id|sbdp-&gt;my_bus-&gt;prom_node
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|prom_printf
c_func
(paren
l_string|&quot;console: &bslash;&quot;%s&bslash;&quot; is unsupported&bslash;n&quot;
comma
id|prom_name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|sparc_framebuffer_setup
(paren
id|sbdprom
op_eq
id|sbdp
comma
id|con_node
comma
id|type
comma
id|sbdp
comma
(paren
id|uint
)paren
id|sbdp-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
id|con_base
comma
id|prom_console_node
op_eq
id|con_node
comma
id|sbdp-&gt;my_bus-&gt;prom_node
)paren
suffix:semicolon
multiline_comment|/* XXX HACK */
r_if
c_cond
(paren
id|sbdprom
op_eq
id|sbdp
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|sbdp-&gt;prom_name
comma
l_string|&quot;cgRDI&quot;
comma
l_int|5
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cg14
)paren
(brace
id|sparc_framebuffer_setup
(paren
op_logical_neg
id|sbdprom
comma
id|cg14
comma
id|FBTYPE_MDICOLOR
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|prom_console_node
op_eq
id|cg14
comma
id|prom_searchsiblings
(paren
id|prom_getchild
(paren
id|prom_root_node
)paren
comma
l_string|&quot;obio&quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|creator
)paren
(brace
id|sparc_framebuffer_setup
(paren
op_logical_neg
id|sbdprom
comma
id|creator
comma
id|FBTYPE_CREATOR
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|prom_console_node
op_eq
id|creator
comma
id|prom_root_node
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|type.fb_type
op_eq
id|FBTYPE_NOTYPE
)paren
(brace
id|prom_printf
(paren
l_string|&quot;Couldn&squot;t setup your primary frame buffer.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|blitc
)paren
id|do_accel
op_assign
l_int|1
suffix:semicolon
id|con_fb_base
op_assign
(paren
r_int
r_char
op_star
)paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|base
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|con_fb_base
)paren
(brace
id|prom_printf
(paren
l_string|&quot;PROM does not have an &squot;address&squot; property for this&bslash;n&quot;
l_string|&quot;frame buffer and the Linux drivers do not know how&bslash;n&quot;
l_string|&quot;to map the video of this device&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
r_return
id|fb_init
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* video init code, called from within the SBUS bus scanner at&n; * boot time.&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|sun_console_init
c_func
(paren
r_int
r_int
id|memory_start
)paren
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|serial_console
)paren
(brace
r_return
id|memory_start
suffix:semicolon
)brace
id|fbinfo
op_assign
(paren
id|fbinfo_t
op_star
)paren
id|memory_start
suffix:semicolon
id|memset
(paren
id|fbinfo
comma
l_int|0
comma
id|FRAME_BUFFERS
op_star
r_sizeof
(paren
id|fbinfo_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sparc_console_probe
c_func
(paren
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Could not probe console, bailing out...&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|sun_clear_screen
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|FRAME_BUFFERS
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|i
op_minus
l_int|1
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
r_break
suffix:semicolon
id|fbinfos
op_assign
id|i
suffix:semicolon
id|memory_start
op_assign
id|memory_start
op_plus
id|i
op_star
r_sizeof
(paren
id|fbinfo_t
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|postsetup
)paren
id|memory_start
op_assign
(paren
op_star
id|fbinfo
(braket
id|j
)braket
dot
id|postsetup
)paren
(paren
id|fbinfo
op_plus
id|j
comma
id|memory_start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
(brace
id|sun_clear_fb
c_func
(paren
id|j
)paren
suffix:semicolon
id|set_other_palette
c_func
(paren
id|j
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; ( defined(CONFIG_SUN_OPENPROMFS) || defined(CONFIG_SUN_OPENPROMFS_MODULE) )
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fbinfo
(braket
id|j
)braket
dot
id|type.fb_type
op_ne
id|FBTYPE_NOTYPE
)paren
id|proc_openprom_regdev
(paren
op_amp
id|fbinfo
(braket
id|j
)braket
dot
id|proc_entry
)paren
suffix:semicolon
macro_line|#endif
r_return
id|memory_start
suffix:semicolon
)brace
multiline_comment|/*&n; * sun_blitc&n; *&n; * Displays an ASCII character at a specified character cell&n; *  position.&n; *&n; * Called from scr_writew() when the destination is&n; *  the &quot;shadow&quot; screen&n; */
r_static
id|uint
DECL|variable|fontmask_bits
id|fontmask_bits
(braket
l_int|16
)braket
op_assign
(brace
l_int|0x00000000
comma
l_int|0x000000ff
comma
l_int|0x0000ff00
comma
l_int|0x0000ffff
comma
l_int|0x00ff0000
comma
l_int|0x00ff00ff
comma
l_int|0x00ffff00
comma
l_int|0x00ffffff
comma
l_int|0xff000000
comma
l_int|0xff0000ff
comma
l_int|0xff00ff00
comma
l_int|0xff00ffff
comma
l_int|0xffff0000
comma
l_int|0xffff00ff
comma
l_int|0xffffff00
comma
l_int|0xffffffff
)brace
suffix:semicolon
r_int
DECL|function|sun_blitc
id|sun_blitc
c_func
(paren
id|uint
id|charattr
comma
r_int
r_int
id|addr
)paren
(brace
r_int
r_int
id|fgmask
comma
id|bgmask
suffix:semicolon
r_int
r_char
id|attrib
suffix:semicolon
r_int
id|j
comma
id|idx
suffix:semicolon
r_int
r_char
op_star
id|font_row
suffix:semicolon
r_if
c_cond
(paren
id|do_accel
)paren
(brace
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|blitc
)paren
(paren
id|charattr
comma
id|x_margin
op_plus
(paren
(paren
(paren
id|addr
op_minus
id|video_mem_base
)paren
op_mod
id|video_size_row
)paren
op_lshift
l_int|2
)paren
comma
id|y_margin
op_plus
id|CHAR_HEIGHT
op_star
(paren
(paren
id|addr
op_minus
id|video_mem_base
)paren
op_div
id|video_size_row
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Invalidate the cursor position if necessary. */
id|idx
op_assign
(paren
id|addr
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
id|attrib
op_assign
id|CHARATTR_TO_SUNCOLOR
c_func
(paren
id|charattr
)paren
suffix:semicolon
id|font_row
op_assign
op_amp
id|vga_font
(braket
(paren
id|j
op_assign
(paren
id|charattr
op_amp
l_int|0xff
)paren
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|con_depth
)paren
(brace
r_case
l_int|1
suffix:colon
(brace
r_register
r_int
r_char
op_star
id|dst
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
)paren
op_plus
id|FBUF_OFFSET
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|charattr
op_amp
l_int|0xf000
)paren
)paren
op_xor
(paren
id|idx
op_eq
id|cursor_pos
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
suffix:semicolon
id|j
op_increment
comma
id|font_row
op_increment
comma
id|dst
op_add_assign
id|CHARS_PER_LINE
)paren
(brace
op_star
id|dst
op_assign
op_complement
(paren
op_star
id|font_row
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
suffix:semicolon
id|j
op_increment
comma
id|font_row
op_increment
comma
id|dst
op_add_assign
id|CHARS_PER_LINE
)paren
(brace
op_star
id|dst
op_assign
op_star
id|font_row
suffix:semicolon
)brace
)brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
(brace
macro_line|#ifdef ASM_BLITC&t;&t;
r_const
r_int
id|cpl
op_assign
id|chars_per_line
suffix:semicolon
multiline_comment|/* The register assignment is important here, do not modify without touching the assembly code as well */
r_register
r_int
r_int
id|x1
id|__asm__
c_func
(paren
l_string|&quot;g4&quot;
)paren
comma
id|x2
id|__asm__
c_func
(paren
l_string|&quot;g5&quot;
)paren
comma
id|x3
id|__asm__
c_func
(paren
l_string|&quot;g2&quot;
)paren
comma
id|x4
id|__asm__
c_func
(paren
l_string|&quot;g3&quot;
)paren
comma
id|flags
id|__asm__
c_func
(paren
l_string|&quot;g7&quot;
)paren
suffix:semicolon
r_register
r_int
r_int
op_star
id|dst
id|__asm__
c_func
(paren
l_string|&quot;g1&quot;
)paren
suffix:semicolon
macro_line|#else&t;&t;
r_const
r_int
id|ipl
op_assign
id|ints_per_line
suffix:semicolon
r_int
r_int
id|data2
comma
id|data3
comma
id|data4
suffix:semicolon
r_int
r_int
id|data
comma
id|rowbits
suffix:semicolon
r_register
r_int
r_int
op_star
id|dst
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#endif&t;&t;
r_const
id|uint
op_star
id|fontm_bits
op_assign
id|fontmask_bits
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|con_fb_base
)paren
op_plus
id|COLOR_FBUF_OFFSET
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_char|&squot; &squot;
)paren
multiline_comment|/* space is quite common, so we optimize a bit */
(brace
macro_line|#ifdef ASM_BLITC
DECL|macro|BLITC_SPACE
mdefine_line|#define BLITC_SPACE &bslash;&n;&t;&t;&quot;&bslash;n&bslash;t std&t;%%g4, [%%g1]&quot; &bslash;&n;&t;&t;&quot;&bslash;n&bslash;t std&t;%%g4, [%%g1 + %0]&quot; &bslash;&n;&t;&t;&quot;&bslash;n&bslash;t add&t;%%g1, %1, %%g1&quot;
DECL|macro|BLITC_SPC
mdefine_line|#define BLITC_SPC &bslash;&n;&t;&t;&quot;&bslash;n&bslash;t std&t;%0, [%1]&quot; &bslash;&n;&t;&t;&quot;&bslash;n&bslash;t std&t;%0, [%1 + %2]&quot;
id|x1
op_assign
id|attrib
op_rshift
l_int|4
suffix:semicolon
id|x1
op_or_assign
id|x1
op_lshift
l_int|8
suffix:semicolon
id|x1
op_or_assign
id|x1
op_lshift
l_int|16
suffix:semicolon
id|x3
op_assign
id|cpl
op_lshift
l_int|1
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;&bslash;n&bslash;t mov&t;%2, %3&quot;
id|BLITC_SPACE
id|BLITC_SPACE
id|BLITC_SPACE
id|BLITC_SPACE
id|BLITC_SPACE
id|BLITC_SPACE
id|BLITC_SPACE
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|cpl
)paren
comma
l_string|&quot;r&quot;
(paren
id|x3
)paren
comma
l_string|&quot;r&quot;
(paren
id|x1
)paren
comma
l_string|&quot;r&quot;
(paren
id|x2
)paren
)paren
suffix:semicolon
id|__save_and_cli
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ne
id|cursor_pos
)paren
id|__asm__
id|__volatile__
(paren
id|BLITC_SPC
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|x1
)paren
comma
l_string|&quot;r&quot;
(paren
id|dst
)paren
comma
l_string|&quot;r&quot;
(paren
id|cpl
)paren
)paren
suffix:semicolon
r_else
id|__asm__
id|__volatile__
(paren
id|BLITC_SPC
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|x1
)paren
comma
l_string|&quot;r&quot;
(paren
id|under_cursor
)paren
comma
l_string|&quot;i&quot;
(paren
l_int|8
)paren
)paren
suffix:semicolon
id|__restore_flags
(paren
id|flags
)paren
suffix:semicolon
macro_line|#else
id|bgmask
op_assign
id|attrib
op_rshift
l_int|4
suffix:semicolon
id|bgmask
op_or_assign
id|bgmask
op_lshift
l_int|8
suffix:semicolon
id|bgmask
op_or_assign
id|bgmask
op_lshift
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
op_minus
l_int|2
suffix:semicolon
id|j
op_increment
comma
id|font_row
op_increment
comma
id|dst
op_add_assign
id|ipl
)paren
(brace
op_star
id|dst
op_assign
id|bgmask
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|bgmask
suffix:semicolon
)brace
multiline_comment|/* Prevent cursor spots left on the screen */
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ne
id|cursor_pos
)paren
(brace
op_star
id|dst
op_assign
id|bgmask
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|bgmask
suffix:semicolon
id|dst
op_add_assign
id|ipl
suffix:semicolon
op_star
id|dst
op_assign
id|bgmask
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|bgmask
suffix:semicolon
)brace
r_else
(brace
id|under_cursor
(braket
l_int|0
)braket
op_assign
id|bgmask
suffix:semicolon
id|under_cursor
(braket
l_int|1
)braket
op_assign
id|bgmask
suffix:semicolon
id|under_cursor
(braket
l_int|2
)braket
op_assign
id|bgmask
suffix:semicolon
id|under_cursor
(braket
l_int|3
)braket
op_assign
id|bgmask
suffix:semicolon
)brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
multiline_comment|/* non-space */
(brace
id|fgmask
op_assign
id|attrib
op_amp
l_int|0x0f
suffix:semicolon
id|bgmask
op_assign
id|attrib
op_rshift
l_int|4
suffix:semicolon
id|fgmask
op_or_assign
id|fgmask
op_lshift
l_int|8
suffix:semicolon
id|fgmask
op_or_assign
id|fgmask
op_lshift
l_int|16
suffix:semicolon
id|bgmask
op_or_assign
id|bgmask
op_lshift
l_int|8
suffix:semicolon
id|bgmask
op_or_assign
id|bgmask
op_lshift
l_int|16
suffix:semicolon
macro_line|#ifdef ASM_BLITC
DECL|macro|BLITC_INIT
mdefine_line|#define BLITC_INIT &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t ld&t;[%0], %%g2&quot;
DECL|macro|BLITC_BODY
mdefine_line|#define BLITC_BODY(ST1,SC1,ST2,SC2)  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t &quot; #ST1 &quot;&t;%%g2, &quot; #SC1 &quot;, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t &quot; #ST2 &quot;&t;%%g2, &quot; #SC2 &quot;, %7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%%g7, 0x3c, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%7, 0x3c, %7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t ld&t;[%1 + %%g7], %6&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%6, %2, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t andn&t;%3, %6, %6&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t or&t;%%g7, %6, %6&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t ld&t;[%1 + %7], %7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%7, %2, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t andn&t;%3, %7, %7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t or&t;%%g7, %7, %7&quot;
DECL|macro|BLITC_BODYEND
mdefine_line|#define BLITC_BODYEND &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t sll&t;%3, 2, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t srl&t;%3, 2, %3&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%%g7, 0x3c, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%3, 0x3c, %3&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t ld&t;[%0 + %%g7], %4&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%4, %1, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t andn&t;%2, %4, %4&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t or&t;%%g7, %4, %4&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t ld&t;[%0 + %3], %3&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t and&t;%3, %1, %%g7&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t andn&t;%2, %3, %3&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t or&t;%%g7, %3, %3&quot;
DECL|macro|BLITC_STOREIT
mdefine_line|#define BLITC_STOREIT &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t std&t;%6, [%5]&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t add&t;%5, %4, %5&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t&quot; 
DECL|macro|BLITC_STORE
mdefine_line|#define BLITC_STORE &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t std&t;%%g4, [%0]&quot;  &bslash;&n;&t;&t;&t;&quot;&bslash;n&bslash;t std&t;%%g2, [%0 + %1]&quot;
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|3
suffix:semicolon
id|j
op_increment
comma
id|font_row
op_add_assign
l_int|4
)paren
(brace
id|__asm__
id|__volatile__
(paren
id|BLITC_INIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|26
comma
id|srl
comma
l_int|22
)paren
id|BLITC_STOREIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|18
comma
id|srl
comma
l_int|14
)paren
id|BLITC_STOREIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|10
comma
id|srl
comma
l_int|6
)paren
id|BLITC_STOREIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|2
comma
id|sll
comma
l_int|2
)paren
id|BLITC_STOREIT
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|font_row
)paren
comma
l_string|&quot;r&quot;
(paren
id|fontm_bits
)paren
comma
l_string|&quot;r&quot;
(paren
id|fgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|bgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|cpl
)paren
comma
l_string|&quot;r&quot;
(paren
id|dst
)paren
comma
l_string|&quot;r&quot;
(paren
id|x1
)paren
comma
l_string|&quot;r&quot;
(paren
id|x2
)paren
)paren
suffix:semicolon
)brace
id|__asm__
id|__volatile__
(paren
id|BLITC_INIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|26
comma
id|srl
comma
l_int|22
)paren
id|BLITC_STOREIT
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|18
comma
id|srl
comma
l_int|14
)paren
id|BLITC_STOREIT
multiline_comment|/* Now prepare date for the 15th line, but don&squot;t put it anywhere yet (leave it in g4,g5) */
id|BLITC_BODY
c_func
(paren
id|srl
comma
l_int|10
comma
id|srl
comma
l_int|6
)paren
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|font_row
)paren
comma
l_string|&quot;r&quot;
(paren
id|fontm_bits
)paren
comma
l_string|&quot;r&quot;
(paren
id|fgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|bgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|cpl
)paren
comma
l_string|&quot;r&quot;
(paren
id|dst
)paren
comma
l_string|&quot;r&quot;
(paren
id|x1
)paren
comma
l_string|&quot;r&quot;
(paren
id|x2
)paren
)paren
suffix:semicolon
multiline_comment|/* Prepare the data the bottom line (and put it into g2,g3) */
id|__asm__
id|__volatile__
(paren
id|BLITC_BODYEND
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|fontm_bits
)paren
comma
l_string|&quot;r&quot;
(paren
id|fgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|bgmask
)paren
comma
l_string|&quot;r&quot;
(paren
id|x3
)paren
comma
l_string|&quot;r&quot;
(paren
id|x4
)paren
)paren
suffix:semicolon
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ne
id|cursor_pos
)paren
id|__asm__
id|__volatile__
(paren
id|BLITC_STORE
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|dst
)paren
comma
l_string|&quot;r&quot;
(paren
id|cpl
)paren
)paren
suffix:semicolon
r_else
id|__asm__
id|__volatile__
(paren
id|BLITC_STORE
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|under_cursor
)paren
comma
l_string|&quot;i&quot;
(paren
l_int|8
)paren
)paren
suffix:semicolon
id|__restore_flags
(paren
id|flags
)paren
suffix:semicolon
macro_line|#else
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CHAR_HEIGHT
op_minus
l_int|2
suffix:semicolon
id|j
op_increment
comma
id|font_row
op_increment
comma
id|dst
op_add_assign
id|ipl
)paren
(brace
id|rowbits
op_assign
op_star
id|font_row
suffix:semicolon
id|data
op_assign
id|fontm_bits
(braket
(paren
id|rowbits
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data
op_assign
(paren
id|data
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data
op_amp
id|bgmask
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|data
suffix:semicolon
id|data
op_assign
id|fontm_bits
(braket
id|rowbits
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data
op_assign
(paren
id|data
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data
op_amp
id|bgmask
)paren
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|data
suffix:semicolon
)brace
id|rowbits
op_assign
op_star
id|font_row
suffix:semicolon
id|data
op_assign
id|fontm_bits
(braket
(paren
id|rowbits
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data
op_assign
(paren
id|data
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data
op_amp
id|bgmask
)paren
suffix:semicolon
id|data2
op_assign
id|fontm_bits
(braket
id|rowbits
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data2
op_assign
(paren
id|data2
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data2
op_amp
id|bgmask
)paren
suffix:semicolon
id|rowbits
op_assign
id|font_row
(braket
l_int|1
)braket
suffix:semicolon
id|data3
op_assign
id|fontm_bits
(braket
(paren
id|rowbits
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data3
op_assign
(paren
id|data3
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data3
op_amp
id|bgmask
)paren
suffix:semicolon
id|data4
op_assign
id|fontm_bits
(braket
id|rowbits
op_amp
l_int|0xf
)braket
suffix:semicolon
id|data4
op_assign
(paren
id|data4
op_amp
id|fgmask
)paren
op_or
(paren
op_complement
id|data4
op_amp
id|bgmask
)paren
suffix:semicolon
multiline_comment|/* Prevent cursor spots left on the screen */
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ne
id|cursor_pos
)paren
(brace
op_star
id|dst
op_assign
id|data
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|data2
suffix:semicolon
id|dst
op_add_assign
id|ipl
suffix:semicolon
op_star
id|dst
op_assign
id|data3
suffix:semicolon
op_star
(paren
id|dst
op_plus
l_int|1
)paren
op_assign
id|data4
suffix:semicolon
)brace
r_else
(brace
id|under_cursor
(braket
l_int|0
)braket
op_assign
id|data
suffix:semicolon
id|under_cursor
(braket
l_int|1
)braket
op_assign
id|data2
suffix:semicolon
id|under_cursor
(braket
l_int|2
)braket
op_assign
id|data3
suffix:semicolon
id|under_cursor
(braket
l_int|3
)braket
op_assign
id|data4
suffix:semicolon
)brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* case */
)brace
multiline_comment|/* switch */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|memsetw
r_void
id|memsetw
c_func
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|addr
op_assign
(paren
r_int
r_int
op_star
)paren
id|s
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
op_star
id|addr
op_increment
op_assign
id|c
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|addr
op_plus
id|count
OG
id|video_mem_term
op_logical_or
(paren
r_int
r_int
)paren
id|addr
OL
id|video_mem_base
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|addr
op_plus
id|count
op_le
id|video_mem_term
op_logical_or
(paren
r_int
r_int
)paren
id|addr
OG
id|video_mem_base
)paren
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
op_star
id|addr
op_increment
op_assign
id|c
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|scr_writew
c_func
(paren
id|c
comma
id|addr
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|macro|GX_SETW
mdefine_line|#define GX_SETW (*fbinfo[0].setw)(x_margin + ((xoff - (addr - last)) &lt;&lt; 3), y_margin + CHAR_HEIGHT * yoff, c, addr - last);
)brace
r_else
r_if
c_cond
(paren
id|do_accel
)paren
(brace
r_int
id|yoff
op_assign
(paren
id|addr
op_minus
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
)paren
op_div
id|video_num_columns
suffix:semicolon
r_int
id|xoff
op_assign
(paren
id|addr
op_minus
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
)paren
op_mod
id|video_num_columns
suffix:semicolon
r_int
r_int
op_star
id|last
op_assign
id|addr
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_star
id|addr
op_ne
id|c
)paren
(brace
r_if
c_cond
(paren
id|xoff
op_eq
id|video_num_columns
)paren
(brace
r_if
c_cond
(paren
id|last
op_ne
id|addr
)paren
id|GX_SETW
id|xoff
op_assign
l_int|0
suffix:semicolon
id|yoff
op_increment
suffix:semicolon
id|last
op_assign
id|addr
suffix:semicolon
)brace
op_star
id|addr
op_increment
op_assign
id|c
suffix:semicolon
id|xoff
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|last
op_ne
id|addr
)paren
id|GX_SETW
r_if
c_cond
(paren
id|xoff
op_eq
id|video_num_columns
)paren
(brace
id|xoff
op_assign
l_int|0
suffix:semicolon
id|yoff
op_increment
suffix:semicolon
)brace
id|addr
op_increment
suffix:semicolon
id|xoff
op_increment
suffix:semicolon
id|last
op_assign
id|addr
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|last
op_ne
id|addr
)paren
id|GX_SETW
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_star
id|addr
op_ne
id|c
)paren
(brace
id|sun_blitc
c_func
(paren
id|c
comma
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
op_star
id|addr
op_increment
op_assign
id|c
suffix:semicolon
)brace
r_else
id|addr
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|memcpyw
r_void
id|memcpyw
c_func
(paren
r_int
r_int
op_star
id|to
comma
r_int
r_int
op_star
id|from
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
(brace
id|memcpy
c_func
(paren
id|to
comma
id|from
comma
id|count
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|to
op_plus
id|count
OG
id|video_mem_term
op_logical_or
(paren
r_int
r_int
)paren
id|to
OL
id|video_mem_base
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|to
op_plus
id|count
op_le
id|video_mem_term
op_logical_or
(paren
r_int
r_int
)paren
id|to
OG
id|video_mem_base
)paren
id|memcpy
c_func
(paren
id|to
comma
id|from
comma
id|count
)paren
suffix:semicolon
r_else
(brace
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|scr_writew
c_func
(paren
id|scr_readw
c_func
(paren
id|from
op_increment
)paren
comma
id|to
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|macro|GX_CPYW
mdefine_line|#define GX_CPYW (*fbinfo[0].cpyw)(x_margin + ((xoff - (to - last)) &lt;&lt; 3), y_margin + CHAR_HEIGHT * yoff, last, to - last);
)brace
r_else
r_if
c_cond
(paren
id|do_accel
)paren
(brace
r_int
id|yoff
op_assign
(paren
id|to
op_minus
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
)paren
op_div
id|video_num_columns
suffix:semicolon
r_int
id|xoff
op_assign
(paren
id|to
op_minus
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
)paren
op_mod
id|video_num_columns
suffix:semicolon
r_int
r_int
op_star
id|last
op_assign
id|to
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_star
id|to
op_ne
op_star
id|from
)paren
(brace
r_if
c_cond
(paren
id|xoff
op_eq
id|video_num_columns
)paren
(brace
r_if
c_cond
(paren
id|last
op_ne
id|to
)paren
id|GX_CPYW
id|xoff
op_assign
l_int|0
suffix:semicolon
id|yoff
op_increment
suffix:semicolon
id|last
op_assign
id|to
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|last
op_ne
id|to
op_logical_and
(paren
op_star
id|last
op_amp
l_int|0xff00
)paren
op_ne
(paren
op_star
id|from
op_amp
l_int|0xff00
)paren
)paren
(brace
id|GX_CPYW
id|last
op_assign
id|to
suffix:semicolon
)brace
op_star
id|to
op_increment
op_assign
op_star
id|from
op_increment
suffix:semicolon
id|xoff
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|last
op_ne
id|to
)paren
id|GX_CPYW
r_if
c_cond
(paren
id|xoff
op_eq
id|video_num_columns
)paren
(brace
id|xoff
op_assign
l_int|0
suffix:semicolon
id|yoff
op_increment
suffix:semicolon
)brace
id|to
op_increment
suffix:semicolon
id|xoff
op_increment
suffix:semicolon
id|last
op_assign
id|to
suffix:semicolon
id|from
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|last
op_ne
id|to
)paren
id|GX_CPYW
)brace
r_else
(brace
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_star
id|to
op_ne
op_star
id|from
)paren
(brace
id|sun_blitc
c_func
(paren
op_star
id|from
comma
(paren
r_int
r_int
)paren
id|to
)paren
suffix:semicolon
op_star
id|to
op_increment
op_assign
op_star
id|from
op_increment
suffix:semicolon
)brace
r_else
(brace
id|from
op_increment
suffix:semicolon
id|to
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|macro|pos
macro_line|#undef pos
r_int
DECL|function|sun_hw_scursor
id|sun_hw_scursor
(paren
r_struct
id|fbcursor
op_star
id|cursor
comma
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_int
id|op
suffix:semicolon
r_int
id|i
comma
id|bytes
op_assign
l_int|0
suffix:semicolon
r_struct
id|fbcursor
id|f
suffix:semicolon
r_char
id|red
(braket
l_int|2
)braket
comma
id|green
(braket
l_int|2
)braket
comma
id|blue
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|f
comma
id|cursor
comma
r_sizeof
(paren
r_struct
id|fbcursor
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|op
op_assign
id|f.set
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETSHAPE
)paren
(brace
r_if
c_cond
(paren
(paren
id|uint
)paren
id|f.size.fbx
OG
id|fb-&gt;cursor.hwsize.fbx
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|uint
)paren
id|f.size.fby
OG
id|fb-&gt;cursor.hwsize.fby
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|f.size.fbx
OG
l_int|32
)paren
id|bytes
op_assign
id|f.size.fby
op_lshift
l_int|3
suffix:semicolon
r_else
id|bytes
op_assign
id|f.size.fby
op_lshift
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETCMAP
)paren
(brace
r_if
c_cond
(paren
id|f.cmap.index
op_logical_or
id|f.cmap.count
op_ne
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
id|red
comma
id|f.cmap.red
comma
l_int|2
)paren
op_logical_or
id|copy_from_user
(paren
id|green
comma
id|f.cmap.green
comma
l_int|2
)paren
op_logical_or
id|copy_from_user
(paren
id|blue
comma
id|f.cmap.blue
comma
l_int|2
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETCMAP
)paren
(paren
op_star
id|fb-&gt;setcursormap
)paren
(paren
id|fb
comma
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETSHAPE
)paren
(brace
id|uint
id|u
suffix:semicolon
id|fb-&gt;cursor.size
op_assign
id|f.size
suffix:semicolon
id|memset
(paren
(paren
r_void
op_star
)paren
op_amp
id|fb-&gt;cursor.bits
comma
l_int|0
comma
r_sizeof
(paren
id|fb-&gt;cursor.bits
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
comma
id|f.mask
comma
id|bytes
)paren
op_logical_or
id|copy_from_user
(paren
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
comma
id|f.image
comma
id|bytes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|f.size.fbx
op_le
l_int|32
)paren
(brace
id|u
op_assign
op_complement
(paren
l_int|0xffffffff
op_rshift
id|f.size.fbx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|fb-&gt;cursor.size.fby
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
id|i
)braket
op_and_assign
id|u
suffix:semicolon
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
(braket
id|i
)braket
op_and_assign
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|u
op_assign
op_complement
(paren
l_int|0xffffffff
op_rshift
(paren
id|f.size.fbx
op_minus
l_int|32
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|fb-&gt;cursor.size.fby
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
l_int|2
op_star
id|i
op_plus
l_int|1
)braket
op_and_assign
id|u
suffix:semicolon
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
(braket
l_int|2
op_star
id|i
)braket
op_and_assign
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
l_int|2
op_star
id|i
)braket
suffix:semicolon
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
(braket
l_int|2
op_star
id|i
op_plus
l_int|1
)braket
op_and_assign
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
l_int|2
op_star
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
)brace
(paren
op_star
id|fb-&gt;setcurshape
)paren
(paren
id|fb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op
op_amp
(paren
id|FB_CUR_SETCUR
op_or
id|FB_CUR_SETPOS
op_or
id|FB_CUR_SETHOT
)paren
)paren
(brace
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETCUR
)paren
id|fb-&gt;cursor.enable
op_assign
id|f.enable
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETPOS
)paren
id|fb-&gt;cursor.cpos
op_assign
id|f.pos
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
id|FB_CUR_SETHOT
)paren
id|fb-&gt;cursor.chot
op_assign
id|f.hot
suffix:semicolon
(paren
op_star
id|fb-&gt;setcursor
)paren
(paren
id|fb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hw_cursor_cmap
r_static
r_int
r_char
id|hw_cursor_cmap
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0xff
)brace
suffix:semicolon
r_void
DECL|function|sun_hw_hide_cursor
id|sun_hw_hide_cursor
(paren
r_void
)paren
(brace
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.enable
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcursor
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sun_hw_cursor_shown
op_assign
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|sun_hw_set_cursor
id|sun_hw_set_cursor
(paren
r_int
id|xoff
comma
r_int
id|yoff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sun_hw_cursor_shown
)paren
(brace
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.size.fbx
op_assign
id|CHAR_WIDTH
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.size.fby
op_assign
id|CHAR_HEIGHT
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.chot.fbx
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.chot.fby
op_assign
l_int|0
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.enable
op_assign
l_int|1
suffix:semicolon
id|memset
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
comma
l_int|0
comma
r_sizeof
(paren
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
)paren
)paren
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
(braket
l_int|0
)braket
(braket
id|CHAR_HEIGHT
op_minus
l_int|2
)braket
op_assign
l_int|0xff000000
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
(braket
l_int|1
)braket
(braket
id|CHAR_HEIGHT
op_minus
l_int|2
)braket
op_assign
l_int|0xff000000
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
(braket
l_int|0
)braket
(braket
id|CHAR_HEIGHT
op_minus
l_int|1
)braket
op_assign
l_int|0xff000000
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.bits
(braket
l_int|1
)braket
(braket
id|CHAR_HEIGHT
op_minus
l_int|1
)braket
op_assign
l_int|0xff000000
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcursormap
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
comma
id|hw_cursor_cmap
comma
id|hw_cursor_cmap
comma
id|hw_cursor_cmap
)paren
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcurshape
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sun_hw_cursor_shown
op_assign
l_int|1
suffix:semicolon
)brace
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.cpos.fbx
op_assign
id|xoff
suffix:semicolon
id|fbinfo
(braket
l_int|0
)braket
dot
id|cursor.cpos.fby
op_assign
id|yoff
suffix:semicolon
(paren
op_star
id|fbinfo
(braket
l_int|0
)braket
dot
id|setcursor
)paren
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
eof
