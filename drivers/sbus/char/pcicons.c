multiline_comment|/* $Id: pcicons.c,v 1.17 1998/05/03 21:56:10 davem Exp $&n; * pcicons.c: PCI specific probing and console operations layer.&n; *&n; * Copyright (C) 1997 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#ifdef CONFIG_PCI
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/pbm.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &quot;pcicons.h&quot;
macro_line|#include &quot;fb.h&quot;
DECL|variable|x_margin
r_static
r_int
id|x_margin
op_assign
l_int|0
suffix:semicolon
DECL|variable|y_margin
r_static
r_int
id|y_margin
op_assign
l_int|0
suffix:semicolon
DECL|variable|skip_bytes
r_static
r_int
id|skip_bytes
suffix:semicolon
DECL|variable|cursor_screen_pos
r_static
id|__u64
op_star
id|cursor_screen_pos
suffix:semicolon
DECL|variable|cursor_bits
r_static
id|__u64
id|cursor_bits
(braket
l_int|2
)braket
suffix:semicolon
DECL|variable|cursor_pos
r_static
r_int
id|cursor_pos
op_assign
op_minus
l_int|1
suffix:semicolon
r_extern
r_int
id|serial_console
suffix:semicolon
r_extern
r_struct
id|console
id|vt_console_driver
suffix:semicolon
r_static
r_void
id|pci_install_consops
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|fbuf_offset
r_static
r_int
(paren
op_star
id|fbuf_offset
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|function|color_fbuf_offset_1280_144
r_static
r_int
id|color_fbuf_offset_1280_144
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|144
)paren
suffix:semicolon
multiline_comment|/* (1280 * CHAR_HEIGHT) == 101.0000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
id|i
op_lshift
l_int|12
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|144
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|color_fbuf_offset_1152_128
r_static
r_int
id|color_fbuf_offset_1152_128
c_func
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_rshift
l_int|7
)paren
suffix:semicolon
multiline_comment|/* (1152 * CHAR_HEIGHT) == 100.1000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
id|i
op_lshift
l_int|11
)paren
op_plus
(paren
(paren
id|cindex
op_amp
l_int|127
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|color_fbuf_offset_1024_128
r_static
r_int
id|color_fbuf_offset_1024_128
c_func
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_rshift
l_int|7
)paren
suffix:semicolon
multiline_comment|/* (1024 * CHAR_HEIGHT) == 100.0000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|14
)paren
op_plus
(paren
(paren
id|cindex
op_amp
l_int|127
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|color_fbuf_offset_800_96
r_static
r_int
id|color_fbuf_offset_800_96
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|96
)paren
suffix:semicolon
multiline_comment|/* (800 * CHAR_HEIGHT) == 11.0010.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|13
)paren
op_plus
(paren
id|i
op_lshift
l_int|12
)paren
op_plus
(paren
id|i
op_lshift
l_int|9
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|96
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|color_fbuf_offset_640_80
r_static
r_int
id|color_fbuf_offset_640_80
(paren
r_int
id|cindex
)paren
(brace
r_register
r_int
id|i
op_assign
(paren
id|cindex
op_div
l_int|80
)paren
suffix:semicolon
multiline_comment|/* (640 * CHAR_HEIGHT) == 10.1000.0000.0000 */
r_return
id|skip_bytes
op_plus
(paren
id|i
op_lshift
l_int|13
)paren
op_plus
(paren
id|i
op_lshift
l_int|11
)paren
op_plus
(paren
(paren
id|cindex
op_mod
l_int|80
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|color_fbuf_offset_generic
r_static
r_int
id|color_fbuf_offset_generic
(paren
r_int
id|cindex
)paren
(brace
macro_line|#if 0
multiline_comment|/* XXX Implement me -DaveM */
r_return
id|skip_bytes
op_plus
(paren
id|cindex
op_div
id|video_num_columns
)paren
op_star
id|bytes_per_row
op_plus
(paren
(paren
id|cindex
op_mod
id|video_num_columns
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|expand_bits_8
r_static
id|__u32
id|expand_bits_8
(braket
l_int|16
)braket
op_assign
(brace
l_int|0x00000000
comma
l_int|0x000000ff
comma
l_int|0x0000ff00
comma
l_int|0x0000ffff
comma
l_int|0x00ff0000
comma
l_int|0x00ff00ff
comma
l_int|0x00ffff00
comma
l_int|0x00ffffff
comma
l_int|0xff000000
comma
l_int|0xff0000ff
comma
l_int|0xff00ff00
comma
l_int|0xff00ffff
comma
l_int|0xffff0000
comma
l_int|0xffff00ff
comma
l_int|0xffffff00
comma
l_int|0xffffffff
)brace
suffix:semicolon
DECL|function|pci_blitc
r_static
r_void
id|pci_blitc
c_func
(paren
r_int
r_int
id|charattr
comma
r_int
r_int
id|addr
)paren
(brace
r_static
r_int
id|cached_attr
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
id|__u32
id|fg
comma
id|bg
suffix:semicolon
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
id|__u32
op_star
id|screen
suffix:semicolon
r_int
r_char
id|attrib
suffix:semicolon
r_int
r_char
op_star
id|fp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|idx
suffix:semicolon
r_if
c_cond
(paren
(paren
id|charattr
op_amp
l_int|0xff00
)paren
op_ne
id|cached_attr
)paren
(brace
id|cached_attr
op_assign
id|charattr
suffix:semicolon
id|attrib
op_assign
id|CHARATTR_TO_SUNCOLOR
c_func
(paren
id|charattr
)paren
suffix:semicolon
id|fg
op_assign
id|attrib
op_amp
l_int|0x0f
suffix:semicolon
id|fg
op_or_assign
id|fg
op_lshift
l_int|8
suffix:semicolon
id|fg
op_or_assign
id|fg
op_lshift
l_int|16
suffix:semicolon
id|bg
op_assign
id|attrib
op_rshift
l_int|4
suffix:semicolon
id|bg
op_or_assign
id|bg
op_lshift
l_int|8
suffix:semicolon
id|bg
op_or_assign
id|bg
op_lshift
l_int|16
suffix:semicolon
id|fg
op_xor_assign
id|bg
suffix:semicolon
)brace
id|idx
op_assign
(paren
id|addr
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cursor_pos
op_eq
id|idx
)paren
id|cursor_pos
op_assign
op_minus
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|screen
op_assign
(paren
id|__u32
op_star
)paren
(paren
id|fb-&gt;base
op_plus
id|fbuf_offset
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
id|fp
op_assign
op_amp
id|vga_font
(braket
(paren
id|charattr
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|bits
op_assign
op_star
id|fp
op_increment
suffix:semicolon
id|screen
(braket
l_int|0
)braket
op_assign
(paren
id|expand_bits_8
(braket
id|bits
op_rshift
l_int|4
)braket
op_amp
id|fg
)paren
op_xor
id|bg
suffix:semicolon
id|screen
(braket
l_int|1
)braket
op_assign
(paren
id|expand_bits_8
(braket
id|bits
op_amp
l_int|0x0f
)braket
op_amp
id|fg
)paren
op_xor
id|bg
suffix:semicolon
id|screen
op_assign
(paren
id|__u32
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|screen
)paren
op_plus
id|fb-&gt;linebytes
)paren
suffix:semicolon
)brace
)brace
DECL|function|pci_memsetw
r_static
r_void
id|pci_memsetw
c_func
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|s
suffix:semicolon
id|count
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
(brace
r_while
c_loop
(paren
id|count
)paren
(brace
op_decrement
id|count
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|c
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|p
op_plus
id|count
)paren
OG
id|video_mem_base
op_logical_and
(paren
r_int
r_int
)paren
id|p
OL
id|video_mem_term
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|p
OL
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_logical_and
id|count
suffix:semicolon
id|count
op_decrement
)paren
op_star
id|p
op_increment
op_assign
id|c
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|p
OL
(paren
r_int
r_int
op_star
)paren
id|video_mem_term
op_logical_and
id|count
suffix:semicolon
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_ne
id|c
)paren
(brace
op_star
id|p
op_assign
id|c
suffix:semicolon
id|pci_blitc
c_func
(paren
id|c
comma
(paren
r_int
r_int
)paren
id|p
)paren
suffix:semicolon
)brace
op_increment
id|p
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
op_star
id|p
op_increment
op_assign
id|c
suffix:semicolon
)brace
DECL|function|pci_memcpyw
r_static
r_void
id|pci_memcpyw
c_func
(paren
r_int
r_int
op_star
id|dst
comma
r_int
r_int
op_star
id|src
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
id|count
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|dst
op_plus
id|count
)paren
OG
id|video_mem_base
op_logical_and
(paren
r_int
r_int
)paren
id|dst
OL
id|video_mem_term
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|dst
OL
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_logical_and
id|count
suffix:semicolon
id|count
op_decrement
)paren
op_star
id|dst
op_increment
op_assign
op_star
id|src
op_increment
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dst
OL
(paren
r_int
r_int
op_star
)paren
id|video_mem_term
op_logical_and
id|count
suffix:semicolon
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|src
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|dst
op_ne
id|c
)paren
(brace
op_star
id|dst
op_assign
id|c
suffix:semicolon
id|pci_blitc
c_func
(paren
id|c
comma
(paren
r_int
r_int
)paren
id|dst
)paren
suffix:semicolon
)brace
op_increment
id|dst
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
op_star
id|dst
op_increment
op_assign
op_star
id|src
op_increment
suffix:semicolon
)brace
DECL|function|pci_scr_writew
r_static
r_void
id|pci_scr_writew
c_func
(paren
r_int
r_int
id|val
comma
r_int
r_int
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
op_star
id|addr
op_ne
id|val
)paren
(brace
op_star
id|addr
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|addr
OL
id|video_mem_term
op_logical_and
(paren
r_int
r_int
)paren
id|addr
op_ge
id|video_mem_base
op_logical_and
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
id|pci_blitc
c_func
(paren
id|val
comma
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
)brace
)brace
DECL|function|pci_scr_readw
r_static
r_int
r_int
id|pci_scr_readw
c_func
(paren
r_int
r_int
op_star
id|addr
)paren
(brace
r_return
op_star
id|addr
suffix:semicolon
)brace
DECL|function|pci_get_scrmem
r_static
r_void
id|pci_get_scrmem
c_func
(paren
r_int
id|currcons
)paren
(brace
r_struct
id|vc_data
op_star
id|vcd
op_assign
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
suffix:semicolon
id|memcpyw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|vcd-&gt;vc_origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|vcd-&gt;vc_origin
op_assign
id|vcd-&gt;vc_video_mem_start
op_assign
(paren
r_int
r_int
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
suffix:semicolon
id|vcd-&gt;vc_scr_end
op_assign
id|vcd-&gt;vc_video_mem_end
op_assign
id|vcd-&gt;vc_video_mem_start
op_plus
id|video_screen_size
suffix:semicolon
id|vcd-&gt;vc_pos
op_assign
id|vcd-&gt;vc_origin
op_plus
id|vcd-&gt;vc_y
op_star
id|video_size_row
op_plus
(paren
id|vcd-&gt;vc_x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pci_set_scrmem
r_static
r_void
id|pci_set_scrmem
c_func
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
r_struct
id|vc_data
op_star
id|vcd
op_assign
id|vc_cons
(braket
id|currcons
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|video_mem_term
op_minus
id|video_mem_base
OL
id|offset
op_plus
id|video_screen_size
)paren
id|offset
op_assign
l_int|0
suffix:semicolon
id|memcpyw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|video_mem_base
op_plus
id|offset
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|vcd-&gt;vc_origin
comma
id|video_screen_size
)paren
suffix:semicolon
id|vcd-&gt;vc_video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|vcd-&gt;vc_video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|vcd-&gt;vc_origin
op_assign
id|video_mem_base
op_plus
id|offset
suffix:semicolon
id|vcd-&gt;vc_scr_end
op_assign
id|vcd-&gt;vc_origin
op_plus
id|video_screen_size
suffix:semicolon
id|vcd-&gt;vc_pos
op_assign
id|vcd-&gt;vc_origin
op_plus
id|vcd-&gt;vc_y
op_star
id|video_size_row
op_plus
(paren
id|vcd-&gt;vc_x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pci_invert_cursor
r_static
r_void
id|pci_invert_cursor
c_func
(paren
r_int
id|cpos
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
id|__u64
op_star
id|screen
suffix:semicolon
r_if
c_cond
(paren
id|cpos
op_eq
op_minus
l_int|1
)paren
(brace
id|screen
op_assign
id|cursor_screen_pos
suffix:semicolon
op_star
id|screen
op_assign
id|cursor_bits
(braket
l_int|0
)braket
suffix:semicolon
id|screen
op_assign
(paren
id|__u64
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|screen
op_plus
id|fb-&gt;linebytes
)paren
suffix:semicolon
op_star
id|screen
op_assign
id|cursor_bits
(braket
l_int|1
)braket
suffix:semicolon
r_return
suffix:semicolon
)brace
id|screen
op_assign
(paren
id|__u64
op_star
)paren
(paren
id|fb-&gt;base
op_plus
id|fbuf_offset
c_func
(paren
id|cpos
)paren
op_plus
l_int|14
op_star
id|fb-&gt;linebytes
)paren
suffix:semicolon
id|cursor_screen_pos
op_assign
id|screen
suffix:semicolon
id|cursor_bits
(braket
l_int|0
)braket
op_assign
op_star
id|screen
suffix:semicolon
op_star
id|screen
op_assign
l_int|0x0000000000000000
suffix:semicolon
id|screen
op_assign
(paren
id|__u64
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|screen
op_plus
id|fb-&gt;linebytes
)paren
suffix:semicolon
id|cursor_bits
(braket
l_int|1
)braket
op_assign
op_star
id|screen
suffix:semicolon
op_star
id|screen
op_assign
l_int|0x0000000000000000
suffix:semicolon
)brace
DECL|function|pci_hide_cursor
r_static
r_void
id|pci_hide_cursor
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cursor_pos
op_ne
op_minus
l_int|1
)paren
id|pci_invert_cursor
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|pci_set_cursor
r_static
r_void
id|pci_set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|old_cursor
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
op_logical_or
id|console_blanked
op_logical_or
id|vt_cons
(braket
id|currcons
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_deccm
)paren
(brace
id|pci_hide_cursor
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|old_cursor
op_assign
id|cursor_pos
suffix:semicolon
id|cursor_pos
op_assign
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|old_cursor
op_ne
op_minus
l_int|1
)paren
id|pci_invert_cursor
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|pci_invert_cursor
c_func
(paren
id|cursor_pos
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|pci_set_palette
r_static
r_void
id|pci_set_palette
c_func
(paren
r_void
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
op_logical_or
id|vt_cons
(braket
id|fg_console
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_GRAPHICS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;loadcmap
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
id|sparc_color_table
(braket
id|i
)braket
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
id|fb
op_member_access_from_pointer
id|loadcmap
c_func
(paren
id|fb
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
)brace
)brace
DECL|function|pci_set_other_palette
r_static
r_void
id|pci_set_other_palette
c_func
(paren
r_int
id|n
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
id|n
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
(brace
id|pci_set_palette
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb-&gt;loadcmap
)paren
(brace
id|fb-&gt;color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|0
)paren
op_assign
l_int|0
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
l_int|0
comma
l_int|2
)paren
op_assign
l_int|0
suffix:semicolon
id|fb
op_member_access_from_pointer
id|loadcmap
c_func
(paren
id|fb
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|pci_restore_palette
r_static
r_void
id|pci_restore_palette
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|fb_restore_palette
)paren
id|fb_restore_palette
c_func
(paren
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|pci_set_get_font
r_static
r_int
id|pci_set_get_font
c_func
(paren
r_char
op_star
id|arg
comma
r_int
id|set
comma
r_int
id|ch512
)paren
(brace
r_int
id|i
comma
id|line
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
(brace
r_if
c_cond
(paren
id|clear_user
c_func
(paren
id|arg
comma
r_sizeof
(paren
id|vga_font
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
(brace
r_int
r_char
id|value
suffix:semicolon
id|value
op_assign
id|vga_font
(braket
id|i
op_star
id|CHAR_HEIGHT
op_plus
id|line
)braket
suffix:semicolon
id|__put_user_ret
c_func
(paren
id|value
comma
(paren
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|arg
comma
l_int|256
op_star
id|CHAR_HEIGHT
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
(brace
r_int
r_char
id|value
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|value
comma
(paren
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|vga_font
(braket
id|i
op_star
id|CHAR_HEIGHT
op_plus
id|line
)braket
op_assign
id|value
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pci_con_adjust_height
r_static
r_int
id|pci_con_adjust_height
c_func
(paren
r_int
r_int
id|fontheight
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|pci_set_get_cmap
r_static
r_int
id|pci_set_get_cmap
c_func
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|set
)paren
id|i
op_assign
id|VERIFY_READ
suffix:semicolon
r_else
id|i
op_assign
id|VERIFY_WRITE
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|i
comma
id|arg
comma
(paren
l_int|16
op_star
l_int|3
op_star
r_sizeof
(paren
r_int
r_char
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|set
)paren
(brace
id|__get_user_ret
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|0
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|1
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|2
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
r_else
(brace
id|__put_user_ret
c_func
(paren
id|default_red
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|0
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
c_func
(paren
id|default_grn
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|1
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
c_func
(paren
id|default_blu
(braket
id|i
)braket
comma
(paren
id|arg
op_plus
l_int|2
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
id|arg
op_add_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vc_cons_allocated
c_func
(paren
id|i
)paren
)paren
(brace
r_int
id|j
comma
id|k
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_red
(braket
id|i
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_grn
(braket
id|i
)braket
suffix:semicolon
id|vc_cons
(braket
id|i
)braket
dot
id|d-&gt;vc_palette
(braket
id|k
op_increment
)braket
op_assign
id|default_blu
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
)brace
id|pci_set_palette
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|pci_clear_screen
r_static
r_void
id|pci_clear_screen
c_func
(paren
r_void
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;base
)paren
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|fb-&gt;base
comma
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
(paren
id|fb-&gt;type.fb_depth
op_star
id|fb-&gt;type.fb_height
op_star
id|fb-&gt;type.fb_width
)paren
op_div
l_int|8
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|video_mem_base
comma
l_int|0
comma
(paren
id|video_mem_term
op_minus
id|video_mem_base
)paren
)paren
suffix:semicolon
)brace
DECL|function|pci_clear_fb
r_static
r_void
id|pci_clear_fb
c_func
(paren
r_int
id|n
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
id|n
)braket
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
(brace
id|pci_clear_screen
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|fb-&gt;base
)paren
(brace
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|fb-&gt;base
comma
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
(paren
id|fb-&gt;type.fb_depth
op_star
id|fb-&gt;type.fb_height
op_star
id|fb-&gt;type.fb_width
)paren
op_div
l_int|8
)paren
suffix:semicolon
)brace
)brace
DECL|function|pci_render_screen
r_static
r_void
id|pci_render_screen
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|p
op_increment
)paren
id|pci_blitc
c_func
(paren
op_star
id|p
comma
(paren
r_int
r_int
)paren
id|p
)paren
suffix:semicolon
)brace
DECL|function|pci_clear_margin
r_static
r_void
id|pci_clear_margin
c_func
(paren
r_void
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
r_int
id|h
comma
id|he
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|fb-&gt;base
comma
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|fb-&gt;base
op_plus
id|fb-&gt;linebytes
op_star
id|fb-&gt;type.fb_height
op_minus
id|skip_bytes
op_plus
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
comma
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
ques
c_cond
op_complement
(paren
l_int|0
)paren
suffix:colon
id|reverse_color_table
(braket
l_int|0
)braket
comma
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|he
op_assign
id|fb-&gt;type.fb_height
op_minus
l_int|2
op_star
id|y_margin
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|fb-&gt;base
op_plus
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
comma
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|he
suffix:semicolon
id|p
op_add_assign
id|fb-&gt;linebytes
comma
id|h
op_increment
)paren
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|p
comma
op_complement
(paren
l_int|0
)paren
comma
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|p
op_assign
id|fb-&gt;base
op_plus
id|skip_bytes
op_minus
(paren
id|x_margin
op_lshift
l_int|1
)paren
comma
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|he
suffix:semicolon
id|p
op_add_assign
id|fb-&gt;linebytes
comma
id|h
op_increment
)paren
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|p
comma
id|reverse_color_table
(braket
l_int|0
)braket
comma
(paren
id|x_margin
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb-&gt;switch_from_graph
)paren
id|fb
op_member_access_from_pointer
id|switch_from_graph
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pci_postsetup
r_static
r_void
id|pci_postsetup
c_func
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|fb-&gt;color_map
op_assign
id|kmalloc
c_func
(paren
id|fb-&gt;type.fb_cmsize
op_star
l_int|3
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|pci_set_palette
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|pci_con_type_init
c_func
(paren
r_const
r_char
op_star
op_star
id|display_desc
)paren
)paren
(brace
id|can_do_color
op_assign
l_int|1
suffix:semicolon
id|video_type
op_assign
id|VIDEO_TYPE_SUNPCI
suffix:semicolon
op_star
id|display_desc
op_assign
l_string|&quot;SUNPCI&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|serial_console
)paren
(brace
multiline_comment|/* If we fall back to PROM then our output&n;&t;&t; * have to remain readable.&n;&t;&t; */
id|prom_putchar
c_func
(paren
l_char|&squot;&bslash;033&squot;
)paren
suffix:semicolon
id|prom_putchar
c_func
(paren
l_char|&squot;[&squot;
)paren
suffix:semicolon
id|prom_putchar
c_func
(paren
l_char|&squot;H&squot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Fake the screen memory with some CPU memory&n;&t;&t; */
id|video_mem_base
op_assign
(paren
r_int
r_int
)paren
id|kmalloc
c_func
(paren
id|video_screen_size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|video_mem_term
op_assign
(paren
id|video_mem_base
op_plus
id|video_screen_size
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|pci_con_type_init_finish
c_func
(paren
r_void
)paren
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|fb-&gt;base
op_plus
id|skip_bytes
suffix:semicolon
r_char
id|q
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|5
)brace
suffix:semicolon
r_int
r_int
op_star
id|ush
suffix:semicolon
r_int
id|currcons
op_assign
l_int|0
suffix:semicolon
r_int
id|cpu
comma
id|ncpus
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|serial_console
)paren
r_return
suffix:semicolon
id|ncpus
op_assign
id|linux_num_cpus
suffix:semicolon
r_if
c_cond
(paren
id|ncpus
OG
l_int|4
)paren
id|ncpus
op_assign
l_int|4
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|fb-&gt;draw_penguin
)paren
id|fb
op_member_access_from_pointer
id|draw_penguin
c_func
(paren
id|x_margin
comma
id|y_margin
comma
id|ncpus
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|8
op_logical_and
id|fb-&gt;loadcmap
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|linux_logo_colors
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|0
)paren
op_assign
id|linux_logo_red
(braket
id|i
)braket
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|1
)paren
op_assign
id|linux_logo_green
(braket
id|i
)braket
suffix:semicolon
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
op_plus
l_int|32
comma
l_int|2
)paren
op_assign
id|linux_logo_blue
(braket
id|i
)braket
suffix:semicolon
)brace
id|fb
op_member_access_from_pointer
id|loadcmap
c_func
(paren
id|fb
comma
l_int|32
comma
id|linux_logo_colors
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|fb-&gt;linebytes
)paren
(brace
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|ncpus
suffix:semicolon
id|cpu
op_increment
)paren
id|memcpy
c_func
(paren
id|p
op_plus
(paren
id|cpu
op_star
l_int|88
)paren
comma
id|linux_logo
op_plus
l_int|80
op_star
id|i
comma
l_int|80
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|fb-&gt;type.fb_depth
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
id|fb-&gt;linebytes
)paren
(brace
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|ncpus
suffix:semicolon
id|cpu
op_increment
)paren
id|memcpy
c_func
(paren
id|p
op_plus
(paren
id|cpu
op_star
l_int|11
)paren
comma
id|linux_logo_bw
op_plus
l_int|10
op_star
id|i
comma
l_int|10
)paren
suffix:semicolon
)brace
)brace
id|putconsxy
c_func
(paren
l_int|0
comma
id|q
)paren
suffix:semicolon
id|ush
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_plus
id|video_num_columns
op_star
l_int|2
op_plus
l_int|20
op_plus
l_int|10
op_star
(paren
id|ncpus
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|logo_banner
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
comma
id|ush
op_increment
)paren
(brace
op_star
id|ush
op_assign
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|d-&gt;vc_attr
op_lshift
l_int|8
)paren
op_plus
op_star
id|p
suffix:semicolon
id|pci_blitc
c_func
(paren
op_star
id|ush
comma
(paren
r_int
r_int
)paren
id|ush
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ush
op_assign
(paren
r_int
r_int
op_star
)paren
id|video_mem_base
op_plus
id|i
op_star
id|video_num_columns
suffix:semicolon
id|memset
c_func
(paren
id|ush
comma
l_int|0xff
comma
l_int|20
)paren
suffix:semicolon
)brace
id|register_console
c_func
(paren
op_amp
id|vt_console_driver
)paren
suffix:semicolon
)brace
DECL|variable|pcivga_iobase
r_int
r_int
id|pcivga_iobase
op_assign
l_int|0
suffix:semicolon
DECL|variable|pcivga_membase
r_int
r_int
id|pcivga_membase
op_assign
l_int|0
suffix:semicolon
DECL|variable|pcivga_membase2
r_int
r_int
id|pcivga_membase2
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
(brace
DECL|member|depth
r_int
id|depth
suffix:semicolon
DECL|member|resx
DECL|member|resy
r_int
id|resx
comma
id|resy
suffix:semicolon
DECL|member|x_margin
DECL|member|y_margin
r_int
id|x_margin
comma
id|y_margin
suffix:semicolon
DECL|variable|scr_def
)brace
id|scr_def
(braket
)braket
op_assign
(brace
(brace
l_int|8
comma
l_int|1280
comma
l_int|1024
comma
l_int|64
comma
l_int|80
)brace
comma
(brace
l_int|8
comma
l_int|1152
comma
l_int|1024
comma
l_int|64
comma
l_int|80
)brace
comma
(brace
l_int|8
comma
l_int|1152
comma
l_int|900
comma
l_int|64
comma
l_int|18
)brace
comma
(brace
l_int|8
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|800
comma
l_int|600
comma
l_int|16
comma
l_int|12
)brace
comma
(brace
l_int|8
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
r_extern
r_int
id|mach64_init
c_func
(paren
id|fbinfo_t
op_star
id|fb
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|pci_console_probe
c_func
(paren
r_void
)paren
)paren
(brace
id|fbinfo_t
op_star
id|fb
op_assign
op_amp
id|fbinfo
(braket
l_int|0
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
l_int|1
macro_line|#if 1
op_logical_and
id|mach64_init
c_func
(paren
id|fb
)paren
macro_line|#endif
op_logical_and
l_int|1
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|fbinfos
op_increment
suffix:semicolon
id|fb-&gt;clear_fb
op_assign
id|pci_clear_fb
suffix:semicolon
id|fb-&gt;set_other_palette
op_assign
id|pci_set_other_palette
suffix:semicolon
id|fb-&gt;postsetup
op_assign
id|pci_postsetup
suffix:semicolon
id|fb-&gt;blanked
op_assign
l_int|0
suffix:semicolon
id|fb-&gt;type.fb_height
op_assign
id|prom_getintdefault
c_func
(paren
id|fb-&gt;prom_node
comma
l_string|&quot;height&quot;
comma
l_int|900
)paren
suffix:semicolon
id|fb-&gt;type.fb_width
op_assign
id|prom_getintdefault
c_func
(paren
id|fb-&gt;prom_node
comma
l_string|&quot;width&quot;
comma
l_int|1152
)paren
suffix:semicolon
id|fb-&gt;type.fb_depth
op_assign
id|prom_getintdefault
c_func
(paren
id|fb-&gt;prom_node
comma
l_string|&quot;depth&quot;
comma
l_int|8
)paren
suffix:semicolon
id|fb-&gt;linebytes
op_assign
id|prom_getintdefault
c_func
(paren
id|fb-&gt;prom_node
comma
l_string|&quot;linebytes&quot;
comma
l_int|1152
)paren
suffix:semicolon
id|fb-&gt;type.fb_size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|fb-&gt;linebytes
op_star
id|fb-&gt;type.fb_height
)paren
suffix:semicolon
id|fb-&gt;proc_entry.rdev
op_assign
id|MKDEV
c_func
(paren
id|GRAPHDEV_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|fb-&gt;proc_entry.mode
op_assign
id|S_IFCHR
op_or
id|S_IRUSR
op_or
id|S_IWUSR
suffix:semicolon
id|prom_getname
c_func
(paren
id|fb-&gt;prom_node
comma
id|fb-&gt;proc_entry.name
comma
l_int|32
op_minus
l_int|3
)paren
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|fb-&gt;proc_entry.name
comma
l_int|0
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;:%d&quot;
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|scr_def
(braket
id|i
)braket
dot
id|depth
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resx
op_ne
id|fb-&gt;type.fb_width
)paren
op_logical_or
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resy
op_ne
id|fb-&gt;type.fb_height
)paren
op_logical_or
(paren
id|scr_def
(braket
id|i
)braket
dot
id|depth
op_ne
id|fb-&gt;type.fb_depth
)paren
)paren
r_continue
suffix:semicolon
id|x_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|x_margin
suffix:semicolon
id|y_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|y_margin
suffix:semicolon
id|skip_bytes
op_assign
id|y_margin
op_star
id|fb-&gt;linebytes
op_plus
id|x_margin
suffix:semicolon
multiline_comment|/* XXX Check that ORIG_VIDEO_COLS match -DaveM */
id|fbuf_offset
op_assign
id|color_fbuf_offset_generic
suffix:semicolon
r_switch
c_cond
(paren
id|fb-&gt;type.fb_width
)paren
(brace
r_case
l_int|1152
suffix:colon
id|fbuf_offset
op_assign
id|color_fbuf_offset_1152_128
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
id|fbuf_offset
op_assign
id|color_fbuf_offset_1024_128
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1280
suffix:colon
id|fbuf_offset
op_assign
id|color_fbuf_offset_1280_144
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|fbuf_offset
op_assign
id|color_fbuf_offset_800_96
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|fbuf_offset
op_assign
id|color_fbuf_offset_640_80
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;can&squot;t handle console width %d&bslash;n&quot;
comma
id|fb-&gt;type.fb_width
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scr_def
(braket
id|i
)braket
dot
id|depth
op_eq
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;can&squot;t support console resolution %dX%d&bslash;n&quot;
comma
id|fb-&gt;type.fb_width
comma
id|fb-&gt;type.fb_height
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|pci_install_consops
c_func
(paren
)paren
suffix:semicolon
r_return
id|fb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pci_console_inithook
c_func
(paren
r_void
)paren
)paren
(brace
r_extern
r_char
op_star
id|console_fb_path
suffix:semicolon
r_char
id|prop
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|node
op_assign
l_int|0
suffix:semicolon
r_int
id|width
comma
id|height
comma
id|depth
comma
id|linebytes
suffix:semicolon
r_int
id|x_margin
comma
id|y_margin
suffix:semicolon
r_int
id|i
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
id|console_fb_path
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|console_fb_path
suffix:semicolon
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot; &squot;
suffix:semicolon
id|p
op_increment
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|node
op_assign
id|prom_pathtoinode
c_func
(paren
id|console_fb_path
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
(brace
id|node
op_assign
id|prom_inst2pkg
c_func
(paren
id|prom_stdout
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;can&squot;t find output-device node&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;device_type&quot;
comma
id|prop
comma
r_sizeof
(paren
id|prop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;output-device doesn&squot;t have&quot;
l_string|&quot; device_type property&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
l_string|&quot;display&quot;
)paren
op_logical_or
id|strncmp
c_func
(paren
l_string|&quot;display&quot;
comma
id|prop
comma
r_sizeof
(paren
l_string|&quot;display&quot;
)paren
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;output-device is %s&quot;
l_string|&quot; not &bslash;&quot;display&bslash;&quot;&bslash;n&quot;
comma
id|prop
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|depth
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;depth&quot;
comma
l_int|8
)paren
suffix:semicolon
id|width
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;width&quot;
comma
l_int|1152
)paren
suffix:semicolon
id|height
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;height&quot;
comma
l_int|900
)paren
suffix:semicolon
id|linebytes
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;linebytes&quot;
comma
l_int|1152
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|scr_def
(braket
id|i
)braket
dot
id|depth
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resx
op_ne
id|width
)paren
op_logical_or
(paren
id|scr_def
(braket
id|i
)braket
dot
id|resy
op_ne
id|height
)paren
op_logical_or
(paren
id|scr_def
(braket
id|i
)braket
dot
id|depth
op_ne
id|depth
)paren
)paren
r_continue
suffix:semicolon
id|x_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|x_margin
suffix:semicolon
id|y_margin
op_assign
id|scr_def
(braket
id|i
)braket
dot
id|y_margin
suffix:semicolon
id|ORIG_VIDEO_COLS
op_assign
id|width
op_div
l_int|8
op_minus
l_int|2
op_star
id|x_margin
op_div
id|depth
suffix:semicolon
id|ORIG_VIDEO_LINES
op_assign
(paren
id|height
op_minus
l_int|2
op_star
id|y_margin
)paren
op_div
l_int|16
suffix:semicolon
)brace
id|suncons_ops.con_type_init
op_assign
id|pci_con_type_init
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|pci_install_consops
c_func
(paren
r_void
)paren
)paren
(brace
id|suncons_ops.memsetw
op_assign
id|pci_memsetw
suffix:semicolon
id|suncons_ops.memcpyw
op_assign
id|pci_memcpyw
suffix:semicolon
id|suncons_ops.scr_writew
op_assign
id|pci_scr_writew
suffix:semicolon
id|suncons_ops.scr_readw
op_assign
id|pci_scr_readw
suffix:semicolon
id|suncons_ops.get_scrmem
op_assign
id|pci_get_scrmem
suffix:semicolon
id|suncons_ops.set_scrmem
op_assign
id|pci_set_scrmem
suffix:semicolon
id|suncons_ops.hide_cursor
op_assign
id|pci_hide_cursor
suffix:semicolon
id|suncons_ops.set_cursor
op_assign
id|pci_set_cursor
suffix:semicolon
id|suncons_ops.set_get_font
op_assign
id|pci_set_get_font
suffix:semicolon
id|suncons_ops.con_adjust_height
op_assign
id|pci_con_adjust_height
suffix:semicolon
id|suncons_ops.set_get_cmap
op_assign
id|pci_set_get_cmap
suffix:semicolon
id|suncons_ops.set_palette
op_assign
id|pci_set_palette
suffix:semicolon
id|suncons_ops.set_other_palette
op_assign
id|pci_set_other_palette
suffix:semicolon
id|suncons_ops.console_restore_palette
op_assign
id|pci_restore_palette
suffix:semicolon
id|suncons_ops.con_type_init
op_assign
id|pci_con_type_init
suffix:semicolon
id|suncons_ops.con_type_init_finish
op_assign
id|pci_con_type_init_finish
suffix:semicolon
id|suncons_ops.clear_screen
op_assign
id|pci_clear_screen
suffix:semicolon
id|suncons_ops.render_screen
op_assign
id|pci_render_screen
suffix:semicolon
id|suncons_ops.clear_margin
op_assign
id|pci_clear_margin
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
eof
