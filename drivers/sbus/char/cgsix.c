multiline_comment|/* $Id: cgsix.c,v 1.37 1997/08/22 15:55:20 jj Exp $&n; * cgsix.c: cgsix frame buffer driver&n; *&n; * Copyright (C) 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1996 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)&n; */
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
multiline_comment|/* These must be included after asm/fbio.h */
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &quot;fb.h&quot;
macro_line|#include &quot;cg_common.h&quot;
multiline_comment|/* Offset of interesting structures in the OBIO space */
multiline_comment|/*&n; * Brooktree is the video dac and is funny to program on the cg6.&n; * (it&squot;s even funnier on the cg3)&n; * The FBC could be the the frame buffer control&n; * The FHC could is the frame buffer hardware control.&n; */
DECL|macro|CG6_ROM_OFFSET
mdefine_line|#define CG6_ROM_OFFSET       0x0
DECL|macro|CG6_BROOKTREE_OFFSET
mdefine_line|#define CG6_BROOKTREE_OFFSET 0x200000
DECL|macro|CG6_DHC_OFFSET
mdefine_line|#define CG6_DHC_OFFSET       0x240000
DECL|macro|CG6_ALT_OFFSET
mdefine_line|#define CG6_ALT_OFFSET       0x280000
DECL|macro|CG6_FHC_OFFSET
mdefine_line|#define CG6_FHC_OFFSET       0x300000
DECL|macro|CG6_THC_OFFSET
mdefine_line|#define CG6_THC_OFFSET       0x301000
DECL|macro|CG6_FBC_OFFSET
mdefine_line|#define CG6_FBC_OFFSET       0x700000
DECL|macro|CG6_TEC_OFFSET
mdefine_line|#define CG6_TEC_OFFSET       0x701000
DECL|macro|CG6_RAM_OFFSET
mdefine_line|#define CG6_RAM_OFFSET       0x800000
multiline_comment|/* FHC definitions */
DECL|macro|CG6_FHC_FBID_SHIFT
mdefine_line|#define CG6_FHC_FBID_SHIFT           24
DECL|macro|CG6_FHC_FBID_MASK
mdefine_line|#define CG6_FHC_FBID_MASK            255
DECL|macro|CG6_FHC_REV_SHIFT
mdefine_line|#define CG6_FHC_REV_SHIFT            20
DECL|macro|CG6_FHC_REV_MASK
mdefine_line|#define CG6_FHC_REV_MASK             15
DECL|macro|CG6_FHC_FROP_DISABLE
mdefine_line|#define CG6_FHC_FROP_DISABLE         (1 &lt;&lt; 19)
DECL|macro|CG6_FHC_ROW_DISABLE
mdefine_line|#define CG6_FHC_ROW_DISABLE          (1 &lt;&lt; 18)
DECL|macro|CG6_FHC_SRC_DISABLE
mdefine_line|#define CG6_FHC_SRC_DISABLE          (1 &lt;&lt; 17)
DECL|macro|CG6_FHC_DST_DISABLE
mdefine_line|#define CG6_FHC_DST_DISABLE          (1 &lt;&lt; 16)
DECL|macro|CG6_FHC_RESET
mdefine_line|#define CG6_FHC_RESET                (1 &lt;&lt; 15)
DECL|macro|CG6_FHC_LITTLE_ENDIAN
mdefine_line|#define CG6_FHC_LITTLE_ENDIAN        (1 &lt;&lt; 13)
DECL|macro|CG6_FHC_RES_MASK
mdefine_line|#define CG6_FHC_RES_MASK             (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_1024
mdefine_line|#define CG6_FHC_1024                 (0 &lt;&lt; 11)
DECL|macro|CG6_FHC_1152
mdefine_line|#define CG6_FHC_1152                 (1 &lt;&lt; 11)
DECL|macro|CG6_FHC_1280
mdefine_line|#define CG6_FHC_1280                 (2 &lt;&lt; 11)
DECL|macro|CG6_FHC_1600
mdefine_line|#define CG6_FHC_1600                 (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_CPU_MASK
mdefine_line|#define CG6_FHC_CPU_MASK             (3 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_SPARC
mdefine_line|#define CG6_FHC_CPU_SPARC            (0 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_68020
mdefine_line|#define CG6_FHC_CPU_68020            (1 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_386
mdefine_line|#define CG6_FHC_CPU_386              (2 &lt;&lt; 9)
DECL|macro|CG6_FHC_TEST
mdefine_line|#define CG6_FHC_TEST&t;&t;     (1 &lt;&lt; 8)
DECL|macro|CG6_FHC_TEST_X_SHIFT
mdefine_line|#define CG6_FHC_TEST_X_SHIFT&t;     4
DECL|macro|CG6_FHC_TEST_X_MASK
mdefine_line|#define CG6_FHC_TEST_X_MASK&t;     15
DECL|macro|CG6_FHC_TEST_Y_SHIFT
mdefine_line|#define CG6_FHC_TEST_Y_SHIFT&t;     0
DECL|macro|CG6_FHC_TEST_Y_MASK
mdefine_line|#define CG6_FHC_TEST_Y_MASK&t;     15
multiline_comment|/* FBC mode definitions */
DECL|macro|CG6_FBC_BLIT_IGNORE
mdefine_line|#define CG6_FBC_BLIT_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BLIT_NOSRC
mdefine_line|#define CG6_FBC_BLIT_NOSRC&t;&t;0x00100000
DECL|macro|CG6_FBC_BLIT_SRC
mdefine_line|#define CG6_FBC_BLIT_SRC&t;&t;0x00200000
DECL|macro|CG6_FBC_BLIT_ILLEGAL
mdefine_line|#define CG6_FBC_BLIT_ILLEGAL&t;&t;0x00300000
DECL|macro|CG6_FBC_BLIT_MASK
mdefine_line|#define CG6_FBC_BLIT_MASK&t;&t;0x00300000
DECL|macro|CG6_FBC_VBLANK
mdefine_line|#define CG6_FBC_VBLANK&t;&t;&t;0x00080000
DECL|macro|CG6_FBC_MODE_IGNORE
mdefine_line|#define CG6_FBC_MODE_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_MODE_COLOR8
mdefine_line|#define CG6_FBC_MODE_COLOR8&t;&t;0x00020000
DECL|macro|CG6_FBC_MODE_COLOR1
mdefine_line|#define CG6_FBC_MODE_COLOR1&t;&t;0x00040000
DECL|macro|CG6_FBC_MODE_HRMONO
mdefine_line|#define CG6_FBC_MODE_HRMONO&t;&t;0x00060000
DECL|macro|CG6_FBC_MODE_MASK
mdefine_line|#define CG6_FBC_MODE_MASK&t;&t;0x00060000
DECL|macro|CG6_FBC_DRAW_IGNORE
mdefine_line|#define CG6_FBC_DRAW_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_DRAW_RENDER
mdefine_line|#define CG6_FBC_DRAW_RENDER&t;&t;0x00008000
DECL|macro|CG6_FBC_DRAW_PICK
mdefine_line|#define CG6_FBC_DRAW_PICK&t;&t;0x00010000
DECL|macro|CG6_FBC_DRAW_ILLEGAL
mdefine_line|#define CG6_FBC_DRAW_ILLEGAL&t;&t;0x00018000
DECL|macro|CG6_FBC_DRAW_MASK
mdefine_line|#define CG6_FBC_DRAW_MASK&t;&t;0x00018000
DECL|macro|CG6_FBC_BWRITE0_IGNORE
mdefine_line|#define CG6_FBC_BWRITE0_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE0_ENABLE
mdefine_line|#define CG6_FBC_BWRITE0_ENABLE&t;&t;0x00002000
DECL|macro|CG6_FBC_BWRITE0_DISABLE
mdefine_line|#define CG6_FBC_BWRITE0_DISABLE&t;&t;0x00004000
DECL|macro|CG6_FBC_BWRITE0_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE0_ILLEGAL&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE0_MASK
mdefine_line|#define CG6_FBC_BWRITE0_MASK&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE1_IGNORE
mdefine_line|#define CG6_FBC_BWRITE1_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE1_ENABLE
mdefine_line|#define CG6_FBC_BWRITE1_ENABLE&t;&t;0x00000800
DECL|macro|CG6_FBC_BWRITE1_DISABLE
mdefine_line|#define CG6_FBC_BWRITE1_DISABLE&t;&t;0x00001000
DECL|macro|CG6_FBC_BWRITE1_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE1_ILLEGAL&t;&t;0x00001800
DECL|macro|CG6_FBC_BWRITE1_MASK
mdefine_line|#define CG6_FBC_BWRITE1_MASK&t;&t;0x00001800
DECL|macro|CG6_FBC_BREAD_IGNORE
mdefine_line|#define CG6_FBC_BREAD_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BREAD_0
mdefine_line|#define CG6_FBC_BREAD_0&t;&t;&t;0x00000200
DECL|macro|CG6_FBC_BREAD_1
mdefine_line|#define CG6_FBC_BREAD_1&t;&t;&t;0x00000400
DECL|macro|CG6_FBC_BREAD_ILLEGAL
mdefine_line|#define CG6_FBC_BREAD_ILLEGAL&t;&t;0x00000600
DECL|macro|CG6_FBC_BREAD_MASK
mdefine_line|#define CG6_FBC_BREAD_MASK&t;&t;0x00000600
DECL|macro|CG6_FBC_BDISP_IGNORE
mdefine_line|#define CG6_FBC_BDISP_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BDISP_0
mdefine_line|#define CG6_FBC_BDISP_0&t;&t;&t;0x00000080
DECL|macro|CG6_FBC_BDISP_1
mdefine_line|#define CG6_FBC_BDISP_1&t;&t;&t;0x00000100
DECL|macro|CG6_FBC_BDISP_ILLEGAL
mdefine_line|#define CG6_FBC_BDISP_ILLEGAL&t;&t;0x00000180
DECL|macro|CG6_FBC_BDISP_MASK
mdefine_line|#define CG6_FBC_BDISP_MASK&t;&t;0x00000180
DECL|macro|CG6_FBC_INDEX_MOD
mdefine_line|#define CG6_FBC_INDEX_MOD&t;&t;0x00000040
DECL|macro|CG6_FBC_INDEX_MASK
mdefine_line|#define CG6_FBC_INDEX_MASK&t;&t;0x00000030
multiline_comment|/* THC definitions */
DECL|macro|CG6_THC_MISC_REV_SHIFT
mdefine_line|#define CG6_THC_MISC_REV_SHIFT       16
DECL|macro|CG6_THC_MISC_REV_MASK
mdefine_line|#define CG6_THC_MISC_REV_MASK        15
DECL|macro|CG6_THC_MISC_RESET
mdefine_line|#define CG6_THC_MISC_RESET           (1 &lt;&lt; 12)
DECL|macro|CG6_THC_MISC_VIDEO
mdefine_line|#define CG6_THC_MISC_VIDEO           (1 &lt;&lt; 10)
DECL|macro|CG6_THC_MISC_SYNC
mdefine_line|#define CG6_THC_MISC_SYNC            (1 &lt;&lt; 9)
DECL|macro|CG6_THC_MISC_VSYNC
mdefine_line|#define CG6_THC_MISC_VSYNC           (1 &lt;&lt; 8)
DECL|macro|CG6_THC_MISC_SYNC_ENAB
mdefine_line|#define CG6_THC_MISC_SYNC_ENAB       (1 &lt;&lt; 7)
DECL|macro|CG6_THC_MISC_CURS_RES
mdefine_line|#define CG6_THC_MISC_CURS_RES        (1 &lt;&lt; 6)
DECL|macro|CG6_THC_MISC_INT_ENAB
mdefine_line|#define CG6_THC_MISC_INT_ENAB        (1 &lt;&lt; 5)
DECL|macro|CG6_THC_MISC_INT
mdefine_line|#define CG6_THC_MISC_INT             (1 &lt;&lt; 4)
DECL|macro|CG6_THC_MISC_INIT
mdefine_line|#define CG6_THC_MISC_INIT            0x9f
multiline_comment|/* The contents are unknown */
DECL|struct|cg6_tec
r_struct
id|cg6_tec
(brace
DECL|member|tec_matrix
r_volatile
r_int
id|tec_matrix
suffix:semicolon
DECL|member|tec_clip
r_volatile
r_int
id|tec_clip
suffix:semicolon
DECL|member|tec_vdc
r_volatile
r_int
id|tec_vdc
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cg6_thc
r_struct
id|cg6_thc
(brace
DECL|member|thc_pad0
id|uint
id|thc_pad0
(braket
l_int|512
)braket
suffix:semicolon
DECL|member|thc_hs
r_volatile
id|uint
id|thc_hs
suffix:semicolon
multiline_comment|/* hsync timing */
DECL|member|thc_hsdvs
r_volatile
id|uint
id|thc_hsdvs
suffix:semicolon
DECL|member|thc_hd
r_volatile
id|uint
id|thc_hd
suffix:semicolon
DECL|member|thc_vs
r_volatile
id|uint
id|thc_vs
suffix:semicolon
multiline_comment|/* vsync timing */
DECL|member|thc_vd
r_volatile
id|uint
id|thc_vd
suffix:semicolon
DECL|member|thc_refresh
r_volatile
id|uint
id|thc_refresh
suffix:semicolon
DECL|member|thc_misc
r_volatile
id|uint
id|thc_misc
suffix:semicolon
DECL|member|thc_pad1
id|uint
id|thc_pad1
(braket
l_int|56
)braket
suffix:semicolon
DECL|member|thc_cursxy
r_volatile
id|uint
id|thc_cursxy
suffix:semicolon
multiline_comment|/* cursor x,y position (16 bits each) */
DECL|member|thc_cursmask
r_volatile
id|uint
id|thc_cursmask
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* cursor mask bits */
DECL|member|thc_cursbits
r_volatile
id|uint
id|thc_cursbits
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* what to show where mask enabled */
)brace
suffix:semicolon
DECL|struct|cg6_fbc
r_struct
id|cg6_fbc
(brace
DECL|member|xxx0
id|u32
id|xxx0
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|mode
r_volatile
id|u32
id|mode
suffix:semicolon
DECL|member|clip
r_volatile
id|u32
id|clip
suffix:semicolon
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|s
r_volatile
id|u32
id|s
suffix:semicolon
DECL|member|draw
r_volatile
id|u32
id|draw
suffix:semicolon
DECL|member|blit
r_volatile
id|u32
id|blit
suffix:semicolon
DECL|member|font
r_volatile
id|u32
id|font
suffix:semicolon
DECL|member|xxx2
id|u32
id|xxx2
(braket
l_int|24
)braket
suffix:semicolon
DECL|member|x0
DECL|member|y0
DECL|member|z0
DECL|member|color0
r_volatile
id|u32
id|x0
comma
id|y0
comma
id|z0
comma
id|color0
suffix:semicolon
DECL|member|x1
DECL|member|y1
DECL|member|z1
DECL|member|color1
r_volatile
id|u32
id|x1
comma
id|y1
comma
id|z1
comma
id|color1
suffix:semicolon
DECL|member|x2
DECL|member|y2
DECL|member|z2
DECL|member|color2
r_volatile
id|u32
id|x2
comma
id|y2
comma
id|z2
comma
id|color2
suffix:semicolon
DECL|member|x3
DECL|member|y3
DECL|member|z3
DECL|member|color3
r_volatile
id|u32
id|x3
comma
id|y3
comma
id|z3
comma
id|color3
suffix:semicolon
DECL|member|offx
DECL|member|offy
r_volatile
id|u32
id|offx
comma
id|offy
suffix:semicolon
DECL|member|xxx3
id|u32
id|xxx3
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|incx
DECL|member|incy
r_volatile
id|u32
id|incx
comma
id|incy
suffix:semicolon
DECL|member|xxx4
id|u32
id|xxx4
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipminx
DECL|member|clipminy
r_volatile
id|u32
id|clipminx
comma
id|clipminy
suffix:semicolon
DECL|member|xxx5
id|u32
id|xxx5
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipmaxx
DECL|member|clipmaxy
r_volatile
id|u32
id|clipmaxx
comma
id|clipmaxy
suffix:semicolon
DECL|member|xxx6
id|u32
id|xxx6
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|fg
r_volatile
id|u32
id|fg
suffix:semicolon
DECL|member|bg
r_volatile
id|u32
id|bg
suffix:semicolon
DECL|member|alu
r_volatile
id|u32
id|alu
suffix:semicolon
DECL|member|pm
r_volatile
id|u32
id|pm
suffix:semicolon
DECL|member|pixelm
r_volatile
id|u32
id|pixelm
suffix:semicolon
DECL|member|xxx7
id|u32
id|xxx7
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|patalign
r_volatile
id|u32
id|patalign
suffix:semicolon
DECL|member|pattern
r_volatile
id|u32
id|pattern
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|xxx8
id|u32
id|xxx8
(braket
l_int|432
)braket
suffix:semicolon
DECL|member|apointx
DECL|member|apointy
DECL|member|apointz
r_volatile
id|u32
id|apointx
comma
id|apointy
comma
id|apointz
suffix:semicolon
DECL|member|xxx9
id|u32
id|xxx9
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rpointx
DECL|member|rpointy
DECL|member|rpointz
r_volatile
id|u32
id|rpointx
comma
id|rpointy
comma
id|rpointz
suffix:semicolon
DECL|member|xxx10
id|u32
id|xxx10
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|pointr
DECL|member|pointg
DECL|member|pointb
DECL|member|pointa
r_volatile
id|u32
id|pointr
comma
id|pointg
comma
id|pointb
comma
id|pointa
suffix:semicolon
DECL|member|alinex
DECL|member|aliney
DECL|member|alinez
r_volatile
id|u32
id|alinex
comma
id|aliney
comma
id|alinez
suffix:semicolon
DECL|member|xxx11
id|u32
id|xxx11
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rlinex
DECL|member|rliney
DECL|member|rlinez
r_volatile
id|u32
id|rlinex
comma
id|rliney
comma
id|rlinez
suffix:semicolon
DECL|member|xxx12
id|u32
id|xxx12
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|liner
DECL|member|lineg
DECL|member|lineb
DECL|member|linea
r_volatile
id|u32
id|liner
comma
id|lineg
comma
id|lineb
comma
id|linea
suffix:semicolon
DECL|member|atrix
DECL|member|atriy
DECL|member|atriz
r_volatile
id|u32
id|atrix
comma
id|atriy
comma
id|atriz
suffix:semicolon
DECL|member|xxx13
id|u32
id|xxx13
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rtrix
DECL|member|rtriy
DECL|member|rtriz
r_volatile
id|u32
id|rtrix
comma
id|rtriy
comma
id|rtriz
suffix:semicolon
DECL|member|xxx14
id|u32
id|xxx14
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|trir
DECL|member|trig
DECL|member|trib
DECL|member|tria
r_volatile
id|u32
id|trir
comma
id|trig
comma
id|trib
comma
id|tria
suffix:semicolon
DECL|member|aquadx
DECL|member|aquady
DECL|member|aquadz
r_volatile
id|u32
id|aquadx
comma
id|aquady
comma
id|aquadz
suffix:semicolon
DECL|member|xxx15
id|u32
id|xxx15
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rquadx
DECL|member|rquady
DECL|member|rquadz
r_volatile
id|u32
id|rquadx
comma
id|rquady
comma
id|rquadz
suffix:semicolon
DECL|member|xxx16
id|u32
id|xxx16
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|quadr
DECL|member|quadg
DECL|member|quadb
DECL|member|quada
r_volatile
id|u32
id|quadr
comma
id|quadg
comma
id|quadb
comma
id|quada
suffix:semicolon
DECL|member|arectx
DECL|member|arecty
DECL|member|arectz
r_volatile
id|u32
id|arectx
comma
id|arecty
comma
id|arectz
suffix:semicolon
DECL|member|xxx17
id|u32
id|xxx17
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rrectx
DECL|member|rrecty
DECL|member|rrectz
r_volatile
id|u32
id|rrectx
comma
id|rrecty
comma
id|rrectz
suffix:semicolon
DECL|member|xxx18
id|u32
id|xxx18
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|rectr
DECL|member|rectg
DECL|member|rectb
DECL|member|recta
r_volatile
id|u32
id|rectr
comma
id|rectg
comma
id|rectb
comma
id|recta
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
DECL|function|cg6_restore_palette
id|cg6_restore_palette
(paren
id|fbinfo_t
op_star
id|fbinfo
)paren
(brace
r_volatile
r_struct
id|bt_regs
op_star
id|bt
suffix:semicolon
id|bt
op_assign
id|fbinfo-&gt;info.cg6.bt
suffix:semicolon
id|bt-&gt;addr
op_assign
l_int|0
suffix:semicolon
id|bt-&gt;color_map
op_assign
l_int|0xffffffff
suffix:semicolon
id|bt-&gt;color_map
op_assign
l_int|0xffffffff
suffix:semicolon
id|bt-&gt;color_map
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_static
r_void
id|cg6_blitc
c_func
(paren
r_int
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|cg6_setw
c_func
(paren
r_int
comma
r_int
comma
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|cg6_cpyw
c_func
(paren
r_int
comma
r_int
comma
r_int
r_int
op_star
comma
r_int
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|cg6_fill
c_func
(paren
r_int
comma
r_int
comma
r_int
op_star
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Ugh: X wants to mmap a bunch of cute stuff at the same time :-( */
multiline_comment|/* So, we just mmap the things that are being asked for */
r_static
r_int
DECL|function|cg6_mmap
id|cg6_mmap
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
id|base
comma
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|uint
id|size
comma
id|page
comma
id|r
comma
id|map_size
suffix:semicolon
r_int
r_int
id|map_offset
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_offset
op_amp
op_complement
id|PAGE_MASK
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#ifdef __sparc_v9__
multiline_comment|/* Try to align RAM */
DECL|macro|ALIGNMENT
mdefine_line|#define ALIGNMENT 0x80000
id|map_offset
op_assign
id|vma-&gt;vm_offset
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_offset
op_le
id|CG6_RAM
op_logical_and
id|map_offset
op_ge
id|CG6_RAM
op_plus
id|fb-&gt;type.fb_size
)paren
(brace
r_struct
id|vm_area_struct
op_star
id|vmm
op_assign
id|find_vma
c_func
(paren
id|current-&gt;mm
comma
id|vma-&gt;vm_start
)paren
suffix:semicolon
r_int
id|alignment
op_assign
id|ALIGNMENT
op_minus
(paren
(paren
id|vma-&gt;vm_start
op_plus
id|CG6_RAM
op_minus
id|vma-&gt;vm_offset
)paren
op_amp
(paren
id|ALIGNMENT
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_int
id|sz
op_assign
l_int|0
comma
id|fbsz
suffix:semicolon
r_if
c_cond
(paren
id|alignment
op_eq
id|ALIGNMENT
)paren
id|alignment
op_assign
l_int|0
suffix:semicolon
id|fbsz
op_assign
(paren
(paren
id|fb-&gt;type.fb_size
op_plus
id|ALIGNMENT
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|ALIGNMENT
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map_offset
OL
id|CG6_RAM
op_plus
id|fbsz
)paren
id|sz
op_assign
id|fbsz
op_minus
id|map_offset
op_plus
id|CG6_RAM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sz
op_logical_or
id|alignment
)paren
op_logical_and
(paren
op_logical_neg
id|vmm
op_logical_or
id|vmm-&gt;vm_start
op_ge
id|vma-&gt;vm_end
op_plus
id|sz
op_plus
id|alignment
)paren
)paren
(brace
id|vma-&gt;vm_start
op_add_assign
id|alignment
suffix:semicolon
id|vma-&gt;vm_end
op_add_assign
id|alignment
op_plus
id|sz
suffix:semicolon
)brace
)brace
DECL|macro|ALIGNMENT
macro_line|#undef ALIGNMENT
macro_line|#endif&t;
multiline_comment|/* To stop the swapper from even considering these pages */
id|vma-&gt;vm_flags
op_or_assign
id|FB_MMAP_VM_FLAGS
suffix:semicolon
multiline_comment|/* Each page, see which map applies */
r_for
c_loop
(paren
id|page
op_assign
l_int|0
suffix:semicolon
id|page
OL
id|size
suffix:semicolon
)paren
(brace
r_switch
c_cond
(paren
id|vma-&gt;vm_offset
op_plus
id|page
)paren
(brace
r_case
id|CG6_TEC
suffix:colon
id|map_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.tec
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_FBC
suffix:colon
id|map_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.fbc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_FHC
suffix:colon
id|map_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.fhc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_THC
suffix:colon
id|map_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.thc
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_BTREGS
suffix:colon
id|map_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.bt
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* For Ultra, make sure the following two are right.&n;&t;&t; * The above two happen to work out (for example FBC and&n;&t;&t; * TEC will get mapped by one I/O page mapping because&n;&t;&t; * of the 8192 byte page size, same for FHC/THC.  -DaveM&n;&t;&t; */
r_case
id|CG6_DHC
suffix:colon
id|map_size
op_assign
multiline_comment|/* PAGE_SIZE * 40 */
(paren
l_int|4096
op_star
l_int|40
)paren
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.dhc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_ROM
suffix:colon
id|map_size
op_assign
multiline_comment|/* PAGE_SIZE * 16 */
(paren
l_int|4096
op_star
l_int|16
)paren
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;info.cg6.rom
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_RAM
suffix:colon
id|map_size
op_assign
id|size
op_minus
id|page
suffix:semicolon
id|map_offset
op_assign
id|get_phys
(paren
(paren
r_int
r_int
)paren
id|fb-&gt;base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map_size
OL
id|fb-&gt;type.fb_size
)paren
id|map_size
op_assign
id|fb-&gt;type.fb_size
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|map_size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|map_size
)paren
(brace
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|page
op_plus
id|map_size
OG
id|size
)paren
id|map_size
op_assign
id|size
op_minus
id|page
suffix:semicolon
id|r
op_assign
id|io_remap_page_range
(paren
id|vma-&gt;vm_start
op_plus
id|page
comma
id|map_offset
comma
id|map_size
comma
id|vma-&gt;vm_page_prot
comma
id|fb-&gt;space
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|page
op_add_assign
id|map_size
suffix:semicolon
)brace
id|vma-&gt;vm_dentry
op_assign
id|dget
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|cg6_loadcmap
id|cg6_loadcmap
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|fb-&gt;info.cg6.bt
suffix:semicolon
r_int
id|i
suffix:semicolon
id|bt-&gt;addr
op_assign
id|index
op_lshift
l_int|24
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|index
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bt-&gt;color_map
op_assign
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;color_map
op_assign
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;color_map
op_assign
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
op_lshift
l_int|24
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cg6_setcursormap
id|cg6_setcursormap
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
r_char
op_star
id|red
comma
r_int
r_char
op_star
id|green
comma
r_int
r_char
op_star
id|blue
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|fb-&gt;info.cg6.bt
suffix:semicolon
id|bt-&gt;addr
op_assign
l_int|1
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|red
(braket
l_int|0
)braket
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|green
(braket
l_int|0
)braket
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|blue
(braket
l_int|0
)braket
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;addr
op_assign
l_int|3
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|red
(braket
l_int|1
)braket
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|green
(braket
l_int|1
)braket
op_lshift
l_int|24
suffix:semicolon
id|bt-&gt;cursor
op_assign
id|blue
(braket
l_int|1
)braket
op_lshift
l_int|24
suffix:semicolon
)brace
multiline_comment|/* Load cursor information */
r_static
r_void
DECL|function|cg6_setcursor
id|cg6_setcursor
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|uint
id|v
suffix:semicolon
r_struct
id|cg_cursor
op_star
id|c
op_assign
op_amp
id|fb-&gt;cursor
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;enable
)paren
(brace
id|v
op_assign
(paren
(paren
id|c-&gt;cpos.fbx
op_minus
id|c-&gt;chot.fbx
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|c-&gt;cpos.fby
op_minus
id|c-&gt;chot.fby
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Magic constant to turn off the cursor */
id|v
op_assign
(paren
(paren
l_int|65536
op_minus
l_int|32
)paren
op_lshift
l_int|16
)paren
op_or
(paren
l_int|65536
op_minus
l_int|32
)paren
suffix:semicolon
)brace
id|fb-&gt;info.cg6.thc-&gt;thc_cursxy
op_assign
id|v
suffix:semicolon
)brace
multiline_comment|/* Set cursor shape */
r_static
r_void
DECL|function|cg6_setcurshape
id|cg6_setcurshape
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_struct
id|cg6_thc
op_star
id|thc
op_assign
id|fb-&gt;info.cg6.thc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|thc-&gt;thc_cursmask
(braket
id|i
)braket
op_assign
id|fb-&gt;cursor.bits
(braket
l_int|0
)braket
(braket
id|i
)braket
suffix:semicolon
id|thc-&gt;thc_cursbits
(braket
id|i
)braket
op_assign
id|fb-&gt;cursor.bits
(braket
l_int|1
)braket
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cg6_blank
id|cg6_blank
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|fb-&gt;info.cg6.thc-&gt;thc_misc
op_and_assign
op_complement
id|CG6_THC_MISC_VIDEO
suffix:semicolon
)brace
r_static
r_void
DECL|function|cg6_unblank
id|cg6_unblank
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|fb-&gt;info.cg6.thc-&gt;thc_misc
op_or_assign
id|CG6_THC_MISC_VIDEO
suffix:semicolon
)brace
r_void
DECL|function|cg6_reset
id|cg6_reset
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_struct
id|cg6_info
op_star
id|cg6
op_assign
op_amp
(paren
id|fb-&gt;info.cg6
)paren
suffix:semicolon
r_int
r_int
id|rev
comma
id|conf
suffix:semicolon
r_if
c_cond
(paren
id|fb
op_eq
op_amp
id|fbinfo
(braket
l_int|0
)braket
)paren
id|sbus_hw_hide_cursor
(paren
)paren
suffix:semicolon
multiline_comment|/* Turn off stuff in the Transform Engine. */
id|cg6-&gt;tec-&gt;tec_matrix
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;tec-&gt;tec_clip
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;tec-&gt;tec_vdc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Take care of bugs in old revisions. */
id|rev
op_assign
(paren
op_star
(paren
id|cg6-&gt;fhc
)paren
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|5
)paren
(brace
id|conf
op_assign
(paren
op_star
(paren
id|cg6-&gt;fhc
)paren
op_amp
id|CG6_FHC_RES_MASK
)paren
op_or
id|CG6_FHC_CPU_68020
op_or
id|CG6_FHC_TEST
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_X_SHIFT
)paren
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_Y_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|2
)paren
id|conf
op_or_assign
id|CG6_FHC_DST_DISABLE
suffix:semicolon
op_star
(paren
id|cg6-&gt;fhc
)paren
op_assign
id|conf
suffix:semicolon
)brace
multiline_comment|/* Set things in the FBC. */
id|cg6-&gt;fbc-&gt;mode
op_and_assign
op_complement
(paren
id|CG6_FBC_BLIT_MASK
op_or
id|CG6_FBC_MODE_MASK
op_or
id|CG6_FBC_DRAW_MASK
op_or
id|CG6_FBC_BWRITE0_MASK
op_or
id|CG6_FBC_BWRITE1_MASK
op_or
id|CG6_FBC_BREAD_MASK
op_or
id|CG6_FBC_BDISP_MASK
)paren
suffix:semicolon
id|cg6-&gt;fbc-&gt;mode
op_or_assign
(paren
id|CG6_FBC_BLIT_SRC
op_or
id|CG6_FBC_MODE_COLOR8
op_or
id|CG6_FBC_DRAW_RENDER
op_or
id|CG6_FBC_BWRITE0_ENABLE
op_or
id|CG6_FBC_BWRITE1_DISABLE
op_or
id|CG6_FBC_BREAD_0
op_or
id|CG6_FBC_BDISP_0
)paren
suffix:semicolon
id|cg6-&gt;fbc-&gt;clip
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;fbc-&gt;offx
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;fbc-&gt;offy
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;fbc-&gt;clipminx
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;fbc-&gt;clipminy
op_assign
l_int|0
suffix:semicolon
id|cg6-&gt;fbc-&gt;clipmaxx
op_assign
id|fb-&gt;type.fb_width
op_minus
l_int|1
suffix:semicolon
id|cg6-&gt;fbc-&gt;clipmaxy
op_assign
id|fb-&gt;type.fb_height
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Enable cursor in Brooktree DAC. */
id|cg6-&gt;bt-&gt;addr
op_assign
l_int|0x06
op_lshift
l_int|24
suffix:semicolon
id|cg6-&gt;bt-&gt;control
op_or_assign
l_int|0x03
op_lshift
l_int|24
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|cg6_setup
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|slot
comma
id|u32
id|cg6
comma
r_int
id|cg6_io
)paren
)paren
(brace
r_struct
id|cg6_info
op_star
id|cg6info
suffix:semicolon
r_int
r_int
id|rev
comma
id|cpu
comma
id|conf
suffix:semicolon
id|printk
(paren
l_string|&quot;cgsix%d at 0x%8.8x &quot;
comma
id|slot
comma
id|cg6
)paren
suffix:semicolon
multiline_comment|/* Fill in parameters we left out */
id|fb-&gt;type.fb_cmsize
op_assign
l_int|256
suffix:semicolon
id|fb-&gt;mmap
op_assign
id|cg6_mmap
suffix:semicolon
id|fb-&gt;loadcmap
op_assign
id|cg6_loadcmap
suffix:semicolon
id|fb-&gt;reset
op_assign
id|cg6_reset
suffix:semicolon
id|fb-&gt;blank
op_assign
id|cg6_blank
suffix:semicolon
id|fb-&gt;unblank
op_assign
id|cg6_unblank
suffix:semicolon
id|fb-&gt;setcursor
op_assign
id|cg6_setcursor
suffix:semicolon
id|fb-&gt;setcursormap
op_assign
id|cg6_setcursormap
suffix:semicolon
id|fb-&gt;setcurshape
op_assign
id|cg6_setcurshape
suffix:semicolon
id|fb-&gt;postsetup
op_assign
id|cg_postsetup
suffix:semicolon
id|fb-&gt;blitc
op_assign
id|cg6_blitc
suffix:semicolon
id|fb-&gt;setw
op_assign
id|cg6_setw
suffix:semicolon
id|fb-&gt;cpyw
op_assign
id|cg6_cpyw
suffix:semicolon
id|cg6info
op_assign
(paren
r_struct
id|cg6_info
op_star
)paren
op_amp
id|fb-&gt;info.cg6
suffix:semicolon
multiline_comment|/* Map the hardware registers */
id|cg6info-&gt;bt
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_BROOKTREE_OFFSET
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|bt_regs
)paren
comma
l_string|&quot;cgsix_dac&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
id|cg6info-&gt;fhc
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_FHC_OFFSET
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
comma
l_string|&quot;cgsix_fhc&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if PAGE_SHIFT &lt;= 12&t;&t; 
id|cg6info-&gt;thc
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_THC_OFFSET
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cg6_thc
)paren
comma
l_string|&quot;cgsix_thc&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
id|cg6info-&gt;thc
op_assign
(paren
r_struct
id|cg6_thc
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|cg6info-&gt;fhc
)paren
op_plus
l_int|0x1000
)paren
suffix:semicolon
macro_line|#endif
id|cg6info-&gt;fbc
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_FBC_OFFSET
comma
l_int|0
comma
l_int|0x1000
comma
l_string|&quot;cgsix_fbc&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if PAGE_SHIFT &lt;= 12&t;&t; 
id|cg6info-&gt;tec
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_TEC_OFFSET
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cg6_tec
)paren
comma
l_string|&quot;cgsix_tec&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
id|cg6info-&gt;tec
op_assign
(paren
r_struct
id|cg6_tec
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|cg6info-&gt;fbc
)paren
op_plus
l_int|0x1000
)paren
suffix:semicolon
macro_line|#endif
id|cg6info-&gt;dhc
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_DHC_OFFSET
comma
l_int|0
comma
l_int|0x40000
comma
l_string|&quot;cgsix_dhc&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
id|cg6info-&gt;rom
op_assign
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_ROM_OFFSET
comma
l_int|0
comma
l_int|0x10000
comma
l_string|&quot;cgsix_rom&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb-&gt;base
)paren
(brace
id|fb-&gt;base
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
(paren
id|cg6
op_plus
id|CG6_RAM_OFFSET
comma
l_int|0
comma
id|fb-&gt;type.fb_size
comma
l_string|&quot;cgsix_ram&quot;
comma
id|cg6_io
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slot
op_eq
id|sun_prom_console_id
)paren
id|fb_restore_palette
op_assign
id|cg6_restore_palette
suffix:semicolon
multiline_comment|/* Initialize Brooktree DAC */
id|cg6info-&gt;bt-&gt;addr
op_assign
l_int|0x04
op_lshift
l_int|24
suffix:semicolon
multiline_comment|/* color planes */
id|cg6info-&gt;bt-&gt;control
op_assign
l_int|0xff
op_lshift
l_int|24
suffix:semicolon
id|cg6info-&gt;bt-&gt;addr
op_assign
l_int|0x05
op_lshift
l_int|24
suffix:semicolon
id|cg6info-&gt;bt-&gt;control
op_assign
l_int|0x00
op_lshift
l_int|24
suffix:semicolon
id|cg6info-&gt;bt-&gt;addr
op_assign
l_int|0x06
op_lshift
l_int|24
suffix:semicolon
multiline_comment|/* overlay plane */
id|cg6info-&gt;bt-&gt;control
op_assign
l_int|0x73
op_lshift
l_int|24
suffix:semicolon
id|cg6info-&gt;bt-&gt;addr
op_assign
l_int|0x07
op_lshift
l_int|24
suffix:semicolon
id|cg6info-&gt;bt-&gt;control
op_assign
l_int|0x00
op_lshift
l_int|24
suffix:semicolon
macro_line|#ifdef __sparc_v9__&t;
id|printk
c_func
(paren
l_string|&quot;VA %016lx &quot;
comma
id|fb-&gt;base
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;TEC Rev %x &quot;
comma
(paren
id|cg6info-&gt;thc-&gt;thc_misc
op_rshift
id|CG6_THC_MISC_REV_SHIFT
)paren
op_amp
id|CG6_THC_MISC_REV_MASK
)paren
suffix:semicolon
multiline_comment|/* Get FHC Revision */
id|conf
op_assign
op_star
(paren
id|cg6info-&gt;fhc
)paren
suffix:semicolon
id|cpu
op_assign
id|conf
op_amp
id|CG6_FHC_CPU_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CPU &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu
op_eq
id|CG6_FHC_CPU_SPARC
)paren
id|printk
c_func
(paren
l_string|&quot;sparc &quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cpu
op_eq
id|CG6_FHC_CPU_68020
)paren
id|printk
c_func
(paren
l_string|&quot;68020 &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;386 &quot;
)paren
suffix:semicolon
id|rev
op_assign
id|conf
op_rshift
id|CG6_FHC_REV_SHIFT
op_amp
id|CG6_FHC_REV_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Rev %x&bslash;n&quot;
comma
id|rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_logical_and
id|sun_prom_console_id
op_eq
id|slot
)paren
r_return
suffix:semicolon
multiline_comment|/* Reset the cg6 */
id|cg6_reset
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot
)paren
(brace
multiline_comment|/* Enable Video */
id|cg6_unblank
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_else
(brace
id|cg6_blank
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
)brace
r_extern
r_int
r_char
id|vga_font
(braket
)braket
suffix:semicolon
DECL|macro|GX_BLITC_START
mdefine_line|#define GX_BLITC_START(attr) &bslash;&n;&t;{ &bslash;&n;&t;&t;register struct cg6_fbc *gx = fbinfo[0].info.cg6.fbc; &bslash;&n;&t;&t;register uint i; &bslash;&n;&t;&t;do { &bslash;&n;&t;&t;&t;i = gx-&gt;s; &bslash;&n;&t;&t;} while (i &amp; 0x10000000); &bslash;&n;&t;&t;gx-&gt;fg = attr &amp; 0xf; &bslash;&n;&t;&t;gx-&gt;bg = (attr&gt;&gt;4); &bslash;&n;&t;&t;gx-&gt;mode = 0x140000; &bslash;&n;&t;&t;gx-&gt;alu = 0xe880fc30; &bslash;&n;&t;&t;gx-&gt;pixelm = ~(0); &bslash;&n;&t;&t;gx-&gt;s = 0; &bslash;&n;&t;&t;gx-&gt;clip = 0; &bslash;&n;&t;&t;gx-&gt;pm = 0xff;
DECL|macro|GX_BLITC_BODY4
mdefine_line|#define GX_BLITC_BODY4(count,x,y,start,action) &bslash;&n;&t;&t;while (count &gt;= 4) { &bslash;&n;&t;&t;&t;count -= 4; &bslash;&n;&t;&t;    &t;gx-&gt;incx = 0; &bslash;&n;&t;&t;    &t;gx-&gt;incy = 1; &bslash;&n;&t;&t;    &t;gx-&gt;x0 = x; &bslash;&n;&t;&t;    &t;gx-&gt;x1 = (x += 32) - 1; &bslash;&n;&t;&t;    &t;gx-&gt;y0 = y; &bslash;&n;&t;&t;    &t;start; &bslash;&n;&t;&t;    &t;for (i = 0; i &lt; CHAR_HEIGHT; i++) { &bslash;&n;&t;&t;    &t;&t;action; &bslash;&n;&t;&t;    &t;} &bslash;&n;&t;&t;}
DECL|macro|GX_BLITC_BODY1
mdefine_line|#define GX_BLITC_BODY1(x,y,action) &bslash;&n;&t;&t;    &t;gx-&gt;incx = 0; &bslash;&n;&t;&t;    &t;gx-&gt;incy = 1; &bslash;&n;&t;&t;    &t;gx-&gt;x0 = x; &bslash;&n;&t;&t;    &t;gx-&gt;x1 = (x += 8) - 1; &bslash;&n;&t;&t;    &t;gx-&gt;y0 = y; &bslash;&n;&t;&t;    &t;for (i = 0; i &lt; CHAR_HEIGHT; i++) { &bslash;&n;&t;&t;    &t;&t;action; &bslash;&n;&t;&t;    &t;}
DECL|macro|GX_BLITC_END
mdefine_line|#define GX_BLITC_END &bslash;&n;&t;}
DECL|function|cg6_blitc
r_static
r_void
id|cg6_blitc
c_func
(paren
r_int
r_int
id|charattr
comma
r_int
id|xoff
comma
r_int
id|yoff
)paren
(brace
r_int
r_char
id|attrib
op_assign
id|CHARATTR_TO_SUNCOLOR
c_func
(paren
id|charattr
)paren
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
id|charattr
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|GX_BLITC_START
c_func
(paren
id|attrib
)paren
id|GX_BLITC_BODY1
c_func
(paren
id|xoff
comma
id|yoff
comma
id|gx-&gt;font
op_assign
(paren
(paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|24
)paren
)paren
id|GX_BLITC_END
)brace
DECL|function|cg6_setw
r_static
r_void
id|cg6_setw
c_func
(paren
r_int
id|xoff
comma
r_int
id|yoff
comma
r_int
r_int
id|c
comma
r_int
id|count
)paren
(brace
r_int
r_char
id|attrib
op_assign
id|CHARATTR_TO_SUNCOLOR
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
id|c
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
r_register
r_int
r_char
op_star
id|q
suffix:semicolon
r_register
id|uint
id|l
suffix:semicolon
id|GX_BLITC_START
c_func
(paren
id|attrib
)paren
r_if
c_cond
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|GX_BLITC_BODY4
c_func
(paren
id|count
comma
id|xoff
comma
id|yoff
comma
id|q
op_assign
id|p
comma
id|l
op_assign
op_star
id|q
op_increment
suffix:semicolon
id|l
op_or_assign
id|l
op_lshift
l_int|8
suffix:semicolon
id|l
op_or_assign
id|l
op_lshift
l_int|16
suffix:semicolon
id|gx-&gt;font
op_assign
id|l
)paren
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|q
op_assign
id|p
suffix:semicolon
id|GX_BLITC_BODY1
c_func
(paren
id|xoff
comma
id|yoff
comma
id|gx-&gt;font
op_assign
(paren
(paren
op_star
id|q
op_increment
)paren
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
)brace
id|GX_BLITC_END
)brace
DECL|function|cg6_cpyw
r_static
r_void
id|cg6_cpyw
c_func
(paren
r_int
id|xoff
comma
r_int
id|yoff
comma
r_int
r_int
op_star
id|p
comma
r_int
id|count
)paren
(brace
r_int
r_char
id|attrib
op_assign
id|CHARATTR_TO_SUNCOLOR
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_int
r_char
op_star
id|p1
comma
op_star
id|p2
comma
op_star
id|p3
comma
op_star
id|p4
suffix:semicolon
id|GX_BLITC_START
c_func
(paren
id|attrib
)paren
r_if
c_cond
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|GX_BLITC_BODY4
c_func
(paren
id|count
comma
id|xoff
comma
id|yoff
comma
id|p1
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|p2
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|p3
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|p4
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|4
)braket
comma
id|gx-&gt;font
op_assign
(paren
(paren
id|uint
)paren
op_star
id|p4
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|uint
)paren
op_star
id|p3
op_increment
)paren
op_or
(paren
(paren
(paren
(paren
id|uint
)paren
op_star
id|p2
op_increment
)paren
op_or
(paren
(paren
(paren
id|uint
)paren
op_star
id|p1
op_increment
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
l_int|8
)paren
)paren
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|p1
op_assign
op_amp
id|vga_font
(braket
(paren
(paren
r_int
r_char
)paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|4
)braket
suffix:semicolon
id|GX_BLITC_BODY1
c_func
(paren
id|xoff
comma
id|yoff
comma
id|gx-&gt;font
op_assign
(paren
(paren
op_star
id|p1
op_increment
)paren
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
)brace
id|GX_BLITC_END
)brace
DECL|macro|GX_FILL_START
mdefine_line|#define GX_FILL_START(attr) &bslash;&n;&t;{ &bslash;&n;&t;&t;register struct cg6_fbc *gx = fbinfo[0].info.cg6.fbc; &bslash;&n;&t;&t;register uint i; &bslash;&n;&t;&t;do { &bslash;&n;&t;&t;&t;i = gx-&gt;s; &bslash;&n;&t;&t;} while (i &amp; 0x10000000); &bslash;&n;&t;&t;gx-&gt;fg = attr &amp; 0xf; &bslash;&n;&t;&t;gx-&gt;bg = 0; &bslash;&n;&t;&t;gx-&gt;pixelm = ~(0); &bslash;&n;&t;&t;gx-&gt;s = 0; &bslash;&n;&t;&t;gx-&gt;alu = 0xea80ff00; &bslash;&n;&t;&t;gx-&gt;pm = ~(0); &bslash;&n;&t;&t;gx-&gt;clip = 0;
DECL|macro|GX_FILL_END
mdefine_line|#define GX_FILL_END &bslash;&n;&t;}
macro_line|#if 0
r_static
r_void
id|cg6_fill
c_func
(paren
r_int
id|attrib
comma
r_int
id|count
comma
r_int
op_star
id|boxes
)paren
(brace
r_register
r_int
id|r
suffix:semicolon
id|attrib
op_assign
l_int|5
suffix:semicolon
id|GX_FILL_START
c_func
(paren
id|attrib
)paren
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
id|gx-&gt;arecty
op_assign
id|boxes
(braket
l_int|1
)braket
suffix:semicolon
id|gx-&gt;arectx
op_assign
id|boxes
(braket
l_int|0
)braket
suffix:semicolon
id|gx-&gt;arecty
op_assign
id|boxes
(braket
l_int|3
)braket
suffix:semicolon
id|gx-&gt;arecty
op_assign
id|boxes
(braket
l_int|2
)braket
suffix:semicolon
id|boxes
op_add_assign
l_int|4
suffix:semicolon
r_do
(brace
id|r
op_assign
id|gx-&gt;draw
suffix:semicolon
)brace
r_while
c_loop
(paren
id|r
OL
l_int|0
op_logical_and
(paren
id|r
op_amp
l_int|0x20000000
)paren
)paren
suffix:semicolon
)brace
id|GX_FILL_END
)brace
macro_line|#endif
eof
