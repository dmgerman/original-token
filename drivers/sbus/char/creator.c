multiline_comment|/* $Id: creator.c,v 1.7 1997/07/17 02:21:47 davem Exp $&n; * creator.c: Creator/Creator3D frame buffer driver&n; *&n; * Copyright (C) 1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* These must be included after asm/fbio.h */
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console_struct.h&gt;
macro_line|#include &quot;fb.h&quot;
macro_line|#include &quot;cg_common.h&quot;
DECL|macro|FFB_SFB8R_VOFF
mdefine_line|#define&t;FFB_SFB8R_VOFF&t;&t;0x00000000
DECL|macro|FFB_SFB8G_VOFF
mdefine_line|#define&t;FFB_SFB8G_VOFF&t;&t;0x00400000
DECL|macro|FFB_SFB8B_VOFF
mdefine_line|#define&t;FFB_SFB8B_VOFF&t;&t;0x00800000
DECL|macro|FFB_SFB8X_VOFF
mdefine_line|#define&t;FFB_SFB8X_VOFF&t;&t;0x00c00000
DECL|macro|FFB_SFB32_VOFF
mdefine_line|#define&t;FFB_SFB32_VOFF&t;&t;0x01000000
DECL|macro|FFB_SFB64_VOFF
mdefine_line|#define&t;FFB_SFB64_VOFF&t;&t;0x02000000
DECL|macro|FFB_FBC_REGS_VOFF
mdefine_line|#define&t;FFB_FBC_REGS_VOFF&t;0x04000000
DECL|macro|FFB_BM_FBC_REGS_VOFF
mdefine_line|#define&t;FFB_BM_FBC_REGS_VOFF&t;0x04002000
DECL|macro|FFB_DFB8R_VOFF
mdefine_line|#define&t;FFB_DFB8R_VOFF&t;&t;0x04004000
DECL|macro|FFB_DFB8G_VOFF
mdefine_line|#define&t;FFB_DFB8G_VOFF&t;&t;0x04404000
DECL|macro|FFB_DFB8B_VOFF
mdefine_line|#define&t;FFB_DFB8B_VOFF&t;&t;0x04804000
DECL|macro|FFB_DFB8X_VOFF
mdefine_line|#define&t;FFB_DFB8X_VOFF&t;&t;0x04c04000
DECL|macro|FFB_DFB24_VOFF
mdefine_line|#define&t;FFB_DFB24_VOFF&t;&t;0x05004000
DECL|macro|FFB_DFB32_VOFF
mdefine_line|#define&t;FFB_DFB32_VOFF&t;&t;0x06004000
DECL|macro|FFB_DFB422A_VOFF
mdefine_line|#define&t;FFB_DFB422A_VOFF&t;0x07004000&t;/* DFB 422 mode write to A */
DECL|macro|FFB_DFB422AD_VOFF
mdefine_line|#define&t;FFB_DFB422AD_VOFF&t;0x07804000&t;/* DFB 422 mode with line doubling */
DECL|macro|FFB_DFB24B_VOFF
mdefine_line|#define&t;FFB_DFB24B_VOFF&t;&t;0x08004000&t;/* DFB 24bit mode write to B */
DECL|macro|FFB_DFB422B_VOFF
mdefine_line|#define&t;FFB_DFB422B_VOFF&t;0x09004000&t;/* DFB 422 mode write to B */
DECL|macro|FFB_DFB422BD_VOFF
mdefine_line|#define&t;FFB_DFB422BD_VOFF&t;0x09804000&t;/* DFB 422 mode with line doubling */
DECL|macro|FFB_SFB16Z_VOFF
mdefine_line|#define&t;FFB_SFB16Z_VOFF&t;&t;0x0a004000&t;/* 16bit mode Z planes */
DECL|macro|FFB_SFB8Z_VOFF
mdefine_line|#define&t;FFB_SFB8Z_VOFF&t;&t;0x0a404000&t;/* 8bit mode Z planes */
DECL|macro|FFB_SFB422_VOFF
mdefine_line|#define&t;FFB_SFB422_VOFF&t;&t;0x0ac04000&t;/* SFB 422 mode write to A/B */
DECL|macro|FFB_SFB422D_VOFF
mdefine_line|#define&t;FFB_SFB422D_VOFF&t;0x0b404000&t;/* SFB 422 mode with line doubling */
DECL|macro|FFB_FBC_KREGS_VOFF
mdefine_line|#define&t;FFB_FBC_KREGS_VOFF&t;0x0bc04000
DECL|macro|FFB_DAC_VOFF
mdefine_line|#define&t;FFB_DAC_VOFF&t;&t;0x0bc06000
DECL|macro|FFB_PROM_VOFF
mdefine_line|#define&t;FFB_PROM_VOFF&t;&t;0x0bc08000
DECL|macro|FFB_EXP_VOFF
mdefine_line|#define&t;FFB_EXP_VOFF&t;&t;0x0bc18000
DECL|macro|FFB_SFB8R_POFF
mdefine_line|#define&t;FFB_SFB8R_POFF&t;&t;0x04000000
DECL|macro|FFB_SFB8G_POFF
mdefine_line|#define&t;FFB_SFB8G_POFF&t;&t;0x04400000
DECL|macro|FFB_SFB8B_POFF
mdefine_line|#define&t;FFB_SFB8B_POFF&t;&t;0x04800000
DECL|macro|FFB_SFB8X_POFF
mdefine_line|#define&t;FFB_SFB8X_POFF&t;&t;0x04c00000
DECL|macro|FFB_SFB32_POFF
mdefine_line|#define&t;FFB_SFB32_POFF&t;&t;0x05000000
DECL|macro|FFB_SFB64_POFF
mdefine_line|#define&t;FFB_SFB64_POFF&t;&t;0x06000000
DECL|macro|FFB_FBC_REGS_POFF
mdefine_line|#define&t;FFB_FBC_REGS_POFF&t;0x00600000
DECL|macro|FFB_BM_FBC_REGS_POFF
mdefine_line|#define&t;FFB_BM_FBC_REGS_POFF&t;0x00600000
DECL|macro|FFB_DFB8R_POFF
mdefine_line|#define&t;FFB_DFB8R_POFF&t;&t;0x01000000
DECL|macro|FFB_DFB8G_POFF
mdefine_line|#define&t;FFB_DFB8G_POFF&t;&t;0x01400000
DECL|macro|FFB_DFB8B_POFF
mdefine_line|#define&t;FFB_DFB8B_POFF&t;&t;0x01800000
DECL|macro|FFB_DFB8X_POFF
mdefine_line|#define&t;FFB_DFB8X_POFF&t;&t;0x01c00000
DECL|macro|FFB_DFB24_POFF
mdefine_line|#define&t;FFB_DFB24_POFF&t;&t;0x02000000
DECL|macro|FFB_DFB32_POFF
mdefine_line|#define&t;FFB_DFB32_POFF&t;&t;0x03000000
DECL|macro|FFB_FBC_KREGS_POFF
mdefine_line|#define&t;FFB_FBC_KREGS_POFF&t;0x00610000
DECL|macro|FFB_DAC_POFF
mdefine_line|#define&t;FFB_DAC_POFF&t;&t;0x00400000
DECL|macro|FFB_PROM_POFF
mdefine_line|#define&t;FFB_PROM_POFF&t;&t;0x00000000
DECL|macro|FFB_EXP_POFF
mdefine_line|#define&t;FFB_EXP_POFF&t;&t;0x00200000
DECL|macro|FFB_Y_BYTE_ADDR_SHIFT
mdefine_line|#define FFB_Y_BYTE_ADDR_SHIFT          11
DECL|macro|FFB_Y_ADDR_SHIFT
mdefine_line|#define FFB_Y_ADDR_SHIFT               13
DECL|macro|FFB_PPC_ACE_DISABLE
mdefine_line|#define FFB_PPC_ACE_DISABLE             1
DECL|macro|FFB_PPC_ACE_AUX_ADD
mdefine_line|#define FFB_PPC_ACE_AUX_ADD             3
DECL|macro|FFB_PPC_ACE_SHIFT
mdefine_line|#define FFB_PPC_ACE_SHIFT              18
DECL|macro|FFB_PPC_DCE_DISABLE
mdefine_line|#define FFB_PPC_DCE_DISABLE             2
DECL|macro|FFB_PPC_DCE_SHIFT
mdefine_line|#define FFB_PPC_DCE_SHIFT              16
DECL|macro|FFB_PPC_ABE_DISABLE
mdefine_line|#define FFB_PPC_ABE_DISABLE             2
DECL|macro|FFB_PPC_ABE_SHIFT
mdefine_line|#define FFB_PPC_ABE_SHIFT              14
DECL|macro|FFB_PPC_VCE_DISABLE
mdefine_line|#define FFB_PPC_VCE_DISABLE             1
DECL|macro|FFB_PPC_VCE_2D
mdefine_line|#define FFB_PPC_VCE_2D                  2
DECL|macro|FFB_PPC_VCE_SHIFT
mdefine_line|#define FFB_PPC_VCE_SHIFT              12
DECL|macro|FFB_PPC_APE_DISABLE
mdefine_line|#define FFB_PPC_APE_DISABLE             2
DECL|macro|FFB_PPC_APE_SHIFT
mdefine_line|#define FFB_PPC_APE_SHIFT              10
DECL|macro|FFB_PPC_CS_VARIABLE
mdefine_line|#define FFB_PPC_CS_VARIABLE             2
DECL|macro|FFB_PPC_CS_SHIFT
mdefine_line|#define FFB_PPC_CS_SHIFT                0
DECL|macro|FFB_FBC_WB_A
mdefine_line|#define FFB_FBC_WB_A                    1
DECL|macro|FFB_FBC_WB_SHIFT
mdefine_line|#define FFB_FBC_WB_SHIFT               29
DECL|macro|FFB_FBC_PGE_MASK
mdefine_line|#define FFB_FBC_PGE_MASK                3
DECL|macro|FFB_FBC_BE_SHIFT
mdefine_line|#define FFB_FBC_BE_SHIFT                4
DECL|macro|FFB_FBC_GE_SHIFT
mdefine_line|#define FFB_FBC_GE_SHIFT                2
DECL|macro|FFB_FBC_RE_SHIFT
mdefine_line|#define FFB_FBC_RE_SHIFT                0
DECL|macro|FFB_ROP_NEW
mdefine_line|#define FFB_ROP_NEW                  0x83
DECL|macro|FFB_ROP_RGB_SHIFT
mdefine_line|#define FFB_ROP_RGB_SHIFT               0
DECL|macro|FFB_UCSR_FIFO_MASK
mdefine_line|#define FFB_UCSR_FIFO_MASK     0x00000fff
DECL|macro|FFB_UCSR_RP_BUSY
mdefine_line|#define FFB_UCSR_RP_BUSY       0x02000000
DECL|struct|ffb_fbc
r_struct
id|ffb_fbc
(brace
DECL|member|xxx1
id|u8
id|xxx1
(braket
l_int|0x200
)braket
suffix:semicolon
DECL|member|ppc
r_volatile
id|u32
id|ppc
suffix:semicolon
DECL|member|xxx2
id|u8
id|xxx2
(braket
l_int|0x50
)braket
suffix:semicolon
DECL|member|fbc
r_volatile
id|u32
id|fbc
suffix:semicolon
DECL|member|rop
r_volatile
id|u32
id|rop
suffix:semicolon
DECL|member|xxx3
id|u8
id|xxx3
(braket
l_int|0x34
)braket
suffix:semicolon
DECL|member|pmask
r_volatile
id|u32
id|pmask
suffix:semicolon
DECL|member|xxx4
id|u8
id|xxx4
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|clip0min
r_volatile
id|u32
id|clip0min
suffix:semicolon
DECL|member|clip0max
r_volatile
id|u32
id|clip0max
suffix:semicolon
DECL|member|clip1min
r_volatile
id|u32
id|clip1min
suffix:semicolon
DECL|member|clip1max
r_volatile
id|u32
id|clip1max
suffix:semicolon
DECL|member|clip2min
r_volatile
id|u32
id|clip2min
suffix:semicolon
DECL|member|clip2max
r_volatile
id|u32
id|clip2max
suffix:semicolon
DECL|member|clip3min
r_volatile
id|u32
id|clip3min
suffix:semicolon
DECL|member|clip3max
r_volatile
id|u32
id|clip3max
suffix:semicolon
DECL|member|xxx5
id|u8
id|xxx5
(braket
l_int|0x3c
)braket
suffix:semicolon
DECL|member|unk1
r_volatile
id|u32
id|unk1
suffix:semicolon
DECL|member|xxx6
id|u8
id|xxx6
(braket
l_int|0x500
)braket
suffix:semicolon
DECL|member|unk2
r_volatile
id|u32
id|unk2
suffix:semicolon
DECL|member|xxx7
id|u8
id|xxx7
(braket
l_int|0xfc
)braket
suffix:semicolon
DECL|member|ucsr
r_volatile
id|u32
id|ucsr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ffb_dac
r_struct
id|ffb_dac
(brace
DECL|member|type
r_volatile
id|u32
id|type
suffix:semicolon
DECL|member|value
r_volatile
id|u32
id|value
suffix:semicolon
DECL|member|type2
r_volatile
id|u32
id|type2
suffix:semicolon
DECL|member|value2
r_volatile
id|u32
id|value2
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
DECL|function|ffb_restore_palette
id|ffb_restore_palette
(paren
id|fbinfo_t
op_star
id|fbinfo
)paren
(brace
)brace
r_static
r_void
id|ffb_blitc
c_func
(paren
r_int
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ffb_setw
c_func
(paren
r_int
comma
r_int
comma
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ffb_cpyw
c_func
(paren
r_int
comma
r_int
comma
r_int
r_int
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ffb_fill
c_func
(paren
r_int
comma
r_int
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_struct
(brace
DECL|member|voff
r_int
r_int
id|voff
suffix:semicolon
DECL|member|poff
r_int
r_int
id|poff
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|variable|ffbmmap
)brace
id|ffbmmap
(braket
)braket
op_assign
(brace
(brace
id|FFB_SFB8R_VOFF
comma
id|FFB_SFB8R_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_SFB8G_VOFF
comma
id|FFB_SFB8G_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_SFB8B_VOFF
comma
id|FFB_SFB8B_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_SFB8X_VOFF
comma
id|FFB_SFB8X_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_SFB32_VOFF
comma
id|FFB_SFB32_POFF
comma
l_int|0x1000000
)brace
comma
(brace
id|FFB_SFB64_VOFF
comma
id|FFB_SFB64_POFF
comma
l_int|0x2000000
)brace
comma
(brace
id|FFB_FBC_REGS_VOFF
comma
id|FFB_FBC_REGS_POFF
comma
l_int|0x0002000
)brace
comma
(brace
id|FFB_BM_FBC_REGS_VOFF
comma
id|FFB_BM_FBC_REGS_POFF
comma
l_int|0x0002000
)brace
comma
(brace
id|FFB_DFB8R_VOFF
comma
id|FFB_DFB8R_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_DFB8G_VOFF
comma
id|FFB_DFB8G_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_DFB8B_VOFF
comma
id|FFB_DFB8B_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_DFB8X_VOFF
comma
id|FFB_DFB8X_POFF
comma
l_int|0x0400000
)brace
comma
(brace
id|FFB_DFB24_VOFF
comma
id|FFB_DFB24_POFF
comma
l_int|0x1000000
)brace
comma
(brace
id|FFB_DFB32_VOFF
comma
id|FFB_DFB32_POFF
comma
l_int|0x1000000
)brace
comma
(brace
id|FFB_FBC_KREGS_VOFF
comma
id|FFB_FBC_KREGS_POFF
comma
l_int|0x0002000
)brace
comma
(brace
id|FFB_DAC_VOFF
comma
id|FFB_DAC_POFF
comma
l_int|0x0002000
)brace
comma
(brace
id|FFB_PROM_VOFF
comma
id|FFB_PROM_POFF
comma
l_int|0x0010000
)brace
comma
(brace
id|FFB_EXP_VOFF
comma
id|FFB_EXP_POFF
comma
l_int|0x0002000
)brace
)brace
suffix:semicolon
multiline_comment|/* Ugh: X wants to mmap a bunch of cute stuff at the same time :-( */
multiline_comment|/* So, we just mmap the things that are being asked for */
r_static
r_int
DECL|function|ffb_mmap
id|ffb_mmap
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
id|base
comma
id|fbinfo_t
op_star
id|fb
)paren
(brace
id|uint
id|size
comma
id|page
comma
id|r
comma
id|map_size
suffix:semicolon
r_int
r_int
id|map_offset
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_offset
op_amp
op_complement
id|PAGE_MASK
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/* Try to align RAM */
DECL|macro|ALIGNMENT
mdefine_line|#define ALIGNMENT 0x400000
id|map_offset
op_assign
id|vma-&gt;vm_offset
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_offset
OL
id|FFB_FBC_REGS_VOFF
)paren
(brace
r_struct
id|vm_area_struct
op_star
id|vmm
op_assign
id|find_vma
c_func
(paren
id|current-&gt;mm
comma
id|vma-&gt;vm_start
)paren
suffix:semicolon
r_int
id|alignment
op_assign
id|ALIGNMENT
op_minus
(paren
(paren
id|vma-&gt;vm_start
op_minus
id|vma-&gt;vm_offset
)paren
op_amp
(paren
id|ALIGNMENT
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alignment
op_eq
id|ALIGNMENT
)paren
id|alignment
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|alignment
op_logical_and
(paren
op_logical_neg
id|vmm
op_logical_or
id|vmm-&gt;vm_start
op_ge
id|vma-&gt;vm_end
op_plus
id|alignment
)paren
)paren
(brace
id|vma-&gt;vm_start
op_add_assign
id|alignment
suffix:semicolon
id|vma-&gt;vm_end
op_add_assign
id|alignment
suffix:semicolon
)brace
)brace
DECL|macro|ALIGNMENT
macro_line|#undef ALIGNMENT
multiline_comment|/* To stop the swapper from even considering these pages */
id|vma-&gt;vm_flags
op_or_assign
id|FB_MMAP_VM_FLAGS
suffix:semicolon
multiline_comment|/* Each page, see which map applies */
r_for
c_loop
(paren
id|page
op_assign
l_int|0
suffix:semicolon
id|page
OL
id|size
suffix:semicolon
)paren
(brace
id|map_size
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|ffbmmap
)paren
op_div
r_sizeof
(paren
id|ffbmmap
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ffbmmap
(braket
id|i
)braket
dot
id|voff
op_eq
id|vma-&gt;vm_offset
op_plus
id|page
)paren
(brace
id|map_size
op_assign
id|ffbmmap
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|map_offset
op_assign
id|fb-&gt;info.ffb.physbase
op_plus
id|ffbmmap
(braket
id|i
)braket
dot
id|poff
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|map_size
)paren
(brace
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|page
op_plus
id|map_size
OG
id|size
)paren
id|map_size
op_assign
id|size
op_minus
id|page
suffix:semicolon
id|r
op_assign
id|io_remap_page_range
(paren
id|vma-&gt;vm_start
op_plus
id|page
comma
id|map_offset
comma
id|map_size
comma
id|vma-&gt;vm_page_prot
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|page
op_add_assign
id|map_size
suffix:semicolon
)brace
id|vma-&gt;vm_dentry
op_assign
id|dget
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* XXX write body of these two... */
r_static
r_inline
r_int
DECL|function|ffb_wid_get
id|ffb_wid_get
(paren
id|fbinfo_t
op_star
id|fb
comma
r_struct
id|fb_wid_list
op_star
id|wl
)paren
(brace
r_struct
id|fb_wid_item
op_star
id|wi
suffix:semicolon
r_struct
id|fb_wid_list
id|wlt
suffix:semicolon
r_struct
id|fb_wid_item
id|wit
(braket
l_int|30
)braket
suffix:semicolon
r_char
op_star
id|km
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|u32
id|l
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifdef CONFIG_SPARC32_COMPAT
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|wlt
comma
id|wl
comma
l_int|2
op_star
r_sizeof
(paren
id|__u32
)paren
)paren
op_logical_or
id|__get_user
(paren
(paren
r_int
)paren
id|wlt.wl_list
comma
(paren
(paren
(paren
id|__u32
op_star
)paren
id|wl
)paren
op_plus
l_int|2
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|wlt
comma
id|wl
comma
r_sizeof
(paren
id|wlt
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|wlt.wl_count
op_le
l_int|30
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
id|wit
comma
id|wlt.wl_list
comma
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|wi
op_assign
id|wit
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|wlt.wl_count
OG
l_int|120
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
id|wi
op_assign
(paren
r_struct
id|fb_wid_item
op_star
)paren
id|km
op_assign
id|kmalloc
(paren
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wi
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
id|wi
comma
id|wlt.wl_list
comma
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
)paren
)paren
(brace
id|kfree
(paren
id|wi
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlt.wl_count
suffix:semicolon
id|i
op_increment
comma
id|wi
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|wi-&gt;wi_type
)paren
(brace
r_case
id|FB_WID_DBL_8
suffix:colon
id|j
op_assign
(paren
id|wi-&gt;wi_index
op_amp
l_int|0xf
)paren
op_plus
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_WID_DBL_24
suffix:colon
id|j
op_assign
id|wi-&gt;wi_index
op_amp
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|wi-&gt;wi_attrs
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|32
suffix:semicolon
id|j
op_increment
)paren
id|wi-&gt;wi_values
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|wlt.wl_list
comma
id|km
ques
c_cond
id|km
suffix:colon
(paren
r_char
op_star
)paren
id|wit
comma
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|km
)paren
id|kfree
(paren
id|km
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|ffb_wid_put
id|ffb_wid_put
(paren
id|fbinfo_t
op_star
id|fb
comma
r_struct
id|fb_wid_list
op_star
id|wl
)paren
(brace
r_struct
id|fb_wid_item
op_star
id|wi
suffix:semicolon
r_struct
id|fb_wid_list
id|wlt
suffix:semicolon
r_struct
id|fb_wid_item
id|wit
(braket
l_int|30
)braket
suffix:semicolon
r_char
op_star
id|km
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|u32
id|l
suffix:semicolon
macro_line|#ifdef CONFIG_SPARC32_COMPAT
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|wlt
comma
id|wl
comma
l_int|2
op_star
r_sizeof
(paren
id|__u32
)paren
)paren
op_logical_or
id|__get_user
(paren
(paren
r_int
)paren
id|wlt.wl_list
comma
(paren
(paren
(paren
id|__u32
op_star
)paren
id|wl
)paren
op_plus
l_int|2
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|wlt
comma
id|wl
comma
r_sizeof
(paren
id|wlt
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|wlt.wl_count
op_le
l_int|30
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
id|wit
comma
id|wlt.wl_list
comma
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|wi
op_assign
id|wit
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|wlt.wl_count
OG
l_int|120
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
id|wi
op_assign
(paren
r_struct
id|fb_wid_item
op_star
)paren
id|km
op_assign
id|kmalloc
(paren
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wi
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
id|wi
comma
id|wlt.wl_list
comma
id|wlt.wl_count
op_star
r_sizeof
(paren
op_star
id|wi
)paren
)paren
)paren
(brace
id|kfree
(paren
id|wi
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlt.wl_count
suffix:semicolon
id|i
op_increment
comma
id|wi
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|wi-&gt;wi_type
)paren
(brace
r_case
id|FB_WID_DBL_8
suffix:colon
id|j
op_assign
(paren
id|wi-&gt;wi_index
op_amp
l_int|0xf
)paren
op_plus
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_WID_DBL_24
suffix:colon
id|j
op_assign
id|wi-&gt;wi_index
op_amp
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* x =&t;wi-&gt;wi_values [j] */
suffix:semicolon
)brace
r_if
c_cond
(paren
id|km
)paren
id|kfree
(paren
id|km
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|ffb_curs_enable
id|ffb_curs_enable
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|fb-&gt;info.ffb.dac
suffix:semicolon
id|dac-&gt;type2
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;info.ffb.dac_rev
op_le
l_int|2
)paren
id|dac-&gt;value2
op_assign
id|enable
ques
c_cond
l_int|3
suffix:colon
l_int|0
suffix:semicolon
r_else
id|dac-&gt;value2
op_assign
id|enable
ques
c_cond
l_int|0
suffix:colon
l_int|3
suffix:semicolon
)brace
r_static
r_void
DECL|function|ffb_setcursormap
id|ffb_setcursormap
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
r_char
op_star
id|red
comma
r_int
r_char
op_star
id|green
comma
r_int
r_char
op_star
id|blue
)paren
(brace
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|fb-&gt;info.ffb.dac
suffix:semicolon
id|ffb_curs_enable
(paren
id|fb
comma
l_int|0
)paren
suffix:semicolon
id|dac-&gt;type2
op_assign
l_int|0x102
suffix:semicolon
id|dac-&gt;value2
op_assign
(paren
id|red
(braket
l_int|0
)braket
op_or
(paren
id|green
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|dac-&gt;value2
op_assign
(paren
id|red
(braket
l_int|1
)braket
op_or
(paren
id|green
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Set cursor shape */
r_static
r_void
DECL|function|ffb_setcurshape
id|ffb_setcurshape
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|fb-&gt;info.ffb.dac
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|ffb_curs_enable
(paren
id|fb
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|dac-&gt;type2
op_assign
id|j
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x40
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fb-&gt;cursor.size.fbx
op_le
l_int|32
)paren
(brace
id|dac-&gt;value2
op_assign
id|fb-&gt;cursor.bits
(braket
id|j
)braket
(braket
id|i
)braket
suffix:semicolon
id|dac-&gt;value2
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|dac-&gt;value2
op_assign
id|fb-&gt;cursor.bits
(braket
id|j
)braket
(braket
l_int|2
op_star
id|i
)braket
suffix:semicolon
id|dac-&gt;value2
op_assign
id|fb-&gt;cursor.bits
(braket
id|j
)braket
(braket
l_int|2
op_star
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* Load cursor information */
r_static
r_void
DECL|function|ffb_setcursor
id|ffb_setcursor
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|fb-&gt;info.ffb.dac
suffix:semicolon
r_struct
id|cg_cursor
op_star
id|c
op_assign
op_amp
id|fb-&gt;cursor
suffix:semicolon
id|dac-&gt;type2
op_assign
l_int|0x104
suffix:semicolon
multiline_comment|/* Should this be just 0x7ff?? Should I do some margin handling and setcurshape&n;   in that case? */
id|dac-&gt;value2
op_assign
(paren
(paren
(paren
id|c-&gt;cpos.fbx
op_minus
id|c-&gt;chot.fbx
)paren
op_amp
l_int|0xffff
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|c-&gt;cpos.fby
op_minus
id|c-&gt;chot.fby
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|ffb_curs_enable
(paren
id|fb
comma
id|fb-&gt;cursor.enable
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ffb_blank
id|ffb_blank
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
multiline_comment|/* XXX Write this */
)brace
r_static
r_void
DECL|function|ffb_unblank
id|ffb_unblank
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
multiline_comment|/* XXX Write this */
)brace
DECL|function|ffb_clutstore
r_static
r_int
id|ffb_clutstore
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|offset
comma
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
op_star
id|clut
op_assign
id|fb-&gt;info.ffb.clut
op_plus
id|offset
suffix:semicolon
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|fb-&gt;info.ffb.dac
suffix:semicolon
id|dac-&gt;type
op_assign
l_int|0x2000
op_or
id|offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
id|dac-&gt;value
op_assign
op_star
id|clut
op_increment
suffix:semicolon
multiline_comment|/* Feed the colors in :)) */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ffb_clutpost
r_static
r_int
id|ffb_clutpost
(paren
id|fbinfo_t
op_star
id|fb
comma
r_struct
id|fb_clut
op_star
id|fc
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
op_star
id|clut
suffix:semicolon
r_struct
id|fb_clut
id|fct
suffix:semicolon
id|u8
id|red
(braket
l_int|256
)braket
comma
id|green
(braket
l_int|256
)braket
comma
id|blue
(braket
l_int|256
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_SPARC32_COMPAT
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|fct
comma
id|fc
comma
l_int|3
op_star
r_sizeof
(paren
id|__u32
)paren
)paren
op_logical_or
id|__get_user
(paren
(paren
r_int
)paren
id|fct.red
comma
op_amp
(paren
(paren
(paren
r_struct
id|fb_clut32
op_star
)paren
id|fc
)paren
op_member_access_from_pointer
id|red
)paren
)paren
op_logical_or
id|__get_user
(paren
(paren
r_int
)paren
id|fct.green
comma
op_amp
(paren
(paren
(paren
r_struct
id|fb_clut32
op_star
)paren
id|fc
)paren
op_member_access_from_pointer
id|green
)paren
)paren
op_logical_or
id|__get_user
(paren
(paren
r_int
)paren
id|fct.blue
comma
op_amp
(paren
(paren
(paren
r_struct
id|fb_clut32
op_star
)paren
id|fc
)paren
op_member_access_from_pointer
id|blue
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|fct
comma
id|fc
comma
r_sizeof
(paren
r_struct
id|fb_clut
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_assign
id|fct.offset
op_plus
id|fct.count
suffix:semicolon
r_if
c_cond
(paren
id|fct.clutid
op_logical_or
id|i
op_le
l_int|0
op_logical_or
id|i
OG
l_int|256
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
id|red
comma
id|fct.red
comma
id|fct.count
)paren
op_logical_or
id|copy_from_user
(paren
id|green
comma
id|fct.green
comma
id|fct.count
)paren
op_logical_or
id|copy_from_user
(paren
id|blue
comma
id|fct.blue
comma
id|fct.count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|clut
op_assign
id|fb-&gt;info.ffb.clut
op_plus
id|fct.offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fct.count
suffix:semicolon
id|i
op_increment
)paren
op_star
id|clut
op_increment
op_assign
(paren
(paren
id|red
(braket
id|i
)braket
)paren
op_or
(paren
id|green
(braket
id|i
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
(braket
id|i
)braket
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_return
id|ffb_clutstore
(paren
id|fb
comma
id|fct.offset
comma
id|fct.count
)paren
suffix:semicolon
)brace
DECL|function|ffb_clutread
r_static
r_int
id|ffb_clutread
(paren
id|fbinfo_t
op_star
id|fb
comma
r_struct
id|fb_clut
op_star
id|fc
)paren
(brace
multiline_comment|/* XXX write this */
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|ffb_loadcmap
id|ffb_loadcmap
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
id|u32
op_star
id|clut
op_assign
id|fb-&gt;info.ffb.clut
op_plus
id|index
suffix:semicolon
r_int
id|i
comma
id|j
op_assign
id|count
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|index
suffix:semicolon
id|j
op_decrement
suffix:semicolon
id|i
op_increment
)paren
op_star
id|clut
op_increment
op_assign
(paren
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|0
)paren
)paren
)paren
op_or
(paren
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|1
)paren
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|fb-&gt;color_map
id|CM
c_func
(paren
id|i
comma
l_int|2
)paren
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|ffb_clutstore
(paren
id|fb
comma
id|index
comma
id|count
)paren
suffix:semicolon
)brace
multiline_comment|/* Handle ffb-specific ioctls */
r_static
r_int
DECL|function|ffb_ioctl
id|ffb_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_WID_GET
suffix:colon
r_return
id|ffb_wid_get
(paren
id|fb
comma
(paren
r_struct
id|fb_wid_list
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|FBIO_WID_PUT
suffix:colon
r_return
id|ffb_wid_put
(paren
id|fb
comma
(paren
r_struct
id|fb_wid_list
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|FFB_CLUTPOST
suffix:colon
r_return
id|ffb_clutpost
(paren
id|fb
comma
(paren
r_struct
id|fb_clut
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|FFB_CLUTREAD
suffix:colon
r_return
id|ffb_clutread
(paren
id|fb
comma
(paren
r_struct
id|fb_clut
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
r_void
DECL|function|ffb_reset
id|ffb_reset
(paren
id|fbinfo_t
op_star
id|fb
)paren
(brace
r_struct
id|ffb_info
op_star
id|ffb
op_assign
op_amp
(paren
id|fb-&gt;info.ffb
)paren
suffix:semicolon
r_int
id|fifo
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;setcursor
)paren
id|sun_hw_hide_cursor
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|fifo
op_assign
(paren
id|ffb-&gt;fbc-&gt;ucsr
op_amp
id|FFB_UCSR_FIFO_MASK
)paren
)paren
OL
l_int|8
)paren
suffix:semicolon
id|ffb-&gt;fbc-&gt;ppc
op_assign
(paren
id|FFB_PPC_ACE_DISABLE
op_lshift
id|FFB_PPC_ACE_SHIFT
)paren
op_or
(paren
id|FFB_PPC_DCE_DISABLE
op_lshift
id|FFB_PPC_DCE_SHIFT
)paren
op_or
(paren
id|FFB_PPC_ABE_DISABLE
op_lshift
id|FFB_PPC_ABE_SHIFT
)paren
op_or
(paren
id|FFB_PPC_VCE_DISABLE
op_lshift
id|FFB_PPC_VCE_SHIFT
)paren
op_or
(paren
id|FFB_PPC_APE_DISABLE
op_lshift
id|FFB_PPC_APE_SHIFT
)paren
op_or
(paren
id|FFB_PPC_CS_VARIABLE
op_lshift
id|FFB_PPC_CS_SHIFT
)paren
suffix:semicolon
id|ffb-&gt;fbc-&gt;fbc
op_assign
(paren
id|FFB_FBC_WB_A
op_lshift
id|FFB_FBC_WB_SHIFT
)paren
op_or
(paren
id|FFB_FBC_PGE_MASK
op_lshift
id|FFB_FBC_BE_SHIFT
)paren
op_or
(paren
id|FFB_FBC_PGE_MASK
op_lshift
id|FFB_FBC_GE_SHIFT
)paren
op_or
(paren
id|FFB_FBC_PGE_MASK
op_lshift
id|FFB_FBC_RE_SHIFT
)paren
suffix:semicolon
id|ffb-&gt;fbc-&gt;rop
op_assign
(paren
id|FFB_ROP_NEW
op_lshift
id|FFB_ROP_RGB_SHIFT
)paren
suffix:semicolon
id|ffb-&gt;fbc-&gt;pmask
op_assign
l_int|0x00ffffff
suffix:semicolon
r_while
c_loop
(paren
id|ffb-&gt;fbc-&gt;ucsr
op_amp
id|FFB_UCSR_RP_BUSY
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
r_int
id|ffb_postsetup
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
r_int
id|memory_start
)paren
)paren
(brace
id|fb-&gt;info.ffb.clut
op_assign
(paren
id|u32
op_star
)paren
(paren
id|memory_start
)paren
suffix:semicolon
id|fb-&gt;color_map
op_assign
(paren
id|u8
op_star
)paren
(paren
id|memory_start
op_plus
l_int|256
op_star
l_int|4
op_plus
l_int|256
)paren
suffix:semicolon
r_return
id|memory_start
op_plus
l_int|256
op_star
l_int|4
op_plus
l_int|256
op_star
l_int|3
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|creator_setup
(paren
id|fbinfo_t
op_star
id|fb
comma
r_int
id|slot
comma
r_int
id|ffb_node
comma
r_int
r_int
id|ffb
comma
r_int
id|ffb_io
)paren
)paren
(brace
r_struct
id|ffb_info
op_star
id|ffbinfo
suffix:semicolon
r_struct
id|linux_prom64_registers
id|regs
(braket
l_int|2
op_star
id|PROMREG_MAX
)braket
suffix:semicolon
r_if
c_cond
(paren
id|prom_getproperty
c_func
(paren
id|ffb_node
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|ffb
op_assign
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|printk
(paren
l_string|&quot;creator%d at 0x%016lx &quot;
comma
id|slot
comma
id|ffb
)paren
suffix:semicolon
id|fb-&gt;base
op_assign
id|ffb
suffix:semicolon
multiline_comment|/* ??? */
multiline_comment|/* Fill in parameters we left out */
id|fb-&gt;type.fb_cmsize
op_assign
l_int|256
suffix:semicolon
id|fb-&gt;mmap
op_assign
id|ffb_mmap
suffix:semicolon
id|fb-&gt;loadcmap
op_assign
id|ffb_loadcmap
suffix:semicolon
id|fb-&gt;reset
op_assign
id|ffb_reset
suffix:semicolon
id|fb-&gt;blank
op_assign
id|ffb_blank
suffix:semicolon
id|fb-&gt;unblank
op_assign
id|ffb_unblank
suffix:semicolon
id|fb-&gt;setcursor
op_assign
id|ffb_setcursor
suffix:semicolon
id|fb-&gt;setcursormap
op_assign
id|ffb_setcursormap
suffix:semicolon
id|fb-&gt;setcurshape
op_assign
id|ffb_setcurshape
suffix:semicolon
id|fb-&gt;postsetup
op_assign
id|ffb_postsetup
suffix:semicolon
id|fb-&gt;blitc
op_assign
id|ffb_blitc
suffix:semicolon
id|fb-&gt;setw
op_assign
id|ffb_setw
suffix:semicolon
id|fb-&gt;cpyw
op_assign
id|ffb_cpyw
suffix:semicolon
id|fb-&gt;fill
op_assign
id|ffb_fill
suffix:semicolon
id|fb-&gt;ioctl
op_assign
id|ffb_ioctl
suffix:semicolon
id|fb-&gt;cursor.hwsize.fbx
op_assign
l_int|64
suffix:semicolon
id|fb-&gt;cursor.hwsize.fby
op_assign
l_int|64
suffix:semicolon
id|ffbinfo
op_assign
(paren
r_struct
id|ffb_info
op_star
)paren
op_amp
id|fb-&gt;info.ffb
suffix:semicolon
id|ffbinfo-&gt;physbase
op_assign
id|ffb
suffix:semicolon
id|ffbinfo-&gt;fbc
op_assign
(paren
r_struct
id|ffb_fbc
op_star
)paren
(paren
id|ffb
op_plus
id|FFB_FBC_REGS_POFF
)paren
suffix:semicolon
id|ffbinfo-&gt;dac
op_assign
(paren
r_struct
id|ffb_dac
op_star
)paren
(paren
id|ffb
op_plus
id|FFB_DAC_POFF
)paren
suffix:semicolon
id|ffbinfo-&gt;dac-&gt;type
op_assign
l_int|0x8000
suffix:semicolon
id|ffbinfo-&gt;dac_rev
op_assign
(paren
id|ffbinfo-&gt;dac-&gt;value
op_rshift
l_int|0x1c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_eq
id|sun_prom_console_id
)paren
id|fb_restore_palette
op_assign
id|ffb_restore_palette
suffix:semicolon
multiline_comment|/* Initialize Brooktree DAC */
id|printk
c_func
(paren
l_string|&quot;DAC %d&bslash;n&quot;
comma
id|ffbinfo-&gt;dac_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_logical_and
id|sun_prom_console_id
op_eq
id|slot
)paren
r_return
suffix:semicolon
multiline_comment|/* Reset the ffb */
id|ffb_reset
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot
)paren
(brace
multiline_comment|/* Enable Video */
id|ffb_unblank
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_else
(brace
id|ffb_blank
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
)brace
r_extern
r_int
r_char
id|vga_font
(braket
)braket
suffix:semicolon
DECL|function|ffb_blitc
r_static
r_void
id|ffb_blitc
c_func
(paren
r_int
r_int
id|charattr
comma
r_int
id|xoff
comma
r_int
id|yoff
)paren
(brace
)brace
DECL|function|ffb_setw
r_static
r_void
id|ffb_setw
c_func
(paren
r_int
id|xoff
comma
r_int
id|yoff
comma
r_int
r_int
id|c
comma
r_int
id|count
)paren
(brace
)brace
DECL|function|ffb_cpyw
r_static
r_void
id|ffb_cpyw
c_func
(paren
r_int
id|xoff
comma
r_int
id|yoff
comma
r_int
r_int
op_star
id|p
comma
r_int
id|count
)paren
(brace
)brace
DECL|function|ffb_fill
r_static
r_void
id|ffb_fill
c_func
(paren
r_int
id|attrib
comma
r_int
id|count
comma
r_int
op_star
id|boxes
)paren
(brace
)brace
eof
