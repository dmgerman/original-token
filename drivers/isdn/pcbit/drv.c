multiline_comment|/*&n; * Copyright (C) 1996 Universidade de Lisboa&n; * &n; * Written by Pedro Roque Marques (roque@di.fc.ul.pt)&n; *&n; * This software may be used and distributed according to the terms of &n; * the GNU Public License, incorporated herein by reference.&n; */
multiline_comment|/*        &n; *        PCBIT-D interface with isdn4linux&n; */
multiline_comment|/*&n; *&t;Fixes:&n; *&n; *&t;Nuno Grilo&t;&lt;l38486@alfa.ist.utl.pt&gt;&n; *      fixed msn_list NULL pointer dereference.&n; *&t;&t;&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/isdnif.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &quot;pcbit.h&quot;
macro_line|#include &quot;edss1.h&quot;
macro_line|#include &quot;layer2.h&quot;
macro_line|#include &quot;capi.h&quot;
r_extern
id|ushort
id|last_ref_num
suffix:semicolon
r_static
r_int
id|pcbit_ioctl
c_func
(paren
id|isdn_ctrl
op_star
id|ctl
)paren
suffix:semicolon
DECL|variable|pcbit_devname
r_static
r_char
op_star
id|pcbit_devname
(braket
id|MAX_PCBIT_CARDS
)braket
op_assign
(brace
l_string|&quot;pcbit0&quot;
comma
l_string|&quot;pcbit1&quot;
comma
l_string|&quot;pcbit2&quot;
comma
l_string|&quot;pcbit3&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * prototypes&n; */
r_int
id|pcbit_command
c_func
(paren
id|isdn_ctrl
op_star
id|ctl
)paren
suffix:semicolon
r_int
id|pcbit_stat
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_int
id|pcbit_xmit
c_func
(paren
r_int
id|driver
comma
r_int
id|chan
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_int
id|pcbit_writecmd
c_func
(paren
r_const
id|u_char
op_star
comma
r_int
comma
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|set_protocol_running
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|pcbit_clear_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|pcbit_set_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_char
op_star
id|list
)paren
suffix:semicolon
r_static
r_int
id|pcbit_check_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_char
op_star
id|msn
)paren
suffix:semicolon
r_extern
r_void
id|pcbit_deliver
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|function|pcbit_init_dev
r_int
id|pcbit_init_dev
c_func
(paren
r_int
id|board
comma
r_int
id|mem_base
comma
r_int
id|irq
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
id|isdn_if
op_star
id|dev_if
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pcbit_dev
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_init: couldn&squot;t malloc pcbit_dev struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|dev_pcbit
(braket
id|board
)braket
op_assign
id|dev
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pcbit_dev
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev-&gt;set_running_wq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem_base
op_ge
l_int|0xA0000
op_logical_and
id|mem_base
op_le
l_int|0xFFFFF
)paren
(brace
id|dev-&gt;ph_mem
op_assign
id|mem_base
suffix:semicolon
r_if
c_cond
(paren
id|check_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCBIT: memory region %lx-%lx already in use&bslash;n&quot;
comma
id|dev-&gt;ph_mem
comma
id|dev-&gt;ph_mem
op_plus
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_pcbit
(braket
id|board
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
r_else
(brace
id|request_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
comma
l_string|&quot;PCBIT mem&quot;
)paren
suffix:semicolon
)brace
id|dev-&gt;sh_mem
op_assign
(paren
r_int
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;memory address invalid&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_pcbit
(braket
id|board
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
id|dev-&gt;b1
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pcbit_chan
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;b1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_init: couldn&squot;t malloc pcbit_chan struct&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|dev-&gt;b2
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pcbit_chan
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;b2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_init: couldn&squot;t malloc pcbit_chan struct&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b1
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev-&gt;b1
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pcbit_chan
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;b2
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pcbit_chan
)paren
)paren
suffix:semicolon
id|dev-&gt;b2-&gt;id
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;qdelivery.sync
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;qdelivery.routine
op_assign
id|pcbit_deliver
suffix:semicolon
id|dev-&gt;qdelivery.data
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *  interrupts&n;&t; */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
op_amp
id|pcbit_irq_handler
comma
l_int|0
comma
id|pcbit_devname
(braket
id|board
)braket
comma
id|dev
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|dev-&gt;b1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b2
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_pcbit
(braket
id|board
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* next frame to be received */
id|dev-&gt;rcv_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;send_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;unack_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;hl_hdrlen
op_assign
l_int|16
suffix:semicolon
id|dev_if
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|isdn_if
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_if
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b2
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_pcbit
(braket
id|board
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|dev-&gt;dev_if
op_assign
id|dev_if
suffix:semicolon
id|dev_if-&gt;channels
op_assign
l_int|2
suffix:semicolon
id|dev_if-&gt;features
op_assign
(paren
id|ISDN_FEATURE_P_EURO
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L2_TRANS
)paren
suffix:semicolon
id|dev_if-&gt;writebuf_skb
op_assign
id|pcbit_xmit
suffix:semicolon
id|dev_if-&gt;hl_hdrlen
op_assign
l_int|16
suffix:semicolon
id|dev_if-&gt;maxbufsize
op_assign
id|MAXBUFSIZE
suffix:semicolon
id|dev_if-&gt;command
op_assign
id|pcbit_command
suffix:semicolon
id|dev_if-&gt;writecmd
op_assign
id|pcbit_writecmd
suffix:semicolon
id|dev_if-&gt;readstat
op_assign
id|pcbit_stat
suffix:semicolon
id|strcpy
c_func
(paren
id|dev_if-&gt;id
comma
id|pcbit_devname
(braket
id|board
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|register_isdn
c_func
(paren
id|dev_if
)paren
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b2
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_pcbit
(braket
id|board
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|dev-&gt;id
op_assign
id|dev_if-&gt;channels
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_DOWN
suffix:semicolon
id|dev-&gt;free
op_assign
l_int|511
suffix:semicolon
multiline_comment|/*&n;&t; * set_protocol_running(dev);&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|pcbit_terminate
r_void
id|pcbit_terminate
c_func
(paren
r_int
id|board
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|dev_pcbit
(braket
id|board
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
multiline_comment|/* unregister_isdn(dev-&gt;dev_if); */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|pcbit_clear_msn
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;dev_if
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;b1-&gt;fsm_timer.function
)paren
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;b1-&gt;fsm_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;b2-&gt;fsm_timer.function
)paren
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;b2-&gt;fsm_timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;b2
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|dev-&gt;sh_mem
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;ph_mem
comma
l_int|4096
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|pcbit_command
r_int
id|pcbit_command
c_func
(paren
id|isdn_ctrl
op_star
id|ctl
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
r_struct
id|pcbit_chan
op_star
id|chan
suffix:semicolon
r_struct
id|callb_data
id|info
suffix:semicolon
id|dev
op_assign
id|finddev
c_func
(paren
id|ctl-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_command: unknown device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|chan
op_assign
(paren
id|ctl-&gt;arg
op_amp
l_int|0x0F
)paren
ques
c_cond
id|dev-&gt;b2
suffix:colon
id|dev-&gt;b1
suffix:semicolon
r_switch
c_cond
(paren
id|ctl-&gt;command
)paren
(brace
r_case
id|ISDN_CMD_IOCTL
suffix:colon
r_return
id|pcbit_ioctl
c_func
(paren
id|ctl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
id|info.type
op_assign
id|EV_USR_SETUP_REQ
suffix:semicolon
id|info.data.setup.CalledPN
op_assign
(paren
r_char
op_star
)paren
op_amp
id|ctl-&gt;parm.setup.phone
suffix:semicolon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_USR_SETUP_REQ
comma
op_amp
id|info
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_USR_SETUP_RESP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ISDN_CMD_ACCEPTB - not really needed&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_USR_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_SETL2
suffix:colon
id|chan-&gt;proto
op_assign
(paren
id|ctl-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_GETL2
suffix:colon
r_return
id|chan-&gt;proto
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_LOCK
suffix:colon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_UNLOCK
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
id|pcbit_clear_msn
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
id|pcbit_set_msn
c_func
(paren
id|dev
comma
id|ctl-&gt;parm.num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_if
c_cond
(paren
(paren
id|ctl-&gt;arg
op_rshift
l_int|8
)paren
op_ne
id|ISDN_PROTO_L3_TRANS
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;L3 protocol unknown&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_GETL3
suffix:colon
r_return
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_GETEAZ
suffix:colon
r_case
id|ISDN_CMD_SETSIL
suffix:colon
r_case
id|ISDN_CMD_GETSIL
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit_command: code %d not implemented yet&bslash;n&quot;
comma
id|ctl-&gt;command
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit_command: unknown command&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Another Hack :-(&n; * on some conditions the board stops sending TDATA_CONFs&n; * let&squot;s see if we can turn around the problem&n; */
macro_line|#ifdef BLOCK_TIMER
DECL|function|pcbit_block_timer
r_static
r_void
id|pcbit_block_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|pcbit_chan
op_star
id|chan
suffix:semicolon
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
id|isdn_ctrl
id|ictl
suffix:semicolon
id|chan
op_assign
(paren
r_struct
id|pcbit_chan
op_star
)paren
id|data
suffix:semicolon
id|dev
op_assign
id|chan2dev
c_func
(paren
id|chan
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit: chan2dev failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|del_timer
c_func
(paren
op_amp
id|chan-&gt;block_timer
)paren
suffix:semicolon
id|chan-&gt;block_timer.function
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit_block_timer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|chan-&gt;queued
op_assign
l_int|0
suffix:semicolon
id|ictl.driver
op_assign
id|dev-&gt;id
suffix:semicolon
id|ictl.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|ictl.arg
op_assign
id|chan-&gt;id
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|statcallb
c_func
(paren
op_amp
id|ictl
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|pcbit_xmit
r_int
id|pcbit_xmit
c_func
(paren
r_int
id|driver
comma
r_int
id|chnum
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ushort
id|hdrlen
suffix:semicolon
r_int
id|refnum
comma
id|len
suffix:semicolon
r_struct
id|pcbit_chan
op_star
id|chan
suffix:semicolon
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|finddev
c_func
(paren
id|driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;finddev returned NULL&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|chan
op_assign
id|chnum
ques
c_cond
id|dev-&gt;b2
suffix:colon
id|dev-&gt;b1
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_ne
id|ST_ACTIVE
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;queued
op_ge
id|MAX_QUEUED
)paren
(brace
macro_line|#ifdef DEBUG_QUEUE
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit: %d packets already in queue - write fails&bslash;n&quot;
comma
id|chan-&gt;queued
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t;&t; * packet stays on the head of the device queue&n;&t;&t; * since dev_start_xmit will fail&n;&t;&t; * see net/core/dev.c&n;&t;&t; */
macro_line|#ifdef BLOCK_TIMER
r_if
c_cond
(paren
id|chan-&gt;block_timer.function
op_eq
l_int|NULL
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|chan-&gt;block_timer
)paren
suffix:semicolon
id|chan-&gt;block_timer.function
op_assign
op_amp
id|pcbit_block_timer
suffix:semicolon
id|chan-&gt;block_timer.data
op_assign
(paren
r_int
)paren
id|chan
suffix:semicolon
id|chan-&gt;block_timer.expires
op_assign
id|jiffies
op_plus
l_int|1
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|chan-&gt;block_timer
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;
r_return
l_int|0
suffix:semicolon
)brace
id|chan-&gt;queued
op_increment
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|hdrlen
op_assign
id|capi_tdata_req
c_func
(paren
id|chan
comma
id|skb
)paren
suffix:semicolon
id|refnum
op_assign
id|last_ref_num
op_increment
op_amp
l_int|0x7fffU
suffix:semicolon
id|chan-&gt;s_refnum
op_assign
id|refnum
suffix:semicolon
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_TDATA_REQ
comma
id|refnum
comma
id|skb
comma
id|hdrlen
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|pcbit_writecmd
r_int
id|pcbit_writecmd
c_func
(paren
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|driver
comma
r_int
id|channel
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_const
id|u_char
op_star
id|loadbuf
suffix:semicolon
id|u_char
op_star
id|ptr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|errstat
suffix:semicolon
id|dev
op_assign
id|finddev
c_func
(paren
id|driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_writecmd: couldn&squot;t find device&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|dev-&gt;l2_state
)paren
(brace
r_case
id|L2_LWMODE
suffix:colon
multiline_comment|/* check (size &lt;= rdp_size); write buf into board */
r_if
c_cond
(paren
id|len
OG
id|BANK4
op_plus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcbit_writecmd: invalid length %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|user
)paren
(brace
id|u_char
id|cbuf
(braket
l_int|1024
)braket
suffix:semicolon
id|copy_from_user
c_func
(paren
id|cbuf
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|writeb
c_func
(paren
id|cbuf
(braket
id|i
)braket
comma
id|dev-&gt;sh_mem
op_plus
id|i
)paren
suffix:semicolon
)brace
r_else
id|memcpy_toio
c_func
(paren
id|dev-&gt;sh_mem
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2_FWMODE
suffix:colon
multiline_comment|/* this is the hard part */
multiline_comment|/* dumb board */
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
(brace
multiline_comment|/* get it into kernel space */
r_if
c_cond
(paren
(paren
id|ptr
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|copy_from_user
c_func
(paren
id|ptr
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|loadbuf
op_assign
id|ptr
suffix:semicolon
)brace
r_else
id|loadbuf
op_assign
id|buf
suffix:semicolon
id|errstat
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|LOAD_RETRY
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|readb
c_func
(paren
id|dev-&gt;sh_mem
op_plus
id|dev-&gt;loadptr
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
id|LOAD_RETRY
)paren
(brace
id|errstat
op_assign
op_minus
id|ETIME
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TIMEOUT i=%d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|writeb
c_func
(paren
id|loadbuf
(braket
id|i
)braket
comma
id|dev-&gt;sh_mem
op_plus
id|dev-&gt;loadptr
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x01
comma
id|dev-&gt;sh_mem
op_plus
id|dev-&gt;loadptr
)paren
suffix:semicolon
id|dev-&gt;loadptr
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;loadptr
OG
id|LOAD_ZONE_END
)paren
id|dev-&gt;loadptr
op_assign
id|LOAD_ZONE_START
suffix:semicolon
)brace
r_if
c_cond
(paren
id|user
)paren
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_return
id|errstat
ques
c_cond
id|errstat
suffix:colon
id|len
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  demultiplexing of messages&n; *&n; */
DECL|function|pcbit_l3_receive
r_void
id|pcbit_l3_receive
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
id|ulong
id|msg
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|ushort
id|hdr_len
comma
id|ushort
id|refnum
)paren
(brace
r_struct
id|pcbit_chan
op_star
id|chan
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_struct
id|callb_data
id|cbdata
suffix:semicolon
r_int
id|complete
comma
id|err
suffix:semicolon
id|isdn_ctrl
id|ictl
suffix:semicolon
r_switch
c_cond
(paren
id|msg
)paren
(brace
r_case
id|MSG_TDATA_IND
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chan-&gt;r_refnum
op_assign
id|skb-&gt;data
(braket
l_int|7
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|8
)paren
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|rcvcallb_skb
c_func
(paren
id|dev-&gt;id
comma
id|chan-&gt;id
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|capi_tdata_resp
c_func
(paren
id|chan
comma
op_amp
id|skb2
)paren
OG
l_int|0
)paren
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_TDATA_RESP
comma
id|refnum
comma
id|skb2
comma
id|skb2-&gt;len
)paren
suffix:semicolon
r_return
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_TDATA_CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
op_star
(paren
(paren
id|ushort
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|2
)paren
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;TDATA_CONF error&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef BLOCK_TIMER
r_if
c_cond
(paren
id|chan-&gt;queued
op_eq
id|MAX_QUEUED
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|chan-&gt;block_timer
)paren
suffix:semicolon
id|chan-&gt;block_timer.function
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif&t;&t;
id|chan-&gt;queued
op_decrement
suffix:semicolon
id|ictl.driver
op_assign
id|dev-&gt;id
suffix:semicolon
id|ictl.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|ictl.arg
op_assign
id|chan-&gt;id
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|statcallb
c_func
(paren
op_amp
id|ictl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_CONN_IND
suffix:colon
multiline_comment|/*&n;&t;&t; *  channel: 1st not used will do&n;&t;&t; *           if both are used we&squot;re in trouble &n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;b1-&gt;fsm_state
)paren
id|chan
op_assign
id|dev-&gt;b1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;b2-&gt;fsm_state
)paren
id|chan
op_assign
id|dev-&gt;b2
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Incoming connection: no channels available&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|capi_disc_req
c_func
(paren
op_star
(paren
id|ushort
op_star
)paren
(paren
id|skb-&gt;data
)paren
comma
op_amp
id|skb2
comma
id|CAUSE_NOCHAN
)paren
)paren
OG
l_int|0
)paren
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_DISC_REQ
comma
id|refnum
comma
id|skb2
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cbdata.data.setup.CalledPN
op_assign
l_int|NULL
suffix:semicolon
id|cbdata.data.setup.CallingPN
op_assign
l_int|NULL
suffix:semicolon
id|capi_decode_conn_ind
c_func
(paren
id|chan
comma
id|skb
comma
op_amp
id|cbdata
)paren
suffix:semicolon
id|cbdata.type
op_assign
id|EV_NET_SETUP
suffix:semicolon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_SETUP
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcbit_check_msn
c_func
(paren
id|dev
comma
id|cbdata.data.setup.CallingPN
)paren
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_USR_PROCED_REQ
comma
op_amp
id|cbdata
)paren
suffix:semicolon
r_else
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_USR_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cbdata.data.setup.CalledPN
)paren
id|kfree
c_func
(paren
id|cbdata.data.setup.CalledPN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cbdata.data.setup.CallingPN
)paren
id|kfree
c_func
(paren
id|cbdata.data.setup.CallingPN
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_CONN_CONF
suffix:colon
multiline_comment|/* &n;&t;&t; * We should be able to find the channel by the message&n;&t;&t; * reference number. The current version of the firmware&n;&t;&t; * doesn&squot;t sent the ref number correctly.&n;&t;&t; */
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;refnum=%04x b1=%04x b2=%04x&bslash;n&quot;
comma
id|refnum
comma
id|dev-&gt;b1-&gt;s_refnum
comma
id|dev-&gt;b2-&gt;s_refnum
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* We just try to find a channel in the right state */
r_if
c_cond
(paren
id|dev-&gt;b1-&gt;fsm_state
op_eq
id|ST_CALL_INIT
)paren
id|chan
op_assign
id|dev-&gt;b1
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|dev-&gt;b2-&gt;s_refnum
op_eq
id|ST_CALL_INIT
)paren
id|chan
op_assign
id|dev-&gt;b2
suffix:semicolon
r_else
(brace
id|chan
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Connection Confirm - no channel in Call Init state&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|capi_decode_conn_conf
c_func
(paren
id|chan
comma
id|skb
comma
op_amp
id|complete
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;conn_conf indicates error&bslash;n&quot;
)paren
suffix:semicolon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|complete
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_CALL_PROC
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_SETUP_ACK
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_CONN_ACTV_IND
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|capi_decode_conn_actv_ind
c_func
(paren
id|chan
comma
id|skb
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;error in capi_decode_conn_actv_ind&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* pcbit_fsm_event(dev, chan, EV_ERROR, NULL); */
r_break
suffix:semicolon
)brace
id|chan-&gt;r_refnum
op_assign
id|refnum
suffix:semicolon
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_CONN
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_CONN_ACTV_CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|capi_decode_conn_actv_conf
c_func
(paren
id|chan
comma
id|skb
)paren
op_eq
l_int|0
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_CONN_ACK
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;decode_conn_actv_conf failed&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_SELP_CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|capi_decode_sel_proto_conf
c_func
(paren
id|chan
comma
id|skb
)paren
)paren
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_SELP_RESP
comma
l_int|NULL
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Error */
id|printk
c_func
(paren
l_string|&quot;error %d - capi_decode_sel_proto_conf&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MSG_ACT_TRANSP_CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capi_decode_actv_trans_conf
c_func
(paren
id|chan
comma
id|skb
)paren
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_ACTV_RESP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_DISC_IND
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capi_decode_disc_ind
c_func
(paren
id|chan
comma
id|skb
)paren
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_DISC
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;capi_decode_disc_ind - error&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_DISC_CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|capi_channel
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CAPI header: unknown channel id&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capi_decode_disc_ind
c_func
(paren
id|chan
comma
id|skb
)paren
)paren
id|pcbit_fsm_event
c_func
(paren
id|dev
comma
id|chan
comma
id|EV_NET_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;capi_decode_disc_conf - error&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_INFO_IND
suffix:colon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;received Info Indication - discarded&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
macro_line|#ifdef DEBUG
r_case
id|MSG_DEBUG_188
suffix:colon
id|capi_decode_debug_188
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit_l3_receive: unknown message %08lx&bslash;n&quot;
comma
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *   Single statbuf&n; *   should be a statbuf per device&n; */
DECL|variable|statbuf
r_static
r_char
id|statbuf
(braket
id|STATBUF_LEN
)braket
suffix:semicolon
DECL|variable|stat_st
r_static
r_int
id|stat_st
op_assign
l_int|0
suffix:semicolon
DECL|variable|stat_end
r_static
r_int
id|stat_end
op_assign
l_int|0
suffix:semicolon
r_static
id|__inline
r_void
DECL|function|memcpy_to_COND
id|memcpy_to_COND
c_func
(paren
r_int
id|flag
comma
r_char
op_star
id|d
comma
r_const
r_char
op_star
id|s
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|flag
)paren
id|copy_to_user
c_func
(paren
id|d
comma
id|s
comma
id|len
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|d
comma
id|s
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|pcbit_stat
r_int
id|pcbit_stat
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|driver
comma
r_int
id|channel
)paren
(brace
r_int
id|stat_count
suffix:semicolon
id|stat_count
op_assign
id|stat_end
op_minus
id|stat_st
suffix:semicolon
r_if
c_cond
(paren
id|stat_count
OL
l_int|0
)paren
id|stat_count
op_assign
id|STATBUF_LEN
op_minus
id|stat_st
op_plus
id|stat_end
suffix:semicolon
multiline_comment|/* FIXME: should we sleep and wait for more cookies ? */
r_if
c_cond
(paren
id|len
OG
id|stat_count
)paren
id|len
op_assign
id|stat_count
suffix:semicolon
r_if
c_cond
(paren
id|stat_st
OL
id|stat_end
)paren
(brace
id|memcpy_to_COND
c_func
(paren
id|user
comma
id|buf
comma
id|statbuf
op_plus
id|stat_st
comma
id|len
)paren
suffix:semicolon
id|stat_st
op_add_assign
id|len
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|len
OG
id|STATBUF_LEN
op_minus
id|stat_st
)paren
(brace
id|memcpy_to_COND
c_func
(paren
id|user
comma
id|buf
comma
id|statbuf
op_plus
id|stat_st
comma
id|STATBUF_LEN
op_minus
id|stat_st
)paren
suffix:semicolon
id|memcpy_to_COND
c_func
(paren
id|user
comma
id|buf
comma
id|statbuf
comma
id|len
op_minus
(paren
id|STATBUF_LEN
op_minus
id|stat_st
)paren
)paren
suffix:semicolon
id|stat_st
op_assign
id|len
op_minus
(paren
id|STATBUF_LEN
op_minus
id|stat_st
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy_to_COND
c_func
(paren
id|user
comma
id|buf
comma
id|statbuf
op_plus
id|stat_st
comma
id|len
)paren
suffix:semicolon
id|stat_st
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|stat_st
op_eq
id|STATBUF_LEN
)paren
id|stat_st
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|stat_st
op_eq
id|stat_end
)paren
id|stat_st
op_assign
id|stat_end
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|pcbit_logstat
r_static
r_void
id|pcbit_logstat
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
id|isdn_ctrl
id|ictl
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|stat_end
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|str
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|statbuf
(braket
id|i
)braket
op_assign
id|str
(braket
id|i
)braket
suffix:semicolon
id|stat_end
op_assign
(paren
id|stat_end
op_plus
l_int|1
)paren
op_mod
id|STATBUF_LEN
suffix:semicolon
r_if
c_cond
(paren
id|stat_end
op_eq
id|stat_st
)paren
id|stat_st
op_assign
(paren
id|stat_st
op_plus
l_int|1
)paren
op_mod
id|STATBUF_LEN
suffix:semicolon
)brace
id|ictl.command
op_assign
id|ISDN_STAT_STAVAIL
suffix:semicolon
id|ictl.driver
op_assign
id|dev-&gt;id
suffix:semicolon
id|ictl.arg
op_assign
id|strlen
c_func
(paren
id|str
)paren
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|statcallb
c_func
(paren
op_amp
id|ictl
)paren
suffix:semicolon
)brace
r_extern
r_char
op_star
id|isdn_state_table
(braket
)braket
suffix:semicolon
r_extern
r_char
op_star
id|strisdnevent
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
DECL|function|pcbit_state_change
r_void
id|pcbit_state_change
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_struct
id|pcbit_chan
op_star
id|chan
comma
r_int
r_int
id|i
comma
r_int
r_int
id|ev
comma
r_int
r_int
id|f
)paren
(brace
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;change on device: %d channel:%d&bslash;n%s -&gt; %s -&gt; %s&bslash;n&quot;
comma
id|dev-&gt;id
comma
id|chan-&gt;id
comma
id|isdn_state_table
(braket
id|i
)braket
comma
id|strisdnevent
c_func
(paren
id|ev
)paren
comma
id|isdn_state_table
(braket
id|f
)braket
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
macro_line|#endif
id|pcbit_logstat
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|function|set_running_timeout
r_static
r_void
id|set_running_timeout
c_func
(paren
r_int
r_int
id|ptr
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;set_running_timeout&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dev
op_assign
(paren
r_struct
id|pcbit_dev
op_star
)paren
id|ptr
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;set_running_wq
)paren
suffix:semicolon
)brace
DECL|function|set_protocol_running
r_static
r_int
id|set_protocol_running
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
)paren
(brace
id|isdn_ctrl
id|ctl
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dev-&gt;set_running_timer
)paren
suffix:semicolon
id|dev-&gt;set_running_timer.function
op_assign
op_amp
id|set_running_timeout
suffix:semicolon
id|dev-&gt;set_running_timer.data
op_assign
(paren
id|ulong
)paren
id|dev
suffix:semicolon
id|dev-&gt;set_running_timer.expires
op_assign
id|jiffies
op_plus
id|SET_RUN_TIMEOUT
suffix:semicolon
multiline_comment|/* kick it */
id|dev-&gt;l2_state
op_assign
id|L2_STARTING
suffix:semicolon
id|writeb
c_func
(paren
(paren
l_int|0x80U
op_or
(paren
(paren
id|dev-&gt;rcv_seq
op_amp
l_int|0x07
)paren
op_lshift
l_int|3
)paren
op_or
(paren
id|dev-&gt;send_seq
op_amp
l_int|0x07
)paren
)paren
comma
id|dev-&gt;sh_mem
op_plus
id|BANK4
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dev-&gt;set_running_timer
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev-&gt;set_running_wq
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;set_running_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit: running&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;unack_seq
op_assign
id|dev-&gt;send_seq
suffix:semicolon
id|dev-&gt;writeptr
op_assign
id|dev-&gt;sh_mem
suffix:semicolon
id|dev-&gt;readptr
op_assign
id|dev-&gt;sh_mem
op_plus
id|BANK2
suffix:semicolon
multiline_comment|/* tell the good news to the upper layer */
id|ctl.driver
op_assign
id|dev-&gt;id
suffix:semicolon
id|ctl.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|statcallb
c_func
(paren
op_amp
id|ctl
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit: initialization failed&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit: firmware not loaded&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_DOWN
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Bank3 = %02x&bslash;n&quot;
comma
id|readb
c_func
(paren
id|dev-&gt;sh_mem
op_plus
id|BANK3
)paren
)paren
suffix:semicolon
macro_line|#endif
op_star
(paren
id|dev-&gt;sh_mem
op_plus
id|BANK4
)paren
op_assign
l_int|0x40U
suffix:semicolon
multiline_comment|/* warn the upper layer */
id|ctl.driver
op_assign
id|dev-&gt;id
suffix:semicolon
id|ctl.command
op_assign
id|ISDN_STAT_STOP
suffix:semicolon
id|dev-&gt;dev_if
op_member_access_from_pointer
id|statcallb
c_func
(paren
op_amp
id|ctl
)paren
suffix:semicolon
r_return
op_minus
id|EL2HLT
suffix:semicolon
multiline_comment|/* Level 2 halted */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcbit_ioctl
r_static
r_int
id|pcbit_ioctl
c_func
(paren
id|isdn_ctrl
op_star
id|ctl
)paren
(brace
r_struct
id|pcbit_dev
op_star
id|dev
suffix:semicolon
r_struct
id|pcbit_ioctl
op_star
id|cmd
suffix:semicolon
id|dev
op_assign
id|finddev
c_func
(paren
id|ctl-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;pcbit_ioctl: unknown device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|cmd
op_assign
(paren
r_struct
id|pcbit_ioctl
op_star
)paren
id|ctl-&gt;parm.num
suffix:semicolon
r_switch
c_cond
(paren
id|ctl-&gt;arg
)paren
(brace
r_case
id|PCBIT_IOCTL_GETSTAT
suffix:colon
id|cmd-&gt;info.l2_status
op_assign
id|dev-&gt;l2_state
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_STRLOAD
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dev-&gt;unack_seq
op_assign
id|dev-&gt;send_seq
op_assign
id|dev-&gt;rcv_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;writeptr
op_assign
id|dev-&gt;sh_mem
suffix:semicolon
id|dev-&gt;readptr
op_assign
id|dev-&gt;sh_mem
op_plus
id|BANK2
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_LOADING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_LWMODE
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_ne
id|L2_LOADING
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_LWMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_FWMODE
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dev-&gt;loadptr
op_assign
id|LOAD_ZONE_START
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_FWMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_ENDLOAD
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dev-&gt;l2_state
op_assign
id|L2_DOWN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_SETBYTE
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* check addr */
r_if
c_cond
(paren
id|cmd-&gt;info.rdp_byte.addr
OG
id|BANK4
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|writeb
c_func
(paren
id|cmd-&gt;info.rdp_byte.value
comma
id|dev-&gt;sh_mem
op_plus
id|cmd-&gt;info.rdp_byte.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_GETBYTE
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* check addr */
r_if
c_cond
(paren
id|cmd-&gt;info.rdp_byte.addr
OG
id|BANK4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;getbyte: invalid addr %04x&bslash;n&quot;
comma
id|cmd-&gt;info.rdp_byte.addr
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|cmd-&gt;info.rdp_byte.value
op_assign
id|readb
c_func
(paren
id|dev-&gt;sh_mem
op_plus
id|cmd-&gt;info.rdp_byte.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_RUNNING
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_eq
id|L2_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
id|set_protocol_running
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_WATCH188
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_ne
id|L2_LOADING
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_WATCH188
comma
l_int|0x0001
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_PING188
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_ne
id|L2_LOADING
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_PING188_REQ
comma
l_int|0x0001
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_APION
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;l2_state
op_ne
id|L2_LOADING
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pcbit_l2_write
c_func
(paren
id|dev
comma
id|MSG_API_ON
comma
l_int|0x0001
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCBIT_IOCTL_STOP
suffix:colon
id|dev-&gt;l2_state
op_assign
id|L2_DOWN
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x40
comma
id|dev-&gt;sh_mem
op_plus
id|BANK4
)paren
suffix:semicolon
id|dev-&gt;rcv_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;send_seq
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;unack_seq
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;error: unknown ioctl&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; *        MSN list handling&n; *&n; *        if null reject all calls&n; *        if first entry has null MSN accept all calls &n; */
DECL|function|pcbit_clear_msn
r_static
r_void
id|pcbit_clear_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
)paren
(brace
r_struct
id|msn_entry
op_star
id|ptr
comma
op_star
id|back
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|dev-&gt;msn_list
suffix:semicolon
id|ptr
suffix:semicolon
)paren
(brace
id|back
op_assign
id|ptr-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|ptr
op_assign
id|back
suffix:semicolon
)brace
id|dev-&gt;msn_list
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|pcbit_set_msn
r_static
r_void
id|pcbit_set_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_char
op_star
id|list
)paren
(brace
r_struct
id|msn_entry
op_star
id|ptr
suffix:semicolon
r_struct
id|msn_entry
op_star
id|back
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|cp
comma
op_star
id|sp
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|list
)paren
op_eq
l_int|0
)paren
(brace
id|ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|msn_entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr-&gt;msn
op_assign
l_int|NULL
suffix:semicolon
id|ptr-&gt;next
op_assign
id|dev-&gt;msn_list
suffix:semicolon
id|dev-&gt;msn_list
op_assign
id|ptr
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;msn_list
)paren
r_for
c_loop
(paren
id|back
op_assign
id|dev-&gt;msn_list
suffix:semicolon
id|back-&gt;next
suffix:semicolon
id|back
op_assign
id|back-&gt;next
)paren
suffix:semicolon
id|sp
op_assign
id|list
suffix:semicolon
r_do
(brace
id|cp
op_assign
id|strchr
c_func
(paren
id|sp
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp
)paren
id|len
op_assign
id|cp
op_minus
id|sp
suffix:semicolon
r_else
id|len
op_assign
id|strlen
c_func
(paren
id|sp
)paren
suffix:semicolon
id|ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|msn_entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|ptr-&gt;msn
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptr-&gt;msn
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|ptr-&gt;msn
comma
id|sp
comma
id|len
op_minus
l_int|1
)paren
suffix:semicolon
id|ptr-&gt;msn
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;msn: %s&bslash;n&quot;
comma
id|ptr-&gt;msn
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;msn_list
op_eq
l_int|NULL
)paren
id|dev-&gt;msn_list
op_assign
id|ptr
suffix:semicolon
r_else
id|back-&gt;next
op_assign
id|ptr
suffix:semicolon
id|back
op_assign
id|ptr
suffix:semicolon
id|sp
op_add_assign
id|len
suffix:semicolon
)brace
r_while
c_loop
(paren
id|cp
)paren
(brace
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  check if we do signal or reject an incoming call&n; */
DECL|function|pcbit_check_msn
r_static
r_int
id|pcbit_check_msn
c_func
(paren
r_struct
id|pcbit_dev
op_star
id|dev
comma
r_char
op_star
id|msn
)paren
(brace
r_struct
id|msn_entry
op_star
id|ptr
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|dev-&gt;msn_list
suffix:semicolon
id|ptr
suffix:semicolon
id|ptr
op_assign
id|ptr-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ptr-&gt;msn
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ptr-&gt;msn
comma
id|msn
)paren
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
