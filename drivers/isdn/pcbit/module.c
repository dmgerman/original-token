multiline_comment|/*&n; * Copyright (C) 1996 Universidade de Lisboa&n; * &n; * Written by Pedro Roque Marques (roque@di.fc.ul.pt)&n; *&n; * This software may be used and distributed according to the terms of &n; * the GNU Public License, incorporated herein by reference.&n; */
multiline_comment|/*        &n; *        PCBIT-D module support&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tqueue.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/isdnif.h&gt;
macro_line|#include &quot;pcbit.h&quot;
DECL|variable|mem
r_static
r_int
id|mem
(braket
id|MAX_PCBIT_CARDS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
id|MAX_PCBIT_CARDS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|num_boards
r_static
r_int
id|num_boards
suffix:semicolon
DECL|variable|dev_pcbit
r_struct
id|pcbit_dev
op_star
id|dev_pcbit
(braket
id|MAX_PCBIT_CARDS
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_int
id|init_module
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|pcbit_terminate
c_func
(paren
r_int
id|board
)paren
suffix:semicolon
r_extern
r_int
id|pcbit_init_dev
c_func
(paren
r_int
id|board
comma
r_int
id|mem_base
comma
r_int
id|irq
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_PCBIT_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_PCBIT_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|pcbit_init
mdefine_line|#define pcbit_init init_module
macro_line|#endif
DECL|function|pcbit_init
r_int
id|pcbit_init
c_func
(paren
r_void
)paren
(brace
r_int
id|board
suffix:semicolon
id|num_boards
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;PCBIT-D device driver v 0.5-fjpc0 19991204 - &quot;
l_string|&quot;Copyright (C) 1996 Universidade de Lisboa&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
(braket
l_int|0
)braket
op_logical_or
id|irq
(braket
l_int|0
)braket
)paren
(brace
r_for
c_loop
(paren
id|board
op_assign
l_int|0
suffix:semicolon
id|board
OL
id|MAX_PCBIT_CARDS
op_logical_and
id|mem
(braket
id|board
)braket
op_logical_and
id|irq
(braket
id|board
)braket
suffix:semicolon
id|board
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mem
(braket
id|board
)braket
)paren
id|mem
(braket
id|board
)braket
op_assign
l_int|0xD0000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
(braket
id|board
)braket
)paren
id|irq
(braket
id|board
)braket
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|pcbit_init_dev
c_func
(paren
id|board
comma
id|mem
(braket
id|board
)braket
comma
id|irq
(braket
id|board
)braket
)paren
op_eq
l_int|0
)paren
id|num_boards
op_increment
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pcbit_init failed for dev %d&quot;
comma
id|board
op_plus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Hardcoded default settings detection */
r_if
c_cond
(paren
op_logical_neg
id|num_boards
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Trying to detect board using default settings&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcbit_init_dev
c_func
(paren
l_int|0
comma
l_int|0xD0000
comma
l_int|5
)paren
op_eq
l_int|0
)paren
id|num_boards
op_increment
suffix:semicolon
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* No symbols to export, hide all symbols */
id|EXPORT_NO_SYMBOLS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|board
suffix:semicolon
r_for
c_loop
(paren
id|board
op_assign
l_int|0
suffix:semicolon
id|board
OL
id|num_boards
suffix:semicolon
id|board
op_increment
)paren
id|pcbit_terminate
c_func
(paren
id|board
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;PCBIT-D module unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|MAX_PARA
mdefine_line|#define MAX_PARA&t;(MAX_PCBIT_CARDS * 2)
macro_line|#include &lt;linux/init.h&gt;
DECL|function|pcbit_setup
r_static
r_int
id|__init
id|pcbit_setup
c_func
(paren
r_char
op_star
id|line
)paren
(brace
r_int
id|i
comma
id|j
comma
id|argc
suffix:semicolon
r_char
op_star
id|str
suffix:semicolon
r_int
id|ints
(braket
id|MAX_PARA
op_plus
l_int|1
)braket
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|line
comma
id|MAX_PARA
comma
id|ints
)paren
suffix:semicolon
id|argc
op_assign
id|ints
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|argc
op_logical_and
(paren
id|i
OL
id|MAX_PCBIT_CARDS
)paren
)paren
(brace
r_if
c_cond
(paren
id|argc
)paren
(brace
id|mem
(braket
id|i
)braket
op_assign
id|ints
(braket
id|j
)braket
suffix:semicolon
id|j
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argc
)paren
(brace
id|irq
(braket
id|i
)braket
op_assign
id|ints
(braket
id|j
)braket
suffix:semicolon
id|j
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;pcbit=&quot;
comma
id|pcbit_setup
)paren
suffix:semicolon
macro_line|#endif
eof
