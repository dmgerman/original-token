multiline_comment|/* $Id: eicon_idi.c,v 1.41 2000/08/12 18:00:47 armin Exp $&n; *&n; * ISDN lowlevel-module for Eicon active cards.&n; *        IDI interface &n; *&n; * Copyright 1998-2000  by Armin Schindler (mac@melware.de)&n; * Copyright 1999,2000  Cytronics &amp; Melware (info@melware.de)&n; *&n; * Thanks to&t;Deutsche Mailbox Saar-Lor-Lux GmbH&n; *&t;&t;for sponsoring and testing fax&n; *&t;&t;capabilities with Diva Server cards.&n; *&t;&t;(dor@deutschemailbox.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. &n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;eicon.h&quot;
macro_line|#include &quot;eicon_idi.h&quot;
macro_line|#include &quot;eicon_dsp.h&quot;
macro_line|#include &quot;uxio.h&quot;
DECL|macro|EICON_FULL_SERVICE_OKTETT
macro_line|#undef EICON_FULL_SERVICE_OKTETT
DECL|variable|eicon_idi_revision
r_char
op_star
id|eicon_idi_revision
op_assign
l_string|&quot;$Revision: 1.41 $&quot;
suffix:semicolon
DECL|variable|manbuf
id|eicon_manifbuf
op_star
id|manbuf
suffix:semicolon
r_int
id|eicon_idi_manage_assign
c_func
(paren
id|eicon_card
op_star
id|card
)paren
suffix:semicolon
r_int
id|eicon_idi_manage_remove
c_func
(paren
id|eicon_card
op_star
id|card
)paren
suffix:semicolon
r_int
id|idi_fill_in_T30
c_func
(paren
id|eicon_chan
op_star
id|chan
comma
r_int
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_int
DECL|function|idi_assign_req
id|idi_assign_req
c_func
(paren
id|eicon_REQ
op_star
id|reqbuf
comma
r_int
id|signet
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_int
id|l
op_assign
l_int|0
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|signet
)paren
(brace
multiline_comment|/* Signal Layer */
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|CAI
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|KEY
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|3
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_char|&squot;I&squot;
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_char|&squot;4&squot;
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_char|&squot;L&squot;
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|SHIFT
op_or
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|SIN
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|2
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* end */
id|reqbuf-&gt;Req
op_assign
id|ASSIGN
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
id|DSIG_ID
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|l
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sig Entity */
)brace
r_else
(brace
multiline_comment|/* Network Layer */
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|CAI
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|chan-&gt;e.D3Id
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|LLC
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|chan-&gt;l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
r_case
id|ISDN_PROTO_L2_TRANS
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* transparent */
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_X75I
suffix:colon
r_case
id|ISDN_PROTO_L2_X75UI
suffix:colon
r_case
id|ISDN_PROTO_L2_X75BUI
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* X.75 */
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_MODEM
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_IWAIT
)paren
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|9
suffix:semicolon
multiline_comment|/* V.42 incoming */
r_else
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* V.42 */
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_HDLC
suffix:colon
r_case
id|ISDN_PROTO_L2_FAX
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_IWAIT
)paren
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* autoconnect on incoming */
r_else
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* transparent */
r_break
suffix:semicolon
r_default
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|chan-&gt;l3prot
)paren
(brace
r_case
id|ISDN_PROTO_L3_FCLASS2
suffix:colon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|NLC
suffix:semicolon
id|tmp
op_assign
id|idi_fill_in_T30
c_func
(paren
id|chan
comma
op_amp
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|tmp
suffix:semicolon
id|l
op_add_assign
id|tmp
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|ISDN_PROTO_L3_TRANS
suffix:colon
r_default
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|4
suffix:semicolon
)brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* end */
id|reqbuf-&gt;Req
op_assign
id|ASSIGN
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
id|NL_ID
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|l
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Net Entity */
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_put_req
id|idi_put_req
c_func
(paren
id|eicon_REQ
op_star
id|reqbuf
comma
r_int
id|rq
comma
r_int
id|signet
comma
r_int
id|Ch
)paren
(brace
id|reqbuf-&gt;Req
op_assign
id|rq
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
id|Ch
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
id|signet
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_put_suspend_req
id|idi_put_suspend_req
c_func
(paren
id|eicon_REQ
op_star
id|reqbuf
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
id|reqbuf-&gt;Req
op_assign
id|SUSPEND
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|0
)braket
op_assign
id|CAI
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
id|chan-&gt;No
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
l_int|4
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sig Entity */
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_call_res_req
id|idi_call_res_req
c_func
(paren
id|eicon_REQ
op_star
id|reqbuf
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_int
id|l
op_assign
l_int|9
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|CALL_RES
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|0
)braket
op_assign
id|CAI
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|1
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|9
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|6
)braket
op_assign
l_int|32
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chan-&gt;l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_X75I
suffix:colon
r_case
id|ISDN_PROTO_L2_X75UI
suffix:colon
r_case
id|ISDN_PROTO_L2_X75BUI
suffix:colon
r_case
id|ISDN_PROTO_L2_HDLC
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x05
suffix:semicolon
id|l
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|5
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|7
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_MODEM
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x11
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|7
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|6
)braket
op_assign
l_int|128
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_FAX
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|0x10
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|6
)braket
op_assign
l_int|128
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_TRANS
suffix:colon
r_switch
c_cond
(paren
id|chan-&gt;l3prot
)paren
(brace
r_case
id|ISDN_PROTO_L3_TRANSDSP
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|2
)braket
op_assign
l_int|22
suffix:semicolon
multiline_comment|/* DTMF, audio events on */
)brace
r_break
suffix:semicolon
)brace
id|reqbuf-&gt;XBuffer.P
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|l
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sig Entity */
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Call_Res&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_do_req
id|idi_do_req
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
r_int
id|cmd
comma
r_int
id|layer
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in do_req()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: req %x (%s)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|cmd
comma
(paren
id|layer
)paren
ques
c_cond
l_string|&quot;Net&quot;
suffix:colon
l_string|&quot;Sig&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|layer
)paren
id|cmd
op_or_assign
l_int|0x700
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ASSIGN
suffix:colon
r_case
id|ASSIGN
op_or
l_int|0x700
suffix:colon
id|idi_assign_req
c_func
(paren
id|reqbuf
comma
id|layer
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REMOVE
suffix:colon
r_case
id|REMOVE
op_or
l_int|0x700
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|REMOVE
comma
id|layer
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INDICATE_REQ
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|INDICATE_REQ
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HANGUP
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|HANGUP
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUSPEND
suffix:colon
id|idi_put_suspend_req
c_func
(paren
id|reqbuf
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESUME
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|RESUME
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REJECT
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|REJECT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CALL_ALERT
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|CALL_ALERT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CALL_RES
suffix:colon
id|idi_call_res_req
c_func
(paren
id|reqbuf
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CALL_HOLD
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|CALL_HOLD
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_CONNECT
op_or
l_int|0x700
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|N_CONNECT
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_CONNECT_ACK
op_or
l_int|0x700
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|N_CONNECT_ACK
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_DISC
op_or
l_int|0x700
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|N_DISC
comma
l_int|1
comma
id|chan-&gt;e.IndCh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_DISC_ACK
op_or
l_int|0x700
suffix:colon
id|idi_put_req
c_func
(paren
id|reqbuf
comma
id|N_DISC_ACK
comma
l_int|1
comma
id|chan-&gt;e.IndCh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_req: Ch%d: Unknown request&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|eicon_idi_listen_req
id|eicon_idi_listen_req
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|16
comma
l_string|&quot;idi_req: Ch%d: Listen_Req eazmask=0x%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;eazmask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.D3Id
)paren
(brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|ASSIGN
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan-&gt;statectrl
op_amp
id|HAVE_CONN_REQ
)paren
)paren
(brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|INDICATE_REQ
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_LISTEN
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
r_char
DECL|function|idi_si2bc
id|idi_si2bc
c_func
(paren
r_int
id|si1
comma
r_int
id|si2
comma
r_char
op_star
id|bc
comma
r_char
op_star
id|hlc
)paren
(brace
id|hlc
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|si1
)paren
(brace
r_case
l_int|1
suffix:colon
id|bc
(braket
l_int|0
)braket
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 3,1 kHz audio */
id|bc
(braket
l_int|1
)braket
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 64 kbit/s */
id|bc
(braket
l_int|2
)braket
op_assign
l_int|0xa3
suffix:semicolon
multiline_comment|/* G.711 A-law */
macro_line|#ifdef EICON_FULL_SERVICE_OKTETT
r_if
c_cond
(paren
id|si2
op_eq
l_int|1
)paren
(brace
id|bc
(braket
l_int|0
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Speech */
id|hlc
(braket
l_int|0
)braket
op_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* hlc len */
id|hlc
(braket
l_int|1
)braket
op_assign
l_int|0x91
suffix:semicolon
multiline_comment|/* first hic */
id|hlc
(braket
l_int|2
)braket
op_assign
l_int|0x81
suffix:semicolon
multiline_comment|/* Telephony */
)brace
macro_line|#endif
r_return
l_int|3
suffix:semicolon
r_case
l_int|2
suffix:colon
id|bc
(braket
l_int|0
)braket
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 3,1 kHz audio */
id|bc
(braket
l_int|1
)braket
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 64 kbit/s */
id|bc
(braket
l_int|2
)braket
op_assign
l_int|0xa3
suffix:semicolon
multiline_comment|/* G.711 A-law */
macro_line|#ifdef EICON_FULL_SERVICE_OKTETT
r_if
c_cond
(paren
id|si2
op_eq
l_int|2
)paren
(brace
id|hlc
(braket
l_int|0
)braket
op_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* hlc len */
id|hlc
(braket
l_int|1
)braket
op_assign
l_int|0x91
suffix:semicolon
multiline_comment|/* first hic */
id|hlc
(braket
l_int|2
)braket
op_assign
l_int|0x84
suffix:semicolon
multiline_comment|/* Fax Gr.2/3 */
)brace
macro_line|#endif
r_return
l_int|3
suffix:semicolon
r_case
l_int|5
suffix:colon
r_case
l_int|7
suffix:colon
r_default
suffix:colon
id|bc
(braket
l_int|0
)braket
op_assign
l_int|0x88
suffix:semicolon
id|bc
(braket
l_int|1
)braket
op_assign
l_int|0x90
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|idi_hangup
id|idi_hangup
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_WMCONN
)paren
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|N_DISC
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|REMOVE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_NULL
)paren
(brace
id|chan-&gt;statectrl
op_or_assign
id|WAITING_FOR_HANGUP
suffix:semicolon
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|HANGUP
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Hangup&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|chan-&gt;fax
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|capipmsg
id|capipmsg
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
id|capi_msg
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
(paren
id|cm-&gt;para
(braket
l_int|0
)braket
op_ne
l_int|3
)paren
op_logical_or
(paren
id|cm-&gt;para
(braket
l_int|1
)braket
op_ne
l_int|0
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;para
(braket
l_int|2
)braket
OL
l_int|3
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;para
(braket
l_int|4
)braket
op_ne
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|cm-&gt;para
(braket
l_int|3
)braket
)paren
(brace
r_case
l_int|4
suffix:colon
multiline_comment|/* Suspend */
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Call Suspend&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;para
(braket
l_int|5
)braket
)paren
(brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|SUSPEND
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|CALL_HOLD
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Resume */
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Call Resume&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|RESUME
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_connect_res
id|idi_connect_res
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_IWAIT
suffix:semicolon
multiline_comment|/* check if old NetID has been removed */
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Ch%d: old net_id %x still exist, removing.&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;e.B2Id
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|REMOVE
comma
l_int|1
)paren
suffix:semicolon
)brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|ASSIGN
comma
l_int|1
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|CALL_RES
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idi_connect_req
id|idi_connect_req
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
r_char
op_star
id|phone
comma
r_char
op_star
id|eazmsn
comma
r_int
id|si1
comma
r_int
id|si2
)paren
(brace
r_int
id|l
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_int
r_char
op_star
id|sub
comma
op_star
id|sp
suffix:semicolon
r_int
r_char
id|bc
(braket
l_int|5
)braket
suffix:semicolon
r_int
r_char
id|hlc
(braket
l_int|5
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in connect_req()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|CALL_REQ
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|sub
op_assign
l_int|NULL
suffix:semicolon
id|sp
op_assign
id|phone
suffix:semicolon
r_while
c_loop
(paren
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
op_star
id|sp
op_eq
l_char|&squot;.&squot;
)paren
(brace
id|sub
op_assign
id|sp
op_plus
l_int|1
suffix:semicolon
op_star
id|sp
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|sp
op_increment
suffix:semicolon
)brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|CPN
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|strlen
c_func
(paren
id|phone
)paren
op_plus
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x81
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|phone
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|phone
(braket
id|i
)braket
op_amp
l_int|0x7f
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sub
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|DSA
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|strlen
c_func
(paren
id|sub
)paren
op_plus
l_int|2
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* NSAP coded */
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x50
suffix:semicolon
multiline_comment|/* local IDI format */
r_while
c_loop
(paren
op_star
id|sub
)paren
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
op_star
id|sub
op_increment
op_amp
l_int|0x7f
suffix:semicolon
)brace
id|sub
op_assign
l_int|NULL
suffix:semicolon
id|sp
op_assign
id|eazmsn
suffix:semicolon
r_while
c_loop
(paren
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
op_star
id|sp
op_eq
l_char|&squot;.&squot;
)paren
(brace
id|sub
op_assign
id|sp
op_plus
l_int|1
suffix:semicolon
op_star
id|sp
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|sp
op_increment
suffix:semicolon
)brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|OAD
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|strlen
c_func
(paren
id|eazmsn
)paren
op_plus
l_int|2
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x01
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|eazmsn
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|eazmsn
(braket
id|i
)braket
op_amp
l_int|0x7f
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sub
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|OSA
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|strlen
c_func
(paren
id|sub
)paren
op_plus
l_int|2
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* NSAP coded */
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x50
suffix:semicolon
multiline_comment|/* local IDI format */
r_while
c_loop
(paren
op_star
id|sub
)paren
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
op_star
id|sub
op_increment
op_amp
l_int|0x7f
suffix:semicolon
)brace
r_if
c_cond
(paren
id|si2
OG
l_int|2
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|SHIFT
op_or
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|SIN
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|2
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|si1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|si2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|idi_si2bc
c_func
(paren
id|si1
comma
id|si2
comma
id|bc
comma
id|hlc
)paren
)paren
OG
l_int|0
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|BC
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tmp
suffix:semicolon
id|i
op_increment
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|bc
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|hlc
(braket
l_int|0
)braket
)paren
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|HLC
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|tmp
suffix:semicolon
id|i
op_increment
)paren
(brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|hlc
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
)brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|CAI
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x09
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|32
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chan-&gt;l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_X75I
suffix:colon
r_case
id|ISDN_PROTO_L2_X75UI
suffix:colon
r_case
id|ISDN_PROTO_L2_X75BUI
suffix:colon
r_case
id|ISDN_PROTO_L2_HDLC
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|5
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|7
)braket
op_assign
l_int|1
suffix:semicolon
id|l
op_sub_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|7
)braket
op_assign
l_int|3
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|5
)braket
op_assign
l_int|5
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|l
op_sub_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|7
)braket
op_assign
l_int|3
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|5
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|l
op_sub_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|7
)braket
op_assign
l_int|3
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|5
)braket
op_assign
l_int|7
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|l
op_sub_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_MODEM
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|0x11
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|5
)braket
op_assign
l_int|7
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|2
)braket
op_assign
l_int|128
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_FAX
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|0x10
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|2
)braket
op_assign
l_int|128
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_TRANS
suffix:colon
r_switch
c_cond
(paren
id|chan-&gt;l3prot
)paren
(brace
r_case
id|ISDN_PROTO_L3_TRANSDSP
suffix:colon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_minus
l_int|6
)braket
op_assign
l_int|22
suffix:semicolon
multiline_comment|/* DTMF, audio events on */
)brace
r_break
suffix:semicolon
)brace
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* end */
id|reqbuf-&gt;XBuffer.length
op_assign
id|l
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sig Entity */
r_if
c_cond
(paren
id|chan-&gt;statectrl
op_amp
id|WAITING_FOR_HANGUP
)paren
(brace
multiline_comment|/*&t;If the line did not disconnect yet,&n;&t;&t;&t;we have to delay this command&t;&t;*/
id|eicon_log
c_func
(paren
id|card
comma
l_int|32
comma
l_string|&quot;idi_req: Ch%d: delaying conn_req&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|chan-&gt;statectrl
op_or_assign
id|HAVE_CONN_REQ
suffix:semicolon
id|chan-&gt;tskb1
op_assign
id|skb
suffix:semicolon
id|chan-&gt;tskb2
op_assign
id|skb2
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Conn_Req %s -&gt; %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|eazmsn
comma
id|phone
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|idi_IndParse
id|idi_IndParse
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
id|idi_ind_message
op_star
id|message
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|codeset
op_assign
l_int|0
suffix:semicolon
r_int
id|wlen
op_assign
l_int|0
suffix:semicolon
r_int
id|lock
op_assign
l_int|0
suffix:semicolon
id|__u8
id|w
suffix:semicolon
id|__u16
id|code
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|memset
c_func
(paren
id|message
comma
l_int|0
comma
r_sizeof
(paren
id|idi_ind_message
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|len
)paren
op_logical_or
(paren
op_logical_neg
id|buffer
(braket
id|pos
)braket
)paren
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|pos
op_le
id|len
)paren
(brace
id|w
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|w
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|w
op_amp
l_int|0x80
)paren
(brace
id|wlen
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|wlen
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|len
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|lock
op_amp
l_int|0x80
)paren
id|lock
op_and_assign
l_int|0x7f
suffix:semicolon
r_else
id|codeset
op_assign
id|lock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|w
op_amp
l_int|0xf0
)paren
op_eq
id|SHIFT
)paren
(brace
id|codeset
op_assign
id|w
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|codeset
op_amp
l_int|0x08
)paren
)paren
(brace
id|lock
op_assign
id|codeset
op_amp
l_int|7
suffix:semicolon
)brace
id|codeset
op_and_assign
l_int|7
suffix:semicolon
id|lock
op_or_assign
l_int|0x80
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|w
op_eq
id|ESC
op_logical_and
id|wlen
op_ge
l_int|2
)paren
(brace
id|code
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
op_or
l_int|0x800
suffix:semicolon
id|wlen
op_decrement
suffix:semicolon
)brace
r_else
id|code
op_assign
id|w
suffix:semicolon
id|code
op_or_assign
(paren
id|codeset
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
id|wlen
OG
id|len
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: IElen %d of %x exceeds Ind_Length (+%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|wlen
comma
id|code
comma
(paren
id|pos
op_plus
id|wlen
)paren
op_minus
id|len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
id|OAD
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;oad
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
id|j
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|wlen
)paren
(brace
id|message-&gt;plan
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|message-&gt;plan
op_amp
l_int|0x80
)paren
id|message-&gt;screen
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|message-&gt;screen
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
id|j
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
op_minus
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;oad
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: OAD=(0x%02x,0x%02x) %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;plan
comma
id|message-&gt;screen
comma
id|message-&gt;oad
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RDN
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;rdn
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
id|j
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|wlen
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buffer
(braket
id|pos
op_increment
)braket
op_amp
l_int|0x80
)paren
)paren
(brace
id|pos
op_increment
suffix:semicolon
id|j
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
op_minus
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;rdn
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: RDN= %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;rdn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPN
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;cpn
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;cpn
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: CPN=(0x%02x) %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
(paren
id|__u8
)paren
id|message-&gt;cpn
(braket
l_int|0
)braket
comma
id|message-&gt;cpn
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSA
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;dsa
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pos
op_add_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
op_minus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;dsa
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: DSA=%s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;dsa
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OSA
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;osa
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pos
op_add_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
op_minus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;osa
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: OSA=%s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;osa
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAD
suffix:colon
id|pos
op_add_assign
id|wlen
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: Connected Address in ind, len:%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|wlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BC
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;bc
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;bc
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: BC = 0x%02x 0x%02x 0x%02x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;bc
(braket
l_int|0
)braket
comma
id|message-&gt;bc
(braket
l_int|1
)braket
comma
id|message-&gt;bc
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x800
op_or
id|BC
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;e_bc
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;e_bc
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: ESC/BC=%d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;bc
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;llc
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;llc
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: LLC=%d %d %d %d ...&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;llc
(braket
l_int|0
)braket
comma
id|message-&gt;llc
(braket
l_int|1
)braket
comma
id|message-&gt;llc
(braket
l_int|2
)braket
comma
id|message-&gt;llc
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HLC
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;hlc
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;hlc
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: HLC=%x %x %x %x %x ...&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;hlc
(braket
l_int|0
)braket
comma
id|message-&gt;hlc
(braket
l_int|1
)braket
comma
id|message-&gt;hlc
(braket
l_int|2
)braket
comma
id|message-&gt;hlc
(braket
l_int|3
)braket
comma
id|message-&gt;hlc
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP
suffix:colon
r_case
l_int|0x600
op_or
id|DSP
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;display
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;display
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Display: %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;display
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x600
op_or
id|KEY
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;keypad
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;keypad
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Keypad: %s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;keypad
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NI
suffix:colon
r_case
l_int|0x600
op_or
id|NI
suffix:colon
r_if
c_cond
(paren
id|wlen
)paren
(brace
r_switch
c_cond
(paren
id|buffer
(braket
id|pos
)braket
op_amp
l_int|127
)paren
(brace
r_case
l_int|0
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: User suspended.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: User resumed.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Bearer service change.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Unknown Notification %x.&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|buffer
(braket
id|pos
)braket
op_amp
l_int|127
)paren
suffix:semicolon
)brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PI
suffix:colon
r_case
l_int|0x600
op_or
id|PI
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|buffer
(braket
id|pos
op_plus
l_int|1
)braket
op_amp
l_int|127
)paren
(brace
r_case
l_int|1
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Call is not end-to-end ISDN.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Destination address is non ISDN.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Origination address is non ISDN.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Call has returned to the ISDN.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Interworking has occurred.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: In-band information available.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: Unknown Progress %x.&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|buffer
(braket
id|pos
op_plus
l_int|1
)braket
op_amp
l_int|127
)paren
suffix:semicolon
)brace
)brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAU
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;cau
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;cau
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|chan-&gt;cause
comma
op_amp
id|message-&gt;cau
comma
l_int|2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: CAU=%d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;cau
(braket
l_int|0
)braket
comma
id|message-&gt;cau
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x800
op_or
id|CAU
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;e_cau
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;e_cau
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: ECAU=%d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;e_cau
(braket
l_int|0
)braket
comma
id|message-&gt;e_cau
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x800
op_or
id|CHI
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;e_chi
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;e_chi
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: ESC/CHI=%d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;e_cau
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x800
op_or
l_int|0x7a
suffix:colon
id|pos
op_increment
suffix:semicolon
id|message-&gt;e_mt
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: EMT=0x%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;e_mt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DT
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;dt
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;dt
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|4
comma
l_string|&quot;idi_inf: Ch%d: DT: %02d.%02d.%02d %02d:%02d:%02d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;dt
(braket
l_int|2
)braket
comma
id|message-&gt;dt
(braket
l_int|1
)braket
comma
id|message-&gt;dt
(braket
l_int|0
)braket
comma
id|message-&gt;dt
(braket
l_int|3
)braket
comma
id|message-&gt;dt
(braket
l_int|4
)braket
comma
id|message-&gt;dt
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x600
op_or
id|SIN
suffix:colon
r_if
c_cond
(paren
id|wlen
OG
r_sizeof
(paren
id|message-&gt;sin
)paren
)paren
(brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|message-&gt;sin
(braket
id|i
)braket
op_assign
id|buffer
(braket
id|pos
op_increment
)braket
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: SIN=%d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|message-&gt;sin
(braket
l_int|0
)braket
comma
id|message-&gt;sin
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x600
op_or
id|CPS
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: Called Party Status in ind&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x600
op_or
id|CIF
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wlen
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|buffer
(braket
id|pos
op_plus
id|i
)braket
op_ne
l_char|&squot;0&squot;
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd.parm.num
comma
op_amp
id|buffer
(braket
id|pos
op_plus
id|i
)braket
comma
id|wlen
op_minus
id|i
)paren
suffix:semicolon
id|cmd.parm.num
(braket
id|wlen
op_minus
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: CIF=%s&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|cmd.parm.num
)paren
suffix:semicolon
id|pos
op_add_assign
id|wlen
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_CINF
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x600
op_or
id|DATE
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: Date in ind&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xa1
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;idi_inf: Ch%d: Sending Complete in ind.&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe08
suffix:colon
r_case
l_int|0xe7a
suffix:colon
r_case
l_int|0xe04
suffix:colon
r_case
l_int|0xe00
suffix:colon
multiline_comment|/* *** TODO *** */
r_case
id|CHA
suffix:colon
multiline_comment|/* Charge advice */
r_case
id|FTY
suffix:colon
r_case
l_int|0x600
op_or
id|FTY
suffix:colon
r_case
id|CHI
suffix:colon
r_case
l_int|0x800
suffix:colon
multiline_comment|/* Not yet interested in this */
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x880
suffix:colon
multiline_comment|/* Managment Information Element */
r_if
c_cond
(paren
op_logical_neg
id|manbuf
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: manbuf not allocated&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|manbuf-&gt;data
(braket
id|manbuf-&gt;pos
)braket
comma
op_amp
id|buffer
(braket
id|pos
)braket
comma
id|wlen
)paren
suffix:semicolon
id|manbuf-&gt;length
(braket
id|manbuf-&gt;count
)braket
op_assign
id|wlen
suffix:semicolon
id|manbuf-&gt;count
op_increment
suffix:semicolon
id|manbuf-&gt;pos
op_add_assign
id|wlen
suffix:semicolon
)brace
id|pos
op_add_assign
id|wlen
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|pos
op_add_assign
id|wlen
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|6
comma
l_string|&quot;idi_inf: Ch%d: unknown information element 0x%x in ind, len:%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|code
comma
id|wlen
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_void
DECL|function|idi_bc2si
id|idi_bc2si
c_func
(paren
r_int
r_char
op_star
id|bc
comma
r_int
r_char
op_star
id|hlc
comma
r_int
r_char
op_star
id|sin
comma
r_int
r_char
op_star
id|si1
comma
r_int
r_char
op_star
id|si2
)paren
(brace
id|si1
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|si2
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|bc
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
(brace
r_case
l_int|0x00
suffix:colon
multiline_comment|/* Speech */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef EICON_FULL_SERVICE_OKTETT
id|si1
(braket
l_int|0
)braket
op_assign
id|sin
(braket
l_int|0
)braket
suffix:semicolon
id|si2
(braket
l_int|0
)braket
op_assign
id|sin
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
multiline_comment|/* 3.1 Khz audio */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef EICON_FULL_SERVICE_OKTETT
id|si1
(braket
l_int|0
)braket
op_assign
id|sin
(braket
l_int|0
)braket
suffix:semicolon
id|si2
(braket
l_int|0
)braket
op_assign
id|sin
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
multiline_comment|/* Unrestricted digital information */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|7
suffix:semicolon
id|si2
(braket
l_int|0
)braket
op_assign
id|sin
(braket
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x09
suffix:colon
multiline_comment|/* Restricted digital information */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x11
suffix:colon
multiline_comment|/* Unrestr. digital information  with&n;&t;&t;&t; * tones/announcements ( or 7 kHz audio&n;&t;&t;&t; */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x18
suffix:colon
multiline_comment|/* Video */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bc
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
(brace
r_case
l_int|0x40
suffix:colon
multiline_comment|/* packed mode */
id|si1
(braket
l_int|0
)braket
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
multiline_comment|/* 64 kbit */
r_case
l_int|0x11
suffix:colon
multiline_comment|/* 2*64 kbit */
r_case
l_int|0x13
suffix:colon
multiline_comment|/* 384 kbit */
r_case
l_int|0x15
suffix:colon
multiline_comment|/* 1536 kbit */
r_case
l_int|0x17
suffix:colon
multiline_comment|/* 1920 kbit */
multiline_comment|/* moderate = bc[1] &amp; 0x7f; */
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/********************* FAX stuff ***************************/
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_int
DECL|function|idi_fill_in_T30
id|idi_fill_in_T30
c_func
(paren
id|eicon_chan
op_star
id|chan
comma
r_int
r_char
op_star
id|buffer
)paren
(brace
id|eicon_t30_s
op_star
id|t30
op_assign
(paren
id|eicon_t30_s
op_star
)paren
id|buffer
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|1
comma
l_string|&quot;idi_T30: fill_in with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|t30
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_t30_s
)paren
)paren
suffix:semicolon
id|t30-&gt;station_id_len
op_assign
id|EICON_FAXID_LEN
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|t30-&gt;station_id
(braket
l_int|0
)braket
comma
op_amp
id|chan-&gt;fax-&gt;id
(braket
l_int|0
)braket
comma
id|EICON_FAXID_LEN
)paren
suffix:semicolon
id|t30-&gt;resolution
op_assign
id|chan-&gt;fax-&gt;resolution
suffix:semicolon
id|t30-&gt;rate
op_assign
id|chan-&gt;fax-&gt;rate
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* eicon rate starts with 1 */
id|t30-&gt;format
op_assign
id|T30_FORMAT_SFF
suffix:semicolon
id|t30-&gt;pages_low
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;pages_high
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;atf
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* optimised for AT+F command set */
id|t30-&gt;code
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;feature_bits_low
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;feature_bits_high
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;control_bits_low
op_assign
l_int|0
suffix:semicolon
id|t30-&gt;control_bits_high
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;nbc
)paren
(brace
multiline_comment|/* set compression by DCC value */
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;compression
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
multiline_comment|/* 1-D modified */
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
multiline_comment|/* 2-D modified Read */
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_2D_CODING
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_2D_CODING
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
multiline_comment|/* 2-D uncompressed */
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_UNCOMPR
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_2D_CODING
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_UNCOMPR_ENABLED
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_2D_CODING
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|3
)paren
suffix:colon
multiline_comment|/* 2-D modified Read */
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_T6_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_2D_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_UNCOMPR
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_UNCOMPR_ENABLED
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_T6_CODING
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_2D_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_ECM
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_ECM
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* set compression to best */
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_T6_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_2D_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_UNCOMPR
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_UNCOMPR_ENABLED
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_T6_CODING
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_2D_CODING
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_ECM
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_ECM
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;ecm
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
multiline_comment|/* disable ECM */
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_ECM
suffix:semicolon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ECM_64_BYTES
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_ECM
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_ECM_64_BYTES
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
id|t30-&gt;control_bits_low
op_or_assign
id|T30_CONTROL_BIT_ENABLE_ECM
suffix:semicolon
id|t30-&gt;feature_bits_low
op_or_assign
id|T30_FEATURE_BIT_ECM
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|128
)paren
(brace
r_char
id|st
(braket
l_int|40
)braket
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:code = %x&bslash;n&quot;
comma
id|t30-&gt;code
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:rate = %x&bslash;n&quot;
comma
id|t30-&gt;rate
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:res  = %x&bslash;n&quot;
comma
id|t30-&gt;resolution
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:format = %x&bslash;n&quot;
comma
id|t30-&gt;format
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:pages_low = %x&bslash;n&quot;
comma
id|t30-&gt;pages_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:pages_high = %x&bslash;n&quot;
comma
id|t30-&gt;pages_high
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:atf  = %x&bslash;n&quot;
comma
id|t30-&gt;atf
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:control_bits_low = %x&bslash;n&quot;
comma
id|t30-&gt;control_bits_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:control_bits_high = %x&bslash;n&quot;
comma
id|t30-&gt;control_bits_high
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:feature_bits_low = %x&bslash;n&quot;
comma
id|t30-&gt;feature_bits_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:feature_bits_high = %x&bslash;n&quot;
comma
id|t30-&gt;feature_bits_high
)paren
suffix:semicolon
singleline_comment|//eicon_log(NULL, 128, &quot;sT30:universal_5 = %x&bslash;n&quot;, t30-&gt;universal_5);
singleline_comment|//eicon_log(NULL, 128, &quot;sT30:universal_6 = %x&bslash;n&quot;, t30-&gt;universal_6);
singleline_comment|//eicon_log(NULL, 128, &quot;sT30:universal_7 = %x&bslash;n&quot;, t30-&gt;universal_7);
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:station_id_len = %x&bslash;n&quot;
comma
id|t30-&gt;station_id_len
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:head_line_len = %x&bslash;n&quot;
comma
id|t30-&gt;head_line_len
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|st
comma
id|t30-&gt;station_id
comma
id|t30-&gt;station_id_len
)paren
suffix:semicolon
id|st
(braket
id|t30-&gt;station_id_len
)braket
op_assign
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|128
comma
l_string|&quot;sT30:station_id = &lt;%s&gt;&bslash;n&quot;
comma
id|st
)paren
suffix:semicolon
)brace
r_return
r_sizeof
(paren
id|eicon_t30_s
)paren
suffix:semicolon
)brace
multiline_comment|/* send fax struct */
r_int
DECL|function|idi_send_edata
id|idi_send_edata
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_NULL
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_LISTEN
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_snd: Ch%d: send edata on state %d !&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;idi_snd: Ch%d: edata (fax)&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_REQ
)paren
op_plus
r_sizeof
(paren
id|eicon_t30_s
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in send_edata()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_t30_s
)paren
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|N_EDATA
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
id|chan-&gt;e.IndCh
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|idi_fill_in_T30
c_func
(paren
id|chan
comma
id|reqbuf-&gt;XBuffer.P
)paren
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Net Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_parse_edata
id|idi_parse_edata
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
id|eicon_t30_s
op_star
id|p
op_assign
(paren
id|eicon_t30_s
op_star
)paren
id|buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|128
)paren
(brace
r_char
id|st
(braket
l_int|40
)braket
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:len %d , size %d&bslash;n&quot;
comma
id|len
comma
r_sizeof
(paren
id|eicon_t30_s
)paren
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:code = %x&bslash;n&quot;
comma
id|p-&gt;code
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:rate = %x&bslash;n&quot;
comma
id|p-&gt;rate
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:res  = %x&bslash;n&quot;
comma
id|p-&gt;resolution
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:format = %x&bslash;n&quot;
comma
id|p-&gt;format
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:pages_low = %x&bslash;n&quot;
comma
id|p-&gt;pages_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:pages_high = %x&bslash;n&quot;
comma
id|p-&gt;pages_high
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:atf  = %x&bslash;n&quot;
comma
id|p-&gt;atf
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:control_bits_low = %x&bslash;n&quot;
comma
id|p-&gt;control_bits_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:control_bits_high = %x&bslash;n&quot;
comma
id|p-&gt;control_bits_high
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:feature_bits_low = %x&bslash;n&quot;
comma
id|p-&gt;feature_bits_low
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:feature_bits_high = %x&bslash;n&quot;
comma
id|p-&gt;feature_bits_high
)paren
suffix:semicolon
singleline_comment|//eicon_log(ccard, 128, &quot;rT30:universal_5 = %x&bslash;n&quot;, p-&gt;universal_5);
singleline_comment|//eicon_log(ccard, 128, &quot;rT30:universal_6 = %x&bslash;n&quot;, p-&gt;universal_6);
singleline_comment|//eicon_log(ccard, 128, &quot;rT30:universal_7 = %x&bslash;n&quot;, p-&gt;universal_7);
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:station_id_len = %x&bslash;n&quot;
comma
id|p-&gt;station_id_len
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:head_line_len = %x&bslash;n&quot;
comma
id|p-&gt;head_line_len
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|st
comma
id|p-&gt;station_id
comma
id|p-&gt;station_id_len
)paren
suffix:semicolon
id|st
(braket
id|p-&gt;station_id_len
)braket
op_assign
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rT30:station_id = &lt;%s&gt;&bslash;n&quot;
comma
id|st
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_edata: parse to NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|chan-&gt;fax-&gt;code
op_assign
id|p-&gt;code
suffix:semicolon
id|i
op_assign
(paren
id|p-&gt;station_id_len
OL
id|FAXIDLEN
)paren
ques
c_cond
id|p-&gt;station_id_len
suffix:colon
(paren
id|FAXIDLEN
op_minus
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|chan-&gt;fax-&gt;r_id
comma
id|p-&gt;station_id
comma
id|i
)paren
suffix:semicolon
id|chan-&gt;fax-&gt;r_id
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax-&gt;r_resolution
op_assign
id|p-&gt;resolution
suffix:semicolon
id|chan-&gt;fax-&gt;r_rate
op_assign
id|p-&gt;rate
op_minus
l_int|1
suffix:semicolon
id|chan-&gt;fax-&gt;r_binary
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no binary support */
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax-&gt;r_length
op_assign
l_int|2
suffix:semicolon
id|chan-&gt;fax-&gt;r_scantime
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax-&gt;r_ecm
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;feature_bits_low
op_amp
id|T30_FEATURE_BIT_2D_CODING
)paren
(brace
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;feature_bits_low
op_amp
id|T30_FEATURE_BIT_UNCOMPR_ENABLED
)paren
(brace
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;feature_bits_low
op_amp
id|T30_FEATURE_BIT_T6_CODING
)paren
(brace
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;feature_bits_low
op_amp
id|T30_FEATURE_BIT_ECM
)paren
(brace
id|chan-&gt;fax-&gt;r_ecm
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;feature_bits_low
op_amp
id|T30_FEATURE_BIT_ECM_64_BYTES
)paren
id|chan-&gt;fax-&gt;r_ecm
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_void
DECL|function|idi_fax_send_header
id|idi_fax_send_header
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
r_int
id|header
)paren
(brace
r_static
id|__u16
id|wd2sff
(braket
)braket
op_assign
(brace
l_int|1728
comma
l_int|2048
comma
l_int|2432
comma
l_int|1216
comma
l_int|864
)brace
suffix:semicolon
r_static
id|__u16
id|ln2sff
(braket
l_int|2
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
l_int|1143
comma
l_int|1401
comma
l_int|0
)brace
comma
(brace
l_int|2287
comma
l_int|2802
comma
l_int|0
)brace
)brace
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|eicon_sff_dochead
op_star
id|doc
suffix:semicolon
id|eicon_sff_pagehead
op_star
id|page
suffix:semicolon
id|u_char
op_star
id|docp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_fax: send head with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|header
op_eq
l_int|2
)paren
(brace
multiline_comment|/* DocHeader + PageHeader */
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_sff_dochead
)paren
op_plus
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in fax_send_header()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|header
op_eq
l_int|2
)paren
(brace
multiline_comment|/* DocHeader + PageHeader */
id|docp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_sff_dochead
)paren
op_plus
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
)paren
suffix:semicolon
id|doc
op_assign
(paren
id|eicon_sff_dochead
op_star
)paren
id|docp
suffix:semicolon
id|page
op_assign
(paren
id|eicon_sff_pagehead
op_star
)paren
(paren
id|docp
op_plus
r_sizeof
(paren
id|eicon_sff_dochead
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|docp
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_sff_dochead
)paren
op_plus
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
)paren
suffix:semicolon
id|doc-&gt;id
op_assign
l_int|0x66666653
suffix:semicolon
id|doc-&gt;version
op_assign
l_int|0x01
suffix:semicolon
id|doc-&gt;off1pagehead
op_assign
r_sizeof
(paren
id|eicon_sff_dochead
)paren
suffix:semicolon
)brace
r_else
(brace
id|page
op_assign
(paren
id|eicon_sff_pagehead
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|page
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|header
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* PageHeaderEnd */
id|page-&gt;pageheadid
op_assign
l_int|254
suffix:semicolon
id|page-&gt;pageheadlen
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* PageHeader */
r_case
l_int|2
suffix:colon
multiline_comment|/* DocHeader + PageHeader */
id|page-&gt;pageheadid
op_assign
l_int|254
suffix:semicolon
id|page-&gt;pageheadlen
op_assign
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
op_minus
l_int|2
suffix:semicolon
id|page-&gt;resvert
op_assign
id|chan-&gt;fax-&gt;resolution
suffix:semicolon
id|page-&gt;reshoriz
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* always 203 dpi */
id|page-&gt;coding
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* always 1D */
id|page-&gt;linelength
op_assign
id|wd2sff
(braket
id|chan-&gt;fax-&gt;width
)braket
suffix:semicolon
id|page-&gt;pagelength
op_assign
id|ln2sff
(braket
id|chan-&gt;fax-&gt;resolution
)braket
(braket
id|chan-&gt;fax-&gt;length
)braket
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;sSFF-Head: linelength = %d&bslash;n&quot;
comma
id|page-&gt;linelength
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;sSFF-Head: pagelength = %d&bslash;n&quot;
comma
id|page-&gt;pagelength
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|idi_send_data
c_func
(paren
id|card
comma
id|chan
comma
l_int|0
comma
id|skb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_fax_cmd
id|idi_fax_cmd
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_fax: cmd with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;code
)paren
(brace
r_case
id|ISDN_TTY_FAX_DT
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_B
)paren
(brace
id|idi_send_edata
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_D
)paren
(brace
id|idi_send_edata
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_TTY_FAX_DR
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_B
)paren
(brace
id|idi_send_edata
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_CFR
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_RID
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
multiline_comment|/* telling 1-D compression */
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|0
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_DCS
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|chan-&gt;fax2.NextObject
op_assign
id|FAX_OBJECT_DOCU
suffix:semicolon
id|chan-&gt;fax2.PrevObject
op_assign
id|FAX_OBJECT_DOCU
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_D
)paren
(brace
id|idi_send_edata
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_TTY_FAX_ET
suffix:colon
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;fet
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
id|idi_fax_send_header
c_func
(paren
id|card
comma
id|chan
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|idi_fax_send_header
c_func
(paren
id|card
comma
id|chan
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|idi_edata_rcveop
id|idi_edata_rcveop
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_edata: rcveop with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_ET
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_reset_fax_stat
id|idi_reset_fax_stat
c_func
(paren
id|eicon_chan
op_star
id|chan
)paren
(brace
id|chan-&gt;fax2.LineLen
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.LineData
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.LineDataLen
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.Dle
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.PageCount
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;fax2.Eop
op_assign
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|idi_edata_action
id|idi_edata_action
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_edata: action with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;direction
op_eq
id|ISDN_TTY_FAX_CONN_OUT
)paren
(brace
id|idi_parse_edata
c_func
(paren
id|ccard
comma
id|chan
comma
id|buffer
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_A
)paren
(brace
id|idi_reset_fax_stat
c_func
(paren
id|chan
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ACTIVE
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_FCON
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_RID
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_DIS
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;r_compression
op_ne
l_int|0
)paren
(brace
multiline_comment|/* telling fake compression in second DIS message */
id|chan-&gt;fax-&gt;r_compression
op_assign
l_int|0
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_DIS
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_SENT
suffix:semicolon
multiline_comment|/* OK message */
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_D
)paren
(brace
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;code
op_eq
id|EDATA_T30_MCF
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;fet
op_ne
l_int|2
)paren
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_PTS
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;fet
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* new page */
multiline_comment|/* stay in phase D , wait on cmd +FDT */
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* new document */
multiline_comment|/* link-level switch to phase B */
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* session end */
r_default
suffix:colon
multiline_comment|/* send_edata produces error on some */
multiline_comment|/* fax-machines here, so we don&squot;t */
multiline_comment|/* idi_send_edata(ccard, chan); */
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;direction
op_eq
id|ISDN_TTY_FAX_CONN_IN
)paren
(brace
id|idi_parse_edata
c_func
(paren
id|ccard
comma
id|chan
comma
id|buffer
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;code
op_eq
id|EDATA_T30_DCS
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_A
)paren
)paren
(brace
id|idi_reset_fax_stat
c_func
(paren
id|chan
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_FCON_I
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;code
op_eq
id|EDATA_T30_TRAIN_OK
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_A
)paren
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_RID
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_TRAIN_OK
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;code
op_eq
id|EDATA_T30_TRAIN_OK
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_B
)paren
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_TRAIN_OK
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_C
)paren
(brace
r_switch
c_cond
(paren
id|chan-&gt;fax-&gt;code
)paren
(brace
r_case
id|EDATA_T30_TRAIN_OK
suffix:colon
id|idi_send_edata
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EDATA_T30_MPS
suffix:colon
id|chan-&gt;fax-&gt;fet
op_assign
l_int|0
suffix:semicolon
id|idi_edata_rcveop
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EDATA_T30_EOM
suffix:colon
id|chan-&gt;fax-&gt;fet
op_assign
l_int|1
suffix:semicolon
id|idi_edata_rcveop
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EDATA_T30_EOP
suffix:colon
id|chan-&gt;fax-&gt;fet
op_assign
l_int|2
suffix:semicolon
id|idi_edata_rcveop
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_void
DECL|function|fax_put_rcv
id|fax_put_rcv
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
id|u_char
op_star
id|Data
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
op_plus
id|MAX_HEADER_LEN
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in fax_put_rcv()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|MAX_HEADER_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|Data
comma
id|len
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|rcvcallb_skb
c_func
(paren
id|ccard-&gt;myid
comma
id|chan-&gt;No
comma
id|skb
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_faxdata_rcv
id|idi_faxdata_rcv
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|eicon_OBJBUFFER
id|InBuf
suffix:semicolon
id|eicon_OBJBUFFER
id|LineBuf
suffix:semicolon
r_int
r_int
id|Length
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|aLength
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|ObjectSize
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|ObjHeadLen
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|ObjDataLen
op_assign
l_int|0
suffix:semicolon
id|__u8
id|Recordtype
suffix:semicolon
id|__u8
id|PageHeaderLen
suffix:semicolon
id|__u8
id|Event
suffix:semicolon
id|eicon_sff_pagehead
op_star
id|ob_page
suffix:semicolon
id|__u16
id|Cl2Eol
op_assign
l_int|0x8000
suffix:semicolon
DECL|macro|EVENT_NONE
macro_line|#&t;define EVENT_NONE&t;0
DECL|macro|EVENT_NEEDDATA
macro_line|#&t;define EVENT_NEEDDATA&t;1
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_fax: rcvdata with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;direction
op_eq
id|ISDN_TTY_FAX_CONN_IN
)paren
(brace
id|InBuf.Data
op_assign
id|skb-&gt;data
suffix:semicolon
id|InBuf.Size
op_assign
id|skb-&gt;len
suffix:semicolon
id|InBuf.Len
op_assign
l_int|0
suffix:semicolon
id|InBuf.Next
op_assign
id|InBuf.Data
suffix:semicolon
id|LineBuf.Data
op_assign
id|chan-&gt;fax2.abLine
suffix:semicolon
id|LineBuf.Size
op_assign
r_sizeof
(paren
id|chan-&gt;fax2.abLine
)paren
suffix:semicolon
id|LineBuf.Len
op_assign
id|chan-&gt;fax2.LineLen
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|Event
op_assign
id|EVENT_NONE
suffix:semicolon
r_while
c_loop
(paren
id|Event
op_eq
id|EVENT_NONE
)paren
(brace
r_switch
c_cond
(paren
id|chan-&gt;fax2.NextObject
)paren
(brace
r_case
id|FAX_OBJECT_DOCU
suffix:colon
id|Length
op_assign
id|LineBuf.Len
op_plus
(paren
id|InBuf.Size
op_minus
id|InBuf.Len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
r_sizeof
(paren
id|eicon_sff_dochead
)paren
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ObjectSize
op_assign
r_sizeof
(paren
id|eicon_sff_dochead
)paren
suffix:semicolon
id|Length
op_assign
id|ObjectSize
suffix:semicolon
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|Length
)paren
(brace
id|Length
op_sub_assign
id|LineBuf.Len
suffix:semicolon
id|LineBuf.Len
op_assign
l_int|0
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
suffix:semicolon
id|InBuf.Len
op_add_assign
id|Length
suffix:semicolon
id|InBuf.Next
op_add_assign
id|Length
suffix:semicolon
)brace
r_else
(brace
id|LineBuf.Len
op_sub_assign
id|Length
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|memmove
c_func
(paren
id|LineBuf.Data
comma
id|LineBuf.Data
op_plus
id|Length
comma
id|LineBuf.Len
)paren
suffix:semicolon
)brace
id|chan-&gt;fax2.PrevObject
op_assign
id|FAX_OBJECT_DOCU
suffix:semicolon
id|chan-&gt;fax2.NextObject
op_assign
id|FAX_OBJECT_PAGE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FAX_OBJECT_PAGE
suffix:colon
id|Length
op_assign
id|LineBuf.Len
op_plus
(paren
id|InBuf.Size
op_minus
id|InBuf.Len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
l_int|2
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
op_eq
l_int|0
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
op_eq
l_int|1
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
)brace
id|PageHeaderLen
op_assign
op_star
(paren
id|LineBuf.Data
op_plus
l_int|1
)paren
suffix:semicolon
id|ObjectSize
op_assign
(paren
id|PageHeaderLen
op_eq
l_int|0
)paren
ques
c_cond
l_int|2
suffix:colon
r_sizeof
(paren
id|eicon_sff_pagehead
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
id|ObjectSize
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|Length
op_assign
id|ObjectSize
suffix:semicolon
multiline_comment|/* extract page dimensions */
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|Length
)paren
(brace
id|aLength
op_assign
id|Length
op_minus
id|LineBuf.Len
suffix:semicolon
id|memcpy
c_func
(paren
id|LineBuf.Next
comma
id|InBuf.Next
comma
id|aLength
)paren
suffix:semicolon
id|LineBuf.Next
op_add_assign
id|aLength
suffix:semicolon
id|InBuf.Next
op_add_assign
id|aLength
suffix:semicolon
id|LineBuf.Len
op_add_assign
id|aLength
suffix:semicolon
id|InBuf.Len
op_add_assign
id|aLength
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Length
OG
l_int|2
)paren
(brace
id|ob_page
op_assign
(paren
id|eicon_sff_pagehead
op_star
)paren
id|LineBuf.Data
suffix:semicolon
r_switch
c_cond
(paren
id|ob_page-&gt;linelength
)paren
(brace
r_case
l_int|2048
suffix:colon
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2432
suffix:colon
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1216
suffix:colon
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|864
suffix:colon
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1728
suffix:colon
r_default
suffix:colon
id|chan-&gt;fax-&gt;r_width
op_assign
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ob_page-&gt;pagelength
)paren
(brace
r_case
l_int|1143
suffix:colon
r_case
l_int|2287
suffix:colon
id|chan-&gt;fax-&gt;r_length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1401
suffix:colon
r_case
l_int|2802
suffix:colon
id|chan-&gt;fax-&gt;r_length
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|chan-&gt;fax-&gt;r_length
op_assign
l_int|2
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rSFF-Head: linelength = %d&bslash;n&quot;
comma
id|ob_page-&gt;linelength
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;rSFF-Head: pagelength = %d&bslash;n&quot;
comma
id|ob_page-&gt;pagelength
)paren
suffix:semicolon
)brace
id|LineBuf.Len
op_sub_assign
id|Length
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|memmove
c_func
(paren
id|LineBuf.Data
comma
id|LineBuf.Data
op_plus
id|Length
comma
id|LineBuf.Len
)paren
suffix:semicolon
id|chan-&gt;fax2.PrevObject
op_assign
id|FAX_OBJECT_PAGE
suffix:semicolon
id|chan-&gt;fax2.NextObject
op_assign
id|FAX_OBJECT_LINE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FAX_OBJECT_LINE
suffix:colon
id|Length
op_assign
id|LineBuf.Len
op_plus
(paren
id|InBuf.Size
op_minus
id|InBuf.Len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
l_int|1
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
op_eq
l_int|0
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
)brace
id|Recordtype
op_assign
op_star
id|LineBuf.Data
suffix:semicolon
r_if
c_cond
(paren
id|Recordtype
op_eq
l_int|0
)paren
(brace
multiline_comment|/* recordtype pixel row (2 byte length) */
id|ObjHeadLen
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
id|ObjHeadLen
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|LineBuf.Len
OL
id|ObjHeadLen
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
)brace
id|ObjDataLen
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|LineBuf.Data
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|ObjectSize
op_assign
id|ObjHeadLen
op_plus
id|ObjDataLen
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
id|ObjectSize
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|Recordtype
op_ge
l_int|1
)paren
op_logical_and
(paren
id|Recordtype
op_le
l_int|216
)paren
)paren
(brace
multiline_comment|/* recordtype pixel row (1 byte length) */
id|ObjHeadLen
op_assign
l_int|1
suffix:semicolon
id|ObjDataLen
op_assign
id|Recordtype
suffix:semicolon
id|ObjectSize
op_assign
id|ObjHeadLen
op_plus
id|ObjDataLen
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
id|ObjectSize
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|Recordtype
op_ge
l_int|217
)paren
op_logical_and
(paren
id|Recordtype
op_le
l_int|253
)paren
)paren
(brace
multiline_comment|/* recordtype empty lines */
id|ObjHeadLen
op_assign
l_int|1
suffix:semicolon
id|ObjDataLen
op_assign
l_int|0
suffix:semicolon
id|ObjectSize
op_assign
id|ObjHeadLen
op_plus
id|ObjDataLen
suffix:semicolon
id|LineBuf.Len
op_decrement
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|memmove
c_func
(paren
id|LineBuf.Data
comma
id|LineBuf.Data
op_plus
l_int|1
comma
id|LineBuf.Len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Recordtype
op_eq
l_int|254
)paren
(brace
multiline_comment|/* recordtype page header */
id|chan-&gt;fax2.PrevObject
op_assign
id|FAX_OBJECT_LINE
suffix:semicolon
id|chan-&gt;fax2.NextObject
op_assign
id|FAX_OBJECT_PAGE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* recordtype user information */
id|ObjHeadLen
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|Length
OL
id|ObjHeadLen
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|LineBuf.Len
OL
id|ObjHeadLen
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
)brace
id|ObjDataLen
op_assign
op_star
(paren
id|LineBuf.Data
op_plus
l_int|1
)paren
suffix:semicolon
id|ObjectSize
op_assign
id|ObjHeadLen
op_plus
id|ObjDataLen
suffix:semicolon
r_if
c_cond
(paren
id|ObjDataLen
op_eq
l_int|0
)paren
(brace
multiline_comment|/* illegal line coding */
id|LineBuf.Len
op_sub_assign
id|ObjHeadLen
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|memmove
c_func
(paren
id|LineBuf.Data
comma
id|LineBuf.Data
op_plus
id|ObjHeadLen
comma
id|LineBuf.Len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* user information */
r_if
c_cond
(paren
id|Length
OL
id|ObjectSize
)paren
(brace
id|Event
op_assign
id|EVENT_NEEDDATA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|Length
op_assign
id|ObjectSize
suffix:semicolon
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|Length
)paren
(brace
id|Length
op_sub_assign
id|LineBuf.Len
suffix:semicolon
id|LineBuf.Len
op_assign
l_int|0
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
suffix:semicolon
id|InBuf.Len
op_add_assign
id|Length
suffix:semicolon
id|InBuf.Next
op_add_assign
id|Length
suffix:semicolon
)brace
r_else
(brace
id|LineBuf.Len
op_sub_assign
id|Length
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|memmove
c_func
(paren
id|LineBuf.Data
comma
id|LineBuf.Data
op_plus
id|Length
comma
id|LineBuf.Len
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
id|Length
op_assign
id|ObjectSize
suffix:semicolon
r_if
c_cond
(paren
id|LineBuf.Len
OG
id|ObjHeadLen
)paren
(brace
id|fax_put_rcv
c_func
(paren
id|ccard
comma
id|chan
comma
id|LineBuf.Data
op_plus
id|ObjHeadLen
comma
(paren
id|LineBuf.Len
op_minus
id|ObjHeadLen
)paren
)paren
suffix:semicolon
)brace
id|Length
op_sub_assign
id|LineBuf.Len
suffix:semicolon
id|LineBuf.Len
op_assign
l_int|0
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
suffix:semicolon
r_if
c_cond
(paren
id|Length
OG
l_int|0
)paren
(brace
id|fax_put_rcv
c_func
(paren
id|ccard
comma
id|chan
comma
id|InBuf.Next
comma
id|Length
)paren
suffix:semicolon
id|InBuf.Len
op_add_assign
id|Length
suffix:semicolon
id|InBuf.Next
op_add_assign
id|Length
suffix:semicolon
)brace
id|fax_put_rcv
c_func
(paren
id|ccard
comma
id|chan
comma
(paren
id|__u8
op_star
)paren
op_amp
id|Cl2Eol
comma
r_sizeof
(paren
id|Cl2Eol
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* end of switch (chan-&gt;fax2.NextObject) */
)brace
multiline_comment|/* end of while (Event==EVENT_NONE) */
r_if
c_cond
(paren
id|InBuf.Len
OL
id|InBuf.Size
)paren
(brace
id|Length
op_assign
id|InBuf.Size
op_minus
id|InBuf.Len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|LineBuf.Len
op_plus
id|Length
)paren
OG
id|LineBuf.Size
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_fax: Ch%d: %d bytes dropping, small buffer&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|Length
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|LineBuf.Next
comma
id|InBuf.Next
comma
id|Length
)paren
suffix:semicolon
id|LineBuf.Len
op_add_assign
id|Length
suffix:semicolon
)brace
)brace
id|chan-&gt;fax2.LineLen
op_assign
id|LineBuf.Len
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* CONN_OUT */
multiline_comment|/* On CONN_OUT we do not need incoming data, drop it */
multiline_comment|/* maybe later for polling */
)brace
DECL|macro|EVENT_NONE
macro_line|#&t;undef EVENT_NONE
DECL|macro|EVENT_NEEDDATA
macro_line|#&t;undef EVENT_NEEDDATA
r_return
suffix:semicolon
)brace
r_int
DECL|function|idi_fax_send_outbuf
id|idi_fax_send_outbuf
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
id|eicon_OBJBUFFER
op_star
id|OutBuf
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|OutBuf-&gt;Len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in fax_send_outbuf()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|OutBuf-&gt;Len
)paren
comma
id|OutBuf-&gt;Data
comma
id|OutBuf-&gt;Len
)paren
suffix:semicolon
id|OutBuf-&gt;Len
op_assign
l_int|0
suffix:semicolon
id|OutBuf-&gt;Next
op_assign
id|OutBuf-&gt;Data
suffix:semicolon
r_return
id|idi_send_data
c_func
(paren
id|ccard
comma
id|chan
comma
l_int|0
comma
id|skb
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|idi_faxdata_send
id|idi_faxdata_send
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|eicon_OBJBUFFER
id|InBuf
suffix:semicolon
id|__u8
id|InData
suffix:semicolon
id|__u8
id|InMask
suffix:semicolon
id|eicon_OBJBUFFER
id|OutBuf
suffix:semicolon
id|eicon_OBJBUFFER
id|LineBuf
suffix:semicolon
id|__u32
id|LineData
suffix:semicolon
r_int
r_int
id|LineDataLen
suffix:semicolon
id|__u8
id|Byte
suffix:semicolon
id|__u8
id|Event
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
suffix:semicolon
DECL|macro|EVENT_NONE
macro_line|#&t;define EVENT_NONE&t;0
DECL|macro|EVENT_EOD
macro_line|#&t;define EVENT_EOD&t;1
DECL|macro|EVENT_EOL
macro_line|#&t;define EVENT_EOL &t;2
DECL|macro|EVENT_EOP
macro_line|#&t;define EVENT_EOP &t;3
r_if
c_cond
(paren
(paren
op_logical_neg
id|ccard
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_fax: senddata with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;direction
op_eq
id|ISDN_TTY_FAX_CONN_IN
)paren
(brace
multiline_comment|/* Simply ignore any data written in data mode when receiving a fax.    */
multiline_comment|/* This is not completely correct because only XON&squot;s should come here.  */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_ne
id|ISDN_FAX_PHASE_C
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;queued
op_plus
id|skb-&gt;len
OG
l_int|1200
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;pqueued
OG
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
id|InBuf.Data
op_assign
id|skb-&gt;data
suffix:semicolon
id|InBuf.Size
op_assign
id|skb-&gt;len
suffix:semicolon
id|InBuf.Len
op_assign
l_int|0
suffix:semicolon
id|InBuf.Next
op_assign
id|InBuf.Data
suffix:semicolon
id|InData
op_assign
l_int|0
suffix:semicolon
id|InMask
op_assign
l_int|0
suffix:semicolon
id|LineBuf.Data
op_assign
id|chan-&gt;fax2.abLine
suffix:semicolon
id|LineBuf.Size
op_assign
r_sizeof
(paren
id|chan-&gt;fax2.abLine
)paren
suffix:semicolon
id|LineBuf.Len
op_assign
id|chan-&gt;fax2.LineLen
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
op_plus
id|LineBuf.Len
suffix:semicolon
id|LineData
op_assign
id|chan-&gt;fax2.LineData
suffix:semicolon
id|LineDataLen
op_assign
id|chan-&gt;fax2.LineDataLen
suffix:semicolon
id|OutBuf.Data
op_assign
id|chan-&gt;fax2.abFrame
suffix:semicolon
id|OutBuf.Size
op_assign
r_sizeof
(paren
id|chan-&gt;fax2.abFrame
)paren
suffix:semicolon
id|OutBuf.Len
op_assign
l_int|0
suffix:semicolon
id|OutBuf.Next
op_assign
id|OutBuf.Data
suffix:semicolon
id|Event
op_assign
id|EVENT_NONE
suffix:semicolon
id|chan-&gt;fax2.Eop
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|InMask
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|InBuf.Len
op_ge
id|InBuf.Size
)paren
(brace
id|Event
op_assign
id|EVENT_EOD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan-&gt;fax2.Dle
op_ne
id|_DLE_
)paren
op_logical_and
op_star
id|InBuf.Next
op_eq
id|_DLE_
)paren
(brace
id|chan-&gt;fax2.Dle
op_assign
id|_DLE_
suffix:semicolon
id|InBuf.Next
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|InBuf.Len
op_ge
id|InBuf.Size
)paren
(brace
id|Event
op_assign
id|EVENT_EOD
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chan-&gt;fax2.Dle
op_eq
id|_DLE_
)paren
(brace
id|chan-&gt;fax2.Dle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|InBuf.Next
op_eq
id|_ETX_
)paren
(brace
id|Event
op_assign
id|EVENT_EOP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|InBuf.Next
op_eq
id|_DLE_
)paren
(brace
multiline_comment|/* do nothing */
)brace
r_else
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: unknown DLE escape %02x found&bslash;n&quot;
comma
id|chan-&gt;No
comma
op_star
id|InBuf.Next
)paren
suffix:semicolon
id|InBuf.Next
op_increment
suffix:semicolon
id|InBuf.Len
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|InBuf.Len
op_ge
id|InBuf.Size
)paren
(brace
id|Event
op_assign
id|EVENT_EOD
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|InBuf.Len
op_increment
suffix:semicolon
id|InData
op_assign
op_star
id|InBuf.Next
op_increment
suffix:semicolon
id|InMask
op_assign
(paren
id|chan-&gt;fax-&gt;bor
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x01
suffix:semicolon
)brace
r_while
c_loop
(paren
id|InMask
)paren
(brace
id|LineData
op_rshift_assign
l_int|1
suffix:semicolon
id|LineDataLen
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|InData
op_amp
id|InMask
)paren
id|LineData
op_or_assign
l_int|0x80000000
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;bor
)paren
id|InMask
op_rshift_assign
l_int|1
suffix:semicolon
r_else
id|InMask
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|LineDataLen
op_ge
id|T4_EOL_BITSIZE
)paren
op_logical_and
(paren
(paren
id|LineData
op_amp
id|T4_EOL_MASK_DWORD
)paren
op_eq
id|T4_EOL_DWORD
)paren
)paren
(brace
id|Event
op_assign
id|EVENT_EOL
suffix:semicolon
r_if
c_cond
(paren
id|LineDataLen
OG
id|T4_EOL_BITSIZE
)paren
(brace
id|Byte
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|LineData
op_amp
op_complement
id|T4_EOL_MASK_DWORD
)paren
op_rshift
(paren
l_int|32
op_minus
id|LineDataLen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Byte
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax2.NullByteExist
)paren
(brace
id|chan-&gt;fax2.NullBytesPos
op_assign
id|LineBuf.Len
suffix:semicolon
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|LineBuf.Size
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
id|Byte
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
)brace
)brace
id|LineDataLen
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineDataLen
op_ge
id|T4_EOL_BITSIZE
op_plus
l_int|8
)paren
(brace
id|Byte
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|LineData
op_amp
op_complement
id|T4_EOL_MASK_DWORD
)paren
op_rshift
(paren
l_int|32
op_minus
id|T4_EOL_BITSIZE
op_minus
l_int|8
)paren
)paren
suffix:semicolon
id|LineData
op_and_assign
id|T4_EOL_MASK_DWORD
suffix:semicolon
id|LineDataLen
op_assign
id|T4_EOL_BITSIZE
suffix:semicolon
r_if
c_cond
(paren
id|Byte
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax2.NullByteExist
)paren
(brace
id|chan-&gt;fax2.NullBytesPos
op_assign
id|LineBuf.Len
suffix:semicolon
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|LineBuf.Size
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
id|Byte
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|Event
op_ne
id|EVENT_NONE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|Event
op_ne
id|EVENT_EOL
)paren
op_logical_and
(paren
id|Event
op_ne
id|EVENT_EOP
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Event
op_eq
id|EVENT_EOP
)paren
op_logical_and
(paren
id|LineDataLen
OG
l_int|0
)paren
)paren
(brace
id|LineData
op_rshift_assign
l_int|32
op_minus
id|LineDataLen
suffix:semicolon
id|LineDataLen
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|LineData
op_ne
l_int|0
)paren
(brace
id|Byte
op_assign
(paren
id|__u8
)paren
id|LineData
suffix:semicolon
id|LineData
op_rshift_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|Byte
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax2.NullByteExist
)paren
(brace
id|chan-&gt;fax2.NullBytesPos
op_assign
id|LineBuf.Len
suffix:semicolon
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
OL
id|LineBuf.Size
)paren
(brace
op_star
id|LineBuf.Next
op_increment
op_assign
id|Byte
suffix:semicolon
id|LineBuf.Len
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|chan-&gt;fax2.NullByteExist
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;fax2.NullBytesPos
op_eq
l_int|0
)paren
(brace
id|LineBuf.Len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|LineBuf.Len
op_assign
id|chan-&gt;fax2.NullBytesPos
op_plus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|LineBuf.Len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|OutBuf.Len
op_plus
id|LineBuf.Len
op_plus
id|SFF_LEN_FLD_SIZE
OG
id|OutBuf.Size
)paren
(brace
id|ret
op_assign
id|idi_fax_send_outbuf
c_func
(paren
id|ccard
comma
id|chan
comma
op_amp
id|OutBuf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LineBuf.Len
op_le
l_int|216
)paren
(brace
op_star
id|OutBuf.Next
op_increment
op_assign
(paren
id|__u8
)paren
id|LineBuf.Len
suffix:semicolon
id|OutBuf.Len
op_increment
suffix:semicolon
)brace
r_else
(brace
op_star
id|OutBuf.Next
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
id|OutBuf.Next
)paren
op_increment
op_assign
(paren
id|__u16
)paren
id|LineBuf.Len
suffix:semicolon
id|OutBuf.Len
op_add_assign
l_int|3
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|OutBuf.Next
comma
id|LineBuf.Data
comma
id|LineBuf.Len
)paren
suffix:semicolon
id|OutBuf.Next
op_add_assign
id|LineBuf.Len
suffix:semicolon
id|OutBuf.Len
op_add_assign
id|LineBuf.Len
suffix:semicolon
)brace
id|LineBuf.Len
op_assign
l_int|0
suffix:semicolon
id|LineBuf.Next
op_assign
id|LineBuf.Data
suffix:semicolon
id|chan-&gt;fax2.NullByteExist
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Event
op_eq
id|EVENT_EOP
)paren
r_break
suffix:semicolon
id|Event
op_assign
id|EVENT_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Event
op_eq
id|EVENT_EOP
)paren
(brace
id|chan-&gt;fax2.Eop
op_assign
l_int|1
suffix:semicolon
id|chan-&gt;fax2.PageCount
op_increment
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_EOP
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|OutBuf.Len
OG
l_int|0
)paren
(brace
id|ret
op_assign
id|idi_fax_send_outbuf
c_func
(paren
id|ccard
comma
id|chan
comma
op_amp
id|OutBuf
)paren
suffix:semicolon
)brace
id|chan-&gt;fax2.LineLen
op_assign
id|LineBuf.Len
suffix:semicolon
id|chan-&gt;fax2.LineData
op_assign
id|LineData
suffix:semicolon
id|chan-&gt;fax2.LineDataLen
op_assign
id|LineDataLen
suffix:semicolon
DECL|macro|EVENT_NONE
macro_line|#&t;undef EVENT_NONE
DECL|macro|EVENT_EOD
macro_line|#&t;undef EVENT_EOD
DECL|macro|EVENT_EOL
macro_line|#&t;undef EVENT_EOL
DECL|macro|EVENT_EOP
macro_line|#&t;undef EVENT_EOP
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|ret
op_assign
l_int|1
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_void
DECL|function|idi_fax_hangup
id|idi_fax_hangup
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_fax: hangup with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;direction
op_eq
id|ISDN_TTY_FAX_CONN_OUT
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;code
op_eq
l_int|0
)paren
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_PTS
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan-&gt;fax-&gt;code
OG
l_int|1
)paren
op_logical_and
(paren
id|chan-&gt;fax-&gt;code
OL
l_int|120
)paren
)paren
id|chan-&gt;fax-&gt;code
op_add_assign
l_int|120
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_fax: Ch%d: Hangup (code=%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fax-&gt;code
)paren
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_HNG
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/******** FAX ********/
r_int
DECL|function|idi_send_udata
id|idi_send_udata
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
r_int
id|UReq
comma
id|u_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_NULL
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_LISTEN
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_snd: Ch%d: send udata on state %d !&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|8
comma
l_string|&quot;idi_snd: Ch%d: udata 0x%x: %d %d %d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|UReq
comma
id|buffer
(braket
l_int|0
)braket
comma
id|buffer
(braket
l_int|1
)braket
comma
id|buffer
(braket
l_int|2
)braket
comma
id|buffer
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_REQ
)paren
op_plus
id|len
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in send_udata()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
op_plus
id|len
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|N_UDATA
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
id|chan-&gt;e.IndCh
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|len
op_plus
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|0
)braket
op_assign
id|UReq
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|reqbuf-&gt;XBuffer.P
(braket
l_int|1
)braket
comma
id|buffer
comma
id|len
)paren
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Net Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_audio_cmd
id|idi_audio_cmd
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_int
id|cmd
comma
id|u_char
op_star
id|value
)paren
(brace
id|u_char
id|buf
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|enable_dtmf_s
op_star
id|dtmf_buf
op_assign
(paren
r_struct
id|enable_dtmf_s
op_star
)paren
id|buf
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|ccard
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ISDN_AUDIO_SETDD
suffix:colon
r_if
c_cond
(paren
id|value
(braket
l_int|0
)braket
)paren
(brace
id|dtmf_buf-&gt;tone
op_assign
(paren
id|__u16
)paren
(paren
id|value
(braket
l_int|1
)braket
op_star
l_int|5
)paren
suffix:semicolon
id|dtmf_buf-&gt;gap
op_assign
(paren
id|__u16
)paren
(paren
id|value
(braket
l_int|1
)braket
op_star
l_int|5
)paren
suffix:semicolon
id|idi_send_udata
c_func
(paren
id|ccard
comma
id|chan
comma
id|DSP_UDATA_REQUEST_ENABLE_DTMF_RECEIVER
comma
id|buf
comma
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|idi_send_udata
c_func
(paren
id|ccard
comma
id|chan
comma
id|DSP_UDATA_REQUEST_DISABLE_DTMF_RECEIVER
comma
id|buf
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|idi_parse_udata
id|idi_parse_udata
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|eicon_dsp_ind
op_star
id|p
op_assign
(paren
id|eicon_dsp_ind
op_star
)paren
(paren
op_amp
id|buffer
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_static
r_char
op_star
id|connmsg
(braket
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
l_string|&quot;V.21&quot;
comma
l_string|&quot;V.23&quot;
comma
l_string|&quot;V.22&quot;
comma
l_string|&quot;V.22bis&quot;
comma
l_string|&quot;V.32bis&quot;
comma
l_string|&quot;V.34&quot;
comma
l_string|&quot;V.8&quot;
comma
l_string|&quot;Bell 212A&quot;
comma
l_string|&quot;Bell 103&quot;
comma
l_string|&quot;V.29 Leased&quot;
comma
l_string|&quot;V.33 Leased&quot;
comma
l_string|&quot;V.90&quot;
comma
l_string|&quot;V.21 CH2&quot;
comma
l_string|&quot;V.27ter&quot;
comma
l_string|&quot;V.29&quot;
comma
l_string|&quot;V.33&quot;
comma
l_string|&quot;V.17&quot;
)brace
suffix:semicolon
r_static
id|u_char
id|dtmf_code
(braket
)braket
op_assign
(brace
l_char|&squot;1&squot;
comma
l_char|&squot;4&squot;
comma
l_char|&squot;7&squot;
comma
l_char|&squot;*&squot;
comma
l_char|&squot;2&squot;
comma
l_char|&squot;5&squot;
comma
l_char|&squot;8&squot;
comma
l_char|&squot;0&squot;
comma
l_char|&squot;3&squot;
comma
l_char|&squot;6&squot;
comma
l_char|&squot;9&squot;
comma
l_char|&squot;#&squot;
comma
l_char|&squot;A&squot;
comma
l_char|&squot;B&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;D&squot;
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|ccard
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
)paren
(brace
r_case
id|DSP_UDATA_INDICATION_SYNC
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ind: Ch%d: UDATA_SYNC time %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;time
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_DCD_OFF
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_DCD_OFF time %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;time
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_DCD_ON
suffix:colon
r_if
c_cond
(paren
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_MODEM
)paren
op_logical_and
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_WMCONN
)paren
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ACTIVE
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|sprintf
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;%d/%s&quot;
comma
id|p-&gt;speed
comma
id|connmsg
(braket
id|p-&gt;norm
)braket
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_DCD_ON time %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;time
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: %d %d %d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;norm
comma
id|p-&gt;options
comma
id|p-&gt;speed
comma
id|p-&gt;delay
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_CTS_OFF
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_CTS_OFF time %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;time
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_CTS_ON
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_CTS_ON time %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;time
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: %d %d %d %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|p-&gt;norm
comma
id|p-&gt;options
comma
id|p-&gt;speed
comma
id|p-&gt;delay
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_DISCONNECT
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_DISCONNECT cause %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|buffer
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_UDATA_INDICATION_DTMF_DIGITS_RECEIVED
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UDATA_DTMF_REC &squot;%c&squot;&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|dtmf_code
(braket
id|buffer
(braket
l_int|1
)braket
)braket
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_AUDIO
suffix:semicolon
id|cmd.parm.num
(braket
l_int|0
)braket
op_assign
id|ISDN_AUDIO_DTMF
suffix:semicolon
id|cmd.parm.num
(braket
l_int|1
)braket
op_assign
id|dtmf_code
(braket
id|buffer
(braket
l_int|1
)braket
)braket
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UNHANDLED UDATA Indication 0x%02x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|buffer
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|eicon_parse_trace
id|eicon_parse_trace
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
r_int
id|buflen
op_assign
id|len
op_star
l_int|3
op_plus
l_int|30
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|trace_s
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_int
r_int
id|code
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|1
)braket
suffix:semicolon
)brace
op_star
id|q
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|kmalloc
c_func
(paren
id|buflen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch??: could not allocate trace buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
id|buflen
)paren
suffix:semicolon
id|q
op_assign
(paren
r_struct
id|trace_s
op_star
)paren
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|512
)paren
(brace
r_if
c_cond
(paren
(paren
id|q-&gt;code
op_eq
l_int|3
)paren
op_logical_or
(paren
id|q-&gt;code
op_eq
l_int|4
)paren
)paren
(brace
id|n
op_assign
(paren
r_int
)paren
op_star
(paren
id|q-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
(brace
id|j
op_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;DTRC:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|j
comma
l_string|&quot;%02x &quot;
comma
id|q-&gt;data
(braket
id|i
op_plus
l_int|2
)braket
)paren
suffix:semicolon
)brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|j
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|j
op_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;XLOG: %lx %04x %04x &quot;
comma
id|q-&gt;time
comma
id|q-&gt;size
comma
id|q-&gt;code
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|q-&gt;size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|j
comma
l_string|&quot;%02x &quot;
comma
id|q-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|j
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|p
)paren
)paren
id|eicon_putstatus
c_func
(paren
id|ccard
comma
id|p
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_void
DECL|function|idi_handle_ind
id|idi_handle_ind
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_char
id|tnum
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|dlev
suffix:semicolon
r_int
id|free_buff
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_IND
op_star
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|idi_ind_message
id|message
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch??: null card in handle_ind&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan
op_assign
id|ccard-&gt;IdTable
(braket
id|ind-&gt;IndId
)braket
)paren
op_eq
l_int|NULL
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch??: null chan in handle_ind&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ind-&gt;Ind
op_ne
l_int|8
)paren
op_logical_and
(paren
id|ind-&gt;Ind
op_ne
l_int|0xc
)paren
)paren
id|dlev
op_assign
l_int|144
suffix:semicolon
r_else
id|dlev
op_assign
l_int|128
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
id|dlev
comma
l_string|&quot;idi_hdl: Ch%d: Ind=%x Id=%x Ch=%x MInd=%x MLen=%x Len=%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ind-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|ind-&gt;IndCh
comma
id|ind-&gt;MInd
comma
id|ind-&gt;MLength
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|free_buff
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Signal Layer */
r_if
c_cond
(paren
id|chan-&gt;e.D3Id
op_eq
id|ind-&gt;IndId
)paren
(brace
id|idi_IndParse
c_func
(paren
id|ccard
comma
id|chan
comma
op_amp
id|message
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ind-&gt;Ind
)paren
(brace
r_case
id|HANGUP
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Hangup&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.X
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|chan-&gt;queued
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;pqueued
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;waitq
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;waitpq
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message.e_cau
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|sprintf
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;E%02x%02x&quot;
comma
id|chan-&gt;cause
(braket
l_int|0
)braket
op_amp
l_int|0x7f
comma
id|message.e_cau
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_CAUSE
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|chan-&gt;cause
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_WMCONN
)paren
)paren
op_logical_or
(paren
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
op_logical_and
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_OBWAIT
)paren
)paren
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|REMOVE
comma
l_int|1
)paren
suffix:semicolon
id|chan-&gt;statectrl
op_and_assign
op_complement
id|WAITING_FOR_HANGUP
suffix:semicolon
id|chan-&gt;statectrl
op_and_assign
op_complement
id|IN_HOLD
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;statectrl
op_amp
id|HAVE_CONN_REQ
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|32
comma
l_string|&quot;idi_req: Ch%d: queueing delayed conn_req&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|chan-&gt;statectrl
op_and_assign
op_complement
id|HAVE_CONN_REQ
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;tskb1
)paren
op_logical_and
(paren
id|chan-&gt;tskb2
)paren
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|chan-&gt;tskb1
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;sndq
comma
id|chan-&gt;tskb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
id|chan-&gt;tskb1
op_assign
l_int|NULL
suffix:semicolon
id|chan-&gt;tskb2
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|chan-&gt;fax
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
)brace
r_break
suffix:semicolon
r_case
id|INDICATE_IND
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Indicate_Ind&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_LISTEN
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: Incoming call on wrong state (%d).&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|HANGUP
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ICALL
suffix:semicolon
id|idi_bc2si
c_func
(paren
id|message.bc
comma
id|message.hlc
comma
id|message.sin
comma
op_amp
id|chan-&gt;si1
comma
op_amp
id|chan-&gt;si2
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|chan-&gt;cpn
comma
id|message.cpn
op_plus
l_int|1
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|chan-&gt;oad
comma
id|message.oad
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|chan-&gt;dsa
comma
id|message.dsa
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|chan-&gt;osa
comma
id|message.osa
)paren
suffix:semicolon
id|chan-&gt;plan
op_assign
id|message.plan
suffix:semicolon
id|chan-&gt;screen
op_assign
id|message.screen
suffix:semicolon
id|try_stat_icall_again
suffix:colon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_ICALL
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|cmd.parm.setup.si1
op_assign
id|chan-&gt;si1
suffix:semicolon
id|cmd.parm.setup.si2
op_assign
id|chan-&gt;si2
suffix:semicolon
id|strcpy
c_func
(paren
id|tnum
comma
id|chan-&gt;cpn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|chan-&gt;dsa
)paren
)paren
(brace
id|strcat
c_func
(paren
id|tnum
comma
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|tnum
comma
id|chan-&gt;dsa
)paren
suffix:semicolon
)brace
id|tnum
(braket
id|ISDN_MSNLEN
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.setup.eazmsn
comma
id|tnum
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tnum
comma
id|chan-&gt;oad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|chan-&gt;osa
)paren
)paren
(brace
id|strcat
c_func
(paren
id|tnum
comma
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|tnum
comma
id|chan-&gt;osa
)paren
suffix:semicolon
)brace
id|tnum
(braket
id|ISDN_MSNLEN
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.setup.phone
comma
id|tnum
)paren
suffix:semicolon
id|cmd.parm.setup.plan
op_assign
id|chan-&gt;plan
suffix:semicolon
id|cmd.parm.setup.screen
op_assign
id|chan-&gt;screen
suffix:semicolon
id|tmp
op_assign
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tmp
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* no user responding */
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|HANGUP
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* alert */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Call Alert&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALL
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALLW
)paren
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ICALL
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|CALL_ALERT
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* reject */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Call Reject&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|REJECT
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* incomplete number */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_req: Ch%d: Incomplete Number&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ICALLW
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|INFO_IND
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Info_Ind&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALLW
)paren
op_logical_and
(paren
id|message.cpn
(braket
l_int|0
)braket
)paren
)paren
(brace
id|strcat
c_func
(paren
id|chan-&gt;cpn
comma
id|message.cpn
op_plus
l_int|1
)paren
suffix:semicolon
r_goto
id|try_stat_icall_again
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CALL_IND
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Call_Ind&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALL
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_IWAIT
)paren
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_IBWAIT
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|chan-&gt;l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_FAX
suffix:colon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;fax
)paren
id|chan-&gt;fax-&gt;phase
op_assign
id|ISDN_FAX_PHASE_A
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_MODEM
suffix:colon
multiline_comment|/* do nothing, wait for connect */
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
r_case
id|ISDN_PROTO_L2_TRANS
suffix:colon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|N_CONNECT
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* On most incoming calls we use automatic connect */
multiline_comment|/* idi_do_req(ccard, chan, N_CONNECT, 1); */
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_ACTIVE
)paren
id|idi_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CALL_CON
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Call_Con&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_OCALL
)paren
(brace
multiline_comment|/* check if old NetID has been removed */
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon: Ch%d: old net_id %x still exist, removing.&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;e.B2Id
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|REMOVE
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;fax
)paren
(brace
id|chan-&gt;fax-&gt;phase
op_assign
id|ISDN_FAX_PHASE_A
suffix:semicolon
)brace
r_else
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ind: Call_Con with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
id|idi_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_OBWAIT
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|ASSIGN
comma
l_int|1
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|N_CONNECT
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|idi_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AOC_IND
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Advice of Charge&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CALL_HOLD_ACK
suffix:colon
id|chan-&gt;statectrl
op_or_assign
id|IN_HOLD
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Call Hold Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUSPEND_REJ
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Suspend Rejected&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUSPEND
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Suspend Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESUME
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: Resume Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UNHANDLED SigIndication 0x%02x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ind-&gt;Ind
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Network Layer */
r_else
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
op_eq
id|ind-&gt;IndId
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;No
op_eq
id|ccard-&gt;nchannels
)paren
(brace
multiline_comment|/* Management Indication */
r_if
c_cond
(paren
id|ind-&gt;Ind
op_eq
l_int|0x04
)paren
(brace
multiline_comment|/* Trace_Ind */
id|eicon_parse_trace
c_func
(paren
id|ccard
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
)brace
r_else
(brace
id|idi_IndParse
c_func
(paren
id|ccard
comma
id|chan
comma
op_amp
id|message
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_switch
c_cond
(paren
id|ind-&gt;Ind
)paren
(brace
r_case
id|N_CONNECT_ACK
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ind: Ch%d: N_Connect_Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_MODEM
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_WMCONN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ACTIVE
suffix:semicolon
id|idi_parse_edata
c_func
(paren
id|ccard
comma
id|chan
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;fax-&gt;phase
op_eq
id|ISDN_FAX_PHASE_B
)paren
(brace
id|idi_fax_send_header
c_func
(paren
id|ccard
comma
id|chan
comma
l_int|2
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_DCS
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ind: N_Connect_Ack with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
)brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ACTIVE
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;64000&quot;
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_CONNECT
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ind: Ch%d: N_Connect&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
id|chan-&gt;e.IndCh
op_assign
id|ind-&gt;IndCh
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|N_CONNECT_ACK
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_MODEM
)paren
(brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_WMCONN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_ACTIVE
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.num
comma
l_string|&quot;64000&quot;
)paren
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_DISC
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ind: Ch%d: N_Disc&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
(brace
r_while
c_loop
(paren
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.X
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|N_DISC_ACK
comma
l_int|1
)paren
suffix:semicolon
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|REMOVE
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
op_logical_and
(paren
id|chan-&gt;fax
)paren
)paren
(brace
id|idi_parse_edata
c_func
(paren
id|ccard
comma
id|chan
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|idi_fax_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
)brace
macro_line|#endif
id|chan-&gt;e.IndCh
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|chan-&gt;queued
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;pqueued
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;waitq
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;waitpq
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan-&gt;statectrl
op_amp
id|IN_HOLD
)paren
)paren
(brace
id|idi_do_req
c_func
(paren
id|ccard
comma
id|chan
comma
id|HANGUP
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan-&gt;statectrl
op_amp
id|IN_HOLD
)paren
)paren
(brace
id|chan-&gt;statectrl
op_or_assign
id|WAITING_FOR_HANGUP
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|chan-&gt;fax
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|N_DISC_ACK
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ind: Ch%d: N_Disc_Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
id|idi_parse_edata
c_func
(paren
id|ccard
comma
id|chan
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|idi_fax_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
r_case
id|N_DATA_ACK
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_ind: Ch%d: N_Data_Ack&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_DATA
suffix:colon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_IND
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_rcv: Ch%d: %d bytes&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|idi_faxdata_rcv
c_func
(paren
id|ccard
comma
id|chan
comma
id|skb
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|ccard-&gt;interface
dot
id|rcvcallb_skb
c_func
(paren
id|ccard-&gt;myid
comma
id|chan-&gt;No
comma
id|skb
)paren
suffix:semicolon
id|free_buff
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|N_UDATA
suffix:colon
id|idi_parse_udata
c_func
(paren
id|ccard
comma
id|chan
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_case
id|N_EDATA
suffix:colon
id|idi_edata_action
c_func
(paren
id|ccard
comma
id|chan
comma
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;idi_ind: Ch%d: UNHANDLED NetIndication 0x%02x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ind-&gt;Ind
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ind: Ch%d: Ind is neither SIG nor NET !&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|free_buff
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_int
DECL|function|idi_handle_ack_ok
id|idi_handle_ack_ok
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
id|eicon_chan
op_star
id|chan
comma
id|eicon_RC
op_star
id|ack
)paren
(brace
id|ulong
id|flags
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|tqueued
op_assign
l_int|0
suffix:semicolon
r_int
id|twaitpq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ack-&gt;RcId
op_ne
(paren
(paren
id|chan-&gt;e.ReqCh
)paren
ques
c_cond
id|chan-&gt;e.B2Id
suffix:colon
id|chan-&gt;e.D3Id
)paren
)paren
(brace
multiline_comment|/* I dont know why this happens, should not ! */
multiline_comment|/* just ignoring this RC */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: RcId %d not equal to last %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;RcId
comma
(paren
id|chan-&gt;e.ReqCh
)paren
ques
c_cond
id|chan-&gt;e.B2Id
suffix:colon
id|chan-&gt;e.D3Id
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Management Interface */
r_if
c_cond
(paren
id|chan-&gt;No
op_eq
id|ccard-&gt;nchannels
)paren
(brace
multiline_comment|/* Managementinterface: changing state */
r_if
c_cond
(paren
id|chan-&gt;e.Req
op_ne
l_int|0x02
)paren
id|chan-&gt;fsm_state
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Remove an Id */
r_if
c_cond
(paren
id|chan-&gt;e.Req
op_eq
id|REMOVE
)paren
(brace
r_if
c_cond
(paren
id|ack-&gt;Reference
op_ne
id|chan-&gt;e.ref
)paren
(brace
multiline_comment|/* This should not happen anymore */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: Rc-Ref %d not equal to stored %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;Reference
comma
id|chan-&gt;e.ref
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|ccard-&gt;IdTable
(braket
id|ack-&gt;RcId
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.ReqCh
)paren
id|chan-&gt;e.D3Id
op_assign
l_int|0
suffix:semicolon
r_else
id|chan-&gt;e.B2Id
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: Removed : Id=%x Ch=%d (%s)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
(paren
id|chan-&gt;e.ReqCh
)paren
ques
c_cond
l_string|&quot;Net&quot;
suffix:colon
l_string|&quot;Sig&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Signal layer */
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.ReqCh
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: RC OK Id=%x Ch=%d (ref:%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|ack-&gt;Reference
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Network layer */
r_switch
c_cond
(paren
id|chan-&gt;e.Req
op_amp
l_int|0x0f
)paren
(brace
r_case
id|N_CONNECT
suffix:colon
id|chan-&gt;e.IndCh
op_assign
id|ack-&gt;RcCh
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: RC OK Id=%x Ch=%d (ref:%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|ack-&gt;Reference
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|N_MDATA
suffix:colon
r_case
id|N_DATA
suffix:colon
id|tqueued
op_assign
id|chan-&gt;queued
suffix:semicolon
id|twaitpq
op_assign
id|chan-&gt;waitpq
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;e.Req
op_amp
l_int|0x0f
)paren
op_eq
id|N_DATA
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|chan-&gt;waitpq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;pqueued
)paren
(brace
id|chan-&gt;pqueued
op_decrement
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|chan-&gt;queued
op_minus
id|chan-&gt;waitq
)paren
OL
l_int|1
)paren
op_logical_and
(paren
id|chan-&gt;fax2.Eop
)paren
)paren
(brace
id|chan-&gt;fax2.Eop
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fax
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;fax-&gt;r_code
op_assign
id|ISDN_TTY_FAX_SENT
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_else
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ack: Sent with NULL fax struct, ERROR&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|chan-&gt;queued
op_sub_assign
id|chan-&gt;waitq
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;queued
OL
l_int|0
)paren
id|chan-&gt;queued
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|chan-&gt;e.Req
op_amp
l_int|0x0f
)paren
op_eq
id|N_DATA
)paren
op_logical_and
(paren
id|tqueued
)paren
)paren
(brace
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|cmd.parm.length
op_assign
id|twaitpq
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: RC OK Id=%x Ch=%d (ref:%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|ack-&gt;Reference
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|idi_handle_ack
id|idi_handle_ack
c_func
(paren
id|eicon_card
op_star
id|ccard
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|j
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|eicon_RC
op_star
id|ack
op_assign
(paren
id|eicon_RC
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|dCh
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_err: Ch??: null card in handle_ack&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan
op_assign
id|ccard-&gt;IdTable
(braket
id|ack-&gt;RcId
)braket
)paren
op_ne
l_int|NULL
)paren
id|dCh
op_assign
id|chan-&gt;No
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ack-&gt;Rc
)paren
(brace
r_case
id|OK_FC
suffix:colon
r_case
id|N_FLOW_CONTROL
suffix:colon
r_case
id|ASSIGN_RC
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ack: Ch%d: unhandled RC 0x%x&bslash;n&quot;
comma
id|dCh
comma
id|ack-&gt;Rc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READY_INT
suffix:colon
r_case
id|TIMER_INT
suffix:colon
multiline_comment|/* we do nothing here */
r_break
suffix:semicolon
r_case
id|OK
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|chan
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ack: Ch%d: OK on chan without Id&bslash;n&quot;
comma
id|dCh
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|idi_handle_ack_ok
c_func
(paren
id|ccard
comma
id|chan
comma
id|ack
)paren
)paren
id|chan
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ASSIGN_OK
suffix:colon
r_if
c_cond
(paren
id|chan
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ack: Ch%d: ASSIGN-OK on chan already assigned (%x,%x)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;e.D3Id
comma
id|chan-&gt;e.B2Id
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ccard-&gt;nchannels
op_plus
l_int|1
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.ref
op_eq
id|ack-&gt;Reference
)paren
op_logical_and
(paren
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.Req
op_eq
id|ASSIGN
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.ReqCh
)paren
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.D3Id
op_assign
id|ack-&gt;RcId
suffix:semicolon
r_else
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.B2Id
op_assign
id|ack-&gt;RcId
suffix:semicolon
id|ccard-&gt;IdTable
(braket
id|ack-&gt;RcId
)braket
op_assign
op_amp
id|ccard-&gt;bch
(braket
id|j
)braket
suffix:semicolon
id|chan
op_assign
op_amp
id|ccard-&gt;bch
(braket
id|j
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;idi_ack: Ch%d: Id %x assigned (%s)&bslash;n&quot;
comma
id|j
comma
id|ack-&gt;RcId
comma
(paren
id|ccard-&gt;bch
(braket
id|j
)braket
dot
id|e.ReqCh
)paren
ques
c_cond
l_string|&quot;Net&quot;
suffix:colon
l_string|&quot;Sig&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
OG
id|ccard-&gt;nchannels
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|24
comma
l_string|&quot;idi_ack: Ch??: ref %d not found for Id %d&bslash;n&quot;
comma
id|ack-&gt;Reference
comma
id|ack-&gt;RcId
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OUT_OF_RESOURCES
suffix:colon
r_case
id|UNKNOWN_COMMAND
suffix:colon
r_case
id|WRONG_COMMAND
suffix:colon
r_case
id|WRONG_ID
suffix:colon
r_case
id|ADAPTER_DEAD
suffix:colon
r_case
id|WRONG_CH
suffix:colon
r_case
id|UNKNOWN_IE
suffix:colon
r_case
id|WRONG_IE
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|chan
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_ack: Ch%d: Not OK !! on chan without Id&bslash;n&quot;
comma
id|dCh
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_switch
c_cond
(paren
id|chan-&gt;e.Req
)paren
(brace
r_case
l_int|12
suffix:colon
multiline_comment|/* Alert */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|2
comma
l_string|&quot;eicon_err: Ch%d: Alert Not OK : Rc=%d Id=%x Ch=%d&bslash;n&quot;
comma
id|dCh
comma
id|ack-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|dCh
op_ne
id|ccard-&gt;nchannels
)paren
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_err: Ch%d: Ack Not OK !!: Rc=%d Id=%x Ch=%d Req=%d&bslash;n&quot;
comma
id|dCh
comma
id|ack-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|chan-&gt;e.Req
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dCh
op_eq
id|ccard-&gt;nchannels
)paren
(brace
multiline_comment|/* Management */
id|chan-&gt;fsm_state
op_assign
l_int|2
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|8
comma
l_string|&quot;eicon_err: Ch%d: Ack Not OK !!: Rc=%d Id=%x Ch=%d Req=%d&bslash;n&quot;
comma
id|dCh
comma
id|ack-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|chan-&gt;e.Req
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dCh
op_ge
l_int|0
)paren
(brace
multiline_comment|/* any other channel */
multiline_comment|/* card reports error: we hangup */
id|idi_hangup
c_func
(paren
id|ccard
comma
id|chan
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|ccard-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|cmd.arg
op_assign
id|chan-&gt;No
suffix:semicolon
id|ccard-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan
)paren
(brace
id|chan-&gt;e.ref
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;e.busy
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
r_int
DECL|function|idi_send_data
id|idi_send_data
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_chan
op_star
id|chan
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|que
comma
r_int
id|chk
)paren
(brace
r_struct
id|sk_buff
op_star
id|xmit_skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
r_int
id|len
comma
id|plen
op_assign
l_int|0
comma
id|offset
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|card
)paren
op_logical_or
(paren
op_logical_neg
id|chan
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch??: null card/chan in send_data&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_ACTIVE
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_snd: Ch%d: send bytes on state %d !&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|EICON_MAX_QUEUE
)paren
multiline_comment|/* too much for the shared memory */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chk
)paren
op_logical_and
(paren
id|chan-&gt;pqueued
OG
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;idi_snd: Ch%d: %d bytes (Pqueue=%d)&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|len
comma
id|chan-&gt;pqueued
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|offset
OL
id|len
)paren
(brace
id|plen
op_assign
(paren
(paren
id|len
op_minus
id|offset
)paren
OG
l_int|270
)paren
ques
c_cond
l_int|270
suffix:colon
id|len
op_minus
id|offset
suffix:semicolon
id|xmit_skb
op_assign
id|alloc_skb
c_func
(paren
id|plen
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|xmit_skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: Ch%d: alloc_skb failed in send_data()&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xmit_skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|xmit_skb
comma
id|plen
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_minus
id|offset
)paren
OG
l_int|270
)paren
(brace
id|reqbuf-&gt;Req
op_assign
id|N_MDATA
suffix:semicolon
)brace
r_else
(brace
id|reqbuf-&gt;Req
op_assign
id|N_DATA
suffix:semicolon
multiline_comment|/* if (ack) reqbuf-&gt;Req |= N_D_BIT; */
)brace
id|reqbuf-&gt;ReqCh
op_assign
id|chan-&gt;e.IndCh
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|reqbuf-&gt;XBuffer.P
comma
id|skb-&gt;data
op_plus
id|offset
comma
id|plen
)paren
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|plen
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Net Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|xmit_skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|offset
op_add_assign
id|plen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|que
)paren
(brace
id|chan-&gt;queued
op_add_assign
id|len
suffix:semicolon
id|chan-&gt;pqueued
op_increment
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_int
DECL|function|eicon_idi_manage_assign
id|eicon_idi_manage_assign
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
id|chan
op_assign
op_amp
(paren
id|card-&gt;bch
(braket
id|card-&gt;nchannels
)braket
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: alloc_skb failed in manage_assign()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|ASSIGN
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
id|MAN_ID
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Man Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|eicon_idi_manage_remove
id|eicon_idi_manage_remove
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
id|chan
op_assign
op_amp
(paren
id|card-&gt;bch
(braket
id|card-&gt;nchannels
)braket
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: alloc_skb failed in manage_remove()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
id|REMOVE
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Man Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|eicon_idi_manage
id|eicon_idi_manage
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|eicon_manifbuf
op_star
id|mb
)paren
(brace
r_int
id|l
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
id|chan
op_assign
op_amp
(paren
id|card-&gt;bch
(braket
id|card-&gt;nchannels
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan-&gt;e.D3Id
)paren
)paren
(brace
id|chan-&gt;e.D3Id
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.X
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
id|chan-&gt;e.busy
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|eicon_idi_manage_assign
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|chan-&gt;e.D3Id
op_assign
l_int|0
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|timeout
op_assign
id|jiffies
op_plus
l_int|50
suffix:semicolon
r_while
c_loop
(paren
id|timeout
OG
id|jiffies
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;e.B2Id
)paren
r_break
suffix:semicolon
id|SLEEP
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.B2Id
)paren
(brace
id|chan-&gt;e.D3Id
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|chan-&gt;fsm_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|manbuf
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_manifbuf
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err: alloc_manifbuf failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|manbuf
comma
id|mb
comma
r_sizeof
(paren
id|eicon_manifbuf
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|manbuf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_chan_ptr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb
)paren
op_logical_or
(paren
op_logical_neg
id|skb2
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_err_manif: alloc_skb failed in manage()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|manbuf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb_put
c_func
(paren
id|skb2
comma
r_sizeof
(paren
id|eicon_chan_ptr
)paren
)paren
suffix:semicolon
id|chan2-&gt;ptr
op_assign
id|chan
suffix:semicolon
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|270
op_plus
r_sizeof
(paren
id|eicon_REQ
)paren
)paren
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|ESC
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|6
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|manbuf-&gt;length
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
id|manbuf-&gt;data
(braket
id|i
)braket
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
l_int|1
)braket
op_assign
id|manbuf-&gt;length
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.P
(braket
id|l
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;Req
op_assign
(paren
id|manbuf-&gt;count
)paren
ques
c_cond
id|manbuf-&gt;count
suffix:colon
id|MAN_READ
suffix:semicolon
id|reqbuf-&gt;ReqCh
op_assign
l_int|0
suffix:semicolon
id|reqbuf-&gt;ReqId
op_assign
l_int|1
suffix:semicolon
id|reqbuf-&gt;XBuffer.length
op_assign
id|l
suffix:semicolon
id|reqbuf-&gt;Reference
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Man Entity */
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.X
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|manbuf-&gt;count
op_assign
l_int|0
suffix:semicolon
id|manbuf-&gt;pos
op_assign
l_int|0
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|card
)paren
suffix:semicolon
id|timeout
op_assign
id|jiffies
op_plus
l_int|50
suffix:semicolon
r_while
c_loop
(paren
id|timeout
OG
id|jiffies
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
)paren
r_break
suffix:semicolon
id|SLEEP
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|chan-&gt;fsm_state
)paren
op_logical_or
(paren
id|chan-&gt;fsm_state
op_eq
l_int|2
)paren
)paren
(brace
id|kfree
c_func
(paren
id|manbuf
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|mb
comma
id|manbuf
comma
r_sizeof
(paren
id|eicon_manifbuf
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|manbuf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|manbuf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
