multiline_comment|/* $Id: eicon_mod.c,v 1.37 2000/09/02 11:16:47 armin Exp $&n; *&n; * ISDN lowlevel-module for Eicon active cards.&n; * &n; * Copyright 1997      by Fritz Elfert (fritz@isdn4linux.de)&n; * Copyright 1998-2000 by Armin Schindler (mac@melware.de) &n; * Copyright 1999,2000 Cytronics &amp; Melware (info@melware.de)&n; * &n; * Thanks to    Eicon Technology GmbH &amp; Co. oHG for&n; *              documents, informations and hardware.&n; *&n; *&t;&t;Deutsche Mailbox Saar-Lor-Lux GmbH&n; *&t;&t;for sponsoring and testing fax&n; *&t;&t;capabilities with Diva Server cards.&n; *&t;&t;(dor@deutschemailbox.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. &n; *&n; */
DECL|macro|DRIVERNAME
mdefine_line|#define DRIVERNAME &quot;Eicon active ISDN driver&quot;
DECL|macro|DRIVERRELEASE
mdefine_line|#define DRIVERRELEASE &quot;2.0&quot;
DECL|macro|DRIVERPATCH
mdefine_line|#define DRIVERPATCH &quot;.15&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_MCA
macro_line|#include &lt;linux/mca.h&gt;
macro_line|#endif /* CONFIG_MCA */
macro_line|#include &quot;eicon.h&quot;
macro_line|#include &quot;../avmb1/capicmd.h&quot;  /* this should be moved in a common place */
DECL|macro|N_DATA
macro_line|#undef N_DATA
macro_line|#include &quot;adapter.h&quot;
macro_line|#include &quot;uxio.h&quot;
DECL|macro|INCLUDE_INLINE_FUNCS
mdefine_line|#define INCLUDE_INLINE_FUNCS
DECL|variable|cards
r_static
id|eicon_card
op_star
id|cards
op_assign
(paren
id|eicon_card
op_star
)paren
l_int|NULL
suffix:semicolon
multiline_comment|/* glob. var , contains&n;                                                     start of card-list   */
DECL|variable|eicon_revision
r_static
r_char
op_star
id|eicon_revision
op_assign
l_string|&quot;$Revision: 1.37 $&quot;
suffix:semicolon
r_extern
r_char
op_star
id|eicon_pci_revision
suffix:semicolon
r_extern
r_char
op_star
id|eicon_isa_revision
suffix:semicolon
r_extern
r_char
op_star
id|eicon_idi_revision
suffix:semicolon
r_extern
r_int
id|do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|pDivasInode
comma
r_struct
id|file
op_star
id|pDivasFile
comma
r_int
r_int
id|command
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_extern
r_void
id|eicon_pci_init_conf
c_func
(paren
id|eicon_card
op_star
id|card
)paren
suffix:semicolon
r_void
id|mod_inc_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|mod_dec_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_char
op_star
id|file_check
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|MOD_USE_COUNT
mdefine_line|#define MOD_USE_COUNT (GET_USE_COUNT (&amp;__this_module))
macro_line|#endif
DECL|macro|EICON_CTRL_VERSION
mdefine_line|#define EICON_CTRL_VERSION 2 
DECL|variable|DebugVar
id|ulong
id|DebugVar
suffix:semicolon
DECL|variable|eicon_lock
id|spinlock_t
id|eicon_lock
suffix:semicolon
DECL|variable|idi_d
id|DESCRIPTOR
id|idi_d
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* Parameters to be set by insmod */
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
DECL|variable|membase
r_static
r_int
id|membase
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
DECL|variable|id
r_static
r_char
op_star
id|id
op_assign
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver for Eicon active ISDN cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Armin Schindler&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;ISDN subsystem&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID-String of first card&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
id|MODULE_PARM_DESC
c_func
(paren
id|membase
comma
l_string|&quot;Base address of first ISA card&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;IRQ of first card&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|membase
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|eicon_ctype_name
r_char
op_star
id|eicon_ctype_name
(braket
)braket
op_assign
(brace
l_string|&quot;ISDN-S&quot;
comma
l_string|&quot;ISDN-SX&quot;
comma
l_string|&quot;ISDN-SCOM&quot;
comma
l_string|&quot;ISDN-QUADRO&quot;
comma
l_string|&quot;ISDN-S2M&quot;
comma
l_string|&quot;DIVA Server BRI/PCI&quot;
comma
l_string|&quot;DIVA Server 4BRI/PCI&quot;
comma
l_string|&quot;DIVA Server 4BRI/PCI&quot;
comma
l_string|&quot;DIVA Server PRI/PCI&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
DECL|function|eicon_getrev
id|eicon_getrev
c_func
(paren
r_const
r_char
op_star
id|revision
)paren
(brace
r_char
op_star
id|rev
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|rev
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
op_decrement
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|rev
op_assign
l_string|&quot;?.??&quot;
suffix:semicolon
r_return
id|rev
suffix:semicolon
)brace
r_static
id|eicon_chan
op_star
DECL|function|find_channel
id|find_channel
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
(paren
id|channel
op_ge
l_int|0
)paren
op_logical_and
(paren
id|channel
OL
id|card-&gt;nchannels
)paren
)paren
r_return
op_amp
(paren
id|card-&gt;bch
(braket
id|channel
)braket
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Invalid channel %d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
multiline_comment|/*&n; * Find pcicard with given card number &n; */
r_static
r_inline
id|eicon_card
op_star
DECL|function|eicon_findnpcicard
id|eicon_findnpcicard
c_func
(paren
r_int
id|driverid
)paren
(brace
id|eicon_card
op_star
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;regname
(braket
id|strlen
c_func
(paren
id|p-&gt;regname
)paren
op_minus
l_int|1
)braket
op_eq
(paren
id|driverid
op_plus
l_char|&squot;0&squot;
)paren
)paren
op_logical_and
(paren
id|p-&gt;bus
op_eq
id|EICON_BUS_PCI
)paren
)paren
r_return
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_return
(paren
id|eicon_card
op_star
)paren
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif /* CONFIG_PCI */
r_static
r_void
DECL|function|eicon_rcv_dispatch
id|eicon_rcv_dispatch
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_rcv_dispatch
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_ack_dispatch: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|eicon_ack_dispatch
id|eicon_ack_dispatch
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_ack_dispatch
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_ack_dispatch: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|eicon_transmit
id|eicon_transmit
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_transmit
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_transmit: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|eicon_command
id|eicon_command
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|ulong
id|a
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_cdef
id|cdef
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|dia_start_t
id|dstart
suffix:semicolon
r_int
id|idi_length
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|16
comma
l_string|&quot;eicon_cmd 0x%x with arg 0x%lx (0x%lx)&bslash;n&quot;
comma
id|c-&gt;command
comma
id|c-&gt;arg
comma
(paren
id|ulong
)paren
op_star
id|c-&gt;parm.num
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_CMD_IOCTL
suffix:colon
id|memcpy
c_func
(paren
op_amp
id|a
comma
id|c-&gt;parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;arg
)paren
(brace
r_case
id|EICON_IOCTL_GETVER
suffix:colon
r_return
id|EICON_CTRL_VERSION
suffix:semicolon
r_case
id|EICON_IOCTL_GETTYPE
suffix:colon
r_if
c_cond
(paren
id|card-&gt;bus
op_eq
id|EICON_BUS_PCI
)paren
(brace
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|a
comma
op_amp
id|card-&gt;hwif.pci.master
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
r_return
id|card-&gt;type
suffix:semicolon
r_case
id|EICON_IOCTL_GETMMIO
suffix:colon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_return
(paren
r_int
)paren
id|card-&gt;hwif.isa.shmem
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_IOCTL_SETMMIO
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_LOADED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_if
c_cond
(paren
id|eicon_isa_find_card
c_func
(paren
id|a
comma
id|card-&gt;hwif.isa.irq
comma
id|card-&gt;regname
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|a
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EICON_BUS_MCA
suffix:colon
macro_line|#if CONFIG_MCA
r_if
c_cond
(paren
id|eicon_mca_find_card
c_func
(paren
l_int|0
comma
id|a
comma
id|card-&gt;hwif.isa.irq
comma
id|card-&gt;regname
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|a
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif
r_case
id|EICON_IOCTL_GETIRQ
suffix:colon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_return
id|card-&gt;hwif.isa.irq
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_case
id|EICON_IOCTL_SETIRQ
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_LOADED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|a
OL
l_int|2
)paren
op_logical_or
(paren
id|a
OG
l_int|15
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
id|card-&gt;hwif.isa.irq
op_assign
id|a
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_IOCTL_LOADBOOT
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
id|ret
op_assign
id|eicon_isa_bootload
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.isa
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|isa
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_IOCTL_LOADISA
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
id|ret
op_assign
id|eicon_isa_load
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.isa
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|isa
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hwif.isa.channels
OG
l_int|1
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_ADDCH
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|card-&gt;hwif.isa.channels
op_minus
l_int|1
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
macro_line|#endif
r_case
id|EICON_IOCTL_MANIF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;d
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;d-&gt;features
op_amp
id|DI_MANAGE
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|ret
op_assign
id|eicon_idi_manage
c_func
(paren
id|card
comma
(paren
id|eicon_manifbuf
op_star
)paren
id|a
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|EICON_IOCTL_GETXLOG
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|EICON_IOCTL_ADDCARD
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|cdef
comma
(paren
r_char
op_star
)paren
id|a
comma
r_sizeof
(paren
id|cdef
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|eicon_addcard
c_func
(paren
l_int|0
comma
id|cdef.membase
comma
id|cdef.irq
comma
id|cdef.id
comma
l_int|0
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EICON_IOCTL_DEBUGVAR
suffix:colon
id|DebugVar
op_assign
id|a
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: Debug Value set to %ld&bslash;n&quot;
comma
id|DebugVar
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef MODULE
r_case
id|EICON_IOCTL_FREEIT
suffix:colon
r_while
c_loop
(paren
id|MOD_USE_COUNT
OG
l_int|0
)paren
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_case
id|EICON_IOCTL_LOADPCI
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: Wrong version of load-utility,&bslash;n&quot;
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: re-compile eiconctrl !&bslash;n&quot;
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: Maybe update of utility is necessary !&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
(brace
)brace
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_if
c_cond
(paren
id|c-&gt;arg
OL
id|EICON_IOCTL_DIA_OFFSET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|dstart
comma
(paren
r_char
op_star
)paren
id|a
comma
r_sizeof
(paren
id|dstart
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
id|eicon_findnpcicard
c_func
(paren
id|dstart.card_id
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|do_ioctl
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
id|c-&gt;arg
op_minus
id|EICON_IOCTL_DIA_OFFSET
comma
(paren
r_int
r_int
)paren
id|a
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|c-&gt;arg
op_minus
id|EICON_IOCTL_DIA_OFFSET
)paren
op_eq
id|DIA_IOCTL_START
)paren
op_logical_and
(paren
op_logical_neg
id|ret
)paren
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;type
op_ne
id|EICON_CTYPE_MAESTRAQ
)paren
(brace
id|DIVA_DIDD_Read
c_func
(paren
id|idi_d
comma
r_sizeof
(paren
id|idi_d
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idi_length
op_assign
l_int|0
suffix:semicolon
id|idi_length
OL
l_int|32
suffix:semicolon
id|idi_length
op_increment
)paren
(brace
r_if
c_cond
(paren
id|idi_d
(braket
id|idi_length
)braket
dot
id|type
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|idi_length
OL
l_int|1
)paren
op_logical_or
(paren
id|idi_length
op_ge
l_int|32
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: invalid idi table length.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|card-&gt;d
op_assign
op_amp
id|idi_d
(braket
id|idi_length
op_minus
l_int|1
)braket
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
id|eicon_pci_init_conf
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d-&gt;channels
OG
l_int|1
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_ADDCH
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|card-&gt;d-&gt;channels
op_minus
l_int|1
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: %s started, %d channels (feat. 0x%x)&bslash;n&quot;
comma
(paren
id|card-&gt;type
op_eq
id|EICON_CTYPE_MAESTRA
)paren
ques
c_cond
l_string|&quot;BRI&quot;
suffix:colon
l_string|&quot;PRI&quot;
comma
id|card-&gt;d-&gt;channels
comma
id|card-&gt;d-&gt;features
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
id|DIVA_DIDD_Read
c_func
(paren
id|idi_d
comma
r_sizeof
(paren
id|idi_d
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idi_length
op_assign
l_int|0
suffix:semicolon
id|idi_length
OL
l_int|32
suffix:semicolon
id|idi_length
op_increment
)paren
r_if
c_cond
(paren
id|idi_d
(braket
id|idi_length
)braket
dot
id|type
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idi_length
OL
l_int|1
)paren
op_logical_or
(paren
id|idi_length
op_ge
l_int|32
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: invalid idi table length.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
id|eicon_findnpcicard
c_func
(paren
id|dstart.card_id
op_minus
id|i
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
id|card-&gt;d
op_assign
op_amp
id|idi_d
(braket
id|idi_length
op_minus
(paren
id|i
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|eicon_pci_init_conf
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d-&gt;channels
OG
l_int|1
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_ADDCH
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|card-&gt;d-&gt;channels
op_minus
l_int|1
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Eicon: %d/4BRI started, %d channels (feat. 0x%x)&bslash;n&quot;
comma
l_int|4
op_minus
id|i
comma
id|card-&gt;d-&gt;channels
comma
id|card-&gt;d-&gt;features
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
id|ret
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
macro_line|#endif /* CONFIG_PCI */
)brace
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_NULL
)paren
op_logical_and
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_LISTEN
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;Dial on channel %d with state %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_OCALL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|idi_connect_req
c_func
(paren
id|card
comma
id|chan
comma
id|c-&gt;parm.setup.phone
comma
id|c-&gt;parm.setup.eazmsn
comma
id|c-&gt;parm.setup.si1
comma
id|c-&gt;parm.setup.si2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|cmd.arg
op_and_assign
l_int|0x1f
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALL
)paren
(brace
id|idi_connect_res
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|idi_hangup
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0x3ff
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETL2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l2prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETL2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_return
id|chan-&gt;l2prot
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l3prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l3prot
op_eq
id|ISDN_PROTO_L3_FCLASS2
)paren
(brace
id|chan-&gt;fax
op_assign
id|c-&gt;parm.fax
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;idi_cmd: Ch%d: SETL3 struct fax=0x%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fax
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETL3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_return
id|chan-&gt;l3prot
suffix:semicolon
r_case
id|ISDN_CMD_GETEAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon CMD_GETEAZ not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETSIL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon CMD_SETSIL not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETSIL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon CMD_GETSIL not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_LOCK
suffix:colon
macro_line|#ifdef MODULE
id|mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_UNLOCK
suffix:colon
macro_line|#ifdef MODULE
id|mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_case
id|ISDN_CMD_FAXCMD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
r_break
suffix:semicolon
id|idi_fax_cmd
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_case
id|ISDN_CMD_AUDIO
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|idi_audio_cmd
c_func
(paren
id|card
comma
id|chan
comma
id|c-&gt;arg
op_rshift
l_int|8
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|CAPI_PUT_MESSAGE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;parm.cmsg.Length
OL
l_int|8
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;parm.cmsg.Command
)paren
(brace
r_case
id|CAPI_FACILITY
suffix:colon
r_if
c_cond
(paren
id|c-&gt;parm.cmsg.Subcommand
op_eq
id|CAPI_REQ
)paren
r_return
id|capipmsg
c_func
(paren
id|card
comma
id|chan
comma
op_amp
id|c-&gt;parm.cmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPI_MANUFACTURER
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
id|eicon_card
op_star
DECL|function|eicon_findcard
id|eicon_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
id|eicon_card
op_star
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;myid
op_eq
id|driverid
)paren
r_return
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_return
(paren
id|eicon_card
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Wrapper functions for interface to linklevel&n; */
r_static
r_int
DECL|function|if_command
id|if_command
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|c-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
r_return
(paren
id|eicon_command
c_func
(paren
id|card
comma
id|c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_command %d called with invalid driverId %d!&bslash;n&quot;
comma
id|c-&gt;command
comma
id|c-&gt;driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_writecmd
id|if_writecmd
c_func
(paren
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_readstatus
id|if_readstatus
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
op_assign
l_int|0
suffix:semicolon
id|u_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;statq
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb-&gt;len
op_plus
id|count
)paren
OG
id|len
)paren
id|cnt
op_assign
id|len
op_minus
id|count
suffix:semicolon
r_else
id|cnt
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_to_user
c_func
(paren
id|p
comma
id|skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|p
comma
id|skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
id|count
op_add_assign
id|cnt
suffix:semicolon
id|p
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_eq
id|skb-&gt;len
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;statq_entries
OG
l_int|0
)paren
id|card-&gt;statq_entries
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|skb_pull
c_func
(paren
id|skb
comma
id|cnt
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|card-&gt;statq
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
)brace
id|card-&gt;statq_entries
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_readstatus called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_sendbuf
id|if_sendbuf
c_func
(paren
r_int
id|id
comma
r_int
id|channel
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|channel
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|idi_faxdata_send
c_func
(paren
id|card
comma
id|chan
comma
id|skb
)paren
)paren
OG
l_int|0
)paren
id|ret
op_assign
id|len
suffix:semicolon
)brace
r_else
macro_line|#endif
id|ret
op_assign
id|idi_send_data
c_func
(paren
id|card
comma
id|chan
comma
id|ack
comma
id|skb
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_sendbuf called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* jiftime() copied from HiSax */
DECL|function|jiftime
r_static
r_inline
r_int
id|jiftime
c_func
(paren
r_char
op_star
id|s
comma
r_int
id|mark
)paren
(brace
id|s
op_add_assign
l_int|8
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;.&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|6
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|6
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;:&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
r_return
l_int|8
suffix:semicolon
)brace
r_void
DECL|function|eicon_putstatus
id|eicon_putstatus
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_char
op_star
id|buf
)paren
(brace
id|ulong
id|flags
suffix:semicolon
r_int
id|count
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
id|cards
)paren
)paren
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|count
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: could not alloc skb in putstatus&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;statq
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;statq_entries
op_ge
id|MAX_STATUS_BUFFER
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;statq
)paren
)paren
)paren
(brace
id|count
op_sub_assign
id|skb-&gt;len
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|card-&gt;statq_entries
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_STAVAIL
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|count
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Debug and Log &n; */
r_void
DECL|function|eicon_log
id|eicon_log
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|level
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_char
id|Line
(braket
l_int|160
)braket
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|DebugVar
op_amp
id|level
)paren
op_logical_or
(paren
id|DebugVar
op_amp
l_int|256
)paren
)paren
(brace
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
id|level
)paren
(brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|256
)paren
(brace
multiline_comment|/* log-buffer */
id|p
op_assign
id|Line
suffix:semicolon
id|p
op_add_assign
id|jiftime
c_func
(paren
id|p
comma
id|jiffies
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|32
suffix:semicolon
id|p
op_add_assign
id|vsprintf
c_func
(paren
id|p
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|eicon_putstatus
c_func
(paren
id|card
comma
id|Line
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* printk, syslogd */
id|vsprintf
c_func
(paren
id|Line
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&quot;
comma
id|Line
)paren
suffix:semicolon
)brace
)brace
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Allocate a new card-struct, initialize it&n; * link it into cards-list.&n; */
r_static
r_void
DECL|function|eicon_alloccard
id|eicon_alloccard
c_func
(paren
r_int
id|Type
comma
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
comma
r_int
id|card_id
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|qloop
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_char
id|qid
(braket
l_int|5
)braket
suffix:semicolon
macro_line|#endif
id|eicon_card
op_star
id|card
suffix:semicolon
id|qloop
op_assign
(paren
id|Type
op_eq
id|EICON_CTYPE_QUADRO
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|qloop
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
(paren
id|eicon_card
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_card
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: (%s) Could not allocate card-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_card
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;statq
)paren
suffix:semicolon
id|card-&gt;statq_entries
op_assign
l_int|0
suffix:semicolon
id|card-&gt;snd_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_transmit
suffix:semicolon
id|card-&gt;snd_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;rcv_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_rcv_dispatch
suffix:semicolon
id|card-&gt;rcv_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;ack_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_ack_dispatch
suffix:semicolon
id|card-&gt;ack_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;interface.maxbufsize
op_assign
l_int|4000
suffix:semicolon
id|card-&gt;interface.command
op_assign
id|if_command
suffix:semicolon
id|card-&gt;interface.writebuf_skb
op_assign
id|if_sendbuf
suffix:semicolon
id|card-&gt;interface.writecmd
op_assign
id|if_writecmd
suffix:semicolon
id|card-&gt;interface.readstat
op_assign
id|if_readstatus
suffix:semicolon
id|card-&gt;interface.features
op_assign
id|ISDN_FEATURE_L2_X75I
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L2_TRANS
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
id|ISDN_FEATURE_P_UNKNOWN
suffix:semicolon
id|card-&gt;interface.hl_hdrlen
op_assign
l_int|20
suffix:semicolon
id|card-&gt;ptype
op_assign
id|ISDN_PTYPE_UNKNOWN
suffix:semicolon
id|strncpy
c_func
(paren
id|card-&gt;interface.id
comma
id|id
comma
r_sizeof
(paren
id|card-&gt;interface.id
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|card-&gt;myid
op_assign
op_minus
l_int|1
suffix:semicolon
id|card-&gt;type
op_assign
id|Type
suffix:semicolon
r_switch
c_cond
(paren
id|Type
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
macro_line|#if CONFIG_MCA /* only needed for MCA */
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_if
c_cond
(paren
id|MCA_bus
)paren
(brace
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_MCA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.physmem
op_assign
(paren
r_int
r_int
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon (%s): no MCA bus detected.&bslash;n&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
(paren
id|membase
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_star
id|EICON_ISA_QOFFSET
)paren
suffix:semicolon
id|card-&gt;hwif.isa.physmem
op_assign
(paren
r_int
r_int
)paren
(paren
id|membase
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_star
id|EICON_ISA_QOFFSET
)paren
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;interface.id
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
(braket
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|1
)braket
op_eq
l_char|&squot;a&squot;
)paren
(brace
id|card-&gt;interface.id
(braket
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;a&squot;
op_plus
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|qid
comma
l_string|&quot;_%c&quot;
comma
l_char|&squot;2&squot;
op_plus
id|i
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;interface.id
comma
id|qid
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: Quadro: Driver-Id %s added.&bslash;n&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|eicon_card
op_star
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;hwif.isa.master
)paren
op_logical_and
(paren
id|p-&gt;hwif.isa.irq
op_eq
id|irq
)paren
)paren
(brace
id|p-&gt;qnext
op_assign
id|card
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_alloccard: Quadro Master not found.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|cards-&gt;qnext
op_assign
id|card
suffix:semicolon
)brace
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_case
id|EICON_CTYPE_MAESTRA
suffix:colon
id|card-&gt;bus
op_assign
id|EICON_BUS_PCI
suffix:semicolon
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
op_or
id|ISDN_FEATURE_L2_MODEM
op_or
id|ISDN_FEATURE_L2_FAX
op_or
id|ISDN_FEATURE_L3_TRANSDSP
op_or
id|ISDN_FEATURE_L3_FCLASS2
suffix:semicolon
id|card-&gt;hwif.pci.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.pci.master
op_assign
id|card_id
suffix:semicolon
id|card-&gt;hwif.pci.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.pci.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRAQ
suffix:colon
id|card-&gt;bus
op_assign
id|EICON_BUS_PCI
suffix:semicolon
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
op_or
id|ISDN_FEATURE_L2_MODEM
op_or
id|ISDN_FEATURE_L2_FAX
op_or
id|ISDN_FEATURE_L3_TRANSDSP
op_or
id|ISDN_FEATURE_L3_FCLASS2
suffix:semicolon
id|card-&gt;hwif.pci.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.pci.master
op_assign
id|card_id
suffix:semicolon
id|card-&gt;hwif.pci.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.pci.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRAP
suffix:colon
id|card-&gt;bus
op_assign
id|EICON_BUS_PCI
suffix:semicolon
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
op_or
id|ISDN_FEATURE_L2_MODEM
op_or
id|ISDN_FEATURE_L2_FAX
op_or
id|ISDN_FEATURE_L3_TRANSDSP
op_or
id|ISDN_FEATURE_L3_FCLASS2
suffix:semicolon
id|card-&gt;hwif.pci.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.pci.master
op_assign
id|card_id
suffix:semicolon
id|card-&gt;hwif.pci.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.pci.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|30
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_CTYPE_ISABRI
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.physmem
op_assign
(paren
r_int
r_int
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_ISAPRI
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.physmem
op_assign
(paren
r_int
r_int
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|30
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_alloccard: Invalid type %d&bslash;n&quot;
comma
id|Type
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;bch
op_assign
(paren
id|eicon_chan
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_chan
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: (%s) Could not allocate bch-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_chan
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|statectrl
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l2prot
op_assign
id|ISDN_PROTO_L2_X75I
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l3prot
op_assign
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.D3Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.B2Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.Req
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|No
op_assign
id|j
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|tskb1
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|tskb2
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.X
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.R
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
multiline_comment|/* *** Diva Server *** */
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;dbuf
op_assign
(paren
id|DBUFFER
op_star
)paren
id|kmalloc
c_func
(paren
(paren
r_sizeof
(paren
id|DBUFFER
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: (%s) Could not allocate DBUFFER-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;sbuf
op_assign
(paren
id|BUFFERS
op_star
)paren
id|kmalloc
c_func
(paren
(paren
r_sizeof
(paren
id|BUFFERS
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: (%s) Could not allocate BUFFERS-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;sbufp
op_assign
(paren
r_char
op_star
)paren
id|kmalloc
c_func
(paren
(paren
l_int|270
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: (%s) Could not allocate BUFFERSP-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;sbuf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|DBUFFER
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.RBuffer
op_assign
(paren
id|DBUFFER
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.RBuffer
op_assign
(paren
id|DBUFFER
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.X
op_assign
(paren
id|BUFFERS
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.X
op_assign
(paren
id|BUFFERS
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
)braket
comma
l_int|0
comma
l_int|270
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.X-&gt;P
op_assign
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
op_star
l_int|270
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
l_int|270
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.X-&gt;P
op_assign
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
(paren
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|270
)braket
suffix:semicolon
)brace
multiline_comment|/* *** */
macro_line|#endif /* CONFIG_ISDN_DRV_EICON_PCI */
id|card-&gt;next
op_assign
id|cards
suffix:semicolon
id|cards
op_assign
id|card
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * register card at linklevel&n; */
r_static
r_int
DECL|function|eicon_registercard
id|eicon_registercard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_BUS_ISA
suffix:colon
multiline_comment|/* TODO something to print */
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_MCA
r_case
id|EICON_BUS_MCA
suffix:colon
id|eicon_isa_printpar
c_func
(paren
op_amp
id|card-&gt;hwif.isa
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
macro_line|#endif
r_case
id|EICON_BUS_PCI
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon_registercard: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|register_isdn
c_func
(paren
op_amp
id|card-&gt;interface
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_registercard: Unable to register %s&bslash;n&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;myid
op_assign
id|card-&gt;interface.channels
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;regname
comma
l_string|&quot;%s&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_static
r_void
DECL|function|unregister_card
id|unregister_card
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_UNLOAD
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_BUS_ISA
suffix:colon
macro_line|#ifdef CONFIG_MCA
r_case
id|EICON_BUS_MCA
suffix:colon
macro_line|#endif /* CONFIG_MCA */
id|eicon_isa_release
c_func
(paren
op_amp
id|card-&gt;hwif.isa
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_BUS_PCI
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;eicon: Invalid BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif /* MODULE */
r_static
r_void
DECL|function|eicon_freecard
id|eicon_freecard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|i
)braket
dot
id|e.X
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|i
)braket
dot
id|e.R
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;statq
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|kfree
c_func
(paren
id|card-&gt;sbufp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;sbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_int
DECL|function|eicon_addcard
id|eicon_addcard
c_func
(paren
r_int
id|Type
comma
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
comma
r_int
id|card_id
)paren
(brace
id|eicon_card
op_star
id|p
suffix:semicolon
id|eicon_card
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_int
id|registered
suffix:semicolon
r_int
id|added
op_assign
l_int|0
suffix:semicolon
r_int
id|failed
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_if
c_cond
(paren
op_logical_neg
id|Type
)paren
multiline_comment|/* ISA */
r_if
c_cond
(paren
(paren
id|Type
op_assign
id|eicon_isa_find_card
c_func
(paren
id|membase
comma
id|irq
comma
id|id
)paren
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
id|eicon_alloccard
c_func
(paren
id|Type
comma
id|membase
comma
id|irq
comma
id|id
comma
id|card_id
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
id|registered
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;interface.statcallb
)paren
(brace
multiline_comment|/* Not yet registered.&n;&t;&t;&t; * Try to register and activate it.&n;&t;&t;&t; */
id|added
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;bus
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_MCA
suffix:colon
r_if
c_cond
(paren
id|eicon_registercard
c_func
(paren
id|p
)paren
)paren
r_break
suffix:semicolon
id|registered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_BUS_PCI
suffix:colon
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_if
c_cond
(paren
id|eicon_registercard
c_func
(paren
id|p
)paren
)paren
r_break
suffix:semicolon
id|registered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: addcard: Invalid BUS type %d&bslash;n&quot;
comma
id|p-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* Card already registered */
id|registered
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|registered
)paren
(brace
multiline_comment|/* Init OK, next card ... */
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* registering failed, remove card from list, free memory */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: Initialization of %s failed&bslash;n&quot;
comma
id|p-&gt;interface.id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
)paren
(brace
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|cards
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
)brace
id|failed
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
id|added
op_minus
id|failed
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|macro|eicon_init
mdefine_line|#define eicon_init init_module
macro_line|#endif
r_int
DECL|function|eicon_init
id|eicon_init
c_func
(paren
r_void
)paren
(brace
r_int
id|card_count
op_assign
l_int|0
suffix:semicolon
r_char
id|tmprev
(braket
l_int|50
)braket
suffix:semicolon
id|DebugVar
op_assign
l_int|1
suffix:semicolon
id|eicon_lock
op_assign
(paren
id|spinlock_t
)paren
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Rev: &quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_pci_revision
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;---/&quot;
)paren
suffix:semicolon
macro_line|#endif
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_isa_revision
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;---/&quot;
)paren
suffix:semicolon
macro_line|#endif
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_idi_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Release: %s%s (%s)&bslash;n&quot;
comma
id|DRIVERNAME
comma
id|DRIVERRELEASE
comma
id|DRIVERPATCH
comma
id|file_check
c_func
(paren
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
macro_line|#ifdef CONFIG_MCA
multiline_comment|/* Check if we have MCA-bus */
r_if
c_cond
(paren
op_logical_neg
id|MCA_bus
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;eicon: No MCA bus, ISDN-interfaces  not probed.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|8
comma
l_string|&quot;eicon_mca_find_card, irq=%d.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eicon_mca_find_card
c_func
(paren
l_int|0
comma
id|membase
comma
id|irq
comma
id|id
)paren
)paren
id|card_count
op_increment
suffix:semicolon
)brace
suffix:semicolon
macro_line|#else
id|card_count
op_assign
id|eicon_addcard
c_func
(paren
l_int|0
comma
id|membase
comma
id|irq
comma
id|id
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
macro_line|#endif /* CONFIG_ISDN_DRV_EICON_ISA */
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|DivasCardsDiscover
c_func
(paren
)paren
suffix:semicolon
id|card_count
op_add_assign
id|eicon_pci_find_card
c_func
(paren
id|id
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|cards
)paren
(brace
macro_line|#ifdef MODULE
macro_line|#ifndef CONFIG_ISDN_DRV_EICON_PCI
macro_line|#ifndef CONFIG_ISDN_DRV_EICON_ISA
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: Driver is neither ISA nor PCI compiled !&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: Driver not loaded !&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: No cards defined, driver not loaded !&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: No PCI-cards found, driver not loaded !&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* MODULE */
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: %d card%s added&bslash;n&quot;
comma
id|card_count
comma
(paren
id|card_count
OG
l_int|1
)paren
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|mod_inc_use_count
r_void
id|mod_inc_use_count
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|mod_dec_use_count
r_void
id|mod_dec_use_count
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_void
id|DIVA_DIDD_Write
c_func
(paren
id|DESCRIPTOR
op_star
comma
r_int
)paren
suffix:semicolon
DECL|variable|DIVA_DIDD_Read
id|EXPORT_SYMBOL_NOVERS
c_func
(paren
id|DIVA_DIDD_Read
)paren
suffix:semicolon
DECL|variable|DIVA_DIDD_Write
id|EXPORT_SYMBOL_NOVERS
c_func
(paren
id|DIVA_DIDD_Write
)paren
suffix:semicolon
DECL|variable|DivasPrintf
id|EXPORT_SYMBOL_NOVERS
c_func
(paren
id|DivasPrintf
)paren
suffix:semicolon
macro_line|#else
DECL|variable|DivasCardNext
r_int
id|DivasCardNext
suffix:semicolon
DECL|variable|DivasCards
id|card_t
id|DivasCards
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#endif
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
macro_line|#if CONFIG_PCI&t;
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|card_t
op_star
id|pCard
suffix:semicolon
id|word
id|wCardIndex
suffix:semicolon
r_extern
r_int
id|Divas_major
suffix:semicolon
r_int
id|iTmp
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|eicon_card
op_star
id|card
op_assign
id|cards
suffix:semicolon
id|eicon_card
op_star
id|last
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
macro_line|#ifdef CONFIG_MCA
r_if
c_cond
(paren
id|MCA_bus
)paren
(brace
id|mca_mark_as_unused
(paren
id|card-&gt;mca_slot
)paren
suffix:semicolon
id|mca_set_adapter_procfn
c_func
(paren
id|card-&gt;mca_slot
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
macro_line|#endif
id|unregister_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
)brace
id|card
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|last
op_assign
id|card
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
macro_line|#if CONFIG_PCI&t;
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
id|pCard
op_assign
id|DivasCards
suffix:semicolon
r_for
c_loop
(paren
id|wCardIndex
op_assign
l_int|0
suffix:semicolon
id|wCardIndex
OL
id|MAX_CARDS
suffix:semicolon
id|wCardIndex
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|pCard-&gt;hw
)paren
op_logical_and
(paren
id|pCard-&gt;hw-&gt;in_use
)paren
)paren
(brace
(paren
op_star
id|pCard-&gt;card_reset
)paren
(paren
id|pCard
)paren
suffix:semicolon
id|UxIsrRemove
c_func
(paren
id|pCard-&gt;hw
comma
id|pCard
)paren
suffix:semicolon
id|UxCardHandleFree
c_func
(paren
id|pCard-&gt;hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCard-&gt;e_tbl
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|pCard-&gt;e_tbl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pCard-&gt;hw-&gt;card_type
op_eq
id|DIA_CARD_TYPE_DIVA_SERVER_B
)paren
(brace
id|release_region
c_func
(paren
id|pCard-&gt;hw-&gt;io_base
comma
l_int|0x20
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|pCard-&gt;hw-&gt;reset_base
comma
l_int|0x80
)paren
suffix:semicolon
)brace
singleline_comment|// If this is a 4BRI ...
r_if
c_cond
(paren
id|pCard-&gt;hw-&gt;card_type
op_eq
id|DIA_CARD_TYPE_DIVA_SERVER_Q
)paren
(brace
singleline_comment|// Skip over the next 3 virtual adapters
id|wCardIndex
op_add_assign
l_int|3
suffix:semicolon
singleline_comment|// But free their handles
r_for
c_loop
(paren
id|iTmp
op_assign
l_int|0
suffix:semicolon
id|iTmp
OL
l_int|3
suffix:semicolon
id|iTmp
op_increment
)paren
(brace
id|pCard
op_increment
suffix:semicolon
id|UxCardHandleFree
c_func
(paren
id|pCard-&gt;hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCard-&gt;e_tbl
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|pCard-&gt;e_tbl
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|pCard
op_increment
suffix:semicolon
)brace
id|unregister_chrdev
c_func
(paren
id|Divas_major
comma
l_string|&quot;Divas&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* CONFIG_PCI */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s unloaded&bslash;n&quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
)brace
macro_line|#else /* no module */
r_static
r_int
id|__init
DECL|function|eicon_setup
id|eicon_setup
c_func
(paren
r_char
op_star
id|line
)paren
(brace
r_int
id|i
comma
id|argc
suffix:semicolon
r_int
id|ints
(braket
l_int|5
)braket
suffix:semicolon
r_char
op_star
id|str
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|line
comma
l_int|4
comma
id|ints
)paren
suffix:semicolon
id|argc
op_assign
id|ints
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_if
c_cond
(paren
id|argc
)paren
(brace
id|membase
op_assign
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
id|membase
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argc
)paren
(brace
id|irq
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|str
)paren
)paren
(brace
id|strcpy
c_func
(paren
id|id
comma
id|str
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|id
comma
l_string|&quot;eicon&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon ISDN active driver setup (id=%s membase=0x%x irq=%d)&bslash;n&quot;
comma
id|id
comma
id|membase
comma
id|irq
)paren
suffix:semicolon
)brace
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon ISDN active driver setup&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;eicon=&quot;
comma
id|eicon_setup
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
macro_line|#ifdef CONFIG_MCA
DECL|struct|eicon_mca_adapters_struct
r_struct
id|eicon_mca_adapters_struct
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|adf_id
r_int
id|adf_id
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* possible MCA-brands of eicon cards                                         */
DECL|variable|eicon_mca_adapters
r_struct
id|eicon_mca_adapters_struct
id|eicon_mca_adapters
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;ISDN-P/2 Adapter&quot;
comma
l_int|0x6abb
)brace
comma
(brace
l_string|&quot;ISDN-[S|SX|SCOM]/2 Adapter&quot;
comma
l_int|0x6a93
)brace
comma
(brace
l_string|&quot;DIVA /MCA&quot;
comma
l_int|0x6336
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|function|eicon_mca_find_card
r_int
id|eicon_mca_find_card
c_func
(paren
r_int
id|type
comma
multiline_comment|/* type-idx of eicon-card          */
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
)paren
multiline_comment|/* name of eicon-isdn-dev          */
(brace
r_int
id|j
comma
id|curr_slot
op_assign
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|8
comma
l_string|&quot;eicon_mca_find_card type: %d, membase: %#x, irq %d &bslash;n&quot;
comma
id|type
comma
id|membase
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/* find a no-driver-assigned eicon card                               */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|eicon_mca_adapters
(braket
id|j
)braket
dot
id|adf_id
op_ne
l_int|0
suffix:semicolon
id|j
op_increment
)paren
(brace
r_for
c_loop
(paren
id|curr_slot
op_assign
l_int|0
suffix:semicolon
id|curr_slot
op_le
id|MCA_MAX_SLOT_NR
suffix:semicolon
id|curr_slot
op_increment
)paren
(brace
id|curr_slot
op_assign
id|mca_find_unused_adapter
c_func
(paren
id|eicon_mca_adapters
(braket
id|j
)braket
dot
id|adf_id
comma
id|curr_slot
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_slot
op_ne
id|MCA_NOTFOUND
)paren
(brace
multiline_comment|/* check if pre-set parameters match&n;&t;&t;&t;&t;   these of the card, check cards memory      */
r_if
c_cond
(paren
op_logical_neg
(paren
r_int
)paren
id|eicon_mca_probe
c_func
(paren
id|curr_slot
comma
id|j
comma
id|membase
comma
id|irq
comma
id|id
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* means: adapter parms did match     */
)brace
suffix:semicolon
)brace
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* MCA_NOTFOUND-branch: no matching adapter of&n;&t;&t;&t;   THIS flavor found, next flavor                     */
)brace
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* all adapter flavors checked without match, finito with:            */
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&n; *  stolen from 3c523.c/elmc_getinfo, ewe, 10.5.1999 &n; */
DECL|function|eicon_info
r_int
id|eicon_info
c_func
(paren
r_char
op_star
id|buf
comma
r_int
id|slot
comma
r_void
op_star
id|d
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|eicon_card
op_star
id|dev
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|eicon_card
op_star
)paren
id|d
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
id|len
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;eicon ISDN adapter, type %d.&bslash;n&quot;
comma
id|dev-&gt;type
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;IRQ: %d&bslash;n&quot;
comma
id|dev-&gt;hwif.isa.irq
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;MEMBASE: %#lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|dev-&gt;hwif.isa.shmem
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
suffix:semicolon
DECL|function|eicon_mca_probe
r_int
id|eicon_mca_probe
c_func
(paren
r_int
id|slot
comma
multiline_comment|/* slot-nr where the card was detected         */
r_int
id|a_idx
comma
multiline_comment|/* idx-nr of probed card in eicon_mca_adapters */
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
)paren
multiline_comment|/* name of eicon-isdn-dev                      */
(brace
r_int
r_char
id|adf_pos0
suffix:semicolon
r_int
id|cards_irq
comma
id|cards_membase
comma
id|cards_io
suffix:semicolon
r_int
id|type
op_assign
id|EICON_CTYPE_S
suffix:semicolon
r_int
id|irq_array
(braket
)braket
op_assign
initialization_block
suffix:semicolon
r_int
id|irq_array1
(braket
)braket
op_assign
initialization_block
suffix:semicolon
id|adf_pos0
op_assign
id|mca_read_stored_pos
c_func
(paren
id|slot
comma
l_int|2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|8
comma
l_string|&quot;eicon_mca_probe irq=%d, membase=%d&bslash;n&quot;
comma
id|irq
comma
id|membase
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|a_idx
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* P/2-Adapter (== PRI/S2M ? )         */
id|cards_membase
op_assign
l_int|0xC0000
op_plus
(paren
(paren
id|adf_pos0
op_rshift
l_int|4
)paren
op_star
l_int|0x4000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
(brace
id|membase
op_assign
id|cards_membase
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|membase
op_ne
id|cards_membase
)paren
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
id|cards_irq
op_assign
id|irq_array
(braket
(paren
(paren
id|adf_pos0
op_amp
l_int|0xC
)paren
op_rshift
l_int|2
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|irq
op_assign
id|cards_irq
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|irq
op_ne
id|cards_irq
)paren
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
id|cards_io
op_assign
l_int|0xC00
op_plus
(paren
(paren
id|adf_pos0
op_rshift
l_int|4
)paren
op_star
l_int|0x10
)paren
suffix:semicolon
id|type
op_assign
id|EICON_CTYPE_ISAPRI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* [S|SX|SCOM]/2                       */
id|cards_membase
op_assign
l_int|0xC0000
op_plus
(paren
(paren
id|adf_pos0
op_rshift
l_int|4
)paren
op_star
l_int|0x2000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
(brace
id|membase
op_assign
id|cards_membase
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|membase
op_ne
id|cards_membase
)paren
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
id|cards_irq
op_assign
id|irq_array
(braket
(paren
(paren
id|adf_pos0
op_amp
l_int|0xC
)paren
op_rshift
l_int|2
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|irq
op_assign
id|cards_irq
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|irq
op_ne
id|cards_irq
)paren
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
id|cards_io
op_assign
l_int|0xC00
op_plus
(paren
(paren
id|adf_pos0
op_rshift
l_int|4
)paren
op_star
l_int|0x10
)paren
suffix:semicolon
id|type
op_assign
id|EICON_CTYPE_SCOM
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* DIVA/MCA                            */
id|cards_io
op_assign
l_int|0x200
op_plus
(paren
(paren
id|adf_pos0
op_rshift
l_int|4
)paren
op_star
l_int|0x20
)paren
suffix:semicolon
id|cards_irq
op_assign
id|irq_array1
(braket
(paren
id|adf_pos0
op_amp
l_int|0x7
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|irq
op_assign
id|cards_irq
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|irq
op_ne
id|cards_irq
)paren
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
id|type
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* matching membase &amp; irq */
r_if
c_cond
(paren
l_int|1
op_eq
id|eicon_addcard
c_func
(paren
id|type
comma
id|membase
comma
id|irq
comma
id|id
comma
l_int|0
)paren
)paren
(brace
id|mca_set_adapter_name
c_func
(paren
id|slot
comma
id|eicon_mca_adapters
(braket
id|a_idx
)braket
dot
id|name
)paren
suffix:semicolon
id|mca_set_adapter_procfn
c_func
(paren
id|slot
comma
(paren
id|MCA_ProcFn
)paren
id|eicon_info
comma
id|cards
)paren
suffix:semicolon
id|mca_mark_as_used
c_func
(paren
id|slot
)paren
suffix:semicolon
id|cards-&gt;mca_slot
op_assign
id|slot
suffix:semicolon
multiline_comment|/* card-&gt;io noch setzen  oder ?? */
id|cards-&gt;mca_io
op_assign
id|cards_io
suffix:semicolon
id|cards-&gt;hwif.isa.io
op_assign
id|cards_io
suffix:semicolon
multiline_comment|/* reset card */
id|outb_p
c_func
(paren
l_int|0
comma
id|cards_io
op_plus
l_int|1
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
l_int|NULL
comma
l_int|8
comma
l_string|&quot;eicon_addcard: successful for slot # %d.&bslash;n&quot;
comma
id|cards-&gt;mca_slot
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* eicon_addcard added a card */
)brace
r_else
(brace
r_return
id|ENODEV
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
macro_line|#endif /* CONFIG_ISDN_DRV_EICON_ISA */
eof
