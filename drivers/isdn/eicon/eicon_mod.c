multiline_comment|/* $Id: eicon_mod.c,v 1.5 1999/04/01 12:48:35 armin Exp $&n; *&n; * ISDN lowlevel-module for Eicon.Diehl active cards.&n; * &n; * Copyright 1997    by Fritz Elfert (fritz@wuemaus.franken.de)&n; * Copyright 1998,99 by Armin Schindler (mac@melware.de) &n; * Copyright 1999    Cytronics &amp; Melware (info@melware.de)&n; * &n; * Thanks to    Eicon Technology Diehl GmbH &amp; Co. oHG for&n; *              documents, informations and hardware.&n; *&n; *              Deutsche Telekom AG for S2M support.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. &n; *&n; * $Log: eicon_mod.c,v $&n; * Revision 1.5  1999/04/01 12:48:35  armin&n; * Changed some log outputs.&n; *&n; * Revision 1.4  1999/03/29 11:19:47  armin&n; * I/O stuff now in seperate file (eicon_io.c)&n; * Old ISA type cards (S,SX,SCOM,Quadro,S2M) implemented.&n; *&n; * Revision 1.3  1999/03/02 12:37:47  armin&n; * Added some important checks.&n; * Analog Modem with DSP.&n; * Channels will be added to Link-Level after loading firmware.&n; *&n; * Revision 1.2  1999/01/24 20:14:21  armin&n; * Changed and added debug stuff.&n; * Better data sending. (still problems with tty&squot;s flip buffer)&n; *&n; * Revision 1.1  1999/01/01 18:09:44  armin&n; * First checkin of new eicon driver.&n; * DIVA-Server BRI/PCI and PRI/PCI are supported.&n; * Old diehl code is obsolete.&n; *&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;eicon.h&quot;
DECL|macro|INCLUDE_INLINE_FUNCS
mdefine_line|#define INCLUDE_INLINE_FUNCS
DECL|variable|cards
r_static
id|eicon_card
op_star
id|cards
op_assign
(paren
id|eicon_card
op_star
)paren
l_int|NULL
suffix:semicolon
DECL|variable|eicon_revision
r_static
r_char
op_star
id|eicon_revision
op_assign
l_string|&quot;$Revision: 1.5 $&quot;
suffix:semicolon
r_extern
r_char
op_star
id|eicon_pci_revision
suffix:semicolon
r_extern
r_char
op_star
id|eicon_isa_revision
suffix:semicolon
r_extern
r_char
op_star
id|eicon_idi_revision
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|MOD_USE_COUNT
mdefine_line|#define MOD_USE_COUNT (GET_USE_COUNT (&amp;__this_module))
macro_line|#endif
DECL|macro|EICON_CTRL_VERSION
mdefine_line|#define EICON_CTRL_VERSION 1
DECL|variable|DebugVar
id|ulong
id|DebugVar
suffix:semicolon
multiline_comment|/* Parameters to be set by insmod */
DECL|variable|membase
r_static
r_int
id|membase
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|id
r_static
r_char
op_star
id|id
op_assign
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver for Eicon.Diehl active ISDN cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Armin Schindler&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;ISDN subsystem&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|membase
comma
l_string|&quot;Base address of first ISA card&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;IRQ of first card&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID-String of first card&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|membase
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
DECL|variable|eicon_ctype_name
r_char
op_star
id|eicon_ctype_name
(braket
)braket
op_assign
(brace
l_string|&quot;ISDN-S&quot;
comma
l_string|&quot;ISDN-SX&quot;
comma
l_string|&quot;ISDN-SCOM&quot;
comma
l_string|&quot;ISDN-QUADRO&quot;
comma
l_string|&quot;ISDN-S2M&quot;
comma
l_string|&quot;DIVA Server BRI/PCI&quot;
comma
l_string|&quot;DIVA Server 4BRI/PCI&quot;
comma
l_string|&quot;DIVA Server 4BRI/PCI&quot;
comma
l_string|&quot;DIVA Server PRI/PCI&quot;
)brace
suffix:semicolon
r_static
r_int
DECL|function|getrel
id|getrel
c_func
(paren
r_char
op_star
id|p
)paren
(brace
r_int
id|v
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|tmp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|strchr
c_func
(paren
id|p
comma
l_char|&squot;.&squot;
)paren
)paren
)paren
id|p
op_assign
id|tmp
op_plus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|p
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
id|p
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
(brace
id|v
op_assign
(paren
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
id|v
op_star
l_int|10
)paren
)paren
op_plus
(paren
r_int
)paren
(paren
id|p
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
r_return
id|v
suffix:semicolon
)brace
r_static
r_char
op_star
DECL|function|eicon_getrev
id|eicon_getrev
c_func
(paren
r_const
r_char
op_star
id|revision
)paren
(brace
r_char
op_star
id|rev
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|rev
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
op_decrement
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|rev
op_assign
l_string|&quot;?.??&quot;
suffix:semicolon
r_return
id|rev
suffix:semicolon
)brace
r_static
id|eicon_chan
op_star
DECL|function|find_channel
id|find_channel
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
(paren
id|channel
op_ge
l_int|0
)paren
op_logical_and
(paren
id|channel
OL
id|card-&gt;nchannels
)paren
)paren
r_return
op_amp
(paren
id|card-&gt;bch
(braket
id|channel
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Invalid channel %d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Free MSN list&n; */
r_static
r_void
DECL|function|eicon_clear_msn
id|eicon_clear_msn
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_struct
id|msn_entry
op_star
id|p
op_assign
id|card-&gt;msn_list
suffix:semicolon
r_struct
id|msn_entry
op_star
id|q
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;msn_list
op_assign
l_int|NULL
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
id|q
op_assign
id|p-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|q
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Find an MSN entry in the list.&n; * If ia5 != 0, return IA5-encoded EAZ, else&n; * return a bitmask with corresponding bit set.&n; */
r_static
id|__u16
DECL|function|eicon_find_msn
id|eicon_find_msn
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_char
op_star
id|msn
comma
r_int
id|ia5
)paren
(brace
r_struct
id|msn_entry
op_star
id|p
op_assign
id|card-&gt;msn_list
suffix:semicolon
id|__u8
id|eaz
op_assign
l_char|&squot;0&squot;
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;msn
comma
id|msn
)paren
)paren
(brace
id|eaz
op_assign
id|p-&gt;eaz
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ia5
)paren
r_return
(paren
l_int|1
op_lshift
(paren
id|eaz
op_minus
l_char|&squot;0&squot;
)paren
)paren
suffix:semicolon
r_else
r_return
id|eaz
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an EAZ entry in the list.&n; * return a string with corresponding msn.&n; */
r_char
op_star
DECL|function|eicon_find_eaz
id|eicon_find_eaz
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_char
id|eaz
)paren
(brace
r_struct
id|msn_entry
op_star
id|p
op_assign
id|card-&gt;msn_list
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;eaz
op_eq
id|eaz
)paren
r_return
id|p-&gt;msn
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_return
l_string|&quot;&bslash;0&quot;
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/*&n; * Add or delete an MSN to the MSN list&n; *&n; * First character of msneaz is EAZ, rest is MSN.&n; * If length of eazmsn is 1, delete that entry.&n; */
r_static
r_int
id|eicon_set_msn
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_char
op_star
id|eazmsn
)paren
(brace
r_struct
id|msn_entry
op_star
id|p
op_assign
id|card-&gt;msn_list
suffix:semicolon
r_struct
id|msn_entry
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|eazmsn
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|eazmsn
)paren
OG
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|eazmsn
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
id|eazmsn
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|eazmsn
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Delete a single MSN */
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;eaz
op_eq
id|eazmsn
(braket
l_int|0
)braket
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
)paren
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
r_else
id|card-&gt;msn_list
op_assign
id|p-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|8
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Mapping for EAZ %c deleted&bslash;n&quot;
comma
id|eazmsn
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Add a single MSN */
r_while
c_loop
(paren
id|p
)paren
(brace
multiline_comment|/* Found in list, replace MSN */
r_if
c_cond
(paren
id|p-&gt;eaz
op_eq
id|eazmsn
(braket
l_int|0
)braket
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|p-&gt;msn
comma
op_amp
id|eazmsn
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|8
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Mapping for EAZ %c changed to %s&bslash;n&quot;
comma
id|eazmsn
(braket
l_int|0
)braket
comma
op_amp
id|eazmsn
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
multiline_comment|/* Not found in list, add new entry */
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|msn_entry
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;eaz
op_assign
id|eazmsn
(braket
l_int|0
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|p-&gt;msn
comma
op_amp
id|eazmsn
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|p-&gt;next
op_assign
id|card-&gt;msn_list
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;msn_list
op_assign
id|p
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|8
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Mapping %c -&gt; %s added&bslash;n&quot;
comma
id|eazmsn
(braket
l_int|0
)braket
comma
op_amp
id|eazmsn
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|eicon_rcv_dispatch
id|eicon_rcv_dispatch
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_rcv_dispatch
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_ack_dispatch: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|eicon_ack_dispatch
id|eicon_ack_dispatch
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_ack_dispatch
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_ack_dispatch: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|eicon_transmit
id|eicon_transmit
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_case
id|EICON_BUS_PCI
suffix:colon
id|eicon_io_transmit
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_transmit: Illegal bustype %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|eicon_command
id|eicon_command
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|ulong
id|a
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_cdef
id|cdef
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_char
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_CMD_IOCTL
suffix:colon
id|memcpy
c_func
(paren
op_amp
id|a
comma
id|c-&gt;parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;arg
)paren
(brace
r_case
id|EICON_IOCTL_GETVER
suffix:colon
r_return
id|EICON_CTRL_VERSION
suffix:semicolon
r_case
id|EICON_IOCTL_GETTYPE
suffix:colon
r_return
id|card-&gt;type
suffix:semicolon
r_case
id|EICON_IOCTL_GETMMIO
suffix:colon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_return
(paren
r_int
)paren
id|card-&gt;hwif.isa.shmem
suffix:semicolon
macro_line|#if CONFIG_PCI
r_case
id|EICON_BUS_PCI
suffix:colon
r_return
id|card-&gt;hwif.pci.PCIram
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_case
id|EICON_IOCTL_SETMMIO
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_LOADED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_if
c_cond
(paren
id|eicon_isa_find_card
c_func
(paren
id|a
comma
id|card-&gt;hwif.isa.irq
comma
id|card-&gt;regname
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|a
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_case
id|EICON_IOCTL_GETIRQ
suffix:colon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_return
id|card-&gt;hwif.isa.irq
suffix:semicolon
macro_line|#if CONFIG_PCI
r_case
id|EICON_BUS_PCI
suffix:colon
r_return
id|card-&gt;hwif.pci.irq
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_case
id|EICON_IOCTL_SETIRQ
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_LOADED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|a
OL
l_int|2
)paren
op_logical_or
(paren
id|a
OG
l_int|15
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
id|card-&gt;hwif.isa.irq
op_assign
id|a
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_case
id|EICON_IOCTL_LOADBOOT
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
id|ret
op_assign
id|eicon_isa_bootload
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.isa
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|isa
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
r_case
id|EICON_IOCTL_LOADISA
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
id|ret
op_assign
id|eicon_isa_load
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.isa
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|isa
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hwif.isa.channels
OG
l_int|1
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_ADDCH
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|card-&gt;hwif.isa.channels
op_minus
l_int|1
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
r_case
id|EICON_IOCTL_MANIF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;Feature
op_amp
id|PROTCAP_MANIF
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|ret
op_assign
id|eicon_idi_manage
c_func
(paren
id|card
comma
(paren
id|eicon_manifbuf
op_star
)paren
id|a
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
macro_line|#if CONFIG_PCI 
r_case
id|EICON_IOCTL_LOADPCI
suffix:colon
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;bus
op_eq
id|EICON_BUS_PCI
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;type
)paren
(brace
r_case
id|EICON_CTYPE_MAESTRA
suffix:colon
id|ret
op_assign
id|eicon_pci_load_bri
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.pci
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|pci
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRAP
suffix:colon
id|ret
op_assign
id|eicon_pci_load_pri
c_func
(paren
op_amp
(paren
id|card-&gt;hwif.pci
)paren
comma
op_amp
(paren
(paren
(paren
id|eicon_codebuf
op_star
)paren
id|a
)paren
op_member_access_from_pointer
id|pci
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hwif.pci.channels
OG
l_int|1
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_ADDCH
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|card-&gt;hwif.pci.channels
op_minus
l_int|1
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#endif
macro_line|#if 0
r_case
id|EICON_IOCTL_SETMSN
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|tmp
comma
(paren
r_char
op_star
)paren
id|a
comma
r_sizeof
(paren
id|tmp
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|eicon_set_msn
c_func
(paren
id|card
comma
id|tmp
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
id|eicon_capi_manufacturer_req_msn
c_func
(paren
id|card
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_case
id|EICON_IOCTL_ADDCARD
suffix:colon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|cdef
comma
(paren
r_char
op_star
)paren
id|a
comma
r_sizeof
(paren
id|cdef
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|eicon_addcard
c_func
(paren
l_int|0
comma
id|cdef.membase
comma
id|cdef.irq
comma
id|cdef.id
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EICON_IOCTL_DEBUGVAR
suffix:colon
id|DebugVar
op_assign
id|a
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Eicon: Debug Value set to %ld&bslash;n&quot;
comma
id|DebugVar
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef MODULE
r_case
id|EICON_IOCTL_FREEIT
suffix:colon
r_while
c_loop
(paren
id|MOD_USE_COUNT
OG
l_int|0
)paren
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_NULL
)paren
op_logical_and
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_LISTEN
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Dial on channel %d with state %d&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;ptype
op_eq
id|ISDN_PTYPE_EURO
)paren
id|tmp
(braket
l_int|0
)braket
op_assign
id|eicon_find_msn
c_func
(paren
id|card
comma
id|c-&gt;parm.setup.eazmsn
comma
l_int|1
)paren
suffix:semicolon
r_else
id|tmp
(braket
l_int|0
)braket
op_assign
id|c-&gt;parm.setup.eazmsn
(braket
l_int|0
)braket
suffix:semicolon
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_OCALL
suffix:semicolon
id|chan-&gt;callref
op_assign
l_int|0xffff
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|idi_connect_req
c_func
(paren
id|card
comma
id|chan
comma
id|c-&gt;parm.setup.phone
comma
id|c-&gt;parm.setup.eazmsn
comma
id|c-&gt;parm.setup.si1
comma
id|c-&gt;parm.setup.si2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|cmd.arg
op_and_assign
l_int|0x1f
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALL
)paren
(brace
id|idi_connect_res
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|idi_hangup
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|c-&gt;parm.num
)paren
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;ptype
op_eq
id|ISDN_PTYPE_EURO
)paren
(brace
id|chan-&gt;eazmask
op_assign
id|eicon_find_msn
c_func
(paren
id|card
comma
id|c-&gt;parm.num
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;ptype
op_eq
id|ISDN_PTYPE_1TR6
)paren
(brace
r_int
id|i
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|c-&gt;parm.num
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|c-&gt;parm.num
(braket
id|i
)braket
)paren
)paren
id|chan-&gt;eazmask
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|c-&gt;parm.num
(braket
id|i
)braket
op_minus
l_char|&squot;0&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
id|chan-&gt;eazmask
op_assign
l_int|0x3ff
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETL2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l2prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETL2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_return
id|chan-&gt;l2prot
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
op_ne
id|ISDN_PROTO_L3_TRANS
)paren
(brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;L3 protocol unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l3prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETL3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_return
id|chan-&gt;l3prot
suffix:semicolon
r_case
id|ISDN_CMD_GETEAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;eicon CMD_GETEAZ not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETSIL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;eicon CMD_SETSIL not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_GETSIL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;eicon CMD_GETSIL not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_LOCK
suffix:colon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_UNLOCK
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
id|eicon_card
op_star
DECL|function|eicon_findcard
id|eicon_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
id|eicon_card
op_star
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;myid
op_eq
id|driverid
)paren
r_return
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_return
(paren
id|eicon_card
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Wrapper functions for interface to linklevel&n; */
r_static
r_int
DECL|function|if_command
id|if_command
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|c-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
r_return
(paren
id|eicon_command
c_func
(paren
id|card
comma
id|c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_command %d called with invalid driverId %d!&bslash;n&quot;
comma
id|c-&gt;command
comma
id|c-&gt;driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_writecmd
id|if_writecmd
c_func
(paren
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_writecmd called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_readstatus
id|if_readstatus
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
macro_line|#if 0
multiline_comment|/* Not yet used */
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
(paren
id|eicon_readstatus
c_func
(paren
id|buf
comma
id|len
comma
id|user
comma
id|card
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_readstatus called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_sendbuf
id|if_sendbuf
c_func
(paren
r_int
id|id
comma
r_int
id|channel
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|channel
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
r_return
(paren
id|idi_send_data
c_func
(paren
id|card
comma
id|chan
comma
id|ack
comma
id|skb
)paren
)paren
suffix:semicolon
r_else
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eicon: if_sendbuf called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate a new card-struct, initialize it&n; * link it into cards-list.&n; */
r_static
r_void
DECL|function|eicon_alloccard
id|eicon_alloccard
c_func
(paren
r_int
id|Type
comma
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|qloop
suffix:semicolon
r_char
id|qid
(braket
l_int|5
)braket
suffix:semicolon
id|eicon_card
op_star
id|card
suffix:semicolon
macro_line|#if CONFIG_PCI
id|eicon_pci_card
op_star
id|pcic
suffix:semicolon
macro_line|#endif
id|qloop
op_assign
(paren
id|Type
op_eq
id|EICON_CTYPE_QUADRO
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|qloop
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
(paren
id|eicon_card
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_card
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: (%s) Could not allocate card-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_card
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
suffix:semicolon
id|card-&gt;snd_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_transmit
suffix:semicolon
id|card-&gt;snd_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;rcv_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_rcv_dispatch
suffix:semicolon
id|card-&gt;rcv_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;ack_tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|eicon_ack_dispatch
suffix:semicolon
id|card-&gt;ack_tq.data
op_assign
id|card
suffix:semicolon
id|card-&gt;interface.maxbufsize
op_assign
l_int|4000
suffix:semicolon
id|card-&gt;interface.command
op_assign
id|if_command
suffix:semicolon
id|card-&gt;interface.writebuf_skb
op_assign
id|if_sendbuf
suffix:semicolon
id|card-&gt;interface.writecmd
op_assign
id|if_writecmd
suffix:semicolon
id|card-&gt;interface.readstat
op_assign
id|if_readstatus
suffix:semicolon
id|card-&gt;interface.features
op_assign
id|ISDN_FEATURE_L2_X75I
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L2_TRANS
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
id|ISDN_FEATURE_P_UNKNOWN
suffix:semicolon
id|card-&gt;interface.hl_hdrlen
op_assign
l_int|20
suffix:semicolon
id|card-&gt;ptype
op_assign
id|ISDN_PTYPE_UNKNOWN
suffix:semicolon
id|strncpy
c_func
(paren
id|card-&gt;interface.id
comma
id|id
comma
r_sizeof
(paren
id|card-&gt;interface.id
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|card-&gt;myid
op_assign
op_minus
l_int|1
suffix:semicolon
id|card-&gt;type
op_assign
id|Type
suffix:semicolon
r_switch
c_cond
(paren
id|Type
)paren
(brace
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
(paren
id|membase
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_star
id|EICON_ISA_QOFFSET
)paren
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;interface.id
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
(braket
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|1
)braket
op_eq
l_char|&squot;a&squot;
)paren
(brace
id|card-&gt;interface.id
(braket
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;a&squot;
op_plus
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|qid
comma
l_string|&quot;_%c&quot;
comma
l_char|&squot;2&squot;
op_plus
id|i
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;interface.id
comma
id|qid
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: Quadro: Driver-Id %s added.&bslash;n&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|eicon_card
op_star
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;hwif.isa.master
)paren
op_logical_and
(paren
id|p-&gt;hwif.isa.irq
op_eq
id|irq
)paren
)paren
(brace
id|p-&gt;qnext
op_assign
id|card
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_alloccard: Quadro Master not found.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|cards-&gt;qnext
op_assign
id|card
suffix:semicolon
)brace
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if CONFIG_PCI
r_case
id|EICON_CTYPE_MAESTRA
suffix:colon
(paren
id|eicon_pci_card
op_star
)paren
id|pcic
op_assign
(paren
id|eicon_pci_card
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_PCI
suffix:semicolon
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
op_or
id|ISDN_FEATURE_L2_MODEM
suffix:semicolon
id|card-&gt;hwif.pci.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.pci.PCIreg
op_assign
id|pcic-&gt;PCIreg
suffix:semicolon
id|card-&gt;hwif.pci.PCIcfg
op_assign
id|pcic-&gt;PCIcfg
suffix:semicolon
id|card-&gt;hwif.pci.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.pci.mvalid
op_assign
id|pcic-&gt;mvalid
suffix:semicolon
id|card-&gt;hwif.pci.ivalid
op_assign
l_int|0
suffix:semicolon
id|card-&gt;hwif.pci.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.pci.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRAP
suffix:colon
(paren
id|eicon_pci_card
op_star
)paren
id|pcic
op_assign
(paren
id|eicon_pci_card
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_PCI
suffix:semicolon
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
op_or
id|ISDN_FEATURE_L2_MODEM
suffix:semicolon
id|card-&gt;hwif.pci.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.pci.shmem
op_assign
(paren
id|eicon_pci_shmem
op_star
)paren
id|pcic-&gt;shmem
suffix:semicolon
id|card-&gt;hwif.pci.PCIreg
op_assign
id|pcic-&gt;PCIreg
suffix:semicolon
id|card-&gt;hwif.pci.PCIram
op_assign
id|pcic-&gt;PCIram
suffix:semicolon
id|card-&gt;hwif.pci.PCIcfg
op_assign
id|pcic-&gt;PCIcfg
suffix:semicolon
id|card-&gt;hwif.pci.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.pci.mvalid
op_assign
id|pcic-&gt;mvalid
suffix:semicolon
id|card-&gt;hwif.pci.ivalid
op_assign
l_int|0
suffix:semicolon
id|card-&gt;hwif.pci.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.pci.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|30
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_CTYPE_ISABRI
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|2
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_ISAPRI
suffix:colon
r_if
c_cond
(paren
id|membase
op_eq
op_minus
l_int|1
)paren
id|membase
op_assign
id|EICON_ISA_MEMBASE
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
id|irq
op_assign
id|EICON_ISA_IRQ
suffix:semicolon
id|card-&gt;bus
op_assign
id|EICON_BUS_ISA
suffix:semicolon
id|card-&gt;hwif.isa.card
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|card-&gt;hwif.isa.shmem
op_assign
(paren
id|eicon_isa_shmem
op_star
)paren
id|membase
suffix:semicolon
id|card-&gt;hwif.isa.master
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hwif.isa.irq
op_assign
id|irq
suffix:semicolon
id|card-&gt;hwif.isa.type
op_assign
id|Type
suffix:semicolon
id|card-&gt;nchannels
op_assign
l_int|30
suffix:semicolon
id|card-&gt;interface.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_alloccard: Invalid type %d&bslash;n&quot;
comma
id|Type
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;bch
op_assign
(paren
id|eicon_chan
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_chan
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: (%s) Could not allocate bch-struct.&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_chan
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|plci
op_assign
l_int|0x8000
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|ncci
op_assign
l_int|0x8000
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l2prot
op_assign
id|ISDN_PROTO_L2_X75I
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l3prot
op_assign
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.D3Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.B2Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.Req
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|No
op_assign
id|j
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.X
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.R
)paren
suffix:semicolon
)brace
id|card-&gt;next
op_assign
id|cards
suffix:semicolon
id|cards
op_assign
id|card
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * register card at linklevel&n; */
r_static
r_int
DECL|function|eicon_registercard
id|eicon_registercard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
multiline_comment|/* TODO something to print */
r_break
suffix:semicolon
r_case
id|EICON_BUS_PCI
suffix:colon
macro_line|#if CONFIG_PCI
id|eicon_pci_printpar
c_func
(paren
op_amp
id|card-&gt;hwif.pci
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_registercard: Illegal BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|register_isdn
c_func
(paren
op_amp
id|card-&gt;interface
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon_registercard: Unable to register %s&bslash;n&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;myid
op_assign
id|card-&gt;interface.channels
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;regname
comma
l_string|&quot;%s&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_static
r_void
DECL|function|unregister_card
id|unregister_card
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_UNLOAD
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
id|eicon_isa_release
c_func
(paren
op_amp
id|card-&gt;hwif.isa
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_BUS_PCI
suffix:colon
macro_line|#if CONFIG_PCI
id|eicon_pci_release
c_func
(paren
op_amp
id|card-&gt;hwif.pci
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Invalid BUS type %d&bslash;n&quot;
comma
id|card-&gt;bus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif /* MODULE */
r_static
r_void
DECL|function|eicon_freecard
id|eicon_freecard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
id|eicon_clear_msn
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_int
DECL|function|eicon_addcard
id|eicon_addcard
c_func
(paren
r_int
id|Type
comma
r_int
id|membase
comma
r_int
id|irq
comma
r_char
op_star
id|id
)paren
(brace
id|eicon_card
op_star
id|p
suffix:semicolon
id|eicon_card
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_int
id|registered
suffix:semicolon
r_int
id|added
op_assign
l_int|0
suffix:semicolon
r_int
id|failed
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Type
)paren
multiline_comment|/* ISA */
r_if
c_cond
(paren
(paren
id|Type
op_assign
id|eicon_isa_find_card
c_func
(paren
id|membase
comma
id|irq
comma
id|id
)paren
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|eicon_alloccard
c_func
(paren
id|Type
comma
id|membase
comma
id|irq
comma
id|id
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
id|registered
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;interface.statcallb
)paren
(brace
multiline_comment|/* Not yet registered.&n;&t;&t;&t; * Try to register and activate it.&n;&t;&t;&t; */
id|added
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;bus
)paren
(brace
r_case
id|EICON_BUS_ISA
suffix:colon
r_if
c_cond
(paren
id|eicon_registercard
c_func
(paren
id|p
)paren
)paren
r_break
suffix:semicolon
id|registered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_BUS_PCI
suffix:colon
macro_line|#if CONFIG_PCI
r_if
c_cond
(paren
id|eicon_registercard
c_func
(paren
id|p
)paren
)paren
r_break
suffix:semicolon
id|registered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|EICON_BUS_MCA
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: addcard: Invalid BUS type %d&bslash;n&quot;
comma
id|p-&gt;bus
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* Card already registered */
id|registered
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|registered
)paren
(brace
multiline_comment|/* Init OK, next card ... */
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* registering failed, remove card from list, free memory */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;eicon: Initialization of %s failed&bslash;n&quot;
comma
id|p-&gt;interface.id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
)paren
(brace
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|cards
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
)brace
id|failed
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
id|added
op_minus
id|failed
)paren
suffix:semicolon
)brace
DECL|macro|DRIVERNAME
mdefine_line|#define DRIVERNAME &quot;Eicon active ISDN driver&quot;
DECL|macro|DRIVERRELEASE
mdefine_line|#define DRIVERRELEASE &quot;1&quot;
macro_line|#ifdef MODULE
DECL|macro|eicon_init
mdefine_line|#define eicon_init init_module
macro_line|#endif
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|eicon_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|release
op_assign
l_int|0
suffix:semicolon
r_char
id|tmprev
(braket
l_int|50
)braket
suffix:semicolon
id|DebugVar
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Rev: &quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|release
op_add_assign
id|getrel
c_func
(paren
id|tmprev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_pci_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|release
op_add_assign
id|getrel
c_func
(paren
id|tmprev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_isa_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|release
op_add_assign
id|getrel
c_func
(paren
id|tmprev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_idi_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|release
op_add_assign
id|getrel
c_func
(paren
id|tmprev
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmprev
comma
l_string|&quot;%d&quot;
comma
id|release
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Release: %s.%s&bslash;n&quot;
comma
id|DRIVERNAME
comma
id|DRIVERRELEASE
comma
id|tmprev
)paren
suffix:semicolon
id|tmp
op_assign
id|eicon_addcard
c_func
(paren
l_int|0
comma
id|membase
comma
id|irq
comma
id|id
)paren
suffix:semicolon
macro_line|#if CONFIG_PCI
id|tmp
op_add_assign
id|eicon_pci_find_card
c_func
(paren
id|id
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|cards
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: No cards defined, driver not loaded !&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Eicon: %d card%s added&bslash;n&quot;
comma
id|tmp
comma
(paren
id|tmp
OG
l_int|1
)paren
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
multiline_comment|/* No symbols to export, hide all symbols */
id|EXPORT_NO_SYMBOLS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|cards
suffix:semicolon
id|eicon_card
op_star
id|last
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|unregister_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
)brace
id|card
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|last
op_assign
id|card
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s unloaded&bslash;n&quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|eicon_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
)paren
(brace
r_int
id|i
comma
id|argc
suffix:semicolon
id|argc
op_assign
id|ints
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
id|membase
op_assign
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
id|membase
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argc
)paren
(brace
id|irq
op_assign
id|ints
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|str
)paren
)paren
(brace
id|strcpy
c_func
(paren
id|id
comma
id|str
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|id
comma
l_string|&quot;eicon&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* eicon_addcard(0, membase, irq, id); */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;eicon: membase=0x%x irq=%d id=%s&bslash;n&quot;
comma
id|membase
comma
id|irq
comma
id|id
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
eof
