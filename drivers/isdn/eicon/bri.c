multiline_comment|/*&n; *&n; * Copyright (C) Eicon Technology Corporation, 2000.&n; *&n; * This source file is supplied for the exclusive use with Eicon&n; * Technology Corporation&squot;s range of DIVA Server Adapters.&n; *&n; * Eicon File Revision :    1.8  &n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY OF ANY KIND WHATSOEVER INCLUDING ANY &n; * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  &n; * See the GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; */
macro_line|#include &lt;sys/types.h&gt;
macro_line|#include &quot;sys.h&quot;
macro_line|#include &quot;idi.h&quot;
macro_line|#include &quot;divas.h&quot;
macro_line|#include &quot;pc.h&quot;
macro_line|#include &quot;pr_pc.h&quot;
macro_line|#include &quot;dsp_defs.h&quot;
macro_line|#include &quot;adapter.h&quot;
macro_line|#include &quot;uxio.h&quot;
DECL|macro|PCI_COMMAND
mdefine_line|#define PCI_COMMAND&t;0x04
DECL|macro|PCI_STATUS
mdefine_line|#define PCI_STATUS&t;0x06
DECL|macro|PCI_LATENCY
mdefine_line|#define PCI_LATENCY&t;0x0D
DECL|macro|PCI_BADDR0
mdefine_line|#define PCI_BADDR0&t;0x10
DECL|macro|PCI_BADDR1
mdefine_line|#define PCI_BADDR1&t;0x14
DECL|macro|PCI_BADDR2
mdefine_line|#define PCI_BADDR2&t;0x18
DECL|macro|DIVAS_SIGNATURE
mdefine_line|#define DIVAS_SIGNATURE 0x4447
multiline_comment|/* offset to start of MAINT area (used by xlog) */
DECL|macro|DIVAS_MAINT_OFFSET
mdefine_line|#define&t;DIVAS_MAINT_OFFSET&t;0xff00&t;&t;/* value for BRI card */
DECL|macro|PROTCAP_TELINDUS
mdefine_line|#define PROTCAP_TELINDUS&t;0x1
DECL|macro|PROTCAP_V90D
mdefine_line|#define PROTCAP_V90D&t;&t;0x8
id|word
id|GetProtFeatureValue
c_func
(paren
r_char
op_star
id|sw_id
)paren
suffix:semicolon
id|byte
id|io_in
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
)paren
suffix:semicolon
id|word
id|io_inw
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
)paren
suffix:semicolon
r_void
id|io_in_buffer
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
comma
r_void
op_star
id|P
comma
id|word
id|length
)paren
suffix:semicolon
r_void
id|io_look_ahead
c_func
(paren
id|ADAPTER
op_star
id|a
comma
id|PBUFFER
op_star
id|RBuffer
comma
id|ENTITY
op_star
id|e
)paren
suffix:semicolon
r_void
id|io_out
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
comma
id|byte
id|data
)paren
suffix:semicolon
r_void
id|io_outw
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
comma
id|word
id|data
)paren
suffix:semicolon
r_void
id|io_out_buffer
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
comma
r_void
op_star
id|P
comma
id|word
id|length
)paren
suffix:semicolon
r_void
id|io_inc
c_func
(paren
id|ADAPTER
op_star
id|a
comma
r_void
op_star
id|adr
)paren
suffix:semicolon
r_static
r_int
id|diva_server_bri_test_int
c_func
(paren
id|card_t
op_star
id|card
)paren
suffix:semicolon
DECL|macro|PLX_IOBASE
mdefine_line|#define PLX_IOBASE&t;&t;0
DECL|macro|DIVAS_IOBASE
mdefine_line|#define&t;DIVAS_IOBASE&t;1
DECL|macro|REG_DATA
mdefine_line|#define&t;REG_DATA&t;&t;0x00
DECL|macro|REG_ADDRLO
mdefine_line|#define&t;REG_ADDRLO&t;&t;0x04
DECL|macro|REG_ADDRHI
mdefine_line|#define REG_ADDRHI&t;&t;0x0C
DECL|macro|REG_IOCTRL
mdefine_line|#define REG_IOCTRL&t;&t;0x10
DECL|macro|M_PCI_RESET
mdefine_line|#define M_PCI_RESET&t;0x10
id|byte
id|UxCardPortIoIn
c_func
(paren
id|ux_diva_card_t
op_star
id|card
comma
id|byte
op_star
id|base
comma
r_int
id|offset
)paren
suffix:semicolon
id|word
id|UxCardPortIoInW
c_func
(paren
id|ux_diva_card_t
op_star
id|card
comma
id|byte
op_star
id|base
comma
r_int
id|offset
)paren
suffix:semicolon
r_void
id|UxCardPortIoOut
c_func
(paren
id|ux_diva_card_t
op_star
id|card
comma
id|byte
op_star
id|base
comma
r_int
id|offset
comma
id|byte
)paren
suffix:semicolon
r_void
id|UxCardPortIoOutW
c_func
(paren
id|ux_diva_card_t
op_star
id|card
comma
id|byte
op_star
id|base
comma
r_int
id|offset
comma
id|word
)paren
suffix:semicolon
r_int
id|DivasBRIInitPCI
c_func
(paren
id|card_t
op_star
id|card
comma
id|dia_card_t
op_star
id|cfg
)paren
suffix:semicolon
r_int
id|bri_ISR
(paren
id|card_t
op_star
id|card
)paren
suffix:semicolon
r_static
DECL|function|diva_server_bri_reset
r_int
id|diva_server_bri_reset
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
id|byte
op_star
id|DivasIOBase
suffix:semicolon
id|word
id|i
suffix:semicolon
id|dword
id|dwWait
suffix:semicolon
id|UxCardLog
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: resetting BRI adapter&quot;
)paren
)paren
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_IOCTRL
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|50000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|0x0000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x8000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|dwWait
op_assign
l_int|0
suffix:semicolon
id|dwWait
OL
l_int|0x00FFFFFF
suffix:semicolon
id|dwWait
op_increment
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|diva_server_bri_reset_int
r_void
id|diva_server_bri_reset_int
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
id|byte
op_star
id|DivasIOBase
op_assign
l_int|NULL
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_IOCTRL
comma
l_int|0x08
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
DECL|function|diva_server_bri_start
r_int
id|diva_server_bri_start
c_func
(paren
id|card_t
op_star
id|card
comma
id|byte
op_star
id|channels
)paren
(brace
id|byte
op_star
id|DivasIOBase
comma
op_star
id|PLXIOBase
suffix:semicolon
id|word
id|wSig
op_assign
l_int|0
suffix:semicolon
id|word
id|i
suffix:semicolon
id|dword
id|dwSerialNum
suffix:semicolon
id|byte
id|bPLX9060
op_assign
id|FALSE
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: starting Diva Server BRI card&quot;
)paren
)paren
suffix:semicolon
id|card-&gt;is_live
op_assign
id|FALSE
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|0x1E
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_IOCTRL
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* wait for signature to indicate card has started */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|300
suffix:semicolon
id|i
op_increment
)paren
(brace
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|0x1E
)paren
suffix:semicolon
id|wSig
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wSig
op_eq
id|DIVAS_SIGNATURE
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: card started after %d ms&quot;
comma
id|i
op_star
l_int|10
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|UxPause
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wSig
op_ne
id|DIVAS_SIGNATURE
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: card failed to start (Sig=0x%x)&quot;
comma
id|wSig
)paren
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;is_live
op_assign
id|TRUE
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|0x3F6
)paren
suffix:semicolon
op_star
id|channels
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
id|PLXIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|PLX_IOBASE
)paren
suffix:semicolon
id|bPLX9060
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x6C
)paren
op_or
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x6E
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bPLX9060
)paren
(brace
id|dwSerialNum
op_assign
(paren
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x1E
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x22
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: PLX9060 in use. Serial number 0x%04X&quot;
comma
id|dwSerialNum
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|dwSerialNum
op_assign
(paren
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x22
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x26
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: PLX9050 in use. Serial number 0x%04X&quot;
comma
id|dwSerialNum
)paren
)paren
suffix:semicolon
)brace
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
)paren
suffix:semicolon
id|card-&gt;serial_no
op_assign
id|dwSerialNum
suffix:semicolon
id|diva_server_bri_test_int
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|diva_server_bri_load
r_int
id|diva_server_bri_load
c_func
(paren
id|card_t
op_star
id|card
comma
id|dia_load_t
op_star
id|load
)paren
(brace
id|byte
op_star
id|DivasIOBase
suffix:semicolon
id|dword
id|r3000_base
suffix:semicolon
id|dword
id|dwAddr
comma
id|dwLength
comma
id|i
suffix:semicolon
id|word
id|wTest
comma
id|aWord
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: loading Diva Server BRI card&quot;
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|load-&gt;code_type
)paren
(brace
r_case
id|DIA_CPU_CODE
suffix:colon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: loading RISC %s&quot;
comma
op_amp
id|load-&gt;code
(braket
l_int|0x80
)braket
)paren
)paren
suffix:semicolon
id|card-&gt;hw-&gt;features
op_assign
id|GetProtFeatureValue
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|load-&gt;code
(braket
l_int|0x80
)braket
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: features 0x%x&quot;
comma
id|card-&gt;hw-&gt;features
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw-&gt;features
op_eq
l_int|0xFFFF
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: invalid feature string failed load&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|r3000_base
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIA_DSP_CODE
suffix:colon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: DSP code &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|load-&gt;code
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;hw-&gt;features
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|card-&gt;hw-&gt;features
op_amp
id|PROTCAP_TELINDUS
)paren
)paren
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: only Telindus style binaries supported&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;hw-&gt;features
)paren
op_logical_and
(paren
id|card-&gt;hw-&gt;features
op_amp
id|PROTCAP_V90D
)paren
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: V.90 DSP binary&quot;
)paren
)paren
suffix:semicolon
id|r3000_base
op_assign
(paren
l_int|0xBF790000
op_plus
(paren
(paren
(paren
r_sizeof
(paren
id|dword
)paren
op_plus
(paren
r_sizeof
(paren
id|t_dsp_download_desc
)paren
op_star
id|DSP_MAX_DOWNLOAD_COUNT
)paren
)paren
op_plus
l_int|3
)paren
op_amp
l_int|0xFFFFFFFC
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: non-V.90 DSP binary&quot;
)paren
)paren
suffix:semicolon
id|r3000_base
op_assign
(paren
l_int|0xBF7A0000
op_plus
(paren
(paren
(paren
r_sizeof
(paren
id|dword
)paren
op_plus
(paren
r_sizeof
(paren
id|t_dsp_download_desc
)paren
op_star
id|DSP_MAX_DOWNLOAD_COUNT
)paren
)paren
op_plus
l_int|3
)paren
op_amp
l_int|0xFFFFFFFC
)paren
)paren
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: loading at 0x%x&quot;
comma
id|r3000_base
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIA_TABLE_CODE
suffix:colon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: TABLE code&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;hw-&gt;features
)paren
op_logical_and
(paren
id|card-&gt;hw-&gt;features
op_amp
id|PROTCAP_V90D
)paren
)paren
(brace
id|r3000_base
op_assign
l_int|0xBF790000
op_plus
r_sizeof
(paren
id|dword
)paren
suffix:semicolon
)brace
r_else
(brace
id|r3000_base
op_assign
l_int|0xBF7A0000
op_plus
r_sizeof
(paren
id|dword
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|DIA_DLOAD_CNT
suffix:colon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: COUNT code&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;hw-&gt;features
)paren
op_logical_and
(paren
id|card-&gt;hw-&gt;features
op_amp
id|PROTCAP_V90D
)paren
)paren
(brace
id|r3000_base
op_assign
l_int|0xBF790000
suffix:semicolon
)brace
r_else
(brace
id|r3000_base
op_assign
l_int|0xBF7A0000
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: unknown code type %d&quot;
comma
id|load-&gt;code_type
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Writing %d bytes to adapter, address 0x%x&quot;
comma
id|load-&gt;length
comma
id|r3000_base
)paren
)paren
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Attached to 0x%04X&quot;
comma
id|DivasIOBase
)paren
)paren
suffix:semicolon
id|dwLength
op_assign
id|load-&gt;length
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dwLength
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dwAddr
op_assign
id|r3000_base
op_plus
id|i
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
id|dwAddr
op_rshift
l_int|16
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
id|dwAddr
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|load-&gt;code
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Verifying&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dwLength
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dwAddr
op_assign
id|r3000_base
op_plus
id|i
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
id|dwAddr
op_rshift
l_int|16
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
id|dwAddr
)paren
suffix:semicolon
id|wTest
op_assign
id|UxCardPortIoIn
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
)paren
suffix:semicolon
id|aWord
op_assign
id|load-&gt;code
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|wTest
op_ne
id|aWord
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: load verify failed on byte %d&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: RAM 0x%x   File 0x%x&quot;
comma
id|wTest
comma
id|aWord
)paren
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Loaded and verified. Detaching from adapter&quot;
)paren
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
id|UxCardLog
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|diva_server_bri_config
r_int
id|diva_server_bri_config
c_func
(paren
id|card_t
op_star
id|card
comma
id|dia_config_t
op_star
id|config
)paren
(brace
id|byte
op_star
id|DivasIOBase
comma
id|i
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: configuring Diva Server BRI card&quot;
)paren
)paren
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|8
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;tei
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|9
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;nt2
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|10
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|11
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;watchdog
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|12
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;permanent
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|13
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|14
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;stable_l2
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|15
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;no_order_check
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|16
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|17
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|18
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;low_channel
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|19
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;prot_version
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|20
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;crc4
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|21
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;hw-&gt;features
)paren
op_logical_and
(paren
id|card-&gt;hw-&gt;features
op_amp
id|PROTCAP_V90D
)paren
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Signifying V.90&quot;
)paren
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|22
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|22
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|0
)paren
suffix:semicolon
)brace
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|23
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|card-&gt;serial_no
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|24
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
(paren
id|card-&gt;serial_no
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|25
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
(paren
id|card-&gt;serial_no
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|26
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
l_int|21
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|32
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|0
)braket
dot
id|oad
(braket
id|i
)braket
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|64
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|0
)braket
dot
id|osa
(braket
id|i
)braket
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|96
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|0
)braket
dot
id|spid
(braket
id|i
)braket
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|128
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|1
)braket
dot
id|oad
(braket
id|i
)braket
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|160
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|1
)braket
dot
id|osa
(braket
id|i
)braket
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
l_int|192
op_plus
id|i
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
comma
id|config-&gt;terminal
(braket
l_int|1
)braket
dot
id|spid
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DivasBriPatch
r_void
id|DivasBriPatch
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
id|dword
id|PLXIOBase
op_assign
l_int|0
suffix:semicolon
id|dword
id|DivasIOBase
op_assign
l_int|0
suffix:semicolon
id|PLXIOBase
op_assign
id|card-&gt;cfg.reset_base
suffix:semicolon
id|DivasIOBase
op_assign
id|card-&gt;cfg.io_base
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw
op_eq
l_int|NULL
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: BRI PATCH (PLX chip) card-&gt;hw is null&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PLXIOBase
op_eq
l_int|0
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: BRI (PLX chip) cannot be patched. The BRI adapter may&quot;
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas:   not function properly. If you do encounter problems,&quot;
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas:   ensure that your machine is using the latest BIOS.&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: PLX I/O Base 0x%x&quot;
comma
id|PLXIOBase
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: Divas I/O Base 0x%x&quot;
comma
id|DivasIOBase
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PLXIOBase
op_amp
l_int|0x80
)paren
(brace
id|dword
id|dwSize
comma
id|dwSerialNum
comma
id|dwCmd
suffix:semicolon
id|boolean_t
id|bPLX9060
suffix:semicolon
id|word
id|wSerHi
comma
id|wSerLo
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: Patch required&quot;
)paren
)paren
suffix:semicolon
id|dwCmd
op_assign
l_int|0
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_COMMAND
comma
op_amp
id|dwCmd
)paren
suffix:semicolon
id|PLXIOBase
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_BADDR1
comma
op_amp
id|PLXIOBase
)paren
suffix:semicolon
id|dwSize
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_BADDR1
comma
op_amp
id|dwSize
)paren
suffix:semicolon
id|UxPciConfigRead
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_BADDR1
comma
op_amp
id|dwSize
)paren
suffix:semicolon
id|dwSize
op_assign
(paren
op_complement
(paren
id|dwSize
op_amp
op_complement
l_int|7
)paren
)paren
op_plus
l_int|1
suffix:semicolon
id|DivasIOBase
op_assign
id|PLXIOBase
op_plus
id|dwSize
suffix:semicolon
id|card-&gt;cfg.reset_base
op_assign
id|PLXIOBase
suffix:semicolon
id|card-&gt;cfg.io_base
op_assign
id|DivasIOBase
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_BADDR1
comma
op_amp
id|card-&gt;cfg.reset_base
)paren
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_BADDR2
comma
op_amp
id|card-&gt;cfg.io_base
)paren
suffix:semicolon
id|dwCmd
op_assign
l_int|5
suffix:semicolon
id|UxPciConfigWrite
c_func
(paren
id|card-&gt;hw
comma
l_int|4
comma
id|PCI_COMMAND
comma
op_amp
id|dwCmd
)paren
suffix:semicolon
id|bPLX9060
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x6C
)paren
op_or
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x6E
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bPLX9060
)paren
(brace
id|wSerHi
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x1E
)paren
suffix:semicolon
id|wSerLo
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x22
)paren
suffix:semicolon
id|dwSerialNum
op_assign
(paren
id|wSerHi
op_lshift
l_int|16
)paren
op_or
id|wSerLo
suffix:semicolon
id|UxCardLog
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|wSerHi
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x22
)paren
suffix:semicolon
id|wSerLo
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x26
)paren
suffix:semicolon
id|dwSerialNum
op_assign
(paren
id|wSerHi
op_lshift
l_int|16
)paren
op_or
id|wSerLo
suffix:semicolon
id|UxCardLog
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|word
id|wSerHi
comma
id|wSerLo
suffix:semicolon
id|boolean_t
id|bPLX9060
suffix:semicolon
id|dword
id|dwSerialNum
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: No patch required&quot;
)paren
)paren
suffix:semicolon
id|bPLX9060
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x6C
)paren
op_or
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x6E
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bPLX9060
)paren
(brace
id|wSerHi
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x1E
)paren
suffix:semicolon
id|wSerLo
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x22
)paren
suffix:semicolon
id|dwSerialNum
op_assign
(paren
id|wSerHi
op_lshift
l_int|16
)paren
op_or
id|wSerLo
suffix:semicolon
)brace
r_else
(brace
id|wSerHi
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x22
)paren
suffix:semicolon
id|wSerLo
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
(paren
r_void
op_star
)paren
id|card-&gt;cfg.reset_base
comma
l_int|0x26
)paren
suffix:semicolon
id|dwSerialNum
op_assign
(paren
id|wSerHi
op_lshift
l_int|16
)paren
op_or
id|wSerLo
suffix:semicolon
)brace
)brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: After patching:&quot;
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: PLX I/O Base 0x%x&quot;
comma
id|PLXIOBase
)paren
)paren
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;Divas: Divas I/O Base 0x%x&quot;
comma
id|DivasIOBase
)paren
)paren
suffix:semicolon
)brace
DECL|macro|TEST_INT_DIVAS_BRI
mdefine_line|#define TEST_INT_DIVAS_BRI&t;0x12
r_static
DECL|function|diva_server_bri_test_int
r_int
id|diva_server_bri_test_int
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
id|boolean_t
id|bPLX9060
op_assign
id|FALSE
suffix:semicolon
id|byte
op_star
id|PLXIOBase
op_assign
l_int|NULL
comma
op_star
id|DivasIOBase
op_assign
l_int|NULL
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: test interrupt for Diva Server BRI card&quot;
)paren
)paren
suffix:semicolon
id|PLXIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|PLX_IOBASE
)paren
suffix:semicolon
id|bPLX9060
op_assign
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x6C
)paren
op_logical_or
id|UxCardPortIoInW
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x6E
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bPLX9060
)paren
(brace
multiline_comment|/* PLX9060 */
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x69
comma
l_int|0x09
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* PLX9050 */
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
comma
l_int|0x4C
comma
l_int|0x41
)paren
suffix:semicolon
)brace
id|card-&gt;test_int_pend
op_assign
id|TEST_INT_DIVAS_BRI
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|PLXIOBase
)paren
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_IOCTRL
comma
l_int|0x89
)paren
suffix:semicolon
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|diva_server_bri_mem_get
r_int
id|diva_server_bri_mem_get
c_func
(paren
id|card_t
op_star
id|card
comma
id|mem_block_t
op_star
id|mem_block
)paren
(brace
id|dword
id|user_addr
op_assign
id|mem_block-&gt;addr
suffix:semicolon
id|word
id|length
op_assign
l_int|0
suffix:semicolon
id|dword
id|addr
suffix:semicolon
id|word
id|i
suffix:semicolon
id|byte
op_star
id|DivasIOBase
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: Retrieving memory from 0x%x&quot;
comma
id|user_addr
)paren
)paren
suffix:semicolon
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
id|addr
op_assign
id|user_addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|16
op_star
l_int|8
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|addr
op_assign
id|user_addr
op_plus
id|i
suffix:semicolon
id|UxCardPortIoOut
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRHI
comma
id|addr
op_rshift
l_int|16
)paren
suffix:semicolon
id|UxCardPortIoOutW
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_ADDRLO
comma
(paren
id|word
)paren
id|addr
)paren
suffix:semicolon
id|mem_block-&gt;data
(braket
id|i
)braket
op_assign
id|UxCardPortIoIn
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|REG_DATA
)paren
suffix:semicolon
id|length
op_increment
suffix:semicolon
)brace
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
id|length
suffix:semicolon
)brace
DECL|function|DivasBriInit
r_int
id|DivasBriInit
c_func
(paren
id|card_t
op_star
id|card
comma
id|dia_card_t
op_star
id|cfg
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: initialise Diva Server BRI card&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DivasBRIInitPCI
c_func
(paren
id|card
comma
id|cfg
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;card_reset
op_assign
id|diva_server_bri_reset
suffix:semicolon
id|card-&gt;card_start
op_assign
id|diva_server_bri_start
suffix:semicolon
id|card-&gt;card_load
op_assign
id|diva_server_bri_load
suffix:semicolon
id|card-&gt;card_config
op_assign
id|diva_server_bri_config
suffix:semicolon
id|card-&gt;reset_int
op_assign
id|diva_server_bri_reset_int
suffix:semicolon
id|card-&gt;card_mem_get
op_assign
id|diva_server_bri_mem_get
suffix:semicolon
id|card-&gt;xlog_offset
op_assign
id|DIVAS_MAINT_OFFSET
suffix:semicolon
id|card-&gt;out
op_assign
id|DivasOut
suffix:semicolon
id|card-&gt;test_int
op_assign
id|DivasTestInt
suffix:semicolon
id|card-&gt;dpc
op_assign
id|DivasDpc
suffix:semicolon
id|card-&gt;clear_int
op_assign
id|DivasClearInt
suffix:semicolon
id|card-&gt;card_isr
op_assign
id|bri_ISR
suffix:semicolon
id|card-&gt;a.ram_out
op_assign
id|io_out
suffix:semicolon
id|card-&gt;a.ram_outw
op_assign
id|io_outw
suffix:semicolon
id|card-&gt;a.ram_out_buffer
op_assign
id|io_out_buffer
suffix:semicolon
id|card-&gt;a.ram_inc
op_assign
id|io_inc
suffix:semicolon
id|card-&gt;a.ram_in
op_assign
id|io_in
suffix:semicolon
id|card-&gt;a.ram_inw
op_assign
id|io_inw
suffix:semicolon
id|card-&gt;a.ram_in_buffer
op_assign
id|io_in_buffer
suffix:semicolon
id|card-&gt;a.ram_look_ahead
op_assign
id|io_look_ahead
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|GetProtFeatureValue
id|word
id|GetProtFeatureValue
c_func
(paren
r_char
op_star
id|sw_id
)paren
(brace
id|word
id|features
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|sw_id
)paren
op_logical_and
(paren
id|sw_id
(braket
l_int|0
)braket
op_ne
l_char|&squot;[&squot;
)paren
)paren
id|sw_id
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sw_id
op_eq
l_int|NULL
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: no feature string present&quot;
)paren
)paren
suffix:semicolon
id|features
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|byte
id|i
comma
id|shifter
suffix:semicolon
id|sw_id
op_add_assign
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|shifter
op_assign
l_int|12
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
comma
id|shifter
op_sub_assign
l_int|4
)paren
(brace
r_if
c_cond
(paren
(paren
id|sw_id
(braket
id|i
)braket
op_ge
l_char|&squot;0&squot;
)paren
op_logical_and
(paren
id|sw_id
(braket
id|i
)braket
op_le
l_char|&squot;9&squot;
)paren
)paren
(brace
id|features
op_or_assign
(paren
id|sw_id
(braket
id|i
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
id|shifter
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|sw_id
(braket
id|i
)braket
op_ge
l_char|&squot;a&squot;
)paren
op_logical_and
(paren
id|sw_id
(braket
id|i
)braket
op_le
l_char|&squot;f&squot;
)paren
)paren
(brace
id|features
op_or_assign
(paren
id|sw_id
(braket
id|i
)braket
op_minus
l_char|&squot;a&squot;
op_plus
l_int|10
)paren
op_lshift
id|shifter
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|sw_id
(braket
id|i
)braket
op_ge
l_char|&squot;A&squot;
)paren
op_logical_and
(paren
id|sw_id
(braket
id|i
)braket
op_le
l_char|&squot;F&squot;
)paren
)paren
(brace
id|features
op_or_assign
(paren
id|sw_id
(braket
id|i
)braket
op_minus
l_char|&squot;A&squot;
op_plus
l_int|10
)paren
op_lshift
id|shifter
suffix:semicolon
)brace
r_else
(brace
id|DPRINTF
c_func
(paren
(paren
l_string|&quot;divas: invalid feature string&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_return
id|features
suffix:semicolon
)brace
DECL|function|bri_ISR
r_int
id|bri_ISR
(paren
id|card_t
op_star
id|card
)paren
(brace
r_int
id|served
op_assign
l_int|0
suffix:semicolon
id|byte
op_star
id|DivasIOBase
op_assign
id|UxCardMemAttach
c_func
(paren
id|card-&gt;hw
comma
id|DIVAS_IOBASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UxCardPortIoIn
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|M_PCI_RESET
)paren
op_amp
l_int|0x01
)paren
(brace
id|served
op_assign
l_int|1
suffix:semicolon
id|card-&gt;int_pend
op_add_assign
l_int|1
suffix:semicolon
id|DivasDpcSchedule
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* ISR DPC */
id|UxCardPortIoOut
(paren
id|card-&gt;hw
comma
id|DivasIOBase
comma
id|M_PCI_RESET
comma
l_int|0x08
)paren
suffix:semicolon
)brace
id|UxCardMemDetach
c_func
(paren
id|card-&gt;hw
comma
id|DivasIOBase
)paren
suffix:semicolon
r_return
(paren
id|served
op_ne
l_int|0
)paren
suffix:semicolon
)brace
eof
