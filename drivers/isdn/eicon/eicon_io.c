multiline_comment|/* $Id: eicon_io.c,v 1.13 2000/05/07 08:51:04 armin Exp $&n; *&n; * ISDN low-level module for Eicon active ISDN-Cards.&n; * Code for communicating with hardware.&n; *&n; * Copyright 1999,2000  by Armin Schindler (mac@melware.de)&n; * Copyright 1999,2000  Cytronics &amp; Melware (info@melware.de)&n; *&n; * Thanks to&t;Eicon Technology GmbH &amp; Co. oHG for &n; *&t;&t;documents, informations and hardware. &n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. &n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;eicon.h&quot;
macro_line|#include &quot;uxio.h&quot;
r_void
DECL|function|eicon_io_rcv_dispatch
id|eicon_io_rcv_dispatch
c_func
(paren
id|eicon_card
op_star
id|ccard
)paren
(brace
id|ulong
id|flags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|skb2
comma
op_star
id|skb_new
suffix:semicolon
id|eicon_IND
op_star
id|ind
comma
op_star
id|ind2
comma
op_star
id|ind_new
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_err: NULL card in rcv_dispatch !&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ccard-&gt;rcvq
)paren
)paren
)paren
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan
op_assign
id|ccard-&gt;IdTable
(braket
id|ind-&gt;IndId
)braket
)paren
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|ind-&gt;Ind
)paren
(brace
r_case
id|N_DISC_ACK
suffix:colon
multiline_comment|/* doesn&squot;t matter if this happens */
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi: Indication for unknown channel Ind=%d Id=%x&bslash;n&quot;
comma
id|ind-&gt;Ind
comma
id|ind-&gt;IndId
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_hdl: Ch??: Ind=%d Id=%x Ch=%d MInd=%d MLen=%d Len=%d&bslash;n&quot;
comma
id|ind-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|ind-&gt;IndCh
comma
id|ind-&gt;MInd
comma
id|ind-&gt;MLength
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
)brace
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;e.complete
)paren
(brace
multiline_comment|/* check for rec-buffer chaining */
r_if
c_cond
(paren
id|ind-&gt;MLength
op_eq
id|ind-&gt;RBuffer.length
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|1
suffix:semicolon
id|idi_handle_ind
c_func
(paren
id|ccard
comma
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;e.complete
op_assign
l_int|0
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|ind-&gt;MInd
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.R
comma
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.R
)paren
)paren
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|1
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon: buffer incomplete, but 0 in queue&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ind2
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb2-&gt;data
suffix:semicolon
id|skb_new
op_assign
id|alloc_skb
c_func
(paren
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_minus
l_int|1
)paren
op_plus
id|ind-&gt;RBuffer.length
op_plus
id|ind2-&gt;RBuffer.length
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_new
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in rcv_dispatch()&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ind_new
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb_new
comma
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_minus
l_int|1
)paren
op_plus
id|ind-&gt;RBuffer.length
op_plus
id|ind2-&gt;RBuffer.length
)paren
)paren
suffix:semicolon
id|ind_new-&gt;Ind
op_assign
id|ind2-&gt;Ind
suffix:semicolon
id|ind_new-&gt;IndId
op_assign
id|ind2-&gt;IndId
suffix:semicolon
id|ind_new-&gt;IndCh
op_assign
id|ind2-&gt;IndCh
suffix:semicolon
id|ind_new-&gt;MInd
op_assign
id|ind2-&gt;MInd
suffix:semicolon
id|ind_new-&gt;MLength
op_assign
id|ind2-&gt;MLength
suffix:semicolon
id|ind_new-&gt;RBuffer.length
op_assign
id|ind2-&gt;RBuffer.length
op_plus
id|ind-&gt;RBuffer.length
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ind_new-&gt;RBuffer.P
comma
op_amp
id|ind2-&gt;RBuffer.P
comma
id|ind2-&gt;RBuffer.length
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_amp
id|ind_new-&gt;RBuffer.P
)paren
op_plus
id|ind2-&gt;RBuffer.length
comma
op_amp
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ind-&gt;MLength
op_eq
id|ind-&gt;RBuffer.length
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|2
suffix:semicolon
id|idi_handle_ind
c_func
(paren
id|ccard
comma
id|skb_new
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;e.complete
op_assign
l_int|0
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.R
comma
id|skb_new
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
)brace
r_void
DECL|function|eicon_io_ack_dispatch
id|eicon_io_ack_dispatch
c_func
(paren
id|eicon_card
op_star
id|ccard
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_err: NULL card in ack_dispatch!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ccard-&gt;rackq
)paren
)paren
)paren
(brace
id|idi_handle_ack
c_func
(paren
id|ccard
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  IO-Functions for ISA cards&n; */
DECL|function|ram_inb
id|u8
id|ram_inb
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adr
)paren
(brace
id|u32
id|addr
op_assign
(paren
id|u32
)paren
id|adr
suffix:semicolon
r_return
id|readb
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|ram_inw
id|u16
id|ram_inw
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adr
)paren
(brace
id|u32
id|addr
op_assign
(paren
id|u32
)paren
id|adr
suffix:semicolon
r_return
id|readw
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|ram_outb
r_void
id|ram_outb
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adr
comma
id|u8
id|data
)paren
(brace
id|u32
id|addr
op_assign
(paren
id|u32
)paren
id|adr
suffix:semicolon
id|writeb
c_func
(paren
id|data
comma
id|addr
)paren
suffix:semicolon
)brace
DECL|function|ram_outw
r_void
id|ram_outw
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adr
comma
id|u16
id|data
)paren
(brace
id|u32
id|addr
op_assign
(paren
id|u32
)paren
id|adr
suffix:semicolon
id|writew
c_func
(paren
id|data
comma
id|addr
)paren
suffix:semicolon
)brace
DECL|function|ram_copyfromcard
r_void
id|ram_copyfromcard
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adrto
comma
r_void
op_star
id|adr
comma
r_int
id|len
)paren
(brace
id|memcpy_fromio
c_func
(paren
id|adrto
comma
id|adr
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|ram_copytocard
r_void
id|ram_copytocard
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_void
op_star
id|adrto
comma
r_void
op_star
id|adr
comma
r_int
id|len
)paren
(brace
id|memcpy_toio
c_func
(paren
id|adrto
comma
id|adr
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
multiline_comment|/*&n; *  IDI-Callback function&n; */
r_void
DECL|function|eicon_idi_callback
id|eicon_idi_callback
c_func
(paren
id|ENTITY
op_star
id|de
)paren
(brace
id|eicon_card
op_star
id|ccard
op_assign
(paren
id|eicon_card
op_star
)paren
id|de-&gt;R
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|eicon_RC
op_star
id|ack
suffix:semicolon
id|eicon_IND
op_star
id|ind
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;complete
op_eq
l_int|255
)paren
(brace
multiline_comment|/* Return Code */
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_RC
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _idi_callback()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ack
op_assign
(paren
id|eicon_RC
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_RC
)paren
)paren
suffix:semicolon
id|ack-&gt;Rc
op_assign
id|de-&gt;Rc
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;Rc
op_eq
id|ASSIGN_OK
)paren
(brace
id|ack-&gt;RcId
op_assign
id|de-&gt;Id
suffix:semicolon
id|de-&gt;user
(braket
l_int|1
)braket
op_assign
id|de-&gt;Id
suffix:semicolon
)brace
r_else
(brace
id|ack-&gt;RcId
op_assign
id|de-&gt;user
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|ack-&gt;RcCh
op_assign
id|de-&gt;RcCh
suffix:semicolon
id|ack-&gt;Reference
op_assign
id|de-&gt;user
(braket
l_int|0
)braket
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rackq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_ack
c_func
(paren
id|ccard
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_cbk: Ch%d: Rc=%x Id=%x RLen=%x compl=%x&bslash;n&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Indication */
r_if
c_cond
(paren
id|de-&gt;complete
)paren
(brace
id|len
op_assign
id|de-&gt;RLength
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
l_int|270
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;RLength
op_le
l_int|270
)paren
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_cbk: ind not complete but &lt;= 270&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _idi_callback()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|de-&gt;Ind
suffix:semicolon
id|ind-&gt;IndId
op_assign
id|de-&gt;user
(braket
l_int|1
)braket
suffix:semicolon
id|ind-&gt;IndCh
op_assign
id|de-&gt;IndCh
suffix:semicolon
id|ind-&gt;MInd
op_assign
id|de-&gt;Ind
suffix:semicolon
id|ind-&gt;RBuffer.length
op_assign
id|len
suffix:semicolon
id|ind-&gt;MLength
op_assign
id|de-&gt;RLength
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ind-&gt;RBuffer.P
comma
op_amp
id|de-&gt;RBuffer-&gt;P
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rcvq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_rx
c_func
(paren
id|ccard
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_cbk: Ch%d: Ind=%x Id=%x RLen=%x compl=%x&bslash;n&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
suffix:semicolon
)brace
)brace
id|de-&gt;RNum
op_assign
l_int|0
suffix:semicolon
id|de-&gt;RNR
op_assign
l_int|0
suffix:semicolon
id|de-&gt;Rc
op_assign
l_int|0
suffix:semicolon
id|de-&gt;Ind
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ISDN_DRV_EICON_PCI */
multiline_comment|/*&n; *  Transmit-Function&n; */
r_void
DECL|function|eicon_io_transmit
id|eicon_io_transmit
c_func
(paren
id|eicon_card
op_star
id|ccard
)paren
(brace
id|eicon_isa_card
op_star
id|isa_card
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|eicon_pr_ram
op_star
id|prram
op_assign
l_int|0
suffix:semicolon
id|eicon_isa_com
op_star
id|com
op_assign
l_int|0
suffix:semicolon
id|eicon_REQ
op_star
id|ReqOut
op_assign
l_int|0
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
op_assign
l_int|0
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
r_int
id|ReqCount
suffix:semicolon
r_int
id|scom
op_assign
l_int|0
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|tmpid
op_assign
l_int|0
suffix:semicolon
r_int
id|quloop
op_assign
l_int|1
suffix:semicolon
r_int
id|dlev
op_assign
l_int|0
suffix:semicolon
id|ENTITY
op_star
id|ep
op_assign
l_int|0
suffix:semicolon
id|isa_card
op_assign
op_amp
id|ccard-&gt;hwif.isa
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_transmit: NULL card!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ccard-&gt;type
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
id|scom
op_assign
l_int|1
suffix:semicolon
id|com
op_assign
(paren
id|eicon_isa_com
op_star
)paren
id|isa_card-&gt;shmem
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_S2M
suffix:colon
id|scom
op_assign
l_int|0
suffix:semicolon
id|prram
op_assign
(paren
id|eicon_pr_ram
op_star
)paren
id|isa_card-&gt;shmem
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_case
id|EICON_CTYPE_MAESTRAP
suffix:colon
id|scom
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRAQ
suffix:colon
id|scom
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_MAESTRA
suffix:colon
id|scom
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_transmit: unsupported card-type!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ReqCount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ccard-&gt;sndq
)paren
)paren
)paren
id|quloop
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|quloop
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
(paren
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Req
)paren
)paren
op_logical_or
(paren
id|ccard-&gt;ReadyInt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ccard-&gt;ReadyInt
)paren
(brace
id|tmp
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReadyInt
)paren
op_plus
l_int|1
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReadyInt
comma
id|tmp
)paren
suffix:semicolon
id|ccard-&gt;ReadyInt
op_increment
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|ccard-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|32
comma
l_string|&quot;eicon: transmit: Card not ready&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;ReqOutput
)paren
op_minus
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;ReqInput
)paren
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|ccard-&gt;sndq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|32
comma
l_string|&quot;eicon: transmit: Card not ready&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb2-&gt;data
suffix:semicolon
id|chan
op_assign
id|chan2-&gt;ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.busy
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.X
)paren
)paren
)paren
(brace
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reqbuf-&gt;Reference
)paren
op_logical_and
(paren
id|chan-&gt;e.B2Id
op_eq
l_int|0
)paren
op_logical_and
(paren
id|reqbuf-&gt;ReqId
op_amp
l_int|0x1f
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|16
comma
l_string|&quot;eicon: transmit: error Id=0 on %d (Net)&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|ram_outw
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;XBuffer.length
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ram_copytocard
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;XBuffer.P
comma
op_amp
id|reqbuf-&gt;XBuffer.P
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReqCh
comma
id|reqbuf-&gt;ReqCh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* get address of next available request buffer */
id|ReqOut
op_assign
(paren
id|eicon_REQ
op_star
)paren
op_amp
id|prram-&gt;B
(braket
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;NextReq
)paren
)braket
suffix:semicolon
id|ram_outw
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;XBuffer.length
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ram_copytocard
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;XBuffer.P
comma
op_amp
id|reqbuf-&gt;XBuffer.P
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;ReqCh
comma
id|reqbuf-&gt;ReqCh
)paren
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;Req
comma
id|reqbuf-&gt;Req
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dlev
op_assign
l_int|160
suffix:semicolon
r_if
c_cond
(paren
id|reqbuf-&gt;ReqId
op_amp
l_int|0x1f
)paren
(brace
multiline_comment|/* if this is no ASSIGN */
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
(brace
multiline_comment|/* Signal Layer */
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReqId
comma
id|chan-&gt;e.D3Id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;ReqId
comma
id|chan-&gt;e.D3Id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ep
op_assign
op_amp
id|chan-&gt;de
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tmpid
op_assign
id|chan-&gt;e.D3Id
suffix:semicolon
id|chan-&gt;e.ReqCh
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Net Layer */
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReqId
comma
id|chan-&gt;e.B2Id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;ReqId
comma
id|chan-&gt;e.B2Id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ep
op_assign
op_amp
id|chan-&gt;be
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tmpid
op_assign
id|chan-&gt;e.B2Id
suffix:semicolon
id|chan-&gt;e.ReqCh
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|reqbuf-&gt;Req
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x08
)paren
op_logical_or
(paren
(paren
id|reqbuf-&gt;Req
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x01
)paren
)paren
(brace
multiline_comment|/* Send Data */
id|chan-&gt;waitq
op_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|chan-&gt;waitpq
op_add_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|dlev
op_assign
l_int|128
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* It is an ASSIGN */
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;ReqId
comma
id|reqbuf-&gt;ReqId
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;ReqId
comma
id|reqbuf-&gt;ReqId
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
id|ep
op_assign
op_amp
id|chan-&gt;de
suffix:semicolon
r_else
id|ep
op_assign
op_amp
id|chan-&gt;be
suffix:semicolon
id|ep-&gt;Id
op_assign
id|reqbuf-&gt;ReqId
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tmpid
op_assign
id|reqbuf-&gt;ReqId
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
id|chan-&gt;e.ReqCh
op_assign
l_int|0
suffix:semicolon
r_else
id|chan-&gt;e.ReqCh
op_assign
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|chan-&gt;e.ref
op_assign
id|ccard-&gt;ref_out
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|chan-&gt;e.ref
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;Reference
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|chan-&gt;e.ref
op_assign
id|chan-&gt;No
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chan-&gt;e.Req
op_assign
id|reqbuf-&gt;Req
suffix:semicolon
id|ReqCount
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Req
comma
id|reqbuf-&gt;Req
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|ram_outw
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;NextReq
comma
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|ReqOut-&gt;next
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_if
c_cond
(paren
op_logical_neg
id|ep
)paren
r_break
suffix:semicolon
id|ep-&gt;callback
op_assign
id|eicon_idi_callback
suffix:semicolon
id|ep-&gt;R
op_assign
(paren
id|BUFFERS
op_star
)paren
id|ccard
suffix:semicolon
id|ep-&gt;user
(braket
l_int|0
)braket
op_assign
(paren
id|word
)paren
id|chan-&gt;No
suffix:semicolon
id|ep-&gt;user
(braket
l_int|1
)braket
op_assign
(paren
id|word
)paren
id|tmpid
suffix:semicolon
id|ep-&gt;XNum
op_assign
l_int|1
suffix:semicolon
id|ep-&gt;RNum
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;RNR
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;Rc
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;Ind
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;X-&gt;PLength
op_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|memcpy
c_func
(paren
id|ep-&gt;X-&gt;P
comma
op_amp
id|reqbuf-&gt;XBuffer.P
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ep-&gt;ReqCh
op_assign
id|reqbuf-&gt;ReqCh
suffix:semicolon
id|ep-&gt;Req
op_assign
id|reqbuf-&gt;Req
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
id|chan-&gt;e.busy
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|eicon_lock
comma
id|flags
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
id|dlev
comma
l_string|&quot;eicon: Req=%d Id=%x Ch=%d Len=%d Ref=%d&bslash;n&quot;
comma
id|reqbuf-&gt;Req
comma
id|tmpid
comma
id|reqbuf-&gt;ReqCh
comma
id|reqbuf-&gt;XBuffer.length
comma
id|chan-&gt;e.ref
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_PCI
r_if
c_cond
(paren
id|scom
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|ep
)paren
(brace
id|ccard-&gt;d
op_member_access_from_pointer
id|request
c_func
(paren
id|ep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;Rc
)paren
id|eicon_idi_callback
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;sackq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;eicon: transmit: busy chan %d&bslash;n&quot;
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|scom
)paren
(brace
r_case
l_int|1
suffix:colon
id|quloop
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ccard-&gt;sndq
)paren
)paren
)paren
id|quloop
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|scom
)paren
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;ReqInput
comma
(paren
id|__u8
)paren
(paren
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;ReqInput
)paren
op_plus
id|ReqCount
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ccard-&gt;sackq
)paren
)paren
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;sndq
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_ISDN_DRV_EICON_ISA
multiline_comment|/*&n; * IRQ handler &n; */
r_void
DECL|function|eicon_irq
id|eicon_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|eicon_card
op_star
id|ccard
op_assign
(paren
id|eicon_card
op_star
)paren
id|dev_id
suffix:semicolon
id|eicon_isa_card
op_star
id|isa_card
suffix:semicolon
id|eicon_pr_ram
op_star
id|prram
op_assign
l_int|0
suffix:semicolon
id|eicon_isa_com
op_star
id|com
op_assign
l_int|0
suffix:semicolon
id|eicon_RC
op_star
id|RcIn
suffix:semicolon
id|eicon_IND
op_star
id|IndIn
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|Count
op_assign
l_int|0
suffix:semicolon
r_int
id|Rc
op_assign
l_int|0
suffix:semicolon
r_int
id|Ind
op_assign
l_int|0
suffix:semicolon
r_int
r_char
op_star
id|irqprobe
op_assign
l_int|0
suffix:semicolon
r_int
id|scom
op_assign
l_int|0
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|dlev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ccard
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_irq: spurious interrupt %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ccard-&gt;type
op_eq
id|EICON_CTYPE_QUADRO
)paren
(brace
id|tmp
op_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|tmp
)paren
(brace
id|com
op_assign
(paren
id|eicon_isa_com
op_star
)paren
id|ccard-&gt;hwif.isa.shmem
suffix:semicolon
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
id|ccard-&gt;hwif.isa.intack
)paren
)paren
)paren
(brace
multiline_comment|/* quadro found */
r_break
suffix:semicolon
)brace
id|ccard
op_assign
id|ccard-&gt;qnext
suffix:semicolon
id|tmp
op_decrement
suffix:semicolon
)brace
)brace
id|isa_card
op_assign
op_amp
id|ccard-&gt;hwif.isa
suffix:semicolon
r_switch
c_cond
(paren
id|ccard-&gt;type
)paren
(brace
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
id|scom
op_assign
l_int|1
suffix:semicolon
id|com
op_assign
(paren
id|eicon_isa_com
op_star
)paren
id|isa_card-&gt;shmem
suffix:semicolon
id|irqprobe
op_assign
op_amp
id|isa_card-&gt;irqprobe
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_S2M
suffix:colon
id|scom
op_assign
l_int|0
suffix:semicolon
id|prram
op_assign
(paren
id|eicon_pr_ram
op_star
)paren
id|isa_card-&gt;shmem
suffix:semicolon
id|irqprobe
op_assign
op_amp
id|isa_card-&gt;irqprobe
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_irq: unsupported card-type!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|irqprobe
)paren
(brace
r_switch
c_cond
(paren
id|ccard-&gt;type
)paren
(brace
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
r_if
c_cond
(paren
id|readb
c_func
(paren
id|isa_card-&gt;intack
)paren
)paren
(brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|com-&gt;Rc
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|isa_card-&gt;intack
)paren
suffix:semicolon
)brace
(paren
op_star
id|irqprobe
)paren
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_S2M
suffix:colon
r_if
c_cond
(paren
id|readb
c_func
(paren
id|isa_card-&gt;intack
)paren
)paren
(brace
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|prram-&gt;RcOutput
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|isa_card-&gt;intack
)paren
suffix:semicolon
)brace
(paren
op_star
id|irqprobe
)paren
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ccard-&gt;type
)paren
(brace
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
r_case
id|EICON_CTYPE_S2M
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|readb
c_func
(paren
id|isa_card-&gt;intack
)paren
)paren
)paren
(brace
multiline_comment|/* card did not interrupt */
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon: IRQ: card reports no interrupt!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scom
)paren
(brace
multiline_comment|/* if a return code is available ...  */
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Rc
)paren
)paren
)paren
(brace
id|eicon_RC
op_star
id|ack
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
id|READY_INT
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|64
comma
l_string|&quot;eicon: IRQ Rc=READY_INT&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ccard-&gt;ReadyInt
)paren
(brace
id|ccard-&gt;ReadyInt
op_decrement
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Rc
comma
l_int|0
)paren
suffix:semicolon
id|eicon_schedule_tx
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_RC
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _irq()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ack
op_assign
(paren
id|eicon_RC
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_RC
)paren
)paren
suffix:semicolon
id|ack-&gt;Rc
op_assign
id|tmp
suffix:semicolon
id|ack-&gt;RcId
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;RcId
)paren
suffix:semicolon
id|ack-&gt;RcCh
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;RcCh
)paren
suffix:semicolon
id|ack-&gt;Reference
op_assign
id|ccard-&gt;ref_in
op_increment
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;eicon: IRQ Rc=%d Id=%x Ch=%d Ref=%d&bslash;n&quot;
comma
id|tmp
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|ack-&gt;Reference
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rackq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_ack
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Req
comma
l_int|0
)paren
suffix:semicolon
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Rc
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* if an indication is available ...  */
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Ind
)paren
)paren
)paren
(brace
id|eicon_IND
op_star
id|ind
suffix:semicolon
r_int
id|len
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;RBuffer.length
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _irq()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|tmp
suffix:semicolon
id|ind-&gt;IndId
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;IndId
)paren
suffix:semicolon
id|ind-&gt;IndCh
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;IndCh
)paren
suffix:semicolon
id|ind-&gt;MInd
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;MInd
)paren
suffix:semicolon
id|ind-&gt;MLength
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;MLength
)paren
suffix:semicolon
id|ind-&gt;RBuffer.length
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_eq
l_int|1
)paren
op_logical_or
(paren
id|tmp
op_eq
l_int|8
)paren
)paren
id|dlev
op_assign
l_int|128
suffix:semicolon
r_else
id|dlev
op_assign
l_int|192
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
id|dlev
comma
l_string|&quot;eicon: IRQ Ind=%d Id=%x Ch=%d MInd=%d MLen=%d Len=%d&bslash;n&quot;
comma
id|tmp
comma
id|ind-&gt;IndId
comma
id|ind-&gt;IndCh
comma
id|ind-&gt;MInd
comma
id|ind-&gt;MLength
comma
id|len
)paren
suffix:semicolon
id|ram_copyfromcard
c_func
(paren
id|ccard
comma
op_amp
id|ind-&gt;RBuffer.P
comma
op_amp
id|com-&gt;RBuffer.P
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rcvq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_rx
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|com-&gt;Ind
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* if return codes are available ...  */
r_if
c_cond
(paren
(paren
id|Count
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;RcOutput
)paren
)paren
)paren
(brace
id|eicon_RC
op_star
id|ack
suffix:semicolon
multiline_comment|/* get the buffer address of the first return code */
id|RcIn
op_assign
(paren
id|eicon_RC
op_star
)paren
op_amp
id|prram-&gt;B
(braket
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;NextRc
)paren
)braket
suffix:semicolon
multiline_comment|/* for all return codes do ...  */
r_while
c_loop
(paren
id|Count
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|Rc
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;Rc
)paren
)paren
)paren
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_RC
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _irq()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ack
op_assign
(paren
id|eicon_RC
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_RC
)paren
)paren
suffix:semicolon
id|ack-&gt;Rc
op_assign
id|Rc
suffix:semicolon
id|ack-&gt;RcId
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;RcId
)paren
suffix:semicolon
id|ack-&gt;RcCh
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;RcCh
)paren
suffix:semicolon
id|ack-&gt;Reference
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;Reference
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;eicon: IRQ Rc=%d Id=%x Ch=%d Ref=%d&bslash;n&quot;
comma
id|Rc
comma
id|ack-&gt;RcId
comma
id|ack-&gt;RcCh
comma
id|ack-&gt;Reference
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rackq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_ack
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;Rc
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* get buffer address of next return code   */
id|RcIn
op_assign
(paren
id|eicon_RC
op_star
)paren
op_amp
id|prram-&gt;B
(braket
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|RcIn-&gt;next
)paren
)braket
suffix:semicolon
)brace
multiline_comment|/* clear all return codes (no chaining!) */
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;RcOutput
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* if indications are available ... */
r_if
c_cond
(paren
(paren
id|Count
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;IndOutput
)paren
)paren
)paren
(brace
id|eicon_IND
op_star
id|ind
suffix:semicolon
multiline_comment|/* get the buffer address of the first indication */
id|IndIn
op_assign
(paren
id|eicon_IND
op_star
)paren
op_amp
id|prram-&gt;B
(braket
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;NextInd
)paren
)braket
suffix:semicolon
multiline_comment|/* for all indications do ... */
r_while
c_loop
(paren
id|Count
op_decrement
)paren
(brace
id|Ind
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;Ind
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Ind
)paren
(brace
r_int
id|len
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;RBuffer.length
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;eicon_io: skb_alloc failed in _irq()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|Ind
suffix:semicolon
id|ind-&gt;IndId
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;IndId
)paren
suffix:semicolon
id|ind-&gt;IndCh
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;IndCh
)paren
suffix:semicolon
id|ind-&gt;MInd
op_assign
id|ram_inb
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;MInd
)paren
suffix:semicolon
id|ind-&gt;MLength
op_assign
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;MLength
)paren
suffix:semicolon
id|ind-&gt;RBuffer.length
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Ind
op_eq
l_int|1
)paren
op_logical_or
(paren
id|Ind
op_eq
l_int|8
)paren
)paren
id|dlev
op_assign
l_int|128
suffix:semicolon
r_else
id|dlev
op_assign
l_int|192
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
id|dlev
comma
l_string|&quot;eicon: IRQ Ind=%d Id=%x Ch=%d MInd=%d MLen=%d Len=%d&bslash;n&quot;
comma
id|Ind
comma
id|ind-&gt;IndId
comma
id|ind-&gt;IndCh
comma
id|ind-&gt;MInd
comma
id|ind-&gt;MLength
comma
id|len
)paren
suffix:semicolon
id|ram_copyfromcard
c_func
(paren
id|ccard
comma
op_amp
id|ind-&gt;RBuffer.P
comma
op_amp
id|IndIn-&gt;RBuffer.P
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rcvq
comma
id|skb
)paren
suffix:semicolon
id|eicon_schedule_rx
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;Ind
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* get buffer address of next indication  */
id|IndIn
op_assign
(paren
id|eicon_IND
op_star
)paren
op_amp
id|prram-&gt;B
(braket
id|ram_inw
c_func
(paren
id|ccard
comma
op_amp
id|IndIn-&gt;next
)paren
)braket
suffix:semicolon
)brace
id|ram_outb
c_func
(paren
id|ccard
comma
op_amp
id|prram-&gt;IndOutput
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* clear interrupt */
r_switch
c_cond
(paren
id|ccard-&gt;type
)paren
(brace
r_case
id|EICON_CTYPE_QUADRO
suffix:colon
id|writeb
c_func
(paren
l_int|0
comma
id|isa_card-&gt;intack
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|com
(braket
l_int|0x401
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EICON_CTYPE_S
suffix:colon
r_case
id|EICON_CTYPE_SX
suffix:colon
r_case
id|EICON_CTYPE_SCOM
suffix:colon
r_case
id|EICON_CTYPE_S2M
suffix:colon
id|writeb
c_func
(paren
l_int|0
comma
id|isa_card-&gt;intack
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif
eof
