multiline_comment|/* $Id: isdn_ppp.c,v 1.27 1997/03/30 16:51:17 calle Exp $&n; *&n; * Linux ISDN subsystem, functions for synchronous PPP (linklevel).&n; *&n; * Copyright 1995,96 by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * $Log: isdn_ppp.c,v $&n; * Revision 1.27  1997/03/30 16:51:17  calle&n; * changed calls to copy_from_user/copy_to_user and removed verify_area&n; * were possible.&n; *&n; * Revision 1.26  1997/02/23 16:53:44  hipp&n; * minor cleanup&n; * some initial changes for future PPP compresion&n; * added AC,PC compression for outgoing frames&n; *&n; * Revision 1.25  1997/02/12 20:37:35  hipp&n; * New ioctl() PPPIOCGCALLINFO, minor cleanup&n; *&n; * Revision 1.24  1997/02/11 18:32:56  fritz&n; * Bugfix in isdn_ppp_free_mpqueue().&n; *&n; * Revision 1.23  1997/02/10 11:12:19  fritz&n; * More changes for Kernel 2.1.X compatibility.&n; *&n; * Revision 1.22  1997/02/06 15:03:51  hipp&n; * changed GFP_KERNEL kmalloc to GFP_ATOMIC in isdn_ppp_fill_mpqueue()&n; *&n; * Revision 1.21  1997/02/03 23:29:38  fritz&n; * Reformatted according CodingStyle&n; * Bugfix: removed isdn_ppp_skb_destructor, used by upper layers.&n; * Misc changes for Kernel 2.1.X compatibility.&n; *&n; * Revision 1.20  1996/10/30 12:21:58  fritz&n; * Cosmetic fix: Compiler warning when compiling without MPP.&n; *&n; * Revision 1.19  1996/10/25 19:03:21  hipp&n; * changed/added some defines to (re)allow compilation without MP/VJ&n; *&n; * Revision 1.18  1996/10/22 23:14:00  fritz&n; * Changes for compatibility to 2.0.X and 2.1.X kernels.&n; *&n; * Revision 1.17  1996/10/22 09:39:49  hipp&n; * a few MP changes and bugfixes&n; *&n; * Revision 1.16  1996/09/23 01:58:10  fritz&n; * Fix: With syncPPP encapsulation, discard LCP packets&n; *      when calculating hangup timeout.&n; *&n; * Revision 1.15  1996/09/07 12:50:12  hipp&n; * bugfixes (unknown device after failed dial attempt, minor bugs)&n; *&n; * Revision 1.14  1996/08/12 16:26:47  hipp&n; * code cleanup&n; * changed connection management from minors to slots&n; *&n; * Revision 1.13  1996/07/01 19:47:24  hipp&n; * Fixed memory leak in VJ handling and more VJ changes&n; *&n; * Revision 1.12  1996/06/24 17:42:03  fritz&n; * Minor bugfixes.&n; *&n; * Revision 1.11  1996/06/16 17:46:05  tsbogend&n; * changed unsigned long to u32 to make Alpha people happy&n; *&n; * Revision 1.10  1996/06/11 14:50:29  hipp&n; * Lot of changes and bugfixes.&n; * New scheme to resend packets to busy LL devices.&n; *&n; * Revision 1.9  1996/05/18 01:37:01  fritz&n; * Added spelling corrections and some minor changes&n; * to stay in sync with kernel.&n; *&n; * Revision 1.8  1996/05/06 11:34:55  hipp&n; * fixed a few bugs&n; *&n; * Revision 1.7  1996/04/30 11:07:42  fritz&n; * Added Michael&squot;s ippp-bind patch.&n; *&n; * Revision 1.6  1996/04/30 09:33:09  fritz&n; * Removed compatibility-macros.&n; *&n; * Revision 1.5  1996/04/20 16:32:32  fritz&n; * Changed ippp_table to an array of pointers, allocating each part&n; * separately.&n; *&n; * Revision 1.4  1996/02/19 15:25:50  fritz&n; * Bugfix: Sync-PPP packets got compressed twice, when resent due to&n; * send-queue-full reject.&n; *&n; * Revision 1.3  1996/02/11 02:27:12  fritz&n; * Lot of Bugfixes my Michael.&n; * Moved calls to skb_push() into isdn_net_header()&n; * Fixed a possible race-condition in isdn_ppp_timer_timeout().&n; *&n; * Revision 1.2  1996/01/22 05:08:06  fritz&n; * Merged in Michael&squot;s patches for MP.&n; * Minor changes in isdn_ppp_xmit.&n; *&n; * Revision 1.1  1996/01/09 04:11:29  fritz&n; * Initial revision&n; *&n; */
multiline_comment|/* TODO: right tbusy handling when using MP */
multiline_comment|/*&n; * experimental for dynamic addressing: readdress IP frames&n; */
DECL|macro|ISDN_SYNCPPP_READDRESS
macro_line|#undef ISDN_SYNCPPP_READDRESS
macro_line|#include &lt;linux/config.h&gt;
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#if (LINUX_VERSION_CODE &gt;= 0x020117)
macro_line|#include &lt;asm/poll.h&gt;
macro_line|#endif
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#ifndef PPP_IPX
DECL|macro|PPP_IPX
mdefine_line|#define PPP_IPX 0x002b
macro_line|#endif
multiline_comment|/* set this if you use dynamic addressing */
multiline_comment|/* Prototypes */
r_static
r_int
id|isdn_ppp_fill_rq
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|proto
comma
r_int
id|slot
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_closewait
c_func
(paren
r_int
id|slot
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_push_higher
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|namebuf
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_set_compressor
c_func
(paren
r_struct
id|ippp_struct
op_star
id|is
comma
r_int
id|num
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_static
r_int
id|isdn_ppp_bundle
c_func
(paren
r_struct
id|ippp_struct
op_star
comma
r_int
id|unit
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mask_queue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
r_int
id|mask
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
r_int
id|min
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_cleanup_sqqueue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
id|isdn_net_local
op_star
comma
r_int
id|min
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_free_sqqueue
c_func
(paren
id|isdn_net_dev
op_star
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_fill_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
comma
r_struct
id|sk_buff
op_star
op_star
id|skb
comma
r_int
id|BEbyte
comma
r_int
op_star
id|sqno
comma
r_int
id|min_sqno
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_free_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|isdn_ppp_revision
r_char
op_star
id|isdn_ppp_revision
op_assign
l_string|&quot;$Revision: 1.27 $&quot;
suffix:semicolon
DECL|variable|ippp_table
r_static
r_struct
id|ippp_struct
op_star
id|ippp_table
(braket
id|ISDN_MAX_CHANNELS
)braket
suffix:semicolon
DECL|variable|ipc_head
r_static
r_struct
id|isdn_ppp_compressor
op_star
id|ipc_head
op_assign
l_int|NULL
suffix:semicolon
r_extern
r_int
id|isdn_net_force_dial_lp
c_func
(paren
id|isdn_net_local
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; * frame log (debug)&n; */
r_static
r_void
DECL|function|isdn_ppp_frame_log
id|isdn_ppp_frame_log
c_func
(paren
r_char
op_star
id|info
comma
r_char
op_star
id|data
comma
r_int
id|len
comma
r_int
id|maxlen
)paren
(brace
r_int
id|cnt
comma
id|j
comma
id|i
suffix:semicolon
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|maxlen
)paren
id|maxlen
op_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
op_logical_and
id|cnt
OL
id|maxlen
suffix:semicolon
id|j
op_increment
comma
id|cnt
op_increment
)paren
id|sprintf
c_func
(paren
id|buf
op_plus
id|j
op_star
l_int|3
comma
l_string|&quot;%02x &quot;
comma
(paren
r_int
r_char
)paren
id|data
(braket
id|cnt
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s[%d]: %s&bslash;n&quot;
comma
id|info
comma
id|i
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * unbind isdn_net_local &lt;=&gt; ippp-device&n; * note: it can happen, that we hangup/free the master before the slaves&n; */
r_int
DECL|function|isdn_ppp_free
id|isdn_ppp_free
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_local
op_star
id|master_lp
op_assign
id|lp
suffix:semicolon
macro_line|#endif
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ppp_slot
template_param
id|ISDN_MAX_CHANNELS
)paren
r_return
l_int|0
suffix:semicolon
id|is
op_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|lp-&gt;master
)paren
id|master_lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;master-&gt;priv
suffix:semicolon
id|lp-&gt;last-&gt;next
op_assign
id|lp-&gt;next
suffix:semicolon
id|lp-&gt;next-&gt;last
op_assign
id|lp-&gt;last
suffix:semicolon
r_if
c_cond
(paren
id|master_lp-&gt;netdev-&gt;queue
op_eq
id|lp
)paren
(brace
id|master_lp-&gt;netdev-&gt;queue
op_assign
id|lp-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;next
op_eq
id|lp
)paren
(brace
multiline_comment|/* last link in queue? */
id|master_lp-&gt;netdev-&gt;ib.bundled
op_assign
l_int|0
suffix:semicolon
id|isdn_ppp_free_mpqueue
c_func
(paren
id|master_lp-&gt;netdev
)paren
suffix:semicolon
id|isdn_ppp_free_sqqueue
c_func
(paren
id|master_lp-&gt;netdev
)paren
suffix:semicolon
)brace
)brace
id|lp-&gt;next
op_assign
id|lp-&gt;last
op_assign
id|lp
suffix:semicolon
multiline_comment|/* (re)set own pointers */
macro_line|#endif
r_if
c_cond
(paren
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
id|isdn_ppp_closewait
c_func
(paren
id|lp-&gt;ppp_slot
)paren
suffix:semicolon
multiline_comment|/* force wakeup on ippp device */
r_else
r_if
c_cond
(paren
id|is-&gt;state
op_amp
id|IPPP_ASSIGNED
)paren
id|is-&gt;state
op_assign
id|IPPP_OPEN
suffix:semicolon
multiline_comment|/* fallback to &squot;OPEN but not ASSIGEND&squot; staet */
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_free %d %lx %lx&bslash;n&quot;
comma
id|lp-&gt;ppp_slot
comma
(paren
r_int
)paren
id|lp
comma
(paren
r_int
)paren
id|is-&gt;lp
)paren
suffix:semicolon
id|is-&gt;lp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* link is down .. set lp to NULL */
macro_line|#ifdef ISDN_SYNCPPP_READDRESS
id|is-&gt;old_pa_addr
op_assign
l_int|0x0
suffix:semicolon
id|is-&gt;old_pa_dstaddr
op_assign
l_int|0x0
suffix:semicolon
macro_line|#endif
id|lp-&gt;ppp_slot
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* is this OK ?? */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * bind isdn_net_local &lt;=&gt; ippp-device&n; */
r_int
DECL|function|isdn_ppp_bind
id|isdn_ppp_bind
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|unit
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_ne
id|ISDN_NET_ENCAP_SYNCPPP
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;pppbind
OL
l_int|0
)paren
(brace
multiline_comment|/* device bounded to ippp device ? */
id|isdn_net_dev
op_star
id|net_dev
op_assign
id|dev-&gt;netdev
suffix:semicolon
r_char
id|exclusive
(braket
id|ISDN_MAX_CHANNELS
)braket
suffix:semicolon
multiline_comment|/* exclusive flags */
id|memset
c_func
(paren
id|exclusive
comma
l_int|0
comma
id|ISDN_MAX_CHANNELS
)paren
suffix:semicolon
r_while
c_loop
(paren
id|net_dev
)paren
(brace
multiline_comment|/* step through net devices to find exclusive minors */
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|net_dev-&gt;local
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;pppbind
op_ge
l_int|0
)paren
id|exclusive
(braket
id|lp-&gt;pppbind
)braket
op_assign
l_int|1
suffix:semicolon
id|net_dev
op_assign
id|net_dev-&gt;next
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * search a free device / slot&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
id|IPPP_OPEN
op_logical_and
op_logical_neg
id|exclusive
(braket
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|minor
)braket
)paren
(brace
multiline_comment|/* OPEN, but not connected! */
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|minor
op_eq
id|lp-&gt;pppbind
op_logical_and
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
id|IPPP_OPEN
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
id|ISDN_MAX_CHANNELS
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_bind: Can&squot;t find usable ippp device.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|unit
op_assign
id|isdn_ppp_if_get_unit
c_func
(paren
id|lp-&gt;name
)paren
suffix:semicolon
multiline_comment|/* get unit number from interface name .. ugly! */
r_if
c_cond
(paren
id|unit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_ppp_bind: illegal interface name %s.&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|lp-&gt;ppp_slot
op_assign
id|i
suffix:semicolon
id|is
op_assign
id|ippp_table
(braket
id|i
)braket
suffix:semicolon
id|is-&gt;lp
op_assign
id|lp
suffix:semicolon
id|is-&gt;unit
op_assign
id|unit
suffix:semicolon
id|is-&gt;state
op_assign
id|IPPP_OPEN
op_or
id|IPPP_ASSIGNED
suffix:semicolon
multiline_comment|/* assigned to a netdevice but not connected */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|lp-&gt;ppp_slot
suffix:semicolon
)brace
multiline_comment|/*&n; * kick the ipppd on the device&n; * (wakes up daemon after B-channel connect)&n; */
r_void
DECL|function|isdn_ppp_wakeup_daemon
id|isdn_ppp_wakeup_daemon
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;ppp_slot
OL
l_int|0
op_logical_or
id|lp-&gt;ppp_slot
op_ge
id|ISDN_MAX_CHANNELS
)paren
r_return
suffix:semicolon
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|state
op_assign
id|IPPP_OPEN
op_or
id|IPPP_CONNECT
op_or
id|IPPP_NOBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|wq
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|wq
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * there was a hangup on the netdevice&n; * force wakeup of the ippp device&n; * go into &squot;device waits for release&squot; state&n; */
r_static
r_int
DECL|function|isdn_ppp_closewait
id|isdn_ppp_closewait
c_func
(paren
r_int
id|slot
)paren
(brace
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
op_logical_or
id|slot
op_ge
id|ISDN_MAX_CHANNELS
)paren
r_return
l_int|0
suffix:semicolon
id|is
op_assign
id|ippp_table
(braket
id|slot
)braket
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;state
op_logical_and
id|is-&gt;wq
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
id|is-&gt;state
op_assign
id|IPPP_CLOSEWAIT
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * isdn_ppp_find_slot / isdn_ppp_free_slot&n; */
r_static
r_int
DECL|function|isdn_ppp_get_slot
id|isdn_ppp_get_slot
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|state
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * isdn_ppp_open&n; */
r_int
DECL|function|isdn_ppp_open
id|isdn_ppp_open
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|slot
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|min
template_param
id|ISDN_MAX_CHANNELS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|slot
op_assign
id|isdn_ppp_get_slot
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|is
op_assign
id|file-&gt;private_data
op_assign
id|ippp_table
(braket
id|slot
)braket
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp, open, slot: %d, minor: %d, state: %04x&bslash;n&quot;
comma
id|slot
comma
id|min
comma
id|is-&gt;state
)paren
suffix:semicolon
id|is-&gt;compressor
op_assign
l_int|NULL
suffix:semicolon
id|is-&gt;lp
op_assign
l_int|NULL
suffix:semicolon
id|is-&gt;mp_seqno
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* MP sequence number */
id|is-&gt;pppcfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ppp configuration */
id|is-&gt;mpppcfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mppp configuration */
id|is-&gt;range
op_assign
l_int|0x1000000
suffix:semicolon
multiline_comment|/* MP: 24 bit range */
id|is-&gt;last_link_seqno
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* MP: maybe set to Bundle-MIN, when joining a bundle ?? */
id|is-&gt;unit
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set, when we have our interface */
id|is-&gt;mru
op_assign
l_int|1524
suffix:semicolon
multiline_comment|/* MRU, default 1524 */
id|is-&gt;maxcid
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* VJ: maxcid */
id|is-&gt;tk
op_assign
id|current
suffix:semicolon
id|is-&gt;wq
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* read() wait queue */
id|is-&gt;wq1
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* select() wait queue */
id|is-&gt;first
op_assign
id|is-&gt;rq
op_plus
id|NUM_RCV_BUFFS
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* receive queue */
id|is-&gt;last
op_assign
id|is-&gt;rq
suffix:semicolon
id|is-&gt;minor
op_assign
id|min
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
multiline_comment|/*&n;&t; * VJ header compression init&n;&t; */
id|is-&gt;slcomp
op_assign
id|slhc_init
c_func
(paren
l_int|16
comma
l_int|16
)paren
suffix:semicolon
multiline_comment|/* not necessary for 2. link in bundle */
macro_line|#endif
id|is-&gt;state
op_assign
id|IPPP_OPEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * release ippp device&n; */
r_void
DECL|function|isdn_ppp_release
id|isdn_ppp_release
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|min
OL
l_int|0
op_logical_or
id|min
op_ge
id|ISDN_MAX_CHANNELS
)paren
r_return
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: release, minor: %d %lx&bslash;n&quot;
comma
id|min
comma
(paren
r_int
)paren
id|is-&gt;lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;lp
)paren
(brace
multiline_comment|/* a lp address says: this link is still up */
id|isdn_net_dev
op_star
id|p
op_assign
id|is-&gt;lp-&gt;netdev
suffix:semicolon
id|is-&gt;state
op_and_assign
op_complement
id|IPPP_CONNECT
suffix:semicolon
multiline_comment|/* -&gt; effect: no call of wakeup */
multiline_comment|/*&n;&t;&t; * isdn_net_hangup() calls isdn_ppp_free()&n;&t;&t; * isdn_ppp_free() sets is-&gt;lp to NULL and lp-&gt;ppp_slot to -1&n;&t;&t; * removing the IPPP_CONNECT flag omits calling of isdn_ppp_wakeup_daemon()&n;&t;&t; */
id|isdn_net_hangup
c_func
(paren
op_amp
id|p-&gt;dev
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RCV_BUFFS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|is-&gt;rq
(braket
id|i
)braket
dot
id|buf
)paren
(brace
id|kfree
c_func
(paren
id|is-&gt;rq
(braket
id|i
)braket
dot
id|buf
)paren
suffix:semicolon
id|is-&gt;rq
(braket
id|i
)braket
dot
id|buf
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|is-&gt;first
op_assign
id|is-&gt;rq
op_plus
id|NUM_RCV_BUFFS
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* receive queue */
id|is-&gt;last
op_assign
id|is-&gt;rq
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|slhc_free
c_func
(paren
id|is-&gt;slcomp
)paren
suffix:semicolon
id|is-&gt;slcomp
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|is-&gt;state
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * get_arg .. ioctl helper&n; */
r_static
r_int
DECL|function|get_arg
id|get_arg
c_func
(paren
r_void
op_star
id|b
comma
r_void
op_star
id|val
comma
r_int
id|len
)paren
(brace
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
id|len
op_assign
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
id|val
comma
id|b
comma
id|len
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * set arg .. ioctl helper&n; */
r_static
r_int
DECL|function|set_arg
id|set_arg
c_func
(paren
r_void
op_star
id|b
comma
r_int
r_int
id|val
comma
r_void
op_star
id|str
)paren
(brace
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|str
)paren
(brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|copy_to_user
c_func
(paren
id|b
comma
(paren
r_void
op_star
)paren
op_amp
id|val
comma
l_int|4
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|copy_to_user
c_func
(paren
id|b
comma
id|str
comma
id|val
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ippp device ioctl&n; */
r_int
DECL|function|isdn_ppp_ioctl
id|isdn_ppp_ioctl
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
r_int
id|num
comma
id|r
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
id|isdn_net_local
op_star
id|lp
suffix:semicolon
id|is
op_assign
(paren
r_struct
id|ippp_struct
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|lp
op_assign
id|is-&gt;lp
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_ioctl: minor: %d cmd: %x state: %x&bslash;n&quot;
comma
id|min
comma
id|cmd
comma
id|is-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PPPIOCBUNDLE
suffix:colon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;iPPP-bundle: minor: %d, slave unit: %d, master unit: %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|min
comma
(paren
r_int
)paren
id|is-&gt;unit
comma
(paren
r_int
)paren
id|val
)paren
suffix:semicolon
r_return
id|isdn_ppp_bundle
c_func
(paren
id|is
comma
id|val
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|PPPIOCGUNIT
suffix:colon
multiline_comment|/* get ppp/isdn unit number */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|is-&gt;unit
comma
l_int|NULL
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGMPFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|is-&gt;mpppcfg
comma
l_int|NULL
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|is-&gt;mpppcfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|is-&gt;pppcfg
comma
l_int|NULL
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|r
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|SC_ENABLE_IP
op_logical_and
op_logical_neg
(paren
id|is-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
op_logical_and
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
(brace
r_if
c_cond
(paren
id|lp
)paren
(brace
id|lp-&gt;netdev-&gt;dev.tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
multiline_comment|/* OK .. we are ready to send buffers */
)brace
)brace
id|is-&gt;pppcfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|PPPIOCGSTAT
suffix:colon
multiline_comment|/* read PPP statistic information */
r_break
suffix:semicolon
macro_line|#endif
r_case
id|PPPIOCGIDLE
suffix:colon
multiline_comment|/* get idle time information */
r_if
c_cond
(paren
id|lp
)paren
(brace
r_struct
id|ppp_idle
id|pidle
suffix:semicolon
id|pidle.xmit_idle
op_assign
id|pidle.recv_idle
op_assign
id|lp-&gt;huptimer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|ppp_idle
)paren
comma
op_amp
id|pidle
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCSMRU
suffix:colon
multiline_comment|/* set receive unit size for PPP */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|is-&gt;mru
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPMRU
suffix:colon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPMTU
suffix:colon
r_break
suffix:semicolon
r_case
id|PPPIOCSMAXCID
suffix:colon
multiline_comment|/* set the maximum compression slot id */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|val
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;maxcid
op_ne
id|val
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_struct
id|slcompress
op_star
id|sltmp
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp, ioctl: changed MAXCID to %ld&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|is-&gt;maxcid
op_assign
id|val
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|sltmp
op_assign
id|slhc_init
c_func
(paren
l_int|16
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sltmp
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ippp, can&squot;t realloc slhc struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is-&gt;slcomp
)paren
id|slhc_free
c_func
(paren
id|is-&gt;slcomp
)paren
suffix:semicolon
id|is-&gt;slcomp
op_assign
id|sltmp
suffix:semicolon
macro_line|#endif
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCGDEBUG
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|is-&gt;debug
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSDEBUG
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|is-&gt;debug
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGCOMPRESSORS
suffix:colon
(brace
r_int
r_int
id|protos
op_assign
l_int|0
suffix:semicolon
r_struct
id|isdn_ppp_compressor
op_star
id|ipc
op_assign
id|ipc_head
suffix:semicolon
r_while
c_loop
(paren
id|ipc
)paren
(brace
id|protos
op_or_assign
(paren
l_int|0x1
op_lshift
id|ipc-&gt;num
)paren
suffix:semicolon
id|ipc
op_assign
id|ipc-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|protos
comma
l_int|0
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCSCOMPRESSOR
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|num
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_return
id|isdn_ppp_set_compressor
c_func
(paren
id|is
comma
id|num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGCALLINFO
suffix:colon
(brace
r_struct
id|pppcallinfo
id|pci
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pci
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pppcallinfo
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
)paren
(brace
id|strncpy
c_func
(paren
id|pci.local_num
comma
id|lp-&gt;msn
comma
l_int|63
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dial
)paren
(brace
id|strncpy
c_func
(paren
id|pci.remote_num
comma
id|lp-&gt;dial-&gt;num
comma
l_int|63
)paren
suffix:semicolon
)brace
id|pci.charge_units
op_assign
id|lp-&gt;charge
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;outgoing
)paren
(brace
id|pci.calltype
op_assign
id|CALLTYPE_OUTGOING
suffix:semicolon
)brace
r_else
id|pci.calltype
op_assign
id|CALLTYPE_INCOMING
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
(brace
id|pci.calltype
op_or_assign
id|CALLTYPE_CALLBACK
suffix:semicolon
)brace
)brace
r_return
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|pppcallinfo
)paren
comma
op_amp
id|pci
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if (LINUX_VERSION_CODE &lt; 0x020117)
r_int
DECL|function|isdn_ppp_select
id|isdn_ppp_select
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
comma
r_int
id|type
comma
id|select_table
op_star
id|st
)paren
(brace
r_struct
id|ippp_buf_queue
op_star
id|bf
comma
op_star
id|bl
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_select: minor: %d, type: %d &bslash;n&quot;
comma
id|min
comma
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|SEL_IN
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|bl
op_assign
id|is-&gt;last
suffix:semicolon
id|bf
op_assign
id|is-&gt;first
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * if IPPP_NOBLOCK is set we return even if we have nothing to read&n;&t;&t;&t; */
r_if
c_cond
(paren
id|bf-&gt;next
op_eq
id|bl
op_logical_and
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_NOBLOCK
)paren
)paren
(brace
id|select_wait
c_func
(paren
op_amp
id|is-&gt;wq
comma
id|st
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|is-&gt;state
op_and_assign
op_complement
id|IPPP_NOBLOCK
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|SEL_OUT
suffix:colon
multiline_comment|/* we&squot;re always ready to send .. */
r_return
l_int|1
suffix:semicolon
r_case
id|SEL_EX
suffix:colon
id|select_wait
c_func
(paren
op_amp
id|is-&gt;wq1
comma
id|st
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#else
r_int
r_int
DECL|function|isdn_ppp_poll
id|isdn_ppp_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
suffix:semicolon
r_struct
id|ippp_buf_queue
op_star
id|bf
suffix:semicolon
r_struct
id|ippp_buf_queue
op_star
id|bl
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_poll: minor: %d&bslash;n&quot;
comma
id|MINOR
c_func
(paren
id|file-&gt;f_inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
op_amp
id|is-&gt;wq
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: device not open&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|POLLERR
suffix:semicolon
)brace
multiline_comment|/* we&squot;re always ready to send .. */
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|bl
op_assign
id|is-&gt;last
suffix:semicolon
id|bf
op_assign
id|is-&gt;first
suffix:semicolon
multiline_comment|/*&n;&t; * if IPPP_NOBLOCK is set we return even if we have nothing to read&n;&t; */
r_if
c_cond
(paren
id|bf-&gt;next
op_ne
id|bl
op_logical_or
(paren
id|is-&gt;state
op_amp
id|IPPP_NOBLOCK
)paren
)paren
(brace
id|is-&gt;state
op_and_assign
op_complement
id|IPPP_NOBLOCK
suffix:semicolon
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *  fill up isdn_ppp_read() queue ..&n; */
r_static
r_int
DECL|function|isdn_ppp_fill_rq
id|isdn_ppp_fill_rq
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|proto
comma
r_int
id|slot
)paren
(brace
r_struct
id|ippp_buf_queue
op_star
id|bf
comma
op_star
id|bl
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
op_star
id|nbuf
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
op_logical_or
id|slot
op_ge
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: illegal slot.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|is
op_assign
id|ippp_table
(braket
id|slot
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: device not activated.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nbuf
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|4
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nbuf
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Can&squot;t alloc buf&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nbuf
(braket
l_int|0
)braket
op_assign
id|PPP_ALLSTATIONS
suffix:semicolon
id|nbuf
(braket
l_int|1
)braket
op_assign
id|PPP_UI
suffix:semicolon
id|nbuf
(braket
l_int|2
)braket
op_assign
id|proto
op_rshift
l_int|8
suffix:semicolon
id|nbuf
(braket
l_int|3
)braket
op_assign
id|proto
op_amp
l_int|0xff
suffix:semicolon
id|memcpy
c_func
(paren
id|nbuf
op_plus
l_int|4
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|bf
op_assign
id|is-&gt;first
suffix:semicolon
id|bl
op_assign
id|is-&gt;last
suffix:semicolon
r_if
c_cond
(paren
id|bf
op_eq
id|bl
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Queue is full; discarding first buffer&bslash;n&quot;
)paren
suffix:semicolon
id|bf
op_assign
id|bf-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|bf-&gt;buf
)paren
suffix:semicolon
id|is-&gt;first
op_assign
id|bf
suffix:semicolon
)brace
id|bl-&gt;buf
op_assign
(paren
r_char
op_star
)paren
id|nbuf
suffix:semicolon
id|bl-&gt;len
op_assign
id|len
op_plus
l_int|4
suffix:semicolon
id|is-&gt;last
op_assign
id|bl-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;wq
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * read() .. non-blocking: ipppd calls it only after select()&n; *           reports, that there is data&n; */
r_int
DECL|function|isdn_ppp_read
id|isdn_ppp_read
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_struct
id|ippp_buf_queue
op_star
id|b
suffix:semicolon
r_int
id|r
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|b
op_assign
id|is-&gt;first-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b-&gt;buf
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|b-&gt;len
OL
id|count
)paren
id|count
op_assign
id|b-&gt;len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|copy_to_user
c_func
(paren
id|buf
comma
id|b-&gt;buf
comma
id|count
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|b-&gt;buf
)paren
suffix:semicolon
id|b-&gt;buf
op_assign
l_int|NULL
suffix:semicolon
id|is-&gt;first
op_assign
id|b
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * ipppd wanna write a packet to the card .. non-blocking&n; */
r_int
DECL|function|isdn_ppp_write
id|isdn_ppp_write
c_func
(paren
r_int
id|min
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|isdn_net_local
op_star
id|lp
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
r_int
id|proto
suffix:semicolon
r_int
r_char
id|protobuf
(braket
l_int|4
)braket
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|lp
op_assign
id|is-&gt;lp
suffix:semicolon
multiline_comment|/* -&gt; push it directly to the lowlevel interface */
r_if
c_cond
(paren
op_logical_neg
id|lp
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_write: lp == NULL&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/*&n;&t;&t; * Don&squot;t reset huptimer for&n;&t;&t; * LCP packets. (Echo requests).&n;&t;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|protobuf
comma
id|buf
comma
l_int|4
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|proto
op_assign
id|PPP_PROTOCOL
c_func
(paren
id|protobuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_ne
id|PPP_LCP
)paren
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;isdn_device
OL
l_int|0
op_logical_or
id|lp-&gt;isdn_channel
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|lp-&gt;isdn_device
)braket
op_member_access_from_pointer
id|running
op_logical_and
id|lp-&gt;dialstate
op_eq
l_int|0
op_logical_and
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CONNECTED
)paren
)paren
(brace
r_int
id|cnt
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_write: out of memory!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|buf
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ppp xmit: len %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cnt
op_assign
id|isdn_writebuf_skb_stub
c_func
(paren
id|lp-&gt;isdn_device
comma
id|lp-&gt;isdn_channel
comma
id|skb
)paren
)paren
op_ne
id|count
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;sav_skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;sav_skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_write: freeing sav_skb (%d,%d)!&bslash;n&quot;
comma
id|cnt
comma
id|count
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_write: Can&squot;t write PPP frame to LL (%d,%d)!&bslash;n&quot;
comma
id|cnt
comma
id|count
)paren
suffix:semicolon
id|lp-&gt;sav_skb
op_assign
id|skb
suffix:semicolon
)brace
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * init memory, structures etc.&n; */
r_int
DECL|function|isdn_ppp_init
id|isdn_ppp_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ippp_table
(braket
id|i
)braket
op_assign
(paren
r_struct
id|ippp_struct
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ippp_struct
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_init: Could not alloc ippp_table&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
id|kfree
c_func
(paren
id|ippp_table
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|ippp_table
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ippp_struct
)paren
)paren
suffix:semicolon
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
l_int|0
suffix:semicolon
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|first
op_assign
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
op_plus
id|NUM_RCV_BUFFS
op_minus
l_int|1
suffix:semicolon
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|last
op_assign
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NUM_RCV_BUFFS
suffix:semicolon
id|j
op_increment
)paren
(brace
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
(braket
id|j
)braket
dot
id|buf
op_assign
l_int|NULL
suffix:semicolon
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
(braket
id|j
)braket
dot
id|last
op_assign
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
op_plus
(paren
id|NUM_RCV_BUFFS
op_plus
id|j
op_minus
l_int|1
)paren
op_mod
id|NUM_RCV_BUFFS
suffix:semicolon
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
(braket
id|j
)braket
dot
id|next
op_assign
id|ippp_table
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
op_plus
(paren
id|j
op_plus
l_int|1
)paren
op_mod
id|NUM_RCV_BUFFS
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|isdn_ppp_cleanup
id|isdn_ppp_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|ippp_table
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * handler for incoming packets on a syncPPP interface&n; */
r_void
DECL|function|isdn_ppp_receive
id|isdn_ppp_receive
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ippp_struct
op_star
id|is
suffix:semicolon
id|is
op_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp_receive: len: %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;receive&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_dev-&gt;local.master
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_receice: net_dev != master&bslash;n&quot;
)paren
suffix:semicolon
id|net_dev
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|net_dev-&gt;local.master-&gt;priv
)paren
op_member_access_from_pointer
id|netdev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_eq
l_int|0xff
op_logical_and
id|skb-&gt;data
(braket
l_int|1
)braket
op_eq
l_int|0x03
)paren
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|is-&gt;pppcfg
op_amp
id|SC_REJ_COMP_AC
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* discard it silently */
)brace
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;mpppcfg
op_amp
id|SC_REJ_MP_PROT
)paren
)paren
(brace
r_int
id|proto
suffix:semicolon
r_int
id|sqno_end
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0x1
)paren
(brace
id|proto
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* protocol ID is only 8 bit */
)brace
r_else
(brace
id|proto
op_assign
(paren
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_plus
id|skb-&gt;data
(braket
l_int|1
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_MP
)paren
(brace
id|isdn_net_local
op_star
id|lpq
suffix:semicolon
r_int
id|sqno
comma
id|min_sqno
comma
id|tseq
suffix:semicolon
id|u_char
id|BEbyte
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x8
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;recv: %d/%04x/%d -&gt; %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|lp-&gt;ppp_slot
comma
id|proto
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|2
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|3
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|4
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;mpppcfg
op_amp
id|SC_IN_SHORT_SEQ
)paren
)paren
(brace
id|sqno
op_assign
(paren
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|3
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|sqno
op_assign
(paren
(paren
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
)paren
op_plus
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tseq
op_assign
id|is-&gt;last_link_seqno
)paren
op_ge
id|sqno
)paren
(brace
r_int
id|range
op_assign
id|is-&gt;range
suffix:semicolon
r_if
c_cond
(paren
id|tseq
op_plus
l_int|1024
OL
id|range
op_plus
id|sqno
)paren
multiline_comment|/* redundancy check .. not MP conform */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_receive, MP, detected overflow with sqno: %ld, last: %ld !!!&bslash;n&quot;
comma
id|sqno
comma
id|tseq
)paren
suffix:semicolon
r_else
(brace
id|sqno
op_add_assign
id|range
suffix:semicolon
id|is-&gt;last_link_seqno
op_assign
id|sqno
suffix:semicolon
)brace
)brace
r_else
id|is-&gt;last_link_seqno
op_assign
id|sqno
suffix:semicolon
r_for
c_loop
(paren
id|min_sqno
op_assign
id|LONG_MAX
comma
id|lpq
op_assign
id|net_dev-&gt;queue
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
id|lls
op_assign
id|ippp_table
(braket
id|lpq-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|last_link_seqno
suffix:semicolon
r_if
c_cond
(paren
id|lls
op_ge
l_int|0
op_logical_and
id|lls
OL
id|min_sqno
)paren
id|min_sqno
op_assign
id|lls
suffix:semicolon
id|lpq
op_assign
id|lpq-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|lpq
op_eq
id|net_dev-&gt;queue
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|min_sqno
op_ge
id|ippp_table
(braket
id|lpq-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|range
)paren
(brace
multiline_comment|/* OK, every link overflowed */
r_int
id|mask
op_assign
id|ippp_table
(braket
id|lpq-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|range
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* range is a power of 2 */
macro_line|#if 0
id|isdn_ppp_cleanup_queue
c_func
(paren
id|net_dev
comma
id|min_sqno
)paren
suffix:semicolon
macro_line|#endif
id|isdn_ppp_mask_queue
c_func
(paren
id|net_dev
comma
id|mask
)paren
suffix:semicolon
id|net_dev-&gt;ib.next_num
op_and_assign
id|mask
suffix:semicolon
(brace
r_struct
id|sqqueue
op_star
id|q
op_assign
id|net_dev-&gt;ib.sq
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
id|q-&gt;sqno_start
op_and_assign
id|mask
suffix:semicolon
id|q-&gt;sqno_end
op_and_assign
id|mask
suffix:semicolon
)brace
)brace
id|min_sqno
op_and_assign
id|mask
suffix:semicolon
r_for
c_loop
(paren
id|lpq
op_assign
id|net_dev-&gt;queue
suffix:semicolon
suffix:semicolon
)paren
(brace
id|ippp_table
(braket
id|lpq-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|last_link_seqno
op_and_assign
id|mask
suffix:semicolon
id|lpq
op_assign
id|lpq-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|lpq
op_eq
id|net_dev-&gt;queue
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|BEbyte
op_amp
(paren
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
)paren
)paren
op_ne
(paren
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
)paren
)paren
(brace
r_static
r_int
id|dmes
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmes
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: trying ;) to fill mp_queue %d .. UNTESTED!!&bslash;n&quot;
comma
id|lp-&gt;ppp_slot
)paren
suffix:semicolon
id|dmes
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sqno_end
op_assign
id|isdn_ppp_fill_mpqueue
c_func
(paren
id|net_dev
comma
op_amp
id|skb
comma
id|BEbyte
comma
op_amp
id|sqno
comma
id|min_sqno
)paren
)paren
OL
l_int|0
)paren
(brace
id|net_dev-&gt;ib.modify
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* block timeout-timer */
id|isdn_ppp_cleanup_sqqueue
c_func
(paren
id|net_dev
comma
id|lp
comma
id|min_sqno
)paren
suffix:semicolon
id|net_dev-&gt;ib.modify
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* no packet complete */
)brace
)brace
r_else
id|sqno_end
op_assign
id|sqno
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x40
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;min_sqno: %ld sqno_end %d next: %ld&bslash;n&quot;
comma
id|min_sqno
comma
id|sqno_end
comma
id|net_dev-&gt;ib.next_num
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * MP buffer management .. reorders incoming packets ..&n;&t;&t;&t; * lotsa mem-copies and not heavily tested.&n;&t;&t;&t; *&n;&t;&t;&t; * first check whether there is more than one link in the bundle&n;&t;&t;&t; * then check whether the number is in order&n;&t;&t;&t; */
id|net_dev-&gt;ib.modify
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* block timeout-timer */
r_if
c_cond
(paren
id|net_dev-&gt;ib.bundled
op_logical_and
id|net_dev-&gt;ib.next_num
op_ne
id|sqno
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * packet is not &squot;in order&squot;&n;&t;&t;&t;&t; */
r_struct
id|sqqueue
op_star
id|q
suffix:semicolon
id|q
op_assign
(paren
r_struct
id|sqqueue
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sqqueue
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|net_dev-&gt;ib.modify
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp/MPPP: Bad! Can&squot;t alloc sq node!&bslash;n&quot;
)paren
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* discard */
)brace
id|q-&gt;skb
op_assign
id|skb
suffix:semicolon
id|q-&gt;sqno_end
op_assign
id|sqno_end
suffix:semicolon
id|q-&gt;sqno_start
op_assign
id|sqno
suffix:semicolon
id|q-&gt;timer
op_assign
id|jiffies
op_plus
(paren
id|ISDN_TIMER_1SEC
)paren
op_star
l_int|5
suffix:semicolon
multiline_comment|/* timeout after 5 seconds */
r_if
c_cond
(paren
op_logical_neg
id|net_dev-&gt;ib.sq
)paren
(brace
id|net_dev-&gt;ib.sq
op_assign
id|q
suffix:semicolon
id|q-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sqqueue
op_star
id|ql
op_assign
id|net_dev-&gt;ib.sq
suffix:semicolon
r_if
c_cond
(paren
id|ql-&gt;sqno_start
OG
id|q-&gt;sqno_start
)paren
(brace
id|q-&gt;next
op_assign
id|ql
suffix:semicolon
id|net_dev-&gt;ib.sq
op_assign
id|q
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|ql-&gt;next
op_logical_and
id|ql-&gt;next-&gt;sqno_start
OL
id|q-&gt;sqno_start
)paren
id|ql
op_assign
id|ql-&gt;next
suffix:semicolon
id|q-&gt;next
op_assign
id|ql-&gt;next
suffix:semicolon
id|ql-&gt;next
op_assign
id|q
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * packet was &squot;in order&squot; .. push it higher&n;&t;&t;&t;&t; */
id|net_dev-&gt;ib.next_num
op_assign
id|sqno_end
op_plus
l_int|1
suffix:semicolon
id|isdn_ppp_push_higher
c_func
(paren
id|net_dev
comma
id|lp
comma
id|skb
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|isdn_ppp_cleanup_sqqueue
c_func
(paren
id|net_dev
comma
id|lp
comma
id|min_sqno
)paren
suffix:semicolon
id|net_dev-&gt;ib.modify
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|isdn_ppp_push_higher
c_func
(paren
id|net_dev
comma
id|lp
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|isdn_ppp_push_higher
c_func
(paren
id|net_dev
comma
id|lp
comma
id|skb
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * push frame to higher layers&n; * note: net_dev has to be master net_dev&n; */
r_static
r_void
DECL|function|isdn_ppp_push_higher
id|isdn_ppp_push_higher
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
op_amp
id|net_dev-&gt;dev
suffix:semicolon
r_struct
id|ippp_struct
op_star
id|is
op_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
suffix:semicolon
r_if
c_cond
(paren
id|proto
OL
l_int|0
)paren
(brace
multiline_comment|/* MP, oder normales Paket bei REJ_MP, MP Pakete gehen bei REJ zum pppd */
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0x01
)paren
(brace
multiline_comment|/* is it odd? */
id|proto
op_assign
(paren
r_int
r_char
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* protocol ID is only 8 bit */
)brace
r_else
(brace
id|proto
op_assign
(paren
(paren
r_int
)paren
(paren
r_int
r_char
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
r_int
r_char
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x10
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;push, skb %d %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|proto
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;rpush&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_IPX
suffix:colon
multiline_comment|/* untested */
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IPX&bslash;n&quot;
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_case
id|PPP_VJC_UNCOMP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: VJC_UNCOMP&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slhc_remember
c_func
(paren
id|ippp_table
(braket
id|net_dev-&gt;local.ppp_slot
)braket
op_member_access_from_pointer
id|slcomp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp: received illegal VJC_UNCOMP frame!&bslash;n&quot;
)paren
suffix:semicolon
id|net_dev-&gt;local.stats.rx_dropped
op_increment
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_case
id|PPP_IP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IP&bslash;n&quot;
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_VJC_COMP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: VJC_COMP&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
(brace
r_struct
id|sk_buff
op_star
id|skb_old
op_assign
id|skb
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|skb_old-&gt;len
op_plus
l_int|40
)paren
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|skb_old
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|net_dev-&gt;local.stats.rx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb_old
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|skb_old-&gt;len
op_plus
l_int|40
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|skb_old-&gt;data
comma
id|skb_old-&gt;len
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|pkt_len
op_assign
id|slhc_uncompress
c_func
(paren
id|ippp_table
(braket
id|net_dev-&gt;local.ppp_slot
)braket
op_member_access_from_pointer
id|slcomp
comma
id|skb-&gt;data
comma
id|skb_old-&gt;len
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb_old
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OL
l_int|0
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_trim
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
)brace
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Ooopsa .. VJ-Compression support not compiled into isdn driver.&bslash;n&quot;
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|isdn_ppp_fill_rq
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|proto
comma
id|lp-&gt;ppp_slot
)paren
suffix:semicolon
multiline_comment|/* push data to pppd device */
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* net_dev-&gt;local.stats.rx_packets++; */
multiline_comment|/* done in isdn_net.c */
multiline_comment|/* Reset hangup-timer */
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * send ppp frame .. we expect a PIDCOMPressable proto --&n; *  (here: currently always PPP_IP,PPP_VJC_COMP,PPP_VJC_UNCOMP)&n; *&n; * VJ compression may change skb pointer!!! .. requeue with old&n; * skb isn&squot;t allowed!!&n; */
r_int
DECL|function|isdn_ppp_xmit
id|isdn_ppp_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|device
op_star
id|mdev
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|master
suffix:semicolon
multiline_comment|/* get master (for redundancy) */
id|isdn_net_local
op_star
id|lp
comma
op_star
id|mlp
suffix:semicolon
id|isdn_net_dev
op_star
id|nd
suffix:semicolon
r_int
r_int
id|proto
op_assign
id|PPP_IP
suffix:semicolon
multiline_comment|/* 0x21 */
r_struct
id|ippp_struct
op_star
id|ipt
comma
op_star
id|ipts
suffix:semicolon
r_if
c_cond
(paren
id|mdev
)paren
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
(paren
id|mdev-&gt;priv
)paren
suffix:semicolon
r_else
(brace
id|mdev
op_assign
id|dev
suffix:semicolon
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
)brace
id|nd
op_assign
id|mlp-&gt;netdev
suffix:semicolon
multiline_comment|/* get master lp */
id|ipts
op_assign
id|ippp_table
(braket
id|mlp-&gt;ppp_slot
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipts-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
)paren
(brace
multiline_comment|/* PPP connected ? */
macro_line|#ifdef ISDN_SYNCPPP_READDRESS
r_if
c_cond
(paren
op_logical_neg
id|ipts-&gt;old_pa_addr
)paren
id|ipts-&gt;old_pa_addr
op_assign
id|mdev-&gt;pa_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipts-&gt;old_pa_dstaddr
)paren
id|ipts-&gt;old_pa_dstaddr
op_assign
id|mdev-&gt;pa_dstaddr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ipts-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: IP frame delayed.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
id|proto
op_assign
id|PPP_IP
suffix:semicolon
macro_line|#ifdef ISDN_SYNCPPP_READDRESS
r_if
c_cond
(paren
id|ipts-&gt;old_pa_addr
op_ne
id|mdev-&gt;pa_addr
)paren
(brace
r_struct
id|iphdr
op_star
id|ipfr
suffix:semicolon
id|ipfr
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|ipts-&gt;debug
op_amp
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IF-address changed from %lx to %lx&bslash;n&quot;
comma
id|ipts-&gt;old_pa_addr
comma
id|mdev-&gt;pa_addr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipfr-&gt;version
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|ipfr-&gt;saddr
op_eq
id|ipts-&gt;old_pa_addr
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;readdressing %lx to %lx&bslash;n&quot;
comma
id|ipfr-&gt;saddr
comma
id|mdev-&gt;pa_addr
)paren
suffix:semicolon
id|ipfr-&gt;saddr
op_assign
id|mdev-&gt;pa_addr
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* dstaddr change not so important */
macro_line|#endif
r_break
suffix:semicolon
r_case
id|ETH_P_IPX
suffix:colon
id|proto
op_assign
id|PPP_IPX
suffix:semicolon
multiline_comment|/* untested */
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_ppp: skipped frame with unsupported protocoll: %#x.&bslash;n&quot;
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|lp
op_assign
id|nd-&gt;queue
suffix:semicolon
multiline_comment|/* get lp on top of queue */
r_if
c_cond
(paren
id|lp-&gt;sav_skb
)paren
(brace
multiline_comment|/* find a non-busy device */
id|isdn_net_local
op_star
id|nlp
op_assign
id|lp-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;sav_skb
)paren
(brace
r_if
c_cond
(paren
id|lp
op_eq
id|nlp
)paren
r_return
l_int|1
suffix:semicolon
id|nlp
op_assign
id|nd-&gt;queue
op_assign
id|nd-&gt;queue-&gt;next
suffix:semicolon
)brace
id|lp
op_assign
id|nlp
suffix:semicolon
)brace
id|ipt
op_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
suffix:semicolon
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * after this line .. requeueing in the device queue is no longer allowed!!!&n;&t; */
r_if
c_cond
(paren
id|ipt-&gt;debug
op_amp
l_int|0x4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;xmit skb, len %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_IP
op_logical_and
id|ipts-&gt;pppcfg
op_amp
id|SC_COMP_TCP
)paren
(brace
multiline_comment|/* ipts here? probably yes .. but this check again */
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
id|new_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_skb
)paren
(brace
id|u_char
op_star
id|buf
suffix:semicolon
r_int
id|pktlen
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|new_skb
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|new_skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
id|pktlen
op_assign
id|slhc_compress
c_func
(paren
id|ipts-&gt;slcomp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|new_skb-&gt;data
comma
op_amp
id|buf
comma
op_logical_neg
(paren
id|ipts-&gt;pppcfg
op_amp
id|SC_NO_TCP_CCID
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_ne
id|skb-&gt;data
)paren
(brace
multiline_comment|/* copied to new buffer ??? (btw: WHY must slhc copy it?? *sigh*)  */
r_if
c_cond
(paren
id|new_skb-&gt;data
op_ne
id|buf
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_ppp: FATAL error after slhc_compress!!&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
r_else
(brace
id|dev_kfree_skb
c_func
(paren
id|new_skb
comma
l_int|0
multiline_comment|/* FREE_WRITE */
)paren
suffix:semicolon
)brace
id|skb_trim
c_func
(paren
id|skb
comma
id|pktlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
id|SL_TYPE_COMPRESSED_TCP
)paren
(brace
multiline_comment|/* cslip? style -&gt; PPP */
id|proto
op_assign
id|PPP_VJC_COMP
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_xor_assign
id|SL_TYPE_COMPRESSED_TCP
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_ge
id|SL_TYPE_UNCOMPRESSED_TCP
)paren
id|proto
op_assign
id|PPP_VJC_UNCOMP
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ipt-&gt;debug
op_amp
l_int|0x24
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;xmit2 skb, len %d, proto %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|proto
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|ipt-&gt;mpppcfg
op_amp
id|SC_MP_PROT
)paren
(brace
multiline_comment|/* we get mp_seqno from static isdn_net_local */
r_int
id|mp_seqno
op_assign
id|ipts-&gt;mp_seqno
suffix:semicolon
id|ipts-&gt;mp_seqno
op_increment
suffix:semicolon
id|nd-&gt;queue
op_assign
id|nd-&gt;queue-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ipt-&gt;mpppcfg
op_amp
id|SC_OUT_SHORT_SEQ
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
id|mp_seqno
op_and_assign
l_int|0xfff
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
op_or
(paren
id|mp_seqno
op_rshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/* (B)egin &amp; (E)ndbit .. */
id|data
(braket
l_int|1
)braket
op_assign
id|mp_seqno
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|proto
suffix:semicolon
multiline_comment|/* PID compression */
)brace
r_else
(brace
r_int
r_char
op_star
id|data
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|5
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
suffix:semicolon
multiline_comment|/* (B)egin &amp; (E)ndbit .. */
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* sequence number: 24bit */
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
id|proto
suffix:semicolon
multiline_comment|/* PID compression */
)brace
id|proto
op_assign
id|PPP_MP
suffix:semicolon
multiline_comment|/* MP Protocol, 0x003d */
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|ipt-&gt;pppcfg
op_amp
id|SC_COMP_PROT
)paren
op_logical_and
(paren
id|proto
op_le
l_int|0xff
)paren
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|proto
op_amp
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
r_int
r_char
op_star
id|data
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
(paren
id|proto
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|proto
op_amp
l_int|0xff
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipt-&gt;pppcfg
op_amp
id|SC_COMP_AC
)paren
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* All Stations */
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Unnumbered information */
)brace
multiline_comment|/* tx-stats are now updated via BSENT-callback */
r_if
c_cond
(paren
id|ipts-&gt;debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;skb xmit: len: %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_net_send_skb
c_func
(paren
id|dev
comma
id|lp
comma
id|skb
)paren
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;sav_skb
)paren
(brace
multiline_comment|/* whole sav_skb processing with disabled IRQs ?? */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: whoops .. there is another stored skb!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_else
id|lp-&gt;sav_skb
op_assign
id|skb
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_MPP
r_static
r_void
DECL|function|isdn_ppp_free_sqqueue
id|isdn_ppp_free_sqqueue
c_func
(paren
id|isdn_net_dev
op_star
id|p
)paren
(brace
r_struct
id|sqqueue
op_star
id|q
op_assign
id|p-&gt;ib.sq
suffix:semicolon
id|p-&gt;ib.sq
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
r_struct
id|sqqueue
op_star
id|qn
op_assign
id|q-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;skb
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|q-&gt;skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|q-&gt;skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
id|qn
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|isdn_ppp_free_mpqueue
id|isdn_ppp_free_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
id|p
)paren
(brace
r_struct
id|mpqueue
op_star
id|q
op_assign
id|p-&gt;mp_last
suffix:semicolon
id|p-&gt;mp_last
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
r_struct
id|mpqueue
op_star
id|ql
op_assign
id|q-&gt;next
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|q-&gt;skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|q-&gt;skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
id|ql
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|isdn_ppp_bundle
id|isdn_ppp_bundle
c_func
(paren
r_struct
id|ippp_struct
op_star
id|is
comma
r_int
id|unit
)paren
(brace
r_char
id|ifn
(braket
id|IFNAMSIZ
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|isdn_net_dev
op_star
id|p
suffix:semicolon
id|isdn_net_local
op_star
id|lp
comma
op_star
id|nlp
suffix:semicolon
id|sprintf
c_func
(paren
id|ifn
comma
l_string|&quot;ippp%d&quot;
comma
id|unit
)paren
suffix:semicolon
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|ifn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|isdn_timer_ctrl
c_func
(paren
id|ISDN_TIMER_IPPP
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* enable timer for ippp/MP */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|nlp
op_assign
id|is-&gt;lp
suffix:semicolon
id|lp
op_assign
id|p-&gt;queue
suffix:semicolon
id|p-&gt;ib.bundled
op_assign
l_int|1
suffix:semicolon
id|nlp-&gt;last
op_assign
id|lp-&gt;last
suffix:semicolon
id|lp-&gt;last-&gt;next
op_assign
id|nlp
suffix:semicolon
id|lp-&gt;last
op_assign
id|nlp
suffix:semicolon
id|nlp-&gt;next
op_assign
id|lp
suffix:semicolon
id|p-&gt;queue
op_assign
id|nlp
suffix:semicolon
id|ippp_table
(braket
id|nlp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|unit
op_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|unit
suffix:semicolon
multiline_comment|/* maybe also SC_CCP stuff */
id|ippp_table
(braket
id|nlp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|pppcfg
op_or_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|pppcfg
op_amp
(paren
id|SC_ENABLE_IP
op_or
id|SC_NO_TCP_CCID
op_or
id|SC_REJ_COMP_TCP
)paren
suffix:semicolon
id|ippp_table
(braket
id|nlp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
op_or_assign
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
op_amp
(paren
id|SC_MP_PROT
op_or
id|SC_REJ_MP_PROT
op_or
id|SC_OUT_SHORT_SEQ
op_or
id|SC_IN_SHORT_SEQ
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|ippp_table
(braket
id|nlp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
op_ne
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_bundle: different MP options %04x and %04x&bslash;n&quot;
comma
id|ippp_table
(braket
id|nlp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
comma
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
)paren
suffix:semicolon
)brace
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_mask_queue
id|isdn_ppp_mask_queue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
r_int
id|mask
)paren
(brace
r_struct
id|mpqueue
op_star
id|q
op_assign
id|dev-&gt;mp_last
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
id|q-&gt;sqno
op_and_assign
id|mask
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|isdn_ppp_fill_mpqueue
id|isdn_ppp_fill_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
op_star
id|skb
comma
r_int
id|BEbyte
comma
r_int
op_star
id|sqnop
comma
r_int
id|min_sqno
)paren
(brace
r_struct
id|mpqueue
op_star
id|qe
comma
op_star
id|q1
comma
op_star
id|q
suffix:semicolon
r_int
id|cnt
comma
id|flags
suffix:semicolon
r_int
id|pktlen
comma
id|sqno_end
suffix:semicolon
r_int
id|sqno
op_assign
op_star
id|sqnop
suffix:semicolon
id|q1
op_assign
(paren
r_struct
id|mpqueue
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mpqueue
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_fill_mpqueue: Can&squot;t alloc struct memory.&bslash;n&quot;
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|dev
comma
id|min_sqno
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|q1-&gt;skb
op_assign
op_star
id|skb
suffix:semicolon
id|q1-&gt;sqno
op_assign
id|sqno
suffix:semicolon
id|q1-&gt;BEbyte
op_assign
id|BEbyte
suffix:semicolon
id|q1-&gt;time
op_assign
id|jiffies
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|q
op_assign
id|dev-&gt;mp_last
)paren
)paren
(brace
id|dev-&gt;mp_last
op_assign
id|q1
suffix:semicolon
id|q1-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|q1-&gt;last
op_assign
l_int|NULL
suffix:semicolon
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|dev
comma
id|min_sqno
)paren
suffix:semicolon
multiline_comment|/* not necessary */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* -1 is not an error. Just says, that this fragment hasn&squot;t complete a full frame */
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
multiline_comment|/* the faster way would be to step from the queue-end to the start */
r_if
c_cond
(paren
id|sqno
OG
id|q-&gt;sqno
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;next
)paren
(brace
id|q
op_assign
id|q-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|q-&gt;next
op_assign
id|q1
suffix:semicolon
id|q1-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|q1-&gt;last
op_assign
id|q
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sqno
op_eq
id|q-&gt;sqno
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_fill_mpqueue: illegal sqno received!!&bslash;n&quot;
)paren
suffix:semicolon
id|q1-&gt;last
op_assign
id|q-&gt;last
suffix:semicolon
id|q1-&gt;next
op_assign
id|q
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;last
)paren
(brace
id|q-&gt;last-&gt;next
op_assign
id|q1
suffix:semicolon
)brace
r_else
id|dev-&gt;mp_last
op_assign
id|q1
suffix:semicolon
id|q-&gt;last
op_assign
id|q1
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* now we check whether we completed a packet with this fragment */
id|pktlen
op_assign
op_minus
id|q1-&gt;skb-&gt;len
suffix:semicolon
id|q
op_assign
id|q1
suffix:semicolon
id|cnt
op_assign
id|q1-&gt;sqno
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|q-&gt;BEbyte
op_amp
id|MP_END_FRAG
)paren
)paren
(brace
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|q-&gt;next
)paren
op_logical_or
id|q-&gt;next-&gt;sqno
op_ne
id|cnt
)paren
(brace
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|dev
comma
id|min_sqno
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pktlen
op_add_assign
id|q-&gt;skb-&gt;len
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|pktlen
op_add_assign
id|q-&gt;skb-&gt;len
suffix:semicolon
id|qe
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|q1
suffix:semicolon
id|cnt
op_assign
id|q1-&gt;sqno
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|q-&gt;BEbyte
op_amp
id|MP_BEGIN_FRAG
)paren
)paren
(brace
id|cnt
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|q-&gt;last
)paren
op_logical_or
id|q-&gt;last-&gt;sqno
op_ne
id|cnt
)paren
(brace
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|dev
comma
id|min_sqno
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pktlen
op_add_assign
id|q-&gt;skb-&gt;len
suffix:semicolon
id|q
op_assign
id|q-&gt;last
suffix:semicolon
)brace
id|pktlen
op_add_assign
id|q-&gt;skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;last
)paren
id|q-&gt;last-&gt;next
op_assign
id|qe-&gt;next
suffix:semicolon
r_else
id|dev-&gt;mp_last
op_assign
id|qe-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|qe-&gt;next
)paren
id|qe-&gt;next-&gt;last
op_assign
id|q-&gt;last
suffix:semicolon
id|qe-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|sqno_end
op_assign
id|qe-&gt;sqno
suffix:semicolon
op_star
id|sqnop
op_assign
id|q-&gt;sqno
suffix:semicolon
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|dev
comma
id|min_sqno
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pktlen
op_plus
l_int|40
)paren
suffix:semicolon
multiline_comment|/* not needed: +40 for VJ compression .. */
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|skb
)paren
)paren
(brace
r_while
c_loop
(paren
id|q
)paren
(brace
r_struct
id|mpqueue
op_star
id|ql
op_assign
id|q-&gt;next
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|q-&gt;skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|q-&gt;skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
id|ql
suffix:semicolon
)brace
r_return
op_minus
l_int|2
suffix:semicolon
)brace
id|cnt
op_assign
l_int|0
suffix:semicolon
id|skb_put
c_func
(paren
op_star
id|skb
comma
id|pktlen
)paren
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
r_struct
id|mpqueue
op_star
id|ql
op_assign
id|q-&gt;next
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
id|cnt
comma
id|q-&gt;skb-&gt;data
comma
id|q-&gt;skb-&gt;len
)paren
suffix:semicolon
id|cnt
op_add_assign
id|q-&gt;skb-&gt;len
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|q-&gt;skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|q-&gt;skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
id|ql
suffix:semicolon
)brace
r_return
id|sqno_end
suffix:semicolon
)brace
multiline_comment|/*&n; * check sq-queue, whether we have still buffered the next packet(s)&n; * or packets with a sqno less or equal to min_sqno&n; * net_dev: master netdevice , lp: &squot;real&squot; local connection&n; */
r_static
r_void
DECL|function|isdn_ppp_cleanup_sqqueue
id|isdn_ppp_cleanup_sqqueue
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_int
id|min_sqno
)paren
(brace
r_struct
id|sqqueue
op_star
id|q
suffix:semicolon
r_while
c_loop
(paren
(paren
id|q
op_assign
id|net_dev-&gt;ib.sq
)paren
op_logical_and
(paren
id|q-&gt;sqno_start
op_eq
id|net_dev-&gt;ib.next_num
op_logical_or
id|q-&gt;sqno_end
op_le
id|min_sqno
)paren
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;sqno_start
op_ne
id|net_dev-&gt;ib.next_num
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: MP, stepping over missing frame: %ld&bslash;n&quot;
comma
id|net_dev-&gt;ib.next_num
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|slhc_toss
c_func
(paren
id|ippp_table
(braket
id|net_dev-&gt;local.ppp_slot
)braket
op_member_access_from_pointer
id|slcomp
)paren
suffix:semicolon
macro_line|#endif
)brace
id|isdn_ppp_push_higher
c_func
(paren
id|net_dev
comma
id|lp
comma
id|q-&gt;skb
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|net_dev-&gt;ib.sq
op_assign
id|q-&gt;next
suffix:semicolon
id|net_dev-&gt;ib.next_num
op_assign
id|q-&gt;sqno_end
op_plus
l_int|1
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * remove stale packets from list&n; */
r_static
r_void
DECL|function|isdn_ppp_cleanup_mpqueue
id|isdn_ppp_cleanup_mpqueue
c_func
(paren
id|isdn_net_dev
op_star
id|dev
comma
r_int
id|min_sqno
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_int
id|toss
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* z.z einfaches aussortieren gammeliger pakete. Fuer die Zukunft:&n;   eventuell, solange vorne kein B-paket ist und sqno&lt;=min_sqno: auch rauswerfen&n;   wenn sqno&lt;min_sqno und Luecken vorhanden sind: auch weg (die koennen nicht mehr gefuellt werden)&n;   bei paketen groesser min_sqno: ueber mp_mrru: wenn summe ueber pktlen der rumhaengenden Pakete&n;   groesser als mrru ist: raus damit , Pakete muessen allerdings zusammenhaengen sonst koennte&n;   ja ein Paket mit B und eins mit E dazwischenpassen */
r_struct
id|mpqueue
op_star
id|ql
comma
op_star
id|q
op_assign
id|dev-&gt;mp_last
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;sqno
OL
id|min_sqno
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;BEbyte
op_amp
id|MP_END_FRAG
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: freeing stale packet!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;mp_last
op_assign
id|q-&gt;next
)paren
)paren
id|q-&gt;next-&gt;last
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
id|ql
op_assign
id|q-&gt;last
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|q-&gt;skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|q-&gt;skb
comma
l_int|0
multiline_comment|/* FREE_READ */
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|toss
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|q
op_assign
id|ql
suffix:semicolon
)brace
id|q
op_assign
id|dev-&gt;mp_last
suffix:semicolon
)brace
r_else
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
multiline_comment|/* did we free a stale frame ? */
r_if
c_cond
(paren
id|toss
)paren
id|slhc_toss
c_func
(paren
id|ippp_table
(braket
id|dev-&gt;local.ppp_slot
)braket
op_member_access_from_pointer
id|slcomp
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * a buffered packet timed-out?&n; */
macro_line|#endif
r_void
DECL|function|isdn_ppp_timer_timeout
id|isdn_ppp_timer_timeout
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_dev
op_star
id|net_dev
op_assign
id|dev-&gt;netdev
suffix:semicolon
r_struct
id|sqqueue
op_star
id|q
comma
op_star
id|ql
op_assign
l_int|NULL
comma
op_star
id|qn
suffix:semicolon
r_while
c_loop
(paren
id|net_dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|net_dev-&gt;local
suffix:semicolon
r_if
c_cond
(paren
id|net_dev-&gt;ib.modify
op_logical_or
id|lp-&gt;master
)paren
(brace
multiline_comment|/* interface locked or slave? */
id|net_dev
op_assign
id|net_dev-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|q
op_assign
id|net_dev-&gt;ib.sq
suffix:semicolon
r_while
c_loop
(paren
id|q
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;sqno_start
op_eq
id|net_dev-&gt;ib.next_num
op_logical_or
id|q-&gt;timer
OL
id|jiffies
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
multiline_comment|/* did we step over a missing frame ? */
r_if
c_cond
(paren
id|q-&gt;sqno_start
op_ne
id|net_dev-&gt;ib.next_num
)paren
id|slhc_toss
c_func
(paren
id|ippp_table
(braket
id|lp-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|slcomp
)paren
suffix:semicolon
macro_line|#endif
id|ql
op_assign
id|net_dev-&gt;ib.sq
suffix:semicolon
id|net_dev-&gt;ib.sq
op_assign
id|q-&gt;next
suffix:semicolon
id|net_dev-&gt;ib.next_num
op_assign
id|q-&gt;sqno_end
op_plus
l_int|1
suffix:semicolon
id|q-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|ql
suffix:semicolon
)paren
(brace
id|isdn_ppp_push_higher
c_func
(paren
id|net_dev
comma
id|lp
comma
id|ql-&gt;skb
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|qn
op_assign
id|ql-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|ql
)paren
suffix:semicolon
id|ql
op_assign
id|qn
suffix:semicolon
)brace
id|q
op_assign
id|net_dev-&gt;ib.sq
suffix:semicolon
)brace
r_else
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|net_dev
op_assign
id|net_dev-&gt;next
suffix:semicolon
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * network device ioctl handlers&n; */
r_static
r_int
DECL|function|isdn_ppp_dev_ioctl_stats
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
r_int
id|slot
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|ppp_stats
op_star
id|res
comma
id|t
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|res
op_assign
(paren
r_struct
id|ppp_stats
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|res
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* build a temporary stat struct and copy it to user space */
id|memset
c_func
(paren
op_amp
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|t.p.ppp_ipackets
op_assign
id|lp-&gt;stats.rx_packets
suffix:semicolon
id|t.p.ppp_ierrors
op_assign
id|lp-&gt;stats.rx_errors
suffix:semicolon
id|t.p.ppp_opackets
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
id|t.p.ppp_oerrors
op_assign
id|lp-&gt;stats.tx_errors
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_if
c_cond
(paren
id|slot
op_ge
l_int|0
op_logical_and
id|ippp_table
(braket
id|slot
)braket
op_member_access_from_pointer
id|slcomp
)paren
(brace
r_struct
id|slcompress
op_star
id|slcomp
op_assign
id|ippp_table
(braket
id|slot
)braket
op_member_access_from_pointer
id|slcomp
suffix:semicolon
id|t.vj.vjs_packets
op_assign
id|slcomp-&gt;sls_o_compressed
op_plus
id|slcomp-&gt;sls_o_uncompressed
suffix:semicolon
id|t.vj.vjs_compressed
op_assign
id|slcomp-&gt;sls_o_compressed
suffix:semicolon
id|t.vj.vjs_searches
op_assign
id|slcomp-&gt;sls_o_searches
suffix:semicolon
id|t.vj.vjs_misses
op_assign
id|slcomp-&gt;sls_o_misses
suffix:semicolon
id|t.vj.vjs_errorin
op_assign
id|slcomp-&gt;sls_i_error
suffix:semicolon
id|t.vj.vjs_tossed
op_assign
id|slcomp-&gt;sls_i_tossed
suffix:semicolon
id|t.vj.vjs_uncompressedin
op_assign
id|slcomp-&gt;sls_i_uncompressed
suffix:semicolon
id|t.vj.vjs_compressedin
op_assign
id|slcomp-&gt;sls_i_compressed
suffix:semicolon
)brace
macro_line|#endif
)brace
r_return
id|copy_to_user
c_func
(paren
id|res
comma
op_amp
id|t
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|isdn_ppp_dev_ioctl
id|isdn_ppp_dev_ioctl
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_int
id|error
suffix:semicolon
r_char
op_star
id|r
suffix:semicolon
r_int
id|len
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp, dev_ioctl: cmd %#08x , %d &bslash;n&quot;
comma
id|cmd
comma
id|lp-&gt;ppp_slot
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_ne
id|ISDN_NET_ENCAP_SYNCPPP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGPPPVER
suffix:colon
id|r
op_assign
(paren
r_char
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|PPP_VERSION
)paren
op_plus
l_int|1
suffix:semicolon
id|error
op_assign
id|copy_to_user
c_func
(paren
id|r
comma
id|PPP_VERSION
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGPPPSTATS
suffix:colon
id|error
op_assign
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
id|lp-&gt;ppp_slot
comma
id|ifr
comma
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ppp_if_get_unit
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_int
id|len
comma
id|i
comma
id|unit
op_assign
l_int|0
comma
id|deci
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;ippp&quot;
comma
id|name
comma
l_int|4
)paren
op_logical_or
id|len
OG
l_int|8
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|deci
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
comma
id|deci
op_mul_assign
l_int|10
)paren
(brace
r_char
id|a
op_assign
id|name
(braket
id|len
op_minus
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ge
l_char|&squot;0&squot;
op_logical_and
id|a
op_le
l_char|&squot;9&squot;
)paren
id|unit
op_add_assign
(paren
id|a
op_minus
l_char|&squot;0&squot;
)paren
op_star
id|deci
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_or
id|len
op_minus
id|i
op_ne
l_int|4
)paren
id|unit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|unit
suffix:semicolon
)brace
r_int
DECL|function|isdn_ppp_dial_slave
id|isdn_ppp_dial_slave
c_func
(paren
r_char
op_star
id|name
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_dev
op_star
id|ndev
suffix:semicolon
id|isdn_net_local
op_star
id|lp
suffix:semicolon
r_struct
id|device
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ndev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|lp
op_assign
op_amp
id|ndev-&gt;local
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CONNECTED
)paren
)paren
r_return
l_int|5
suffix:semicolon
id|sdev
op_assign
id|lp-&gt;slave
suffix:semicolon
r_while
c_loop
(paren
id|sdev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|sdev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CONNECTED
)paren
)paren
r_break
suffix:semicolon
id|sdev
op_assign
id|mlp-&gt;slave
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sdev
)paren
r_return
l_int|2
suffix:semicolon
id|isdn_net_force_dial_lp
c_func
(paren
(paren
id|isdn_net_local
op_star
)paren
id|sdev-&gt;priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|isdn_ppp_hangup_slave
id|isdn_ppp_hangup_slave
c_func
(paren
r_char
op_star
id|name
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_dev
op_star
id|ndev
suffix:semicolon
id|isdn_net_local
op_star
id|lp
suffix:semicolon
r_struct
id|device
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ndev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|lp
op_assign
op_amp
id|ndev-&gt;local
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CONNECTED
)paren
)paren
r_return
l_int|5
suffix:semicolon
id|sdev
op_assign
id|lp-&gt;slave
suffix:semicolon
r_while
c_loop
(paren
id|sdev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|sdev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CONNECTED
)paren
)paren
r_break
suffix:semicolon
id|sdev
op_assign
id|mlp-&gt;slave
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sdev
)paren
r_return
l_int|2
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|sdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
)brace
DECL|function|isdn_ppp_register_compressor
r_int
id|isdn_ppp_register_compressor
c_func
(paren
r_struct
id|isdn_ppp_compressor
op_star
id|ipc
)paren
(brace
id|ipc-&gt;next
op_assign
id|ipc_head
suffix:semicolon
id|ipc-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ipc_head
)paren
(brace
id|ipc_head-&gt;prev
op_assign
id|ipc
suffix:semicolon
)brace
id|ipc_head
op_assign
id|ipc
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isdn_ppp_unregister_compressor
r_int
id|isdn_ppp_unregister_compressor
c_func
(paren
r_struct
id|isdn_ppp_compressor
op_star
id|ipc
)paren
(brace
r_if
c_cond
(paren
id|ipc-&gt;prev
)paren
(brace
id|ipc-&gt;prev-&gt;next
op_assign
id|ipc-&gt;next
suffix:semicolon
)brace
r_else
id|ipc_head
op_assign
id|ipc-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ipc-&gt;next
)paren
(brace
id|ipc-&gt;next-&gt;prev
op_assign
id|ipc-&gt;prev
suffix:semicolon
)brace
id|ipc-&gt;prev
op_assign
id|ipc-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isdn_ppp_set_compressor
r_static
r_int
id|isdn_ppp_set_compressor
c_func
(paren
r_struct
id|ippp_struct
op_star
id|is
comma
r_int
id|num
)paren
(brace
r_struct
id|isdn_ppp_compressor
op_star
id|ipc
op_assign
id|ipc_head
suffix:semicolon
r_while
c_loop
(paren
id|ipc
)paren
(brace
r_if
c_cond
(paren
id|ipc-&gt;num
op_eq
id|num
)paren
(brace
r_return
l_int|0
suffix:semicolon
id|is-&gt;compressor
op_assign
id|ipc
suffix:semicolon
)brace
id|ipc
op_assign
id|ipc-&gt;next
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_struct
id|symbol_table
id|isdn_ppp_syms
op_assign
(brace
macro_line|#include &lt;linux/symtab_begin.h&gt;
id|X
c_func
(paren
id|isdn_ppp_register_compressor
)paren
comma
id|X
c_func
(paren
id|isdn_ppp_unregister_compressor
)paren
comma
macro_line|#include &lt;linux/symtab_end.h&gt;
)brace
suffix:semicolon
macro_line|#endif
eof
