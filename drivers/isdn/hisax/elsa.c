multiline_comment|/* $Id: elsa.c,v 1.8 1997/01/27 15:51:48 keil Exp $&n;&n; * elsa.c     low level stuff for Elsa isdn cards&n; *&n; * Author     Karsten Keil (keil@temic-ech.spacenet.de)&n; *&n; * Thanks to    Elsa GmbH for documents and informations&n; *&n; *&n; * $Log: elsa.c,v $&n; * Revision 1.8  1997/01/27 15:51:48  keil&n; * SMP proof,cosmetics&n; *&n; * Revision 1.7  1997/01/21 22:20:48  keil&n; * Elsa Quickstep support&n; *&n; * Revision 1.6  1997/01/09 18:22:46  keil&n; * one more PCC-8 fix&n; *&n; * Revision 1.5  1996/12/08 19:46:14  keil&n; * PCC-8 correct IRQs; starting ARCOFI support&n; *&n; * Revision 1.4  1996/11/18 20:50:54  keil&n; * with PCF Pro release 16 Byte IO&n; *&n; * Revision 1.3  1996/11/18 15:33:04  keil&n; * PCC and PCFPro support&n; *&n; * Revision 1.2  1996/10/27 22:08:03  keil&n; * cosmetic changes&n; *&n; * Revision 1.1  1996/10/13 20:04:52  keil&n; * Initial revision&n; *&n; *&n; */
DECL|macro|ARCOFI_USE
mdefine_line|#define ARCOFI_USE&t;0
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;siemens.h&quot;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;elsa.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/kernel_stat.h&gt;
r_extern
r_const
r_char
op_star
id|CardType
(braket
)braket
suffix:semicolon
DECL|variable|Elsa_revision
r_const
r_char
op_star
id|Elsa_revision
op_assign
l_string|&quot;$Revision: 1.8 $&quot;
suffix:semicolon
DECL|variable|Elsa_Types
r_const
r_char
op_star
id|Elsa_Types
(braket
)braket
op_assign
(brace
l_string|&quot;None&quot;
comma
l_string|&quot;PCC-8&quot;
comma
l_string|&quot;PCF-Pro&quot;
comma
l_string|&quot;PCC-16&quot;
comma
l_string|&quot;PCF&quot;
comma
l_string|&quot;QS 1000&quot;
)brace
suffix:semicolon
DECL|macro|byteout
mdefine_line|#define byteout(addr,val) outb_p(val,addr)
DECL|macro|bytein
mdefine_line|#define bytein(addr) inb_p(addr)
r_static
r_inline
id|byte
DECL|function|readhscx
id|readhscx
c_func
(paren
r_int
r_int
id|adr
comma
r_int
id|hscx
comma
id|byte
id|off
)paren
(brace
r_register
id|byte
id|ret
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
id|off
op_plus
(paren
id|hscx
ques
c_cond
l_int|0x60
suffix:colon
l_int|0x20
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|bytein
c_func
(paren
id|adr
op_plus
id|CARD_HSCX
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|read_fifo_hscx
id|read_fifo_hscx
c_func
(paren
r_int
r_int
id|adr
comma
r_int
id|hscx
comma
id|byte
op_star
id|data
comma
r_int
id|size
)paren
(brace
multiline_comment|/* fifo read without cli because it&squot;s allready done  */
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
(paren
id|hscx
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|insb
c_func
(paren
id|adr
op_plus
id|CARD_HSCX
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|writehscx
id|writehscx
c_func
(paren
r_int
r_int
id|adr
comma
r_int
id|hscx
comma
id|byte
id|off
comma
id|byte
id|data
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
id|off
op_plus
(paren
id|hscx
ques
c_cond
l_int|0x60
suffix:colon
l_int|0x20
)paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_HSCX
comma
id|data
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|write_fifo_hscx
id|write_fifo_hscx
c_func
(paren
r_int
r_int
id|adr
comma
r_int
id|hscx
comma
id|byte
op_star
id|data
comma
r_int
id|size
)paren
(brace
multiline_comment|/* fifo write without cli because it&squot;s allready done  */
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
(paren
id|hscx
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|outsb
c_func
(paren
id|adr
op_plus
id|CARD_HSCX
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
id|byte
DECL|function|readisac
id|readisac
c_func
(paren
r_int
r_int
id|adr
comma
id|byte
id|off
)paren
(brace
r_register
id|byte
id|ret
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
id|off
op_plus
l_int|0x20
)paren
suffix:semicolon
id|ret
op_assign
id|bytein
c_func
(paren
id|adr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|read_fifo_isac
id|read_fifo_isac
c_func
(paren
r_int
r_int
id|adr
comma
id|byte
op_star
id|data
comma
r_int
id|size
)paren
(brace
multiline_comment|/* fifo read without cli because it&squot;s allready done  */
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
l_int|0
)paren
suffix:semicolon
id|insb
c_func
(paren
id|adr
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|writeisac
id|writeisac
c_func
(paren
r_int
r_int
id|adr
comma
id|byte
id|off
comma
id|byte
id|data
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
id|off
op_plus
l_int|0x20
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|adr
comma
id|data
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|write_fifo_isac
id|write_fifo_isac
c_func
(paren
r_int
r_int
id|adr
comma
id|byte
op_star
id|data
comma
r_int
id|size
)paren
(brace
multiline_comment|/* fifo write without cli because it&squot;s allready done  */
id|byteout
c_func
(paren
id|adr
op_plus
id|CARD_ALE
comma
l_int|0
)paren
suffix:semicolon
id|outsb
c_func
(paren
id|adr
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|TimerRun
id|TimerRun
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_register
id|byte
id|val
suffix:semicolon
id|val
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;subtyp
op_eq
id|ELSA_QS1000
)paren
r_return
(paren
l_int|0
op_eq
(paren
id|val
op_amp
id|TIMER_RUN
)paren
)paren
suffix:semicolon
r_return
(paren
(paren
id|val
op_amp
id|TIMER_RUN
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|elsa_led_handler
id|elsa_led_handler
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
id|byte
id|outval
op_assign
l_int|0xf0
suffix:semicolon
r_int
id|stat
op_assign
l_int|0
comma
id|cval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;ph_state
op_eq
l_int|0
)paren
op_logical_or
(paren
id|sp-&gt;ph_state
op_eq
l_int|15
)paren
)paren
(brace
id|stat
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sp-&gt;hs
(braket
l_int|0
)braket
dot
id|mode
op_ne
l_int|0
)paren
id|stat
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;hs
(braket
l_int|1
)braket
dot
id|mode
op_ne
l_int|0
)paren
id|stat
op_or_assign
l_int|4
suffix:semicolon
)brace
id|cval
op_assign
(paren
id|sp-&gt;counter
op_rshift
l_int|6
)paren
op_amp
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|cval
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
id|outval
op_or_assign
id|STAT_LED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|1
)paren
id|outval
op_or_assign
id|LINE_LED
op_or
id|STAT_LED
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|stat
op_amp
l_int|2
)paren
id|outval
op_or_assign
id|STAT_LED
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
l_int|4
)paren
id|outval
op_or_assign
id|LINE_LED
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
id|outval
op_or_assign
id|LINE_LED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|1
)paren
id|outval
op_or_assign
id|LINE_LED
op_or
id|STAT_LED
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|stat
op_amp
l_int|2
)paren
id|outval
op_or_assign
id|STAT_LED
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
l_int|4
)paren
id|outval
op_or_assign
id|LINE_LED
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
id|outval
op_or_assign
id|STAT_LED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|1
)paren
id|outval
op_or_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|stat
op_amp
l_int|2
)paren
id|outval
op_or_assign
id|STAT_LED
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
l_int|4
)paren
id|outval
op_or_assign
id|LINE_LED
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
id|outval
op_or_assign
id|LINE_LED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|byteout
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONTROL
comma
id|outval
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|waitforCEC
id|waitforCEC
c_func
(paren
r_int
id|adr
comma
r_int
id|hscx
)paren
(brace
r_int
id|to
op_assign
l_int|50
suffix:semicolon
r_while
c_loop
(paren
(paren
id|readhscx
c_func
(paren
id|adr
comma
id|hscx
comma
id|HSCX_STAR
)paren
op_amp
l_int|0x04
)paren
op_logical_and
id|to
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|to
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|to
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: waitforCEC timeout&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|waitforXFW
id|waitforXFW
c_func
(paren
r_int
id|adr
comma
r_int
id|hscx
)paren
(brace
r_int
id|to
op_assign
l_int|50
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|readhscx
c_func
(paren
id|adr
comma
id|hscx
comma
id|HSCX_STAR
)paren
op_amp
l_int|0x44
)paren
op_eq
l_int|0x40
)paren
op_logical_and
id|to
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|to
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|to
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: waitforXFW timeout&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|writehscxCMDR
id|writehscxCMDR
c_func
(paren
r_int
id|adr
comma
r_int
id|hscx
comma
id|byte
id|data
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|waitforCEC
c_func
(paren
id|adr
comma
id|hscx
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|adr
comma
id|hscx
comma
id|HSCX_CMDR
comma
id|data
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fast interrupt here&n; */
r_static
r_void
DECL|function|hscxreport
id|hscxreport
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
id|hscx
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HSCX %d&bslash;n&quot;
comma
id|hscx
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISTA %x&bslash;n&quot;
comma
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_ISTA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;STAR %x&bslash;n&quot;
comma
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_STAR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;EXIR %x&bslash;n&quot;
comma
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_EXIR
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|elsa_report
id|elsa_report
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISAC&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISTA %x&bslash;n&quot;
comma
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_ISTA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;STAR %x&bslash;n&quot;
comma
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_STAR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;EXIR %x&bslash;n&quot;
comma
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_EXIR
)paren
)paren
suffix:semicolon
id|hscxreport
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
id|hscxreport
c_func
(paren
id|sp
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * HSCX stuff goes here&n; */
r_static
r_void
DECL|function|hscx_empty_fifo
id|hscx_empty_fifo
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
comma
r_int
id|count
)paren
(brace
id|byte
op_star
id|ptr
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|hsp-&gt;sp
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|hsp-&gt;rcvibh
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;hscx_empty_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;rcvptr
op_plus
id|count
OG
id|BUFFER_SIZE
c_func
(paren
id|HSCX_RBUF_ORDER
comma
id|HSCX_RBUF_BPPS
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;hscx_empty_fifo: incoming packet too large&quot;
)paren
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x80
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|hsp-&gt;rcvptr
suffix:semicolon
id|hsp-&gt;rcvptr
op_add_assign
id|count
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|read_fifo_hscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x80
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;hscx_empty_fifo %c cnt %d&quot;
comma
id|hsp-&gt;hscx
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|hscx_fill_fifo
id|hscx_fill_fifo
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|hsp-&gt;sp
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
suffix:semicolon
r_int
id|more
comma
id|count
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;hscx_fill_fifo&quot;
)paren
suffix:semicolon
id|ibh
op_assign
id|hsp-&gt;xmtibh
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibh
)paren
r_return
suffix:semicolon
id|count
op_assign
id|ibh-&gt;datasize
op_minus
id|hsp-&gt;sendptr
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|more
op_assign
(paren
id|hsp-&gt;mode
op_eq
l_int|1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|32
)paren
(brace
id|more
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|count
op_assign
l_int|32
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|hsp-&gt;sendptr
suffix:semicolon
id|hsp-&gt;sendptr
op_add_assign
id|count
suffix:semicolon
id|waitforXFW
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|write_fifo_hscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
id|more
ques
c_cond
l_int|0x8
suffix:colon
l_int|0xa
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;hscx_fill_fifo %c cnt %d&quot;
comma
id|hsp-&gt;hscx
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hscx_interrupt
id|hscx_interrupt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
id|byte
id|val
comma
id|byte
id|hscx
)paren
(brace
id|byte
id|r
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|hscx
suffix:semicolon
r_int
id|count
comma
id|err
suffix:semicolon
r_char
id|tmp
(braket
l_int|32
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;init
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* RME */
id|r
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
id|HSCX_RSTA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_amp
l_int|0xf0
)paren
op_ne
l_int|0xa0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|r
op_amp
l_int|0x80
)paren
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;HSCX invalid frame&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_amp
l_int|0x40
)paren
op_logical_and
id|hsp-&gt;mode
)paren
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX RDO mode=%d&quot;
comma
id|hsp-&gt;mode
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|r
op_amp
l_int|0x20
)paren
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;HSCX CRC error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;rcvibh
)paren
id|BufPoolRelease
c_func
(paren
id|hsp-&gt;rcvibh
)paren
suffix:semicolon
id|hsp-&gt;rcvibh
op_assign
l_int|NULL
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRME
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;rcvibh
)paren
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
id|hsp-&gt;rcvibh
comma
op_amp
id|hsp-&gt;rbufpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;HSCX RME out of buffers&quot;
)paren
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRME
suffix:semicolon
)brace
r_else
id|hsp-&gt;rcvptr
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
id|HSCX_RBCL
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|count
op_assign
l_int|32
suffix:semicolon
id|hscx_empty_fifo
c_func
(paren
id|hsp
comma
id|count
)paren
suffix:semicolon
id|hsp-&gt;rcvibh-&gt;datasize
op_assign
id|hsp-&gt;rcvptr
op_minus
l_int|1
suffix:semicolon
id|BufQueueLink
c_func
(paren
op_amp
id|hsp-&gt;rq
comma
id|hsp-&gt;rcvibh
)paren
suffix:semicolon
id|hsp-&gt;rcvibh
op_assign
l_int|NULL
suffix:semicolon
id|hscx_sched_event
c_func
(paren
id|hsp
comma
id|HSCX_RCVBUFREADY
)paren
suffix:semicolon
)brace
id|afterRME
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* RPF */
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;rcvibh
)paren
(brace
r_if
c_cond
(paren
id|hsp-&gt;mode
op_eq
l_int|1
)paren
id|err
op_assign
id|BufPoolGet
c_func
(paren
op_amp
id|hsp-&gt;rcvibh
comma
op_amp
id|hsp-&gt;smallpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|2
)paren
suffix:semicolon
r_else
id|err
op_assign
id|BufPoolGet
c_func
(paren
op_amp
id|hsp-&gt;rcvibh
comma
op_amp
id|hsp-&gt;rbufpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;HSCX RPF out of buffers&quot;
)paren
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRPF
suffix:semicolon
)brace
r_else
id|hsp-&gt;rcvptr
op_assign
l_int|0
suffix:semicolon
)brace
id|hscx_empty_fifo
c_func
(paren
id|hsp
comma
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;mode
op_eq
l_int|1
)paren
(brace
multiline_comment|/* receive audio data */
id|hsp-&gt;rcvibh-&gt;datasize
op_assign
id|hsp-&gt;rcvptr
suffix:semicolon
id|BufQueueLink
c_func
(paren
op_amp
id|hsp-&gt;rq
comma
id|hsp-&gt;rcvibh
)paren
suffix:semicolon
id|hsp-&gt;rcvibh
op_assign
l_int|NULL
suffix:semicolon
id|hscx_sched_event
c_func
(paren
id|hsp
comma
id|HSCX_RCVBUFREADY
)paren
suffix:semicolon
)brace
)brace
id|afterRPF
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* XPR */
r_if
c_cond
(paren
id|hsp-&gt;xmtibh
)paren
r_if
c_cond
(paren
id|hsp-&gt;xmtibh-&gt;datasize
OG
id|hsp-&gt;sendptr
)paren
(brace
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_goto
id|afterXPR
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|hsp-&gt;releasebuf
)paren
id|BufPoolRelease
c_func
(paren
id|hsp-&gt;xmtibh
)paren
suffix:semicolon
id|hsp-&gt;sendptr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;st-&gt;l4.l1writewakeup
)paren
id|hsp-&gt;st-&gt;l4
dot
id|l1writewakeup
c_func
(paren
id|hsp-&gt;st
)paren
suffix:semicolon
id|hsp-&gt;xmtibh
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|BufQueueUnlink
c_func
(paren
op_amp
id|hsp-&gt;xmtibh
comma
op_amp
id|hsp-&gt;sq
)paren
)paren
(brace
id|hsp-&gt;releasebuf
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
)brace
r_else
id|hscx_sched_event
c_func
(paren
id|hsp
comma
id|HSCX_XMTBUFREADY
)paren
suffix:semicolon
)brace
id|afterXPR
suffix:colon
)brace
multiline_comment|/*&n; * ISAC stuff goes here&n; */
r_static
r_void
DECL|function|isac_empty_fifo
id|isac_empty_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
id|count
)paren
(brace
id|byte
op_star
id|ptr
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|sp-&gt;rcvibh
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
op_logical_and
op_logical_neg
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;isac_empty_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;rcvptr
op_ge
l_int|3072
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
r_char
id|tmp
(braket
l_int|40
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;isac_empty_fifo rcvptr %d&quot;
comma
id|sp-&gt;rcvptr
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;rcvptr
suffix:semicolon
id|sp-&gt;rcvptr
op_add_assign
id|count
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|read_fifo_isac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;isac_empty_fifo cnt %d&quot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|isac_fill_fifo
id|isac_fill_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
suffix:semicolon
r_int
id|count
comma
id|more
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
op_logical_and
op_logical_neg
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;isac_fill_fifo&quot;
)paren
suffix:semicolon
id|ibh
op_assign
id|sp-&gt;xmtibh
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibh
)paren
r_return
suffix:semicolon
id|count
op_assign
id|ibh-&gt;datasize
op_minus
id|sp-&gt;sendptr
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
l_int|3072
)paren
r_return
suffix:semicolon
id|more
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|32
)paren
(brace
id|more
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|count
op_assign
l_int|32
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;sendptr
suffix:semicolon
id|sp-&gt;sendptr
op_add_assign
id|count
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|write_fifo_isac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
id|more
ques
c_cond
l_int|0x8
suffix:colon
l_int|0xa
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;isac_fill_fifo cnt %d&quot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ph_command
id|ph_command
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
r_int
id|command
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
(brace
r_char
id|tmp
(braket
l_int|32
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ph_command %d&quot;
comma
id|command
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CIX0
comma
(paren
id|command
op_lshift
l_int|2
)paren
op_or
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|isac_interrupt
id|isac_interrupt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
id|byte
id|val
)paren
(brace
id|byte
id|exval
comma
id|v1
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_char
id|tmp
(braket
l_int|32
)braket
suffix:semicolon
macro_line|#if ARCOFI_USE
r_struct
id|BufHeader
op_star
id|ibh
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ISAC interrupt %x&quot;
comma
id|val
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* RME */
id|exval
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_RSTA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|exval
op_amp
l_int|0x70
)paren
op_ne
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x40
)paren
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC RDO&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|exval
op_amp
l_int|0x20
)paren
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC CRC error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;rcvibh
)paren
id|BufPoolRelease
c_func
(paren
id|sp-&gt;rcvibh
)paren
suffix:semicolon
id|sp-&gt;rcvibh
op_assign
l_int|NULL
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRME
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;rcvibh
)paren
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
(paren
id|sp-&gt;rcvibh
)paren
comma
op_amp
(paren
id|sp-&gt;rbufpool
)paren
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC RME out of buffers!&quot;
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRME
suffix:semicolon
)brace
r_else
id|sp-&gt;rcvptr
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_RBCL
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|count
op_assign
l_int|32
suffix:semicolon
id|isac_empty_fifo
c_func
(paren
id|sp
comma
id|count
)paren
suffix:semicolon
id|sp-&gt;rcvibh-&gt;datasize
op_assign
id|sp-&gt;rcvptr
suffix:semicolon
id|BufQueueLink
c_func
(paren
op_amp
(paren
id|sp-&gt;rq
)paren
comma
id|sp-&gt;rcvibh
)paren
suffix:semicolon
id|sp-&gt;rcvibh
op_assign
l_int|NULL
suffix:semicolon
id|isac_sched_event
c_func
(paren
id|sp
comma
id|ISAC_RCVBUFREADY
)paren
suffix:semicolon
)brace
id|afterRME
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* RPF */
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;rcvibh
)paren
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
(paren
id|sp-&gt;rcvibh
)paren
comma
op_amp
(paren
id|sp-&gt;rbufpool
)paren
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|4
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC RME out of buffers!&quot;
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
r_goto
id|afterRPF
suffix:semicolon
)brace
r_else
id|sp-&gt;rcvptr
op_assign
l_int|0
suffix:semicolon
id|isac_empty_fifo
c_func
(paren
id|sp
comma
l_int|32
)paren
suffix:semicolon
)brace
id|afterRPF
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* RSC */
multiline_comment|/* never */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC RSC interrupt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* XPR */
r_if
c_cond
(paren
id|sp-&gt;xmtibh
)paren
r_if
c_cond
(paren
id|sp-&gt;xmtibh-&gt;datasize
OG
id|sp-&gt;sendptr
)paren
(brace
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
r_goto
id|afterXPR
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sp-&gt;releasebuf
)paren
id|BufPoolRelease
c_func
(paren
id|sp-&gt;xmtibh
)paren
suffix:semicolon
id|sp-&gt;xmtibh
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;sendptr
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|BufQueueUnlink
c_func
(paren
op_amp
id|sp-&gt;xmtibh
comma
op_amp
id|sp-&gt;sq
)paren
)paren
(brace
id|sp-&gt;releasebuf
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_else
id|isac_sched_event
c_func
(paren
id|sp
comma
id|ISAC_XMTBUFREADY
)paren
suffix:semicolon
)brace
id|afterXPR
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x04
)paren
(brace
multiline_comment|/* CISQ */
id|sp-&gt;ph_state
op_assign
(paren
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CIX0
)paren
op_rshift
l_int|2
)paren
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;l1state %d&quot;
comma
id|sp-&gt;ph_state
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|isac_new_ph
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x02
)paren
(brace
multiline_comment|/* SIN */
multiline_comment|/* never */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC SIN interrupt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x01
)paren
(brace
multiline_comment|/* EXI */
id|exval
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_EXIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ISAC EXIR %02x&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x08
)paren
(brace
id|v1
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ISAC MOSR %02x&quot;
comma
id|v1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#if ARCOFI_USE
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x08
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;mon_rx
)paren
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
(paren
id|sp-&gt;mon_rx
)paren
comma
op_amp
(paren
id|sp-&gt;rbufpool
)paren
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC MON RX out of buffers!&quot;
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0x0a
)paren
suffix:semicolon
r_goto
id|afterMONR0
suffix:semicolon
)brace
r_else
id|sp-&gt;mon_rxp
op_assign
l_int|0
suffix:semicolon
id|ibh
op_assign
id|sp-&gt;mon_rx
suffix:semicolon
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;mon_rxp
suffix:semicolon
id|sp-&gt;mon_rxp
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mon_rxp
op_ge
l_int|3072
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0x0a
)paren
suffix:semicolon
id|sp-&gt;mon_rxp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC MON RX overflow!&quot;
)paren
suffix:semicolon
r_goto
id|afterMONR0
suffix:semicolon
)brace
op_star
id|ptr
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ISAC MOR0 %02x&quot;
comma
op_star
id|ptr
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
id|afterMONR0
suffix:colon
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;mon_rx
)paren
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
(paren
id|sp-&gt;mon_rx
)paren
comma
op_amp
(paren
id|sp-&gt;rbufpool
)paren
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC MON RX out of buffers!&quot;
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xa0
)paren
suffix:semicolon
r_goto
id|afterMONR1
suffix:semicolon
)brace
r_else
id|sp-&gt;mon_rxp
op_assign
l_int|0
suffix:semicolon
id|ibh
op_assign
id|sp-&gt;mon_rx
suffix:semicolon
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;mon_rxp
suffix:semicolon
id|sp-&gt;mon_rxp
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mon_rxp
op_ge
l_int|3072
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xa0
)paren
suffix:semicolon
id|sp-&gt;mon_rxp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC MON RX overflow!&quot;
)paren
suffix:semicolon
r_goto
id|afterMONR1
suffix:semicolon
)brace
op_star
id|ptr
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOR1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ISAC MOR1 %02x&quot;
comma
op_star
id|ptr
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
id|afterMONR1
suffix:colon
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x04
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0x0a
)paren
suffix:semicolon
id|sp-&gt;mon_rx-&gt;datasize
op_assign
id|sp-&gt;mon_rxp
suffix:semicolon
id|sp-&gt;mon_flg
op_or_assign
id|MON0_RX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x40
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xa0
)paren
suffix:semicolon
id|sp-&gt;mon_rx-&gt;datasize
op_assign
id|sp-&gt;mon_rxp
suffix:semicolon
id|sp-&gt;mon_flg
op_or_assign
id|MON1_RX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v1
op_eq
l_int|0x02
)paren
(brace
id|ibh
op_assign
id|sp-&gt;mon_tx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibh
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0x0a
)paren
suffix:semicolon
r_goto
id|AfterMOX0
suffix:semicolon
)brace
id|count
op_assign
id|ibh-&gt;datasize
op_minus
id|sp-&gt;mon_txp
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0x0f
)paren
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|sp-&gt;mon_tx
)paren
suffix:semicolon
id|sp-&gt;mon_tx
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;mon_txp
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;mon_flg
op_or_assign
id|MON0_TX
suffix:semicolon
r_goto
id|AfterMOX0
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;mon_txp
suffix:semicolon
id|sp-&gt;mon_txp
op_increment
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOX0
comma
op_star
id|ptr
)paren
suffix:semicolon
)brace
id|AfterMOX0
suffix:colon
r_if
c_cond
(paren
id|v1
op_eq
l_int|0x20
)paren
(brace
id|ibh
op_assign
id|sp-&gt;mon_tx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibh
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xa0
)paren
suffix:semicolon
r_goto
id|AfterMOX1
suffix:semicolon
)brace
id|count
op_assign
id|ibh-&gt;datasize
op_minus
id|sp-&gt;mon_txp
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xf0
)paren
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|sp-&gt;mon_tx
)paren
suffix:semicolon
id|sp-&gt;mon_tx
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;mon_txp
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;mon_flg
op_or_assign
id|MON1_TX
suffix:semicolon
r_goto
id|AfterMOX1
suffix:semicolon
)brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|sp-&gt;mon_txp
suffix:semicolon
id|sp-&gt;mon_txp
op_increment
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOX1
comma
op_star
id|ptr
)paren
suffix:semicolon
)brace
id|AfterMOX1
suffix:colon
macro_line|#endif
)brace
)brace
)brace
r_static
r_inline
r_void
DECL|function|hscx_int_main
id|hscx_int_main
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
id|byte
id|val
)paren
(brace
id|byte
id|exval
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
suffix:semicolon
r_char
id|tmp
(braket
l_int|32
)braket
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x01
)paren
(brace
id|hsp
op_assign
id|sp-&gt;hs
op_plus
l_int|1
suffix:semicolon
id|exval
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_EXIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_eq
l_int|0x40
)paren
(brace
r_if
c_cond
(paren
id|hsp-&gt;mode
op_eq
l_int|1
)paren
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Here we lost an TX interrupt, so&n;&t;&t;&t;&t;   * restart transmitting the whole frame.&n;&t;&t;&t;&t; */
id|hsp-&gt;sendptr
op_assign
l_int|0
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX B EXIR %x Lost TX&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX B EXIR %x&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0xf8
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX B interrupt %x&quot;
comma
id|val
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|hscx_interrupt
c_func
(paren
id|sp
comma
id|val
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x02
)paren
(brace
id|hsp
op_assign
id|sp-&gt;hs
suffix:semicolon
id|exval
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|0
comma
id|HSCX_EXIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_eq
l_int|0x40
)paren
(brace
r_if
c_cond
(paren
id|hsp-&gt;mode
op_eq
l_int|1
)paren
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Here we lost an TX interrupt, so&n;&t;&t;&t;&t;   * restart transmitting the whole frame.&n;&t;&t;&t;&t; */
id|hsp-&gt;sendptr
op_assign
l_int|0
suffix:semicolon
id|writehscxCMDR
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hsp-&gt;hscx
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX A EXIR %x Lost TX&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX A EXIR %x&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x04
)paren
(brace
id|exval
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|0
comma
id|HSCX_ISTA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;HSCX A interrupt %x&quot;
comma
id|exval
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|hscx_interrupt
c_func
(paren
id|sp
comma
id|exval
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|elsa_interrupt
id|elsa_interrupt
c_func
(paren
r_int
id|intno
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
suffix:semicolon
id|byte
id|val
comma
id|sval
comma
id|stat
op_assign
l_int|0
suffix:semicolon
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|irq2dev_map
(braket
id|intno
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: Spurious interrupt!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sval
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
id|INT_RESTART
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
(brace
multiline_comment|/* Timer Restart */
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp-&gt;counter
op_increment
op_amp
l_int|0x3f
)paren
)paren
(brace
multiline_comment|/* Call LEDs all 64 tics */
id|elsa_led_handler
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
)brace
id|val
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_ISTA
)paren
suffix:semicolon
id|Start_HSCX
suffix:colon
r_if
c_cond
(paren
id|val
)paren
(brace
id|hscx_int_main
c_func
(paren
id|sp
comma
id|val
)paren
suffix:semicolon
id|stat
op_or_assign
l_int|1
suffix:semicolon
)brace
id|val
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_ISTA
)paren
suffix:semicolon
id|Start_ISAC
suffix:colon
r_if
c_cond
(paren
id|val
)paren
(brace
id|isac_interrupt
c_func
(paren
id|sp
comma
id|val
)paren
suffix:semicolon
id|stat
op_or_assign
l_int|2
suffix:semicolon
)brace
id|sval
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
r_goto
id|INT_RESTART
suffix:semicolon
id|val
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_ISTA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;HSCX IntStat after IntRoutine&quot;
)paren
suffix:semicolon
r_goto
id|Start_HSCX
suffix:semicolon
)brace
id|val
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_ISTA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC IntStat after IntRoutine&quot;
)paren
suffix:semicolon
r_goto
id|Start_ISAC
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
l_int|1
)paren
(brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|0
comma
id|HSCX_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|0
comma
id|HSCX_MASK
comma
l_int|0x0
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_MASK
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
l_int|2
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MASK
comma
l_int|0x0
)paren
suffix:semicolon
)brace
id|byteout
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
l_int|7
comma
l_int|0xff
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|initisac
id|initisac
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_int
r_int
id|adr
op_assign
id|sp-&gt;cfg_reg
suffix:semicolon
multiline_comment|/* Elsa IOM 2 Mode */
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_ADF2
comma
l_int|0x80
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_SQXR
comma
l_int|0x2f
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_SPCR
comma
l_int|0x00
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_STCR
comma
l_int|0x70
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_MODE
comma
l_int|0xc9
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_TIMR
comma
l_int|0x00
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_ADF1
comma
l_int|0x00
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_CIX0
comma
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
l_int|3
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|adr
comma
id|ISAC_MASK
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|modehscx
id|modehscx
c_func
(paren
r_struct
id|HscxState
op_star
id|hs
comma
r_int
id|mode
comma
r_int
id|ichan
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|hs-&gt;sp
suffix:semicolon
r_int
id|hscx
op_assign
id|hs-&gt;hscx
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
(brace
r_char
id|tmp
(braket
l_int|40
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;hscx %c mode %d ichan %d&quot;
comma
l_char|&squot;A&squot;
op_plus
id|hscx
comma
id|mode
comma
id|ichan
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|hs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_CCR1
comma
l_int|0x85
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XAD1
comma
l_int|0xFF
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XAD2
comma
l_int|0xFF
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_RAH2
comma
l_int|0xFF
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XBCH
comma
l_int|0x0
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_RLCR
comma
l_int|0x0
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_CCR2
comma
l_int|0x30
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAX
comma
l_int|0xff
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAR
comma
l_int|0xff
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_RCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_MODE
comma
l_int|0x84
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
r_if
c_cond
(paren
id|ichan
op_eq
l_int|0
)paren
(brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAX
comma
l_int|0x2f
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAR
comma
l_int|0x2f
)paren
suffix:semicolon
)brace
r_else
(brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAX
comma
l_int|0x3
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAR
comma
l_int|0x3
)paren
suffix:semicolon
)brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_RCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_MODE
comma
l_int|0xe4
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_CMDR
comma
l_int|0x41
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
r_if
c_cond
(paren
id|ichan
op_eq
l_int|0
)paren
(brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAX
comma
l_int|0x2f
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAR
comma
l_int|0x2f
)paren
suffix:semicolon
)brace
r_else
(brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAX
comma
l_int|0x3
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_TSAR
comma
l_int|0x3
)paren
suffix:semicolon
)brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_XCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_RCCR
comma
l_int|7
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_MODE
comma
l_int|0x8c
)paren
suffix:semicolon
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_CMDR
comma
l_int|0x41
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|writehscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|hscx
comma
id|HSCX_ISTA
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_void
DECL|function|release_io_elsa
id|release_io_elsa
c_func
(paren
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
r_int
id|bytecnt
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;sp-&gt;subtyp
op_eq
id|ELSA_PCFPRO
)paren
id|bytecnt
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;sp-&gt;cfg_reg
)paren
id|release_region
c_func
(paren
id|card-&gt;sp-&gt;cfg_reg
comma
id|bytecnt
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|clear_pending_ints
id|clear_pending_ints
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MASK
comma
l_int|0
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_CMDR
comma
l_int|0x41
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|check_arcofi
id|check_arcofi
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
macro_line|#if 0
id|byte
id|val
suffix:semicolon
r_char
id|tmp
(braket
l_int|40
)braket
suffix:semicolon
r_char
op_star
id|t
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|BufPoolGet
c_func
(paren
op_amp
(paren
id|sp-&gt;mon_tx
)paren
comma
op_amp
(paren
id|sp-&gt;sbufpool
)paren
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
l_int|1
comma
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;ISAC MON TX out of buffers!&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|sp-&gt;mon_txp
op_assign
l_int|0
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|sp-&gt;mon_tx
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0xa0
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x0
suffix:semicolon
id|sp-&gt;mon_tx-&gt;datasize
op_assign
l_int|2
suffix:semicolon
id|sp-&gt;mon_txp
op_assign
l_int|1
suffix:semicolon
id|sp-&gt;mon_flg
op_assign
l_int|0
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xa0
)paren
suffix:semicolon
id|val
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOSR
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOX1
comma
l_int|0xa0
)paren
suffix:semicolon
id|writeisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_MOCR
comma
l_int|0xb0
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|HZDELAY
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mon_flg
op_amp
id|MON1_TX
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;mon_flg
op_amp
id|MON1_RX
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Arcofi response received %d bytes&quot;
comma
id|sp-&gt;mon_rx-&gt;datasize
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|sp-&gt;mon_rx
)paren
suffix:semicolon
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Arcofi data&quot;
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|p
comma
id|sp-&gt;mon_rx-&gt;datasize
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|sp-&gt;mon_rx
)paren
suffix:semicolon
id|sp-&gt;mon_rx
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;mon_rxp
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;mon_flg
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sp-&gt;mon_tx
)paren
(brace
id|BufPoolRelease
c_func
(paren
id|sp-&gt;mon_tx
)paren
suffix:semicolon
id|sp-&gt;mon_tx
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;mon_txp
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Arcofi not detected&quot;
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|sp-&gt;mon_flg
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|initelsa
id|initelsa
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_int
id|ret
comma
id|irq_cnt
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|sp-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|irq_cnt
op_assign
id|kstat.interrupts
(braket
id|sp-&gt;irq
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: IRQ %d count %d&bslash;n&quot;
comma
id|sp-&gt;irq
comma
id|irq_cnt
)paren
suffix:semicolon
id|clear_pending_ints
c_func
(paren
id|sp
)paren
suffix:semicolon
id|ret
op_assign
id|get_irq
c_func
(paren
id|sp-&gt;cardnr
comma
op_amp
id|elsa_interrupt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|initisac
c_func
(paren
id|sp
)paren
suffix:semicolon
id|sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|sp-&gt;hs
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|sp-&gt;hs
op_plus
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sp-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONTROL
comma
id|ISDN_RESET
op_or
id|ENABLE_TIM_INT
)paren
suffix:semicolon
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
id|HZDELAY
c_func
(paren
l_int|11
)paren
suffix:semicolon
multiline_comment|/* Warte 110 ms */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: %d timer tics in 110 msek&bslash;n&quot;
comma
id|sp-&gt;counter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
id|sp-&gt;counter
op_minus
l_int|12
)paren
OL
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: timer and irq OK&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: timer problem maybe an IRQ(%d) conflict&bslash;n&quot;
comma
id|sp-&gt;irq
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: IRQ %d count %d&bslash;n&quot;
comma
id|sp-&gt;irq
comma
id|kstat.interrupts
(braket
id|sp-&gt;irq
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kstat.interrupts
(braket
id|sp-&gt;irq
)braket
op_eq
id|irq_cnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: IRQ(%d) getting no interrupts during init&bslash;n&quot;
comma
id|sp-&gt;irq
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|sp-&gt;irq
)braket
op_assign
l_int|NULL
suffix:semicolon
id|free_irq
c_func
(paren
id|sp-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|check_arcofi
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
id|sp-&gt;counter
op_assign
l_int|0
suffix:semicolon
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_static
r_int
r_char
DECL|function|probe_elsa_adr
id|probe_elsa_adr
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
id|i
comma
id|in1
comma
id|in2
comma
id|p16_1
op_assign
l_int|0
comma
id|p16_2
op_assign
l_int|0
comma
id|pcc_1
op_assign
l_int|0
comma
id|pcc_2
op_assign
l_int|0
comma
id|pfp_1
op_assign
l_int|0
comma
id|pfp_2
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|adr
comma
l_int|8
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: Probing Port 0x%x: already in use&bslash;n&quot;
comma
id|adr
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|in1
op_assign
id|inb
c_func
(paren
id|adr
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
multiline_comment|/* &squot;toggelt&squot; bei */
id|in2
op_assign
id|inb
c_func
(paren
id|adr
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
multiline_comment|/* jedem Zugriff */
id|p16_1
op_add_assign
l_int|0x04
op_amp
id|in1
suffix:semicolon
id|p16_2
op_add_assign
l_int|0x04
op_amp
id|in2
suffix:semicolon
id|pcc_1
op_add_assign
l_int|0x01
op_amp
id|in1
suffix:semicolon
id|pcc_2
op_add_assign
l_int|0x01
op_amp
id|in2
suffix:semicolon
id|pfp_1
op_add_assign
l_int|0x40
op_amp
id|in1
suffix:semicolon
id|pfp_2
op_add_assign
l_int|0x40
op_amp
id|in2
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: Probing IO 0x%x&quot;
comma
id|adr
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|65
op_eq
op_increment
id|p16_1
op_star
op_increment
id|p16_2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; PCC-16/PCF found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|3
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|1025
op_eq
op_increment
id|pfp_1
op_star
op_increment
id|pfp_2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; PCF-Pro found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|17
op_eq
op_increment
id|pcc_1
op_star
op_increment
id|pcc_2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; PCC8 found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot; failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
r_int
DECL|function|probe_elsa
id|probe_elsa
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|CARD_portlist
(braket
)braket
op_assign
(brace
l_int|0x160
comma
l_int|0x170
comma
l_int|0x260
comma
l_int|0x360
comma
l_int|0
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|CARD_portlist
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|sp-&gt;subtyp
op_assign
id|probe_elsa_adr
c_func
(paren
id|CARD_portlist
(braket
id|i
)braket
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
r_return
(paren
id|CARD_portlist
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_int
DECL|function|setup_elsa
id|setup_elsa
c_func
(paren
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|bytecnt
suffix:semicolon
id|byte
id|val
comma
id|verA
comma
id|verB
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|card-&gt;sp
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|tmp
comma
id|Elsa_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;HiSax: Elsa driver Rev. %s&bslash;n&quot;
comma
id|HiSax_getrev
c_func
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;typ
op_eq
id|ISDN_CTYPE_ELSA
)paren
(brace
id|sp-&gt;cfg_reg
op_assign
id|card-&gt;para
(braket
l_int|0
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: Mircolink IO probing&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;cfg_reg
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp-&gt;subtyp
op_assign
id|probe_elsa_adr
c_func
(paren
id|sp-&gt;cfg_reg
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: no Elsa Mircolink at 0x%x&bslash;n&quot;
comma
id|sp-&gt;cfg_reg
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
id|sp-&gt;cfg_reg
op_assign
id|probe_elsa
c_func
(paren
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;cfg_reg
)paren
(brace
id|val
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;subtyp
op_eq
id|ELSA_PCC
)paren
(brace
r_const
id|byte
id|CARD_IrqTab
(braket
l_int|8
)braket
op_assign
(brace
l_int|7
comma
l_int|3
comma
l_int|5
comma
l_int|9
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|sp-&gt;irq
op_assign
id|CARD_IrqTab
(braket
(paren
id|val
op_amp
l_int|0x0c
)paren
op_rshift
l_int|2
)braket
suffix:semicolon
)brace
r_else
(brace
r_const
id|byte
id|CARD_IrqTab
(braket
l_int|8
)braket
op_assign
(brace
l_int|15
comma
l_int|10
comma
l_int|15
comma
l_int|3
comma
l_int|11
comma
l_int|5
comma
l_int|11
comma
l_int|9
)brace
suffix:semicolon
id|sp-&gt;irq
op_assign
id|CARD_IrqTab
(braket
(paren
id|val
op_amp
l_int|0x38
)paren
op_rshift
l_int|3
)braket
suffix:semicolon
)brace
id|val
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_ALE
)paren
op_amp
l_int|0x7
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|3
)paren
id|val
op_or_assign
l_int|8
suffix:semicolon
id|val
op_add_assign
l_char|&squot;A&squot;
op_minus
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_char|&squot;B&squot;
op_logical_or
id|val
op_eq
l_char|&squot;C&squot;
)paren
id|val
op_xor_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp-&gt;subtyp
op_eq
id|ELSA_PCFPRO
)paren
op_logical_and
(paren
id|val
op_assign
l_char|&squot;G&squot;
)paren
)paren
id|val
op_assign
l_char|&squot;C&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: %s found at 0x%x Rev.:%c IRQ %d&bslash;n&quot;
comma
id|Elsa_Types
(braket
id|sp-&gt;subtyp
)braket
comma
id|sp-&gt;cfg_reg
comma
id|val
comma
id|sp-&gt;irq
)paren
suffix:semicolon
id|val
op_assign
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_ALE
)paren
op_amp
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: Mircolink S0 bus power bad&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;No Elsa Mircolink found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sp-&gt;typ
op_eq
id|ISDN_CTYPE_ELSA_QS1000
)paren
(brace
id|sp-&gt;cfg_reg
op_assign
id|card-&gt;para
(braket
l_int|1
)braket
suffix:semicolon
id|sp-&gt;irq
op_assign
id|card-&gt;para
(braket
l_int|0
)braket
suffix:semicolon
id|sp-&gt;subtyp
op_assign
id|ELSA_QS1000
suffix:semicolon
)brace
r_else
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sp-&gt;subtyp
)paren
(brace
r_case
id|ELSA_PCC
suffix:colon
id|bytecnt
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELSA_PCFPRO
suffix:colon
id|bytecnt
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELSA_PCC16
suffix:colon
id|bytecnt
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELSA_PCF
suffix:colon
id|bytecnt
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELSA_QS1000
suffix:colon
id|bytecnt
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unknown ELSA subtype %d&bslash;n&quot;
comma
id|sp-&gt;subtyp
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
(paren
id|sp-&gt;cfg_reg
)paren
comma
id|bytecnt
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: %s config port %x-%x already in use&bslash;n&quot;
comma
id|CardType
(braket
id|card-&gt;typ
)braket
comma
id|sp-&gt;cfg_reg
comma
id|sp-&gt;cfg_reg
op_plus
id|bytecnt
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|request_region
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|bytecnt
comma
l_string|&quot;elsa isdn&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Teste Timer */
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
(brace
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
multiline_comment|/* 2. Versuch */
r_if
c_cond
(paren
op_logical_neg
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: timer do not start&bslash;n&quot;
)paren
suffix:semicolon
id|release_io_elsa
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|HZDELAY
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* wait &gt;=10 ms */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: timer do not run down&bslash;n&quot;
)paren
suffix:semicolon
id|release_io_elsa
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: timer OK; resetting card&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Wait 1 Timer */
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
r_while
c_loop
(paren
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONTROL
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Reset On */
multiline_comment|/* Wait 1 Timer */
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
r_while
c_loop
(paren
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_CONTROL
comma
id|ISDN_RESET
)paren
suffix:semicolon
multiline_comment|/* Reset Off */
multiline_comment|/* Wait 1 Timer */
id|bytein
c_func
(paren
id|sp-&gt;cfg_reg
op_plus
id|CARD_START_TIMER
)paren
suffix:semicolon
r_while
c_loop
(paren
id|TimerRun
c_func
(paren
id|sp
)paren
)paren
suffix:semicolon
id|verA
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|0
comma
id|HSCX_VSTR
)paren
op_amp
l_int|0xf
suffix:semicolon
id|verB
op_assign
id|readhscx
c_func
(paren
id|sp-&gt;cfg_reg
comma
l_int|1
comma
id|HSCX_VSTR
)paren
op_amp
l_int|0xf
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: HSCX version A: %s  B: %s&bslash;n&quot;
comma
id|HscxVersion
c_func
(paren
id|verA
)paren
comma
id|HscxVersion
c_func
(paren
id|verB
)paren
)paren
suffix:semicolon
id|val
op_assign
id|readisac
c_func
(paren
id|sp-&gt;cfg_reg
comma
id|ISAC_RBCH
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Elsa: ISAC %s&bslash;n&quot;
comma
id|ISACVersion
c_func
(paren
id|val
)paren
)paren
suffix:semicolon
id|sp-&gt;modehscx
op_assign
op_amp
id|modehscx
suffix:semicolon
id|sp-&gt;ph_command
op_assign
op_amp
id|ph_command
suffix:semicolon
id|sp-&gt;hscx_fill_fifo
op_assign
op_amp
id|hscx_fill_fifo
suffix:semicolon
id|sp-&gt;isac_fill_fifo
op_assign
op_amp
id|isac_fill_fifo
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
eof
