multiline_comment|/* $Id: isdnl1.c,v 1.15 1997/05/27 15:17:55 fritz Exp $&n;&n; * isdnl1.c     common low level stuff for Siemens Chipsetbased isdn cards&n; *              based on the teles driver from Jan den Ouden&n; *&n; * Author       Karsten Keil (keil@temic-ech.spacenet.de)&n; *&n; * Thanks to    Jan den Ouden&n; *              Fritz Elfert&n; *              Beat Doebeli&n; *&n; *&n; * $Log: isdnl1.c,v $&n; * Revision 1.15  1997/05/27 15:17:55  fritz&n; * Added changes for recent 2.1.x kernels:&n; *   changed return type of isdn_close&n; *   queue_task_* -&gt; queue_task&n; *   clear/set_bit -&gt; test_and_... where apropriate.&n; *   changed type of hard_header_cache parameter.&n; *&n; * Revision 1.14  1997/04/07 23:00:08  keil&n; * GFP_KERNEL ---&gt; GFP_ATOMIC&n; *&n; * Revision 1.13  1997/04/06 22:55:50  keil&n; * Using SKB&squot;s&n; *&n; * Revision 1.12  1997/03/26 13:43:57  keil&n; * small cosmetics&n; *&n; * Revision 1.11  1997/03/25 23:11:23  keil&n; * US NI-1 protocol&n; *&n; * Revision 1.10  1997/03/13 14:45:05  keil&n; * using IRQ proof queue_task&n; *&n; * Revision 1.9  1997/03/12 21:44:21  keil&n; * change Interrupt routine from atomic quick to normal&n; *&n; * Revision 1.8  1997/02/09 00:24:31  keil&n; * new interface handling, one interface per card&n; *&n; * Revision 1.7  1997/01/27 15:56:03  keil&n; * PCMCIA Teles card and ITK ix1 micro added&n; *&n; * Revision 1.6  1997/01/21 22:20:00  keil&n; * changes for D-channel log; Elsa Quickstep support&n; *&n; * Revision 1.5  1997/01/10 12:51:19  keil&n; * cleanup; set newversion&n; *&n; * Revision 1.4  1996/12/08 19:44:53  keil&n; * L2FRAME_DEBUG and other changes from Pekka Sarnila&n; *&n; * Revision 1.3  1996/11/18 15:34:47  keil&n; * fix HSCX version code&n; *&n; * Revision 1.2  1996/10/27 22:16:54  keil&n; * ISAC/HSCX version lookup&n; *&n; * Revision 1.1  1996/10/13 20:04:53  keil&n; * Initial revision&n; *&n; *&n; *&n; */
DECL|variable|l1_revision
r_const
r_char
op_star
id|l1_revision
op_assign
l_string|&quot;$Revision: 1.15 $&quot;
suffix:semicolon
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#if CARD_TELES0
macro_line|#include &quot;teles0.h&quot;
macro_line|#endif
macro_line|#if CARD_TELES3
macro_line|#include &quot;teles3.h&quot;
macro_line|#endif
macro_line|#if CARD_AVM_A1
macro_line|#include &quot;avm_a1.h&quot;
macro_line|#endif
macro_line|#if CARD_ELSA
macro_line|#include &quot;elsa.h&quot;
macro_line|#endif
macro_line|#if CARD_IX1MICROR2
macro_line|#include &quot;ix1_micro.h&quot;
macro_line|#endif
multiline_comment|/* #define I4L_IRQ_FLAG SA_INTERRUPT */
DECL|macro|I4L_IRQ_FLAG
mdefine_line|#define I4L_IRQ_FLAG    0
DECL|macro|HISAX_STATUS_BUFSIZE
mdefine_line|#define HISAX_STATUS_BUFSIZE 4096
DECL|macro|INCLUDE_INLINE_FUNCS
mdefine_line|#define INCLUDE_INLINE_FUNCS
macro_line|#include &lt;linux/tqueue.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
DECL|variable|CardType
r_const
r_char
op_star
id|CardType
(braket
)braket
op_assign
(brace
l_string|&quot;No Card&quot;
comma
l_string|&quot;Teles 16.0&quot;
comma
l_string|&quot;Teles 8.0&quot;
comma
l_string|&quot;Teles 16.3&quot;
comma
l_string|&quot;Creatix/Teles PnP&quot;
comma
l_string|&quot;AVM A1&quot;
comma
l_string|&quot;Elsa ML&quot;
comma
macro_line|#ifdef CONFIG_HISAX_ELSA_PCMCIA
l_string|&quot;Elsa PCMCIA&quot;
comma
macro_line|#else
l_string|&quot;Elsa Quickstep&quot;
comma
macro_line|#endif
l_string|&quot;Teles PCMCIA&quot;
comma
l_string|&quot;ITK ix1-micro Rev.2&quot;
)brace
suffix:semicolon
DECL|variable|HSCXVer
r_static
r_char
op_star
id|HSCXVer
(braket
)braket
op_assign
(brace
l_string|&quot;A1&quot;
comma
l_string|&quot;?1&quot;
comma
l_string|&quot;A2&quot;
comma
l_string|&quot;?3&quot;
comma
l_string|&quot;A3&quot;
comma
l_string|&quot;V2.1&quot;
comma
l_string|&quot;?6&quot;
comma
l_string|&quot;?7&quot;
comma
l_string|&quot;?8&quot;
comma
l_string|&quot;?9&quot;
comma
l_string|&quot;?10&quot;
comma
l_string|&quot;?11&quot;
comma
l_string|&quot;?12&quot;
comma
l_string|&quot;?13&quot;
comma
l_string|&quot;?14&quot;
comma
l_string|&quot;???&quot;
)brace
suffix:semicolon
DECL|variable|ISACVer
r_static
r_char
op_star
id|ISACVer
(braket
)braket
op_assign
(brace
l_string|&quot;2086/2186 V1.1&quot;
comma
l_string|&quot;2085 B1&quot;
comma
l_string|&quot;2085 B2&quot;
comma
l_string|&quot;2085 V2.3&quot;
)brace
suffix:semicolon
r_extern
r_struct
id|IsdnCard
id|cards
(braket
)braket
suffix:semicolon
r_extern
r_int
id|nrcards
suffix:semicolon
r_extern
r_char
op_star
id|HiSax_id
suffix:semicolon
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
r_struct
id|IsdnCardState
op_star
DECL|function|hisax_findcard
id|hisax_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp-&gt;myid
op_eq
id|driverid
)paren
r_return
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
r_return
(paren
r_struct
id|IsdnCardState
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|HiSax_readstatus
id|HiSax_readstatus
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
r_int
id|count
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|hisax_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csta
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|buf
comma
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|len
suffix:semicolon
id|p
op_increment
comma
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|user
)paren
id|put_user
c_func
(paren
op_star
id|csta-&gt;status_read
op_increment
comma
id|p
)paren
suffix:semicolon
r_else
op_star
id|p
op_increment
op_assign
op_star
id|csta-&gt;status_read
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;status_read
OG
id|csta-&gt;status_end
)paren
id|csta-&gt;status_read
op_assign
id|csta-&gt;status_buf
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax: if_readstatus called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_void
DECL|function|HiSax_putstatus
id|HiSax_putstatus
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|len
comma
id|count
comma
id|i
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csta
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No CardStatus for message %s&quot;
comma
id|buf
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|p
op_assign
id|buf
comma
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|p
op_increment
)paren
(brace
op_star
id|csta-&gt;status_write
op_increment
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;status_write
OG
id|csta-&gt;status_end
)paren
id|csta-&gt;status_write
op_assign
id|csta-&gt;status_buf
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
id|ic.command
op_assign
id|ISDN_STAT_STAVAIL
suffix:semicolon
id|ic.driver
op_assign
id|csta-&gt;myid
suffix:semicolon
id|ic.arg
op_assign
id|count
suffix:semicolon
id|csta-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|ll_run
id|ll_run
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_int
id|flags
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ic.driver
op_assign
id|csta-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|csta-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|ll_stop
id|ll_stop
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_STOP
suffix:semicolon
id|ic.driver
op_assign
id|csta-&gt;myid
suffix:semicolon
id|csta-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|CallcFreeChan
c_func
(paren
id|csta
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ll_unload
id|ll_unload
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_UNLOAD
suffix:semicolon
id|ic.driver
op_assign
id|csta-&gt;myid
suffix:semicolon
id|csta-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;status_buf
)paren
id|kfree
c_func
(paren
id|csta-&gt;status_buf
)paren
suffix:semicolon
id|csta-&gt;status_read
op_assign
l_int|NULL
suffix:semicolon
id|csta-&gt;status_write
op_assign
l_int|NULL
suffix:semicolon
id|csta-&gt;status_end
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|csta-&gt;dlogspace
)paren
suffix:semicolon
)brace
r_void
DECL|function|debugl1
id|debugl1
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_char
op_star
id|msg
)paren
(brace
r_char
id|tmp
(braket
l_int|256
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s Card %d %s&bslash;n&quot;
comma
id|tm
comma
id|sp-&gt;cardnr
op_plus
l_int|1
comma
id|msg
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * HSCX stuff goes here&n; */
r_char
op_star
DECL|function|HscxVersion
id|HscxVersion
c_func
(paren
id|u_char
id|v
)paren
(brace
r_return
(paren
id|HSCXVer
(braket
id|v
op_amp
l_int|0xf
)braket
)paren
suffix:semicolon
)brace
r_void
DECL|function|hscx_sched_event
id|hscx_sched_event
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
comma
r_int
id|event
)paren
(brace
id|hsp-&gt;event
op_or_assign
l_int|1
op_lshift
id|event
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|hsp-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ISAC stuff goes here&n; */
r_char
op_star
DECL|function|ISACVersion
id|ISACVersion
c_func
(paren
id|u_char
id|v
)paren
(brace
r_return
(paren
id|ISACVer
(braket
(paren
id|v
op_rshift
l_int|5
)paren
op_amp
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_void
DECL|function|isac_sched_event
id|isac_sched_event
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
id|event
)paren
(brace
id|sp-&gt;event
op_or_assign
l_int|1
op_lshift
id|event
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|sp-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_int
DECL|function|act_wanted
id|act_wanted
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
id|st
op_assign
id|sp-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
r_if
c_cond
(paren
id|st-&gt;l1.act_state
)paren
r_return
(paren
op_logical_neg
l_int|0
)paren
suffix:semicolon
r_else
id|st
op_assign
id|st-&gt;next
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|isac_new_ph
id|isac_new_ph
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_int
id|enq
suffix:semicolon
id|enq
op_assign
id|act_wanted
c_func
(paren
id|sp
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sp-&gt;ph_state
)paren
(brace
r_case
(paren
l_int|6
)paren
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|15
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|15
)paren
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|enq
)paren
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|0
)paren
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|enq
)paren
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if 0
r_else
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|15
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
(paren
l_int|7
)paren
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|enq
)paren
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|9
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|12
)paren
suffix:colon
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|8
)paren
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|5
suffix:semicolon
id|isac_sched_event
c_func
(paren
id|sp
comma
id|ISAC_PHCHANGE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;tx_skb
)paren
id|sp-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sp-&gt;sq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;tx_skb
)paren
(brace
id|sp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
l_int|13
)paren
suffix:colon
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|9
)paren
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|5
suffix:semicolon
id|isac_sched_event
c_func
(paren
id|sp
comma
id|ISAC_PHCHANGE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;tx_skb
)paren
id|sp-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sp-&gt;sq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;tx_skb
)paren
(brace
id|sp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
l_int|4
)paren
suffix:colon
r_case
(paren
l_int|8
)paren
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|restart_ph
id|restart_ph
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;ph_active
)paren
(brace
r_if
c_cond
(paren
(paren
id|sp-&gt;ph_state
op_eq
l_int|6
)paren
op_logical_or
(paren
id|sp-&gt;ph_state
op_eq
l_int|0
)paren
)paren
(brace
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|1
)paren
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sp-&gt;ph_active
op_eq
l_int|2
)paren
(brace
id|sp
op_member_access_from_pointer
id|ph_command
c_func
(paren
id|sp
comma
l_int|1
)paren
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|act_ivated
id|act_ivated
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
id|st
op_assign
id|sp-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;l1.act_state
op_eq
l_int|1
)paren
(brace
id|st-&gt;l1.act_state
op_assign
l_int|2
suffix:semicolon
id|st-&gt;l1
dot
id|l1man
c_func
(paren
id|st
comma
id|PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|st
op_assign
id|st-&gt;next
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|process_new_ph
id|process_new_ph
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;ph_active
op_eq
l_int|5
)paren
id|act_ivated
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|process_xmt
id|process_xmt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;tx_skb
)paren
r_return
suffix:semicolon
id|stptr
op_assign
id|sp-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|stptr-&gt;l1.requestpull
)paren
(brace
id|stptr-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_PULL_ACK
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
r_static
r_void
DECL|function|process_rcv
id|process_rcv
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|nskb
suffix:semicolon
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_int
id|found
comma
id|broadc
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sp-&gt;rq
)paren
)paren
)paren
(brace
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|sp
comma
id|skb
comma
l_string|&quot;PH_DATA&quot;
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|stptr
op_assign
id|sp-&gt;stlist
suffix:semicolon
id|broadc
op_assign
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_rshift
l_int|1
)paren
op_eq
l_int|127
suffix:semicolon
r_if
c_cond
(paren
id|broadc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
)paren
(brace
multiline_comment|/* sapi 0 */
id|sp-&gt;CallFlags
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;dlogflag
)paren
(brace
id|LogFrame
c_func
(paren
id|sp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|dlogframe
c_func
(paren
id|sp
comma
id|skb-&gt;data
op_plus
l_int|3
comma
id|skb-&gt;len
op_minus
l_int|3
comma
l_string|&quot;Q.931 frame network-&gt;user broadcast&quot;
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
op_eq
id|stptr-&gt;l2.sap
)paren
r_if
c_cond
(paren
(paren
id|nskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
)paren
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_DATA
comma
id|nskb
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: isdn broadcast buffer shortage&bslash;n&quot;
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
r_else
(brace
id|found
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
(paren
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
op_eq
id|stptr-&gt;l2.sap
)paren
op_logical_and
(paren
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_rshift
l_int|1
)paren
op_eq
id|stptr-&gt;l2.tei
)paren
)paren
(brace
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_DATA
comma
id|skb
)paren
suffix:semicolon
id|found
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
multiline_comment|/* BD 10.10.95&n;&t;&t;&t;&t; * Print out D-Channel msg not processed&n;&t;&t;&t;&t; * by isdn4linux&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_amp
l_int|0x01
)paren
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Q.931 frame network-&gt;user with tei %d (not for us)&quot;
comma
id|skb-&gt;data
(braket
l_int|1
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
id|LogFrame
c_func
(paren
id|sp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|dlogframe
c_func
(paren
id|sp
comma
id|skb-&gt;data
op_plus
l_int|4
comma
id|skb-&gt;len
op_minus
l_int|4
comma
id|tmp
)paren
suffix:semicolon
)brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_void
DECL|function|isac_bh
id|isac_bh
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|ISAC_PHCHANGE
comma
op_amp
id|sp-&gt;event
)paren
)paren
id|process_new_ph
c_func
(paren
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|ISAC_RCVBUFREADY
comma
op_amp
id|sp-&gt;event
)paren
)paren
id|process_rcv
c_func
(paren
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|ISAC_XMTBUFREADY
comma
op_amp
id|sp-&gt;event
)paren
)paren
id|process_xmt
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l2l1
id|l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_char
id|str
(braket
l_int|64
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
)paren
suffix:colon
r_if
c_cond
(paren
id|sp-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|sp-&gt;sq
comma
id|skb
)paren
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|sp
comma
id|skb
comma
l_string|&quot;PH_DATA Queued&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|sp-&gt;dlogflag
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_amp
l_int|1
)paren
)paren
)paren
(brace
multiline_comment|/* I-FRAME */
id|LogFrame
c_func
(paren
id|sp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;Q.931 frame user-&gt;network tei %d&quot;
comma
id|st-&gt;l2.tei
)paren
suffix:semicolon
id|dlogframe
c_func
(paren
id|sp
comma
id|skb-&gt;data
op_plus
id|st-&gt;l2.ihsize
comma
id|skb-&gt;len
op_minus
id|st-&gt;l2.ihsize
comma
id|str
)paren
suffix:semicolon
)brace
id|sp-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|sp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|sp
comma
id|skb
comma
l_string|&quot;PH_DATA&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|sp
op_member_access_from_pointer
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_DATA_PULLED
)paren
suffix:colon
r_if
c_cond
(paren
id|sp-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot; l2l1 tx_skb exist this shouldn&squot;t happen&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sp-&gt;dlogflag
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_amp
l_int|1
)paren
)paren
)paren
(brace
multiline_comment|/* I-FRAME */
id|LogFrame
c_func
(paren
id|sp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;Q.931 frame user-&gt;network tei %d&quot;
comma
id|st-&gt;l2.tei
)paren
suffix:semicolon
id|dlogframe
c_func
(paren
id|sp
comma
id|skb-&gt;data
op_plus
id|st-&gt;l2.ihsize
comma
id|skb-&gt;len
op_minus
id|st-&gt;l2.ihsize
comma
id|str
)paren
suffix:semicolon
)brace
id|sp-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|sp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|sp
comma
id|skb
comma
l_string|&quot;PH_DATA_PULLED&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|sp
op_member_access_from_pointer
id|isac_fill_fifo
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_REQUEST_PULL
)paren
suffix:colon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|sp-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;-&gt; PH_REQUEST_PULL&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|sp-&gt;tx_skb
)paren
(brace
id|st-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL_ACK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|st-&gt;l1.requestpull
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|hscx_process_xmt
id|hscx_process_xmt
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|hsp-&gt;st
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;tx_skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.requestpull
)paren
(brace
id|st-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL_ACK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;active
)paren
r_if
c_cond
(paren
(paren
op_logical_neg
id|hsp-&gt;tx_skb
)paren
op_logical_and
(paren
op_logical_neg
id|skb_queue_len
c_func
(paren
op_amp
id|hsp-&gt;squeue
)paren
)paren
)paren
id|hsp-&gt;sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|hsp
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hscx_process_rcv
id|hscx_process_rcv
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#ifdef DEBUG_MAGIC
r_if
c_cond
(paren
id|hsp-&gt;magic
op_ne
l_int|301270
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;hscx_process_rcv magic not 301270&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|hsp-&gt;rqueue
)paren
)paren
)paren
(brace
id|hsp-&gt;st-&gt;l1
dot
id|l1l2
c_func
(paren
id|hsp-&gt;st
comma
id|PH_DATA
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|hscx_bh
id|hscx_bh
c_func
(paren
r_struct
id|HscxState
op_star
id|hsp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|hsp
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|HSCX_RCVBUFREADY
comma
op_amp
id|hsp-&gt;event
)paren
)paren
id|hscx_process_rcv
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|HSCX_XMTBUFREADY
comma
op_amp
id|hsp-&gt;event
)paren
)paren
id|hscx_process_xmt
c_func
(paren
id|hsp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * interrupt stuff ends here&n; */
r_void
DECL|function|HiSax_addlist
id|HiSax_addlist
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_struct
id|PStack
op_star
id|st
)paren
(brace
id|st-&gt;next
op_assign
id|sp-&gt;stlist
suffix:semicolon
id|sp-&gt;stlist
op_assign
id|st
suffix:semicolon
)brace
r_void
DECL|function|HiSax_rmlist
id|HiSax_rmlist
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_struct
id|PStack
op_star
id|st
)paren
(brace
r_struct
id|PStack
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;stlist
op_eq
id|st
)paren
id|sp-&gt;stlist
op_assign
id|st-&gt;next
suffix:semicolon
r_else
(brace
id|p
op_assign
id|sp-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
r_if
c_cond
(paren
id|p-&gt;next
op_eq
id|st
)paren
(brace
id|p-&gt;next
op_assign
id|st-&gt;next
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|check_ph_act
id|check_ph_act
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|sp-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;l1.act_state
)paren
r_return
suffix:semicolon
id|st
op_assign
id|st-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sp-&gt;ph_active
op_eq
l_int|5
)paren
id|sp-&gt;ph_active
op_assign
l_int|4
suffix:semicolon
)brace
r_static
r_void
DECL|function|HiSax_manl1
id|HiSax_manl1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_char
id|tmp
(braket
l_int|32
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
r_if
c_cond
(paren
id|sp-&gt;debug
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;PH_ACT ph_active %d&quot;
comma
id|sp-&gt;ph_active
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;ph_active
op_amp
l_int|4
)paren
(brace
id|sp-&gt;ph_active
op_assign
l_int|5
suffix:semicolon
id|st-&gt;l1.act_state
op_assign
l_int|2
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1man
c_func
(paren
id|st
comma
id|PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|st-&gt;l1.act_state
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;ph_active
op_eq
l_int|0
)paren
id|restart_ph
c_func
(paren
id|sp
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
id|st-&gt;l1.act_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;debug
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;PH_DEACT ph_active %d&quot;
comma
id|sp-&gt;ph_active
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|check_ph_act
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|HiSax_l2l1discardq
id|HiSax_l2l1discardq
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|heldby
comma
r_int
id|releasetoo
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#ifdef DEBUG_MAGIC
r_if
c_cond
(paren
id|sp-&gt;magic
op_ne
l_int|301271
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isac_discardq magic not 301271&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sp-&gt;sq
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|setstack_HiSax
id|setstack_HiSax
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|IsdnCardState
op_star
id|sp
)paren
(brace
id|st-&gt;l1.hardware
op_assign
id|sp
suffix:semicolon
id|st-&gt;protocol
op_assign
id|sp-&gt;protocol
suffix:semicolon
id|setstack_tei
c_func
(paren
id|st
)paren
suffix:semicolon
id|st-&gt;l1.stlistp
op_assign
op_amp
(paren
id|sp-&gt;stlist
)paren
suffix:semicolon
id|st-&gt;l1.act_state
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|l2l1
suffix:semicolon
id|st-&gt;l2.l2l1discardq
op_assign
id|HiSax_l2l1discardq
suffix:semicolon
id|st-&gt;ma.manl1
op_assign
id|HiSax_manl1
suffix:semicolon
id|st-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|init_hscxstate
id|init_hscxstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
id|hscx
)paren
(brace
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|hscx
suffix:semicolon
id|hsp-&gt;sp
op_assign
id|sp
suffix:semicolon
id|hsp-&gt;hscx
op_assign
id|hscx
suffix:semicolon
id|hsp-&gt;tqueue.next
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;tqueue.sync
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;tqueue.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|hscx_bh
suffix:semicolon
id|hsp-&gt;tqueue.data
op_assign
id|hsp
suffix:semicolon
id|hsp-&gt;inuse
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;init
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;active
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG_MAGIC
id|hsp-&gt;magic
op_assign
l_int|301270
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|get_irq
id|get_irq
c_func
(paren
r_int
id|cardnr
comma
r_void
op_star
id|routine
)paren
(brace
r_struct
id|IsdnCard
op_star
id|card
op_assign
id|cards
op_plus
id|cardnr
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|card-&gt;sp-&gt;irq
comma
id|routine
comma
id|I4L_IRQ_FLAG
comma
l_string|&quot;HiSax&quot;
comma
id|card-&gt;sp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: couldn&squot;t get interrupt %d&bslash;n&quot;
comma
id|card-&gt;sp-&gt;irq
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_irq
id|release_irq
c_func
(paren
r_int
id|cardnr
)paren
(brace
r_struct
id|IsdnCard
op_star
id|card
op_assign
id|cards
op_plus
id|cardnr
suffix:semicolon
id|free_irq
c_func
(paren
id|card-&gt;sp-&gt;irq
comma
id|card-&gt;sp
)paren
suffix:semicolon
)brace
r_void
DECL|function|close_hscxstate
id|close_hscxstate
c_func
(paren
r_struct
id|HscxState
op_star
id|hs
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|hs-&gt;sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|hs
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|hs-&gt;inuse
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hs-&gt;init
)paren
(brace
r_if
c_cond
(paren
id|hs-&gt;rcvbuf
)paren
(brace
id|kfree
c_func
(paren
id|hs-&gt;rcvbuf
)paren
suffix:semicolon
id|hs-&gt;rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|hs-&gt;rqueue
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|hs-&gt;squeue
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hs-&gt;tx_skb
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|hs-&gt;tx_skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|hs-&gt;tx_skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|hs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|hs-&gt;init
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|closecard
id|closecard
c_func
(paren
r_int
id|cardnr
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|cards
(braket
id|cardnr
)braket
dot
id|sp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|close_hscxstate
c_func
(paren
id|csta-&gt;hs
op_plus
l_int|1
)paren
suffix:semicolon
id|close_hscxstate
c_func
(paren
id|csta-&gt;hs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;rcvbuf
)paren
(brace
id|kfree
c_func
(paren
id|csta-&gt;rcvbuf
)paren
suffix:semicolon
id|csta-&gt;rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|csta-&gt;rq
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|csta-&gt;sq
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csta-&gt;tx_skb
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|csta-&gt;tx_skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|csta-&gt;tx_skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|csta-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|csta-&gt;typ
)paren
(brace
macro_line|#if CARD_TELES0
r_case
id|ISDN_CTYPE_16_0
suffix:colon
r_case
id|ISDN_CTYPE_8_0
suffix:colon
id|release_io_teles0
c_func
(paren
id|cards
op_plus
id|cardnr
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_TELES3
r_case
id|ISDN_CTYPE_PNP
suffix:colon
r_case
id|ISDN_CTYPE_16_3
suffix:colon
r_case
id|ISDN_CTYPE_TELESPCMCIA
suffix:colon
id|release_io_teles3
c_func
(paren
id|cards
op_plus
id|cardnr
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_AVM_A1
r_case
id|ISDN_CTYPE_A1
suffix:colon
id|release_io_avm_a1
c_func
(paren
id|cards
op_plus
id|cardnr
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_ELSA
r_case
id|ISDN_CTYPE_ELSA
suffix:colon
r_case
id|ISDN_CTYPE_ELSA_QS1000
suffix:colon
id|release_io_elsa
c_func
(paren
id|cards
op_plus
id|cardnr
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_IX1MICROR2
r_case
id|ISDN_CTYPE_IX1MICROR2
suffix:colon
id|release_io_ix1micro
c_func
(paren
id|cards
op_plus
id|cardnr
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|ll_unload
c_func
(paren
id|csta
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|checkcard
id|checkcard
c_func
(paren
r_int
id|cardnr
comma
r_char
op_star
id|id
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|IsdnCard
op_star
id|card
op_assign
id|cards
op_plus
id|cardnr
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|IsdnCardState
)paren
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for IsdnCardState(card %d)&bslash;n&quot;
comma
id|cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|card-&gt;sp
op_assign
id|sp
suffix:semicolon
id|sp-&gt;cardnr
op_assign
id|cardnr
suffix:semicolon
id|sp-&gt;cfg_reg
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;protocol
op_assign
id|card-&gt;protocol
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;typ
OG
l_int|0
)paren
op_logical_and
(paren
id|card-&gt;typ
OL
l_int|31
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
l_int|1
op_lshift
id|card-&gt;typ
)paren
op_amp
id|SUPORTED_CARDS
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: Support for %s Card not selected&bslash;n&quot;
comma
id|CardType
(braket
id|card-&gt;typ
)braket
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: Card Type %d out of range&bslash;n&quot;
comma
id|card-&gt;typ
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp-&gt;dlogspace
op_assign
id|kmalloc
c_func
(paren
l_int|4096
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for dlogspace(card %d)&bslash;n&quot;
comma
id|cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp-&gt;status_buf
op_assign
id|kmalloc
c_func
(paren
id|HISAX_STATUS_BUFSIZE
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for status_buf(card %d)&bslash;n&quot;
comma
id|cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sp-&gt;dlogspace
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|sp-&gt;status_read
op_assign
id|sp-&gt;status_buf
suffix:semicolon
id|sp-&gt;status_write
op_assign
id|sp-&gt;status_buf
suffix:semicolon
id|sp-&gt;status_end
op_assign
id|sp-&gt;status_buf
op_plus
id|HISAX_STATUS_BUFSIZE
op_minus
l_int|1
suffix:semicolon
id|sp-&gt;typ
op_assign
id|card-&gt;typ
suffix:semicolon
id|sp-&gt;CallFlags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|sp-&gt;iif.id
comma
id|id
)paren
suffix:semicolon
id|sp-&gt;iif.channels
op_assign
l_int|2
suffix:semicolon
id|sp-&gt;iif.maxbufsize
op_assign
id|MAX_DATA_SIZE
suffix:semicolon
id|sp-&gt;iif.hl_hdrlen
op_assign
id|MAX_HEADER_LEN
suffix:semicolon
id|sp-&gt;iif.features
op_assign
id|ISDN_FEATURE_L2_X75I
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L2_TRANS
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
macro_line|#ifdef&t;CONFIG_HISAX_1TR6
id|ISDN_FEATURE_P_1TR6
op_or
macro_line|#endif
macro_line|#ifdef&t;CONFIG_HISAX_EURO
id|ISDN_FEATURE_P_EURO
op_or
macro_line|#endif
macro_line|#ifdef        CONFIG_HISAX_NI1
id|ISDN_FEATURE_P_NI1
op_or
macro_line|#endif
l_int|0
suffix:semicolon
id|sp-&gt;iif.command
op_assign
id|HiSax_command
suffix:semicolon
id|sp-&gt;iif.writebuf
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;iif.writecmd
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;iif.writebuf_skb
op_assign
id|HiSax_writebuf_skb
suffix:semicolon
id|sp-&gt;iif.readstat
op_assign
id|HiSax_readstatus
suffix:semicolon
id|register_isdn
c_func
(paren
op_amp
id|sp-&gt;iif
)paren
suffix:semicolon
id|sp-&gt;myid
op_assign
id|sp-&gt;iif.channels
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;HiSax: Card %d Protocol %s Id=%s (%d)&bslash;n&quot;
comma
id|cardnr
op_plus
l_int|1
comma
(paren
id|card-&gt;protocol
op_eq
id|ISDN_PTYPE_1TR6
)paren
ques
c_cond
l_string|&quot;1TR6&quot;
suffix:colon
(paren
id|card-&gt;protocol
op_eq
id|ISDN_PTYPE_EURO
)paren
ques
c_cond
l_string|&quot;EDSS1&quot;
suffix:colon
(paren
id|card-&gt;protocol
op_eq
id|ISDN_PTYPE_LEASED
)paren
ques
c_cond
l_string|&quot;LEASED&quot;
suffix:colon
(paren
id|card-&gt;protocol
op_eq
id|ISDN_PTYPE_NI1
)paren
ques
c_cond
l_string|&quot;NI1&quot;
suffix:colon
l_string|&quot;NONE&quot;
comma
id|sp-&gt;iif.id
comma
id|sp-&gt;myid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;typ
)paren
(brace
macro_line|#if CARD_TELES0
r_case
id|ISDN_CTYPE_16_0
suffix:colon
r_case
id|ISDN_CTYPE_8_0
suffix:colon
id|ret
op_assign
id|setup_teles0
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_TELES3
r_case
id|ISDN_CTYPE_16_3
suffix:colon
r_case
id|ISDN_CTYPE_PNP
suffix:colon
r_case
id|ISDN_CTYPE_TELESPCMCIA
suffix:colon
id|ret
op_assign
id|setup_teles3
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_AVM_A1
r_case
id|ISDN_CTYPE_A1
suffix:colon
id|ret
op_assign
id|setup_avm_a1
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_ELSA
r_case
id|ISDN_CTYPE_ELSA
suffix:colon
r_case
id|ISDN_CTYPE_ELSA_QS1000
suffix:colon
id|ret
op_assign
id|setup_elsa
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_IX1MICROR2
r_case
id|ISDN_CTYPE_IX1MICROR2
suffix:colon
id|ret
op_assign
id|setup_ix1micro
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: Unknown Card Typ %d&bslash;n&quot;
comma
id|card-&gt;typ
)paren
suffix:semicolon
id|ll_unload
c_func
(paren
id|sp
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|ll_unload
c_func
(paren
id|sp
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp-&gt;rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|MAX_DFRAME_LEN
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for isac rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|sp-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;event
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;tqueue.next
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;tqueue.sync
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;tqueue.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|isac_bh
suffix:semicolon
id|sp-&gt;tqueue.data
op_assign
id|sp
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sp-&gt;rq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sp-&gt;sq
)paren
suffix:semicolon
id|sp-&gt;stlist
op_assign
l_int|NULL
suffix:semicolon
id|sp-&gt;ph_active
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;dlogflag
op_assign
l_int|0
suffix:semicolon
id|sp-&gt;debug
op_assign
id|L1_DEB_WARN
suffix:semicolon
macro_line|#ifdef DEBUG_MAGIC
id|sp-&gt;magic
op_assign
l_int|301271
suffix:semicolon
macro_line|#endif
id|init_hscxstate
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
id|init_hscxstate
c_func
(paren
id|sp
comma
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;typ
)paren
(brace
macro_line|#if CARD_TELES0
r_case
id|ISDN_CTYPE_16_0
suffix:colon
r_case
id|ISDN_CTYPE_8_0
suffix:colon
id|ret
op_assign
id|initteles0
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_TELES3
r_case
id|ISDN_CTYPE_16_3
suffix:colon
r_case
id|ISDN_CTYPE_PNP
suffix:colon
r_case
id|ISDN_CTYPE_TELESPCMCIA
suffix:colon
id|ret
op_assign
id|initteles3
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_AVM_A1
r_case
id|ISDN_CTYPE_A1
suffix:colon
id|ret
op_assign
id|initavm_a1
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_ELSA
r_case
id|ISDN_CTYPE_ELSA
suffix:colon
r_case
id|ISDN_CTYPE_ELSA_QS1000
suffix:colon
id|ret
op_assign
id|initelsa
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if CARD_IX1MICROR2
r_case
id|ISDN_CTYPE_IX1MICROR2
suffix:colon
id|ret
op_assign
id|initix1micro
c_func
(paren
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|closecard
c_func
(paren
id|cardnr
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|init_tei
c_func
(paren
id|sp
comma
id|sp-&gt;protocol
)paren
suffix:semicolon
id|CallcNewChan
c_func
(paren
id|sp
)paren
suffix:semicolon
id|ll_run
c_func
(paren
id|sp
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_void
DECL|function|HiSax_shiftcards
id|HiSax_shiftcards
c_func
(paren
r_int
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|idx
suffix:semicolon
id|i
OL
l_int|15
suffix:semicolon
id|i
op_increment
)paren
id|memcpy
c_func
(paren
op_amp
id|cards
(braket
id|i
)braket
comma
op_amp
id|cards
(braket
id|i
op_plus
l_int|1
)braket
comma
r_sizeof
(paren
id|cards
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|HiSax_inithardware
id|HiSax_inithardware
c_func
(paren
r_void
)paren
(brace
r_int
id|foundcards
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|t
op_assign
l_char|&squot;,&squot;
suffix:semicolon
r_int
id|flg
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|id
suffix:semicolon
r_char
op_star
id|next_id
op_assign
id|HiSax_id
suffix:semicolon
r_char
id|ids
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|strchr
c_func
(paren
id|HiSax_id
comma
l_char|&squot;,&squot;
)paren
)paren
id|t
op_assign
l_char|&squot;,&squot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strchr
c_func
(paren
id|HiSax_id
comma
l_char|&squot;%&squot;
)paren
)paren
id|t
op_assign
l_char|&squot;%&squot;
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|nrcards
)paren
(brace
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|typ
OL
l_int|1
)paren
r_break
suffix:semicolon
id|id
op_assign
id|next_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|next_id
op_assign
id|strchr
c_func
(paren
id|id
comma
id|t
)paren
)paren
)paren
(brace
op_star
id|next_id
op_increment
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|ids
comma
id|id
)paren
suffix:semicolon
id|flg
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|next_id
op_assign
id|id
suffix:semicolon
r_if
c_cond
(paren
id|flg
op_ge
id|i
)paren
id|strcpy
c_func
(paren
id|ids
comma
id|id
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|ids
comma
l_string|&quot;%s%d&quot;
comma
id|id
comma
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checkcard
c_func
(paren
id|i
comma
id|ids
)paren
)paren
(brace
id|foundcards
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: Card %s not installed !&bslash;n&quot;
comma
id|CardType
(braket
id|cards
(braket
id|i
)braket
dot
id|typ
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
id|cards
(braket
id|i
)braket
dot
id|sp
op_assign
l_int|NULL
suffix:semicolon
id|HiSax_shiftcards
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
)brace
r_return
id|foundcards
suffix:semicolon
)brace
r_void
DECL|function|HiSax_closehardware
id|HiSax_closehardware
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
(brace
id|ll_stop
c_func
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
id|CallcFreeChan
c_func
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
id|release_tei
c_func
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
id|release_irq
c_func
(paren
id|i
)paren
suffix:semicolon
id|closecard
c_func
(paren
id|i
)paren
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
id|cards
(braket
id|i
)braket
dot
id|sp
op_assign
l_int|NULL
suffix:semicolon
)brace
id|Isdnl2Free
c_func
(paren
)paren
suffix:semicolon
id|CallcFree
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hscx_l2l1
id|hscx_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|st-&gt;l1.hscx
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
)paren
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hsp-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|hsp-&gt;squeue
comma
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|hsp-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|hsp-&gt;count
op_assign
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_DATA_PULLED
)paren
suffix:colon
r_if
c_cond
(paren
id|hsp-&gt;tx_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;hscx_l2l1: this shouldn&squot;t happen&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hsp-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|hsp-&gt;count
op_assign
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|hscx_fill_fifo
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_REQUEST_PULL
)paren
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;tx_skb
)paren
(brace
id|st-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL_ACK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|st-&gt;l1.requestpull
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_extern
r_struct
id|IsdnBuffers
op_star
id|tracebuf
suffix:semicolon
r_static
r_void
DECL|function|hscx_l2l1discardq
id|hscx_l2l1discardq
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|heldby
comma
r_int
id|releasetoo
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|st-&gt;l1.hscx
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#ifdef DEBUG_MAGIC
r_if
c_cond
(paren
id|hsp-&gt;magic
op_ne
l_int|301270
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;hscx_discardq magic not 301270&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|hsp-&gt;squeue
)paren
)paren
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|open_hscxstate
id|open_hscxstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_int
id|hscx
)paren
(brace
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|hscx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;init
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|hsp-&gt;rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|HSCX_BUFMAX
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for hscx_rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|hsp-&gt;rqueue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|hsp-&gt;squeue
)paren
suffix:semicolon
)brace
id|hsp-&gt;init
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|hsp-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|hsp-&gt;event
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
id|hsp-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hscx_manl1
id|hscx_manl1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|st-&gt;l1.hscx
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
id|hsp-&gt;active
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|hsp
comma
id|st-&gt;l1.hscxmode
comma
id|st-&gt;l1.hscxchannel
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1man
c_func
(paren
id|st
comma
id|PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hsp-&gt;tx_skb
)paren
id|sp
op_member_access_from_pointer
id|modehscx
c_func
(paren
id|hsp
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|hsp-&gt;active
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_int
DECL|function|setstack_hscx
id|setstack_hscx
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|HscxState
op_star
id|hs
)paren
(brace
r_if
c_cond
(paren
id|open_hscxstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|hs-&gt;hscx
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.hscx
op_assign
id|hs-&gt;hscx
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|hscx_l2l1
suffix:semicolon
id|st-&gt;ma.manl1
op_assign
id|hscx_manl1
suffix:semicolon
id|st-&gt;l2.l2l1discardq
op_assign
id|hscx_l2l1discardq
suffix:semicolon
id|st-&gt;l1.act_state
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1.requestpull
op_assign
l_int|0
suffix:semicolon
id|hs-&gt;st
op_assign
id|st
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|HiSax_reportcard
id|HiSax_reportcard
c_func
(paren
r_int
id|cardnr
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|cards
(braket
id|cardnr
)braket
dot
id|sp
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: reportcard No %d&bslash;n&quot;
comma
id|cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: Type %s&bslash;n&quot;
comma
id|CardType
(braket
id|sp-&gt;typ
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: debuglevel %x&bslash;n&quot;
comma
id|sp-&gt;debug
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: HiSax_reportcard address 0x%lX&bslash;n&quot;
comma
(paren
id|ulong
)paren
op_amp
id|HiSax_reportcard
)paren
suffix:semicolon
)brace
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_char
op_star
DECL|function|l2cmd
id|l2cmd
c_func
(paren
id|u_char
id|cmd
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
op_complement
l_int|0x10
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
l_string|&quot;RR&quot;
suffix:semicolon
r_case
l_int|5
suffix:colon
r_return
l_string|&quot;RNR&quot;
suffix:semicolon
r_case
l_int|9
suffix:colon
r_return
l_string|&quot;REJ&quot;
suffix:semicolon
r_case
l_int|0x6f
suffix:colon
r_return
l_string|&quot;SABME&quot;
suffix:semicolon
r_case
l_int|0x0f
suffix:colon
r_return
l_string|&quot;DM&quot;
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
l_string|&quot;UI&quot;
suffix:semicolon
r_case
l_int|0x43
suffix:colon
r_return
l_string|&quot;DISC&quot;
suffix:semicolon
r_case
l_int|0x63
suffix:colon
r_return
l_string|&quot;UA&quot;
suffix:semicolon
r_case
l_int|0x87
suffix:colon
r_return
l_string|&quot;FRMR&quot;
suffix:semicolon
r_case
l_int|0xaf
suffix:colon
r_return
l_string|&quot;XID&quot;
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd
op_amp
l_int|1
)paren
)paren
r_return
l_string|&quot;I&quot;
suffix:semicolon
r_else
r_return
l_string|&quot;invalid command&quot;
suffix:semicolon
)brace
)brace
DECL|variable|tmp
r_static
r_char
id|tmp
(braket
l_int|20
)braket
suffix:semicolon
r_char
op_star
DECL|function|l2frames
id|l2frames
c_func
(paren
id|u_char
op_star
id|ptr
)paren
(brace
r_switch
c_cond
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
op_complement
l_int|0x10
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|9
suffix:colon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s[%d](nr %d)&quot;
comma
id|l2cmd
c_func
(paren
id|ptr
(braket
l_int|2
)braket
)paren
comma
id|ptr
(braket
l_int|3
)braket
op_amp
l_int|1
comma
id|ptr
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6f
suffix:colon
r_case
l_int|0x0f
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|0x43
suffix:colon
r_case
l_int|0x63
suffix:colon
r_case
l_int|0x87
suffix:colon
r_case
l_int|0xaf
suffix:colon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s[%d]&quot;
comma
id|l2cmd
c_func
(paren
id|ptr
(braket
l_int|2
)braket
)paren
comma
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
l_int|0x10
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
l_int|1
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;I[%d](ns %d, nr %d)&quot;
comma
id|ptr
(braket
l_int|3
)braket
op_amp
l_int|1
comma
id|ptr
(braket
l_int|2
)braket
op_rshift
l_int|1
comma
id|ptr
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_return
l_string|&quot;invalid command&quot;
suffix:semicolon
)brace
r_return
id|tmp
suffix:semicolon
)brace
r_void
DECL|function|Logl2Frame
id|Logl2Frame
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|sp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|buf
comma
r_int
id|dir
)paren
(brace
r_char
id|tmp
(braket
l_int|132
)braket
suffix:semicolon
id|u_char
op_star
id|ptr
suffix:semicolon
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|ptr
(braket
l_int|0
)braket
op_amp
l_int|1
op_logical_or
op_logical_neg
(paren
id|ptr
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
)paren
id|debugl1
c_func
(paren
id|sp
comma
l_string|&quot;Addres not LAPD&quot;
)paren
suffix:semicolon
r_else
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s %s: %s%c (sapi %d, tei %d)&quot;
comma
(paren
id|dir
ques
c_cond
l_string|&quot;&lt;-&quot;
suffix:colon
l_string|&quot;-&gt;&quot;
)paren
comma
id|buf
comma
id|l2frames
c_func
(paren
id|ptr
)paren
comma
(paren
(paren
id|ptr
(braket
l_int|0
)braket
op_amp
l_int|2
)paren
op_rshift
l_int|1
)paren
op_eq
id|dir
ques
c_cond
l_char|&squot;C&squot;
suffix:colon
l_char|&squot;R&squot;
comma
id|ptr
(braket
l_int|0
)braket
op_rshift
l_int|2
comma
id|ptr
(braket
l_int|1
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
eof
