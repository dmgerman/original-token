multiline_comment|/* $Id: isdnl1.c,v 2.41.6.1 2000/12/10 22:01:04 kai Exp $&n; *&n; * isdnl1.c     common low level stuff for Siemens Chipsetbased isdn cards&n; *              based on the teles driver from Jan den Ouden&n; *&n; * Author       Karsten Keil (keil@isdn4linux.de)&n; *&n; *&t;&t;This file is (c) under GNU PUBLIC LICENSE&n; *&t;&t;For changes and modifications please read&n; *&t;&t;../../../Documentation/isdn/HiSax.cert&n; *&n; * Thanks to    Jan den Ouden&n; *              Fritz Elfert&n; *              Beat Doebeli&n; *&n; */
DECL|variable|l1_revision
r_const
r_char
op_star
id|l1_revision
op_assign
l_string|&quot;$Revision: 2.41.6.1 $&quot;
suffix:semicolon
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
DECL|macro|TIMER3_VALUE
mdefine_line|#define TIMER3_VALUE 7000
DECL|variable|l1fsm_b
r_static
r_struct
id|Fsm
id|l1fsm_b
suffix:semicolon
DECL|variable|l1fsm_s
r_static
r_struct
id|Fsm
id|l1fsm_s
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_L1_F2
id|ST_L1_F2
comma
DECL|enumerator|ST_L1_F3
id|ST_L1_F3
comma
DECL|enumerator|ST_L1_F4
id|ST_L1_F4
comma
DECL|enumerator|ST_L1_F5
id|ST_L1_F5
comma
DECL|enumerator|ST_L1_F6
id|ST_L1_F6
comma
DECL|enumerator|ST_L1_F7
id|ST_L1_F7
comma
DECL|enumerator|ST_L1_F8
id|ST_L1_F8
comma
)brace
suffix:semicolon
DECL|macro|L1S_STATE_COUNT
mdefine_line|#define L1S_STATE_COUNT (ST_L1_F8+1)
DECL|variable|strL1SState
r_static
r_char
op_star
id|strL1SState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_L1_F2&quot;
comma
l_string|&quot;ST_L1_F3&quot;
comma
l_string|&quot;ST_L1_F4&quot;
comma
l_string|&quot;ST_L1_F5&quot;
comma
l_string|&quot;ST_L1_F6&quot;
comma
l_string|&quot;ST_L1_F7&quot;
comma
l_string|&quot;ST_L1_F8&quot;
comma
)brace
suffix:semicolon
macro_line|#ifdef HISAX_UINTERFACE
r_static
DECL|variable|l1fsm_u
r_struct
id|Fsm
id|l1fsm_u
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_L1_RESET
id|ST_L1_RESET
comma
DECL|enumerator|ST_L1_DEACT
id|ST_L1_DEACT
comma
DECL|enumerator|ST_L1_SYNC2
id|ST_L1_SYNC2
comma
DECL|enumerator|ST_L1_TRANS
id|ST_L1_TRANS
comma
)brace
suffix:semicolon
DECL|macro|L1U_STATE_COUNT
mdefine_line|#define L1U_STATE_COUNT (ST_L1_TRANS+1)
DECL|variable|strL1UState
r_static
r_char
op_star
id|strL1UState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_L1_RESET&quot;
comma
l_string|&quot;ST_L1_DEACT&quot;
comma
l_string|&quot;ST_L1_SYNC2&quot;
comma
l_string|&quot;ST_L1_TRANS&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
r_enum
(brace
DECL|enumerator|ST_L1_NULL
id|ST_L1_NULL
comma
DECL|enumerator|ST_L1_WAIT_ACT
id|ST_L1_WAIT_ACT
comma
DECL|enumerator|ST_L1_WAIT_DEACT
id|ST_L1_WAIT_DEACT
comma
DECL|enumerator|ST_L1_ACTIV
id|ST_L1_ACTIV
comma
)brace
suffix:semicolon
DECL|macro|L1B_STATE_COUNT
mdefine_line|#define L1B_STATE_COUNT (ST_L1_ACTIV+1)
DECL|variable|strL1BState
r_static
r_char
op_star
id|strL1BState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_L1_NULL&quot;
comma
l_string|&quot;ST_L1_WAIT_ACT&quot;
comma
l_string|&quot;ST_L1_WAIT_DEACT&quot;
comma
l_string|&quot;ST_L1_ACTIV&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_PH_ACTIVATE
id|EV_PH_ACTIVATE
comma
DECL|enumerator|EV_PH_DEACTIVATE
id|EV_PH_DEACTIVATE
comma
DECL|enumerator|EV_RESET_IND
id|EV_RESET_IND
comma
DECL|enumerator|EV_DEACT_CNF
id|EV_DEACT_CNF
comma
DECL|enumerator|EV_DEACT_IND
id|EV_DEACT_IND
comma
DECL|enumerator|EV_POWER_UP
id|EV_POWER_UP
comma
DECL|enumerator|EV_RSYNC_IND
id|EV_RSYNC_IND
comma
DECL|enumerator|EV_INFO2_IND
id|EV_INFO2_IND
comma
DECL|enumerator|EV_INFO4_IND
id|EV_INFO4_IND
comma
DECL|enumerator|EV_TIMER_DEACT
id|EV_TIMER_DEACT
comma
DECL|enumerator|EV_TIMER_ACT
id|EV_TIMER_ACT
comma
DECL|enumerator|EV_TIMER3
id|EV_TIMER3
comma
)brace
suffix:semicolon
DECL|macro|L1_EVENT_COUNT
mdefine_line|#define L1_EVENT_COUNT (EV_TIMER3 + 1)
DECL|variable|strL1Event
r_static
r_char
op_star
id|strL1Event
(braket
)braket
op_assign
(brace
l_string|&quot;EV_PH_ACTIVATE&quot;
comma
l_string|&quot;EV_PH_DEACTIVATE&quot;
comma
l_string|&quot;EV_RESET_IND&quot;
comma
l_string|&quot;EV_DEACT_CNF&quot;
comma
l_string|&quot;EV_DEACT_IND&quot;
comma
l_string|&quot;EV_POWER_UP&quot;
comma
l_string|&quot;EV_RSYNC_IND&quot;
comma
l_string|&quot;EV_INFO2_IND&quot;
comma
l_string|&quot;EV_INFO4_IND&quot;
comma
l_string|&quot;EV_TIMER_DEACT&quot;
comma
l_string|&quot;EV_TIMER_ACT&quot;
comma
l_string|&quot;EV_TIMER3&quot;
comma
)brace
suffix:semicolon
r_void
DECL|function|debugl1
id|debugl1
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_char
id|tmp
(braket
l_int|8
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Card%d &quot;
comma
id|cs-&gt;cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|VHiSax_putstatus
c_func
(paren
id|cs
comma
id|tmp
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1m_debug
id|l1m_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
r_char
id|tmp
(braket
l_int|8
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Card%d &quot;
comma
id|cs-&gt;cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|VHiSax_putstatus
c_func
(paren
id|cs
comma
id|tmp
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
r_void
DECL|function|L1activated
id|L1activated
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
id|st
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
id|st
op_assign
id|st-&gt;next
suffix:semicolon
)brace
)brace
r_void
DECL|function|L1deactivated
id|L1deactivated
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
id|st
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PAUSE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
id|st
op_assign
id|st-&gt;next
suffix:semicolon
)brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|DChannel_proc_xmt
id|DChannel_proc_xmt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
r_return
suffix:semicolon
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|stptr-&gt;l1.Flags
)paren
)paren
(brace
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
r_void
DECL|function|DChannel_proc_rcv
id|DChannel_proc_rcv
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|nskb
suffix:semicolon
r_struct
id|PStack
op_star
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_int
id|found
comma
id|tei
comma
id|sapi
suffix:semicolon
r_if
c_cond
(paren
id|stptr
)paren
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_ACTTIMER
comma
op_amp
id|stptr-&gt;l1.Flags
)paren
)paren
id|FsmEvent
c_func
(paren
op_amp
id|stptr-&gt;l1.l1m
comma
id|EV_TIMER_ACT
comma
l_int|NULL
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|cs-&gt;rq
)paren
)paren
)paren
(brace
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|cs
comma
id|skb
comma
l_string|&quot;PH_DATA&quot;
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|3
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-channel frame too short(%d)&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|1
)paren
op_logical_or
op_logical_neg
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-channel frame wrong EA0/EA1&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sapi
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
op_rshift
l_int|2
suffix:semicolon
id|tei
op_assign
id|skb-&gt;data
(braket
l_int|1
)braket
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_HEX
)paren
id|LogFrame
c_func
(paren
id|cs
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_VERBOSE
)paren
id|dlogframe
c_func
(paren
id|cs
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tei
op_eq
id|GROUP_TEI
)paren
(brace
r_if
c_cond
(paren
id|sapi
op_eq
id|CTRL_SAPI
)paren
(brace
multiline_comment|/* sapi 0 */
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|nskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
)paren
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|nskb
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: isdn broadcast buffer shortage&bslash;n&quot;
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sapi
op_eq
id|TEI_SAPI
)paren
(brace
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|nskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
)paren
id|stptr-&gt;l1
dot
id|l1tei
c_func
(paren
id|stptr
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|nskb
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: tei broadcast buffer shortage&bslash;n&quot;
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sapi
op_eq
id|CTRL_SAPI
)paren
(brace
multiline_comment|/* sapi 0 */
id|found
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|tei
op_eq
id|stptr-&gt;l2.tei
)paren
(brace
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|skb
)paren
suffix:semicolon
id|found
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|BChannel_proc_xmt
id|BChannel_proc_xmt
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|bcs-&gt;st
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;BC_BUSY Error&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
op_logical_and
(paren
op_logical_neg
id|skb_queue_len
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|st-&gt;l2
dot
id|l2l1
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|BChannel_proc_rcv
id|BChannel_proc_rcv
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;st-&gt;l1.l1m.state
op_eq
id|ST_L1_WAIT_ACT
)paren
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|bcs-&gt;st-&gt;l1.timer
comma
l_int|4
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|bcs-&gt;st-&gt;l1.l1m
comma
id|EV_TIMER_ACT
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
)paren
)paren
(brace
id|bcs-&gt;st-&gt;l1
dot
id|l1l2
c_func
(paren
id|bcs-&gt;st
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|BChannel_bh
id|BChannel_bh
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bcs
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|B_RCVBUFREADY
comma
op_amp
id|bcs-&gt;event
)paren
)paren
id|BChannel_proc_rcv
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|B_XMTBUFREADY
comma
op_amp
id|bcs-&gt;event
)paren
)paren
id|BChannel_proc_xmt
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_void
DECL|function|HiSax_addlist
id|HiSax_addlist
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|PStack
op_star
id|st
)paren
(brace
id|st-&gt;next
op_assign
id|cs-&gt;stlist
suffix:semicolon
id|cs-&gt;stlist
op_assign
id|st
suffix:semicolon
)brace
r_void
DECL|function|HiSax_rmlist
id|HiSax_rmlist
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|PStack
op_star
id|st
)paren
(brace
r_struct
id|PStack
op_star
id|p
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;stlist
op_eq
id|st
)paren
id|cs-&gt;stlist
op_assign
id|st-&gt;next
suffix:semicolon
r_else
(brace
id|p
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
r_if
c_cond
(paren
id|p-&gt;next
op_eq
id|st
)paren
(brace
id|p-&gt;next
op_assign
id|st-&gt;next
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
)brace
r_void
DECL|function|init_bcstate
id|init_bcstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|bc
)paren
(brace
r_struct
id|BCState
op_star
id|bcs
op_assign
id|cs-&gt;bcs
op_plus
id|bc
suffix:semicolon
id|bcs-&gt;cs
op_assign
id|cs
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bcs-&gt;tqueue.sync
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tqueue.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|BChannel_bh
suffix:semicolon
id|bcs-&gt;tqueue.data
op_assign
id|bcs
suffix:semicolon
id|bcs-&gt;BC_SetStack
op_assign
l_int|NULL
suffix:semicolon
id|bcs-&gt;BC_Close
op_assign
l_int|NULL
suffix:semicolon
id|bcs-&gt;Flag
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_char
op_star
DECL|function|l2cmd
id|l2cmd
c_func
(paren
id|u_char
id|cmd
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
op_complement
l_int|0x10
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
l_string|&quot;RR&quot;
suffix:semicolon
r_case
l_int|5
suffix:colon
r_return
l_string|&quot;RNR&quot;
suffix:semicolon
r_case
l_int|9
suffix:colon
r_return
l_string|&quot;REJ&quot;
suffix:semicolon
r_case
l_int|0x6f
suffix:colon
r_return
l_string|&quot;SABME&quot;
suffix:semicolon
r_case
l_int|0x0f
suffix:colon
r_return
l_string|&quot;DM&quot;
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
l_string|&quot;UI&quot;
suffix:semicolon
r_case
l_int|0x43
suffix:colon
r_return
l_string|&quot;DISC&quot;
suffix:semicolon
r_case
l_int|0x63
suffix:colon
r_return
l_string|&quot;UA&quot;
suffix:semicolon
r_case
l_int|0x87
suffix:colon
r_return
l_string|&quot;FRMR&quot;
suffix:semicolon
r_case
l_int|0xaf
suffix:colon
r_return
l_string|&quot;XID&quot;
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd
op_amp
l_int|1
)paren
)paren
r_return
l_string|&quot;I&quot;
suffix:semicolon
r_else
r_return
l_string|&quot;invalid command&quot;
suffix:semicolon
)brace
)brace
DECL|variable|tmpdeb
r_static
r_char
id|tmpdeb
(braket
l_int|32
)braket
suffix:semicolon
r_char
op_star
DECL|function|l2frames
id|l2frames
c_func
(paren
id|u_char
op_star
id|ptr
)paren
(brace
r_switch
c_cond
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
op_complement
l_int|0x10
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|9
suffix:colon
id|sprintf
c_func
(paren
id|tmpdeb
comma
l_string|&quot;%s[%d](nr %d)&quot;
comma
id|l2cmd
c_func
(paren
id|ptr
(braket
l_int|2
)braket
)paren
comma
id|ptr
(braket
l_int|3
)braket
op_amp
l_int|1
comma
id|ptr
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6f
suffix:colon
r_case
l_int|0x0f
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|0x43
suffix:colon
r_case
l_int|0x63
suffix:colon
r_case
l_int|0x87
suffix:colon
r_case
l_int|0xaf
suffix:colon
id|sprintf
c_func
(paren
id|tmpdeb
comma
l_string|&quot;%s[%d]&quot;
comma
id|l2cmd
c_func
(paren
id|ptr
(braket
l_int|2
)braket
)paren
comma
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
l_int|0x10
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ptr
(braket
l_int|2
)braket
op_amp
l_int|1
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|tmpdeb
comma
l_string|&quot;I[%d](ns %d, nr %d)&quot;
comma
id|ptr
(braket
l_int|3
)braket
op_amp
l_int|1
comma
id|ptr
(braket
l_int|2
)braket
op_rshift
l_int|1
comma
id|ptr
(braket
l_int|3
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_return
l_string|&quot;invalid command&quot;
suffix:semicolon
)brace
r_return
id|tmpdeb
suffix:semicolon
)brace
r_void
DECL|function|Logl2Frame
id|Logl2Frame
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|buf
comma
r_int
id|dir
)paren
(brace
id|u_char
op_star
id|ptr
suffix:semicolon
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|ptr
(braket
l_int|0
)braket
op_amp
l_int|1
op_logical_or
op_logical_neg
(paren
id|ptr
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;Address not LAPD&quot;
)paren
suffix:semicolon
r_else
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;%s %s: %s%c (sapi %d, tei %d)&quot;
comma
(paren
id|dir
ques
c_cond
l_string|&quot;&lt;-&quot;
suffix:colon
l_string|&quot;-&gt;&quot;
)paren
comma
id|buf
comma
id|l2frames
c_func
(paren
id|ptr
)paren
comma
(paren
(paren
id|ptr
(braket
l_int|0
)braket
op_amp
l_int|2
)paren
op_rshift
l_int|1
)paren
op_eq
id|dir
ques
c_cond
l_char|&squot;C&squot;
suffix:colon
l_char|&squot;R&squot;
comma
id|ptr
(braket
l_int|0
)braket
op_rshift
l_int|2
comma
id|ptr
(braket
l_int|1
)braket
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|l1_reset
id|l1_reset
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_deact_cnf
id|l1_deact_cnf
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_ENABLE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_deact_req_s
id|l1_deact_req_s
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|550
comma
id|EV_TIMER_DEACT
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_DEACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_power_up_s
id|l1_power_up_s
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F4
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_INFO3
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
id|TIMER3_VALUE
comma
id|EV_TIMER3
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_T3RUN
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
)brace
r_else
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_go_F5
id|l1_go_F5
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F5
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_go_F8
id|l1_go_F8
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F8
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_info2_ind
id|l1_info2_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
macro_line|#ifdef HISAX_UINTERFACE
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_UINT
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_SYNC2
)paren
suffix:semicolon
r_else
macro_line|#endif
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F6
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_INFO3
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_info4_ind
id|l1_info4_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
macro_line|#ifdef HISAX_UINTERFACE
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_UINT
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_TRANS
)paren
suffix:semicolon
r_else
macro_line|#endif
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F7
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_INFO3
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DEACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|FsmDelTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|FLG_L1_ACTIVATED
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_T3RUN
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|FsmDelTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|3
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|110
comma
id|EV_TIMER_ACT
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_ACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l1_timer3
id|l1_timer3
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_T3RUN
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|L1deactivated
c_func
(paren
id|st-&gt;l1.hardware
)paren
suffix:semicolon
macro_line|#ifdef HISAX_UINTERFACE
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|FLG_L1_UINT
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
macro_line|#endif
r_if
c_cond
(paren
id|st-&gt;l1.l1m.state
op_ne
id|ST_L1_F6
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_ENABLE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l1_timer_act
id|l1_timer_act
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_ACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_ACTIVATED
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|L1activated
c_func
(paren
id|st-&gt;l1.hardware
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_timer_deact
id|l1_timer_deact
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DEACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_ACTIVATED
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|L1deactivated
c_func
(paren
id|st-&gt;l1.hardware
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_DEACTIVATE
op_or
id|RESPONSE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_activate_s
id|l1_activate_s
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_RESET
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_activate_no
id|l1_activate_no
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|FLG_L1_DEACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
op_logical_and
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|FLG_L1_T3RUN
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|L1deactivated
c_func
(paren
id|st-&gt;l1.hardware
)paren
suffix:semicolon
)brace
)brace
DECL|variable|__initdata
r_static
r_struct
id|FsmNode
id|L1SFnList
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ST_L1_F3
comma
id|EV_PH_ACTIVATE
comma
id|l1_activate_s
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_PH_ACTIVATE
comma
id|l1_activate_no
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_PH_ACTIVATE
comma
id|l1_activate_no
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_RESET_IND
comma
id|l1_reset
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_DEACT_CNF
comma
id|l1_deact_cnf
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_s
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_s
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_s
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_POWER_UP
comma
id|l1_power_up_s
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_RSYNC_IND
comma
id|l1_go_F5
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_RSYNC_IND
comma
id|l1_go_F8
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_RSYNC_IND
comma
id|l1_go_F8
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_TIMER_ACT
comma
id|l1_timer_act
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
)brace
suffix:semicolon
DECL|macro|L1S_FN_COUNT
mdefine_line|#define L1S_FN_COUNT (sizeof(L1SFnList)/sizeof(struct FsmNode))
macro_line|#ifdef HISAX_UINTERFACE
r_static
r_void
DECL|function|l1_deact_req_u
id|l1_deact_req_u
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_RESET
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|550
comma
id|EV_TIMER_DEACT
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_DEACTTIMER
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_ENABLE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_power_up_u
id|l1_power_up_u
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
id|TIMER3_VALUE
comma
id|EV_TIMER3
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_L1_T3RUN
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_info0_ind
id|l1_info0_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_DEACT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1_activate_u
id|l1_activate_u
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_INFO1
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|FsmNode
id|L1UFnList
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ST_L1_RESET
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_u
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_u
)brace
comma
(brace
id|ST_L1_SYNC2
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_u
)brace
comma
(brace
id|ST_L1_TRANS
comma
id|EV_DEACT_IND
comma
id|l1_deact_req_u
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_PH_ACTIVATE
comma
id|l1_activate_u
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_POWER_UP
comma
id|l1_power_up_u
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_TRANS
comma
id|EV_INFO2_IND
comma
id|l1_info2_ind
)brace
comma
(brace
id|ST_L1_RESET
comma
id|EV_DEACT_CNF
comma
id|l1_info0_ind
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_SYNC2
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_RESET
comma
id|EV_INFO4_IND
comma
id|l1_info4_ind
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_SYNC2
comma
id|EV_TIMER3
comma
id|l1_timer3
)brace
comma
(brace
id|ST_L1_TRANS
comma
id|EV_TIMER_ACT
comma
id|l1_timer_act
)brace
comma
(brace
id|ST_L1_DEACT
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_SYNC2
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
(brace
id|ST_L1_RESET
comma
id|EV_TIMER_DEACT
comma
id|l1_timer_deact
)brace
comma
)brace
suffix:semicolon
DECL|macro|L1U_FN_COUNT
mdefine_line|#define L1U_FN_COUNT (sizeof(L1UFnList)/sizeof(struct FsmNode))
macro_line|#endif
r_static
r_void
DECL|function|l1b_activate
id|l1b_activate
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_WAIT_ACT
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
id|st-&gt;l1.delay
comma
id|EV_TIMER_ACT
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1b_deactivate
id|l1b_deactivate
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_WAIT_DEACT
)paren
suffix:semicolon
id|FsmRestartTimer
c_func
(paren
op_amp
id|st-&gt;l1.timer
comma
l_int|10
comma
id|EV_TIMER_DEACT
comma
l_int|NULL
comma
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1b_timer_act
id|l1b_timer_act
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_ACTIV
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l1b_timer_deact
id|l1b_timer_deact
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_NULL
)paren
suffix:semicolon
id|st-&gt;l2
dot
id|l2l1
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|FsmNode
id|L1BFnList
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ST_L1_NULL
comma
id|EV_PH_ACTIVATE
comma
id|l1b_activate
)brace
comma
(brace
id|ST_L1_WAIT_ACT
comma
id|EV_TIMER_ACT
comma
id|l1b_timer_act
)brace
comma
(brace
id|ST_L1_ACTIV
comma
id|EV_PH_DEACTIVATE
comma
id|l1b_deactivate
)brace
comma
(brace
id|ST_L1_WAIT_DEACT
comma
id|EV_TIMER_DEACT
comma
id|l1b_timer_deact
)brace
comma
)brace
suffix:semicolon
DECL|macro|L1B_FN_COUNT
mdefine_line|#define L1B_FN_COUNT (sizeof(L1BFnList)/sizeof(struct FsmNode))
r_void
id|__init
DECL|function|Isdnl1New
id|Isdnl1New
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef HISAX_UINTERFACE
id|l1fsm_u.state_count
op_assign
id|L1U_STATE_COUNT
suffix:semicolon
id|l1fsm_u.event_count
op_assign
id|L1_EVENT_COUNT
suffix:semicolon
id|l1fsm_u.strEvent
op_assign
id|strL1Event
suffix:semicolon
id|l1fsm_u.strState
op_assign
id|strL1UState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|l1fsm_u
comma
id|L1UFnList
comma
id|L1U_FN_COUNT
)paren
suffix:semicolon
macro_line|#endif
id|l1fsm_s.state_count
op_assign
id|L1S_STATE_COUNT
suffix:semicolon
id|l1fsm_s.event_count
op_assign
id|L1_EVENT_COUNT
suffix:semicolon
id|l1fsm_s.strEvent
op_assign
id|strL1Event
suffix:semicolon
id|l1fsm_s.strState
op_assign
id|strL1SState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|l1fsm_s
comma
id|L1SFnList
comma
id|L1S_FN_COUNT
)paren
suffix:semicolon
id|l1fsm_b.state_count
op_assign
id|L1B_STATE_COUNT
suffix:semicolon
id|l1fsm_b.event_count
op_assign
id|L1_EVENT_COUNT
suffix:semicolon
id|l1fsm_b.strEvent
op_assign
id|strL1Event
suffix:semicolon
id|l1fsm_b.strState
op_assign
id|strL1BState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|l1fsm_b
comma
id|L1BFnList
comma
id|L1B_FN_COUNT
)paren
suffix:semicolon
)brace
DECL|function|Isdnl1Free
r_void
id|Isdnl1Free
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef HISAX_UINTERFACE
id|FsmFree
c_func
(paren
op_amp
id|l1fsm_u
)paren
suffix:semicolon
macro_line|#endif
id|FsmFree
c_func
(paren
op_amp
id|l1fsm_s
)paren
suffix:semicolon
id|FsmFree
c_func
(paren
op_amp
id|l1fsm_b
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|dch_l2l1
id|dch_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;PH_ACTIVATE_REQ %s&quot;
comma
id|st-&gt;l1.l1m.fsm-&gt;strState
(braket
id|st-&gt;l1.l1m.state
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_L1_ACTIVATED
comma
op_amp
id|st-&gt;l1.Flags
)paren
)paren
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_else
(brace
id|test_and_set_bit
c_func
(paren
id|FLG_L1_ACTIVATING
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_PH_ACTIVATE
comma
id|arg
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_TESTLOOP
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
l_int|1
op_amp
(paren
r_int
)paren
id|arg
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;PH_TEST_LOOP B1&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|2
op_amp
(paren
r_int
)paren
id|arg
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;PH_TEST_LOOP B2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
l_int|3
op_amp
(paren
r_int
)paren
id|arg
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;PH_TEST_LOOP DISABLED&quot;
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1hw
c_func
(paren
id|st
comma
id|HW_TESTLOOP
op_or
id|REQUEST
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;dch_l2l1 msg %04X unhandled&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|l1_msg
id|l1_msg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
id|st
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|st
)paren
(brace
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|HW_RESET
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_RESET_IND
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_DEACT_CNF
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_DEACTIVATE
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_DEACT_IND
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_POWERUP
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_POWER_UP
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_RSYNC
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_RSYNC_IND
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_INFO2
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_INFO2_IND
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_INFO4_P8
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|HW_INFO4_P10
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_INFO4_IND
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;l1msg %04X unhandled&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|st
op_assign
id|st-&gt;next
suffix:semicolon
)brace
)brace
r_void
DECL|function|l1_msg_b
id|l1_msg_b
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
id|EV_PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|setstack_HiSax
id|setstack_HiSax
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|st-&gt;l1.hardware
op_assign
id|cs
suffix:semicolon
id|st-&gt;protocol
op_assign
id|cs-&gt;protocol
suffix:semicolon
id|st-&gt;l1.l1m.fsm
op_assign
op_amp
id|l1fsm_s
suffix:semicolon
id|st-&gt;l1.l1m.state
op_assign
id|ST_L1_F3
suffix:semicolon
id|st-&gt;l1.Flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef HISAX_UINTERFACE
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_HW_L1_UINT
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
id|st-&gt;l1.l1m.fsm
op_assign
op_amp
id|l1fsm_u
suffix:semicolon
id|st-&gt;l1.l1m.state
op_assign
id|ST_L1_RESET
suffix:semicolon
id|st-&gt;l1.Flags
op_assign
id|FLG_L1_UINT
suffix:semicolon
)brace
macro_line|#endif
id|st-&gt;l1.l1m.debug
op_assign
id|cs-&gt;debug
suffix:semicolon
id|st-&gt;l1.l1m.userdata
op_assign
id|st
suffix:semicolon
id|st-&gt;l1.l1m.userint
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1.l1m.printdebug
op_assign
id|l1m_debug
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
op_amp
id|st-&gt;l1.timer
)paren
suffix:semicolon
id|setstack_tei
c_func
(paren
id|st
)paren
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|st-&gt;l1.stlistp
op_assign
op_amp
(paren
id|cs-&gt;stlist
)paren
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|dch_l2l1
suffix:semicolon
id|cs
op_member_access_from_pointer
id|setstack_d
c_func
(paren
id|st
comma
id|cs
)paren
suffix:semicolon
)brace
r_void
DECL|function|setstack_l1_B
id|setstack_l1_B
c_func
(paren
r_struct
id|PStack
op_star
id|st
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
id|st-&gt;l1.l1m.fsm
op_assign
op_amp
id|l1fsm_b
suffix:semicolon
id|st-&gt;l1.l1m.state
op_assign
id|ST_L1_NULL
suffix:semicolon
id|st-&gt;l1.l1m.debug
op_assign
id|cs-&gt;debug
suffix:semicolon
id|st-&gt;l1.l1m.userdata
op_assign
id|st
suffix:semicolon
id|st-&gt;l1.l1m.userint
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1.l1m.printdebug
op_assign
id|l1m_debug
suffix:semicolon
id|st-&gt;l1.Flags
op_assign
l_int|0
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|st-&gt;l1.l1m
comma
op_amp
id|st-&gt;l1.timer
)paren
suffix:semicolon
)brace
eof
