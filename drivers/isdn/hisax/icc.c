singleline_comment|// $Id: icc.c,v 1.5 2000/11/24 17:05:37 kai Exp $
singleline_comment|//-----------------------------------------------------------------------------
singleline_comment|//
singleline_comment|// ICC specific routines
singleline_comment|//
singleline_comment|// Author       Matt Henderson &amp; Guy Ellis - Traverse Tecnologies Pty Ltd
singleline_comment|//              www.traverse.com.au
singleline_comment|//
singleline_comment|// 1999.6.25 Initial implementation of routines for Siemens ISDN
singleline_comment|// Communication Controler PEB 2070 based on the ISAC routines
singleline_comment|// written by Karsten Keil.
singleline_comment|//
singleline_comment|// This file is (c) under GNU PUBLIC LICENSE
singleline_comment|//
singleline_comment|//-----------------------------------------------------------------------------
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;icc.h&quot;
singleline_comment|// #include &quot;arcofi.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;
DECL|macro|DBUSY_TIMER_VALUE
mdefine_line|#define DBUSY_TIMER_VALUE 80
DECL|macro|ARCOFI_USE
mdefine_line|#define ARCOFI_USE 0
DECL|variable|__initdata
r_static
r_char
op_star
id|ICCVer
(braket
)braket
id|__initdata
op_assign
(brace
l_string|&quot;2070 A1/A3&quot;
comma
l_string|&quot;2070 B1&quot;
comma
l_string|&quot;2070 B2/B3&quot;
comma
l_string|&quot;2070 V2.4&quot;
)brace
suffix:semicolon
r_void
DECL|function|ICCVersion
id|ICCVersion
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_char
op_star
id|s
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_RBCH
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s ICC version (%x): %s&bslash;n&quot;
comma
id|s
comma
id|val
comma
id|ICCVer
(braket
(paren
id|val
op_rshift
l_int|5
)paren
op_amp
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ph_command
id|ph_command
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
r_int
id|command
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ph_command %x&quot;
comma
id|command
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CIX0
comma
(paren
id|command
op_lshift
l_int|2
)paren
op_or
l_int|3
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|icc_new_ph
id|icc_new_ph
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_switch
c_cond
(paren
id|cs-&gt;dc.icc.ph_state
)paren
(brace
r_case
(paren
id|ICC_IND_EI1
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_DI
)paren
suffix:semicolon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_RESET
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_DC
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_DR
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_PU
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_POWERUP
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_FJ
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_RSYNC
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_AR
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_INFO2
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ICC_IND_AI
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_INFO4
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|icc_bh
id|icc_bh
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_CLEARBUSY
comma
op_amp
id|cs-&gt;event
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy cleared&quot;
)paren
suffix:semicolon
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_PAUSE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_L1STATECHANGE
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|icc_new_ph
c_func
(paren
id|cs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_RCVBUFREADY
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|DChannel_proc_rcv
c_func
(paren
id|cs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_XMTBUFREADY
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|DChannel_proc_xmt
c_func
(paren
id|cs
)paren
suffix:semicolon
macro_line|#if ARCOFI_USE
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HW_ARCOFI
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_RX_MON1
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|arcofi_fsm
c_func
(paren
id|cs
comma
id|ARCOFI_RX_END
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_TX_MON1
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|arcofi_fsm
c_func
(paren
id|cs
comma
id|ARCOFI_TX_END
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|icc_empty_fifo
id|icc_empty_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|count
)paren
(brace
id|u_char
op_star
id|ptr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;icc_empty_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;rcvidx
op_plus
id|count
)paren
op_ge
id|MAX_DFRAME_LEN_L1
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;icc_empty_fifo overrun %d&quot;
comma
id|cs-&gt;rcvidx
op_plus
id|count
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
id|cs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr
op_assign
id|cs-&gt;rcvbuf
op_plus
id|cs-&gt;rcvidx
suffix:semicolon
id|cs-&gt;rcvidx
op_add_assign
id|count
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|readisacfifo
c_func
(paren
id|cs
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
(brace
r_char
op_star
id|t
op_assign
id|cs-&gt;dlog
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;icc_empty_fifo cnt %d&quot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|cs-&gt;dlog
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|icc_fill_fifo
id|icc_fill_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|count
comma
id|more
suffix:semicolon
id|u_char
op_star
id|ptr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;icc_fill_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;tx_skb
)paren
r_return
suffix:semicolon
id|count
op_assign
id|cs-&gt;tx_skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|more
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|32
)paren
(brace
id|more
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|count
op_assign
l_int|32
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ptr
op_assign
id|cs-&gt;tx_skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|cs-&gt;tx_skb
comma
id|count
)paren
suffix:semicolon
id|cs-&gt;tx_cnt
op_add_assign
id|count
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisacfifo
c_func
(paren
id|cs
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CMDR
comma
id|more
ques
c_cond
l_int|0x8
suffix:colon
l_int|0xa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;icc_fill_fifo dbusytimer running&quot;
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
id|cs-&gt;dbusytimer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
id|DBUSY_TIMER_VALUE
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC_FIFO
)paren
(brace
r_char
op_star
id|t
op_assign
id|cs-&gt;dlog
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;icc_fill_fifo cnt %d&quot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|ptr
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|cs-&gt;dlog
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|icc_sched_event
id|icc_sched_event
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|event
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|event
comma
op_amp
id|cs-&gt;event
)paren
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|cs-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_void
DECL|function|icc_interrupt
id|icc_interrupt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|val
)paren
(brace
id|u_char
id|exval
comma
id|v1
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC interrupt %x&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* RME */
id|exval
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_RSTA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|exval
op_amp
l_int|0x70
)paren
op_ne
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x40
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC RDO&quot;
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
id|cs-&gt;err_rx
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|exval
op_amp
l_int|0x20
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC CRC error&quot;
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
id|cs-&gt;err_crc
op_increment
suffix:semicolon
macro_line|#endif
)brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CMDR
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_RBCL
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|count
op_assign
l_int|32
suffix:semicolon
id|icc_empty_fifo
c_func
(paren
id|cs
comma
id|count
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_assign
id|cs-&gt;rcvidx
)paren
OG
l_int|0
)paren
(brace
id|cs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|count
comma
id|GFP_ATOMIC
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: D receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|cs-&gt;rcvbuf
comma
id|count
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|cs-&gt;rq
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|cs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_RCVBUFREADY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* RPF */
id|icc_empty_fifo
c_func
(paren
id|cs
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* RSC */
multiline_comment|/* never */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC RSC interrupt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* XPR */
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_CLEARBUSY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;tx_skb-&gt;len
)paren
(brace
id|icc_fill_fifo
c_func
(paren
id|cs
)paren
suffix:semicolon
r_goto
id|afterXPR
suffix:semicolon
)brace
r_else
(brace
id|dev_kfree_skb_irq
c_func
(paren
id|cs-&gt;tx_skb
)paren
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|cs-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|cs-&gt;sq
)paren
)paren
)paren
(brace
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|icc_fill_fifo
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_else
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_XMTBUFREADY
)paren
suffix:semicolon
)brace
id|afterXPR
suffix:colon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x04
)paren
(brace
multiline_comment|/* CISQ */
id|exval
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_CIR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC CIR0 %02X&quot;
comma
id|exval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
l_int|2
)paren
(brace
id|cs-&gt;dc.icc.ph_state
op_assign
(paren
id|exval
op_rshift
l_int|2
)paren
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ph_state change %x&quot;
comma
id|cs-&gt;dc.icc.ph_state
)paren
suffix:semicolon
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_L1STATECHANGE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|1
)paren
(brace
id|exval
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_CIR1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC CIR1 %02X&quot;
comma
id|exval
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x02
)paren
(brace
multiline_comment|/* SIN */
multiline_comment|/* never */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC SIN interrupt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
l_int|0x01
)paren
(brace
multiline_comment|/* EXI */
id|exval
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_EXIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC EXIR %02x&quot;
comma
id|exval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* XMR */
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC XMR&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: ICC XMR&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* XDU */
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC XDU&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: ICC XDU&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
id|cs-&gt;err_tx
op_increment
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_CLEARBUSY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
multiline_comment|/* Restart frame */
id|skb_push
c_func
(paren
id|cs-&gt;tx_skb
comma
id|cs-&gt;tx_cnt
)paren
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|icc_fill_fifo
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: ICC XDU no skb&bslash;n&quot;
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC XDU no skb&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|exval
op_amp
l_int|0x04
)paren
(brace
multiline_comment|/* MOS */
id|v1
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_MOSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_MONITOR
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MOSR %02x&quot;
comma
id|v1
)paren
suffix:semicolon
macro_line|#if ARCOFI_USE
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x08
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;dc.icc.mon_rx
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;dc.icc.mon_rx
op_assign
id|kmalloc
c_func
(paren
id|MAX_MON_FRAME
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MON RX out of memory!&quot;
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0xf0
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x0a
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
r_goto
id|afterMONR0
suffix:semicolon
)brace
r_else
id|cs-&gt;dc.icc.mon_rxp
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_rxp
op_ge
id|MAX_MON_FRAME
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0xf0
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x0a
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mon_rxp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MON RX overflow!&quot;
)paren
suffix:semicolon
r_goto
id|afterMONR0
suffix:semicolon
)brace
id|cs-&gt;dc.icc.mon_rx
(braket
id|cs-&gt;dc.icc.mon_rxp
op_increment
)braket
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_MOR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_MONITOR
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MOR0 %02x&quot;
comma
id|cs-&gt;dc.icc.mon_rx
(braket
id|cs-&gt;dc.icc.mon_rxp
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_rxp
op_eq
l_int|1
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x04
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
)brace
)brace
id|afterMONR0
suffix:colon
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;dc.icc.mon_rx
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;dc.icc.mon_rx
op_assign
id|kmalloc
c_func
(paren
id|MAX_MON_FRAME
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MON RX out of memory!&quot;
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0x0f
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0xa0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
r_goto
id|afterMONR1
suffix:semicolon
)brace
r_else
id|cs-&gt;dc.icc.mon_rxp
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_rxp
op_ge
id|MAX_MON_FRAME
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0x0f
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0xa0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mon_rxp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MON RX overflow!&quot;
)paren
suffix:semicolon
r_goto
id|afterMONR1
suffix:semicolon
)brace
id|cs-&gt;dc.icc.mon_rx
(braket
id|cs-&gt;dc.icc.mon_rxp
op_increment
)braket
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_MOR1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_MONITOR
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MOR1 %02x&quot;
comma
id|cs-&gt;dc.icc.mon_rx
(braket
id|cs-&gt;dc.icc.mon_rxp
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x40
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
)brace
id|afterMONR1
suffix:colon
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x04
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0xf0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x0a
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_RX_MON0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x40
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0x0f
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0xa0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_RX_MON1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x02
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|cs-&gt;dc.icc.mon_tx
)paren
op_logical_or
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
op_logical_and
op_logical_neg
(paren
id|v1
op_amp
l_int|0x08
)paren
)paren
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0xf0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0x0a
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
)paren
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_TX_MON0
)paren
suffix:semicolon
r_goto
id|AfterMOX0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
)paren
(brace
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_TX_MON0
)paren
suffix:semicolon
r_goto
id|AfterMOX0
suffix:semicolon
)brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOX0
comma
id|cs-&gt;dc.icc.mon_tx
(braket
id|cs-&gt;dc.icc.mon_txp
op_increment
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_MONITOR
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC %02x -&gt; MOX0&quot;
comma
id|cs-&gt;dc.icc.mon_tx
(braket
id|cs-&gt;dc.icc.mon_txp
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|AfterMOX0
suffix:colon
r_if
c_cond
(paren
id|v1
op_amp
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|cs-&gt;dc.icc.mon_tx
)paren
op_logical_or
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
op_logical_and
op_logical_neg
(paren
id|v1
op_amp
l_int|0x80
)paren
)paren
)paren
(brace
id|cs-&gt;dc.icc.mocr
op_and_assign
l_int|0x0f
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_or_assign
l_int|0xa0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOCR
comma
id|cs-&gt;dc.icc.mocr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
)paren
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_TX_MON1
)paren
suffix:semicolon
r_goto
id|AfterMOX1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_txc
op_logical_and
(paren
id|cs-&gt;dc.icc.mon_txp
op_ge
id|cs-&gt;dc.icc.mon_txc
)paren
)paren
(brace
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_TX_MON1
)paren
suffix:semicolon
r_goto
id|AfterMOX1
suffix:semicolon
)brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MOX1
comma
id|cs-&gt;dc.icc.mon_tx
(braket
id|cs-&gt;dc.icc.mon_txp
op_increment
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_MONITOR
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC %02x -&gt; MOX1&quot;
comma
id|cs-&gt;dc.icc.mon_tx
(braket
id|cs-&gt;dc.icc.mon_txp
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|AfterMOX1
suffix:colon
macro_line|#endif
)brace
)brace
)brace
r_static
r_void
DECL|function|ICC_l1hw
id|ICC_l1hw
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_HEX
)paren
id|LogFrame
c_func
(paren
id|cs
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_VERBOSE
)paren
id|dlogframe
c_func
(paren
id|cs
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|cs-&gt;sq
comma
id|skb
)paren
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|cs
comma
id|skb
comma
l_string|&quot;PH_DATA Queued&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|cs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|cs
comma
id|skb
comma
l_string|&quot;PH_DATA&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|icc_fill_fifo
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot; l2l1 tx_skb exist this shouldn&squot;t happen&quot;
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|cs-&gt;sq
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_HEX
)paren
id|LogFrame
c_func
(paren
id|cs
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|DEB_DLOG_VERBOSE
)paren
id|dlogframe
c_func
(paren
id|cs
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|Logl2Frame
c_func
(paren
id|cs
comma
id|skb
comma
l_string|&quot;PH_DATA_PULLED&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|icc_fill_fifo
c_func
(paren
id|cs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
macro_line|#ifdef L2FRAME_DEBUG&t;&t;/* psa */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_LAPD
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;-&gt; PH_REQUEST_PULL&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;tx_skb
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|test_and_set_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_RESET
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
(paren
id|cs-&gt;dc.icc.ph_state
op_eq
id|ICC_IND_EI1
)paren
op_logical_or
(paren
id|cs-&gt;dc.icc.ph_state
op_eq
id|ICC_IND_DR
)paren
)paren
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_DI
)paren
suffix:semicolon
r_else
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_RES
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_ENABLE
op_or
id|REQUEST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_DI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_INFO1
op_or
id|REQUEST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_AR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_INFO3
op_or
id|REQUEST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_AI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_TESTLOOP
op_or
id|REQUEST
)paren
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_amp
(paren
r_int
)paren
id|arg
)paren
id|val
op_or_assign
l_int|0x0c
suffix:semicolon
r_if
c_cond
(paren
l_int|2
op_amp
(paren
r_int
)paren
id|arg
)paren
id|val
op_or_assign
l_int|0x3
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|HW_IOM1
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
multiline_comment|/* IOM 1 Mode */
r_if
c_cond
(paren
op_logical_neg
id|val
)paren
(brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SPCR
comma
l_int|0xa
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0x2
)paren
suffix:semicolon
)brace
r_else
(brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SPCR
comma
id|val
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0xa
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* IOM 2 Mode */
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SPCR
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0x8
)paren
suffix:semicolon
r_else
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|HW_DEACTIVATE
op_or
id|RESPONSE
)paren
suffix:colon
id|discard_queue
c_func
(paren
op_amp
id|cs-&gt;rq
)paren
suffix:semicolon
id|discard_queue
c_func
(paren
op_amp
id|cs-&gt;sq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|cs-&gt;tx_skb
)paren
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_CLEARBUSY
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;icc_l1hw unknown %04x&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|setstack_icc
id|setstack_icc
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|st-&gt;l1.l1hw
op_assign
id|ICC_l1hw
suffix:semicolon
)brace
r_void
DECL|function|DC_Close_icc
id|DC_Close_icc
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_rx
)paren
(brace
id|kfree
c_func
(paren
id|cs-&gt;dc.icc.mon_rx
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mon_rx
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;dc.icc.mon_tx
)paren
(brace
id|kfree
c_func
(paren
id|cs-&gt;dc.icc.mon_tx
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mon_tx
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dbusy_timer_handler
id|dbusy_timer_handler
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_int
id|rbch
comma
id|star
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
id|rbch
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_RBCH
)paren
suffix:semicolon
id|star
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_STAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy RBCH %02x STAR %02x&quot;
comma
id|rbch
comma
id|star
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rbch
op_amp
id|ICC_RBCH_XAC
)paren
(brace
multiline_comment|/* D-Channel Busy */
id|test_and_set_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
suffix:semicolon
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
id|stptr-&gt;l1
dot
id|l1l2
c_func
(paren
id|stptr
comma
id|PH_PAUSE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* discard frame; reset transceiver */
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|cs-&gt;tx_skb
)paren
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: ICC D-Channel Busy no skb&bslash;n&quot;
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy no skb&quot;
)paren
suffix:semicolon
)brace
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_CMDR
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Transmitter reset */
id|cs
op_member_access_from_pointer
id|irq_func
c_func
(paren
id|cs-&gt;irq
comma
id|cs
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
id|__init
DECL|function|initicc
id|initicc
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;tqueue.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|icc_bh
suffix:semicolon
id|cs-&gt;setstack_d
op_assign
id|setstack_icc
suffix:semicolon
id|cs-&gt;DC_Close
op_assign
id|DC_Close_icc
suffix:semicolon
id|cs-&gt;dc.icc.mon_tx
op_assign
l_int|NULL
suffix:semicolon
id|cs-&gt;dc.icc.mon_rx
op_assign
l_int|NULL
suffix:semicolon
id|cs-&gt;dbusytimer.function
op_assign
(paren
r_void
op_star
)paren
id|dbusy_timer_handler
suffix:semicolon
id|cs-&gt;dbusytimer.data
op_assign
(paren
r_int
)paren
id|cs
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|cs-&gt;dc.icc.mocr
op_assign
l_int|0xaa
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|HW_IOM1
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
multiline_comment|/* IOM 1 Mode */
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF2
comma
l_int|0x0
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SPCR
comma
l_int|0xa
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0x2
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_STCR
comma
l_int|0x70
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MODE
comma
l_int|0xc9
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* IOM 2 Mode */
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;dc.icc.adf2
)paren
id|cs-&gt;dc.icc.adf2
op_assign
l_int|0x80
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF2
comma
id|cs-&gt;dc.icc.adf2
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SQXR
comma
l_int|0xa0
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_SPCR
comma
l_int|0x20
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_STCR
comma
l_int|0x70
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MODE
comma
l_int|0xca
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_TIMR
comma
l_int|0x00
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_ADF1
comma
l_int|0x20
)paren
suffix:semicolon
)brace
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_RES
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MASK
comma
l_int|0x0
)paren
suffix:semicolon
id|ph_command
c_func
(paren
id|cs
comma
id|ICC_CMD_DI
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|clear_pending_icc_ints
id|clear_pending_icc_ints
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|val
comma
id|eval
suffix:semicolon
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_STAR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC STAR %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_MODE
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC MODE %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_ADF2
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC ADF2 %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_ISTA
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC ISTA %x&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x01
)paren
(brace
id|eval
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_EXIR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC EXIR %x&quot;
comma
id|eval
)paren
suffix:semicolon
)brace
id|val
op_assign
id|cs
op_member_access_from_pointer
id|readisac
c_func
(paren
id|cs
comma
id|ICC_CIR0
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ICC CIR0 %x&quot;
comma
id|val
)paren
suffix:semicolon
id|cs-&gt;dc.icc.ph_state
op_assign
(paren
id|val
op_rshift
l_int|2
)paren
op_amp
l_int|0xf
suffix:semicolon
id|icc_sched_event
c_func
(paren
id|cs
comma
id|D_L1STATECHANGE
)paren
suffix:semicolon
multiline_comment|/* Disable all IRQ */
id|cs
op_member_access_from_pointer
id|writeisac
c_func
(paren
id|cs
comma
id|ICC_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
)brace
eof
