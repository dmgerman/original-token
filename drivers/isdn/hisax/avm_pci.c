multiline_comment|/* $Id: avm_pci.c,v 1.22.6.2 2000/11/29 16:00:14 kai Exp $&n; *&n; * avm_pci.c    low level stuff for AVM Fritz!PCI and ISA PnP isdn cards&n; *              Thanks to AVM, Berlin for informations&n; *&n; * Author       Karsten Keil (keil@isdn4linux.de)&n; *&n; * This file is (c) under GNU PUBLIC LICENSE&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isac.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
r_extern
r_const
r_char
op_star
id|CardType
(braket
)braket
suffix:semicolon
DECL|variable|avm_pci_rev
r_static
r_const
r_char
op_star
id|avm_pci_rev
op_assign
l_string|&quot;$Revision: 1.22.6.2 $&quot;
suffix:semicolon
DECL|macro|AVM_FRITZ_PCI
mdefine_line|#define  AVM_FRITZ_PCI&t;&t;1
DECL|macro|AVM_FRITZ_PNP
mdefine_line|#define  AVM_FRITZ_PNP&t;&t;2
DECL|macro|HDLC_FIFO
mdefine_line|#define  HDLC_FIFO&t;&t;0x0
DECL|macro|HDLC_STATUS
mdefine_line|#define  HDLC_STATUS&t;&t;0x4
DECL|macro|AVM_HDLC_1
mdefine_line|#define&t; AVM_HDLC_1&t;&t;0x00
DECL|macro|AVM_HDLC_2
mdefine_line|#define&t; AVM_HDLC_2&t;&t;0x01
DECL|macro|AVM_ISAC_FIFO
mdefine_line|#define&t; AVM_ISAC_FIFO&t;&t;0x02
DECL|macro|AVM_ISAC_REG_LOW
mdefine_line|#define&t; AVM_ISAC_REG_LOW&t;0x04
DECL|macro|AVM_ISAC_REG_HIGH
mdefine_line|#define&t; AVM_ISAC_REG_HIGH&t;0x06
DECL|macro|AVM_STATUS0_IRQ_ISAC
mdefine_line|#define  AVM_STATUS0_IRQ_ISAC&t;0x01
DECL|macro|AVM_STATUS0_IRQ_HDLC
mdefine_line|#define  AVM_STATUS0_IRQ_HDLC&t;0x02
DECL|macro|AVM_STATUS0_IRQ_TIMER
mdefine_line|#define  AVM_STATUS0_IRQ_TIMER&t;0x04
DECL|macro|AVM_STATUS0_IRQ_MASK
mdefine_line|#define  AVM_STATUS0_IRQ_MASK&t;0x07
DECL|macro|AVM_STATUS0_RESET
mdefine_line|#define  AVM_STATUS0_RESET&t;0x01
DECL|macro|AVM_STATUS0_DIS_TIMER
mdefine_line|#define  AVM_STATUS0_DIS_TIMER&t;0x02
DECL|macro|AVM_STATUS0_RES_TIMER
mdefine_line|#define  AVM_STATUS0_RES_TIMER&t;0x04
DECL|macro|AVM_STATUS0_ENA_IRQ
mdefine_line|#define  AVM_STATUS0_ENA_IRQ&t;0x08
DECL|macro|AVM_STATUS0_TESTBIT
mdefine_line|#define  AVM_STATUS0_TESTBIT&t;0x10
DECL|macro|AVM_STATUS1_INT_SEL
mdefine_line|#define  AVM_STATUS1_INT_SEL&t;0x0f
DECL|macro|AVM_STATUS1_ENA_IOM
mdefine_line|#define  AVM_STATUS1_ENA_IOM&t;0x80
DECL|macro|HDLC_MODE_ITF_FLG
mdefine_line|#define  HDLC_MODE_ITF_FLG&t;0x01
DECL|macro|HDLC_MODE_TRANS
mdefine_line|#define  HDLC_MODE_TRANS&t;0x02
DECL|macro|HDLC_MODE_CCR_7
mdefine_line|#define  HDLC_MODE_CCR_7&t;0x04
DECL|macro|HDLC_MODE_CCR_16
mdefine_line|#define  HDLC_MODE_CCR_16&t;0x08
DECL|macro|HDLC_MODE_TESTLOOP
mdefine_line|#define  HDLC_MODE_TESTLOOP&t;0x80
DECL|macro|HDLC_INT_XPR
mdefine_line|#define  HDLC_INT_XPR&t;&t;0x80
DECL|macro|HDLC_INT_XDU
mdefine_line|#define  HDLC_INT_XDU&t;&t;0x40
DECL|macro|HDLC_INT_RPR
mdefine_line|#define  HDLC_INT_RPR&t;&t;0x20
DECL|macro|HDLC_INT_MASK
mdefine_line|#define  HDLC_INT_MASK&t;&t;0xE0
DECL|macro|HDLC_STAT_RME
mdefine_line|#define  HDLC_STAT_RME&t;&t;0x01
DECL|macro|HDLC_STAT_RDO
mdefine_line|#define  HDLC_STAT_RDO&t;&t;0x10
DECL|macro|HDLC_STAT_CRCVFRRAB
mdefine_line|#define  HDLC_STAT_CRCVFRRAB&t;0x0E
DECL|macro|HDLC_STAT_CRCVFR
mdefine_line|#define  HDLC_STAT_CRCVFR&t;0x06
DECL|macro|HDLC_STAT_RML_MASK
mdefine_line|#define  HDLC_STAT_RML_MASK&t;0x3f00
DECL|macro|HDLC_CMD_XRS
mdefine_line|#define  HDLC_CMD_XRS&t;&t;0x80
DECL|macro|HDLC_CMD_XME
mdefine_line|#define  HDLC_CMD_XME&t;&t;0x01
DECL|macro|HDLC_CMD_RRS
mdefine_line|#define  HDLC_CMD_RRS&t;&t;0x20
DECL|macro|HDLC_CMD_XML_MASK
mdefine_line|#define  HDLC_CMD_XML_MASK&t;0x3f00
multiline_comment|/* Interface functions */
r_static
id|u_char
DECL|function|ReadISAC
id|ReadISAC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|offset
)paren
(brace
r_register
id|u_char
id|idx
op_assign
(paren
id|offset
OG
l_int|0x2f
)paren
ques
c_cond
id|AVM_ISAC_REG_HIGH
suffix:colon
id|AVM_ISAC_REG_LOW
suffix:semicolon
r_register
id|u_char
id|val
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
(paren
id|offset
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WriteISAC
id|WriteISAC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|offset
comma
id|u_char
id|value
)paren
(brace
r_register
id|u_char
id|idx
op_assign
(paren
id|offset
OG
l_int|0x2f
)paren
ques
c_cond
id|AVM_ISAC_REG_HIGH
suffix:colon
id|AVM_ISAC_REG_LOW
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
(paren
id|offset
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ReadISACfifo
id|ReadISACfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|outb
c_func
(paren
id|AVM_ISAC_FIFO
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|insb
c_func
(paren
id|cs-&gt;hw.avm.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WriteISACfifo
id|WriteISACfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|outb
c_func
(paren
id|AVM_ISAC_FIFO
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outsb
c_func
(paren
id|cs-&gt;hw.avm.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u_int
DECL|function|ReadHDLCPCI
id|ReadHDLCPCI
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
)paren
(brace
r_register
id|u_int
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_register
id|u_int
id|val
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|WriteHDLCPCI
id|WriteHDLCPCI
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
comma
id|u_int
id|value
)paren
(brace
r_register
id|u_int
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outl
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u_char
DECL|function|ReadHDLCPnP
id|ReadHDLCPnP
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
)paren
(brace
r_register
id|u_char
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_register
id|u_char
id|val
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|WriteHDLCPnP
id|WriteHDLCPnP
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
comma
id|u_char
id|value
)paren
(brace
r_register
id|u_char
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_register
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
id|u_char
DECL|function|ReadHDLC_s
id|ReadHDLC_s
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
)paren
(brace
r_return
l_int|0xff
op_amp
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
id|chan
comma
id|offset
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WriteHDLC_s
id|WriteHDLC_s
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u_char
id|offset
comma
id|u_char
id|value
)paren
(brace
id|WriteHDLCPCI
c_func
(paren
id|cs
comma
id|chan
comma
id|offset
comma
id|value
)paren
suffix:semicolon
)brace
r_static
r_inline
DECL|function|Sel_BCS
r_struct
id|BCState
op_star
id|Sel_BCS
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_logical_and
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|channel
op_eq
id|channel
)paren
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|0
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_logical_and
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|channel
op_eq
id|channel
)paren
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|1
)braket
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
r_void
r_inline
DECL|function|hdlc_sched_event
id|hdlc_sched_event
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|event
)paren
(brace
id|bcs-&gt;event
op_or_assign
l_int|1
op_lshift
id|event
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|bcs-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_void
DECL|function|write_ctrl
id|write_ctrl
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|which
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;hdlc %c wr%x ctrl %x&quot;
comma
l_char|&squot;A&squot;
op_plus
id|bcs-&gt;channel
comma
id|which
comma
id|bcs-&gt;hw.hdlc.ctrl.ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|WriteHDLCPCI
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
comma
id|bcs-&gt;hw.hdlc.ctrl.ctrl
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|which
op_amp
l_int|4
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
op_plus
l_int|2
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
l_int|2
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
op_plus
l_int|1
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
l_int|1
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|modehdlc
id|modehdlc
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bc
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|hdlc
op_assign
id|bcs-&gt;channel
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc %c mode %d --&gt; %d ichan %d --&gt; %d&quot;
comma
l_char|&squot;A&squot;
op_plus
id|hdlc
comma
id|bcs-&gt;mode
comma
id|mode
comma
id|hdlc
comma
id|bc
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.ctrl
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
(paren
op_minus
l_int|1
)paren
suffix:colon
multiline_comment|/* used for init */
id|bcs-&gt;mode
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bc
op_assign
l_int|0
suffix:semicolon
r_case
(paren
id|L1_MODE_NULL
)paren
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_NULL
)paren
r_return
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_TRANS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|L1_MODE_NULL
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_TRANS
)paren
suffix:colon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_TRANS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
l_int|0
suffix:semicolon
id|hdlc_sched_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_HDLC
)paren
suffix:colon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_ITF_FLG
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
l_int|0
suffix:semicolon
id|hdlc_sched_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hdlc_empty_fifo
id|hdlc_empty_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|count
)paren
(brace
r_register
id|u_int
op_star
id|ptr
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
id|u_char
id|idx
op_assign
id|bcs-&gt;channel
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc_empty_fifo %d&quot;
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.hdlc.rcvidx
op_plus
id|count
OG
id|HSCX_BUFMAX
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc_empty_fifo: incoming packet too large&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|u_int
op_star
)paren
id|p
op_assign
id|bcs-&gt;hw.hdlc.rcvbuf
op_plus
id|bcs-&gt;hw.hdlc.rcvidx
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvidx
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
macro_line|#ifdef __powerpc__
macro_line|#ifdef CONFIG_APUS
op_star
id|ptr
op_increment
op_assign
id|in_le32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
macro_line|#else
op_star
id|ptr
op_increment
op_assign
id|in_be32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_APUS */
macro_line|#else
op_star
id|ptr
op_increment
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
macro_line|#endif /* __powerpc__ */
id|cnt
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
r_else
(brace
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
op_star
id|p
op_increment
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
op_star
id|t
op_assign
id|bcs-&gt;blog
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PNP
)paren
id|p
op_assign
(paren
id|u_char
op_star
)paren
id|ptr
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;hdlc_empty_fifo %c cnt %d&quot;
comma
id|bcs-&gt;channel
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|p
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|bcs-&gt;blog
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hdlc_fill_fifo
id|hdlc_fill_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|count
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
r_int
id|fifo_size
op_assign
l_int|32
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
id|u_int
op_star
id|ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc_fill_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_XME
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
OG
id|fifo_size
)paren
(brace
id|count
op_assign
id|fifo_size
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_ne
id|L1_MODE_TRANS
)paren
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_XME
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc_fill_fifo %d/%ld&quot;
comma
id|count
comma
id|bcs-&gt;tx_skb-&gt;len
)paren
suffix:semicolon
id|ptr
op_assign
(paren
id|u_int
op_star
)paren
id|p
op_assign
id|bcs-&gt;tx_skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|bcs-&gt;tx_skb
comma
id|count
)paren
suffix:semicolon
id|bcs-&gt;tx_cnt
op_sub_assign
id|count
suffix:semicolon
id|bcs-&gt;hw.hdlc.count
op_add_assign
id|count
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
(paren
(paren
id|count
op_eq
id|fifo_size
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* sets the correct index too */
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
macro_line|#ifdef __powerpc__
macro_line|#ifdef CONFIG_APUS
id|out_le32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
comma
op_star
id|ptr
op_increment
)paren
suffix:semicolon
macro_line|#else
id|out_be32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
comma
op_star
id|ptr
op_increment
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_APUS */
macro_line|#else
id|outl
c_func
(paren
op_star
id|ptr
op_increment
comma
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
macro_line|#endif /* __powerpc__ */
id|cnt
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
id|outb
c_func
(paren
op_star
id|p
op_increment
comma
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
op_star
id|t
op_assign
id|bcs-&gt;blog
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PNP
)paren
id|p
op_assign
(paren
id|u_char
op_star
)paren
id|ptr
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;hdlc_fill_fifo %c cnt %d&quot;
comma
id|bcs-&gt;channel
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
id|count
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|p
comma
id|count
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|bcs-&gt;blog
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|fill_hdlc
id|fill_hdlc
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|hdlc_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|HDLC_irq
id|HDLC_irq
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
id|stat
)paren
(brace
r_int
id|len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d stat %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
(brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_STAT_RDO
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;RDO&quot;
)paren
suffix:semicolon
r_else
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d stat %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_RRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_RRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|len
op_assign
(paren
id|stat
op_amp
id|HDLC_STAT_RML_MASK
)paren
op_rshift
l_int|8
)paren
)paren
id|len
op_assign
l_int|32
suffix:semicolon
id|hdlc_empty_fifo
c_func
(paren
id|bcs
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|HDLC_STAT_RME
)paren
op_logical_or
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_TRANS
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|stat
op_amp
id|HDLC_STAT_CRCVFRRAB
)paren
op_eq
id|HDLC_STAT_CRCVFR
)paren
op_logical_or
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_TRANS
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|bcs-&gt;hw.hdlc.rcvidx
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HDLC: receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|bcs-&gt;hw.hdlc.rcvidx
)paren
comma
id|bcs-&gt;hw.hdlc.rcvbuf
comma
id|bcs-&gt;hw.hdlc.rcvidx
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
)brace
id|bcs-&gt;hw.hdlc.rcvidx
op_assign
l_int|0
suffix:semicolon
id|hdlc_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;invalid frame&quot;
)paren
suffix:semicolon
r_else
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d invalid frame %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_XDU
)paren
(brace
multiline_comment|/* Here we lost an TX interrupt, so&n;&t;&t; * restart transmitting the whole frame.&n;&t;&t; */
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
id|skb_push
c_func
(paren
id|bcs-&gt;tx_skb
comma
id|bcs-&gt;hw.hdlc.count
)paren
suffix:semicolon
id|bcs-&gt;tx_cnt
op_add_assign
id|bcs-&gt;hw.hdlc.count
suffix:semicolon
id|bcs-&gt;hw.hdlc.count
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;&t;&t;hdlc_sched_event(bcs, B_XMTBUFREADY);
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d XDU&quot;
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d XDU without skb&quot;
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|hdlc_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_XPR
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
)paren
(brace
id|hdlc_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;st-&gt;lli.l1writewakeup
op_logical_and
(paren
id|PACKET_NOACK
op_ne
id|bcs-&gt;tx_skb-&gt;pkt_type
)paren
)paren
id|bcs-&gt;st-&gt;lli
dot
id|l1writewakeup
c_func
(paren
id|bcs-&gt;st
comma
id|bcs-&gt;hw.hdlc.count
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.count
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|bcs-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|bcs-&gt;hw.hdlc.count
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|hdlc_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|hdlc_sched_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
)brace
)brace
)brace
r_inline
r_void
DECL|function|HDLC_irq_main
id|HDLC_irq_main
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
id|stat
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|stat
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
)brace
r_else
(brace
id|stat
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
id|stat
op_or_assign
(paren
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_MASK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs
op_assign
id|Sel_BCS
c_func
(paren
id|cs
comma
l_int|0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc spurious channel 0 IRQ&quot;
)paren
suffix:semicolon
)brace
r_else
id|HDLC_irq
c_func
(paren
id|bcs
comma
id|stat
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|stat
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
)brace
r_else
(brace
id|stat
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
id|stat
op_or_assign
(paren
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_MASK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs
op_assign
id|Sel_BCS
c_func
(paren
id|cs
comma
l_int|1
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc spurious channel 1 IRQ&quot;
)paren
suffix:semicolon
)brace
r_else
id|HDLC_irq
c_func
(paren
id|bcs
comma
id|stat
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|hdlc_l2l1
id|hdlc_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|st-&gt;l1.bcs-&gt;squeue
comma
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.hdlc.count
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;hdlc_l2l1: this shouldn&squot;t happen&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.hdlc.count
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|test_and_set_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|st-&gt;l1.bcs
comma
l_int|0
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|close_hdlcstate
id|close_hdlcstate
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|modehdlc
c_func
(paren
id|bcs
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.hdlc.rcvbuf
)paren
(brace
id|kfree
c_func
(paren
id|bcs-&gt;hw.hdlc.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;blog
)paren
(brace
id|kfree
c_func
(paren
id|bcs-&gt;blog
)paren
suffix:semicolon
id|bcs-&gt;blog
op_assign
l_int|NULL
suffix:semicolon
)brace
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
)brace
r_int
DECL|function|open_hdlcstate
id|open_hdlcstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;hw.hdlc.rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|HSCX_BUFMAX
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for hdlc.rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;blog
op_assign
id|kmalloc
c_func
(paren
id|MAX_BLOG_SPACE
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for bcs-&gt;blog&bslash;n&quot;
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bcs-&gt;hw.hdlc.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
)brace
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|bcs-&gt;event
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hdlc.rcvidx
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|setstack_hdlc
id|setstack_hdlc
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
r_if
c_cond
(paren
id|open_hdlcstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|hdlc_l2l1
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|clear_pending_hdlc_ints
id|clear_pending_hdlc_ints
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|val
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 RML %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|2
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 MODE %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|3
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 VIN %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 RML %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|2
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 MODE %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|3
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 VIN %x&quot;
comma
id|val
)paren
suffix:semicolon
)brace
)brace
r_void
id|__init
DECL|function|inithdlc
id|inithdlc
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_SetStack
op_assign
id|setstack_hdlc
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_SetStack
op_assign
id|setstack_hdlc
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_Close
op_assign
id|close_hdlcstate
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_Close
op_assign
id|close_hdlcstate
suffix:semicolon
id|modehdlc
c_func
(paren
id|cs-&gt;bcs
comma
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|cs-&gt;bcs
op_plus
l_int|1
comma
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|avm_pcipnp_interrupt
id|avm_pcipnp_interrupt
c_func
(paren
r_int
id|intno
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|dev_id
suffix:semicolon
id|u_char
id|val
suffix:semicolon
id|u_char
id|sval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AVM PCI: Spurious interrupt!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sval
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_MASK
)paren
op_eq
id|AVM_STATUS0_IRQ_MASK
)paren
multiline_comment|/* possible a shared  IRQ reqest */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_ISAC
)paren
)paren
(brace
id|val
op_assign
id|ReadISAC
c_func
(paren
id|cs
comma
id|ISAC_ISTA
)paren
suffix:semicolon
id|isac_interrupt
c_func
(paren
id|cs
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_HDLC
)paren
)paren
(brace
id|HDLC_irq_main
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_MASK
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|reset_avmpcipnp
id|reset_avmpcipnp
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|flags
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI/PnP: reset&bslash;n&quot;
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_RESET
op_or
id|AVM_STATUS0_DIS_TIMER
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Timeout 10ms */
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
op_or
id|AVM_STATUS0_ENA_IRQ
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS1_ENA_IOM
op_or
id|cs-&gt;irq
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|3
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Timeout 10ms */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI/PnP: S1 %x&bslash;n&quot;
comma
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|AVM_card_msg
id|AVM_card_msg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|mt
comma
r_void
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|mt
)paren
(brace
r_case
id|CARD_RESET
suffix:colon
id|reset_avmpcipnp
c_func
(paren
id|cs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|CARD_RELEASE
suffix:colon
id|outb
c_func
(paren
l_int|0
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
comma
l_int|32
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|CARD_INIT
suffix:colon
id|clear_pending_isac_ints
c_func
(paren
id|cs
)paren
suffix:semicolon
id|initisac
c_func
(paren
id|cs
)paren
suffix:semicolon
id|clear_pending_hdlc_ints
c_func
(paren
id|cs
)paren
suffix:semicolon
id|inithdlc
c_func
(paren
id|cs
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_MASK
comma
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
op_or
id|AVM_STATUS0_ENA_IRQ
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* RESET Receiver and Transmitter */
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_CMDR
comma
l_int|0x41
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|CARD_TEST
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|pci_dev
op_star
id|dev_avm
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
r_int
id|__init
DECL|function|setup_avm_pcipnp
id|setup_avm_pcipnp
c_func
(paren
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
id|u_int
id|val
comma
id|ver
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|card-&gt;cs
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|tmp
comma
id|avm_pci_rev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: AVM PCI driver Rev. %s&bslash;n&quot;
comma
id|HiSax_getrev
c_func
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;typ
op_ne
id|ISDN_CTYPE_FRITZPCI
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;para
(braket
l_int|1
)braket
)paren
(brace
id|cs-&gt;hw.avm.cfg_reg
op_assign
id|card-&gt;para
(braket
l_int|1
)braket
suffix:semicolon
id|cs-&gt;irq
op_assign
id|card-&gt;para
(braket
l_int|0
)braket
suffix:semicolon
id|cs-&gt;subtyp
op_assign
id|AVM_FRITZ_PNP
suffix:semicolon
)brace
r_else
(brace
macro_line|#if CONFIG_PCI
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPCI: no PCI bus present&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev_avm
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_AVM
comma
id|PCI_DEVICE_ID_AVM_A1
comma
id|dev_avm
)paren
)paren
)paren
(brace
id|cs-&gt;irq
op_assign
id|dev_avm-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;irq
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPCI: No IRQ for PCI card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev_avm
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|cs-&gt;hw.avm.cfg_reg
op_assign
id|pci_resource_start
c_func
(paren
id|dev_avm
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;hw.avm.cfg_reg
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPCI: No IO-Adr for PCI card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cs-&gt;subtyp
op_assign
id|AVM_FRITZ_PCI
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;FritzPCI: No PCI card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cs-&gt;irq_flags
op_or_assign
id|SA_SHIRQ
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;FritzPCI: NO_PCI_BIOS&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PCI */
)brace
id|cs-&gt;hw.avm.isac
op_assign
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
(paren
id|cs-&gt;hw.avm.cfg_reg
)paren
comma
l_int|32
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: %s config port %x-%x already in use&bslash;n&quot;
comma
id|CardType
(braket
id|card-&gt;typ
)braket
comma
id|cs-&gt;hw.avm.cfg_reg
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|31
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|request_region
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
comma
l_int|32
comma
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
ques
c_cond
l_string|&quot;avm PCI&quot;
suffix:colon
l_string|&quot;avm PnP&quot;
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cs-&gt;subtyp
)paren
(brace
r_case
id|AVM_FRITZ_PCI
suffix:colon
id|val
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI: stat %#x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI: Class %X Rev %d&bslash;n&quot;
comma
id|val
op_amp
l_int|0xff
comma
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|cs-&gt;BC_Read_Reg
op_assign
op_amp
id|ReadHDLC_s
suffix:semicolon
id|cs-&gt;BC_Write_Reg
op_assign
op_amp
id|WriteHDLC_s
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AVM_FRITZ_PNP
suffix:colon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
)paren
suffix:semicolon
id|ver
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PnP: Class %X Rev %d&bslash;n&quot;
comma
id|val
comma
id|ver
)paren
suffix:semicolon
id|reset_avmpcipnp
c_func
(paren
id|cs
)paren
suffix:semicolon
id|cs-&gt;BC_Read_Reg
op_assign
op_amp
id|ReadHDLCPnP
suffix:semicolon
id|cs-&gt;BC_Write_Reg
op_assign
op_amp
id|WriteHDLCPnP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AVM unknown subtype %d&bslash;n&quot;
comma
id|cs-&gt;subtyp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: %s config irq:%d base:0x%X&bslash;n&quot;
comma
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
ques
c_cond
l_string|&quot;AVM Fritz!PCI&quot;
suffix:colon
l_string|&quot;AVM Fritz!PnP&quot;
comma
id|cs-&gt;irq
comma
id|cs-&gt;hw.avm.cfg_reg
)paren
suffix:semicolon
id|cs-&gt;readisac
op_assign
op_amp
id|ReadISAC
suffix:semicolon
id|cs-&gt;writeisac
op_assign
op_amp
id|WriteISAC
suffix:semicolon
id|cs-&gt;readisacfifo
op_assign
op_amp
id|ReadISACfifo
suffix:semicolon
id|cs-&gt;writeisacfifo
op_assign
op_amp
id|WriteISACfifo
suffix:semicolon
id|cs-&gt;BC_Send_Data
op_assign
op_amp
id|fill_hdlc
suffix:semicolon
id|cs-&gt;cardmsg
op_assign
op_amp
id|AVM_card_msg
suffix:semicolon
id|cs-&gt;irq_func
op_assign
op_amp
id|avm_pcipnp_interrupt
suffix:semicolon
id|ISACVersion
c_func
(paren
id|cs
comma
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
ques
c_cond
l_string|&quot;AVM PCI:&quot;
suffix:colon
l_string|&quot;AVM PnP:&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
eof
