multiline_comment|/* $Id: isar.c,v 1.17 2000/11/24 17:05:37 kai Exp $&n; *&n; * isar.c   ISAR (Siemens PSB 7110) specific routines&n; *&n; * Author       Karsten Keil (keil@isdn4linux.de)&n; *&n; * This file is (c) under GNU PUBLIC LICENSE&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isar.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;
DECL|macro|DBG_LOADFIRM
mdefine_line|#define DBG_LOADFIRM&t;0
DECL|macro|DUMP_MBOXFRAME
mdefine_line|#define DUMP_MBOXFRAME&t;2
DECL|macro|MIN
mdefine_line|#define MIN(a,b) ((a&lt;b)?a:b)
DECL|macro|DLE
mdefine_line|#define DLE&t;0x10
DECL|macro|ETX
mdefine_line|#define ETX&t;0x03
DECL|variable|faxmodulation_s
r_const
id|u_char
id|faxmodulation_s
(braket
)braket
op_assign
l_string|&quot;3,24,48,72,73,74,96,97,98,121,122,145,146&quot;
suffix:semicolon
DECL|variable|faxmodulation
r_const
id|u_char
id|faxmodulation
(braket
)braket
op_assign
(brace
l_int|3
comma
l_int|24
comma
l_int|48
comma
l_int|72
comma
l_int|73
comma
l_int|74
comma
l_int|96
comma
l_int|97
comma
l_int|98
comma
l_int|121
comma
l_int|122
comma
l_int|145
comma
l_int|146
)brace
suffix:semicolon
DECL|macro|FAXMODCNT
mdefine_line|#define FAXMODCNT 13
r_void
id|isar_setup
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
suffix:semicolon
r_static
r_void
id|isar_pump_cmd
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|cmd
comma
id|u_char
id|para
)paren
suffix:semicolon
r_static
r_inline
r_void
id|ll_deliver_faxstat
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|status
)paren
suffix:semicolon
r_static
r_inline
r_int
DECL|function|waitforHIA
id|waitforHIA
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|timeout
)paren
(brace
r_while
c_loop
(paren
(paren
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_HIA
)paren
op_amp
l_int|1
)paren
op_logical_and
id|timeout
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|timeout
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: ISAR waitforHIA timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|timeout
suffix:semicolon
)brace
r_int
DECL|function|sendmsg
id|sendmsg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|his
comma
id|u_char
id|creg
comma
id|u_char
id|len
comma
id|u_char
op_star
id|msg
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|waitforHIA
c_func
(paren
id|cs
comma
l_int|4000
)paren
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#if DUMP_MBOXFRAME
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;sendmsg(%02x,%02x,%d)&quot;
comma
id|his
comma
id|creg
comma
id|len
)paren
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_CTRL_H
comma
id|creg
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_CTRL_L
comma
id|len
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_WADR
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_logical_and
id|len
)paren
(brace
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_MBOX
comma
id|msg
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|2
comma
id|ISAR_MBOX
comma
id|msg
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#if DUMP_MBOXFRAME&gt;1
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|256
)braket
comma
op_star
id|t
suffix:semicolon
id|i
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;sendmbox cnt %d&quot;
comma
id|len
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
op_amp
id|msg
(braket
id|len
op_minus
id|i
)braket
comma
(paren
id|i
OG
l_int|64
)paren
ques
c_cond
l_int|64
suffix:colon
id|i
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|tmp
)paren
suffix:semicolon
id|i
op_sub_assign
l_int|64
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_HIS
comma
id|his
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|waitforHIA
c_func
(paren
id|cs
comma
l_int|10000
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Call only with IRQ disabled !!! */
r_inline
r_void
DECL|function|rcv_mbox
id|rcv_mbox
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|isar_reg
op_star
id|ireg
comma
id|u_char
op_star
id|msg
)paren
(brace
r_int
id|i
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_RADR
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_logical_and
id|ireg-&gt;clsb
)paren
(brace
id|msg
(braket
l_int|0
)braket
op_assign
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_MBOX
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|ireg-&gt;clsb
suffix:semicolon
id|i
op_increment
)paren
id|msg
(braket
id|i
)braket
op_assign
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|2
comma
id|ISAR_MBOX
)paren
suffix:semicolon
macro_line|#if DUMP_MBOXFRAME&gt;1
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
(brace
r_char
id|tmp
(braket
l_int|256
)braket
comma
op_star
id|t
suffix:semicolon
id|i
op_assign
id|ireg-&gt;clsb
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;rcv_mbox cnt %d&quot;
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
op_amp
id|msg
(braket
id|ireg-&gt;clsb
op_minus
id|i
)braket
comma
(paren
id|i
OG
l_int|64
)paren
ques
c_cond
l_int|64
suffix:colon
id|i
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|tmp
)paren
suffix:semicolon
id|i
op_sub_assign
l_int|64
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Call only with IRQ disabled !!! */
r_inline
r_void
DECL|function|get_irq_infos
id|get_irq_infos
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|isar_reg
op_star
id|ireg
)paren
(brace
id|ireg-&gt;iis
op_assign
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIS
)paren
suffix:semicolon
id|ireg-&gt;cmsb
op_assign
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_CTRL_H
)paren
suffix:semicolon
id|ireg-&gt;clsb
op_assign
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_CTRL_L
)paren
suffix:semicolon
macro_line|#if DUMP_MBOXFRAME
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;rcv_mbox(%02x,%02x,%d)&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|waitrecmsg
id|waitrecmsg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|len
comma
id|u_char
op_star
id|msg
comma
r_int
id|maxdelay
)paren
(brace
r_int
id|timeout
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|isar_reg
op_star
id|ir
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.isar.reg
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|cs
op_member_access_from_pointer
id|BC_Read_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_IRQBIT
)paren
op_amp
id|ISAR_IRQSTA
)paren
)paren
op_logical_and
(paren
id|timeout
op_increment
OL
id|maxdelay
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|timeout
op_ge
id|maxdelay
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isar recmsg IRQSTA timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|get_irq_infos
c_func
(paren
id|cs
comma
id|ir
)paren
suffix:semicolon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ir
comma
id|msg
)paren
suffix:semicolon
op_star
id|len
op_assign
id|ir-&gt;clsb
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|ISARVersion
id|ISARVersion
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_char
op_star
id|s
)paren
(brace
r_int
id|ver
suffix:semicolon
id|u_char
id|msg
(braket
)braket
op_assign
id|ISAR_MSG_HWVER
suffix:semicolon
id|u_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
id|u_char
id|len
suffix:semicolon
r_int
id|debug
suffix:semicolon
id|cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|cs
comma
id|CARD_RESET
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* disable ISAR IRQ */
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_IRQBIT
comma
l_int|0
)paren
suffix:semicolon
id|debug
op_assign
id|cs-&gt;debug
suffix:semicolon
id|cs-&gt;debug
op_and_assign
op_complement
(paren
id|L1_DEB_HSCX
op_or
id|L1_DEB_HSCX_FIFO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_VNR
comma
l_int|0
comma
l_int|3
comma
id|msg
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|waitrecmsg
c_func
(paren
id|cs
comma
op_amp
id|len
comma
id|tmp
comma
l_int|100000
)paren
)paren
r_return
op_minus
l_int|2
suffix:semicolon
id|cs-&gt;debug
op_assign
id|debug
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.isar.reg-&gt;iis
op_eq
id|ISAR_IIS_VNR
)paren
(brace
r_if
c_cond
(paren
id|len
op_eq
l_int|1
)paren
(brace
id|ver
op_assign
id|tmp
(braket
l_int|0
)braket
op_amp
l_int|0xf
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s ISAR version %d&bslash;n&quot;
comma
id|s
comma
id|ver
)paren
suffix:semicolon
r_return
id|ver
suffix:semicolon
)brace
r_return
op_minus
l_int|3
suffix:semicolon
)brace
r_return
op_minus
l_int|4
suffix:semicolon
)brace
r_int
DECL|function|isar_load_firmware
id|isar_load_firmware
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|buf
)paren
(brace
r_int
id|ret
comma
id|size
comma
id|cnt
comma
id|debug
suffix:semicolon
id|u_char
id|len
comma
id|nom
comma
id|noc
suffix:semicolon
id|u_short
id|sadr
comma
id|left
comma
op_star
id|sp
suffix:semicolon
id|u_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|u_char
op_star
id|msg
comma
op_star
id|tmpmsg
comma
op_star
id|mp
comma
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|isar_reg
op_star
id|ireg
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.isar.reg
suffix:semicolon
r_struct
(brace
id|u_short
id|sadr
suffix:semicolon
id|u_short
id|len
suffix:semicolon
id|u_short
id|d_key
suffix:semicolon
)brace
id|blk_head
suffix:semicolon
DECL|macro|BLK_HEAD_SIZE
mdefine_line|#define&t;BLK_HEAD_SIZE 6
r_if
c_cond
(paren
l_int|1
op_ne
(paren
id|ret
op_assign
id|ISARVersion
c_func
(paren
id|cs
comma
l_string|&quot;Testing&quot;
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware wrong isar version %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|debug
op_assign
id|cs-&gt;debug
suffix:semicolon
macro_line|#if DBG_LOADFIRM&lt;2
id|cs-&gt;debug
op_and_assign
op_complement
(paren
id|L1_DEB_HSCX
op_or
id|L1_DEB_HSCX_FIFO
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar_load_firmware buf %#lx&bslash;n&quot;
comma
(paren
id|u_long
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware verify_area ret %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|size
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware copy_from_user ret %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|p
op_add_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar_load_firmware size: %d&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|p
comma
id|size
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware verify_area ret %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|cnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disable ISAR IRQ */
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_IRQBIT
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|msg
op_assign
id|kmalloc
c_func
(paren
l_int|256
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware no buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmpmsg
op_assign
id|kmalloc
c_func
(paren
l_int|256
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware no tmp buffer&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|msg
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|cnt
OL
id|size
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|blk_head
comma
id|p
comma
id|BLK_HEAD_SIZE
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware copy_from_user ret %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
macro_line|#ifdef __BIG_ENDIAN
id|sadr
op_assign
(paren
id|blk_head.sadr
op_amp
l_int|0xff
)paren
op_star
l_int|256
op_plus
id|blk_head.sadr
op_div
l_int|256
suffix:semicolon
id|blk_head.sadr
op_assign
id|sadr
suffix:semicolon
id|sadr
op_assign
(paren
id|blk_head.len
op_amp
l_int|0xff
)paren
op_star
l_int|256
op_plus
id|blk_head.len
op_div
l_int|256
suffix:semicolon
id|blk_head.len
op_assign
id|sadr
suffix:semicolon
id|sadr
op_assign
(paren
id|blk_head.d_key
op_amp
l_int|0xff
)paren
op_star
l_int|256
op_plus
id|blk_head.d_key
op_div
l_int|256
suffix:semicolon
id|blk_head.d_key
op_assign
id|sadr
suffix:semicolon
macro_line|#endif /* __BIG_ENDIAN */
id|cnt
op_add_assign
id|BLK_HEAD_SIZE
suffix:semicolon
id|p
op_add_assign
id|BLK_HEAD_SIZE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar firmware block (%#x,%5d,%#x)&bslash;n&quot;
comma
id|blk_head.sadr
comma
id|blk_head.len
comma
id|blk_head.d_key
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sadr
op_assign
id|blk_head.sadr
suffix:semicolon
id|left
op_assign
id|blk_head.len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_DKEY
comma
id|blk_head.d_key
op_amp
l_int|0xff
comma
l_int|0
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar sendmsg dkey failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|waitrecmsg
c_func
(paren
id|cs
comma
op_amp
id|len
comma
id|tmp
comma
l_int|100000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar waitrecmsg dkey failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ireg-&gt;iis
op_ne
id|ISAR_IIS_DKEY
)paren
op_logical_or
id|ireg-&gt;cmsb
op_logical_or
id|len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar wrong dkey response (%x,%x,%x)&bslash;n&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_while
c_loop
(paren
id|left
OG
l_int|0
)paren
(brace
id|noc
op_assign
id|MIN
c_func
(paren
l_int|126
comma
id|left
)paren
suffix:semicolon
id|nom
op_assign
l_int|2
op_star
id|noc
suffix:semicolon
id|mp
op_assign
id|msg
suffix:semicolon
op_star
id|mp
op_increment
op_assign
id|sadr
op_div
l_int|256
suffix:semicolon
op_star
id|mp
op_increment
op_assign
id|sadr
op_mod
l_int|256
suffix:semicolon
id|left
op_sub_assign
id|noc
suffix:semicolon
op_star
id|mp
op_increment
op_assign
id|noc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|tmpmsg
comma
id|p
comma
id|nom
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_load_firmware copy_from_user ret %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
id|p
op_add_assign
id|nom
suffix:semicolon
id|cnt
op_add_assign
id|nom
suffix:semicolon
id|nom
op_add_assign
l_int|3
suffix:semicolon
id|sp
op_assign
(paren
id|u_short
op_star
)paren
id|tmpmsg
suffix:semicolon
macro_line|#if DBG_LOADFIRM
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar: load %3d words at %04x&bslash;n&quot;
comma
id|noc
comma
id|sadr
)paren
suffix:semicolon
macro_line|#endif
id|sadr
op_add_assign
id|noc
suffix:semicolon
r_while
c_loop
(paren
id|noc
)paren
(brace
macro_line|#ifdef __BIG_ENDIAN
op_star
id|mp
op_increment
op_assign
op_star
id|sp
op_mod
l_int|256
suffix:semicolon
op_star
id|mp
op_increment
op_assign
op_star
id|sp
op_div
l_int|256
suffix:semicolon
macro_line|#else
op_star
id|mp
op_increment
op_assign
op_star
id|sp
op_div
l_int|256
suffix:semicolon
op_star
id|mp
op_increment
op_assign
op_star
id|sp
op_mod
l_int|256
suffix:semicolon
macro_line|#endif /* __BIG_ENDIAN */
id|sp
op_increment
suffix:semicolon
id|noc
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_FIRM
comma
l_int|0
comma
id|nom
comma
id|msg
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar sendmsg prog failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|waitrecmsg
c_func
(paren
id|cs
comma
op_amp
id|len
comma
id|tmp
comma
l_int|100000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar waitrecmsg prog failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ireg-&gt;iis
op_ne
id|ISAR_IIS_FIRM
)paren
op_logical_or
id|ireg-&gt;cmsb
op_logical_or
id|len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar wrong prog response (%x,%x,%x)&bslash;n&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar firmware block %5d words loaded&bslash;n&quot;
comma
id|blk_head.len
)paren
suffix:semicolon
)brace
multiline_comment|/* 10ms delay */
id|cnt
op_assign
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
l_int|0xfe
suffix:semicolon
id|ireg-&gt;bstat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_STDSP
comma
l_int|0
comma
l_int|2
comma
id|msg
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar sendmsg start dsp failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|waitrecmsg
c_func
(paren
id|cs
comma
op_amp
id|len
comma
id|tmp
comma
l_int|100000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar waitrecmsg start dsp failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ireg-&gt;iis
op_ne
id|ISAR_IIS_STDSP
)paren
op_logical_or
id|ireg-&gt;cmsb
op_logical_or
id|len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar wrong start dsp response (%x,%x,%x)&bslash;n&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar start dsp success&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* NORMAL mode entered */
multiline_comment|/* Enable IRQs of ISAR */
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_IRQBIT
comma
id|ISAR_IRQSTA
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|cnt
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* max 1s */
r_while
c_loop
(paren
(paren
op_logical_neg
id|ireg-&gt;bstat
)paren
op_logical_and
id|cnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar no general status event received&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterrflg
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar general status event %x&bslash;n&quot;
comma
id|ireg-&gt;bstat
)paren
suffix:semicolon
)brace
multiline_comment|/* 10ms delay */
id|cnt
op_assign
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|ireg-&gt;iis
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_DIAG
comma
id|ISAR_CTRL_STST
comma
l_int|0
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar sendmsg self tst failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterrflg
suffix:semicolon
)brace
id|cnt
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* max 100 ms */
r_while
c_loop
(paren
(paren
id|ireg-&gt;iis
op_ne
id|ISAR_IIS_DIAG
)paren
op_logical_and
id|cnt
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar no self tst response&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterrflg
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ireg-&gt;cmsb
op_eq
id|ISAR_CTRL_STST
)paren
op_logical_and
(paren
id|ireg-&gt;clsb
op_eq
l_int|1
)paren
op_logical_and
(paren
id|ireg-&gt;par
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar selftest OK&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar selftest not OK %x/%x/%x&bslash;n&quot;
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
comma
id|ireg-&gt;par
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
id|ireg-&gt;iis
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sendmsg
c_func
(paren
id|cs
comma
id|ISAR_HIS_DIAG
comma
id|ISAR_CTRL_SWVER
comma
l_int|0
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar RQST SVN failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterror
suffix:semicolon
)brace
id|cnt
op_assign
l_int|30000
suffix:semicolon
multiline_comment|/* max 300 ms */
r_while
c_loop
(paren
(paren
id|ireg-&gt;iis
op_ne
id|ISAR_IIS_DIAG
)paren
op_logical_and
id|cnt
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar no SVN response&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterrflg
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ireg-&gt;cmsb
op_eq
id|ISAR_CTRL_SWVER
)paren
op_logical_and
(paren
id|ireg-&gt;clsb
op_eq
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isar software version %#x&bslash;n&quot;
comma
id|ireg-&gt;par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar wrong swver response (%x,%x) cnt(%d)&bslash;n&quot;
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
comma
id|cnt
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|reterrflg
suffix:semicolon
)brace
)brace
id|cs-&gt;debug
op_assign
id|debug
suffix:semicolon
id|isar_setup
c_func
(paren
id|cs
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|reterrflg
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|reterror
suffix:colon
id|cs-&gt;debug
op_assign
id|debug
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
multiline_comment|/* disable ISAR IRQ */
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|ISAR_IRQBIT
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|msg
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tmpmsg
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_extern
r_void
id|BChannel_bh
c_func
(paren
r_struct
id|BCState
op_star
)paren
suffix:semicolon
DECL|macro|B_LL_NOCARRIER
mdefine_line|#define B_LL_NOCARRIER&t;8
DECL|macro|B_LL_CONNECT
mdefine_line|#define B_LL_CONNECT&t;9
DECL|macro|B_LL_OK
mdefine_line|#define B_LL_OK&t;&t;10
r_static
r_void
DECL|function|isar_bh
id|isar_bh
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|BChannel_bh
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|B_LL_NOCARRIER
comma
op_amp
id|bcs-&gt;event
)paren
)paren
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_NOCARR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|B_LL_CONNECT
comma
op_amp
id|bcs-&gt;event
)paren
)paren
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_CONNECT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|B_LL_OK
comma
op_amp
id|bcs-&gt;event
)paren
)paren
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_OK
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isar_sched_event
id|isar_sched_event
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|event
)paren
(brace
id|bcs-&gt;event
op_or_assign
l_int|1
op_lshift
id|event
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|bcs-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|send_DLE_ETX
id|send_DLE_ETX
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|u_char
id|dleetx
(braket
l_int|2
)braket
op_assign
(brace
id|DLE
comma
id|ETX
)brace
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|2
)paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
id|dleetx
comma
l_int|2
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: skb out of memory&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|dle_count
id|dle_count
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
r_if
c_cond
(paren
op_star
id|buf
op_increment
op_eq
id|DLE
)paren
id|count
op_increment
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|insert_dle
id|insert_dle
c_func
(paren
r_int
r_char
op_star
id|dest
comma
r_int
r_char
op_star
id|src
comma
r_int
id|count
)paren
(brace
multiline_comment|/* &lt;DLE&gt; in input stream have to be flagged as &lt;DLE&gt;&lt;DLE&gt; */
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
op_star
id|dest
op_increment
op_assign
op_star
id|src
suffix:semicolon
r_if
c_cond
(paren
op_star
id|src
op_increment
op_eq
id|DLE
)paren
op_star
id|dest
op_increment
op_assign
id|DLE
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|isar_rcv_frame
id|isar_rcv_frame
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|u_char
op_star
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|isar_reg
op_star
id|ireg
op_assign
id|bcs-&gt;hw.isar.reg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ireg-&gt;clsb
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar zero len frame&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar mode 0 spurious IIS_RDATA %x/%x/%x&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isar mode 0 spurious IIS_RDATA %x/%x/%x&bslash;n&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_V32
suffix:colon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|ireg-&gt;clsb
)paren
)paren
)paren
(brace
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
(paren
id|u_char
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|ireg-&gt;clsb
)paren
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: skb out of memory&bslash;n&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|L1_MODE_HDLC
suffix:colon
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.rcvidx
op_plus
id|ireg-&gt;clsb
)paren
OG
id|HSCX_BUFMAX
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: incoming packet too large&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_ERROR
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar frame error %x len %d&quot;
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_ERR_RER
)paren
id|bcs-&gt;err_inv
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_ERR_CER
)paren
id|bcs-&gt;err_crc
op_increment
suffix:semicolon
macro_line|#endif
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_FSD
)paren
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|ptr
op_assign
id|bcs-&gt;hw.isar.rcvbuf
op_plus
id|bcs-&gt;hw.isar.rcvidx
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_add_assign
id|ireg-&gt;clsb
suffix:semicolon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_FED
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.rcvidx
OL
l_int|3
)paren
(brace
multiline_comment|/* last 2 bytes are the FCS */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar frame to short %d&quot;
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|bcs-&gt;hw.isar.rcvidx
op_minus
l_int|2
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISAR: receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|bcs-&gt;hw.isar.rcvidx
op_minus
l_int|2
)paren
comma
id|bcs-&gt;hw.isar.rcvbuf
comma
id|bcs-&gt;hw.isar.rcvidx
op_minus
l_int|2
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
)brace
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|L1_MODE_FAX
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_ne
id|STFAX_ACTIV
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: not ACTIV&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FRM
)paren
(brace
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
id|bcs-&gt;hw.isar.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
id|ireg-&gt;clsb
op_plus
id|dle_count
c_func
(paren
id|bcs-&gt;hw.isar.rcvbuf
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: raw(%d) dle(%d)&quot;
comma
id|ireg-&gt;clsb
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|bcs-&gt;hw.isar.rcvidx
)paren
)paren
)paren
(brace
id|insert_dle
c_func
(paren
(paren
id|u_char
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
comma
id|bcs-&gt;hw.isar.rcvbuf
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|SART_NMD
)paren
(brace
multiline_comment|/* ABORT */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: no more data&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|send_DLE_ETX
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_ESC
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_NOCARRIER
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: skb out of memory&bslash;n&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_ne
id|PCTRL_CMD_FRH
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: unknown fax mode %x&quot;
comma
id|bcs-&gt;hw.isar.cmd
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* PCTRL_CMD_FRH */
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.rcvidx
op_plus
id|ireg-&gt;clsb
)paren
OG
id|HSCX_BUFMAX
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: incoming packet too large&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_ERROR
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar frame error %x len %d&quot;
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_FSD
)paren
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|ptr
op_assign
id|bcs-&gt;hw.isar.rcvbuf
op_plus
id|bcs-&gt;hw.isar.rcvidx
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_add_assign
id|ireg-&gt;clsb
suffix:semicolon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|HDLC_FED
)paren
(brace
r_int
id|len
op_assign
id|bcs-&gt;hw.isar.rcvidx
op_plus
id|dle_count
c_func
(paren
id|bcs-&gt;hw.isar.rcvbuf
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.rcvidx
OL
l_int|3
)paren
(brace
multiline_comment|/* last 2 bytes are the FCS */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar frame to short %d&quot;
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|bcs-&gt;hw.isar.rcvidx
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ISAR: receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|insert_dle
c_func
(paren
(paren
id|u_char
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|bcs-&gt;hw.isar.rcvbuf
comma
id|bcs-&gt;hw.isar.rcvidx
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
id|send_DLE_ETX
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_OK
)paren
suffix:semicolon
)brace
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_amp
id|SART_NMD
)paren
(brace
multiline_comment|/* ABORT */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_rcv_frame: no more data&quot;
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|send_DLE_ETX
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_ESC
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_NOCARRIER
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_rcv_frame mode (%x)error&bslash;n&quot;
comma
id|bcs-&gt;mode
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|isar_fill_fifo
id|isar_fill_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|count
suffix:semicolon
id|u_char
id|msb
suffix:semicolon
id|u_char
op_star
id|ptr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
op_logical_and
op_logical_neg
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_fill_fifo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
op_le
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;hw.isar.reg-&gt;bstat
op_amp
(paren
id|bcs-&gt;hw.isar.dpath
op_eq
l_int|1
ques
c_cond
id|BSTAT_RDM1
suffix:colon
id|BSTAT_RDM2
)paren
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
OG
id|bcs-&gt;hw.isar.mml
)paren
(brace
id|msb
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
id|bcs-&gt;hw.isar.mml
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
id|msb
op_assign
id|HDLC_FED
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ptr
op_assign
id|bcs-&gt;tx_skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;hw.isar.txcnt
)paren
(brace
id|msb
op_or_assign
id|HDLC_FST
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_FAX
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTH
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ptr
(braket
l_int|0
)braket
op_eq
l_int|0xff
)paren
op_logical_and
(paren
id|ptr
(braket
l_int|1
)braket
op_eq
l_int|0x13
)paren
)paren
multiline_comment|/* last frame */
id|test_and_set_bit
c_func
(paren
id|BC_FLG_LASTDATA
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
)brace
id|skb_pull
c_func
(paren
id|bcs-&gt;tx_skb
comma
id|count
)paren
suffix:semicolon
id|bcs-&gt;tx_cnt
op_sub_assign
id|count
suffix:semicolon
id|bcs-&gt;hw.isar.txcnt
op_add_assign
id|count
suffix:semicolon
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_fill_fifo wrong mode 0&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_V32
suffix:colon
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_SDATA
comma
l_int|0
comma
id|count
comma
id|ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_HDLC
suffix:colon
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_SDATA
comma
id|msb
comma
id|count
comma
id|ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_FAX
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_ne
id|STFAX_ACTIV
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_fill_fifo: not ACTIV&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTH
)paren
(brace
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_SDATA
comma
id|msb
comma
id|count
comma
id|ptr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTM
)paren
(brace
id|sendmsg
c_func
(paren
id|cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_SDATA
comma
l_int|0
comma
id|count
comma
id|ptr
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_fill_fifo: not FTH/FTM&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_fill_fifo mode(%x) error&quot;
comma
id|bcs-&gt;mode
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isar_fill_fifo mode(%x) error&bslash;n&quot;
comma
id|bcs-&gt;mode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_inline
DECL|function|sel_bcs_isar
r_struct
id|BCState
op_star
id|sel_bcs_isar
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|dpath
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|dpath
)paren
op_logical_or
(paren
id|dpath
op_eq
l_int|3
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.isar.dpath
op_eq
id|dpath
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.isar.dpath
op_eq
id|dpath
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|1
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_inline
r_void
DECL|function|send_frames
id|send_frames
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
)paren
(brace
id|isar_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;st-&gt;lli.l1writewakeup
op_logical_and
(paren
id|PACKET_NOACK
op_ne
id|bcs-&gt;tx_skb-&gt;pkt_type
)paren
)paren
id|bcs-&gt;st-&gt;lli
dot
id|l1writewakeup
c_func
(paren
id|bcs-&gt;st
comma
id|bcs-&gt;hw.isar.txcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_FAX
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTH
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_LASTDATA
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_NMD_DATA
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTM
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_DLEETX
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_LASTDATA
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_NMD_DATA
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
)brace
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.txcnt
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|bcs-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|bcs-&gt;hw.isar.txcnt
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|isar_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_DLEETX
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_LASTDATA
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_NMD_DATA
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|u_char
id|dummy
op_assign
l_int|0
suffix:semicolon
id|sendmsg
c_func
(paren
id|bcs-&gt;cs
comma
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
op_or
id|ISAR_HIS_SDATA
comma
l_int|0x01
comma
l_int|1
comma
op_amp
id|dummy
)paren
suffix:semicolon
)brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_LL_OK
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
r_else
(brace
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_CONNECT
)paren
suffix:semicolon
)brace
)brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
)brace
)brace
r_inline
r_void
DECL|function|check_send
id|check_send
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|rdm
)paren
(brace
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
r_if
c_cond
(paren
id|rdm
op_amp
id|BSTAT_RDM1
)paren
(brace
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
l_int|1
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
id|send_frames
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|rdm
op_amp
id|BSTAT_RDM2
)paren
(brace
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
l_int|2
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
id|send_frames
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|variable|dmril
r_const
r_char
op_star
id|dmril
(braket
)braket
op_assign
(brace
l_string|&quot;NO SPEED&quot;
comma
l_string|&quot;1200/75&quot;
comma
l_string|&quot;NODEF2&quot;
comma
l_string|&quot;75/1200&quot;
comma
l_string|&quot;NODEF4&quot;
comma
l_string|&quot;300&quot;
comma
l_string|&quot;600&quot;
comma
l_string|&quot;1200&quot;
comma
l_string|&quot;2400&quot;
comma
l_string|&quot;4800&quot;
comma
l_string|&quot;7200&quot;
comma
l_string|&quot;9600nt&quot;
comma
l_string|&quot;9600t&quot;
comma
l_string|&quot;12000&quot;
comma
l_string|&quot;14400&quot;
comma
l_string|&quot;WRONG&quot;
)brace
suffix:semicolon
DECL|variable|dmrim
r_const
r_char
op_star
id|dmrim
(braket
)braket
op_assign
(brace
l_string|&quot;NO MOD&quot;
comma
l_string|&quot;NO DEF&quot;
comma
l_string|&quot;V32/V32b&quot;
comma
l_string|&quot;V22&quot;
comma
l_string|&quot;V21&quot;
comma
l_string|&quot;Bell103&quot;
comma
l_string|&quot;V23&quot;
comma
l_string|&quot;Bell202&quot;
comma
l_string|&quot;V17&quot;
comma
l_string|&quot;V29&quot;
comma
l_string|&quot;V27ter&quot;
)brace
suffix:semicolon
r_static
r_void
DECL|function|isar_pump_status_rsp
id|isar_pump_status_rsp
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_struct
id|isar_reg
op_star
id|ireg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|ril
op_assign
id|ireg-&gt;par
(braket
l_int|0
)braket
suffix:semicolon
id|u_char
id|rim
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_clear_bit
c_func
(paren
id|ISAR_RATE_REQ
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ril
OG
l_int|14
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;wrong pstrsp ril=%d&quot;
comma
id|ril
)paren
suffix:semicolon
id|ril
op_assign
l_int|15
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ireg-&gt;par
(braket
l_int|1
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|rim
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x20
suffix:colon
id|rim
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x40
suffix:colon
id|rim
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x41
suffix:colon
id|rim
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x51
suffix:colon
id|rim
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x61
suffix:colon
id|rim
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x71
suffix:colon
id|rim
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x82
suffix:colon
id|rim
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x92
suffix:colon
id|rim
op_assign
l_int|9
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xa2
suffix:colon
id|rim
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rim
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|bcs-&gt;hw.isar.conmsg
comma
l_string|&quot;%s %s&quot;
comma
id|dmril
(braket
id|ril
)braket
comma
id|dmrim
(braket
id|rim
)braket
)paren
suffix:semicolon
id|bcs-&gt;conmsg
op_assign
id|bcs-&gt;hw.isar.conmsg
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump strsp %s&quot;
comma
id|bcs-&gt;conmsg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isar_pump_statev_modem
id|isar_pump_statev_modem
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|devt
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|devt
)paren
(brace
r_case
id|PSEV_10MS_TIMER
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev TIMER&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_CON_ON
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev CONNECT&quot;
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|bcs-&gt;st
comma
id|PH_ACTIVATE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_CON_OFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev NO CONNECT&quot;
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PSTREQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|bcs-&gt;st
comma
id|PH_DEACTIVATE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_V24_OFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev V24 OFF&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_CTS_ON
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev CTS ON&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_CTS_OFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev CTS OFF&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_DCD_ON
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev CARRIER ON&quot;
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|ISAR_RATE_REQ
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PSTREQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_DCD_OFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev CARRIER OFF&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_DSR_ON
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev DSR ON&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_DSR_OFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev DSR_OFF&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_REM_RET
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev REMOTE RETRAIN&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_REM_REN
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev REMOTE RENEGOTIATE&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_GSTN_CLR
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev GSTN CLEAR&quot;
comma
id|devt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;unknown pump stev %x&quot;
comma
id|devt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|ll_deliver_faxstat
id|ll_deliver_faxstat
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|status
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|bcs-&gt;st-&gt;lli.userdata
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;HL-&gt;LL FAXIND %x&quot;
comma
id|status
)paren
suffix:semicolon
id|ic.driver
op_assign
id|bcs-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|ic.parm.aux.cmd
op_assign
id|status
suffix:semicolon
id|bcs-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isar_pump_statev_fax
id|isar_pump_statev_fax
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|devt
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
id|u_char
id|p1
suffix:semicolon
r_switch
c_cond
(paren
id|devt
)paren
(brace
r_case
id|PSEV_10MS_TIMER
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev TIMER&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_RSP_READY
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_READY&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_READY
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|bcs-&gt;st
comma
id|PH_ACTIVATE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_ORIG
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|isar_pump_cmd
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_FRH
comma
l_int|3
)paren
suffix:semicolon
)brace
r_else
(brace
id|isar_pump_cmd
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_FTH
comma
l_int|3
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_LINE_TX_H
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_LINE
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_TX_H&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_CONT
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_CONT
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_TX_H wrong st %x&quot;
comma
id|bcs-&gt;hw.isar.state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_LINE_RX_H
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_LINE
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_RX_H&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_CONT
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_CONT
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_RX_H wrong st %x&quot;
comma
id|bcs-&gt;hw.isar.state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_LINE_TX_B
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_LINE
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_TX_B&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_CONT
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_CONT
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_TX_B wrong st %x&quot;
comma
id|bcs-&gt;hw.isar.state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_LINE_RX_B
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_LINE
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_RX_B&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_CONT
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_CONT
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev LINE_RX_B wrong st %x&quot;
comma
id|bcs-&gt;hw.isar.state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_RSP_CONN
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_CONT
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_CONN&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ACTIV
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|ISAR_RATE_REQ
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PSTREQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTH
)paren
(brace
multiline_comment|/* 1s Flags before data */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|BC_FLG_FTI_RUN
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|bcs-&gt;hw.isar.ftimer
)paren
suffix:semicolon
multiline_comment|/* 1000 ms */
id|bcs-&gt;hw.isar.ftimer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
l_int|1000
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_LL_CONN
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|bcs-&gt;hw.isar.ftimer
)paren
suffix:semicolon
)brace
r_else
(brace
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_CONNECT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_CONN wrong st %x&quot;
comma
id|bcs-&gt;hw.isar.state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_FLAGS_DET
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev FLAGS_DET&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_RSP_DISC
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_DISC&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ESCAPE
)paren
(brace
r_switch
c_cond
(paren
id|bcs-&gt;hw.isar.newcmd
)paren
(brace
r_case
l_int|0
suffix:colon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_READY
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCTRL_CMD_FTH
suffix:colon
r_case
id|PCTRL_CMD_FTM
suffix:colon
id|p1
op_assign
l_int|10
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_SILON
comma
l_int|1
comma
op_amp
id|p1
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_SILDET
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCTRL_CMD_FRH
suffix:colon
r_case
id|PCTRL_CMD_FRM
suffix:colon
id|p1
op_assign
id|bcs-&gt;hw.isar.mod
op_assign
id|bcs-&gt;hw.isar.newmod
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|bcs-&gt;hw.isar.newcmd
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|bcs-&gt;hw.isar.cmd
comma
l_int|1
comma
op_amp
id|p1
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;RSP_DISC unknown newcmd %x&quot;
comma
id|bcs-&gt;hw.isar.newcmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ACTIV
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_LL_OK
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_OK
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FRM
)paren
(brace
id|send_DLE_ETX
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_NOCARRIER
)paren
suffix:semicolon
)brace
r_else
(brace
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_FCERROR
)paren
suffix:semicolon
)brace
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_READY
suffix:semicolon
)brace
r_else
(brace
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_READY
suffix:semicolon
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_FCERROR
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_RSP_SILDET
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_SILDET&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_SILDET
)paren
(brace
id|p1
op_assign
id|bcs-&gt;hw.isar.mod
op_assign
id|bcs-&gt;hw.isar.newmod
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|bcs-&gt;hw.isar.newcmd
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|bcs-&gt;hw.isar.cmd
comma
l_int|1
comma
op_amp
id|p1
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSEV_RSP_SILOFF
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_SILOFF&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSEV_RSP_FCERR
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_LINE
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_FCERR try %d&quot;
comma
id|bcs-&gt;hw.isar.try_mod
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.try_mod
op_decrement
)paren
(brace
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|bcs-&gt;hw.isar.cmd
comma
l_int|1
comma
op_amp
id|bcs-&gt;hw.isar.mod
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;pump stev RSP_FCERR&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|PCTRL_CMD_ESC
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_FCERROR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|variable|debbuf
r_static
r_char
id|debbuf
(braket
l_int|128
)braket
suffix:semicolon
r_void
DECL|function|isar_int_main
id|isar_int_main
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|flags
suffix:semicolon
r_struct
id|isar_reg
op_star
id|ireg
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.isar.reg
suffix:semicolon
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|get_irq_infos
c_func
(paren
id|cs
comma
id|ireg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ireg-&gt;iis
op_amp
id|ISAR_IIS_MSCMSD
)paren
(brace
r_case
id|ISAR_IIS_RDATA
suffix:colon
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
id|ireg-&gt;iis
op_rshift
l_int|6
)paren
)paren
)paren
(brace
id|isar_rcv_frame
c_func
(paren
id|cs
comma
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar spurious IIS_RDATA %x/%x/%x&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISAR_IIS_GSTEV
suffix:colon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
id|ireg-&gt;bstat
op_or_assign
id|ireg-&gt;cmsb
suffix:semicolon
id|check_send
c_func
(paren
id|cs
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISAR_IIS_BSTEV
suffix:colon
macro_line|#ifdef ERROR_STATISTIC
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
id|ireg-&gt;iis
op_rshift
l_int|6
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_eq
id|BSTEV_TBO
)paren
id|bcs-&gt;err_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ireg-&gt;cmsb
op_eq
id|BSTEV_RBO
)paren
id|bcs-&gt;err_rdo
op_increment
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;Buffer STEV dpath%d msb(%x)&quot;
comma
id|ireg-&gt;iis
op_rshift
l_int|6
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISAR_IIS_PSTEV
suffix:colon
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
id|ireg-&gt;iis
op_rshift
l_int|6
)paren
)paren
)paren
(brace
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
(paren
id|u_char
op_star
)paren
id|ireg-&gt;par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_V32
)paren
(brace
id|isar_pump_statev_modem
c_func
(paren
id|bcs
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_FAX
)paren
(brace
id|isar_pump_statev_fax
c_func
(paren
id|bcs
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar IIS_PSTEV pmode %d stat %x&quot;
comma
id|bcs-&gt;mode
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar spurious IIS_PSTEV %x/%x/%x&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISAR_IIS_PSTRSP
suffix:colon
r_if
c_cond
(paren
(paren
id|bcs
op_assign
id|sel_bcs_isar
c_func
(paren
id|cs
comma
id|ireg-&gt;iis
op_rshift
l_int|6
)paren
)paren
)paren
(brace
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
(paren
id|u_char
op_star
)paren
id|ireg-&gt;par
)paren
suffix:semicolon
id|isar_pump_status_rsp
c_func
(paren
id|bcs
comma
id|ireg
)paren
suffix:semicolon
)brace
r_else
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar spurious IIS_PSTRSP %x/%x/%x&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|cs
op_member_access_from_pointer
id|BC_Write_Reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|ISAR_IIA
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISAR_IIS_DIAG
suffix:colon
r_case
id|ISAR_IIS_BSTRSP
suffix:colon
r_case
id|ISAR_IIS_IOM2RSP
suffix:colon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
(paren
id|u_char
op_star
)paren
id|ireg-&gt;par
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;debug
op_amp
(paren
id|L1_DEB_HSCX
op_or
id|L1_DEB_HSCX_FIFO
)paren
)paren
op_eq
id|L1_DEB_HSCX
)paren
(brace
id|u_char
op_star
id|tp
op_assign
id|debbuf
suffix:semicolon
id|tp
op_add_assign
id|sprintf
c_func
(paren
id|debbuf
comma
l_string|&quot;msg iis(%x) msb(%x)&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|tp
comma
(paren
id|u_char
op_star
)paren
id|ireg-&gt;par
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|debbuf
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISAR_IIS_INVMSG
suffix:colon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
id|debbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;invalid msg his:%x&quot;
comma
id|ireg-&gt;cmsb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcv_mbox
c_func
(paren
id|cs
comma
id|ireg
comma
id|debbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;unhandled msg iis(%x) ctrl(%x/%x)&quot;
comma
id|ireg-&gt;iis
comma
id|ireg-&gt;cmsb
comma
id|ireg-&gt;clsb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ftimer_handler
id|ftimer_handler
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ftimer flags %04x&quot;
comma
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_FTI_RUN
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_LL_CONN
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|isar_sched_event
c_func
(paren
id|bcs
comma
id|B_LL_CONNECT
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|setup_pump
id|setup_pump
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
id|u_char
id|ctrl
comma
id|param
(braket
l_int|6
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_HDLC
suffix:colon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCFG
comma
id|PMOD_BYPASS
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_V32
suffix:colon
id|ctrl
op_assign
id|PMOD_DATAMODEM
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_ORIG
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|ctrl
op_or_assign
id|PCTRL_ORIG
suffix:semicolon
id|param
(braket
l_int|5
)braket
op_assign
id|PV32P6_CTN
suffix:semicolon
)brace
r_else
(brace
id|param
(braket
l_int|5
)braket
op_assign
id|PV32P6_ATN
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* 6 db */
id|param
(braket
l_int|1
)braket
op_assign
id|PV32P2_V23R
op_or
id|PV32P2_V22A
op_or
id|PV32P2_V22B
op_or
id|PV32P2_V22C
op_or
id|PV32P2_V21
op_or
id|PV32P2_BEL
suffix:semicolon
id|param
(braket
l_int|2
)braket
op_assign
id|PV32P3_AMOD
op_or
id|PV32P3_V32B
op_or
id|PV32P3_V23B
suffix:semicolon
id|param
(braket
l_int|3
)braket
op_assign
id|PV32P4_UT144
suffix:semicolon
id|param
(braket
l_int|4
)braket
op_assign
id|PV32P5_UT144
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCFG
comma
id|ctrl
comma
l_int|6
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_FAX
suffix:colon
id|ctrl
op_assign
id|PMOD_FAX
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_ORIG
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|ctrl
op_or_assign
id|PCTRL_ORIG
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|PFAXP2_CTN
suffix:semicolon
)brace
r_else
(brace
id|param
(braket
l_int|1
)braket
op_assign
id|PFAXP2_ATN
suffix:semicolon
)brace
id|param
(braket
l_int|0
)braket
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* 6 db */
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCFG
comma
id|ctrl
comma
l_int|2
comma
id|param
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_NULL
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_FTI_RUN
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PSTREQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|setup_sart
id|setup_sart
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
id|u_char
id|ctrl
comma
id|param
(braket
l_int|2
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_SARTCFG
comma
id|SMODE_DISABLE
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_SARTCFG
comma
id|SMODE_BINARY
comma
l_int|2
comma
l_string|&quot;&bslash;0&bslash;0&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_HDLC
suffix:colon
r_case
id|L1_MODE_FAX
suffix:colon
id|param
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_SARTCFG
comma
id|SMODE_HDLC
comma
l_int|1
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_V32
suffix:colon
id|ctrl
op_assign
id|SMODE_V14
op_or
id|SCTRL_HDMC_BOTH
suffix:semicolon
id|param
(braket
l_int|0
)braket
op_assign
id|S_P1_CHS_8
suffix:semicolon
id|param
(braket
l_int|1
)braket
op_assign
id|S_P2_BFT_DEF
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_SARTCFG
comma
id|ctrl
comma
l_int|2
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_BSTREQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|setup_iom2
id|setup_iom2
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
id|u_char
id|cmsb
op_assign
id|IOM_CTRL_ENA
comma
id|msg
(braket
l_int|5
)braket
op_assign
(brace
id|IOM_P1_TXD
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;channel
)paren
id|msg
(braket
l_int|1
)braket
op_assign
id|msg
(braket
l_int|3
)braket
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
id|cmsb
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* dummy slot */
id|msg
(braket
l_int|1
)braket
op_assign
id|msg
(braket
l_int|3
)braket
op_assign
id|bcs-&gt;hw.isar.dpath
op_plus
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_HDLC
suffix:colon
r_break
suffix:semicolon
r_case
id|L1_MODE_V32
suffix:colon
r_case
id|L1_MODE_FAX
suffix:colon
id|cmsb
op_or_assign
id|IOM_CTRL_ALAW
op_or
id|IOM_CTRL_RCV
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_IOM2CFG
comma
id|cmsb
comma
l_int|5
comma
id|msg
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_IOM2REQ
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_int
DECL|function|modeisar
id|modeisar
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bc
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
multiline_comment|/* Here we are selecting the best datapath for requested mode */
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_NULL
)paren
(brace
multiline_comment|/* New Setup */
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
multiline_comment|/* init */
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;hw.isar.dpath
)paren
multiline_comment|/* no init for dpath 0 */
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_HDLC
suffix:colon
multiline_comment|/* best is datapath 2 */
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|ISAR_DP2_USE
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
)paren
id|bcs-&gt;hw.isar.dpath
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|ISAR_DP1_USE
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
)paren
id|bcs-&gt;hw.isar.dpath
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isar modeisar both pathes in use&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|L1_MODE_V32
suffix:colon
r_case
id|L1_MODE_FAX
suffix:colon
multiline_comment|/* only datapath 1 */
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|ISAR_DP1_USE
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
)paren
id|bcs-&gt;hw.isar.dpath
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isar modeisar analog funktions only with DP1&bslash;n&quot;
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar modeisar analog funktions only with DP1&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar dp%d mode %d-&gt;%d ichan %d&quot;
comma
id|bcs-&gt;hw.isar.dpath
comma
id|bcs-&gt;mode
comma
id|mode
comma
id|bc
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|setup_pump
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|setup_iom2
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|setup_sart
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_NULL
)paren
(brace
multiline_comment|/* Clear resources */
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.dpath
op_eq
l_int|1
)paren
id|test_and_clear_bit
c_func
(paren
id|ISAR_DP1_USE
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.dpath
op_eq
l_int|2
)paren
id|test_and_clear_bit
c_func
(paren
id|ISAR_DP2_USE
comma
op_amp
id|bcs-&gt;hw.isar.reg-&gt;Flags
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.dpath
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|isar_pump_cmd
id|isar_pump_cmd
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_char
id|cmd
comma
id|u_char
id|para
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
id|u_char
id|dps
op_assign
id|SET_DPS
c_func
(paren
id|bcs-&gt;hw.isar.dpath
)paren
suffix:semicolon
id|u_char
id|ctrl
op_assign
l_int|0
comma
id|nom
op_assign
l_int|0
comma
id|p1
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ISDN_FAX_CLASS1_FTM
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_READY
)paren
(brace
id|p1
op_assign
id|para
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_FTM
suffix:semicolon
id|nom
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|ctrl
suffix:semicolon
id|bcs-&gt;hw.isar.mod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ACTIV
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTM
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.mod
op_eq
id|para
)paren
)paren
(brace
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_CONNECT
)paren
suffix:semicolon
)brace
r_else
(brace
id|bcs-&gt;hw.isar.newmod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
id|PCTRL_CMD_FTM
suffix:semicolon
id|nom
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_ESC
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_FAX_CLASS1_FTH
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_READY
)paren
(brace
id|p1
op_assign
id|para
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_FTH
suffix:semicolon
id|nom
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|ctrl
suffix:semicolon
id|bcs-&gt;hw.isar.mod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ACTIV
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FTH
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.mod
op_eq
id|para
)paren
)paren
(brace
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_CONNECT
)paren
suffix:semicolon
)brace
r_else
(brace
id|bcs-&gt;hw.isar.newmod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
id|PCTRL_CMD_FTH
suffix:semicolon
id|nom
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_ESC
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_FAX_CLASS1_FRM
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_READY
)paren
(brace
id|p1
op_assign
id|para
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_FRM
suffix:semicolon
id|nom
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|ctrl
suffix:semicolon
id|bcs-&gt;hw.isar.mod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ACTIV
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FRM
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.mod
op_eq
id|para
)paren
)paren
(brace
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_CONNECT
)paren
suffix:semicolon
)brace
r_else
(brace
id|bcs-&gt;hw.isar.newmod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
id|PCTRL_CMD_FRM
suffix:semicolon
id|nom
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_ESC
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_FAX_CLASS1_FRH
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_READY
)paren
(brace
id|p1
op_assign
id|para
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_FRH
suffix:semicolon
id|nom
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_LINE
suffix:semicolon
id|bcs-&gt;hw.isar.cmd
op_assign
id|ctrl
suffix:semicolon
id|bcs-&gt;hw.isar.mod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newmod
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.try_mod
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bcs-&gt;hw.isar.state
op_eq
id|STFAX_ACTIV
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.cmd
op_eq
id|PCTRL_CMD_FRH
)paren
op_logical_and
(paren
id|bcs-&gt;hw.isar.mod
op_eq
id|para
)paren
)paren
(brace
id|ll_deliver_faxstat
c_func
(paren
id|bcs
comma
id|ISDN_FAX_CLASS1_CONNECT
)paren
suffix:semicolon
)brace
r_else
(brace
id|bcs-&gt;hw.isar.newmod
op_assign
id|para
suffix:semicolon
id|bcs-&gt;hw.isar.newcmd
op_assign
id|PCTRL_CMD_FRH
suffix:semicolon
id|nom
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|PCTRL_CMD_ESC
suffix:semicolon
id|bcs-&gt;hw.isar.state
op_assign
id|STFAX_ESCAPE
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctrl
)paren
id|sendmsg
c_func
(paren
id|cs
comma
id|dps
op_or
id|ISAR_HIS_PUMPCTRL
comma
id|ctrl
comma
id|nom
comma
op_amp
id|p1
)paren
suffix:semicolon
)brace
r_void
DECL|function|isar_setup
id|isar_setup
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_char
id|msg
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Dpath 1, 2 */
id|msg
op_assign
l_int|61
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Buffer Config */
id|sendmsg
c_func
(paren
id|cs
comma
(paren
id|i
ques
c_cond
id|ISAR_HIS_DPS2
suffix:colon
id|ISAR_HIS_DPS1
)paren
op_or
id|ISAR_HIS_P12CFG
comma
l_int|4
comma
l_int|1
comma
op_amp
id|msg
)paren
suffix:semicolon
id|cs-&gt;bcs
(braket
id|i
)braket
dot
id|hw.isar.mml
op_assign
id|msg
suffix:semicolon
id|cs-&gt;bcs
(braket
id|i
)braket
dot
id|mode
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;bcs
(braket
id|i
)braket
dot
id|hw.isar.dpath
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|modeisar
c_func
(paren
op_amp
id|cs-&gt;bcs
(braket
id|i
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|cs-&gt;bcs
(braket
id|i
)braket
dot
id|tqueue.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|isar_bh
suffix:semicolon
)brace
)brace
r_void
DECL|function|isar_l2l1
id|isar_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|st-&gt;l1.bcs-&gt;squeue
comma
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
l_string|&quot;DRQ set BC_FLG_BUSY&quot;
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.isar.txcnt
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isar_l2l1: this shouldn&squot;t happen&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
l_string|&quot;PUI set BC_FLG_BUSY&quot;
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.isar.txcnt
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|test_and_set_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.isar.conmsg
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_ORIG
comma
op_amp
id|st-&gt;l2.flag
)paren
)paren
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ORIG
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
r_else
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ORIG
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;l1.mode
)paren
(brace
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_HDLC
suffix:colon
r_if
c_cond
(paren
id|modeisar
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
)paren
id|l1_msg_b
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|REQUEST
comma
id|arg
)paren
suffix:semicolon
r_else
id|l1_msg_b
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|REQUEST
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_V32
suffix:colon
r_case
id|L1_MODE_FAX
suffix:colon
r_if
c_cond
(paren
id|modeisar
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
)paren
id|l1_msg_b
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|REQUEST
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
l_string|&quot;PDAC clear BC_FLG_BUSY&quot;
)paren
suffix:semicolon
id|modeisar
c_func
(paren
id|st-&gt;l1.bcs
comma
l_int|0
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|close_isarstate
id|close_isarstate
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|modeisar
c_func
(paren
id|bcs
comma
l_int|0
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.isar.rcvbuf
)paren
(brace
id|kfree
c_func
(paren
id|bcs-&gt;hw.isar.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.isar.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;closeisar clear BC_FLG_BUSY&quot;
)paren
suffix:semicolon
)brace
)brace
id|del_timer
c_func
(paren
op_amp
id|bcs-&gt;hw.isar.ftimer
)paren
suffix:semicolon
)brace
r_int
DECL|function|open_isarstate
id|open_isarstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;hw.isar.rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|HSCX_BUFMAX
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for isar.rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
)brace
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;openisar clear BC_FLG_BUSY&quot;
)paren
suffix:semicolon
id|bcs-&gt;event
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.rcvidx
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.isar.ftimer.function
op_assign
(paren
r_void
op_star
)paren
id|ftimer_handler
suffix:semicolon
id|bcs-&gt;hw.isar.ftimer.data
op_assign
(paren
r_int
)paren
id|bcs
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|bcs-&gt;hw.isar.ftimer
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|setstack_isar
id|setstack_isar
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
r_if
c_cond
(paren
id|open_isarstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|isar_l2l1
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|isar_auxcmd
id|isar_auxcmd
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|isdn_ctrl
op_star
id|ic
)paren
(brace
id|u_long
id|adr
suffix:semicolon
r_int
id|features
comma
id|i
suffix:semicolon
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_auxcmd cmd/ch %x/%d&quot;
comma
id|ic-&gt;command
comma
id|ic-&gt;arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ic-&gt;command
)paren
(brace
r_case
(paren
id|ISDN_CMD_FAXCMD
)paren
suffix:colon
id|bcs
op_assign
id|cs-&gt;channel
(braket
id|ic-&gt;arg
)braket
dot
id|bcs
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;isar_auxcmd cmd/subcmd %d/%d&quot;
comma
id|ic-&gt;parm.aux.cmd
comma
id|ic-&gt;parm.aux.subcmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ic-&gt;parm.aux.cmd
)paren
(brace
r_case
id|ISDN_FAX_CLASS1_CTRL
suffix:colon
r_if
c_cond
(paren
id|ic-&gt;parm.aux.subcmd
op_eq
id|ETX
)paren
id|test_and_set_bit
c_func
(paren
id|BC_FLG_DLEETX
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_FAX_CLASS1_FRM
suffix:colon
r_case
id|ISDN_FAX_CLASS1_FRH
suffix:colon
r_case
id|ISDN_FAX_CLASS1_FTM
suffix:colon
r_case
id|ISDN_FAX_CLASS1_FTH
suffix:colon
r_if
c_cond
(paren
id|ic-&gt;parm.aux.subcmd
op_eq
id|AT_QUERY
)paren
(brace
id|sprintf
c_func
(paren
id|ic-&gt;parm.aux.para
comma
l_string|&quot;%d&quot;
comma
id|bcs-&gt;hw.isar.mod
)paren
suffix:semicolon
id|ic-&gt;command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|ic-&gt;parm.aux.cmd
op_assign
id|ISDN_FAX_CLASS1_QUERY
suffix:semicolon
id|cs-&gt;iif
dot
id|statcallb
c_func
(paren
id|ic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ic-&gt;parm.aux.subcmd
op_eq
id|AT_EQ_QUERY
)paren
(brace
id|strcpy
c_func
(paren
id|ic-&gt;parm.aux.para
comma
id|faxmodulation_s
)paren
suffix:semicolon
id|ic-&gt;command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|ic-&gt;parm.aux.cmd
op_assign
id|ISDN_FAX_CLASS1_QUERY
suffix:semicolon
id|cs-&gt;iif
dot
id|statcallb
c_func
(paren
id|ic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ic-&gt;parm.aux.subcmd
op_eq
id|AT_EQ_VALUE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FAXMODCNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|faxmodulation
(braket
id|i
)braket
op_eq
id|ic-&gt;parm.aux.para
(braket
l_int|0
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|FAXMODCNT
OG
id|i
)paren
op_logical_and
id|test_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|isar_pump_cmd
c_func
(paren
id|bcs
comma
id|ic-&gt;parm.aux.cmd
comma
id|ic-&gt;parm.aux.para
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* wrong modulation or not activ */
multiline_comment|/* fall through */
r_default
suffix:colon
id|ic-&gt;command
op_assign
id|ISDN_STAT_FAXIND
suffix:semicolon
id|ic-&gt;parm.aux.cmd
op_assign
id|ISDN_FAX_CLASS1_ERROR
suffix:semicolon
id|cs-&gt;iif
dot
id|statcallb
c_func
(paren
id|ic
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_IOCTL
)paren
suffix:colon
r_switch
c_cond
(paren
id|ic-&gt;arg
)paren
(brace
r_case
(paren
l_int|9
)paren
suffix:colon
multiline_comment|/* load firmware */
id|features
op_assign
id|ISDN_FEATURE_L2_MODEM
op_or
id|ISDN_FEATURE_L2_FAX
op_or
id|ISDN_FEATURE_L3_FCLASS1
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|adr
comma
id|ic-&gt;parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isar_load_firmware
c_func
(paren
id|cs
comma
(paren
id|u_char
op_star
)paren
id|adr
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
id|ll_run
c_func
(paren
id|cs
comma
id|features
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: invalid ioctl %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|ic-&gt;arg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
id|__devinit
DECL|function|initisar
id|initisar
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_SetStack
op_assign
id|setstack_isar
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_SetStack
op_assign
id|setstack_isar
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_Close
op_assign
id|close_isarstate
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_Close
op_assign
id|close_isarstate
suffix:semicolon
)brace
eof
