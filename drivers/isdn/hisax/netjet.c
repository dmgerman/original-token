multiline_comment|/* $Id: netjet.c,v 1.24.6.1 2000/12/06 16:59:20 kai Exp $&n; *&n; * netjet.c     low level stuff for Traverse Technologie NETJet ISDN cards&n; *&n; * Author     Karsten Keil (keil@isdn4linux.de)&n; *&n; * Thanks to Traverse Technologie Australia for documents and informations&n; *&n; * This file is (c) under GNU PUBLIC LICENSE&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isac.h&quot;
macro_line|#include &quot;hscx.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ppp_defs.h&gt;
macro_line|#include &quot;netjet.h&quot;
macro_line|#ifndef bus_to_virt
DECL|macro|bus_to_virt
mdefine_line|#define bus_to_virt (u_int *)
macro_line|#endif
macro_line|#ifndef virt_to_bus
DECL|macro|virt_to_bus
mdefine_line|#define virt_to_bus (u_int)
macro_line|#endif
DECL|variable|NETjet_revision
r_const
r_char
op_star
id|NETjet_revision
op_assign
l_string|&quot;$Revision: 1.24.6.1 $&quot;
suffix:semicolon
multiline_comment|/* Interface functions */
id|u_char
DECL|function|NETjet_ReadIC
id|NETjet_ReadIC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|offset
)paren
(brace
r_int
id|flags
suffix:semicolon
id|u_char
id|ret
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cs-&gt;hw.njet.auxd
op_and_assign
l_int|0xfc
suffix:semicolon
id|cs-&gt;hw.njet.auxd
op_or_assign
(paren
id|offset
op_rshift
l_int|4
)paren
op_amp
l_int|3
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.auxa
comma
id|cs-&gt;hw.njet.auxd
)paren
suffix:semicolon
id|ret
op_assign
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.isac
op_plus
(paren
(paren
id|offset
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_void
DECL|function|NETjet_WriteIC
id|NETjet_WriteIC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
id|offset
comma
id|u_char
id|value
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cs-&gt;hw.njet.auxd
op_and_assign
l_int|0xfc
suffix:semicolon
id|cs-&gt;hw.njet.auxd
op_or_assign
(paren
id|offset
op_rshift
l_int|4
)paren
op_amp
l_int|3
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.auxa
comma
id|cs-&gt;hw.njet.auxd
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.isac
op_plus
(paren
(paren
id|offset
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
comma
id|value
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|NETjet_ReadICfifo
id|NETjet_ReadICfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|cs-&gt;hw.njet.auxd
op_and_assign
l_int|0xfc
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.auxa
comma
id|cs-&gt;hw.njet.auxd
)paren
suffix:semicolon
id|insb
c_func
(paren
id|cs-&gt;hw.njet.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
DECL|variable|fcstab
id|__u16
id|fcstab
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x0000
comma
l_int|0x1189
comma
l_int|0x2312
comma
l_int|0x329b
comma
l_int|0x4624
comma
l_int|0x57ad
comma
l_int|0x6536
comma
l_int|0x74bf
comma
l_int|0x8c48
comma
l_int|0x9dc1
comma
l_int|0xaf5a
comma
l_int|0xbed3
comma
l_int|0xca6c
comma
l_int|0xdbe5
comma
l_int|0xe97e
comma
l_int|0xf8f7
comma
l_int|0x1081
comma
l_int|0x0108
comma
l_int|0x3393
comma
l_int|0x221a
comma
l_int|0x56a5
comma
l_int|0x472c
comma
l_int|0x75b7
comma
l_int|0x643e
comma
l_int|0x9cc9
comma
l_int|0x8d40
comma
l_int|0xbfdb
comma
l_int|0xae52
comma
l_int|0xdaed
comma
l_int|0xcb64
comma
l_int|0xf9ff
comma
l_int|0xe876
comma
l_int|0x2102
comma
l_int|0x308b
comma
l_int|0x0210
comma
l_int|0x1399
comma
l_int|0x6726
comma
l_int|0x76af
comma
l_int|0x4434
comma
l_int|0x55bd
comma
l_int|0xad4a
comma
l_int|0xbcc3
comma
l_int|0x8e58
comma
l_int|0x9fd1
comma
l_int|0xeb6e
comma
l_int|0xfae7
comma
l_int|0xc87c
comma
l_int|0xd9f5
comma
l_int|0x3183
comma
l_int|0x200a
comma
l_int|0x1291
comma
l_int|0x0318
comma
l_int|0x77a7
comma
l_int|0x662e
comma
l_int|0x54b5
comma
l_int|0x453c
comma
l_int|0xbdcb
comma
l_int|0xac42
comma
l_int|0x9ed9
comma
l_int|0x8f50
comma
l_int|0xfbef
comma
l_int|0xea66
comma
l_int|0xd8fd
comma
l_int|0xc974
comma
l_int|0x4204
comma
l_int|0x538d
comma
l_int|0x6116
comma
l_int|0x709f
comma
l_int|0x0420
comma
l_int|0x15a9
comma
l_int|0x2732
comma
l_int|0x36bb
comma
l_int|0xce4c
comma
l_int|0xdfc5
comma
l_int|0xed5e
comma
l_int|0xfcd7
comma
l_int|0x8868
comma
l_int|0x99e1
comma
l_int|0xab7a
comma
l_int|0xbaf3
comma
l_int|0x5285
comma
l_int|0x430c
comma
l_int|0x7197
comma
l_int|0x601e
comma
l_int|0x14a1
comma
l_int|0x0528
comma
l_int|0x37b3
comma
l_int|0x263a
comma
l_int|0xdecd
comma
l_int|0xcf44
comma
l_int|0xfddf
comma
l_int|0xec56
comma
l_int|0x98e9
comma
l_int|0x8960
comma
l_int|0xbbfb
comma
l_int|0xaa72
comma
l_int|0x6306
comma
l_int|0x728f
comma
l_int|0x4014
comma
l_int|0x519d
comma
l_int|0x2522
comma
l_int|0x34ab
comma
l_int|0x0630
comma
l_int|0x17b9
comma
l_int|0xef4e
comma
l_int|0xfec7
comma
l_int|0xcc5c
comma
l_int|0xddd5
comma
l_int|0xa96a
comma
l_int|0xb8e3
comma
l_int|0x8a78
comma
l_int|0x9bf1
comma
l_int|0x7387
comma
l_int|0x620e
comma
l_int|0x5095
comma
l_int|0x411c
comma
l_int|0x35a3
comma
l_int|0x242a
comma
l_int|0x16b1
comma
l_int|0x0738
comma
l_int|0xffcf
comma
l_int|0xee46
comma
l_int|0xdcdd
comma
l_int|0xcd54
comma
l_int|0xb9eb
comma
l_int|0xa862
comma
l_int|0x9af9
comma
l_int|0x8b70
comma
l_int|0x8408
comma
l_int|0x9581
comma
l_int|0xa71a
comma
l_int|0xb693
comma
l_int|0xc22c
comma
l_int|0xd3a5
comma
l_int|0xe13e
comma
l_int|0xf0b7
comma
l_int|0x0840
comma
l_int|0x19c9
comma
l_int|0x2b52
comma
l_int|0x3adb
comma
l_int|0x4e64
comma
l_int|0x5fed
comma
l_int|0x6d76
comma
l_int|0x7cff
comma
l_int|0x9489
comma
l_int|0x8500
comma
l_int|0xb79b
comma
l_int|0xa612
comma
l_int|0xd2ad
comma
l_int|0xc324
comma
l_int|0xf1bf
comma
l_int|0xe036
comma
l_int|0x18c1
comma
l_int|0x0948
comma
l_int|0x3bd3
comma
l_int|0x2a5a
comma
l_int|0x5ee5
comma
l_int|0x4f6c
comma
l_int|0x7df7
comma
l_int|0x6c7e
comma
l_int|0xa50a
comma
l_int|0xb483
comma
l_int|0x8618
comma
l_int|0x9791
comma
l_int|0xe32e
comma
l_int|0xf2a7
comma
l_int|0xc03c
comma
l_int|0xd1b5
comma
l_int|0x2942
comma
l_int|0x38cb
comma
l_int|0x0a50
comma
l_int|0x1bd9
comma
l_int|0x6f66
comma
l_int|0x7eef
comma
l_int|0x4c74
comma
l_int|0x5dfd
comma
l_int|0xb58b
comma
l_int|0xa402
comma
l_int|0x9699
comma
l_int|0x8710
comma
l_int|0xf3af
comma
l_int|0xe226
comma
l_int|0xd0bd
comma
l_int|0xc134
comma
l_int|0x39c3
comma
l_int|0x284a
comma
l_int|0x1ad1
comma
l_int|0x0b58
comma
l_int|0x7fe7
comma
l_int|0x6e6e
comma
l_int|0x5cf5
comma
l_int|0x4d7c
comma
l_int|0xc60c
comma
l_int|0xd785
comma
l_int|0xe51e
comma
l_int|0xf497
comma
l_int|0x8028
comma
l_int|0x91a1
comma
l_int|0xa33a
comma
l_int|0xb2b3
comma
l_int|0x4a44
comma
l_int|0x5bcd
comma
l_int|0x6956
comma
l_int|0x78df
comma
l_int|0x0c60
comma
l_int|0x1de9
comma
l_int|0x2f72
comma
l_int|0x3efb
comma
l_int|0xd68d
comma
l_int|0xc704
comma
l_int|0xf59f
comma
l_int|0xe416
comma
l_int|0x90a9
comma
l_int|0x8120
comma
l_int|0xb3bb
comma
l_int|0xa232
comma
l_int|0x5ac5
comma
l_int|0x4b4c
comma
l_int|0x79d7
comma
l_int|0x685e
comma
l_int|0x1ce1
comma
l_int|0x0d68
comma
l_int|0x3ff3
comma
l_int|0x2e7a
comma
l_int|0xe70e
comma
l_int|0xf687
comma
l_int|0xc41c
comma
l_int|0xd595
comma
l_int|0xa12a
comma
l_int|0xb0a3
comma
l_int|0x8238
comma
l_int|0x93b1
comma
l_int|0x6b46
comma
l_int|0x7acf
comma
l_int|0x4854
comma
l_int|0x59dd
comma
l_int|0x2d62
comma
l_int|0x3ceb
comma
l_int|0x0e70
comma
l_int|0x1ff9
comma
l_int|0xf78f
comma
l_int|0xe606
comma
l_int|0xd49d
comma
l_int|0xc514
comma
l_int|0xb1ab
comma
l_int|0xa022
comma
l_int|0x92b9
comma
l_int|0x8330
comma
l_int|0x7bc7
comma
l_int|0x6a4e
comma
l_int|0x58d5
comma
l_int|0x495c
comma
l_int|0x3de3
comma
l_int|0x2c6a
comma
l_int|0x1ef1
comma
l_int|0x0f78
)brace
suffix:semicolon
r_void
DECL|function|NETjet_WriteICfifo
id|NETjet_WriteICfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|cs-&gt;hw.njet.auxd
op_and_assign
l_int|0xfc
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.auxa
comma
id|cs-&gt;hw.njet.auxd
)paren
suffix:semicolon
id|outsb
c_func
(paren
id|cs-&gt;hw.njet.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|fill_mem
r_void
id|fill_mem
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
op_star
id|pos
comma
id|u_int
id|cnt
comma
r_int
id|chan
comma
id|u_char
id|fill
)paren
(brace
id|u_int
id|mask
op_assign
l_int|0x000000ff
comma
id|val
op_assign
l_int|0
comma
op_star
id|p
op_assign
id|pos
suffix:semicolon
id|u_int
id|i
suffix:semicolon
id|val
op_or_assign
id|fill
suffix:semicolon
r_if
c_cond
(paren
id|chan
)paren
(brace
id|val
op_lshift_assign
l_int|8
suffix:semicolon
id|mask
op_lshift_assign
l_int|8
suffix:semicolon
)brace
id|mask
op_xor_assign
l_int|0xffffffff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|p
op_and_assign
id|mask
suffix:semicolon
op_star
id|p
op_increment
op_or_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
)brace
)brace
r_void
DECL|function|mode_tiger
id|mode_tiger
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bc
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;Tiger mode %d bchan %d/%d&quot;
comma
id|mode
comma
id|bc
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
(paren
id|L1_MODE_NULL
)paren
suffix:colon
id|fill_mem
c_func
(paren
id|bcs
comma
id|bcs-&gt;hw.tiger.send
comma
id|NETJET_DMA_TXSIZE
comma
id|bc
comma
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;Tiger stat rec %d/%d send %d&quot;
comma
id|bcs-&gt;hw.tiger.r_tot
comma
id|bcs-&gt;hw.tiger.r_err
comma
id|bcs-&gt;hw.tiger.s_tot
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_eq
id|L1_MODE_NULL
)paren
op_logical_and
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_eq
id|L1_MODE_NULL
)paren
)paren
(brace
id|cs-&gt;hw.njet.dmactrl
op_assign
l_int|0
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMACTRL
comma
id|cs-&gt;hw.njet.dmactrl
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQMASK0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_TRANS
)paren
suffix:colon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_HDLC_56K
)paren
suffix:colon
r_case
(paren
id|L1_MODE_HDLC
)paren
suffix:colon
id|fill_mem
c_func
(paren
id|bcs
comma
id|bcs-&gt;hw.tiger.send
comma
id|NETJET_DMA_TXSIZE
comma
id|bc
comma
l_int|0xff
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.r_state
op_assign
id|HDLC_ZERO_SEARCH
suffix:semicolon
id|bcs-&gt;hw.tiger.r_tot
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.tiger.r_bitcnt
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.tiger.r_one
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.tiger.r_err
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.tiger.s_tot
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;hw.njet.dmactrl
)paren
(brace
id|fill_mem
c_func
(paren
id|bcs
comma
id|bcs-&gt;hw.tiger.send
comma
id|NETJET_DMA_TXSIZE
comma
op_logical_neg
id|bc
comma
l_int|0xff
)paren
suffix:semicolon
id|cs-&gt;hw.njet.dmactrl
op_assign
l_int|1
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMACTRL
comma
id|cs-&gt;hw.njet.dmactrl
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQMASK0
comma
l_int|0x0f
)paren
suffix:semicolon
multiline_comment|/* was 0x3f now 0x0f for TJ300 and TJ320  GE 13/07/00 */
)brace
id|bcs-&gt;hw.tiger.sendp
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
id|bcs-&gt;hw.tiger.free
op_assign
id|NETJET_DMA_TXSIZE
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_EMPTY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger: set %x %x %x  %x/%x  pulse=%d&quot;
comma
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMACTRL
)paren
comma
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQMASK0
)paren
comma
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQSTAT0
)paren
comma
id|inl
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_ADR
)paren
comma
id|inl
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_WRITE_ADR
)paren
comma
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_PULSE_CNT
)paren
)paren
suffix:semicolon
)brace
DECL|function|printframe
r_static
r_void
id|printframe
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|buf
comma
r_int
id|count
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
r_int
id|i
op_assign
id|count
comma
id|j
suffix:semicolon
id|u_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;tiger %s(%4d)&quot;
comma
id|s
comma
id|count
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|16
)paren
id|j
op_assign
l_int|16
suffix:semicolon
r_else
id|j
op_assign
id|i
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|p
comma
id|j
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|tmp
)paren
suffix:semicolon
id|p
op_add_assign
id|j
suffix:semicolon
id|i
op_sub_assign
id|j
suffix:semicolon
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;tiger %s      &quot;
comma
id|s
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// macro for 64k
DECL|macro|MAKE_RAW_BYTE
mdefine_line|#define MAKE_RAW_BYTE for (j=0; j&lt;8; j++) { &bslash;&n;&t;&t;&t;bitcnt++;&bslash;&n;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;if (val &amp; 1) {&bslash;&n;&t;&t;&t;&t;s_one++;&bslash;&n;&t;&t;&t;&t;s_val |= 0x80;&bslash;&n;&t;&t;&t;} else {&bslash;&n;&t;&t;&t;&t;s_one = 0;&bslash;&n;&t;&t;&t;&t;s_val &amp;= 0x7f;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (bitcnt==8) {&bslash;&n;&t;&t;&t;&t;bcs-&gt;hw.tiger.sendbuf[s_cnt++] = s_val;&bslash;&n;&t;&t;&t;&t;bitcnt = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (s_one == 5) {&bslash;&n;&t;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;&t;s_val &amp;= 0x7f;&bslash;&n;&t;&t;&t;&t;bitcnt++;&bslash;&n;&t;&t;&t;&t;s_one = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (bitcnt==8) {&bslash;&n;&t;&t;&t;&t;bcs-&gt;hw.tiger.sendbuf[s_cnt++] = s_val;&bslash;&n;&t;&t;&t;&t;bitcnt = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;val &gt;&gt;= 1;&bslash;&n;&t;&t;}
DECL|function|make_raw_data
r_static
r_int
id|make_raw_data
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
singleline_comment|// this make_raw is for 64k
r_register
id|u_int
id|i
comma
id|s_cnt
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|j
suffix:semicolon
r_register
id|u_char
id|val
suffix:semicolon
r_register
id|u_char
id|s_one
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|s_val
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|bitcnt
op_assign
l_int|0
suffix:semicolon
id|u_int
id|fcs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger make_raw: NULL skb&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|HDLC_FLAG_VALUE
suffix:semicolon
id|fcs
op_assign
id|PPP_INITFCS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|bcs-&gt;tx_skb-&gt;data
(braket
id|i
)braket
suffix:semicolon
id|fcs
op_assign
id|PPP_FCS
(paren
id|fcs
comma
id|val
)paren
suffix:semicolon
id|MAKE_RAW_BYTE
suffix:semicolon
)brace
id|fcs
op_xor_assign
l_int|0xffff
suffix:semicolon
id|val
op_assign
id|fcs
op_amp
l_int|0xff
suffix:semicolon
id|MAKE_RAW_BYTE
suffix:semicolon
id|val
op_assign
(paren
id|fcs
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|MAKE_RAW_BYTE
suffix:semicolon
id|val
op_assign
id|HDLC_FLAG_VALUE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bitcnt
op_increment
suffix:semicolon
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|s_val
op_and_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
op_eq
l_int|8
)paren
(brace
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|s_val
suffix:semicolon
id|bitcnt
op_assign
l_int|0
suffix:semicolon
)brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger make_raw: in %ld out %d.%d&quot;
comma
id|bcs-&gt;tx_skb-&gt;len
comma
id|s_cnt
comma
id|bitcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
)paren
(brace
r_while
c_loop
(paren
l_int|8
OG
id|bitcnt
op_increment
)paren
(brace
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|s_val
suffix:semicolon
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
l_int|0xff
suffix:semicolon
singleline_comment|// NJ&lt;-&gt;NJ thoughput bug fix
)brace
id|bcs-&gt;hw.tiger.sendcnt
op_assign
id|s_cnt
suffix:semicolon
id|bcs-&gt;tx_cnt
op_sub_assign
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
id|bcs-&gt;hw.tiger.sp
op_assign
id|bcs-&gt;hw.tiger.sendbuf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|// macro for 56k
DECL|macro|MAKE_RAW_BYTE_56K
mdefine_line|#define MAKE_RAW_BYTE_56K for (j=0; j&lt;8; j++) { &bslash;&n;&t;&t;&t;bitcnt++;&bslash;&n;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;if (val &amp; 1) {&bslash;&n;&t;&t;&t;&t;s_one++;&bslash;&n;&t;&t;&t;&t;s_val |= 0x80;&bslash;&n;&t;&t;&t;} else {&bslash;&n;&t;&t;&t;&t;s_one = 0;&bslash;&n;&t;&t;&t;&t;s_val &amp;= 0x7f;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (bitcnt==7) {&bslash;&n;&t;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;&t;s_val |= 0x80;&bslash;&n;&t;&t;&t;&t;bcs-&gt;hw.tiger.sendbuf[s_cnt++] = s_val;&bslash;&n;&t;&t;&t;&t;bitcnt = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (s_one == 5) {&bslash;&n;&t;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;&t;s_val &amp;= 0x7f;&bslash;&n;&t;&t;&t;&t;bitcnt++;&bslash;&n;&t;&t;&t;&t;s_one = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;if (bitcnt==7) {&bslash;&n;&t;&t;&t;&t;s_val &gt;&gt;= 1;&bslash;&n;&t;&t;&t;&t;s_val |= 0x80;&bslash;&n;&t;&t;&t;&t;bcs-&gt;hw.tiger.sendbuf[s_cnt++] = s_val;&bslash;&n;&t;&t;&t;&t;bitcnt = 0;&bslash;&n;&t;&t;&t;}&bslash;&n;&t;&t;&t;val &gt;&gt;= 1;&bslash;&n;&t;&t;}
DECL|function|make_raw_data_56k
r_static
r_int
id|make_raw_data_56k
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
singleline_comment|// this make_raw is for 56k
r_register
id|u_int
id|i
comma
id|s_cnt
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|j
suffix:semicolon
r_register
id|u_char
id|val
suffix:semicolon
r_register
id|u_char
id|s_one
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|s_val
op_assign
l_int|0
suffix:semicolon
r_register
id|u_char
id|bitcnt
op_assign
l_int|0
suffix:semicolon
id|u_int
id|fcs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger make_raw_56k: NULL skb&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|val
op_assign
id|HDLC_FLAG_VALUE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bitcnt
op_increment
suffix:semicolon
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|s_val
op_and_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
op_eq
l_int|7
)paren
(brace
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|s_val
suffix:semicolon
id|bitcnt
op_assign
l_int|0
suffix:semicolon
)brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
)brace
suffix:semicolon
id|fcs
op_assign
id|PPP_INITFCS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|bcs-&gt;tx_skb-&gt;data
(braket
id|i
)braket
suffix:semicolon
id|fcs
op_assign
id|PPP_FCS
(paren
id|fcs
comma
id|val
)paren
suffix:semicolon
id|MAKE_RAW_BYTE_56K
suffix:semicolon
)brace
id|fcs
op_xor_assign
l_int|0xffff
suffix:semicolon
id|val
op_assign
id|fcs
op_amp
l_int|0xff
suffix:semicolon
id|MAKE_RAW_BYTE_56K
suffix:semicolon
id|val
op_assign
(paren
id|fcs
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|MAKE_RAW_BYTE_56K
suffix:semicolon
id|val
op_assign
id|HDLC_FLAG_VALUE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bitcnt
op_increment
suffix:semicolon
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|s_val
op_and_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
op_eq
l_int|7
)paren
(brace
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|s_val
suffix:semicolon
id|bitcnt
op_assign
l_int|0
suffix:semicolon
)brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger make_raw_56k: in %ld out %d.%d&quot;
comma
id|bcs-&gt;tx_skb-&gt;len
comma
id|s_cnt
comma
id|bitcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
)paren
(brace
r_while
c_loop
(paren
l_int|8
OG
id|bitcnt
op_increment
)paren
(brace
id|s_val
op_rshift_assign
l_int|1
suffix:semicolon
id|s_val
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
id|s_val
suffix:semicolon
id|bcs-&gt;hw.tiger.sendbuf
(braket
id|s_cnt
op_increment
)braket
op_assign
l_int|0xff
suffix:semicolon
singleline_comment|// NJ&lt;-&gt;NJ thoughput bug fix
)brace
id|bcs-&gt;hw.tiger.sendcnt
op_assign
id|s_cnt
suffix:semicolon
id|bcs-&gt;tx_cnt
op_sub_assign
id|bcs-&gt;tx_skb-&gt;len
suffix:semicolon
id|bcs-&gt;hw.tiger.sp
op_assign
id|bcs-&gt;hw.tiger.sendbuf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|got_frame
r_static
r_void
id|got_frame
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|count
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|count
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;TIGER: receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|bcs-&gt;hw.tiger.rcvbuf
comma
id|count
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
)brace
id|bcs-&gt;event
op_or_assign
l_int|1
op_lshift
id|B_RCVBUFREADY
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|bcs-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_RECEIVE_FRAME
)paren
id|printframe
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;hw.tiger.rcvbuf
comma
id|count
comma
l_string|&quot;rec&quot;
)paren
suffix:semicolon
)brace
DECL|function|read_raw
r_static
r_void
(def_block
id|read_raw
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
op_star
id|buf
comma
r_int
id|cnt
)paren
(brace
r_int
id|i
suffix:semicolon
r_register
id|u_char
id|j
suffix:semicolon
r_register
id|u_char
id|val
suffix:semicolon
id|u_int
op_star
id|pend
op_assign
id|bcs-&gt;hw.tiger.rec
op_plus
id|NETJET_DMA_RXSIZE
op_minus
l_int|1
suffix:semicolon
r_register
id|u_char
id|state
op_assign
id|bcs-&gt;hw.tiger.r_state
suffix:semicolon
r_register
id|u_char
id|r_one
op_assign
id|bcs-&gt;hw.tiger.r_one
suffix:semicolon
r_register
id|u_char
id|r_val
op_assign
id|bcs-&gt;hw.tiger.r_val
suffix:semicolon
r_register
id|u_int
id|bitcnt
op_assign
id|bcs-&gt;hw.tiger.r_bitcnt
suffix:semicolon
id|u_int
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|bits
suffix:semicolon
id|u_char
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_HDLC
)paren
(brace
singleline_comment|// it&squot;s 64k
id|mask
op_assign
l_int|0xff
suffix:semicolon
id|bits
op_assign
l_int|8
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// it&squot;s 56K
id|mask
op_assign
l_int|0x7f
suffix:semicolon
id|bits
op_assign
l_int|7
suffix:semicolon
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|bcs-&gt;channel
ques
c_cond
(paren
(paren
op_star
id|p
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:colon
(paren
op_star
id|p
op_amp
l_int|0xff
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|pend
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.rec
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|mask
)paren
op_eq
id|mask
)paren
(brace
id|state
op_assign
id|HDLC_ZERO_SEARCH
suffix:semicolon
id|bcs-&gt;hw.tiger.r_tot
op_increment
suffix:semicolon
id|bitcnt
op_assign
l_int|0
suffix:semicolon
id|r_one
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|bits
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|state
op_eq
id|HDLC_ZERO_SEARCH
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
(brace
id|r_one
op_increment
suffix:semicolon
)brace
r_else
(brace
id|r_one
op_assign
l_int|0
suffix:semicolon
id|state
op_assign
id|HDLC_FLAG_SEARCH
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger read_raw: zBit(%d,%d,%d) %x&quot;
comma
id|bcs-&gt;hw.tiger.r_tot
comma
id|i
comma
id|j
comma
id|val
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|state
op_eq
id|HDLC_FLAG_SEARCH
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
(brace
id|r_one
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|r_one
OG
l_int|6
)paren
(brace
id|state
op_assign
id|HDLC_ZERO_SEARCH
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|r_one
op_eq
l_int|6
)paren
(brace
id|bitcnt
op_assign
l_int|0
suffix:semicolon
id|r_val
op_assign
l_int|0
suffix:semicolon
id|state
op_assign
id|HDLC_FLAG_FOUND
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger read_raw: flag(%d,%d,%d) %x&quot;
comma
id|bcs-&gt;hw.tiger.r_tot
comma
id|i
comma
id|j
comma
id|val
)paren
suffix:semicolon
)brace
id|r_one
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|state
op_eq
id|HDLC_FLAG_FOUND
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
(brace
id|r_one
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|r_one
OG
l_int|6
)paren
(brace
id|state
op_assign
id|HDLC_ZERO_SEARCH
suffix:semicolon
)brace
r_else
(brace
id|r_val
op_rshift_assign
l_int|1
suffix:semicolon
id|r_val
op_or_assign
l_int|0x80
suffix:semicolon
id|bitcnt
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|r_one
op_eq
l_int|6
)paren
(brace
id|bitcnt
op_assign
l_int|0
suffix:semicolon
id|r_val
op_assign
l_int|0
suffix:semicolon
id|r_one
op_assign
l_int|0
suffix:semicolon
id|val
op_rshift_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|r_one
op_ne
l_int|5
)paren
(brace
id|r_val
op_rshift_assign
l_int|1
suffix:semicolon
id|r_val
op_and_assign
l_int|0x7f
suffix:semicolon
id|bitcnt
op_increment
suffix:semicolon
)brace
id|r_one
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|state
op_ne
id|HDLC_ZERO_SEARCH
)paren
op_logical_and
op_logical_neg
(paren
id|bitcnt
op_amp
l_int|7
)paren
)paren
(brace
id|state
op_assign
id|HDLC_FRAME_FOUND
suffix:semicolon
id|bcs-&gt;hw.tiger.r_fcs
op_assign
id|PPP_INITFCS
suffix:semicolon
id|bcs-&gt;hw.tiger.rcvbuf
(braket
l_int|0
)braket
op_assign
id|r_val
suffix:semicolon
id|bcs-&gt;hw.tiger.r_fcs
op_assign
id|PPP_FCS
(paren
id|bcs-&gt;hw.tiger.r_fcs
comma
id|r_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger read_raw: byte1(%d,%d,%d) rval %x val %x i %x&quot;
comma
id|bcs-&gt;hw.tiger.r_tot
comma
id|i
comma
id|j
comma
id|r_val
comma
id|val
comma
id|bcs-&gt;cs-&gt;hw.njet.irqstat0
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|state
op_eq
id|HDLC_FRAME_FOUND
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
(brace
id|r_one
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|r_one
OG
l_int|6
)paren
(brace
id|state
op_assign
id|HDLC_ZERO_SEARCH
suffix:semicolon
id|bitcnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|r_val
op_rshift_assign
l_int|1
suffix:semicolon
id|r_val
op_or_assign
l_int|0x80
suffix:semicolon
id|bitcnt
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|r_one
op_eq
l_int|6
)paren
(brace
id|r_val
op_assign
l_int|0
suffix:semicolon
id|r_one
op_assign
l_int|0
suffix:semicolon
id|bitcnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|bitcnt
op_amp
l_int|7
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger: frame not byte aligned&quot;
)paren
suffix:semicolon
id|state
op_assign
id|HDLC_FLAG_SEARCH
suffix:semicolon
id|bcs-&gt;hw.tiger.r_err
op_increment
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
id|bcs-&gt;err_inv
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger frame end(%d,%d): fcs(%x) i %x&quot;
comma
id|i
comma
id|j
comma
id|bcs-&gt;hw.tiger.r_fcs
comma
id|bcs-&gt;cs-&gt;hw.njet.irqstat0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.tiger.r_fcs
op_eq
id|PPP_GOODFCS
)paren
(brace
id|got_frame
c_func
(paren
id|bcs
comma
(paren
id|bitcnt
op_rshift
l_int|3
)paren
op_minus
l_int|3
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger FCS error&quot;
)paren
suffix:semicolon
id|printframe
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;hw.tiger.rcvbuf
comma
(paren
id|bitcnt
op_rshift
l_int|3
)paren
op_minus
l_int|1
comma
l_string|&quot;rec&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.r_err
op_increment
suffix:semicolon
)brace
macro_line|#ifdef ERROR_STATISTIC
id|bcs-&gt;err_crc
op_increment
suffix:semicolon
macro_line|#endif
)brace
id|state
op_assign
id|HDLC_FLAG_FOUND
suffix:semicolon
)brace
id|bitcnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|r_one
op_eq
l_int|5
)paren
(brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
id|r_one
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|r_val
op_rshift_assign
l_int|1
suffix:semicolon
id|r_val
op_and_assign
l_int|0x7f
suffix:semicolon
id|bitcnt
op_increment
suffix:semicolon
)brace
id|r_one
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|state
op_eq
id|HDLC_FRAME_FOUND
)paren
op_logical_and
op_logical_neg
(paren
id|bitcnt
op_amp
l_int|7
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|bitcnt
op_rshift
l_int|3
)paren
op_ge
id|HSCX_BUFMAX
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger: frame too big&quot;
)paren
suffix:semicolon
id|r_val
op_assign
l_int|0
suffix:semicolon
id|state
op_assign
id|HDLC_FLAG_SEARCH
suffix:semicolon
id|bcs-&gt;hw.tiger.r_err
op_increment
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
id|bcs-&gt;err_inv
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|bcs-&gt;hw.tiger.rcvbuf
(braket
(paren
id|bitcnt
op_rshift
l_int|3
)paren
op_minus
l_int|1
)braket
op_assign
id|r_val
suffix:semicolon
id|bcs-&gt;hw.tiger.r_fcs
op_assign
id|PPP_FCS
(paren
id|bcs-&gt;hw.tiger.r_fcs
comma
id|r_val
)paren
suffix:semicolon
)brace
)brace
)brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.r_tot
op_increment
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.r_state
op_assign
id|state
suffix:semicolon
id|bcs-&gt;hw.tiger.r_one
op_assign
id|r_one
suffix:semicolon
id|bcs-&gt;hw.tiger.r_val
op_assign
id|r_val
suffix:semicolon
id|bcs-&gt;hw.tiger.r_bitcnt
op_assign
id|bitcnt
suffix:semicolon
)brace
)def_block
DECL|function|read_tiger
r_void
id|read_tiger
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
op_star
id|p
suffix:semicolon
r_int
id|cnt
op_assign
id|NETJET_DMA_RXSIZE
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|cs-&gt;hw.njet.last_is0
)paren
op_amp
id|NETJET_IRQM0_READ
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger warn read double dma %x/%x&quot;
comma
id|cs-&gt;hw.njet.irqstat0
comma
id|cs-&gt;hw.njet.last_is0
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
)paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|err_rdo
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
)paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|err_rdo
op_increment
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
r_else
(brace
id|cs-&gt;hw.njet.last_is0
op_and_assign
op_complement
id|NETJET_IRQM0_READ
suffix:semicolon
id|cs-&gt;hw.njet.last_is0
op_or_assign
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|NETJET_IRQM0_READ
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|NETJET_IRQM0_READ_1
)paren
id|p
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_plus
id|NETJET_DMA_RXSIZE
op_minus
l_int|1
suffix:semicolon
r_else
id|p
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_plus
id|cnt
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC
)paren
op_logical_or
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC_56K
)paren
)paren
id|read_raw
c_func
(paren
id|cs-&gt;bcs
comma
id|p
comma
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC
)paren
op_logical_or
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC_56K
)paren
)paren
id|read_raw
c_func
(paren
id|cs-&gt;bcs
op_plus
l_int|1
comma
id|p
comma
id|cnt
)paren
suffix:semicolon
id|cs-&gt;hw.njet.irqstat0
op_and_assign
op_complement
id|NETJET_IRQM0_READ
suffix:semicolon
)brace
r_static
r_void
id|write_raw
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
op_star
id|buf
comma
r_int
id|cnt
)paren
suffix:semicolon
DECL|function|netjet_fill_dma
r_void
id|netjet_fill_dma
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_register
id|u_int
op_star
id|p
comma
op_star
id|sp
suffix:semicolon
r_register
r_int
id|cnt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger fill_dma1: c%d %4x&quot;
comma
id|bcs-&gt;channel
comma
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_HDLC
)paren
(brace
singleline_comment|// it&squot;s 64k
r_if
c_cond
(paren
id|make_raw_data
c_func
(paren
id|bcs
)paren
)paren
r_return
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// it&squot;s 56k
r_if
c_cond
(paren
id|make_raw_data_56k
c_func
(paren
id|bcs
)paren
)paren
r_return
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger fill_dma2: c%d %4x&quot;
comma
id|bcs-&gt;channel
comma
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_NOFRAME
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|write_raw
c_func
(paren
id|bcs
comma
id|bcs-&gt;hw.tiger.sendp
comma
id|bcs-&gt;hw.tiger.free
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_HALF
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|p
op_assign
id|bus_to_virt
c_func
(paren
id|inl
c_func
(paren
id|bcs-&gt;cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_ADR
)paren
)paren
suffix:semicolon
id|sp
op_assign
id|bcs-&gt;hw.tiger.sendp
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sp
op_eq
id|bcs-&gt;hw.tiger.s_end
)paren
id|sp
op_assign
id|bcs-&gt;hw.tiger.send
op_minus
l_int|1
suffix:semicolon
id|cnt
op_assign
id|p
op_minus
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|0
)paren
(brace
id|write_raw
c_func
(paren
id|bcs
comma
id|bcs-&gt;hw.tiger.sendp
comma
id|bcs-&gt;hw.tiger.free
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_increment
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
id|p
op_increment
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
id|write_raw
c_func
(paren
id|bcs
comma
id|p
comma
id|bcs-&gt;hw.tiger.free
op_minus
id|cnt
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_EMPTY
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|p
op_assign
id|bus_to_virt
c_func
(paren
id|inl
c_func
(paren
id|bcs-&gt;cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_ADR
)paren
)paren
suffix:semicolon
id|cnt
op_assign
id|bcs-&gt;hw.tiger.s_end
op_minus
id|p
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|2
)paren
(brace
id|p
op_assign
id|bcs-&gt;hw.tiger.send
op_plus
l_int|1
suffix:semicolon
id|cnt
op_assign
id|NETJET_DMA_TXSIZE
op_div
l_int|2
op_minus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|p
op_increment
suffix:semicolon
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
(paren
id|NETJET_DMA_TXSIZE
op_div
l_int|2
)paren
)paren
id|cnt
op_add_assign
id|NETJET_DMA_TXSIZE
op_div
l_int|2
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
)brace
id|write_raw
c_func
(paren
id|bcs
comma
id|p
comma
id|cnt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger fill_dma3: c%d %4x&quot;
comma
id|bcs-&gt;channel
comma
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
DECL|function|write_raw
r_static
r_void
id|write_raw
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
op_star
id|buf
comma
r_int
id|cnt
)paren
(brace
id|u_int
id|mask
comma
id|val
comma
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|u_int
id|i
comma
id|s_cnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.tiger.sendcnt
OG
id|cnt
)paren
(brace
id|s_cnt
op_assign
id|cnt
suffix:semicolon
id|bcs-&gt;hw.tiger.sendcnt
op_sub_assign
id|cnt
suffix:semicolon
)brace
r_else
(brace
id|s_cnt
op_assign
id|bcs-&gt;hw.tiger.sendcnt
suffix:semicolon
id|bcs-&gt;hw.tiger.sendcnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;channel
)paren
id|mask
op_assign
l_int|0xffff00ff
suffix:semicolon
r_else
id|mask
op_assign
l_int|0xffffff00
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|s_cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|bcs-&gt;channel
ques
c_cond
(paren
(paren
id|bcs-&gt;hw.tiger.sp
(braket
id|i
)braket
op_lshift
l_int|8
)paren
op_amp
l_int|0xff00
)paren
suffix:colon
(paren
id|bcs-&gt;hw.tiger.sp
(braket
id|i
)braket
)paren
suffix:semicolon
op_star
id|p
op_and_assign
id|mask
suffix:semicolon
op_star
id|p
op_increment
op_or_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
)brace
id|bcs-&gt;hw.tiger.s_tot
op_add_assign
id|s_cnt
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger write_raw: c%d %x-%x %d/%d %d %x&quot;
comma
id|bcs-&gt;channel
comma
(paren
id|u_int
)paren
id|buf
comma
(paren
id|u_int
)paren
id|p
comma
id|s_cnt
comma
id|cnt
comma
id|bcs-&gt;hw.tiger.sendcnt
comma
id|bcs-&gt;cs-&gt;hw.njet.irqstat0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX_FIFO
)paren
id|printframe
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;hw.tiger.sp
comma
id|s_cnt
comma
l_string|&quot;snd&quot;
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.sp
op_add_assign
id|s_cnt
suffix:semicolon
id|bcs-&gt;hw.tiger.sendp
op_assign
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;hw.tiger.sendcnt
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
(brace
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger write_raw: NULL skb s_cnt %d&quot;
comma
id|s_cnt
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;st-&gt;lli.l1writewakeup
op_logical_and
(paren
id|PACKET_NOACK
op_ne
id|bcs-&gt;tx_skb-&gt;pkt_type
)paren
)paren
id|bcs-&gt;st-&gt;lli
dot
id|l1writewakeup
c_func
(paren
id|bcs-&gt;st
comma
id|bcs-&gt;tx_skb-&gt;len
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.free
op_assign
id|cnt
op_minus
id|s_cnt
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;hw.tiger.free
OG
(paren
id|NETJET_DMA_TXSIZE
op_div
l_int|2
)paren
)paren
id|test_and_set_bit
c_func
(paren
id|BC_FLG_HALF
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
r_else
(brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_HALF
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_NOFRAME
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bcs-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|netjet_fill_dma
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
id|mask
op_xor_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|s_cnt
OL
id|cnt
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|s_cnt
suffix:semicolon
id|i
OL
id|cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|p
op_increment
op_or_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|bcs-&gt;hw.tiger.s_end
)paren
id|p
op_assign
id|bcs-&gt;hw.tiger.send
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger write_raw: fill rest %d&quot;
comma
id|cnt
op_minus
id|s_cnt
)paren
suffix:semicolon
)brace
id|bcs-&gt;event
op_or_assign
l_int|1
op_lshift
id|B_XMTBUFREADY
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|bcs-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_NOFRAME
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_HALF
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|fill_mem
c_func
(paren
id|bcs
comma
id|buf
comma
id|cnt
comma
id|bcs-&gt;channel
comma
l_int|0xff
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.free
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger write_raw: fill half&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_HALF
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_EMPTY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|fill_mem
c_func
(paren
id|bcs
comma
id|buf
comma
id|cnt
comma
id|bcs-&gt;channel
comma
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;tiger write_raw: fill full&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|write_tiger
r_void
id|write_tiger
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
op_star
id|p
comma
id|cnt
op_assign
id|NETJET_DMA_TXSIZE
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|cs-&gt;hw.njet.last_is0
)paren
op_amp
id|NETJET_IRQM0_WRITE
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger warn write double dma %x/%x&quot;
comma
id|cs-&gt;hw.njet.irqstat0
comma
id|cs-&gt;hw.njet.last_is0
)paren
suffix:semicolon
macro_line|#ifdef ERROR_STATISTIC
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
)paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|err_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
)paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|err_tx
op_increment
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
r_else
(brace
id|cs-&gt;hw.njet.last_is0
op_and_assign
op_complement
id|NETJET_IRQM0_WRITE
suffix:semicolon
id|cs-&gt;hw.njet.last_is0
op_or_assign
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|NETJET_IRQM0_WRITE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;hw.njet.irqstat0
op_amp
id|NETJET_IRQM0_WRITE_1
)paren
id|p
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_plus
id|NETJET_DMA_TXSIZE
op_minus
l_int|1
suffix:semicolon
r_else
id|p
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_plus
id|cnt
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC
)paren
op_logical_or
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC_56K
)paren
)paren
id|write_raw
c_func
(paren
id|cs-&gt;bcs
comma
id|p
comma
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC
)paren
op_logical_or
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_eq
id|L1_MODE_HDLC_56K
)paren
)paren
id|write_raw
c_func
(paren
id|cs-&gt;bcs
op_plus
l_int|1
comma
id|p
comma
id|cnt
)paren
suffix:semicolon
id|cs-&gt;hw.njet.irqstat0
op_and_assign
op_complement
id|NETJET_IRQM0_WRITE
suffix:semicolon
)brace
r_static
r_void
DECL|function|tiger_l2l1
id|tiger_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|st-&gt;l1.bcs-&gt;squeue
comma
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;tiger_l2l1: this shouldn&squot;t happen&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs
op_member_access_from_pointer
id|BC_Send_Data
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_PULL
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|test_and_set_bit
c_func
(paren
id|FLG_L1_PULL_REQ
comma
op_amp
id|st-&gt;l1.Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|mode_tiger
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|mode_tiger
c_func
(paren
id|st-&gt;l1.bcs
comma
l_int|0
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|close_tigerstate
id|close_tigerstate
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|mode_tiger
c_func
(paren
id|bcs
comma
l_int|0
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.tiger.rcvbuf
)paren
(brace
id|kfree
c_func
(paren
id|bcs-&gt;hw.tiger.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;hw.tiger.sendbuf
)paren
(brace
id|kfree
c_func
(paren
id|bcs-&gt;hw.tiger.sendbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.tiger.sendbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|discard_queue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_int
DECL|function|open_tigerstate
id|open_tigerstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;hw.tiger.rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|HSCX_BUFMAX
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for tiger.rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs-&gt;hw.tiger.sendbuf
op_assign
id|kmalloc
c_func
(paren
id|RAW_BUFMAX
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for tiger.sendbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
)brace
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|bcs-&gt;hw.tiger.sendcnt
op_assign
l_int|0
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|bcs-&gt;event
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|setstack_tiger
id|setstack_tiger
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
r_if
c_cond
(paren
id|open_tigerstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|tiger_l2l1
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|inittiger
id|inittiger
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_assign
id|kmalloc
c_func
(paren
id|NETJET_DMA_TXSIZE
op_star
r_sizeof
(paren
r_int
r_int
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for tiger.send&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_irq
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_plus
id|NETJET_DMA_TXSIZE
op_div
l_int|2
op_minus
l_int|1
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_end
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_plus
id|NETJET_DMA_TXSIZE
op_minus
l_int|1
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.send
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.s_irq
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_irq
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.s_end
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_end
suffix:semicolon
id|memset
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
comma
l_int|0xff
comma
id|NETJET_DMA_TXSIZE
op_star
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger: send buf %x - %x&quot;
comma
(paren
id|u_int
)paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
comma
(paren
id|u_int
)paren
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_plus
id|NETJET_DMA_TXSIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_START
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_irq
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_IRQ
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.s_end
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_END
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_assign
id|kmalloc
c_func
(paren
id|NETJET_DMA_RXSIZE
op_star
r_sizeof
(paren
r_int
r_int
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: No memory for tiger.rec&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger: rec buf %x - %x&quot;
comma
(paren
id|u_int
)paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
comma
(paren
id|u_int
)paren
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_plus
id|NETJET_DMA_RXSIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.rec
op_assign
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
suffix:semicolon
id|memset
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
comma
l_int|0xff
comma
id|NETJET_DMA_RXSIZE
op_star
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_WRITE_START
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_plus
id|NETJET_DMA_RXSIZE
op_div
l_int|2
op_minus
l_int|1
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_WRITE_IRQ
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_plus
id|NETJET_DMA_RXSIZE
op_minus
l_int|1
)paren
comma
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_WRITE_END
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;tiger: dmacfg  %x/%x  pulse=%d&quot;
comma
id|inl
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_WRITE_ADR
)paren
comma
id|inl
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_DMA_READ_ADR
)paren
comma
id|bytein
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_PULSE_CNT
)paren
)paren
suffix:semicolon
id|cs-&gt;hw.njet.last_is0
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_SetStack
op_assign
id|setstack_tiger
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_SetStack
op_assign
id|setstack_tiger
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_Close
op_assign
id|close_tigerstate
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_Close
op_assign
id|close_tigerstate
suffix:semicolon
)brace
r_void
DECL|function|releasetiger
id|releasetiger
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
)paren
(brace
id|kfree
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
)paren
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.send
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.send
)paren
(brace
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.send
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
)paren
(brace
id|kfree
c_func
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
)paren
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|hw.tiger.rec
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.rec
)paren
(brace
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|hw.tiger.rec
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_void
DECL|function|release_io_netjet
id|release_io_netjet
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQMASK0
comma
l_int|0
)paren
suffix:semicolon
id|byteout
c_func
(paren
id|cs-&gt;hw.njet.base
op_plus
id|NETJET_IRQMASK1
comma
l_int|0
)paren
suffix:semicolon
id|releasetiger
c_func
(paren
id|cs
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|cs-&gt;hw.njet.base
comma
l_int|256
)paren
suffix:semicolon
)brace
eof
