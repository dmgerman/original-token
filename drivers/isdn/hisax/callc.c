multiline_comment|/* $Id: callc.c,v 1.20 1997/02/17 00:32:47 keil Exp $&n;&n; * Author       Karsten Keil (keil@temic-ech.spacenet.de)&n; *              based on the teles driver from Jan den Ouden&n; *&n; * Thanks to    Jan den Ouden&n; *              Fritz Elfert&n; *&n; * $Log: callc.c,v $&n; * Revision 1.20  1997/02/17 00:32:47  keil&n; * Bugfix: No Busy reported to LL&n; *&n; * Revision 1.19  1997/02/14 12:23:10  fritz&n; * Added support for new insmod parameter handling.&n; *&n; * Revision 1.18  1997/02/11 01:36:58  keil&n; * Changed setup-interface (incoming and outgoing), cause reporting&n; *&n; * Revision 1.17  1997/02/09 00:23:10  keil&n; * new interface handling, one interface per card&n; * some changes in debug and leased line mode&n; *&n; * Revision 1.16  1997/01/27 23:17:03  keil&n; * delete timers while unloading&n; *&n; * Revision 1.15  1997/01/27 16:00:38  keil&n; * D-channel shutdown delay; improved callback&n; *&n; * Revision 1.14  1997/01/21 22:16:39  keil&n; * new statemachine; leased line support; cleanup for 2.0&n; *&n; * Revision 1.13  1996/12/08 19:51:17  keil&n; * bugfixes from Pekka Sarnila&n; *&n; * Revision 1.12  1996/11/26 20:20:03  keil&n; * fixed warning while compile&n; *&n; * Revision 1.11  1996/11/26 18:43:17  keil&n; * change ioctl 555 --&gt; 55 (555 didn&squot;t work)&n; *&n; * Revision 1.10  1996/11/26 18:06:07  keil&n; * fixed missing break statement,ioctl 555 reset modcount&n; *&n; * Revision 1.9  1996/11/18 20:23:19  keil&n; * log writebuf channel not open changed&n; *&n; * Revision 1.8  1996/11/06 17:43:17  keil&n; * more changes for 2.1.X;block fixed ST_PRO_W&n; *&n; * Revision 1.7  1996/11/06 15:13:51  keil&n; * typo 0x64 ---&gt;64 in debug code&n; *&n; * Revision 1.6  1996/11/05 19:40:33  keil&n; * X.75 windowsize&n; *&n; * Revision 1.5  1996/10/30 10:11:06  keil&n; * debugging LOCK changed;ST_REL_W EV_HANGUP added&n; *&n; * Revision 1.4  1996/10/27 22:20:16  keil&n; * alerting bugfixes&n; * no static b-channel&lt;-&gt;channel mapping&n; *&n; * Revision 1.2  1996/10/16 21:29:45  keil&n; * compile bug as &quot;not module&quot;&n; * Callback with euro&n; *&n; * Revision 1.1  1996/10/13 20:04:50  keil&n; * Initial revision&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;hisax.h&quot;
macro_line|#ifdef MODULE
macro_line|#if (LINUX_VERSION_CODE &lt; 0x020111)
r_extern
r_int
id|mod_use_count_
suffix:semicolon
DECL|macro|MOD_USE_COUNT
mdefine_line|#define MOD_USE_COUNT mod_use_count_
macro_line|#else
DECL|macro|MOD_USE_COUNT
mdefine_line|#define MOD_USE_COUNT ((&amp;__this_module)-&gt;usecount)
macro_line|#endif
macro_line|#endif&t;&t;&t;&t;/* MODULE */
DECL|variable|l4_revision
r_const
r_char
op_star
id|l4_revision
op_assign
l_string|&quot;$Revision: 1.20 $&quot;
suffix:semicolon
r_extern
r_struct
id|IsdnCard
id|cards
(braket
)braket
suffix:semicolon
r_extern
r_int
id|nrcards
suffix:semicolon
r_extern
r_void
id|HiSax_mod_dec_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|HiSax_mod_inc_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|init_ds
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|incoming
)paren
suffix:semicolon
r_static
r_void
id|release_ds
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
suffix:semicolon
DECL|variable|callcfsm
r_static
r_struct
id|Fsm
id|callcfsm
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|lcfsm
r_static
r_struct
id|Fsm
id|lcfsm
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|chancount
r_static
r_int
id|chancount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Flags for remembering action done in l4 */
DECL|macro|FLG_START_D
mdefine_line|#define  FLG_START_D&t;0x0001
DECL|macro|FLG_ESTAB_D
mdefine_line|#define  FLG_ESTAB_D&t;0x0002
DECL|macro|FLG_CALL_SEND
mdefine_line|#define  FLG_CALL_SEND&t;0x0004
DECL|macro|FLG_CALL_REC
mdefine_line|#define  FLG_CALL_REC   0x0008
DECL|macro|FLG_CALL_ALERT
mdefine_line|#define  FLG_CALL_ALERT&t;0x0010
DECL|macro|FLG_START_B
mdefine_line|#define  FLG_START_B&t;0x0020
DECL|macro|FLG_CONNECT_B
mdefine_line|#define  FLG_CONNECT_B&t;0x0040
DECL|macro|FLG_LL_DCONN
mdefine_line|#define  FLG_LL_DCONN&t;0x0080
DECL|macro|FLG_LL_BCONN
mdefine_line|#define  FLG_LL_BCONN&t;0x0100
DECL|macro|FLG_DISC_SEND
mdefine_line|#define  FLG_DISC_SEND&t;0x0200
DECL|macro|FLG_DISC_REC
mdefine_line|#define  FLG_DISC_REC&t;0x0400
DECL|macro|FLG_REL_REC
mdefine_line|#define  FLG_REL_REC&t;0x0800
DECL|macro|SETBIT
mdefine_line|#define  SETBIT(flg, item)  flg |= item
DECL|macro|RESBIT
mdefine_line|#define  RESBIT(flg, item)  flg &amp;= (~item)
multiline_comment|/*&n; * Because of callback it&squot;s a good idea to delay the shutdown of the d-channel&n; */
DECL|macro|DREL_TIMER_VALUE
mdefine_line|#define&t;DREL_TIMER_VALUE 30000
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
r_struct
id|IsdnCardState
op_star
DECL|function|hisax_findcard
id|hisax_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp-&gt;myid
op_eq
id|driverid
)paren
r_return
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
suffix:semicolon
r_return
(paren
r_struct
id|IsdnCardState
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|link_debug
id|link_debug
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_char
op_star
id|s
comma
r_int
id|direction
)paren
(brace
r_char
id|tmp
(braket
l_int|100
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s Channel %d %s %s&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|direction
ques
c_cond
l_string|&quot;LL-&gt;HL&quot;
suffix:colon
l_string|&quot;HL-&gt;LL&quot;
comma
id|s
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|chanp-&gt;sp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_enum
(brace
DECL|enumerator|ST_NULL
id|ST_NULL
comma
multiline_comment|/*  0 inactive */
DECL|enumerator|ST_OUT_WAIT_D
id|ST_OUT_WAIT_D
comma
multiline_comment|/*  1 outgoing, awaiting d-channel establishment */
DECL|enumerator|ST_IN_WAIT_D
id|ST_IN_WAIT_D
comma
multiline_comment|/*  2 incoming, awaiting d-channel establishment */
DECL|enumerator|ST_OUT_DIAL
id|ST_OUT_DIAL
comma
multiline_comment|/*  3 outgoing, SETUP send; awaiting confirm */
DECL|enumerator|ST_IN_WAIT_LL
id|ST_IN_WAIT_LL
comma
multiline_comment|/*  4 incoming call received; wait for LL confirm */
DECL|enumerator|ST_IN_ALERT_SEND
id|ST_IN_ALERT_SEND
comma
multiline_comment|/*  5 incoming call received; ALERT send */
DECL|enumerator|ST_IN_WAIT_CONN_ACK
id|ST_IN_WAIT_CONN_ACK
comma
multiline_comment|/*  6 incoming CONNECT send; awaiting CONN_ACK */
DECL|enumerator|ST_WAIT_BCONN
id|ST_WAIT_BCONN
comma
multiline_comment|/*  7 CONNECT/CONN_ACK received, awaiting b-channel prot. estbl. */
DECL|enumerator|ST_ACTIVE
id|ST_ACTIVE
comma
multiline_comment|/*  8 active, b channel prot. established */
DECL|enumerator|ST_WAIT_BRELEASE
id|ST_WAIT_BRELEASE
comma
multiline_comment|/*  9 call clear. (initiator), awaiting b channel prot. rel. */
DECL|enumerator|ST_WAIT_BREL_DISC
id|ST_WAIT_BREL_DISC
comma
multiline_comment|/* 10 call clear. (receiver), DISCONNECT req. received */
DECL|enumerator|ST_WAIT_DCOMMAND
id|ST_WAIT_DCOMMAND
comma
multiline_comment|/* 11 call clear. (receiver), awaiting DCHANNEL message */
DECL|enumerator|ST_WAIT_DRELEASE
id|ST_WAIT_DRELEASE
comma
multiline_comment|/* 12 DISCONNECT sent, awaiting RELEASE */
DECL|enumerator|ST_WAIT_D_REL_CNF
id|ST_WAIT_D_REL_CNF
comma
multiline_comment|/* 13 RELEASE sent, awaiting RELEASE confirm */
DECL|enumerator|ST_WAIT_DSHUTDOWN
id|ST_WAIT_DSHUTDOWN
comma
multiline_comment|/*  14 awaiting d-channel shutdown */
)brace
suffix:semicolon
DECL|macro|STATE_COUNT
mdefine_line|#define STATE_COUNT (ST_WAIT_DSHUTDOWN +1)
DECL|variable|strState
r_static
r_char
op_star
id|strState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_NULL&quot;
comma
l_string|&quot;ST_OUT_WAIT_D&quot;
comma
l_string|&quot;ST_IN_WAIT_D&quot;
comma
l_string|&quot;ST_OUT_DIAL&quot;
comma
l_string|&quot;ST_IN_WAIT_LL&quot;
comma
l_string|&quot;ST_IN_ALERT_SEND&quot;
comma
l_string|&quot;ST_IN_WAIT_CONN_ACK&quot;
comma
l_string|&quot;ST_WAIT_BCONN&quot;
comma
l_string|&quot;ST_ACTIVE&quot;
comma
l_string|&quot;ST_WAIT_BRELEASE&quot;
comma
l_string|&quot;ST_WAIT_BREL_DISC&quot;
comma
l_string|&quot;ST_WAIT_DCOMMAND&quot;
comma
l_string|&quot;ST_WAIT_DRELEASE&quot;
comma
l_string|&quot;ST_WAIT_D_REL_CNF&quot;
comma
l_string|&quot;ST_WAIT_DSHUTDOWN&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_DIAL
id|EV_DIAL
comma
multiline_comment|/*  0 */
DECL|enumerator|EV_SETUP_CNF
id|EV_SETUP_CNF
comma
multiline_comment|/*  1 */
DECL|enumerator|EV_ACCEPTB
id|EV_ACCEPTB
comma
multiline_comment|/*  2 */
DECL|enumerator|EV_DISCONNECT_IND
id|EV_DISCONNECT_IND
comma
multiline_comment|/*  3 */
DECL|enumerator|EV_RELEASE_CNF
id|EV_RELEASE_CNF
comma
multiline_comment|/*  4 */
DECL|enumerator|EV_DLEST
id|EV_DLEST
comma
multiline_comment|/*  5 */
DECL|enumerator|EV_DLRL
id|EV_DLRL
comma
multiline_comment|/*  6 */
DECL|enumerator|EV_SETUP_IND
id|EV_SETUP_IND
comma
multiline_comment|/*  7 */
DECL|enumerator|EV_RELEASE_IND
id|EV_RELEASE_IND
comma
multiline_comment|/*  8 */
DECL|enumerator|EV_ACCEPTD
id|EV_ACCEPTD
comma
multiline_comment|/*  9 */
DECL|enumerator|EV_SETUP_CMPL_IND
id|EV_SETUP_CMPL_IND
comma
multiline_comment|/* 10 */
DECL|enumerator|EV_BC_EST
id|EV_BC_EST
comma
multiline_comment|/* 11 */
DECL|enumerator|EV_WRITEBUF
id|EV_WRITEBUF
comma
multiline_comment|/* 12 */
DECL|enumerator|EV_DATAIN
id|EV_DATAIN
comma
multiline_comment|/* 13 */
DECL|enumerator|EV_HANGUP
id|EV_HANGUP
comma
multiline_comment|/* 14 */
DECL|enumerator|EV_BC_REL
id|EV_BC_REL
comma
multiline_comment|/* 15 */
DECL|enumerator|EV_CINF
id|EV_CINF
comma
multiline_comment|/* 16 */
DECL|enumerator|EV_SUSPEND
id|EV_SUSPEND
comma
multiline_comment|/* 17 */
DECL|enumerator|EV_RESUME
id|EV_RESUME
comma
multiline_comment|/* 18 */
DECL|enumerator|EV_SHUTDOWN_D
id|EV_SHUTDOWN_D
comma
multiline_comment|/* 19 */
DECL|enumerator|EV_NOSETUP_RSP
id|EV_NOSETUP_RSP
comma
multiline_comment|/* 20 */
DECL|enumerator|EV_SETUP_ERR
id|EV_SETUP_ERR
comma
multiline_comment|/* 21 */
DECL|enumerator|EV_CONNECT_ERR
id|EV_CONNECT_ERR
comma
multiline_comment|/* 22 */
DECL|enumerator|EV_RELEASE_ERR
id|EV_RELEASE_ERR
comma
multiline_comment|/* 23 */
)brace
suffix:semicolon
DECL|macro|EVENT_COUNT
mdefine_line|#define EVENT_COUNT (EV_RELEASE_ERR +1)
DECL|variable|strEvent
r_static
r_char
op_star
id|strEvent
(braket
)braket
op_assign
(brace
l_string|&quot;EV_DIAL&quot;
comma
l_string|&quot;EV_SETUP_CNF&quot;
comma
l_string|&quot;EV_ACCEPTB&quot;
comma
l_string|&quot;EV_DISCONNECT_IND&quot;
comma
l_string|&quot;EV_RELEASE_CNF&quot;
comma
l_string|&quot;EV_DLEST&quot;
comma
l_string|&quot;EV_DLRL&quot;
comma
l_string|&quot;EV_SETUP_IND&quot;
comma
l_string|&quot;EV_RELEASE_IND&quot;
comma
l_string|&quot;EV_ACCEPTD&quot;
comma
l_string|&quot;EV_SETUP_CMPL_IND&quot;
comma
l_string|&quot;EV_BC_EST&quot;
comma
l_string|&quot;EV_WRITEBUF&quot;
comma
l_string|&quot;EV_DATAIN&quot;
comma
l_string|&quot;EV_HANGUP&quot;
comma
l_string|&quot;EV_BC_REL&quot;
comma
l_string|&quot;EV_CINF&quot;
comma
l_string|&quot;EV_SUSPEND&quot;
comma
l_string|&quot;EV_RESUME&quot;
comma
l_string|&quot;EV_SHUTDOWN_D&quot;
comma
l_string|&quot;EV_NOSETUP_RSP&quot;
comma
l_string|&quot;EV_SETUP_ERR&quot;
comma
l_string|&quot;EV_CONNECT_ERR&quot;
comma
l_string|&quot;EV_RELEASE_ERR&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_LC_NULL
id|ST_LC_NULL
comma
DECL|enumerator|ST_LC_ACTIVATE_WAIT
id|ST_LC_ACTIVATE_WAIT
comma
DECL|enumerator|ST_LC_DELAY
id|ST_LC_DELAY
comma
DECL|enumerator|ST_LC_ESTABLISH_WAIT
id|ST_LC_ESTABLISH_WAIT
comma
DECL|enumerator|ST_LC_CONNECTED
id|ST_LC_CONNECTED
comma
DECL|enumerator|ST_LC_FLUSH_WAIT
id|ST_LC_FLUSH_WAIT
comma
DECL|enumerator|ST_LC_FLUSH_DELAY
id|ST_LC_FLUSH_DELAY
comma
DECL|enumerator|ST_LC_RELEASE_WAIT
id|ST_LC_RELEASE_WAIT
comma
)brace
suffix:semicolon
DECL|macro|LC_STATE_COUNT
mdefine_line|#define LC_STATE_COUNT (ST_LC_RELEASE_WAIT+1)
DECL|variable|strLcState
r_static
r_char
op_star
id|strLcState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_LC_NULL&quot;
comma
l_string|&quot;ST_LC_ACTIVATE_WAIT&quot;
comma
l_string|&quot;ST_LC_DELAY&quot;
comma
l_string|&quot;ST_LC_ESTABLISH_WAIT&quot;
comma
l_string|&quot;ST_LC_CONNECTED&quot;
comma
l_string|&quot;ST_LC_FLUSH_WAIT&quot;
comma
l_string|&quot;ST_LC_FLUSH_DELAY&quot;
comma
l_string|&quot;ST_LC_RELEASE_WAIT&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_LC_ESTABLISH
id|EV_LC_ESTABLISH
comma
DECL|enumerator|EV_LC_PH_ACTIVATE
id|EV_LC_PH_ACTIVATE
comma
DECL|enumerator|EV_LC_PH_DEACTIVATE
id|EV_LC_PH_DEACTIVATE
comma
DECL|enumerator|EV_LC_DL_ESTABLISH
id|EV_LC_DL_ESTABLISH
comma
DECL|enumerator|EV_LC_TIMER
id|EV_LC_TIMER
comma
DECL|enumerator|EV_LC_DL_FLUSH
id|EV_LC_DL_FLUSH
comma
DECL|enumerator|EV_LC_DL_RELEASE
id|EV_LC_DL_RELEASE
comma
DECL|enumerator|EV_LC_FLUSH
id|EV_LC_FLUSH
comma
DECL|enumerator|EV_LC_RELEASE
id|EV_LC_RELEASE
comma
)brace
suffix:semicolon
DECL|macro|LC_EVENT_COUNT
mdefine_line|#define LC_EVENT_COUNT (EV_LC_RELEASE+1)
DECL|variable|strLcEvent
r_static
r_char
op_star
id|strLcEvent
(braket
)braket
op_assign
(brace
l_string|&quot;EV_LC_ESTABLISH&quot;
comma
l_string|&quot;EV_LC_PH_ACTIVATE&quot;
comma
l_string|&quot;EV_LC_PH_DEACTIVATE&quot;
comma
l_string|&quot;EV_LC_DL_ESTABLISH&quot;
comma
l_string|&quot;EV_LC_TIMER&quot;
comma
l_string|&quot;EV_LC_DL_FLUSH&quot;
comma
l_string|&quot;EV_LC_DL_RELEASE&quot;
comma
l_string|&quot;EV_LC_FLUSH&quot;
comma
l_string|&quot;EV_LC_RELEASE&quot;
comma
)brace
suffix:semicolon
DECL|macro|LC_D
mdefine_line|#define LC_D  0
DECL|macro|LC_B
mdefine_line|#define LC_B  1
r_static
r_inline
r_void
DECL|function|l4_deliver_cause
id|l4_deliver_cause
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;para.cause
OL
l_int|0
)paren
r_return
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CAUSE
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;sp-&gt;protocol
op_eq
id|ISDN_PTYPE_EURO
)paren
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;E%02X%02X&quot;
comma
id|chanp-&gt;para.loc
comma
id|chanp-&gt;para.cause
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;%02X%02X&quot;
comma
id|chanp-&gt;para.loc
comma
id|chanp-&gt;para.cause
)paren
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Dial out&n; */
r_static
r_void
DECL|function|l4_prep_dialout
id|l4_prep_dialout
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|isdn_ctrl
op_star
id|ic
op_assign
id|arg
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_WAIT_D
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|60
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|73
)paren
suffix:semicolon
id|chanp-&gt;para.setup
op_assign
id|ic-&gt;parm.setup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|chanp-&gt;para.setup.eazmsn
comma
l_string|&quot;0&quot;
)paren
)paren
id|chanp-&gt;para.setup.eazmsn
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;l4_prep_dialout unknown protocol&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_ESTAB_D
)paren
(brace
id|FsmEvent
c_func
(paren
id|fi
comma
id|EV_DLEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;Flags
op_assign
id|FLG_START_D
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|chanp-&gt;lc_d.l2_establish
op_assign
l_int|0
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l4_do_dialout
id|l4_do_dialout
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_DIAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|chanp-&gt;para.bchannel
op_assign
(paren
id|chanp-&gt;chan
op_amp
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_ESTAB_D
)paren
suffix:semicolon
id|chanp-&gt;para.callref
op_assign
id|chanp-&gt;outcallref
suffix:semicolon
id|chanp-&gt;outcallref
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;outcallref
op_eq
l_int|128
)paren
id|chanp-&gt;outcallref
op_assign
l_int|64
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_SETUP_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_SEND
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l4_init_bchan_out
id|l4_init_bchan_out
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BCONN
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DCONN&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|init_ds
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_go_active
id|l4_go_active
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_ACTIVE
)paren
suffix:semicolon
id|chanp-&gt;data_open
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BCONN&quot;
comma
l_int|0
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
multiline_comment|/* incomming call */
r_static
r_void
DECL|function|l4_start_dchan
id|l4_start_dchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_D
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|61
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_ESTAB_D
)paren
(brace
id|FsmEvent
c_func
(paren
id|fi
comma
id|EV_DLEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;Flags
op_assign
id|FLG_START_D
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l4_deliver_call
id|l4_deliver_call
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_char
id|txt
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * Report incoming calls only once to linklevel, use CallFlags&n;&t; * which is set to 3 with each broadcast message in isdnl1.c&n;&t; * and resetted if a interface  answered the STAT_ICALL.&n;&t; */
r_if
c_cond
(paren
(paren
id|chanp-&gt;sp
)paren
op_logical_and
(paren
id|chanp-&gt;sp-&gt;CallFlags
op_eq
l_int|3
)paren
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_LL
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_ESTAB_D
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_REC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_ICALL&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_ICALL
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
multiline_comment|/*&n;&t;&t; * No need to return &quot;unknown&quot; for calls without OAD,&n;&t;&t; * cause that&squot;s handled in linklevel now (replaced by &squot;0&squot;)&n;&t;&t; */
id|ic.parm.setup
op_assign
id|chanp-&gt;para.setup
suffix:semicolon
id|ret
op_assign
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|txt
comma
l_string|&quot;statcallb ret=%d&quot;
comma
id|ret
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|txt
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
)paren
multiline_comment|/* if a interface knows this call, reset the CallFlag&n;&t;&t;&t;&t;   * to avoid a second Call report to the linklevel&n;&t;&t;&t;&t; */
id|chanp-&gt;sp-&gt;CallFlags
op_and_assign
op_complement
(paren
id|chanp-&gt;chan
op_plus
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* OK, anybody likes this call */
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_ALERT_SEND
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_ALERT
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_ALERTING_REQ
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Rejecting Call */
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_REC
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* OK, nobody likes this call */
r_default
suffix:colon
multiline_comment|/* statcallb problems */
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_IGNORE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
id|FLG_ESTAB_D
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
id|DREL_TIMER_VALUE
comma
id|EV_SHUTDOWN_D
comma
l_int|NULL
comma
l_int|61
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_IGNORE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
id|FLG_ESTAB_D
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
id|DREL_TIMER_VALUE
comma
id|EV_SHUTDOWN_D
comma
l_int|NULL
comma
l_int|62
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l4_send_dconnect
id|l4_send_dconnect
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_CONN_ACK
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_SETUP_RSP
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_init_bchan_in
id|l4_init_bchan_in
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BCONN
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DCONN&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;r9 unknown protocol&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|init_ds
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Call clearing */
r_static
r_void
DECL|function|l4_reject_call
id|l4_reject_call
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
id|chanp-&gt;para.cause
op_assign
l_int|0x15
suffix:semicolon
multiline_comment|/* Call Rejected */
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_REJECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_cancel_call
id|l4_cancel_call
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
id|chanp-&gt;para.cause
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* Normal Call Clearing */
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DISCONNECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_shutdown_d
id|l4_shutdown_d
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DSHUTDOWN
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|62
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_ESTAB_D
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_timeout_d
id|l4_timeout_d
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_DCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
id|FLG_ESTAB_D
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
id|DREL_TIMER_VALUE
comma
id|EV_SHUTDOWN_D
comma
l_int|NULL
comma
l_int|60
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_go_null
id|l4_go_null
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_disconn_bchan
id|l4_disconn_bchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BRELEASE
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_send_d_disc
id|l4_send_d_disc
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
(paren
id|FLG_DISC_REC
op_or
id|FLG_REL_REC
)paren
)paren
r_return
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
id|chanp-&gt;para.cause
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* Normal Call Clearing */
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DISCONNECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_released_bchan
id|l4_released_bchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DCOMMAND
)paren
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_release_bchan
id|l4_release_bchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_REC
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BREL_DISC
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_received_d_rel
id|l4_received_d_rel
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DSHUTDOWN
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_REL_REC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_CONNECT_B
)paren
(brace
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* direct reset in lc_b.lcfi */
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
(paren
id|FLG_LL_DCONN
op_or
id|FLG_CALL_SEND
)paren
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_SEND
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_FLUSH
comma
l_int|NULL
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_ESTAB_D
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_REC
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_ALERT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_received_d_relcnf
id|l4_received_d_relcnf
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DSHUTDOWN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_CONNECT_B
)paren
(brace
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* direct reset in lc_b.lcfi */
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
(paren
id|FLG_LL_DCONN
op_or
id|FLG_CALL_SEND
)paren
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_SEND
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_ESTAB_D
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_REC
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_ALERT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_received_d_disc
id|l4_received_d_disc
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_D_REL_CNF
)paren
suffix:semicolon
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_REC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
(paren
id|FLG_LL_DCONN
op_or
id|FLG_CALL_SEND
)paren
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_SEND
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_ALERT
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CALL_ALERT
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* processing charge info */
r_static
r_void
DECL|function|l4_charge_info
id|l4_charge_info
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CINF
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;%d&quot;
comma
id|chanp-&gt;para.chargeinfo
)paren
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
multiline_comment|/* error procedures */
r_static
r_void
DECL|function|l4_no_dchan
id|l4_no_dchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_NODCH&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_NODCH
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_no_dchan_ready
id|l4_no_dchan_ready
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_no_dchan_in
id|l4_no_dchan_in
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_no_setup_rsp
id|l4_no_setup_rsp
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l4_setup_err
id|l4_setup_err
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_DCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
multiline_comment|/* DISCONN was sent from L3 */
)brace
r_static
r_void
DECL|function|l4_connect_err
id|l4_connect_err
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_DCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|SETBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_DISC_SEND
)paren
suffix:semicolon
multiline_comment|/* DISCONN was sent from L3 */
)brace
r_static
r_void
DECL|function|l4_active_dlrl
id|l4_active_dlrl
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_CONNECT_B
)paren
(brace
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* direct reset in lc_b.lcfi */
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_CONNECT_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_BCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_BCONN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_START_B
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;Flags
op_amp
id|FLG_LL_DCONN
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|RESBIT
c_func
(paren
id|chanp-&gt;Flags
comma
id|FLG_LL_DCONN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;sp-&gt;protocol
op_eq
id|ISDN_PTYPE_EURO
)paren
(brace
id|chanp-&gt;para.cause
op_assign
l_int|0x2f
suffix:semicolon
id|chanp-&gt;para.loc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;para.cause
op_assign
l_int|0x70
suffix:semicolon
id|chanp-&gt;para.loc
op_assign
l_int|0
suffix:semicolon
)brace
id|l4_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* *INDENT-OFF* */
DECL|variable|fnlist
r_static
r_struct
id|FsmNode
id|fnlist
(braket
)braket
op_assign
(brace
(brace
id|ST_NULL
comma
id|EV_DIAL
comma
id|l4_prep_dialout
)brace
comma
(brace
id|ST_NULL
comma
id|EV_SETUP_IND
comma
id|l4_start_dchan
)brace
comma
(brace
id|ST_NULL
comma
id|EV_SHUTDOWN_D
comma
id|l4_shutdown_d
)brace
comma
(brace
id|ST_OUT_WAIT_D
comma
id|EV_DLEST
comma
id|l4_do_dialout
)brace
comma
(brace
id|ST_OUT_WAIT_D
comma
id|EV_DLRL
comma
id|l4_no_dchan
)brace
comma
(brace
id|ST_OUT_WAIT_D
comma
id|EV_HANGUP
comma
id|l4_no_dchan
)brace
comma
(brace
id|ST_IN_WAIT_D
comma
id|EV_DLEST
comma
id|l4_deliver_call
)brace
comma
(brace
id|ST_IN_WAIT_D
comma
id|EV_DLRL
comma
id|l4_no_dchan_in
)brace
comma
(brace
id|ST_IN_WAIT_D
comma
id|EV_HANGUP
comma
id|l4_no_dchan_in
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_SETUP_CNF
comma
id|l4_init_bchan_out
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_HANGUP
comma
id|l4_cancel_call
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_NOSETUP_RSP
comma
id|l4_no_setup_rsp
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_SETUP_ERR
comma
id|l4_setup_err
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_SETUP_CMPL_IND
comma
id|l4_init_bchan_in
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_ACCEPTD
comma
id|l4_send_dconnect
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_HANGUP
comma
id|l4_reject_call
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_SETUP_CMPL_IND
comma
id|l4_init_bchan_in
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_ACCEPTD
comma
id|l4_send_dconnect
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_HANGUP
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_IN_ALERT_SEND
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_SETUP_CMPL_IND
comma
id|l4_init_bchan_in
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_HANGUP
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_CONNECT_ERR
comma
id|l4_connect_err
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_BC_EST
comma
id|l4_go_active
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_BC_REL
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_HANGUP
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_CINF
comma
id|l4_charge_info
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_BC_REL
comma
id|l4_released_bchan
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_HANGUP
comma
id|l4_disconn_bchan
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_DISCONNECT_IND
comma
id|l4_release_bchan
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_DLRL
comma
id|l4_active_dlrl
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_BC_REL
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_WAIT_BREL_DISC
comma
id|EV_BC_REL
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_WAIT_BREL_DISC
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_WAIT_BREL_DISC
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_HANGUP
comma
id|l4_send_d_disc
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_DISCONNECT_IND
comma
id|l4_received_d_disc
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_RELEASE_CNF
comma
id|l4_received_d_relcnf
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_RELEASE_IND
comma
id|l4_received_d_rel
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_RELEASE_IND
comma
id|l4_timeout_d
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_RELEASE_CNF
comma
id|l4_timeout_d
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_RELEASE_ERR
comma
id|l4_timeout_d
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_DIAL
comma
id|l4_no_dchan_ready
)brace
comma
(brace
id|ST_WAIT_D_REL_CNF
comma
id|EV_RELEASE_CNF
comma
id|l4_timeout_d
)brace
comma
(brace
id|ST_WAIT_D_REL_CNF
comma
id|EV_RELEASE_ERR
comma
id|l4_timeout_d
)brace
comma
(brace
id|ST_WAIT_D_REL_CNF
comma
id|EV_DIAL
comma
id|l4_no_dchan_ready
)brace
comma
(brace
id|ST_WAIT_DSHUTDOWN
comma
id|EV_DLRL
comma
id|l4_go_null
)brace
comma
(brace
id|ST_WAIT_DSHUTDOWN
comma
id|EV_DIAL
comma
id|l4_prep_dialout
)brace
comma
(brace
id|ST_WAIT_DSHUTDOWN
comma
id|EV_SETUP_IND
comma
id|l4_start_dchan
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* *INDENT-ON* */
DECL|macro|FNCOUNT
mdefine_line|#define FNCOUNT (sizeof(fnlist)/sizeof(struct FsmNode))
r_static
r_void
DECL|function|lc_r1
id|lc_r1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_ACTIVATE_WAIT
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|1000
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|50
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r6
id|lc_r6
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|50
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_DELAY
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|40
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|51
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r2
id|lc_r2
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_establish
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_ESTABLISH_WAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_start
)paren
id|lf-&gt;st-&gt;ma
dot
id|manl2
c_func
(paren
id|lf-&gt;st
comma
id|DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_CONNECTED
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lc_r3
id|lc_r3
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_CONNECTED
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r7
id|lc_r7
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_FLUSH_WAIT
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl2
c_func
(paren
id|lf-&gt;st
comma
id|DL_FLUSH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r4
id|lc_r4
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_establish
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_RELEASE_WAIT
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl2
c_func
(paren
id|lf-&gt;st
comma
id|DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* This timer is for releasing the channel even&n;&t;&t; * there is a hang in layer 2 ; 5 sec are a try&n;&t;&t; */
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|5000
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|53
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_NULL
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lc_r4_1
id|lc_r4_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_FLUSH_DELAY
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|50
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|52
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r5_1
id|lc_r5_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_RELEASE_WAIT
)paren
suffix:semicolon
multiline_comment|/* This delay is needed for send out the UA frame before&n;&t; * PH_DEACTIVATE the interface&n;&t; */
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|10
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|54
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r5
id|lc_r5
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|54
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_NULL
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* *INDENT-OFF* */
DECL|variable|LcFnList
r_static
r_struct
id|FsmNode
id|LcFnList
(braket
)braket
op_assign
(brace
(brace
id|ST_LC_NULL
comma
id|EV_LC_ESTABLISH
comma
id|lc_r1
)brace
comma
(brace
id|ST_LC_ACTIVATE_WAIT
comma
id|EV_LC_PH_ACTIVATE
comma
id|lc_r6
)brace
comma
(brace
id|ST_LC_DELAY
comma
id|EV_LC_TIMER
comma
id|lc_r2
)brace
comma
(brace
id|ST_LC_DELAY
comma
id|EV_LC_DL_ESTABLISH
comma
id|lc_r3
)brace
comma
(brace
id|ST_LC_ESTABLISH_WAIT
comma
id|EV_LC_DL_ESTABLISH
comma
id|lc_r3
)brace
comma
(brace
id|ST_LC_ESTABLISH_WAIT
comma
id|EV_LC_RELEASE
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_CONNECTED
comma
id|EV_LC_FLUSH
comma
id|lc_r7
)brace
comma
(brace
id|ST_LC_CONNECTED
comma
id|EV_LC_RELEASE
comma
id|lc_r4
)brace
comma
(brace
id|ST_LC_CONNECTED
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5_1
)brace
comma
(brace
id|ST_LC_FLUSH_WAIT
comma
id|EV_LC_DL_FLUSH
comma
id|lc_r4_1
)brace
comma
(brace
id|ST_LC_FLUSH_DELAY
comma
id|EV_LC_TIMER
comma
id|lc_r4
)brace
comma
(brace
id|ST_LC_RELEASE_WAIT
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_RELEASE_WAIT
comma
id|EV_LC_TIMER
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_ACTIVATE_WAIT
comma
id|EV_LC_TIMER
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_ESTABLISH_WAIT
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* *INDENT-ON* */
DECL|macro|LC_FN_COUNT
mdefine_line|#define LC_FN_COUNT (sizeof(LcFnList)/sizeof(struct FsmNode))
r_void
DECL|function|CallcNew
id|CallcNew
c_func
(paren
r_void
)paren
(brace
id|callcfsm.state_count
op_assign
id|STATE_COUNT
suffix:semicolon
id|callcfsm.event_count
op_assign
id|EVENT_COUNT
suffix:semicolon
id|callcfsm.strEvent
op_assign
id|strEvent
suffix:semicolon
id|callcfsm.strState
op_assign
id|strState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|callcfsm
comma
id|fnlist
comma
id|FNCOUNT
)paren
suffix:semicolon
id|lcfsm.state_count
op_assign
id|LC_STATE_COUNT
suffix:semicolon
id|lcfsm.event_count
op_assign
id|LC_EVENT_COUNT
suffix:semicolon
id|lcfsm.strEvent
op_assign
id|strLcEvent
suffix:semicolon
id|lcfsm.strState
op_assign
id|strLcState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|lcfsm
comma
id|LcFnList
comma
id|LC_FN_COUNT
)paren
suffix:semicolon
)brace
r_void
DECL|function|CallcFree
id|CallcFree
c_func
(paren
r_void
)paren
(brace
id|FsmFree
c_func
(paren
op_amp
id|lcfsm
)paren
suffix:semicolon
id|FsmFree
c_func
(paren
op_amp
id|callcfsm
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_ds
id|release_ds
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
suffix:semicolon
id|sp
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|chanp-&gt;hscx
suffix:semicolon
id|close_hscxstate
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|releasestack_transl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cc_l1man
id|cc_l1man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cc_l2man
id|cc_l2man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_FLUSH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_DL_FLUSH
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dcc_l1man
id|dcc_l1man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dcc_l2man
id|dcc_l2man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ll_handler
id|ll_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_struct
id|BufHeader
op_star
id|ibh
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|CC_DISCONNECT_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DISCONNECT_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_CNF
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_COMPLETE_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CMPL_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_CNF
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_INFO_CHARGE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_CINF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_NOSETUP_RSP_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_NOSETUP_RSP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_ERR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_CONNECT_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_CONNECT_ERR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE_ERR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s Channel %d L3-&gt;L4 unknown primitiv %d&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|pr
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|chanp-&gt;sp
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|init_is
id|init_is
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
r_int
id|ces
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanp-&gt;is
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|chanp-&gt;sp
suffix:semicolon
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
id|setstack_HiSax
c_func
(paren
id|st
comma
id|sp
)paren
suffix:semicolon
id|st-&gt;l2.sap
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.tei
op_assign
l_int|255
suffix:semicolon
id|st-&gt;l2.ces
op_assign
id|ces
suffix:semicolon
id|st-&gt;l2.extended
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|st-&gt;l2.laptype
op_assign
id|LAPD
suffix:semicolon
id|st-&gt;l2.window
op_assign
l_int|1
suffix:semicolon
id|st-&gt;l2.orig
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|st-&gt;l2.t200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds  */
r_if
c_cond
(paren
id|st-&gt;protocol
op_eq
id|ISDN_PTYPE_1TR6
)paren
(brace
id|st-&gt;l2.n200
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* try 3 times        */
id|st-&gt;l2.t203
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10000 milliseconds */
)brace
r_else
(brace
id|st-&gt;l2.n200
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* try 4 times        */
id|st-&gt;l2.t203
op_assign
l_int|5000
suffix:semicolon
multiline_comment|/* 5000 milliseconds  */
)brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Channel %d q.921&quot;
comma
id|chanp-&gt;chan
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|setstack_isdnl3
c_func
(paren
id|st
comma
id|chanp
)paren
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;l4.l2writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;l3.l3l4
op_assign
id|ll_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|cc_l1man
suffix:semicolon
id|st-&gt;l2.l2man
op_assign
id|cc_l2man
suffix:semicolon
id|st-&gt;pa
op_assign
op_amp
id|chanp-&gt;para
suffix:semicolon
id|HiSax_addlist
c_func
(paren
id|sp
comma
id|st
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|callc_debug
id|callc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|80
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d callc %s&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|chanp-&gt;sp
comma
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_debug
id|lc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|256
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d lc %s&bslash;n&quot;
comma
id|tm
comma
id|lf-&gt;ch-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|lf-&gt;ch-&gt;sp
comma
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|dlc_debug
id|dlc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|256
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d dlc %s&bslash;n&quot;
comma
id|tm
comma
id|lf-&gt;ch-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|lf-&gt;ch-&gt;sp
comma
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lccall_d
id|lccall_d
c_func
(paren
r_struct
id|LcFsm
op_star
id|lf
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|lf-&gt;ch
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|LC_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DLEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|LC_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lccall_b
id|lccall_b
c_func
(paren
r_struct
id|LcFsm
op_star
id|lf
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|lf-&gt;ch
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|LC_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_EST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|LC_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_REL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|init_chan
id|init_chan
c_func
(paren
r_int
id|chan
comma
r_struct
id|IsdnCardState
op_star
id|csta
comma
r_int
id|hscx
comma
r_int
r_int
id|ces
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|chan
suffix:semicolon
id|chanp-&gt;sp
op_assign
id|csta
suffix:semicolon
id|chanp-&gt;hscx
op_assign
id|hscx
suffix:semicolon
id|chanp-&gt;chan
op_assign
id|chan
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;leased
op_assign
l_int|0
suffix:semicolon
id|init_is
c_func
(paren
id|chanp
comma
id|ces
)paren
suffix:semicolon
id|chanp-&gt;fi.fsm
op_assign
op_amp
id|callcfsm
suffix:semicolon
id|chanp-&gt;fi.state
op_assign
id|ST_NULL
suffix:semicolon
id|chanp-&gt;fi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;fi.userdata
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;fi.printdebug
op_assign
id|callc_debug
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
op_amp
id|chanp-&gt;dial_timer
)paren
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
op_amp
id|chanp-&gt;drel_timer
)paren
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.fsm
op_assign
op_amp
id|lcfsm
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.state
op_assign
id|ST_LC_NULL
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.userdata
op_assign
op_amp
id|chanp-&gt;lc_d
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.printdebug
op_assign
id|lc_debug
suffix:semicolon
id|chanp-&gt;lc_d.type
op_assign
id|LC_D
suffix:semicolon
id|chanp-&gt;lc_d.ch
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;lc_d.st
op_assign
op_amp
id|chanp-&gt;is
suffix:semicolon
id|chanp-&gt;lc_d.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.lccall
op_assign
id|lccall_d
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
op_amp
id|chanp-&gt;lc_d.act_timer
)paren
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.fsm
op_assign
op_amp
id|lcfsm
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.state
op_assign
id|ST_LC_NULL
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.userdata
op_assign
op_amp
id|chanp-&gt;lc_b
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.printdebug
op_assign
id|dlc_debug
suffix:semicolon
id|chanp-&gt;lc_b.type
op_assign
id|LC_B
suffix:semicolon
id|chanp-&gt;lc_b.ch
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;lc_b.st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.lccall
op_assign
id|lccall_b
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
op_amp
id|chanp-&gt;lc_b.act_timer
)paren
suffix:semicolon
id|chanp-&gt;outcallref
op_assign
l_int|64
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|CallcNewChan
id|CallcNewChan
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_int
id|ces
suffix:semicolon
id|chancount
op_add_assign
l_int|2
suffix:semicolon
id|ces
op_assign
id|randomces
c_func
(paren
)paren
suffix:semicolon
id|init_chan
c_func
(paren
l_int|0
comma
id|csta
comma
l_int|1
comma
id|ces
op_increment
)paren
suffix:semicolon
id|ces
op_mod_assign
l_int|0xffff
suffix:semicolon
id|init_chan
c_func
(paren
l_int|1
comma
id|csta
comma
l_int|0
comma
id|ces
op_increment
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: 2 channels added&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_is
id|release_is
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanp-&gt;is
suffix:semicolon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
id|releasestack_isdnl3
c_func
(paren
id|st
)paren
suffix:semicolon
id|HiSax_rmlist
c_func
(paren
id|st-&gt;l1.hardware
comma
id|st
)paren
suffix:semicolon
id|BufQueueRelease
c_func
(paren
op_amp
id|st-&gt;l2.i_queue
)paren
suffix:semicolon
)brace
r_void
DECL|function|CallcFreeChan
id|CallcFreeChan
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|drel_timer
comma
l_int|74
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|dial_timer
comma
l_int|75
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|lc_b.act_timer
comma
l_int|76
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|lc_d.act_timer
comma
l_int|77
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|Flags
op_amp
id|FLG_START_B
)paren
(brace
id|release_ds
c_func
(paren
id|csta-&gt;channel
op_plus
id|i
)paren
suffix:semicolon
)brace
id|release_is
c_func
(paren
id|csta-&gt;channel
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lldata_handler
id|lldata_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_int
id|size
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_DATA
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|chanp-&gt;ds.l2.ihsize
suffix:semicolon
id|size
op_assign
id|ibh-&gt;datasize
op_minus
id|chanp-&gt;ds.l2.ihsize
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|rcvcallb
c_func
(paren
id|chanp-&gt;sp-&gt;myid
comma
id|chanp-&gt;chan
comma
id|ptr
comma
id|size
)paren
suffix:semicolon
)brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lldata_handler unknown primitive %d&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lltrans_handler
id|lltrans_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_struct
id|BufHeader
op_star
id|ibh
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|rcvcallb
c_func
(paren
id|chanp-&gt;sp-&gt;myid
comma
id|chanp-&gt;chan
comma
id|ptr
comma
id|ibh-&gt;datasize
)paren
suffix:semicolon
)brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lltrans_handler unknown primitive %d&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ll_writewakeup
id|ll_writewakeup
c_func
(paren
r_struct
id|PStack
op_star
id|st
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|st-&gt;l4.userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;sp-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;sp-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_ds
id|init_ds
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|incoming
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|chanp-&gt;sp
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|chanp-&gt;hscx
suffix:semicolon
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
id|st-&gt;l1.hardware
op_assign
id|sp
suffix:semicolon
id|hsp-&gt;mode
op_assign
l_int|2
suffix:semicolon
id|hsp-&gt;transbufsize
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|setstack_hscx
c_func
(paren
id|st
comma
id|hsp
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l2.extended
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.laptype
op_assign
id|LAPB
suffix:semicolon
id|st-&gt;l2.orig
op_assign
op_logical_neg
id|incoming
suffix:semicolon
id|st-&gt;l2.t200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds */
id|st-&gt;l2.window
op_assign
l_int|7
suffix:semicolon
id|st-&gt;l2.n200
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* try 4 times       */
id|st-&gt;l2.t203
op_assign
l_int|5000
suffix:semicolon
multiline_comment|/* 5000 milliseconds */
id|st-&gt;l3.debug
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Channel %d x.75&quot;
comma
id|chanp-&gt;chan
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|st-&gt;l2.l2l3
op_assign
id|lldata_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l2.l2man
op_assign
id|dcc_l2man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;l4.l2writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l2.l2m.debug
op_assign
id|chanp-&gt;debug
op_amp
l_int|16
suffix:semicolon
id|st-&gt;l2.debug
op_assign
id|chanp-&gt;debug
op_amp
l_int|64
suffix:semicolon
id|st-&gt;ma
dot
id|manl2
c_func
(paren
id|st
comma
id|MDL_NOTEIPROC
comma
l_int|NULL
)paren
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Packet-Mode ? */
id|st-&gt;l1.hscxchannel
op_assign
id|chanp-&gt;para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
id|st-&gt;l1.l1l2
op_assign
id|lltrans_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|2
suffix:semicolon
id|st-&gt;l1.hscxchannel
op_assign
id|chanp-&gt;para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|st-&gt;l1.l1l2
op_assign
id|lltrans_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|1
suffix:semicolon
id|st-&gt;l1.hscxchannel
op_assign
id|chanp-&gt;para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|channel_report
id|channel_report
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
)brace
r_static
r_void
DECL|function|distr_debug
id|distr_debug
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
comma
r_int
id|debugflags
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|csta-&gt;channel
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|chanp
(braket
id|i
)braket
dot
id|debug
op_assign
id|debugflags
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|fi.debug
op_assign
id|debugflags
op_amp
l_int|2
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|is.l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|8
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|ds.l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|16
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|is.l2.debug
op_assign
id|debugflags
op_amp
l_int|32
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|ds.l2.debug
op_assign
id|debugflags
op_amp
l_int|64
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|lc_d.lcfi.debug
op_assign
id|debugflags
op_amp
l_int|128
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|lc_b.lcfi.debug
op_assign
id|debugflags
op_amp
l_int|256
suffix:semicolon
)brace
id|csta-&gt;dlogflag
op_assign
id|debugflags
op_amp
l_int|4
suffix:semicolon
id|csta-&gt;teistack-&gt;l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|512
suffix:semicolon
)brace
r_int
DECL|function|HiSax_command
id|HiSax_command
c_func
(paren
id|isdn_ctrl
op_star
id|ic
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|hisax_findcard
c_func
(paren
id|ic-&gt;driver
)paren
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csta
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax: if_command %d called with invalid driverId %d!&bslash;n&quot;
comma
id|ic-&gt;command
comma
id|ic-&gt;driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ic-&gt;command
)paren
(brace
r_case
(paren
id|ISDN_CMD_SETEAZ
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;SETEAZ&quot;
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_SETL2
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;SETL2 card %d %ld&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|ic-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
id|chanp-&gt;l2_protocol
op_assign
id|ic-&gt;arg
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_DIAL
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;DIAL %s -&gt; %s (%d,%d)&quot;
comma
id|ic-&gt;parm.setup.eazmsn
comma
id|ic-&gt;parm.setup.phone
comma
id|ic-&gt;parm.setup.si1
comma
id|ic-&gt;parm.setup.si2
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* this solution is dirty and may be change, if&n;&t;&t;&t; * we make a callreference based callmanager */
r_if
c_cond
(paren
id|chanp-&gt;fi.state
op_eq
id|ST_NULL
)paren
(brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DIAL
comma
id|ic
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|70
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|50
comma
id|EV_DIAL
comma
id|ic
comma
l_int|71
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTB
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;ACCEPTB&quot;
comma
l_int|1
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTB
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTD
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;ACCEPTD&quot;
comma
l_int|1
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTD
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_HANGUP
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;HANGUP&quot;
comma
l_int|1
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_HANGUP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_SUSPEND
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;SUSPEND %s&quot;
comma
id|ic-&gt;parm.num
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SUSPEND
comma
id|ic
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_RESUME
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;RESUME %s&quot;
comma
id|ic-&gt;parm.num
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RESUME
comma
id|ic
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_LOCK
)paren
suffix:colon
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|debug
op_amp
l_int|1024
)paren
(brace
id|jiftime
c_func
(paren
id|tmp
comma
id|jiffies
)paren
suffix:semicolon
id|i
op_assign
id|strlen
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
op_plus
id|i
comma
l_string|&quot;   LOCK modcnt %lx&bslash;n&quot;
comma
id|MOD_USE_COUNT
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_UNLOCK
)paren
suffix:colon
id|HiSax_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|debug
op_amp
l_int|1024
)paren
(brace
id|jiftime
c_func
(paren
id|tmp
comma
id|jiffies
)paren
suffix:semicolon
id|i
op_assign
id|strlen
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
op_plus
id|i
comma
l_string|&quot; UNLOCK modcnt %lx&bslash;n&quot;
comma
id|MOD_USE_COUNT
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_IOCTL
)paren
suffix:colon
r_switch
c_cond
(paren
id|ic-&gt;arg
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
id|HiSax_reportcard
c_func
(paren
id|csta-&gt;cardnr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|channel_report
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|distr_debug
c_func
(paren
id|csta
comma
id|num
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: %s&quot;
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|i
op_assign
id|num
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|2
)paren
r_break
suffix:semicolon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|i
suffix:semicolon
id|chanp-&gt;impair
op_assign
id|num
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;IMPAIR %x&quot;
comma
id|chanp-&gt;impair
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
l_int|3
)paren
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|i
op_increment
)paren
id|HiSax_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|4
)paren
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|i
op_increment
)paren
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|5
)paren
suffix:colon
multiline_comment|/* set card in leased mode */
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|leased
op_assign
l_int|1
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|1
)braket
dot
id|leased
op_assign
l_int|1
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;card %d set into leased mode&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef MODULE
r_case
(paren
l_int|55
)paren
suffix:colon
macro_line|#if (LINUX_VERSION_CODE &lt; 0x020111)
id|MOD_USE_COUNT
op_assign
id|MOD_VISITED
suffix:semicolon
macro_line|#else
id|MOD_USE_COUNT
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_case
(paren
l_int|11
)paren
suffix:colon
id|csta-&gt;debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;l1 debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|csta-&gt;debug
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|cards
(braket
l_int|0
)braket
dot
id|sp
comma
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: %s&quot;
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|13
)paren
suffix:colon
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|is.l3.debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|1
)braket
dot
id|is.l3.debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;l3 debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|cards
(braket
l_int|0
)braket
dot
id|sp
comma
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: %s&quot;
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: invalid ioclt %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|ic-&gt;arg
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|HiSax_writebuf
id|HiSax_writebuf
c_func
(paren
r_int
id|id
comma
r_int
id|chan
comma
r_const
id|u_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|user
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|hisax_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_struct
id|PStack
op_star
id|st
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csta
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax: if_sendbuf called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|chan
suffix:semicolon
id|st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chanp-&gt;data_open
)paren
(brace
id|link_debug
c_func
(paren
id|chanp
comma
l_string|&quot;writebuf: channel not open&quot;
comma
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|err
op_assign
id|BufPoolGet
c_func
(paren
op_amp
id|ibh
comma
id|st-&gt;l1.sbufpool
comma
id|GFP_ATOMIC
comma
id|st
comma
l_int|21
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
multiline_comment|/* Must return 0 here, since this is not an error&n;&t;&t; * but a temporary lack of resources.&n;&t;&t; */
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;writebuf: no buffers for %d bytes&quot;
comma
id|count
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;writebuf: %d bytes&quot;
comma
id|count
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;lc_b.l2_establish
)paren
id|i
op_assign
id|st-&gt;l2.ihsize
suffix:semicolon
r_else
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_plus
id|i
)paren
OG
id|BUFFER_SIZE
c_func
(paren
id|HSCX_SBUF_ORDER
comma
id|HSCX_SBUF_BPPS
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;writebuf: packet too large (%d bytes)&quot;
comma
id|count
op_plus
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax_%s !&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
id|link_debug
c_func
(paren
id|chanp
comma
id|tmp
comma
l_int|1
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
id|ptr
op_add_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_from_user
c_func
(paren
id|ptr
comma
id|buf
comma
id|count
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|ptr
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|ibh-&gt;datasize
op_assign
id|count
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;lc_b.l2_establish
)paren
id|chanp-&gt;ds.l3
dot
id|l3l2
c_func
(paren
op_amp
id|chanp-&gt;ds
comma
id|DL_DATA
comma
id|ibh
)paren
suffix:semicolon
r_else
id|chanp-&gt;ds.l2
dot
id|l2l1
c_func
(paren
op_amp
id|chanp-&gt;ds
comma
id|PH_DATA
comma
id|ibh
)paren
suffix:semicolon
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
r_else
(brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
eof
