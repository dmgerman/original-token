multiline_comment|/* $Id: callc.c,v 2.51 2000/11/24 17:05:37 kai Exp $&n; *&n; * Author       Karsten Keil (keil@isdn4linux.de)&n; *              based on the teles driver from Jan den Ouden&n; *&n; *&t;&t;This file is (c) under GNU PUBLIC LICENSE&n; *&t;&t;For changes and modifications please read&n; *&t;&t;../../../Documentation/isdn/HiSax.cert&n; *&n; * Thanks to    Jan den Ouden&n; *              Fritz Elfert&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;../avmb1/capicmd.h&quot;  /* this should be moved in a common place */
macro_line|#ifdef MODULE
DECL|macro|MOD_USE_COUNT
mdefine_line|#define MOD_USE_COUNT ( GET_USE_COUNT (&amp;__this_module))
macro_line|#endif&t;/* MODULE */
DECL|variable|lli_revision
r_const
r_char
op_star
id|lli_revision
op_assign
l_string|&quot;$Revision: 2.51 $&quot;
suffix:semicolon
r_extern
r_struct
id|IsdnCard
id|cards
(braket
)braket
suffix:semicolon
r_extern
r_int
id|nrcards
suffix:semicolon
r_extern
r_void
id|HiSax_mod_dec_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|HiSax_mod_inc_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|init_b_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|incoming
)paren
suffix:semicolon
r_static
r_void
id|release_b_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
suffix:semicolon
DECL|variable|callcfsm
r_static
r_struct
id|Fsm
id|callcfsm
suffix:semicolon
DECL|variable|chancount
r_static
r_int
id|chancount
suffix:semicolon
multiline_comment|/* experimental REJECT after ALERTING for CALLBACK to beat the 4s delay */
DECL|macro|ALERT_REJECT
mdefine_line|#define ALERT_REJECT 0
multiline_comment|/* Value to delay the sending of the first B-channel paket after CONNECT&n; * here is no value given by ITU, but experience shows that 300 ms will&n; * work on many networks, if you or your other side is behind local exchanges&n; * a greater value may be recommented. If the delay is to short the first paket&n; * will be lost and autodetect on many comercial routers goes wrong !&n; * You can adjust this value on runtime with&n; * hisaxctrl &lt;id&gt; 2 &lt;value&gt;&n; * value is in milliseconds&n; */
DECL|macro|DEFAULT_B_DELAY
mdefine_line|#define DEFAULT_B_DELAY&t;300
multiline_comment|/* Flags for remembering action done in lli */
DECL|macro|FLG_START_B
mdefine_line|#define  FLG_START_B&t;0
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
r_struct
id|IsdnCardState
op_star
DECL|function|hisax_findcard
id|hisax_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|cs
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|cs-&gt;myid
op_eq
id|driverid
)paren
r_return
(paren
id|cards
(braket
id|i
)braket
dot
id|cs
)paren
suffix:semicolon
r_return
(paren
r_struct
id|IsdnCardState
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|discard_queue
id|discard_queue
c_func
(paren
r_struct
id|sk_buff_head
op_star
id|q
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ret
op_increment
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_void
DECL|function|link_debug
id|link_debug
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|direction
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Ch%d %s &quot;
comma
id|chanp-&gt;chan
comma
id|direction
ques
c_cond
l_string|&quot;LL-&gt;HL&quot;
suffix:colon
l_string|&quot;HL-&gt;LL&quot;
)paren
suffix:semicolon
id|VHiSax_putstatus
c_func
(paren
id|chanp-&gt;cs
comma
id|tmp
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
r_enum
(brace
DECL|enumerator|ST_NULL
id|ST_NULL
comma
multiline_comment|/*  0 inactive */
DECL|enumerator|ST_OUT_DIAL
id|ST_OUT_DIAL
comma
multiline_comment|/*  1 outgoing, SETUP send; awaiting confirm */
DECL|enumerator|ST_IN_WAIT_LL
id|ST_IN_WAIT_LL
comma
multiline_comment|/*  2 incoming call received; wait for LL confirm */
DECL|enumerator|ST_IN_ALERT_SENT
id|ST_IN_ALERT_SENT
comma
multiline_comment|/*  3 incoming call received; ALERT send */
DECL|enumerator|ST_IN_WAIT_CONN_ACK
id|ST_IN_WAIT_CONN_ACK
comma
multiline_comment|/*  4 incoming CONNECT send; awaiting CONN_ACK */
DECL|enumerator|ST_WAIT_BCONN
id|ST_WAIT_BCONN
comma
multiline_comment|/*  5 CONNECT/CONN_ACK received, awaiting b-channel prot. estbl. */
DECL|enumerator|ST_ACTIVE
id|ST_ACTIVE
comma
multiline_comment|/*  6 active, b channel prot. established */
DECL|enumerator|ST_WAIT_BRELEASE
id|ST_WAIT_BRELEASE
comma
multiline_comment|/*  7 call clear. (initiator), awaiting b channel prot. rel. */
DECL|enumerator|ST_WAIT_BREL_DISC
id|ST_WAIT_BREL_DISC
comma
multiline_comment|/*  8 call clear. (receiver), DISCONNECT req. received */
DECL|enumerator|ST_WAIT_DCOMMAND
id|ST_WAIT_DCOMMAND
comma
multiline_comment|/*  9 call clear. (receiver), awaiting DCHANNEL message */
DECL|enumerator|ST_WAIT_DRELEASE
id|ST_WAIT_DRELEASE
comma
multiline_comment|/* 10 DISCONNECT sent, awaiting RELEASE */
DECL|enumerator|ST_WAIT_D_REL_CNF
id|ST_WAIT_D_REL_CNF
comma
multiline_comment|/* 11 RELEASE sent, awaiting RELEASE confirm */
DECL|enumerator|ST_IN_PROCEED_SEND
id|ST_IN_PROCEED_SEND
comma
multiline_comment|/* 12 incoming call, proceeding send */
)brace
suffix:semicolon
DECL|macro|STATE_COUNT
mdefine_line|#define STATE_COUNT (ST_IN_PROCEED_SEND + 1)
DECL|variable|strState
r_static
r_char
op_star
id|strState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_NULL&quot;
comma
l_string|&quot;ST_OUT_DIAL&quot;
comma
l_string|&quot;ST_IN_WAIT_LL&quot;
comma
l_string|&quot;ST_IN_ALERT_SENT&quot;
comma
l_string|&quot;ST_IN_WAIT_CONN_ACK&quot;
comma
l_string|&quot;ST_WAIT_BCONN&quot;
comma
l_string|&quot;ST_ACTIVE&quot;
comma
l_string|&quot;ST_WAIT_BRELEASE&quot;
comma
l_string|&quot;ST_WAIT_BREL_DISC&quot;
comma
l_string|&quot;ST_WAIT_DCOMMAND&quot;
comma
l_string|&quot;ST_WAIT_DRELEASE&quot;
comma
l_string|&quot;ST_WAIT_D_REL_CNF&quot;
comma
l_string|&quot;ST_IN_PROCEED_SEND&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_DIAL
id|EV_DIAL
comma
multiline_comment|/*  0 */
DECL|enumerator|EV_SETUP_CNF
id|EV_SETUP_CNF
comma
multiline_comment|/*  1 */
DECL|enumerator|EV_ACCEPTB
id|EV_ACCEPTB
comma
multiline_comment|/*  2 */
DECL|enumerator|EV_DISCONNECT_IND
id|EV_DISCONNECT_IND
comma
multiline_comment|/*  3 */
DECL|enumerator|EV_RELEASE
id|EV_RELEASE
comma
multiline_comment|/*  4 */
DECL|enumerator|EV_LEASED
id|EV_LEASED
comma
multiline_comment|/*  5 */
DECL|enumerator|EV_LEASED_REL
id|EV_LEASED_REL
comma
multiline_comment|/*  6 */
DECL|enumerator|EV_SETUP_IND
id|EV_SETUP_IND
comma
multiline_comment|/*  7 */
DECL|enumerator|EV_ACCEPTD
id|EV_ACCEPTD
comma
multiline_comment|/*  8 */
DECL|enumerator|EV_SETUP_CMPL_IND
id|EV_SETUP_CMPL_IND
comma
multiline_comment|/*  9 */
DECL|enumerator|EV_BC_EST
id|EV_BC_EST
comma
multiline_comment|/* 10 */
DECL|enumerator|EV_WRITEBUF
id|EV_WRITEBUF
comma
multiline_comment|/* 11 */
DECL|enumerator|EV_HANGUP
id|EV_HANGUP
comma
multiline_comment|/* 12 */
DECL|enumerator|EV_BC_REL
id|EV_BC_REL
comma
multiline_comment|/* 13 */
DECL|enumerator|EV_CINF
id|EV_CINF
comma
multiline_comment|/* 14 */
DECL|enumerator|EV_SUSPEND
id|EV_SUSPEND
comma
multiline_comment|/* 15 */
DECL|enumerator|EV_RESUME
id|EV_RESUME
comma
multiline_comment|/* 16 */
DECL|enumerator|EV_NOSETUP_RSP
id|EV_NOSETUP_RSP
comma
multiline_comment|/* 17 */
DECL|enumerator|EV_SETUP_ERR
id|EV_SETUP_ERR
comma
multiline_comment|/* 18 */
DECL|enumerator|EV_CONNECT_ERR
id|EV_CONNECT_ERR
comma
multiline_comment|/* 19 */
DECL|enumerator|EV_PROCEED
id|EV_PROCEED
comma
multiline_comment|/* 20 */
DECL|enumerator|EV_ALERT
id|EV_ALERT
comma
multiline_comment|/* 21 */
DECL|enumerator|EV_REDIR
id|EV_REDIR
comma
multiline_comment|/* 22 */
)brace
suffix:semicolon
DECL|macro|EVENT_COUNT
mdefine_line|#define EVENT_COUNT (EV_REDIR + 1)
DECL|variable|strEvent
r_static
r_char
op_star
id|strEvent
(braket
)braket
op_assign
(brace
l_string|&quot;EV_DIAL&quot;
comma
l_string|&quot;EV_SETUP_CNF&quot;
comma
l_string|&quot;EV_ACCEPTB&quot;
comma
l_string|&quot;EV_DISCONNECT_IND&quot;
comma
l_string|&quot;EV_RELEASE&quot;
comma
l_string|&quot;EV_LEASED&quot;
comma
l_string|&quot;EV_LEASED_REL&quot;
comma
l_string|&quot;EV_SETUP_IND&quot;
comma
l_string|&quot;EV_ACCEPTD&quot;
comma
l_string|&quot;EV_SETUP_CMPL_IND&quot;
comma
l_string|&quot;EV_BC_EST&quot;
comma
l_string|&quot;EV_WRITEBUF&quot;
comma
l_string|&quot;EV_HANGUP&quot;
comma
l_string|&quot;EV_BC_REL&quot;
comma
l_string|&quot;EV_CINF&quot;
comma
l_string|&quot;EV_SUSPEND&quot;
comma
l_string|&quot;EV_RESUME&quot;
comma
l_string|&quot;EV_NOSETUP_RSP&quot;
comma
l_string|&quot;EV_SETUP_ERR&quot;
comma
l_string|&quot;EV_CONNECT_ERR&quot;
comma
l_string|&quot;EV_PROCEED&quot;
comma
l_string|&quot;EV_ALERT&quot;
comma
l_string|&quot;EV_REDIR&quot;
comma
)brace
suffix:semicolon
r_static
r_inline
r_void
DECL|function|HL_LL
id|HL_LL
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|command
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|command
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|lli_deliver_cause
id|lli_deliver_cause
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chanp-&gt;proc
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;proc-&gt;para.cause
op_eq
id|NO_CAUSE
)paren
r_return
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CAUSE
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;cs-&gt;protocol
op_eq
id|ISDN_PTYPE_EURO
)paren
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;E%02X%02X&quot;
comma
id|chanp-&gt;proc-&gt;para.loc
op_amp
l_int|0x7f
comma
id|chanp-&gt;proc-&gt;para.cause
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;%02X%02X&quot;
comma
id|chanp-&gt;proc-&gt;para.loc
op_amp
l_int|0x7f
comma
id|chanp-&gt;proc-&gt;para.cause
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|lli_close
id|lli_close
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_REL
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_leased_in
id|lli_leased_in
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chanp-&gt;leased
)paren
r_return
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_SETUP
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_LL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_ICALL_LEASED&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
(paren
(paren
id|chanp-&gt;chan
OL
l_int|2
)paren
ques
c_cond
id|ISDN_STAT_ICALL
suffix:colon
id|ISDN_STAT_ICALLW
)paren
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|ic.parm.setup.si1
op_assign
l_int|7
suffix:semicolon
id|ic.parm.setup.si2
op_assign
l_int|0
suffix:semicolon
id|ic.parm.setup.plan
op_assign
l_int|0
suffix:semicolon
id|ic.parm.setup.screen
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.setup.eazmsn
comma
l_string|&quot;%d&quot;
comma
id|chanp-&gt;chan
op_plus
l_int|1
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.setup.phone
comma
l_string|&quot;LEASED%d&quot;
comma
id|chanp-&gt;cs-&gt;myid
)paren
suffix:semicolon
id|ret
op_assign
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;statcallb ret=%d&quot;
comma
id|ret
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_REL
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Dial out&n; */
r_static
r_void
DECL|function|lli_init_bchan_out
id|lli_init_bchan_out
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BCONN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DCONN&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DCONN
)paren
suffix:semicolon
id|init_b_st
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_prep_dialout
id|lli_prep_dialout
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|60
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|73
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_SETUP
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_init_bchan_out
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_DIAL
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_SETUP
op_or
id|REQUEST
comma
id|chanp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_resume
id|lli_resume
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|60
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|73
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_SETUP
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_init_bchan_out
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_DIAL
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_RESUME
op_or
id|REQUEST
comma
id|chanp
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_go_active
id|lli_go_active
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_ACTIVE
)paren
suffix:semicolon
id|chanp-&gt;data_open
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;bcs-&gt;conmsg
)paren
id|strcpy
c_func
(paren
id|ic.parm.num
comma
id|chanp-&gt;bcs-&gt;conmsg
)paren
suffix:semicolon
r_else
id|ic.parm.num
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BCONN %s&quot;
comma
id|ic.parm.num
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_CONN
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * RESUME&n; */
multiline_comment|/* incomming call */
r_static
r_void
DECL|function|lli_deliver_call
id|lli_deliver_call
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_SETUP
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Report incoming calls only once to linklevel, use CallFlags&n;&t; * which is set to 3 with each broadcast message in isdnl1.c&n;&t; * and resetted if a interface  answered the STAT_ICALL.&n;&t; */
r_if
c_cond
(paren
l_int|1
)paren
(brace
multiline_comment|/* for only one TEI */
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_LL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
(paren
id|chanp-&gt;chan
OL
l_int|2
)paren
ques
c_cond
l_string|&quot;STAT_ICALL&quot;
suffix:colon
l_string|&quot;STAT_ICALLW&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
(paren
(paren
id|chanp-&gt;chan
OL
l_int|2
)paren
ques
c_cond
id|ISDN_STAT_ICALL
suffix:colon
id|ISDN_STAT_ICALLW
)paren
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
multiline_comment|/*&n;&t;&t; * No need to return &quot;unknown&quot; for calls without OAD,&n;&t;&t; * cause that&squot;s handled in linklevel now (replaced by &squot;0&squot;)&n;&t;&t; */
id|memcpy
c_func
(paren
op_amp
id|ic.parm.setup
comma
op_amp
id|chanp-&gt;proc-&gt;para.setup
comma
r_sizeof
(paren
id|setup_parm
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;statcallb ret=%d&quot;
comma
id|ret
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* OK, someone likes this call */
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|61
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_ALERT_SENT
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_ALERTING
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* direct redirect */
r_case
l_int|4
suffix:colon
multiline_comment|/* Proceeding desired */
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|61
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_PROCEED_SEND
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_PROCEED_SEND
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|5
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|chanp-&gt;setup
comma
op_amp
id|ic.parm.setup
comma
r_sizeof
(paren
id|setup_parm
)paren
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_REDIR
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Rejecting Call */
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* incomplete number */
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|61
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_MORE_INFO
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* OK, nobody likes this call */
r_default
suffix:colon
multiline_comment|/* statcallb problems */
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_IGNORE
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_REL
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_IGNORE
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_REL
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_send_dconnect
id|lli_send_dconnect
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_CONN_ACK
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_SETUP
op_or
id|RESPONSE
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_send_alert
id|lli_send_alert
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_ALERT_SENT
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_ALERTING
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_send_redir
id|lli_send_redir
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_REDIR
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_init_bchan_in
id|lli_init_bchan_in
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BCONN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DCONN&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DCONN
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|init_b_st
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_setup_rsp
id|lli_setup_rsp
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_init_bchan_in
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_WAIT_CONN_ACK
)paren
suffix:semicolon
macro_line|#ifdef WANT_ALERT
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_ALERTING
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
macro_line|#endif
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_SETUP
op_or
id|RESPONSE
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Call suspend */
r_static
r_void
DECL|function|lli_suspend
id|lli_suspend
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_SUSPEND
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
multiline_comment|/* Call clearing */
r_static
r_void
DECL|function|lli_leased_hup
id|lli_leased_hup
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CAUSE
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;L0010&quot;
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DHUP
)paren
suffix:semicolon
id|lli_close
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_disconnect_req
id|lli_disconnect_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;proc
)paren
id|chanp-&gt;proc-&gt;para.cause
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* Normal Call Clearing */
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_DISCONNECT
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_disconnect_reject
id|lli_disconnect_reject
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;proc
)paren
id|chanp-&gt;proc-&gt;para.cause
op_assign
l_int|0x15
suffix:semicolon
multiline_comment|/* Call Rejected */
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_DISCONNECT
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_dhup_close
id|lli_dhup_close
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DHUP&quot;
)paren
suffix:semicolon
id|lli_deliver_cause
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DHUP
)paren
suffix:semicolon
id|lli_close
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_reject_req
id|lli_reject_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifndef ALERT_REJECT
r_if
c_cond
(paren
id|chanp-&gt;proc
)paren
id|chanp-&gt;proc-&gt;para.cause
op_assign
l_int|0x15
suffix:semicolon
multiline_comment|/* Call Rejected */
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_REJECT
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
id|lli_dhup_close
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
macro_line|#else
id|FsmRestartTimer
c_func
(paren
op_amp
id|chanp-&gt;drel_timer
comma
l_int|40
comma
id|EV_HANGUP
comma
l_int|NULL
comma
l_int|63
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_ALERT_SENT
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_ALERTING
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
r_void
DECL|function|lli_disconn_bchan
id|lli_disconn_bchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BRELEASE
)paren
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_RELEASE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_start_disc
id|lli_start_disc
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
id|lli_disconnect_req
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_rel_b_disc
id|lli_rel_b_disc
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_b_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|lli_start_disc
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_bhup_disc
id|lli_bhup_disc
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_BHUP
)paren
suffix:semicolon
id|lli_rel_b_disc
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_bhup_rel_b
id|lli_bhup_rel_b
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DCOMMAND
)paren
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_BHUP
)paren
suffix:semicolon
id|release_b_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_release_bchan
id|lli_release_bchan
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_BREL_DISC
)paren
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_RELEASE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_rel_b_dhup
id|lli_rel_b_dhup
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_b_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|lli_dhup_close
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_bhup_dhup
id|lli_bhup_dhup
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_BHUP
)paren
suffix:semicolon
id|lli_rel_b_dhup
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_abort
id|lli_abort
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_RELEASE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
id|lli_bhup_dhup
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_release_req
id|lli_release_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
(brace
id|lli_leased_hup
c_func
(paren
id|fi
comma
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_D_REL_CNF
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|CC_RELEASE
op_or
id|REQUEST
comma
id|chanp-&gt;proc
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lli_rel_b_release_req
id|lli_rel_b_release_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_b_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|lli_release_req
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_bhup_release_req
id|lli_bhup_release_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_BHUP
)paren
suffix:semicolon
id|lli_rel_b_release_req
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/* processing charge info */
r_static
r_void
DECL|function|lli_charge_info
id|lli_charge_info
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CINF
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;%d&quot;
comma
id|chanp-&gt;proc-&gt;para.chargeinfo
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
multiline_comment|/* error procedures */
r_static
r_void
DECL|function|lli_dchan_not_ready
id|lli_dchan_not_ready
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DHUP
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_no_setup_rsp
id|lli_no_setup_rsp
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_DHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DHUP
)paren
suffix:semicolon
id|lli_close
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_error
id|lli_error
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_WAIT_DRELEASE
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_failure_l
id|lli_failure_l
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CAUSE
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.parm.num
comma
l_string|&quot;L%02X%02X&quot;
comma
l_int|0
comma
l_int|0x2f
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_DHUP
)paren
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|chanp-&gt;cs
comma
id|MDL_INFO_REL
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|chanp-&gt;chan
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_rel_b_fail
id|lli_rel_b_fail
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_b_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
id|lli_failure_l
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_bhup_fail
id|lli_bhup_fail
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|HL_LL
c_func
(paren
id|chanp
comma
id|ISDN_STAT_BHUP
)paren
suffix:semicolon
id|lli_rel_b_fail
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lli_failure_a
id|lli_failure_a
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;b_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;b_st
comma
id|DL_RELEASE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
id|lli_bhup_fail
c_func
(paren
id|fi
comma
id|event
comma
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/* *INDENT-OFF* */
DECL|variable|__initdata
r_static
r_struct
id|FsmNode
id|fnlist
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ST_NULL
comma
id|EV_DIAL
comma
id|lli_prep_dialout
)brace
comma
(brace
id|ST_NULL
comma
id|EV_RESUME
comma
id|lli_resume
)brace
comma
(brace
id|ST_NULL
comma
id|EV_SETUP_IND
comma
id|lli_deliver_call
)brace
comma
(brace
id|ST_NULL
comma
id|EV_LEASED
comma
id|lli_leased_in
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_SETUP_CNF
comma
id|lli_init_bchan_out
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_HANGUP
comma
id|lli_disconnect_req
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_req
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_NOSETUP_RSP
comma
id|lli_no_setup_rsp
)brace
comma
(brace
id|ST_OUT_DIAL
comma
id|EV_SETUP_ERR
comma
id|lli_error
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_LEASED_REL
comma
id|lli_failure_l
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_ACCEPTD
comma
id|lli_setup_rsp
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_HANGUP
comma
id|lli_reject_req
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_req
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_SETUP_IND
comma
id|lli_deliver_call
)brace
comma
(brace
id|ST_IN_WAIT_LL
comma
id|EV_SETUP_ERR
comma
id|lli_error
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_SETUP_CMPL_IND
comma
id|lli_init_bchan_in
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_ACCEPTD
comma
id|lli_send_dconnect
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_HANGUP
comma
id|lli_disconnect_reject
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_req
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_REDIR
comma
id|lli_send_redir
)brace
comma
(brace
id|ST_IN_PROCEED_SEND
comma
id|EV_REDIR
comma
id|lli_send_redir
)brace
comma
(brace
id|ST_IN_PROCEED_SEND
comma
id|EV_ALERT
comma
id|lli_send_alert
)brace
comma
(brace
id|ST_IN_PROCEED_SEND
comma
id|EV_ACCEPTD
comma
id|lli_send_dconnect
)brace
comma
(brace
id|ST_IN_PROCEED_SEND
comma
id|EV_HANGUP
comma
id|lli_disconnect_reject
)brace
comma
(brace
id|ST_IN_PROCEED_SEND
comma
id|EV_DISCONNECT_IND
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_IN_ALERT_SENT
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_SETUP_CMPL_IND
comma
id|lli_init_bchan_in
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_HANGUP
comma
id|lli_disconnect_req
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_req
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_IN_WAIT_CONN_ACK
comma
id|EV_CONNECT_ERR
comma
id|lli_error
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_BC_EST
comma
id|lli_go_active
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_BC_REL
comma
id|lli_rel_b_disc
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_HANGUP
comma
id|lli_rel_b_disc
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_DISCONNECT_IND
comma
id|lli_rel_b_release_req
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_RELEASE
comma
id|lli_rel_b_dhup
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_LEASED_REL
comma
id|lli_rel_b_fail
)brace
comma
(brace
id|ST_WAIT_BCONN
comma
id|EV_CINF
comma
id|lli_charge_info
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_CINF
comma
id|lli_charge_info
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_BC_REL
comma
id|lli_bhup_rel_b
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_SUSPEND
comma
id|lli_suspend
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_HANGUP
comma
id|lli_disconn_bchan
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_bchan
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_RELEASE
comma
id|lli_abort
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_LEASED_REL
comma
id|lli_failure_a
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_BC_REL
comma
id|lli_bhup_disc
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_DISCONNECT_IND
comma
id|lli_bhup_release_req
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_RELEASE
comma
id|lli_bhup_dhup
)brace
comma
(brace
id|ST_WAIT_BRELEASE
comma
id|EV_LEASED_REL
comma
id|lli_bhup_fail
)brace
comma
(brace
id|ST_WAIT_BREL_DISC
comma
id|EV_BC_REL
comma
id|lli_bhup_release_req
)brace
comma
(brace
id|ST_WAIT_BREL_DISC
comma
id|EV_RELEASE
comma
id|lli_bhup_dhup
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_HANGUP
comma
id|lli_start_disc
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_DISCONNECT_IND
comma
id|lli_release_req
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_WAIT_DCOMMAND
comma
id|EV_LEASED_REL
comma
id|lli_failure_l
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_WAIT_DRELEASE
comma
id|EV_DIAL
comma
id|lli_dchan_not_ready
)brace
comma
multiline_comment|/* ETS 300-104 16.1 */
(brace
id|ST_WAIT_D_REL_CNF
comma
id|EV_RELEASE
comma
id|lli_dhup_close
)brace
comma
(brace
id|ST_WAIT_D_REL_CNF
comma
id|EV_DIAL
comma
id|lli_dchan_not_ready
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* *INDENT-ON* */
DECL|macro|FNCOUNT
mdefine_line|#define FNCOUNT (sizeof(fnlist)/sizeof(struct FsmNode))
r_void
id|__init
DECL|function|CallcNew
id|CallcNew
c_func
(paren
r_void
)paren
(brace
id|callcfsm.state_count
op_assign
id|STATE_COUNT
suffix:semicolon
id|callcfsm.event_count
op_assign
id|EVENT_COUNT
suffix:semicolon
id|callcfsm.strEvent
op_assign
id|strEvent
suffix:semicolon
id|callcfsm.strState
op_assign
id|strState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|callcfsm
comma
id|fnlist
comma
id|FNCOUNT
)paren
suffix:semicolon
)brace
r_void
DECL|function|CallcFree
id|CallcFree
c_func
(paren
r_void
)paren
(brace
id|FsmFree
c_func
(paren
op_amp
id|callcfsm
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_b_st
id|release_b_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|chanp-&gt;b_st
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_START_B
comma
op_amp
id|chanp-&gt;Flags
)paren
)paren
(brace
id|chanp-&gt;bcs
op_member_access_from_pointer
id|BC_Close
c_func
(paren
id|chanp-&gt;bcs
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_HDLC_56K
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_MODEM
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_FAX
)paren
suffix:colon
id|releasestack_transl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_struct
id|Channel
DECL|function|selectfreechannel
op_star
id|selectfreechannel
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|bch
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|st-&gt;lli.userdata
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|i
op_assign
l_int|1
suffix:semicolon
r_else
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bch
)paren
(brace
id|i
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* virtual channel */
id|chanp
op_add_assign
l_int|2
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
(paren
(paren
id|bch
)paren
ques
c_cond
id|cs-&gt;chanlimit
suffix:colon
(paren
l_int|2
op_plus
id|MAX_WAITING_CALLS
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;fi.state
op_eq
id|ST_NULL
)paren
r_return
(paren
id|chanp
)paren
suffix:semicolon
id|chanp
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bch
)paren
multiline_comment|/* number of channels is limited */
(brace
id|i
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* virtual channel */
id|chanp
op_assign
id|st-&gt;lli.userdata
suffix:semicolon
id|chanp
op_add_assign
id|i
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
(paren
l_int|2
op_plus
id|MAX_WAITING_CALLS
)paren
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;fi.state
op_eq
id|ST_NULL
)paren
r_return
(paren
id|chanp
)paren
suffix:semicolon
id|chanp
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|stat_redir_result
r_static
r_void
id|stat_redir_result
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|ulong
id|result
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_REDIR
suffix:semicolon
id|ic.arg
op_assign
id|chan
suffix:semicolon
(paren
id|ulong
)paren
(paren
id|ic.parm.num
(braket
l_int|0
)braket
)paren
op_assign
id|result
suffix:semicolon
id|cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
multiline_comment|/* stat_redir_result */
r_static
r_void
DECL|function|dchan_l3l4
id|dchan_l3l4
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|l3_process
op_star
id|pc
op_assign
id|arg
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pc
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pr
op_eq
(paren
id|CC_SETUP
op_or
id|INDICATION
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chanp
op_assign
id|selectfreechannel
c_func
(paren
id|pc-&gt;st
comma
id|pc-&gt;para.bchannel
)paren
)paren
)paren
(brace
id|pc-&gt;para.cause
op_assign
l_int|0x11
suffix:semicolon
multiline_comment|/* User busy */
id|pc-&gt;st-&gt;lli
dot
id|l4l3
c_func
(paren
id|pc-&gt;st
comma
id|CC_REJECT
op_or
id|REQUEST
comma
id|pc
)paren
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;proc
op_assign
id|pc
suffix:semicolon
id|pc-&gt;chan
op_assign
id|chanp
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chanp
op_assign
id|pc-&gt;chan
)paren
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|CC_MORE_INFO
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_DISCONNECT
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DISCONNECT_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SUSPEND
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RESUME
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RESUME_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_COMPL
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CMPL_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_CHARGE
op_or
id|INDICATION
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_CINF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_NOSETUP_RSP
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_NOSETUP_RSP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_ERR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_CONNECT_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_CONNECT_ERR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_ERR
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_PROCEED_SEND
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|CC_PROCEEDING
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|CC_ALERTING
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|CC_PROGRESS
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|CC_NOTIFY
op_or
id|INDICATION
)paren
suffix:colon
r_break
suffix:semicolon
r_case
(paren
id|CC_REDIR
op_or
id|INDICATION
)paren
suffix:colon
id|stat_redir_result
c_func
(paren
id|cs
comma
id|chanp-&gt;chan
comma
id|pc-&gt;redir_result
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
(brace
id|HiSax_putstatus
c_func
(paren
id|chanp-&gt;cs
comma
l_string|&quot;Ch&quot;
comma
l_string|&quot;%d L3-&gt;L4 unknown primitiv %#x&quot;
comma
id|chanp-&gt;chan
comma
id|pr
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|dummy_pstack
id|dummy_pstack
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;call to dummy_pstack pr=%04x arg %lx&bslash;n&quot;
comma
id|pr
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_PStack
id|init_PStack
c_func
(paren
r_struct
id|PStack
op_star
op_star
id|stp
)paren
(brace
op_star
id|stp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|PStack
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|next
op_assign
l_int|NULL
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l1.l1l2
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l1.l1hw
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l1.l1tei
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l2.l2tei
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l2.l2l1
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l2.l2l3
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l3.l3l2
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l3.l3ml3
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|l3.l3l4
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|lli.l4l3
op_assign
id|dummy_pstack
suffix:semicolon
(paren
op_star
id|stp
)paren
op_member_access_from_pointer
id|ma.layer
op_assign
id|dummy_pstack
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_d_st
id|init_d_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
r_struct
id|PStack
op_star
id|st
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|chanp-&gt;cs
suffix:semicolon
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|init_PStack
c_func
(paren
op_amp
id|chanp-&gt;d_st
)paren
suffix:semicolon
id|st
op_assign
id|chanp-&gt;d_st
suffix:semicolon
id|st-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|HiSax_addlist
c_func
(paren
id|cs
comma
id|st
)paren
suffix:semicolon
id|setstack_HiSax
c_func
(paren
id|st
comma
id|cs
)paren
suffix:semicolon
id|st-&gt;l2.sap
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.tei
op_assign
op_minus
l_int|1
suffix:semicolon
id|st-&gt;l2.flag
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_MOD128
comma
op_amp
id|st-&gt;l2.flag
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_LAPD
comma
op_amp
id|st-&gt;l2.flag
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_ORIG
comma
op_amp
id|st-&gt;l2.flag
)paren
suffix:semicolon
id|st-&gt;l2.maxlen
op_assign
id|MAX_DFRAME_LEN
suffix:semicolon
id|st-&gt;l2.window
op_assign
l_int|1
suffix:semicolon
id|st-&gt;l2.T200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds  */
id|st-&gt;l2.N200
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* try 3 times        */
id|st-&gt;l2.T203
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10000 milliseconds */
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;DCh%d Q.921 &quot;
comma
id|chanp-&gt;chan
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;DCh Q.921 &quot;
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|setstack_l3dc
c_func
(paren
id|st
comma
id|chanp
)paren
suffix:semicolon
id|st-&gt;lli.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;lli.l2writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;l3.l3l4
op_assign
id|dchan_l3l4
suffix:semicolon
)brace
r_static
r_void
DECL|function|callc_debug
id|callc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Ch%d callc &quot;
comma
id|chanp-&gt;chan
)paren
suffix:semicolon
id|VHiSax_putstatus
c_func
(paren
id|chanp-&gt;cs
comma
id|tmp
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_chan
id|init_chan
c_func
(paren
r_int
id|chan
comma
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|chan
suffix:semicolon
id|chanp-&gt;cs
op_assign
id|csta
suffix:semicolon
id|chanp-&gt;bcs
op_assign
id|csta-&gt;bcs
op_plus
id|chan
suffix:semicolon
id|chanp-&gt;chan
op_assign
id|chan
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;Flags
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;leased
op_assign
l_int|0
suffix:semicolon
id|init_PStack
c_func
(paren
op_amp
id|chanp-&gt;b_st
)paren
suffix:semicolon
id|chanp-&gt;b_st-&gt;l1.delay
op_assign
id|DEFAULT_B_DELAY
suffix:semicolon
id|chanp-&gt;fi.fsm
op_assign
op_amp
id|callcfsm
suffix:semicolon
id|chanp-&gt;fi.state
op_assign
id|ST_NULL
suffix:semicolon
id|chanp-&gt;fi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;fi.userdata
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;fi.printdebug
op_assign
id|callc_debug
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
op_amp
id|chanp-&gt;dial_timer
)paren
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
op_amp
id|chanp-&gt;drel_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan
op_logical_or
(paren
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|csta-&gt;HW_Flags
)paren
op_logical_and
id|chan
OL
l_int|2
)paren
)paren
(brace
id|init_d_st
c_func
(paren
id|chanp
)paren
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;d_st
op_assign
id|csta-&gt;channel-&gt;d_st
suffix:semicolon
)brace
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|CallcNewChan
id|CallcNewChan
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_int
id|i
suffix:semicolon
id|chancount
op_add_assign
l_int|2
suffix:semicolon
id|init_chan
c_func
(paren
l_int|0
comma
id|csta
)paren
suffix:semicolon
id|init_chan
c_func
(paren
l_int|1
comma
id|csta
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: 2 channels added&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_WAITING_CALLS
suffix:semicolon
id|i
op_increment
)paren
id|init_chan
c_func
(paren
id|i
op_plus
l_int|2
comma
id|csta
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: MAX_WAITING_CALLS added&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_PTP
comma
op_amp
id|csta-&gt;channel-&gt;d_st-&gt;l2.flag
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;LAYER2 WATCHING ESTABLISH&bslash;n&quot;
)paren
suffix:semicolon
id|csta-&gt;channel-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|csta-&gt;channel-&gt;d_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_d_st
id|release_d_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|chanp-&gt;d_st
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|st
)paren
r_return
suffix:semicolon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
id|releasestack_isdnl3
c_func
(paren
id|st
)paren
suffix:semicolon
id|HiSax_rmlist
c_func
(paren
id|st-&gt;l1.hardware
comma
id|st
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|st
)paren
suffix:semicolon
id|chanp-&gt;d_st
op_assign
l_int|NULL
suffix:semicolon
)brace
r_void
DECL|function|CallcFreeChan
id|CallcFreeChan
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|drel_timer
comma
l_int|74
)paren
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|dial_timer
comma
l_int|75
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_logical_or
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|csta-&gt;HW_Flags
)paren
)paren
id|release_d_st
c_func
(paren
id|csta-&gt;channel
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|b_st
)paren
(brace
id|release_b_st
c_func
(paren
id|csta-&gt;channel
op_plus
id|i
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|b_st
)paren
suffix:semicolon
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|b_st
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CallcFreeChan b_st ch%d allready freed&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_logical_or
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|csta-&gt;HW_Flags
)paren
)paren
(brace
id|release_d_st
c_func
(paren
id|csta-&gt;channel
op_plus
id|i
)paren
suffix:semicolon
)brace
r_else
id|csta-&gt;channel
(braket
id|i
)braket
dot
id|d_st
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lldata_handler
id|lldata_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;lli.userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_DATA
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;lldata: %d&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|rcvcallb_skb
c_func
(paren
id|chanp-&gt;cs-&gt;myid
comma
id|chanp-&gt;chan
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;lldata: channel not open&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|DL_ESTABLISH
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|DL_ESTABLISH
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_EST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|DL_RELEASE
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_REL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lldata_handler unknown primitive %#x&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lltrans_handler
id|lltrans_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;lli.userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|INDICATION
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;lltrans: %d&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|rcvcallb_skb
c_func
(paren
id|chanp-&gt;cs-&gt;myid
comma
id|chanp-&gt;chan
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;lltrans: channel not open&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|PH_ACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_EST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_REL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lltrans_handler unknown primitive %#x&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ll_writewakeup
id|ll_writewakeup
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|len
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|st-&gt;lli.userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;llwakeup: %d&quot;
comma
id|len
)paren
suffix:semicolon
id|ic.driver
op_assign
id|chanp-&gt;cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|ic.parm.length
op_assign
id|len
suffix:semicolon
id|chanp-&gt;cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_b_st
id|init_b_st
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|incoming
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
id|chanp-&gt;b_st
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|chanp-&gt;cs
suffix:semicolon
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|st-&gt;l1.hardware
op_assign
id|cs
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;leased
)paren
id|st-&gt;l1.bc
op_assign
id|chanp-&gt;chan
op_amp
l_int|1
suffix:semicolon
r_else
id|st-&gt;l1.bc
op_assign
id|chanp-&gt;proc-&gt;para.bchannel
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
id|st-&gt;l1.mode
op_assign
id|L1_MODE_HDLC
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC_56K
)paren
suffix:colon
id|st-&gt;l1.mode
op_assign
id|L1_MODE_HDLC_56K
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|st-&gt;l1.mode
op_assign
id|L1_MODE_TRANS
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_MODEM
)paren
suffix:colon
id|st-&gt;l1.mode
op_assign
id|L1_MODE_V32
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_FAX
)paren
suffix:colon
id|st-&gt;l1.mode
op_assign
id|L1_MODE_FAX
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chanp-&gt;bcs-&gt;conmsg
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;bcs
op_member_access_from_pointer
id|BC_SetStack
c_func
(paren
id|st
comma
id|chanp-&gt;bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l2.flag
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_LAPB
comma
op_amp
id|st-&gt;l2.flag
)paren
suffix:semicolon
id|st-&gt;l2.maxlen
op_assign
id|MAX_DATA_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|incoming
)paren
id|test_and_set_bit
c_func
(paren
id|FLG_ORIG
comma
op_amp
id|st-&gt;l2.flag
)paren
suffix:semicolon
id|st-&gt;l2.T200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds */
id|st-&gt;l2.window
op_assign
l_int|7
suffix:semicolon
id|st-&gt;l2.N200
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* try 4 times       */
id|st-&gt;l2.T203
op_assign
l_int|5000
suffix:semicolon
multiline_comment|/* 5000 milliseconds */
id|st-&gt;l3.debug
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Ch%d X.75&quot;
comma
id|chanp-&gt;chan
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|setstack_l3bc
c_func
(paren
id|st
comma
id|chanp
)paren
suffix:semicolon
id|st-&gt;l2.l2l3
op_assign
id|lldata_handler
suffix:semicolon
id|st-&gt;lli.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;lli.l1writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;lli.l2writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l2.l2m.debug
op_assign
id|chanp-&gt;debug
op_amp
l_int|16
suffix:semicolon
id|st-&gt;l2.debug
op_assign
id|chanp-&gt;debug
op_amp
l_int|64
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_HDLC_56K
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_MODEM
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_FAX
)paren
suffix:colon
id|st-&gt;l1.l1l2
op_assign
id|lltrans_handler
suffix:semicolon
id|st-&gt;lli.userdata
op_assign
id|chanp
suffix:semicolon
id|st-&gt;lli.l1writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|setstack_transl2
c_func
(paren
id|st
)paren
suffix:semicolon
id|setstack_l3bc
c_func
(paren
id|st
comma
id|chanp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|test_and_set_bit
c_func
(paren
id|FLG_START_B
comma
op_amp
id|chanp-&gt;Flags
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|leased_l4l3
id|leased_l4l3
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;lli.userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;leased line d-channel DATA&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_ESTABLISH
op_or
id|REQUEST
)paren
suffix:colon
id|st-&gt;l2
dot
id|l2l1
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
op_or
id|REQUEST
)paren
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;transd_l4l3 unknown primitive %#x&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|leased_l1l2
id|leased_l1l2
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;lli.userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|i
comma
id|event
op_assign
id|EV_LEASED_REL
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|INDICATION
)paren
suffix:colon
id|link_debug
c_func
(paren
id|chanp
comma
l_int|0
comma
l_string|&quot;leased line d-channel DATA&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|PH_ACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|event
op_assign
id|EV_LEASED
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|INDICATION
)paren
suffix:colon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|chanp-&gt;cs-&gt;HW_Flags
)paren
)paren
id|i
op_assign
l_int|1
suffix:semicolon
r_else
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
l_int|2
)paren
(brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|event
comma
l_int|NULL
)paren
suffix:semicolon
id|chanp
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;transd_l1l2 unknown primitive %#x&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|distr_debug
id|distr_debug
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|csta
comma
r_int
id|debugflags
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|csta-&gt;channel
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|2
op_plus
id|MAX_WAITING_CALLS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|chanp
(braket
id|i
)braket
dot
id|debug
op_assign
id|debugflags
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|fi.debug
op_assign
id|debugflags
op_amp
l_int|2
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|d_st-&gt;l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|8
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|0x10
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|d_st-&gt;l2.debug
op_assign
id|debugflags
op_amp
l_int|0x20
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;l2.debug
op_assign
id|debugflags
op_amp
l_int|0x40
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|d_st-&gt;l3.l3m.debug
op_assign
id|debugflags
op_amp
l_int|0x80
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;l3.l3m.debug
op_assign
id|debugflags
op_amp
l_int|0x100
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;ma.tei_m.debug
op_assign
id|debugflags
op_amp
l_int|0x200
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;ma.debug
op_assign
id|debugflags
op_amp
l_int|0x200
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|d_st-&gt;l1.l1m.debug
op_assign
id|debugflags
op_amp
l_int|0x1000
suffix:semicolon
id|chanp
(braket
id|i
)braket
dot
id|b_st-&gt;l1.l1m.debug
op_assign
id|debugflags
op_amp
l_int|0x2000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debugflags
op_amp
l_int|4
)paren
id|csta-&gt;debug
op_or_assign
id|DEB_DLOG_HEX
suffix:semicolon
r_else
id|csta-&gt;debug
op_and_assign
op_complement
id|DEB_DLOG_HEX
suffix:semicolon
)brace
DECL|variable|tmpbuf
r_static
r_char
id|tmpbuf
(braket
l_int|256
)braket
suffix:semicolon
r_static
r_void
DECL|function|capi_debug
id|capi_debug
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
id|capi_msg
op_star
id|cm
)paren
(brace
r_char
op_star
id|t
op_assign
id|tmpbuf
suffix:semicolon
id|t
op_add_assign
id|QuickHex
c_func
(paren
id|t
comma
(paren
id|u_char
op_star
)paren
id|cm
comma
(paren
id|cm-&gt;Length
OG
l_int|50
)paren
ques
c_cond
l_int|50
suffix:colon
id|cm-&gt;Length
)paren
suffix:semicolon
id|t
op_decrement
suffix:semicolon
op_star
id|t
op_assign
l_int|0
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|chanp-&gt;cs
comma
l_string|&quot;Ch&quot;
comma
l_string|&quot;%d CAPIMSG %s&quot;
comma
id|chanp-&gt;chan
comma
id|tmpbuf
)paren
suffix:semicolon
)brace
r_void
DECL|function|lli_got_fac_req
id|lli_got_fac_req
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
id|capi_msg
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
(paren
id|cm-&gt;para
(braket
l_int|0
)braket
op_ne
l_int|3
)paren
op_logical_or
(paren
id|cm-&gt;para
(braket
l_int|1
)braket
op_ne
l_int|0
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;para
(braket
l_int|2
)braket
OL
l_int|3
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;para
(braket
l_int|4
)braket
op_ne
l_int|0
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|cm-&gt;para
(braket
l_int|3
)braket
)paren
(brace
r_case
l_int|4
suffix:colon
multiline_comment|/* Suspend */
id|strncpy
c_func
(paren
id|chanp-&gt;setup.phone
comma
op_amp
id|cm-&gt;para
(braket
l_int|5
)braket
comma
id|cm-&gt;para
(braket
l_int|5
)braket
op_plus
l_int|1
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SUSPEND
comma
id|cm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Resume */
id|strncpy
c_func
(paren
id|chanp-&gt;setup.phone
comma
op_amp
id|cm-&gt;para
(braket
l_int|5
)braket
comma
id|cm-&gt;para
(braket
l_int|5
)braket
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;fi.state
op_eq
id|ST_NULL
)paren
(brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RESUME
comma
id|cm
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|72
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|80
comma
id|EV_RESUME
comma
id|cm
comma
l_int|73
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|lli_got_manufacturer
id|lli_got_manufacturer
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|capi_msg
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
(paren
id|cs-&gt;typ
op_eq
id|ISDN_CTYPE_ELSA
)paren
op_logical_or
(paren
id|cs-&gt;typ
op_eq
id|ISDN_CTYPE_ELSA_PNP
)paren
op_logical_or
(paren
id|cs-&gt;typ
op_eq
id|ISDN_CTYPE_ELSA_PCI
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.MFlag
)paren
(brace
id|cs
op_member_access_from_pointer
id|cardmsg
c_func
(paren
id|cs
comma
id|CARD_AUX_IND
comma
id|cm-&gt;para
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/***************************************************************/
multiline_comment|/* Limit the available number of channels for the current card */
multiline_comment|/***************************************************************/
r_static
r_int
DECL|function|set_channel_limit
id|set_channel_limit
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chanmax
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
r_int
id|i
comma
id|ii
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chanmax
OL
l_int|0
)paren
op_logical_or
(paren
id|chanmax
OG
l_int|2
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cs-&gt;chanlimit
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|ii
op_assign
l_int|0
suffix:semicolon
id|ii
OL
l_int|2
suffix:semicolon
id|ii
op_increment
)paren
(brace
id|ic.driver
op_assign
id|cs-&gt;myid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DISCH
suffix:semicolon
id|ic.arg
op_assign
id|ii
suffix:semicolon
r_if
c_cond
(paren
id|ii
op_ge
id|chanmax
)paren
id|ic.parm.num
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disabled */
r_else
id|ic.parm.num
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* enabled */
id|i
op_assign
id|cs-&gt;iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ii
OL
id|chanmax
)paren
id|cs-&gt;chanlimit
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set_channel_limit */
r_int
DECL|function|HiSax_command
id|HiSax_command
c_func
(paren
id|isdn_ctrl
op_star
id|ic
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|hisax_findcard
c_func
(paren
id|ic-&gt;driver
)paren
suffix:semicolon
r_struct
id|PStack
op_star
id|st
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u_int
id|num
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csta
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax: if_command %d called with invalid driverId %d!&bslash;n&quot;
comma
id|ic-&gt;command
comma
id|ic-&gt;driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ic-&gt;command
)paren
(brace
r_case
(paren
id|ISDN_CMD_SETEAZ
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_SETL2
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;SETL2 card %d %ld&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|ic-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
id|chanp-&gt;l2_protocol
op_assign
id|ic-&gt;arg
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_SETL3
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;SETL3 card %d %ld&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|ic-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
id|chanp-&gt;l3_protocol
op_assign
id|ic-&gt;arg
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_DIAL
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;DIAL %s -&gt; %s (%d,%d)&quot;
comma
id|ic-&gt;parm.setup.eazmsn
comma
id|ic-&gt;parm.setup.phone
comma
id|ic-&gt;parm.setup.si1
comma
id|ic-&gt;parm.setup.si2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|chanp-&gt;setup
comma
op_amp
id|ic-&gt;parm.setup
comma
r_sizeof
(paren
id|setup_parm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|chanp-&gt;setup.eazmsn
comma
l_string|&quot;0&quot;
)paren
)paren
id|chanp-&gt;setup.eazmsn
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* this solution is dirty and may be change, if&n;&t;&t;&t; * we make a callreference based callmanager */
r_if
c_cond
(paren
id|chanp-&gt;fi.state
op_eq
id|ST_NULL
)paren
(brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DIAL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmDelTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|70
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|chanp-&gt;dial_timer
comma
l_int|50
comma
id|EV_DIAL
comma
l_int|NULL
comma
l_int|71
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTB
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;ACCEPTB&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTB
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTD
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|chanp-&gt;setup
comma
op_amp
id|ic-&gt;parm.setup
comma
r_sizeof
(paren
id|setup_parm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;ACCEPTD&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTD
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_HANGUP
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;HANGUP&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_HANGUP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CAPI_PUT_MESSAGE
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|capi_debug
c_func
(paren
id|chanp
comma
op_amp
id|ic-&gt;parm.cmsg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ic-&gt;parm.cmsg.Length
OL
l_int|8
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|ic-&gt;parm.cmsg.Command
)paren
(brace
r_case
id|CAPI_FACILITY
suffix:colon
r_if
c_cond
(paren
id|ic-&gt;parm.cmsg.Subcommand
op_eq
id|CAPI_REQ
)paren
id|lli_got_fac_req
c_func
(paren
id|chanp
comma
op_amp
id|ic-&gt;parm.cmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPI_MANUFACTURER
suffix:colon
r_if
c_cond
(paren
id|ic-&gt;parm.cmsg.Subcommand
op_eq
id|CAPI_REQ
)paren
id|lli_got_manufacturer
c_func
(paren
id|chanp
comma
id|csta
comma
op_amp
id|ic-&gt;parm.cmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_LOCK
)paren
suffix:colon
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|debug
op_amp
l_int|0x400
)paren
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;   LOCK &quot;
comma
l_string|&quot;modcnt %lx&quot;
comma
id|MOD_USE_COUNT
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_UNLOCK
)paren
suffix:colon
id|HiSax_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_if
c_cond
(paren
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|debug
op_amp
l_int|0x400
)paren
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot; UNLOCK &quot;
comma
l_string|&quot;modcnt %lx&quot;
comma
id|MOD_USE_COUNT
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_IOCTL
)paren
suffix:colon
r_switch
c_cond
(paren
id|ic-&gt;arg
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|HiSax_reportcard
c_func
(paren
id|csta-&gt;cardnr
comma
id|num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|distr_debug
c_func
(paren
id|csta
comma
id|num
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;debugging flags &quot;
comma
l_string|&quot;card %d set to %x&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|b_st-&gt;l1.delay
op_assign
id|num
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|1
)braket
dot
id|b_st-&gt;l1.delay
op_assign
id|num
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;delay &quot;
comma
l_string|&quot;card %d set to %d ms&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: delay card %d set to %d ms&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|3
)paren
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|i
op_increment
)paren
id|HiSax_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|4
)paren
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|i
op_increment
)paren
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|5
)paren
suffix:colon
multiline_comment|/* set card in leased mode */
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
r_if
c_cond
(paren
(paren
id|num
OL
l_int|1
)paren
op_logical_or
(paren
id|num
OG
l_int|2
)paren
)paren
(brace
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;Set LEASED &quot;
comma
l_string|&quot;wrong channel %d&quot;
comma
id|num
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: Set LEASED wrong channel %d&bslash;n&quot;
comma
id|num
)paren
suffix:semicolon
)brace
r_else
(brace
id|num
op_decrement
suffix:semicolon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|num
suffix:semicolon
id|chanp-&gt;leased
op_assign
l_int|1
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;Card&quot;
comma
l_string|&quot;%d channel %d set leased mode&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|num
op_plus
l_int|1
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;l1.l1l2
op_assign
id|leased_l1l2
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli.l4l3
op_assign
id|leased_l4l3
suffix:semicolon
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
l_int|6
)paren
suffix:colon
multiline_comment|/* set B-channel test loop */
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
r_if
c_cond
(paren
id|csta-&gt;stlist
)paren
id|csta-&gt;stlist-&gt;l2
dot
id|l2l1
c_func
(paren
id|csta-&gt;stlist
comma
id|PH_TESTLOOP
op_or
id|REQUEST
comma
(paren
r_void
op_star
)paren
(paren
r_int
)paren
id|num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|7
)paren
suffix:colon
multiline_comment|/* set card in PTP mode */
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_TWO_DCHAN
comma
op_amp
id|csta-&gt;HW_Flags
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax PTP mode only with one TEI possible&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|num
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|FLG_PTP
comma
op_amp
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l2.flag
)paren
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|FLG_FIXED_TEI
comma
op_amp
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l2.flag
)paren
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l2.tei
op_assign
l_int|0
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;set card &quot;
comma
l_string|&quot;in PTP mode&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: set card in PTP mode&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;LAYER2 WATCHING ESTABLISH&bslash;n&quot;
)paren
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_PTP
comma
op_amp
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l2.flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|FLG_FIXED_TEI
comma
op_amp
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l2.flag
)paren
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;set card &quot;
comma
l_string|&quot;in PTMP mode&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: set card in PTMP mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
l_int|8
)paren
suffix:colon
multiline_comment|/* set card in FIXED TEI mode */
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
(paren
id|num
op_amp
l_int|1
)paren
suffix:semicolon
id|num
op_assign
id|num
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|num
op_eq
l_int|127
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|FLG_FIXED_TEI
comma
op_amp
id|chanp-&gt;d_st-&gt;l2.flag
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;l2.tei
op_assign
op_minus
l_int|1
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;set card &quot;
comma
l_string|&quot;in VAR TEI mode&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: set card in VAR TEI mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|test_and_set_bit
c_func
(paren
id|FLG_FIXED_TEI
comma
op_amp
id|chanp-&gt;d_st-&gt;l2.flag
)paren
suffix:semicolon
id|chanp-&gt;d_st-&gt;l2.tei
op_assign
id|num
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|csta
comma
l_string|&quot;set card &quot;
comma
l_string|&quot;in FIXED TEI (%d) mode&quot;
comma
id|num
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: set card in FIXED TEI (%d) mode&bslash;n&quot;
comma
id|num
)paren
suffix:semicolon
)brace
id|chanp-&gt;d_st-&gt;lli
dot
id|l4l3
c_func
(paren
id|chanp-&gt;d_st
comma
id|DL_ESTABLISH
op_or
id|REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef MODULE
r_case
(paren
l_int|55
)paren
suffix:colon
id|MOD_USE_COUNT
op_assign
l_int|0
suffix:semicolon
id|HiSax_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* MODULE */
r_case
(paren
l_int|11
)paren
suffix:colon
id|num
op_assign
id|csta-&gt;debug
op_amp
id|DEB_DLOG_HEX
suffix:semicolon
id|csta-&gt;debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|csta-&gt;debug
op_or_assign
id|num
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|cards
(braket
l_int|0
)braket
dot
id|cs
comma
l_string|&quot;l1 debugging &quot;
comma
l_string|&quot;flags card %d set to %x&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|csta-&gt;debug
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: l1 debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
id|csta-&gt;debug
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|13
)paren
suffix:colon
id|csta-&gt;channel
(braket
l_int|0
)braket
dot
id|d_st-&gt;l3.debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|csta-&gt;channel
(braket
l_int|1
)braket
dot
id|d_st-&gt;l3.debug
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
id|HiSax_putstatus
c_func
(paren
id|cards
(braket
l_int|0
)braket
dot
id|cs
comma
l_string|&quot;l3 debugging &quot;
comma
l_string|&quot;flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: l3 debugging flags card %d set to %x&bslash;n&quot;
comma
id|csta-&gt;cardnr
op_plus
l_int|1
comma
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|10
)paren
suffix:colon
id|i
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;parm.num
suffix:semicolon
r_return
id|set_channel_limit
c_func
(paren
id|csta
comma
id|i
)paren
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|csta-&gt;auxcmd
)paren
r_return
id|csta
op_member_access_from_pointer
id|auxcmd
c_func
(paren
id|csta
comma
id|ic
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;HiSax: invalid ioclt %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|ic-&gt;arg
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_PROCEED
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;PROCEED&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_PROCEED
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ALERT
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;ALERT&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ALERT
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_REDIR
)paren
suffix:colon
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;REDIR&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|chanp-&gt;setup
comma
op_amp
id|ic-&gt;parm.setup
comma
r_sizeof
(paren
id|setup_parm
)paren
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_REDIR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* protocol specific io commands */
r_case
(paren
id|ISDN_CMD_PROT_IO
)paren
suffix:colon
r_for
c_loop
(paren
id|st
op_assign
id|csta-&gt;stlist
suffix:semicolon
id|st
suffix:semicolon
id|st
op_assign
id|st-&gt;next
)paren
r_if
c_cond
(paren
id|st-&gt;protocol
op_eq
(paren
id|ic-&gt;arg
op_amp
l_int|0xFF
)paren
)paren
r_return
id|st-&gt;lli
dot
id|l4l3_proto
c_func
(paren
id|st
comma
id|ic
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|csta-&gt;auxcmd
)paren
r_return
id|csta
op_member_access_from_pointer
id|auxcmd
c_func
(paren
id|csta
comma
id|ic
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|HiSax_writebuf_skb
id|HiSax_writebuf_skb
c_func
(paren
r_int
id|id
comma
r_int
id|chan
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|csta
op_assign
id|hisax_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_struct
id|PStack
op_star
id|st
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|nskb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|csta
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;HiSax: if_sendbuf called with invalid driverId!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|chanp
op_assign
id|csta-&gt;channel
op_plus
id|chan
suffix:semicolon
id|st
op_assign
id|chanp-&gt;b_st
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chanp-&gt;data_open
)paren
(brace
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;writebuf: channel not open&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
id|MAX_DATA_SIZE
)paren
(brace
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;writebuf: packet too large (%d bytes)&quot;
comma
id|len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax_writebuf: packet too large (%d bytes) !&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
(paren
id|len
op_plus
id|chanp-&gt;bcs-&gt;tx_cnt
)paren
OG
id|MAX_DATA_MEM
)paren
(brace
multiline_comment|/* Must return 0 here, since this is not an error&n;&t;&t;&t; * but a temporary lack of resources.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;writebuf: no buffers for %d bytes&quot;
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|0x800
)paren
id|link_debug
c_func
(paren
id|chanp
comma
l_int|1
comma
l_string|&quot;writebuf %d/%d/%d&quot;
comma
id|len
comma
id|chanp-&gt;bcs-&gt;tx_cnt
comma
id|MAX_DATA_MEM
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|nskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nskb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ack
)paren
id|nskb-&gt;pkt_type
op_assign
id|PACKET_NOACK
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;l2_active_protocol
op_eq
id|ISDN_PROTO_L2_X75I
)paren
id|st-&gt;l3
dot
id|l3l2
c_func
(paren
id|st
comma
id|DL_DATA
op_or
id|REQUEST
comma
id|nskb
)paren
suffix:semicolon
r_else
(brace
id|chanp-&gt;bcs-&gt;tx_cnt
op_add_assign
id|len
suffix:semicolon
id|st-&gt;l2
dot
id|l2l1
c_func
(paren
id|st
comma
id|PH_DATA
op_or
id|REQUEST
comma
id|nskb
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|len
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
eof
