multiline_comment|/* $Id: elsa_ser.c,v 2.10 2000/11/19 17:02:47 kai Exp $&n; *&n; * stuff for the serial modem on ELSA cards&n; *&n; * This file is (c) under GNU PUBLIC LICENSE&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/serial_reg.h&gt;
DECL|macro|MAX_MODEM_BUF
mdefine_line|#define MAX_MODEM_BUF&t;256
DECL|macro|WAKEUP_CHARS
mdefine_line|#define WAKEUP_CHARS&t;(MAX_MODEM_BUF/2)
DECL|macro|RS_ISR_PASS_LIMIT
mdefine_line|#define RS_ISR_PASS_LIMIT 256
DECL|macro|BASE_BAUD
mdefine_line|#define BASE_BAUD ( 1843200 / 16 )
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b)&t;((a) &lt; (b) ? (a) : (b))
macro_line|#endif
singleline_comment|//#define SERIAL_DEBUG_OPEN 1
singleline_comment|//#define SERIAL_DEBUG_INTR 1
singleline_comment|//#define SERIAL_DEBUG_FLOW 1
DECL|macro|SERIAL_DEBUG_OPEN
macro_line|#undef SERIAL_DEBUG_OPEN
DECL|macro|SERIAL_DEBUG_INTR
macro_line|#undef SERIAL_DEBUG_INTR
DECL|macro|SERIAL_DEBUG_FLOW
macro_line|#undef SERIAL_DEBUG_FLOW
DECL|macro|SERIAL_DEBUG_REG
macro_line|#undef SERIAL_DEBUG_REG
singleline_comment|//#define SERIAL_DEBUG_REG 1
macro_line|#ifdef SERIAL_DEBUG_REG
DECL|variable|deb
r_static
id|u_char
id|deb
(braket
l_int|32
)braket
suffix:semicolon
DECL|variable|ModemIn
r_const
r_char
op_star
id|ModemIn
(braket
)braket
op_assign
(brace
l_string|&quot;RBR&quot;
comma
l_string|&quot;IER&quot;
comma
l_string|&quot;IIR&quot;
comma
l_string|&quot;LCR&quot;
comma
l_string|&quot;MCR&quot;
comma
l_string|&quot;LSR&quot;
comma
l_string|&quot;MSR&quot;
comma
l_string|&quot;SCR&quot;
)brace
suffix:semicolon
DECL|variable|ModemOut
r_const
r_char
op_star
id|ModemOut
(braket
)braket
op_assign
(brace
l_string|&quot;THR&quot;
comma
l_string|&quot;IER&quot;
comma
l_string|&quot;FCR&quot;
comma
l_string|&quot;LCR&quot;
comma
l_string|&quot;MCR&quot;
comma
l_string|&quot;LSR&quot;
comma
l_string|&quot;MSR&quot;
comma
l_string|&quot;SCR&quot;
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|MInit_1
r_static
r_char
op_star
id|MInit_1
op_assign
l_string|&quot;AT&amp;F&amp;C1E0&amp;D2&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_2
r_static
r_char
op_star
id|MInit_2
op_assign
l_string|&quot;ATL2M1S64=13&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_3
r_static
r_char
op_star
id|MInit_3
op_assign
l_string|&quot;AT+FCLASS=0&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_4
r_static
r_char
op_star
id|MInit_4
op_assign
l_string|&quot;ATV1S2=128X1&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_5
r_static
r_char
op_star
id|MInit_5
op_assign
l_string|&quot;AT&bslash;&bslash;V8&bslash;&bslash;N3&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_6
r_static
r_char
op_star
id|MInit_6
op_assign
l_string|&quot;ATL0M0&amp;G0%E1&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_7
r_static
r_char
op_star
id|MInit_7
op_assign
l_string|&quot;AT%L1%M0%C3&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_speed28800
r_static
r_char
op_star
id|MInit_speed28800
op_assign
l_string|&quot;AT%G0%B28800&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_dialout
r_static
r_char
op_star
id|MInit_dialout
op_assign
l_string|&quot;ATs7=60 x1 d&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|variable|MInit_dialin
r_static
r_char
op_star
id|MInit_dialin
op_assign
l_string|&quot;ATs7=60 x1 a&bslash;r&bslash;0&quot;
suffix:semicolon
DECL|function|serial_in
r_static
r_inline
r_int
r_int
id|serial_in
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|offset
)paren
(brace
macro_line|#ifdef SERIAL_DEBUG_REG
id|u_int
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;in   %s %02x&quot;
comma
id|ModemIn
(braket
id|offset
)braket
comma
id|val
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
macro_line|#else
r_return
id|inb
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|serial_inp
r_static
r_inline
r_int
r_int
id|serial_inp
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|offset
)paren
(brace
macro_line|#ifdef SERIAL_DEBUG_REG
macro_line|#ifdef CONFIG_SERIAL_NOPAUSE_IO
id|u_int
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;inp  %s %02x&quot;
comma
id|ModemIn
(braket
id|offset
)braket
comma
id|val
)paren
suffix:semicolon
macro_line|#else
id|u_int
id|val
op_assign
id|inb_p
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;inP  %s %02x&quot;
comma
id|ModemIn
(braket
id|offset
)braket
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
r_return
id|val
suffix:semicolon
macro_line|#else
macro_line|#ifdef CONFIG_SERIAL_NOPAUSE_IO
r_return
id|inb
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
macro_line|#else
r_return
id|inb_p
c_func
(paren
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
)brace
DECL|function|serial_out
r_static
r_inline
r_void
id|serial_out
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|offset
comma
r_int
id|value
)paren
(brace
macro_line|#ifdef SERIAL_DEBUG_REG
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;out  %s %02x&quot;
comma
id|ModemOut
(braket
id|offset
)braket
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|serial_outp
r_static
r_inline
r_void
id|serial_outp
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|offset
comma
r_int
id|value
)paren
(brace
macro_line|#ifdef SERIAL_DEBUG_REG
macro_line|#ifdef CONFIG_SERIAL_NOPAUSE_IO
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;outp %s %02x&quot;
comma
id|ModemOut
(braket
id|offset
)braket
comma
id|value
)paren
suffix:semicolon
macro_line|#else
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;outP %s %02x&quot;
comma
id|ModemOut
(braket
id|offset
)braket
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SERIAL_NOPAUSE_IO
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
macro_line|#else
id|outb_p
c_func
(paren
id|value
comma
id|cs-&gt;hw.elsa.base
op_plus
l_int|8
op_plus
id|offset
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * This routine is called to set the UART divisor registers to match&n; * the specified baud rate for a serial port.&n; */
DECL|function|change_speed
r_static
r_void
id|change_speed
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|baud
)paren
(brace
r_int
id|quot
op_assign
l_int|0
comma
id|baud_base
suffix:semicolon
r_int
id|cval
comma
id|fcr
op_assign
l_int|0
suffix:semicolon
r_int
id|bits
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* byte size and parity */
id|cval
op_assign
l_int|0x03
suffix:semicolon
id|bits
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Determine divisor based on baud rate */
id|baud_base
op_assign
id|BASE_BAUD
suffix:semicolon
id|quot
op_assign
id|baud_base
op_div
id|baud
suffix:semicolon
multiline_comment|/* If the quotient is ever zero, default to 9600 bps */
r_if
c_cond
(paren
op_logical_neg
id|quot
)paren
id|quot
op_assign
id|baud_base
op_div
l_int|9600
suffix:semicolon
multiline_comment|/* Set up FIFO&squot;s */
r_if
c_cond
(paren
(paren
id|baud_base
op_div
id|quot
)paren
OL
l_int|2400
)paren
id|fcr
op_assign
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_TRIGGER_1
suffix:semicolon
r_else
id|fcr
op_assign
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_TRIGGER_8
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_FCR
comma
id|fcr
)paren
suffix:semicolon
multiline_comment|/* CTS flow control flag and modem status interrupts */
id|cs-&gt;hw.elsa.IER
op_and_assign
op_complement
id|UART_IER_MSI
suffix:semicolon
id|cs-&gt;hw.elsa.IER
op_or_assign
id|UART_IER_MSI
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;modem quot=0x%x&quot;
comma
id|quot
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_LCR
comma
id|cval
op_or
id|UART_LCR_DLAB
)paren
suffix:semicolon
multiline_comment|/* set DLAB */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_DLL
comma
id|quot
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* LS of divisor */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_DLM
comma
id|quot
op_rshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/* MS of divisor */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_LCR
comma
id|cval
)paren
suffix:semicolon
multiline_comment|/* reset DLAB */
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_RX
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|mstartup
r_static
r_int
id|mstartup
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the FIFO buffers and disable them&n;&t; * (they will be reenabled in change_speed())&n;&t; */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_FCR
comma
(paren
id|UART_FCR_CLEAR_RCVR
op_or
id|UART_FCR_CLEAR_XMIT
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * At this point there&squot;s no way the LSR could still be 0xFF;&n;&t; * if it is, then bail out, because there&squot;s likely no UART&n;&t; * here.&n;&t; */
r_if
c_cond
(paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_LSR
)paren
op_eq
l_int|0xff
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|errout
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Clear the interrupt registers.&n;&t; */
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_RX
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_IIR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_MSR
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now, initialize the UART &n;&t; */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_LCR
comma
id|UART_LCR_WLEN8
)paren
suffix:semicolon
multiline_comment|/* reset DLAB */
id|cs-&gt;hw.elsa.MCR
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;hw.elsa.MCR
op_assign
id|UART_MCR_DTR
op_or
id|UART_MCR_RTS
op_or
id|UART_MCR_OUT2
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_MCR
comma
id|cs-&gt;hw.elsa.MCR
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Finally, enable interrupts&n;&t; */
id|cs-&gt;hw.elsa.IER
op_assign
id|UART_IER_MSI
op_or
id|UART_IER_RLSI
op_or
id|UART_IER_RDI
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
multiline_comment|/*&n;&t; * And clear the interrupt registers again for luck.&n;&t; */
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_LSR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_RX
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_IIR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_MSR
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transcnt
op_assign
id|cs-&gt;hw.elsa.transp
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;hw.elsa.rcvcnt
op_assign
id|cs-&gt;hw.elsa.rcvp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * and set the speed of the serial port&n;&t; */
id|change_speed
c_func
(paren
id|cs
comma
id|BASE_BAUD
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.MFlag
op_assign
l_int|1
suffix:semicolon
id|errout
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine will shutdown a serial port; interrupts are disabled, and&n; * DTR is dropped if the hangup on close termio flag is on.&n; */
DECL|function|mshutdown
r_static
r_void
id|mshutdown
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_OPEN
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Shutting down serial ....&quot;
)paren
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts */
multiline_comment|/*&n;&t; * clear delta_msr_wait queue to avoid mem leaks: we may free the irq&n;&t; * here so the queue might never be waken up&n;&t; */
id|cs-&gt;hw.elsa.IER
op_assign
l_int|0
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* disable all intrs */
id|cs-&gt;hw.elsa.MCR
op_and_assign
op_complement
id|UART_MCR_OUT2
suffix:semicolon
multiline_comment|/* disable break condition */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_LCR
comma
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_LCR
)paren
op_amp
op_complement
id|UART_LCR_SBC
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.MCR
op_and_assign
op_complement
(paren
id|UART_MCR_DTR
op_or
id|UART_MCR_RTS
)paren
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_MCR
comma
id|cs-&gt;hw.elsa.MCR
)paren
suffix:semicolon
multiline_comment|/* disable FIFO&squot;s */
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_FCR
comma
(paren
id|UART_FCR_CLEAR_RCVR
op_or
id|UART_FCR_CLEAR_XMIT
)paren
)paren
suffix:semicolon
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_RX
)paren
suffix:semicolon
multiline_comment|/* read data port to reset things */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_OPEN
id|printk
c_func
(paren
l_string|&quot; done&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_inline
r_int
DECL|function|write_modem
id|write_modem
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|count
comma
id|len
comma
id|fp
comma
id|buflen
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|buflen
op_assign
id|MAX_MODEM_BUF
op_minus
id|cs-&gt;hw.elsa.transcnt
suffix:semicolon
id|len
op_assign
id|MIN
c_func
(paren
id|buflen
comma
id|bcs-&gt;tx_skb-&gt;len
)paren
suffix:semicolon
id|fp
op_assign
id|cs-&gt;hw.elsa.transcnt
op_plus
id|cs-&gt;hw.elsa.transp
suffix:semicolon
id|fp
op_and_assign
(paren
id|MAX_MODEM_BUF
op_minus
l_int|1
)paren
suffix:semicolon
id|count
op_assign
id|MIN
c_func
(paren
id|len
comma
id|MAX_MODEM_BUF
op_minus
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|len
)paren
(brace
id|memcpy
c_func
(paren
id|cs-&gt;hw.elsa.transbuf
op_plus
id|fp
comma
id|bcs-&gt;tx_skb-&gt;data
comma
id|count
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|bcs-&gt;tx_skb
comma
id|count
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transcnt
op_add_assign
id|count
suffix:semicolon
id|ret
op_assign
id|count
suffix:semicolon
id|count
op_assign
id|len
op_minus
id|count
suffix:semicolon
id|fp
op_assign
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
(paren
id|cs-&gt;hw.elsa.transbuf
op_plus
id|fp
)paren
comma
id|bcs-&gt;tx_skb-&gt;data
comma
id|count
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|bcs-&gt;tx_skb
comma
id|count
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transcnt
op_add_assign
id|count
suffix:semicolon
id|ret
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transcnt
op_logical_and
op_logical_neg
(paren
id|cs-&gt;hw.elsa.IER
op_amp
id|UART_IER_THRI
)paren
)paren
(brace
id|cs-&gt;hw.elsa.IER
op_or_assign
id|UART_IER_THRI
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_inline
r_void
DECL|function|modem_fill
id|modem_fill
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb-&gt;len
)paren
(brace
id|write_modem
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;st-&gt;lli.l1writewakeup
op_logical_and
(paren
id|PACKET_NOACK
op_ne
id|bcs-&gt;tx_skb-&gt;pkt_type
)paren
)paren
id|bcs-&gt;st-&gt;lli
dot
id|l1writewakeup
c_func
(paren
id|bcs-&gt;st
comma
id|bcs-&gt;hw.hscx.count
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|bcs-&gt;tx_skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|bcs-&gt;hw.hscx.count
op_assign
l_int|0
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|write_modem
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|hscx_sched_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
)brace
)brace
DECL|function|receive_chars
r_static
r_inline
r_void
id|receive_chars
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
op_star
id|status
)paren
(brace
r_int
r_char
id|ch
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_do
(brace
id|ch
op_assign
id|serial_in
c_func
(paren
id|cs
comma
id|UART_RX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.rcvcnt
op_ge
id|MAX_MODEM_BUF
)paren
r_break
suffix:semicolon
id|cs-&gt;hw.elsa.rcvbuf
(braket
id|cs-&gt;hw.elsa.rcvcnt
op_increment
)braket
op_assign
id|ch
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;DR%02x:%02x...&quot;
comma
id|ch
comma
op_star
id|status
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_star
id|status
op_amp
(paren
id|UART_LSR_BI
op_or
id|UART_LSR_PE
op_or
id|UART_LSR_FE
op_or
id|UART_LSR_OE
)paren
)paren
(brace
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;handling exept....&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
op_star
id|status
op_assign
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_LSR
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|status
op_amp
id|UART_LSR_DR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.MFlag
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|cs-&gt;hw.elsa.rcvcnt
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ElsaSER: receive out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|cs-&gt;hw.elsa.rcvcnt
)paren
comma
id|cs-&gt;hw.elsa.rcvbuf
comma
id|cs-&gt;hw.elsa.rcvcnt
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|cs-&gt;hw.elsa.bcs-&gt;rqueue
comma
id|skb
)paren
suffix:semicolon
)brace
id|hscx_sched_event
c_func
(paren
id|cs-&gt;hw.elsa.bcs
comma
id|B_RCVBUFREADY
)paren
suffix:semicolon
)brace
r_else
(brace
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|t
op_assign
id|tmp
suffix:semicolon
id|t
op_add_assign
id|sprintf
c_func
(paren
id|t
comma
l_string|&quot;modem read cnt %d&quot;
comma
id|cs-&gt;hw.elsa.rcvcnt
)paren
suffix:semicolon
id|QuickHex
c_func
(paren
id|t
comma
id|cs-&gt;hw.elsa.rcvbuf
comma
id|cs-&gt;hw.elsa.rcvcnt
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
id|tmp
)paren
suffix:semicolon
)brace
id|cs-&gt;hw.elsa.rcvcnt
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|transmit_chars
r_static
r_inline
r_void
id|transmit_chars
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
op_star
id|intr_done
)paren
(brace
r_int
id|count
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;transmit_chars: p(%x) cnt(%x)&quot;
comma
id|cs-&gt;hw.elsa.transp
comma
id|cs-&gt;hw.elsa.transcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transcnt
op_le
l_int|0
)paren
(brace
id|cs-&gt;hw.elsa.IER
op_and_assign
op_complement
id|UART_IER_THRI
suffix:semicolon
id|serial_out
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|count
op_assign
l_int|16
suffix:semicolon
r_do
(brace
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_TX
comma
id|cs-&gt;hw.elsa.transbuf
(braket
id|cs-&gt;hw.elsa.transp
op_increment
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transp
op_ge
id|MAX_MODEM_BUF
)paren
id|cs-&gt;hw.elsa.transp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cs-&gt;hw.elsa.transcnt
op_le
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cs-&gt;hw.elsa.transcnt
OL
id|WAKEUP_CHARS
)paren
op_logical_and
(paren
id|cs-&gt;hw.elsa.MFlag
op_eq
l_int|2
)paren
)paren
id|modem_fill
c_func
(paren
id|cs-&gt;hw.elsa.bcs
)paren
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;THRE...&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|intr_done
)paren
op_star
id|intr_done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transcnt
op_le
l_int|0
)paren
(brace
id|cs-&gt;hw.elsa.IER
op_and_assign
op_complement
id|UART_IER_THRI
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
)brace
)brace
DECL|function|rs_interrupt_elsa
r_static
r_void
id|rs_interrupt_elsa
c_func
(paren
r_int
id|irq
comma
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|status
comma
id|iir
comma
id|msr
suffix:semicolon
r_int
id|pass_counter
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;rs_interrupt_single(%d)...&quot;
comma
id|irq
)paren
suffix:semicolon
macro_line|#endif
r_do
(brace
id|status
op_assign
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_LSR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;rs LSR %02x&quot;
comma
id|status
)paren
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;status = %x...&quot;
comma
id|status
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|status
op_amp
id|UART_LSR_DR
)paren
id|receive_chars
c_func
(paren
id|cs
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_LSR_THRE
)paren
id|transmit_chars
c_func
(paren
id|cs
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pass_counter
op_increment
OG
id|RS_ISR_PASS_LIMIT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;rs_single loop break.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|iir
op_assign
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_IIR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;rs IIR %02x&quot;
comma
id|iir
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|iir
op_amp
l_int|0xf
)paren
op_eq
l_int|0
)paren
(brace
id|msr
op_assign
id|serial_inp
c_func
(paren
id|cs
comma
id|UART_MSR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;rs MSR %02x&quot;
comma
id|msr
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|iir
op_amp
id|UART_IIR_NO_INT
)paren
)paren
suffix:semicolon
macro_line|#ifdef SERIAL_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;end.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_extern
r_int
id|open_hscxstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
suffix:semicolon
r_extern
r_void
id|modehscx
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bc
)paren
suffix:semicolon
r_extern
r_void
id|hscx_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
r_void
DECL|function|close_elsastate
id|close_elsastate
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|modehscx
c_func
(paren
id|bcs
comma
l_int|0
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;hw.hscx.rcvbuf
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;mode
op_ne
id|L1_MODE_MODEM
)paren
id|kfree
c_func
(paren
id|bcs-&gt;hw.hscx.rcvbuf
)paren
suffix:semicolon
id|bcs-&gt;hw.hscx.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
)paren
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
)paren
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|bcs-&gt;tx_skb
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|modem_write_cmd
id|modem_write_cmd
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|count
comma
id|fp
suffix:semicolon
id|u_char
op_star
id|msg
op_assign
id|buf
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
(paren
id|MAX_MODEM_BUF
op_minus
id|cs-&gt;hw.elsa.transcnt
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fp
op_assign
id|cs-&gt;hw.elsa.transcnt
op_plus
id|cs-&gt;hw.elsa.transp
suffix:semicolon
id|fp
op_and_assign
(paren
id|MAX_MODEM_BUF
op_minus
l_int|1
)paren
suffix:semicolon
id|count
op_assign
id|MIN
c_func
(paren
id|len
comma
id|MAX_MODEM_BUF
op_minus
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|len
)paren
(brace
id|memcpy
c_func
(paren
id|cs-&gt;hw.elsa.transbuf
op_plus
id|fp
comma
id|msg
comma
id|count
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transcnt
op_add_assign
id|count
suffix:semicolon
id|msg
op_add_assign
id|count
suffix:semicolon
id|count
op_assign
id|len
op_minus
id|count
suffix:semicolon
id|fp
op_assign
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|cs-&gt;hw.elsa.transbuf
op_plus
id|fp
comma
id|msg
comma
id|count
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transcnt
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transcnt
op_logical_and
op_logical_neg
(paren
id|cs-&gt;hw.elsa.IER
op_amp
id|UART_IER_THRI
)paren
)paren
(brace
id|cs-&gt;hw.elsa.IER
op_or_assign
id|UART_IER_THRI
suffix:semicolon
id|serial_outp
c_func
(paren
id|cs
comma
id|UART_IER
comma
id|cs-&gt;hw.elsa.IER
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|modem_set_init
id|modem_set_init
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
DECL|macro|RCV_DELAY
mdefine_line|#define RCV_DELAY 20000&t;
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_1
comma
id|strlen
c_func
(paren
id|MInit_1
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_2
comma
id|strlen
c_func
(paren
id|MInit_2
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_3
comma
id|strlen
c_func
(paren
id|MInit_3
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_4
comma
id|strlen
c_func
(paren
id|MInit_4
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_5
comma
id|strlen
c_func
(paren
id|MInit_5
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_6
comma
id|strlen
c_func
(paren
id|MInit_6
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_7
comma
id|strlen
c_func
(paren
id|MInit_7
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|modem_set_dial
id|modem_set_dial
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|outgoing
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
DECL|macro|RCV_DELAY
mdefine_line|#define RCV_DELAY 20000&t;
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_speed28800
comma
id|strlen
c_func
(paren
id|MInit_speed28800
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|outgoing
)paren
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_dialout
comma
id|strlen
c_func
(paren
id|MInit_dialout
)paren
)paren
suffix:semicolon
r_else
id|modem_write_cmd
c_func
(paren
id|cs
comma
id|MInit_dialin
comma
id|strlen
c_func
(paren
id|MInit_dialin
)paren
)paren
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
op_logical_and
id|cs-&gt;hw.elsa.transcnt
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;msi tout=%d&quot;
comma
id|timeout
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|RCV_DELAY
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|modem_l2l1
id|modem_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|pr
op_eq
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;l1.bcs-&gt;tx_skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|st-&gt;l1.bcs-&gt;squeue
comma
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|st-&gt;l1.bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;hw.hscx.count
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|write_modem
c_func
(paren
id|st-&gt;l1.bcs
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pr
op_eq
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
)paren
(brace
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1
dot
id|l1l2
c_func
(paren
id|st
comma
id|PH_ACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
id|set_arcofi
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|mstartup
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
)paren
suffix:semicolon
id|modem_set_dial
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
id|test_bit
c_func
(paren
id|FLG_ORIG
comma
op_amp
id|st-&gt;l2.flag
)paren
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs-&gt;hw.elsa.MFlag
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pr
op_eq
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
)paren
(brace
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs-&gt;dc.isac.arcofi_bc
op_assign
id|st-&gt;l1.bc
suffix:semicolon
id|arcofi_fsm
c_func
(paren
id|st-&gt;l1.bcs-&gt;cs
comma
id|ARCOFI_START
comma
op_amp
id|ARCOFI_XOP_0
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|st-&gt;l1.bcs-&gt;cs-&gt;dc.isac.arcofi_wait
)paren
suffix:semicolon
id|st-&gt;l1.bcs-&gt;cs-&gt;hw.elsa.MFlag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ElsaSer: unknown pr %x&bslash;n&quot;
comma
id|pr
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|setstack_elsa
id|setstack_elsa
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;l1.mode
)paren
(brace
r_case
id|L1_MODE_HDLC
suffix:colon
r_case
id|L1_MODE_TRANS
suffix:colon
r_if
c_cond
(paren
id|open_hscxstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|hscx_l2l1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_MODEM
suffix:colon
id|bcs-&gt;mode
op_assign
id|L1_MODE_MODEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|bcs-&gt;hw.hscx.rcvbuf
op_assign
id|bcs-&gt;cs-&gt;hw.elsa.rcvbuf
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;rqueue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|bcs-&gt;squeue
)paren
suffix:semicolon
)brace
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|bcs-&gt;Flag
)paren
suffix:semicolon
id|bcs-&gt;event
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hscx.rcvidx
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;cs-&gt;hw.elsa.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l2.l2l1
op_assign
id|modem_l2l1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|init_modem
id|init_modem
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_SetStack
op_assign
id|setstack_elsa
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_SetStack
op_assign
id|setstack_elsa
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|BC_Close
op_assign
id|close_elsastate
suffix:semicolon
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|BC_Close
op_assign
id|close_elsastate
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;hw.elsa.rcvbuf
op_assign
id|kmalloc
c_func
(paren
id|MAX_MODEM_BUF
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: No modem mem hw.elsa.rcvbuf&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cs-&gt;hw.elsa.transbuf
op_assign
id|kmalloc
c_func
(paren
id|MAX_MODEM_BUF
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: No modem mem hw.elsa.transbuf&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cs-&gt;hw.elsa.rcvbuf
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mstartup
c_func
(paren
id|cs
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Elsa: problem startup modem&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|modem_set_init
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_void
DECL|function|release_modem
id|release_modem
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;hw.elsa.MFlag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.transbuf
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;hw.elsa.rcvbuf
)paren
(brace
id|mshutdown
c_func
(paren
id|cs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cs-&gt;hw.elsa.rcvbuf
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.rcvbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|cs-&gt;hw.elsa.transbuf
)paren
suffix:semicolon
id|cs-&gt;hw.elsa.transbuf
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
eof
