multiline_comment|/* $Id: llglue.c,v 1.1 1996/04/13 10:26:29 fritz Exp $&n; *&n; * $Log: llglue.c,v $&n; * Revision 1.1  1996/04/13 10:26:29  fritz&n; * Initial revision&n; *&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;teles.h&quot;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
r_extern
r_struct
id|Channel
op_star
id|chanlist
suffix:semicolon
DECL|variable|drid
r_int
id|drid
suffix:semicolon
DECL|variable|teles_id
r_char
op_star
id|teles_id
op_assign
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
suffix:semicolon
DECL|variable|iif
id|isdn_if
id|iif
suffix:semicolon
DECL|macro|TELES_STATUS_BUFSIZE
mdefine_line|#define TELES_STATUS_BUFSIZE 4096
DECL|variable|teles_status_buf
r_static
id|byte
op_star
id|teles_status_buf
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|teles_status_read
r_static
id|byte
op_star
id|teles_status_read
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|teles_status_write
r_static
id|byte
op_star
id|teles_status_write
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|teles_status_end
r_static
id|byte
op_star
id|teles_status_end
op_assign
l_int|NULL
suffix:semicolon
r_int
DECL|function|teles_readstatus
id|teles_readstatus
c_func
(paren
id|byte
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
)paren
(brace
r_int
id|count
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|buf
comma
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|len
suffix:semicolon
id|p
op_increment
comma
id|count
op_increment
)paren
(brace
r_if
c_cond
(paren
id|user
)paren
id|put_fs_byte
c_func
(paren
op_star
id|teles_status_read
op_increment
comma
id|p
)paren
suffix:semicolon
r_else
op_star
id|p
op_increment
op_assign
op_star
id|teles_status_read
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|teles_status_read
OG
id|teles_status_end
)paren
id|teles_status_read
op_assign
id|teles_status_buf
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_void
DECL|function|teles_putstatus
id|teles_putstatus
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|len
comma
id|count
comma
id|i
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|buf
comma
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|p
op_increment
)paren
(brace
op_star
id|teles_status_write
op_increment
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|teles_status_write
OG
id|teles_status_end
)paren
id|teles_status_write
op_assign
id|teles_status_buf
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
id|ic.command
op_assign
id|ISDN_STAT_STAVAIL
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.arg
op_assign
id|count
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|ll_init
id|ll_init
c_func
(paren
r_void
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|teles_status_buf
op_assign
id|Smalloc
c_func
(paren
id|TELES_STATUS_BUFSIZE
comma
id|GFP_KERNEL
comma
l_string|&quot;teles_status_buf&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|teles_status_buf
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;teles: Could not allocate status-buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EIO
)paren
suffix:semicolon
)brace
r_else
(brace
id|teles_status_read
op_assign
id|teles_status_buf
suffix:semicolon
id|teles_status_write
op_assign
id|teles_status_buf
suffix:semicolon
id|teles_status_end
op_assign
id|teles_status_buf
op_plus
id|TELES_STATUS_BUFSIZE
op_minus
l_int|1
suffix:semicolon
)brace
id|iif.channels
op_assign
id|CallcNewChan
c_func
(paren
)paren
suffix:semicolon
id|iif.maxbufsize
op_assign
id|BUFFER_SIZE
c_func
(paren
id|HSCX_SBUF_ORDER
comma
id|HSCX_SBUF_BPPS
)paren
suffix:semicolon
id|iif.features
op_assign
id|ISDN_FEATURE_L2_X75I
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
id|ISDN_FEATURE_P_1TR6
op_or
id|ISDN_FEATURE_P_EURO
suffix:semicolon
id|iif.command
op_assign
id|teles_command
suffix:semicolon
id|iif.writebuf
op_assign
id|teles_writebuf
suffix:semicolon
id|iif.writecmd
op_assign
l_int|NULL
suffix:semicolon
id|iif.readstat
op_assign
id|teles_readstatus
suffix:semicolon
id|strncpy
c_func
(paren
id|iif.id
comma
id|teles_id
comma
r_sizeof
(paren
id|iif.id
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|register_isdn
c_func
(paren
op_amp
id|iif
)paren
suffix:semicolon
id|drid
op_assign
id|iif.channels
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|ll_stop
id|ll_stop
c_func
(paren
r_void
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_STOP
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
id|CallcFreeChan
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|ll_unload
id|ll_unload
c_func
(paren
r_void
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_UNLOAD
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
eof
