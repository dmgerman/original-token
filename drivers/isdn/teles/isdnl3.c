multiline_comment|/* $Id: isdnl3.c,v 1.6 1996/05/21 11:33:50 keil Exp $&n; *&n; * $Log: isdnl3.c,v $&n; * Revision 1.6  1996/05/21 11:33:50  keil&n; * Adding SETUP_ACKNOWLEDGE as answer of a SETUP message.&n; *&n; * Revision 1.5  1996/05/18 01:37:16  fritz&n; * Added spelling corrections and some minor changes&n; * to stay in sync with kernel.&n; *&n; * Revision 1.4  1996/05/17 03:46:16  fritz&n; * General cleanup.&n; *&n; * Revision 1.3  1996/04/30 21:57:53  isdn4dev&n; * remove some debugging code, improve callback   Karsten Keil&n; *&n; * Revision 1.2  1996/04/20 16:45:05  fritz&n; * Changed to report all incoming calls to Linklevel, not just those&n; * with Service 7.&n; * Misc. typos&n; *&n; * Revision 1.1  1996/04/13 10:24:45  fritz&n; * Initial revision&n; *&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
DECL|macro|P_1TR6
mdefine_line|#define P_1TR6
macro_line|#include &quot;teles.h&quot;
macro_line|#include &quot;l3_1TR6.h&quot;
DECL|macro|DEBUG_1TR6
mdefine_line|#define DEBUG_1TR6 0
r_static
r_void
DECL|function|i_down
id|i_down
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BufHeader
op_star
id|ibh
)paren
(brace
id|st-&gt;l3
dot
id|l3l2
c_func
(paren
id|st
comma
id|DL_DATA
comma
id|ibh
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|newl3state
id|newl3state
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|state
)paren
(brace
id|st-&gt;l3.state
op_assign
id|state
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3: bc:%d cr:%x new state %d&bslash;n&quot;
comma
id|st-&gt;pa-&gt;bchannel
comma
id|st-&gt;pa-&gt;callref
comma
id|state
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3_message
id|l3_message
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|mt
)paren
(brace
r_struct
id|BufHeader
op_star
id|dibh
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
r_int
id|size
suffix:semicolon
id|BufPoolGet
c_func
(paren
op_amp
id|dibh
comma
id|st-&gt;l1.sbufpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
id|st
comma
l_int|18
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|dibh
)paren
suffix:semicolon
id|p
op_add_assign
id|st-&gt;l2.ihsize
suffix:semicolon
id|size
op_assign
id|st-&gt;l2.ihsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x8
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x1
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|st-&gt;l3.callref
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|mt
suffix:semicolon
id|size
op_add_assign
l_int|4
suffix:semicolon
id|dibh-&gt;datasize
op_assign
id|size
suffix:semicolon
id|i_down
c_func
(paren
id|st
comma
id|dibh
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s3
id|l3s3
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|l3_message
c_func
(paren
id|st
comma
id|MT_RELEASE
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|19
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s4
id|l3s4
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|0
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_RELEASE_CNF
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s4_1
id|l3s4_1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|19
)paren
suffix:semicolon
id|l3_message
c_func
(paren
id|st
comma
id|MT_RELEASE
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_RELEASE_CNF
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s5
id|l3s5
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|dibh
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
r_char
op_star
id|teln
suffix:semicolon
id|st-&gt;l3.callref
op_assign
id|st-&gt;pa-&gt;callref
suffix:semicolon
id|BufPoolGet
c_func
(paren
op_amp
id|dibh
comma
id|st-&gt;l1.sbufpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
id|st
comma
l_int|19
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|dibh
)paren
suffix:semicolon
id|p
op_add_assign
id|st-&gt;l2.ihsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x8
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x1
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|st-&gt;l3.callref
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|MT_SETUP
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0xa1
suffix:semicolon
multiline_comment|/*&n;         * Set Bearer Capability, Map info from 1TR6-convention to EDSS1&n;         */
r_switch
c_cond
(paren
id|st-&gt;pa-&gt;info
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* Telephony                               */
op_star
id|p
op_increment
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* BC-IE-code                              */
op_star
id|p
op_increment
op_assign
l_int|0x3
suffix:semicolon
multiline_comment|/* Length                                  */
op_star
id|p
op_increment
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* Coding Std. national, 3.1 kHz audio     */
op_star
id|p
op_increment
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* Circuit-Mode 64kbps                     */
op_star
id|p
op_increment
op_assign
l_int|0xa3
suffix:semicolon
multiline_comment|/* A-Law Audio                             */
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Datatransmission 64k, BTX               */
r_case
l_int|7
suffix:colon
multiline_comment|/* Datatransmission 64k                    */
r_default
suffix:colon
op_star
id|p
op_increment
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* BC-IE-code                              */
op_star
id|p
op_increment
op_assign
l_int|0x2
suffix:semicolon
multiline_comment|/* Length                                  */
op_star
id|p
op_increment
op_assign
l_int|0x88
suffix:semicolon
multiline_comment|/* Coding Std. nat., unrestr. dig. Inform. */
op_star
id|p
op_increment
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* Packet-Mode 64kbps                      */
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * What about info2? Mapping to High-Layer-Compatibility?&n;&t; */
r_if
c_cond
(paren
id|st-&gt;pa-&gt;calling
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
op_star
id|p
op_increment
op_assign
l_int|0x6c
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|strlen
c_func
(paren
id|st-&gt;pa-&gt;calling
)paren
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Classify as AnyPref. */
op_star
id|p
op_increment
op_assign
l_int|0x81
suffix:semicolon
multiline_comment|/* Ext = &squot;1&squot;B, Type = &squot;000&squot;B, Plan = &squot;0001&squot;B. */
id|teln
op_assign
id|st-&gt;pa-&gt;calling
suffix:semicolon
r_while
c_loop
(paren
op_star
id|teln
)paren
op_star
id|p
op_increment
op_assign
op_star
id|teln
op_increment
op_amp
l_int|0x7f
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
l_int|0x70
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|strlen
c_func
(paren
id|st-&gt;pa-&gt;called
)paren
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Classify as AnyPref. */
op_star
id|p
op_increment
op_assign
l_int|0x81
suffix:semicolon
multiline_comment|/* Ext = &squot;1&squot;B, Type = &squot;000&squot;B, Plan = &squot;0001&squot;B. */
id|teln
op_assign
id|st-&gt;pa-&gt;called
suffix:semicolon
r_while
c_loop
(paren
op_star
id|teln
)paren
op_star
id|p
op_increment
op_assign
op_star
id|teln
op_increment
op_amp
l_int|0x7f
suffix:semicolon
id|dibh-&gt;datasize
op_assign
id|p
op_minus
id|DATAPTR
c_func
(paren
id|dibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|1
)paren
suffix:semicolon
id|i_down
c_func
(paren
id|st
comma
id|dibh
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s6
id|l3s6
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|byte
op_star
id|p
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.ihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.ihsize
comma
l_int|0x18
comma
l_int|0
)paren
)paren
)paren
(brace
id|st-&gt;pa-&gt;bchannel
op_assign
id|p
(braket
l_int|2
)braket
op_amp
l_int|0x3
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;octect 3 not found&bslash;n&quot;
)paren
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|3
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_PROCEEDING_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s7
id|l3s7
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|12
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_DISCONNECT_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s8
id|l3s8
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|10
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s11
id|l3s11
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|4
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_ALERTING_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s12
id|l3s12
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|byte
op_star
id|p
suffix:semicolon
r_int
id|bcfound
op_assign
l_int|0
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|p
op_add_assign
id|st-&gt;l2.uihsize
suffix:semicolon
id|st-&gt;pa-&gt;callref
op_assign
id|getcallref
c_func
(paren
id|p
)paren
suffix:semicolon
id|st-&gt;l3.callref
op_assign
l_int|0x80
op_plus
id|st-&gt;pa-&gt;callref
suffix:semicolon
multiline_comment|/*&n;         * Channel Identification&n;         */
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.uihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
comma
l_int|0x18
comma
l_int|0
)paren
)paren
)paren
(brace
id|st-&gt;pa-&gt;bchannel
op_assign
id|p
(braket
l_int|2
)braket
op_amp
l_int|0x3
suffix:semicolon
id|bcfound
op_increment
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;l3s12: Channel ident not found&bslash;n&quot;
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;protocol
op_eq
id|ISDN_PTYPE_1TR6
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.uihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
comma
l_int|0x01
comma
l_int|6
)paren
)paren
)paren
(brace
id|st-&gt;pa-&gt;info
op_assign
id|p
(braket
l_int|2
)braket
suffix:semicolon
id|st-&gt;pa-&gt;info2
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;l3s12(1TR6): ServiceIndicator not found&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;                 * Bearer Capabilities&n;                 */
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.uihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
comma
l_int|0x04
comma
l_int|0
)paren
)paren
)paren
(brace
r_switch
c_cond
(paren
id|p
(braket
l_int|2
)braket
op_amp
l_int|0x1f
)paren
(brace
r_case
l_int|0x00
suffix:colon
multiline_comment|/* Speech */
r_case
l_int|0x10
suffix:colon
multiline_comment|/* 3.1 Khz audio */
id|st-&gt;pa-&gt;info
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
multiline_comment|/* Unrestricted digital information */
id|st-&gt;pa-&gt;info
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x09
suffix:colon
multiline_comment|/* Restricted digital information */
id|st-&gt;pa-&gt;info
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x11
suffix:colon
multiline_comment|/* Unrestr. digital information  with tones/announcements */
id|st-&gt;pa-&gt;info
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x18
suffix:colon
multiline_comment|/* Video */
id|st-&gt;pa-&gt;info
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|st-&gt;pa-&gt;info
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;l3s12: Bearer capabilities not found&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.uihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
comma
l_int|0x70
comma
l_int|0
)paren
)paren
)paren
id|iecpy
c_func
(paren
id|st-&gt;pa-&gt;called
comma
id|p
comma
l_int|1
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|st-&gt;pa-&gt;called
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|findie
c_func
(paren
id|p
op_plus
id|st-&gt;l2.uihsize
comma
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
comma
l_int|0x6c
comma
l_int|0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;protocol
op_eq
id|ISDN_PTYPE_1TR6
)paren
id|iecpy
c_func
(paren
id|st-&gt;pa-&gt;calling
comma
id|p
comma
l_int|1
)paren
suffix:semicolon
r_else
id|iecpy
c_func
(paren
id|st-&gt;pa-&gt;calling
comma
id|p
comma
l_int|2
)paren
suffix:semicolon
)brace
r_else
id|strcpy
c_func
(paren
id|st-&gt;pa-&gt;calling
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcfound
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;pa-&gt;info
op_ne
l_int|7
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;non-digital call: %s -&gt; %s&bslash;n&quot;
comma
id|st-&gt;pa-&gt;calling
comma
id|st-&gt;pa-&gt;called
)paren
suffix:semicolon
)brace
id|newl3state
c_func
(paren
id|st
comma
l_int|6
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_SETUP_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|l3s13
id|l3s13
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|newl3state
c_func
(paren
id|st
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s16
id|l3s16
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|st-&gt;l3.callref
op_assign
l_int|0x80
op_plus
id|st-&gt;pa-&gt;callref
suffix:semicolon
id|l3_message
c_func
(paren
id|st
comma
id|MT_CONNECT
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|8
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s17
id|l3s17
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_SETUP_COMPLETE_IND
comma
l_int|NULL
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|10
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s18
id|l3s18
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|dibh
suffix:semicolon
id|byte
op_star
id|p
suffix:semicolon
r_int
id|size
suffix:semicolon
id|BufPoolGet
c_func
(paren
op_amp
id|dibh
comma
id|st-&gt;l1.sbufpool
comma
id|GFP_ATOMIC
comma
(paren
r_void
op_star
)paren
id|st
comma
l_int|20
)paren
suffix:semicolon
id|p
op_assign
id|DATAPTR
c_func
(paren
id|dibh
)paren
suffix:semicolon
id|p
op_add_assign
id|st-&gt;l2.ihsize
suffix:semicolon
id|size
op_assign
id|st-&gt;l2.ihsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x8
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x1
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|st-&gt;l3.callref
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|MT_DISCONNECT
suffix:semicolon
id|size
op_add_assign
l_int|4
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|IE_CAUSE
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x2
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x80
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0x90
suffix:semicolon
id|size
op_add_assign
l_int|4
suffix:semicolon
id|dibh-&gt;datasize
op_assign
id|size
suffix:semicolon
id|i_down
c_func
(paren
id|st
comma
id|dibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|11
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s19
id|l3s19
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|0
)paren
suffix:semicolon
id|l3_message
c_func
(paren
id|st
comma
id|MT_RELEASE_COMPLETE
)paren
suffix:semicolon
id|st-&gt;l3
dot
id|l3l4
c_func
(paren
id|st
comma
id|CC_RELEASE_IND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|l3s20
id|l3s20
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
id|byte
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|l3_message
c_func
(paren
id|st
comma
id|MT_ALERTING
)paren
suffix:semicolon
id|newl3state
c_func
(paren
id|st
comma
l_int|7
)paren
suffix:semicolon
)brace
DECL|struct|stateentry
r_struct
id|stateentry
(brace
DECL|member|state
r_int
id|state
suffix:semicolon
DECL|member|primitive
id|byte
id|primitive
suffix:semicolon
DECL|member|rout
r_void
(paren
op_star
id|rout
)paren
(paren
r_struct
id|PStack
op_star
comma
id|byte
comma
r_void
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|downstatelist
r_static
r_struct
id|stateentry
id|downstatelist
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
id|CC_SETUP_REQ
comma
id|l3s5
)brace
comma
(brace
l_int|1
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|1
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|1
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|3
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|3
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|3
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|4
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|4
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|4
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|6
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|6
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|6
comma
id|CC_ALERTING_REQ
comma
id|l3s20
)brace
comma
(brace
l_int|6
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|7
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|7
comma
id|CC_SETUP_RSP
comma
id|l3s16
)brace
comma
(brace
l_int|7
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|8
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|8
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|8
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|10
comma
id|CC_DISCONNECT_REQ
comma
id|l3s18
)brace
comma
(brace
l_int|10
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|10
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
(brace
l_int|11
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|12
comma
id|CC_RELEASE_REQ
comma
id|l3s3
)brace
comma
(brace
l_int|19
comma
id|CC_DLRL
comma
id|l3s13
)brace
comma
)brace
suffix:semicolon
DECL|variable|downsllen
r_static
r_int
id|downsllen
op_assign
r_sizeof
(paren
id|downstatelist
)paren
op_div
r_sizeof
(paren
r_struct
id|stateentry
)paren
suffix:semicolon
DECL|variable|datastatelist
r_static
r_struct
id|stateentry
id|datastatelist
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
id|MT_SETUP
comma
id|l3s12
)brace
comma
(brace
l_int|1
comma
id|MT_CALL_PROCEEDING
comma
id|l3s6
)brace
comma
(brace
l_int|1
comma
id|MT_SETUP_ACKNOWLEDGE
comma
id|l3s6
)brace
comma
(brace
l_int|1
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4
)brace
comma
(brace
l_int|1
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|1
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|3
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|3
comma
id|MT_CONNECT
comma
id|l3s8
)brace
comma
(brace
l_int|3
comma
id|MT_ALERTING
comma
id|l3s11
)brace
comma
(brace
l_int|3
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|3
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4
)brace
comma
(brace
l_int|4
comma
id|MT_CONNECT
comma
id|l3s8
)brace
comma
(brace
l_int|4
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|4
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|4
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4
)brace
comma
(brace
l_int|6
comma
id|MT_SETUP
comma
id|l3s12
)brace
comma
(brace
l_int|7
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|7
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4_1
)brace
comma
(brace
l_int|7
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|8
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|8
comma
id|MT_CONNECT_ACKNOWLEDGE
comma
id|l3s17
)brace
comma
(brace
l_int|8
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|8
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4_1
)brace
comma
(brace
l_int|10
comma
id|MT_DISCONNECT
comma
id|l3s7
)brace
comma
(brace
l_int|10
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|10
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4_1
)brace
comma
(brace
l_int|11
comma
id|MT_RELEASE
comma
id|l3s19
)brace
comma
(brace
l_int|11
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4
)brace
comma
(brace
l_int|19
comma
id|MT_RELEASE_COMPLETE
comma
id|l3s4
)brace
comma
)brace
suffix:semicolon
DECL|variable|datasllen
r_static
r_int
id|datasllen
op_assign
r_sizeof
(paren
id|datastatelist
)paren
op_div
r_sizeof
(paren
r_struct
id|stateentry
)paren
suffix:semicolon
macro_line|#ifdef P_1TR6
macro_line|#include &quot;l3_1TR6.c&quot;
macro_line|#endif
r_static
r_void
DECL|function|l3up
id|l3up
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|i
comma
id|mt
comma
id|size
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|pr
op_eq
id|DL_DATA
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|st-&gt;l2.ihsize
suffix:semicolon
id|size
op_assign
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.ihsize
suffix:semicolon
id|mt
op_assign
id|ptr
(braket
l_int|3
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ptr
(braket
l_int|0
)braket
)paren
(brace
macro_line|#ifdef P_1TR6
r_case
id|PROTO_DIS_N0
suffix:colon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROTO_DIS_N1
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|datasl_1tr6t_len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|mt
op_eq
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|datasl_1tr6t_len
)paren
(brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3up unhandled 1tr6 state %d MT %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|mt
)paren
suffix:semicolon
)brace
r_else
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
multiline_comment|/* E-DSS1 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|datasllen
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|datastatelist
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|mt
op_eq
id|datastatelist
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|datasllen
)paren
(brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3up unhandled E-DSS1 state %d MT %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|mt
)paren
suffix:semicolon
)brace
r_else
id|datastatelist
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pr
op_eq
id|DL_UNIT_DATA
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|st-&gt;l2.uihsize
suffix:semicolon
id|size
op_assign
id|ibh-&gt;datasize
op_minus
id|st-&gt;l2.uihsize
suffix:semicolon
id|mt
op_assign
id|ptr
(braket
l_int|3
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ptr
(braket
l_int|0
)braket
)paren
(brace
macro_line|#ifdef P_1TR6
r_case
id|PROTO_DIS_N0
suffix:colon
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROTO_DIS_N1
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|datasl_1tr6t_len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|mt
op_eq
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|datasl_1tr6t_len
)paren
(brace
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3up unhandled 1tr6 state %d MT %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|mt
)paren
suffix:semicolon
)brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
)brace
r_else
id|datastatelist_1tr6t
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
multiline_comment|/* E-DSS1 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|datasllen
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|datastatelist
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|mt
op_eq
id|datastatelist
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|datasllen
)paren
(brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3up unhandled E-DSS1 state %d MT %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|mt
)paren
suffix:semicolon
)brace
r_else
id|datastatelist
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|l3down
id|l3down
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;protocol
)paren
(brace
macro_line|#ifdef P_1TR6
r_case
id|ISDN_PTYPE_1TR6
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|downsl_1tr6t_len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|downstatelist_1tr6t
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|pr
op_eq
id|downstatelist_1tr6t
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|downsl_1tr6t_len
)paren
(brace
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3down unhandled 1tr6 state %d primitive %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|pr
)paren
suffix:semicolon
)brace
)brace
r_else
id|downstatelist_1tr6t
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|downsllen
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|st-&gt;l3.state
op_eq
id|downstatelist
(braket
id|i
)braket
dot
id|state
)paren
op_logical_and
(paren
id|pr
op_eq
id|downstatelist
(braket
id|i
)braket
dot
id|primitive
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|downsllen
)paren
(brace
r_if
c_cond
(paren
id|DEBUG_1TR6
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdnl3down unhandled E-DSS1 state %d primitive %x&bslash;n&quot;
comma
id|st-&gt;l3.state
comma
id|pr
)paren
suffix:semicolon
)brace
)brace
r_else
id|downstatelist
(braket
id|i
)braket
dot
id|rout
c_func
(paren
id|st
comma
id|pr
comma
id|ibh
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|setstack_isdnl3
id|setstack_isdnl3
c_func
(paren
r_struct
id|PStack
op_star
id|st
)paren
(brace
id|st-&gt;l4.l4l3
op_assign
id|l3down
suffix:semicolon
id|st-&gt;l2.l2l3
op_assign
id|l3up
suffix:semicolon
id|st-&gt;l3.state
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l3.callref
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l3.debug
op_assign
l_int|0
suffix:semicolon
)brace
eof
