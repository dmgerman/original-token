multiline_comment|/* $Id: callc.c,v 1.8 1996/05/31 01:00:38 fritz Exp $&n; *&n; * $Log: callc.c,v $&n; * Revision 1.8  1996/05/31 01:00:38  fritz&n; * Changed return code of teles_writebuf, when out of memory.&n; *&n; * Revision 1.7  1996/05/17 03:40:37  fritz&n; * General cleanup.&n; *&n; * Revision 1.6  1996/05/10 22:42:07  fritz&n; * Added entry for EV_RELEASE_CNF in ST_OUT (if no D-Channel avail.)&n; *&n; * Revision 1.5  1996/05/06 10:16:15  fritz&n; * Added voice stuff.&n; *&n; * Revision 1.4  1996/04/30 22:04:05  isdn4dev&n; *   improved callback  Karsten Keil&n; *&n; * Revision 1.3  1996/04/30 10:04:19  fritz&n; * Started voice support.&n; * Added printk() to debug-switcher for easier&n; * synchronization between printk()&squot;s and output&n; * of /dev/isdnctrl.&n; *&n; * Revision 1.2  1996/04/20 16:42:29  fritz&n; * Changed statemachine to allow reject of incoming calls.&n; *&n; * Revision 1.1  1996/04/13 10:20:59  fritz&n; * Initial revision&n; *&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;teles.h&quot;
r_extern
r_struct
id|IsdnCard
id|cards
(braket
)braket
suffix:semicolon
r_extern
r_int
id|nrcards
suffix:semicolon
r_extern
r_int
id|drid
suffix:semicolon
r_extern
id|isdn_if
id|iif
suffix:semicolon
r_extern
r_void
id|teles_mod_dec_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|teles_mod_inc_use_count
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|init_ds
c_func
(paren
r_int
id|chan
comma
r_int
id|incoming
)paren
suffix:semicolon
r_static
r_void
id|release_ds
c_func
(paren
r_int
id|chan
)paren
suffix:semicolon
r_static
r_char
op_star
id|strcpyupto
c_func
(paren
r_char
op_star
id|dest
comma
r_char
op_star
id|src
comma
r_char
id|upto
)paren
suffix:semicolon
DECL|variable|callcfsm
r_static
r_struct
id|Fsm
id|callcfsm
op_assign
DECL|variable|lcfsm
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
)brace
comma
id|lcfsm
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|chanlist
r_struct
id|Channel
op_star
id|chanlist
suffix:semicolon
DECL|variable|chancount
r_static
r_int
id|chancount
op_assign
l_int|0
suffix:semicolon
DECL|variable|debugflags
r_int
r_int
id|debugflags
op_assign
l_int|0
suffix:semicolon
DECL|macro|TMR_DCHAN_EST
mdefine_line|#define TMR_DCHAN_EST 2000
r_static
r_void
DECL|function|stat_debug
id|stat_debug
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|tmp
(braket
l_int|100
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s Channel %d HL-&gt;LL %s&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_enum
(brace
DECL|enumerator|ST_NULL
id|ST_NULL
comma
multiline_comment|/*  0 inactive                                               */
DECL|enumerator|ST_OUT
id|ST_OUT
comma
multiline_comment|/*  1 outgoing, awaiting SETUP confirm                       */
DECL|enumerator|ST_CLEAR
id|ST_CLEAR
comma
multiline_comment|/*  2 call release, awaiting RELEASE confirm                 */
DECL|enumerator|ST_OUT_W
id|ST_OUT_W
comma
multiline_comment|/*  3 outgoing, awaiting d-channel establishment             */
DECL|enumerator|ST_REL_W
id|ST_REL_W
comma
multiline_comment|/*  4 awaiting d-channel release                             */
DECL|enumerator|ST_IN_W
id|ST_IN_W
comma
multiline_comment|/*  5 incoming, awaiting d-channel establishment             */
DECL|enumerator|ST_IN
id|ST_IN
comma
multiline_comment|/*  6 incoming call received                                 */
DECL|enumerator|ST_IN_SETUP
id|ST_IN_SETUP
comma
multiline_comment|/*  7 incoming, SETUP response sent                          */
DECL|enumerator|ST_IN_DACT
id|ST_IN_DACT
comma
multiline_comment|/*  8 incoming connected, no b-channel prot.                 */
DECL|enumerator|ST_OUT_ESTB
id|ST_OUT_ESTB
comma
multiline_comment|/* 10 outgoing connected, awaiting b-channel prot. estbl.    */
DECL|enumerator|ST_ACTIVE
id|ST_ACTIVE
comma
multiline_comment|/* 11 active, b channel prot. established                    */
DECL|enumerator|ST_BC_HANGUP
id|ST_BC_HANGUP
comma
multiline_comment|/* 12 call clear. (initiator), awaiting b channel prot. rel. */
DECL|enumerator|ST_PRO_W
id|ST_PRO_W
comma
multiline_comment|/* 13 call clear. (initiator), DISCONNECT req. sent          */
DECL|enumerator|ST_ANT_W
id|ST_ANT_W
comma
multiline_comment|/* 14 call clear. (receiver), awaiting DISCONNECT ind.       */
DECL|enumerator|ST_DISC_BC_HANGUP
id|ST_DISC_BC_HANGUP
comma
multiline_comment|/*    d channel gone, wait for b channel deactivation        */
DECL|enumerator|ST_OUT_W_HANGUP
id|ST_OUT_W_HANGUP
comma
multiline_comment|/* Outgoing waiting for D-Channel hangup received */
DECL|enumerator|ST_D_ERR
id|ST_D_ERR
comma
multiline_comment|/*    d channel released while active                        */
)brace
suffix:semicolon
DECL|macro|STATE_COUNT
mdefine_line|#define STATE_COUNT (ST_D_ERR+1)
DECL|variable|strState
r_static
r_char
op_star
id|strState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_NULL&quot;
comma
l_string|&quot;ST_OUT&quot;
comma
l_string|&quot;ST_CLEAR&quot;
comma
l_string|&quot;ST_OUT_W&quot;
comma
l_string|&quot;ST_REL_W&quot;
comma
l_string|&quot;ST_IN_W&quot;
comma
l_string|&quot;ST_IN&quot;
comma
l_string|&quot;ST_IN_SETUP&quot;
comma
l_string|&quot;ST_IN_DACT&quot;
comma
l_string|&quot;ST_OUT_ESTB&quot;
comma
l_string|&quot;ST_ACTIVE&quot;
comma
l_string|&quot;ST_BC_HANGUP&quot;
comma
l_string|&quot;ST_PRO_W&quot;
comma
l_string|&quot;ST_ANT_W&quot;
comma
l_string|&quot;ST_DISC_BC_HANGUP&quot;
comma
l_string|&quot;ST_OUT_W_HANGUP&quot;
comma
l_string|&quot;ST_D_ERR&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_DIAL
id|EV_DIAL
comma
multiline_comment|/*  0 */
DECL|enumerator|EV_SETUP_CNF
id|EV_SETUP_CNF
comma
multiline_comment|/*  1 */
DECL|enumerator|EV_ACCEPTB
id|EV_ACCEPTB
comma
multiline_comment|/*  2 */
DECL|enumerator|EV_DISCONNECT_CNF
id|EV_DISCONNECT_CNF
comma
multiline_comment|/*  5 */
DECL|enumerator|EV_DISCONNECT_IND
id|EV_DISCONNECT_IND
comma
multiline_comment|/*  6 */
DECL|enumerator|EV_RELEASE_CNF
id|EV_RELEASE_CNF
comma
multiline_comment|/*  7 */
DECL|enumerator|EV_DLEST
id|EV_DLEST
comma
multiline_comment|/*  8 */
DECL|enumerator|EV_DLRL
id|EV_DLRL
comma
multiline_comment|/*  9 */
DECL|enumerator|EV_SETUP_IND
id|EV_SETUP_IND
comma
multiline_comment|/* 10 */
DECL|enumerator|EV_RELEASE_IND
id|EV_RELEASE_IND
comma
multiline_comment|/* 11 */
DECL|enumerator|EV_ACCEPTD
id|EV_ACCEPTD
comma
multiline_comment|/* 12 */
DECL|enumerator|EV_SETUP_CMPL_IND
id|EV_SETUP_CMPL_IND
comma
multiline_comment|/* 13 */
DECL|enumerator|EV_BC_EST
id|EV_BC_EST
comma
multiline_comment|/* 14 */
DECL|enumerator|EV_WRITEBUF
id|EV_WRITEBUF
comma
multiline_comment|/* 15 */
DECL|enumerator|EV_DATAIN
id|EV_DATAIN
comma
multiline_comment|/* 16 */
DECL|enumerator|EV_HANGUP
id|EV_HANGUP
comma
multiline_comment|/* 17 */
DECL|enumerator|EV_BC_REL
id|EV_BC_REL
comma
multiline_comment|/* 18 */
DECL|enumerator|EV_CINF
id|EV_CINF
comma
multiline_comment|/* 19 */
)brace
suffix:semicolon
DECL|macro|EVENT_COUNT
mdefine_line|#define EVENT_COUNT (EV_CINF+1)
DECL|variable|strEvent
r_static
r_char
op_star
id|strEvent
(braket
)braket
op_assign
(brace
l_string|&quot;EV_DIAL&quot;
comma
l_string|&quot;EV_SETUP_CNF&quot;
comma
l_string|&quot;EV_ACCEPTB&quot;
comma
l_string|&quot;EV_DISCONNECT_CNF&quot;
comma
l_string|&quot;EV_DISCONNECT_IND&quot;
comma
l_string|&quot;EV_RELEASE_CNF&quot;
comma
l_string|&quot;EV_DLEST&quot;
comma
l_string|&quot;EV_DLRL&quot;
comma
l_string|&quot;EV_SETUP_IND&quot;
comma
l_string|&quot;EV_RELEASE_IND&quot;
comma
l_string|&quot;EV_ACCEPTD&quot;
comma
l_string|&quot;EV_SETUP_CMPL_IND&quot;
comma
l_string|&quot;EV_BC_EST&quot;
comma
l_string|&quot;EV_WRITEBUF&quot;
comma
l_string|&quot;EV_DATAIN&quot;
comma
l_string|&quot;EV_HANGUP&quot;
comma
l_string|&quot;EV_BC_REL&quot;
comma
l_string|&quot;EV_CINF&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_LC_NULL
id|ST_LC_NULL
comma
DECL|enumerator|ST_LC_ACTIVATE_WAIT
id|ST_LC_ACTIVATE_WAIT
comma
DECL|enumerator|ST_LC_DELAY
id|ST_LC_DELAY
comma
DECL|enumerator|ST_LC_ESTABLISH_WAIT
id|ST_LC_ESTABLISH_WAIT
comma
DECL|enumerator|ST_LC_CONNECTED
id|ST_LC_CONNECTED
comma
DECL|enumerator|ST_LC_RELEASE_WAIT
id|ST_LC_RELEASE_WAIT
comma
)brace
suffix:semicolon
DECL|macro|LC_STATE_COUNT
mdefine_line|#define LC_STATE_COUNT (ST_LC_RELEASE_WAIT+1)
DECL|variable|strLcState
r_static
r_char
op_star
id|strLcState
(braket
)braket
op_assign
(brace
l_string|&quot;ST_LC_NULL&quot;
comma
l_string|&quot;ST_LC_ACTIVATE_WAIT&quot;
comma
l_string|&quot;ST_LC_DELAY&quot;
comma
l_string|&quot;ST_LC_ESTABLISH_WAIT&quot;
comma
l_string|&quot;ST_LC_CONNECTED&quot;
comma
l_string|&quot;ST_LC_RELEASE_WAIT&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_LC_ESTABLISH
id|EV_LC_ESTABLISH
comma
DECL|enumerator|EV_LC_PH_ACTIVATE
id|EV_LC_PH_ACTIVATE
comma
DECL|enumerator|EV_LC_PH_DEACTIVATE
id|EV_LC_PH_DEACTIVATE
comma
DECL|enumerator|EV_LC_DL_ESTABLISH
id|EV_LC_DL_ESTABLISH
comma
DECL|enumerator|EV_LC_TIMER
id|EV_LC_TIMER
comma
DECL|enumerator|EV_LC_DL_RELEASE
id|EV_LC_DL_RELEASE
comma
DECL|enumerator|EV_LC_RELEASE
id|EV_LC_RELEASE
comma
)brace
suffix:semicolon
DECL|macro|LC_EVENT_COUNT
mdefine_line|#define LC_EVENT_COUNT (EV_LC_RELEASE+1)
DECL|variable|strLcEvent
r_static
r_char
op_star
id|strLcEvent
(braket
)braket
op_assign
(brace
l_string|&quot;EV_LC_ESTABLISH&quot;
comma
l_string|&quot;EV_LC_PH_ACTIVATE&quot;
comma
l_string|&quot;EV_LC_PH_DEACTIVATE&quot;
comma
l_string|&quot;EV_LC_DL_ESTABLISH&quot;
comma
l_string|&quot;EV_LC_TIMER&quot;
comma
l_string|&quot;EV_LC_DL_RELEASE&quot;
comma
l_string|&quot;EV_LC_RELEASE&quot;
comma
)brace
suffix:semicolon
DECL|macro|LC_D
mdefine_line|#define LC_D  0
DECL|macro|LC_B
mdefine_line|#define LC_B  1
r_static
r_int
DECL|function|my_atoi
id|my_atoi
c_func
(paren
r_char
op_star
id|s
)paren
(brace
r_int
id|i
comma
id|n
suffix:semicolon
id|n
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_star
id|s
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|s
op_le
l_char|&squot;9&squot;
suffix:semicolon
id|i
op_increment
comma
id|s
op_increment
)paren
id|n
op_assign
l_int|10
op_star
id|n
op_plus
(paren
op_star
id|s
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
multiline_comment|/*&n; * Dial out&n; */
r_static
r_void
DECL|function|r1
id|r1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|isdn_ctrl
op_star
id|ic
op_assign
id|arg
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_char
op_star
id|ptr
suffix:semicolon
r_char
id|sis
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Destination Phone-Number */
id|ptr
op_assign
id|strcpyupto
c_func
(paren
id|chanp-&gt;para.called
comma
id|ic-&gt;num
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
multiline_comment|/* Source Phone-Number */
id|ptr
op_assign
id|strcpyupto
c_func
(paren
id|chanp-&gt;para.calling
comma
id|ptr
op_plus
l_int|1
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|chanp-&gt;para.calling
comma
l_string|&quot;0&quot;
)paren
)paren
id|chanp-&gt;para.calling
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* Service-Indicator 1 */
id|ptr
op_assign
id|strcpyupto
c_func
(paren
id|sis
comma
id|ptr
op_plus
l_int|1
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
id|chanp-&gt;para.info
op_assign
id|my_atoi
c_func
(paren
id|sis
)paren
suffix:semicolon
multiline_comment|/* Service-Indicator 2 */
id|ptr
op_assign
id|strcpyupto
c_func
(paren
id|sis
comma
id|ptr
op_plus
l_int|1
comma
l_char|&squot;&bslash;0&squot;
)paren
suffix:semicolon
id|chanp-&gt;para.info2
op_assign
id|my_atoi
c_func
(paren
id|sis
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;r1 unknown protocol&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_W
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ll_hangup
id|ll_hangup
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_int
id|bchantoo
)paren
(brace
id|isdn_ctrl
id|ic
suffix:semicolon
r_if
c_cond
(paren
id|bchantoo
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|stat_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BHUP&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|stat_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DHUP&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r2
id|r2
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_CLEAR
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r2_1
id|r2_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DISCONNECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_W_HANGUP
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r2_2
id|r2_2
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_REL_W
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r3
id|r3
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_REL_W
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r3_1
id|r3_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_REL_W
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r4
id|r4
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r5
id|r5
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;para.callref
op_assign
id|chanp-&gt;outcallref
suffix:semicolon
id|chanp-&gt;outcallref
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;outcallref
op_eq
l_int|128
)paren
id|chanp-&gt;outcallref
op_assign
l_int|64
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_SETUP_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r6
id|r6
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_W
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r7
id|r7
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
multiline_comment|/*&n;         * Report incoming calls only once to linklevel, use octet 3 of&n;         * channel identification information element. (it&squot;s value&n;         * is copied to chanp-&gt;para.bchannel in l3s12(), file isdnl3.c)&n;         */
r_if
c_cond
(paren
(paren
(paren
id|chanp-&gt;chan
op_amp
l_int|1
)paren
op_plus
l_int|1
)paren
op_amp
id|chanp-&gt;para.bchannel
)paren
(brace
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_ALERTING_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|stat_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_ICALL&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_ICALL
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
multiline_comment|/*&n;                 * No need to return &quot;unknown&quot; for calls without OAD,&n;                 * cause that&squot;s handled in linklevel now (replaced by &squot;0&squot;)&n;                 */
id|sprintf
c_func
(paren
id|ic.num
comma
l_string|&quot;%s,%d,0,%s&quot;
comma
id|chanp-&gt;para.calling
comma
id|chanp-&gt;para.info
comma
id|chanp-&gt;para.called
)paren
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_else
(brace
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_REL_W
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|r8
id|r8
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_SETUP
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_SETUP_RSP
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r9
id|r9
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_IN_DACT
)paren
suffix:semicolon
id|chanp-&gt;l2_active_protocol
op_assign
id|chanp-&gt;l2_protocol
suffix:semicolon
id|chanp-&gt;incoming
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|chanp-&gt;l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|chanp-&gt;lc_b.l2_establish
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;r9 unknown protocol&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|init_ds
c_func
(paren
id|chanp-&gt;chan
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r10
id|r10
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_OUT_ESTB
)paren
suffix:semicolon
id|init_ds
c_func
(paren
id|chanp-&gt;chan
comma
l_int|0
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r12
id|r12
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_ACTIVE
)paren
suffix:semicolon
id|chanp-&gt;data_open
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|stat_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_DCONN&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_DCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|stat_debug
c_func
(paren
id|chanp
comma
l_string|&quot;STAT_BCONN&quot;
)paren
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BCONN
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r15
id|r15
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_BC_HANGUP
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r16
id|r16
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_PRO_W
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DISCONNECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r17
id|r17
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_ANT_W
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r17_1
id|r17_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r18
id|r18
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_REL_W
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r19
id|r19
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_CLEAR
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r20
id|r20
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r21
id|r21
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_DISC_BC_HANGUP
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r22
id|r22
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_CLEAR
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_RELEASE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r23
id|r23
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_PRO_W
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DISCONNECT_REQ
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r23_1
id|r23_1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|chanp-&gt;is.l4
dot
id|l4l3
c_func
(paren
op_amp
id|chanp-&gt;is
comma
id|CC_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r24
id|r24
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_D_ERR
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r25
id|r25
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|release_ds
c_func
(paren
id|chanp-&gt;chan
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_NULL
)paren
suffix:semicolon
id|ll_hangup
c_func
(paren
id|chanp
comma
op_logical_neg
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|r26
id|r26
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_CINF
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|sprintf
c_func
(paren
id|ic.num
comma
l_string|&quot;%d&quot;
comma
id|chanp-&gt;para.chargeinfo
)paren
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
DECL|variable|fnlist
r_static
r_struct
id|FsmNode
id|fnlist
(braket
)braket
op_assign
(brace
(brace
id|ST_NULL
comma
id|EV_DIAL
comma
id|r1
)brace
comma
(brace
id|ST_OUT_W
comma
id|EV_DLEST
comma
id|r5
)brace
comma
(brace
id|ST_OUT_W
comma
id|EV_DLRL
comma
id|r20
)brace
comma
(brace
id|ST_OUT_W
comma
id|EV_RELEASE_CNF
comma
id|r2_2
)brace
comma
(brace
id|ST_OUT
comma
id|EV_DISCONNECT_IND
comma
id|r2
)brace
comma
(brace
id|ST_OUT
comma
id|EV_SETUP_CNF
comma
id|r10
)brace
comma
(brace
id|ST_OUT
comma
id|EV_HANGUP
comma
id|r2_1
)brace
comma
(brace
id|ST_OUT
comma
id|EV_RELEASE_IND
comma
id|r20
)brace
comma
(brace
id|ST_OUT
comma
id|EV_RELEASE_CNF
comma
id|r20
)brace
comma
(brace
id|ST_OUT
comma
id|EV_DLRL
comma
id|r2_2
)brace
comma
(brace
id|ST_OUT_W_HANGUP
comma
id|EV_RELEASE_IND
comma
id|r2_2
)brace
comma
(brace
id|ST_OUT_W_HANGUP
comma
id|EV_DLRL
comma
id|r20
)brace
comma
(brace
id|ST_CLEAR
comma
id|EV_RELEASE_CNF
comma
id|r3
)brace
comma
(brace
id|ST_CLEAR
comma
id|EV_DLRL
comma
id|r20
)brace
comma
(brace
id|ST_REL_W
comma
id|EV_DLRL
comma
id|r4
)brace
comma
(brace
id|ST_NULL
comma
id|EV_SETUP_IND
comma
id|r6
)brace
comma
(brace
id|ST_IN_W
comma
id|EV_DLEST
comma
id|r7
)brace
comma
(brace
id|ST_IN_W
comma
id|EV_DLRL
comma
id|r3_1
)brace
comma
(brace
id|ST_IN
comma
id|EV_DLRL
comma
id|r3_1
)brace
comma
(brace
id|ST_IN
comma
id|EV_HANGUP
comma
id|r2_1
)brace
comma
(brace
id|ST_IN
comma
id|EV_RELEASE_IND
comma
id|r2_2
)brace
comma
(brace
id|ST_IN
comma
id|EV_RELEASE_CNF
comma
id|r2_2
)brace
comma
(brace
id|ST_IN
comma
id|EV_ACCEPTD
comma
id|r8
)brace
comma
(brace
id|ST_IN_SETUP
comma
id|EV_HANGUP
comma
id|r2_1
)brace
comma
(brace
id|ST_IN_SETUP
comma
id|EV_SETUP_CMPL_IND
comma
id|r9
)brace
comma
(brace
id|ST_IN_SETUP
comma
id|EV_RELEASE_IND
comma
id|r2_2
)brace
comma
(brace
id|ST_IN_SETUP
comma
id|EV_DISCONNECT_IND
comma
id|r2
)brace
comma
(brace
id|ST_IN_SETUP
comma
id|EV_DLRL
comma
id|r20
)brace
comma
(brace
id|ST_OUT_ESTB
comma
id|EV_BC_EST
comma
id|r12
)brace
comma
(brace
id|ST_OUT_ESTB
comma
id|EV_BC_REL
comma
id|r23
)brace
comma
(brace
id|ST_OUT_ESTB
comma
id|EV_DLRL
comma
id|r23_1
)brace
comma
(brace
id|ST_IN_DACT
comma
id|EV_BC_EST
comma
id|r12
)brace
comma
(brace
id|ST_IN_DACT
comma
id|EV_BC_REL
comma
id|r17
)brace
comma
(brace
id|ST_IN_DACT
comma
id|EV_DLRL
comma
id|r17_1
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_HANGUP
comma
id|r15
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_BC_REL
comma
id|r17
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_DISCONNECT_IND
comma
id|r21
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_DLRL
comma
id|r24
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_CINF
comma
id|r26
)brace
comma
(brace
id|ST_ACTIVE
comma
id|EV_RELEASE_IND
comma
id|r17
)brace
comma
(brace
id|ST_BC_HANGUP
comma
id|EV_BC_REL
comma
id|r16
)brace
comma
(brace
id|ST_BC_HANGUP
comma
id|EV_DISCONNECT_IND
comma
id|r21
)brace
comma
(brace
id|ST_PRO_W
comma
id|EV_RELEASE_IND
comma
id|r18
)brace
comma
(brace
id|ST_ANT_W
comma
id|EV_DISCONNECT_IND
comma
id|r19
)brace
comma
(brace
id|ST_DISC_BC_HANGUP
comma
id|EV_BC_REL
comma
id|r22
)brace
comma
(brace
id|ST_D_ERR
comma
id|EV_BC_REL
comma
id|r25
)brace
comma
)brace
suffix:semicolon
DECL|macro|FNCOUNT
mdefine_line|#define FNCOUNT (sizeof(fnlist)/sizeof(struct FsmNode))
r_static
r_void
DECL|function|lc_r1
id|lc_r1
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_ACTIVATE_WAIT
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|1000
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|50
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r6
id|lc_r6
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmDelTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|50
)paren
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_DELAY
)paren
suffix:semicolon
id|FsmAddTimer
c_func
(paren
op_amp
id|lf-&gt;act_timer
comma
l_int|40
comma
id|EV_LC_TIMER
comma
l_int|NULL
comma
l_int|51
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r2
id|lc_r2
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_establish
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_ESTABLISH_WAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_start
)paren
id|lf-&gt;st-&gt;ma
dot
id|manl2
c_func
(paren
id|lf-&gt;st
comma
id|DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_CONNECTED
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lc_r3
id|lc_r3
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_CONNECTED
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_r4
id|lc_r4
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;l2_establish
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_RELEASE_WAIT
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl2
c_func
(paren
id|lf-&gt;st
comma
id|DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_NULL
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lc_r5
id|lc_r5
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_LC_NULL
)paren
suffix:semicolon
id|lf-&gt;st-&gt;ma
dot
id|manl1
c_func
(paren
id|lf-&gt;st
comma
id|PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
id|lf
op_member_access_from_pointer
id|lccall
c_func
(paren
id|lf
comma
id|LC_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|LcFnList
r_static
r_struct
id|FsmNode
id|LcFnList
(braket
)braket
op_assign
(brace
(brace
id|ST_LC_NULL
comma
id|EV_LC_ESTABLISH
comma
id|lc_r1
)brace
comma
(brace
id|ST_LC_ACTIVATE_WAIT
comma
id|EV_LC_PH_ACTIVATE
comma
id|lc_r6
)brace
comma
(brace
id|ST_LC_DELAY
comma
id|EV_LC_TIMER
comma
id|lc_r2
)brace
comma
(brace
id|ST_LC_ESTABLISH_WAIT
comma
id|EV_LC_DL_ESTABLISH
comma
id|lc_r3
)brace
comma
(brace
id|ST_LC_CONNECTED
comma
id|EV_LC_RELEASE
comma
id|lc_r4
)brace
comma
(brace
id|ST_LC_CONNECTED
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_RELEASE_WAIT
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_ACTIVATE_WAIT
comma
id|EV_LC_TIMER
comma
id|lc_r5
)brace
comma
(brace
id|ST_LC_ESTABLISH_WAIT
comma
id|EV_LC_DL_RELEASE
comma
id|lc_r5
)brace
comma
)brace
suffix:semicolon
DECL|macro|LC_FN_COUNT
mdefine_line|#define LC_FN_COUNT (sizeof(LcFnList)/sizeof(struct FsmNode))
r_void
DECL|function|CallcNew
id|CallcNew
c_func
(paren
r_void
)paren
(brace
id|callcfsm.state_count
op_assign
id|STATE_COUNT
suffix:semicolon
id|callcfsm.event_count
op_assign
id|EVENT_COUNT
suffix:semicolon
id|callcfsm.strEvent
op_assign
id|strEvent
suffix:semicolon
id|callcfsm.strState
op_assign
id|strState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|callcfsm
comma
id|fnlist
comma
id|FNCOUNT
)paren
suffix:semicolon
id|lcfsm.state_count
op_assign
id|LC_STATE_COUNT
suffix:semicolon
id|lcfsm.event_count
op_assign
id|LC_EVENT_COUNT
suffix:semicolon
id|lcfsm.strEvent
op_assign
id|strLcEvent
suffix:semicolon
id|lcfsm.strState
op_assign
id|strLcState
suffix:semicolon
id|FsmNew
c_func
(paren
op_amp
id|lcfsm
comma
id|LcFnList
comma
id|LC_FN_COUNT
)paren
suffix:semicolon
)brace
r_void
DECL|function|CallcFree
id|CallcFree
c_func
(paren
r_void
)paren
(brace
id|FsmFree
c_func
(paren
op_amp
id|lcfsm
)paren
suffix:semicolon
id|FsmFree
c_func
(paren
op_amp
id|callcfsm
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_ds
id|release_ds
c_func
(paren
r_int
id|chan
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanlist
(braket
id|chan
)braket
dot
id|ds
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
suffix:semicolon
id|sp
op_assign
id|st-&gt;l1.hardware
suffix:semicolon
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|chanlist
(braket
id|chan
)braket
dot
id|hscx
suffix:semicolon
id|close_hscxstate
c_func
(paren
id|hsp
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|chanlist
(braket
id|chan
)braket
dot
id|l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|releasestack_transl2
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cc_l1man
id|cc_l1man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|cc_l2man
id|cc_l2man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
id|EV_LC_DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dcc_l1man
id|dcc_l1man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_ACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_PH_ACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_PH_DEACTIVATE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dcc_l2man
id|dcc_l2man
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_DL_ESTABLISH
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|DL_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
id|EV_LC_DL_RELEASE
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ll_handler
id|ll_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_struct
id|BufHeader
op_star
id|ibh
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|CC_DISCONNECT_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DISCONNECT_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_CNF
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_RELEASE_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_RELEASE_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_COMPLETE_IND
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CMPL_IND
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_SETUP_CNF
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_SETUP_CNF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CC_INFO_CHARGE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_CINF
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|init_is
id|init_is
c_func
(paren
r_int
id|chan
comma
r_int
r_int
id|ces
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
(paren
id|chanlist
(braket
id|chan
)braket
dot
id|is
)paren
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
id|chanlist
(braket
id|chan
)braket
dot
id|sp
suffix:semicolon
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
id|setstack_teles
c_func
(paren
id|st
comma
id|sp
)paren
suffix:semicolon
id|st-&gt;l2.sap
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.tei
op_assign
l_int|255
suffix:semicolon
id|st-&gt;l2.ces
op_assign
id|ces
suffix:semicolon
id|st-&gt;l2.extended
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|st-&gt;l2.laptype
op_assign
id|LAPD
suffix:semicolon
id|st-&gt;l2.window
op_assign
l_int|1
suffix:semicolon
id|st-&gt;l2.orig
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|st-&gt;l2.t200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds  */
r_if
c_cond
(paren
id|st-&gt;protocol
op_eq
id|ISDN_PTYPE_1TR6
)paren
(brace
id|st-&gt;l2.n200
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* try 3 times        */
id|st-&gt;l2.t203
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10000 milliseconds */
)brace
r_else
(brace
id|st-&gt;l2.n200
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* try 4 times        */
id|st-&gt;l2.t203
op_assign
l_int|5000
suffix:semicolon
multiline_comment|/* 5000 milliseconds  */
)brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Channel %d q.921&quot;
comma
id|chan
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|setstack_isdnl3
c_func
(paren
id|st
)paren
suffix:semicolon
id|st-&gt;l2.debug
op_assign
l_int|2
suffix:semicolon
id|st-&gt;l3.debug
op_assign
l_int|2
suffix:semicolon
id|st-&gt;l2.debug
op_assign
l_int|0xff
suffix:semicolon
id|st-&gt;l3.debug
op_assign
l_int|0xff
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
id|st-&gt;l4.l2writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;l3.l3l4
op_assign
id|ll_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|cc_l1man
suffix:semicolon
id|st-&gt;l2.l2man
op_assign
id|cc_l2man
suffix:semicolon
id|st-&gt;pa
op_assign
op_amp
id|chanlist
(braket
id|chan
)braket
dot
id|para
suffix:semicolon
id|teles_addlist
c_func
(paren
id|sp
comma
id|st
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|callc_debug
id|callc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|80
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d callc %s&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lc_debug
id|lc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|256
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d lc %s&bslash;n&quot;
comma
id|tm
comma
id|lf-&gt;ch-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|dlc_debug
id|dlc_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|str
(braket
l_int|256
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|LcFsm
op_star
id|lf
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s Channel %d dlc %s&bslash;n&quot;
comma
id|tm
comma
id|lf-&gt;ch-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lccall_d
id|lccall_d
c_func
(paren
r_struct
id|LcFsm
op_star
id|lf
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|lf-&gt;ch
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|LC_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DLEST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|LC_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DLRL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lccall_b
id|lccall_b
c_func
(paren
r_struct
id|LcFsm
op_star
id|lf
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|lf-&gt;ch
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|LC_ESTABLISH
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_EST
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|LC_RELEASE
)paren
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_BC_REL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|init_chan
id|init_chan
c_func
(paren
r_int
id|chan
comma
r_int
id|cardnr
comma
r_int
id|hscx
comma
r_int
r_int
id|ces
)paren
(brace
r_struct
id|IsdnCard
op_star
id|card
op_assign
id|cards
op_plus
id|cardnr
suffix:semicolon
r_struct
id|Channel
op_star
id|chanp
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
id|chanp-&gt;sp
op_assign
id|card-&gt;sp
suffix:semicolon
id|chanp-&gt;hscx
op_assign
id|hscx
suffix:semicolon
id|chanp-&gt;chan
op_assign
id|chan
suffix:semicolon
id|chanp-&gt;incoming
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;debug
op_assign
l_int|0
suffix:semicolon
id|init_is
c_func
(paren
id|chan
comma
id|ces
)paren
suffix:semicolon
id|chanp-&gt;fi.fsm
op_assign
op_amp
id|callcfsm
suffix:semicolon
id|chanp-&gt;fi.state
op_assign
id|ST_NULL
suffix:semicolon
id|chanp-&gt;fi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;fi.userdata
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;fi.printdebug
op_assign
id|callc_debug
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.fsm
op_assign
op_amp
id|lcfsm
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.state
op_assign
id|ST_LC_NULL
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.userdata
op_assign
op_amp
id|chanp-&gt;lc_d
suffix:semicolon
id|chanp-&gt;lc_d.lcfi.printdebug
op_assign
id|lc_debug
suffix:semicolon
id|chanp-&gt;lc_d.type
op_assign
id|LC_D
suffix:semicolon
id|chanp-&gt;lc_d.ch
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;lc_d.st
op_assign
op_amp
id|chanp-&gt;is
suffix:semicolon
id|chanp-&gt;lc_d.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_d.lccall
op_assign
id|lccall_d
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;lc_d.lcfi
comma
op_amp
id|chanp-&gt;lc_d.act_timer
)paren
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.fsm
op_assign
op_amp
id|lcfsm
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.state
op_assign
id|ST_LC_NULL
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.debug
op_assign
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.userdata
op_assign
op_amp
id|chanp-&gt;lc_b
suffix:semicolon
id|chanp-&gt;lc_b.lcfi.printdebug
op_assign
id|dlc_debug
suffix:semicolon
id|chanp-&gt;lc_b.type
op_assign
id|LC_B
suffix:semicolon
id|chanp-&gt;lc_b.ch
op_assign
id|chanp
suffix:semicolon
id|chanp-&gt;lc_b.st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
id|chanp-&gt;lc_b.l2_establish
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.l2_start
op_assign
op_logical_neg
l_int|0
suffix:semicolon
id|chanp-&gt;lc_b.lccall
op_assign
id|lccall_b
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|chanp-&gt;lc_b.lcfi
comma
op_amp
id|chanp-&gt;lc_b.act_timer
)paren
suffix:semicolon
id|chanp-&gt;outcallref
op_assign
l_int|64
suffix:semicolon
id|chanp-&gt;data_open
op_assign
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|CallcNewChan
id|CallcNewChan
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|ces
comma
id|c
suffix:semicolon
id|chancount
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
id|chancount
op_add_assign
l_int|2
suffix:semicolon
id|chanlist
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|Smalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|Channel
)paren
op_star
id|chancount
comma
id|GFP_KERNEL
comma
l_string|&quot;chanlist&quot;
)paren
suffix:semicolon
id|c
op_assign
l_int|0
suffix:semicolon
id|ces
op_assign
id|randomces
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
(brace
id|init_chan
c_func
(paren
id|c
op_increment
comma
id|i
comma
l_int|1
comma
id|ces
op_increment
)paren
suffix:semicolon
id|ces
op_mod_assign
l_int|0xffff
suffix:semicolon
id|init_chan
c_func
(paren
id|c
op_increment
comma
id|i
comma
l_int|0
comma
id|ces
op_increment
)paren
suffix:semicolon
id|ces
op_mod_assign
l_int|0xffff
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;channels %d&bslash;n&quot;
comma
id|chancount
)paren
suffix:semicolon
r_return
(paren
id|chancount
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|release_is
id|release_is
c_func
(paren
r_int
id|chan
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanlist
(braket
id|chan
)braket
dot
id|is
suffix:semicolon
id|releasestack_isdnl2
c_func
(paren
id|st
)paren
suffix:semicolon
id|teles_rmlist
c_func
(paren
id|st-&gt;l1.hardware
comma
id|st
)paren
suffix:semicolon
id|BufQueueRelease
c_func
(paren
op_amp
id|st-&gt;l2.i_queue
)paren
suffix:semicolon
)brace
r_void
DECL|function|CallcFreeChan
id|CallcFreeChan
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chancount
suffix:semicolon
id|i
op_increment
)paren
id|release_is
c_func
(paren
id|i
)paren
suffix:semicolon
id|Sfree
c_func
(paren
(paren
r_void
op_star
)paren
id|chanlist
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lldata_handler
id|lldata_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_int
id|size
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|DL_DATA
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|ptr
op_add_assign
id|chanp-&gt;ds.l2.ihsize
suffix:semicolon
id|size
op_assign
id|ibh-&gt;datasize
op_minus
id|chanp-&gt;ds.l2.ihsize
suffix:semicolon
id|iif
dot
id|rcvcallb
c_func
(paren
id|drid
comma
id|chanp-&gt;chan
comma
id|ptr
comma
id|size
)paren
suffix:semicolon
)brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lldata_handler unknown primitive&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|lltrans_handler
id|lltrans_handler
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_struct
id|BufHeader
op_star
id|ibh
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
(paren
r_struct
id|Channel
op_star
)paren
id|st-&gt;l4.userdata
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
)paren
suffix:colon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|iif
dot
id|rcvcallb
c_func
(paren
id|drid
comma
id|chanp-&gt;chan
comma
id|ptr
comma
id|ibh-&gt;datasize
)paren
suffix:semicolon
)brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;lltrans_handler unknown primitive&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ll_writewakeup
id|ll_writewakeup
c_func
(paren
r_struct
id|PStack
op_star
id|st
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|st-&gt;l4.userdata
suffix:semicolon
id|isdn_ctrl
id|ic
suffix:semicolon
id|ic.driver
op_assign
id|drid
suffix:semicolon
id|ic.command
op_assign
id|ISDN_STAT_BSENT
suffix:semicolon
id|ic.arg
op_assign
id|chanp-&gt;chan
suffix:semicolon
id|iif
dot
id|statcallb
c_func
(paren
op_amp
id|ic
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_ds
id|init_ds
c_func
(paren
r_int
id|chan
comma
r_int
id|incoming
)paren
(brace
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
(paren
id|chanlist
(braket
id|chan
)braket
dot
id|ds
)paren
suffix:semicolon
r_struct
id|IsdnCardState
op_star
id|sp
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|chanlist
(braket
id|chan
)braket
dot
id|is.l1.hardware
suffix:semicolon
r_struct
id|HscxState
op_star
id|hsp
op_assign
id|sp-&gt;hs
op_plus
id|chanlist
(braket
id|chan
)braket
dot
id|hscx
suffix:semicolon
r_char
id|tmp
(braket
l_int|128
)braket
suffix:semicolon
id|st-&gt;l1.hardware
op_assign
id|sp
suffix:semicolon
id|hsp-&gt;mode
op_assign
l_int|2
suffix:semicolon
id|hsp-&gt;transbufsize
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|setstack_hscx
c_func
(paren
id|st
comma
id|hsp
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l2.extended
op_assign
l_int|0
suffix:semicolon
id|st-&gt;l2.laptype
op_assign
id|LAPB
suffix:semicolon
id|st-&gt;l2.orig
op_assign
op_logical_neg
id|incoming
suffix:semicolon
id|st-&gt;l2.t200
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1000 milliseconds */
id|st-&gt;l2.window
op_assign
l_int|3
suffix:semicolon
id|st-&gt;l2.n200
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* try 4 times       */
id|st-&gt;l2.t203
op_assign
l_int|5000
suffix:semicolon
multiline_comment|/* 5000 milliseconds */
id|st-&gt;l2.debug
op_assign
l_int|0xff
suffix:semicolon
id|st-&gt;l3.debug
op_assign
l_int|0xff
suffix:semicolon
r_switch
c_cond
(paren
id|chanlist
(braket
id|chan
)braket
dot
id|l2_active_protocol
)paren
(brace
r_case
(paren
id|ISDN_PROTO_L2_X75I
)paren
suffix:colon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;Channel %d x.75&quot;
comma
id|chan
)paren
suffix:semicolon
id|setstack_isdnl2
c_func
(paren
id|st
comma
id|tmp
)paren
suffix:semicolon
id|st-&gt;l2.l2l3
op_assign
id|lldata_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l2.l2man
op_assign
id|dcc_l2man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
l_int|NULL
suffix:semicolon
id|st-&gt;l4.l2writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|16
suffix:semicolon
id|st-&gt;ma
dot
id|manl2
c_func
(paren
id|st
comma
id|MDL_NOTEIPROC
comma
l_int|NULL
)paren
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Packet-Mode ? */
id|st-&gt;l1.hscxchannel
op_assign
id|chanlist
(braket
id|chan
)braket
dot
id|para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_HDLC
)paren
suffix:colon
id|st-&gt;l1.l1l2
op_assign
id|lltrans_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|2
suffix:semicolon
id|st-&gt;l1.hscxchannel
op_assign
id|chanlist
(braket
id|chan
)braket
dot
id|para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_PROTO_L2_TRANS
)paren
suffix:colon
id|st-&gt;l1.l1l2
op_assign
id|lltrans_handler
suffix:semicolon
id|st-&gt;l1.l1man
op_assign
id|dcc_l1man
suffix:semicolon
id|st-&gt;l4.userdata
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
id|st-&gt;l4.l1writewakeup
op_assign
id|ll_writewakeup
suffix:semicolon
id|st-&gt;l1.hscxmode
op_assign
l_int|1
suffix:semicolon
id|st-&gt;l1.hscxchannel
op_assign
id|chanlist
(braket
id|chan
)braket
dot
id|para.bchannel
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|channel_report
id|channel_report
c_func
(paren
r_int
id|i
)paren
(brace
)brace
r_static
r_void
DECL|function|command_debug
id|command_debug
c_func
(paren
r_struct
id|Channel
op_star
id|chanp
comma
r_char
op_star
id|s
)paren
(brace
r_char
id|tmp
(braket
l_int|64
)braket
comma
id|tm
(braket
l_int|32
)braket
suffix:semicolon
id|jiftime
c_func
(paren
id|tm
comma
id|jiffies
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s Channel %d LL-&gt;HL %s&bslash;n&quot;
comma
id|tm
comma
id|chanp-&gt;chan
comma
id|s
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|distr_debug
id|distr_debug
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chancount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|chanlist
(braket
id|i
)braket
dot
id|debug
op_assign
id|debugflags
op_amp
l_int|1
suffix:semicolon
id|chanlist
(braket
id|i
)braket
dot
id|fi.debug
op_assign
id|debugflags
op_amp
l_int|2
suffix:semicolon
id|chanlist
(braket
id|i
)braket
dot
id|is.l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|8
suffix:semicolon
id|chanlist
(braket
id|i
)braket
dot
id|ds.l2.l2m.debug
op_assign
id|debugflags
op_amp
l_int|16
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
id|cards
(braket
id|i
)braket
dot
id|sp-&gt;dlogflag
op_assign
id|debugflags
op_amp
l_int|4
suffix:semicolon
)brace
r_int
DECL|function|teles_command
id|teles_command
c_func
(paren
id|isdn_ctrl
op_star
id|ic
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|num
suffix:semicolon
r_switch
c_cond
(paren
id|ic-&gt;command
)paren
(brace
r_case
(paren
id|ISDN_CMD_SETEAZ
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|command_debug
c_func
(paren
id|chanp
comma
l_string|&quot;SETEAZ&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_case
(paren
id|ISDN_CMD_DIAL
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;DIAL %s&quot;
comma
id|ic-&gt;num
)paren
suffix:semicolon
id|command_debug
c_func
(paren
id|chanp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_DIAL
comma
id|ic
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTB
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|command_debug
c_func
(paren
id|chanp
comma
l_string|&quot;ACCEPTB&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTB
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_ACCEPTD
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|command_debug
c_func
(paren
id|chanp
comma
l_string|&quot;ACCEPTD&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_ACCEPTD
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_HANGUP
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
id|ic-&gt;arg
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
id|command_debug
c_func
(paren
id|chanp
comma
l_string|&quot;HANGUP&quot;
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|chanp-&gt;fi
comma
id|EV_HANGUP
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_LOCK
)paren
suffix:colon
id|teles_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_UNLOCK
)paren
suffix:colon
id|teles_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_IOCTL
)paren
suffix:colon
r_switch
c_cond
(paren
id|ic-&gt;arg
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nrcards
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|sp
)paren
id|teles_reportcard
c_func
(paren
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chancount
suffix:semicolon
id|i
op_increment
)paren
id|channel_report
c_func
(paren
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
id|debugflags
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;num
suffix:semicolon
id|distr_debug
c_func
(paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;debugging flags set to %x&bslash;n&quot;
comma
id|debugflags
)paren
suffix:semicolon
id|teles_putstatus
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&quot;
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
)paren
suffix:colon
id|num
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ic-&gt;num
suffix:semicolon
id|i
op_assign
id|num
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|chancount
)paren
r_break
suffix:semicolon
id|chanp
op_assign
id|chanlist
op_plus
id|i
suffix:semicolon
id|chanp-&gt;impair
op_assign
id|num
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;IMPAIR %x&quot;
comma
id|chanp-&gt;impair
)paren
suffix:semicolon
id|command_debug
c_func
(paren
id|chanp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ISDN_CMD_SETL2
)paren
suffix:colon
id|chanp
op_assign
id|chanlist
op_plus
(paren
id|ic-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;debug
op_amp
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;SETL2 %ld&quot;
comma
id|ic-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
id|command_debug
c_func
(paren
id|chanp
comma
id|tmp
)paren
suffix:semicolon
)brace
id|chanp-&gt;l2_protocol
op_assign
id|ic-&gt;arg
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|teles_writebuf
id|teles_writebuf
c_func
(paren
r_int
id|id
comma
r_int
id|chan
comma
r_const
id|u_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|user
)paren
(brace
r_struct
id|Channel
op_star
id|chanp
op_assign
id|chanlist
op_plus
id|chan
suffix:semicolon
r_struct
id|PStack
op_star
id|st
op_assign
op_amp
id|chanp-&gt;ds
suffix:semicolon
r_struct
id|BufHeader
op_star
id|ibh
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|byte
op_star
id|ptr
suffix:semicolon
id|err
op_assign
id|BufPoolGet
c_func
(paren
op_amp
id|ibh
comma
id|st-&gt;l1.sbufpool
comma
id|GFP_ATOMIC
comma
id|st
comma
l_int|21
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ptr
op_assign
id|DATAPTR
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;lc_b.l2_establish
)paren
id|i
op_assign
id|st-&gt;l2.ihsize
suffix:semicolon
r_else
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_plus
id|i
)paren
OG
id|BUFFER_SIZE
c_func
(paren
id|HSCX_SBUF_ORDER
comma
id|HSCX_SBUF_BPPS
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;teles_writebuf: packet too large!&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
id|ptr
op_add_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|memcpy_fromfs
c_func
(paren
id|ptr
comma
id|buf
comma
id|count
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|ptr
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|ibh-&gt;datasize
op_assign
id|count
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|chanp-&gt;data_open
)paren
(brace
r_if
c_cond
(paren
id|chanp-&gt;lc_b.l2_establish
)paren
id|chanp-&gt;ds.l3
dot
id|l3l2
c_func
(paren
op_amp
id|chanp-&gt;ds
comma
id|DL_DATA
comma
id|ibh
)paren
suffix:semicolon
r_else
id|chanp-&gt;ds.l2
dot
id|l2l1
c_func
(paren
op_amp
id|chanp-&gt;ds
comma
id|PH_DATA
comma
id|ibh
)paren
suffix:semicolon
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
r_else
(brace
id|BufPoolRelease
c_func
(paren
id|ibh
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_static
r_char
op_star
DECL|function|strcpyupto
id|strcpyupto
c_func
(paren
r_char
op_star
id|dest
comma
r_char
op_star
id|src
comma
r_char
id|upto
)paren
(brace
r_while
c_loop
(paren
op_star
id|src
op_logical_and
(paren
op_star
id|src
op_ne
id|upto
)paren
op_logical_and
(paren
op_star
id|src
op_ne
l_char|&squot;&bslash;0&squot;
)paren
)paren
op_star
id|dest
op_increment
op_assign
op_star
id|src
op_increment
suffix:semicolon
op_star
id|dest
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
(paren
id|src
)paren
suffix:semicolon
)brace
eof
