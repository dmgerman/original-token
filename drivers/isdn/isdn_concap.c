multiline_comment|/* $Id: isdn_concap.c,v 1.8 2000/05/11 22:29:20 kai Exp $&n; &n; * Linux ISDN subsystem, protocol encapsulation&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; */
multiline_comment|/* Stuff to support the concap_proto by isdn4linux. isdn4linux - specific&n; * stuff goes here. Stuff that depends only on the concap protocol goes to&n; * another -- protocol specific -- source file.&n; *&n; */
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &quot;isdn_x25iface.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &lt;linux/concap.h&gt;
macro_line|#include &quot;isdn_concap.h&quot;
multiline_comment|/* The following set of device service operations are for encapsulation&n;   protocols that require for reliable datalink semantics. That means:&n;&n;   - before any data is to be submitted the connection must explicitly&n;     be set up.&n;   - after the successful set up of the connection is signalled the&n;     connection is considered to be reliably up.&n;&n;   Auto-dialing ist not compatible with this requirements. Thus, auto-dialing &n;   is completely bypassed.&n;&n;   It might be possible to implement a (non standardized) datalink protocol&n;   that provides a reliable data link service while using some auto dialing&n;   mechanism. Such a protocol would need an auxiliary channel (i.e. user-user-&n;   signaling on the D-channel) while the B-channel is down.&n;   */
DECL|function|isdn_concap_dl_data_req
r_int
id|isdn_concap_dl_data_req
c_func
(paren
r_struct
id|concap_proto
op_star
id|concap
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
id|concap
op_member_access_from_pointer
id|net_dev
suffix:semicolon
id|isdn_net_dev
op_star
id|nd
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|ndev-&gt;priv
)paren
op_member_access_from_pointer
id|netdev
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
id|isdn_net_get_locked_lp
c_func
(paren
id|nd
)paren
suffix:semicolon
id|IX25DEBUG
c_func
(paren
l_string|&quot;isdn_concap_dl_data_req: %s &bslash;n&quot;
comma
id|concap-&gt;net_dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp
)paren
(brace
id|IX25DEBUG
c_func
(paren
l_string|&quot;isdn_concap_dl_data_req: %s : isdn_net_send_skb returned %d&bslash;n&quot;
comma
id|concap
op_member_access_from_pointer
id|net_dev
op_member_access_from_pointer
id|name
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|isdn_net_writebuf_skb
c_func
(paren
id|lp
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
id|IX25DEBUG
c_func
(paren
l_string|&quot;isdn_concap_dl_data_req: %s : isdn_net_send_skb returned %d&bslash;n&quot;
comma
id|concap
op_member_access_from_pointer
id|net_dev
op_member_access_from_pointer
id|name
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isdn_concap_dl_connect_req
r_int
id|isdn_concap_dl_connect_req
c_func
(paren
r_struct
id|concap_proto
op_star
id|concap
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
id|concap
op_member_access_from_pointer
id|net_dev
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|ndev-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|IX25DEBUG
c_func
(paren
l_string|&quot;isdn_concap_dl_connect_req: %s &bslash;n&quot;
comma
id|ndev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
multiline_comment|/* dial ... */
id|ret
op_assign
id|isdn_net_dial_req
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|IX25DEBUG
c_func
(paren
l_string|&quot;dialing failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|isdn_concap_dl_disconn_req
r_int
id|isdn_concap_dl_disconn_req
c_func
(paren
r_struct
id|concap_proto
op_star
id|concap
)paren
(brace
id|IX25DEBUG
c_func
(paren
l_string|&quot;isdn_concap_dl_disconn_req: %s &bslash;n&quot;
comma
id|concap
op_member_access_from_pointer
id|net_dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|concap
op_member_access_from_pointer
id|net_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|isdn_concap_reliable_dl_dops
r_struct
id|concap_device_ops
id|isdn_concap_reliable_dl_dops
op_assign
(brace
op_amp
id|isdn_concap_dl_data_req
comma
op_amp
id|isdn_concap_dl_connect_req
comma
op_amp
id|isdn_concap_dl_disconn_req
)brace
suffix:semicolon
DECL|variable|isdn_concap_demand_dial_dops
r_struct
id|concap_device_ops
id|isdn_concap_demand_dial_dops
op_assign
(brace
l_int|NULL
comma
multiline_comment|/* set this first entry to something like &amp;isdn_net_start_xmit,&n;&t;&t; but the entry part of the current isdn_net_start_xmit must be&n;&t;&t; separated first. */
multiline_comment|/* no connection control for demand dial semantics */
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
multiline_comment|/* The following should better go into a dedicated source file such that&n;   this sourcefile does not need to include any protocol specific header&n;   files. For now:&n;   */
DECL|function|isdn_concap_new
r_struct
id|concap_proto
op_star
id|isdn_concap_new
c_func
(paren
r_int
id|encap
)paren
(brace
r_switch
c_cond
(paren
id|encap
)paren
(brace
r_case
id|ISDN_NET_ENCAP_X25IFACE
suffix:colon
r_return
id|isdn_x25iface_proto_new
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
eof
