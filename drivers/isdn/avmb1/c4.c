multiline_comment|/*&n; * $Id: c4.c,v 1.20.6.1 2000/11/28 12:02:45 kai Exp $&n; * &n; * Module for AVM C4 card.&n; * &n; * (c) Copyright 1999 by Carsten Paeth (calle@calle.in-berlin.de)&n; * &n; * $Log: c4.c,v $&n; * Revision 1.20.6.1  2000/11/28 12:02:45  kai&n; * MODULE_DEVICE_TABLE for 2.4&n; *&n; * Revision 1.20.2.2  2000/11/26 17:47:53  kai&n; * added PCI_DEV_TABLE for 2.4&n; *&n; * Revision 1.20.2.1  2000/11/26 17:14:19  kai&n; * fix device ids&n; * also needs patches to include/linux/pci_ids.h&n; *&n; * Revision 1.20  2000/11/23 20:45:14  kai&n; * fixed module_init/exit stuff&n; * Note: compiled-in kernel doesn&squot;t work pre 2.2.18 anymore.&n; *&n; * Revision 1.19  2000/11/19 17:02:47  kai&n; * compatibility cleanup - part 3&n; *&n; * Revision 1.18  2000/11/01 14:05:02  calle&n; * - use module_init/module_exit from linux/init.h.&n; * - all static struct variables are initialized with &quot;membername:&quot; now.&n; * - avm_cs.c, let it work with newer pcmcia-cs.&n; *&n; * Revision 1.17  2000/10/10 17:44:19  kai&n; * changes from/for 2.2.18&n; *&n; * Revision 1.16  2000/08/20 07:30:13  keil&n; * changes for 2.4&n; *&n; * Revision 1.15  2000/08/08 09:24:19  calle&n; * calls to pci_enable_device surounded by #ifndef COMPAT_HAS_2_2_PCI&n; *&n; * Revision 1.14  2000/08/04 12:20:08  calle&n; * - Fix unsigned/signed warning in the right way ...&n; *&n; * Revision 1.13  2000/07/20 10:21:21  calle&n; * Bugfix: driver will not be unregistered, if not cards were detected.&n; *         this result in an oops in kcapi.c&n; *&n; * Revision 1.12  2000/06/19 16:51:53  keil&n; * don&squot;t free skb in irq context&n; *&n; * Revision 1.11  2000/06/19 15:11:24  keil&n; * avoid use of freed structs&n; * changes from 2.4.0-ac21&n; *&n; * Revision 1.10  2000/05/29 12:29:18  keil&n; * make pci_enable_dev compatible to 2.2 kernel versions&n; *&n; * Revision 1.9  2000/05/19 15:43:22  calle&n; * added calls to pci_device_start().&n; *&n; * Revision 1.8  2000/04/03 16:38:05  calle&n; * made suppress_pollack static.&n; *&n; * Revision 1.7  2000/04/03 13:29:24  calle&n; * make Tim Waugh happy (module unload races in 2.3.99-pre3).&n; * no real problem there, but now it is much cleaner ...&n; *&n; * Revision 1.6  2000/03/17 12:21:08  calle&n; * send patchvalues now working.&n; *&n; * Revision 1.5  2000/03/16 15:21:03  calle&n; * Bugfix in c4_remove: loop 5 times instead of 4 :-(&n; *&n; * Revision 1.4  2000/02/02 18:36:03  calle&n; * - Modules are now locked while init_module is running&n; * - fixed problem with memory mapping if address is not aligned&n; *&n; * Revision 1.3  2000/01/25 14:37:39  calle&n; * new message after successfull detection including card revision and&n; * used resources.&n; *&n; * Revision 1.2  2000/01/21 20:52:58  keil&n; * pci_find_subsys as local function for 2.2.X kernel&n; *&n; * Revision 1.1  2000/01/20 10:51:37  calle&n; * Added driver for C4.&n; *&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/capi.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &quot;capicmd.h&quot;
macro_line|#include &quot;capiutil.h&quot;
macro_line|#include &quot;capilli.h&quot;
macro_line|#include &quot;avmcard.h&quot;
DECL|variable|revision
r_static
r_char
op_star
id|revision
op_assign
l_string|&quot;$Revision: 1.20.6.1 $&quot;
suffix:semicolon
DECL|macro|CONFIG_C4_DEBUG
macro_line|#undef CONFIG_C4_DEBUG
DECL|macro|CONFIG_C4_POLLDEBUG
macro_line|#undef CONFIG_C4_POLLDEBUG
multiline_comment|/* ------------------------------------------------------------- */
DECL|variable|suppress_pollack
r_static
r_int
id|suppress_pollack
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pci_device_id
id|c4_pci_tbl
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_DEC
comma
id|PCI_DEVICE_ID_DEC_21285
comma
id|PCI_VENDOR_ID_AVM
comma
id|PCI_DEVICE_ID_AVM_C4
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|c4_pci_tbl
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Carsten Paeth &lt;calle@calle.in-berlin.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|suppress_pollack
comma
l_string|&quot;0-1i&quot;
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
DECL|variable|di
r_static
r_struct
id|capi_driver_interface
op_star
id|di
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
r_static
r_void
id|c4_dispatch_tx
c_func
(paren
id|avmcard
op_star
id|card
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|DC21285_DRAM_A0MR
mdefine_line|#define DC21285_DRAM_A0MR&t;0x40000000
DECL|macro|DC21285_DRAM_A1MR
mdefine_line|#define DC21285_DRAM_A1MR&t;0x40004000
DECL|macro|DC21285_DRAM_A2MR
mdefine_line|#define DC21285_DRAM_A2MR&t;0x40008000
DECL|macro|DC21285_DRAM_A3MR
mdefine_line|#define DC21285_DRAM_A3MR&t;0x4000C000
DECL|macro|CAS_OFFSET
mdefine_line|#define&t;CAS_OFFSET&t;0x88
DECL|macro|DC21285_ARMCSR_BASE
mdefine_line|#define DC21285_ARMCSR_BASE&t;0x42000000
DECL|macro|PCI_OUT_INT_STATUS
mdefine_line|#define&t;PCI_OUT_INT_STATUS&t;0x30
DECL|macro|PCI_OUT_INT_MASK
mdefine_line|#define&t;PCI_OUT_INT_MASK&t;0x34
DECL|macro|MAILBOX_0
mdefine_line|#define&t;MAILBOX_0&t;&t;0x50
DECL|macro|MAILBOX_1
mdefine_line|#define&t;MAILBOX_1&t;&t;0x54
DECL|macro|MAILBOX_2
mdefine_line|#define&t;MAILBOX_2&t;&t;0x58
DECL|macro|MAILBOX_3
mdefine_line|#define&t;MAILBOX_3&t;&t;0x5C
DECL|macro|DOORBELL
mdefine_line|#define&t;DOORBELL&t;&t;0x60
DECL|macro|DOORBELL_SETUP
mdefine_line|#define&t;DOORBELL_SETUP&t;&t;0x64
DECL|macro|CHAN_1_CONTROL
mdefine_line|#define CHAN_1_CONTROL&t;&t;0x90
DECL|macro|CHAN_2_CONTROL
mdefine_line|#define CHAN_2_CONTROL&t;&t;0xB0
DECL|macro|DRAM_TIMING
mdefine_line|#define DRAM_TIMING&t;&t;0x10C
DECL|macro|DRAM_ADDR_SIZE_0
mdefine_line|#define DRAM_ADDR_SIZE_0&t;0x110
DECL|macro|DRAM_ADDR_SIZE_1
mdefine_line|#define DRAM_ADDR_SIZE_1&t;0x114
DECL|macro|DRAM_ADDR_SIZE_2
mdefine_line|#define DRAM_ADDR_SIZE_2&t;0x118
DECL|macro|DRAM_ADDR_SIZE_3
mdefine_line|#define DRAM_ADDR_SIZE_3&t;0x11C
DECL|macro|SA_CONTROL
mdefine_line|#define&t;SA_CONTROL&t;&t;0x13C
DECL|macro|XBUS_CYCLE
mdefine_line|#define&t;XBUS_CYCLE&t;&t;0x148
DECL|macro|XBUS_STROBE
mdefine_line|#define&t;XBUS_STROBE&t;&t;0x14C
DECL|macro|DBELL_PCI_MASK
mdefine_line|#define&t;DBELL_PCI_MASK&t;&t;0x150
DECL|macro|DBELL_SA_MASK
mdefine_line|#define DBELL_SA_MASK&t;&t;0x154
DECL|macro|SDRAM_SIZE
mdefine_line|#define SDRAM_SIZE&t;&t;0x1000000
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|MBOX_PEEK_POKE
mdefine_line|#define&t;MBOX_PEEK_POKE&t;&t;MAILBOX_0
DECL|macro|DBELL_ADDR
mdefine_line|#define DBELL_ADDR&t;&t;0x01
DECL|macro|DBELL_DATA
mdefine_line|#define DBELL_DATA&t;&t;0x02
DECL|macro|DBELL_RNWR
mdefine_line|#define DBELL_RNWR&t;&t;0x40
DECL|macro|DBELL_INIT
mdefine_line|#define DBELL_INIT&t;&t;0x80
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|MBOX_UP_ADDR
mdefine_line|#define&t;MBOX_UP_ADDR&t;&t;MAILBOX_0
DECL|macro|MBOX_UP_LEN
mdefine_line|#define&t;MBOX_UP_LEN&t;&t;MAILBOX_1
DECL|macro|MBOX_DOWN_ADDR
mdefine_line|#define&t;MBOX_DOWN_ADDR&t;&t;MAILBOX_2
DECL|macro|MBOX_DOWN_LEN
mdefine_line|#define&t;MBOX_DOWN_LEN&t;&t;MAILBOX_3
DECL|macro|DBELL_UP_HOST
mdefine_line|#define&t;DBELL_UP_HOST&t;&t;0x00000100
DECL|macro|DBELL_UP_ARM
mdefine_line|#define&t;DBELL_UP_ARM&t;&t;0x00000200
DECL|macro|DBELL_DOWN_HOST
mdefine_line|#define&t;DBELL_DOWN_HOST&t;&t;0x00000400
DECL|macro|DBELL_DOWN_ARM
mdefine_line|#define&t;DBELL_DOWN_ARM&t;&t;0x00000800
DECL|macro|DBELL_RESET_HOST
mdefine_line|#define&t;DBELL_RESET_HOST&t;0x40000000
DECL|macro|DBELL_RESET_ARM
mdefine_line|#define&t;DBELL_RESET_ARM&t;&t;0x80000000
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|DRAM_TIMING_DEF
mdefine_line|#define&t;DRAM_TIMING_DEF&t;&t;0x001A01A5
DECL|macro|DRAM_AD_SZ_DEF0
mdefine_line|#define DRAM_AD_SZ_DEF0&t;&t;0x00000045
DECL|macro|DRAM_AD_SZ_NULL
mdefine_line|#define DRAM_AD_SZ_NULL&t;&t;0x00000000
DECL|macro|SA_CTL_ALLRIGHT
mdefine_line|#define SA_CTL_ALLRIGHT&t;&t;0x64AA0271
DECL|macro|INIT_XBUS_CYCLE
mdefine_line|#define&t;INIT_XBUS_CYCLE&t;&t;0x100016DB
DECL|macro|INIT_XBUS_STROBE
mdefine_line|#define&t;INIT_XBUS_STROBE&t;0xF1F1F1F1
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|RESET_TIMEOUT
mdefine_line|#define&t;RESET_TIMEOUT&t;&t;(15*HZ)&t;/* 15 sec */
DECL|macro|PEEK_POKE_TIMEOUT
mdefine_line|#define&t;PEEK_POKE_TIMEOUT&t;(HZ/10)&t;/* 0.1 sec */
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|c4outmeml
mdefine_line|#define c4outmeml(addr, value)&t;writel(value, addr)
DECL|macro|c4inmeml
mdefine_line|#define c4inmeml(addr)&t;readl(addr)
DECL|macro|c4outmemw
mdefine_line|#define c4outmemw(addr, value)&t;writew(value, addr)
DECL|macro|c4inmemw
mdefine_line|#define c4inmemw(addr)&t;readw(addr)
DECL|macro|c4outmemb
mdefine_line|#define c4outmemb(addr, value)&t;writeb(value, addr)
DECL|macro|c4inmemb
mdefine_line|#define c4inmemb(addr)&t;readb(addr)
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|wait_for_doorbell
r_static
r_inline
r_int
id|wait_for_doorbell
c_func
(paren
id|avmcard
op_star
id|card
comma
r_int
r_int
id|t
)paren
(brace
r_int
r_int
id|stop
suffix:semicolon
id|stop
op_assign
id|jiffies
op_plus
id|t
suffix:semicolon
r_while
c_loop
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
)paren
op_ne
l_int|0xffffffff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c4_poke
r_static
r_int
id|c4_poke
c_func
(paren
id|avmcard
op_star
id|card
comma
r_int
r_int
id|off
comma
r_int
r_int
id|value
)paren
(brace
r_if
c_cond
(paren
id|wait_for_doorbell
c_func
(paren
id|card
comma
id|HZ
op_div
l_int|10
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_PEEK_POKE
comma
id|off
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_for_doorbell
c_func
(paren
id|card
comma
id|HZ
op_div
l_int|10
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_PEEK_POKE
comma
id|value
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_DATA
op_or
id|DBELL_ADDR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c4_peek
r_static
r_int
id|c4_peek
c_func
(paren
id|avmcard
op_star
id|card
comma
r_int
r_int
id|off
comma
r_int
r_int
op_star
id|valuep
)paren
(brace
r_if
c_cond
(paren
id|wait_for_doorbell
c_func
(paren
id|card
comma
id|HZ
op_div
l_int|10
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_PEEK_POKE
comma
id|off
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_RNWR
op_or
id|DBELL_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_for_doorbell
c_func
(paren
id|card
comma
id|HZ
op_div
l_int|10
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
op_star
id|valuep
op_assign
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_PEEK_POKE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_load_t4file
r_static
r_int
id|c4_load_t4file
c_func
(paren
id|avmcard
op_star
id|card
comma
id|capiloaddatapart
op_star
id|t4file
)paren
(brace
id|__u32
id|val
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|left
comma
id|retval
suffix:semicolon
id|__u32
id|loadoff
op_assign
l_int|0
suffix:semicolon
id|dp
op_assign
id|t4file-&gt;data
suffix:semicolon
id|left
op_assign
id|t4file-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|left
op_ge
r_sizeof
(paren
id|__u32
)paren
)paren
(brace
r_if
c_cond
(paren
id|t4file-&gt;user
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|val
comma
id|dp
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|val
comma
id|dp
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|loadoff
comma
id|val
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: corrupted firmware file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|left
op_sub_assign
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
id|loadoff
op_add_assign
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|t4file-&gt;user
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|val
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|val
comma
id|dp
comma
id|left
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|loadoff
comma
id|val
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: corrupted firmware file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|_put_byte
r_static
r_inline
r_void
id|_put_byte
c_func
(paren
r_void
op_star
op_star
id|pp
comma
id|__u8
id|val
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
op_star
id|s
op_increment
op_assign
id|val
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
)brace
DECL|function|_put_word
r_static
r_inline
r_void
id|_put_word
c_func
(paren
r_void
op_star
op_star
id|pp
comma
id|__u32
id|val
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
op_star
id|s
op_increment
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
)brace
DECL|function|_put_slice
r_static
r_inline
r_void
id|_put_slice
c_func
(paren
r_void
op_star
op_star
id|pp
comma
r_int
r_char
op_star
id|dp
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
id|len
suffix:semicolon
id|_put_word
c_func
(paren
id|pp
comma
id|i
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
id|_put_byte
c_func
(paren
id|pp
comma
op_star
id|dp
op_increment
)paren
suffix:semicolon
)brace
DECL|function|_get_byte
r_static
r_inline
id|__u8
id|_get_byte
c_func
(paren
r_void
op_star
op_star
id|pp
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
id|__u8
id|val
suffix:semicolon
id|val
op_assign
op_star
id|s
op_increment
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|_get_word
r_static
r_inline
id|__u32
id|_get_word
c_func
(paren
r_void
op_star
op_star
id|pp
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
id|__u32
id|val
suffix:semicolon
id|val
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|8
)paren
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|16
)paren
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|24
)paren
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|_get_slice
r_static
r_inline
id|__u32
id|_get_slice
c_func
(paren
r_void
op_star
op_star
id|pp
comma
r_int
r_char
op_star
id|dp
)paren
(brace
r_int
r_int
id|len
comma
id|i
suffix:semicolon
id|len
op_assign
id|i
op_assign
id|_get_word
c_func
(paren
id|pp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
op_star
id|dp
op_increment
op_assign
id|_get_byte
c_func
(paren
id|pp
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_reset
r_static
r_void
id|c4_reset
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
r_int
id|stop
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_RESET_ARM
)paren
suffix:semicolon
id|stop
op_assign
id|jiffies
op_plus
id|HZ
op_star
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
)paren
op_ne
l_int|0xffffffff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
)paren
r_return
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_ADDR
)paren
suffix:semicolon
)brace
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|CHAN_1_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|CHAN_2_CONTROL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_detect
r_static
r_int
id|c4_detect
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
r_int
id|stop
comma
id|dummy
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|PCI_OUT_INT_MASK
comma
l_int|0x0c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|PCI_OUT_INT_MASK
)paren
op_ne
l_int|0x0c
)paren
r_return
l_int|1
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_RESET_ARM
)paren
suffix:semicolon
id|stop
op_assign
id|jiffies
op_plus
id|HZ
op_star
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
)paren
op_ne
l_int|0xffffffff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
)paren
r_return
l_int|2
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_ADDR
)paren
suffix:semicolon
)brace
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|CHAN_1_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|CHAN_2_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MAILBOX_0
comma
l_int|0x55aa55aa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MAILBOX_0
)paren
op_ne
l_int|0x55aa55aa
)paren
r_return
l_int|3
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MAILBOX_0
comma
l_int|0xaa55aa55
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MAILBOX_0
)paren
op_ne
l_int|0xaa55aa55
)paren
r_return
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DBELL_SA_MASK
comma
l_int|0
)paren
)paren
r_return
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DBELL_PCI_MASK
comma
l_int|0
)paren
)paren
r_return
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|SA_CONTROL
comma
id|SA_CTL_ALLRIGHT
)paren
)paren
r_return
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|XBUS_CYCLE
comma
id|INIT_XBUS_CYCLE
)paren
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|XBUS_STROBE
comma
id|INIT_XBUS_STROBE
)paren
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_TIMING
comma
l_int|0
)paren
)paren
r_return
l_int|9
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
id|DC21285_DRAM_A0MR
comma
op_amp
id|dummy
)paren
)paren
r_return
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
id|DC21285_DRAM_A1MR
comma
op_amp
id|dummy
)paren
)paren
r_return
l_int|11
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
id|DC21285_DRAM_A2MR
comma
op_amp
id|dummy
)paren
)paren
r_return
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
id|DC21285_DRAM_A3MR
comma
op_amp
id|dummy
)paren
)paren
r_return
l_int|13
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_DRAM_A0MR
op_plus
id|CAS_OFFSET
comma
l_int|0
)paren
)paren
r_return
l_int|14
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_DRAM_A1MR
op_plus
id|CAS_OFFSET
comma
l_int|0
)paren
)paren
r_return
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_DRAM_A2MR
op_plus
id|CAS_OFFSET
comma
l_int|0
)paren
)paren
r_return
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_DRAM_A3MR
op_plus
id|CAS_OFFSET
comma
l_int|0
)paren
)paren
r_return
l_int|17
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_TIMING
comma
id|DRAM_TIMING_DEF
)paren
)paren
r_return
l_int|18
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_ADDR_SIZE_0
comma
id|DRAM_AD_SZ_DEF0
)paren
)paren
r_return
l_int|19
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_ADDR_SIZE_1
comma
id|DRAM_AD_SZ_NULL
)paren
)paren
r_return
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_ADDR_SIZE_2
comma
id|DRAM_AD_SZ_NULL
)paren
)paren
r_return
l_int|21
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
id|DC21285_ARMCSR_BASE
op_plus
id|DRAM_ADDR_SIZE_3
comma
id|DRAM_AD_SZ_NULL
)paren
)paren
r_return
l_int|22
suffix:semicolon
multiline_comment|/* Transputer test */
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x000000
comma
l_int|0x11111111
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x400000
comma
l_int|0x22222222
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x800000
comma
l_int|0x33333333
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0xC00000
comma
l_int|0x44444444
)paren
)paren
r_return
l_int|23
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x000000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x11111111
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x400000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x22222222
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x800000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x33333333
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0xC00000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x44444444
)paren
r_return
l_int|24
suffix:semicolon
r_if
c_cond
(paren
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x000000
comma
l_int|0x55555555
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x400000
comma
l_int|0x66666666
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0x800000
comma
l_int|0x77777777
)paren
op_logical_or
id|c4_poke
c_func
(paren
id|card
comma
l_int|0xC00000
comma
l_int|0x88888888
)paren
)paren
r_return
l_int|25
suffix:semicolon
r_if
c_cond
(paren
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x000000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x55555555
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x400000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x66666666
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0x800000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x77777777
op_logical_or
id|c4_peek
c_func
(paren
id|card
comma
l_int|0xC00000
comma
op_amp
id|dummy
)paren
op_logical_or
id|dummy
op_ne
l_int|0x88888888
)paren
r_return
l_int|26
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_dispatch_tx
r_static
r_void
id|c4_dispatch_tx
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|avmcard_dmainfo
op_star
id|dma
op_assign
id|card-&gt;dma
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
id|cmd
comma
id|subcmd
suffix:semicolon
id|__u16
id|len
suffix:semicolon
id|__u32
id|txlen
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;csr
op_amp
id|DBELL_DOWN_ARM
)paren
(brace
multiline_comment|/* tx busy */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|dma-&gt;send_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
macro_line|#ifdef CONFIG_C4_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx underrun&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|len
op_assign
id|CAPIMSG_LEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|p
op_assign
id|dma-&gt;sendbuf
suffix:semicolon
r_if
c_cond
(paren
id|CAPICMD
c_func
(paren
id|cmd
comma
id|subcmd
)paren
op_eq
id|CAPI_DATA_B3_REQ
)paren
(brace
id|__u16
id|dlen
op_assign
id|CAPIMSG_DATALEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_DATA_B3_REQ
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
op_plus
id|len
comma
id|dlen
)paren
suffix:semicolon
)brace
r_else
(brace
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_MESSAGE
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
)brace
id|txlen
op_assign
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|dma-&gt;sendbuf
suffix:semicolon
macro_line|#ifdef CONFIG_C4_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx put msg len=%d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|txlen
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|txlen
op_assign
id|skb-&gt;len
op_minus
l_int|2
suffix:semicolon
macro_line|#ifdef CONFIG_C4_POLLDEBUG
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_eq
id|SEND_POLLACK
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: ack to c4&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_C4_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx put 0x%x len=%d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|skb-&gt;data
(braket
l_int|2
)braket
comma
id|txlen
)paren
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|dma-&gt;sendbuf
comma
id|skb-&gt;data
op_plus
l_int|2
comma
id|skb-&gt;len
op_minus
l_int|2
)paren
suffix:semicolon
)brace
id|txlen
op_assign
(paren
id|txlen
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_DOWN_ADDR
comma
id|virt_to_phys
c_func
(paren
id|dma-&gt;sendbuf
)paren
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_DOWN_LEN
comma
id|txlen
)paren
suffix:semicolon
id|card-&gt;csr
op_or_assign
id|DBELL_DOWN_ARM
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_DOWN_ARM
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|queue_pollack
r_static
r_void
id|queue_pollack
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|3
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost poll ack&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_POLLACK
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_handle_rx
r_static
r_void
id|c4_handle_rx
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|avmcard_dmainfo
op_star
id|dma
op_assign
id|card-&gt;dma
suffix:semicolon
r_struct
id|capi_ctr
op_star
id|ctrl
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
op_assign
id|dma-&gt;recvbuf
suffix:semicolon
id|__u32
id|ApplId
comma
id|MsgLen
comma
id|DataB3Len
comma
id|NCCI
comma
id|WindowSize
suffix:semicolon
id|__u8
id|b1cmd
op_assign
id|_get_byte
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|__u32
id|cidx
suffix:semicolon
macro_line|#ifdef CONFIG_C4_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx 0x%x len=%lu&bslash;n&quot;
comma
id|card-&gt;name
comma
id|b1cmd
comma
(paren
r_int
r_int
)paren
id|dma-&gt;recvlen
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|b1cmd
)paren
(brace
r_case
id|RECEIVE_DATA_B3_IND
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|DataB3Len
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;databuf
)paren
suffix:semicolon
id|cidx
op_assign
id|CAPIMSG_CONTROLLER
c_func
(paren
id|card-&gt;msgbuf
)paren
op_minus
id|card-&gt;cardnr
suffix:semicolon
r_if
c_cond
(paren
id|cidx
OG
l_int|3
)paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
r_if
c_cond
(paren
id|MsgLen
OL
l_int|30
)paren
(brace
multiline_comment|/* not CAPI 64Bit */
id|memset
c_func
(paren
id|card-&gt;msgbuf
op_plus
id|MsgLen
comma
l_int|0
comma
l_int|30
op_minus
id|MsgLen
)paren
suffix:semicolon
id|MsgLen
op_assign
l_int|30
suffix:semicolon
id|CAPIMSG_SETLEN
c_func
(paren
id|card-&gt;msgbuf
comma
l_int|30
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|DataB3Len
op_plus
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|DataB3Len
)paren
comma
id|card-&gt;databuf
comma
id|DataB3Len
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|handle_capimsg
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_MESSAGE
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|cidx
op_assign
id|CAPIMSG_CONTROLLER
c_func
(paren
id|card-&gt;msgbuf
)paren
op_minus
id|card-&gt;cardnr
suffix:semicolon
r_if
c_cond
(paren
id|cidx
OG
l_int|3
)paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|handle_capimsg
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_NEW_NCCI
suffix:colon
id|ApplId
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|NCCI
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|WindowSize
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|cidx
op_assign
(paren
id|NCCI
op_amp
l_int|0x7f
)paren
op_minus
id|card-&gt;cardnr
suffix:semicolon
r_if
c_cond
(paren
id|cidx
OG
l_int|3
)paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|new_ncci
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|NCCI
comma
id|WindowSize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_FREE_NCCI
suffix:colon
id|ApplId
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|NCCI
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NCCI
op_ne
l_int|0xffffffff
)paren
(brace
id|cidx
op_assign
(paren
id|NCCI
op_amp
l_int|0x7f
)paren
op_minus
id|card-&gt;cardnr
suffix:semicolon
r_if
c_cond
(paren
id|cidx
OG
l_int|3
)paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|free_ncci
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|cidx
OL
l_int|4
suffix:semicolon
id|cidx
op_increment
)paren
(brace
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|appl_released
c_func
(paren
id|ctrl
comma
id|ApplId
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_START
suffix:colon
macro_line|#ifdef CONFIG_C4_POLLDEBUG
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: poll from c4&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|suppress_pollack
)paren
id|queue_pollack
c_func
(paren
id|card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|cidx
OL
l_int|4
suffix:semicolon
id|cidx
op_increment
)paren
(brace
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|resume_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_STOP
suffix:colon
r_for
c_loop
(paren
id|cidx
op_assign
l_int|0
suffix:semicolon
id|cidx
OL
l_int|4
suffix:semicolon
id|cidx
op_increment
)paren
(brace
id|ctrl
op_assign
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
dot
id|capi_ctrl
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|suspend_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_INIT
suffix:colon
id|cidx
op_assign
id|card-&gt;nlogcontr
op_increment
suffix:semicolon
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|cidx
)braket
suffix:semicolon
id|ctrl
op_assign
id|cinfo-&gt;capi_ctrl
suffix:semicolon
id|cinfo-&gt;versionlen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|cinfo-&gt;versionbuf
)paren
suffix:semicolon
id|b1_parse_version
c_func
(paren
id|cinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s-card (%s) now active&bslash;n&quot;
comma
id|card-&gt;name
comma
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
comma
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|ready
c_func
(paren
id|cinfo-&gt;capi_ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_TASK_READY
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: task %d &bslash;&quot;%s&bslash;&quot; ready.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ApplId
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_DEBUGMSG
suffix:colon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: DEBUG: %s&bslash;n&quot;
comma
id|card-&gt;name
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: c4_interrupt: 0x%x ???&bslash;n&quot;
comma
id|card-&gt;name
comma
id|b1cmd
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_handle_interrupt
r_static
r_void
id|c4_handle_interrupt
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|__u32
id|status
op_assign
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DBELL_RESET_HOST
)paren
(brace
r_int
id|i
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|PCI_OUT_INT_MASK
comma
l_int|0x0c
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unexpected reset&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
id|cinfo-&gt;version
comma
l_int|0
comma
r_sizeof
(paren
id|cinfo-&gt;version
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cinfo-&gt;capi_ctrl
)paren
id|cinfo-&gt;capi_ctrl
op_member_access_from_pointer
id|reseted
c_func
(paren
id|cinfo-&gt;capi_ctrl
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|status
op_and_assign
(paren
id|DBELL_UP_HOST
op_or
id|DBELL_DOWN_HOST
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_return
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|DBELL_UP_HOST
)paren
op_ne
l_int|0
)paren
(brace
id|card-&gt;dma-&gt;recvlen
op_assign
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_LEN
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_LEN
comma
l_int|0
)paren
suffix:semicolon
id|c4_handle_rx
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;dma-&gt;recvlen
op_assign
l_int|0
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_LEN
comma
r_sizeof
(paren
id|card-&gt;dma-&gt;recvbuf
)paren
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_UP_ARM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|DBELL_DOWN_HOST
)paren
op_ne
l_int|0
)paren
(brace
id|card-&gt;csr
op_and_assign
op_complement
id|DBELL_DOWN_ARM
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|card-&gt;csr
op_amp
id|DBELL_DOWN_HOST
)paren
(brace
r_if
c_cond
(paren
id|c4inmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_DOWN_LEN
)paren
op_eq
l_int|0
)paren
(brace
id|card-&gt;csr
op_and_assign
op_complement
id|DBELL_DOWN_ARM
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|c4_interrupt
r_static
r_void
id|c4_interrupt
c_func
(paren
r_int
id|interrupt
comma
r_void
op_star
id|devptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|avmcard
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
id|avmcard
op_star
)paren
id|devptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: interrupt: wrong device&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;interrupt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: reentering interrupt hander&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|card-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
id|c4_handle_interrupt
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_send_init
r_static
r_void
id|c4_send_init
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|15
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost register appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_INIT
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|AVM_NAPPS
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|AVM_NCCI_PER_CHANNEL
op_star
l_int|30
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|card-&gt;cardnr
op_minus
l_int|1
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|queue_sendconfigword
r_static
r_int
id|queue_sendconfigword
c_func
(paren
id|avmcard
op_star
id|card
comma
id|__u32
id|val
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|3
op_plus
l_int|4
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, send config&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|val
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|queue_sendconfig
r_static
r_int
id|queue_sendconfig
c_func
(paren
id|avmcard
op_star
id|card
comma
r_char
id|cval
(braket
l_int|4
)braket
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|3
op_plus
l_int|4
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, send config&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|cval
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|cval
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|cval
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|cval
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c4_send_config
r_static
r_int
id|c4_send_config
c_func
(paren
id|avmcard
op_star
id|card
comma
id|capiloaddatapart
op_star
id|config
)paren
(brace
id|__u8
id|val
(braket
l_int|4
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|left
comma
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|queue_sendconfigword
c_func
(paren
id|card
comma
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|queue_sendconfigword
c_func
(paren
id|card
comma
id|config-&gt;len
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
id|dp
op_assign
id|config-&gt;data
suffix:semicolon
id|left
op_assign
id|config-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|left
op_ge
r_sizeof
(paren
id|__u32
)paren
)paren
(brace
r_if
c_cond
(paren
id|config-&gt;user
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|val
comma
id|dp
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|val
comma
id|dp
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|queue_sendconfig
c_func
(paren
id|card
comma
id|val
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
id|left
op_sub_assign
r_sizeof
(paren
id|val
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|memset
c_func
(paren
id|val
comma
l_int|0
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|config-&gt;user
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|val
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|val
comma
id|dp
comma
id|left
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|queue_sendconfig
c_func
(paren
id|card
comma
id|val
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|retval
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c4_load_firmware
r_static
r_int
id|c4_load_firmware
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|capiloaddata
op_star
id|data
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|c4_load_t4file
c_func
(paren
id|card
comma
op_amp
id|data-&gt;firmware
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load t4file!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|c4_reset
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;csr
op_assign
l_int|0
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_LEN
comma
l_int|0
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_DOWN_LEN
comma
l_int|0
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_INIT
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_UP_HOST
op_or
id|DBELL_DOWN_HOST
op_or
id|DBELL_RESET_HOST
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|PCI_OUT_INT_MASK
comma
l_int|0x08
)paren
suffix:semicolon
id|card-&gt;dma-&gt;recvlen
op_assign
l_int|0
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_ADDR
comma
id|virt_to_phys
c_func
(paren
id|card-&gt;dma-&gt;recvbuf
)paren
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|MBOX_UP_LEN
comma
r_sizeof
(paren
id|card-&gt;dma-&gt;recvbuf
)paren
)paren
suffix:semicolon
id|c4outmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|DOORBELL
comma
id|DBELL_UP_ARM
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;configuration.len
OG
l_int|0
op_logical_and
id|data-&gt;configuration.data
)paren
(brace
id|retval
op_assign
id|c4_send_config
c_func
(paren
id|card
comma
op_amp
id|data-&gt;configuration
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to set config!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|c4_reset
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
id|c4_send_init
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c4_reset_ctr
r_void
id|c4_reset_ctr
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmcard
op_star
id|card
op_assign
(paren
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
)paren
op_member_access_from_pointer
id|card
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
suffix:semicolon
r_int
id|i
suffix:semicolon
id|c4_reset
c_func
(paren
id|card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
id|cinfo-&gt;version
comma
l_int|0
comma
r_sizeof
(paren
id|cinfo-&gt;version
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cinfo-&gt;capi_ctrl
)paren
id|cinfo-&gt;capi_ctrl
op_member_access_from_pointer
id|reseted
c_func
(paren
id|cinfo-&gt;capi_ctrl
)paren
suffix:semicolon
)brace
)brace
DECL|function|c4_remove_ctr
r_static
r_void
id|c4_remove_ctr
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmcard
op_star
id|card
op_assign
(paren
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
)paren
op_member_access_from_pointer
id|card
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
suffix:semicolon
r_int
id|i
suffix:semicolon
id|c4_reset
c_func
(paren
id|card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cinfo-&gt;capi_ctrl
)paren
(brace
id|di
op_member_access_from_pointer
id|detach_ctr
c_func
(paren
id|cinfo-&gt;capi_ctrl
)paren
suffix:semicolon
id|cinfo-&gt;capi_ctrl
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|free_irq
c_func
(paren
id|card-&gt;irq
comma
id|card
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|card-&gt;mbase
)paren
op_amp
id|PAGE_MASK
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|card-&gt;port
comma
id|AVMB1_PORTLEN
)paren
suffix:semicolon
id|ctrl-&gt;driverdata
op_assign
l_int|0
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_register_appl
r_void
id|c4_register_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
comma
id|capi_register_params
op_star
id|rp
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|want
op_assign
id|rp-&gt;level3cnt
suffix:semicolon
r_int
id|nconn
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|ctrl-&gt;cnr
op_eq
id|card-&gt;cardnr
)paren
(brace
r_if
c_cond
(paren
id|want
OG
l_int|0
)paren
id|nconn
op_assign
id|want
suffix:semicolon
r_else
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
op_star
l_int|4
op_star
op_minus
id|want
suffix:semicolon
r_if
c_cond
(paren
id|nconn
op_eq
l_int|0
)paren
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
op_star
l_int|4
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|23
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost register appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_REGISTER
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|appl
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
l_int|1024
op_star
(paren
id|nconn
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|nconn
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|rp-&gt;datablkcnt
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|rp-&gt;datablklen
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|ctrl
op_member_access_from_pointer
id|appl_registered
c_func
(paren
id|ctrl
comma
id|appl
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_release_appl
r_void
id|c4_release_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|ctrl-&gt;cnr
op_eq
id|card-&gt;cardnr
)paren
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|7
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost release appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_RELEASE
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|appl
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_send_message
r_static
r_void
id|c4_send_message
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|c4_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_procinfo
r_static
r_char
op_star
id|c4_procinfo
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cinfo
)paren
r_return
l_string|&quot;&quot;
suffix:semicolon
id|sprintf
c_func
(paren
id|cinfo-&gt;infobuf
comma
l_string|&quot;%s %s 0x%x %d 0x%lx&quot;
comma
id|cinfo-&gt;cardname
(braket
l_int|0
)braket
ques
c_cond
id|cinfo-&gt;cardname
suffix:colon
l_string|&quot;-&quot;
comma
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
ques
c_cond
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
suffix:colon
l_string|&quot;-&quot;
comma
id|cinfo-&gt;card
ques
c_cond
id|cinfo-&gt;card-&gt;port
suffix:colon
l_int|0x0
comma
id|cinfo-&gt;card
ques
c_cond
id|cinfo-&gt;card-&gt;irq
suffix:colon
l_int|0
comma
id|cinfo-&gt;card
ques
c_cond
id|cinfo-&gt;card-&gt;membase
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
id|cinfo-&gt;infobuf
suffix:semicolon
)brace
DECL|function|c4_read_proc
r_static
r_int
id|c4_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|__u8
id|flag
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;name&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%x&bslash;n&quot;
comma
l_string|&quot;io&quot;
comma
id|card-&gt;port
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %d&bslash;n&quot;
comma
l_string|&quot;irq&quot;
comma
id|card-&gt;irq
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%lx&bslash;n&quot;
comma
l_string|&quot;membase&quot;
comma
id|card-&gt;membase
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;cardtype
)paren
(brace
r_case
id|avm_b1isa
suffix:colon
id|s
op_assign
l_string|&quot;B1 ISA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pci
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pcmcia
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCMCIA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m1
suffix:colon
id|s
op_assign
l_string|&quot;M1&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m2
suffix:colon
id|s
op_assign
l_string|&quot;M2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1isa
suffix:colon
id|s
op_assign
l_string|&quot;T1 ISA (HEMA)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1pci
suffix:colon
id|s
op_assign
l_string|&quot;T1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_c4
suffix:colon
id|s
op_assign
l_string|&quot;C4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;???&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;type&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_driver&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_cardtype&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_SERIAL
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_serial&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|__u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;protocol&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; DSS1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; CT1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; VN3&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; NI1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; AUSTEL&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; ESS&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; 1TR6&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|__u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|5
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;linetype&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; point to point&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; point to multipoint&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; leased line without D-channel&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; leased line with D-channel&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;cardname&quot;
comma
id|cinfo-&gt;cardname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|c4_add_card
r_static
r_int
id|c4_add_card
c_func
(paren
r_struct
id|capi_driver
op_star
id|driver
comma
r_struct
id|capicardparams
op_star
id|p
)paren
(brace
r_int
r_int
id|base
comma
id|page_offset
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
suffix:semicolon
id|avmcard
op_star
id|card
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|i
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|card
op_assign
(paren
id|avmcard
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|avmcard
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no memory.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|avmcard
)paren
)paren
suffix:semicolon
id|card-&gt;dma
op_assign
(paren
id|avmcard_dmainfo
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|avmcard_dmainfo
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;dma
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no memory.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;dma
comma
l_int|0
comma
r_sizeof
(paren
id|avmcard_dmainfo
)paren
)paren
suffix:semicolon
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|avmctrl_info
)paren
op_star
l_int|4
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cinfo
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no memory.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cinfo
comma
l_int|0
comma
r_sizeof
(paren
id|avmctrl_info
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|card-&gt;ctrlinfo
op_assign
id|cinfo
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
id|cinfo-&gt;card
op_assign
id|card
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|card-&gt;name
comma
l_string|&quot;c4-%x&quot;
comma
id|p-&gt;port
)paren
suffix:semicolon
id|card-&gt;port
op_assign
id|p-&gt;port
suffix:semicolon
id|card-&gt;irq
op_assign
id|p-&gt;irq
suffix:semicolon
id|card-&gt;membase
op_assign
id|p-&gt;membase
suffix:semicolon
id|card-&gt;cardtype
op_assign
id|avm_c4
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|card-&gt;port
comma
id|AVMB1_PORTLEN
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ports 0x%03x-0x%03x in use.&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|card-&gt;port
comma
id|card-&gt;port
op_plus
id|AVMB1_PORTLEN
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|base
op_assign
id|card-&gt;membase
op_amp
id|PAGE_MASK
suffix:semicolon
id|page_offset
op_assign
id|card-&gt;membase
op_minus
id|base
suffix:semicolon
id|card-&gt;mbase
op_assign
id|ioremap_nocache
c_func
(paren
id|base
comma
id|page_offset
op_plus
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;mbase
)paren
(brace
id|card-&gt;mbase
op_add_assign
id|page_offset
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: can&squot;t remap memory at 0x%lx&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|card-&gt;membase
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|c4_detect
c_func
(paren
id|card
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: NO card at 0x%x (%d)&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|card-&gt;port
comma
id|retval
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|card-&gt;mbase
)paren
op_amp
id|PAGE_MASK
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|c4_reset
c_func
(paren
id|card
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|p-&gt;port
comma
id|AVMB1_PORTLEN
comma
id|card-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
id|request_irq
c_func
(paren
id|card-&gt;irq
comma
id|c4_interrupt
comma
id|SA_SHIRQ
comma
id|card-&gt;name
comma
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to get IRQ %d.&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|card-&gt;irq
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|card-&gt;mbase
)paren
op_amp
id|PAGE_MASK
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|card-&gt;port
comma
id|AVMB1_PORTLEN
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
id|cinfo-&gt;card
op_assign
id|card
suffix:semicolon
id|cinfo-&gt;capi_ctrl
op_assign
id|di
op_member_access_from_pointer
id|attach_ctr
c_func
(paren
id|driver
comma
id|card-&gt;name
comma
id|cinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cinfo-&gt;capi_ctrl
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: attach controller failed (%d).&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_decrement
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
id|i
)braket
suffix:semicolon
id|di
op_member_access_from_pointer
id|detach_ctr
c_func
(paren
id|cinfo-&gt;capi_ctrl
)paren
suffix:semicolon
)brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|card-&gt;mbase
)paren
op_amp
id|PAGE_MASK
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|card-&gt;irq
comma
id|card
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|card-&gt;port
comma
id|AVMB1_PORTLEN
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|card-&gt;cardnr
op_assign
id|cinfo-&gt;capi_ctrl-&gt;cnr
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: AVM C4 at i/o %#x, irq %d, mem %#lx&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|card-&gt;port
comma
id|card-&gt;irq
comma
id|card-&gt;membase
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|variable|c4_driver
r_static
r_struct
id|capi_driver
id|c4_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;c4&quot;
comma
id|revision
suffix:colon
l_string|&quot;0.0&quot;
comma
id|load_firmware
suffix:colon
id|c4_load_firmware
comma
id|reset_ctr
suffix:colon
id|c4_reset_ctr
comma
id|remove_ctr
suffix:colon
id|c4_remove_ctr
comma
id|register_appl
suffix:colon
id|c4_register_appl
comma
id|release_appl
suffix:colon
id|c4_release_appl
comma
id|send_message
suffix:colon
id|c4_send_message
comma
id|procinfo
suffix:colon
id|c4_procinfo
comma
id|ctr_read_proc
suffix:colon
id|c4_read_proc
comma
id|driver_read_proc
suffix:colon
l_int|0
comma
multiline_comment|/* use standard driver_read_proc */
id|add_card
suffix:colon
l_int|0
comma
multiline_comment|/* no add_card function */
)brace
suffix:semicolon
DECL|variable|ncards
r_static
r_int
id|ncards
op_assign
l_int|0
suffix:semicolon
DECL|function|c4_init
r_static
r_int
id|__init
id|c4_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|capi_driver
op_star
id|driver
op_assign
op_amp
id|c4_driver
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|driver-&gt;revision
comma
id|p
op_plus
l_int|1
comma
r_sizeof
(paren
id|driver-&gt;revision
)paren
)paren
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|driver-&gt;revision
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: revision %s&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|driver-&gt;revision
)paren
suffix:semicolon
id|di
op_assign
id|attach_capi_driver
c_func
(paren
id|driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|di
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to attach capi_driver&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: no PCI bus present&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|detach_capi_driver
c_func
(paren
id|driver
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pci_find_subsys
c_func
(paren
id|PCI_VENDOR_ID_DEC
comma
id|PCI_DEVICE_ID_DEC_21285
comma
id|PCI_VENDOR_ID_AVM
comma
id|PCI_DEVICE_ID_AVM_C4
comma
id|dev
)paren
)paren
)paren
(brace
r_struct
id|capicardparams
id|param
suffix:semicolon
id|param.port
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|param.irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|param.membase
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
id|pci_enable_device
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to enable AVM-C4 at i/o %#x, irq %d, mem %#x err=%d&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|param.port
comma
id|param.irq
comma
id|param.membase
comma
id|retval
)paren
suffix:semicolon
id|detach_capi_driver
c_func
(paren
id|driver
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: PCI BIOS reports AVM-C4 at i/o %#x, irq %d, mem %#x&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|param.port
comma
id|param.irq
comma
id|param.membase
)paren
suffix:semicolon
id|retval
op_assign
id|c4_add_card
c_func
(paren
id|driver
comma
op_amp
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: no AVM-C4 at i/o %#x, irq %d detected, mem %#x&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|param.port
comma
id|param.irq
comma
id|param.membase
)paren
suffix:semicolon
id|detach_capi_driver
c_func
(paren
id|driver
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|ncards
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ncards
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %d C4 card(s) detected&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|ncards
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: NO C4 card detected&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|detach_capi_driver
c_func
(paren
id|driver
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: kernel not compiled with PCI.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
macro_line|#endif
)brace
DECL|function|c4_exit
r_static
r_void
id|__exit
id|c4_exit
c_func
(paren
r_void
)paren
(brace
id|detach_capi_driver
c_func
(paren
op_amp
id|c4_driver
)paren
suffix:semicolon
)brace
DECL|variable|c4_init
id|module_init
c_func
(paren
id|c4_init
)paren
suffix:semicolon
DECL|variable|c4_exit
id|module_exit
c_func
(paren
id|c4_exit
)paren
suffix:semicolon
eof
