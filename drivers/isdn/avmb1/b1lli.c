multiline_comment|/*&n; * $Id: b1lli.c,v 1.10 1999/04/15 19:49:31 calle Exp $&n; * &n; * ISDN lowlevel-module for AVM B1-card.&n; * &n; * (c) Copyright 1997 by Carsten Paeth (calle@calle.in-berlin.de)&n; * &n; * $Log: b1lli.c,v $&n; * Revision 1.10  1999/04/15 19:49:31  calle&n; * fix fuer die B1-PCI. Jetzt geht z.B. auch IRQ 17 ...&n; *&n; * Revision 1.9  1999/01/05 18:33:23  he&n; * merged remaining 2.2pre{1,2} changes (jiffies and Config)&n; *&n; * Revision 1.8  1998/10/25 14:39:00  fritz&n; * Backported from MIPS (Cobalt).&n; *&n; * Revision 1.7  1998/03/29 16:06:00  calle&n; * changes from 2.0 tree merged.&n; *&n; * Revision 1.1.2.10  1998/03/20 20:34:41  calle&n; * port valid check now only for T1, because of the PCI and PCMCIA cards.&n; *&n; * Revision 1.1.2.9  1998/03/20 14:38:20  calle&n; * capidrv: prepared state machines for suspend/resume/hold&n; * capidrv: fix bug in state machine if B1/T1 is out of nccis&n; * b1capi: changed some errno returns.&n; * b1capi: detect if you try to add same T1 to different io address.&n; * b1capi: change number of nccis depending on number of channels.&n; * b1lli: cosmetics&n; *&n; * Revision 1.1.2.8  1998/03/18 17:43:29  calle&n; * T1 with fastlink, bugfix for multicontroller support in capidrv.c&n; *&n; * Revision 1.1.2.7  1998/03/04 17:33:50  calle&n; * Changes for T1.&n; *&n; * Revision 1.1.2.6  1998/02/27 15:40:44  calle&n; * T1 running with slow link. bugfix in capi_release.&n; *&n; * Revision 1.1.2.5  1998/02/13 16:28:28  calle&n; * first step for T1&n; *&n; * Revision 1.6  1998/02/13 07:09:11  calle&n; * change for 2.1.86 (removing FREE_READ/FREE_WRITE from [dev]_kfree_skb()&n; *&n; * Revision 1.5  1998/01/31 11:14:41  calle&n; * merged changes to 2.0 tree, prepare 2.1.82 to work.&n; *&n; * Revision 1.4  1997/12/10 20:00:48  calle&n; * get changes from 2.0 version&n; *&n; * Revision 1.1.2.2  1997/11/26 10:46:55  calle&n; * prepared for M1 (Mobile) and T1 (PMX) cards.&n; * prepared to set configuration after load to support other D-channel&n; * protocols, point-to-point and leased lines.&n; *&n; * Revision 1.3  1997/10/01 09:21:13  fritz&n; * Removed old compatibility stuff for 2.0.X kernels.&n; * From now on, this code is for 2.1.X ONLY!&n; * Old stuff is still in the separate branch.&n; *&n; * Revision 1.2  1997/07/13 12:22:42  calle&n; * bug fix for more than one controller in connect_req.&n; * debugoutput now with contrnr.&n; *&n; *&n; * Revision 1.1  1997/03/04 21:50:28  calle&n; * Frirst version in isdn4linux&n; *&n; * Revision 2.2  1997/02/12 09:31:39  calle&n; * new version&n; *&n; * Revision 1.1  1997/01/31 10:32:20  calle&n; * Initial revision&n; *&n; * &n; */
multiline_comment|/* #define FASTLINK_DEBUG */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/capi.h&gt;
macro_line|#include &lt;linux/b1lli.h&gt;
macro_line|#include &quot;compat.h&quot;
macro_line|#include &quot;capicmd.h&quot;
macro_line|#include &quot;capiutil.h&quot;
r_extern
r_int
id|showcapimsgs
suffix:semicolon
multiline_comment|/*&n; * LLI Messages to the ISDN-ControllerISDN Controller &n; */
DECL|macro|SEND_POLL
mdefine_line|#define&t;SEND_POLL&t;&t;0x72&t;/*&n;&t;&t;&t;&t;&t;   * after load &lt;- RECEIVE_POLL &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_INIT
mdefine_line|#define SEND_INIT&t;&t;0x11&t;/*&n;&t;&t;&t;&t;&t;   * first message &lt;- RECEIVE_INIT&n;&t;&t;&t;&t;&t;   * int32 NumApplications  int32&n;&t;&t;&t;&t;&t;   * NumNCCIs int32 BoardNumber &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_REGISTER
mdefine_line|#define SEND_REGISTER&t;&t;0x12&t;/*&n;&t;&t;&t;&t;&t;   * register an application int32&n;&t;&t;&t;&t;&t;   * ApplIDId int32 NumMessages&n;&t;&t;&t;&t;&t;   * int32 NumB3Connections int32&n;&t;&t;&t;&t;&t;   * NumB3Blocks int32 B3Size&n;&t;&t;&t;&t;&t;   * &n;&t;&t;&t;&t;&t;   * AnzB3Connection != 0 &amp;&amp;&n;&t;&t;&t;&t;&t;   * AnzB3Blocks &gt;= 1 &amp;&amp; B3Size &gt;= 1 &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_RELEASE
mdefine_line|#define SEND_RELEASE&t;&t;0x14&t;/*&n;&t;&t;&t;&t;&t;   * deregister an application int32 &n;&t;&t;&t;&t;&t;   * ApplID &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_MESSAGE
mdefine_line|#define SEND_MESSAGE&t;&t;0x15&t;/*&n;&t;&t;&t;&t;&t;   * send capi-message int32 length&n;&t;&t;&t;&t;&t;   * capi-data ... &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_DATA_B3_REQ
mdefine_line|#define SEND_DATA_B3_REQ&t;0x13&t;/*&n;&t;&t;&t;&t;&t;   * send capi-data-message int32&n;&t;&t;&t;&t;&t;   * MsgLength capi-data ... int32&n;&t;&t;&t;&t;&t;   * B3Length data .... &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_CONFIG
mdefine_line|#define SEND_CONFIG&t;&t;0x21    /*&n;                                         */
DECL|macro|SEND_POLLACK
mdefine_line|#define SEND_POLLACK&t;&t;0x73    /* T1 Watchdog */
multiline_comment|/*&n; * LLI Messages from the ISDN-ControllerISDN Controller &n; */
DECL|macro|RECEIVE_POLL
mdefine_line|#define RECEIVE_POLL&t;&t;0x32&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_POLL &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_INIT
mdefine_line|#define RECEIVE_INIT&t;&t;0x27&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_INIT int32 length&n;&t;&t;&t;&t;&t;   * byte total length b1struct board &n;&t;&t;&t;&t;&t;   * driver revision b1struct card&n;&t;&t;&t;&t;&t;   * type b1struct reserved b1struct&n;&t;&t;&t;&t;&t;   * serial number b1struct driver&n;&t;&t;&t;&t;&t;   * capability b1struct d-channel&n;&t;&t;&t;&t;&t;   * protocol b1struct CAPI-2.0&n;&t;&t;&t;&t;&t;   * profile b1struct capi version &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_MESSAGE
mdefine_line|#define RECEIVE_MESSAGE&t;&t;0x21&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_MESSAGE int32&n;&t;&t;&t;&t;&t;   * AppllID int32 Length capi-data&n;&t;&t;&t;&t;&t;   * .... &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_DATA_B3_IND
mdefine_line|#define RECEIVE_DATA_B3_IND&t;0x22&t;/*&n;&t;&t;&t;&t;&t;   * received data int32 AppllID&n;&t;&t;&t;&t;&t;   * int32 Length capi-data ...&n;&t;&t;&t;&t;&t;   * int32 B3Length data ... &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_START
mdefine_line|#define RECEIVE_START&t;&t;0x23&t;/*&n;&t;&t;&t;&t;&t;   * Handshake &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_STOP
mdefine_line|#define RECEIVE_STOP&t;&t;0x24&t;/*&n;&t;&t;&t;&t;&t;   * Handshake &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_NEW_NCCI
mdefine_line|#define RECEIVE_NEW_NCCI&t;0x25&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 NCCI int32&n;&t;&t;&t;&t;&t;   * WindowSize &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_FREE_NCCI
mdefine_line|#define RECEIVE_FREE_NCCI&t;0x26&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 NCCI &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_RELEASE
mdefine_line|#define RECEIVE_RELEASE&t;&t;0x26&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 0xffffffff &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_TASK_READY
mdefine_line|#define RECEIVE_TASK_READY&t;0x31&t;/*&n;&t;&t;&t;&t;&t;   * int32 tasknr&n;&t;&t;&t;&t;&t;   * int32 Length Taskname ...&n;&t;&t;&t;&t;&t; */
DECL|macro|WRITE_REGISTER
mdefine_line|#define WRITE_REGISTER&t;&t;0x00
DECL|macro|READ_REGISTER
mdefine_line|#define READ_REGISTER&t;&t;0x01
multiline_comment|/*&n; * port offsets&n; */
DECL|macro|B1_READ
mdefine_line|#define B1_READ&t;&t;&t;0x00
DECL|macro|B1_WRITE
mdefine_line|#define B1_WRITE&t;&t;0x01
DECL|macro|B1_INSTAT
mdefine_line|#define B1_INSTAT&t;&t;0x02
DECL|macro|B1_OUTSTAT
mdefine_line|#define B1_OUTSTAT&t;&t;0x03
DECL|macro|B1_RESET
mdefine_line|#define B1_RESET&t;&t;0x10
DECL|macro|B1_ANALYSE
mdefine_line|#define B1_ANALYSE&t;&t;0x04
multiline_comment|/* Hema card T1 */
DECL|macro|T1_FASTLINK
mdefine_line|#define T1_FASTLINK&t;&t;0x00
DECL|macro|T1_SLOWLINK
mdefine_line|#define T1_SLOWLINK&t;&t;0x08
DECL|macro|T1_READ
mdefine_line|#define T1_READ&t;&t;&t;B1_READ
DECL|macro|T1_WRITE
mdefine_line|#define T1_WRITE&t;&t;B1_WRITE
DECL|macro|T1_INSTAT
mdefine_line|#define T1_INSTAT&t;&t;B1_INSTAT
DECL|macro|T1_OUTSTAT
mdefine_line|#define T1_OUTSTAT&t;&t;B1_OUTSTAT
DECL|macro|T1_IRQENABLE
mdefine_line|#define T1_IRQENABLE&t;&t;0x05
DECL|macro|T1_FIFOSTAT
mdefine_line|#define T1_FIFOSTAT&t;&t;0x06
DECL|macro|T1_RESETLINK
mdefine_line|#define T1_RESETLINK&t;&t;0x10
DECL|macro|T1_ANALYSE
mdefine_line|#define T1_ANALYSE&t;&t;0x11
DECL|macro|T1_IRQMASTER
mdefine_line|#define T1_IRQMASTER&t;&t;0x12
DECL|macro|T1_IDENT
mdefine_line|#define T1_IDENT&t;&t;0x17
DECL|macro|T1_RESETBOARD
mdefine_line|#define T1_RESETBOARD&t;&t;0x1f
DECL|macro|T1F_IREADY
mdefine_line|#define&t;T1F_IREADY&t;&t;0x01
DECL|macro|T1F_IHALF
mdefine_line|#define&t;T1F_IHALF&t;&t;0x02
DECL|macro|T1F_IFULL
mdefine_line|#define&t;T1F_IFULL&t;&t;0x04
DECL|macro|T1F_IEMPTY
mdefine_line|#define&t;T1F_IEMPTY&t;&t;0x08
DECL|macro|T1F_IFLAGS
mdefine_line|#define&t;T1F_IFLAGS&t;&t;0xF0
DECL|macro|T1F_OREADY
mdefine_line|#define&t;T1F_OREADY&t;&t;0x10
DECL|macro|T1F_OHALF
mdefine_line|#define&t;T1F_OHALF&t;&t;0x20
DECL|macro|T1F_OEMPTY
mdefine_line|#define&t;T1F_OEMPTY&t;&t;0x40
DECL|macro|T1F_OFULL
mdefine_line|#define&t;T1F_OFULL&t;&t;0x80
DECL|macro|T1F_OFLAGS
mdefine_line|#define&t;T1F_OFLAGS&t;&t;0xF0
multiline_comment|/* there are HEMA cards with 1k and 4k FIFO out */
DECL|macro|FIFO_OUTBSIZE
mdefine_line|#define FIFO_OUTBSIZE&t;&t;256
DECL|macro|FIFO_INPBSIZE
mdefine_line|#define FIFO_INPBSIZE&t;&t;512
DECL|macro|HEMA_VERSION_ID
mdefine_line|#define HEMA_VERSION_ID&t;&t;0
DECL|macro|HEMA_PAL_ID
mdefine_line|#define HEMA_PAL_ID&t;&t;0
DECL|macro|B1_STAT0
mdefine_line|#define B1_STAT0(cardtype)  ((cardtype) == AVM_CARDTYPE_M1 ? 0x81200000l : 0x80A00000l)
DECL|macro|B1_STAT1
mdefine_line|#define B1_STAT1(cardtype)  (0x80E00000l)
DECL|function|b1outp
r_static
r_inline
r_int
r_char
id|b1outp
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|offset
comma
r_int
r_char
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|base
op_plus
id|offset
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_ANALYSE
)paren
suffix:semicolon
)brace
DECL|function|t1outp
r_static
r_inline
r_void
id|t1outp
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|offset
comma
r_int
r_char
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|base
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|t1inp
r_static
r_inline
r_int
r_char
id|t1inp
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|offset
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|B1_isfastlink
r_static
r_inline
r_int
id|B1_isfastlink
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
(paren
id|inb
c_func
(paren
id|base
op_plus
id|T1_IDENT
)paren
op_amp
op_complement
l_int|0x82
)paren
op_eq
l_int|1
suffix:semicolon
)brace
DECL|function|B1_fifostatus
r_static
r_inline
r_int
r_char
id|B1_fifostatus
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|T1_FIFOSTAT
)paren
suffix:semicolon
)brace
DECL|function|B1_rx_full
r_static
r_inline
r_int
id|B1_rx_full
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|B1_get_byte
r_static
r_inline
r_int
r_char
id|B1_get_byte
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|i
op_assign
id|jiffies
op_plus
l_int|1
op_star
id|HZ
suffix:semicolon
multiline_comment|/* maximum wait time 1 sec */
r_while
c_loop
(paren
op_logical_neg
id|B1_rx_full
c_func
(paren
id|base
)paren
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|B1_rx_full
c_func
(paren
id|base
)paren
)paren
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_READ
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;b1lli(0x%x): rx not full after 1 second&bslash;n&quot;
comma
id|base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_get_word
r_static
r_inline
r_int
r_int
id|B1_get_word
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|val
op_or_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|B1_tx_empty
r_static
r_inline
r_int
id|B1_tx_empty
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|B1_put_byte
r_static
r_inline
r_void
id|B1_put_byte
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
id|val
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_WRITE
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|B1_put_word
r_static
r_inline
r_void
id|B1_put_word
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|val
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|B1_get_slice
r_static
r_inline
r_int
r_int
id|B1_get_slice
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
op_star
id|dp
)paren
(brace
r_int
r_int
id|len
comma
id|i
suffix:semicolon
macro_line|#ifdef FASTLINK_DEBUG
r_int
id|wcnt
op_assign
l_int|0
comma
id|bcnt
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|len
op_assign
id|i
op_assign
id|B1_get_word
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|B1_isfastlink
c_func
(paren
id|base
)paren
)paren
(brace
r_int
id|status
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|status
op_assign
id|B1_fifostatus
c_func
(paren
id|base
)paren
op_amp
(paren
id|T1F_IREADY
op_or
id|T1F_IHALF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|FIFO_INPBSIZE
)paren
id|status
op_or_assign
id|T1F_IFULL
suffix:semicolon
r_switch
c_cond
(paren
id|status
)paren
(brace
r_case
id|T1F_IREADY
op_or
id|T1F_IHALF
op_or
id|T1F_IFULL
suffix:colon
id|insb
c_func
(paren
id|base
op_plus
id|B1_READ
comma
id|dp
comma
id|FIFO_INPBSIZE
)paren
suffix:semicolon
id|dp
op_add_assign
id|FIFO_INPBSIZE
suffix:semicolon
id|i
op_sub_assign
id|FIFO_INPBSIZE
suffix:semicolon
macro_line|#ifdef FASTLINK_DEBUG
id|wcnt
op_add_assign
id|FIFO_INPBSIZE
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|T1F_IREADY
op_or
id|T1F_IHALF
suffix:colon
id|insb
c_func
(paren
id|base
op_plus
id|B1_READ
comma
id|dp
comma
id|i
)paren
suffix:semicolon
macro_line|#ifdef FASTLINK_DEBUG
id|wcnt
op_add_assign
id|i
suffix:semicolon
macro_line|#endif
id|dp
op_add_assign
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* fall through */
r_default
suffix:colon
op_star
id|dp
op_increment
op_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
suffix:semicolon
id|i
op_decrement
suffix:semicolon
macro_line|#ifdef FASTLINK_DEBUG
id|bcnt
op_increment
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
)brace
macro_line|#ifdef FASTLINK_DEBUG
r_if
c_cond
(paren
id|wcnt
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli(0x%x): get_slice l=%d w=%d b=%d&bslash;n&quot;
comma
id|base
comma
id|len
comma
id|wcnt
comma
id|bcnt
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
op_star
id|dp
op_increment
op_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|B1_put_slice
r_static
r_inline
r_void
id|B1_put_slice
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
op_star
id|dp
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
id|len
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|B1_isfastlink
c_func
(paren
id|base
)paren
)paren
(brace
r_int
id|status
suffix:semicolon
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
(brace
id|status
op_assign
id|B1_fifostatus
c_func
(paren
id|base
)paren
op_amp
(paren
id|T1F_OREADY
op_or
id|T1F_OHALF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|FIFO_OUTBSIZE
)paren
id|status
op_or_assign
id|T1F_OEMPTY
suffix:semicolon
r_switch
c_cond
(paren
id|status
)paren
(brace
r_case
id|T1F_OREADY
op_or
id|T1F_OHALF
op_or
id|T1F_OEMPTY
suffix:colon
id|outsb
c_func
(paren
id|base
op_plus
id|B1_WRITE
comma
id|dp
comma
id|FIFO_OUTBSIZE
)paren
suffix:semicolon
id|dp
op_add_assign
id|FIFO_OUTBSIZE
suffix:semicolon
id|i
op_sub_assign
id|FIFO_OUTBSIZE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|T1F_OREADY
op_or
id|T1F_OHALF
suffix:colon
id|outsb
c_func
(paren
id|base
op_plus
id|B1_WRITE
comma
id|dp
comma
id|i
)paren
suffix:semicolon
id|dp
op_add_assign
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|B1_put_byte
c_func
(paren
id|base
comma
op_star
id|dp
op_increment
)paren
suffix:semicolon
id|i
op_decrement
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
op_star
id|dp
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|b1_wr_reg
r_static
r_void
id|b1_wr_reg
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|value
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|WRITE_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|reg
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|b1_rd_reg
r_static
r_inline
r_int
r_int
id|b1_rd_reg
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|reg
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|READ_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|reg
)paren
suffix:semicolon
r_return
id|B1_get_word
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|b1_set_test_bit
r_static
r_inline
r_void
id|b1_set_test_bit
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
comma
r_int
id|onoff
)paren
(brace
id|b1_wr_reg
c_func
(paren
id|base
comma
id|B1_STAT0
c_func
(paren
id|cardtype
)paren
comma
id|onoff
ques
c_cond
l_int|0x21
suffix:colon
l_int|0x20
)paren
suffix:semicolon
)brace
DECL|function|b1_get_test_bit
r_static
r_inline
r_int
id|b1_get_test_bit
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
)paren
(brace
r_return
(paren
id|b1_rd_reg
c_func
(paren
id|base
comma
id|B1_STAT0
c_func
(paren
id|cardtype
)paren
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0
suffix:semicolon
)brace
DECL|variable|irq_table
r_static
r_int
id|irq_table
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|192
comma
multiline_comment|/* irq 3 */
l_int|32
comma
multiline_comment|/* irq 4 */
l_int|160
comma
multiline_comment|/* irq 5 */
l_int|96
comma
multiline_comment|/* irq 6 */
l_int|224
comma
multiline_comment|/* irq 7 */
l_int|0
comma
l_int|64
comma
multiline_comment|/* irq 9 */
l_int|80
comma
multiline_comment|/* irq 10 */
l_int|208
comma
multiline_comment|/* irq 11 */
l_int|48
comma
multiline_comment|/* irq 12 */
l_int|0
comma
l_int|0
comma
l_int|112
comma
multiline_comment|/* irq 15 */
)brace
suffix:semicolon
DECL|variable|hema_irq_table
r_static
r_int
id|hema_irq_table
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x80
comma
multiline_comment|/* irq 3 */
l_int|0
comma
l_int|0x90
comma
multiline_comment|/* irq 5 */
l_int|0
comma
l_int|0xA0
comma
multiline_comment|/* irq 7 */
l_int|0
comma
l_int|0xB0
comma
multiline_comment|/* irq 9 */
l_int|0xC0
comma
multiline_comment|/* irq 10 */
l_int|0xD0
comma
multiline_comment|/* irq 11 */
l_int|0xE0
comma
multiline_comment|/* irq 12 */
l_int|0
comma
l_int|0
comma
l_int|0xF0
comma
multiline_comment|/* irq 15 */
)brace
suffix:semicolon
DECL|function|B1_valid_irq
r_int
id|B1_valid_irq
c_func
(paren
r_int
id|irq
comma
r_int
id|cardtype
)paren
(brace
r_switch
c_cond
(paren
id|cardtype
)paren
(brace
r_default
suffix:colon
r_case
id|AVM_CARDTYPE_M1
suffix:colon
r_case
id|AVM_CARDTYPE_M2
suffix:colon
r_case
id|AVM_CARDTYPE_B1
suffix:colon
r_return
id|irq_table
(braket
id|irq
op_amp
l_int|0xf
)braket
op_ne
l_int|0
suffix:semicolon
r_case
id|AVM_CARDTYPE_T1
suffix:colon
r_return
id|hema_irq_table
(braket
id|irq
op_amp
l_int|0xf
)braket
op_ne
l_int|0
suffix:semicolon
r_case
id|AVM_CARDTYPE_B1PCI
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|B1_valid_port
r_int
id|B1_valid_port
c_func
(paren
r_int
id|port
comma
r_int
id|cardtype
)paren
(brace
r_switch
c_cond
(paren
id|cardtype
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_case
id|AVM_CARDTYPE_M1
suffix:colon
r_case
id|AVM_CARDTYPE_M2
suffix:colon
r_case
id|AVM_CARDTYPE_B1
suffix:colon
macro_line|#if 0&t;/* problem with PCMCIA and PCI cards */
r_switch
c_cond
(paren
id|port
)paren
(brace
r_case
l_int|0x150
suffix:colon
r_case
l_int|0x250
suffix:colon
r_case
l_int|0x300
suffix:colon
r_case
l_int|0x340
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
l_int|1
suffix:semicolon
macro_line|#endif
r_case
id|AVM_CARDTYPE_B1PCI
suffix:colon
r_return
l_int|1
suffix:semicolon
r_case
id|AVM_CARDTYPE_T1
suffix:colon
r_return
(paren
(paren
id|port
op_amp
l_int|0x7
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|port
op_amp
l_int|0x30
)paren
op_ne
l_int|0x30
)paren
suffix:semicolon
)brace
)brace
DECL|function|B1_setinterrupt
r_void
id|B1_setinterrupt
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|irq
comma
r_int
id|cardtype
)paren
(brace
r_switch
c_cond
(paren
id|cardtype
)paren
(brace
r_case
id|AVM_CARDTYPE_T1
suffix:colon
id|t1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x02
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_IRQMASTER
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|AVM_CARDTYPE_M1
suffix:colon
r_case
id|AVM_CARDTYPE_M2
suffix:colon
r_case
id|AVM_CARDTYPE_B1
suffix:colon
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
id|irq_table
(braket
id|irq
)braket
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x02
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AVM_CARDTYPE_B1PCI
suffix:colon
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|0xf0
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x02
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|B1_disable_irq
r_int
r_char
id|B1_disable_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
)brace
DECL|function|T1_disable_irq
r_void
id|T1_disable_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|t1outp
c_func
(paren
id|base
comma
id|T1_IRQMASTER
comma
l_int|0x00
)paren
suffix:semicolon
)brace
DECL|function|B1_reset
r_void
id|B1_reset
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
)brace
DECL|function|T1_reset
r_void
id|T1_reset
c_func
(paren
r_int
r_int
id|base
)paren
(brace
multiline_comment|/* reset T1 Controller */
id|B1_reset
c_func
(paren
id|base
)paren
suffix:semicolon
multiline_comment|/* disable irq on HEMA */
id|t1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|B1_OUTSTAT
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_IRQMASTER
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* reset HEMA board configuration */
id|t1outp
c_func
(paren
id|base
comma
id|T1_RESETBOARD
comma
l_int|0xf
)paren
suffix:semicolon
)brace
DECL|function|B1_detect
r_int
id|B1_detect
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
)paren
(brace
r_int
id|onoff
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cardtype
op_eq
id|AVM_CARDTYPE_T1
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 00xx &n;&t; */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfc
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfc
)paren
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 001x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x2
)paren
suffix:semicolon
multiline_comment|/* enable irq */
multiline_comment|/* b1outp(base, B1_OUTSTAT, 0x2); */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_ne
l_int|0x2
multiline_comment|/* || (inb(base + B1_OUTSTAT) &amp; 0xfe) != 0x2 */
)paren
r_return
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 000x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* disable irq */
id|b1outp
c_func
(paren
id|base
comma
id|B1_OUTSTAT
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfe
)paren
)paren
r_return
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|onoff
op_assign
op_logical_neg
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b1_set_test_bit
c_func
(paren
id|base
comma
id|cardtype
comma
id|onoff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1_get_test_bit
c_func
(paren
id|base
comma
id|cardtype
)paren
op_ne
id|onoff
)paren
r_return
l_int|4
suffix:semicolon
id|onoff
op_assign
op_logical_neg
id|onoff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cardtype
op_eq
id|AVM_CARDTYPE_M1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b1_rd_reg
c_func
(paren
id|base
comma
id|B1_STAT1
c_func
(paren
id|cardtype
)paren
)paren
op_amp
l_int|0x0f
)paren
op_ne
l_int|0x01
)paren
r_return
l_int|5
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|T1_detectandinit
r_int
id|T1_detectandinit
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|irq
comma
r_int
id|cardnr
)paren
(brace
r_int
r_char
id|cregs
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_char
id|reverse_cardnr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|dummy
suffix:semicolon
r_int
id|i
suffix:semicolon
id|reverse_cardnr
op_assign
(paren
(paren
id|cardnr
op_amp
l_int|0x01
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|cardnr
op_amp
l_int|0x02
)paren
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|cardnr
op_amp
l_int|0x04
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|cardnr
op_amp
l_int|0x08
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|cregs
(braket
l_int|0
)braket
op_assign
(paren
id|HEMA_VERSION_ID
op_lshift
l_int|4
)paren
op_or
(paren
id|reverse_cardnr
op_amp
l_int|0xf
)paren
suffix:semicolon
id|cregs
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* fast &amp; slow link connected to CON1 */
id|cregs
(braket
l_int|2
)braket
op_assign
l_int|0x05
suffix:semicolon
multiline_comment|/* fast link 20MBit, slow link 20 MBit */
id|cregs
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|cregs
(braket
l_int|4
)braket
op_assign
l_int|0x11
suffix:semicolon
multiline_comment|/* zero wait state */
id|cregs
(braket
l_int|5
)braket
op_assign
id|hema_irq_table
(braket
id|irq
op_amp
l_int|0xf
)braket
suffix:semicolon
id|cregs
(braket
l_int|6
)braket
op_assign
l_int|0
suffix:semicolon
id|cregs
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* board reset */
id|t1outp
c_func
(paren
id|base
comma
id|T1_RESETBOARD
comma
l_int|0xf
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
op_star
l_int|1000
)paren
suffix:semicolon
id|dummy
op_assign
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_OUTSTAT
)paren
suffix:semicolon
multiline_comment|/* first read */
multiline_comment|/* write config */
id|dummy
op_assign
(paren
id|base
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|0xf
suffix:semicolon
id|i
op_increment
)paren
id|t1outp
c_func
(paren
id|base
comma
id|i
comma
id|dummy
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|HEMA_PAL_ID
op_amp
l_int|0xf
comma
id|dummy
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|HEMA_PAL_ID
op_rshift
l_int|4
comma
id|cregs
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|t1outp
c_func
(paren
id|base
comma
l_int|0
comma
id|cregs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|t1outp
c_func
(paren
id|base
comma
(paren
(paren
id|base
op_rshift
l_int|4
)paren
)paren
op_amp
l_int|0x3
comma
id|cregs
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
op_star
l_int|1000
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_RESETLINK
comma
l_int|0
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_RESETLINK
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
op_star
l_int|1000
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_RESETLINK
comma
l_int|1
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_RESETLINK
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
op_star
l_int|1000
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_RESETLINK
comma
l_int|0
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_RESETLINK
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
op_star
l_int|1000
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_ANALYSE
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
op_star
l_int|1000
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_ANALYSE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_OUTSTAT
)paren
op_ne
l_int|0x1
)paren
multiline_comment|/* tx empty */
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_INSTAT
)paren
op_ne
l_int|0x0
)paren
multiline_comment|/* rx empty */
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_IRQENABLE
)paren
op_ne
l_int|0x0
)paren
r_return
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_FIFOSTAT
)paren
op_amp
l_int|0xf0
)paren
op_ne
l_int|0x70
)paren
r_return
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_IRQMASTER
)paren
op_amp
l_int|0x0e
)paren
op_ne
l_int|0
)paren
r_return
l_int|5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_FASTLINK
op_plus
id|T1_IDENT
)paren
op_amp
l_int|0x7d
)paren
op_ne
l_int|1
)paren
r_return
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_OUTSTAT
)paren
op_ne
l_int|0x1
)paren
multiline_comment|/* tx empty */
r_return
l_int|7
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_IRQMASTER
)paren
op_amp
l_int|0x0e
)paren
op_ne
l_int|0
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|base
comma
id|T1_SLOWLINK
op_plus
id|T1_IDENT
)paren
op_amp
l_int|0x7d
)paren
op_ne
l_int|0
)paren
r_return
l_int|9
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_extern
r_int
id|loaddebug
suffix:semicolon
DECL|function|B1_load_t4file
r_int
id|B1_load_t4file
c_func
(paren
r_int
r_int
id|base
comma
id|avmb1_t4file
op_star
id|t4file
)paren
(brace
multiline_comment|/*&n;&t; * Data is in user space !!!&n;&t; */
r_int
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|i
comma
id|left
comma
id|retval
suffix:semicolon
id|dp
op_assign
id|t4file-&gt;data
suffix:semicolon
id|left
op_assign
id|t4file-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|left
OG
r_sizeof
(paren
id|buf
)paren
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loading: %d bytes ..&quot;
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|i
op_increment
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
id|left
op_sub_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loading: %d bytes ..&quot;
comma
id|left
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
id|i
op_increment
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_load_config
r_int
id|B1_load_config
c_func
(paren
r_int
r_int
id|base
comma
id|avmb1_t4file
op_star
id|config
)paren
(brace
multiline_comment|/*&n;&t; * Data is in user space !!!&n;&t; */
r_int
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|left
comma
id|retval
suffix:semicolon
id|dp
op_assign
id|config-&gt;data
suffix:semicolon
id|left
op_assign
id|config-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|left
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
l_int|1
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|left
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|left
OG
r_sizeof
(paren
id|buf
)paren
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: conf load: %d bytes ..&quot;
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
id|left
op_sub_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: conf load: %d bytes ..&quot;
comma
id|left
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|left
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
r_else
id|B1_put_byte
c_func
(paren
id|base
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_loaded
r_int
id|B1_loaded
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|ans
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: wait 1 ..&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|i
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli(0x%x): B1_loaded: timeout tx&bslash;n&quot;
comma
id|base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_POLL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: wait 2 ..&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|i
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|B1_rx_full
c_func
(paren
id|base
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ans
op_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
)paren
op_eq
id|RECEIVE_POLL
)paren
(brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: ok&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli(0x%x): B1_loaded: got 0x%x ???&bslash;n&quot;
comma
id|base
comma
id|ans
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli(0x%x): B1_loaded: timeout rx&bslash;n&quot;
comma
id|base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|parse_version
r_static
r_inline
r_void
id|parse_version
c_func
(paren
id|avmb1_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
suffix:semicolon
id|j
op_increment
)paren
id|card-&gt;version
(braket
id|j
)braket
op_assign
l_string|&quot;&bslash;0&bslash;0&quot;
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
op_logical_and
id|i
OL
id|card-&gt;versionlen
suffix:semicolon
id|j
op_increment
comma
id|i
op_add_assign
id|card-&gt;versionbuf
(braket
id|i
)braket
op_plus
l_int|1
)paren
id|card-&gt;version
(braket
id|j
)braket
op_assign
op_amp
id|card-&gt;versionbuf
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|B1_send_init
r_void
id|B1_send_init
c_func
(paren
r_int
r_int
id|port
comma
r_int
r_int
id|napps
comma
r_int
r_int
id|nncci
comma
r_int
r_int
id|cardnr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_INIT
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|napps
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nncci
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|cardnr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|B1_send_register
r_void
id|B1_send_register
c_func
(paren
r_int
r_int
id|port
comma
id|__u16
id|appid
comma
id|__u32
id|nmsg
comma
id|__u32
id|nb3conn
comma
id|__u32
id|nb3blocks
comma
id|__u32
id|b3bsize
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|appid
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nmsg
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nb3conn
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nb3blocks
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|b3bsize
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|B1_send_release
r_void
id|B1_send_release
c_func
(paren
r_int
r_int
id|port
comma
id|__u16
id|appid
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_RELEASE
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|appid
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|B1_send_message
r_void
id|B1_send_message
c_func
(paren
r_int
r_int
id|port
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|__u16
id|len
op_assign
id|CAPIMSG_LEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CAPICMD
c_func
(paren
id|cmd
comma
id|subcmd
)paren
op_eq
id|CAPI_DATA_B3_REQ
)paren
(brace
id|__u16
id|dlen
op_assign
id|CAPIMSG_DATALEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
OG
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|skb-&gt;data
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_DATA_B3_REQ
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
op_plus
id|len
comma
id|dlen
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|showcapimsgs
)paren
(brace
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|skb-&gt;data
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_MESSAGE
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|B1_handle_interrupt
r_void
id|B1_handle_interrupt
c_func
(paren
id|avmb1_card
op_star
id|card
)paren
(brace
r_int
r_char
id|b1cmd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ApplId
suffix:semicolon
r_int
id|MsgLen
suffix:semicolon
r_int
id|DataB3Len
suffix:semicolon
r_int
id|NCCI
suffix:semicolon
r_int
id|WindowSize
suffix:semicolon
id|t1retry
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|B1_rx_full
c_func
(paren
id|card-&gt;port
)paren
)paren
r_return
suffix:semicolon
id|b1cmd
op_assign
id|B1_get_byte
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|b1cmd
)paren
(brace
r_case
id|RECEIVE_DATA_B3_IND
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|DataB3Len
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;databuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
OG
l_int|2
)paren
(brace
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|CAPIMSG_SETDATA
c_func
(paren
id|card-&gt;msgbuf
comma
id|card-&gt;databuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] id#%d %s len=%u/%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|card-&gt;msgbuf
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|MsgLen
comma
id|DataB3Len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|card-&gt;msgbuf
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|DataB3Len
op_plus
id|MsgLen
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: incoming packet dropped&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|DataB3Len
)paren
comma
id|card-&gt;databuf
comma
id|DataB3Len
)paren
suffix:semicolon
id|CAPIMSG_SETDATA
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;data
op_plus
id|MsgLen
)paren
suffix:semicolon
id|avmb1_handle_capimsg
c_func
(paren
id|card
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_MESSAGE
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
(brace
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|card-&gt;msgbuf
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|MsgLen
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|card-&gt;msgbuf
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|MsgLen
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: incoming packet dropped&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|avmb1_handle_capimsg
c_func
(paren
id|card
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_NEW_NCCI
suffix:colon
id|ApplId
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|WindowSize
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli(0x%x): NEW_NCCI app %u ncci 0x%x&bslash;n&quot;
comma
id|card-&gt;port
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
id|avmb1_handle_new_ncci
c_func
(paren
id|card
comma
id|ApplId
comma
id|NCCI
comma
id|WindowSize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_FREE_NCCI
suffix:colon
id|ApplId
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli(0x%x): FREE_NCCI app %u ncci 0x%x&bslash;n&quot;
comma
id|card-&gt;port
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
id|avmb1_handle_free_ncci
c_func
(paren
id|card
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_START
suffix:colon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_eq
id|AVM_CARDTYPE_T1
)paren
(brace
id|B1_put_byte
c_func
(paren
id|card-&gt;port
comma
id|SEND_POLLACK
)paren
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;b1lli: T1 watchdog&bslash;n&quot;); */
)brace
r_if
c_cond
(paren
id|card-&gt;blocked
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli(0x%x): RESTART&bslash;n&quot;
comma
id|card-&gt;port
)paren
suffix:semicolon
id|card-&gt;blocked
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_STOP
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli(0x%x): STOP&bslash;n&quot;
comma
id|card-&gt;port
)paren
suffix:semicolon
id|card-&gt;blocked
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_INIT
suffix:colon
id|card-&gt;versionlen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;versionbuf
)paren
suffix:semicolon
id|card-&gt;cardstate
op_assign
id|CARD_ACTIVE
suffix:semicolon
id|parse_version
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;b1lli(0x%x): %s-card (%s) now active&bslash;n&quot;
comma
id|card-&gt;port
comma
id|card-&gt;version
(braket
id|VER_CARDTYPE
)braket
comma
id|card-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
suffix:semicolon
id|avmb1_card_ready
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_TASK_READY
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;b1lli(0x%x): Task %d &bslash;&quot;%s&bslash;&quot; ready.&bslash;n&quot;
comma
id|card-&gt;port
comma
id|ApplId
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli(0x%x): B1_handle_interrupt: 0x%x ???&bslash;n&quot;
comma
id|card-&gt;port
comma
id|b1cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;cardtype
op_eq
id|AVM_CARDTYPE_T1
)paren
r_goto
id|t1retry
suffix:semicolon
)brace
eof
