multiline_comment|/*&n; * $Id: b1lli.c,v 1.6 1998/02/13 07:09:11 calle Exp $&n; * &n; * ISDN lowlevel-module for AVM B1-card.&n; * &n; * (c) Copyright 1997 by Carsten Paeth (calle@calle.in-berlin.de)&n; * &n; * $Log: b1lli.c,v $&n; * Revision 1.6  1998/02/13 07:09:11  calle&n; * change for 2.1.86 (removing FREE_READ/FREE_WRITE from [dev]_kfree_skb()&n; *&n; * Revision 1.5  1998/01/31 11:14:41  calle&n; * merged changes to 2.0 tree, prepare 2.1.82 to work.&n; *&n; * Revision 1.4  1997/12/10 20:00:48  calle&n; * get changes from 2.0 version&n; *&n; * Revision 1.1.2.2  1997/11/26 10:46:55  calle&n; * prepared for M1 (Mobile) and T1 (PMX) cards.&n; * prepared to set configuration after load to support other D-channel&n; * protocols, point-to-point and leased lines.&n; *&n; * Revision 1.3  1997/10/01 09:21:13  fritz&n; * Removed old compatibility stuff for 2.0.X kernels.&n; * From now on, this code is for 2.1.X ONLY!&n; * Old stuff is still in the separate branch.&n; *&n; * Revision 1.2  1997/07/13 12:22:42  calle&n; * bug fix for more than one controller in connect_req.&n; * debugoutput now with contrnr.&n; *&n; *&n; * Revision 1.1  1997/03/04 21:50:28  calle&n; * Frirst version in isdn4linux&n; *&n; * Revision 2.2  1997/02/12 09:31:39  calle&n; * new version&n; *&n; * Revision 1.1  1997/01/31 10:32:20  calle&n; * Initial revision&n; *&n; * &n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/capi.h&gt;
macro_line|#include &lt;linux/b1lli.h&gt;
macro_line|#include &quot;compat.h&quot;
macro_line|#include &quot;capicmd.h&quot;
macro_line|#include &quot;capiutil.h&quot;
multiline_comment|/*&n; * LLI Messages to the ISDN-ControllerISDN Controller &n; */
DECL|macro|SEND_POLL
mdefine_line|#define&t;SEND_POLL&t;&t;0x72&t;/*&n;&t;&t;&t;&t;&t;   * after load &lt;- RECEIVE_POLL &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_INIT
mdefine_line|#define SEND_INIT&t;&t;0x11&t;/*&n;&t;&t;&t;&t;&t;   * first message &lt;- RECEIVE_INIT&n;&t;&t;&t;&t;&t;   * int32 NumApplications  int32&n;&t;&t;&t;&t;&t;   * NumNCCIs int32 BoardNumber &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_REGISTER
mdefine_line|#define SEND_REGISTER&t;&t;0x12&t;/*&n;&t;&t;&t;&t;&t;   * register an application int32&n;&t;&t;&t;&t;&t;   * ApplIDId int32 NumMessages&n;&t;&t;&t;&t;&t;   * int32 NumB3Connections int32&n;&t;&t;&t;&t;&t;   * NumB3Blocks int32 B3Size&n;&t;&t;&t;&t;&t;   * &n;&t;&t;&t;&t;&t;   * AnzB3Connection != 0 &amp;&amp;&n;&t;&t;&t;&t;&t;   * AnzB3Blocks &gt;= 1 &amp;&amp; B3Size &gt;= 1 &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_RELEASE
mdefine_line|#define SEND_RELEASE&t;&t;0x14&t;/*&n;&t;&t;&t;&t;&t;   * deregister an application int32 &n;&t;&t;&t;&t;&t;   * ApplID &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_MESSAGE
mdefine_line|#define SEND_MESSAGE&t;&t;0x15&t;/*&n;&t;&t;&t;&t;&t;   * send capi-message int32 length&n;&t;&t;&t;&t;&t;   * capi-data ... &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_DATA_B3_REQ
mdefine_line|#define SEND_DATA_B3_REQ&t;0x13&t;/*&n;&t;&t;&t;&t;&t;   * send capi-data-message int32&n;&t;&t;&t;&t;&t;   * MsgLength capi-data ... int32&n;&t;&t;&t;&t;&t;   * B3Length data .... &n;&t;&t;&t;&t;&t; */
DECL|macro|SEND_CONFIG
mdefine_line|#define SEND_CONFIG&t;&t;0x21    /*&n;                                         */
multiline_comment|/*&n; * LLI Messages from the ISDN-ControllerISDN Controller &n; */
DECL|macro|RECEIVE_POLL
mdefine_line|#define RECEIVE_POLL&t;&t;0x32&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_POLL &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_INIT
mdefine_line|#define RECEIVE_INIT&t;&t;0x27&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_INIT int32 length&n;&t;&t;&t;&t;&t;   * byte total length b1struct board &n;&t;&t;&t;&t;&t;   * driver revision b1struct card&n;&t;&t;&t;&t;&t;   * type b1struct reserved b1struct&n;&t;&t;&t;&t;&t;   * serial number b1struct driver&n;&t;&t;&t;&t;&t;   * capability b1struct d-channel&n;&t;&t;&t;&t;&t;   * protocol b1struct CAPI-2.0&n;&t;&t;&t;&t;&t;   * profile b1struct capi version &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_MESSAGE
mdefine_line|#define RECEIVE_MESSAGE&t;&t;0x21&t;/*&n;&t;&t;&t;&t;&t;   * &lt;- after SEND_MESSAGE int32&n;&t;&t;&t;&t;&t;   * AppllID int32 Length capi-data&n;&t;&t;&t;&t;&t;   * .... &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_DATA_B3_IND
mdefine_line|#define RECEIVE_DATA_B3_IND&t;0x22&t;/*&n;&t;&t;&t;&t;&t;   * received data int32 AppllID&n;&t;&t;&t;&t;&t;   * int32 Length capi-data ...&n;&t;&t;&t;&t;&t;   * int32 B3Length data ... &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_START
mdefine_line|#define RECEIVE_START&t;&t;0x23&t;/*&n;&t;&t;&t;&t;&t;   * Handshake &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_STOP
mdefine_line|#define RECEIVE_STOP&t;&t;0x24&t;/*&n;&t;&t;&t;&t;&t;   * Handshake &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_NEW_NCCI
mdefine_line|#define RECEIVE_NEW_NCCI&t;0x25&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 NCCI int32&n;&t;&t;&t;&t;&t;   * WindowSize &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_FREE_NCCI
mdefine_line|#define RECEIVE_FREE_NCCI&t;0x26&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 NCCI &n;&t;&t;&t;&t;&t; */
DECL|macro|RECEIVE_RELEASE
mdefine_line|#define RECEIVE_RELEASE&t;&t;0x26&t;/*&n;&t;&t;&t;&t;&t;   * int32 AppllID int32 0xffffffff &n;&t;&t;&t;&t;&t; */
DECL|macro|WRITE_REGISTER
mdefine_line|#define WRITE_REGISTER&t;&t;0x00
DECL|macro|READ_REGISTER
mdefine_line|#define READ_REGISTER&t;&t;0x01
multiline_comment|/*&n; * port offsets&n; */
DECL|macro|B1_READ
mdefine_line|#define B1_READ&t;&t;&t;0x00
DECL|macro|B1_WRITE
mdefine_line|#define B1_WRITE&t;&t;0x01
DECL|macro|B1_INSTAT
mdefine_line|#define B1_INSTAT&t;&t;0x02
DECL|macro|B1_OUTSTAT
mdefine_line|#define B1_OUTSTAT&t;&t;0x03
DECL|macro|B1_RESET
mdefine_line|#define B1_RESET&t;&t;0x10
DECL|macro|B1_ANALYSE
mdefine_line|#define B1_ANALYSE&t;&t;0x04
DECL|macro|B1_IDENT
mdefine_line|#define B1_IDENT&t;&t;0x17  /* Hema card T1 */
DECL|macro|B1_IRQ_MASTER
mdefine_line|#define B1_IRQ_MASTER&t;&t;0x12  /* Hema card T1 */
DECL|macro|B1_STAT0
mdefine_line|#define B1_STAT0(cardtype)  ((cardtype) == AVM_CARDTYPE_M1 ? 0x81200000l : 0x80A00000l)
DECL|macro|B1_STAT1
mdefine_line|#define B1_STAT1(cardtype)  (0x80E00000l)
DECL|function|b1outp
r_static
r_inline
r_int
r_char
id|b1outp
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|offset
comma
r_int
r_char
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|base
op_plus
id|offset
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_ANALYSE
)paren
suffix:semicolon
)brace
DECL|function|B1_rx_full
r_static
r_inline
r_int
id|B1_rx_full
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|B1_get_byte
r_static
r_inline
r_int
r_char
id|B1_get_byte
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|i
op_assign
id|jiffies
op_plus
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* maximum wait time 5 sec */
r_while
c_loop
(paren
op_logical_neg
id|B1_rx_full
c_func
(paren
id|base
)paren
op_logical_and
id|i
OG
id|jiffies
)paren
suffix:semicolon
r_if
c_cond
(paren
id|B1_rx_full
c_func
(paren
id|base
)paren
)paren
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_READ
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;b1lli: rx not full after 5 second&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_get_word
r_static
r_inline
r_int
r_int
id|B1_get_word
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|val
op_or_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|B1_get_byte
c_func
(paren
id|base
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|B1_tx_empty
r_static
r_inline
r_int
id|B1_tx_empty
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|B1_put_byte
r_static
r_inline
r_void
id|B1_put_byte
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
id|val
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
suffix:semicolon
id|b1outp
c_func
(paren
id|base
comma
id|B1_WRITE
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|B1_put_word
r_static
r_inline
r_void
id|B1_put_word
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|val
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|B1_get_slice
r_static
r_inline
r_int
r_int
id|B1_get_slice
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
op_star
id|dp
)paren
(brace
r_int
r_int
id|len
comma
id|i
suffix:semicolon
id|len
op_assign
id|i
op_assign
id|B1_get_word
c_func
(paren
id|base
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
op_star
id|dp
op_increment
op_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|B1_put_slice
r_static
r_inline
r_void
id|B1_put_slice
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_char
op_star
id|dp
comma
r_int
r_int
id|len
)paren
(brace
id|B1_put_word
c_func
(paren
id|base
comma
id|len
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
op_star
id|dp
op_increment
)paren
suffix:semicolon
)brace
DECL|function|b1_wr_reg
r_static
r_void
id|b1_wr_reg
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|value
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|WRITE_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|reg
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|b1_rd_reg
r_static
r_inline
r_int
r_int
id|b1_rd_reg
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|reg
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|READ_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|reg
)paren
suffix:semicolon
r_return
id|B1_get_word
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|b1_set_test_bit
r_static
r_inline
r_void
id|b1_set_test_bit
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
comma
r_int
id|onoff
)paren
(brace
id|b1_wr_reg
c_func
(paren
id|base
comma
id|B1_STAT0
c_func
(paren
id|cardtype
)paren
comma
id|onoff
ques
c_cond
l_int|0x21
suffix:colon
l_int|0x20
)paren
suffix:semicolon
)brace
DECL|function|b1_get_test_bit
r_static
r_inline
r_int
id|b1_get_test_bit
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
)paren
(brace
r_return
(paren
id|b1_rd_reg
c_func
(paren
id|base
comma
id|B1_STAT0
c_func
(paren
id|cardtype
)paren
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0
suffix:semicolon
)brace
DECL|variable|irq_table
r_static
r_int
id|irq_table
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|192
comma
multiline_comment|/* irq 3 */
l_int|32
comma
multiline_comment|/* irq 4 */
l_int|160
comma
multiline_comment|/* irq 5 */
l_int|96
comma
multiline_comment|/* irq 6 */
l_int|224
comma
multiline_comment|/* irq 7 */
l_int|0
comma
l_int|64
comma
multiline_comment|/* irq 9 */
l_int|80
comma
multiline_comment|/* irq 10 */
l_int|208
comma
multiline_comment|/* irq 11 */
l_int|48
comma
multiline_comment|/* irq 12 */
l_int|0
comma
l_int|0
comma
l_int|112
comma
multiline_comment|/* irq 15 */
)brace
suffix:semicolon
DECL|function|B1_valid_irq
r_int
id|B1_valid_irq
c_func
(paren
r_int
id|irq
comma
r_int
id|cardtype
)paren
(brace
r_switch
c_cond
(paren
id|cardtype
)paren
(brace
r_default
suffix:colon
r_case
id|AVM_CARDTYPE_M1
suffix:colon
r_case
id|AVM_CARDTYPE_M2
suffix:colon
r_case
id|AVM_CARDTYPE_B1
suffix:colon
r_return
id|irq_table
(braket
id|irq
)braket
op_ne
l_int|0
suffix:semicolon
r_case
id|AVM_CARDTYPE_T1
suffix:colon
r_return
id|irq
op_eq
l_int|5
suffix:semicolon
)brace
)brace
DECL|function|B1_assign_irq
r_int
r_char
id|B1_assign_irq
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|irq
comma
r_int
id|cardtype
)paren
(brace
r_switch
c_cond
(paren
id|cardtype
)paren
(brace
r_case
id|AVM_CARDTYPE_T1
suffix:colon
r_return
id|b1outp
c_func
(paren
id|base
comma
id|B1_IRQ_MASTER
comma
l_int|0x08
)paren
suffix:semicolon
r_default
suffix:colon
r_case
id|AVM_CARDTYPE_M1
suffix:colon
r_case
id|AVM_CARDTYPE_M2
suffix:colon
r_case
id|AVM_CARDTYPE_B1
suffix:colon
r_return
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
id|irq_table
(braket
id|irq
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|B1_enable_irq
r_int
r_char
id|B1_enable_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x02
)paren
suffix:semicolon
)brace
DECL|function|B1_disable_irq
r_int
r_char
id|B1_disable_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_return
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x00
)paren
suffix:semicolon
)brace
DECL|function|B1_reset
r_void
id|B1_reset
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
id|b1outp
c_func
(paren
id|base
comma
id|B1_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|55
op_star
l_int|2
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 2 TIC&squot;s */
)brace
DECL|function|B1_detect
r_int
id|B1_detect
c_func
(paren
r_int
r_int
id|base
comma
r_int
id|cardtype
)paren
(brace
r_int
id|onoff
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cardtype
op_eq
id|AVM_CARDTYPE_T1
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 00xx &n;&t; */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfc
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfc
)paren
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 001x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x2
)paren
suffix:semicolon
multiline_comment|/* enable irq */
multiline_comment|/* b1outp(base, B1_OUTSTAT, 0x2); */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_ne
l_int|0x2
multiline_comment|/* || (inb(base + B1_OUTSTAT) &amp; 0xfe) != 0x2 */
)paren
r_return
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 000x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* disable irq */
id|b1outp
c_func
(paren
id|base
comma
id|B1_OUTSTAT
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfe
)paren
)paren
r_return
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|onoff
op_assign
op_logical_neg
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b1_set_test_bit
c_func
(paren
id|base
comma
id|cardtype
comma
id|onoff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1_get_test_bit
c_func
(paren
id|base
comma
id|cardtype
)paren
op_ne
id|onoff
)paren
r_return
l_int|4
suffix:semicolon
id|onoff
op_assign
op_logical_neg
id|onoff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cardtype
op_eq
id|AVM_CARDTYPE_M1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b1_rd_reg
c_func
(paren
id|base
comma
id|B1_STAT1
c_func
(paren
id|cardtype
)paren
)paren
op_amp
l_int|0x0f
)paren
op_ne
l_int|0x01
)paren
r_return
l_int|5
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_extern
r_int
id|loaddebug
suffix:semicolon
DECL|function|B1_load_t4file
r_int
id|B1_load_t4file
c_func
(paren
r_int
r_int
id|base
comma
id|avmb1_t4file
op_star
id|t4file
)paren
(brace
multiline_comment|/*&n;&t; * Data is in user space !!!&n;&t; */
r_int
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|i
comma
id|left
comma
id|retval
suffix:semicolon
id|dp
op_assign
id|t4file-&gt;data
suffix:semicolon
id|left
op_assign
id|t4file-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|left
OG
r_sizeof
(paren
id|buf
)paren
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loading: %d bytes ..&quot;
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|i
op_increment
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
id|left
op_sub_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loading: %d bytes ..&quot;
comma
id|left
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
id|i
op_increment
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_load_config
r_int
id|B1_load_config
c_func
(paren
r_int
r_int
id|base
comma
id|avmb1_t4file
op_star
id|config
)paren
(brace
multiline_comment|/*&n;&t; * Data is in user space !!!&n;&t; */
r_int
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|left
comma
id|retval
suffix:semicolon
id|dp
op_assign
id|config-&gt;data
suffix:semicolon
id|left
op_assign
id|config-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|left
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
l_int|1
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|base
comma
id|left
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|left
OG
r_sizeof
(paren
id|buf
)paren
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: conf load: %d bytes ..&quot;
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
id|left
op_sub_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
id|dp
op_add_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
id|retval
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: conf load: %d bytes ..&quot;
comma
id|left
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
)paren
(brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|left
)paren
id|B1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
r_else
id|B1_put_byte
c_func
(paren
id|base
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
l_string|&quot;ok&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|B1_loaded
r_int
id|B1_loaded
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|ans
suffix:semicolon
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: wait 1 ..&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|i
OG
id|jiffies
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|B1_tx_empty
c_func
(paren
id|base
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: B1_loaded: timeout tx&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|B1_put_byte
c_func
(paren
id|base
comma
id|SEND_POLL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: wait 2 ..&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|i
OG
id|jiffies
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|B1_rx_full
c_func
(paren
id|base
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ans
op_assign
id|B1_get_byte
c_func
(paren
id|base
)paren
)paren
op_eq
id|RECEIVE_POLL
)paren
(brace
r_if
c_cond
(paren
id|loaddebug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1capi: loaded: ok&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: B1_loaded: got 0x%x ???&bslash;n&quot;
comma
id|ans
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: B1_loaded: timeout rx&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|parse_version
r_static
r_inline
r_void
id|parse_version
c_func
(paren
id|avmb1_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
suffix:semicolon
id|j
op_increment
)paren
id|card-&gt;version
(braket
id|j
)braket
op_assign
l_string|&quot;&bslash;0&bslash;0&quot;
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
op_logical_and
id|i
OL
id|card-&gt;versionlen
suffix:semicolon
id|j
op_increment
comma
id|i
op_add_assign
id|card-&gt;versionbuf
(braket
id|i
)braket
op_plus
l_int|1
)paren
id|card-&gt;version
(braket
id|j
)braket
op_assign
op_amp
id|card-&gt;versionbuf
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|B1_send_init
r_void
id|B1_send_init
c_func
(paren
r_int
r_int
id|port
comma
r_int
r_int
id|napps
comma
r_int
r_int
id|nncci
comma
r_int
r_int
id|cardnr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_INIT
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|napps
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nncci
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|cardnr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|B1_send_register
r_void
id|B1_send_register
c_func
(paren
r_int
r_int
id|port
comma
id|__u16
id|appid
comma
id|__u32
id|nmsg
comma
id|__u32
id|nb3conn
comma
id|__u32
id|nb3blocks
comma
id|__u32
id|b3bsize
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_REGISTER
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|appid
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nmsg
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nb3conn
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|nb3blocks
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|b3bsize
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|B1_send_release
r_void
id|B1_send_release
c_func
(paren
r_int
r_int
id|port
comma
id|__u16
id|appid
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_RELEASE
)paren
suffix:semicolon
id|B1_put_word
c_func
(paren
id|port
comma
id|appid
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_extern
r_int
id|showcapimsgs
suffix:semicolon
DECL|function|B1_send_message
r_void
id|B1_send_message
c_func
(paren
r_int
r_int
id|port
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|__u16
id|len
op_assign
id|CAPIMSG_LEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CAPICMD
c_func
(paren
id|cmd
comma
id|subcmd
)paren
op_eq
id|CAPI_DATA_B3_REQ
)paren
(brace
id|__u16
id|dlen
op_assign
id|CAPIMSG_DATALEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
OG
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|skb-&gt;data
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_DATA_B3_REQ
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
op_plus
id|len
comma
id|dlen
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|showcapimsgs
)paren
(brace
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|skb-&gt;data
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Put [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|B1_put_byte
c_func
(paren
id|port
comma
id|SEND_MESSAGE
)paren
suffix:semicolon
id|B1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------- &n; */
DECL|function|B1_handle_interrupt
r_void
id|B1_handle_interrupt
c_func
(paren
id|avmb1_card
op_star
id|card
)paren
(brace
r_int
r_char
id|b1cmd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ApplId
suffix:semicolon
r_int
id|MsgLen
suffix:semicolon
r_int
id|DataB3Len
suffix:semicolon
r_int
id|NCCI
suffix:semicolon
r_int
id|WindowSize
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|B1_rx_full
c_func
(paren
id|card-&gt;port
)paren
)paren
r_return
suffix:semicolon
id|b1cmd
op_assign
id|B1_get_byte
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|b1cmd
)paren
(brace
r_case
id|RECEIVE_DATA_B3_IND
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|DataB3Len
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;databuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
OG
l_int|2
)paren
(brace
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|CAPIMSG_SETDATA
c_func
(paren
id|card-&gt;msgbuf
comma
id|card-&gt;databuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] id#%d %s len=%u/%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|card-&gt;msgbuf
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|MsgLen
comma
id|DataB3Len
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|card-&gt;msgbuf
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|DataB3Len
op_plus
id|MsgLen
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: incoming packet dropped&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|DataB3Len
)paren
comma
id|card-&gt;databuf
comma
id|DataB3Len
)paren
suffix:semicolon
id|CAPIMSG_SETDATA
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;data
op_plus
id|MsgLen
)paren
suffix:semicolon
id|avmb1_handle_capimsg
c_func
(paren
id|card
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_MESSAGE
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
(brace
id|__u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|__u32
id|contr
op_assign
id|CAPIMSG_CONTROL
c_func
(paren
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] id#%d %s len=%u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|CAPIMSG_APPID
c_func
(paren
id|card-&gt;msgbuf
)paren
comma
id|capi_cmd2str
c_func
(paren
id|cmd
comma
id|subcmd
)paren
comma
id|MsgLen
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: Got [0x%lx] %s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|contr
comma
id|capi_message2str
c_func
(paren
id|card-&gt;msgbuf
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|MsgLen
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: incoming packet dropped&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|avmb1_handle_capimsg
c_func
(paren
id|card
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_NEW_NCCI
suffix:colon
id|ApplId
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|WindowSize
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: NEW_NCCI app %u ncci 0x%x&bslash;n&quot;
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
id|avmb1_handle_new_ncci
c_func
(paren
id|card
comma
id|ApplId
comma
id|NCCI
comma
id|WindowSize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_FREE_NCCI
suffix:colon
id|ApplId
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|B1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|showcapimsgs
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: FREE_NCCI app %u ncci 0x%x&bslash;n&quot;
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
id|avmb1_handle_free_ncci
c_func
(paren
id|card
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_START
suffix:colon
r_if
c_cond
(paren
id|card-&gt;blocked
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: RESTART&bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;blocked
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_STOP
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;b1lli: STOP&bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;blocked
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_INIT
suffix:colon
id|card-&gt;versionlen
op_assign
id|B1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;versionbuf
)paren
suffix:semicolon
id|card-&gt;cardstate
op_assign
id|CARD_ACTIVE
suffix:semicolon
id|parse_version
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;b1lli: %s-card (%s) now active&bslash;n&quot;
comma
id|card-&gt;version
(braket
id|VER_CARDTYPE
)braket
comma
id|card-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
suffix:semicolon
id|avmb1_card_ready
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;b1lli: B1_handle_interrupt: 0x%x ???&bslash;n&quot;
comma
id|b1cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
eof
