multiline_comment|/*&n; * $Id: b1dma.c,v 1.11 2000/11/19 17:02:47 kai Exp $&n; * &n; * Common module for AVM B1 cards that support dma with AMCC&n; * &n; * (c) Copyright 2000 by Carsten Paeth (calle@calle.in-berlin.de)&n; * &n; * $Log: b1dma.c,v $&n; * Revision 1.11  2000/11/19 17:02:47  kai&n; * compatibility cleanup - part 3&n; *&n; * Revision 1.10  2000/11/19 17:01:53  kai&n; * compatibility cleanup - part 2&n; *&n; * Revision 1.9  2000/11/01 14:05:02  calle&n; * - use module_init/module_exit from linux/init.h.&n; * - all static struct variables are initialized with &quot;membername:&quot; now.&n; * - avm_cs.c, let it work with newer pcmcia-cs.&n; *&n; * Revision 1.8  2000/10/10 17:44:19  kai&n; * changes from/for 2.2.18&n; *&n; * Revision 1.7  2000/08/04 12:20:08  calle&n; * - Fix unsigned/signed warning in the right way ...&n; *&n; * Revision 1.6  2000/06/29 13:59:06  calle&n; * Bugfix: reinit txdma without interrupt will confuse some AMCC chips.&n; *&n; * Revision 1.5  2000/06/19 16:51:53  keil&n; * don&squot;t free skb in irq context&n; *&n; * Revision 1.4  2000/04/03 16:38:05  calle&n; * made suppress_pollack static.&n; *&n; * Revision 1.3  2000/02/26 01:00:53  keil&n; * changes from 2.3.47&n; *&n; * Revision 1.2  2000/01/25 14:44:47  calle&n; * typo in b1pciv4_detect().&n; *&n; * Revision 1.1  2000/01/25 14:36:43  calle&n; * common function for  T1 PCI and B1 PCI V4.&n; *&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/capi.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &quot;capilli.h&quot;
macro_line|#include &quot;avmcard.h&quot;
macro_line|#include &quot;capicmd.h&quot;
macro_line|#include &quot;capiutil.h&quot;
DECL|variable|revision
r_static
r_char
op_star
id|revision
op_assign
l_string|&quot;$Revision: 1.11 $&quot;
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Carsten Paeth &lt;calle@calle.in-berlin.de&gt;&quot;
)paren
suffix:semicolon
DECL|variable|suppress_pollack
r_static
r_int
id|suppress_pollack
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|suppress_pollack
comma
l_string|&quot;0-1i&quot;
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
r_static
r_void
id|b1dma_dispatch_tx
c_func
(paren
id|avmcard
op_star
id|card
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
multiline_comment|/* S5933 */
DECL|macro|AMCC_RXPTR
mdefine_line|#define&t;AMCC_RXPTR&t;0x24
DECL|macro|AMCC_RXLEN
mdefine_line|#define&t;AMCC_RXLEN&t;0x28
DECL|macro|AMCC_TXPTR
mdefine_line|#define&t;AMCC_TXPTR&t;0x2c
DECL|macro|AMCC_TXLEN
mdefine_line|#define&t;AMCC_TXLEN&t;0x30
DECL|macro|AMCC_INTCSR
mdefine_line|#define&t;AMCC_INTCSR&t;0x38
DECL|macro|EN_READ_TC_INT
macro_line|#&t;define EN_READ_TC_INT&t;&t;0x00008000L
DECL|macro|EN_WRITE_TC_INT
macro_line|#&t;define EN_WRITE_TC_INT&t;&t;0x00004000L
DECL|macro|EN_TX_TC_INT
macro_line|#&t;define EN_TX_TC_INT&t;&t;EN_READ_TC_INT
DECL|macro|EN_RX_TC_INT
macro_line|#&t;define EN_RX_TC_INT&t;&t;EN_WRITE_TC_INT
DECL|macro|AVM_FLAG
macro_line|#&t;define AVM_FLAG&t;&t;&t;0x30000000L
DECL|macro|ANY_S5933_INT
macro_line|#&t;define ANY_S5933_INT&t;&t;0x00800000L
DECL|macro|READ_TC_INT
macro_line|#&t;define&t;READ_TC_INT&t;&t;0x00080000L
DECL|macro|WRITE_TC_INT
macro_line|#&t;define WRITE_TC_INT&t;&t;0x00040000L
DECL|macro|TX_TC_INT
macro_line|#&t;define&t;TX_TC_INT&t;&t;READ_TC_INT
DECL|macro|RX_TC_INT
macro_line|#&t;define&t;RX_TC_INT&t;&t;WRITE_TC_INT
DECL|macro|MASTER_ABORT_INT
macro_line|#&t;define MASTER_ABORT_INT&t;&t;0x00100000L
DECL|macro|TARGET_ABORT_INT
macro_line|#&t;define TARGET_ABORT_INT&t;&t;0x00200000L
DECL|macro|BUS_MASTER_INT
macro_line|#&t;define BUS_MASTER_INT&t;&t;0x00200000L
DECL|macro|ALL_INT
macro_line|#&t;define ALL_INT&t;&t;&t;0x000C0000L
DECL|macro|AMCC_MCSR
mdefine_line|#define&t;AMCC_MCSR&t;0x3c
DECL|macro|A2P_HI_PRIORITY
macro_line|#&t;define A2P_HI_PRIORITY&t;&t;0x00000100L
DECL|macro|EN_A2P_TRANSFERS
macro_line|#&t;define EN_A2P_TRANSFERS&t;&t;0x00000400L
DECL|macro|P2A_HI_PRIORITY
macro_line|#&t;define P2A_HI_PRIORITY&t;&t;0x00001000L
DECL|macro|EN_P2A_TRANSFERS
macro_line|#&t;define EN_P2A_TRANSFERS&t;&t;0x00004000L
DECL|macro|RESET_A2P_FLAGS
macro_line|#&t;define RESET_A2P_FLAGS&t;&t;0x04000000L
DECL|macro|RESET_P2A_FLAGS
macro_line|#&t;define RESET_P2A_FLAGS&t;&t;0x02000000L
multiline_comment|/* ------------------------------------------------------------- */
DECL|macro|b1dmaoutmeml
mdefine_line|#define b1dmaoutmeml(addr, value)&t;writel(value, addr)
DECL|macro|b1dmainmeml
mdefine_line|#define b1dmainmeml(addr)&t;readl(addr)
DECL|macro|b1dmaoutmemw
mdefine_line|#define b1dmaoutmemw(addr, value)&t;writew(value, addr)
DECL|macro|b1dmainmemw
mdefine_line|#define b1dmainmemw(addr)&t;readw(addr)
DECL|macro|b1dmaoutmemb
mdefine_line|#define b1dmaoutmemb(addr, value)&t;writeb(value, addr)
DECL|macro|b1dmainmemb
mdefine_line|#define b1dmainmemb(addr)&t;readb(addr)
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_tx_empty
r_static
r_inline
r_int
id|b1dma_tx_empty
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_return
id|inb
c_func
(paren
id|port
op_plus
l_int|0x03
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|b1dma_rx_full
r_static
r_inline
r_int
id|b1dma_rx_full
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_return
id|inb
c_func
(paren
id|port
op_plus
l_int|0x02
)paren
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|b1dma_tolink
r_static
r_int
id|b1dma_tolink
c_func
(paren
id|avmcard
op_star
id|card
comma
r_void
op_star
id|buf
comma
r_int
r_int
id|len
)paren
(brace
r_int
r_int
id|stop
op_assign
id|jiffies
op_plus
l_int|1
op_star
id|HZ
suffix:semicolon
multiline_comment|/* maximum wait time 1 sec */
r_int
r_char
op_star
id|s
op_assign
(paren
r_int
r_char
op_star
)paren
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|b1dma_tx_empty
c_func
(paren
id|card-&gt;port
)paren
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b1dma_tx_empty
c_func
(paren
id|card-&gt;port
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x01
comma
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1dma_fromlink
r_static
r_int
id|b1dma_fromlink
c_func
(paren
id|avmcard
op_star
id|card
comma
r_void
op_star
id|buf
comma
r_int
r_int
id|len
)paren
(brace
r_int
r_int
id|stop
op_assign
id|jiffies
op_plus
l_int|1
op_star
id|HZ
suffix:semicolon
multiline_comment|/* maximum wait time 1 sec */
r_int
r_char
op_star
id|s
op_assign
(paren
r_int
r_char
op_star
)paren
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|b1dma_rx_full
c_func
(paren
id|card-&gt;port
)paren
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b1dma_rx_full
c_func
(paren
id|card-&gt;port
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
op_star
id|s
op_increment
op_assign
id|t1inp
c_func
(paren
id|card-&gt;port
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|WriteReg
r_static
r_int
id|WriteReg
c_func
(paren
id|avmcard
op_star
id|card
comma
id|__u32
id|reg
comma
id|__u8
id|val
)paren
(brace
id|__u8
id|cmd
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|b1dma_tolink
c_func
(paren
id|card
comma
op_amp
id|cmd
comma
l_int|1
)paren
op_eq
l_int|0
op_logical_and
id|b1dma_tolink
c_func
(paren
id|card
comma
op_amp
id|reg
comma
l_int|4
)paren
op_eq
l_int|0
)paren
(brace
id|__u32
id|tmp
op_assign
id|val
suffix:semicolon
r_return
id|b1dma_tolink
c_func
(paren
id|card
comma
op_amp
id|tmp
comma
l_int|4
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|ReadReg
r_static
id|__u8
id|ReadReg
c_func
(paren
id|avmcard
op_star
id|card
comma
id|__u32
id|reg
)paren
(brace
id|__u8
id|cmd
op_assign
l_int|0x01
suffix:semicolon
r_if
c_cond
(paren
id|b1dma_tolink
c_func
(paren
id|card
comma
op_amp
id|cmd
comma
l_int|1
)paren
op_eq
l_int|0
op_logical_and
id|b1dma_tolink
c_func
(paren
id|card
comma
op_amp
id|reg
comma
l_int|4
)paren
op_eq
l_int|0
)paren
(brace
id|__u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|b1dma_fromlink
c_func
(paren
id|card
comma
op_amp
id|tmp
comma
l_int|4
)paren
op_eq
l_int|0
)paren
r_return
(paren
id|__u8
)paren
id|tmp
suffix:semicolon
)brace
r_return
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|_put_byte
r_static
r_inline
r_void
id|_put_byte
c_func
(paren
r_void
op_star
op_star
id|pp
comma
id|__u8
id|val
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
op_star
id|s
op_increment
op_assign
id|val
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
)brace
DECL|function|_put_word
r_static
r_inline
r_void
id|_put_word
c_func
(paren
r_void
op_star
op_star
id|pp
comma
id|__u32
id|val
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
op_star
id|s
op_increment
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|s
op_increment
op_assign
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
)brace
DECL|function|_put_slice
r_static
r_inline
r_void
id|_put_slice
c_func
(paren
r_void
op_star
op_star
id|pp
comma
r_int
r_char
op_star
id|dp
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
id|len
suffix:semicolon
id|_put_word
c_func
(paren
id|pp
comma
id|i
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
id|_put_byte
c_func
(paren
id|pp
comma
op_star
id|dp
op_increment
)paren
suffix:semicolon
)brace
DECL|function|_get_byte
r_static
r_inline
id|__u8
id|_get_byte
c_func
(paren
r_void
op_star
op_star
id|pp
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
id|__u8
id|val
suffix:semicolon
id|val
op_assign
op_star
id|s
op_increment
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|_get_word
r_static
r_inline
id|__u32
id|_get_word
c_func
(paren
r_void
op_star
op_star
id|pp
)paren
(brace
id|__u8
op_star
id|s
op_assign
op_star
id|pp
suffix:semicolon
id|__u32
id|val
suffix:semicolon
id|val
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|8
)paren
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|16
)paren
suffix:semicolon
id|val
op_or_assign
(paren
op_star
id|s
op_increment
op_lshift
l_int|24
)paren
suffix:semicolon
op_star
id|pp
op_assign
id|s
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|_get_slice
r_static
r_inline
id|__u32
id|_get_slice
c_func
(paren
r_void
op_star
op_star
id|pp
comma
r_int
r_char
op_star
id|dp
)paren
(brace
r_int
r_int
id|len
comma
id|i
suffix:semicolon
id|len
op_assign
id|i
op_assign
id|_get_word
c_func
(paren
id|pp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
op_star
id|dp
op_increment
op_assign
id|_get_byte
c_func
(paren
id|pp
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_reset
r_void
id|b1dma_reset
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;csr
op_assign
l_int|0x0
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXLEN
comma
l_int|0
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXLEN
comma
l_int|0
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x10
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x07
comma
l_int|0x00
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0x0f000000
)paren
suffix:semicolon
multiline_comment|/* reset all */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_eq
id|avm_t1pci
)paren
id|mdelay
c_func
(paren
l_int|42
)paren
suffix:semicolon
r_else
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_detect
r_int
id|b1dma_detect
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0x0f000000
)paren
suffix:semicolon
multiline_comment|/* reset all */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|42
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXLEN
comma
l_int|0
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXLEN
comma
l_int|0
)paren
suffix:semicolon
id|card-&gt;csr
op_assign
l_int|0x0
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
)paren
op_ne
l_int|0x000000E6
)paren
r_return
l_int|1
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXPTR
comma
l_int|0xffffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
)paren
op_ne
l_int|0xfffffffc
op_logical_or
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXPTR
)paren
op_ne
l_int|0xfffffffc
)paren
r_return
l_int|2
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
comma
l_int|0x0
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXPTR
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
)paren
op_ne
l_int|0x0
op_logical_or
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXPTR
)paren
op_ne
l_int|0x0
)paren
r_return
l_int|3
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x10
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x07
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x02
comma
l_int|0x02
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x03
comma
l_int|0x02
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|card-&gt;port
comma
l_int|0x02
)paren
op_amp
l_int|0xFE
)paren
op_ne
l_int|0x02
op_logical_or
id|t1inp
c_func
(paren
id|card-&gt;port
comma
l_int|0x3
)paren
op_ne
l_int|0x03
)paren
r_return
l_int|4
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x03
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t1inp
c_func
(paren
id|card-&gt;port
comma
l_int|0x02
)paren
op_amp
l_int|0xFE
)paren
op_ne
l_int|0x00
op_logical_or
id|t1inp
c_func
(paren
id|card-&gt;port
comma
l_int|0x3
)paren
op_ne
l_int|0x01
)paren
r_return
l_int|5
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|t1pci_detect
r_int
id|t1pci_detect
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|b1dma_detect
c_func
(paren
id|card
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/* Transputer test */
r_if
c_cond
(paren
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80001000
comma
l_int|0x11
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80101000
comma
l_int|0x22
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80201000
comma
l_int|0x33
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80301000
comma
l_int|0x44
)paren
op_ne
l_int|0
)paren
r_return
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80001000
)paren
op_ne
l_int|0x11
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80101000
)paren
op_ne
l_int|0x22
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80201000
)paren
op_ne
l_int|0x33
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80301000
)paren
op_ne
l_int|0x44
)paren
r_return
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80001000
comma
l_int|0x55
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80101000
comma
l_int|0x66
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80201000
comma
l_int|0x77
)paren
op_ne
l_int|0
op_logical_or
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80301000
comma
l_int|0x88
)paren
op_ne
l_int|0
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80001000
)paren
op_ne
l_int|0x55
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80101000
)paren
op_ne
l_int|0x66
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80201000
)paren
op_ne
l_int|0x77
op_logical_or
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80301000
)paren
op_ne
l_int|0x88
)paren
r_return
l_int|9
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1pciv4_detect
r_int
id|b1pciv4_detect
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
id|ret
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|b1dma_detect
c_func
(paren
id|card
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80A00000
comma
l_int|0x21
)paren
op_ne
l_int|0
)paren
r_return
l_int|6
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80A00000
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0x01
)paren
r_return
l_int|7
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|WriteReg
c_func
(paren
id|card
comma
l_int|0x80A00000
comma
l_int|0x20
)paren
op_ne
l_int|0
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ReadReg
c_func
(paren
id|card
comma
l_int|0x80A00000
)paren
op_amp
l_int|0x01
)paren
op_ne
l_int|0x00
)paren
r_return
l_int|9
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_dispatch_tx
r_static
r_void
id|b1dma_dispatch_tx
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|avmcard_dmainfo
op_star
id|dma
op_assign
id|card-&gt;dma
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
id|cmd
comma
id|subcmd
suffix:semicolon
id|__u16
id|len
suffix:semicolon
id|__u32
id|txlen
suffix:semicolon
r_int
id|inint
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|inint
op_assign
id|card-&gt;interrupt
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;csr
op_amp
id|EN_TX_TC_INT
)paren
(brace
multiline_comment|/* tx busy */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|dma-&gt;send_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
macro_line|#ifdef CONFIG_B1DMA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tx(%d): underrun&bslash;n&quot;
comma
id|inint
)paren
suffix:semicolon
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|len
op_assign
id|CAPIMSG_LEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|p
op_assign
id|dma-&gt;sendbuf
suffix:semicolon
r_if
c_cond
(paren
id|CAPICMD
c_func
(paren
id|cmd
comma
id|subcmd
)paren
op_eq
id|CAPI_DATA_B3_REQ
)paren
(brace
id|__u16
id|dlen
op_assign
id|CAPIMSG_DATALEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_DATA_B3_REQ
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
op_plus
id|len
comma
id|dlen
)paren
suffix:semicolon
)brace
r_else
(brace
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_MESSAGE
)paren
suffix:semicolon
id|_put_slice
c_func
(paren
op_amp
id|p
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
)brace
id|txlen
op_assign
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|dma-&gt;sendbuf
suffix:semicolon
macro_line|#ifdef CONFIG_B1DMA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tx(%d): put msg len=%d&bslash;n&quot;
comma
id|inint
comma
id|txlen
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|txlen
op_assign
id|skb-&gt;len
op_minus
l_int|2
suffix:semicolon
macro_line|#ifdef CONFIG_B1DMA_POLLDEBUG
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_eq
id|SEND_POLLACK
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: send ack&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_B1DMA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tx(%d): put 0x%x len=%d&bslash;n&quot;
comma
id|inint
comma
id|skb-&gt;data
(braket
l_int|2
)braket
comma
id|txlen
)paren
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|dma-&gt;sendbuf
comma
id|skb-&gt;data
op_plus
l_int|2
comma
id|skb-&gt;len
op_minus
l_int|2
)paren
suffix:semicolon
)brace
id|txlen
op_assign
(paren
id|txlen
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXPTR
comma
id|virt_to_phys
c_func
(paren
id|dma-&gt;sendbuf
)paren
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_TXLEN
comma
id|txlen
)paren
suffix:semicolon
id|card-&gt;csr
op_or_assign
id|EN_TX_TC_INT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inint
)paren
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|queue_pollack
r_static
r_void
id|queue_pollack
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|3
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost poll ack&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_POLLACK
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_handle_rx
r_static
r_void
id|b1dma_handle_rx
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
l_int|0
)braket
suffix:semicolon
id|avmcard_dmainfo
op_star
id|dma
op_assign
id|card-&gt;dma
suffix:semicolon
r_struct
id|capi_ctr
op_star
id|ctrl
op_assign
id|cinfo-&gt;capi_ctrl
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
op_assign
id|dma-&gt;recvbuf
op_plus
l_int|4
suffix:semicolon
id|__u32
id|ApplId
comma
id|MsgLen
comma
id|DataB3Len
comma
id|NCCI
comma
id|WindowSize
suffix:semicolon
id|__u8
id|b1cmd
op_assign
id|_get_byte
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_B1DMA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rx: 0x%x %lu&bslash;n&quot;
comma
id|b1cmd
comma
(paren
r_int
r_int
)paren
id|dma-&gt;recvlen
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|b1cmd
)paren
(brace
r_case
id|RECEIVE_DATA_B3_IND
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|DataB3Len
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;databuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MsgLen
OL
l_int|30
)paren
(brace
multiline_comment|/* not CAPI 64Bit */
id|memset
c_func
(paren
id|card-&gt;msgbuf
op_plus
id|MsgLen
comma
l_int|0
comma
l_int|30
op_minus
id|MsgLen
)paren
suffix:semicolon
id|MsgLen
op_assign
l_int|30
suffix:semicolon
id|CAPIMSG_SETLEN
c_func
(paren
id|card-&gt;msgbuf
comma
l_int|30
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|DataB3Len
op_plus
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|DataB3Len
)paren
comma
id|card-&gt;databuf
comma
id|DataB3Len
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|handle_capimsg
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_MESSAGE
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|handle_capimsg
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_NEW_NCCI
suffix:colon
id|ApplId
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|NCCI
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|WindowSize
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|new_ncci
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|NCCI
comma
id|WindowSize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_FREE_NCCI
suffix:colon
id|ApplId
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|NCCI
op_assign
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NCCI
op_ne
l_int|0xffffffff
)paren
id|ctrl
op_member_access_from_pointer
id|free_ncci
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
r_else
id|ctrl
op_member_access_from_pointer
id|appl_released
c_func
(paren
id|ctrl
comma
id|ApplId
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_START
suffix:colon
macro_line|#ifdef CONFIG_B1DMA_POLLDEBUG
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: receive poll&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|suppress_pollack
)paren
id|queue_pollack
c_func
(paren
id|card
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|resume_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_STOP
suffix:colon
id|ctrl
op_member_access_from_pointer
id|suspend_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_INIT
suffix:colon
id|cinfo-&gt;versionlen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|cinfo-&gt;versionbuf
)paren
suffix:semicolon
id|b1_parse_version
c_func
(paren
id|cinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s-card (%s) now active&bslash;n&quot;
comma
id|card-&gt;name
comma
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
comma
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|ready
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_TASK_READY
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|_get_word
c_func
(paren
op_amp
id|p
)paren
suffix:semicolon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: task %d &bslash;&quot;%s&bslash;&quot; ready.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ApplId
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_DEBUGMSG
suffix:colon
id|MsgLen
op_assign
id|_get_slice
c_func
(paren
op_amp
id|p
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: DEBUG: %s&bslash;n&quot;
comma
id|card-&gt;name
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1dma_interrupt: 0x%x ???&bslash;n&quot;
comma
id|card-&gt;name
comma
id|b1cmd
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_handle_interrupt
r_static
r_void
id|b1dma_handle_interrupt
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|__u32
id|status
op_assign
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
)paren
suffix:semicolon
id|__u32
id|newcsr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|ANY_S5933_INT
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|newcsr
op_assign
id|card-&gt;csr
op_or
(paren
id|status
op_amp
id|ALL_INT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TX_TC_INT
)paren
id|newcsr
op_and_assign
op_complement
id|EN_TX_TC_INT
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_TC_INT
)paren
id|newcsr
op_and_assign
op_complement
id|EN_RX_TC_INT
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|newcsr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|RX_TC_INT
)paren
op_ne
l_int|0
)paren
(brace
id|__u8
op_star
id|recvbuf
op_assign
id|card-&gt;dma-&gt;recvbuf
suffix:semicolon
id|__u32
id|rxlen
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;dma-&gt;recvlen
op_eq
l_int|0
)paren
(brace
id|card-&gt;dma-&gt;recvlen
op_assign
op_star
(paren
(paren
id|__u32
op_star
)paren
id|recvbuf
)paren
suffix:semicolon
id|rxlen
op_assign
(paren
id|card-&gt;dma-&gt;recvlen
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
comma
id|virt_to_phys
c_func
(paren
id|recvbuf
op_plus
l_int|4
)paren
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXLEN
comma
id|rxlen
)paren
suffix:semicolon
)brace
r_else
(brace
id|b1dma_handle_rx
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;dma-&gt;recvlen
op_assign
l_int|0
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
comma
id|virt_to_phys
c_func
(paren
id|recvbuf
)paren
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXLEN
comma
l_int|4
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|TX_TC_INT
)paren
op_ne
l_int|0
)paren
(brace
id|card-&gt;csr
op_and_assign
op_complement
id|EN_TX_TC_INT
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
)brace
DECL|function|b1dma_interrupt
r_void
id|b1dma_interrupt
c_func
(paren
r_int
id|interrupt
comma
r_void
op_star
id|devptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|avmcard
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
id|avmcard
op_star
)paren
id|devptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;b1dma: interrupt: wrong device&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;interrupt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: reentering interrupt hander&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|card-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
id|b1dma_handle_interrupt
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_loaded
r_static
r_int
id|b1dma_loaded
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
r_int
id|stop
suffix:semicolon
r_int
r_char
id|ans
suffix:semicolon
r_int
r_int
id|tout
op_assign
l_int|2
suffix:semicolon
r_int
r_int
id|base
op_assign
id|card-&gt;port
suffix:semicolon
r_for
c_loop
(paren
id|stop
op_assign
id|jiffies
op_plus
id|tout
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|b1_tx_empty
c_func
(paren
id|base
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|b1_tx_empty
c_func
(paren
id|base
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1dma_loaded: tx err, corrupted t4 file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_POLLACK
)paren
suffix:semicolon
r_for
c_loop
(paren
id|stop
op_assign
id|jiffies
op_plus
id|tout
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|b1_rx_full
c_func
(paren
id|base
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ans
op_assign
id|b1_get_byte
c_func
(paren
id|base
)paren
)paren
op_eq
id|RECEIVE_POLLDWORD
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1dma_loaded: got 0x%x, firmware not running in dword mode&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ans
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1dma_loaded: firmware not running&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_send_init
r_static
r_void
id|b1dma_send_init
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|15
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost register appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_INIT
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|AVM_NAPPS
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|AVM_NCCI_PER_CHANNEL
op_star
l_int|30
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|card-&gt;cardnr
op_minus
l_int|1
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|b1dma_load_firmware
r_int
id|b1dma_load_firmware
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|capiloaddata
op_star
id|data
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|b1dma_reset
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|b1_load_t4file
c_func
(paren
id|card
comma
op_amp
id|data-&gt;firmware
)paren
)paren
)paren
(brace
id|b1dma_reset
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load t4file!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;configuration.len
OG
l_int|0
op_logical_and
id|data-&gt;configuration.data
)paren
(brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|b1_load_config
c_func
(paren
id|card
comma
op_amp
id|data-&gt;configuration
)paren
)paren
)paren
(brace
id|b1dma_reset
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load config!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|b1dma_loaded
c_func
(paren
id|card
)paren
)paren
(brace
id|b1dma_reset
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load t4file.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|card-&gt;csr
op_assign
id|AVM_FLAG
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_MCSR
comma
id|EN_A2P_TRANSFERS
op_or
id|EN_P2A_TRANSFERS
op_or
id|A2P_HI_PRIORITY
op_or
id|P2A_HI_PRIORITY
op_or
id|RESET_A2P_FLAGS
op_or
id|RESET_P2A_FLAGS
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x07
comma
l_int|0x30
)paren
suffix:semicolon
id|t1outp
c_func
(paren
id|card-&gt;port
comma
l_int|0x10
comma
l_int|0xF0
)paren
suffix:semicolon
id|card-&gt;dma-&gt;recvlen
op_assign
l_int|0
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXPTR
comma
id|virt_to_phys
c_func
(paren
id|card-&gt;dma-&gt;recvbuf
)paren
)paren
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_RXLEN
comma
l_int|4
)paren
suffix:semicolon
id|card-&gt;csr
op_or_assign
id|EN_RX_TC_INT
suffix:semicolon
id|b1dmaoutmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
comma
id|card-&gt;csr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|b1dma_send_init
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1dma_reset_ctr
r_void
id|b1dma_reset_ctr
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|b1dma_reset
c_func
(paren
id|card
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cinfo-&gt;version
comma
l_int|0
comma
r_sizeof
(paren
id|cinfo-&gt;version
)paren
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|reseted
c_func
(paren
id|ctrl
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_register_appl
r_void
id|b1dma_register_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
comma
id|capi_register_params
op_star
id|rp
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|want
op_assign
id|rp-&gt;level3cnt
suffix:semicolon
r_int
id|nconn
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|want
OG
l_int|0
)paren
id|nconn
op_assign
id|want
suffix:semicolon
r_else
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
op_star
op_minus
id|want
suffix:semicolon
r_if
c_cond
(paren
id|nconn
op_eq
l_int|0
)paren
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|23
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost register appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_REGISTER
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|appl
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
l_int|1024
op_star
(paren
id|nconn
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|nconn
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|rp-&gt;datablkcnt
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|rp-&gt;datablklen
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
id|ctrl
op_member_access_from_pointer
id|appl_registered
c_func
(paren
id|ctrl
comma
id|appl
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_release_appl
r_void
id|b1dma_release_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|7
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: no memory, lost release appl.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|_put_byte
c_func
(paren
op_amp
id|p
comma
id|SEND_RELEASE
)paren
suffix:semicolon
id|_put_word
c_func
(paren
op_amp
id|p
comma
id|appl
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
(paren
id|__u8
op_star
)paren
id|p
op_minus
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dma_send_message
r_void
id|b1dma_send_message
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;dma-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|b1dma_dispatch_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1dmactl_read_proc
r_int
id|b1dmactl_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|__u8
id|flag
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
id|__u32
id|txaddr
comma
id|txlen
comma
id|rxaddr
comma
id|rxlen
comma
id|csr
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;name&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%x&bslash;n&quot;
comma
l_string|&quot;io&quot;
comma
id|card-&gt;port
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %d&bslash;n&quot;
comma
l_string|&quot;irq&quot;
comma
id|card-&gt;irq
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%lx&bslash;n&quot;
comma
l_string|&quot;membase&quot;
comma
id|card-&gt;membase
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;cardtype
)paren
(brace
r_case
id|avm_b1isa
suffix:colon
id|s
op_assign
l_string|&quot;B1 ISA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pci
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pcmcia
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCMCIA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m1
suffix:colon
id|s
op_assign
l_string|&quot;M1&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m2
suffix:colon
id|s
op_assign
l_string|&quot;M2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1isa
suffix:colon
id|s
op_assign
l_string|&quot;T1 ISA (HEMA)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1pci
suffix:colon
id|s
op_assign
l_string|&quot;T1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_c4
suffix:colon
id|s
op_assign
l_string|&quot;C4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;???&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;type&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_driver&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_cardtype&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_SERIAL
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_serial&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|__u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;protocol&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; DSS1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; CT1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; VN3&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; NI1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; AUSTEL&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; ESS&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; 1TR6&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|__u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|5
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;linetype&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; point to point&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; point to multipoint&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; leased line without D-channel&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; leased line with D-channel&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;cardname&quot;
comma
id|cinfo-&gt;cardname
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|txaddr
op_assign
(paren
id|__u32
)paren
id|phys_to_virt
c_func
(paren
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
l_int|0x2c
)paren
)paren
suffix:semicolon
id|txaddr
op_sub_assign
(paren
id|__u32
)paren
id|card-&gt;dma-&gt;sendbuf
suffix:semicolon
id|txlen
op_assign
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
l_int|0x30
)paren
suffix:semicolon
id|rxaddr
op_assign
(paren
id|__u32
)paren
id|phys_to_virt
c_func
(paren
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
l_int|0x24
)paren
)paren
suffix:semicolon
id|rxaddr
op_sub_assign
(paren
id|__u32
)paren
id|card-&gt;dma-&gt;recvbuf
suffix:semicolon
id|rxlen
op_assign
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
l_int|0x28
)paren
suffix:semicolon
id|csr
op_assign
id|b1dmainmeml
c_func
(paren
id|card-&gt;mbase
op_plus
id|AMCC_INTCSR
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%lx&bslash;n&quot;
comma
l_string|&quot;csr (cached)&quot;
comma
(paren
r_int
r_int
)paren
id|card-&gt;csr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%lx&bslash;n&quot;
comma
l_string|&quot;csr&quot;
comma
(paren
r_int
r_int
)paren
id|csr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %lu&bslash;n&quot;
comma
l_string|&quot;txoff&quot;
comma
(paren
r_int
r_int
)paren
id|txaddr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %lu&bslash;n&quot;
comma
l_string|&quot;txlen&quot;
comma
(paren
r_int
r_int
)paren
id|txlen
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %lu&bslash;n&quot;
comma
l_string|&quot;rxoff&quot;
comma
(paren
r_int
r_int
)paren
id|rxaddr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %lu&bslash;n&quot;
comma
l_string|&quot;rxlen&quot;
comma
(paren
r_int
r_int
)paren
id|rxlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|variable|b1dma_reset
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_reset
)paren
suffix:semicolon
DECL|variable|t1pci_detect
id|EXPORT_SYMBOL
c_func
(paren
id|t1pci_detect
)paren
suffix:semicolon
DECL|variable|b1pciv4_detect
id|EXPORT_SYMBOL
c_func
(paren
id|b1pciv4_detect
)paren
suffix:semicolon
DECL|variable|b1dma_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_interrupt
)paren
suffix:semicolon
DECL|variable|b1dma_load_firmware
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_load_firmware
)paren
suffix:semicolon
DECL|variable|b1dma_reset_ctr
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_reset_ctr
)paren
suffix:semicolon
DECL|variable|b1dma_register_appl
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_register_appl
)paren
suffix:semicolon
DECL|variable|b1dma_release_appl
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_release_appl
)paren
suffix:semicolon
DECL|variable|b1dma_send_message
id|EXPORT_SYMBOL
c_func
(paren
id|b1dma_send_message
)paren
suffix:semicolon
DECL|variable|b1dmactl_read_proc
id|EXPORT_SYMBOL
c_func
(paren
id|b1dmactl_read_proc
)paren
suffix:semicolon
DECL|function|b1dma_init
r_int
id|b1dma_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_char
id|rev
(braket
l_int|10
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|rev
comma
id|p
op_plus
l_int|1
comma
r_sizeof
(paren
id|rev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|strcpy
c_func
(paren
id|rev
comma
l_string|&quot;1.0&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;b1dma: revision %s&bslash;n&quot;
comma
id|rev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1dma_exit
r_void
id|b1dma_exit
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|b1dma_init
id|module_init
c_func
(paren
id|b1dma_init
)paren
suffix:semicolon
DECL|variable|b1dma_exit
id|module_exit
c_func
(paren
id|b1dma_exit
)paren
suffix:semicolon
eof
