multiline_comment|/* $Id: isdn_common.c,v 1.114 2000/11/25 17:00:59 kai Exp $&n;&n; * Linux ISDN subsystem, common used functions (linklevel).&n; *&n; * Copyright 1994-1999  by Fritz Elfert (fritz@isdn4linux.de)&n; * Copyright 1995,96    Thinking Objects Software GmbH Wuerzburg&n; * Copyright 1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_tty.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#ifdef CONFIG_ISDN_AUDIO
macro_line|#include &quot;isdn_audio.h&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DIVERSION_MODULE
DECL|macro|CONFIG_ISDN_DIVERSION
mdefine_line|#define CONFIG_ISDN_DIVERSION
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DIVERSION
macro_line|#include &lt;linux/isdn_divertif.h&gt;
macro_line|#endif CONFIG_ISDN_DIVERSION
macro_line|#include &quot;isdn_v110.h&quot;
macro_line|#include &quot;isdn_cards.h&quot;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
multiline_comment|/* Debugflags */
DECL|macro|ISDN_DEBUG_STATCALLB
macro_line|#undef ISDN_DEBUG_STATCALLB
DECL|variable|dev
id|isdn_dev
op_star
id|dev
suffix:semicolon
DECL|variable|isdn_revision
r_static
r_char
op_star
id|isdn_revision
op_assign
l_string|&quot;$Revision: 1.114 $&quot;
suffix:semicolon
r_extern
r_char
op_star
id|isdn_net_revision
suffix:semicolon
r_extern
r_char
op_star
id|isdn_tty_revision
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_extern
r_char
op_star
id|isdn_ppp_revision
suffix:semicolon
macro_line|#else
DECL|variable|isdn_ppp_revision
r_static
r_char
op_star
id|isdn_ppp_revision
op_assign
l_string|&quot;: none $&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_AUDIO
r_extern
r_char
op_star
id|isdn_audio_revision
suffix:semicolon
macro_line|#else
DECL|variable|isdn_audio_revision
r_static
r_char
op_star
id|isdn_audio_revision
op_assign
l_string|&quot;: none $&quot;
suffix:semicolon
macro_line|#endif
r_extern
r_char
op_star
id|isdn_v110_revision
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DIVERSION
DECL|variable|divert_if
r_static
id|isdn_divert_if
op_star
id|divert_if
suffix:semicolon
multiline_comment|/* = NULL */
macro_line|#endif CONFIG_ISDN_DIVERSION
r_static
r_int
id|isdn_writebuf_stub
c_func
(paren
r_int
comma
r_int
comma
r_const
id|u_char
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|set_global_features
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|isdn_register_devfs
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_void
id|isdn_unregister_devfs
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_int
id|isdn_wildmat
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
suffix:semicolon
r_void
DECL|function|isdn_lock_drivers
id|isdn_lock_drivers
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;drivers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|cmd.driver
op_assign
id|i
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|locks
op_increment
suffix:semicolon
)brace
)brace
r_void
DECL|function|isdn_MOD_INC_USE_COUNT
id|isdn_MOD_INC_USE_COUNT
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|isdn_lock_drivers
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|isdn_unlock_drivers
id|isdn_unlock_drivers
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;drivers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|locks
OG
l_int|0
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|cmd.driver
op_assign
id|i
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|locks
op_decrement
suffix:semicolon
)brace
)brace
r_void
DECL|function|isdn_MOD_DEC_USE_COUNT
id|isdn_MOD_DEC_USE_COUNT
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|isdn_unlock_drivers
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(ISDN_DEBUG_NET_DUMP) || defined(ISDN_DEBUG_MODEM_DUMP)
r_void
DECL|function|isdn_dumppkt
id|isdn_dumppkt
c_func
(paren
r_char
op_star
id|s
comma
id|u_char
op_star
id|p
comma
r_int
id|len
comma
r_int
id|dumplen
)paren
(brace
r_int
id|dumpc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(%d) &quot;
comma
id|s
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dumpc
op_assign
l_int|0
suffix:semicolon
(paren
id|dumpc
OL
id|dumplen
)paren
op_logical_and
(paren
id|len
)paren
suffix:semicolon
id|len
op_decrement
comma
id|dumpc
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p
op_increment
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * I picked the pattern-matching-functions from an old GNU-tar version (1.10)&n; * It was originally written and put to PD by rs@mirror.TMC.COM (Rich Salz)&n; */
r_static
r_int
DECL|function|isdn_star
id|isdn_star
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
(brace
r_while
c_loop
(paren
id|isdn_wildmat
c_func
(paren
id|s
comma
id|p
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
op_increment
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Shell-type Pattern-matching for incoming caller-Ids&n; * This function gets a string in s and checks, if it matches the pattern&n; * given in p.&n; *&n; * Return:&n; *   0 = match.&n; *   1 = no match.&n; *   2 = no match. Would eventually match, if s would be longer.&n; *&n; * Possible Patterns:&n; *&n; * &squot;?&squot;     matches one character&n; * &squot;*&squot;     matches zero or more characters&n; * [xyz]   matches the set of characters in brackets.&n; * [^xyz]  matches any single character not in the set of characters&n; */
r_static
r_int
DECL|function|isdn_wildmat
id|isdn_wildmat
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
(brace
r_register
r_int
id|last
suffix:semicolon
r_register
r_int
id|matched
suffix:semicolon
r_register
r_int
id|reverse
suffix:semicolon
r_register
r_int
id|nostar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|s
)paren
op_logical_and
op_logical_neg
(paren
op_star
id|p
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_star
id|p
suffix:semicolon
id|s
op_increment
comma
id|p
op_increment
)paren
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
l_char|&squot;&bslash;&bslash;&squot;
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Literal match with following character,&n;&t;&t;&t;&t; * fall through.&n;&t;&t;&t;&t; */
id|p
op_increment
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_star
id|s
op_ne
op_star
id|p
)paren
r_return
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;?&squot;
suffix:colon
multiline_comment|/* Match anything. */
r_if
c_cond
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
(paren
l_int|2
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;*&squot;
suffix:colon
id|nostar
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Trailing star matches everything. */
r_return
(paren
op_star
op_increment
id|p
ques
c_cond
id|isdn_star
c_func
(paren
id|s
comma
id|p
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
r_case
l_char|&squot;[&squot;
suffix:colon
multiline_comment|/* [^....] means inverse character class. */
r_if
c_cond
(paren
(paren
id|reverse
op_assign
(paren
id|p
(braket
l_int|1
)braket
op_eq
l_char|&squot;^&squot;
)paren
)paren
)paren
id|p
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|last
op_assign
l_int|0
comma
id|matched
op_assign
l_int|0
suffix:semicolon
op_star
op_increment
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;]&squot;
)paren
suffix:semicolon
id|last
op_assign
op_star
id|p
)paren
multiline_comment|/* This next line requires a good C compiler. */
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;-&squot;
ques
c_cond
op_star
id|s
op_le
op_star
op_increment
id|p
op_logical_and
op_star
id|s
op_ge
id|last
suffix:colon
op_star
id|s
op_eq
op_star
id|p
)paren
id|matched
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|matched
op_eq
id|reverse
)paren
r_return
(paren
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
ques
c_cond
l_int|0
suffix:colon
id|nostar
suffix:semicolon
)brace
DECL|function|isdn_msncmp
r_int
id|isdn_msncmp
c_func
(paren
r_const
r_char
op_star
id|msn1
comma
r_const
r_char
op_star
id|msn2
)paren
(brace
r_char
id|TmpMsn1
(braket
id|ISDN_MSNLEN
)braket
suffix:semicolon
r_char
id|TmpMsn2
(braket
id|ISDN_MSNLEN
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|TmpMsn1
suffix:semicolon
op_star
id|msn1
op_logical_and
op_star
id|msn1
op_ne
l_char|&squot;:&squot;
suffix:semicolon
)paren
singleline_comment|// Strip off a SPID
op_star
id|p
op_increment
op_assign
op_star
id|msn1
op_increment
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|TmpMsn2
suffix:semicolon
op_star
id|msn2
op_logical_and
op_star
id|msn2
op_ne
l_char|&squot;:&squot;
suffix:semicolon
)paren
singleline_comment|// Strip off a SPID
op_star
id|p
op_increment
op_assign
op_star
id|msn2
op_increment
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
id|isdn_wildmat
c_func
(paren
id|TmpMsn1
comma
id|TmpMsn2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_free_queue
id|isdn_free_queue
c_func
(paren
r_struct
id|sk_buff_head
op_star
id|queue
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
id|queue
)paren
)paren
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|queue
)paren
)paren
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_int
DECL|function|isdn_dc2minor
id|isdn_dc2minor
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
op_logical_and
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
r_return
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|isdn_timer_cnt1
r_static
r_int
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
DECL|variable|isdn_timer_cnt2
r_static
r_int
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
DECL|variable|isdn_timer_cnt3
r_static
r_int
id|isdn_timer_cnt3
op_assign
l_int|0
suffix:semicolon
DECL|variable|isdn_timer_cnt4
r_static
r_int
id|isdn_timer_cnt4
op_assign
l_int|0
suffix:semicolon
r_static
r_void
DECL|function|isdn_timer_funct
id|isdn_timer_funct
c_func
(paren
id|ulong
id|dummy
)paren
(brace
r_int
id|tf
op_assign
id|dev-&gt;tflags
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_FAST
)paren
(brace
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMREAD
)paren
id|isdn_tty_readmodem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMPLUS
)paren
id|isdn_tty_modem_escape
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMXMIT
)paren
id|isdn_tty_modem_xmit
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_SLOW
)paren
(brace
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt1
op_ge
id|ISDN_TIMER_02SEC
)paren
(brace
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_NETDIAL
)paren
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt2
op_ge
id|ISDN_TIMER_1SEC
)paren
(brace
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_NETHANGUP
)paren
id|isdn_net_autohup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt3
OG
id|ISDN_TIMER_RINGING
)paren
(brace
id|isdn_timer_cnt3
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMRING
)paren
id|isdn_tty_modem_ring
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt4
OG
id|ISDN_TIMER_KEEPINT
)paren
(brace
id|isdn_timer_cnt4
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_KEEPALIVE
)paren
id|isdn_net_slarp_out
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_CARRIER
)paren
id|isdn_tty_carrier_timeout
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tf
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|dev-&gt;timer
comma
id|jiffies
op_plus
id|ISDN_TIMER_RES
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|isdn_timer_ctrl
id|isdn_timer_ctrl
c_func
(paren
r_int
id|tf
comma
r_int
id|onoff
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tf
op_amp
id|ISDN_TIMER_SLOW
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|dev-&gt;tflags
op_amp
id|ISDN_TIMER_SLOW
)paren
)paren
)paren
(brace
multiline_comment|/* If the slow-timer wasn&squot;t activated until now */
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|onoff
)paren
id|dev-&gt;tflags
op_or_assign
id|tf
suffix:semicolon
r_else
id|dev-&gt;tflags
op_and_assign
op_complement
id|tf
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tflags
)paren
id|mod_timer
c_func
(paren
op_amp
id|dev-&gt;timer
comma
id|jiffies
op_plus
id|ISDN_TIMER_RES
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Receive a packet from B-Channel. (Called from low-level-module)&n; */
r_static
r_void
DECL|function|isdn_receive_skb_callback
id|isdn_receive_skb_callback
c_func
(paren
r_int
id|di
comma
r_int
id|channel
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|channel
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Update statistics */
id|dev-&gt;ibytes
(braket
id|i
)braket
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* First, try to deliver data to network-device */
r_if
c_cond
(paren
id|isdn_net_rcv_skb
c_func
(paren
id|i
comma
id|skb
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* V.110 handling&n;&t; * makes sense for async streams only, so it is&n;&t; * called after possible net-device delivery.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;v110
(braket
id|i
)braket
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|i
)braket
)paren
suffix:semicolon
id|skb
op_assign
id|isdn_v110_decode
c_func
(paren
id|dev-&gt;v110
(braket
id|i
)braket
comma
id|skb
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* No network-device found, deliver to tty or raw-channel */
r_if
c_cond
(paren
id|skb-&gt;len
)paren
(brace
r_if
c_cond
(paren
id|isdn_tty_rcv_skb
c_func
(paren
id|i
comma
id|di
comma
id|channel
comma
id|skb
)paren
)paren
r_return
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcv_waitq
(braket
id|channel
)braket
)paren
suffix:semicolon
)brace
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Intercept command from Linklevel to Lowlevel.&n; * If layer 2 protocol is V.110 and this is not supported by current&n; * lowlevel-driver, use driver&squot;s transparent mode and handle V.110 in&n; * linklevel instead.&n; */
r_int
DECL|function|isdn_command
id|isdn_command
c_func
(paren
id|isdn_ctrl
op_star
id|cmd
)paren
(brace
r_if
c_cond
(paren
id|cmd-&gt;driver
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_command command(%x) driver -1&bslash;n&quot;
comma
id|cmd-&gt;command
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;command
op_eq
id|ISDN_CMD_SETL2
)paren
(brace
r_int
id|idx
op_assign
id|isdn_dc2minor
c_func
(paren
id|cmd-&gt;driver
comma
id|cmd-&gt;arg
op_amp
l_int|255
)paren
suffix:semicolon
r_int
r_int
id|l2prot
op_assign
(paren
id|cmd-&gt;arg
op_rshift
l_int|8
)paren
op_amp
l_int|255
suffix:semicolon
r_int
r_int
id|features
op_assign
(paren
id|dev-&gt;drv
(braket
id|cmd-&gt;driver
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_rshift
id|ISDN_FEATURE_L2_SHIFT
)paren
op_amp
id|ISDN_FEATURE_L2_MASK
suffix:semicolon
r_int
r_int
id|l2_feature
op_assign
(paren
l_int|1
op_lshift
id|l2prot
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
multiline_comment|/* If V.110 requested, but not supported by&n;&t;&t;&t; * HL-driver, set emulator-flag and change&n;&t;&t;&t; * Layer-2 to transparent&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|features
op_amp
id|l2_feature
)paren
)paren
(brace
id|dev-&gt;v110emu
(braket
id|idx
)braket
op_assign
id|l2prot
suffix:semicolon
id|cmd-&gt;arg
op_assign
(paren
id|cmd-&gt;arg
op_amp
l_int|255
)paren
op_or
(paren
id|ISDN_PROTO_L2_TRANS
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|dev-&gt;v110emu
(braket
id|idx
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|dev-&gt;drv
(braket
id|cmd-&gt;driver
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
id|cmd
)paren
suffix:semicolon
)brace
r_void
DECL|function|isdn_all_eaz
id|isdn_all_eaz
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|di
OL
l_int|0
)paren
r_return
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|ch
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_SETEAZ
suffix:semicolon
id|cmd.parm.num
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Begin of a CAPI like LL&lt;-&gt;HL interface, currently used only for &n; * supplementary service (CAPI 2.0 part III)&n; */
macro_line|#include &quot;avmb1/capicmd.h&quot;  /* this should be moved in a common place */
r_int
DECL|function|isdn_capi_rec_hl_msg
id|isdn_capi_rec_hl_msg
c_func
(paren
id|capi_msg
op_star
id|cm
)paren
(brace
r_int
id|di
suffix:semicolon
r_int
id|ch
suffix:semicolon
id|di
op_assign
(paren
id|cm-&gt;adr.Controller
op_amp
l_int|0x7f
)paren
op_minus
l_int|1
suffix:semicolon
id|ch
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
(paren
id|cm-&gt;adr.Controller
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cm-&gt;Command
)paren
(brace
r_case
id|CAPI_FACILITY
suffix:colon
multiline_comment|/* in the moment only handled in tty */
r_return
id|isdn_tty_capi_facility
c_func
(paren
id|cm
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|isdn_status_callback
id|isdn_status_callback
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
r_int
id|di
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|r
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|isdn_net_dev
op_star
id|p
suffix:semicolon
id|di
op_assign
id|c-&gt;driver
suffix:semicolon
id|i
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|c-&gt;arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_STAT_BSENT
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_v110_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|snd_waitq
(braket
id|c-&gt;arg
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_STAVAIL
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|stavail
op_add_assign
id|c-&gt;arg
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|st_waitq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_RUN
suffix:colon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_or_assign
id|DRV_FLAG_RUNNING
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
id|isdn_all_eaz
c_func
(paren
id|di
comma
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
suffix:semicolon
id|set_global_features
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_STOP
suffix:colon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
id|DRV_FLAG_RUNNING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ICALL
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ICALL (net): %d %ld %s&bslash;n&quot;
comma
id|di
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Try to find a network-interface which will accept incoming call */
id|r
op_assign
(paren
(paren
id|c-&gt;command
op_eq
id|ISDN_STAT_ICALLW
)paren
ques
c_cond
l_int|0
suffix:colon
id|isdn_net_find_icall
c_func
(paren
id|di
comma
id|c-&gt;arg
comma
id|i
comma
op_amp
id|c-&gt;parm.setup
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|r
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* No network-device replies.&n;&t;&t;&t;&t;&t; * Try ttyI&squot;s.&n;&t;&t;&t;&t;&t; * These return 0 on no match, 1 on match and&n;&t;&t;&t;&t;&t; * 3 on eventually match, if CID is longer.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|c-&gt;command
op_eq
id|ISDN_STAT_ICALL
)paren
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|isdn_tty_find_icall
c_func
(paren
id|di
comma
id|c-&gt;arg
comma
op_amp
id|c-&gt;parm.setup
)paren
)paren
)paren
r_return
id|retval
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DIVERSION 
r_if
c_cond
(paren
id|divert_if
)paren
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
)paren
)paren
r_return
id|retval
suffix:semicolon
multiline_comment|/* processed */
macro_line|#endif CONFIG_ISDN_DIVERSION                        
r_if
c_cond
(paren
(paren
op_logical_neg
id|retval
)paren
op_logical_and
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_REJBUS
)paren
)paren
(brace
multiline_comment|/* No tty responding */
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|retval
op_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Schedule connection-setup */
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_ACCEPTD
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|dev-&gt;netdev
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
r_if
c_cond
(paren
id|p-&gt;local-&gt;isdn_channel
op_eq
id|cmd.arg
)paren
(brace
id|strcpy
c_func
(paren
id|cmd.parm.setup.eazmsn
comma
id|p-&gt;local-&gt;msn
)paren
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|retval
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* For calling back, first reject incoming call ... */
r_case
l_int|3
suffix:colon
multiline_comment|/* Interface found, but down, reject call actively  */
id|retval
op_assign
l_int|2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Rejecting Call&bslash;n&quot;
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|3
)paren
r_break
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_int|4
suffix:colon
multiline_comment|/* ... then start callback. */
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Number would eventually match, if longer */
id|retval
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ICALL: ret=%d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
macro_line|#endif
r_return
id|retval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CINF
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;CINF: %ld %s&bslash;n&quot;
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|c-&gt;parm.num
comma
l_string|&quot;0&quot;
)paren
)paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CAUSE
suffix:colon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;CAUSE: %ld %s&bslash;n&quot;
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: %s,ch%ld cause: %s&bslash;n&quot;
comma
id|dev-&gt;drvid
(braket
id|di
)braket
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DIVERSION
r_if
c_cond
(paren
id|divert_if
)paren
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
macro_line|#endif CONFIG_ISDN_DIVERSION
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DISPLAY
suffix:colon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DISPLAY: %ld %s&bslash;n&quot;
comma
id|c-&gt;arg
comma
id|c-&gt;parm.display
)paren
suffix:semicolon
macro_line|#endif
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DIVERSION
r_if
c_cond
(paren
id|divert_if
)paren
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
macro_line|#endif CONFIG_ISDN_DIVERSION
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DCONN
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DCONN: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Find any net-device, waiting for D-channel setup */
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
id|isdn_v110_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
multiline_comment|/* Find any ttyI, waiting for D-channel setup */
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_ACCEPTB
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DHUP: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|online
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Signal hangup to network-devices */
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
id|isdn_v110_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_DIVERSION
r_if
c_cond
(paren
id|divert_if
)paren
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
macro_line|#endif CONFIG_ISDN_DIVERSION
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;BCONN: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Signal B-channel-connect to network-devices */
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|online
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
id|isdn_v110_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BHUP
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;BHUP: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|online
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_X25
multiline_comment|/* Signal hangup to network-devices */
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
macro_line|#endif
id|isdn_v110_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_NODCH
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;NODCH: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ADDCH
suffix:colon
r_if
c_cond
(paren
id|isdn_add_channels
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
comma
id|di
comma
id|c-&gt;arg
comma
l_int|1
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DISCH
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
op_logical_and
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|c-&gt;arg
)paren
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;parm.num
(braket
l_int|0
)braket
)paren
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
op_complement
id|ISDN_USAGE_DISABLED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|USG_NONE
c_func
(paren
id|dev-&gt;usage
(braket
id|i
)braket
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_or_assign
id|ISDN_USAGE_DISABLED
suffix:semicolon
)brace
r_else
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_UNLOAD
suffix:colon
r_while
c_loop
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|locks
OG
l_int|0
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|locks
op_decrement
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
(brace
id|dev-&gt;drvmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;chanmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
op_complement
id|ISDN_USAGE_DISABLED
suffix:semicolon
id|isdn_unregister_devfs
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
id|dev-&gt;drivers
op_decrement
suffix:semicolon
id|dev-&gt;channels
op_sub_assign
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|channels
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|channels
suffix:semicolon
id|i
op_increment
)paren
id|isdn_free_queue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcv_waitq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;drvid
(braket
id|di
)braket
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|set_global_features
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_STAT_L1ERR
suffix:colon
r_break
suffix:semicolon
r_case
id|CAPI_PUT_MESSAGE
suffix:colon
r_return
id|isdn_capi_rec_hl_msg
c_func
(paren
op_amp
id|c-&gt;parm.cmsg
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_case
id|ISDN_STAT_FAXIND
suffix:colon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_AUDIO
r_case
id|ISDN_STAT_AUDIO
suffix:colon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_DIVERSION
r_case
id|ISDN_STAT_PROT
suffix:colon
r_case
id|ISDN_STAT_REDIR
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
r_return
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
macro_line|#endif CONFIG_ISDN_DIVERSION
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get integer from char-pointer, set pointer to end of number&n; */
r_int
DECL|function|isdn_getnum
id|isdn_getnum
c_func
(paren
r_char
op_star
op_star
id|p
)paren
(brace
r_int
id|v
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|p
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
id|v
op_assign
(paren
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
id|v
op_star
l_int|10
)paren
)paren
op_plus
(paren
r_int
)paren
(paren
(paren
op_star
id|p
(braket
l_int|0
)braket
op_increment
)paren
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
DECL|macro|DLE
mdefine_line|#define DLE 0x10
multiline_comment|/*&n; * isdn_readbchan() tries to get data from the read-queue.&n; * It MUST be called with interrupts off.&n; *&n; * Be aware that this is not an atomic operation when sleep != 0, even though &n; * interrupts are turned off! Well, like that we are currently only called&n; * on behalf of a read system call on raw device files (which are documented&n; * to be dangerous and for for debugging purpose only). The inode semaphore&n; * takes care that this is not called for the same minor device number while&n; * we are sleeping, but access is not serialized against simultaneous read()&n; * from the corresponding ttyI device. Can other ugly events, like changes&n; * of the mapping (di,ch)&lt;-&gt;minor, happen during the sleep? --he &n; */
r_int
DECL|function|isdn_readbchan
id|isdn_readbchan
c_func
(paren
r_int
id|di
comma
r_int
id|channel
comma
id|u_char
op_star
id|buf
comma
id|u_char
op_star
id|fp
comma
r_int
id|len
comma
id|wait_queue_head_t
op_star
id|sleep
)paren
(brace
r_int
id|left
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|count_pull
suffix:semicolon
r_int
id|count_put
suffix:semicolon
r_int
id|dflag
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u_char
op_star
id|cp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|di
)braket
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
id|sleep
)paren
id|interruptible_sleep_on
c_func
(paren
id|sleep
)paren
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
id|left
op_assign
id|MIN
c_func
(paren
id|len
comma
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
(braket
id|channel
)braket
)paren
suffix:semicolon
id|cp
op_assign
id|buf
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|left
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
)paren
)paren
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
r_if
c_cond
(paren
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
)paren
r_break
suffix:semicolon
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ISDN_AUDIO_SKB_DLECOUNT
c_func
(paren
id|skb
)paren
)paren
op_logical_or
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_amp
(paren
l_int|1
op_lshift
id|channel
)paren
)paren
)paren
(brace
r_char
op_star
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
r_int
r_int
id|DLEmask
op_assign
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
id|dflag
op_assign
l_int|0
suffix:semicolon
id|count_pull
op_assign
id|count_put
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|count_pull
OL
id|skb-&gt;len
)paren
op_logical_and
(paren
id|left
OG
l_int|0
)paren
)paren
(brace
id|left
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_amp
id|DLEmask
)paren
(brace
op_star
id|cp
op_increment
op_assign
id|DLE
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_and_assign
op_complement
id|DLEmask
suffix:semicolon
)brace
r_else
(brace
op_star
id|cp
op_increment
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_eq
id|DLE
)paren
(brace
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_or_assign
id|DLEmask
suffix:semicolon
(paren
id|ISDN_AUDIO_SKB_DLECOUNT
c_func
(paren
id|skb
)paren
)paren
op_decrement
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
id|count_pull
op_increment
suffix:semicolon
)brace
id|count_put
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count_pull
op_ge
id|skb-&gt;len
)paren
id|dflag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
multiline_comment|/* No DLE&squot;s in buff, so simply copy it */
id|dflag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count_pull
op_assign
id|skb-&gt;len
)paren
OG
id|left
)paren
(brace
id|count_pull
op_assign
id|left
suffix:semicolon
id|dflag
op_assign
l_int|0
suffix:semicolon
)brace
id|count_put
op_assign
id|count_pull
suffix:semicolon
id|memcpy
c_func
(paren
id|cp
comma
id|skb-&gt;data
comma
id|count_put
)paren
suffix:semicolon
id|cp
op_add_assign
id|count_put
suffix:semicolon
id|left
op_sub_assign
id|count_put
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
)brace
macro_line|#endif
id|count
op_add_assign
id|count_put
suffix:semicolon
r_if
c_cond
(paren
id|fp
)paren
(brace
id|memset
c_func
(paren
id|fp
comma
l_int|0
comma
id|count_put
)paren
suffix:semicolon
id|fp
op_add_assign
id|count_put
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dflag
)paren
(brace
multiline_comment|/* We got all the data in this buff.&n;&t;&t;&t; * Now we can dequeue it.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|fp
)paren
op_star
(paren
id|fp
op_minus
l_int|1
)paren
op_assign
l_int|0xff
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Not yet emptied this buff, so it&n;&t;&t;&t; * must stay in the queue, for further calls&n;&t;&t;&t; * but we pull off the data we got until now.&n;&t;&t;&t; */
id|skb_pull
c_func
(paren
id|skb
comma
id|count_pull
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
(braket
id|channel
)braket
op_sub_assign
id|count_put
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|__inline
r_int
DECL|function|isdn_minor2drv
id|isdn_minor2drv
c_func
(paren
r_int
id|minor
)paren
(brace
r_return
(paren
id|dev-&gt;drvmap
(braket
id|minor
)braket
)paren
suffix:semicolon
)brace
r_static
id|__inline
r_int
DECL|function|isdn_minor2chan
id|isdn_minor2chan
c_func
(paren
r_int
id|minor
)paren
(brace
r_return
(paren
id|dev-&gt;chanmap
(braket
id|minor
)braket
)paren
suffix:semicolon
)brace
r_static
r_char
op_star
DECL|function|isdn_statstr
id|isdn_statstr
c_func
(paren
r_void
)paren
(brace
r_static
r_char
id|istatbuf
(braket
l_int|2048
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sprintf
c_func
(paren
id|istatbuf
comma
l_string|&quot;idmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
OL
l_int|0
)paren
ques
c_cond
l_string|&quot;-&quot;
suffix:colon
id|dev-&gt;drvid
(braket
id|dev-&gt;drvmap
(braket
id|i
)braket
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nchmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;ndrmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;drvmap
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nusage:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;usage
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nflags:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%ld &quot;
comma
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|online
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;? &quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nphone:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
id|dev-&gt;num
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|istatbuf
suffix:semicolon
)brace
multiline_comment|/* Module interface-code */
r_void
DECL|function|isdn_info_update
id|isdn_info_update
c_func
(paren
r_void
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
op_star
(paren
id|p
op_member_access_from_pointer
r_private
)paren
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
id|p-&gt;next
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_read
id|isdn_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|file-&gt;private_data
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|interruptible_sleep_on
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
id|p
op_assign
id|isdn_statstr
c_func
(paren
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|strlen
c_func
(paren
id|p
)paren
)paren
op_le
id|count
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
op_star
id|off
op_add_assign
id|len
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_read minor %d obsolete!&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|kmalloc
c_func
(paren
id|count
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|len
op_assign
id|isdn_readbchan
c_func
(paren
id|drvidx
comma
id|chidx
comma
id|p
comma
l_int|0
comma
id|count
comma
op_amp
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|rcv_waitq
(braket
id|chidx
)braket
)paren
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
)paren
id|len
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|interruptible_sleep_on
c_func
(paren
op_amp
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|st_waitq
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;readstat
)paren
id|len
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|readstat
c_func
(paren
id|buf
comma
id|MIN
c_func
(paren
id|count
comma
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
comma
l_int|1
comma
id|drvidx
comma
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
)paren
suffix:semicolon
r_else
id|len
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
op_sub_assign
id|len
suffix:semicolon
r_else
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
(brace
id|retval
op_assign
id|isdn_ppp_read
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|buf
comma
id|count
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#endif
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|loff_t
DECL|function|isdn_llseek
id|isdn_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|orig
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_write
id|isdn_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_write minor %d obsolete!&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_while
c_loop
(paren
id|isdn_writebuf_stub
c_func
(paren
id|drvidx
comma
id|chidx
comma
id|buf
comma
id|count
comma
l_int|1
)paren
op_ne
id|count
)paren
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|snd_waitq
(braket
id|chidx
)braket
)paren
suffix:semicolon
id|retval
op_assign
id|count
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * We want to use the isdnctrl device to load the firmware&n;&t;&t; *&n;&t;&t; if (!(dev-&gt;drv[drvidx]-&gt;flags &amp; DRV_FLAG_RUNNING))&n;&t;&t; return -ENODEV;&n;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;writecmd
)paren
id|retval
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writecmd
c_func
(paren
id|buf
comma
id|count
comma
l_int|1
comma
id|drvidx
comma
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
)paren
suffix:semicolon
r_else
id|retval
op_assign
id|count
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
(brace
id|retval
op_assign
id|isdn_ppp_write
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|buf
comma
id|count
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#endif
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|isdn_poll
id|isdn_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|poll_wait
c_func
(paren
id|file
comma
op_amp
(paren
id|dev-&gt;info_waitq
)paren
comma
id|wait
)paren
suffix:semicolon
multiline_comment|/* mask = POLLOUT | POLLWRNORM; */
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
(brace
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_ge
id|ISDN_MINOR_CTRL
op_logical_and
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
multiline_comment|/* driver deregistered while file open */
id|mask
op_assign
id|POLLHUP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|poll_wait
c_func
(paren
id|file
comma
op_amp
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|st_waitq
)paren
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
(brace
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
(brace
id|mask
op_assign
id|isdn_ppp_poll
c_func
(paren
id|file
comma
id|wait
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#endif
id|mask
op_assign
id|POLLERR
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ioctl
id|isdn_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|uint
id|cmd
comma
id|ulong
id|arg
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|isdn_ctrl
id|c
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_union
id|iocpar
(brace
r_char
id|name
(braket
l_int|10
)braket
suffix:semicolon
r_char
id|bname
(braket
l_int|22
)braket
suffix:semicolon
id|isdn_ioctl_struct
id|iocts
suffix:semicolon
id|isdn_net_ioctl_phone
id|phone
suffix:semicolon
id|isdn_net_ioctl_cfg
id|cfg
suffix:semicolon
)brace
id|iocpar
suffix:semicolon
DECL|macro|name
mdefine_line|#define name  iocpar.name
DECL|macro|bname
mdefine_line|#define bname iocpar.bname
DECL|macro|iocts
mdefine_line|#define iocts iocpar.iocts
DECL|macro|phone
mdefine_line|#define phone iocpar.phone
DECL|macro|cfg
mdefine_line|#define cfg   iocpar.cfg
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCGETDVR
suffix:colon
r_return
(paren
id|TTY_DV
op_plus
(paren
id|NET_DV
op_lshift
l_int|8
)paren
op_plus
(paren
id|INF_DV
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_case
id|IIOCGETCPS
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
id|ulong
op_star
id|p
op_assign
(paren
id|ulong
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ulong
)paren
op_star
id|ISDN_MAX_CHANNELS
op_star
l_int|2
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|put_user
c_func
(paren
id|dev-&gt;ibytes
(braket
id|i
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|dev-&gt;obytes
(braket
id|i
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_NETDEVICES
r_case
id|IIOCNETGPN
suffix:colon
multiline_comment|/* Get peer phone number of a connected &n;&t;&t;&t;&t; * isdn network interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_net_getpeer
c_func
(paren
op_amp
id|phone
comma
(paren
id|isdn_net_ioctl_phone
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
multiline_comment|/*&n; * isdn net devices manage lots of configuration variables as linked lists.&n; * Those lists must only be manipulated from user space. Some of the ioctl&squot;s&n; * service routines access user space and are not atomic. Therefor, ioctl&squot;s&n; * manipulating the lists and ioctl&squot;s sleeping while accessing the lists&n; * are serialized by means of a semaphore.&n; */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCNETDWRSET
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;INFO: ISDN_DW_ABC_EXTENSION not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETLCR
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;INFO: ISDN_ABC_LCR_SUPPORT not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef CONFIG_NETDEVICES
r_case
id|IIOCNETAIF
suffix:colon
multiline_comment|/* Add a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|s
op_assign
id|name
suffix:semicolon
)brace
r_else
(brace
id|s
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|s
op_assign
id|isdn_net_new
c_func
(paren
id|s
comma
l_int|NULL
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
id|s
comma
id|strlen
c_func
(paren
id|s
)paren
op_plus
l_int|1
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|IIOCNETASL
suffix:colon
multiline_comment|/* Add a slave to a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|bname
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bname
)paren
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|s
op_assign
id|isdn_net_newslave
c_func
(paren
id|bname
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
id|s
comma
id|strlen
c_func
(paren
id|s
)paren
op_plus
l_int|1
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|IIOCNETDIF
suffix:colon
multiline_comment|/* Delete a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_net_rm
c_func
(paren
id|name
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETSCF
suffix:colon
multiline_comment|/* Set configurable parameters of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_net_setcfg
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETGCF
suffix:colon
multiline_comment|/* Get configurable parameters of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ret
op_assign
id|isdn_net_getcfg
c_func
(paren
op_amp
id|cfg
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETANM
suffix:colon
multiline_comment|/* Add a phone-number to a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_net_addphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETGNM
suffix:colon
multiline_comment|/* Get list of phone-numbers of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_net_getphones
c_func
(paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETDNM
suffix:colon
multiline_comment|/* Delete a phone-number of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_net_delphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETDIL
suffix:colon
multiline_comment|/* Force dialing of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_net_force_dial
c_func
(paren
id|name
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_case
id|IIOCNETALN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_ppp_dial_slave
c_func
(paren
id|name
)paren
suffix:semicolon
r_case
id|IIOCNETDLN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_ppp_hangup_slave
c_func
(paren
id|name
)paren
suffix:semicolon
macro_line|#endif
r_case
id|IIOCNETHUP
suffix:colon
multiline_comment|/* Force hangup of a network-interface */
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|isdn_net_force_hangup
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif                          /* CONFIG_NETDEVICES */
r_case
id|IIOCSETVER
suffix:colon
id|dev-&gt;net_verbose
op_assign
id|arg
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Verbose-Level is %d&bslash;n&quot;
comma
id|dev-&gt;net_verbose
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETGST
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
id|dev-&gt;global_flags
op_or_assign
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
r_else
id|dev-&gt;global_flags
op_and_assign
op_complement
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Global Mode %s&bslash;n&quot;
comma
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
ques
c_cond
l_string|&quot;stopped&quot;
suffix:colon
l_string|&quot;running&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETBRJ
suffix:colon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|iocts.drvid
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|iocts.arg
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_or_assign
id|DRV_FLAG_REJBUS
suffix:semicolon
r_else
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
id|DRV_FLAG_REJBUS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSIGPRF
suffix:colon
id|dev-&gt;profd
op_assign
id|current
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCGETPRF
suffix:colon
multiline_comment|/* Get all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
op_plus
id|ISDN_LMSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|ISDN_MODEM_NUMREG
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_NUMREG
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|ISDN_MSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.plmsn
comma
id|ISDN_LMSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_LMSNLEN
suffix:semicolon
)brace
r_return
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
op_plus
id|ISDN_LMSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETPRF
suffix:colon
multiline_comment|/* Set all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|p
comma
id|ISDN_MODEM_NUMREG
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_NUMREG
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|p
comma
id|ISDN_MSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETMAP
suffix:colon
r_case
id|IIOCGETMAP
suffix:colon
multiline_comment|/* Set/Get MSN-&gt;EAZ-Mapping for a driver */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|drvidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|IIOCSETMAP
)paren
(brace
r_int
id|loop
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loop
)paren
(brace
r_int
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|p
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|get_user
c_func
(paren
id|bname
(braket
id|j
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bname
(braket
id|j
)braket
)paren
(brace
r_case
l_char|&squot;&bslash;0&squot;
suffix:colon
id|loop
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_char|&squot;,&squot;
suffix:colon
id|bname
(braket
id|j
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
comma
id|bname
)paren
suffix:semicolon
id|j
op_assign
id|ISDN_MSNLEN
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|j
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_ge
id|ISDN_MSNLEN
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|i
OG
l_int|9
)paren
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|bname
comma
l_string|&quot;%s%s&quot;
comma
id|strlen
c_func
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
)paren
ques
c_cond
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
suffix:colon
l_string|&quot;_&quot;
comma
(paren
id|i
OL
l_int|9
)paren
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&bslash;0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|bname
comma
id|strlen
c_func
(paren
id|bname
)paren
op_plus
l_int|1
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|bname
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCDBGVAR
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|dev
comma
r_sizeof
(paren
id|ulong
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_amp
id|IIOCDRVCTL
)paren
op_eq
id|IIOCDRVCTL
)paren
id|cmd
op_assign
(paren
(paren
id|cmd
op_rshift
id|_IOC_NRSHIFT
)paren
op_amp
id|_IOC_NRMASK
)paren
op_amp
id|ISDN_DRVIOCTL_MASK
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|iocts.drvid
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|drvidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_IOCTL
suffix:semicolon
id|c.arg
op_assign
id|cmd
suffix:semicolon
id|memcpy
c_func
(paren
id|c.parm.num
comma
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|isdn_command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
id|c.parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|iocts
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_ioctl
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|cmd
comma
id|arg
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
DECL|macro|name
macro_line|#undef name
DECL|macro|bname
macro_line|#undef bname
DECL|macro|iocts
macro_line|#undef iocts
DECL|macro|phone
macro_line|#undef phone
DECL|macro|cfg
macro_line|#undef cfg
)brace
multiline_comment|/*&n; * Open the device code.&n; */
r_static
r_int
DECL|function|isdn_open
id|isdn_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|ino-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|infostruct
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
(paren
id|infostruct
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|infostruct
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|p-&gt;next
op_assign
(paren
r_char
op_star
)paren
id|dev-&gt;infochain
suffix:semicolon
id|p
op_member_access_from_pointer
r_private
op_assign
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
suffix:semicolon
id|dev-&gt;infochain
op_assign
id|p
suffix:semicolon
multiline_comment|/* At opening we allow a single update */
id|filep-&gt;private_data
op_assign
(paren
r_char
op_star
)paren
l_int|1
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;channels
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_open minor %d obsolete!&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|online
op_amp
(paren
l_int|1
op_lshift
id|chidx
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|isdn_lock_drivers
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|isdn_lock_drivers
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
(brace
id|retval
op_assign
id|isdn_ppp_open
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|filep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
id|isdn_lock_drivers
c_func
(paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#endif
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_close
id|isdn_close
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|ino-&gt;i_rdev
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
id|infostruct
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p
op_member_access_from_pointer
r_private
op_eq
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
)paren
(brace
r_if
c_cond
(paren
id|q
)paren
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
r_else
id|dev-&gt;infochain
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: No private data while closing isdnctrl&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|isdn_unlock_drivers
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;profd
op_eq
id|current
)paren
id|dev-&gt;profd
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
id|isdn_ppp_release
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|filep
)paren
suffix:semicolon
macro_line|#endif
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|isdn_fops
r_static
r_struct
id|file_operations
id|isdn_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|isdn_llseek
comma
id|read
suffix:colon
id|isdn_read
comma
id|write
suffix:colon
id|isdn_write
comma
id|poll
suffix:colon
id|isdn_poll
comma
id|ioctl
suffix:colon
id|isdn_ioctl
comma
id|open
suffix:colon
id|isdn_open
comma
id|release
suffix:colon
id|isdn_close
comma
)brace
suffix:semicolon
r_char
op_star
DECL|function|isdn_map_eaz2msn
id|isdn_map_eaz2msn
c_func
(paren
r_char
op_star
id|msn
comma
r_int
id|di
)paren
(brace
id|driver
op_star
id|this
op_assign
id|dev-&gt;drv
(braket
id|di
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|msn
)paren
op_eq
l_int|1
)paren
(brace
id|i
op_assign
id|msn
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ge
l_int|0
)paren
op_logical_and
(paren
id|i
op_le
l_int|9
)paren
)paren
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
)paren
r_return
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
(paren
id|msn
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an unused ISDN-channel, whose feature-flags match the&n; * given L2- and L3-protocols.&n; */
DECL|macro|L2V
mdefine_line|#define L2V (~(ISDN_FEATURE_L2_V11096|ISDN_FEATURE_L2_V11019|ISDN_FEATURE_L2_V11038))
r_int
DECL|function|isdn_get_free_channel
id|isdn_get_free_channel
c_func
(paren
r_int
id|usage
comma
r_int
id|l2_proto
comma
r_int
id|l3_proto
comma
r_int
id|pre_dev
comma
r_int
id|pre_chan
comma
r_char
op_star
id|msn
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|ulong
id|features
suffix:semicolon
id|ulong
id|vfeatures
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|features
op_assign
(paren
(paren
l_int|1
op_lshift
id|l2_proto
)paren
op_or
(paren
l_int|0x10000
op_lshift
id|l3_proto
)paren
)paren
suffix:semicolon
id|vfeatures
op_assign
(paren
(paren
(paren
l_int|1
op_lshift
id|l2_proto
)paren
op_or
(paren
l_int|0x10000
op_lshift
id|l3_proto
)paren
)paren
op_amp
op_complement
(paren
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
)paren
)paren
suffix:semicolon
multiline_comment|/* If Layer-2 protocol is V.110, accept drivers with&n;&t; * transparent feature even if these don&squot;t support V.110&n;&t; * because we can emulate this in linklevel.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|USG_NONE
c_func
(paren
id|dev-&gt;usage
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_ne
op_minus
l_int|1
)paren
)paren
(brace
r_int
id|d
op_assign
id|dev-&gt;drvmap
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;usage
(braket
id|i
)braket
op_amp
id|ISDN_USAGE_EXCLUSIVE
)paren
op_logical_and
(paren
(paren
id|pre_dev
op_ne
id|d
)paren
op_logical_or
(paren
id|pre_chan
op_ne
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|isdn_map_eaz2msn
c_func
(paren
id|msn
comma
id|d
)paren
comma
l_string|&quot;-&quot;
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;usage
(braket
id|i
)braket
op_amp
id|ISDN_USAGE_DISABLED
)paren
r_continue
suffix:semicolon
multiline_comment|/* usage not allowed */
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|features
)paren
op_eq
id|features
)paren
op_logical_or
(paren
(paren
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|vfeatures
)paren
op_eq
id|vfeatures
)paren
op_logical_and
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|ISDN_FEATURE_L2_TRANS
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|pre_dev
OL
l_int|0
)paren
op_logical_or
(paren
id|pre_chan
OL
l_int|0
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|dev-&gt;usage
(braket
id|i
)braket
op_or_assign
id|usage
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|pre_dev
op_eq
id|d
)paren
op_logical_and
(paren
id|pre_chan
op_eq
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|dev-&gt;usage
(braket
id|i
)braket
op_or_assign
id|usage
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Set state of ISDN-channel to &squot;unused&squot;&n; */
r_void
DECL|function|isdn_free_channel
id|isdn_free_channel
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_int
id|usage
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
(paren
op_logical_neg
id|usage
)paren
op_logical_or
(paren
(paren
id|dev-&gt;usage
(braket
id|i
)braket
op_amp
id|ISDN_USAGE_MASK
)paren
op_eq
id|usage
)paren
)paren
op_logical_and
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
op_logical_and
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
(paren
id|ISDN_USAGE_NONE
op_or
id|ISDN_USAGE_EXCLUSIVE
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;num
(braket
id|i
)braket
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
id|dev-&gt;ibytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;obytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
singleline_comment|// 20.10.99 JIM, try to reinitialize v110 !
id|dev-&gt;v110emu
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
(paren
id|dev-&gt;v110use
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|isdn_v110_close
c_func
(paren
id|dev-&gt;v110
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev-&gt;v110
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|// 20.10.99 JIM, try to reinitialize v110 !
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|isdn_free_queue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|ch
)braket
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Cancel Exclusive-Flag for ISDN-channel&n; */
r_void
DECL|function|isdn_unexclusive_channel
id|isdn_unexclusive_channel
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
op_logical_and
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
op_complement
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  writebuf replacement for SKB_ABLE drivers&n; */
r_static
r_int
DECL|function|isdn_writebuf_stub
id|isdn_writebuf_stub
c_func
(paren
r_int
id|drvidx
comma
r_int
id|chan
comma
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|hl
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|hl
op_plus
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|0
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
l_int|1
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_le
l_int|0
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|dev-&gt;obytes
(braket
id|isdn_dc2minor
c_func
(paren
id|drvidx
comma
id|chan
)paren
)braket
op_add_assign
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Return: length of data on success, -ERRcode on failure.&n; */
r_int
DECL|function|isdn_writebuf_skb_stub
id|isdn_writebuf_skb_stub
c_func
(paren
r_int
id|drvidx
comma
r_int
id|chan
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|sk_buff
op_star
id|nskb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|v110_ret
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
id|idx
op_assign
id|isdn_dc2minor
c_func
(paren
id|drvidx
comma
id|chan
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
id|nskb
op_assign
id|isdn_v110_encode
c_func
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
comma
id|skb
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nskb
)paren
r_return
l_int|0
suffix:semicolon
id|v110_ret
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|nskb-&gt;data
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|nskb
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nskb-&gt;len
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|nskb
)paren
suffix:semicolon
r_return
id|v110_ret
suffix:semicolon
)brace
multiline_comment|/* V.110 must always be acknowledged */
id|ack
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
id|ack
comma
id|nskb
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|hl
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
id|hl
)paren
(brace
multiline_comment|/* &n;&t;&t;&t; * This should only occur when new HL driver with&n;&t;&t;&t; * increased hl_hdrlen was loaded after netdevice&n;&t;&t;&t; * was created and connected to the new driver.&n;&t;&t;&t; *&n;&t;&t;&t; * The V.110 branch (re-allocates on its own) does&n;&t;&t;&t; * not need this&n;&t;&t;&t; */
r_struct
id|sk_buff
op_star
id|skb_tmp
suffix:semicolon
id|skb_tmp
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_writebuf_skb_stub: reallocating headroom%s&bslash;n&quot;
comma
id|skb_tmp
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; failed&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_tmp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* 0 better? */
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
id|ack
comma
id|skb_tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_kfree_skb
c_func
(paren
id|skb_tmp
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
id|ack
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
(brace
id|dev-&gt;obytes
(braket
id|idx
)braket
op_add_assign
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
id|dev-&gt;v110
(braket
id|idx
)braket
op_member_access_from_pointer
id|skbuser
op_increment
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
multiline_comment|/* For V.110 return unencoded data length */
id|ret
op_assign
id|v110_ret
suffix:semicolon
multiline_comment|/* if the complete frame was send we free the skb;&n;&t;&t;&t;   if not upper function will requeue the skb */
r_if
c_cond
(paren
id|ret
op_eq
id|skb-&gt;len
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
id|dev_kfree_skb
c_func
(paren
id|nskb
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|register_isdn_module
id|register_isdn_module
c_func
(paren
id|isdn_module
op_star
id|m
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|unregister_isdn_module
id|unregister_isdn_module
c_func
(paren
id|isdn_module
op_star
id|m
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|isdn_add_channels
id|isdn_add_channels
c_func
(paren
id|driver
op_star
id|d
comma
r_int
id|drvidx
comma
r_int
id|n
comma
r_int
id|adding
)paren
(brace
r_int
id|j
comma
id|k
comma
id|m
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|d-&gt;st_waitq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|DRV_FLAG_RUNNING
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
id|m
op_assign
(paren
id|adding
)paren
ques
c_cond
id|d-&gt;channels
op_plus
id|n
suffix:colon
id|n
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;channels
op_plus
id|n
OG
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Max. %d channels supported&bslash;n&quot;
comma
id|ISDN_MAX_CHANNELS
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|adding
)paren
op_logical_and
(paren
id|d-&gt;rcverr
)paren
)paren
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rcverr
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|m
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcverr&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;rcverr
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
op_star
id|m
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adding
)paren
op_logical_and
(paren
id|d-&gt;rcvcount
)paren
)paren
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rcvcount
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|m
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcvcount&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adding
)paren
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;rcvcount
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
op_star
id|m
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adding
)paren
op_logical_and
(paren
id|d-&gt;rpqueue
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|d-&gt;channels
suffix:semicolon
id|j
op_increment
)paren
id|isdn_free_queue
c_func
(paren
op_amp
id|d-&gt;rpqueue
(braket
id|j
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rpqueue
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rpqueue
op_assign
(paren
r_struct
id|sk_buff_head
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sk_buff_head
)paren
op_star
id|m
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rpqueue&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adding
)paren
(brace
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|m
suffix:semicolon
id|j
op_increment
)paren
(brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|d-&gt;rpqueue
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|adding
)paren
op_logical_and
(paren
id|d-&gt;rcv_waitq
)paren
)paren
id|kfree
c_func
(paren
id|d-&gt;rcv_waitq
)paren
suffix:semicolon
id|d-&gt;rcv_waitq
op_assign
(paren
id|wait_queue_head_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|wait_queue_head_t
)paren
op_star
l_int|2
op_star
id|m
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d-&gt;rcv_waitq
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcv_waitq&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adding
)paren
(brace
id|kfree
c_func
(paren
id|d-&gt;rpqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|d-&gt;snd_waitq
op_assign
id|d-&gt;rcv_waitq
op_plus
id|m
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|m
suffix:semicolon
id|j
op_increment
)paren
(brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|d-&gt;rcv_waitq
(braket
id|j
)braket
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|d-&gt;snd_waitq
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dev-&gt;channels
op_add_assign
id|n
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|d-&gt;channels
suffix:semicolon
id|j
OL
id|m
suffix:semicolon
id|j
op_increment
)paren
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;chanmap
(braket
id|k
)braket
OL
l_int|0
)paren
(brace
id|dev-&gt;chanmap
(braket
id|k
)braket
op_assign
id|j
suffix:semicolon
id|dev-&gt;drvmap
(braket
id|k
)braket
op_assign
id|drvidx
suffix:semicolon
id|isdn_register_devfs
c_func
(paren
id|k
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|d-&gt;channels
op_assign
id|m
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Low-level-driver registration&n; */
r_static
r_void
DECL|function|set_global_features
id|set_global_features
c_func
(paren
r_void
)paren
(brace
r_int
id|drvidx
suffix:semicolon
id|dev-&gt;global_features
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
)paren
id|dev-&gt;global_features
op_or_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;features
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_ISDN_DIVERSION
DECL|function|map_drvname
r_static
r_char
op_star
id|map_drvname
c_func
(paren
r_int
id|di
)paren
(brace
r_if
c_cond
(paren
(paren
id|di
OL
l_int|0
)paren
op_logical_or
(paren
id|di
op_ge
id|ISDN_MAX_DRIVERS
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|dev-&gt;drvid
(braket
id|di
)braket
suffix:semicolon
multiline_comment|/* driver name */
)brace
multiline_comment|/* map_drvname */
DECL|function|map_namedrv
r_static
r_int
id|map_namedrv
c_func
(paren
r_char
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|id
)paren
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* map_namedrv */
DECL|function|DIVERT_REG_NAME
r_int
id|DIVERT_REG_NAME
c_func
(paren
id|isdn_divert_if
op_star
id|i_div
)paren
(brace
r_if
c_cond
(paren
id|i_div-&gt;if_magic
op_ne
id|DIVERT_IF_MAGIC
)paren
r_return
id|DIVERT_VER_ERR
suffix:semicolon
r_switch
c_cond
(paren
id|i_div-&gt;cmd
)paren
(brace
r_case
id|DIVERT_CMD_REL
suffix:colon
r_if
c_cond
(paren
id|divert_if
op_ne
id|i_div
)paren
r_return
id|DIVERT_REL_ERR
suffix:semicolon
id|divert_if
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* free interface */
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|DIVERT_NO_ERR
suffix:semicolon
r_case
id|DIVERT_CMD_REG
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
r_return
id|DIVERT_REG_ERR
suffix:semicolon
id|i_div-&gt;ll_cmd
op_assign
id|isdn_command
suffix:semicolon
multiline_comment|/* set command function */
id|i_div-&gt;drv_to_name
op_assign
id|map_drvname
suffix:semicolon
id|i_div-&gt;name_to_drv
op_assign
id|map_namedrv
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|divert_if
op_assign
id|i_div
suffix:semicolon
multiline_comment|/* remember interface */
r_return
id|DIVERT_NO_ERR
suffix:semicolon
r_default
suffix:colon
r_return
id|DIVERT_CMD_ERR
suffix:semicolon
)brace
)brace
multiline_comment|/* DIVERT_REG_NAME */
DECL|variable|DIVERT_REG_NAME
id|EXPORT_SYMBOL
c_func
(paren
id|DIVERT_REG_NAME
)paren
suffix:semicolon
macro_line|#endif CONFIG_ISDN_DIVERSION
DECL|variable|register_isdn
id|EXPORT_SYMBOL
c_func
(paren
id|register_isdn
)paren
suffix:semicolon
DECL|variable|register_isdn_module
id|EXPORT_SYMBOL
c_func
(paren
id|register_isdn_module
)paren
suffix:semicolon
DECL|variable|unregister_isdn_module
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_isdn_module
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
DECL|variable|isdn_ppp_register_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|isdn_ppp_register_compressor
)paren
suffix:semicolon
DECL|variable|isdn_ppp_unregister_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|isdn_ppp_unregister_compressor
)paren
suffix:semicolon
macro_line|#endif
r_int
DECL|function|register_isdn
id|register_isdn
c_func
(paren
id|isdn_if
op_star
id|i
)paren
(brace
id|driver
op_star
id|d
suffix:semicolon
r_int
id|j
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drivers
op_ge
id|ISDN_MAX_DRIVERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Max. %d drivers supported&bslash;n&quot;
comma
id|ISDN_MAX_DRIVERS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|i-&gt;writebuf_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: No write routine given.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d
op_assign
(paren
id|driver
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|driver
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc driver-struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d
comma
l_int|0
comma
r_sizeof
(paren
id|driver
)paren
)paren
suffix:semicolon
id|d-&gt;maxbufsize
op_assign
id|i-&gt;maxbufsize
suffix:semicolon
id|d-&gt;pktcount
op_assign
l_int|0
suffix:semicolon
id|d-&gt;stavail
op_assign
l_int|0
suffix:semicolon
id|d-&gt;flags
op_assign
id|DRV_FLAG_LOADED
suffix:semicolon
id|d-&gt;online
op_assign
l_int|0
suffix:semicolon
id|d-&gt;interface
op_assign
id|i
suffix:semicolon
id|d-&gt;channels
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|isdn_add_channels
c_func
(paren
id|d
comma
id|drvidx
comma
id|i-&gt;channels
comma
l_int|0
)paren
)paren
(brace
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|i-&gt;channels
op_assign
id|drvidx
suffix:semicolon
id|i-&gt;rcvcallb_skb
op_assign
id|isdn_receive_skb_callback
suffix:semicolon
id|i-&gt;statcallb
op_assign
id|isdn_status_callback
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|i-&gt;id
)paren
)paren
id|sprintf
c_func
(paren
id|i-&gt;id
comma
l_string|&quot;line%d&quot;
comma
id|drvidx
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|drvidx
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|i-&gt;id
comma
id|dev-&gt;drvid
(braket
id|j
)braket
)paren
)paren
id|sprintf
c_func
(paren
id|i-&gt;id
comma
l_string|&quot;line%d&quot;
comma
id|drvidx
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_assign
id|d
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;drvid
(braket
id|drvidx
)braket
comma
id|i-&gt;id
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;drivers
op_increment
suffix:semicolon
id|set_global_features
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; * And now the modules code.&n; *****************************************************************************&n; */
r_extern
r_int
id|printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|isdn_init
mdefine_line|#define isdn_init init_module
macro_line|#endif
r_static
r_char
op_star
DECL|function|isdn_getrev
id|isdn_getrev
c_func
(paren
r_const
r_char
op_star
id|revision
)paren
(brace
r_char
op_star
id|rev
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|rev
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
op_decrement
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|rev
op_assign
l_string|&quot;???&quot;
suffix:semicolon
r_return
id|rev
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DEVFS_FS
DECL|variable|devfs_handle
r_static
id|devfs_handle_t
id|devfs_handle
suffix:semicolon
DECL|function|isdn_register_devfs
r_static
r_void
id|isdn_register_devfs
c_func
(paren
r_int
id|k
)paren
(brace
r_char
id|buf
(braket
l_int|11
)braket
suffix:semicolon
id|sprintf
(paren
id|buf
comma
l_string|&quot;isdn%d&quot;
comma
id|k
)paren
suffix:semicolon
id|dev-&gt;devfs_handle_isdnX
(braket
id|k
)braket
op_assign
id|devfs_register
(paren
id|devfs_handle
comma
id|buf
comma
id|DEVFS_FL_DEFAULT
comma
id|ISDN_MAJOR
comma
id|ISDN_MINOR_B
op_plus
id|k
comma
l_int|0600
op_or
id|S_IFCHR
comma
op_amp
id|isdn_fops
comma
l_int|NULL
)paren
suffix:semicolon
id|sprintf
(paren
id|buf
comma
l_string|&quot;isdnctrl%d&quot;
comma
id|k
)paren
suffix:semicolon
id|dev-&gt;devfs_handle_isdnctrlX
(braket
id|k
)braket
op_assign
id|devfs_register
(paren
id|devfs_handle
comma
id|buf
comma
id|DEVFS_FL_DEFAULT
comma
id|ISDN_MAJOR
comma
id|ISDN_MINOR_CTRL
op_plus
id|k
comma
l_int|0600
op_or
id|S_IFCHR
comma
op_amp
id|isdn_fops
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|isdn_unregister_devfs
r_static
r_void
id|isdn_unregister_devfs
c_func
(paren
r_int
id|k
)paren
(brace
id|devfs_unregister
(paren
id|dev-&gt;devfs_handle_isdnX
(braket
id|k
)braket
)paren
suffix:semicolon
id|devfs_unregister
(paren
id|dev-&gt;devfs_handle_isdnctrlX
(braket
id|k
)braket
)paren
suffix:semicolon
)brace
DECL|function|isdn_init_devfs
r_static
r_void
id|isdn_init_devfs
c_func
(paren
r_void
)paren
(brace
macro_line|#  ifdef CONFIG_ISDN_PPP
r_int
id|i
suffix:semicolon
macro_line|#  endif
id|devfs_handle
op_assign
id|devfs_mk_dir
(paren
l_int|NULL
comma
l_string|&quot;isdn&quot;
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#  ifdef CONFIG_ISDN_PPP
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
id|buf
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
(paren
id|buf
comma
l_string|&quot;ippp%d&quot;
comma
id|i
)paren
suffix:semicolon
id|dev-&gt;devfs_handle_ipppX
(braket
id|i
)braket
op_assign
id|devfs_register
(paren
id|devfs_handle
comma
id|buf
comma
id|DEVFS_FL_DEFAULT
comma
id|ISDN_MAJOR
comma
id|ISDN_MINOR_PPP
op_plus
id|i
comma
l_int|0600
op_or
id|S_IFCHR
comma
op_amp
id|isdn_fops
comma
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#  endif
id|dev-&gt;devfs_handle_isdninfo
op_assign
id|devfs_register
(paren
id|devfs_handle
comma
l_string|&quot;isdninfo&quot;
comma
id|DEVFS_FL_DEFAULT
comma
id|ISDN_MAJOR
comma
id|ISDN_MINOR_STATUS
comma
l_int|0600
op_or
id|S_IFCHR
comma
op_amp
id|isdn_fops
comma
l_int|NULL
)paren
suffix:semicolon
id|dev-&gt;devfs_handle_isdnctrl
op_assign
id|devfs_register
(paren
id|devfs_handle
comma
l_string|&quot;isdnctrl&quot;
comma
id|DEVFS_FL_DEFAULT
comma
id|ISDN_MAJOR
comma
id|ISDN_MINOR_CTRL
comma
l_int|0600
op_or
id|S_IFCHR
comma
op_amp
id|isdn_fops
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|isdn_cleanup_devfs
r_static
r_void
id|isdn_cleanup_devfs
c_func
(paren
r_void
)paren
(brace
macro_line|#  ifdef CONFIG_ISDN_PPP
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|devfs_unregister
(paren
id|dev-&gt;devfs_handle_ipppX
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#  endif
id|devfs_unregister
(paren
id|dev-&gt;devfs_handle_isdninfo
)paren
suffix:semicolon
id|devfs_unregister
(paren
id|dev-&gt;devfs_handle_isdnctrl
)paren
suffix:semicolon
id|devfs_unregister
(paren
id|devfs_handle
)paren
suffix:semicolon
)brace
macro_line|#else   /* CONFIG_DEVFS_FS */
DECL|function|isdn_register_devfs
r_static
r_void
id|isdn_register_devfs
c_func
(paren
r_int
id|dummy
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|isdn_unregister_devfs
r_static
r_void
id|isdn_unregister_devfs
c_func
(paren
r_int
id|dummy
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|isdn_init_devfs
r_static
r_void
id|isdn_init_devfs
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|isdn_cleanup_devfs
r_static
r_void
id|isdn_cleanup_devfs
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#endif  /* CONFIG_DEVFS_FS */
multiline_comment|/*&n; * Allocate and initialize all data, register modem-devices&n; */
r_int
DECL|function|isdn_init
id|isdn_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|tmprev
(braket
l_int|50
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
(paren
id|isdn_dev
op_star
)paren
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|isdn_dev
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not allocate device-struct.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
id|isdn_dev
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|dev-&gt;timer.function
op_assign
id|isdn_timer_funct
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev-&gt;info_waitq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;drvmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;chanmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;m_idx
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;num
(braket
id|i
)braket
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|close_wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devfs_register_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
comma
op_amp
id|isdn_fops
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register control devices&bslash;n&quot;
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|isdn_init_devfs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|isdn_tty_modem_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register tty devices&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|3
)paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_le
op_minus
l_int|2
)paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|isdn_cleanup_devfs
c_func
(paren
)paren
suffix:semicolon
id|devfs_unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|isdn_ppp_init
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not create PPP-device-structs&bslash;n&quot;
)paren
suffix:semicolon
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
suffix:semicolon
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|xmit_buf
op_minus
l_int|4
)paren
suffix:semicolon
id|isdn_cleanup_devfs
c_func
(paren
)paren
suffix:semicolon
id|devfs_unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#endif                          /* CONFIG_ISDN_PPP */
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ISDN subsystem Rev: %s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_tty_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_net_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_ppp_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_audio_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|isdn_v110_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|isdn_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|printk
c_func
(paren
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|isdn_cards_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/*&n; * Unload module&n; */
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
id|isdn_ppp_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_rmall
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: net-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: ttyI-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: cui-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|isdn_tty_cleanup_xmit
c_func
(paren
op_amp
id|dev-&gt;mdm.info
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|xmit_buf
op_minus
l_int|4
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
id|kfree
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|fax
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|devfs_unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: controldevice busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|isdn_cleanup_devfs
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* call vfree with interrupts enabled, else it will hang */
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ISDN-subsystem unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
eof
