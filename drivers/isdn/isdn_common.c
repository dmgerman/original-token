multiline_comment|/* $Id: isdn_common.c,v 1.44 1997/05/27 15:17:23 fritz Exp $&n;&n; * Linux ISDN subsystem, common used functions (linklevel).&n; *&n; * Copyright 1994,95,96 by Fritz Elfert (fritz@wuemaus.franken.de)&n; * Copyright 1995,96    Thinking Objects Software GmbH Wuerzburg&n; * Copyright 1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * $Log: isdn_common.c,v $&n; * Revision 1.44  1997/05/27 15:17:23  fritz&n; * Added changes for recent 2.1.x kernels:&n; *   changed return type of isdn_close&n; *   queue_task_* -&gt; queue_task&n; *   clear/set_bit -&gt; test_and_... where apropriate.&n; *   changed type of hard_header_cache parameter.&n; *&n; * Revision 1.43  1997/03/31 14:09:43  fritz&n; * Fixed memory leak in isdn_close().&n; *&n; * Revision 1.42  1997/03/30 16:51:08  calle&n; * changed calls to copy_from_user/copy_to_user and removed verify_area&n; * were possible.&n; *&n; * Revision 1.41  1997/03/24 22:54:41  fritz&n; * Some small fixes in debug code.&n; *&n; * Revision 1.40  1997/03/08 08:13:51  fritz&n; * Bugfix: IIOCSETMAP (Set mapping) was broken.&n; *&n; * Revision 1.39  1997/03/07 01:32:54  fritz&n; * Added proper ifdef&squot;s for CONFIG_ISDN_AUDIO&n; *&n; * Revision 1.38  1997/03/05 21:15:02  fritz&n; * Fix: reduced stack usage of isdn_ioctl() and isdn_set_allcfg()&n; *&n; * Revision 1.37  1997/03/02 14:29:18  fritz&n; * More ttyI related cleanup.&n; *&n; * Revision 1.36  1997/02/28 02:32:40  fritz&n; * Cleanup: Moved some tty related stuff from isdn_common.c&n; *          to isdn_tty.c&n; * Bugfix:  Bisync protocol did not behave like documented.&n; *&n; * Revision 1.35  1997/02/21 13:01:19  fritz&n; * Changes CAUSE message output in kernel log.&n; *&n; * Revision 1.34  1997/02/10 20:12:43  fritz&n; * Changed interface for reporting incoming calls.&n; *&n; * Revision 1.33  1997/02/10 10:05:42  fritz&n; * More changes for Kernel 2.1.X&n; * Symbol information moved to isdn_syms.c&n; *&n; * Revision 1.32  1997/02/03 22:55:26  fritz&n; * Reformatted according CodingStyle.&n; * Changed isdn_writebuf_stub static.&n; * Slow down tty-RING counter.&n; * skb-&gt;free stuff replaced by macro.&n; * Bugfix in audio-skb locking.&n; * Bugfix in HL-driver locking.&n; *&n; * Revision 1.31  1997/01/17 01:19:18  fritz&n; * Applied chargeint patch.&n; *&n; * Revision 1.30  1997/01/14 01:27:47  fritz&n; * Changed audio receive not to rely on skb-&gt;users and skb-&gt;lock.&n; * Added ATI2 and related variables.&n; * Started adding full-duplex audio capability.&n; *&n; * Revision 1.29  1997/01/12 23:33:03  fritz&n; * Made isdn_all_eaz foolproof.&n; *&n; * Revision 1.28  1996/11/13 02:33:19  fritz&n; * Fixed a race condition.&n; *&n; * Revision 1.27  1996/10/27 22:02:41  keil&n; * return codes for ISDN_STAT_ICALL&n; *&n; * Revision 1.26  1996/10/23 11:59:40  fritz&n; * More compatibility changes.&n; *&n; * Revision 1.25  1996/10/22 23:13:54  fritz&n; * Changes for compatibility to 2.0.X and 2.1.X kernels.&n; *&n; * Revision 1.24  1996/10/11 14:02:03  fritz&n; * Bugfix: call to isdn_ppp_timer_timeout() never compiled, because of&n; *         typo in #ifdef.&n; *&n; * Revision 1.23  1996/06/25 18:35:38  fritz&n; * Fixed bogus memory access in isdn_set_allcfg().&n; *&n; * Revision 1.22  1996/06/24 17:37:37  fritz&n; * Bugfix: isdn_timer_ctrl() did restart timer, even if it&n; *         was already running.&n; *         lowlevel driver locking did use wrong parameters.&n; *&n; * Revision 1.21  1996/06/15 14:58:20  fritz&n; * Added version signatures for data structures used&n; * by userlevel programs.&n; *&n; * Revision 1.20  1996/06/12 16:01:49  fritz&n; * Bugfix: Remote B-channel hangup sometimes did not result&n; *         in a NO CARRIER on tty.&n; *&n; * Revision 1.19  1996/06/11 14:52:04  hipp&n; * minor bugfix in isdn_writebuf_skb_stub()&n; *&n; * Revision 1.18  1996/06/06 14:51:51  fritz&n; * Changed to support DTMF decoding on audio playback also.&n; *&n; * Revision 1.17  1996/06/05 02:24:10  fritz&n; * Added DTMF decoder for audio mode.&n; *&n; * Revision 1.16  1996/06/03 20:09:05  fritz&n; * Bugfix: called wrong function pointer for locking in&n; *         isdn_get_free_channel().&n; *&n; * Revision 1.15  1996/05/31 01:10:54  fritz&n; * Bugfixes:&n; *   Lowlevel modules did not get locked correctly.&n; *   Did show wrong revision when initializing.&n; *   Minor fixes in ioctl code.&n; *   sk_buff did not get freed, if error in writebuf_stub.&n; *&n; * Revision 1.14  1996/05/18 01:36:55  fritz&n; * Added spelling corrections and some minor changes&n; * to stay in sync with kernel.&n; *&n; * Revision 1.13  1996/05/17 15:43:30  fritz&n; * Bugfix: decrement of rcvcount in readbchan() corrected.&n; *&n; * Revision 1.12  1996/05/17 03:55:43  fritz&n; * Changed DLE handling for audio receive.&n; * Some cleanup.&n; * Added display of isdn_audio_revision.&n; *&n; * Revision 1.11  1996/05/11 21:51:32  fritz&n; * Changed queue management to use sk_buffs.&n; *&n; * Revision 1.10  1996/05/10 08:49:16  fritz&n; * Checkin before major changes of tty-code.&n; *&n; * Revision 1.9  1996/05/07 09:19:41  fritz&n; * Adapted to changes in isdn_tty.c&n; *&n; * Revision 1.8  1996/05/06 11:34:51  hipp&n; * fixed a few bugs&n; *&n; * Revision 1.7  1996/05/02 03:55:17  fritz&n; * Bugfixes:&n; *  - B-channel connect message for modem devices&n; *    sometimes did not result in a CONNECT-message.&n; *  - register_isdn did not check for driverId-conflicts.&n; *&n; * Revision 1.6  1996/04/30 20:57:21  fritz&n; * Commit test&n; *&n; * Revision 1.5  1996/04/20 16:19:07  fritz&n; * Changed slow timer handlers to increase accuracy.&n; * Added statistic information for usage by xisdnload.&n; * Fixed behaviour of isdnctrl-device on non-blocked io.&n; * Fixed all io to go through generic writebuf-function without&n; * bypassing. Same for incoming data.&n; * Fixed bug: Last channel had been unusable.&n; * Fixed kfree of tty xmit_buf on ppp initialization failure.&n; *&n; * Revision 1.4  1996/02/11 02:33:26  fritz&n; * Fixed bug in main timer-dispatcher.&n; * Bugfix: Lot of tty-callbacks got called regardless of the events already&n; * been handled by network-devices.&n; * Changed ioctl-names.&n; *&n; * Revision 1.3  1996/01/22 05:16:11  fritz&n; * Changed ioctl-names.&n; * Fixed bugs in isdn_open and isdn_close regarding PPP_MINOR.&n; *&n; * Revision 1.2  1996/01/21 16:52:40  fritz&n; * Support for sk_buffs added, changed header-stuffing.&n; *&n; * Revision 1.1  1996/01/09 04:12:52  fritz&n; * Initial revision&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#if (LINUX_VERSION_CODE &gt;= 0x020117)
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_tty.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#ifdef CONFIG_ISDN_AUDIO
macro_line|#include &quot;isdn_audio.h&quot;
macro_line|#endif
macro_line|#include &quot;isdn_cards.h&quot;
multiline_comment|/* Debugflags */
DECL|macro|ISDN_DEBUG_STATCALLB
macro_line|#undef ISDN_DEBUG_STATCALLB
DECL|variable|dev
id|isdn_dev
op_star
id|dev
op_assign
(paren
id|isdn_dev
op_star
)paren
l_int|0
suffix:semicolon
DECL|variable|isdn_revision
r_static
r_char
op_star
id|isdn_revision
op_assign
l_string|&quot;$Revision: 1.44 $&quot;
suffix:semicolon
r_extern
r_char
op_star
id|isdn_net_revision
suffix:semicolon
r_extern
r_char
op_star
id|isdn_tty_revision
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_extern
r_char
op_star
id|isdn_ppp_revision
suffix:semicolon
macro_line|#else
DECL|variable|isdn_ppp_revision
r_static
r_char
op_star
id|isdn_ppp_revision
op_assign
l_string|&quot;: none $&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_AUDIO
r_extern
r_char
op_star
id|isdn_audio_revision
suffix:semicolon
macro_line|#else
DECL|variable|isdn_audio_revision
r_static
r_char
op_star
id|isdn_audio_revision
op_assign
l_string|&quot;: none $&quot;
suffix:semicolon
macro_line|#endif
r_static
r_int
id|isdn_writebuf_stub
c_func
(paren
r_int
comma
r_int
comma
r_const
id|u_char
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_void
DECL|function|isdn_MOD_INC_USE_COUNT
id|isdn_MOD_INC_USE_COUNT
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
r_void
DECL|function|isdn_MOD_DEC_USE_COUNT
id|isdn_MOD_DEC_USE_COUNT
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#if defined(ISDN_DEBUG_NET_DUMP) || defined(ISDN_DEBUG_MODEM_DUMP)
r_void
DECL|function|isdn_dumppkt
id|isdn_dumppkt
c_func
(paren
r_char
op_star
id|s
comma
id|u_char
op_star
id|p
comma
r_int
id|len
comma
r_int
id|dumplen
)paren
(brace
r_int
id|dumpc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(%d) &quot;
comma
id|s
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dumpc
op_assign
l_int|0
suffix:semicolon
(paren
id|dumpc
OL
id|dumplen
)paren
op_logical_and
(paren
id|len
)paren
suffix:semicolon
id|len
op_decrement
comma
id|dumpc
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p
op_increment
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
id|__inline
r_void
DECL|function|isdn_trash_skb
id|isdn_trash_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|rw
)paren
(brace
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
comma
id|rw
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_free_queue
id|isdn_free_queue
c_func
(paren
r_struct
id|sk_buff_head
op_star
id|queue
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
id|queue
)paren
)paren
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|queue
)paren
)paren
)paren
id|isdn_trash_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_int
DECL|function|isdn_dc2minor
id|isdn_dc2minor
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
op_logical_and
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
r_return
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|isdn_timer_cnt1
r_static
r_int
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
DECL|variable|isdn_timer_cnt2
r_static
r_int
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
DECL|variable|isdn_timer_cnt3
r_static
r_int
id|isdn_timer_cnt3
op_assign
l_int|0
suffix:semicolon
r_static
r_void
DECL|function|isdn_timer_funct
id|isdn_timer_funct
c_func
(paren
id|ulong
id|dummy
)paren
(brace
r_int
id|tf
op_assign
id|dev-&gt;tflags
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_FAST
)paren
(brace
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMREAD
)paren
id|isdn_tty_readmodem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMPLUS
)paren
id|isdn_tty_modem_escape
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMXMIT
)paren
id|isdn_tty_modem_xmit
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_SLOW
)paren
(brace
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt1
op_ge
id|ISDN_TIMER_02SEC
)paren
(brace
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_NETDIAL
)paren
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt2
op_ge
id|ISDN_TIMER_1SEC
)paren
(brace
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_NETHANGUP
)paren
id|isdn_net_autohup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|isdn_timer_cnt3
OG
id|ISDN_TIMER_RINGING
)paren
(brace
id|isdn_timer_cnt3
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_MODEMRING
)paren
id|isdn_tty_modem_ring
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if (defined CONFIG_ISDN_PPP) &amp;&amp; (defined CONFIG_ISDN_MPP)
r_if
c_cond
(paren
id|tf
op_amp
id|ISDN_TIMER_IPPP
)paren
id|isdn_ppp_timer_timeout
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
id|tf
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|dev-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|ISDN_TIMER_RES
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|isdn_timer_ctrl
id|isdn_timer_ctrl
c_func
(paren
r_int
id|tf
comma
r_int
id|onoff
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tf
op_amp
id|ISDN_TIMER_SLOW
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|dev-&gt;tflags
op_amp
id|ISDN_TIMER_SLOW
)paren
)paren
)paren
(brace
multiline_comment|/* If the slow-timer wasn&squot;t activated until now */
id|isdn_timer_cnt1
op_assign
l_int|0
suffix:semicolon
id|isdn_timer_cnt2
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|onoff
)paren
id|dev-&gt;tflags
op_or_assign
id|tf
suffix:semicolon
r_else
id|dev-&gt;tflags
op_and_assign
op_complement
id|tf
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tflags
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
)paren
multiline_comment|/* del_timer is 1, when active */
id|dev-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|ISDN_TIMER_RES
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Receive a packet from B-Channel. (Called from low-level-module)&n; */
r_static
r_void
DECL|function|isdn_receive_skb_callback
id|isdn_receive_skb_callback
c_func
(paren
r_int
id|di
comma
r_int
id|channel
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|channel
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|isdn_trash_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Update statistics */
id|dev-&gt;ibytes
(braket
id|i
)braket
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* First, try to deliver data to network-device */
r_if
c_cond
(paren
id|isdn_net_rcv_skb
c_func
(paren
id|i
comma
id|skb
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* No network-device found, deliver to tty or raw-channel */
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
)paren
(brace
r_if
c_cond
(paren
id|isdn_tty_rcv_skb
c_func
(paren
id|i
comma
id|di
comma
id|channel
comma
id|skb
)paren
)paren
r_return
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcv_waitq
(braket
id|channel
)braket
)paren
suffix:semicolon
)brace
r_else
id|isdn_trash_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_void
DECL|function|isdn_all_eaz
id|isdn_all_eaz
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|di
OL
l_int|0
)paren
r_return
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|ch
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_SETEAZ
suffix:semicolon
id|cmd.parm.num
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_status_callback
id|isdn_status_callback
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
r_int
id|di
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|r
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|di
op_assign
id|c-&gt;driver
suffix:semicolon
id|i
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|c-&gt;arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_STAT_BSENT
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|snd_waitq
(braket
id|c-&gt;arg
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_STAVAIL
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|stavail
op_add_assign
id|c-&gt;arg
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|st_waitq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_RUN
suffix:colon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|running
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
id|isdn_all_eaz
c_func
(paren
id|di
comma
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_STOP
suffix:colon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ICALL
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ICALL (net): %d %ld %s&bslash;n&quot;
comma
id|di
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Try to find a network-interface which will accept incoming call */
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|r
op_assign
id|isdn_net_find_icall
c_func
(paren
id|di
comma
id|c-&gt;arg
comma
id|i
comma
id|c-&gt;parm.setup
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|r
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* No network-device replies.&n;&t;&t;&t;&t;&t; * Try ttyI&squot;s&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|isdn_tty_find_icall
c_func
(paren
id|di
comma
id|c-&gt;arg
comma
id|c-&gt;parm.setup
)paren
op_ge
l_int|0
)paren
id|retval
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|reject_bus
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|retval
op_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Schedule connection-setup */
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_ACCEPTD
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|retval
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* For calling back, first reject incoming call ... */
r_case
l_int|3
suffix:colon
multiline_comment|/* Interface found, but down, reject call actively  */
id|retval
op_assign
l_int|2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Rejecting Call&bslash;n&quot;
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|3
)paren
r_break
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_int|4
suffix:colon
multiline_comment|/* ... then start callback. */
id|isdn_net_dial
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|retval
op_ne
l_int|1
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CINF
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;CINF: %ld %s&bslash;n&quot;
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|c-&gt;parm.num
comma
l_string|&quot;0&quot;
)paren
)paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CAUSE
suffix:colon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;CAUSE: %ld %s&bslash;n&quot;
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: %s,ch%ld cause: %s&bslash;n&quot;
comma
id|dev-&gt;drvid
(braket
id|di
)braket
comma
id|c-&gt;arg
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DCONN
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DCONN: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Find any net-device, waiting for D-channel setup */
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* Find any ttyI, waiting for D-channel setup */
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_ACCEPTB
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DHUP: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Signal hangup to network-devices */
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;BCONN: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Signal B-channel-connect to network-devices */
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BHUP
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;BHUP: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|c-&gt;arg
)paren
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_NODCH
suffix:colon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef ISDN_DEBUG_STATCALLB
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;NODCH: %ld&bslash;n&quot;
comma
id|c-&gt;arg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_stat_callback
c_func
(paren
id|i
comma
id|c-&gt;command
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ADDCH
suffix:colon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_UNLOAD
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
(brace
id|dev-&gt;drvmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;chanmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|dev-&gt;drivers
op_decrement
suffix:semicolon
id|dev-&gt;channels
op_sub_assign
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|channels
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|channels
suffix:semicolon
id|i
op_increment
)paren
id|isdn_free_queue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcv_waitq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|snd_waitq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;drv
(braket
id|di
)braket
)paren
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;drvid
(braket
id|di
)braket
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get integer from char-pointer, set pointer to end of number&n; */
r_int
DECL|function|isdn_getnum
id|isdn_getnum
c_func
(paren
r_char
op_star
op_star
id|p
)paren
(brace
r_int
id|v
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|p
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
id|v
op_assign
(paren
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
id|v
op_star
l_int|10
)paren
)paren
op_plus
(paren
r_int
)paren
(paren
(paren
op_star
id|p
(braket
l_int|0
)braket
op_increment
)paren
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
DECL|macro|DLE
mdefine_line|#define DLE 0x10
multiline_comment|/*&n; * isdn_readbchan() tries to get data from the read-queue.&n; * It MUST be called with interrupts off.&n; */
r_int
DECL|function|isdn_readbchan
id|isdn_readbchan
c_func
(paren
r_int
id|di
comma
r_int
id|channel
comma
id|u_char
op_star
id|buf
comma
id|u_char
op_star
id|fp
comma
r_int
id|len
comma
r_int
id|user
)paren
(brace
r_int
id|left
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|count_pull
suffix:semicolon
r_int
id|count_put
suffix:semicolon
r_int
id|dflag
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u_char
op_star
id|cp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|di
)braket
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
id|user
)paren
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcv_waitq
(braket
id|channel
)braket
)paren
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
id|left
op_assign
id|MIN
c_func
(paren
id|len
comma
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
(braket
id|channel
)braket
)paren
suffix:semicolon
id|cp
op_assign
id|buf
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|left
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
)paren
)paren
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
r_if
c_cond
(paren
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
)paren
r_break
suffix:semicolon
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ISDN_AUDIO_SKB_DLECOUNT
c_func
(paren
id|skb
)paren
)paren
(brace
r_char
op_star
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
r_int
r_int
id|DLEmask
op_assign
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
id|dflag
op_assign
l_int|0
suffix:semicolon
id|count_pull
op_assign
id|count_put
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|count_pull
OL
id|skb-&gt;len
)paren
op_logical_and
(paren
id|left
op_decrement
OG
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_amp
id|DLEmask
)paren
(brace
r_if
c_cond
(paren
id|user
)paren
id|put_user
c_func
(paren
id|DLE
comma
id|cp
op_increment
)paren
suffix:semicolon
r_else
op_star
id|cp
op_increment
op_assign
id|DLE
suffix:semicolon
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_and_assign
op_complement
id|DLEmask
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|user
)paren
id|put_user
c_func
(paren
op_star
id|p
comma
id|cp
op_increment
)paren
suffix:semicolon
r_else
op_star
id|cp
op_increment
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_eq
id|DLE
)paren
(brace
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|DLEflag
op_or_assign
id|DLEmask
suffix:semicolon
(paren
id|ISDN_AUDIO_SKB_DLECOUNT
c_func
(paren
id|skb
)paren
)paren
op_decrement
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
id|count_pull
op_increment
suffix:semicolon
)brace
id|count_put
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count_pull
op_ge
id|skb-&gt;len
)paren
id|dflag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
multiline_comment|/* No DLE&squot;s in buff, so simply copy it */
id|dflag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count_pull
op_assign
id|skb-&gt;len
)paren
OG
id|left
)paren
(brace
id|count_pull
op_assign
id|left
suffix:semicolon
id|dflag
op_assign
l_int|0
suffix:semicolon
)brace
id|count_put
op_assign
id|count_pull
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_to_user
c_func
(paren
id|cp
comma
id|skb-&gt;data
comma
id|count_put
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|cp
comma
id|skb-&gt;data
comma
id|count_put
)paren
suffix:semicolon
id|cp
op_add_assign
id|count_put
suffix:semicolon
id|left
op_sub_assign
id|count_put
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
)brace
macro_line|#endif
id|count
op_add_assign
id|count_put
suffix:semicolon
r_if
c_cond
(paren
id|fp
)paren
(brace
id|memset
c_func
(paren
id|fp
comma
l_int|0
comma
id|count_put
)paren
suffix:semicolon
id|fp
op_add_assign
id|count_put
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dflag
)paren
(brace
multiline_comment|/* We got all the data in this buff.&n;&t;&t;&t; * Now we can dequeue it.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|fp
)paren
op_star
(paren
id|fp
op_minus
l_int|1
)paren
op_assign
l_int|0xff
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|channel
)braket
)paren
suffix:semicolon
id|isdn_trash_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Not yet emptied this buff, so it&n;&t;&t;&t; * must stay in the queue, for further calls&n;&t;&t;&t; * but we pull off the data we got until now.&n;&t;&t;&t; */
id|skb_pull
c_func
(paren
id|skb
comma
id|count_pull
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_AUDIO
id|ISDN_AUDIO_SKB_LOCK
c_func
(paren
id|skb
)paren
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rcvcount
(braket
id|channel
)braket
op_sub_assign
id|count_put
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|__inline
r_int
DECL|function|isdn_minor2drv
id|isdn_minor2drv
c_func
(paren
r_int
id|minor
)paren
(brace
r_return
(paren
id|dev-&gt;drvmap
(braket
id|minor
)braket
)paren
suffix:semicolon
)brace
r_static
id|__inline
r_int
DECL|function|isdn_minor2chan
id|isdn_minor2chan
c_func
(paren
r_int
id|minor
)paren
(brace
r_return
(paren
id|dev-&gt;chanmap
(braket
id|minor
)braket
)paren
suffix:semicolon
)brace
DECL|macro|INF_DV
mdefine_line|#define INF_DV 0x01             /* Data version for /dev/isdninfo */
r_static
r_char
op_star
DECL|function|isdn_statstr
id|isdn_statstr
c_func
(paren
r_void
)paren
(brace
r_static
r_char
id|istatbuf
(braket
l_int|2048
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sprintf
c_func
(paren
id|istatbuf
comma
l_string|&quot;idmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
OL
l_int|0
)paren
ques
c_cond
l_string|&quot;-&quot;
suffix:colon
id|dev-&gt;drvid
(braket
id|dev-&gt;drvmap
(braket
id|i
)braket
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nchmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;ndrmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;drvmap
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nusage:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|dev-&gt;usage
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nflags:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%ld &quot;
comma
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|flags
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;? &quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nphone:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
id|dev-&gt;num
(braket
id|i
)braket
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|istatbuf
suffix:semicolon
)brace
multiline_comment|/* Module interface-code */
r_void
DECL|function|isdn_info_update
id|isdn_info_update
c_func
(paren
r_void
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
op_star
(paren
id|p
op_member_access_from_pointer
r_private
)paren
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
id|p-&gt;next
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
r_static
id|RWTYPE
DECL|function|isdn_read
id|isdn_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
id|RWARG
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file-&gt;private_data
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
id|p
op_assign
id|isdn_statstr
c_func
(paren
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|strlen
c_func
(paren
id|p
)paren
)paren
op_le
id|count
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|running
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|len
op_assign
id|isdn_readbchan
c_func
(paren
id|drvidx
comma
id|chidx
comma
id|buf
comma
l_int|0
comma
id|count
comma
l_int|1
)paren
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|st_waitq
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;readstat
)paren
id|len
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|readstat
c_func
(paren
id|buf
comma
id|MIN
c_func
(paren
id|count
comma
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
comma
l_int|1
comma
id|drvidx
comma
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
)paren
suffix:semicolon
r_else
id|len
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
op_sub_assign
id|len
suffix:semicolon
r_else
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_read
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|buf
comma
id|count
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|isdn_lseek
r_static
id|LSTYPE
id|isdn_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|LSARG
id|offset
comma
r_int
id|orig
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
r_static
id|RWTYPE
DECL|function|isdn_write
id|isdn_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
id|RWARG
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|running
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_while
c_loop
(paren
id|isdn_writebuf_stub
c_func
(paren
id|drvidx
comma
id|chidx
comma
id|buf
comma
id|count
comma
l_int|1
)paren
op_ne
id|count
)paren
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|snd_waitq
(braket
id|chidx
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We want to use the isdnctrl device to load the firmware&n;&t;&t; *&n;&t;&t; if (!dev-&gt;drv[drvidx]-&gt;running)&n;&t;&t; return -ENODEV;&n;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;writecmd
)paren
r_return
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writecmd
c_func
(paren
id|buf
comma
id|count
comma
l_int|1
comma
id|drvidx
comma
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
)paren
)paren
suffix:semicolon
r_else
r_return
id|count
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_write
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|buf
comma
id|count
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#if (LINUX_VERSION_CODE &lt; 0x020117)
r_static
r_int
DECL|function|isdn_select
id|isdn_select
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
id|type
comma
id|select_table
op_star
id|st
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
r_return
l_int|1
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|st
)paren
id|select_wait
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
comma
id|st
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|minor
op_ge
id|ISDN_MINOR_CTRL
op_logical_and
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
r_return
l_int|1
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|st
)paren
id|select_wait
c_func
(paren
op_amp
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|st_waitq
)paren
comma
id|st
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_select
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|type
comma
id|st
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#else
r_static
r_int
r_int
DECL|function|isdn_poll
id|isdn_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|poll_wait
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
comma
id|wait
)paren
suffix:semicolon
multiline_comment|/* mask = POLLOUT | POLLWRNORM; */
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
(brace
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_ge
id|ISDN_MINOR_CTRL
op_logical_and
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|poll_wait
c_func
(paren
op_amp
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|st_waitq
)paren
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_common: isdn_poll 1 -&gt; what the hell&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|POLLERR
suffix:semicolon
)brace
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|stavail
)paren
(brace
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_poll
c_func
(paren
id|file
comma
id|wait
)paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_common: isdn_poll 2 -&gt; what the hell&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|POLLERR
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|isdn_set_allcfg
id|isdn_set_allcfg
c_func
(paren
r_char
op_star
id|src
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|isdn_net_ioctl_cfg
id|cfg
suffix:semicolon
id|isdn_net_ioctl_phone
id|phone
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_rmall
c_func
(paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|i
comma
id|src
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|src
op_add_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
)paren
(brace
r_int
id|phone_len
suffix:semicolon
r_int
id|out_flag
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
id|src
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|src
op_add_assign
r_sizeof
(paren
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_new
c_func
(paren
id|cfg.name
comma
l_int|NULL
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_setcfg
c_func
(paren
op_amp
id|cfg
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|phone_len
op_assign
id|out_flag
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|out_flag
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|src
comma
l_int|1
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|GET_USER
c_func
(paren
id|phone.phone
(braket
id|phone_len
)braket
comma
id|src
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|phone.phone
(braket
id|phone_len
)braket
op_eq
l_char|&squot; &squot;
)paren
op_logical_or
(paren
id|phone.phone
(braket
id|phone_len
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|phone_len
)paren
(brace
id|phone.phone
(braket
id|phone_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|phone.name
comma
id|cfg.name
)paren
suffix:semicolon
id|phone.outgoing
op_assign
id|out_flag
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_addphone
c_func
(paren
op_amp
id|phone
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_else
id|out_flag
op_increment
suffix:semicolon
id|phone_len
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|phone_len
op_ge
r_sizeof
(paren
id|phone.phone
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: IIOCSETSET phone number too long, ignored&bslash;n&quot;
comma
id|cfg.name
)paren
suffix:semicolon
)brace
id|i
op_decrement
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_get_allcfg
id|isdn_get_allcfg
c_func
(paren
r_char
op_star
id|dest
)paren
(brace
id|isdn_net_ioctl_cfg
id|cfg
suffix:semicolon
id|isdn_net_ioctl_phone
id|phone
suffix:semicolon
id|isdn_net_dev
op_star
id|p
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Walk through netdev-chain */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|p
op_assign
id|dev-&gt;netdev
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|dest
comma
r_sizeof
(paren
id|cfg
)paren
op_plus
l_int|200
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|cfg.eaz
comma
id|p-&gt;local.msn
)paren
suffix:semicolon
id|cfg.exclusive
op_assign
id|p-&gt;local.exclusive
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;local.pre_device
op_ge
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|cfg.drvid
comma
l_string|&quot;%s,%d&quot;
comma
id|dev-&gt;drvid
(braket
id|p-&gt;local.pre_device
)braket
comma
id|p-&gt;local.pre_channel
)paren
suffix:semicolon
)brace
r_else
id|cfg.drvid
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|cfg.onhtime
op_assign
id|p-&gt;local.onhtime
suffix:semicolon
id|cfg.charge
op_assign
id|p-&gt;local.charge
suffix:semicolon
id|cfg.l2_proto
op_assign
id|p-&gt;local.l2_proto
suffix:semicolon
id|cfg.l3_proto
op_assign
id|p-&gt;local.l3_proto
suffix:semicolon
id|cfg.p_encap
op_assign
id|p-&gt;local.p_encap
suffix:semicolon
id|cfg.secure
op_assign
(paren
id|p-&gt;local.flags
op_amp
id|ISDN_NET_SECURE
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg.callback
op_assign
(paren
id|p-&gt;local.flags
op_amp
id|ISDN_NET_CALLBACK
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg.chargehup
op_assign
(paren
id|p-&gt;local.hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg.ihup
op_assign
(paren
id|p-&gt;local.hupflags
op_amp
id|ISDN_INHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg.chargeint
op_assign
id|p-&gt;local.chargeint
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|dest
comma
id|p-&gt;local.name
comma
l_int|10
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|dest
op_add_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|dest
comma
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|dest
op_add_assign
r_sizeof
(paren
id|cfg
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|phone.name
comma
id|p-&gt;local.name
)paren
suffix:semicolon
id|phone.outgoing
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_getphones
c_func
(paren
op_amp
id|phone
comma
id|dest
)paren
)paren
OL
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
id|dest
op_add_assign
id|ret
suffix:semicolon
id|strcpy
c_func
(paren
id|phone.name
comma
id|p-&gt;local.name
)paren
suffix:semicolon
id|phone.outgoing
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_getphones
c_func
(paren
op_amp
id|phone
comma
id|dest
)paren
)paren
OL
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
id|dest
op_add_assign
id|ret
suffix:semicolon
id|put_user
c_func
(paren
l_int|0
comma
id|dest
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ioctl
id|isdn_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|uint
id|cmd
comma
id|ulong
id|arg
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|isdn_ctrl
id|c
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_union
id|iocpar
(brace
r_char
id|name
(braket
l_int|10
)braket
suffix:semicolon
r_char
id|bname
(braket
l_int|22
)braket
suffix:semicolon
id|isdn_ioctl_struct
id|iocts
suffix:semicolon
id|isdn_net_ioctl_phone
id|phone
suffix:semicolon
id|isdn_net_ioctl_cfg
id|cfg
suffix:semicolon
)brace
id|iocpar
suffix:semicolon
DECL|macro|name
mdefine_line|#define name  iocpar.name
DECL|macro|bname
mdefine_line|#define bname iocpar.bname
DECL|macro|iocts
mdefine_line|#define iocts iocpar.iocts
DECL|macro|phone
mdefine_line|#define phone iocpar.phone
DECL|macro|cfg
mdefine_line|#define cfg   iocpar.cfg
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCGETDVR
suffix:colon
r_return
(paren
id|TTY_DV
op_plus
(paren
id|NET_DV
op_lshift
l_int|8
)paren
op_plus
(paren
id|INF_DV
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_case
id|IIOCGETCPS
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
id|ulong
op_star
id|p
op_assign
(paren
id|ulong
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ulong
)paren
op_star
id|ISDN_MAX_CHANNELS
op_star
l_int|2
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|put_user
c_func
(paren
id|dev-&gt;ibytes
(braket
id|i
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|dev-&gt;obytes
(braket
id|i
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drivers
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|running
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
macro_line|#ifdef CONFIG_NETDEVICES
r_case
id|IIOCNETAIF
suffix:colon
multiline_comment|/* Add a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|s
op_assign
id|name
suffix:semicolon
)brace
r_else
id|s
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|isdn_net_new
c_func
(paren
id|s
comma
l_int|NULL
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
id|s
comma
id|strlen
c_func
(paren
id|s
)paren
op_plus
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|IIOCNETASL
suffix:colon
multiline_comment|/* Add a slave to a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|bname
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bname
)paren
op_minus
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|isdn_net_newslave
c_func
(paren
id|bname
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
id|s
comma
id|strlen
c_func
(paren
id|s
)paren
op_plus
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|IIOCNETDIF
suffix:colon
multiline_comment|/* Delete a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_rm
c_func
(paren
id|name
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETSCF
suffix:colon
multiline_comment|/* Set configurable parameters of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_setcfg
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETGCF
suffix:colon
multiline_comment|/* Get configurable parameters of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ret
op_assign
id|isdn_net_getcfg
c_func
(paren
op_amp
id|cfg
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETANM
suffix:colon
multiline_comment|/* Add a phone-number to a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_addphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETGNM
suffix:colon
multiline_comment|/* Get list of phone-numbers of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_getphones
c_func
(paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETDNM
suffix:colon
multiline_comment|/* Delete a phone-number of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_delphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCNETDIL
suffix:colon
multiline_comment|/* Force dialing of a network-interface */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_force_dial
c_func
(paren
id|name
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_case
id|IIOCNETALN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_ppp_dial_slave
c_func
(paren
id|name
)paren
suffix:semicolon
r_case
id|IIOCNETDLN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_ppp_hangup_slave
c_func
(paren
id|name
)paren
suffix:semicolon
macro_line|#endif
r_case
id|IIOCNETHUP
suffix:colon
multiline_comment|/* Force hangup of a network-interface */
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
id|isdn_net_force_hangup
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif                          /* CONFIG_NETDEVICES */
r_case
id|IIOCSETVER
suffix:colon
id|dev-&gt;net_verbose
op_assign
id|arg
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Verbose-Level is %d&bslash;n&quot;
comma
id|dev-&gt;net_verbose
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETGST
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
id|dev-&gt;global_flags
op_or_assign
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
r_else
id|dev-&gt;global_flags
op_and_assign
op_complement
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Global Mode %s&bslash;n&quot;
comma
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
ques
c_cond
l_string|&quot;stopped&quot;
suffix:colon
l_string|&quot;running&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETBRJ
suffix:colon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|iocts.drvid
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|reject_bus
op_assign
id|iocts.arg
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCGETSET
suffix:colon
multiline_comment|/* Get complete setup (all network-interfaces and profile-&n;&t;&t;&t;&t;   settings of all tty-devices */
r_if
c_cond
(paren
id|arg
)paren
r_return
(paren
id|isdn_get_allcfg
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
)paren
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETSET
suffix:colon
multiline_comment|/* Set complete setup (all network-interfaces and profile-&n;&t;&t;&t;&t;   settings of all tty-devices */
r_if
c_cond
(paren
id|arg
)paren
r_return
(paren
id|isdn_set_allcfg
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
)paren
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSIGPRF
suffix:colon
id|dev-&gt;profd
op_assign
id|current
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCGETPRF
suffix:colon
multiline_comment|/* Get all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_ANZREG
op_plus
id|ISDN_MSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|ISDN_MODEM_ANZREG
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_ANZREG
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|ISDN_MSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
)brace
r_return
(paren
id|ISDN_MODEM_ANZREG
op_plus
id|ISDN_MSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETPRF
suffix:colon
multiline_comment|/* Set all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_ANZREG
op_plus
id|ISDN_MSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|p
comma
id|ISDN_MODEM_ANZREG
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_ANZREG
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|p
comma
id|ISDN_MSNLEN
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETMAP
suffix:colon
r_case
id|IIOCGETMAP
suffix:colon
multiline_comment|/* Set/Get MSN-&gt;EAZ-Mapping for a driver */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|drvidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|IIOCSETMAP
)paren
(brace
r_int
id|loop
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loop
)paren
(brace
r_int
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|p
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|GET_USER
c_func
(paren
id|bname
(braket
id|j
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bname
(braket
id|j
)braket
)paren
(brace
r_case
l_char|&squot;&bslash;0&squot;
suffix:colon
id|loop
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_char|&squot;,&squot;
suffix:colon
id|bname
(braket
id|j
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
comma
id|bname
)paren
suffix:semicolon
id|j
op_assign
id|ISDN_MSNLEN
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|j
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_ge
id|ISDN_MSNLEN
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|i
OG
l_int|9
)paren
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|bname
comma
l_string|&quot;%s%s&quot;
comma
id|strlen
c_func
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
)paren
ques
c_cond
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
suffix:colon
l_string|&quot;-&quot;
comma
(paren
id|i
OL
l_int|9
)paren
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&bslash;0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_to_user
c_func
(paren
id|p
comma
id|bname
comma
id|strlen
c_func
(paren
id|bname
)paren
op_plus
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|bname
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCDBGVAR
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|dev
comma
r_sizeof
(paren
id|ulong
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_amp
id|IIOCDRVCTL
)paren
op_eq
id|IIOCDRVCTL
)paren
id|cmd
op_assign
(paren
(paren
id|cmd
op_rshift
id|_IOC_NRSHIFT
)paren
op_amp
id|_IOC_NRMASK
)paren
op_amp
id|ISDN_DRVIOCTL_MASK
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|iocts.drvid
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|iocts.drvid
)paren
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|drvidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_IOCTL
suffix:semicolon
id|c.arg
op_assign
id|cmd
suffix:semicolon
id|memcpy
c_func
(paren
id|c.parm.num
comma
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
id|c.parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|iocts
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
r_return
(paren
id|isdn_ppp_ioctl
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|file
comma
id|cmd
comma
id|arg
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
DECL|macro|name
macro_line|#undef name
DECL|macro|bname
macro_line|#undef bname
DECL|macro|iocts
macro_line|#undef iocts
DECL|macro|phone
macro_line|#undef phone
DECL|macro|cfg
macro_line|#undef cfg
)brace
multiline_comment|/*&n; * Open the device code.&n; * MOD_INC_USE_COUNT make sure that the driver memory is not freed&n; * while the device is in use.&n; */
r_static
r_int
DECL|function|isdn_open
id|isdn_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|ino-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|chidx
suffix:semicolon
id|isdn_ctrl
id|c
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|infostruct
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
(paren
id|infostruct
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|infostruct
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|p-&gt;next
op_assign
(paren
r_char
op_star
)paren
id|dev-&gt;infochain
suffix:semicolon
id|p
op_member_access_from_pointer
r_private
op_assign
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
suffix:semicolon
id|dev-&gt;infochain
op_assign
id|p
suffix:semicolon
multiline_comment|/* At opening we allow a single update */
id|filep-&gt;private_data
op_assign
(paren
r_char
op_star
)paren
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;channels
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|chidx
op_assign
id|isdn_minor2chan
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|running
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_amp
(paren
l_int|1
op_lshift
id|chidx
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ret
op_assign
id|isdn_ppp_open
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|filep
)paren
)paren
)paren
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
id|CLOSETYPE
DECL|function|isdn_close
id|isdn_close
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|uint
id|minor
op_assign
id|MINOR
c_func
(paren
id|ino-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
id|isdn_ctrl
id|c
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
id|infostruct
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p
op_member_access_from_pointer
r_private
op_eq
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
)paren
(brace
r_if
c_cond
(paren
id|q
)paren
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
r_else
id|dev-&gt;infochain
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
id|CLOSEVAL
suffix:semicolon
)brace
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: No private data while closing isdnctrl&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|CLOSEVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
OL
id|ISDN_MINOR_CTRL
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
id|CLOSEVAL
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
r_return
id|CLOSEVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
(brace
id|drvidx
op_assign
id|isdn_minor2drv
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
OL
l_int|0
)paren
r_return
id|CLOSEVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;profd
op_eq
id|current
)paren
id|dev-&gt;profd
op_assign
l_int|NULL
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|c
)paren
suffix:semicolon
r_return
id|CLOSEVAL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
id|isdn_ppp_release
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_PPP
comma
id|filep
)paren
suffix:semicolon
macro_line|#endif
r_return
id|CLOSEVAL
suffix:semicolon
)brace
DECL|variable|isdn_fops
r_static
r_struct
id|file_operations
id|isdn_fops
op_assign
(brace
id|isdn_lseek
comma
id|isdn_read
comma
id|isdn_write
comma
l_int|NULL
comma
multiline_comment|/* isdn_readdir */
macro_line|#if (LINUX_VERSION_CODE &lt; 0x020117)
id|isdn_select
comma
multiline_comment|/* isdn_select */
macro_line|#else
id|isdn_poll
comma
multiline_comment|/* isdn_poll */
macro_line|#endif
id|isdn_ioctl
comma
multiline_comment|/* isdn_ioctl */
l_int|NULL
comma
multiline_comment|/* isdn_mmap */
id|isdn_open
comma
id|isdn_close
comma
l_int|NULL
multiline_comment|/* fsync */
)brace
suffix:semicolon
r_char
op_star
DECL|function|isdn_map_eaz2msn
id|isdn_map_eaz2msn
c_func
(paren
r_char
op_star
id|msn
comma
r_int
id|di
)paren
(brace
id|driver
op_star
id|this
op_assign
id|dev-&gt;drv
(braket
id|di
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|msn
)paren
op_eq
l_int|1
)paren
(brace
id|i
op_assign
id|msn
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ge
l_int|0
)paren
op_logical_and
(paren
id|i
op_le
l_int|9
)paren
)paren
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
)paren
r_return
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
(paren
id|msn
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an unused ISDN-channel, whose feature-flags match the&n; * given L2- and L3-protocols.&n; */
r_int
DECL|function|isdn_get_free_channel
id|isdn_get_free_channel
c_func
(paren
r_int
id|usage
comma
r_int
id|l2_proto
comma
r_int
id|l3_proto
comma
r_int
id|pre_dev
comma
r_int
id|pre_chan
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|ulong
id|features
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|features
op_assign
(paren
l_int|1
op_lshift
id|l2_proto
)paren
op_or
(paren
l_int|0x100
op_lshift
id|l3_proto
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|USG_NONE
c_func
(paren
id|dev-&gt;usage
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_ne
op_minus
l_int|1
)paren
)paren
(brace
r_int
id|d
op_assign
id|dev-&gt;drvmap
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;usage
(braket
id|i
)braket
op_amp
id|ISDN_USAGE_EXCLUSIVE
)paren
op_logical_and
(paren
(paren
id|pre_dev
op_ne
id|d
)paren
op_logical_or
(paren
id|pre_chan
op_ne
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|running
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|features
)paren
op_eq
id|features
)paren
(brace
r_if
c_cond
(paren
(paren
id|pre_dev
OL
l_int|0
)paren
op_logical_or
(paren
id|pre_chan
OL
l_int|0
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|dev-&gt;usage
(braket
id|i
)braket
op_or_assign
id|usage
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|d
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|pre_dev
op_eq
id|d
)paren
op_logical_and
(paren
id|pre_chan
op_eq
id|dev-&gt;chanmap
(braket
id|i
)braket
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|dev-&gt;usage
(braket
id|i
)braket
op_or_assign
id|usage
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|d
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_LOCK
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|d
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Set state of ISDN-channel to &squot;unused&squot;&n; */
r_void
DECL|function|isdn_free_channel
id|isdn_free_channel
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_int
id|usage
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
(paren
id|dev-&gt;usage
(braket
id|i
)braket
op_amp
id|ISDN_USAGE_MASK
)paren
op_eq
id|usage
)paren
op_logical_and
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
op_logical_and
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
(paren
id|ISDN_USAGE_NONE
op_or
id|ISDN_USAGE_EXCLUSIVE
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;num
(braket
id|i
)braket
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
id|dev-&gt;ibytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;obytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|isdn_free_queue
c_func
(paren
op_amp
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|rpqueue
(braket
id|ch
)braket
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|ch
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_UNLOCK
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
(paren
r_void
)paren
id|dev-&gt;drv
(braket
id|di
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Cancel Exclusive-Flag for ISDN-channel&n; */
r_void
DECL|function|isdn_unexclusive_channel
id|isdn_unexclusive_channel
c_func
(paren
r_int
id|di
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|dev-&gt;drvmap
(braket
id|i
)braket
op_eq
id|di
)paren
op_logical_and
(paren
id|dev-&gt;chanmap
(braket
id|i
)braket
op_eq
id|ch
)paren
)paren
(brace
id|dev-&gt;usage
(braket
id|i
)braket
op_and_assign
op_complement
id|ISDN_USAGE_EXCLUSIVE
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * receive callback handler for drivers not supporting sk_buff&squot;s.&n; * Parameters:&n; *&n; * di      = Driver-Index.&n; * channel = Number of B-Channel (0...)&n; * buf     = pointer to packet-data&n; * len     = Length of packet-data&n; *&n; */
r_static
r_void
DECL|function|isdn_receive_callback
id|isdn_receive_callback
c_func
(paren
r_int
id|drvidx
comma
r_int
id|chan
comma
id|u_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|isdn_receive_skb_callback
c_func
(paren
id|drvidx
comma
id|chan
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: rcv alloc_skb failed, packet dropped.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  writebuf replacement for SKB_ABLE drivers&n; */
r_static
r_int
DECL|function|isdn_writebuf_stub
id|isdn_writebuf_stub
c_func
(paren
r_int
id|drvidx
comma
r_int
id|chan
comma
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;writebuf
)paren
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf
c_func
(paren
id|drvidx
comma
id|chan
comma
id|buf
comma
id|len
comma
id|user
)paren
suffix:semicolon
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
op_plus
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
)paren
suffix:semicolon
id|SET_SKB_FREE
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_le
l_int|0
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|dev-&gt;obytes
(braket
id|isdn_dc2minor
c_func
(paren
id|drvidx
comma
id|chan
)paren
)braket
op_add_assign
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * writebuf_skb replacement for NON SKB_ABLE drivers&n; * If lowlevel-device does not support supports skbufs, use&n; * standard send-routine, else sind directly.&n; *&n; * Return: length of data on success, -ERRcode on failure.&n; */
r_int
DECL|function|isdn_writebuf_skb_stub
id|isdn_writebuf_skb_stub
c_func
(paren
r_int
id|drvidx
comma
r_int
id|chan
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* skb pointer no longer valid after free */
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;writebuf_skb
)paren
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|drvidx
comma
id|chan
comma
id|skb
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf
c_func
(paren
id|drvidx
comma
id|chan
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|0
)paren
)paren
op_eq
id|len
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|dev-&gt;obytes
(braket
id|isdn_dc2minor
c_func
(paren
id|drvidx
comma
id|chan
)paren
)braket
op_add_assign
id|len
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Low-level-driver registration&n; */
r_int
DECL|function|register_isdn
id|register_isdn
c_func
(paren
id|isdn_if
op_star
id|i
)paren
(brace
id|driver
op_star
id|d
suffix:semicolon
r_int
id|n
comma
id|j
comma
id|k
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drivers
op_ge
id|ISDN_MAX_DRIVERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Max. %d drivers supported&bslash;n&quot;
comma
id|ISDN_MAX_DRIVERS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|n
op_assign
id|i-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;channels
op_plus
id|n
OG
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Max. %d channels supported&bslash;n&quot;
comma
id|ISDN_MAX_CHANNELS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|i-&gt;writebuf_skb
)paren
op_logical_and
(paren
op_logical_neg
id|i-&gt;writebuf
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: No write routine given.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d
op_assign
(paren
id|driver
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|driver
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc driver-struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d
comma
l_int|0
comma
r_sizeof
(paren
id|driver
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rcverr
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcverr&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;rcverr
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
op_star
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rcvcount
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcvcount&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;rcvcount
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
op_star
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rpqueue
op_assign
(paren
r_struct
id|sk_buff_head
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sk_buff_head
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rpqueue&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
(brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|d-&gt;rpqueue
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;rcv_waitq
op_assign
(paren
r_struct
id|wait_queue
op_star
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|wait_queue
op_star
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc rcv_waitq&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rpqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;rcv_waitq
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|wait_queue
op_star
)paren
op_star
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;snd_waitq
op_assign
(paren
r_struct
id|wait_queue
op_star
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|wait_queue
op_star
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Could not alloc snd_waitq&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcv_waitq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rpqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcvcount
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;rcverr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d-&gt;snd_waitq
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|wait_queue
op_star
)paren
op_star
id|n
)paren
suffix:semicolon
id|d-&gt;channels
op_assign
id|n
suffix:semicolon
id|d-&gt;loaded
op_assign
l_int|1
suffix:semicolon
id|d-&gt;maxbufsize
op_assign
id|i-&gt;maxbufsize
suffix:semicolon
id|d-&gt;pktcount
op_assign
l_int|0
suffix:semicolon
id|d-&gt;stavail
op_assign
l_int|0
suffix:semicolon
id|d-&gt;running
op_assign
l_int|0
suffix:semicolon
id|d-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|d-&gt;interface
op_assign
id|i
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;drv
(braket
id|drvidx
)braket
)paren
r_break
suffix:semicolon
id|i-&gt;channels
op_assign
id|drvidx
suffix:semicolon
id|i-&gt;rcvcallb_skb
op_assign
id|isdn_receive_skb_callback
suffix:semicolon
id|i-&gt;rcvcallb
op_assign
id|isdn_receive_callback
suffix:semicolon
id|i-&gt;statcallb
op_assign
id|isdn_status_callback
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|i-&gt;id
)paren
)paren
id|sprintf
c_func
(paren
id|i-&gt;id
comma
l_string|&quot;line%d&quot;
comma
id|drvidx
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|drvidx
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|i-&gt;id
comma
id|dev-&gt;drvid
(braket
id|j
)braket
)paren
)paren
id|sprintf
c_func
(paren
id|i-&gt;id
comma
l_string|&quot;line%d&quot;
comma
id|drvidx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;chanmap
(braket
id|k
)braket
OL
l_int|0
)paren
(brace
id|dev-&gt;chanmap
(braket
id|k
)braket
op_assign
id|j
suffix:semicolon
id|dev-&gt;drvmap
(braket
id|k
)braket
op_assign
id|drvidx
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dev-&gt;drv
(braket
id|drvidx
)braket
op_assign
id|d
suffix:semicolon
id|dev-&gt;channels
op_add_assign
id|n
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;drvid
(braket
id|drvidx
)braket
comma
id|i-&gt;id
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;drivers
op_increment
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; * And now the modules code.&n; *****************************************************************************&n; */
r_extern
r_int
id|printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|isdn_init
mdefine_line|#define isdn_init init_module
macro_line|#endif
r_static
r_char
op_star
DECL|function|isdn_getrev
id|isdn_getrev
c_func
(paren
r_const
r_char
op_star
id|revision
)paren
(brace
r_char
op_star
id|rev
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|rev
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
op_decrement
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|rev
op_assign
l_string|&quot;???&quot;
suffix:semicolon
r_return
id|rev
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate and initialize all data, register modem-devices&n; */
r_int
DECL|function|isdn_init
id|isdn_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|irev
(braket
l_int|50
)braket
suffix:semicolon
r_char
id|trev
(braket
l_int|50
)braket
suffix:semicolon
r_char
id|nrev
(braket
l_int|50
)braket
suffix:semicolon
r_char
id|prev
(braket
l_int|50
)braket
suffix:semicolon
r_char
id|arev
(braket
l_int|50
)braket
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
(paren
id|isdn_dev
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|isdn_dev
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not allocate device-struct.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
id|isdn_dev
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|dev-&gt;timer.function
op_assign
id|isdn_timer_funct
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;drvmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;chanmap
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;m_idx
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;num
(braket
id|i
)braket
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
comma
op_amp
id|isdn_fops
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register control devices&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_assign
id|isdn_tty_modem_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register tty devices&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|3
)paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_le
op_minus
l_int|2
)paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_if
c_cond
(paren
id|isdn_ppp_init
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not create PPP-device-structs&bslash;n&quot;
)paren
suffix:semicolon
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
suffix:semicolon
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|xmit_buf
op_minus
l_int|4
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#endif                          /* CONFIG_ISDN_PPP */
id|isdn_export_syms
c_func
(paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|irev
comma
id|isdn_revision
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|trev
comma
id|isdn_tty_revision
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|nrev
comma
id|isdn_net_revision
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|prev
comma
id|isdn_ppp_revision
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|arev
comma
id|isdn_audio_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ISDN subsystem Rev: %s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|irev
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|trev
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|nrev
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|isdn_getrev
c_func
(paren
id|prev
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|isdn_getrev
c_func
(paren
id|arev
)paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|printk
c_func
(paren
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|isdn_cards_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/*&n; * Unload module&n; */
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
id|isdn_ppp_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_rmall
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: net-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.tty_modem
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: ttyI-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tty_unregister_driver
c_func
(paren
op_amp
id|dev-&gt;mdm.cua_modem
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: cui-device busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|isdn_tty_cleanup_xmit
c_func
(paren
op_amp
id|dev-&gt;mdm.info
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;mdm.info
(braket
id|i
)braket
dot
id|xmit_buf
op_minus
l_int|4
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: controldevice busy, remove cancelled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|del_timer
c_func
(paren
op_amp
id|dev-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ISDN-subsystem unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
