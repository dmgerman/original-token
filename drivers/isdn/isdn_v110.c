multiline_comment|/* $Id: isdn_v110.c,v 1.5 2000/05/11 22:29:21 kai Exp $&n;&n; * Linux ISDN subsystem, V.110 related functions (linklevel).&n; *&n; * Copyright by Thomas Pfeiffer (pfeiffer@pds.de)&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; */
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &quot;isdn_v110.h&quot;
DECL|macro|ISDN_V110_DEBUG
macro_line|#undef ISDN_V110_DEBUG
DECL|variable|isdn_v110_revision
r_char
op_star
id|isdn_v110_revision
op_assign
l_string|&quot;$Revision: 1.5 $&quot;
suffix:semicolon
DECL|macro|V110_38400
mdefine_line|#define V110_38400 255
DECL|macro|V110_19200
mdefine_line|#define V110_19200  15
DECL|macro|V110_9600
mdefine_line|#define V110_9600    3
multiline_comment|/* &n; * The following data are precoded matrices, online and offline matrix &n; * for 9600, 19200 und 38400, respectively&n; */
DECL|variable|V110_OnMatrix_9600
r_static
r_int
r_char
id|V110_OnMatrix_9600
(braket
)braket
op_assign
(brace
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
)brace
suffix:semicolon
DECL|variable|V110_OffMatrix_9600
r_static
r_int
r_char
id|V110_OffMatrix_9600
(braket
)braket
op_assign
(brace
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|V110_OnMatrix_19200
r_static
r_int
r_char
id|V110_OnMatrix_19200
(braket
)braket
op_assign
(brace
l_int|0xf0
comma
l_int|0xf0
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xf7
)brace
suffix:semicolon
DECL|variable|V110_OffMatrix_19200
r_static
r_int
r_char
id|V110_OffMatrix_19200
(braket
)braket
op_assign
(brace
l_int|0xf0
comma
l_int|0xf0
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|V110_OnMatrix_38400
r_static
r_int
r_char
id|V110_OnMatrix_38400
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x7f
comma
l_int|0x7f
comma
l_int|0x7f
comma
l_int|0x7f
comma
l_int|0xfd
comma
l_int|0x7f
comma
l_int|0x7f
comma
l_int|0x7f
comma
l_int|0x7f
)brace
suffix:semicolon
DECL|variable|V110_OffMatrix_38400
r_static
r_int
r_char
id|V110_OffMatrix_38400
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfd
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/* &n; * FlipBits reorders sequences of keylen bits in one byte.&n; * E.g. source order 7654321 will be converted to 45670123 when keylen = 4,&n; * and to 67452301 when keylen = 2. This is necessary because ordering on&n; * the isdn line is the the other way.&n; */
r_static
id|__inline
r_int
r_char
DECL|function|FlipBits
id|FlipBits
c_func
(paren
r_int
r_char
id|c
comma
r_int
id|keylen
)paren
(brace
r_int
r_char
id|b
op_assign
id|c
suffix:semicolon
r_int
r_char
id|bit
op_assign
l_int|128
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|hunks
op_assign
(paren
l_int|8
op_div
id|keylen
)paren
suffix:semicolon
id|c
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hunks
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|keylen
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|b
op_amp
(paren
id|bit
op_rshift
id|j
)paren
)paren
id|c
op_or_assign
id|bit
op_rshift
(paren
id|keylen
op_minus
id|j
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|bit
op_rshift_assign
id|keylen
suffix:semicolon
)brace
r_return
id|c
suffix:semicolon
)brace
multiline_comment|/* isdn_v110_open allocates and initializes private V.110 data&n; * structures and returns a pointer to these.&n; */
r_static
id|isdn_v110_stream
op_star
DECL|function|isdn_v110_open
id|isdn_v110_open
c_func
(paren
r_int
r_char
id|key
comma
r_int
id|hdrlen
comma
r_int
id|maxsize
)paren
(brace
r_int
id|i
suffix:semicolon
id|isdn_v110_stream
op_star
id|v
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|isdn_v110_stream
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|v
comma
l_int|0
comma
r_sizeof
(paren
id|isdn_v110_stream
)paren
)paren
suffix:semicolon
id|v-&gt;key
op_assign
id|key
suffix:semicolon
id|v-&gt;nbits
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|key
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
id|i
op_increment
)paren
id|v-&gt;nbits
op_increment
suffix:semicolon
id|v-&gt;nbytes
op_assign
l_int|8
op_div
id|v-&gt;nbits
suffix:semicolon
id|v-&gt;decodelen
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|key
)paren
(brace
r_case
id|V110_38400
suffix:colon
id|v-&gt;OnlineFrame
op_assign
id|V110_OnMatrix_38400
suffix:semicolon
id|v-&gt;OfflineFrame
op_assign
id|V110_OffMatrix_38400
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V110_19200
suffix:colon
id|v-&gt;OnlineFrame
op_assign
id|V110_OnMatrix_19200
suffix:semicolon
id|v-&gt;OfflineFrame
op_assign
id|V110_OffMatrix_19200
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|v-&gt;OnlineFrame
op_assign
id|V110_OnMatrix_9600
suffix:semicolon
id|v-&gt;OfflineFrame
op_assign
id|V110_OffMatrix_9600
suffix:semicolon
r_break
suffix:semicolon
)brace
id|v-&gt;framelen
op_assign
id|v-&gt;nbytes
op_star
l_int|10
suffix:semicolon
id|v-&gt;SyncInit
op_assign
l_int|5
suffix:semicolon
id|v-&gt;introducer
op_assign
l_int|0
suffix:semicolon
id|v-&gt;dbit
op_assign
l_int|1
suffix:semicolon
id|v-&gt;b
op_assign
l_int|0
suffix:semicolon
id|v-&gt;skbres
op_assign
id|hdrlen
suffix:semicolon
id|v-&gt;maxsize
op_assign
id|maxsize
op_minus
id|hdrlen
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v-&gt;encodebuf
op_assign
id|kmalloc
c_func
(paren
id|maxsize
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|v
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|v
suffix:semicolon
)brace
multiline_comment|/* isdn_v110_close frees private V.110 data structures */
r_void
DECL|function|isdn_v110_close
id|isdn_v110_close
c_func
(paren
id|isdn_v110_stream
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
macro_line|#ifdef ISDN_V110_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;v110 close&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|v-&gt;encodebuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|v
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * ValidHeaderBytes return the number of valid bytes in v-&gt;decodebuf &n; */
r_static
r_int
DECL|function|ValidHeaderBytes
id|ValidHeaderBytes
c_func
(paren
id|isdn_v110_stream
op_star
id|v
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|v-&gt;decodelen
)paren
op_logical_and
(paren
id|i
OL
id|v-&gt;nbytes
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|v-&gt;decodebuf
(braket
id|i
)braket
op_amp
id|v-&gt;key
)paren
op_ne
l_int|0
)paren
r_break
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/* &n; * SyncHeader moves the decodebuf ptr to the next valid header &n; */
r_static
r_void
DECL|function|SyncHeader
id|SyncHeader
c_func
(paren
id|isdn_v110_stream
op_star
id|v
)paren
(brace
r_int
r_char
op_star
id|rbuf
op_assign
id|v-&gt;decodebuf
suffix:semicolon
r_int
id|len
op_assign
id|v-&gt;decodelen
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|rbuf
op_increment
comma
id|len
op_decrement
suffix:semicolon
id|len
OG
l_int|0
suffix:semicolon
id|len
op_decrement
comma
id|rbuf
op_increment
)paren
multiline_comment|/* such den SyncHeader in buf ! */
r_if
c_cond
(paren
(paren
op_star
id|rbuf
op_amp
id|v-&gt;key
)paren
op_eq
l_int|0
)paren
multiline_comment|/* erstes byte gefunden ?       */
r_break
suffix:semicolon
multiline_comment|/* jupp!                        */
r_if
c_cond
(paren
id|len
)paren
id|memcpy
c_func
(paren
id|v-&gt;decodebuf
comma
id|rbuf
comma
id|len
)paren
suffix:semicolon
id|v-&gt;decodelen
op_assign
id|len
suffix:semicolon
macro_line|#ifdef ISDN_V110_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_v110: Header resync&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* DecodeMatrix takes n (n&gt;=1) matrices (v110 frames, 10 bytes) where&n;   len is the number of matrix-lines. len must be a multiple of 10, i.e.&n;   only complete matices must be given.&n;   From these, netto data is extracted and returned in buf. The return-value&n;   is the bytecount of the decoded data.&n; */
r_static
r_int
DECL|function|DecodeMatrix
id|DecodeMatrix
c_func
(paren
id|isdn_v110_stream
op_star
id|v
comma
r_int
r_char
op_star
id|m
comma
r_int
id|len
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
id|line
op_assign
l_int|0
suffix:semicolon
r_int
id|buflen
op_assign
l_int|0
suffix:semicolon
r_int
id|mbit
op_assign
l_int|64
suffix:semicolon
r_int
id|introducer
op_assign
id|v-&gt;introducer
suffix:semicolon
r_int
id|dbit
op_assign
id|v-&gt;dbit
suffix:semicolon
r_int
r_char
id|b
op_assign
id|v-&gt;b
suffix:semicolon
r_while
c_loop
(paren
id|line
OL
id|len
)paren
(brace
multiline_comment|/* Are we done with all lines of the matrix? */
r_if
c_cond
(paren
(paren
id|line
op_mod
l_int|10
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* the 0. line of the matrix is always 0 ! */
r_if
c_cond
(paren
id|m
(braket
id|line
)braket
op_ne
l_int|0x00
)paren
(brace
multiline_comment|/* not 0 ? -&gt; error! */
macro_line|#ifdef ISDN_V110_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_v110: DecodeMatrix, V110 Bad Header&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* returning now is not the right thing, though :-( */
macro_line|#endif
)brace
id|line
op_increment
suffix:semicolon
multiline_comment|/* next line of matrix */
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|line
op_mod
l_int|10
)paren
op_eq
l_int|5
)paren
(brace
multiline_comment|/* in line 5 there&squot;s only e-bits ! */
r_if
c_cond
(paren
(paren
id|m
(braket
id|line
)braket
op_amp
l_int|0x70
)paren
op_ne
l_int|0x30
)paren
(brace
multiline_comment|/* 011 has to be at the beginning! */
macro_line|#ifdef ISDN_V110_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_v110: DecodeMatrix, V110 Bad 5th line&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* returning now is not the right thing, though :-( */
macro_line|#endif
)brace
id|line
op_increment
suffix:semicolon
multiline_comment|/* next line */
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|introducer
)paren
(brace
multiline_comment|/* every byte starts with 10 (stopbit, startbit) */
id|introducer
op_assign
(paren
id|m
(braket
id|line
)braket
op_amp
id|mbit
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* current bit of the matrix */
id|next_byte
suffix:colon
r_if
c_cond
(paren
id|mbit
OG
l_int|2
)paren
(brace
multiline_comment|/* was it the last bit in this line ? */
id|mbit
op_rshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* no -&gt; take next */
r_continue
suffix:semicolon
)brace
multiline_comment|/* otherwise start with leftmost bit in the next line */
id|mbit
op_assign
l_int|64
suffix:semicolon
id|line
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* otherwise we need to set a data bit */
r_if
c_cond
(paren
id|m
(braket
id|line
)braket
op_amp
id|mbit
)paren
multiline_comment|/* was that bit set in the matrix ? */
id|b
op_or_assign
id|dbit
suffix:semicolon
multiline_comment|/* yes -&gt; set it in the data byte */
r_else
id|b
op_and_assign
id|dbit
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* no -&gt; clear it in the data byte */
r_if
c_cond
(paren
id|dbit
OL
l_int|128
)paren
multiline_comment|/* is that data byte done ? */
id|dbit
op_lshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* no, got the next bit */
r_else
(brace
multiline_comment|/* data byte is done */
id|buf
(braket
id|buflen
op_increment
)braket
op_assign
id|b
suffix:semicolon
multiline_comment|/* copy byte into the output buffer */
id|introducer
op_assign
id|b
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* init of the intro sequence and of the data byte */
id|dbit
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* next we look for the 0th bit */
)brace
r_goto
id|next_byte
suffix:semicolon
multiline_comment|/* look for next bit in the matrix */
)brace
)brace
id|v-&gt;introducer
op_assign
id|introducer
suffix:semicolon
id|v-&gt;dbit
op_assign
id|dbit
suffix:semicolon
id|v-&gt;b
op_assign
id|b
suffix:semicolon
r_return
id|buflen
suffix:semicolon
multiline_comment|/* return number of bytes in the output buffer */
)brace
multiline_comment|/* &n; * DecodeStream receives V.110 coded data from the input stream. It recovers the &n; * original frames.&n; * The input stream doesn&squot;t need to be framed&n; */
r_struct
id|sk_buff
op_star
DECL|function|isdn_v110_decode
id|isdn_v110_decode
c_func
(paren
id|isdn_v110_stream
op_star
id|v
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
r_char
op_star
id|v110_buf
suffix:semicolon
r_int
r_char
op_star
id|rbuf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_decode called with NULL skb!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|rbuf
op_assign
id|skb-&gt;data
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* invalid handle, no chance to proceed */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_decode called with NULL stream!&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v-&gt;decodelen
op_eq
l_int|0
)paren
multiline_comment|/* cache empty?               */
r_for
c_loop
(paren
suffix:semicolon
id|len
OG
l_int|0
suffix:semicolon
id|len
op_decrement
comma
id|rbuf
op_increment
)paren
multiline_comment|/* scan for SyncHeader in buf */
r_if
c_cond
(paren
(paren
op_star
id|rbuf
op_amp
id|v-&gt;key
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* found first byte           */
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* copy new data to decode-buffer */
id|memcpy
c_func
(paren
op_amp
(paren
id|v-&gt;decodebuf
(braket
id|v-&gt;decodelen
)braket
)paren
comma
id|rbuf
comma
id|len
)paren
suffix:semicolon
id|v-&gt;decodelen
op_add_assign
id|len
suffix:semicolon
id|ReSync
suffix:colon
r_if
c_cond
(paren
id|v-&gt;decodelen
OL
id|v-&gt;nbytes
)paren
(brace
multiline_comment|/* got a new header ? */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* no, try later      */
)brace
r_if
c_cond
(paren
id|ValidHeaderBytes
c_func
(paren
id|v
)paren
op_ne
id|v-&gt;nbytes
)paren
(brace
multiline_comment|/* is that a valid header? */
id|SyncHeader
c_func
(paren
id|v
)paren
suffix:semicolon
multiline_comment|/* no -&gt; look for header */
r_goto
id|ReSync
suffix:semicolon
)brace
id|len
op_assign
(paren
id|v-&gt;decodelen
op_minus
(paren
id|v-&gt;decodelen
op_mod
(paren
l_int|10
op_star
id|v-&gt;nbytes
)paren
)paren
)paren
op_div
id|v-&gt;nbytes
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v110_buf
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_decode: Couldn&squot;t allocate v110_buf&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|v110_buf
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|v-&gt;nbytes
suffix:semicolon
id|j
op_increment
)paren
id|v110_buf
(braket
id|i
)braket
op_or_assign
(paren
id|v-&gt;decodebuf
(braket
(paren
id|i
op_star
id|v-&gt;nbytes
)paren
op_plus
id|j
)braket
op_amp
id|v-&gt;key
)paren
op_lshift
(paren
l_int|8
op_minus
(paren
(paren
id|j
op_plus
l_int|1
)paren
op_star
id|v-&gt;nbits
)paren
)paren
suffix:semicolon
id|v110_buf
(braket
id|i
)braket
op_assign
id|FlipBits
c_func
(paren
id|v110_buf
(braket
id|i
)braket
comma
id|v-&gt;nbits
)paren
suffix:semicolon
)brace
id|v-&gt;decodelen
op_assign
(paren
id|v-&gt;decodelen
op_mod
(paren
l_int|10
op_star
id|v-&gt;nbytes
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|v-&gt;decodebuf
comma
op_amp
(paren
id|v-&gt;decodebuf
(braket
id|len
op_star
id|v-&gt;nbytes
)braket
)paren
comma
id|v-&gt;decodelen
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|DecodeMatrix
c_func
(paren
id|v
comma
id|v110_buf
comma
id|len
comma
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|v110_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
)paren
r_return
id|skb
suffix:semicolon
r_else
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* EncodeMatrix takes input data in buf, len is the bytecount.&n;   Data is encoded into v110 frames in m. Return value is the number of&n;   matrix-lines generated.&n; */
r_static
r_int
DECL|function|EncodeMatrix
id|EncodeMatrix
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
r_char
op_star
id|m
comma
r_int
id|mlen
)paren
(brace
r_int
id|line
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|mbit
op_assign
l_int|128
suffix:semicolon
r_int
id|dbit
op_assign
l_int|1
suffix:semicolon
r_int
id|introducer
op_assign
l_int|3
suffix:semicolon
r_int
id|ibit
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
)brace
suffix:semicolon
r_while
c_loop
(paren
(paren
id|i
OL
id|len
)paren
op_logical_and
(paren
id|line
OL
id|mlen
)paren
)paren
(brace
multiline_comment|/* while we still have input data */
r_switch
c_cond
(paren
id|line
op_mod
l_int|10
)paren
(brace
multiline_comment|/* in which line of the matrix are we? */
r_case
l_int|0
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* line 0 is always 0 */
id|mbit
op_assign
l_int|128
suffix:semicolon
multiline_comment|/* go on with the 7th bit */
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xbf
suffix:semicolon
multiline_comment|/* line 5 is always 10111111 */
id|mbit
op_assign
l_int|128
suffix:semicolon
multiline_comment|/* go on with the 7th bit */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line
op_ge
id|mlen
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110 (EncodeMatrix): buffer full!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|line
suffix:semicolon
)brace
id|next_bit
suffix:colon
r_switch
c_cond
(paren
id|mbit
)paren
(brace
multiline_comment|/* leftmost or rightmost bit ? */
r_case
l_int|1
suffix:colon
id|line
op_increment
suffix:semicolon
multiline_comment|/* rightmost -&gt; go to next line */
r_if
c_cond
(paren
id|line
op_ge
id|mlen
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110 (EncodeMatrix): buffer full!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|line
suffix:semicolon
)brace
r_case
l_int|128
suffix:colon
id|m
(braket
id|line
)braket
op_assign
l_int|128
suffix:semicolon
multiline_comment|/* leftmost -&gt; set byte to 1000000 */
id|mbit
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* current bit in the matrix line */
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|introducer
)paren
(brace
multiline_comment|/* set 110 sequence ? */
id|introducer
op_decrement
suffix:semicolon
multiline_comment|/* set on digit less */
id|m
(braket
id|line
)braket
op_or_assign
id|ibit
(braket
id|introducer
)braket
ques
c_cond
id|mbit
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* set corresponding bit */
id|mbit
op_rshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* bit of matrix line  &gt;&gt; 1 */
r_goto
id|next_bit
suffix:semicolon
multiline_comment|/* and go on there */
)brace
multiline_comment|/* else push data bits into the matrix! */
id|m
(braket
id|line
)braket
op_or_assign
(paren
id|buf
(braket
id|i
)braket
op_amp
id|dbit
)paren
ques
c_cond
id|mbit
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* set data bit in matrix */
r_if
c_cond
(paren
id|dbit
op_eq
l_int|128
)paren
(brace
multiline_comment|/* was it the last one? */
id|dbit
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* then go on with first bit of  */
id|i
op_increment
suffix:semicolon
multiline_comment|/* next byte in input buffer */
r_if
c_cond
(paren
id|i
OL
id|len
)paren
multiline_comment|/* input buffer done ? */
id|introducer
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* no, write introducer 110 */
r_else
(brace
multiline_comment|/* input buffer done ! */
id|m
(braket
id|line
)braket
op_or_assign
(paren
id|mbit
op_minus
l_int|1
)paren
op_amp
l_int|0xfe
suffix:semicolon
multiline_comment|/* set remaining bits in line to 1 */
r_break
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* not the last data bit */
id|dbit
op_lshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* then go to next data bit */
id|mbit
op_rshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* go to next bit of matrix */
r_goto
id|next_bit
suffix:semicolon
)brace
multiline_comment|/* if necessary, generate remaining lines of the matrix... */
r_if
c_cond
(paren
(paren
id|line
)paren
op_logical_and
(paren
(paren
id|line
op_plus
l_int|10
)paren
OL
id|mlen
)paren
)paren
r_switch
c_cond
(paren
op_increment
id|line
op_mod
l_int|10
)paren
(brace
r_case
l_int|1
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|2
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|3
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|4
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|5
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xbf
suffix:semicolon
r_case
l_int|6
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|7
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|8
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
r_case
l_int|9
suffix:colon
id|m
(braket
id|line
op_increment
)braket
op_assign
l_int|0xfe
suffix:semicolon
)brace
r_return
id|line
suffix:semicolon
multiline_comment|/* that&squot;s how many lines we have */
)brace
multiline_comment|/*&n; * Build a sync frame.&n; */
r_static
r_struct
id|sk_buff
op_star
DECL|function|isdn_v110_sync
id|isdn_v110_sync
c_func
(paren
id|isdn_v110_stream
op_star
id|v
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* invalid handle, no chance to proceed */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_sync called with NULL stream!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|v-&gt;framelen
op_plus
id|v-&gt;skbres
)paren
)paren
)paren
(brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|v-&gt;skbres
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|v-&gt;framelen
)paren
comma
id|v-&gt;OfflineFrame
comma
id|v-&gt;framelen
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
multiline_comment|/*&n; * Build an idle frame.&n; */
r_static
r_struct
id|sk_buff
op_star
DECL|function|isdn_v110_idle
id|isdn_v110_idle
c_func
(paren
id|isdn_v110_stream
op_star
id|v
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* invalid handle, no chance to proceed */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_sync called with NULL stream!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|v-&gt;framelen
op_plus
id|v-&gt;skbres
)paren
)paren
)paren
(brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|v-&gt;skbres
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|v-&gt;framelen
)paren
comma
id|v-&gt;OnlineFrame
comma
id|v-&gt;framelen
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
r_struct
id|sk_buff
op_star
DECL|function|isdn_v110_encode
id|isdn_v110_encode
c_func
(paren
id|isdn_v110_stream
op_star
id|v
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|rlen
suffix:semicolon
r_int
id|mlen
suffix:semicolon
r_int
id|olen
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|sval1
suffix:semicolon
r_int
id|sval2
suffix:semicolon
r_int
id|nframes
suffix:semicolon
r_int
r_char
op_star
id|v110buf
suffix:semicolon
r_int
r_char
op_star
id|rbuf
suffix:semicolon
r_struct
id|sk_buff
op_star
id|nskb
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* invalid handle, no chance to proceed */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_encode called with NULL stream!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
multiline_comment|/* invalid skb, no chance to proceed */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_encode called with NULL skb!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|rlen
op_assign
id|skb-&gt;len
suffix:semicolon
id|nframes
op_assign
(paren
id|rlen
op_plus
l_int|3
)paren
op_div
l_int|4
suffix:semicolon
id|v110buf
op_assign
id|v-&gt;encodebuf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nframes
op_star
l_int|40
)paren
OG
id|v-&gt;maxsize
)paren
(brace
id|size
op_assign
id|v-&gt;maxsize
suffix:semicolon
id|rlen
op_assign
id|v-&gt;maxsize
op_div
l_int|40
suffix:semicolon
)brace
r_else
id|size
op_assign
id|nframes
op_star
l_int|40
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|nskb
op_assign
id|dev_alloc_skb
c_func
(paren
id|size
op_plus
id|v-&gt;skbres
op_plus
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_encode: Couldn&squot;t alloc skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|nskb
comma
id|v-&gt;skbres
op_plus
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|nskb
comma
id|v-&gt;framelen
)paren
comma
id|v-&gt;OnlineFrame
comma
id|v-&gt;framelen
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
id|skb_push
c_func
(paren
id|nskb
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
op_assign
l_int|0
suffix:semicolon
r_return
id|nskb
suffix:semicolon
)brace
id|mlen
op_assign
id|EncodeMatrix
c_func
(paren
id|skb-&gt;data
comma
id|rlen
comma
id|v110buf
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* now distribute 2 or 4 bits each to the output stream! */
id|rbuf
op_assign
id|skb_put
c_func
(paren
id|nskb
comma
id|size
)paren
suffix:semicolon
id|olen
op_assign
l_int|0
suffix:semicolon
id|sval1
op_assign
l_int|8
op_minus
id|v-&gt;nbits
suffix:semicolon
id|sval2
op_assign
id|v-&gt;key
op_lshift
id|sval1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mlen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|v110buf
(braket
id|i
)braket
op_assign
id|FlipBits
c_func
(paren
id|v110buf
(braket
id|i
)braket
comma
id|v-&gt;nbits
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|v-&gt;nbytes
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|size
op_decrement
)paren
op_star
id|rbuf
op_increment
op_assign
op_complement
id|v-&gt;key
op_or
(paren
(paren
(paren
id|v110buf
(braket
id|i
)braket
op_lshift
(paren
id|j
op_star
id|v-&gt;nbits
)paren
)paren
op_amp
id|sval2
)paren
op_rshift
id|sval1
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110_encode: buffers full!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|buffer_full
suffix:semicolon
)brace
id|olen
op_increment
suffix:semicolon
)brace
)brace
id|buffer_full
suffix:colon
id|skb_trim
c_func
(paren
id|nskb
comma
id|olen
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
id|skb_push
c_func
(paren
id|nskb
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
op_assign
id|rlen
suffix:semicolon
r_return
id|nskb
suffix:semicolon
)brace
r_int
DECL|function|isdn_v110_stat_callback
id|isdn_v110_stat_callback
c_func
(paren
r_int
id|idx
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|isdn_v110_stream
op_star
id|v
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_STAT_BSENT
suffix:colon
multiline_comment|/* Keep the send-queue of the driver filled&n;&t;&t;&t; * with frames:&n;&t;&t;&t; * If number of outstanding frames &lt; 3,&n;&t;&t;&t; * send down an Idle-Frame (or an Sync-Frame, if&n;&t;&t;&t; * v-&gt;SyncInit != 0). &n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|v
op_assign
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;skbidle
OG
l_int|0
)paren
(brace
id|v-&gt;skbidle
op_decrement
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|v-&gt;skbuser
OG
l_int|0
)paren
id|v-&gt;skbuser
op_decrement
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|v-&gt;skbuser
op_plus
id|v-&gt;skbidle
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;SyncInit
OG
l_int|0
)paren
id|skb
op_assign
id|isdn_v110_sync
c_func
(paren
id|v
)paren
suffix:semicolon
r_else
id|skb
op_assign
id|isdn_v110_idle
c_func
(paren
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|c-&gt;driver
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|c-&gt;driver
comma
id|c-&gt;arg
comma
l_int|1
comma
id|skb
)paren
op_le
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|v-&gt;SyncInit
)paren
id|v-&gt;SyncInit
op_decrement
suffix:semicolon
id|v-&gt;skbidle
op_increment
suffix:semicolon
)brace
)brace
r_else
r_break
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
r_case
id|ISDN_STAT_BHUP
suffix:colon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
)paren
(brace
id|isdn_v110_close
c_func
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
suffix:semicolon
id|dev-&gt;v110
(braket
id|idx
)braket
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;v110emu
(braket
id|idx
)braket
op_logical_and
(paren
id|dev-&gt;v110
(braket
id|idx
)braket
op_eq
l_int|NULL
)paren
)paren
(brace
r_int
id|hdrlen
op_assign
id|dev-&gt;drv
(braket
id|c-&gt;driver
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
suffix:semicolon
r_int
id|maxsize
op_assign
id|dev-&gt;drv
(braket
id|c-&gt;driver
)braket
op_member_access_from_pointer
id|interface-&gt;maxbufsize
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;v110emu
(braket
id|idx
)braket
)paren
(brace
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
id|dev-&gt;v110
(braket
id|idx
)braket
op_assign
id|isdn_v110_open
c_func
(paren
id|V110_9600
comma
id|hdrlen
comma
id|maxsize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
id|dev-&gt;v110
(braket
id|idx
)braket
op_assign
id|isdn_v110_open
c_func
(paren
id|V110_19200
comma
id|hdrlen
comma
id|maxsize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
id|dev-&gt;v110
(braket
id|idx
)braket
op_assign
id|isdn_v110_open
c_func
(paren
id|V110_38400
comma
id|hdrlen
comma
id|maxsize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|v
op_assign
id|dev-&gt;v110
(braket
id|idx
)braket
)paren
)paren
(brace
r_while
c_loop
(paren
id|v-&gt;SyncInit
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|isdn_v110_sync
c_func
(paren
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|c-&gt;driver
)braket
op_member_access_from_pointer
id|interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|c-&gt;driver
comma
id|c-&gt;arg
comma
l_int|1
comma
id|skb
)paren
op_le
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Unable to send, try later */
r_break
suffix:semicolon
)brace
id|v-&gt;SyncInit
op_decrement
suffix:semicolon
id|v-&gt;skbidle
op_increment
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_v110: Couldn&squot;t open stream for chan %d&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|dev-&gt;v110use
(braket
id|idx
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
