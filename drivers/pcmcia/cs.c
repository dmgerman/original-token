multiline_comment|/*======================================================================&n;&n;    PCMCIA Card Services -- core services&n;&n;    cs.c 1.271 2000/10/02 20:27:49&n;    &n;    The contents of this file are subject to the Mozilla Public&n;    License Version 1.1 (the &quot;License&quot;); you may not use this file&n;    except in compliance with the License. You may obtain a copy of&n;    the License at http://www.mozilla.org/MPL/&n;&n;    Software distributed under the License is distributed on an &quot;AS&n;    IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or&n;    implied. See the License for the specific language governing&n;    rights and limitations under the License.&n;&n;    The initial developer of the original code is David A. Hinds&n;    &lt;dahinds@users.sourceforge.net&gt;.  Portions created by David A. Hinds&n;    are Copyright (C) 1999 David A. Hinds.  All Rights Reserved.&n;&n;    Alternatively, the contents of this file may be used under the&n;    terms of the GNU Public License version 2 (the &quot;GPL&quot;), in which&n;    case the provisions of the GPL are applicable instead of the&n;    above.  If you wish to allow the use of your version of this file&n;    only under the terms of the GPL and not to allow others to use&n;    your version of this file under the MPL, indicate your decision&n;    by deleting the provisions above and replace them with the notice&n;    and other provisions required by the GPL.  If you do not delete&n;    the provisions above, a recipient may use your version of this&n;    file under either the MPL or the GPL.&n;    &n;======================================================================*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|macro|IN_CARD_SERVICES
mdefine_line|#define IN_CARD_SERVICES
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/ss.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/bulkmem.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/cisreg.h&gt;
macro_line|#include &lt;pcmcia/bus_ops.h&gt;
macro_line|#include &quot;cs_internal.h&quot;
macro_line|#include &quot;rsrc_mgr.h&quot;
macro_line|#ifdef PCMCIA_DEBUG
DECL|variable|pc_debug
r_int
id|pc_debug
op_assign
id|PCMCIA_DEBUG
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pc_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;cs.c 1.271 2000/10/02 20:27:49 (David Hinds)&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
DECL|macro|PCI_OPT
mdefine_line|#define PCI_OPT &quot; [pci]&quot;
macro_line|#else
DECL|macro|PCI_OPT
mdefine_line|#define PCI_OPT &quot;&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_CARDBUS
DECL|macro|CB_OPT
mdefine_line|#define CB_OPT &quot; [cardbus]&quot;
macro_line|#else
DECL|macro|CB_OPT
mdefine_line|#define CB_OPT &quot;&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_PM
DECL|macro|PM_OPT
mdefine_line|#define PM_OPT &quot; [pm]&quot;
macro_line|#else
DECL|macro|PM_OPT
mdefine_line|#define PM_OPT &quot;&quot;
macro_line|#endif
macro_line|#if !defined(CONFIG_CARDBUS) &amp;&amp; !defined(CONFIG_PCI) &amp;&amp; !defined(CONFIG_PM)
DECL|macro|OPTIONS
mdefine_line|#define OPTIONS &quot; none&quot;
macro_line|#else
DECL|macro|OPTIONS
mdefine_line|#define OPTIONS PCI_OPT CB_OPT PM_OPT
macro_line|#endif
DECL|variable|release
r_static
r_const
r_char
op_star
id|release
op_assign
l_string|&quot;Linux PCMCIA Card Services &quot;
id|CS_RELEASE
suffix:semicolon
DECL|variable|options
r_static
r_const
r_char
op_star
id|options
op_assign
l_string|&quot;options: &quot;
id|OPTIONS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David Hinds &lt;dahinds@users.sourceforge.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Linux PCMCIA Card Services &quot;
id|CS_RELEASE
l_string|&quot;&bslash;n  options:&quot;
id|OPTIONS
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
DECL|macro|INT_MODULE_PARM
mdefine_line|#define INT_MODULE_PARM(n, v) static int n = v; MODULE_PARM(n, &quot;i&quot;)
id|INT_MODULE_PARM
c_func
(paren
id|setup_delay
comma
l_int|10
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|resume_delay
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|shutdown_delay
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|vcc_settle
comma
l_int|40
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|reset_time
comma
l_int|10
)paren
suffix:semicolon
multiline_comment|/* usecs */
id|INT_MODULE_PARM
c_func
(paren
id|unreset_delay
comma
l_int|10
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|unreset_check
comma
l_int|10
)paren
suffix:semicolon
multiline_comment|/* centiseconds */
id|INT_MODULE_PARM
c_func
(paren
id|unreset_limit
comma
l_int|30
)paren
suffix:semicolon
multiline_comment|/* unreset_check&squot;s */
multiline_comment|/* Access speed for attribute memory windows */
id|INT_MODULE_PARM
c_func
(paren
id|cis_speed
comma
l_int|300
)paren
suffix:semicolon
multiline_comment|/* ns */
multiline_comment|/* Access speed for IO windows */
id|INT_MODULE_PARM
c_func
(paren
id|io_speed
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ns */
multiline_comment|/* Optional features */
macro_line|#ifdef CONFIG_PM
id|INT_MODULE_PARM
c_func
(paren
id|do_apm
comma
l_int|1
)paren
suffix:semicolon
macro_line|#else
id|INT_MODULE_PARM
c_func
(paren
id|do_apm
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*====================================================================*/
DECL|variable|dead_socket
id|socket_state_t
id|dead_socket
op_assign
(brace
l_int|0
comma
id|SS_DETECT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Table of sockets */
DECL|variable|sockets
id|socket_t
id|sockets
op_assign
l_int|0
suffix:semicolon
DECL|variable|socket_table
id|socket_info_t
op_star
id|socket_table
(braket
id|MAX_SOCK
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|proc_pccard
r_struct
id|proc_dir_entry
op_star
id|proc_pccard
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
multiline_comment|/*====================================================================*/
multiline_comment|/* String tables for error messages */
DECL|struct|lookup_t
r_typedef
r_struct
id|lookup_t
(brace
DECL|member|key
r_int
id|key
suffix:semicolon
DECL|member|msg
r_char
op_star
id|msg
suffix:semicolon
DECL|typedef|lookup_t
)brace
id|lookup_t
suffix:semicolon
DECL|variable|error_table
r_static
r_const
id|lookup_t
id|error_table
(braket
)braket
op_assign
(brace
(brace
id|CS_SUCCESS
comma
l_string|&quot;Operation succeeded&quot;
)brace
comma
(brace
id|CS_BAD_ADAPTER
comma
l_string|&quot;Bad adapter&quot;
)brace
comma
(brace
id|CS_BAD_ATTRIBUTE
comma
l_string|&quot;Bad attribute&quot;
comma
)brace
comma
(brace
id|CS_BAD_BASE
comma
l_string|&quot;Bad base address&quot;
)brace
comma
(brace
id|CS_BAD_EDC
comma
l_string|&quot;Bad EDC&quot;
)brace
comma
(brace
id|CS_BAD_IRQ
comma
l_string|&quot;Bad IRQ&quot;
)brace
comma
(brace
id|CS_BAD_OFFSET
comma
l_string|&quot;Bad offset&quot;
)brace
comma
(brace
id|CS_BAD_PAGE
comma
l_string|&quot;Bad page number&quot;
)brace
comma
(brace
id|CS_READ_FAILURE
comma
l_string|&quot;Read failure&quot;
)brace
comma
(brace
id|CS_BAD_SIZE
comma
l_string|&quot;Bad size&quot;
)brace
comma
(brace
id|CS_BAD_SOCKET
comma
l_string|&quot;Bad socket&quot;
)brace
comma
(brace
id|CS_BAD_TYPE
comma
l_string|&quot;Bad type&quot;
)brace
comma
(brace
id|CS_BAD_VCC
comma
l_string|&quot;Bad Vcc&quot;
)brace
comma
(brace
id|CS_BAD_VPP
comma
l_string|&quot;Bad Vpp&quot;
)brace
comma
(brace
id|CS_BAD_WINDOW
comma
l_string|&quot;Bad window&quot;
)brace
comma
(brace
id|CS_WRITE_FAILURE
comma
l_string|&quot;Write failure&quot;
)brace
comma
(brace
id|CS_NO_CARD
comma
l_string|&quot;No card present&quot;
)brace
comma
(brace
id|CS_UNSUPPORTED_FUNCTION
comma
l_string|&quot;Usupported function&quot;
)brace
comma
(brace
id|CS_UNSUPPORTED_MODE
comma
l_string|&quot;Unsupported mode&quot;
)brace
comma
(brace
id|CS_BAD_SPEED
comma
l_string|&quot;Bad speed&quot;
)brace
comma
(brace
id|CS_BUSY
comma
l_string|&quot;Resource busy&quot;
)brace
comma
(brace
id|CS_GENERAL_FAILURE
comma
l_string|&quot;General failure&quot;
)brace
comma
(brace
id|CS_WRITE_PROTECTED
comma
l_string|&quot;Write protected&quot;
)brace
comma
(brace
id|CS_BAD_ARG_LENGTH
comma
l_string|&quot;Bad argument length&quot;
)brace
comma
(brace
id|CS_BAD_ARGS
comma
l_string|&quot;Bad arguments&quot;
)brace
comma
(brace
id|CS_CONFIGURATION_LOCKED
comma
l_string|&quot;Configuration locked&quot;
)brace
comma
(brace
id|CS_IN_USE
comma
l_string|&quot;Resource in use&quot;
)brace
comma
(brace
id|CS_NO_MORE_ITEMS
comma
l_string|&quot;No more items&quot;
)brace
comma
(brace
id|CS_OUT_OF_RESOURCE
comma
l_string|&quot;Out of resource&quot;
)brace
comma
(brace
id|CS_BAD_HANDLE
comma
l_string|&quot;Bad handle&quot;
)brace
comma
(brace
id|CS_BAD_TUPLE
comma
l_string|&quot;Bad CIS tuple&quot;
)brace
)brace
suffix:semicolon
DECL|macro|ERROR_COUNT
mdefine_line|#define ERROR_COUNT (sizeof(error_table)/sizeof(lookup_t))
DECL|variable|service_table
r_static
r_const
id|lookup_t
id|service_table
(braket
)braket
op_assign
(brace
(brace
id|AccessConfigurationRegister
comma
l_string|&quot;AccessConfigurationRegister&quot;
)brace
comma
(brace
id|AddSocketServices
comma
l_string|&quot;AddSocketServices&quot;
)brace
comma
(brace
id|AdjustResourceInfo
comma
l_string|&quot;AdjustResourceInfo&quot;
)brace
comma
(brace
id|CheckEraseQueue
comma
l_string|&quot;CheckEraseQueue&quot;
)brace
comma
(brace
id|CloseMemory
comma
l_string|&quot;CloseMemory&quot;
)brace
comma
(brace
id|DeregisterClient
comma
l_string|&quot;DeregisterClient&quot;
)brace
comma
(brace
id|DeregisterEraseQueue
comma
l_string|&quot;DeregisterEraseQueue&quot;
)brace
comma
(brace
id|GetCardServicesInfo
comma
l_string|&quot;GetCardServicesInfo&quot;
)brace
comma
(brace
id|GetClientInfo
comma
l_string|&quot;GetClientInfo&quot;
)brace
comma
(brace
id|GetConfigurationInfo
comma
l_string|&quot;GetConfigurationInfo&quot;
)brace
comma
(brace
id|GetEventMask
comma
l_string|&quot;GetEventMask&quot;
)brace
comma
(brace
id|GetFirstClient
comma
l_string|&quot;GetFirstClient&quot;
)brace
comma
(brace
id|GetFirstRegion
comma
l_string|&quot;GetFirstRegion&quot;
)brace
comma
(brace
id|GetFirstTuple
comma
l_string|&quot;GetFirstTuple&quot;
)brace
comma
(brace
id|GetNextClient
comma
l_string|&quot;GetNextClient&quot;
)brace
comma
(brace
id|GetNextRegion
comma
l_string|&quot;GetNextRegion&quot;
)brace
comma
(brace
id|GetNextTuple
comma
l_string|&quot;GetNextTuple&quot;
)brace
comma
(brace
id|GetStatus
comma
l_string|&quot;GetStatus&quot;
)brace
comma
(brace
id|GetTupleData
comma
l_string|&quot;GetTupleData&quot;
)brace
comma
(brace
id|MapMemPage
comma
l_string|&quot;MapMemPage&quot;
)brace
comma
(brace
id|ModifyConfiguration
comma
l_string|&quot;ModifyConfiguration&quot;
)brace
comma
(brace
id|ModifyWindow
comma
l_string|&quot;ModifyWindow&quot;
)brace
comma
(brace
id|OpenMemory
comma
l_string|&quot;OpenMemory&quot;
)brace
comma
(brace
id|ParseTuple
comma
l_string|&quot;ParseTuple&quot;
)brace
comma
(brace
id|ReadMemory
comma
l_string|&quot;ReadMemory&quot;
)brace
comma
(brace
id|RegisterClient
comma
l_string|&quot;RegisterClient&quot;
)brace
comma
(brace
id|RegisterEraseQueue
comma
l_string|&quot;RegisterEraseQueue&quot;
)brace
comma
(brace
id|RegisterMTD
comma
l_string|&quot;RegisterMTD&quot;
)brace
comma
(brace
id|ReleaseConfiguration
comma
l_string|&quot;ReleaseConfiguration&quot;
)brace
comma
(brace
id|ReleaseIO
comma
l_string|&quot;ReleaseIO&quot;
)brace
comma
(brace
id|ReleaseIRQ
comma
l_string|&quot;ReleaseIRQ&quot;
)brace
comma
(brace
id|ReleaseWindow
comma
l_string|&quot;ReleaseWindow&quot;
)brace
comma
(brace
id|RequestConfiguration
comma
l_string|&quot;RequestConfiguration&quot;
)brace
comma
(brace
id|RequestIO
comma
l_string|&quot;RequestIO&quot;
)brace
comma
(brace
id|RequestIRQ
comma
l_string|&quot;RequestIRQ&quot;
)brace
comma
(brace
id|RequestSocketMask
comma
l_string|&quot;RequestSocketMask&quot;
)brace
comma
(brace
id|RequestWindow
comma
l_string|&quot;RequestWindow&quot;
)brace
comma
(brace
id|ResetCard
comma
l_string|&quot;ResetCard&quot;
)brace
comma
(brace
id|SetEventMask
comma
l_string|&quot;SetEventMask&quot;
)brace
comma
(brace
id|ValidateCIS
comma
l_string|&quot;ValidateCIS&quot;
)brace
comma
(brace
id|WriteMemory
comma
l_string|&quot;WriteMemory&quot;
)brace
comma
(brace
id|BindDevice
comma
l_string|&quot;BindDevice&quot;
)brace
comma
(brace
id|BindMTD
comma
l_string|&quot;BindMTD&quot;
)brace
comma
(brace
id|ReportError
comma
l_string|&quot;ReportError&quot;
)brace
comma
(brace
id|SuspendCard
comma
l_string|&quot;SuspendCard&quot;
)brace
comma
(brace
id|ResumeCard
comma
l_string|&quot;ResumeCard&quot;
)brace
comma
(brace
id|EjectCard
comma
l_string|&quot;EjectCard&quot;
)brace
comma
(brace
id|InsertCard
comma
l_string|&quot;InsertCard&quot;
)brace
comma
(brace
id|ReplaceCIS
comma
l_string|&quot;ReplaceCIS&quot;
)brace
)brace
suffix:semicolon
DECL|macro|SERVICE_COUNT
mdefine_line|#define SERVICE_COUNT (sizeof(service_table)/sizeof(lookup_t))
multiline_comment|/*======================================================================&n;&n; These functions are just shorthand for the actual low-level drivers&n;&n;======================================================================*/
DECL|function|register_callback
r_static
r_int
id|register_callback
c_func
(paren
id|socket_info_t
op_star
id|s
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_void
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|info
)paren
(brace
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|register_callback
c_func
(paren
id|s-&gt;sock
comma
id|handler
comma
id|info
)paren
suffix:semicolon
)brace
DECL|function|get_socket_status
r_static
r_int
id|get_socket_status
c_func
(paren
id|socket_info_t
op_star
id|s
comma
r_int
op_star
id|val
)paren
(brace
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|get_status
c_func
(paren
id|s-&gt;sock
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|set_socket
r_static
r_int
id|set_socket
c_func
(paren
id|socket_info_t
op_star
id|s
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|set_socket
c_func
(paren
id|s-&gt;sock
comma
id|state
)paren
suffix:semicolon
)brace
DECL|function|set_io_map
r_static
r_int
id|set_io_map
c_func
(paren
id|socket_info_t
op_star
id|s
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|set_io_map
c_func
(paren
id|s-&gt;sock
comma
id|io
)paren
suffix:semicolon
)brace
DECL|function|set_mem_map
r_static
r_int
id|set_mem_map
c_func
(paren
id|socket_info_t
op_star
id|s
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|set_mem_map
c_func
(paren
id|s-&gt;sock
comma
id|mem
)paren
suffix:semicolon
)brace
DECL|function|suspend_socket
r_static
r_int
id|suspend_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
id|s-&gt;socket
op_assign
id|dead_socket
suffix:semicolon
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|suspend
c_func
(paren
id|s-&gt;sock
)paren
suffix:semicolon
)brace
DECL|function|init_socket
r_static
r_int
id|init_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
id|s-&gt;socket
op_assign
id|dead_socket
suffix:semicolon
r_return
id|s-&gt;ss_entry
op_member_access_from_pointer
id|init
c_func
(paren
id|s-&gt;sock
)paren
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(PCMCIA_DEBUG)
DECL|function|proc_read_clients
r_static
r_int
id|proc_read_clients
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|pos
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
id|data
suffix:semicolon
id|client_handle_t
id|c
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|s-&gt;clients
suffix:semicolon
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;fn %x: &squot;%s&squot; [attr 0x%04x] [state 0x%04x]&bslash;n&quot;
comma
id|c-&gt;Function
comma
id|c-&gt;dev_info
comma
id|c-&gt;Attributes
comma
id|c-&gt;state
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Low-level PC Card interface drivers need to register with Card&n;    Services using these calls.&n;    &n;======================================================================*/
r_static
r_int
id|setup_socket
c_func
(paren
id|socket_info_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|shutdown_socket
c_func
(paren
id|socket_info_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|reset_socket
c_func
(paren
id|socket_info_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|unreset_socket
c_func
(paren
id|socket_info_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|parse_events
c_func
(paren
r_void
op_star
id|info
comma
id|u_int
id|events
)paren
suffix:semicolon
DECL|function|pcmcia_register_socket
id|socket_info_t
op_star
id|pcmcia_register_socket
(paren
r_int
id|slot
comma
r_struct
id|pccard_operations
op_star
id|ss_entry
comma
r_int
id|use_bus_pm
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;cs: pcmcia_register_socket(0x%p)&bslash;n&quot;
comma
id|ss_entry
)paren
suffix:semicolon
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|socket_info_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
id|socket_info_t
)paren
)paren
suffix:semicolon
id|s-&gt;ss_entry
op_assign
id|ss_entry
suffix:semicolon
id|s-&gt;sock
op_assign
id|slot
suffix:semicolon
multiline_comment|/* base address = 0, map = 0 */
id|s-&gt;cis_mem.flags
op_assign
l_int|0
suffix:semicolon
id|s-&gt;cis_mem.speed
op_assign
id|cis_speed
suffix:semicolon
id|s-&gt;use_bus_pm
op_assign
id|use_bus_pm
suffix:semicolon
id|s-&gt;erase_busy.next
op_assign
id|s-&gt;erase_busy.prev
op_assign
op_amp
id|s-&gt;erase_busy
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|socket_table
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|socket_table
(braket
id|i
)braket
op_assign
id|s
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|sockets
)paren
id|sockets
op_increment
suffix:semicolon
id|init_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|ss_entry
op_member_access_from_pointer
id|inquire_socket
c_func
(paren
id|slot
comma
op_amp
id|s-&gt;cap
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|proc_pccard
)paren
(brace
r_char
id|name
(braket
l_int|3
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%02d&quot;
comma
id|i
)paren
suffix:semicolon
id|s-&gt;proc
op_assign
id|proc_mkdir
c_func
(paren
id|name
comma
id|proc_pccard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;proc
)paren
id|ss_entry
op_member_access_from_pointer
id|proc_setup
c_func
(paren
id|slot
comma
id|s-&gt;proc
)paren
suffix:semicolon
macro_line|#ifdef PCMCIA_DEBUG
r_if
c_cond
(paren
id|s-&gt;proc
)paren
id|create_proc_read_entry
c_func
(paren
l_string|&quot;clients&quot;
comma
l_int|0
comma
id|s-&gt;proc
comma
id|proc_read_clients
comma
id|s
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
r_return
id|s
suffix:semicolon
)brace
multiline_comment|/* pcmcia_register_socket */
DECL|function|register_ss_entry
r_int
id|register_ss_entry
c_func
(paren
r_int
id|nsock
comma
r_struct
id|pccard_operations
op_star
id|ss_entry
)paren
(brace
r_int
id|ns
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;cs: register_ss_entry(%d, 0x%p)&bslash;n&quot;
comma
id|nsock
comma
id|ss_entry
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ns
op_assign
l_int|0
suffix:semicolon
id|ns
OL
id|nsock
suffix:semicolon
id|ns
op_increment
)paren
(brace
id|pcmcia_register_socket
(paren
id|ns
comma
id|ss_entry
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* register_ss_entry */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_unregister_socket
r_void
id|pcmcia_unregister_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
r_int
id|j
comma
id|socket
op_assign
op_minus
l_int|1
suffix:semicolon
id|client_t
op_star
id|client
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAX_SOCK
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|socket_table
(braket
id|j
)braket
op_eq
id|s
)paren
(brace
id|socket
op_assign
id|j
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|socket
OL
l_int|0
)paren
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|proc_pccard
)paren
(brace
r_char
id|name
(braket
l_int|3
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%02d&quot;
comma
id|socket
)paren
suffix:semicolon
macro_line|#ifdef PCMCIA_DEBUG
id|remove_proc_entry
c_func
(paren
l_string|&quot;clients&quot;
comma
id|s-&gt;proc
)paren
suffix:semicolon
macro_line|#endif
id|remove_proc_entry
c_func
(paren
id|name
comma
id|proc_pccard
)paren
suffix:semicolon
)brace
macro_line|#endif
id|shutdown_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|release_cis_mem
c_func
(paren
id|s
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;clients
)paren
(brace
id|client
op_assign
id|s-&gt;clients
suffix:semicolon
id|s-&gt;clients
op_assign
id|s-&gt;clients-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
)brace
id|s-&gt;ss_entry
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|socket_table
(braket
id|socket
)braket
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|socket
suffix:semicolon
id|j
OL
id|sockets
op_minus
l_int|1
suffix:semicolon
id|j
op_increment
)paren
id|socket_table
(braket
id|j
)braket
op_assign
id|socket_table
(braket
id|j
op_plus
l_int|1
)braket
suffix:semicolon
id|sockets
op_decrement
suffix:semicolon
)brace
multiline_comment|/* pcmcia_unregister_socket */
DECL|function|unregister_ss_entry
r_void
id|unregister_ss_entry
c_func
(paren
r_struct
id|pccard_operations
op_star
id|ss_entry
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|sockets
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|socket_info_t
op_star
id|socket
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|socket-&gt;ss_entry
op_eq
id|ss_entry
)paren
id|pcmcia_unregister_socket
(paren
id|socket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* unregister_ss_entry */
multiline_comment|/*======================================================================&n;&n;    Shutdown_Socket() and setup_socket() are scheduled using add_timer&n;    calls by the main event handler when card insertion and removal&n;    events are received.  Shutdown_Socket() unconfigures a socket and&n;    turns off socket power.  Setup_socket() turns on socket power&n;    and resets the socket, in two stages.&n;&n;======================================================================*/
DECL|function|free_regions
r_static
r_void
id|free_regions
c_func
(paren
id|memory_handle_t
op_star
id|list
)paren
(brace
id|memory_handle_t
id|tmp
suffix:semicolon
r_while
c_loop
(paren
op_star
id|list
op_ne
l_int|NULL
)paren
(brace
id|tmp
op_assign
op_star
id|list
suffix:semicolon
op_star
id|list
op_assign
id|tmp-&gt;info.next
suffix:semicolon
id|tmp-&gt;region_magic
op_assign
l_int|0
suffix:semicolon
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
id|send_event
c_func
(paren
id|socket_info_t
op_star
id|s
comma
id|event_t
id|event
comma
r_int
id|priority
)paren
suffix:semicolon
multiline_comment|/*&n; * Sleep for n_cs centiseconds (1 cs = 1/100th of a second)&n; */
DECL|function|cs_sleep
r_static
r_void
id|cs_sleep
c_func
(paren
r_int
r_int
id|n_cs
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|n_cs
op_star
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
)paren
suffix:semicolon
)brace
DECL|function|shutdown_socket
r_static
r_void
id|shutdown_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
id|client_t
op_star
op_star
id|c
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: shutdown_socket(%p)&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
multiline_comment|/* Blank out the socket state */
id|s-&gt;state
op_and_assign
id|SOCKET_PRESENT
op_or
id|SOCKET_SETUP_PENDING
suffix:semicolon
id|init_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;irq.AssignedIRQ
op_assign
id|s-&gt;irq.Config
op_assign
l_int|0
suffix:semicolon
id|s-&gt;lock_count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;cis_used
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fake_cis
)paren
(brace
id|kfree
c_func
(paren
id|s-&gt;fake_cis
)paren
suffix:semicolon
id|s-&gt;fake_cis
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CARDBUS
id|cb_release_cis_mem
c_func
(paren
id|s
)paren
suffix:semicolon
id|cb_free
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
id|s-&gt;functions
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;config
)paren
(brace
id|kfree
c_func
(paren
id|s-&gt;config
)paren
suffix:semicolon
id|s-&gt;config
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|c
op_assign
op_amp
id|s-&gt;clients
suffix:semicolon
op_star
id|c
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|c
)paren
op_member_access_from_pointer
id|state
op_amp
id|CLIENT_UNBOUND
)paren
(brace
id|client_t
op_star
id|d
op_assign
op_star
id|c
suffix:semicolon
op_star
id|c
op_assign
(paren
op_star
id|c
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
r_else
(brace
id|c
op_assign
op_amp
(paren
(paren
op_star
id|c
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
id|free_regions
c_func
(paren
op_amp
id|s-&gt;a_region
)paren
suffix:semicolon
id|free_regions
c_func
(paren
op_amp
id|s-&gt;c_region
)paren
suffix:semicolon
)brace
multiline_comment|/* shutdown_socket */
multiline_comment|/*&n; * Return zero if we think the card isn&squot;t actually present&n; */
DECL|function|setup_socket
r_static
r_int
id|setup_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
r_int
id|val
comma
id|ret
suffix:semicolon
r_int
id|setup_timeout
op_assign
l_int|100
suffix:semicolon
multiline_comment|/* Wait for &quot;not pending&quot; */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|SS_PENDING
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|setup_timeout
)paren
(brace
id|cs_sleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;cs: socket %p voltage interrogation&quot;
l_string|&quot; timed out&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|SS_DETECT
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: setup_socket(%p): applying power&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_PRESENT
suffix:semicolon
id|s-&gt;socket.flags
op_and_assign
id|SS_DEBOUNCED
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_3VCARD
)paren
id|s-&gt;socket.Vcc
op_assign
id|s-&gt;socket.Vpp
op_assign
l_int|33
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|SS_XVCARD
)paren
)paren
id|s-&gt;socket.Vcc
op_assign
id|s-&gt;socket.Vpp
op_assign
l_int|50
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;cs: socket %p: unsupported &quot;
l_string|&quot;voltage key&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|s-&gt;socket.Vcc
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|SS_CARDBUS
)paren
(brace
id|s-&gt;state
op_or_assign
id|SOCKET_CARDBUS
suffix:semicolon
macro_line|#ifndef CONFIG_CARDBUS
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;cs: unsupported card type detected!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
id|cs_sleep
c_func
(paren
id|vcc_settle
)paren
suffix:semicolon
id|reset_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;cs: setup_socket(%p): no card!&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* setup_socket */
multiline_comment|/*======================================================================&n;&n;    Reset_socket() and unreset_socket() handle hard resets.  Resets&n;    have several causes: card insertion, a call to reset_socket, or&n;    recovery from a suspend/resume cycle.  Unreset_socket() sends&n;    a CS event that matches the cause of the reset.&n;    &n;======================================================================*/
DECL|function|reset_socket
r_static
r_void
id|reset_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: resetting socket %p&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|s-&gt;socket.flags
op_or_assign
id|SS_OUTPUT_ENA
op_or
id|SS_RESET
suffix:semicolon
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
id|udelay
c_func
(paren
(paren
r_int
)paren
id|reset_time
)paren
suffix:semicolon
id|s-&gt;socket.flags
op_and_assign
op_complement
id|SS_RESET
suffix:semicolon
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
id|cs_sleep
c_func
(paren
id|unreset_delay
)paren
suffix:semicolon
id|unreset_socket
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
multiline_comment|/* reset_socket */
DECL|macro|EVENT_MASK
mdefine_line|#define EVENT_MASK &bslash;&n;(SOCKET_SETUP_PENDING|SOCKET_SUSPEND|SOCKET_RESET_PENDING)
DECL|function|unreset_socket
r_static
r_void
id|unreset_socket
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
r_int
id|setup_timeout
op_assign
id|unreset_limit
suffix:semicolon
r_int
id|val
suffix:semicolon
multiline_comment|/* Wait for &quot;ready&quot; */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_READY
)paren
r_break
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;cs: socket %d not ready yet&bslash;n&quot;
comma
id|s-&gt;sock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|setup_timeout
)paren
(brace
id|cs_sleep
c_func
(paren
id|unreset_check
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;cs: socket %p timed out during&quot;
l_string|&quot; reset.  Try increasing setup_delay.&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|s-&gt;state
op_and_assign
op_complement
id|EVENT_MASK
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: reset done on socket %p&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
(brace
id|s-&gt;state
op_and_assign
op_complement
id|EVENT_MASK
suffix:semicolon
r_if
c_cond
(paren
id|verify_cis_cache
c_func
(paren
id|s
)paren
op_ne
l_int|0
)paren
id|parse_events
c_func
(paren
id|s
comma
id|SS_DETECT
)paren
suffix:semicolon
r_else
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_PM_RESUME
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SETUP_PENDING
)paren
(brace
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_CARDBUS
)paren
id|cb_alloc
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_CARD_INSERTION
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_SETUP_PENDING
suffix:semicolon
)brace
r_else
(brace
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_CARD_RESET
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;reset_handle
)paren
(brace
id|s-&gt;reset_handle-&gt;event_callback_args.info
op_assign
l_int|NULL
suffix:semicolon
id|EVENT
c_func
(paren
id|s-&gt;reset_handle
comma
id|CS_EVENT_RESET_COMPLETE
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
)brace
id|s-&gt;state
op_and_assign
op_complement
id|EVENT_MASK
suffix:semicolon
)brace
)brace
multiline_comment|/* unreset_socket */
multiline_comment|/*======================================================================&n;&n;    The central event handler.  Send_event() sends an event to all&n;    valid clients.  Parse_events() interprets the event bits from&n;    a card status change report.  Do_shotdown() handles the high&n;    priority stuff associated with a card removal.&n;    &n;======================================================================*/
DECL|function|send_event
r_static
r_int
id|send_event
c_func
(paren
id|socket_info_t
op_star
id|s
comma
id|event_t
id|event
comma
r_int
id|priority
)paren
(brace
id|client_t
op_star
id|client
op_assign
id|s-&gt;clients
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: send_event(sock %d, event %d, pri %d)&bslash;n&quot;
comma
id|s-&gt;sock
comma
id|event
comma
id|priority
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|client
suffix:semicolon
id|client
op_assign
id|client-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;state
op_amp
(paren
id|CLIENT_UNBOUND
op_or
id|CLIENT_STALE
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;EventMask
op_amp
id|event
)paren
(brace
id|ret
op_assign
id|EVENT
c_func
(paren
id|client
comma
id|event
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* send_event */
DECL|function|do_shutdown
r_static
r_void
id|do_shutdown
c_func
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
id|client_t
op_star
id|client
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SHUTDOWN_PENDING
)paren
r_return
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_SHUTDOWN_PENDING
suffix:semicolon
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_CARD_REMOVAL
comma
id|CS_EVENT_PRI_HIGH
)paren
suffix:semicolon
r_for
c_loop
(paren
id|client
op_assign
id|s-&gt;clients
suffix:semicolon
id|client
suffix:semicolon
id|client
op_assign
id|client-&gt;next
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|client-&gt;Attributes
op_amp
id|INFO_MASTER_CLIENT
)paren
)paren
id|client-&gt;state
op_or_assign
id|CLIENT_STALE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
(paren
id|SOCKET_SETUP_PENDING
op_or
id|SOCKET_RESET_PENDING
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;cs: flushing pending setup&bslash;n&quot;
)paren
suffix:semicolon
id|s-&gt;state
op_and_assign
op_complement
id|EVENT_MASK
suffix:semicolon
)brace
id|cs_sleep
c_func
(paren
id|shutdown_delay
)paren
suffix:semicolon
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_PRESENT
suffix:semicolon
id|shutdown_socket
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|parse_events
r_static
r_void
id|parse_events
c_func
(paren
r_void
op_star
id|info
comma
id|u_int
id|events
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
id|info
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|SS_DETECT
)paren
(brace
r_int
id|status
suffix:semicolon
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
op_logical_or
op_logical_neg
(paren
id|status
op_amp
id|SS_DETECT
)paren
)paren
)paren
id|do_shutdown
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SS_DETECT
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SETUP_PENDING
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: delaying pending setup&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|s-&gt;state
op_or_assign
id|SOCKET_SETUP_PENDING
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
id|cs_sleep
c_func
(paren
id|resume_delay
)paren
suffix:semicolon
r_else
id|cs_sleep
c_func
(paren
id|setup_delay
)paren
suffix:semicolon
id|s-&gt;socket.flags
op_or_assign
id|SS_DEBOUNCED
suffix:semicolon
r_if
c_cond
(paren
id|setup_socket
c_func
(paren
id|s
)paren
op_eq
l_int|0
)paren
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_SETUP_PENDING
suffix:semicolon
id|s-&gt;socket.flags
op_and_assign
op_complement
id|SS_DEBOUNCED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|events
op_amp
id|SS_BATDEAD
)paren
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_BATTERY_DEAD
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|SS_BATWARN
)paren
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_BATTERY_LOW
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|SS_READY
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_RESET_PENDING
)paren
)paren
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_READY_CHANGE
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_else
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: ready change during reset&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* parse_events */
multiline_comment|/*======================================================================&n;&n;    Another event handler, for power management events.&n;&n;    This does not comply with the latest PC Card spec for handling&n;    power management events.&n;    &n;======================================================================*/
DECL|function|pcmcia_suspend_socket
r_void
id|pcmcia_suspend_socket
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
op_logical_and
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
)paren
(brace
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_PM_SUSPEND
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
id|suspend_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_SUSPEND
suffix:semicolon
)brace
)brace
DECL|function|pcmcia_resume_socket
r_void
id|pcmcia_resume_socket
(paren
id|socket_info_t
op_star
id|s
)paren
(brace
r_int
id|stat
suffix:semicolon
multiline_comment|/* Do this just to reinitialize the socket */
id|init_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|stat
)paren
suffix:semicolon
multiline_comment|/* If there was or is a card here, we need to do something&n;    about it... but parse_events will sort it all out. */
r_if
c_cond
(paren
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
op_logical_or
(paren
id|stat
op_amp
id|SS_DETECT
)paren
)paren
id|parse_events
c_func
(paren
id|s
comma
id|SS_DETECT
)paren
suffix:semicolon
)brace
DECL|function|handle_pm_event
r_static
r_int
id|handle_pm_event
c_func
(paren
r_struct
id|pm_dev
op_star
id|dev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
multiline_comment|/* only for busses that don&squot;t suspend/resume slots directly */
r_switch
c_cond
(paren
id|rqst
)paren
(brace
r_case
id|PM_SUSPEND
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: received suspend notification&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;use_bus_pm
)paren
id|pcmcia_suspend_socket
(paren
id|socket_table
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PM_RESUME
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: received resume notification&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;use_bus_pm
)paren
id|pcmcia_resume_socket
(paren
id|socket_table
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* handle_pm_event */
multiline_comment|/*======================================================================&n;&n;    Special stuff for managing IO windows, because they are scarce.&n;    &n;======================================================================*/
DECL|function|alloc_io_space
r_static
r_int
id|alloc_io_space
c_func
(paren
id|socket_info_t
op_star
id|s
comma
id|u_int
id|attr
comma
id|ioaddr_t
op_star
id|base
comma
id|ioaddr_t
id|num
comma
id|u_int
id|lines
comma
r_char
op_star
id|name
)paren
(brace
r_int
id|i
suffix:semicolon
id|ioaddr_t
r_try
comma
id|align
suffix:semicolon
id|align
op_assign
(paren
op_star
id|base
)paren
ques
c_cond
(paren
id|lines
ques
c_cond
l_int|1
op_lshift
id|lines
suffix:colon
l_int|0
)paren
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|align
op_logical_and
(paren
id|align
OL
id|num
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|base
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;odd IO request: num %04x align %04x&bslash;n&quot;
comma
id|num
comma
id|align
)paren
suffix:semicolon
id|align
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_while
c_loop
(paren
id|align
op_logical_and
(paren
id|align
OL
id|num
)paren
)paren
id|align
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|base
op_amp
op_complement
(paren
id|align
op_minus
l_int|1
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;odd IO request: base %04x align %04x&bslash;n&quot;
comma
op_star
id|base
comma
id|align
)paren
suffix:semicolon
id|align
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check for an already-allocated window that must conflict with&n;       what was asked for.  It is a hack because it does not catch all&n;       potential conflicts, just the most obvious ones. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IO_WIN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_amp
(paren
id|align
op_minus
l_int|1
)paren
)paren
op_eq
op_star
id|base
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IO_WIN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|find_io_region
c_func
(paren
id|base
comma
id|num
comma
id|align
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|s-&gt;io
(braket
id|i
)braket
dot
id|Attributes
op_assign
id|attr
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_assign
op_star
id|base
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_assign
id|s-&gt;io
(braket
id|i
)braket
dot
id|InUse
op_assign
id|num
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|Attributes
op_ne
id|attr
)paren
r_continue
suffix:semicolon
multiline_comment|/* Try to extend top of window */
r_try
op_assign
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_plus
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|base
op_eq
l_int|0
)paren
op_logical_or
(paren
op_star
id|base
op_eq
r_try
)paren
)paren
r_if
c_cond
(paren
id|find_io_region
c_func
(paren
op_amp
r_try
comma
id|num
comma
l_int|0
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
op_star
id|base
op_assign
r_try
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_add_assign
id|num
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|InUse
op_add_assign
id|num
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Try to extend bottom of window */
r_try
op_assign
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_minus
id|num
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|base
op_eq
l_int|0
)paren
op_logical_or
(paren
op_star
id|base
op_eq
r_try
)paren
)paren
r_if
c_cond
(paren
id|find_io_region
c_func
(paren
op_amp
r_try
comma
id|num
comma
l_int|0
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_assign
op_star
id|base
op_assign
r_try
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_add_assign
id|num
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|InUse
op_add_assign
id|num
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|i
op_eq
id|MAX_IO_WIN
)paren
suffix:semicolon
)brace
multiline_comment|/* alloc_io_space */
DECL|function|release_io_space
r_static
r_void
id|release_io_space
c_func
(paren
id|socket_info_t
op_star
id|s
comma
id|ioaddr_t
id|base
comma
id|ioaddr_t
id|num
)paren
(brace
r_int
id|i
suffix:semicolon
id|release_region
c_func
(paren
id|base
comma
id|num
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IO_WIN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_le
id|base
)paren
op_logical_and
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
op_plus
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_ge
id|base
op_plus
id|num
)paren
)paren
(brace
id|s-&gt;io
(braket
id|i
)braket
dot
id|InUse
op_sub_assign
id|num
suffix:semicolon
multiline_comment|/* Free the window if no one else is using it */
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|InUse
op_eq
l_int|0
)paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*======================================================================&n;&n;    Access_configuration_register() reads and writes configuration&n;    registers in attribute memory.  Memory window 0 is reserved for&n;    this and the tuple reading services.&n;    &n;======================================================================*/
DECL|function|pcmcia_access_configuration_register
r_int
id|pcmcia_access_configuration_register
c_func
(paren
id|client_handle_t
id|handle
comma
id|conf_reg_t
op_star
id|reg
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_int
id|addr
suffix:semicolon
id|u_char
id|val
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;Function
op_eq
id|BIND_FN_ALL
)paren
(brace
r_if
c_cond
(paren
id|reg-&gt;Function
op_ge
id|s-&gt;functions
)paren
r_return
id|CS_BAD_ARGS
suffix:semicolon
id|c
op_assign
op_amp
id|s-&gt;config
(braket
id|reg-&gt;Function
)braket
suffix:semicolon
)brace
r_else
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
id|addr
op_assign
(paren
id|c-&gt;ConfigBase
op_plus
id|reg-&gt;Offset
)paren
op_rshift
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|reg-&gt;Action
)paren
(brace
r_case
id|CS_READ
suffix:colon
id|read_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
id|addr
comma
l_int|1
comma
op_amp
id|val
)paren
suffix:semicolon
id|reg-&gt;Value
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_WRITE
suffix:colon
id|val
op_assign
id|reg-&gt;Value
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
id|addr
comma
l_int|1
comma
op_amp
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|CS_BAD_ARGS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* access_configuration_register */
multiline_comment|/*======================================================================&n;&n;    Bind_device() associates a device driver with a particular socket.&n;    It is normally called by Driver Services after it has identified&n;    a newly inserted card.  An instance of that driver will then be&n;    eligible to register as a client of this socket.&n;    &n;======================================================================*/
DECL|function|pcmcia_bind_device
r_int
id|pcmcia_bind_device
c_func
(paren
id|bind_req_t
op_star
id|req
)paren
(brace
id|client_t
op_star
id|client
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_SOCKET
c_func
(paren
id|req-&gt;Socket
)paren
)paren
r_return
id|CS_BAD_SOCKET
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|req
)paren
suffix:semicolon
id|client
op_assign
(paren
id|client_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|client_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|client
)paren
r_return
id|CS_OUT_OF_RESOURCE
suffix:semicolon
id|memset
c_func
(paren
id|client
comma
l_char|&squot;&bslash;0&squot;
comma
r_sizeof
(paren
id|client_t
)paren
)paren
suffix:semicolon
id|client-&gt;client_magic
op_assign
id|CLIENT_MAGIC
suffix:semicolon
id|strncpy
c_func
(paren
id|client-&gt;dev_info
comma
(paren
r_char
op_star
)paren
id|req-&gt;dev_info
comma
id|DEV_NAME_LEN
)paren
suffix:semicolon
id|client-&gt;Socket
op_assign
id|req-&gt;Socket
suffix:semicolon
id|client-&gt;Function
op_assign
id|req-&gt;Function
suffix:semicolon
id|client-&gt;state
op_assign
id|CLIENT_UNBOUND
suffix:semicolon
id|client-&gt;erase_busy.next
op_assign
op_amp
id|client-&gt;erase_busy
suffix:semicolon
id|client-&gt;erase_busy.prev
op_assign
op_amp
id|client-&gt;erase_busy
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|client-&gt;mtd_req
)paren
suffix:semicolon
id|client-&gt;next
op_assign
id|s-&gt;clients
suffix:semicolon
id|s-&gt;clients
op_assign
id|client
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: bind_device(): client 0x%p, sock %d, dev %s&bslash;n&quot;
comma
id|client
comma
id|client-&gt;Socket
comma
id|client-&gt;dev_info
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* bind_device */
multiline_comment|/*======================================================================&n;&n;    Bind_mtd() associates a device driver with a particular memory&n;    region.  It is normally called by Driver Services after it has&n;    identified a memory device type.  An instance of the corresponding&n;    driver will then be able to register to control this region.&n;    &n;======================================================================*/
DECL|function|pcmcia_bind_mtd
r_int
id|pcmcia_bind_mtd
c_func
(paren
id|mtd_bind_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|memory_handle_t
id|region
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_SOCKET
c_func
(paren
id|req-&gt;Socket
)paren
)paren
r_return
id|CS_BAD_SOCKET
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|REGION_TYPE_AM
)paren
id|region
op_assign
id|s-&gt;a_region
suffix:semicolon
r_else
id|region
op_assign
id|s-&gt;c_region
suffix:semicolon
r_while
c_loop
(paren
id|region
)paren
(brace
r_if
c_cond
(paren
id|region-&gt;info.CardOffset
op_eq
id|req-&gt;CardOffset
)paren
r_break
suffix:semicolon
id|region
op_assign
id|region-&gt;info.next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|region
op_logical_or
(paren
id|region-&gt;mtd
op_ne
l_int|NULL
)paren
)paren
r_return
id|CS_BAD_OFFSET
suffix:semicolon
id|strncpy
c_func
(paren
id|region-&gt;dev_info
comma
(paren
r_char
op_star
)paren
id|req-&gt;dev_info
comma
id|DEV_NAME_LEN
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: bind_mtd(): attr 0x%x, offset 0x%x, dev %s&bslash;n&quot;
comma
id|req-&gt;Attributes
comma
id|req-&gt;CardOffset
comma
(paren
r_char
op_star
)paren
id|req-&gt;dev_info
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* bind_mtd */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_deregister_client
r_int
id|pcmcia_deregister_client
c_func
(paren
id|client_handle_t
id|handle
)paren
(brace
id|client_t
op_star
op_star
id|client
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
id|memory_handle_t
id|region
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
r_int
id|i
comma
id|sn
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: deregister_client(%p)&bslash;n&quot;
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
(paren
id|CLIENT_IRQ_REQ
op_or
id|CLIENT_IO_REQ
op_or
id|CLIENT_CONFIG_LOCKED
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_WIN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
id|CLIENT_WIN_REQ
c_func
(paren
id|i
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
multiline_comment|/* Disconnect all MTD links */
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;mtd_count
)paren
(brace
r_for
c_loop
(paren
id|region
op_assign
id|s-&gt;a_region
suffix:semicolon
id|region
suffix:semicolon
id|region
op_assign
id|region-&gt;info.next
)paren
r_if
c_cond
(paren
id|region-&gt;mtd
op_eq
id|handle
)paren
id|region-&gt;mtd
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|region
op_assign
id|s-&gt;c_region
suffix:semicolon
id|region
suffix:semicolon
id|region
op_assign
id|region-&gt;info.next
)paren
r_if
c_cond
(paren
id|region-&gt;mtd
op_eq
id|handle
)paren
id|region-&gt;mtd
op_assign
l_int|NULL
suffix:semicolon
)brace
id|sn
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|sn
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|handle-&gt;state
op_amp
id|CLIENT_STALE
)paren
op_logical_or
(paren
id|handle-&gt;Attributes
op_amp
id|INFO_MASTER_CLIENT
)paren
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|client
op_assign
op_amp
id|s-&gt;clients
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|client
)paren
op_logical_and
(paren
(paren
op_star
id|client
)paren
op_ne
id|handle
)paren
)paren
id|client
op_assign
op_amp
(paren
op_star
id|client
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
r_if
c_cond
(paren
op_star
id|client
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|CS_BAD_HANDLE
suffix:semicolon
)brace
op_star
id|client
op_assign
id|handle-&gt;next
suffix:semicolon
id|handle-&gt;client_magic
op_assign
l_int|0
suffix:semicolon
id|kfree
c_func
(paren
id|handle
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|handle-&gt;state
op_assign
id|CLIENT_UNBOUND
suffix:semicolon
id|handle-&gt;mtd_count
op_assign
l_int|0
suffix:semicolon
id|handle-&gt;event_handler
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|s-&gt;real_clients
op_eq
l_int|0
)paren
id|register_callback
c_func
(paren
id|s
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* deregister_client */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_get_configuration_info
r_int
id|pcmcia_get_configuration_info
c_func
(paren
id|client_handle_t
id|handle
comma
id|config_info_t
op_star
id|config
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;Function
op_eq
id|BIND_FN_ALL
)paren
(brace
r_if
c_cond
(paren
id|config-&gt;Function
op_logical_and
(paren
id|config-&gt;Function
op_ge
id|s-&gt;functions
)paren
)paren
r_return
id|CS_BAD_ARGS
suffix:semicolon
)brace
r_else
id|config-&gt;Function
op_assign
id|handle-&gt;Function
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_CARDBUS
)paren
(brace
id|u_char
id|fn
op_assign
id|config-&gt;Function
suffix:semicolon
id|memset
c_func
(paren
id|config
comma
l_int|0
comma
r_sizeof
(paren
id|config_info_t
)paren
)paren
suffix:semicolon
id|config-&gt;Function
op_assign
id|fn
suffix:semicolon
id|config-&gt;Vcc
op_assign
id|s-&gt;socket.Vcc
suffix:semicolon
id|config-&gt;Vpp1
op_assign
id|config-&gt;Vpp2
op_assign
id|s-&gt;socket.Vpp
suffix:semicolon
id|config-&gt;Option
op_assign
id|s-&gt;cap.cb_dev-&gt;subordinate-&gt;number
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;cb_config
)paren
(brace
id|config-&gt;Attributes
op_assign
id|CONF_VALID_CLIENT
suffix:semicolon
id|config-&gt;IntType
op_assign
id|INT_CARDBUS
suffix:semicolon
id|config-&gt;AssignedIRQ
op_assign
id|s-&gt;irq.AssignedIRQ
suffix:semicolon
r_if
c_cond
(paren
id|config-&gt;AssignedIRQ
)paren
id|config-&gt;Attributes
op_or_assign
id|CONF_ENABLE_IRQ
suffix:semicolon
id|config-&gt;BasePort1
op_assign
id|s-&gt;io
(braket
l_int|0
)braket
dot
id|BasePort
suffix:semicolon
id|config-&gt;NumPorts1
op_assign
id|s-&gt;io
(braket
l_int|0
)braket
dot
id|NumPorts
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
macro_line|#endif
id|c
op_assign
(paren
id|s-&gt;config
op_ne
l_int|NULL
)paren
ques
c_cond
op_amp
id|s-&gt;config
(braket
id|config-&gt;Function
)braket
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_eq
l_int|NULL
)paren
op_logical_or
op_logical_neg
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
)paren
(brace
id|config-&gt;Attributes
op_assign
l_int|0
suffix:semicolon
id|config-&gt;Vcc
op_assign
id|s-&gt;socket.Vcc
suffix:semicolon
id|config-&gt;Vpp1
op_assign
id|config-&gt;Vpp2
op_assign
id|s-&gt;socket.Vpp
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* !!! This is a hack !!! */
id|memcpy
c_func
(paren
op_amp
id|config-&gt;Attributes
comma
op_amp
id|c-&gt;Attributes
comma
r_sizeof
(paren
id|config_t
)paren
)paren
suffix:semicolon
id|config-&gt;Attributes
op_or_assign
id|CONF_VALID_CLIENT
suffix:semicolon
id|config-&gt;CardValues
op_assign
id|c-&gt;CardValues
suffix:semicolon
id|config-&gt;IRQAttributes
op_assign
id|c-&gt;irq.Attributes
suffix:semicolon
id|config-&gt;AssignedIRQ
op_assign
id|s-&gt;irq.AssignedIRQ
suffix:semicolon
id|config-&gt;BasePort1
op_assign
id|c-&gt;io.BasePort1
suffix:semicolon
id|config-&gt;NumPorts1
op_assign
id|c-&gt;io.NumPorts1
suffix:semicolon
id|config-&gt;Attributes1
op_assign
id|c-&gt;io.Attributes1
suffix:semicolon
id|config-&gt;BasePort2
op_assign
id|c-&gt;io.BasePort2
suffix:semicolon
id|config-&gt;NumPorts2
op_assign
id|c-&gt;io.NumPorts2
suffix:semicolon
id|config-&gt;Attributes2
op_assign
id|c-&gt;io.Attributes2
suffix:semicolon
id|config-&gt;IOAddrLines
op_assign
id|c-&gt;io.IOAddrLines
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_configuration_info */
multiline_comment|/*======================================================================&n;&n;    Return information about this version of Card Services.&n;    &n;======================================================================*/
DECL|function|pcmcia_get_card_services_info
r_int
id|pcmcia_get_card_services_info
c_func
(paren
id|servinfo_t
op_star
id|info
)paren
(brace
id|info-&gt;Signature
(braket
l_int|0
)braket
op_assign
l_char|&squot;C&squot;
suffix:semicolon
id|info-&gt;Signature
(braket
l_int|1
)braket
op_assign
l_char|&squot;S&squot;
suffix:semicolon
id|info-&gt;Count
op_assign
id|sockets
suffix:semicolon
id|info-&gt;Revision
op_assign
id|CS_RELEASE_CODE
suffix:semicolon
id|info-&gt;CSLevel
op_assign
l_int|0x0210
suffix:semicolon
id|info-&gt;VendorString
op_assign
(paren
r_char
op_star
)paren
id|release
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_card_services_info */
multiline_comment|/*======================================================================&n;&n;    Note that get_first_client() *does* recognize the Socket field&n;    in the request structure.&n;    &n;======================================================================*/
DECL|function|pcmcia_get_first_client
r_int
id|pcmcia_get_first_client
c_func
(paren
id|client_handle_t
op_star
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
id|socket_t
id|s
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|CLIENT_THIS_SOCKET
)paren
id|s
op_assign
id|req-&gt;Socket
suffix:semicolon
r_else
id|s
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_SOCKET
c_func
(paren
id|req-&gt;Socket
)paren
)paren
r_return
id|CS_BAD_SOCKET
suffix:semicolon
r_if
c_cond
(paren
id|socket_table
(braket
id|s
)braket
op_member_access_from_pointer
id|clients
op_eq
l_int|NULL
)paren
r_return
id|CS_NO_MORE_ITEMS
suffix:semicolon
op_star
id|handle
op_assign
id|socket_table
(braket
id|s
)braket
op_member_access_from_pointer
id|clients
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_first_client */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_get_next_client
r_int
id|pcmcia_get_next_client
c_func
(paren
id|client_handle_t
op_star
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
(paren
id|handle
op_eq
l_int|NULL
)paren
op_logical_or
id|CHECK_HANDLE
c_func
(paren
op_star
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|handle
)paren
op_member_access_from_pointer
id|next
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|CLIENT_THIS_SOCKET
)paren
r_return
id|CS_NO_MORE_ITEMS
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
op_star
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;clients
op_eq
l_int|NULL
)paren
r_return
id|CS_NO_MORE_ITEMS
suffix:semicolon
op_star
id|handle
op_assign
id|s-&gt;clients
suffix:semicolon
)brace
r_else
op_star
id|handle
op_assign
(paren
op_star
id|handle
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_next_client */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_get_window
r_int
id|pcmcia_get_window
c_func
(paren
id|window_handle_t
op_star
id|handle
comma
r_int
id|idx
comma
id|win_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|window_t
op_star
id|win
suffix:semicolon
r_int
id|w
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_eq
l_int|0
)paren
id|s
op_assign
id|SOCKET
c_func
(paren
(paren
id|client_handle_t
)paren
op_star
id|handle
)paren
suffix:semicolon
r_else
id|s
op_assign
(paren
op_star
id|handle
)paren
op_member_access_from_pointer
id|sock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_for
c_loop
(paren
id|w
op_assign
id|idx
suffix:semicolon
id|w
OL
id|MAX_WIN
suffix:semicolon
id|w
op_increment
)paren
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_WIN_REQ
c_func
(paren
id|w
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
id|MAX_WIN
)paren
r_return
id|CS_NO_MORE_ITEMS
suffix:semicolon
id|win
op_assign
op_amp
id|s-&gt;win
(braket
id|w
)braket
suffix:semicolon
id|req-&gt;Base
op_assign
id|win-&gt;ctl.sys_start
suffix:semicolon
id|req-&gt;Size
op_assign
id|win-&gt;ctl.sys_stop
op_minus
id|win-&gt;ctl.sys_start
op_plus
l_int|1
suffix:semicolon
id|req-&gt;AccessSpeed
op_assign
id|win-&gt;ctl.speed
suffix:semicolon
id|req-&gt;Attributes
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|win-&gt;ctl.flags
op_amp
id|MAP_ATTRIB
)paren
id|req-&gt;Attributes
op_or_assign
id|WIN_MEMORY_TYPE_AM
suffix:semicolon
r_if
c_cond
(paren
id|win-&gt;ctl.flags
op_amp
id|MAP_ACTIVE
)paren
id|req-&gt;Attributes
op_or_assign
id|WIN_ENABLE
suffix:semicolon
r_if
c_cond
(paren
id|win-&gt;ctl.flags
op_amp
id|MAP_16BIT
)paren
id|req-&gt;Attributes
op_or_assign
id|WIN_DATA_WIDTH_16
suffix:semicolon
r_if
c_cond
(paren
id|win-&gt;ctl.flags
op_amp
id|MAP_USE_WAIT
)paren
id|req-&gt;Attributes
op_or_assign
id|WIN_USE_WAIT
suffix:semicolon
op_star
id|handle
op_assign
id|win
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_window */
DECL|function|pcmcia_get_first_window
r_int
id|pcmcia_get_first_window
c_func
(paren
id|window_handle_t
op_star
id|win
comma
id|win_req_t
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
(paren
op_star
id|win
)paren
op_member_access_from_pointer
id|magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_return
id|pcmcia_get_window
c_func
(paren
id|win
comma
l_int|0
comma
id|req
)paren
suffix:semicolon
)brace
DECL|function|pcmcia_get_next_window
r_int
id|pcmcia_get_next_window
c_func
(paren
id|window_handle_t
op_star
id|win
comma
id|win_req_t
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
(paren
op_star
id|win
)paren
op_member_access_from_pointer
id|magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_return
id|pcmcia_get_window
c_func
(paren
id|win
comma
(paren
op_star
id|win
)paren
op_member_access_from_pointer
id|index
op_plus
l_int|1
comma
id|req
)paren
suffix:semicolon
)brace
multiline_comment|/*=====================================================================&n;&n;    Return the PCI device associated with a card..&n;&n;======================================================================*/
macro_line|#ifdef CONFIG_CARDBUS
DECL|function|pcmcia_lookup_bus
r_struct
id|pci_bus
op_star
id|pcmcia_lookup_bus
c_func
(paren
id|client_handle_t
id|handle
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_CARDBUS
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|s-&gt;cap.cb_dev-&gt;subordinate
suffix:semicolon
)brace
DECL|variable|pcmcia_lookup_bus
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_lookup_bus
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Get the current socket state bits.  We don&squot;t support the latched&n;    SocketState yet: I haven&squot;t seen any point for it.&n;    &n;======================================================================*/
DECL|function|pcmcia_get_status
r_int
id|pcmcia_get_status
c_func
(paren
id|client_handle_t
id|handle
comma
id|cs_status_t
op_star
id|status
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|val
)paren
suffix:semicolon
id|status-&gt;CardState
op_assign
id|status-&gt;SocketState
op_assign
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_DETECT
)paren
ques
c_cond
id|CS_EVENT_CARD_DETECT
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_CARDBUS
)paren
ques
c_cond
id|CS_EVENT_CB_DETECT
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_3VCARD
)paren
ques
c_cond
id|CS_EVENT_3VCARD
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_XVCARD
)paren
ques
c_cond
id|CS_EVENT_XVCARD
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
id|status-&gt;CardState
op_or_assign
id|CS_EVENT_PM_SUSPEND
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SETUP_PENDING
)paren
id|status-&gt;CardState
op_or_assign
id|CS_EVENT_CARD_INSERTION
suffix:semicolon
multiline_comment|/* Get info from the PRR, if necessary */
r_if
c_cond
(paren
id|handle-&gt;Function
op_eq
id|BIND_FN_ALL
)paren
(brace
r_if
c_cond
(paren
id|status-&gt;Function
op_logical_and
(paren
id|status-&gt;Function
op_ge
id|s-&gt;functions
)paren
)paren
r_return
id|CS_BAD_ARGS
suffix:semicolon
id|c
op_assign
(paren
id|s-&gt;config
op_ne
l_int|NULL
)paren
ques
c_cond
op_amp
id|s-&gt;config
(braket
id|status-&gt;Function
)braket
suffix:colon
l_int|NULL
suffix:semicolon
)brace
r_else
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
op_logical_and
(paren
id|c-&gt;IntType
op_amp
id|INT_MEMORY_AND_IO
)paren
)paren
(brace
id|u_char
id|reg
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;Present
op_amp
id|PRESENT_PIN_REPLACE
)paren
(brace
id|read_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|c-&gt;ConfigBase
op_plus
id|CISREG_PRR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|reg
)paren
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|reg
op_amp
id|PRR_WP_STATUS
)paren
ques
c_cond
id|CS_EVENT_WRITE_PROTECT
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|reg
op_amp
id|PRR_READY_STATUS
)paren
ques
c_cond
id|CS_EVENT_READY_CHANGE
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|reg
op_amp
id|PRR_BVD2_STATUS
)paren
ques
c_cond
id|CS_EVENT_BATTERY_LOW
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|reg
op_amp
id|PRR_BVD1_STATUS
)paren
ques
c_cond
id|CS_EVENT_BATTERY_DEAD
suffix:colon
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* No PRR?  Then assume we&squot;re always ready */
id|status-&gt;CardState
op_or_assign
id|CS_EVENT_READY_CHANGE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c-&gt;Present
op_amp
id|PRESENT_EXT_STATUS
)paren
(brace
id|read_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|c-&gt;ConfigBase
op_plus
id|CISREG_ESR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|reg
)paren
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|reg
op_amp
id|ESR_REQ_ATTN
)paren
ques
c_cond
id|CS_EVENT_REQUEST_ATTENTION
suffix:colon
l_int|0
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_WRPROT
)paren
ques
c_cond
id|CS_EVENT_WRITE_PROTECT
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_BATDEAD
)paren
ques
c_cond
id|CS_EVENT_BATTERY_DEAD
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_BATWARN
)paren
ques
c_cond
id|CS_EVENT_BATTERY_LOW
suffix:colon
l_int|0
suffix:semicolon
id|status-&gt;CardState
op_or_assign
(paren
id|val
op_amp
id|SS_READY
)paren
ques
c_cond
id|CS_EVENT_READY_CHANGE
suffix:colon
l_int|0
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_status */
multiline_comment|/*======================================================================&n;&n;    Change the card address of an already open memory window.&n;    &n;======================================================================*/
DECL|function|pcmcia_get_mem_page
r_int
id|pcmcia_get_mem_page
c_func
(paren
id|window_handle_t
id|win
comma
id|memreq_t
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|win-&gt;magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|req-&gt;Page
op_assign
l_int|0
suffix:semicolon
id|req-&gt;CardOffset
op_assign
id|win-&gt;ctl.card_start
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* get_mem_page */
DECL|function|pcmcia_map_mem_page
r_int
id|pcmcia_map_mem_page
c_func
(paren
id|window_handle_t
id|win
comma
id|memreq_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|win-&gt;magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Page
op_ne
l_int|0
)paren
r_return
id|CS_BAD_PAGE
suffix:semicolon
id|s
op_assign
id|win-&gt;sock
suffix:semicolon
id|win-&gt;ctl.card_start
op_assign
id|req-&gt;CardOffset
suffix:semicolon
r_if
c_cond
(paren
id|set_mem_map
c_func
(paren
id|s
comma
op_amp
id|win-&gt;ctl
)paren
op_ne
l_int|0
)paren
r_return
id|CS_BAD_OFFSET
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* map_mem_page */
multiline_comment|/*======================================================================&n;&n;    Modify a locked socket configuration&n;    &n;======================================================================*/
DECL|function|pcmcia_modify_configuration
r_int
id|pcmcia_modify_configuration
c_func
(paren
id|client_handle_t
id|handle
comma
id|modconf_t
op_star
id|mod
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
r_if
c_cond
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_IRQ_CHANGE_VALID
)paren
(brace
r_if
c_cond
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_ENABLE_IRQ
)paren
(brace
id|c-&gt;Attributes
op_or_assign
id|CONF_ENABLE_IRQ
suffix:semicolon
id|s-&gt;socket.io_irq
op_assign
id|s-&gt;irq.AssignedIRQ
suffix:semicolon
)brace
r_else
(brace
id|c-&gt;Attributes
op_and_assign
op_complement
id|CONF_ENABLE_IRQ
suffix:semicolon
id|s-&gt;socket.io_irq
op_assign
l_int|0
suffix:semicolon
)brace
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_VCC_CHANGE_VALID
)paren
r_return
id|CS_BAD_VCC
suffix:semicolon
multiline_comment|/* We only allow changing Vpp1 and Vpp2 to the same value */
r_if
c_cond
(paren
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_VPP1_CHANGE_VALID
)paren
op_logical_and
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_VPP2_CHANGE_VALID
)paren
)paren
(brace
r_if
c_cond
(paren
id|mod-&gt;Vpp1
op_ne
id|mod-&gt;Vpp2
)paren
r_return
id|CS_BAD_VPP
suffix:semicolon
id|c-&gt;Vpp1
op_assign
id|c-&gt;Vpp2
op_assign
id|s-&gt;socket.Vpp
op_assign
id|mod-&gt;Vpp1
suffix:semicolon
r_if
c_cond
(paren
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
)paren
r_return
id|CS_BAD_VPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_VPP1_CHANGE_VALID
)paren
op_logical_or
(paren
id|mod-&gt;Attributes
op_amp
id|CONF_VPP2_CHANGE_VALID
)paren
)paren
r_return
id|CS_BAD_VPP
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* modify_configuration */
multiline_comment|/*======================================================================&n;&n;    Modify the attributes of a window returned by RequestWindow.&n;&n;======================================================================*/
DECL|function|pcmcia_modify_window
r_int
id|pcmcia_modify_window
c_func
(paren
id|window_handle_t
id|win
comma
id|modwin_t
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|win-&gt;magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|win-&gt;ctl.flags
op_and_assign
op_complement
(paren
id|MAP_ATTRIB
op_or
id|MAP_ACTIVE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_MEMORY_TYPE
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_ATTRIB
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_ENABLE
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_DATA_WIDTH_16
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_USE_WAIT
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_USE_WAIT
suffix:semicolon
id|win-&gt;ctl.speed
op_assign
id|req-&gt;AccessSpeed
suffix:semicolon
id|set_mem_map
c_func
(paren
id|win-&gt;sock
comma
op_amp
id|win-&gt;ctl
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* modify_window */
multiline_comment|/*======================================================================&n;&n;    Register_client() uses the dev_info_t handle to match the&n;    caller with a socket.  The driver must have already been bound&n;    to a socket with bind_device() -- in fact, bind_device()&n;    allocates the client structure that will be used.&n;    &n;======================================================================*/
DECL|function|pcmcia_register_client
r_int
id|pcmcia_register_client
c_func
(paren
id|client_handle_t
op_star
id|handle
comma
id|client_reg_t
op_star
id|req
)paren
(brace
id|client_t
op_star
id|client
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
id|socket_t
id|ns
suffix:semicolon
multiline_comment|/* Look for unbound client with matching dev_info */
id|client
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|ns
op_assign
l_int|0
suffix:semicolon
id|ns
OL
id|sockets
suffix:semicolon
id|ns
op_increment
)paren
(brace
id|client
op_assign
id|socket_table
(braket
id|ns
)braket
op_member_access_from_pointer
id|clients
suffix:semicolon
r_while
c_loop
(paren
id|client
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|strcmp
c_func
(paren
id|client-&gt;dev_info
comma
(paren
r_char
op_star
)paren
id|req-&gt;dev_info
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|client-&gt;state
op_amp
id|CLIENT_UNBOUND
)paren
)paren
r_break
suffix:semicolon
id|client
op_assign
id|client-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|client
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|client
op_eq
l_int|NULL
)paren
r_return
id|CS_OUT_OF_RESOURCE
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|ns
)braket
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|s-&gt;real_clients
op_eq
l_int|1
)paren
(brace
r_int
id|status
suffix:semicolon
id|register_callback
c_func
(paren
id|s
comma
op_amp
id|parse_events
comma
id|s
)paren
suffix:semicolon
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SS_DETECT
)paren
op_logical_and
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_SETUP_PENDING
)paren
)paren
(brace
id|s-&gt;state
op_or_assign
id|SOCKET_SETUP_PENDING
suffix:semicolon
r_if
c_cond
(paren
id|setup_socket
c_func
(paren
id|s
)paren
op_eq
l_int|0
)paren
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_SETUP_PENDING
suffix:semicolon
)brace
)brace
op_star
id|handle
op_assign
id|client
suffix:semicolon
id|client-&gt;state
op_and_assign
op_complement
id|CLIENT_UNBOUND
suffix:semicolon
id|client-&gt;Socket
op_assign
id|ns
suffix:semicolon
id|client-&gt;Attributes
op_assign
id|req-&gt;Attributes
suffix:semicolon
id|client-&gt;EventMask
op_assign
id|req-&gt;EventMask
suffix:semicolon
id|client-&gt;event_handler
op_assign
id|req-&gt;event_handler
suffix:semicolon
id|client-&gt;event_callback_args
op_assign
id|req-&gt;event_callback_args
suffix:semicolon
id|client-&gt;event_callback_args.client_handle
op_assign
id|client
suffix:semicolon
id|client-&gt;event_callback_args.bus
op_assign
id|s-&gt;cap.bus
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_CARDBUS
)paren
id|client-&gt;state
op_or_assign
id|CLIENT_CARDBUS
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_CARDBUS
)paren
)paren
op_logical_and
(paren
id|s-&gt;functions
op_eq
l_int|0
)paren
op_logical_and
(paren
id|client-&gt;Function
op_ne
id|BIND_FN_ALL
)paren
)paren
(brace
id|cistpl_longlink_mfc_t
id|mfc
suffix:semicolon
r_if
c_cond
(paren
id|read_tuple
c_func
(paren
id|client
comma
id|CISTPL_LONGLINK_MFC
comma
op_amp
id|mfc
)paren
op_eq
id|CS_SUCCESS
)paren
id|s-&gt;functions
op_assign
id|mfc.nfn
suffix:semicolon
r_else
id|s-&gt;functions
op_assign
l_int|1
suffix:semicolon
id|s-&gt;config
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|config_t
)paren
op_star
id|s-&gt;functions
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|s-&gt;config
comma
l_int|0
comma
r_sizeof
(paren
id|config_t
)paren
op_star
id|s-&gt;functions
)paren
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: register_client(): client 0x%p, sock %d, dev %s&bslash;n&quot;
comma
id|client
comma
id|client-&gt;Socket
comma
id|client-&gt;dev_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;EventMask
op_amp
id|CS_EVENT_REGISTRATION_COMPLETE
)paren
id|EVENT
c_func
(paren
id|client
comma
id|CS_EVENT_REGISTRATION_COMPLETE
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|socket_table
(braket
id|ns
)braket
op_member_access_from_pointer
id|state
op_amp
id|SOCKET_PRESENT
)paren
op_logical_and
op_logical_neg
(paren
id|socket_table
(braket
id|ns
)braket
op_member_access_from_pointer
id|state
op_amp
id|SOCKET_SETUP_PENDING
)paren
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;EventMask
op_amp
id|CS_EVENT_CARD_INSERTION
)paren
id|EVENT
c_func
(paren
id|client
comma
id|CS_EVENT_CARD_INSERTION
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_else
id|client-&gt;PendingEvents
op_or_assign
id|CS_EVENT_CARD_INSERTION
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* register_client */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_release_configuration
r_int
id|pcmcia_release_configuration
c_func
(paren
id|client_handle_t
id|handle
)paren
(brace
id|pccard_io_map
id|io
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
op_logical_or
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_CONFIG_LOCKED
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|handle-&gt;state
op_and_assign
op_complement
id|CLIENT_CONFIG_LOCKED
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
id|CLIENT_CARDBUS
)paren
(brace
id|cb_disable
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;lock_count
op_assign
l_int|0
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_STALE
)paren
)paren
(brace
id|config_t
op_star
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
(paren
id|s-&gt;lock_count
)paren
op_eq
l_int|0
)paren
(brace
id|s-&gt;socket.flags
op_assign
id|SS_OUTPUT_ENA
suffix:semicolon
id|s-&gt;socket.Vpp
op_assign
l_int|0
suffix:semicolon
id|s-&gt;socket.io_irq
op_assign
l_int|0
suffix:semicolon
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_IO_REQ
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IO_WIN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|Config
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|Config
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
id|io.map
op_assign
id|i
suffix:semicolon
id|set_io_map
c_func
(paren
id|s
comma
op_amp
id|io
)paren
suffix:semicolon
)brace
id|c-&gt;state
op_and_assign
op_complement
id|CONFIG_LOCKED
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* release_configuration */
multiline_comment|/*======================================================================&n;&n;    Release_io() releases the I/O ranges allocated by a client.  This&n;    may be invoked some time after a card ejection has already dumped&n;    the actual socket configuration, so if the client is &quot;stale&quot;, we&n;    don&squot;t bother checking the port ranges against the current socket&n;    values.&n;    &n;======================================================================*/
DECL|function|pcmcia_release_io
r_int
id|pcmcia_release_io
c_func
(paren
id|client_handle_t
id|handle
comma
id|io_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
op_logical_or
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_IO_REQ
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|handle-&gt;state
op_and_assign
op_complement
id|CLIENT_IO_REQ
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
id|CLIENT_CARDBUS
)paren
(brace
id|cb_release
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_STALE
)paren
)paren
(brace
id|config_t
op_star
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c-&gt;io.BasePort1
op_ne
id|req-&gt;BasePort1
)paren
op_logical_or
(paren
id|c-&gt;io.NumPorts1
op_ne
id|req-&gt;NumPorts1
)paren
op_logical_or
(paren
id|c-&gt;io.BasePort2
op_ne
id|req-&gt;BasePort2
)paren
op_logical_or
(paren
id|c-&gt;io.NumPorts2
op_ne
id|req-&gt;NumPorts2
)paren
)paren
r_return
id|CS_BAD_ARGS
suffix:semicolon
id|c-&gt;state
op_and_assign
op_complement
id|CONFIG_IO_REQ
suffix:semicolon
)brace
id|release_io_space
c_func
(paren
id|s
comma
id|req-&gt;BasePort1
comma
id|req-&gt;NumPorts1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;NumPorts2
)paren
id|release_io_space
c_func
(paren
id|s
comma
id|req-&gt;BasePort2
comma
id|req-&gt;NumPorts2
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* release_io */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_release_irq
r_int
id|pcmcia_release_irq
c_func
(paren
id|client_handle_t
id|handle
comma
id|irq_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
op_logical_or
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_IRQ_REQ
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|handle-&gt;state
op_and_assign
op_complement
id|CLIENT_IRQ_REQ
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|handle-&gt;state
op_amp
id|CLIENT_STALE
)paren
)paren
(brace
id|config_t
op_star
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;irq.Attributes
op_ne
id|req-&gt;Attributes
)paren
r_return
id|CS_BAD_ATTRIBUTE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;irq.AssignedIRQ
op_ne
id|req-&gt;AssignedIRQ
)paren
r_return
id|CS_BAD_IRQ
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|s-&gt;irq.Config
op_eq
l_int|0
)paren
(brace
id|c-&gt;state
op_and_assign
op_complement
id|CONFIG_IRQ_REQ
suffix:semicolon
id|s-&gt;irq.AssignedIRQ
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|IRQ_HANDLE_PRESENT
)paren
(brace
id|bus_free_irq
c_func
(paren
id|s-&gt;cap.bus
comma
id|req-&gt;AssignedIRQ
comma
id|req-&gt;Instance
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISA
r_if
c_cond
(paren
id|req-&gt;AssignedIRQ
op_ne
id|s-&gt;cap.pci_irq
)paren
id|undo_irq
c_func
(paren
id|req-&gt;Attributes
comma
id|req-&gt;AssignedIRQ
)paren
suffix:semicolon
macro_line|#endif
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* cs_release_irq */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_release_window
r_int
id|pcmcia_release_window
c_func
(paren
id|window_handle_t
id|win
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
(paren
id|win
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|win-&gt;magic
op_ne
id|WINDOW_MAGIC
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|win-&gt;sock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|win-&gt;handle-&gt;state
op_amp
id|CLIENT_WIN_REQ
c_func
(paren
id|win-&gt;index
)paren
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
multiline_comment|/* Shut down memory window */
id|win-&gt;ctl.flags
op_and_assign
op_complement
id|MAP_ACTIVE
suffix:semicolon
id|set_mem_map
c_func
(paren
id|s
comma
op_amp
id|win-&gt;ctl
)paren
suffix:semicolon
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_WIN_REQ
c_func
(paren
id|win-&gt;index
)paren
suffix:semicolon
multiline_comment|/* Release system memory */
id|release_mem_region
c_func
(paren
id|win-&gt;base
comma
id|win-&gt;size
)paren
suffix:semicolon
id|win-&gt;handle-&gt;state
op_and_assign
op_complement
id|CLIENT_WIN_REQ
c_func
(paren
id|win-&gt;index
)paren
suffix:semicolon
id|win-&gt;magic
op_assign
l_int|0
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* release_window */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_request_configuration
r_int
id|pcmcia_request_configuration
c_func
(paren
id|client_handle_t
id|handle
comma
id|config_req_t
op_star
id|req
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_int
id|base
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
id|pccard_io_map
id|iomap
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
id|CLIENT_CARDBUS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|req-&gt;IntType
op_amp
id|INT_CARDBUS
)paren
)paren
r_return
id|CS_UNSUPPORTED_MODE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;lock_count
op_ne
l_int|0
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
id|cb_enable
c_func
(paren
id|s
)paren
suffix:semicolon
id|handle-&gt;state
op_or_assign
id|CLIENT_CONFIG_LOCKED
suffix:semicolon
id|s-&gt;lock_count
op_increment
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|req-&gt;IntType
op_amp
id|INT_CARDBUS
)paren
r_return
id|CS_UNSUPPORTED_MODE
suffix:semicolon
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
multiline_comment|/* Do power control.  We don&squot;t allow changes in Vcc. */
r_if
c_cond
(paren
id|s-&gt;socket.Vcc
op_ne
id|req-&gt;Vcc
)paren
r_return
id|CS_BAD_VCC
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Vpp1
op_ne
id|req-&gt;Vpp2
)paren
r_return
id|CS_BAD_VPP
suffix:semicolon
id|s-&gt;socket.Vpp
op_assign
id|req-&gt;Vpp1
suffix:semicolon
r_if
c_cond
(paren
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
)paren
r_return
id|CS_BAD_VPP
suffix:semicolon
id|c-&gt;Vcc
op_assign
id|req-&gt;Vcc
suffix:semicolon
id|c-&gt;Vpp1
op_assign
id|c-&gt;Vpp2
op_assign
id|req-&gt;Vpp1
suffix:semicolon
multiline_comment|/* Pick memory or I/O card, DMA mode, interrupt */
id|c-&gt;IntType
op_assign
id|req-&gt;IntType
suffix:semicolon
id|c-&gt;Attributes
op_assign
id|req-&gt;Attributes
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;IntType
op_amp
id|INT_MEMORY_AND_IO
)paren
id|s-&gt;socket.flags
op_or_assign
id|SS_IOCARD
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|CONF_ENABLE_DMA
)paren
id|s-&gt;socket.flags
op_or_assign
id|SS_DMA_MODE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|CONF_ENABLE_SPKR
)paren
id|s-&gt;socket.flags
op_or_assign
id|SS_SPKR_ENA
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|CONF_ENABLE_IRQ
)paren
id|s-&gt;socket.io_irq
op_assign
id|s-&gt;irq.AssignedIRQ
suffix:semicolon
r_else
id|s-&gt;socket.io_irq
op_assign
l_int|0
suffix:semicolon
id|set_socket
c_func
(paren
id|s
comma
op_amp
id|s-&gt;socket
)paren
suffix:semicolon
id|s-&gt;lock_count
op_increment
suffix:semicolon
multiline_comment|/* Set up CIS configuration registers */
id|base
op_assign
id|c-&gt;ConfigBase
op_assign
id|req-&gt;ConfigBase
suffix:semicolon
id|c-&gt;Present
op_assign
id|c-&gt;CardValues
op_assign
id|req-&gt;Present
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_COPY
)paren
(brace
id|c-&gt;Copy
op_assign
id|req-&gt;Copy
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_SCR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|c-&gt;Copy
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_OPTION
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;functions
op_eq
l_int|1
)paren
(brace
id|c-&gt;Option
op_assign
id|req-&gt;ConfigIndex
op_amp
id|COR_CONFIG_MASK
suffix:semicolon
)brace
r_else
(brace
id|c-&gt;Option
op_assign
id|req-&gt;ConfigIndex
op_amp
id|COR_MFC_CONFIG_MASK
suffix:semicolon
id|c-&gt;Option
op_or_assign
id|COR_FUNC_ENA
op_or
id|COR_IREQ_ENA
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_IOBASE_0
)paren
id|c-&gt;Option
op_or_assign
id|COR_ADDR_DECODE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_IRQ_REQ
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|c-&gt;irq.Attributes
op_amp
id|IRQ_FORCED_PULSE
)paren
)paren
id|c-&gt;Option
op_or_assign
id|COR_LEVEL_REQ
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_COR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|c-&gt;Option
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_STATUS
)paren
(brace
id|c-&gt;Status
op_assign
id|req-&gt;Status
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_CCSR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|c-&gt;Status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_PIN_REPLACE
)paren
(brace
id|c-&gt;Pin
op_assign
id|req-&gt;Pin
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_PRR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|c-&gt;Pin
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_EXT_STATUS
)paren
(brace
id|c-&gt;ExtStatus
op_assign
id|req-&gt;ExtStatus
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_ESR
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|c-&gt;ExtStatus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_IOBASE_0
)paren
(brace
id|u_char
id|b
op_assign
id|c-&gt;io.BasePort1
op_amp
l_int|0xff
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_IOBASE_0
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|b
)paren
suffix:semicolon
id|b
op_assign
(paren
id|c-&gt;io.BasePort1
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_IOBASE_1
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|b
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;Present
op_amp
id|PRESENT_IOSIZE
)paren
(brace
id|u_char
id|b
op_assign
id|c-&gt;io.NumPorts1
op_plus
id|c-&gt;io.NumPorts2
op_minus
l_int|1
suffix:semicolon
id|write_cis_mem
c_func
(paren
id|s
comma
l_int|1
comma
(paren
id|base
op_plus
id|CISREG_IOSIZE
)paren
op_rshift
l_int|1
comma
l_int|1
comma
op_amp
id|b
)paren
suffix:semicolon
)brace
multiline_comment|/* Configure I/O windows */
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_IO_REQ
)paren
(brace
id|iomap.speed
op_assign
id|io_speed
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IO_WIN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_ne
l_int|0
)paren
(brace
id|iomap.map
op_assign
id|i
suffix:semicolon
id|iomap.flags
op_assign
id|MAP_ACTIVE
suffix:semicolon
r_switch
c_cond
(paren
id|s-&gt;io
(braket
id|i
)braket
dot
id|Attributes
op_amp
id|IO_DATA_PATH_WIDTH
)paren
(brace
r_case
id|IO_DATA_PATH_WIDTH_16
suffix:colon
id|iomap.flags
op_or_assign
id|MAP_16BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IO_DATA_PATH_WIDTH_AUTO
suffix:colon
id|iomap.flags
op_or_assign
id|MAP_AUTOSZ
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|iomap.start
op_assign
id|s-&gt;io
(braket
id|i
)braket
dot
id|BasePort
suffix:semicolon
id|iomap.stop
op_assign
id|iomap.start
op_plus
id|s-&gt;io
(braket
id|i
)braket
dot
id|NumPorts
op_minus
l_int|1
suffix:semicolon
id|set_io_map
c_func
(paren
id|s
comma
op_amp
id|iomap
)paren
suffix:semicolon
id|s-&gt;io
(braket
id|i
)braket
dot
id|Config
op_increment
suffix:semicolon
)brace
)brace
id|c-&gt;state
op_or_assign
id|CONFIG_LOCKED
suffix:semicolon
id|handle-&gt;state
op_or_assign
id|CLIENT_CONFIG_LOCKED
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* request_configuration */
multiline_comment|/*======================================================================&n;  &n;    Request_io() reserves ranges of port addresses for a socket.&n;    I have not implemented range sharing or alias addressing.&n;    &n;======================================================================*/
DECL|function|pcmcia_request_io
r_int
id|pcmcia_request_io
c_func
(paren
id|client_handle_t
id|handle
comma
id|io_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;state
op_amp
id|CLIENT_CARDBUS
)paren
(brace
macro_line|#ifdef CONFIG_CARDBUS
r_int
id|ret
op_assign
id|cb_config
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|CS_SUCCESS
)paren
id|handle-&gt;state
op_or_assign
id|CLIENT_IO_REQ
suffix:semicolon
r_return
id|ret
suffix:semicolon
macro_line|#else
r_return
id|CS_UNSUPPORTED_FUNCTION
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
op_logical_neg
id|req
)paren
r_return
id|CS_UNSUPPORTED_MODE
suffix:semicolon
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_IO_REQ
)paren
r_return
id|CS_IN_USE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes1
op_amp
(paren
id|IO_SHARED
op_or
id|IO_FORCE_ALIAS_ACCESS
)paren
)paren
r_return
id|CS_BAD_ATTRIBUTE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req-&gt;NumPorts2
OG
l_int|0
)paren
op_logical_and
(paren
id|req-&gt;Attributes2
op_amp
(paren
id|IO_SHARED
op_or
id|IO_FORCE_ALIAS_ACCESS
)paren
)paren
)paren
r_return
id|CS_BAD_ATTRIBUTE
suffix:semicolon
r_if
c_cond
(paren
id|alloc_io_space
c_func
(paren
id|s
comma
id|req-&gt;Attributes1
comma
op_amp
id|req-&gt;BasePort1
comma
id|req-&gt;NumPorts1
comma
id|req-&gt;IOAddrLines
comma
id|handle-&gt;dev_info
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;NumPorts2
)paren
(brace
r_if
c_cond
(paren
id|alloc_io_space
c_func
(paren
id|s
comma
id|req-&gt;Attributes2
comma
op_amp
id|req-&gt;BasePort2
comma
id|req-&gt;NumPorts2
comma
id|req-&gt;IOAddrLines
comma
id|handle-&gt;dev_info
)paren
)paren
(brace
id|release_io_space
c_func
(paren
id|s
comma
id|req-&gt;BasePort1
comma
id|req-&gt;NumPorts1
)paren
suffix:semicolon
r_return
id|CS_IN_USE
suffix:semicolon
)brace
)brace
id|c-&gt;io
op_assign
op_star
id|req
suffix:semicolon
id|c-&gt;state
op_or_assign
id|CONFIG_IO_REQ
suffix:semicolon
id|handle-&gt;state
op_or_assign
id|CLIENT_IO_REQ
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* request_io */
multiline_comment|/*======================================================================&n;&n;    Request_irq() reserves an irq for this client.&n;&n;    Also, since Linux only reserves irq&squot;s when they are actually&n;    hooked, we don&squot;t guarantee that an irq will still be available&n;    when the configuration is locked.  Now that I think about it,&n;    there might be a way to fix this using a dummy handler.&n;    &n;======================================================================*/
DECL|function|pcmcia_request_irq
r_int
id|pcmcia_request_irq
c_func
(paren
id|client_handle_t
id|handle
comma
id|irq_req_t
op_star
id|req
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|config_t
op_star
id|c
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
comma
id|irq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
id|c
op_assign
id|CONFIG
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_LOCKED
)paren
r_return
id|CS_CONFIGURATION_LOCKED
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;state
op_amp
id|CONFIG_IRQ_REQ
)paren
r_return
id|CS_IN_USE
suffix:semicolon
multiline_comment|/* Short cut: if there are no ISA interrupts, then it is PCI */
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;cap.irq_mask
)paren
(brace
id|irq
op_assign
id|s-&gt;cap.pci_irq
suffix:semicolon
id|ret
op_assign
(paren
id|irq
)paren
ques
c_cond
l_int|0
suffix:colon
id|CS_IN_USE
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;irq.AssignedIRQ
op_ne
l_int|0
)paren
(brace
multiline_comment|/* If the interrupt is already assigned, it must match */
id|irq
op_assign
id|s-&gt;irq.AssignedIRQ
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;IRQInfo1
op_amp
id|IRQ_INFO2_VALID
)paren
(brace
id|u_int
id|mask
op_assign
id|req-&gt;IRQInfo2
op_amp
id|s-&gt;cap.irq_mask
suffix:semicolon
id|ret
op_assign
(paren
(paren
id|mask
op_rshift
id|irq
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_int|0
suffix:colon
id|CS_BAD_ARGS
suffix:semicolon
)brace
r_else
id|ret
op_assign
(paren
(paren
id|req-&gt;IRQInfo1
op_amp
id|IRQ_MASK
)paren
op_eq
id|irq
)paren
ques
c_cond
l_int|0
suffix:colon
id|CS_BAD_ARGS
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|CS_IN_USE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;IRQInfo1
op_amp
id|IRQ_INFO2_VALID
)paren
(brace
id|u_int
r_try
comma
id|mask
op_assign
id|req-&gt;IRQInfo2
op_amp
id|s-&gt;cap.irq_mask
suffix:semicolon
r_for
c_loop
(paren
r_try
op_assign
l_int|0
suffix:semicolon
r_try
OL
l_int|2
suffix:semicolon
r_try
op_increment
)paren
(brace
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
l_int|32
suffix:semicolon
id|irq
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask
op_rshift
id|irq
)paren
op_amp
l_int|1
)paren
(brace
id|ret
op_assign
id|try_irq
c_func
(paren
id|req-&gt;Attributes
comma
id|irq
comma
r_try
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|irq
op_assign
id|req-&gt;IRQInfo1
op_amp
id|IRQ_MASK
suffix:semicolon
id|ret
op_assign
id|try_irq
c_func
(paren
id|req-&gt;Attributes
comma
id|irq
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|IRQ_HANDLE_PRESENT
)paren
(brace
r_if
c_cond
(paren
id|bus_request_irq
c_func
(paren
id|s-&gt;cap.bus
comma
id|irq
comma
id|req-&gt;Handler
comma
(paren
(paren
id|req-&gt;Attributes
op_amp
id|IRQ_TYPE_DYNAMIC_SHARING
)paren
op_logical_or
(paren
id|s-&gt;functions
OG
l_int|1
)paren
op_logical_or
(paren
id|irq
op_eq
id|s-&gt;cap.pci_irq
)paren
)paren
ques
c_cond
id|SA_SHIRQ
suffix:colon
l_int|0
comma
id|handle-&gt;dev_info
comma
id|req-&gt;Instance
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
)brace
id|c-&gt;irq.Attributes
op_assign
id|req-&gt;Attributes
suffix:semicolon
id|s-&gt;irq.AssignedIRQ
op_assign
id|req-&gt;AssignedIRQ
op_assign
id|irq
suffix:semicolon
id|s-&gt;irq.Config
op_increment
suffix:semicolon
id|c-&gt;state
op_or_assign
id|CONFIG_IRQ_REQ
suffix:semicolon
id|handle-&gt;state
op_or_assign
id|CLIENT_IRQ_REQ
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* pcmcia_request_irq */
multiline_comment|/*======================================================================&n;&n;    Request_window() establishes a mapping between card memory space&n;    and system memory space.&n;&n;======================================================================*/
DECL|function|pcmcia_request_window
r_int
id|pcmcia_request_window
c_func
(paren
id|client_handle_t
op_star
id|handle
comma
id|win_req_t
op_star
id|req
comma
id|window_handle_t
op_star
id|wh
)paren
(brace
id|socket_info_t
op_star
id|s
suffix:semicolon
id|window_t
op_star
id|win
suffix:semicolon
id|u_long
id|align
suffix:semicolon
r_int
id|w
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
op_star
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|s
op_assign
id|SOCKET
c_func
(paren
op_star
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
(paren
id|WIN_PAGED
op_or
id|WIN_SHARED
)paren
)paren
r_return
id|CS_BAD_ATTRIBUTE
suffix:semicolon
multiline_comment|/* Window size defaults to smallest available */
r_if
c_cond
(paren
id|req-&gt;Size
op_eq
l_int|0
)paren
id|req-&gt;Size
op_assign
id|s-&gt;cap.map_size
suffix:semicolon
id|align
op_assign
(paren
(paren
(paren
id|s-&gt;cap.features
op_amp
id|SS_CAP_MEM_ALIGN
)paren
op_logical_or
(paren
id|req-&gt;Attributes
op_amp
id|WIN_STRICT_ALIGN
)paren
)paren
ques
c_cond
id|req-&gt;Size
suffix:colon
id|s-&gt;cap.map_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Size
op_amp
(paren
id|s-&gt;cap.map_size
op_minus
l_int|1
)paren
)paren
r_return
id|CS_BAD_SIZE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req-&gt;Base
op_logical_and
(paren
id|s-&gt;cap.features
op_amp
id|SS_CAP_STATIC_MAP
)paren
)paren
op_logical_or
(paren
id|req-&gt;Base
op_amp
(paren
id|align
op_minus
l_int|1
)paren
)paren
)paren
r_return
id|CS_BAD_BASE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Base
)paren
id|align
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Allocate system memory window */
r_for
c_loop
(paren
id|w
op_assign
l_int|0
suffix:semicolon
id|w
OL
id|MAX_WIN
suffix:semicolon
id|w
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_WIN_REQ
c_func
(paren
id|w
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
id|MAX_WIN
)paren
r_return
id|CS_OUT_OF_RESOURCE
suffix:semicolon
id|win
op_assign
op_amp
id|s-&gt;win
(braket
id|w
)braket
suffix:semicolon
id|win-&gt;magic
op_assign
id|WINDOW_MAGIC
suffix:semicolon
id|win-&gt;index
op_assign
id|w
suffix:semicolon
id|win-&gt;handle
op_assign
op_star
id|handle
suffix:semicolon
id|win-&gt;sock
op_assign
id|s
suffix:semicolon
id|win-&gt;base
op_assign
id|req-&gt;Base
suffix:semicolon
id|win-&gt;size
op_assign
id|req-&gt;Size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;cap.features
op_amp
id|SS_CAP_STATIC_MAP
)paren
op_logical_and
id|find_mem_region
c_func
(paren
op_amp
id|win-&gt;base
comma
id|win-&gt;size
comma
id|align
comma
(paren
id|req-&gt;Attributes
op_amp
id|WIN_MAP_BELOW_1MB
)paren
op_logical_or
op_logical_neg
(paren
id|s-&gt;cap.features
op_amp
id|SS_CAP_PAGE_REGS
)paren
comma
(paren
op_star
id|handle
)paren
op_member_access_from_pointer
id|dev_info
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
(paren
op_star
id|handle
)paren
op_member_access_from_pointer
id|state
op_or_assign
id|CLIENT_WIN_REQ
c_func
(paren
id|w
)paren
suffix:semicolon
multiline_comment|/* Configure the socket controller */
id|win-&gt;ctl.map
op_assign
id|w
op_plus
l_int|1
suffix:semicolon
id|win-&gt;ctl.flags
op_assign
l_int|0
suffix:semicolon
id|win-&gt;ctl.speed
op_assign
id|req-&gt;AccessSpeed
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_MEMORY_TYPE
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_ATTRIB
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_ENABLE
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_DATA_WIDTH_16
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;Attributes
op_amp
id|WIN_USE_WAIT
)paren
id|win-&gt;ctl.flags
op_or_assign
id|MAP_USE_WAIT
suffix:semicolon
id|win-&gt;ctl.sys_start
op_assign
id|win-&gt;base
suffix:semicolon
id|win-&gt;ctl.sys_stop
op_assign
id|win-&gt;base
op_plus
id|win-&gt;size
op_minus
l_int|1
suffix:semicolon
id|win-&gt;ctl.card_start
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|set_mem_map
c_func
(paren
id|s
comma
op_amp
id|win-&gt;ctl
)paren
op_ne
l_int|0
)paren
r_return
id|CS_BAD_ARGS
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_WIN_REQ
c_func
(paren
id|w
)paren
suffix:semicolon
multiline_comment|/* Return window handle */
id|req-&gt;Base
op_assign
id|win-&gt;ctl.sys_start
suffix:semicolon
op_star
id|wh
op_assign
id|win
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* request_window */
multiline_comment|/*======================================================================&n;&n;    I&squot;m not sure which &quot;reset&quot; function this is supposed to use,&n;    but for now, it uses the low-level interface&squot;s reset, not the&n;    CIS register.&n;    &n;======================================================================*/
DECL|function|pcmcia_reset_card
r_int
id|pcmcia_reset_card
c_func
(paren
id|client_handle_t
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_RESET_PENDING
)paren
r_return
id|CS_IN_USE
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_RESET_PENDING
suffix:semicolon
id|ret
op_assign
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_RESET_REQUEST
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
(brace
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_RESET_PENDING
suffix:semicolon
id|handle-&gt;event_callback_args.info
op_assign
(paren
r_void
op_star
)paren
(paren
id|u_long
)paren
id|ret
suffix:semicolon
id|EVENT
c_func
(paren
id|handle
comma
id|CS_EVENT_RESET_COMPLETE
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: resetting socket %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_RESET_PHYSICAL
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
id|s-&gt;reset_handle
op_assign
id|handle
suffix:semicolon
id|reset_socket
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* reset_card */
multiline_comment|/*======================================================================&n;&n;    These shut down or wake up a socket.  They are sort of user&n;    initiated versions of the APM suspend and resume actions.&n;    &n;======================================================================*/
DECL|function|pcmcia_suspend_card
r_int
id|pcmcia_suspend_card
c_func
(paren
id|client_handle_t
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
r_int
id|i
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
r_return
id|CS_IN_USE
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: suspending socket %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_PM_SUSPEND
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
id|suspend_socket
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;state
op_or_assign
id|SOCKET_SUSPEND
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* suspend_card */
DECL|function|pcmcia_resume_card
r_int
id|pcmcia_resume_card
c_func
(paren
id|client_handle_t
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
r_int
id|i
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_SUSPEND
)paren
)paren
r_return
id|CS_IN_USE
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: waking up socket %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|setup_socket
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* resume_card */
multiline_comment|/*======================================================================&n;&n;    These handle user requests to eject or insert a card.&n;    &n;======================================================================*/
DECL|function|pcmcia_eject_card
r_int
id|pcmcia_eject_card
c_func
(paren
id|client_handle_t
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
id|CS_NO_CARD
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: user eject request on socket %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|ret
op_assign
id|send_event
c_func
(paren
id|s
comma
id|CS_EVENT_EJECTION_REQUEST
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|do_shutdown
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* eject_card */
DECL|function|pcmcia_insert_card
r_int
id|pcmcia_insert_card
c_func
(paren
id|client_handle_t
id|handle
comma
id|client_req_t
op_star
id|req
)paren
(brace
r_int
id|i
comma
id|status
suffix:semicolon
id|socket_info_t
op_star
id|s
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
id|i
op_assign
id|handle-&gt;Socket
suffix:semicolon
id|s
op_assign
id|socket_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
r_return
id|CS_IN_USE
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;cs: user insert request on socket %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_SETUP_PENDING
)paren
)paren
(brace
id|s-&gt;state
op_or_assign
id|SOCKET_SETUP_PENDING
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|get_socket_status
c_func
(paren
id|s
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SS_DETECT
)paren
op_eq
l_int|0
op_logical_or
(paren
id|setup_socket
c_func
(paren
id|s
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|s-&gt;state
op_and_assign
op_complement
id|SOCKET_SETUP_PENDING
suffix:semicolon
r_return
id|CS_NO_CARD
suffix:semicolon
)brace
)brace
r_else
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* insert_card */
multiline_comment|/*======================================================================&n;&n;    Maybe this should send a CS_EVENT_CARD_INSERTION event if we&n;    haven&squot;t sent one to this client yet?&n;    &n;======================================================================*/
DECL|function|pcmcia_set_event_mask
r_int
id|pcmcia_set_event_mask
c_func
(paren
id|client_handle_t
id|handle
comma
id|eventmask_t
op_star
id|mask
)paren
(brace
id|u_int
id|events
comma
id|bit
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
r_return
id|CS_BAD_HANDLE
suffix:semicolon
r_if
c_cond
(paren
id|handle-&gt;Attributes
op_amp
id|CONF_EVENT_MASK_VALID
)paren
r_return
id|CS_BAD_SOCKET
suffix:semicolon
id|handle-&gt;EventMask
op_assign
id|mask-&gt;EventMask
suffix:semicolon
id|events
op_assign
id|handle-&gt;PendingEvents
op_amp
id|handle-&gt;EventMask
suffix:semicolon
id|handle-&gt;PendingEvents
op_sub_assign
id|events
suffix:semicolon
r_while
c_loop
(paren
id|events
op_ne
l_int|0
)paren
(brace
id|bit
op_assign
(paren
(paren
id|events
op_xor
(paren
id|events
op_minus
l_int|1
)paren
)paren
op_plus
l_int|1
)paren
op_rshift
l_int|1
suffix:semicolon
id|EVENT
c_func
(paren
id|handle
comma
id|bit
comma
id|CS_EVENT_PRI_LOW
)paren
suffix:semicolon
id|events
op_sub_assign
id|bit
suffix:semicolon
)brace
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* set_event_mask */
multiline_comment|/*====================================================================*/
DECL|function|pcmcia_report_error
r_int
id|pcmcia_report_error
c_func
(paren
id|client_handle_t
id|handle
comma
id|error_info_t
op_star
id|err
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|serv
suffix:semicolon
r_if
c_cond
(paren
id|CHECK_HANDLE
c_func
(paren
id|handle
)paren
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: &quot;
comma
id|handle-&gt;dev_info
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SERVICE_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|service_table
(braket
id|i
)braket
dot
id|key
op_eq
id|err-&gt;func
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|SERVICE_COUNT
)paren
id|serv
op_assign
id|service_table
(braket
id|i
)braket
dot
id|msg
suffix:semicolon
r_else
id|serv
op_assign
l_string|&quot;Unknown service number&quot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ERROR_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|error_table
(braket
id|i
)braket
dot
id|key
op_eq
id|err-&gt;retcode
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|ERROR_COUNT
)paren
id|printk
c_func
(paren
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|serv
comma
id|error_table
(braket
id|i
)braket
dot
id|msg
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s: Unknown error code %#x&bslash;n&quot;
comma
id|serv
comma
id|err-&gt;retcode
)paren
suffix:semicolon
r_return
id|CS_SUCCESS
suffix:semicolon
)brace
multiline_comment|/* report_error */
multiline_comment|/*====================================================================*/
DECL|function|CardServices
r_int
id|CardServices
c_func
(paren
r_int
id|func
comma
r_void
op_star
id|a1
comma
r_void
op_star
id|a2
comma
r_void
op_star
id|a3
)paren
(brace
macro_line|#ifdef PCMCIA_DEBUG
r_if
c_cond
(paren
id|pc_debug
OG
l_int|2
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SERVICE_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|service_table
(braket
id|i
)braket
dot
id|key
op_eq
id|func
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|SERVICE_COUNT
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;cs: CardServices(%s, 0x%p, 0x%p)&bslash;n&quot;
comma
id|service_table
(braket
id|i
)braket
dot
id|msg
comma
id|a1
comma
id|a2
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;cs: CardServices(Unknown func %d, &quot;
l_string|&quot;0x%p, 0x%p)&bslash;n&quot;
comma
id|func
comma
id|a1
comma
id|a2
)paren
suffix:semicolon
)brace
macro_line|#endif
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
id|AccessConfigurationRegister
suffix:colon
r_return
id|pcmcia_access_configuration_register
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AdjustResourceInfo
suffix:colon
r_return
id|pcmcia_adjust_resource_info
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CheckEraseQueue
suffix:colon
r_return
id|pcmcia_check_erase_queue
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CloseMemory
suffix:colon
r_return
id|pcmcia_close_memory
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CopyMemory
suffix:colon
r_return
id|pcmcia_copy_memory
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DeregisterClient
suffix:colon
r_return
id|pcmcia_deregister_client
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DeregisterEraseQueue
suffix:colon
r_return
id|pcmcia_deregister_erase_queue
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetFirstClient
suffix:colon
r_return
id|pcmcia_get_first_client
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetCardServicesInfo
suffix:colon
r_return
id|pcmcia_get_card_services_info
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetConfigurationInfo
suffix:colon
r_return
id|pcmcia_get_configuration_info
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetNextClient
suffix:colon
r_return
id|pcmcia_get_next_client
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetFirstRegion
suffix:colon
r_return
id|pcmcia_get_first_region
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetFirstTuple
suffix:colon
r_return
id|pcmcia_get_first_tuple
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetNextRegion
suffix:colon
r_return
id|pcmcia_get_next_region
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetNextTuple
suffix:colon
r_return
id|pcmcia_get_next_tuple
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetStatus
suffix:colon
r_return
id|pcmcia_get_status
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetTupleData
suffix:colon
r_return
id|pcmcia_get_tuple_data
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MapMemPage
suffix:colon
r_return
id|pcmcia_map_mem_page
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ModifyConfiguration
suffix:colon
r_return
id|pcmcia_modify_configuration
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ModifyWindow
suffix:colon
r_return
id|pcmcia_modify_window
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OpenMemory
suffix:colon
multiline_comment|/*&t;return pcmcia_open_memory(a1, a2); */
(brace
id|memory_handle_t
id|m
suffix:semicolon
r_int
id|ret
op_assign
id|pcmcia_open_memory
c_func
(paren
id|a1
comma
id|a2
comma
op_amp
id|m
)paren
suffix:semicolon
op_star
(paren
id|memory_handle_t
op_star
)paren
id|a1
op_assign
id|m
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ParseTuple
suffix:colon
r_return
id|pcmcia_parse_tuple
c_func
(paren
id|a1
comma
id|a2
comma
id|a3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReadMemory
suffix:colon
r_return
id|pcmcia_read_memory
c_func
(paren
id|a1
comma
id|a2
comma
id|a3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RegisterClient
suffix:colon
r_return
id|pcmcia_register_client
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RegisterEraseQueue
suffix:colon
(brace
id|eraseq_handle_t
id|w
suffix:semicolon
r_int
id|ret
op_assign
id|pcmcia_register_erase_queue
c_func
(paren
id|a1
comma
id|a2
comma
op_amp
id|w
)paren
suffix:semicolon
op_star
(paren
id|eraseq_handle_t
op_star
)paren
id|a1
op_assign
id|w
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/*&t;return pcmcia_register_erase_queue(a1, a2); break; */
r_return
id|pcmcia_register_mtd
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReleaseConfiguration
suffix:colon
r_return
id|pcmcia_release_configuration
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReleaseIO
suffix:colon
r_return
id|pcmcia_release_io
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReleaseIRQ
suffix:colon
r_return
id|pcmcia_release_irq
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReleaseWindow
suffix:colon
r_return
id|pcmcia_release_window
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RequestConfiguration
suffix:colon
r_return
id|pcmcia_request_configuration
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RequestIO
suffix:colon
r_return
id|pcmcia_request_io
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RequestIRQ
suffix:colon
r_return
id|pcmcia_request_irq
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RequestWindow
suffix:colon
(brace
id|window_handle_t
id|w
suffix:semicolon
r_int
id|ret
op_assign
id|pcmcia_request_window
c_func
(paren
id|a1
comma
id|a2
comma
op_amp
id|w
)paren
suffix:semicolon
op_star
(paren
id|window_handle_t
op_star
)paren
id|a1
op_assign
id|w
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ResetCard
suffix:colon
r_return
id|pcmcia_reset_card
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SetEventMask
suffix:colon
r_return
id|pcmcia_set_event_mask
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ValidateCIS
suffix:colon
r_return
id|pcmcia_validate_cis
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WriteMemory
suffix:colon
r_return
id|pcmcia_write_memory
c_func
(paren
id|a1
comma
id|a2
comma
id|a3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BindDevice
suffix:colon
r_return
id|pcmcia_bind_device
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BindMTD
suffix:colon
r_return
id|pcmcia_bind_mtd
c_func
(paren
id|a1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReportError
suffix:colon
r_return
id|pcmcia_report_error
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SuspendCard
suffix:colon
r_return
id|pcmcia_suspend_card
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ResumeCard
suffix:colon
r_return
id|pcmcia_resume_card
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EjectCard
suffix:colon
r_return
id|pcmcia_eject_card
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|InsertCard
suffix:colon
r_return
id|pcmcia_insert_card
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ReplaceCIS
suffix:colon
r_return
id|pcmcia_replace_cis
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetFirstWindow
suffix:colon
r_return
id|pcmcia_get_first_window
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetNextWindow
suffix:colon
r_return
id|pcmcia_get_next_window
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GetMemPage
suffix:colon
r_return
id|pcmcia_get_mem_page
c_func
(paren
id|a1
comma
id|a2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|CS_UNSUPPORTED_FUNCTION
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* CardServices */
multiline_comment|/*======================================================================&n;&n;    OS-specific module glue goes here&n;    &n;======================================================================*/
multiline_comment|/* in alpha order */
DECL|variable|pcmcia_access_configuration_register
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_access_configuration_register
)paren
suffix:semicolon
DECL|variable|pcmcia_adjust_resource_info
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_adjust_resource_info
)paren
suffix:semicolon
DECL|variable|pcmcia_bind_device
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_bind_device
)paren
suffix:semicolon
DECL|variable|pcmcia_bind_mtd
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_bind_mtd
)paren
suffix:semicolon
DECL|variable|pcmcia_check_erase_queue
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_check_erase_queue
)paren
suffix:semicolon
DECL|variable|pcmcia_close_memory
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_close_memory
)paren
suffix:semicolon
DECL|variable|pcmcia_copy_memory
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_copy_memory
)paren
suffix:semicolon
DECL|variable|pcmcia_deregister_client
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_deregister_client
)paren
suffix:semicolon
DECL|variable|pcmcia_deregister_erase_queue
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_deregister_erase_queue
)paren
suffix:semicolon
DECL|variable|pcmcia_eject_card
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_eject_card
)paren
suffix:semicolon
DECL|variable|pcmcia_get_first_client
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_first_client
)paren
suffix:semicolon
DECL|variable|pcmcia_get_card_services_info
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_card_services_info
)paren
suffix:semicolon
DECL|variable|pcmcia_get_configuration_info
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_configuration_info
)paren
suffix:semicolon
DECL|variable|pcmcia_get_mem_page
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_mem_page
)paren
suffix:semicolon
DECL|variable|pcmcia_get_next_client
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_next_client
)paren
suffix:semicolon
DECL|variable|pcmcia_get_first_region
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_first_region
)paren
suffix:semicolon
DECL|variable|pcmcia_get_first_tuple
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_first_tuple
)paren
suffix:semicolon
DECL|variable|pcmcia_get_first_window
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_first_window
)paren
suffix:semicolon
DECL|variable|pcmcia_get_next_region
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_next_region
)paren
suffix:semicolon
DECL|variable|pcmcia_get_next_tuple
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_next_tuple
)paren
suffix:semicolon
DECL|variable|pcmcia_get_next_window
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_next_window
)paren
suffix:semicolon
DECL|variable|pcmcia_get_status
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_status
)paren
suffix:semicolon
DECL|variable|pcmcia_get_tuple_data
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_get_tuple_data
)paren
suffix:semicolon
DECL|variable|pcmcia_insert_card
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_insert_card
)paren
suffix:semicolon
DECL|variable|pcmcia_map_mem_page
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_map_mem_page
)paren
suffix:semicolon
DECL|variable|pcmcia_modify_configuration
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_modify_configuration
)paren
suffix:semicolon
DECL|variable|pcmcia_modify_window
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_modify_window
)paren
suffix:semicolon
DECL|variable|pcmcia_open_memory
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_open_memory
)paren
suffix:semicolon
DECL|variable|pcmcia_parse_tuple
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_parse_tuple
)paren
suffix:semicolon
DECL|variable|pcmcia_read_memory
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_read_memory
)paren
suffix:semicolon
DECL|variable|pcmcia_register_client
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_register_client
)paren
suffix:semicolon
DECL|variable|pcmcia_register_erase_queue
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_register_erase_queue
)paren
suffix:semicolon
DECL|variable|pcmcia_register_mtd
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_register_mtd
)paren
suffix:semicolon
DECL|variable|pcmcia_release_configuration
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_release_configuration
)paren
suffix:semicolon
DECL|variable|pcmcia_release_io
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_release_io
)paren
suffix:semicolon
DECL|variable|pcmcia_release_irq
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_release_irq
)paren
suffix:semicolon
DECL|variable|pcmcia_release_window
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_release_window
)paren
suffix:semicolon
DECL|variable|pcmcia_replace_cis
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_replace_cis
)paren
suffix:semicolon
DECL|variable|pcmcia_report_error
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_report_error
)paren
suffix:semicolon
DECL|variable|pcmcia_request_configuration
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_request_configuration
)paren
suffix:semicolon
DECL|variable|pcmcia_request_io
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_request_io
)paren
suffix:semicolon
DECL|variable|pcmcia_request_irq
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_request_irq
)paren
suffix:semicolon
DECL|variable|pcmcia_request_window
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_request_window
)paren
suffix:semicolon
DECL|variable|pcmcia_reset_card
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_reset_card
)paren
suffix:semicolon
DECL|variable|pcmcia_resume_card
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_resume_card
)paren
suffix:semicolon
DECL|variable|pcmcia_set_event_mask
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_set_event_mask
)paren
suffix:semicolon
DECL|variable|pcmcia_suspend_card
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_suspend_card
)paren
suffix:semicolon
DECL|variable|pcmcia_validate_cis
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_validate_cis
)paren
suffix:semicolon
DECL|variable|pcmcia_write_memory
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_write_memory
)paren
suffix:semicolon
DECL|variable|dead_socket
id|EXPORT_SYMBOL
c_func
(paren
id|dead_socket
)paren
suffix:semicolon
DECL|variable|register_ss_entry
id|EXPORT_SYMBOL
c_func
(paren
id|register_ss_entry
)paren
suffix:semicolon
DECL|variable|unregister_ss_entry
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_ss_entry
)paren
suffix:semicolon
DECL|variable|CardServices
id|EXPORT_SYMBOL
c_func
(paren
id|CardServices
)paren
suffix:semicolon
DECL|variable|MTDHelperEntry
id|EXPORT_SYMBOL
c_func
(paren
id|MTDHelperEntry
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|proc_pccard
id|EXPORT_SYMBOL
c_func
(paren
id|proc_pccard
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|pcmcia_register_socket
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_register_socket
)paren
suffix:semicolon
DECL|variable|pcmcia_unregister_socket
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_unregister_socket
)paren
suffix:semicolon
DECL|variable|pcmcia_suspend_socket
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_suspend_socket
)paren
suffix:semicolon
DECL|variable|pcmcia_resume_socket
id|EXPORT_SYMBOL
c_func
(paren
id|pcmcia_resume_socket
)paren
suffix:semicolon
DECL|function|init_pcmcia_cs
r_static
r_int
id|__init
id|init_pcmcia_cs
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|release
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  %s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_apm
)paren
id|pm_register
c_func
(paren
id|PM_SYS_DEV
comma
id|PM_SYS_PCMCIA
comma
id|handle_pm_event
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_pccard
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;pccard&quot;
comma
id|proc_bus
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|exit_pcmcia_cs
r_static
r_void
id|__exit
id|exit_pcmcia_cs
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;unloading PCMCIA Card Services&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|proc_pccard
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;pccard&quot;
comma
id|proc_bus
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|do_apm
)paren
id|pm_unregister_all
c_func
(paren
id|handle_pm_event
)paren
suffix:semicolon
id|release_resource_db
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|init_pcmcia_cs
id|module_init
c_func
(paren
id|init_pcmcia_cs
)paren
suffix:semicolon
DECL|variable|exit_pcmcia_cs
id|module_exit
c_func
(paren
id|exit_pcmcia_cs
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
eof
