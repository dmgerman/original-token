multiline_comment|/*======================================================================&n;&n;    Device driver for Intel 82365 and compatible PC Card controllers,&n;    and Yenta-compatible PCI-to-CardBus controllers.&n;&n;    i82365.c 1.265 1999/11/10 18:36:21&n;&n;    The contents of this file are subject to the Mozilla Public&n;    License Version 1.1 (the &quot;License&quot;); you may not use this file&n;    except in compliance with the License. You may obtain a copy of&n;    the License at http://www.mozilla.org/MPL/&n;&n;    Software distributed under the License is distributed on an &quot;AS&n;    IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or&n;    implied. See the License for the specific language governing&n;    rights and limitations under the License.&n;&n;    The initial developer of the original code is David A. Hinds&n;    &lt;dhinds@pcmcia.sourceforge.org&gt;.  Portions created by David A. Hinds&n;    are Copyright (C) 1999 David A. Hinds.  All Rights Reserved.&n;&n;    Alternatively, the contents of this file may be used under the&n;    terms of the GNU Public License version 2 (the &quot;GPL&quot;), in which&n;    case the provisions of the GPL are applicable instead of the&n;    above.  If you wish to allow the use of your version of this file&n;    only under the terms of the GPL and not to allow others to use&n;    your version of this file under the MPL, indicate your decision&n;    by deleting the provisions above and replace them with the notice&n;    and other provisions required by the GPL.  If you do not delete&n;    the provisions above, a recipient may use your version of this&n;    file under either the MPL or the GPL.&n;    &n;======================================================================*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/ss.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
multiline_comment|/* ISA-bus controllers */
macro_line|#include &quot;i82365.h&quot;
macro_line|#include &quot;cirrus.h&quot;
macro_line|#include &quot;vg468.h&quot;
macro_line|#include &quot;ricoh.h&quot;
macro_line|#include &quot;o2micro.h&quot;
multiline_comment|/* PCI-bus controllers */
macro_line|#include &quot;old-yenta.h&quot;
macro_line|#include &quot;ti113x.h&quot;
macro_line|#include &quot;smc34c90.h&quot;
macro_line|#include &quot;topic.h&quot;
macro_line|#ifdef PCMCIA_DEBUG
DECL|variable|pc_debug
r_static
r_int
id|pc_debug
op_assign
id|PCMCIA_DEBUG
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pc_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|DEBUG
mdefine_line|#define DEBUG(n, args...) if (pc_debug&gt;(n)) printk(KERN_DEBUG args)
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;i82365.c 1.265 1999/11/10 18:36:21 (David Hinds)&quot;
suffix:semicolon
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG(n, args...) do { } while (0)
macro_line|#endif
r_static
r_void
id|irq_count
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
DECL|function|_check_irq
r_static
r_inline
r_int
id|_check_irq
c_func
(paren
r_int
id|irq
comma
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|irq_count
comma
id|flags
comma
l_string|&quot;x&quot;
comma
l_int|NULL
)paren
op_ne
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
macro_line|#ifdef CONFIG_ISA
multiline_comment|/* Default base address for i82365sl and other ISA chips */
DECL|variable|i365_base
r_static
r_int
id|i365_base
op_assign
l_int|0x3e0
suffix:semicolon
multiline_comment|/* Should we probe at 0x3e2 for an extra ISA controller? */
DECL|variable|extra_sockets
r_static
r_int
id|extra_sockets
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Specify a socket number to ignore */
DECL|variable|ignore
r_static
r_int
id|ignore
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Bit map or list of interrupts to choose from */
DECL|variable|irq_mask
r_static
id|u_int
id|irq_mask
op_assign
l_int|0xffff
suffix:semicolon
DECL|variable|irq_list
r_static
r_int
id|irq_list
(braket
l_int|16
)braket
op_assign
(brace
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* The card status change interrupt -- 0 means autoselect */
DECL|variable|cs_irq
r_static
r_int
id|cs_irq
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* Probe for safe interrupts? */
DECL|variable|do_scan
r_static
r_int
id|do_scan
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Poll status interval -- 0 means default to interrupt */
DECL|variable|poll_interval
r_static
r_int
id|poll_interval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* External clock time, in nanoseconds.  120 ns = 8.33 MHz */
DECL|variable|cycle_time
r_static
r_int
id|cycle_time
op_assign
l_int|120
suffix:semicolon
multiline_comment|/* Cirrus options */
DECL|variable|has_dma
r_static
r_int
id|has_dma
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|has_led
r_static
r_int
id|has_led
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|has_ring
r_static
r_int
id|has_ring
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dynamic_mode
r_static
r_int
id|dynamic_mode
op_assign
l_int|0
suffix:semicolon
DECL|variable|freq_bypass
r_static
r_int
id|freq_bypass
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|setup_time
r_static
r_int
id|setup_time
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cmd_time
r_static
r_int
id|cmd_time
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|recov_time
r_static
r_int
id|recov_time
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
multiline_comment|/* Vadem options */
DECL|variable|async_clock
r_static
r_int
id|async_clock
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cable_mode
r_static
r_int
id|cable_mode
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|wakeup
r_static
r_int
id|wakeup
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISA
id|MODULE_PARM
c_func
(paren
id|i365_base
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ignore
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|extra_sockets
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq_mask
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq_list
comma
l_string|&quot;1-16i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cs_irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|async_clock
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cable_mode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|wakeup
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM
c_func
(paren
id|do_scan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|poll_interval
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cycle_time
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|has_dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|has_led
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|has_ring
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dynamic_mode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|freq_bypass
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|setup_time
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cmd_time
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|recov_time
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Scan PCI bus? */
DECL|variable|do_pci_probe
r_static
r_int
id|do_pci_probe
op_assign
l_int|1
suffix:semicolon
DECL|variable|fast_pci
r_static
r_int
id|fast_pci
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|hold_time
r_static
r_int
id|hold_time
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Override BIOS interrupt routing mode? */
DECL|variable|irq_mode
r_static
r_int
id|irq_mode
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|has_clkrun
r_static
r_int
id|has_clkrun
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|clkrun_sel
r_static
r_int
id|clkrun_sel
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|pci_latency
r_static
r_int
id|pci_latency
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cb_latency
r_static
r_int
id|cb_latency
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cb_bus_base
r_static
r_int
id|cb_bus_base
op_assign
l_int|0
suffix:semicolon
DECL|variable|cb_bus_step
r_static
r_int
id|cb_bus_step
op_assign
l_int|2
suffix:semicolon
DECL|variable|cb_write_post
r_static
r_int
id|cb_write_post
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|do_pci_probe
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|fast_pci
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hold_time
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq_mode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|has_clkrun
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|clkrun_sel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pci_latency
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cb_latency
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cb_bus_base
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cb_bus_step
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|cb_write_post
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISA
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* PCI card status change interrupts? */
DECL|variable|pci_csc
r_static
r_int
id|pci_csc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PCI IO card functional interrupts? */
DECL|variable|pci_int
r_static
r_int
id|pci_int
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pci_csc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pci_int
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#else /* no PCI */
DECL|macro|pci_csc
mdefine_line|#define pci_csc&t;&t;0
DECL|macro|pci_int
mdefine_line|#define pci_int&t;&t;0
macro_line|#endif
macro_line|#else /* no ISA */
macro_line|#ifdef CONFIG_PCI
DECL|macro|pci_csc
mdefine_line|#define pci_csc&t;&t;0
DECL|macro|pci_int
mdefine_line|#define pci_int&t;&t;1
macro_line|#else
macro_line|#error &quot;No bus architectures defined!&quot;
macro_line|#endif
macro_line|#endif
multiline_comment|/*====================================================================*/
DECL|struct|cirrus_state_t
r_typedef
r_struct
id|cirrus_state_t
(brace
DECL|member|misc1
DECL|member|misc2
id|u_char
id|misc1
comma
id|misc2
suffix:semicolon
DECL|member|timer
id|u_char
id|timer
(braket
l_int|6
)braket
suffix:semicolon
DECL|typedef|cirrus_state_t
)brace
id|cirrus_state_t
suffix:semicolon
DECL|struct|vg46x_state_t
r_typedef
r_struct
id|vg46x_state_t
(brace
DECL|member|ctl
DECL|member|ema
id|u_char
id|ctl
comma
id|ema
suffix:semicolon
DECL|typedef|vg46x_state_t
)brace
id|vg46x_state_t
suffix:semicolon
DECL|struct|ti113x_state_t
r_typedef
r_struct
id|ti113x_state_t
(brace
DECL|member|sysctl
id|u_int
id|sysctl
suffix:semicolon
DECL|member|cardctl
DECL|member|devctl
DECL|member|diag
id|u_char
id|cardctl
comma
id|devctl
comma
id|diag
suffix:semicolon
DECL|typedef|ti113x_state_t
)brace
id|ti113x_state_t
suffix:semicolon
DECL|struct|rl5c4xx_state_t
r_typedef
r_struct
id|rl5c4xx_state_t
(brace
DECL|member|misc
DECL|member|ctl
DECL|member|io
DECL|member|mem
id|u_short
id|misc
comma
id|ctl
comma
id|io
comma
id|mem
suffix:semicolon
DECL|typedef|rl5c4xx_state_t
)brace
id|rl5c4xx_state_t
suffix:semicolon
DECL|struct|o2micro_state_t
r_typedef
r_struct
id|o2micro_state_t
(brace
DECL|member|mode_a
DECL|member|mode_b
DECL|member|mode_c
DECL|member|mode_d
id|u_char
id|mode_a
comma
id|mode_b
comma
id|mode_c
comma
id|mode_d
suffix:semicolon
DECL|member|mhpg
DECL|member|fifo
DECL|member|mode_e
id|u_char
id|mhpg
comma
id|fifo
comma
id|mode_e
suffix:semicolon
DECL|typedef|o2micro_state_t
)brace
id|o2micro_state_t
suffix:semicolon
DECL|struct|topic_state_t
r_typedef
r_struct
id|topic_state_t
(brace
DECL|member|slot
DECL|member|ccr
DECL|member|cdr
id|u_char
id|slot
comma
id|ccr
comma
id|cdr
suffix:semicolon
DECL|member|rcr
id|u_int
id|rcr
suffix:semicolon
DECL|typedef|topic_state_t
)brace
id|topic_state_t
suffix:semicolon
DECL|struct|socket_info_t
r_typedef
r_struct
id|socket_info_t
(brace
DECL|member|type
DECL|member|flags
id|u_short
id|type
comma
id|flags
suffix:semicolon
DECL|member|cap
id|socket_cap_t
id|cap
suffix:semicolon
DECL|member|ioaddr
id|ioaddr_t
id|ioaddr
suffix:semicolon
DECL|member|psock
id|u_short
id|psock
suffix:semicolon
DECL|member|cs_irq
DECL|member|intr
id|u_char
id|cs_irq
comma
id|intr
suffix:semicolon
DECL|member|handler
r_void
(paren
op_star
id|handler
)paren
(paren
r_void
op_star
id|info
comma
id|u_int
id|events
)paren
suffix:semicolon
DECL|member|info
r_void
op_star
id|info
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|member|proc
r_struct
id|proc_dir_entry
op_star
id|proc
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|revision
id|u_char
id|revision
suffix:semicolon
DECL|member|bcr
id|u_short
id|bcr
suffix:semicolon
DECL|member|pci_lat
DECL|member|cb_lat
DECL|member|sub_bus
id|u_char
id|pci_lat
comma
id|cb_lat
comma
id|sub_bus
suffix:semicolon
DECL|member|cache
id|u_char
id|cache
suffix:semicolon
DECL|member|cb_phys
id|u_int
id|cb_phys
suffix:semicolon
DECL|member|cb_virt
r_char
op_star
id|cb_virt
suffix:semicolon
macro_line|#endif
r_union
(brace
DECL|member|cirrus
id|cirrus_state_t
id|cirrus
suffix:semicolon
DECL|member|vg46x
id|vg46x_state_t
id|vg46x
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|member|o2micro
id|o2micro_state_t
id|o2micro
suffix:semicolon
DECL|member|ti113x
id|ti113x_state_t
id|ti113x
suffix:semicolon
DECL|member|rl5c4xx
id|rl5c4xx_state_t
id|rl5c4xx
suffix:semicolon
DECL|member|topic
id|topic_state_t
id|topic
suffix:semicolon
macro_line|#endif
DECL|member|state
)brace
id|state
suffix:semicolon
DECL|typedef|socket_info_t
)brace
id|socket_info_t
suffix:semicolon
multiline_comment|/* Where we keep track of our sockets... */
DECL|variable|sockets
r_static
r_int
id|sockets
op_assign
l_int|0
suffix:semicolon
DECL|variable|socket
r_static
id|socket_info_t
id|socket
(braket
l_int|8
)braket
op_assign
(brace
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* ... */
)brace
suffix:semicolon
multiline_comment|/* Default ISA interrupt mask */
DECL|macro|I365_MASK
mdefine_line|#define I365_MASK&t;0xdeb8&t;/* irq 15,14,12,11,10,9,7,5,4,3 */
macro_line|#ifdef CONFIG_ISA
DECL|variable|grab_irq
r_static
r_int
id|grab_irq
suffix:semicolon
DECL|variable|isa_lock
r_static
id|spinlock_t
id|isa_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|ISA_LOCK
mdefine_line|#define ISA_LOCK(n, f) &bslash;&n;    if (!(socket[n].flags &amp; IS_CARDBUS)) spin_lock_irqsave(&amp;isa_lock, f)
DECL|macro|ISA_UNLOCK
mdefine_line|#define ISA_UNLOCK(n, f) &bslash;&n;    if (!(socket[n].flags &amp; IS_CARDBUS)) spin_unlock_irqrestore(&amp;isa_lock, f)
macro_line|#else
DECL|macro|ISA_LOCK
mdefine_line|#define ISA_LOCK(n, f) do { } while (0)
DECL|macro|ISA_UNLOCK
mdefine_line|#define ISA_UNLOCK(n, f) do { } while (0)
macro_line|#endif
DECL|variable|poll_timer
r_static
r_struct
id|timer_list
id|poll_timer
suffix:semicolon
multiline_comment|/*====================================================================*/
multiline_comment|/* Default settings for PCI command configuration register */
DECL|macro|CMD_DFLT
mdefine_line|#define CMD_DFLT (PCI_COMMAND_IO|PCI_COMMAND_MEMORY| &bslash;&n;&t;&t;  PCI_COMMAND_MASTER|PCI_COMMAND_WAIT)
multiline_comment|/* These definitions must match the pcic table! */
DECL|enum|pcic_id
r_typedef
r_enum
id|pcic_id
(brace
macro_line|#ifdef CONFIG_ISA
DECL|enumerator|IS_I82365A
DECL|enumerator|IS_I82365B
DECL|enumerator|IS_I82365DF
id|IS_I82365A
comma
id|IS_I82365B
comma
id|IS_I82365DF
comma
DECL|enumerator|IS_IBM
DECL|enumerator|IS_RF5Cx96
DECL|enumerator|IS_VLSI
DECL|enumerator|IS_VG468
DECL|enumerator|IS_VG469
id|IS_IBM
comma
id|IS_RF5Cx96
comma
id|IS_VLSI
comma
id|IS_VG468
comma
id|IS_VG469
comma
DECL|enumerator|IS_PD6710
DECL|enumerator|IS_PD672X
DECL|enumerator|IS_VT83C469
id|IS_PD6710
comma
id|IS_PD672X
comma
id|IS_VT83C469
comma
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
DECL|enumerator|IS_PD6729
DECL|enumerator|IS_PD6730
DECL|enumerator|IS_OZ6729
DECL|enumerator|IS_OZ6730
id|IS_PD6729
comma
id|IS_PD6730
comma
id|IS_OZ6729
comma
id|IS_OZ6730
comma
DECL|enumerator|IS_I82092AA
DECL|enumerator|IS_OM82C092G
id|IS_I82092AA
comma
id|IS_OM82C092G
comma
DECL|enumerator|IS_PD6832
DECL|enumerator|IS_OZ6832
DECL|enumerator|IS_OZ6836
DECL|enumerator|IS_OZ6812
id|IS_PD6832
comma
id|IS_OZ6832
comma
id|IS_OZ6836
comma
id|IS_OZ6812
comma
DECL|enumerator|IS_RL5C465
DECL|enumerator|IS_RL5C466
DECL|enumerator|IS_RL5C475
DECL|enumerator|IS_RL5C476
DECL|enumerator|IS_RL5C478
id|IS_RL5C465
comma
id|IS_RL5C466
comma
id|IS_RL5C475
comma
id|IS_RL5C476
comma
id|IS_RL5C478
comma
DECL|enumerator|IS_SMC34C90
id|IS_SMC34C90
comma
DECL|enumerator|IS_TI1130
DECL|enumerator|IS_TI1131
DECL|enumerator|IS_TI1250A
DECL|enumerator|IS_TI1220
DECL|enumerator|IS_TI1221
DECL|enumerator|IS_TI1210
id|IS_TI1130
comma
id|IS_TI1131
comma
id|IS_TI1250A
comma
id|IS_TI1220
comma
id|IS_TI1221
comma
id|IS_TI1210
comma
DECL|enumerator|IS_TI1251A
DECL|enumerator|IS_TI1251B
DECL|enumerator|IS_TI1450
DECL|enumerator|IS_TI1225
DECL|enumerator|IS_TI1211
DECL|enumerator|IS_TI1420
id|IS_TI1251A
comma
id|IS_TI1251B
comma
id|IS_TI1450
comma
id|IS_TI1225
comma
id|IS_TI1211
comma
id|IS_TI1420
comma
DECL|enumerator|IS_TOPIC95_A
DECL|enumerator|IS_TOPIC95_B
DECL|enumerator|IS_TOPIC97
id|IS_TOPIC95_A
comma
id|IS_TOPIC95_B
comma
id|IS_TOPIC97
comma
DECL|enumerator|IS_UNK_PCI
DECL|enumerator|IS_UNK_CARDBUS
id|IS_UNK_PCI
comma
id|IS_UNK_CARDBUS
macro_line|#endif
DECL|typedef|pcic_id
)brace
id|pcic_id
suffix:semicolon
multiline_comment|/* Flags for classifying groups of controllers */
DECL|macro|IS_VADEM
mdefine_line|#define IS_VADEM&t;0x0001
DECL|macro|IS_CIRRUS
mdefine_line|#define IS_CIRRUS&t;0x0002
DECL|macro|IS_TI
mdefine_line|#define IS_TI&t;&t;0x0004
DECL|macro|IS_O2MICRO
mdefine_line|#define IS_O2MICRO&t;0x0008
DECL|macro|IS_VIA
mdefine_line|#define IS_VIA&t;&t;0x0010
DECL|macro|IS_TOPIC
mdefine_line|#define IS_TOPIC&t;0x0020
DECL|macro|IS_RICOH
mdefine_line|#define IS_RICOH&t;0x0040
DECL|macro|IS_UNKNOWN
mdefine_line|#define IS_UNKNOWN&t;0x0400
DECL|macro|IS_VG_PWR
mdefine_line|#define IS_VG_PWR&t;0x0800
DECL|macro|IS_DF_PWR
mdefine_line|#define IS_DF_PWR&t;0x1000
DECL|macro|IS_PCI
mdefine_line|#define IS_PCI&t;&t;0x2000
DECL|macro|IS_CARDBUS
mdefine_line|#define IS_CARDBUS&t;0x4000
DECL|macro|IS_ALIVE
mdefine_line|#define IS_ALIVE&t;0x8000
DECL|struct|pcic_t
r_typedef
r_struct
id|pcic_t
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|flags
id|u_short
id|flags
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|member|vendor
DECL|member|device
id|u_short
id|vendor
comma
id|device
suffix:semicolon
macro_line|#endif
DECL|typedef|pcic_t
)brace
id|pcic_t
suffix:semicolon
DECL|variable|pcic
r_static
id|pcic_t
id|pcic
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_ISA
(brace
l_string|&quot;Intel i82365sl A step&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Intel i82365sl B step&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Intel i82365sl DF&quot;
comma
id|IS_DF_PWR
)brace
comma
(brace
l_string|&quot;IBM Clone&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Ricoh RF5C296/396&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;VLSI 82C146&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Vadem VG-468&quot;
comma
id|IS_VADEM
)brace
comma
(brace
l_string|&quot;Vadem VG-469&quot;
comma
id|IS_VADEM
op_or
id|IS_VG_PWR
)brace
comma
(brace
l_string|&quot;Cirrus PD6710&quot;
comma
id|IS_CIRRUS
)brace
comma
(brace
l_string|&quot;Cirrus PD672x&quot;
comma
id|IS_CIRRUS
)brace
comma
(brace
l_string|&quot;VIA VT83C469&quot;
comma
id|IS_CIRRUS
op_or
id|IS_VIA
)brace
comma
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
(brace
l_string|&quot;Cirrus PD6729&quot;
comma
id|IS_CIRRUS
op_or
id|IS_PCI
comma
id|PCI_VENDOR_ID_CIRRUS
comma
id|PCI_DEVICE_ID_CIRRUS_6729
)brace
comma
(brace
l_string|&quot;Cirrus PD6730&quot;
comma
id|IS_CIRRUS
op_or
id|IS_PCI
comma
id|PCI_VENDOR_ID_CIRRUS
comma
l_int|0xffff
)brace
comma
(brace
l_string|&quot;O2Micro OZ6729&quot;
comma
id|IS_O2MICRO
op_or
id|IS_PCI
op_or
id|IS_VG_PWR
comma
id|PCI_VENDOR_ID_O2
comma
id|PCI_DEVICE_ID_O2_6729
)brace
comma
(brace
l_string|&quot;O2Micro OZ6730&quot;
comma
id|IS_O2MICRO
op_or
id|IS_PCI
op_or
id|IS_VG_PWR
comma
id|PCI_VENDOR_ID_O2
comma
id|PCI_DEVICE_ID_O2_6730
)brace
comma
(brace
l_string|&quot;Intel 82092AA&quot;
comma
id|IS_PCI
comma
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82092AA_0
)brace
comma
(brace
l_string|&quot;Omega Micro 82C092G&quot;
comma
id|IS_PCI
comma
id|PCI_VENDOR_ID_OMEGA
comma
id|PCI_DEVICE_ID_OMEGA_82C092G
)brace
comma
(brace
l_string|&quot;Cirrus PD6832&quot;
comma
id|IS_CIRRUS
op_or
id|IS_CARDBUS
comma
id|PCI_VENDOR_ID_CIRRUS
comma
id|PCI_DEVICE_ID_CIRRUS_6832
)brace
comma
(brace
l_string|&quot;O2Micro OZ6832/OZ6833&quot;
comma
id|IS_O2MICRO
op_or
id|IS_CARDBUS
op_or
id|IS_VG_PWR
comma
id|PCI_VENDOR_ID_O2
comma
id|PCI_DEVICE_ID_O2_6832
)brace
comma
(brace
l_string|&quot;O2Micro OZ6836/OZ6860&quot;
comma
id|IS_O2MICRO
op_or
id|IS_CARDBUS
op_or
id|IS_VG_PWR
comma
id|PCI_VENDOR_ID_O2
comma
id|PCI_DEVICE_ID_O2_6836
)brace
comma
(brace
l_string|&quot;O2Micro OZ6812&quot;
comma
id|IS_O2MICRO
op_or
id|IS_CARDBUS
op_or
id|IS_VG_PWR
comma
id|PCI_VENDOR_ID_O2
comma
id|PCI_DEVICE_ID_O2_6812
)brace
comma
(brace
l_string|&quot;Ricoh RL5C465&quot;
comma
id|IS_RICOH
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_RICOH
comma
id|PCI_DEVICE_ID_RICOH_RL5C465
)brace
comma
(brace
l_string|&quot;Ricoh RL5C466&quot;
comma
id|IS_RICOH
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_RICOH
comma
id|PCI_DEVICE_ID_RICOH_RL5C466
)brace
comma
(brace
l_string|&quot;Ricoh RL5C475&quot;
comma
id|IS_RICOH
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_RICOH
comma
id|PCI_DEVICE_ID_RICOH_RL5C475
)brace
comma
(brace
l_string|&quot;Ricoh RL5C476&quot;
comma
id|IS_RICOH
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_RICOH
comma
id|PCI_DEVICE_ID_RICOH_RL5C476
)brace
comma
(brace
l_string|&quot;Ricoh RL5C478&quot;
comma
id|IS_RICOH
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_RICOH
comma
id|PCI_DEVICE_ID_RICOH_RL5C478
)brace
comma
(brace
l_string|&quot;SMC 34C90&quot;
comma
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_SMC
comma
id|PCI_DEVICE_ID_SMC_34C90
)brace
comma
(brace
l_string|&quot;TI 1130&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1130
)brace
comma
(brace
l_string|&quot;TI 1131&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1131
)brace
comma
(brace
l_string|&quot;TI 1250A&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1250A
)brace
comma
(brace
l_string|&quot;TI 1220&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1220
)brace
comma
(brace
l_string|&quot;TI 1221&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1221
)brace
comma
(brace
l_string|&quot;TI 1210&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1210
)brace
comma
(brace
l_string|&quot;TI 1251A&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1251A
)brace
comma
(brace
l_string|&quot;TI 1251B&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1251B
)brace
comma
(brace
l_string|&quot;TI 1450&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1450
)brace
comma
(brace
l_string|&quot;TI 1225&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1225
)brace
comma
(brace
l_string|&quot;TI 1211&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1211
)brace
comma
(brace
l_string|&quot;TI 1420&quot;
comma
id|IS_TI
op_or
id|IS_CARDBUS
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TI
comma
id|PCI_DEVICE_ID_TI_1420
)brace
comma
(brace
l_string|&quot;Toshiba ToPIC95-A&quot;
comma
id|IS_CARDBUS
op_or
id|IS_TOPIC
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TOSHIBA
comma
id|PCI_DEVICE_ID_TOSHIBA_TOPIC95_A
)brace
comma
(brace
l_string|&quot;Toshiba ToPIC95-B&quot;
comma
id|IS_CARDBUS
op_or
id|IS_TOPIC
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TOSHIBA
comma
id|PCI_DEVICE_ID_TOSHIBA_TOPIC95_B
)brace
comma
(brace
l_string|&quot;Toshiba ToPIC97&quot;
comma
id|IS_CARDBUS
op_or
id|IS_TOPIC
op_or
id|IS_DF_PWR
comma
id|PCI_VENDOR_ID_TOSHIBA
comma
id|PCI_DEVICE_ID_TOSHIBA_TOPIC97
)brace
comma
(brace
l_string|&quot;Unknown&quot;
comma
id|IS_PCI
op_or
id|IS_UNKNOWN
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Unknown&quot;
comma
id|IS_CARDBUS
op_or
id|IS_DF_PWR
op_or
id|IS_UNKNOWN
comma
l_int|0
comma
l_int|0
)brace
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|PCIC_COUNT
mdefine_line|#define PCIC_COUNT&t;(sizeof(pcic)/sizeof(pcic_t))
multiline_comment|/*====================================================================*/
multiline_comment|/* Some PCI shortcuts */
DECL|macro|config_readb
mdefine_line|#define config_readb(sock, r, v)&t;pci_read_config_byte((sock)-&gt;pdev, r, v)
DECL|macro|config_readw
mdefine_line|#define config_readw(sock, r, v)&t;pci_read_config_word((sock)-&gt;pdev, r, v)
DECL|macro|config_readl
mdefine_line|#define config_readl(sock, r, v)&t;pci_read_config_dword((sock)-&gt;pdev, r, v)
DECL|macro|config_writeb
mdefine_line|#define config_writeb(sock, r, v)&t;pci_write_config_byte((sock)-&gt;pdev, r, v)
DECL|macro|config_writew
mdefine_line|#define config_writew(sock, r, v)&t;pci_write_config_word((sock)-&gt;pdev, r, v)
DECL|macro|config_writel
mdefine_line|#define config_writel(sock, r, v)&t;pci_write_config_dword((sock)-&gt;pdev, r, v)
DECL|macro|cb_readb
mdefine_line|#define cb_readb(s, r)&t;&t;readb(socket[s].cb_virt + (r))
DECL|macro|cb_readl
mdefine_line|#define cb_readl(s, r)&t;&t;readl(socket[s].cb_virt + (r))
DECL|macro|cb_writeb
mdefine_line|#define cb_writeb(s, r, v)&t;writeb(v, socket[s].cb_virt + (r))
DECL|macro|cb_writel
mdefine_line|#define cb_writel(s, r, v)&t;writel(v, socket[s].cb_virt + (r))
r_static
r_void
id|cb_get_power
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
suffix:semicolon
r_static
r_void
id|cb_set_power
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
DECL|function|i365_get
r_static
id|u_char
id|i365_get
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|cb_virt
)paren
r_return
id|cb_readb
c_func
(paren
id|sock
comma
l_int|0x0800
op_plus
id|reg
)paren
suffix:semicolon
r_else
macro_line|#endif
(brace
id|ioaddr_t
id|port
op_assign
id|socket
(braket
id|sock
)braket
dot
id|ioaddr
suffix:semicolon
id|u_char
id|val
suffix:semicolon
id|reg
op_assign
id|I365_REG
c_func
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
comma
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|port
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|port
op_plus
l_int|1
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
)brace
DECL|function|i365_set
r_static
r_void
id|i365_set
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|data
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|cb_virt
)paren
id|cb_writeb
c_func
(paren
id|sock
comma
l_int|0x0800
op_plus
id|reg
comma
id|data
)paren
suffix:semicolon
r_else
macro_line|#endif
(brace
id|ioaddr_t
id|port
op_assign
id|socket
(braket
id|sock
)braket
dot
id|ioaddr
suffix:semicolon
id|u_char
id|val
op_assign
id|I365_REG
c_func
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
comma
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|i365_bset
r_static
r_void
id|i365_bset
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|d
op_or_assign
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_bclr
r_static
r_void
id|i365_bclr
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|d
op_and_assign
op_complement
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_bflip
r_static
r_void
id|i365_bflip
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
comma
r_int
id|b
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
)paren
id|d
op_or_assign
id|mask
suffix:semicolon
r_else
id|d
op_and_assign
op_complement
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_get_pair
r_static
id|u_short
id|i365_get_pair
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
)paren
(brace
id|u_short
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|b
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|a
op_plus
(paren
id|b
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
DECL|function|i365_set_pair
r_static
r_void
id|i365_set_pair
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_short
id|data
)paren
(brace
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|data
op_amp
l_int|0xff
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
op_plus
l_int|1
comma
id|data
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for Cirrus&n;    PD67xx controllers, and to set and report global configuration&n;    options.&n;&n;    The VIA controllers also use these routines, as they are mostly&n;    Cirrus lookalikes, without the timing registers.&n;    &n;======================================================================*/
DECL|macro|flip
mdefine_line|#define flip(v,b,f) (v = ((f)&lt;0) ? v : ((f) ? ((v)|(b)) : ((v)&amp;(~b))))
DECL|function|cirrus_get_state
r_static
r_void
id|cirrus_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|p-&gt;misc1
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
)paren
suffix:semicolon
id|p-&gt;misc1
op_and_assign
(paren
id|PD67_MC1_MEDIA_ENA
op_or
id|PD67_MC1_INPACK_ENA
)paren
suffix:semicolon
id|p-&gt;misc2
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|p-&gt;timer
(braket
id|i
)braket
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_TIME_SETUP
c_func
(paren
l_int|0
)paren
op_plus
id|i
)paren
suffix:semicolon
)brace
DECL|function|cirrus_set_state
r_static
r_void
id|cirrus_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_char
id|misc
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|misc
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
comma
id|p-&gt;misc2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|misc
op_amp
id|PD67_MC2_SUSPEND
)paren
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|misc
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
)paren
suffix:semicolon
id|misc
op_and_assign
op_complement
(paren
id|PD67_MC1_MEDIA_ENA
op_or
id|PD67_MC1_INPACK_ENA
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
comma
id|misc
op_or
id|p-&gt;misc1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|i365_set
c_func
(paren
id|s
comma
id|PD67_TIME_SETUP
c_func
(paren
l_int|0
)paren
op_plus
id|i
comma
id|p-&gt;timer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|cirrus_set_irq_mode
r_static
r_int
id|cirrus_set_irq_mode
c_func
(paren
id|u_short
id|s
comma
r_int
id|pcsc
comma
r_int
id|pint
)paren
(brace
id|flip
c_func
(paren
id|socket
(braket
id|s
)braket
dot
id|bcr
comma
id|PD6832_BCR_MGMT_IRQ_ENA
comma
op_logical_neg
id|pcsc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
DECL|function|cirrus_set_opts
r_static
id|u_int
id|__init
id|cirrus_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|u_int
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|has_ring
op_eq
op_minus
l_int|1
)paren
id|has_ring
op_assign
l_int|1
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_IRQ15_RI
comma
id|has_ring
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_DYNAMIC_MODE
comma
id|dynamic_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_IRQ15_RI
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [ring]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_DYNAMIC_MODE
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [dyn mode]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc1
op_amp
id|PD67_MC1_INPACK_ENA
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [inpack]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;flags
op_amp
(paren
id|IS_PCI
op_or
id|IS_CARDBUS
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_IRQ15_RI
)paren
id|mask
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
r_if
c_cond
(paren
id|has_led
OG
l_int|0
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [led]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|has_dma
OG
l_int|0
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [dma]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x0600
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_FREQ_BYPASS
comma
id|freq_bypass
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_FREQ_BYPASS
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [freq bypass]&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
)brace
r_else
(brace
id|p-&gt;misc1
op_and_assign
op_complement
id|PD67_MC1_MEDIA_ENA
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_FAST_PCI
comma
id|fast_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_IRQ15_RI
)paren
id|mask
op_and_assign
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_PD6730
)paren
ques
c_cond
op_complement
l_int|0x0400
suffix:colon
op_complement
l_int|0x8000
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;flags
op_amp
id|IS_VIA
)paren
)paren
(brace
r_if
c_cond
(paren
id|setup_time
op_ge
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_assign
id|p-&gt;timer
(braket
l_int|3
)braket
op_assign
id|setup_time
suffix:semicolon
r_if
c_cond
(paren
id|cmd_time
OG
l_int|0
)paren
(brace
id|p-&gt;timer
(braket
l_int|1
)braket
op_assign
id|cmd_time
suffix:semicolon
id|p-&gt;timer
(braket
l_int|4
)braket
op_assign
id|cmd_time
op_star
l_int|2
op_plus
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;timer
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
(brace
id|p-&gt;timer
(braket
l_int|1
)braket
op_assign
l_int|6
suffix:semicolon
id|p-&gt;timer
(braket
l_int|4
)braket
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_assign
id|p-&gt;timer
(braket
l_int|3
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|recov_time
op_ge
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|2
)braket
op_assign
id|p-&gt;timer
(braket
l_int|5
)braket
op_assign
id|recov_time
suffix:semicolon
id|buf
op_add_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [%d/%d/%d] [%d/%d/%d]&quot;
comma
id|p-&gt;timer
(braket
l_int|0
)braket
comma
id|p-&gt;timer
(braket
l_int|1
)braket
comma
id|p-&gt;timer
(braket
l_int|2
)braket
comma
id|p-&gt;timer
(braket
l_int|3
)braket
comma
id|p-&gt;timer
(braket
l_int|4
)braket
comma
id|p-&gt;timer
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for Vadem VG468&n;    and VG469 controllers, and to set and report global configuration&n;    options.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_ISA
DECL|function|vg46x_get_state
r_static
r_void
id|vg46x_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|p-&gt;ctl
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG468_CTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
id|p-&gt;ema
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG469_EXT_MODE
)paren
suffix:semicolon
)brace
DECL|function|vg46x_set_state
r_static
r_void
id|vg46x_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|VG468_CTL
comma
id|p-&gt;ctl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
id|i365_set
c_func
(paren
id|s
comma
id|VG469_EXT_MODE
comma
id|p-&gt;ema
)paren
suffix:semicolon
)brace
DECL|function|vg46x_set_opts
r_static
id|u_int
id|__init
id|vg46x_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;ctl
comma
id|VG468_CTL_ASYNC
comma
id|async_clock
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;ema
comma
id|VG469_MODE_CABLE
comma
id|cable_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ctl
op_amp
id|VG468_CTL_ASYNC
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [async]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ctl
op_amp
id|VG468_CTL_INPACK
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [inpack]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
(brace
id|u_char
id|vsel
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG469_VSELECT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vsel
op_amp
id|VG469_VSEL_EXT_STAT
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [ext mode]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vsel
op_amp
id|VG469_VSEL_EXT_BUS
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [isa buf]&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;ema
op_amp
id|VG469_MODE_CABLE
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [cable]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ema
op_amp
id|VG469_MODE_COMPAT
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [c step]&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0xffff
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for TI 1130 and&n;    TI 1131 controllers, and to set and report global configuration&n;    options.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|ti113x_get_state
r_static
r_void
id|ti113x_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|ti113x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.ti113x
suffix:semicolon
id|config_readl
c_func
(paren
id|t
comma
id|TI113X_SYSTEM_CONTROL
comma
op_amp
id|p-&gt;sysctl
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TI113X_CARD_CONTROL
comma
op_amp
id|p-&gt;cardctl
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TI113X_DEVICE_CONTROL
comma
op_amp
id|p-&gt;devctl
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TI1250_DIAGNOSTIC
comma
op_amp
id|p-&gt;diag
)paren
suffix:semicolon
)brace
DECL|function|ti113x_set_state
r_static
r_void
id|ti113x_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|ti113x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.ti113x
suffix:semicolon
id|config_writel
c_func
(paren
id|t
comma
id|TI113X_SYSTEM_CONTROL
comma
id|p-&gt;sysctl
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TI113X_CARD_CONTROL
comma
id|p-&gt;cardctl
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TI113X_DEVICE_CONTROL
comma
id|p-&gt;devctl
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TI1250_MULTIMEDIA_CTL
comma
l_int|0
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TI1250_DIAGNOSTIC
comma
id|p-&gt;diag
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|s
comma
id|TI113X_IO_OFFSET
c_func
(paren
l_int|0
)paren
comma
l_int|0
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|s
comma
id|TI113X_IO_OFFSET
c_func
(paren
l_int|1
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ti113x_set_irq_mode
r_static
r_int
id|ti113x_set_irq_mode
c_func
(paren
id|u_short
id|s
comma
r_int
id|pcsc
comma
r_int
id|pint
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|ti113x_state_t
op_star
id|p
op_assign
op_amp
id|t-&gt;state.ti113x
suffix:semicolon
id|t-&gt;intr
op_assign
(paren
id|pcsc
)paren
ques
c_cond
id|I365_INTR_ENA
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_le
id|IS_TI1131
)paren
(brace
id|p-&gt;cardctl
op_and_assign
op_complement
(paren
id|TI113X_CCR_PCI_IRQ_ENA
op_or
id|TI113X_CCR_PCI_IREQ
op_or
id|TI113X_CCR_PCI_CSC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcsc
)paren
id|p-&gt;cardctl
op_or_assign
id|TI113X_CCR_PCI_IRQ_ENA
op_or
id|TI113X_CCR_PCI_CSC
suffix:semicolon
r_if
c_cond
(paren
id|pint
)paren
id|p-&gt;cardctl
op_or_assign
id|TI113X_CCR_PCI_IRQ_ENA
op_or
id|TI113X_CCR_PCI_IREQ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|IS_TI1250A
)paren
(brace
id|p-&gt;diag
op_and_assign
id|TI1250_DIAG_PCI_CSC
op_or
id|TI1250_DIAG_PCI_IREQ
suffix:semicolon
r_if
c_cond
(paren
id|pcsc
)paren
id|p-&gt;diag
op_or_assign
id|TI1250_DIAG_PCI_CSC
suffix:semicolon
r_if
c_cond
(paren
id|pint
)paren
id|p-&gt;diag
op_or_assign
id|TI1250_DIAG_PCI_IREQ
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ti113x_set_opts
r_static
id|u_int
id|__init
id|ti113x_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|ti113x_state_t
op_star
id|p
op_assign
op_amp
id|t-&gt;state.ti113x
suffix:semicolon
id|u_int
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|old
op_assign
(paren
id|t-&gt;type
op_le
id|IS_TI1131
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;sysctl
comma
id|TI113X_SCR_CLKRUN_ENA
comma
id|has_clkrun
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;sysctl
comma
id|TI113X_SCR_CLKRUN_SEL
comma
id|clkrun_sel
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;cardctl
comma
id|TI113X_CCR_RIENB
comma
id|has_ring
)paren
suffix:semicolon
id|p-&gt;cardctl
op_and_assign
op_complement
id|TI113X_CCR_ZVENABLE
suffix:semicolon
r_switch
c_cond
(paren
id|irq_mode
)paren
(brace
r_case
l_int|1
suffix:colon
id|p-&gt;devctl
op_and_assign
op_complement
id|TI113X_DCR_IMODE_MASK
suffix:semicolon
id|p-&gt;devctl
op_or_assign
id|TI113X_DCR_IMODE_ISA
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|p-&gt;devctl
op_and_assign
op_complement
id|TI113X_DCR_IMODE_MASK
suffix:semicolon
id|p-&gt;devctl
op_or_assign
id|TI113X_DCR_IMODE_SERIAL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|p-&gt;devctl
op_and_assign
op_complement
id|TI113X_DCR_IMODE_MASK
suffix:semicolon
id|p-&gt;devctl
op_or_assign
id|TI12XX_DCR_IMODE_ALL_SERIAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|p-&gt;devctl
op_amp
id|TI113X_DCR_IMODE_MASK
)paren
op_eq
l_int|0
)paren
id|p-&gt;devctl
op_or_assign
id|TI113X_DCR_IMODE_ISA
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;cardctl
op_amp
id|TI113X_CCR_RIENB
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [ring]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old
)paren
id|mask
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|old
op_logical_and
(paren
id|p-&gt;sysctl
op_amp
id|TI113X_SCR_CLKRUN_ENA
)paren
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;sysctl
op_amp
id|TI113X_SCR_CLKRUN_SEL
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [clkrun irq 12]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x1000
suffix:semicolon
)brace
r_else
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [clkrun irq 10]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x0400
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;sysctl
op_amp
id|TI113X_SCR_PWRSAVINGS
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [pwr save]&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;devctl
op_amp
id|TI113X_DCR_IMODE_MASK
)paren
(brace
r_case
id|TI12XX_DCR_IMODE_PCI_ONLY
suffix:colon
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [pci only]&quot;
)paren
suffix:semicolon
id|mask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TI113X_DCR_IMODE_ISA
suffix:colon
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [isa irq]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old
)paren
id|mask
op_and_assign
op_complement
l_int|0x0018
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TI113X_DCR_IMODE_SERIAL
suffix:colon
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [pci + serial irq]&quot;
)paren
suffix:semicolon
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TI12XX_DCR_IMODE_ALL_SERIAL
suffix:colon
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [serial pci &amp; irq]&quot;
)paren
suffix:semicolon
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for the Ricoh&n;    RL5C4XX controllers, and to set and report global configuration&n;    options.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|rl5c4xx_get_state
r_static
r_void
id|rl5c4xx_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|rl5c4xx_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.rl5c4xx
suffix:semicolon
id|config_readw
c_func
(paren
id|t
comma
id|RL5C4XX_MISC
comma
op_amp
id|p-&gt;misc
)paren
suffix:semicolon
id|config_readw
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_CTL
comma
op_amp
id|p-&gt;ctl
)paren
suffix:semicolon
id|config_readw
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_IO_0
comma
op_amp
id|p-&gt;io
)paren
suffix:semicolon
id|config_readw
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_MEM_0
comma
op_amp
id|p-&gt;mem
)paren
suffix:semicolon
)brace
DECL|function|rl5c4xx_set_state
r_static
r_void
id|rl5c4xx_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|rl5c4xx_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.rl5c4xx
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|RL5C4XX_MISC
comma
id|p-&gt;misc
)paren
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_CTL
comma
id|p-&gt;ctl
)paren
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_IO_0
comma
id|p-&gt;io
)paren
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|RL5C4XX_16BIT_MEM_0
comma
id|p-&gt;mem
)paren
suffix:semicolon
)brace
DECL|function|rl5c4xx_set_opts
r_static
id|u_int
id|__init
id|rl5c4xx_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|rl5c4xx_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.rl5c4xx
suffix:semicolon
id|u_int
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|old
op_assign
(paren
id|socket
(braket
id|s
)braket
dot
id|type
OL
id|IS_RL5C475
)paren
suffix:semicolon
id|p-&gt;ctl
op_assign
id|RL5C4XX_16CTL_IO_TIMING
op_or
id|RL5C4XX_16CTL_MEM_TIMING
suffix:semicolon
r_if
c_cond
(paren
id|old
)paren
id|p-&gt;ctl
op_or_assign
id|RL5C46X_16CTL_LEVEL_1
op_or
id|RL5C46X_16CTL_LEVEL_2
suffix:semicolon
r_if
c_cond
(paren
id|setup_time
op_ge
l_int|0
)paren
(brace
id|p-&gt;io
op_assign
(paren
id|p-&gt;io
op_amp
op_complement
id|RL5C4XX_SETUP_MASK
)paren
op_plus
(paren
(paren
id|setup_time
op_plus
l_int|1
)paren
op_lshift
id|RL5C4XX_SETUP_SHIFT
)paren
suffix:semicolon
id|p-&gt;mem
op_assign
(paren
id|p-&gt;mem
op_amp
op_complement
id|RL5C4XX_SETUP_MASK
)paren
op_plus
(paren
id|setup_time
op_lshift
id|RL5C4XX_SETUP_SHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd_time
op_ge
l_int|0
)paren
(brace
id|p-&gt;io
op_assign
(paren
id|p-&gt;io
op_amp
op_complement
id|RL5C4XX_CMD_MASK
)paren
op_plus
(paren
id|cmd_time
op_lshift
id|RL5C4XX_CMD_SHIFT
)paren
suffix:semicolon
id|p-&gt;mem
op_assign
(paren
id|p-&gt;mem
op_amp
op_complement
id|RL5C4XX_CMD_MASK
)paren
op_plus
(paren
id|cmd_time
op_lshift
id|RL5C4XX_CMD_SHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hold_time
op_ge
l_int|0
)paren
(brace
id|p-&gt;io
op_assign
(paren
id|p-&gt;io
op_amp
op_complement
id|RL5C4XX_HOLD_MASK
)paren
op_plus
(paren
id|hold_time
op_lshift
id|RL5C4XX_HOLD_SHIFT
)paren
suffix:semicolon
id|p-&gt;mem
op_assign
(paren
id|p-&gt;mem
op_amp
op_complement
id|RL5C4XX_HOLD_MASK
)paren
op_plus
(paren
id|hold_time
op_lshift
id|RL5C4XX_HOLD_SHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|old
)paren
(brace
r_switch
c_cond
(paren
id|irq_mode
)paren
(brace
r_case
l_int|1
suffix:colon
id|p-&gt;misc
op_and_assign
op_complement
id|RL5C47X_MISC_SRIRQ_ENA
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|p-&gt;misc
op_or_assign
id|RL5C47X_MISC_SRIRQ_ENA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;misc
op_amp
id|RL5C47X_MISC_SRIRQ_ENA
)paren
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [serial irq]&quot;
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [isa irq]&quot;
)paren
suffix:semicolon
id|buf
op_add_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [io %d/%d/%d] [mem %d/%d/%d]&quot;
comma
(paren
id|p-&gt;io
op_amp
id|RL5C4XX_SETUP_MASK
)paren
op_rshift
id|RL5C4XX_SETUP_SHIFT
comma
(paren
id|p-&gt;io
op_amp
id|RL5C4XX_CMD_MASK
)paren
op_rshift
id|RL5C4XX_CMD_SHIFT
comma
(paren
id|p-&gt;io
op_amp
id|RL5C4XX_HOLD_MASK
)paren
op_rshift
id|RL5C4XX_HOLD_SHIFT
comma
(paren
id|p-&gt;mem
op_amp
id|RL5C4XX_SETUP_MASK
)paren
op_rshift
id|RL5C4XX_SETUP_SHIFT
comma
(paren
id|p-&gt;mem
op_amp
id|RL5C4XX_CMD_MASK
)paren
op_rshift
id|RL5C4XX_CMD_SHIFT
comma
(paren
id|p-&gt;mem
op_amp
id|RL5C4XX_HOLD_MASK
)paren
op_rshift
id|RL5C4XX_HOLD_SHIFT
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for O2Micro&n;    controllers, and to set and report global configuration options.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|o2micro_get_state
r_static
r_void
id|o2micro_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|o2micro_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.o2micro
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t-&gt;revision
op_eq
l_int|0x34
)paren
op_logical_or
(paren
id|t-&gt;revision
op_eq
l_int|0x62
)paren
op_logical_or
(paren
id|t-&gt;type
op_eq
id|IS_OZ6812
)paren
)paren
(brace
id|p-&gt;mode_a
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_A_2
)paren
suffix:semicolon
id|p-&gt;mode_b
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_B_2
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;mode_a
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_A
)paren
suffix:semicolon
id|p-&gt;mode_b
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_B
)paren
suffix:semicolon
)brace
id|p-&gt;mode_c
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_C
)paren
suffix:semicolon
id|p-&gt;mode_d
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_D
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|p-&gt;mhpg
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MHPG_DMA
)paren
suffix:semicolon
id|p-&gt;fifo
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_FIFO_ENA
)paren
suffix:semicolon
id|p-&gt;mode_e
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|O2_MODE_E
)paren
suffix:semicolon
)brace
)brace
DECL|function|o2micro_set_state
r_static
r_void
id|o2micro_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|o2micro_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.o2micro
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t-&gt;revision
op_eq
l_int|0x34
)paren
op_logical_or
(paren
id|t-&gt;revision
op_eq
l_int|0x62
)paren
op_logical_or
(paren
id|t-&gt;type
op_eq
id|IS_OZ6812
)paren
)paren
(brace
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_A_2
comma
id|p-&gt;mode_a
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_B_2
comma
id|p-&gt;mode_b
)paren
suffix:semicolon
)brace
r_else
(brace
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_A
comma
id|p-&gt;mode_a
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_B
comma
id|p-&gt;mode_b
)paren
suffix:semicolon
)brace
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_C
comma
id|p-&gt;mode_c
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_D
comma
id|p-&gt;mode_d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|i365_set
c_func
(paren
id|s
comma
id|O2_MHPG_DMA
comma
id|p-&gt;mhpg
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|O2_FIFO_ENA
comma
id|p-&gt;fifo
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|O2_MODE_E
comma
id|p-&gt;mode_e
)paren
suffix:semicolon
)brace
)brace
DECL|function|o2micro_set_opts
r_static
id|u_int
id|__init
id|o2micro_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|o2micro_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.o2micro
suffix:semicolon
id|u_int
id|mask
op_assign
l_int|0xffff
suffix:semicolon
id|p-&gt;mode_b
op_assign
(paren
id|p-&gt;mode_b
op_amp
op_complement
id|O2_MODE_B_IDENT
)paren
op_or
id|O2_MODE_B_ID_CSTEP
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;mode_b
comma
id|O2_MODE_B_IRQ15_RI
comma
id|has_ring
)paren
suffix:semicolon
id|p-&gt;mode_c
op_and_assign
op_complement
(paren
id|O2_MODE_C_ZVIDEO
op_or
id|O2_MODE_C_DREQ_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|p-&gt;mode_d
op_and_assign
op_complement
id|O2_MODE_D_W97_IRQ
suffix:semicolon
id|p-&gt;mode_e
op_and_assign
op_complement
id|O2_MODE_E_MHPG_DMA
suffix:semicolon
id|p-&gt;mhpg
op_or_assign
id|O2_MHPG_CINT_ENA
op_or
id|O2_MHPG_CSC_ENA
suffix:semicolon
id|p-&gt;mhpg
op_and_assign
op_complement
id|O2_MHPG_CHANNEL
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;revision
op_eq
l_int|0x34
)paren
id|p-&gt;mode_c
op_assign
l_int|0x20
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p-&gt;mode_b
op_amp
id|O2_MODE_B_IRQ15_RI
)paren
id|mask
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [a %02x] [b %02x] [c %02x] [d %02x]&quot;
comma
id|p-&gt;mode_a
comma
id|p-&gt;mode_b
comma
id|p-&gt;mode_c
comma
id|p-&gt;mode_d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|buf
op_add_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [mhpg %02x] [fifo %02x] [e %02x]&quot;
comma
id|p-&gt;mhpg
comma
id|p-&gt;fifo
comma
id|p-&gt;mode_e
)paren
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for the Toshiba&n;    ToPIC 95 and 97 controllers, and to set and report global&n;    configuration options.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|topic_get_state
r_static
r_void
id|topic_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|topic_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.topic
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TOPIC_SLOT_CONTROL
comma
op_amp
id|p-&gt;slot
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TOPIC_CARD_CONTROL
comma
op_amp
id|p-&gt;ccr
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|TOPIC_CARD_DETECT
comma
op_amp
id|p-&gt;cdr
)paren
suffix:semicolon
id|config_readl
c_func
(paren
id|t
comma
id|TOPIC_REGISTER_CONTROL
comma
op_amp
id|p-&gt;rcr
)paren
suffix:semicolon
)brace
DECL|function|topic_set_state
r_static
r_void
id|topic_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|topic_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.topic
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TOPIC_SLOT_CONTROL
comma
id|p-&gt;slot
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TOPIC_CARD_CONTROL
comma
id|p-&gt;ccr
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|TOPIC_CARD_DETECT
comma
id|p-&gt;cdr
)paren
suffix:semicolon
id|config_writel
c_func
(paren
id|t
comma
id|TOPIC_REGISTER_CONTROL
comma
id|p-&gt;rcr
)paren
suffix:semicolon
)brace
DECL|function|topic_set_irq_mode
r_static
r_int
id|topic_set_irq_mode
c_func
(paren
id|u_short
id|s
comma
r_int
id|pcsc
comma
r_int
id|pint
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_TOPIC97
)paren
(brace
id|topic_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.topic
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;ccr
comma
id|TOPIC97_ICR_IRQSEL
comma
id|pcsc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* no ISA card status change irq */
r_return
op_logical_neg
id|pcsc
suffix:semicolon
)brace
)brace
DECL|function|topic_set_opts
r_static
id|u_int
id|__init
id|topic_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|topic_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.topic
suffix:semicolon
id|p-&gt;slot
op_or_assign
id|TOPIC_SLOT_SLOTON
op_or
id|TOPIC_SLOT_SLOTEN
op_or
id|TOPIC_SLOT_ID_LOCK
suffix:semicolon
id|p-&gt;cdr
op_or_assign
id|TOPIC_CDR_MODE_PC32
suffix:semicolon
id|p-&gt;cdr
op_and_assign
op_complement
(paren
id|TOPIC_CDR_SW_DETECT
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [slot 0x%02x] [ccr 0x%02x] [cdr 0x%02x] [rcr 0x%02x]&quot;
comma
id|p-&gt;slot
comma
id|p-&gt;ccr
comma
id|p-&gt;cdr
comma
id|p-&gt;rcr
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Routines to handle common CardBus options&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|cb_get_state
r_static
r_void
id|cb_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|t-&gt;cache
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|t-&gt;pci_lat
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|CB_LATENCY_TIMER
comma
op_amp
id|t-&gt;cb_lat
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|CB_CARDBUS_BUS
comma
op_amp
id|t-&gt;cap.cardbus
)paren
suffix:semicolon
id|config_readb
c_func
(paren
id|t
comma
id|CB_SUBORD_BUS
comma
op_amp
id|t-&gt;sub_bus
)paren
suffix:semicolon
id|config_readw
c_func
(paren
id|t
comma
id|CB_BRIDGE_CONTROL
comma
op_amp
id|t-&gt;bcr
)paren
suffix:semicolon
id|t-&gt;cap.pci_irq
op_assign
id|t-&gt;pdev-&gt;irq
suffix:semicolon
)brace
DECL|function|cb_set_state
r_static
r_void
id|cb_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|t-&gt;pdev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* FIXME: Do we really need all of this? */
id|config_writel
c_func
(paren
id|t
comma
id|CB_LEGACY_MODE_BASE
comma
l_int|0
)paren
suffix:semicolon
id|config_writel
c_func
(paren
id|t
comma
id|PCI_BASE_ADDRESS_0
comma
id|t-&gt;cb_phys
)paren
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|PCI_COMMAND
comma
id|CMD_DFLT
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|PCI_CACHE_LINE_SIZE
comma
id|t-&gt;cache
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|PCI_LATENCY_TIMER
comma
id|t-&gt;pci_lat
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|CB_LATENCY_TIMER
comma
id|t-&gt;cb_lat
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|CB_CARDBUS_BUS
comma
id|t-&gt;cap.cardbus
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
id|t
comma
id|CB_SUBORD_BUS
comma
id|t-&gt;sub_bus
)paren
suffix:semicolon
id|config_writew
c_func
(paren
id|t
comma
id|CB_BRIDGE_CONTROL
comma
id|t-&gt;bcr
)paren
suffix:semicolon
)brace
DECL|function|cb_get_irq_mode
r_static
r_int
id|cb_get_irq_mode
c_func
(paren
id|u_short
id|s
)paren
(brace
r_return
(paren
op_logical_neg
(paren
id|socket
(braket
id|s
)braket
dot
id|bcr
op_amp
id|CB_BCR_ISA_IRQ
)paren
)paren
suffix:semicolon
)brace
DECL|function|cb_set_irq_mode
r_static
r_int
id|cb_set_irq_mode
c_func
(paren
id|u_short
id|s
comma
r_int
id|pcsc
comma
r_int
id|pint
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|flip
c_func
(paren
id|t-&gt;bcr
comma
id|CB_BCR_ISA_IRQ
comma
op_logical_neg
(paren
id|pint
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
r_return
id|cirrus_set_irq_mode
c_func
(paren
id|s
comma
id|pcsc
comma
id|pint
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TI
)paren
r_return
id|ti113x_set_irq_mode
c_func
(paren
id|s
comma
id|pcsc
comma
id|pint
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TOPIC
)paren
r_return
id|topic_set_irq_mode
c_func
(paren
id|s
comma
id|pcsc
comma
id|pint
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
id|pci_scan
c_func
(paren
id|u_short
id|sock
)paren
suffix:semicolon
DECL|function|cb_set_opts
r_static
r_void
id|__init
id|cb_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|t-&gt;bcr
op_or_assign
id|CB_BCR_WRITE_POST
suffix:semicolon
multiline_comment|/* some TI1130&squot;s seem to exhibit problems with write posting */
r_if
c_cond
(paren
(paren
(paren
id|t-&gt;type
op_eq
id|IS_TI1130
)paren
op_logical_and
(paren
id|t-&gt;revision
op_eq
l_int|4
)paren
op_logical_and
(paren
id|cb_write_post
OL
l_int|0
)paren
)paren
op_logical_or
(paren
id|cb_write_post
op_eq
l_int|0
)paren
)paren
id|t-&gt;bcr
op_and_assign
op_complement
id|CB_BCR_WRITE_POST
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;cache
op_eq
l_int|0
)paren
id|t-&gt;cache
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|pci_latency
op_ge
l_int|0
)paren
id|t-&gt;pci_lat
op_assign
id|pci_latency
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;pci_lat
op_eq
l_int|0
)paren
id|t-&gt;pci_lat
op_assign
l_int|0xa8
suffix:semicolon
r_if
c_cond
(paren
id|cb_latency
op_ge
l_int|0
)paren
id|t-&gt;cb_lat
op_assign
id|cb_latency
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;cb_lat
op_eq
l_int|0
)paren
id|t-&gt;cb_lat
op_assign
l_int|0xb0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t-&gt;cap.pci_irq
op_eq
l_int|0
)paren
op_logical_and
(paren
id|pci_csc
op_logical_or
id|pci_int
)paren
op_logical_and
id|do_scan
)paren
id|pci_scan
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;cap.pci_irq
op_eq
l_int|0
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [no pci irq]&quot;
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [pci irq %d]&quot;
comma
id|t-&gt;cap.pci_irq
)paren
suffix:semicolon
id|buf
op_add_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cb_bus_base
OG
l_int|0
)paren
op_logical_or
(paren
id|t-&gt;cap.cardbus
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|cb_bus_base
op_le
l_int|0
)paren
id|cb_bus_base
op_assign
l_int|0x20
suffix:semicolon
id|t-&gt;cap.cardbus
op_assign
id|cb_bus_base
suffix:semicolon
id|t-&gt;sub_bus
op_assign
id|cb_bus_base
op_plus
id|cb_bus_step
suffix:semicolon
id|cb_bus_base
op_add_assign
id|cb_bus_step
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;flags
op_amp
id|IS_TOPIC
)paren
)paren
id|t-&gt;cap.features
op_or_assign
id|SS_CAP_PAGE_REGS
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [lat %d/%d] [bus %d/%d]&quot;
comma
id|t-&gt;pci_lat
comma
id|t-&gt;cb_lat
comma
id|t-&gt;cap.cardbus
comma
id|t-&gt;sub_bus
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    Generic routines to get and set controller options&n;    &n;======================================================================*/
DECL|function|get_bridge_state
r_static
r_void
id|get_bridge_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
id|cirrus_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VADEM
)paren
id|vg46x_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_O2MICRO
)paren
id|o2micro_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TI
)paren
id|ti113x_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_RICOH
)paren
id|rl5c4xx_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TOPIC
)paren
id|topic_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
id|cb_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|set_bridge_state
r_static
r_void
id|set_bridge_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
id|cb_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
id|cirrus_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
(brace
id|i365_set
c_func
(paren
id|s
comma
id|I365_GBLCTL
comma
l_int|0x00
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|I365_GENCTL
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|i365_bflip
c_func
(paren
id|s
comma
id|I365_INTCTL
comma
id|I365_INTR_ENA
comma
id|t-&gt;intr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VADEM
)paren
id|vg46x_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_O2MICRO
)paren
id|o2micro_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TI
)paren
id|ti113x_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_RICOH
)paren
id|rl5c4xx_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_TOPIC
)paren
id|topic_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|set_bridge_opts
r_static
id|u_int
id|__init
id|set_bridge_opts
c_func
(paren
id|u_short
id|s
comma
id|u_short
id|ns
)paren
(brace
id|u_short
id|i
suffix:semicolon
id|u_int
id|m
op_assign
l_int|0xffff
suffix:semicolon
r_char
id|buf
(braket
l_int|128
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|s
suffix:semicolon
id|i
OL
id|s
op_plus
id|ns
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    host opts [%d]: already alive!&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|buf
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|get_bridge_state
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CIRRUS
)paren
id|m
op_assign
id|cirrus_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_VADEM
)paren
id|m
op_assign
id|vg46x_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_O2MICRO
)paren
id|m
op_assign
id|o2micro_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_TI
)paren
id|m
op_assign
id|ti113x_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_RICOH
)paren
id|m
op_assign
id|rl5c4xx_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_TOPIC
)paren
id|m
op_assign
id|topic_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
id|cb_set_opts
c_func
(paren
id|i
comma
id|buf
op_plus
id|strlen
c_func
(paren
id|buf
)paren
)paren
suffix:semicolon
macro_line|#endif
id|set_bridge_state
c_func
(paren
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    host opts [%d]:%s&bslash;n&quot;
comma
id|i
comma
(paren
op_star
id|buf
)paren
ques
c_cond
id|buf
suffix:colon
l_string|&quot; none&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Mask out all PCI interrupts */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
id|m
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|socket
(braket
id|i
)braket
dot
id|cap.pci_irq
)paren
suffix:semicolon
(brace
r_struct
id|pci_dev
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|pci_devices
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
id|m
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|p-&gt;irq
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|m
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Interrupt testing code, for ISA and PCI interrupts&n;    &n;======================================================================*/
DECL|variable|irq_hits
r_static
r_volatile
id|u_int
id|irq_hits
suffix:semicolon
DECL|variable|irq_sock
r_static
id|u_short
id|irq_sock
suffix:semicolon
DECL|function|irq_count
r_static
r_void
id|irq_count
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|irq_sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|cb_writel
c_func
(paren
id|irq_sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|i365_get
c_func
(paren
id|irq_sock
comma
id|I365_CSC
)paren
suffix:semicolon
id|irq_hits
op_increment
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;-&gt; hit on irq %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|function|test_irq
r_static
id|u_int
id|__init
id|test_irq
c_func
(paren
id|u_short
id|sock
comma
r_int
id|irq
comma
r_int
id|pci
)paren
(brace
id|u_char
id|csc
op_assign
(paren
id|pci
)paren
ques
c_cond
l_int|0
suffix:colon
id|irq
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;  testing %s irq %d&bslash;n&quot;
comma
id|pci
ques
c_cond
l_string|&quot;PCI&quot;
suffix:colon
l_string|&quot;ISA&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|irq_count
comma
(paren
id|pci
ques
c_cond
id|SA_SHIRQ
suffix:colon
l_int|0
)paren
comma
l_string|&quot;scan&quot;
comma
l_int|NULL
)paren
op_ne
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|irq_hits
op_assign
l_int|0
suffix:semicolon
id|irq_sock
op_assign
id|sock
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_hits
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;    spurious hit!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Generate one interrupt */
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|I365_CSC_STSCHG
op_or
(paren
id|csc
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_MASK
comma
id|CB_SM_CSTSCHG
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_FORCE
comma
id|CB_SE_CSTSCHG
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_MASK
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|I365_CSC_DETECT
op_or
(paren
id|csc
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_GENCTL
comma
id|I365_CTL_SW_IRQ
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* mask all interrupts */
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;    hits = %d&bslash;n&quot;
comma
id|irq_hits
)paren
suffix:semicolon
r_return
(paren
id|irq_hits
op_ne
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISA
DECL|function|isa_scan
r_static
id|u_int
id|__init
id|isa_scan
c_func
(paren
id|u_short
id|sock
comma
id|u_int
id|mask0
)paren
(brace
id|u_int
id|mask1
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef __alpha__
DECL|macro|PIC
mdefine_line|#define PIC 0x4d0
multiline_comment|/* Don&squot;t probe level-triggered interrupts -- reserved for PCI */
id|mask0
op_and_assign
op_complement
(paren
id|inb
c_func
(paren
id|PIC
)paren
op_or
(paren
id|inb
c_func
(paren
id|PIC
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Only scan if we can select ISA csc irq&squot;s */
r_if
c_cond
(paren
op_logical_neg
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
op_logical_or
(paren
id|cb_set_irq_mode
c_func
(paren
id|sock
comma
l_int|0
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
macro_line|#endif
r_if
c_cond
(paren
id|do_scan
)paren
(brace
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask0
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
id|mask1
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask1
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
comma
l_int|0
)paren
op_ne
l_int|0
)paren
)paren
id|mask1
op_xor_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    ISA irqs (&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;scanned&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Fallback: just find interrupts that aren&squot;t in use */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask0
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|_check_irq
c_func
(paren
id|i
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
id|mask1
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;default&quot;
)paren
suffix:semicolon
multiline_comment|/* If scan failed, default to polled status */
r_if
c_cond
(paren
op_logical_neg
id|cs_irq
op_logical_and
(paren
id|poll_interval
op_eq
l_int|0
)paren
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;) = &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mask1
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s%d&quot;
comma
(paren
(paren
id|mask1
op_amp
(paren
(paren
l_int|1
op_lshift
id|i
)paren
op_minus
l_int|1
)paren
)paren
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask1
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;none!&quot;
)paren
suffix:semicolon
r_return
id|mask1
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ISA */
macro_line|#ifdef CONFIG_PCI
DECL|function|pci_scan
r_static
r_void
id|__init
id|pci_scan
c_func
(paren
id|u_short
id|sock
)paren
(brace
id|u_int
id|i
suffix:semicolon
id|cb_set_irq_mode
c_func
(paren
id|sock
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Only probe irq&squot;s 9..11, to be conservative */
r_for
c_loop
(paren
id|i
op_assign
l_int|9
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
comma
l_int|1
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
comma
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|12
)paren
id|socket
(braket
id|sock
)braket
dot
id|cap.pci_irq
op_assign
id|i
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
multiline_comment|/*====================================================================*/
multiline_comment|/* Time conversion functions */
DECL|function|to_cycles
r_static
r_int
id|to_cycles
c_func
(paren
r_int
id|ns
)paren
(brace
r_return
id|ns
op_div
id|cycle_time
suffix:semicolon
)brace
DECL|function|to_ns
r_static
r_int
id|to_ns
c_func
(paren
r_int
id|cycles
)paren
(brace
r_return
id|cycle_time
op_star
id|cycles
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
macro_line|#ifdef CONFIG_ISA
DECL|function|identify
r_static
r_int
id|__init
id|identify
c_func
(paren
id|u_short
id|port
comma
id|u_short
id|sock
)paren
(brace
id|u_char
id|val
suffix:semicolon
r_int
id|type
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Use the next free entry in the socket table */
id|socket
(braket
id|sockets
)braket
dot
id|ioaddr
op_assign
id|port
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|psock
op_assign
id|sock
suffix:semicolon
multiline_comment|/* Wake up a sleepy Cirrus controller */
r_if
c_cond
(paren
id|wakeup
)paren
(brace
id|i365_bclr
c_func
(paren
id|sockets
comma
id|PD67_MISC_CTL_2
comma
id|PD67_MC2_SUSPEND
)paren
suffix:semicolon
multiline_comment|/* Pause at least 50 ms */
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|I365_IDENT
)paren
)paren
op_amp
l_int|0x70
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0x82
suffix:colon
id|type
op_assign
id|IS_I82365A
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x83
suffix:colon
id|type
op_assign
id|IS_I82365B
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x84
suffix:colon
id|type
op_assign
id|IS_I82365DF
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x88
suffix:colon
r_case
l_int|0x89
suffix:colon
r_case
l_int|0x8a
suffix:colon
id|type
op_assign
id|IS_IBM
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Check for Vadem VG-468 chips */
id|outb
c_func
(paren
l_int|0x0e
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x37
comma
id|port
)paren
suffix:semicolon
id|i365_bset
c_func
(paren
id|sockets
comma
id|VG468_MISC
comma
id|VG468_MISC_VADEMREV
)paren
suffix:semicolon
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|I365_IDENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|I365_IDENT_VADEM
)paren
(brace
id|i365_bclr
c_func
(paren
id|sockets
comma
id|VG468_MISC
comma
id|VG468_MISC_VADEMREV
)paren
suffix:semicolon
id|type
op_assign
(paren
(paren
id|val
op_amp
l_int|7
)paren
op_ge
l_int|4
)paren
ques
c_cond
id|IS_VG469
suffix:colon
id|IS_VG468
suffix:semicolon
)brace
multiline_comment|/* Check for Ricoh chips */
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|RF5C_CHIP_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_eq
id|RF5C_CHIP_RF5C296
)paren
op_logical_or
(paren
id|val
op_eq
id|RF5C_CHIP_RF5C396
)paren
)paren
id|type
op_assign
id|IS_RF5Cx96
suffix:semicolon
multiline_comment|/* Check for Cirrus CL-PD67xx chips */
id|i365_set
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
comma
l_int|0
)paren
suffix:semicolon
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|PD67_INFO_CHIP_ID
)paren
op_eq
id|PD67_INFO_CHIP_ID
)paren
(brace
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|PD67_INFO_CHIP_ID
)paren
op_eq
l_int|0
)paren
(brace
id|type
op_assign
(paren
id|val
op_amp
id|PD67_INFO_SLOTS
)paren
ques
c_cond
id|IS_PD672X
suffix:colon
id|IS_PD6710
suffix:semicolon
id|i365_set
c_func
(paren
id|sockets
comma
id|PD67_EXT_INDEX
comma
l_int|0xe5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_EXT_INDEX
)paren
op_ne
l_int|0xe5
)paren
id|type
op_assign
id|IS_VT83C469
suffix:semicolon
)brace
)brace
r_return
id|type
suffix:semicolon
)brace
multiline_comment|/* identify */
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    See if a card is present, powered up, in IO mode, and already&n;    bound to a (non PC Card) Linux driver.  We leave these alone.&n;&n;    We make an exception for cards that seem to be serial devices.&n;    &n;======================================================================*/
DECL|function|is_alive
r_static
r_int
id|__init
id|is_alive
c_func
(paren
id|u_short
id|sock
)paren
(brace
id|u_char
id|stat
suffix:semicolon
id|u_short
id|start
comma
id|stop
suffix:semicolon
id|stat
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_STATUS
)paren
suffix:semicolon
id|start
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_START
)paren
suffix:semicolon
id|stop
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_STOP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|I365_CS_DETECT
)paren
op_logical_and
(paren
id|stat
op_amp
id|I365_CS_POWERON
)paren
op_logical_and
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
op_logical_and
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_IO
c_func
(paren
l_int|0
)paren
)paren
op_logical_and
(paren
id|check_region
c_func
(paren
id|start
comma
id|stop
op_minus
id|start
op_plus
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|start
op_amp
l_int|0xfeef
)paren
op_ne
l_int|0x02e8
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
DECL|function|add_socket
r_static
r_void
id|__init
id|add_socket
c_func
(paren
id|u_short
id|port
comma
r_int
id|psock
comma
r_int
id|type
)paren
(brace
id|socket
(braket
id|sockets
)braket
dot
id|ioaddr
op_assign
id|port
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|psock
op_assign
id|psock
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|type
op_assign
id|type
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|flags
op_assign
id|pcic
(braket
id|type
)braket
dot
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|is_alive
c_func
(paren
id|sockets
)paren
)paren
id|socket
(braket
id|sockets
)braket
dot
id|flags
op_or_assign
id|IS_ALIVE
suffix:semicolon
id|sockets
op_increment
suffix:semicolon
)brace
DECL|function|add_pcic
r_static
r_void
id|__init
id|add_pcic
c_func
(paren
r_int
id|ns
comma
r_int
id|type
)paren
(brace
id|u_int
id|mask
op_assign
l_int|0
comma
id|i
comma
id|base
suffix:semicolon
r_int
id|use_pci
op_assign
l_int|0
comma
id|isa_irq
op_assign
l_int|0
suffix:semicolon
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sockets
op_minus
id|ns
)braket
suffix:semicolon
id|base
op_assign
id|sockets
op_minus
id|ns
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;ioaddr
OG
l_int|0
)paren
id|request_region
c_func
(paren
id|t-&gt;ioaddr
comma
l_int|2
comma
l_string|&quot;i82365&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|base
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  %s&quot;
comma
id|pcic
(braket
id|type
)braket
dot
id|name
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_UNKNOWN
)paren
id|printk
c_func
(paren
l_string|&quot; [0x%04x 0x%04x]&quot;
comma
id|t-&gt;pdev-&gt;vendor
comma
id|t-&gt;pdev-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
id|printk
c_func
(paren
l_string|&quot; PCI-to-CardBus at %s, mem 0x%08x&quot;
comma
id|t-&gt;pdev-&gt;slot_name
comma
id|t-&gt;cb_phys
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_PCI
)paren
id|printk
c_func
(paren
l_string|&quot; PCI-to-PCMCIA at %s, port %#x&quot;
comma
id|t-&gt;pdev-&gt;slot_name
comma
id|t-&gt;ioaddr
)paren
suffix:semicolon
r_else
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot; ISA-to-PCMCIA at port %#x ofs 0x%02x&quot;
comma
id|t-&gt;ioaddr
comma
id|t-&gt;psock
op_star
l_int|0x40
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, %d socket%s&bslash;n&quot;
comma
id|ns
comma
(paren
(paren
id|ns
OG
l_int|1
)paren
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
multiline_comment|/* Set host options, build basic interrupt mask */
r_if
c_cond
(paren
id|irq_list
(braket
l_int|0
)braket
op_eq
op_minus
l_int|1
)paren
id|mask
op_assign
id|irq_mask
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
id|mask
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|mask
op_or_assign
(paren
l_int|1
op_lshift
id|irq_list
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#endif
id|mask
op_and_assign
id|I365_MASK
op_amp
id|set_bridge_opts
c_func
(paren
id|base
comma
id|ns
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
multiline_comment|/* Scan for ISA interrupts */
id|mask
op_assign
id|isa_scan
c_func
(paren
id|base
comma
id|mask
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    PCI card interrupts,&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Can we use a PCI interrupt for card status changes? */
r_if
c_cond
(paren
id|pci_csc
op_logical_and
id|t-&gt;cap.pci_irq
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ns
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|_check_irq
c_func
(paren
id|t
(braket
id|i
)braket
dot
id|cap.pci_irq
comma
id|SA_SHIRQ
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|ns
)paren
(brace
id|use_pci
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; PCI status changes&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ISA
multiline_comment|/* Poll if only two interrupts available */
r_if
c_cond
(paren
op_logical_neg
id|use_pci
op_logical_and
op_logical_neg
id|poll_interval
)paren
(brace
id|u_int
id|tmp
op_assign
(paren
id|mask
op_amp
l_int|0xff20
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp
op_amp
(paren
id|tmp
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
(paren
id|tmp
op_minus
l_int|1
)paren
)paren
op_eq
l_int|0
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
)brace
multiline_comment|/* Only try an ISA cs_irq if this is the first controller */
r_if
c_cond
(paren
op_logical_neg
id|use_pci
op_logical_and
op_logical_neg
id|grab_irq
op_logical_and
(paren
id|cs_irq
op_logical_or
op_logical_neg
id|poll_interval
)paren
)paren
(brace
multiline_comment|/* Avoid irq 12 unless it is explicitly requested */
id|u_int
id|cs_mask
op_assign
id|mask
op_amp
(paren
(paren
id|cs_irq
)paren
ques
c_cond
(paren
l_int|1
op_lshift
id|cs_irq
)paren
suffix:colon
op_complement
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cs_irq
op_assign
l_int|15
suffix:semicolon
id|cs_irq
OG
l_int|0
suffix:semicolon
id|cs_irq
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|cs_mask
op_amp
(paren
l_int|1
op_lshift
id|cs_irq
)paren
)paren
op_logical_and
(paren
id|_check_irq
c_func
(paren
id|cs_irq
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|cs_irq
)paren
(brace
id|grab_irq
op_assign
l_int|1
suffix:semicolon
id|isa_irq
op_assign
id|cs_irq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; status change on irq %d&bslash;n&quot;
comma
id|cs_irq
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|use_pci
op_logical_and
op_logical_neg
id|isa_irq
)paren
(brace
r_if
c_cond
(paren
id|poll_interval
op_eq
l_int|0
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; polling interval = %d ms&bslash;n&quot;
comma
id|poll_interval
op_star
l_int|1000
op_div
id|HZ
)paren
suffix:semicolon
)brace
multiline_comment|/* Update socket interrupt information, capabilities */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ns
suffix:semicolon
id|i
op_increment
)paren
(brace
id|t
(braket
id|i
)braket
dot
id|cap.features
op_or_assign
id|SS_CAP_PCCARD
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|cap.map_size
op_assign
l_int|0x1000
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|cap.irq_mask
op_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|pci_int
op_logical_and
id|t
(braket
id|i
)braket
dot
id|cap.pci_irq
)paren
id|t
(braket
id|i
)braket
dot
id|cap.irq_mask
op_or_assign
(paren
l_int|1
op_lshift
id|t
(braket
id|i
)braket
dot
id|cap.pci_irq
)paren
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|cs_irq
op_assign
id|isa_irq
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|t
(braket
id|i
)braket
dot
id|cap.features
op_or_assign
id|SS_CAP_CARDBUS
suffix:semicolon
id|cb_set_irq_mode
c_func
(paren
id|i
comma
id|pci_csc
op_logical_and
id|t
(braket
id|i
)braket
dot
id|cap.pci_irq
comma
id|pci_int
op_logical_and
id|t
(braket
id|i
)braket
dot
id|cap.pci_irq
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
multiline_comment|/* add_pcic */
multiline_comment|/*====================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|add_pci_bridge
r_static
r_void
id|__init
id|add_pci_bridge
c_func
(paren
r_int
id|type
comma
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sockets
)braket
suffix:semicolon
id|u_short
id|i
comma
id|ns
suffix:semicolon
id|u32
id|addr
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|PCIC_COUNT
)paren
id|type
op_assign
id|IS_UNK_PCI
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|CMD_DFLT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ns
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
(paren
id|type
op_eq
id|IS_I82092AA
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|2
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|s-&gt;pdev
op_assign
id|dev
suffix:semicolon
id|add_socket
c_func
(paren
id|addr
comma
id|i
comma
id|type
)paren
suffix:semicolon
id|ns
op_increment
suffix:semicolon
id|s
op_increment
suffix:semicolon
)brace
id|add_pcic
c_func
(paren
id|ns
comma
id|type
)paren
suffix:semicolon
)brace
DECL|function|add_cb_bridge
r_static
r_void
id|__init
id|add_cb_bridge
c_func
(paren
r_int
id|type
comma
r_struct
id|pci_dev
op_star
id|dev0
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sockets
)braket
suffix:semicolon
id|u_short
id|i
comma
id|ns
suffix:semicolon
id|u_char
id|a
comma
id|b
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|PCIC_COUNT
)paren
id|type
op_assign
id|IS_UNK_CARDBUS
suffix:semicolon
r_for
c_loop
(paren
id|ns
op_assign
l_int|0
suffix:semicolon
id|ns
OL
l_int|8
suffix:semicolon
id|ns
op_increment
comma
id|s
op_increment
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|dev0-&gt;bus-&gt;number
comma
id|dev0-&gt;devfn
op_plus
id|ns
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_break
suffix:semicolon
id|s-&gt;pdev
op_assign
id|dev
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|s-&gt;revision
)paren
suffix:semicolon
multiline_comment|/* Map CardBus registers if they are not already mapped */
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|CB_LEGACY_MODE_BASE
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;cb_phys
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;cb_phys
op_logical_or
op_logical_neg
(paren
id|s-&gt;cb_virt
op_assign
id|ioremap
c_func
(paren
id|s-&gt;cb_phys
comma
l_int|0x1000
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  No control registers found!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|request_mem_region
c_func
(paren
id|s-&gt;cb_phys
comma
l_int|0x1000
comma
l_string|&quot;i82365&quot;
)paren
suffix:semicolon
id|s-&gt;cap.cb_dev
op_assign
id|dev
suffix:semicolon
id|add_socket
c_func
(paren
l_int|0
comma
l_int|0
comma
id|type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ns
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|s
op_sub_assign
id|ns
suffix:semicolon
r_if
c_cond
(paren
id|ns
op_eq
l_int|2
)paren
(brace
multiline_comment|/* Nasty special check for bad bus mapping */
id|config_readb
c_func
(paren
op_amp
id|s
(braket
l_int|0
)braket
comma
id|CB_CARDBUS_BUS
comma
op_amp
id|a
)paren
suffix:semicolon
id|config_readb
c_func
(paren
op_amp
id|s
(braket
l_int|1
)braket
comma
id|CB_CARDBUS_BUS
comma
op_amp
id|b
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_eq
id|b
)paren
(brace
id|config_writeb
c_func
(paren
op_amp
id|s
(braket
l_int|0
)braket
comma
id|CB_CARDBUS_BUS
comma
l_int|0
)paren
suffix:semicolon
id|config_writeb
c_func
(paren
op_amp
id|s
(braket
l_int|1
)braket
comma
id|CB_CARDBUS_BUS
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|add_pcic
c_func
(paren
id|ns
comma
id|type
)paren
suffix:semicolon
multiline_comment|/* Re-do card voltage detection, if needed: this checks for&n;       card presence with no voltage detect bits set */
r_for
c_loop
(paren
id|a
op_assign
id|sockets
op_minus
id|ns
suffix:semicolon
id|a
OL
id|sockets
suffix:semicolon
id|a
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|cb_readl
c_func
(paren
id|a
comma
id|CB_SOCKET_STATE
)paren
op_amp
l_int|0x3c86
)paren
)paren
id|cb_writel
c_func
(paren
id|a
comma
id|CB_SOCKET_FORCE
comma
id|CB_SF_CVSTEST
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|200
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|a
op_assign
id|sockets
op_minus
id|ns
suffix:semicolon
id|a
OL
id|sockets
suffix:semicolon
id|a
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|cb_readl
c_func
(paren
id|a
comma
id|CB_SOCKET_STATE
)paren
op_amp
l_int|0x3c86
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|a
op_eq
id|sockets
)paren
r_break
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|200
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;i82365: card voltage interrogation&quot;
l_string|&quot; timed out!&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|pci_probe
r_static
r_void
id|__init
id|pci_probe
c_func
(paren
id|u_int
r_class
comma
r_void
(paren
id|add_fn
)paren
(paren
r_int
comma
r_struct
id|pci_dev
op_star
)paren
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|u_short
id|i
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pci_find_class
c_func
(paren
r_class
op_lshift
l_int|8
comma
id|dev
)paren
)paren
)paren
(brace
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PCIC_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|pcic
(braket
id|i
)braket
dot
id|vendor
op_eq
id|dev-&gt;vendor
)paren
op_logical_and
(paren
id|pcic
(braket
id|i
)braket
dot
id|device
op_eq
id|dev-&gt;device
)paren
)paren
r_break
suffix:semicolon
id|add_fn
c_func
(paren
id|i
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_PCI */
multiline_comment|/*====================================================================*/
macro_line|#ifdef CONFIG_ISA
DECL|function|isa_probe
r_static
r_void
id|__init
id|isa_probe
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
comma
id|sock
comma
id|k
comma
id|ns
comma
id|id
suffix:semicolon
id|ioaddr_t
id|port
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|i365_base
comma
l_int|2
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sockets
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;port conflict at %#x&bslash;n&quot;
comma
id|i365_base
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|id
op_assign
id|identify
c_func
(paren
id|i365_base
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|id
op_eq
id|IS_I82365DF
)paren
op_logical_and
(paren
id|identify
c_func
(paren
id|i365_base
comma
l_int|1
)paren
op_ne
id|id
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|ignore
)paren
r_continue
suffix:semicolon
id|port
op_assign
id|i365_base
op_plus
(paren
(paren
id|i
op_amp
l_int|1
)paren
op_lshift
l_int|2
)paren
op_plus
(paren
(paren
id|i
op_amp
l_int|2
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|sock
op_assign
(paren
id|i
op_amp
l_int|1
)paren
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|identify
c_func
(paren
id|port
comma
id|sock
)paren
op_eq
id|IS_I82365DF
)paren
(brace
id|add_socket
c_func
(paren
id|port
comma
id|sock
comma
id|IS_VLSI
)paren
suffix:semicolon
id|add_pcic
c_func
(paren
l_int|1
comma
id|IS_VLSI
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|extra_sockets
ques
c_cond
l_int|8
suffix:colon
l_int|4
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|port
op_assign
id|i365_base
op_plus
l_int|2
op_star
(paren
id|i
op_rshift
l_int|2
)paren
suffix:semicolon
id|sock
op_assign
(paren
id|i
op_amp
l_int|3
)paren
suffix:semicolon
id|id
op_assign
id|identify
c_func
(paren
id|port
comma
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|ns
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
multiline_comment|/* Does the socket exist? */
r_if
c_cond
(paren
(paren
id|ignore
op_eq
id|i
op_plus
id|j
)paren
op_logical_or
(paren
id|identify
c_func
(paren
id|port
comma
id|sock
op_plus
id|j
)paren
OL
l_int|0
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* Check for bad socket decode */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
op_le
id|sockets
suffix:semicolon
id|k
op_increment
)paren
id|i365_set
c_func
(paren
id|k
comma
id|I365_MEM
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_OFF
comma
id|k
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
op_le
id|sockets
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|k
comma
id|I365_MEM
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_OFF
)paren
op_ne
id|k
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|k
op_le
id|sockets
)paren
r_break
suffix:semicolon
id|add_socket
c_func
(paren
id|port
comma
id|sock
op_plus
id|j
comma
id|id
)paren
suffix:semicolon
id|ns
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ns
op_ne
l_int|0
)paren
id|add_pcic
c_func
(paren
id|ns
comma
id|id
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
multiline_comment|/*====================================================================*/
DECL|function|pcic_interrupt
r_static
r_void
id|pcic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
comma
id|j
comma
id|csc
suffix:semicolon
id|u_int
id|events
comma
id|active
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
id|u_long
id|flags
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;i82365: pcic_interrupt(%d)&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|20
suffix:semicolon
id|j
op_increment
)paren
(brace
id|active
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|socket
(braket
id|i
)braket
dot
id|cs_irq
op_ne
id|irq
)paren
op_logical_and
(paren
id|socket
(braket
id|i
)braket
dot
id|cap.pci_irq
op_ne
id|irq
)paren
)paren
r_continue
suffix:semicolon
id|ISA_LOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
id|csc
op_assign
id|i365_get
c_func
(paren
id|i
comma
id|I365_CSC
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
op_logical_and
(paren
id|cb_readl
c_func
(paren
id|i
comma
id|CB_SOCKET_EVENT
)paren
op_amp
(paren
id|CB_SE_CCD1
op_or
id|CB_SE_CCD2
)paren
)paren
)paren
(brace
id|cb_writel
c_func
(paren
id|i
comma
id|CB_SOCKET_EVENT
comma
id|CB_SE_CCD1
op_or
id|CB_SE_CCD2
)paren
suffix:semicolon
id|csc
op_or_assign
id|I365_CSC_DETECT
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|csc
op_eq
l_int|0
)paren
op_logical_or
(paren
op_logical_neg
id|socket
(braket
id|i
)braket
dot
id|handler
)paren
op_logical_or
(paren
id|i365_get
c_func
(paren
id|i
comma
id|I365_IDENT
)paren
op_amp
l_int|0x70
)paren
)paren
(brace
id|ISA_UNLOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|events
op_assign
(paren
id|csc
op_amp
id|I365_CSC_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|i
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_STSCHG
)paren
ques
c_cond
id|SS_STSCHG
suffix:colon
l_int|0
suffix:semicolon
r_else
(brace
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_BVD1
)paren
ques
c_cond
id|SS_BATDEAD
suffix:colon
l_int|0
suffix:semicolon
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_BVD2
)paren
ques
c_cond
id|SS_BATWARN
suffix:colon
l_int|0
suffix:semicolon
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
)brace
id|ISA_UNLOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;i82365: socket %d event 0x%02x&bslash;n&quot;
comma
id|i
comma
id|events
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
)paren
id|socket
(braket
id|i
)braket
dot
id|handler
c_func
(paren
id|socket
(braket
id|i
)braket
dot
id|info
comma
id|events
)paren
suffix:semicolon
id|active
op_or_assign
id|events
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|active
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|20
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;i82365: infinite loop in interrupt handler&bslash;n&quot;
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;i82365: interrupt done&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* pcic_interrupt */
DECL|function|pcic_interrupt_wrapper
r_static
r_void
id|pcic_interrupt_wrapper
c_func
(paren
id|u_long
id|data
)paren
(brace
id|pcic_interrupt
c_func
(paren
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|poll_timer.expires
op_assign
id|jiffies
op_plus
id|poll_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
DECL|function|pcic_register_callback
r_static
r_int
id|pcic_register_callback
c_func
(paren
r_int
r_int
id|sock
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_void
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|info
)paren
(brace
id|socket
(braket
id|sock
)braket
dot
id|handler
op_assign
id|handler
suffix:semicolon
id|socket
(braket
id|sock
)braket
dot
id|info
op_assign
id|info
suffix:semicolon
r_if
c_cond
(paren
id|handler
op_eq
l_int|NULL
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
r_else
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* pcic_register_callback */
multiline_comment|/*====================================================================*/
DECL|function|pcic_inquire_socket
r_static
r_int
id|pcic_inquire_socket
c_func
(paren
r_int
r_int
id|sock
comma
id|socket_cap_t
op_star
id|cap
)paren
(brace
op_star
id|cap
op_assign
id|socket
(braket
id|sock
)braket
dot
id|cap
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* pcic_inquire_socket */
multiline_comment|/*====================================================================*/
DECL|function|i365_get_status
r_static
r_int
id|i365_get_status
c_func
(paren
id|u_short
id|sock
comma
id|u_int
op_star
id|value
)paren
(brace
id|u_int
id|status
suffix:semicolon
id|status
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_STATUS
)paren
suffix:semicolon
op_star
id|value
op_assign
(paren
(paren
id|status
op_amp
id|I365_CS_DETECT
)paren
op_eq
id|I365_CS_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_STSCHG
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_STSCHG
suffix:semicolon
r_else
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_BVD1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_BATDEAD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_BVD2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_BATWARN
suffix:semicolon
)brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_WRPROT
)paren
ques
c_cond
id|SS_WRPROT
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_POWERON
)paren
ques
c_cond
id|SS_POWERON
suffix:colon
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|status
op_assign
id|cb_readl
c_func
(paren
id|sock
comma
id|CB_SOCKET_STATE
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_CARDBUS
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|CB_SS_32BIT
)paren
ques
c_cond
id|SS_CARDBUS
suffix:colon
l_int|0
suffix:semicolon
macro_line|#endif
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|CB_SS_3VCARD
)paren
ques
c_cond
id|SS_3VCARD
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|CB_SS_XVCARD
)paren
ques
c_cond
id|SS_XVCARD
suffix:colon
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_O2MICRO
)paren
(brace
id|status
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|O2_MODE_B
)paren
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|O2_MODE_B_VS1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_3VCARD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|O2_MODE_B_VS2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_XVCARD
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ISA
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
(brace
id|status
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|VG469_VSENSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
op_amp
l_int|1
)paren
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_B_VS1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_3VCARD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_B_VS2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_XVCARD
suffix:semicolon
)brace
r_else
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_A_VS1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_3VCARD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_A_VS2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_XVCARD
suffix:semicolon
)brace
)brace
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: GetStatus(%d) = %#4.4x&bslash;n&quot;
comma
id|sock
comma
op_star
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_status */
multiline_comment|/*====================================================================*/
DECL|function|i365_get_socket
r_static
r_int
id|i365_get_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|reg
comma
id|vcc
comma
id|vpp
suffix:semicolon
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_POWER
)paren
suffix:semicolon
id|state-&gt;flags
op_assign
(paren
id|reg
op_amp
id|I365_PWR_AUTO
)paren
ques
c_cond
id|SS_PWR_AUTO
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;flags
op_or_assign
(paren
id|reg
op_amp
id|I365_PWR_OUT
)paren
ques
c_cond
id|SS_OUTPUT_ENA
suffix:colon
l_int|0
suffix:semicolon
id|vcc
op_assign
id|reg
op_amp
id|I365_VCC_MASK
suffix:semicolon
id|vpp
op_assign
id|reg
op_amp
id|I365_VPP1_MASK
suffix:semicolon
id|state-&gt;Vcc
op_assign
id|state-&gt;Vpp
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|cb_get_power
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
)paren
op_amp
id|PD67_MC1_VCC_3V
)paren
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|33
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VG_PWR
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|VG469_VSELECT
)paren
op_amp
id|VG469_VSEL_VCC
)paren
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|33
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_DF_PWR
)paren
(brace
r_if
c_cond
(paren
id|vcc
op_eq
id|I365_VCC_3V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
(brace
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
)brace
multiline_comment|/* IO card, RESET flags, IO interrupt */
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
suffix:semicolon
id|state-&gt;flags
op_or_assign
(paren
id|reg
op_amp
id|I365_PC_RESET
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_RESET
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|I365_PC_IOCARD
)paren
id|state-&gt;flags
op_or_assign
id|SS_IOCARD
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|cb_get_irq_mode
c_func
(paren
id|sock
)paren
op_ne
l_int|0
)paren
id|state-&gt;io_irq
op_assign
id|t-&gt;cap.pci_irq
suffix:semicolon
r_else
macro_line|#endif
id|state-&gt;io_irq
op_assign
id|reg
op_amp
id|I365_IRQ_MASK
suffix:semicolon
multiline_comment|/* speaker control */
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
)paren
op_amp
id|PD67_MC1_SPKR_ENA
)paren
id|state-&gt;flags
op_or_assign
id|SS_SPKR_ENA
suffix:semicolon
)brace
multiline_comment|/* Card status change mask */
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_CSCINT
)paren
suffix:semicolon
id|state-&gt;csc_mask
op_assign
(paren
id|reg
op_amp
id|I365_CSC_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_STSCHG
)paren
ques
c_cond
id|SS_STSCHG
suffix:colon
l_int|0
suffix:semicolon
r_else
(brace
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_BVD1
)paren
ques
c_cond
id|SS_BATDEAD
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_BVD2
)paren
ques
c_cond
id|SS_BATWARN
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: GetSocket(%d) = flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_socket */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_socket
r_static
r_int
id|i365_set_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|socket_info_t
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|reg
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: SetSocket(%d, flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x)&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
multiline_comment|/* First set global controller options */
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
op_logical_and
id|t-&gt;cap.pci_irq
)paren
id|cb_set_irq_mode
c_func
(paren
id|sock
comma
id|pci_csc
comma
(paren
id|t-&gt;cap.pci_irq
op_eq
id|state-&gt;io_irq
)paren
)paren
suffix:semicolon
id|t-&gt;bcr
op_and_assign
op_complement
id|CB_BCR_CB_RESET
suffix:semicolon
macro_line|#endif
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
multiline_comment|/* IO card, RESET flag, IO interrupt */
id|reg
op_assign
id|t-&gt;intr
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;io_irq
op_ne
id|t-&gt;cap.pci_irq
)paren
id|reg
op_or_assign
id|state-&gt;io_irq
suffix:semicolon
id|reg
op_or_assign
(paren
id|state-&gt;flags
op_amp
id|SS_RESET
)paren
ques
c_cond
l_int|0
suffix:colon
id|I365_PC_RESET
suffix:semicolon
id|reg
op_or_assign
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
ques
c_cond
id|I365_PC_IOCARD
suffix:colon
l_int|0
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_INTCTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|I365_PWR_NORESET
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_PWR_AUTO
)paren
id|reg
op_or_assign
id|I365_PWR_AUTO
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_OUTPUT_ENA
)paren
id|reg
op_or_assign
id|I365_PWR_OUT
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|cb_set_power
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
id|reg
op_or_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_POWER
)paren
op_amp
(paren
id|I365_VCC_MASK
op_or
id|I365_VPP1_MASK
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
l_int|120
)paren
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
id|state-&gt;Vcc
)paren
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;Vcc
op_ne
l_int|0
)paren
(brace
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|33
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_VCC_3V
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|50
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_VCC_3V
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VG_PWR
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
l_int|120
)paren
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
id|state-&gt;Vcc
)paren
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;Vcc
op_ne
l_int|0
)paren
(brace
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|33
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|VG469_VSELECT
comma
id|VG469_VSEL_VCC
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|50
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|VG469_VSELECT
comma
id|VG469_VSEL_VCC
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_DF_PWR
)paren
(brace
r_switch
c_cond
(paren
id|state-&gt;Vcc
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|33
suffix:colon
id|reg
op_or_assign
id|I365_VCC_3V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|state-&gt;Vpp
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|state-&gt;Vcc
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|state-&gt;Vpp
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_5V
op_or
id|I365_VPP2_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_12V
op_or
id|I365_VPP2_12V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|reg
op_ne
id|i365_get
c_func
(paren
id|sock
comma
id|I365_POWER
)paren
)paren
id|i365_set
c_func
(paren
id|sock
comma
id|I365_POWER
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Chipset-specific functions */
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
multiline_comment|/* Speaker control */
id|i365_bflip
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_SPKR_ENA
comma
id|state-&gt;flags
op_amp
id|SS_SPKR_ENA
)paren
suffix:semicolon
)brace
multiline_comment|/* Card status change interrupt mask */
id|reg
op_assign
id|t-&gt;cs_irq
op_lshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_DETECT
)paren
id|reg
op_or_assign
id|I365_CSC_DETECT
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_STSCHG
)paren
id|reg
op_or_assign
id|I365_CSC_STSCHG
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_BATDEAD
)paren
id|reg
op_or_assign
id|I365_CSC_BVD1
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_BATWARN
)paren
id|reg
op_or_assign
id|I365_CSC_BVD2
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_READY
)paren
id|reg
op_or_assign
id|I365_CSC_READY
suffix:semicolon
)brace
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|reg
)paren
suffix:semicolon
id|i365_get
c_func
(paren
id|sock
comma
id|I365_CSC
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CARDBUS
)paren
(brace
r_if
c_cond
(paren
id|t-&gt;cs_irq
op_logical_or
(paren
id|pci_csc
op_logical_and
id|t-&gt;cap.pci_irq
)paren
)paren
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_MASK
comma
id|CB_SM_CCD
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_socket */
multiline_comment|/*====================================================================*/
DECL|function|i365_get_io_map
r_static
r_int
id|i365_get_io_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
id|u_char
id|map
comma
id|ioctl
comma
id|addr
suffix:semicolon
id|map
op_assign
id|io-&gt;map
suffix:semicolon
r_if
c_cond
(paren
id|map
OG
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|io-&gt;start
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_START
)paren
suffix:semicolon
id|io-&gt;stop
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_STOP
)paren
suffix:semicolon
id|ioctl
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_IOCTL
)paren
suffix:semicolon
id|addr
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
suffix:semicolon
id|io-&gt;speed
op_assign
id|to_ns
c_func
(paren
id|ioctl
op_amp
id|I365_IOCTL_WAIT
c_func
(paren
id|map
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|io-&gt;flags
op_assign
(paren
id|addr
op_amp
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_ACTIVE
suffix:colon
l_int|0
suffix:semicolon
id|io-&gt;flags
op_or_assign
(paren
id|ioctl
op_amp
id|I365_IOCTL_0WS
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_0WS
suffix:colon
l_int|0
suffix:semicolon
id|io-&gt;flags
op_or_assign
(paren
id|ioctl
op_amp
id|I365_IOCTL_16BIT
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_16BIT
suffix:colon
l_int|0
suffix:semicolon
id|io-&gt;flags
op_or_assign
(paren
id|ioctl
op_amp
id|I365_IOCTL_IOCS16
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_AUTOSZ
suffix:colon
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: GetIOMap(%d, %d) = %#2.2x, %d ns, &quot;
l_string|&quot;%#4.4x-%#4.4x&bslash;n&quot;
comma
id|sock
comma
id|map
comma
id|io-&gt;flags
comma
id|io-&gt;speed
comma
id|io-&gt;start
comma
id|io-&gt;stop
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_io_map */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_io_map
r_static
r_int
id|i365_set_io_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
id|u_char
id|map
comma
id|ioctl
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: SetIOMap(%d, %d, %#2.2x, %d ns, &quot;
l_string|&quot;%#4.4x-%#4.4x)&bslash;n&quot;
comma
id|sock
comma
id|io-&gt;map
comma
id|io-&gt;flags
comma
id|io-&gt;speed
comma
id|io-&gt;start
comma
id|io-&gt;stop
)paren
suffix:semicolon
id|map
op_assign
id|io-&gt;map
suffix:semicolon
r_if
c_cond
(paren
(paren
id|map
OG
l_int|1
)paren
op_logical_or
(paren
id|io-&gt;start
OG
l_int|0xffff
)paren
op_logical_or
(paren
id|io-&gt;stop
OG
l_int|0xffff
)paren
op_logical_or
(paren
id|io-&gt;stop
OL
id|io-&gt;start
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Turn off the window before changing anything */
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_START
comma
id|io-&gt;start
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_STOP
comma
id|io-&gt;stop
)paren
suffix:semicolon
id|ioctl
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_IOCTL
)paren
op_amp
op_complement
id|I365_IOCTL_MASK
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;speed
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_WAIT
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_0WS
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_0WS
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_16BIT
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_16BIT
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_AUTOSZ
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_IOCS16
c_func
(paren
id|map
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_IOCTL
comma
id|ioctl
)paren
suffix:semicolon
multiline_comment|/* Turn on the window if necessary */
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_ACTIVE
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_io_map */
multiline_comment|/*====================================================================*/
DECL|function|i365_get_mem_map
r_static
r_int
id|i365_get_mem_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
id|u_short
id|base
comma
id|i
suffix:semicolon
id|u_char
id|map
comma
id|addr
suffix:semicolon
id|map
op_assign
id|mem-&gt;map
suffix:semicolon
r_if
c_cond
(paren
id|map
OG
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addr
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
suffix:semicolon
id|mem-&gt;flags
op_assign
(paren
id|addr
op_amp
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_ACTIVE
suffix:colon
l_int|0
suffix:semicolon
id|base
op_assign
id|I365_MEM
c_func
(paren
id|map
)paren
suffix:semicolon
id|i
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_START
)paren
suffix:semicolon
id|mem-&gt;flags
op_or_assign
(paren
id|i
op_amp
id|I365_MEM_16BIT
)paren
ques
c_cond
id|MAP_16BIT
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;flags
op_or_assign
(paren
id|i
op_amp
id|I365_MEM_0WS
)paren
ques
c_cond
id|MAP_0WS
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;sys_start
op_add_assign
(paren
(paren
id|u_long
)paren
(paren
id|i
op_amp
l_int|0x0fff
)paren
op_lshift
l_int|12
)paren
suffix:semicolon
id|i
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_STOP
)paren
suffix:semicolon
id|mem-&gt;speed
op_assign
(paren
id|i
op_amp
id|I365_MEM_WS0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;speed
op_add_assign
(paren
id|i
op_amp
id|I365_MEM_WS1
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;speed
op_assign
id|to_ns
c_func
(paren
id|mem-&gt;speed
)paren
suffix:semicolon
id|mem-&gt;sys_stop
op_assign
(paren
(paren
id|u_long
)paren
(paren
id|i
op_amp
l_int|0x0fff
)paren
op_lshift
l_int|12
)paren
op_plus
l_int|0x0fff
suffix:semicolon
id|i
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_OFF
)paren
suffix:semicolon
id|mem-&gt;flags
op_or_assign
(paren
id|i
op_amp
id|I365_MEM_WRPROT
)paren
ques
c_cond
id|MAP_WRPROT
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;flags
op_or_assign
(paren
id|i
op_amp
id|I365_MEM_REG
)paren
ques
c_cond
id|MAP_ATTRIB
suffix:colon
l_int|0
suffix:semicolon
id|mem-&gt;card_start
op_assign
(paren
(paren
id|u_int
)paren
(paren
id|i
op_amp
l_int|0x3fff
)paren
op_lshift
l_int|12
)paren
op_plus
id|mem-&gt;sys_start
suffix:semicolon
id|mem-&gt;card_start
op_and_assign
l_int|0x3ffffff
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Take care of high byte, for PCI controllers */
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|type
op_eq
id|IS_PD6729
)paren
(brace
id|i365_set
c_func
(paren
id|sock
comma
id|PD67_EXT_INDEX
comma
id|PD67_MEM_PAGE
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
id|addr
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|PD67_EXT_DATA
)paren
op_lshift
l_int|24
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
(brace
id|addr
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|CB_MEM_PAGE
c_func
(paren
id|map
)paren
)paren
op_lshift
l_int|24
suffix:semicolon
id|mem-&gt;sys_stop
op_add_assign
id|addr
suffix:semicolon
id|mem-&gt;sys_start
op_add_assign
id|addr
suffix:semicolon
)brace
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: GetMemMap(%d, %d) = %#2.2x, %d ns, %#5.5lx-%#5.&quot;
l_string|&quot;5lx, %#5.5x&bslash;n&quot;
comma
id|sock
comma
id|mem-&gt;map
comma
id|mem-&gt;flags
comma
id|mem-&gt;speed
comma
id|mem-&gt;sys_start
comma
id|mem-&gt;sys_stop
comma
id|mem-&gt;card_start
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_mem_map */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_mem_map
r_static
r_int
id|i365_set_mem_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
id|u_short
id|base
comma
id|i
suffix:semicolon
id|u_char
id|map
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;i82365: SetMemMap(%d, %d, %#2.2x, %d ns, %#5.5lx-%#5.5&quot;
l_string|&quot;lx, %#5.5x)&bslash;n&quot;
comma
id|sock
comma
id|mem-&gt;map
comma
id|mem-&gt;flags
comma
id|mem-&gt;speed
comma
id|mem-&gt;sys_start
comma
id|mem-&gt;sys_stop
comma
id|mem-&gt;card_start
)paren
suffix:semicolon
id|map
op_assign
id|mem-&gt;map
suffix:semicolon
r_if
c_cond
(paren
(paren
id|map
OG
l_int|4
)paren
op_logical_or
(paren
id|mem-&gt;card_start
OG
l_int|0x3ffffff
)paren
op_logical_or
(paren
id|mem-&gt;sys_start
OG
id|mem-&gt;sys_stop
)paren
op_logical_or
(paren
id|mem-&gt;speed
OG
l_int|1000
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
(paren
id|IS_PCI
op_or
id|IS_CARDBUS
)paren
)paren
op_logical_and
(paren
(paren
id|mem-&gt;sys_start
OG
l_int|0xffffff
)paren
op_logical_or
(paren
id|mem-&gt;sys_stop
OG
l_int|0xffffff
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Turn off the window before changing anything */
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Take care of high byte, for PCI controllers */
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|type
op_eq
id|IS_PD6729
)paren
(brace
id|i365_set
c_func
(paren
id|sock
comma
id|PD67_EXT_INDEX
comma
id|PD67_MEM_PAGE
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|PD67_EXT_DATA
comma
(paren
id|mem-&gt;sys_start
op_rshift
l_int|24
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
id|i365_set
c_func
(paren
id|sock
comma
id|CB_MEM_PAGE
c_func
(paren
id|map
)paren
comma
id|mem-&gt;sys_start
op_rshift
l_int|24
)paren
suffix:semicolon
macro_line|#endif
id|base
op_assign
id|I365_MEM
c_func
(paren
id|map
)paren
suffix:semicolon
id|i
op_assign
(paren
id|mem-&gt;sys_start
op_rshift
l_int|12
)paren
op_amp
l_int|0x0fff
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_16BIT
)paren
id|i
op_or_assign
id|I365_MEM_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_0WS
)paren
id|i
op_or_assign
id|I365_MEM_0WS
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_START
comma
id|i
)paren
suffix:semicolon
id|i
op_assign
(paren
id|mem-&gt;sys_stop
op_rshift
l_int|12
)paren
op_amp
l_int|0x0fff
suffix:semicolon
r_switch
c_cond
(paren
id|to_cycles
c_func
(paren
id|mem-&gt;speed
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS1
op_or
id|I365_MEM_WS0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_STOP
comma
id|i
)paren
suffix:semicolon
id|i
op_assign
(paren
(paren
id|mem-&gt;card_start
op_minus
id|mem-&gt;sys_start
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0x3fff
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_WRPROT
)paren
id|i
op_or_assign
id|I365_MEM_WRPROT
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_ATTRIB
)paren
id|i
op_or_assign
id|I365_MEM_REG
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_OFF
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Turn on the window if necessary */
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_ACTIVE
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_mem_map */
multiline_comment|/*======================================================================&n;&n;    Power control for Cardbus controllers: used both for 16-bit and&n;    Cardbus cards.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PCI
DECL|function|cb_get_power
r_static
r_void
id|cb_get_power
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|u_int
id|reg
op_assign
id|cb_readl
c_func
(paren
id|sock
comma
id|CB_SOCKET_CONTROL
)paren
suffix:semicolon
id|state-&gt;Vcc
op_assign
id|state-&gt;Vpp
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|reg
op_amp
id|CB_SC_VCC_MASK
)paren
(brace
r_case
id|CB_SC_VCC_3V
suffix:colon
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CB_SC_VCC_5V
suffix:colon
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|reg
op_amp
id|CB_SC_VPP_MASK
)paren
(brace
r_case
id|CB_SC_VPP_3V
suffix:colon
id|state-&gt;Vpp
op_assign
l_int|33
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CB_SC_VPP_5V
suffix:colon
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CB_SC_VPP_12V
suffix:colon
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|cb_set_power
r_static
r_void
id|cb_set_power
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|u_int
id|reg
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|state-&gt;Vcc
)paren
(brace
r_case
l_int|33
suffix:colon
id|reg
op_assign
id|CB_SC_VCC_3V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_assign
id|CB_SC_VCC_5V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|reg
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|state-&gt;Vpp
)paren
(brace
r_case
l_int|33
suffix:colon
id|reg
op_or_assign
id|CB_SC_VPP_3V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|CB_SC_VPP_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
id|reg
op_or_assign
id|CB_SC_VPP_12V
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reg
op_ne
id|cb_readl
c_func
(paren
id|sock
comma
id|CB_SOCKET_CONTROL
)paren
)paren
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_CONTROL
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*======================================================================&n;&n;    All the stuff that is strictly for Cardbus cards goes here.&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_CARDBUS
DECL|function|cb_get_status
r_static
r_int
id|cb_get_status
c_func
(paren
id|u_short
id|sock
comma
id|u_int
op_star
id|value
)paren
(brace
id|u_int
id|s
suffix:semicolon
id|s
op_assign
id|cb_readl
c_func
(paren
id|sock
comma
id|CB_SOCKET_STATE
)paren
suffix:semicolon
op_star
id|value
op_assign
(paren
(paren
id|s
op_amp
id|CB_SS_32BIT
)paren
ques
c_cond
id|SS_CARDBUS
suffix:colon
l_int|0
)paren
suffix:semicolon
op_star
id|value
op_or_assign
(paren
(paren
id|s
op_amp
id|CB_SS_CCD1
)paren
op_logical_or
(paren
id|s
op_amp
id|CB_SS_CCD2
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_DETECT
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|s
op_amp
id|CB_SS_CSTSCHG
)paren
ques
c_cond
id|SS_STSCHG
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|s
op_amp
id|CB_SS_PWRCYCLE
)paren
ques
c_cond
(paren
id|SS_POWERON
op_or
id|SS_READY
)paren
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|s
op_amp
id|CB_SS_3VCARD
)paren
ques
c_cond
id|SS_3VCARD
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|s
op_amp
id|CB_SS_XVCARD
)paren
ques
c_cond
id|SS_XVCARD
suffix:colon
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;yenta: GetStatus(%d) = %#4.4x&bslash;n&quot;
comma
id|sock
comma
op_star
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* cb_get_status */
DECL|function|cb_get_socket
r_static
r_int
id|cb_get_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_short
id|bcr
suffix:semicolon
id|cb_get_power
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
id|config_readw
c_func
(paren
id|s
comma
id|CB_BRIDGE_CONTROL
comma
op_amp
id|bcr
)paren
suffix:semicolon
id|state-&gt;flags
op_or_assign
(paren
id|bcr
op_amp
id|CB_BCR_CB_RESET
)paren
ques
c_cond
id|SS_RESET
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cb_get_irq_mode
c_func
(paren
id|sock
)paren
op_ne
l_int|0
)paren
id|state-&gt;io_irq
op_assign
id|s-&gt;cap.pci_irq
suffix:semicolon
r_else
id|state-&gt;io_irq
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
op_amp
id|I365_IRQ_MASK
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;yenta: GetSocket(%d) = flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* cb_get_socket */
DECL|function|cb_set_socket
r_static
r_int
id|cb_set_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_int
id|reg
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;yenta: SetSocket(%d, flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x)&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
multiline_comment|/* First set global controller options */
r_if
c_cond
(paren
id|s-&gt;cap.pci_irq
)paren
id|cb_set_irq_mode
c_func
(paren
id|sock
comma
id|pci_csc
comma
(paren
id|s-&gt;cap.pci_irq
op_eq
id|state-&gt;io_irq
)paren
)paren
suffix:semicolon
id|s-&gt;bcr
op_and_assign
op_complement
id|CB_BCR_CB_RESET
suffix:semicolon
id|s-&gt;bcr
op_or_assign
(paren
id|state-&gt;flags
op_amp
id|SS_RESET
)paren
ques
c_cond
id|CB_BCR_CB_RESET
suffix:colon
l_int|0
suffix:semicolon
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
id|cb_set_power
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
multiline_comment|/* Handle IO interrupt using ISA routing */
id|reg
op_assign
id|s-&gt;intr
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;io_irq
op_ne
id|s-&gt;cap.pci_irq
)paren
id|reg
op_or_assign
id|state-&gt;io_irq
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_INTCTL
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Handle CSC mask */
id|reg
op_assign
(paren
id|socket
(braket
id|sock
)braket
dot
id|cs_irq
op_lshift
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_DETECT
)paren
id|reg
op_or_assign
id|I365_CSC_DETECT
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|reg
)paren
suffix:semicolon
id|i365_get
c_func
(paren
id|sock
comma
id|I365_CSC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;cs_irq
op_logical_or
(paren
id|pci_csc
op_logical_and
id|s-&gt;cap.pci_irq
)paren
)paren
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_MASK
comma
id|CB_SM_CCD
)paren
suffix:semicolon
id|cb_writel
c_func
(paren
id|sock
comma
id|CB_SOCKET_EVENT
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* cb_set_socket */
DECL|function|cb_get_bridge
r_static
r_int
id|cb_get_bridge
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|cb_bridge_map
op_star
id|m
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|map
suffix:semicolon
id|map
op_assign
id|m-&gt;map
suffix:semicolon
r_if
c_cond
(paren
id|map
OG
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|m-&gt;flags
op_and_assign
id|MAP_IOSPACE
suffix:semicolon
id|map
op_add_assign
(paren
id|m-&gt;flags
op_amp
id|MAP_IOSPACE
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
id|config_readl
c_func
(paren
id|s
comma
id|CB_MEM_BASE
c_func
(paren
id|map
)paren
comma
op_amp
id|m-&gt;start
)paren
suffix:semicolon
id|config_readl
c_func
(paren
id|s
comma
id|CB_MEM_LIMIT
c_func
(paren
id|map
)paren
comma
op_amp
id|m-&gt;stop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;start
op_logical_or
id|m-&gt;stop
)paren
(brace
id|m-&gt;flags
op_or_assign
id|MAP_ACTIVE
suffix:semicolon
id|m-&gt;stop
op_or_assign
(paren
id|map
OG
l_int|1
)paren
ques
c_cond
l_int|3
suffix:colon
l_int|0x0fff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|map
OG
l_int|1
)paren
(brace
id|u_short
id|bcr
suffix:semicolon
id|config_readw
c_func
(paren
id|s
comma
id|CB_BRIDGE_CONTROL
comma
op_amp
id|bcr
)paren
suffix:semicolon
id|m-&gt;flags
op_or_assign
(paren
id|bcr
op_amp
id|CB_BCR_PREFETCH
c_func
(paren
id|map
)paren
)paren
ques
c_cond
id|MAP_PREFETCH
suffix:colon
l_int|0
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;yenta: GetBridge(%d, %d) = %#2.2x, %#4.4x-%#4.4x&bslash;n&quot;
comma
id|sock
comma
id|map
comma
id|m-&gt;flags
comma
id|m-&gt;start
comma
id|m-&gt;stop
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cb_set_bridge
r_static
r_int
id|cb_set_bridge
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|cb_bridge_map
op_star
id|m
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|map
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;yenta: SetBridge(%d, %d, %#2.2x, %#4.4x-%#4.4x)&bslash;n&quot;
comma
id|sock
comma
id|m-&gt;map
comma
id|m-&gt;flags
comma
id|m-&gt;start
comma
id|m-&gt;stop
)paren
suffix:semicolon
id|map
op_assign
id|m-&gt;map
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;flags
op_amp
id|IS_CARDBUS
)paren
op_logical_or
(paren
id|map
OG
l_int|1
)paren
op_logical_or
(paren
id|m-&gt;stop
OL
id|m-&gt;start
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;flags
op_amp
id|MAP_IOSPACE
)paren
(brace
r_if
c_cond
(paren
(paren
id|m-&gt;stop
OG
l_int|0xffff
)paren
op_logical_or
(paren
id|m-&gt;start
op_amp
l_int|3
)paren
op_logical_or
(paren
(paren
id|m-&gt;stop
op_amp
l_int|3
)paren
op_ne
l_int|3
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|map
op_add_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_short
id|bcr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m-&gt;start
op_amp
l_int|0x0fff
)paren
op_logical_or
(paren
(paren
id|m-&gt;stop
op_amp
l_int|0x0fff
)paren
op_ne
l_int|0x0fff
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|config_readw
c_func
(paren
id|s
comma
id|CB_BRIDGE_CONTROL
comma
op_amp
id|bcr
)paren
suffix:semicolon
id|bcr
op_and_assign
op_complement
id|CB_BCR_PREFETCH
c_func
(paren
id|map
)paren
suffix:semicolon
id|bcr
op_or_assign
(paren
id|m-&gt;flags
op_amp
id|MAP_PREFETCH
)paren
ques
c_cond
id|CB_BCR_PREFETCH
c_func
(paren
id|map
)paren
suffix:colon
l_int|0
suffix:semicolon
id|config_writew
c_func
(paren
id|s
comma
id|CB_BRIDGE_CONTROL
comma
id|bcr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m-&gt;flags
op_amp
id|MAP_ACTIVE
)paren
(brace
id|config_writel
c_func
(paren
id|s
comma
id|CB_MEM_BASE
c_func
(paren
id|map
)paren
comma
id|m-&gt;start
)paren
suffix:semicolon
id|config_writel
c_func
(paren
id|s
comma
id|CB_MEM_LIMIT
c_func
(paren
id|map
)paren
comma
id|m-&gt;stop
)paren
suffix:semicolon
)brace
r_else
(brace
id|config_writel
c_func
(paren
id|s
comma
id|CB_MEM_BASE
c_func
(paren
id|map
)paren
comma
l_int|0
)paren
suffix:semicolon
id|config_writel
c_func
(paren
id|s
comma
id|CB_MEM_LIMIT
c_func
(paren
id|map
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_CARDBUS */
multiline_comment|/*======================================================================&n;&n;    Routines for accessing socket information and register dumps via&n;    /proc/bus/pccard/...&n;    &n;======================================================================*/
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|proc_read_info
r_static
r_int
id|proc_read_info
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|pos
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
id|data
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;type:     %s&bslash;npsock:    %d&bslash;n&quot;
comma
id|pcic
(braket
id|s-&gt;type
)braket
dot
id|name
comma
id|s-&gt;psock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|s-&gt;flags
op_amp
(paren
id|IS_PCI
op_or
id|IS_CARDBUS
)paren
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;bus:      %02x&bslash;ndevfn:    %02x.%1x&bslash;n&quot;
comma
id|s-&gt;pdev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|s-&gt;pdev-&gt;devfn
)paren
comma
id|PCI_FUNC
c_func
(paren
id|s-&gt;pdev-&gt;devfn
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;flags
op_amp
id|IS_CARDBUS
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;cardbus:  %02x&bslash;n&quot;
comma
id|s-&gt;cap.cardbus
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|proc_read_exca
r_static
r_int
id|proc_read_exca
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|pos
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|u_short
id|sock
op_assign
(paren
id|socket_info_t
op_star
)paren
id|data
op_minus
id|socket
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|i
comma
id|top
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
id|u_long
id|flags
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|ISA_LOCK
c_func
(paren
id|sock
comma
id|flags
)paren
suffix:semicolon
id|top
op_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
id|top
op_assign
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CIRRUS
)paren
ques
c_cond
l_int|0x140
suffix:colon
l_int|0x50
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|top
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0x50
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0x100
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%02x %02x %02x %02x%s&quot;
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|1
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|2
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|3
)paren
comma
(paren
(paren
id|i
op_mod
l_int|16
)paren
op_eq
l_int|12
)paren
ques
c_cond
l_string|&quot;&bslash;n&quot;
suffix:colon
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
id|ISA_UNLOCK
c_func
(paren
id|sock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|proc_read_pci
r_static
r_int
id|proc_read_pci
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|pos
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|socket_info_t
op_star
id|s
op_assign
id|data
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|u_int
id|a
comma
id|b
comma
id|c
comma
id|d
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xc0
suffix:semicolon
id|i
op_add_assign
l_int|0x10
)paren
(brace
id|config_readl
c_func
(paren
id|s
comma
id|i
comma
op_amp
id|a
)paren
suffix:semicolon
id|config_readl
c_func
(paren
id|s
comma
id|i
op_plus
l_int|4
comma
op_amp
id|b
)paren
suffix:semicolon
id|config_readl
c_func
(paren
id|s
comma
id|i
op_plus
l_int|8
comma
op_amp
id|c
)paren
suffix:semicolon
id|config_readl
c_func
(paren
id|s
comma
id|i
op_plus
l_int|12
comma
op_amp
id|d
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%08x %08x %08x %08x&bslash;n&quot;
comma
id|a
comma
id|b
comma
id|c
comma
id|d
)paren
suffix:semicolon
)brace
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_CARDBUS
DECL|function|proc_read_cardbus
r_static
r_int
id|proc_read_cardbus
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|pos
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|u_short
id|sock
op_assign
(paren
id|socket_info_t
op_star
)paren
id|data
op_minus
id|socket
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|i
comma
id|top
suffix:semicolon
id|top
op_assign
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_O2MICRO
)paren
ques
c_cond
l_int|0x30
suffix:colon
l_int|0x20
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|top
suffix:semicolon
id|i
op_add_assign
l_int|0x10
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%08x %08x %08x %08x&bslash;n&quot;
comma
id|cb_readl
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|0x00
)paren
comma
id|cb_readl
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|0x04
)paren
comma
id|cb_readl
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|0x08
)paren
comma
id|cb_readl
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|0x0c
)paren
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|pcic_proc_setup
r_static
r_void
id|pcic_proc_setup
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|proc_dir_entry
op_star
id|base
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
id|socket_info_t
op_star
id|s
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;flags
op_amp
id|IS_ALIVE
)paren
r_return
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;info&quot;
comma
l_int|0
comma
id|base
comma
id|proc_read_info
comma
id|s
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;exca&quot;
comma
l_int|0
comma
id|base
comma
id|proc_read_exca
comma
id|s
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|s-&gt;flags
op_amp
(paren
id|IS_PCI
op_or
id|IS_CARDBUS
)paren
)paren
id|create_proc_read_entry
c_func
(paren
l_string|&quot;pci&quot;
comma
l_int|0
comma
id|base
comma
id|proc_read_pci
comma
id|s
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|s-&gt;flags
op_amp
id|IS_CARDBUS
)paren
id|create_proc_read_entry
c_func
(paren
l_string|&quot;cardbus&quot;
comma
l_int|0
comma
id|base
comma
id|proc_read_cardbus
comma
id|s
)paren
suffix:semicolon
macro_line|#endif
id|s-&gt;proc
op_assign
id|base
suffix:semicolon
macro_line|#endif
)brace
DECL|function|pcic_proc_remove
r_static
r_void
id|pcic_proc_remove
c_func
(paren
id|u_short
id|sock
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|base
op_assign
id|socket
(braket
id|sock
)braket
dot
id|proc
suffix:semicolon
r_if
c_cond
(paren
id|base
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;info&quot;
comma
id|base
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;exca&quot;
comma
id|base
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
(paren
id|IS_PCI
op_or
id|IS_CARDBUS
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;pci&quot;
comma
id|base
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;cardbus&quot;
comma
id|base
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/*====================================================================*/
multiline_comment|/*&n; * This looks like a lot of duplication, and it is. What we should REALLY&n; * have is separate functions for the separate cases, instead of having&n; * duplicate tests in them - and then have the test in the place that sets&n; * up the ss_entry function pointer table instead!&n; *&n; * For example, the IS_CARDBUS thing is something we know _statically_,&n; * and as such it is a waste of time and space to test it dynamically.&n; *&n; * Much of this goes away by splitting off the cases. One small step at a&n; * time..&n; */
macro_line|#ifdef CONFIG_CARDBUS
DECL|macro|is_cardbus
mdefine_line|#define is_cardbus(sock) ((socket[(sock)].flags &amp; IS_CARDBUS) &amp;&amp; (cb_readl((sock), CB_SOCKET_STATE) &amp; CB_SS_32BIT))
macro_line|#endif
multiline_comment|/*&n; * The locking is rather broken. Why do we only lock for ISA, not for&n; * all other cases? If there are reasons to lock, we should lock. Not&n; * this silly conditional.&n; *&n; * Plan: make it bug-for-bug compatible with the old stuff, and clean&n; * it up when the infrastructure is done.&n; */
macro_line|#ifdef CONFIG_ISA
DECL|macro|LOCKED
mdefine_line|#define LOCKED(x) do { &bslash;&n;&t;if (socket[(sock)].flags &amp; IS_CARDBUS) return x; &bslash;&n;&t;do { &bslash;&n;&t;&t;int retval; &bslash;&n;&t;&t;unsigned long flags; &bslash;&n;&t;&t;spin_lock_irqsave(&amp;isa_lock, flags); &bslash;&n;&t;&t;retval = x; &bslash;&n;&t;&t;spin_unlock_irqrestore(&amp;isa_lock, flags); &bslash;&n;&t;&t;return retval; &bslash;&n;&t;} while (0); &bslash;&n;} while (0)
macro_line|#else
DECL|macro|LOCKED
mdefine_line|#define LOCKED(x) return x
macro_line|#endif
DECL|function|pcic_get_status
r_static
r_int
id|pcic_get_status
c_func
(paren
r_int
r_int
id|sock
comma
id|u_int
op_star
id|value
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
(brace
op_star
id|value
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|is_cardbus
c_func
(paren
id|sock
)paren
)paren
r_return
id|cb_get_status
c_func
(paren
id|sock
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
id|LOCKED
c_func
(paren
id|i365_get_status
c_func
(paren
id|sock
comma
id|value
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_get_socket
r_static
r_int
id|pcic_get_socket
c_func
(paren
r_int
r_int
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|is_cardbus
c_func
(paren
id|sock
)paren
)paren
r_return
id|cb_get_socket
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
macro_line|#endif
id|LOCKED
c_func
(paren
id|i365_get_socket
c_func
(paren
id|sock
comma
id|state
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_socket
r_static
r_int
id|pcic_set_socket
c_func
(paren
r_int
r_int
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef CONFIG_CARDBUS
r_if
c_cond
(paren
id|is_cardbus
c_func
(paren
id|sock
)paren
)paren
r_return
id|cb_set_socket
c_func
(paren
id|sock
comma
id|state
)paren
suffix:semicolon
macro_line|#endif
id|LOCKED
c_func
(paren
id|i365_set_socket
c_func
(paren
id|sock
comma
id|state
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_get_io_map
r_static
r_int
id|pcic_get_io_map
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_get_io_map
c_func
(paren
id|sock
comma
id|io
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_io_map
r_static
r_int
id|pcic_set_io_map
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_set_io_map
c_func
(paren
id|sock
comma
id|io
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_get_mem_map
r_static
r_int
id|pcic_get_mem_map
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_get_mem_map
c_func
(paren
id|sock
comma
id|mem
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_mem_map
r_static
r_int
id|pcic_set_mem_map
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_set_mem_map
c_func
(paren
id|sock
comma
id|mem
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_get_bridge
r_static
r_int
id|pcic_get_bridge
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|cb_bridge_map
op_star
id|m
)paren
(brace
macro_line|#ifdef CONFIG_CARDBUS
r_return
id|cb_get_bridge
c_func
(paren
id|sock
comma
id|m
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
DECL|function|pcic_set_bridge
r_static
r_int
id|pcic_set_bridge
c_func
(paren
r_int
r_int
id|sock
comma
r_struct
id|cb_bridge_map
op_star
id|m
)paren
(brace
macro_line|#ifdef CONFIG_CARDBUS
r_return
id|cb_set_bridge
c_func
(paren
id|sock
comma
id|m
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
DECL|function|pcic_init
r_static
r_int
id|pcic_init
c_func
(paren
r_int
r_int
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|pccard_io_map
id|io
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
suffix:semicolon
id|pccard_mem_map
id|mem
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|mem.sys_stop
op_assign
l_int|0x1000
suffix:semicolon
id|pcic_set_socket
c_func
(paren
id|s
comma
op_amp
id|dead_socket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|io.map
op_assign
id|i
suffix:semicolon
id|pcic_set_io_map
c_func
(paren
id|s
comma
op_amp
id|io
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mem.map
op_assign
id|i
suffix:semicolon
id|pcic_set_mem_map
c_func
(paren
id|s
comma
op_amp
id|mem
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcic_suspend
r_static
r_int
id|pcic_suspend
c_func
(paren
r_int
r_int
id|sock
)paren
(brace
r_return
id|pcic_set_socket
c_func
(paren
id|sock
comma
op_amp
id|dead_socket
)paren
suffix:semicolon
)brace
DECL|variable|pcic_operations
r_static
r_struct
id|pccard_operations
id|pcic_operations
op_assign
(brace
id|pcic_init
comma
id|pcic_suspend
comma
id|pcic_register_callback
comma
id|pcic_inquire_socket
comma
id|pcic_get_status
comma
id|pcic_get_socket
comma
id|pcic_set_socket
comma
id|pcic_get_io_map
comma
id|pcic_set_io_map
comma
id|pcic_get_mem_map
comma
id|pcic_set_mem_map
comma
id|pcic_get_bridge
comma
id|pcic_set_bridge
comma
id|pcic_proc_setup
)brace
suffix:semicolon
multiline_comment|/*====================================================================*/
DECL|function|init_i82365
r_static
r_int
id|__init
id|init_i82365
c_func
(paren
r_void
)paren
(brace
id|servinfo_t
id|serv
suffix:semicolon
id|pcmcia_get_card_services_info
c_func
(paren
op_amp
id|serv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|serv.Revision
op_ne
id|CS_RELEASE_CODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;i82365: Card Services release &quot;
l_string|&quot;does not match!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Intel PCIC probe: &quot;
)paren
suffix:semicolon
id|sockets
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|do_pci_probe
)paren
(brace
id|pci_probe
c_func
(paren
id|PCI_CLASS_BRIDGE_CARDBUS
comma
id|add_cb_bridge
)paren
suffix:semicolon
id|pci_probe
c_func
(paren
id|PCI_CLASS_BRIDGE_PCMCIA
comma
id|add_pci_bridge
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ISA
id|isa_probe
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|sockets
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;not found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Set up interrupt handler(s) */
macro_line|#ifdef CONFIG_ISA
r_if
c_cond
(paren
id|grab_irq
op_ne
l_int|0
)paren
id|request_irq
c_func
(paren
id|cs_irq
comma
id|pcic_interrupt
comma
l_int|0
comma
l_string|&quot;i82365&quot;
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|pci_csc
)paren
(brace
id|u_int
id|i
comma
id|irq
comma
id|mask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|socket
(braket
id|i
)braket
dot
id|cap.pci_irq
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_logical_and
op_logical_neg
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|irq
)paren
)paren
)paren
id|request_irq
c_func
(paren
id|irq
comma
id|pcic_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;i82365&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|mask
op_or_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|register_ss_entry
c_func
(paren
id|sockets
comma
op_amp
id|pcic_operations
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;i82365: register_ss_entry() failed&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Finally, schedule a polling interrupt */
r_if
c_cond
(paren
id|poll_interval
op_ne
l_int|0
)paren
(brace
id|poll_timer.function
op_assign
id|pcic_interrupt_wrapper
suffix:semicolon
id|poll_timer.data
op_assign
l_int|0
suffix:semicolon
id|poll_timer.prev
op_assign
id|poll_timer.next
op_assign
l_int|NULL
suffix:semicolon
id|poll_timer.expires
op_assign
id|jiffies
op_plus
id|poll_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* init_i82365 */
DECL|function|exit_i82365
r_static
r_void
id|__exit
id|exit_i82365
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
id|pcic_proc_remove
c_func
(paren
id|i
)paren
suffix:semicolon
macro_line|#endif
id|unregister_ss_entry
c_func
(paren
op_amp
id|pcic_operations
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poll_interval
op_ne
l_int|0
)paren
id|del_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISA
r_if
c_cond
(paren
id|grab_irq
op_ne
l_int|0
)paren
id|free_irq
c_func
(paren
id|cs_irq
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|pci_csc
)paren
(brace
id|u_int
id|irq
comma
id|mask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|socket
(braket
id|i
)braket
dot
id|cap.pci_irq
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_logical_and
op_logical_neg
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|irq
)paren
)paren
)paren
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
id|mask
op_or_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Turn off all interrupt sources! */
id|i365_set
c_func
(paren
id|i
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CARDBUS
)paren
id|cb_writel
c_func
(paren
id|i
comma
id|CB_SOCKET_MASK
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|cb_virt
)paren
(brace
id|iounmap
c_func
(paren
id|socket
(braket
id|i
)braket
dot
id|cb_virt
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|socket
(braket
id|i
)braket
dot
id|cb_phys
comma
l_int|0x1000
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|release_region
c_func
(paren
id|socket
(braket
id|i
)braket
dot
id|ioaddr
comma
l_int|2
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* exit_i82365 */
DECL|variable|init_i82365
id|module_init
c_func
(paren
id|init_i82365
)paren
suffix:semicolon
DECL|variable|exit_i82365
id|module_exit
c_func
(paren
id|exit_i82365
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
eof
