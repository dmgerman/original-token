multiline_comment|/* i2c-core.c - a device driver for the iic-bus interface&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*   Copyright (C) 1995-99 Simon G. Vogl&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* With some changes from Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;.&n;   All SMBus-related things are written by Frodo Looijaard &lt;frodol@dds.nl&gt; */
multiline_comment|/* $Id: i2c-core.c,v 1.58 2000/10/29 22:57:38 frodo Exp $ */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
multiline_comment|/* ----- compatibility stuff ----------------------------------------------- */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,1)
DECL|macro|init_MUTEX
mdefine_line|#define init_MUTEX(s) do { *(s) = MUTEX; } while(0)
macro_line|#endif
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* ----- global defines ---------------------------------------------------- */
multiline_comment|/* exclusive access to the bus */
DECL|macro|I2C_LOCK
mdefine_line|#define I2C_LOCK(adap) down(&amp;adap-&gt;lock)
DECL|macro|I2C_UNLOCK
mdefine_line|#define I2C_UNLOCK(adap) up(&amp;adap-&gt;lock) 
DECL|macro|ADAP_LOCK
mdefine_line|#define ADAP_LOCK()&t;down(&amp;adap_lock)
DECL|macro|ADAP_UNLOCK
mdefine_line|#define ADAP_UNLOCK()&t;up(&amp;adap_lock)
DECL|macro|DRV_LOCK
mdefine_line|#define DRV_LOCK()&t;down(&amp;driver_lock)
DECL|macro|DRV_UNLOCK
mdefine_line|#define DRV_UNLOCK()&t;up(&amp;driver_lock)
DECL|macro|DEB
mdefine_line|#define DEB(x) if (i2c_debug&gt;=1) x;
DECL|macro|DEB2
mdefine_line|#define DEB2(x) if (i2c_debug&gt;=2) x;
multiline_comment|/* ----- global variables -------------------------------------------------- */
multiline_comment|/**** lock for writing to global variables: the adapter &amp; driver list */
DECL|variable|adap_lock
r_struct
id|semaphore
id|adap_lock
suffix:semicolon
DECL|variable|driver_lock
r_struct
id|semaphore
id|driver_lock
suffix:semicolon
multiline_comment|/**** adapter list */
DECL|variable|adapters
r_static
r_struct
id|i2c_adapter
op_star
id|adapters
(braket
id|I2C_ADAP_MAX
)braket
suffix:semicolon
DECL|variable|adap_count
r_static
r_int
id|adap_count
suffix:semicolon
multiline_comment|/**** drivers list */
DECL|variable|drivers
r_static
r_struct
id|i2c_driver
op_star
id|drivers
(braket
id|I2C_DRIVER_MAX
)braket
suffix:semicolon
DECL|variable|driver_count
r_static
r_int
id|driver_count
suffix:semicolon
multiline_comment|/**** debug level */
DECL|variable|i2c_debug
r_static
r_int
id|i2c_debug
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* ---------------------------------------------------&n; * /proc entry declarations&n; *----------------------------------------------------&n; */
macro_line|#ifdef CONFIG_PROC_FS
r_static
r_int
id|i2cproc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|i2cproc_cleanup
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,3,27))
r_static
r_void
id|monitor_bus_i2c
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|fill
)paren
suffix:semicolon
macro_line|#endif /* (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,1,58)) */
r_static
id|ssize_t
id|i2cproc_bus_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
suffix:semicolon
r_static
r_int
id|read_bus_i2c
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
r_private
)paren
suffix:semicolon
multiline_comment|/* To implement the dynamic /proc/bus/i2c-? files, we need our own &n;   implementation of the read hook */
DECL|variable|i2cproc_operations
r_static
r_struct
id|file_operations
id|i2cproc_operations
op_assign
(brace
id|read
suffix:colon
id|i2cproc_bus_read
comma
)brace
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,48))
DECL|variable|i2cproc_inode_operations
r_static
r_struct
id|inode_operations
id|i2cproc_inode_operations
op_assign
(brace
op_amp
id|i2cproc_operations
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|i2cproc_initialized
r_static
r_int
id|i2cproc_initialized
op_assign
l_int|0
suffix:semicolon
macro_line|#else /* undef CONFIG_PROC_FS */
DECL|macro|i2cproc_init
mdefine_line|#define i2cproc_init() 0
DECL|macro|i2cproc_cleanup
mdefine_line|#define i2cproc_cleanup() 0
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/* ---------------------------------------------------&n; * registering functions &n; * --------------------------------------------------- &n; */
multiline_comment|/* -----&n; * i2c_add_adapter is called from within the algorithm layer,&n; * when a new hw adapter registers. A new device is register to be&n; * available for clients.&n; */
DECL|function|i2c_add_adapter
r_int
id|i2c_add_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|i
comma
id|j
comma
id|res
suffix:semicolon
id|ADAP_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_ADAP_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: register_adapter(%s) - enlarge I2C_ADAP_MAX.&bslash;n&quot;
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
id|adapters
(braket
id|i
)braket
op_assign
id|adap
suffix:semicolon
id|adap_count
op_increment
suffix:semicolon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* init data types */
id|init_MUTEX
c_func
(paren
op_amp
id|adap-&gt;lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|i2cproc_initialized
)paren
(brace
r_char
id|name
(braket
l_int|8
)braket
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|proc_entry
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;i2c-%d&quot;
comma
id|i
)paren
suffix:semicolon
id|proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
l_int|0
comma
id|proc_bus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_entry
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: Could not create /proc/bus/%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_goto
id|ERROR1
suffix:semicolon
)brace
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,3,48))
id|proc_entry-&gt;proc_fops
op_assign
op_amp
id|i2cproc_operations
suffix:semicolon
macro_line|#else
id|proc_entry-&gt;ops
op_assign
op_amp
id|i2cproc_inode_operations
suffix:semicolon
macro_line|#endif
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,3,27))
id|proc_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
macro_line|#else
id|proc_entry-&gt;fill_inode
op_assign
op_amp
id|monitor_bus_i2c
suffix:semicolon
macro_line|#endif /* (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,1,58)) */
id|adap-&gt;inode
op_assign
id|proc_entry-&gt;low_ino
suffix:semicolon
)brace
macro_line|#endif /* def CONFIG_PROC_FS */
multiline_comment|/* inform drivers of new adapters */
id|DRV_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|drivers
(braket
id|j
)braket
op_ne
l_int|NULL
op_logical_and
(paren
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|flags
op_amp
(paren
id|I2C_DF_NOTIFY
op_or
id|I2C_DF_DUMMY
)paren
)paren
)paren
multiline_comment|/* We ignore the return code; if it fails, too bad */
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
suffix:semicolon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: adapter %s registered as adapter %d.&bslash;n&quot;
comma
id|adap-&gt;name
comma
id|i
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ERROR1
suffix:colon
id|ADAP_LOCK
c_func
(paren
)paren
suffix:semicolon
id|adapters
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|adap_count
op_decrement
suffix:semicolon
id|ERROR0
suffix:colon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_del_adapter
r_int
id|i2c_del_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|i
comma
id|j
comma
id|res
suffix:semicolon
id|ADAP_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adap
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_ADAP_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: unregister_adapter adap [%s] not found.&bslash;n&quot;
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
multiline_comment|/* DUMMY drivers do not register their clients, so we have to&n;&t; * use a trick here: we call driver-&gt;attach_adapter to&n;&t; * *detach* it! Of course, each dummy driver should know about&n;&t; * this or hell will break loose...&n;&t; */
id|DRV_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|drivers
(braket
id|j
)braket
op_logical_and
(paren
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|flags
op_amp
id|I2C_DF_DUMMY
)paren
)paren
r_if
c_cond
(paren
(paren
id|res
op_assign
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: can&squot;t detach adapter %s &quot;
l_string|&quot;while detaching driver %s: driver not &quot;
l_string|&quot;detached!&quot;
comma
id|adap-&gt;name
comma
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_goto
id|ERROR1
suffix:semicolon
)brace
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* detach any active clients. This must be done first, because&n;&t; * it can fail; in which case we give upp. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|adap-&gt;clients
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|client
op_ne
l_int|NULL
)paren
multiline_comment|/* detaching devices is unconditional of the set notify&n;&t;&t;     * flag, as _all_ clients that reside on the adapter&n;&t;&t;     * must be deleted, as this would cause invalid states.&n;&t;&t;     */
r_if
c_cond
(paren
(paren
id|res
op_assign
id|client-&gt;driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: adapter %s not &quot;
l_string|&quot;unregisted, because client at &quot;
l_string|&quot;address %02x can&squot;t be detached. &quot;
comma
id|adap-&gt;name
comma
id|client-&gt;addr
)paren
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|i2cproc_initialized
)paren
(brace
r_char
id|name
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;i2c-%d&quot;
comma
id|i
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|name
comma
id|proc_bus
)paren
suffix:semicolon
)brace
macro_line|#endif /* def CONFIG_PROC_FS */
id|adapters
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|adap_count
op_decrement
suffix:semicolon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: adapter unregistered: %s&bslash;n&quot;
comma
id|adap-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ERROR0
suffix:colon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
id|ERROR1
suffix:colon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* -----&n; * What follows is the &quot;upwards&quot; interface: commands for talking to clients,&n; * which implement the functions to access the physical information of the&n; * chips.&n; */
DECL|function|i2c_add_driver
r_int
id|i2c_add_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_int
id|i
suffix:semicolon
id|DRV_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|drivers
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_DRIVER_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: register_driver(%s) &quot;
l_string|&quot;- enlarge I2C_DRIVER_MAX.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|drivers
(braket
id|i
)braket
op_assign
id|driver
suffix:semicolon
id|driver_count
op_increment
suffix:semicolon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* driver was successfully added */
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: driver %s registered.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
)paren
suffix:semicolon
id|ADAP_LOCK
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* now look for instances of driver on our adapters&n;&t; */
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
(paren
id|I2C_DF_NOTIFY
op_or
id|I2C_DF_DUMMY
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
multiline_comment|/* Ignore errors */
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adapters
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_del_driver
r_int
id|i2c_del_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
comma
id|res
suffix:semicolon
id|DRV_LOCK
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|driver
op_eq
id|drivers
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_DRIVER_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: unregister_driver: &quot;
l_string|&quot;[%s] not found&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Have a look at each adapter, if clients of this driver are still&n;&t; * attached. If so, detach them to be able to kill the driver &n;&t; * afterwards.&n;&t; */
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: unregister_driver - looking for clients.&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* removing clients does not depend on the notify flag, else &n;&t; * invalid operation might (will!) result, when using stale client&n;&t; * pointers.&n;&t; */
id|ADAP_LOCK
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* should be moved inside the if statement... */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|k
op_increment
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|adapters
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
id|adap
op_eq
l_int|NULL
)paren
multiline_comment|/* skip empty entries. */
r_continue
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: examining adapter %s:&bslash;n&quot;
comma
id|adap-&gt;name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
id|I2C_DF_DUMMY
)paren
(brace
multiline_comment|/* DUMMY drivers do not register their clients, so we have to&n;&t;&t; * use a trick here: we call driver-&gt;attach_adapter to&n;&t;&t; * *detach* it! Of course, each dummy driver should know about&n;&t;&t; * this or hell will break loose...  &n;&t;&t; */
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: while unregistering &quot;
l_string|&quot;dummy driver %s, adapter %s could &quot;
l_string|&quot;not be detached properly; driver &quot;
l_string|&quot;not unloaded!&quot;
comma
id|driver-&gt;name
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|adap-&gt;clients
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|client
op_ne
l_int|NULL
op_logical_and
id|client-&gt;driver
op_eq
id|driver
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: &quot;
l_string|&quot;detaching client %s:&bslash;n&quot;
comma
id|client-&gt;name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: while &quot;
l_string|&quot;unregistering driver &quot;
l_string|&quot;`%s&squot;, the client at &quot;
"&quot;"
id|address
op_mod
l_int|02
id|x
id|of
id|adapter
"`"
op_mod
id|s
"&squot;"
id|could
op_logical_neg
id|be
id|detached
suffix:semicolon
id|driver
op_logical_neg
id|unloaded
op_logical_neg
"&quot;"
comma
id|driver-&gt;name
comma
id|client-&gt;addr
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|ADAP_UNLOCK
c_func
(paren
)paren
suffix:semicolon
id|drivers
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|driver_count
op_decrement
suffix:semicolon
id|DRV_UNLOCK
c_func
(paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: driver unregistered: %s&bslash;n&quot;
comma
id|driver-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_check_addr
r_int
id|i2c_check_addr
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapter-&gt;clients
(braket
id|i
)braket
op_logical_and
(paren
id|adapter-&gt;clients
(braket
id|i
)braket
op_member_access_from_pointer
id|addr
op_eq
id|addr
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_attach_client
r_int
id|i2c_attach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_check_addr
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|adapter-&gt;clients
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_CLIENT_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: attach_client(%s) - enlarge I2C_CLIENT_MAX.&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|adapter-&gt;clients
(braket
id|i
)braket
op_assign
id|client
suffix:semicolon
id|adapter-&gt;client_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;client_register
)paren
r_if
c_cond
(paren
id|adapter
op_member_access_from_pointer
id|client_register
c_func
(paren
id|client
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: warning: client_register seems &quot;
l_string|&quot;to have failed for client %02x at adapter %s&bslash;n&quot;
comma
id|client-&gt;addr
comma
id|adapter-&gt;name
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: client [%s] registered to adapter [%s](pos. %d).&bslash;n&quot;
comma
id|client-&gt;name
comma
id|adapter-&gt;name
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
id|client-&gt;usage_count
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_detach_client
r_int
id|i2c_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
r_int
id|i
comma
id|res
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|client
op_eq
id|adapter-&gt;clients
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_CLIENT_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: unregister_client &quot;
l_string|&quot;[%s] not found&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
op_logical_and
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;client_unregister
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
(paren
id|res
op_assign
id|adapter
op_member_access_from_pointer
id|client_unregister
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: client_unregister [%s] failed, &quot;
l_string|&quot;client not detached&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
id|adapter-&gt;clients
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|adapter-&gt;client_count
op_decrement
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: client [%s] unregistered.&bslash;n&quot;
comma
id|client-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_inc_use_client
r_void
id|i2c_inc_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;driver-&gt;inc_use
op_ne
l_int|NULL
)paren
id|client-&gt;driver
op_member_access_from_pointer
id|inc_use
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;inc_use
op_ne
l_int|NULL
)paren
id|client-&gt;adapter
op_member_access_from_pointer
id|inc_use
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
)brace
DECL|function|i2c_dec_use_client
r_void
id|i2c_dec_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;driver-&gt;dec_use
op_ne
l_int|NULL
)paren
id|client-&gt;driver
op_member_access_from_pointer
id|dec_use
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;dec_use
op_ne
l_int|NULL
)paren
id|client-&gt;adapter
op_member_access_from_pointer
id|dec_use
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
)brace
DECL|function|i2c_get_client
r_struct
id|i2c_client
op_star
id|i2c_get_client
c_func
(paren
r_int
id|driver_id
comma
r_int
id|adapter_id
comma
r_struct
id|i2c_client
op_star
id|prev
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
multiline_comment|/* Will iterate through the list of clients in each adapter of adapters-list&n;&t;   in search for a client that matches the search criteria. driver_id or &n;&t;   adapter_id are ignored if set to 0. If both are ignored this returns &n;&t;   first client found. */
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set starting point */
r_if
c_cond
(paren
id|prev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|prev-&gt;adapter
)paren
)paren
(brace
r_return
(paren
r_struct
id|i2c_client
op_star
)paren
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|prev-&gt;adapter
op_eq
id|adapters
(braket
id|j
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* invalid starting point? */
r_if
c_cond
(paren
id|I2C_ADAP_MAX
op_eq
id|j
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: get_client adapter for client:[%s] not found&bslash;n&quot;
comma
id|prev-&gt;name
)paren
suffix:semicolon
r_return
(paren
r_struct
id|i2c_client
op_star
)paren
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|prev
op_eq
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|clients
(braket
id|i
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* invalid starting point? */
r_if
c_cond
(paren
id|I2C_CLIENT_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: get_client client:[%s] not found&bslash;n&quot;
comma
id|prev-&gt;name
)paren
suffix:semicolon
r_return
(paren
r_struct
id|i2c_client
op_star
)paren
op_minus
id|ENODEV
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
multiline_comment|/* start from one after prev */
)brace
r_for
c_loop
(paren
suffix:semicolon
id|j
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|adapters
(braket
id|j
)braket
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter_id
op_logical_and
(paren
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|id
op_ne
id|adapter_id
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|clients
(braket
id|i
)braket
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|driver_id
op_logical_and
(paren
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|clients
(braket
id|i
)braket
op_member_access_from_pointer
id|driver-&gt;id
op_ne
id|driver_id
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|clients
(braket
id|i
)braket
op_member_access_from_pointer
id|flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_return
id|adapters
(braket
id|j
)braket
op_member_access_from_pointer
id|clients
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_use_client
r_int
id|i2c_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_MULTIPLE_USE
)paren
id|client-&gt;usage_count
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_else
id|client-&gt;usage_count
op_increment
suffix:semicolon
)brace
)brace
id|i2c_inc_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_release_client
r_int
id|i2c_release_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
(brace
id|client-&gt;usage_count
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: dec_use_client used one too many times&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
id|i2c_dec_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------&n; * The /proc functions&n; * ----------------------------------------------------&n; */
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#if (LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,3,27))
multiline_comment|/* Monitor access to /proc/bus/i2c*; make unloading i2c-proc impossible&n;   if some process still uses it or some file in it */
DECL|function|monitor_bus_i2c
r_void
id|monitor_bus_i2c
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|fill
)paren
(brace
r_if
c_cond
(paren
id|fill
)paren
id|MOD_INC_USE_COUNT
suffix:semicolon
r_else
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#endif /* (LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,3,37)) */
multiline_comment|/* This function generates the output for /proc/bus/i2c */
DECL|function|read_bus_i2c
r_int
id|read_bus_i2c
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
r_private
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|nr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Note that it is safe to write a `little&squot; beyond len. Yes, really. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|I2C_ADAP_MAX
)paren
op_logical_and
(paren
id|nr
OL
id|len
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
)paren
(brace
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;i2c-%d&bslash;t&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;smbus_xfer
)paren
(brace
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;master_xfer
)paren
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;smbus/i2c&quot;
)paren
suffix:semicolon
r_else
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;smbus    &quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;master_xfer
)paren
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;i2c       &quot;
)paren
suffix:semicolon
r_else
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;dummy     &quot;
)paren
suffix:semicolon
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;&bslash;t%-32s&bslash;t%-32s&bslash;n&quot;
comma
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|name
comma
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;name
)paren
suffix:semicolon
)brace
r_return
id|nr
suffix:semicolon
)brace
multiline_comment|/* This function generates the output for /proc/bus/i2c-? */
DECL|function|i2cproc_bus_read
id|ssize_t
id|i2cproc_bus_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_char
op_star
id|kbuf
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
comma
id|order_nr
comma
id|len
op_assign
l_int|0
comma
id|len_total
suffix:semicolon
r_int
id|order
(braket
id|I2C_CLIENT_MAX
)braket
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len_total
op_assign
id|file-&gt;f_pos
op_plus
id|count
suffix:semicolon
multiline_comment|/* Too bad if this gets longer (unlikely) */
r_if
c_cond
(paren
id|len_total
OG
l_int|4000
)paren
id|len_total
op_assign
l_int|4000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|inode
op_eq
id|inode-&gt;i_ino
)paren
(brace
multiline_comment|/* We need a bit of slack in the kernel buffer; this makes the&n;&t;&t;   sprintf safe. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|kbuf
op_assign
id|kmalloc
c_func
(paren
id|count
op_plus
l_int|80
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Order will hold the indexes of the clients&n;&t;&t;&t;   sorted by address */
id|order_nr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|client
op_assign
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|j
)braket
)paren
op_logical_and
(paren
id|client-&gt;driver-&gt;id
op_ne
id|I2C_DRIVERID_I2CDEV
)paren
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
id|order_nr
suffix:semicolon
(paren
id|k
OG
l_int|0
)paren
op_logical_and
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|order
(braket
id|k
op_minus
l_int|1
)braket
)braket
op_member_access_from_pointer
id|addr
OG
id|client-&gt;addr
suffix:semicolon
id|k
op_decrement
)paren
(brace
id|order
(braket
id|k
)braket
op_assign
id|order
(braket
id|k
op_minus
l_int|1
)braket
suffix:semicolon
)brace
id|order
(braket
id|k
)braket
op_assign
id|j
suffix:semicolon
id|order_nr
op_increment
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
(paren
id|j
OL
id|order_nr
)paren
op_logical_and
(paren
id|len
OL
id|len_total
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|client
op_assign
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|order
(braket
id|j
)braket
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|kbuf
op_plus
id|len
comma
l_string|&quot;%02x&bslash;t%-32s&bslash;t%-32s&bslash;n&quot;
comma
id|client-&gt;addr
comma
id|client-&gt;name
comma
id|client-&gt;driver-&gt;name
)paren
suffix:semicolon
)brace
id|len
op_assign
id|len
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|count
)paren
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|buf
comma
id|kbuf
op_plus
id|file-&gt;f_pos
comma
id|len
)paren
)paren
(brace
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
id|len
suffix:semicolon
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|i2cproc_init
r_int
id|i2cproc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|proc_bus_i2c
suffix:semicolon
id|i2cproc_initialized
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_bus
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: /proc/bus/ does not exist&quot;
)paren
suffix:semicolon
id|i2cproc_cleanup
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|proc_bus_i2c
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;i2c&quot;
comma
l_int|0
comma
id|proc_bus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_bus_i2c
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: Could not create /proc/bus/i2c&quot;
)paren
suffix:semicolon
id|i2cproc_cleanup
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|proc_bus_i2c-&gt;read_proc
op_assign
op_amp
id|read_bus_i2c
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,3,27))
id|proc_bus_i2c-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
macro_line|#else
id|proc_bus_i2c-&gt;fill_inode
op_assign
op_amp
id|monitor_bus_i2c
suffix:semicolon
macro_line|#endif /* (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,3,27)) */
id|i2cproc_initialized
op_add_assign
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2cproc_cleanup
r_int
id|i2cproc_cleanup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|i2cproc_initialized
op_ge
l_int|1
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;i2c&quot;
comma
id|proc_bus
)paren
suffix:semicolon
id|i2cproc_initialized
op_sub_assign
l_int|2
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* def CONFIG_PROC_FS */
multiline_comment|/* ----------------------------------------------------&n; * the functional interface to the i2c busses.&n; * ----------------------------------------------------&n; */
DECL|function|i2c_transfer
r_int
id|i2c_transfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_struct
id|i2c_msg
id|msgs
(braket
)braket
comma
r_int
id|num
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;master_xfer
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: master_xfer: %s with %d msgs.&bslash;n&quot;
comma
id|adap-&gt;name
comma
id|num
)paren
)paren
suffix:semicolon
id|I2C_LOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
id|msgs
comma
id|num
)paren
suffix:semicolon
id|I2C_UNLOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|adap-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_send
r_int
id|i2c_master_send
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
(paren
r_const
r_char
op_star
)paren
id|msg.buf
op_assign
id|buf
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: master_send: writing %d bytes on %s.&bslash;n&quot;
comma
id|count
comma
id|client-&gt;adapter-&gt;name
)paren
)paren
suffix:semicolon
id|I2C_LOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|I2C_UNLOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t;&t; * transmitted, else error code.&n;&t;&t; */
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|client-&gt;adapter-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_recv
r_int
id|i2c_master_recv
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.flags
op_or_assign
id|I2C_M_RD
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
id|msg.buf
op_assign
id|buf
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: master_recv: reading %d bytes on %s.&bslash;n&quot;
comma
id|count
comma
id|client-&gt;adapter-&gt;name
)paren
)paren
suffix:semicolon
id|I2C_LOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|I2C_UNLOCK
c_func
(paren
id|adap
)paren
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: master_recv: return:%d (count:%d, addr:0x%02x)&bslash;n&quot;
comma
id|ret
comma
id|count
comma
id|client-&gt;addr
)paren
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t; &t;* transmitted, else error code.&n;&t; &t;*/
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|client-&gt;adapter-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_control
r_int
id|i2c_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: i2c ioctl, cmd: 0x%x, arg: %#lx&bslash;n&quot;
comma
id|cmd
comma
id|arg
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|I2C_RETRIES
suffix:colon
id|adap-&gt;retries
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_TIMEOUT
suffix:colon
id|adap-&gt;timeout
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;algo_control
op_ne
l_int|NULL
)paren
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|algo_control
c_func
(paren
id|adap
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------&n; * the i2c address scanning function&n; * Will not work for 10-bit addresses!&n; * ----------------------------------------------------&n; */
DECL|function|i2c_probe
r_int
id|i2c_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_struct
id|i2c_client_address_data
op_star
id|address_data
comma
id|i2c_client_found_addr_proc
op_star
id|found_proc
)paren
(brace
r_int
id|addr
comma
id|i
comma
id|found
comma
id|err
suffix:semicolon
r_int
id|adap_id
op_assign
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
suffix:semicolon
multiline_comment|/* Forget it if we can&squot;t probe using SMBUS_QUICK */
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_QUICK
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|addr
op_assign
l_int|0x00
suffix:semicolon
id|addr
op_le
l_int|0x7f
suffix:semicolon
id|addr
op_increment
)paren
(brace
multiline_comment|/* Skip if already in use */
r_if
c_cond
(paren
id|i2c_check_addr
c_func
(paren
id|adapter
comma
id|addr
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* If it is in one of the force entries, we don&squot;t do any detection&n;&t;&t;   at all */
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;force
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;force
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found force parameter for adapter %d, addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* If this address is in one of the ignores, we can forget about&n;&t;&t;   it right now */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;ignore
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found ignore parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found ignore_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* Now, we will do a detection, but only if it is in the normal or &n;&t;&t;   probe entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|addr
op_eq
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found normal i2c entry for adapter %d, &quot;
l_string|&quot;addr %02x&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_ge
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;normal_i2c_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found normal i2c_range entry for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;probe
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found probe parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: found probe_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* OK, so we really should examine this address. First check&n;&t;&t;   whether there is some client here at all! */
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
op_ge
l_int|0
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
op_minus
l_int|1
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return id number for a specific adapter&n; */
DECL|function|i2c_adapter_id
r_int
id|i2c_adapter_id
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adap
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_return
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* The SMBus parts */
DECL|function|i2c_smbus_write_quick
r_extern
id|s32
id|i2c_smbus_write_quick
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|value
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte
r_extern
id|s32
id|i2c_smbus_read_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
l_int|0
comma
id|I2C_SMBUS_BYTE
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte
r_extern
id|s32
id|i2c_smbus_write_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|value
comma
id|I2C_SMBUS_BYTE
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte_data
r_extern
id|s32
id|i2c_smbus_read_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte_data
r_extern
id|s32
id|i2c_smbus_write_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.byte
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_word_data
r_extern
id|s32
id|i2c_smbus_read_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_word_data
r_extern
id|s32
id|i2c_smbus_write_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_process_call
r_extern
id|s32
id|i2c_smbus_process_call
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_PROC_CALL
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_read_block_data
r_extern
id|s32
id|i2c_smbus_read_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
DECL|function|i2c_smbus_write_block_data
r_extern
id|s32
id|i2c_smbus_write_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
l_int|32
)paren
id|length
op_assign
l_int|32
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_i2c_block_data
r_extern
id|s32
id|i2c_smbus_write_i2c_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
l_int|32
)paren
id|length
op_assign
l_int|32
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_I2C_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* Simulate a SMBus command using the i2c protocol &n;   No checking of parameters is done!  */
DECL|function|i2c_smbus_xfer_emulated
r_static
id|s32
id|i2c_smbus_xfer_emulated
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
multiline_comment|/* So we need to generate a series of msgs. In the case of writing, we&n;&t;  need to use only one message; when reading, we need two. We initialize&n;&t;  most things with sane defaults, to keep the code below somewhat&n;&t;  simpler. */
r_int
r_char
id|msgbuf0
(braket
l_int|34
)braket
suffix:semicolon
r_int
r_char
id|msgbuf1
(braket
l_int|34
)braket
suffix:semicolon
r_int
id|num
op_assign
id|read_write
op_eq
id|I2C_SMBUS_READ
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|addr
comma
id|flags
comma
l_int|1
comma
id|msgbuf0
)brace
comma
(brace
id|addr
comma
id|flags
op_or
id|I2C_M_RD
comma
l_int|0
comma
id|msgbuf1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|msgbuf0
(braket
l_int|0
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_QUICK
suffix:colon
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Special case: The read/write field is used as data */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|flags
op_or
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
ques
c_cond
id|I2C_M_RD
suffix:colon
l_int|0
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
multiline_comment|/* Special case: only a read! */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|I2C_M_RD
op_or
id|flags
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;byte
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|num
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Special case */
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: Block read not supported under &quot;
l_string|&quot;I2C emulation!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
OG
l_int|34
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: smbus_access called with &quot;
l_string|&quot;invalid block write size (%d)&bslash;n&quot;
comma
id|msg
(braket
l_int|0
)braket
dot
id|len
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|msg
(braket
l_int|0
)braket
dot
id|len
suffix:semicolon
id|i
op_increment
)paren
id|msgbuf0
(braket
id|i
)braket
op_assign
id|data-&gt;block
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: smbus_access called with invalid size (%d)&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
id|adapter
comma
id|msg
comma
id|num
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf0
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf1
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|data-&gt;word
op_assign
id|msgbuf1
(braket
l_int|0
)braket
op_or
(paren
id|msgbuf1
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_smbus_xfer
id|s32
id|i2c_smbus_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|s32
id|res
suffix:semicolon
id|flags
op_assign
id|flags
op_amp
id|I2C_M_TEN
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;algo-&gt;smbus_xfer
)paren
(brace
id|I2C_LOCK
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|res
op_assign
id|adapter-&gt;algo
op_member_access_from_pointer
id|smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
id|I2C_UNLOCK
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
r_else
id|res
op_assign
id|i2c_smbus_xfer_emulated
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* You should always define `functionality&squot;; the &squot;else&squot; is just for&n;   backward compatibility. */
DECL|function|i2c_get_functionality
id|u32
id|i2c_get_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;functionality
)paren
r_return
id|adap-&gt;algo
op_member_access_from_pointer
id|functionality
c_func
(paren
id|adap
)paren
suffix:semicolon
r_else
r_return
l_int|0xffffffff
suffix:semicolon
)brace
DECL|function|i2c_check_functionality
r_int
id|i2c_check_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
id|u32
id|func
)paren
(brace
id|u32
id|adap_func
op_assign
id|i2c_get_functionality
(paren
id|adap
)paren
suffix:semicolon
r_return
(paren
id|func
op_amp
id|adap_func
)paren
op_eq
id|func
suffix:semicolon
)brace
DECL|function|i2c_init
r_static
r_int
id|__init
id|i2c_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: i2c core module&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|adapters
comma
l_int|0
comma
r_sizeof
(paren
id|adapters
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|drivers
comma
l_int|0
comma
r_sizeof
(paren
id|drivers
)paren
)paren
suffix:semicolon
id|adap_count
op_assign
l_int|0
suffix:semicolon
id|driver_count
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adap_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|driver_lock
)paren
suffix:semicolon
id|i2cproc_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef MODULE
macro_line|#ifdef CONFIG_I2C_CHARDEV
r_extern
r_int
id|i2c_dev_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_ALGOBIT
r_extern
r_int
id|i2c_algo_bit_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_BITLP
r_extern
r_int
id|i2c_bitlp_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_BITELV
r_extern
r_int
id|i2c_bitelv_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_BITVELLE
r_extern
r_int
id|i2c_bitvelle_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_BITVIA
r_extern
r_int
id|i2c_bitvia_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_ALGOPCF
r_extern
r_int
id|i2c_algo_pcf_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_PCFISA
r_extern
r_int
id|i2c_pcfisa_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* This is needed for automatic patch generation: sensors code starts here */
multiline_comment|/* This is needed for automatic patch generation: sensors code ends here   */
DECL|function|i2c_init_all
r_int
id|__init
id|i2c_init_all
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* --------------------- global ----- */
id|i2c_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_I2C_CHARDEV
id|i2c_dev_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* --------------------- bit -------- */
macro_line|#ifdef CONFIG_I2C_ALGOBIT
id|i2c_algo_bit_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_PHILIPSPAR
id|i2c_bitlp_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_ELV
id|i2c_bitelv_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_VELLEMAN
id|i2c_bitvelle_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* --------------------- pcf -------- */
macro_line|#ifdef CONFIG_I2C_ALGOPCF
id|i2c_algo_pcf_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_I2C_ELEKTOR
id|i2c_pcfisa_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* This is needed for automatic patch generation: sensors code starts here */
multiline_comment|/* This is needed for automatic patch generation: sensors code ends here */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|i2c_add_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_adapter
)paren
suffix:semicolon
DECL|variable|i2c_del_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_adapter
)paren
suffix:semicolon
DECL|variable|i2c_add_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_driver
)paren
suffix:semicolon
DECL|variable|i2c_del_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_driver
)paren
suffix:semicolon
DECL|variable|i2c_attach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_attach_client
)paren
suffix:semicolon
DECL|variable|i2c_detach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_detach_client
)paren
suffix:semicolon
DECL|variable|i2c_inc_use_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_inc_use_client
)paren
suffix:semicolon
DECL|variable|i2c_dec_use_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_dec_use_client
)paren
suffix:semicolon
DECL|variable|i2c_get_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_get_client
)paren
suffix:semicolon
DECL|variable|i2c_use_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_use_client
)paren
suffix:semicolon
DECL|variable|i2c_release_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_release_client
)paren
suffix:semicolon
DECL|variable|i2c_check_addr
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_addr
)paren
suffix:semicolon
DECL|variable|i2c_master_send
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_send
)paren
suffix:semicolon
DECL|variable|i2c_master_recv
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_recv
)paren
suffix:semicolon
DECL|variable|i2c_control
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_control
)paren
suffix:semicolon
DECL|variable|i2c_transfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_transfer
)paren
suffix:semicolon
DECL|variable|i2c_adapter_id
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_adapter_id
)paren
suffix:semicolon
DECL|variable|i2c_probe
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_probe
)paren
suffix:semicolon
DECL|variable|i2c_smbus_xfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_xfer
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_quick
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_quick
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_process_call
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_process_call
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_block_data
)paren
suffix:semicolon
DECL|variable|i2c_get_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_get_functionality
)paren
suffix:semicolon
DECL|variable|i2c_check_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_functionality
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Simon G. Vogl &lt;simon@tk.uni-linz.ac.at&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;I2C-Bus main module&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|i2c_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|i2c_debug
comma
l_string|&quot;debug level&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|i2cproc_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
