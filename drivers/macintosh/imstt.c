multiline_comment|/*&n; * imstt.c: Console support for PowerMac &quot;imstt&quot; display adaptor.&n; *&n; * Copyright (C) 1997 Sigurdur Asgeirsson&n; * Modified by Danilo Beuche 1997&n; *&t;&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/vc_ioctl.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/nvram.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &lt;asm/init.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &quot;pmac-cons.h&quot;
macro_line|#include &quot;imstt.h&quot;
r_enum
(brace
DECL|enumerator|IBMRAMDAC
id|IBMRAMDAC
op_assign
l_int|0x00
comma
DECL|enumerator|TVPRAMDAC
id|TVPRAMDAC
op_assign
l_int|0x01
)brace
suffix:semicolon
singleline_comment|// IMS TWIN TURBO 
r_enum
(brace
DECL|enumerator|S1SA
id|S1SA
op_assign
l_int|0
comma
multiline_comment|/* 0x00 */
DECL|enumerator|S2SA
id|S2SA
op_assign
l_int|1
comma
multiline_comment|/* 0x04 */
DECL|enumerator|SP
id|SP
op_assign
l_int|2
comma
multiline_comment|/* 0x08 */
DECL|enumerator|DSA
id|DSA
op_assign
l_int|3
comma
multiline_comment|/* 0x0C */
DECL|enumerator|CNT
id|CNT
op_assign
l_int|4
comma
multiline_comment|/* 0x10 */
DECL|enumerator|DP_OCTRL
id|DP_OCTRL
op_assign
l_int|5
comma
multiline_comment|/* 0x14 */
DECL|enumerator|BLTCTL
id|BLTCTL
op_assign
l_int|10
comma
multiline_comment|/* 0x28 */
singleline_comment|//&t;Scan Timing Generator Registers
DECL|enumerator|HES
id|HES
op_assign
l_int|12
comma
multiline_comment|/* 0x30 */
DECL|enumerator|HEB
id|HEB
op_assign
l_int|13
comma
multiline_comment|/* 0x34 */
DECL|enumerator|HSB
id|HSB
op_assign
l_int|14
comma
multiline_comment|/* 0x38 */
DECL|enumerator|HT
id|HT
op_assign
l_int|15
comma
multiline_comment|/* 0x3C */
DECL|enumerator|VES
id|VES
op_assign
l_int|16
comma
multiline_comment|/* 0x40 */
DECL|enumerator|VEB
id|VEB
op_assign
l_int|17
comma
multiline_comment|/* 0x44 */
DECL|enumerator|VSB
id|VSB
op_assign
l_int|18
comma
multiline_comment|/* 0x48 */
DECL|enumerator|VT
id|VT
op_assign
l_int|19
comma
multiline_comment|/* 0x4C */
DECL|enumerator|HCIV
id|HCIV
op_assign
l_int|20
comma
multiline_comment|/* 0x50 */
DECL|enumerator|VCIV
id|VCIV
op_assign
l_int|21
comma
multiline_comment|/* 0x54 */
DECL|enumerator|TCDR
id|TCDR
op_assign
l_int|22
comma
multiline_comment|/* 0x58 */
DECL|enumerator|VIL
id|VIL
op_assign
l_int|23
comma
multiline_comment|/* 0x5C */
DECL|enumerator|STGCTL
id|STGCTL
op_assign
l_int|24
comma
multiline_comment|/* 0x60 */
singleline_comment|//&t;Screen Refresh Generator Registers
DECL|enumerator|SSR
id|SSR
op_assign
l_int|25
comma
multiline_comment|/* 0x64 */
DECL|enumerator|HRIR
id|HRIR
op_assign
l_int|26
comma
multiline_comment|/* 0x68 */
DECL|enumerator|SPR
id|SPR
op_assign
l_int|27
comma
multiline_comment|/* 0x6C */
DECL|enumerator|CMR
id|CMR
op_assign
l_int|28
comma
multiline_comment|/* 0x70 */
DECL|enumerator|SRGCTL
id|SRGCTL
op_assign
l_int|29
comma
multiline_comment|/* 0x74 */
singleline_comment|//&t;RAM Refresh Generator Registers
DECL|enumerator|RRCIV
id|RRCIV
op_assign
l_int|30
comma
multiline_comment|/* 0x78 */
DECL|enumerator|RRSC
id|RRSC
op_assign
l_int|31
comma
multiline_comment|/* 0x7C */
DECL|enumerator|RRCR
id|RRCR
op_assign
l_int|34
comma
multiline_comment|/* 0x88 */
singleline_comment|//&t;System Registers
DECL|enumerator|GIOE
id|GIOE
op_assign
l_int|32
comma
multiline_comment|/* 0x80 */
DECL|enumerator|GIO
id|GIO
op_assign
l_int|33
comma
multiline_comment|/* 0x84 */
DECL|enumerator|SCR
id|SCR
op_assign
l_int|35
comma
multiline_comment|/* 0x8C */
DECL|enumerator|SSTATUS
id|SSTATUS
op_assign
l_int|36
comma
multiline_comment|/* 0x90 */
DECL|enumerator|PRC
id|PRC
op_assign
l_int|37
comma
multiline_comment|/* 0x94 */
macro_line|#if 0&t;
singleline_comment|//&t;PCI Registers
id|DVID
op_assign
l_int|0x00000000L
comma
id|SC
op_assign
l_int|0x00000004L
comma
id|CCR
op_assign
l_int|0x00000008L
comma
id|OG
op_assign
l_int|0x0000000CL
comma
id|BARM
op_assign
l_int|0x00000010L
comma
id|BARER
op_assign
l_int|0x00000030L
comma
macro_line|#endif
)brace
suffix:semicolon
singleline_comment|// IBM RAMDAC
r_enum
(brace
DECL|enumerator|PADDRW
id|PADDRW
op_assign
l_int|0x00
comma
DECL|enumerator|PDATA
id|PDATA
op_assign
l_int|0x04
comma
DECL|enumerator|PPMASK
id|PPMASK
op_assign
l_int|0x08
comma
DECL|enumerator|PADDRR
id|PADDRR
op_assign
l_int|0x0C
comma
DECL|enumerator|PIDXLO
id|PIDXLO
op_assign
l_int|0x10
comma
DECL|enumerator|PIDXHI
id|PIDXHI
op_assign
l_int|0x14
comma
DECL|enumerator|PIDXDATA
id|PIDXDATA
op_assign
l_int|0x18
comma
DECL|enumerator|PIDXCTL
id|PIDXCTL
op_assign
l_int|0x1C
comma
DECL|enumerator|PPIXREP
id|PPIXREP
op_assign
l_int|0x0A
comma
DECL|enumerator|PM0
id|PM0
op_assign
l_int|0x20
comma
DECL|enumerator|PN0
id|PN0
op_assign
l_int|0x21
comma
DECL|enumerator|PP0
id|PP0
op_assign
l_int|0x22
comma
DECL|enumerator|PC0
id|PC0
op_assign
l_int|0x23
)brace
suffix:semicolon
singleline_comment|// TI TVP 3030 RAMDAC Direct Registers
r_enum
(brace
DECL|enumerator|TVPADDRW
id|TVPADDRW
op_assign
l_int|0x00
comma
singleline_comment|// 0  Palette/Cursor RAM Write Adress/Index
DECL|enumerator|TVPPDATA
id|TVPPDATA
op_assign
l_int|0x04
comma
singleline_comment|// 1  Palette Data RAM Data
DECL|enumerator|TVPPMASK
id|TVPPMASK
op_assign
l_int|0x08
comma
singleline_comment|// 2  Pixel Read-Mask
DECL|enumerator|TVPPADRR
id|TVPPADRR
op_assign
l_int|0x0c
comma
singleline_comment|// 3  Palette/Cursor RAM Read Adress
DECL|enumerator|TVPCADRW
id|TVPCADRW
op_assign
l_int|0x10
comma
singleline_comment|// 4  Cursor/Overscan Color Write Address
DECL|enumerator|TVPCDATA
id|TVPCDATA
op_assign
l_int|0x14
comma
singleline_comment|// 5  Cursor/Overscan Color Data
singleline_comment|// 6  reserved
DECL|enumerator|TVPCADRR
id|TVPCADRR
op_assign
l_int|0x1c
comma
singleline_comment|// 7  Cursor/Overscan Color Read Address
singleline_comment|// 8  reserved
DECL|enumerator|TVPDCCTL
id|TVPDCCTL
op_assign
l_int|0x24
comma
singleline_comment|// 9  Direct Cursor Control
DECL|enumerator|TVPIDATA
id|TVPIDATA
op_assign
l_int|0x28
comma
singleline_comment|// 10 Index Data
DECL|enumerator|TVPCRDAT
id|TVPCRDAT
op_assign
l_int|0x2c
comma
singleline_comment|// 11 Cursor RAM Data
DECL|enumerator|TVPCXPOL
id|TVPCXPOL
op_assign
l_int|0x30
comma
singleline_comment|// 12 Cursor-Position X LSB
DECL|enumerator|TVPCXPOH
id|TVPCXPOH
op_assign
l_int|0x34
comma
singleline_comment|// 13 Cursor-Position X MSB
DECL|enumerator|TVPCYPOL
id|TVPCYPOL
op_assign
l_int|0x38
comma
singleline_comment|// 14 Cursor-Position Y LSB
DECL|enumerator|TVPCYPOH
id|TVPCYPOH
op_assign
l_int|0x3c
comma
singleline_comment|// 15 Cursor-Position Y MSB
)brace
suffix:semicolon
singleline_comment|// TI TVP 3030 RAMDAC Indirect Registers
r_enum
(brace
DECL|enumerator|TVPIRREV
id|TVPIRREV
op_assign
l_int|0x01
comma
singleline_comment|// Silicon Revision [RO] 
DECL|enumerator|TVPIRICC
id|TVPIRICC
op_assign
l_int|0x06
comma
singleline_comment|// Indirect Cursor Control &t;(0x00) 
DECL|enumerator|TVPIRBRC
id|TVPIRBRC
op_assign
l_int|0x07
comma
singleline_comment|// Byte Router Control &t;(0xe4)
DECL|enumerator|TVPIRLAC
id|TVPIRLAC
op_assign
l_int|0x0f
comma
singleline_comment|// Latch Control &t;&t;(0x06)
DECL|enumerator|TVPIRTCC
id|TVPIRTCC
op_assign
l_int|0x18
comma
singleline_comment|// True Color Control  &t;(0x80)
DECL|enumerator|TVPIRMXC
id|TVPIRMXC
op_assign
l_int|0x19
comma
singleline_comment|// Multiplex Control&t;&t;(0x98)
DECL|enumerator|TVPIRCLS
id|TVPIRCLS
op_assign
l_int|0x1a
comma
singleline_comment|// Clock Selection&t;&t;(0x07)
DECL|enumerator|TVPIRPPG
id|TVPIRPPG
op_assign
l_int|0x1c
comma
singleline_comment|// Palette Page&t;&t;(0x00)
DECL|enumerator|TVPIRGEC
id|TVPIRGEC
op_assign
l_int|0x1d
comma
singleline_comment|// General Control &t;&t;(0x00)
DECL|enumerator|TVPIRMIC
id|TVPIRMIC
op_assign
l_int|0x1e
comma
singleline_comment|// Miscellaneous Control&t;(0x00)
DECL|enumerator|TVPIRPLA
id|TVPIRPLA
op_assign
l_int|0x2c
comma
singleline_comment|// PLL Address&t;&t;&t;
DECL|enumerator|TVPIRPPD
id|TVPIRPPD
op_assign
l_int|0x2d
comma
singleline_comment|// Pixel Clock PLL Data
DECL|enumerator|TVPIRMPD
id|TVPIRMPD
op_assign
l_int|0x2e
comma
singleline_comment|// Memory Clock PLL Data
DECL|enumerator|TVPIRLPD
id|TVPIRLPD
op_assign
l_int|0x2f
comma
singleline_comment|// Loop Clock PLL Data
DECL|enumerator|TVPIRCKL
id|TVPIRCKL
op_assign
l_int|0x30
comma
singleline_comment|// Color-Key Overlay Low
DECL|enumerator|TVPIRCKH
id|TVPIRCKH
op_assign
l_int|0x31
comma
singleline_comment|// Color-Key Overlay High 
DECL|enumerator|TVPIRCRL
id|TVPIRCRL
op_assign
l_int|0x32
comma
singleline_comment|// Color-Key Red Low
DECL|enumerator|TVPIRCRH
id|TVPIRCRH
op_assign
l_int|0x33
comma
singleline_comment|// Color-Key Red High 
DECL|enumerator|TVPIRCGL
id|TVPIRCGL
op_assign
l_int|0x34
comma
singleline_comment|// Color-Key Green Low
DECL|enumerator|TVPIRCGH
id|TVPIRCGH
op_assign
l_int|0x35
comma
singleline_comment|// Color-Key Green High 
DECL|enumerator|TVPIRCBL
id|TVPIRCBL
op_assign
l_int|0x36
comma
singleline_comment|// Color-Key Blue Low
DECL|enumerator|TVPIRCBH
id|TVPIRCBH
op_assign
l_int|0x37
comma
singleline_comment|// Color-Key Blue High 
DECL|enumerator|TVPIRCKC
id|TVPIRCKC
op_assign
l_int|0x38
comma
singleline_comment|// Color-Key Control &t;&t;(0x00)
DECL|enumerator|TVPIRMLC
id|TVPIRMLC
op_assign
l_int|0x39
comma
singleline_comment|// MCLK/Loop Clock Control&t;(0x18)
DECL|enumerator|TVPIRSEN
id|TVPIRSEN
op_assign
l_int|0x3a
comma
singleline_comment|// Sense Test&t;&t;&t;(0x00)
DECL|enumerator|TVPIRTMD
id|TVPIRTMD
op_assign
l_int|0x3b
comma
singleline_comment|// Test Mode Data
DECL|enumerator|TVPIRRML
id|TVPIRRML
op_assign
l_int|0x3c
comma
singleline_comment|// CRC Remainder LSB [RO]
DECL|enumerator|TVPIRRMM
id|TVPIRRMM
op_assign
l_int|0x3d
comma
singleline_comment|// CRC Remainder MSB [RO]
DECL|enumerator|TVPIRRMS
id|TVPIRRMS
op_assign
l_int|0x3e
comma
singleline_comment|// CRC  Bit Select [WO] 
DECL|enumerator|TVPIRDID
id|TVPIRDID
op_assign
l_int|0x3f
comma
singleline_comment|// Device ID [RO] &t;&t;(0x30)
DECL|enumerator|TVPIRRES
id|TVPIRRES
op_assign
l_int|0xff
comma
singleline_comment|// Software Reset [WO]
)brace
suffix:semicolon
DECL|struct|initvalues
r_struct
id|initvalues
(brace
DECL|member|addr
DECL|member|value
r_int
r_char
id|addr
comma
id|value
suffix:semicolon
)brace
suffix:semicolon
singleline_comment|// Values which only depend on resolution not on color mode
DECL|struct|tt_single_rmodevals
r_struct
id|tt_single_rmodevals
(brace
DECL|member|hes
r_int
r_int
id|hes
suffix:semicolon
DECL|member|heb
r_int
r_int
id|heb
suffix:semicolon
DECL|member|hsb
r_int
r_int
id|hsb
suffix:semicolon
DECL|member|ht
r_int
r_int
id|ht
suffix:semicolon
DECL|member|ves
r_int
r_int
id|ves
suffix:semicolon
DECL|member|veb
r_int
r_int
id|veb
suffix:semicolon
DECL|member|vsb
r_int
r_int
id|vsb
suffix:semicolon
DECL|member|vt
r_int
r_int
id|vt
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|tvp_single_rmodevals
r_struct
id|tvp_single_rmodevals
(brace
DECL|member|pclk_n
r_int
r_char
id|pclk_n
suffix:semicolon
DECL|member|pclk_m
r_int
r_char
id|pclk_m
suffix:semicolon
DECL|member|pclk_p
r_int
r_char
id|pclk_p
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ibm_single_rmodevals
r_struct
id|ibm_single_rmodevals
(brace
DECL|member|pclk_m
r_int
r_char
id|pclk_m
suffix:semicolon
DECL|member|pclk_n
r_int
r_char
id|pclk_n
suffix:semicolon
DECL|member|pclk_p
r_int
r_char
id|pclk_p
suffix:semicolon
DECL|member|pclk_c
r_int
r_char
id|pclk_c
suffix:semicolon
)brace
suffix:semicolon
singleline_comment|// Values which only depend on color mode not on resolution
DECL|struct|tvp_single_cmodevals
r_struct
id|tvp_single_cmodevals
(brace
DECL|member|tcc
r_int
r_char
id|tcc
suffix:semicolon
singleline_comment|// True Color control
DECL|member|mxc
r_int
r_char
id|mxc
suffix:semicolon
singleline_comment|// Multiplexer control
DECL|member|lckl_n
r_int
r_char
id|lckl_n
suffix:semicolon
singleline_comment|// N value of LCKL PLL
)brace
suffix:semicolon
DECL|struct|ibm_single_cmodevals
r_struct
id|ibm_single_cmodevals
(brace
DECL|member|pformat
r_int
r_char
id|pformat
suffix:semicolon
singleline_comment|// pixel format
)brace
suffix:semicolon
singleline_comment|// Values of the tvp which change depending on colormode x resolution
DECL|struct|tvp_single_crmodevals
r_struct
id|tvp_single_crmodevals
(brace
DECL|member|mlc
r_int
r_char
id|mlc
suffix:semicolon
singleline_comment|// Memory Loop Config 0x39
DECL|member|lckl_p
r_int
r_char
id|lckl_p
suffix:semicolon
singleline_comment|// P value of LCKL PLL
)brace
suffix:semicolon
DECL|struct|ibm_single_crmodevals
r_struct
id|ibm_single_crmodevals
(brace
singleline_comment|// oh nothing changes
)brace
suffix:semicolon
singleline_comment|// complete configuration for a resolution in all depths 
singleline_comment|// 0 = 8 Bit, 15/16 bit = 1 , 32 Bit = 2 
DECL|struct|ims_crmodevals
r_struct
id|ims_crmodevals
(brace
DECL|member|pitch
r_int
id|pitch
suffix:semicolon
DECL|member|tt
r_struct
id|tt_single_rmodevals
id|tt
(braket
l_int|2
)braket
suffix:semicolon
singleline_comment|// for each ramdac  seperate tt config
DECL|member|tvp_clock
r_struct
id|tvp_single_rmodevals
id|tvp_clock
suffix:semicolon
singleline_comment|// for each ramdac  seperate clock config
DECL|member|tvp
r_struct
id|tvp_single_crmodevals
id|tvp
(braket
l_int|3
)braket
suffix:semicolon
singleline_comment|// for each colormode 
DECL|member|ibm_clock
r_struct
id|ibm_single_rmodevals
id|ibm_clock
suffix:semicolon
singleline_comment|// for each ramdac  seperate clock config
singleline_comment|//&t;struct ibm_single_crmodevals ibm[3];&t;   // for each color mode 
)brace
suffix:semicolon
DECL|struct|ims_modevals
r_struct
id|ims_modevals
(brace
DECL|member|dac
r_int
id|dac
suffix:semicolon
singleline_comment|// which dac do we have
DECL|member|total_vram
r_int
id|total_vram
suffix:semicolon
singleline_comment|// how much vram is on board
DECL|member|sense
r_int
id|sense
suffix:semicolon
singleline_comment|// what monitor
DECL|member|fb
r_int
r_char
op_star
id|fb
suffix:semicolon
singleline_comment|// frame buffer address
DECL|member|fb_phys
r_int
r_char
op_star
id|fb_phys
suffix:semicolon
singleline_comment|// frame buffer address
DECL|member|cmap
r_int
r_char
op_star
id|cmap
suffix:semicolon
singleline_comment|// dac address
DECL|member|cmap_phys
r_int
r_char
op_star
id|cmap_phys
suffix:semicolon
singleline_comment|// dac address
DECL|member|dc
r_int
r_int
op_star
id|dc
suffix:semicolon
singleline_comment|// tt address
DECL|member|dc_phys
r_int
r_int
op_star
id|dc_phys
suffix:semicolon
singleline_comment|// tt address
DECL|member|init
r_struct
id|initvalues
op_star
id|init
(braket
l_int|2
)braket
suffix:semicolon
singleline_comment|// initial register settings for each ramdac
DECL|member|mode
r_struct
id|ims_crmodevals
op_star
id|mode
(braket
l_int|20
)braket
suffix:semicolon
singleline_comment|// for each possible mode
DECL|member|tvp
r_struct
id|tvp_single_cmodevals
id|tvp
(braket
l_int|3
)braket
suffix:semicolon
singleline_comment|// for each color mode
DECL|member|ibm
r_struct
id|ibm_single_cmodevals
id|ibm
(braket
l_int|3
)braket
suffix:semicolon
singleline_comment|// for each color mode
)brace
suffix:semicolon
DECL|variable|imsmode_6
r_struct
id|ims_crmodevals
id|imsmode_6
op_assign
(brace
l_int|640
comma
(brace
(brace
l_int|0x08
comma
l_int|0x12
comma
l_int|0x62
comma
l_int|0x6C
comma
l_int|0x0003
comma
l_int|0x002A
comma
l_int|0x020A
comma
l_int|0x020C
)brace
comma
(brace
l_int|0x04
comma
l_int|0x0009
comma
l_int|0x0031
comma
l_int|0x0036
comma
l_int|0x0003
comma
l_int|0x002a
comma
l_int|0x020a
comma
l_int|0x020d
)brace
comma
)brace
comma
(brace
l_int|0xef
comma
l_int|0x2e
comma
l_int|0xb2
)brace
comma
(brace
(brace
l_int|0x39
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x39
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf3
)brace
)brace
comma
singleline_comment|// IBM CLOCK
(brace
l_int|0x78
comma
l_int|0x13
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
)brace
suffix:semicolon
DECL|variable|imsmode_13
r_struct
id|ims_crmodevals
id|imsmode_13
op_assign
(brace
l_int|832
comma
(brace
(brace
l_int|0x05
comma
l_int|0x20
comma
l_int|0x88
comma
l_int|0x90
comma
l_int|0x0003
comma
l_int|0x0028
comma
l_int|0x0298
comma
l_int|0x029B
)brace
comma
(brace
l_int|0x04
comma
l_int|0x0011
comma
l_int|0x0045
comma
l_int|0x0048
comma
l_int|0x0003
comma
l_int|0x002a
comma
l_int|0x029a
comma
l_int|0x029b
)brace
comma
)brace
comma
(brace
l_int|0xfe
comma
l_int|0x3e
comma
l_int|0xf1
)brace
comma
(brace
(brace
l_int|0x39
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf2
)brace
)brace
comma
(brace
l_int|0x3E
comma
l_int|0x0A
comma
l_int|0x01
comma
l_int|0x02
)brace
)brace
suffix:semicolon
DECL|variable|imsmode_17
r_struct
id|ims_crmodevals
id|imsmode_17
op_assign
(brace
l_int|1024
comma
(brace
(brace
l_int|0x0A
comma
l_int|0x1C
comma
l_int|0x9C
comma
l_int|0xA6
comma
l_int|0x0003
comma
l_int|0x0020
comma
l_int|0x0320
comma
l_int|0x0323
)brace
comma
(brace
l_int|0x06
comma
l_int|0x0210
comma
l_int|0x0250
comma
l_int|0x0053
comma
l_int|0x1003
comma
l_int|0x0021
comma
l_int|0x0321
comma
l_int|0x0324
)brace
comma
)brace
comma
(brace
l_int|0xfc
comma
l_int|0x3a
comma
l_int|0xf1
)brace
comma
(brace
(brace
l_int|0x39
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf2
)brace
)brace
comma
(brace
l_int|0x07
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
)brace
)brace
suffix:semicolon
DECL|variable|imsmode_18
r_struct
id|ims_crmodevals
id|imsmode_18
op_assign
(brace
l_int|1152
comma
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0x09
comma
l_int|0x0011
comma
l_int|0x059
comma
l_int|0x5b
comma
l_int|0x0003
comma
l_int|0x0031
comma
l_int|0x0397
comma
l_int|0x039a
)brace
comma
)brace
comma
(brace
l_int|0xfd
comma
l_int|0x3a
comma
l_int|0xf1
)brace
comma
(brace
(brace
l_int|0x39
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf2
)brace
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|imsmode_19
r_struct
id|ims_crmodevals
id|imsmode_19
op_assign
(brace
l_int|1280
comma
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0x09
comma
l_int|0x0016
comma
l_int|0x0066
comma
l_int|0x0069
comma
l_int|0x0003
comma
l_int|0x0027
comma
l_int|0x03e7
comma
l_int|0x03e8
)brace
comma
)brace
comma
(brace
l_int|0xf7
comma
l_int|0x36
comma
l_int|0xf0
)brace
comma
(brace
(brace
l_int|0x38
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf2
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf1
)brace
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|imsmode_20
r_struct
id|ims_crmodevals
id|imsmode_20
op_assign
(brace
l_int|1280
comma
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0x09
comma
l_int|0x0018
comma
l_int|0x0068
comma
l_int|0x006a
comma
l_int|0x0003
comma
l_int|0x0029
comma
l_int|0x0429
comma
l_int|0x042a
)brace
comma
)brace
comma
(brace
l_int|0xf0
comma
l_int|0x2d
comma
l_int|0xf0
)brace
comma
(brace
(brace
l_int|0x38
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf2
)brace
comma
(brace
l_int|0x38
comma
l_int|0xf1
)brace
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
singleline_comment|// IBM RAMDAC initial register values
DECL|variable|ibm_initregs
r_static
r_struct
id|initvalues
id|ibm_initregs
(braket
)braket
op_assign
(brace
(brace
l_int|0x02
comma
l_int|0x21
)brace
comma
multiline_comment|/* (0x01) Miscellaneous Clock Control */
(brace
l_int|0x03
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Sync Control */
(brace
l_int|0x04
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Horizontal Sync Position */
(brace
l_int|0x05
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Power Management */
(brace
l_int|0x06
comma
l_int|0x0B
)brace
comma
multiline_comment|/* (0x02) DAC Operation */
(brace
l_int|0x07
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Palette Control */
(brace
l_int|0x08
comma
l_int|0x01
)brace
comma
multiline_comment|/* (0x01) System Clock Control */
(brace
l_int|0x0B
comma
l_int|0x00
)brace
comma
multiline_comment|/* (U) 8 BPP Control */
(brace
l_int|0x0C
comma
l_int|0xC4
)brace
comma
multiline_comment|/* (U) 16 BPP Control */
(brace
l_int|0x0D
comma
l_int|0x00
)brace
comma
multiline_comment|/* (U) 24 BPP Packed Control */
(brace
l_int|0x0E
comma
l_int|0x03
)brace
comma
multiline_comment|/* (U) 32 BPP Control */
(brace
l_int|0x10
comma
l_int|0x05
)brace
comma
multiline_comment|/* (0x00) Pixel PLL Control 1 */
(brace
l_int|0x11
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Pixel PLL Control 2 */
(brace
l_int|0x15
comma
l_int|0x08
)brace
comma
multiline_comment|/* (0x08) SYSCLK N (System PLL Reference Divider) */
(brace
l_int|0x16
comma
l_int|0x57
)brace
comma
multiline_comment|/* (0x41) SYSCLK M (System PLL VCO Divider) */
(brace
l_int|0x17
comma
l_int|0x00
)brace
comma
multiline_comment|/* (U) SYSCLK P */
(brace
l_int|0x18
comma
l_int|0x00
)brace
comma
multiline_comment|/* (U) SYSCLK C */
(brace
l_int|0x30
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Cursor Control */
(brace
l_int|0x60
comma
l_int|0xFF
)brace
comma
multiline_comment|/* (U) Border Color Red */
(brace
l_int|0x61
comma
l_int|0xFF
)brace
comma
multiline_comment|/* (U) Border Color Green */
(brace
l_int|0x62
comma
l_int|0xFF
)brace
comma
multiline_comment|/* (U) Border Color Blue */
(brace
l_int|0x70
comma
l_int|0x01
)brace
comma
multiline_comment|/* (0x00) Miscellaneous Control 1 */
(brace
l_int|0x71
comma
l_int|0x45
)brace
comma
multiline_comment|/* (0x00) Miscellaneous Control 2 */
(brace
l_int|0x72
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Miscellaneous Control 3 */
(brace
l_int|0x78
comma
l_int|0x00
)brace
comma
multiline_comment|/* (0x00) Key Control/DB Operation */
(brace
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
DECL|variable|tvp_initregs
r_static
r_struct
id|initvalues
id|tvp_initregs
(braket
)braket
op_assign
(brace
(brace
l_int|0x6
comma
l_int|0x00
)brace
comma
(brace
l_int|0x7
comma
l_int|0xe4
)brace
comma
(brace
l_int|0xf
comma
l_int|0x06
)brace
comma
(brace
l_int|0x18
comma
l_int|0x80
)brace
comma
(brace
l_int|0x19
comma
l_int|0x4d
)brace
comma
(brace
l_int|0x1a
comma
l_int|0x05
)brace
comma
(brace
l_int|0x1c
comma
l_int|0x00
)brace
comma
(brace
l_int|0x1d
comma
l_int|0x00
)brace
comma
(brace
l_int|0x1e
comma
l_int|0x08
)brace
comma
(brace
l_int|0x30
comma
l_int|0xff
)brace
comma
(brace
l_int|0x31
comma
l_int|0xff
)brace
comma
(brace
l_int|0x32
comma
l_int|0xff
)brace
comma
(brace
l_int|0x33
comma
l_int|0xff
)brace
comma
(brace
l_int|0x34
comma
l_int|0xff
)brace
comma
(brace
l_int|0x35
comma
l_int|0xff
)brace
comma
(brace
l_int|0x36
comma
l_int|0xff
)brace
comma
(brace
l_int|0x37
comma
l_int|0xff
)brace
comma
(brace
l_int|0x38
comma
l_int|0x00
)brace
comma
(brace
id|TVPIRPLA
comma
l_int|0x00
)brace
comma
(brace
id|TVPIRPPD
comma
l_int|0xc0
)brace
comma
(brace
id|TVPIRPPD
comma
l_int|0xd5
)brace
comma
(brace
id|TVPIRPPD
comma
l_int|0xea
)brace
comma
(brace
id|TVPIRPLA
comma
l_int|0x00
)brace
comma
(brace
id|TVPIRMPD
comma
l_int|0xb9
)brace
comma
(brace
id|TVPIRMPD
comma
l_int|0x3a
)brace
comma
(brace
id|TVPIRMPD
comma
l_int|0xb1
)brace
comma
(brace
id|TVPIRPLA
comma
l_int|0x00
)brace
comma
(brace
id|TVPIRLPD
comma
l_int|0xc1
)brace
comma
(brace
id|TVPIRLPD
comma
l_int|0x3d
)brace
comma
(brace
id|TVPIRLPD
comma
l_int|0xf3
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
DECL|variable|ims_info
r_static
r_struct
id|ims_modevals
id|ims_info
op_assign
(brace
op_minus
l_int|1
comma
singleline_comment|// DAC
op_minus
l_int|1
comma
singleline_comment|// VRAM
op_minus
l_int|1
comma
singleline_comment|// Monitor;
l_int|0
comma
singleline_comment|// Framebuffer
l_int|0
comma
singleline_comment|// Framebuffer_phys
l_int|0
comma
singleline_comment|// colormap
l_int|0
comma
singleline_comment|// colormap_phys
l_int|0
comma
singleline_comment|// dc
l_int|0
comma
singleline_comment|// dc_phys
(brace
id|ibm_initregs
comma
id|tvp_initregs
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|imsmode_6
comma
op_amp
id|imsmode_6
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|imsmode_13
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|imsmode_17
comma
op_amp
id|imsmode_18
comma
op_amp
id|imsmode_19
comma
op_amp
id|imsmode_20
)brace
comma
(brace
(brace
l_int|0x80
comma
l_int|0x4d
comma
l_int|0xc1
)brace
comma
(brace
l_int|0x44
comma
l_int|0x55
comma
l_int|0xe1
)brace
comma
(brace
l_int|0x46
comma
l_int|0x5d
comma
l_int|0xf1
)brace
)brace
comma
(brace
(brace
l_int|0x03
)brace
comma
(brace
l_int|0x04
)brace
comma
(brace
l_int|0x06
)brace
)brace
)brace
suffix:semicolon
singleline_comment|// static void set_imstt_clock(unsigned char *params);
r_static
r_void
id|map_imstt_display
c_func
(paren
r_struct
id|device_node
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|read_imstt_sense
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|imstt_vram_reqd
c_func
(paren
r_int
id|vmode
comma
r_int
id|cmode
)paren
suffix:semicolon
id|__openfirmware
macro_line|#if 0
r_static
r_int
id|get_tvp_ireg
c_func
(paren
r_int
id|iaddr
)paren
(brace
id|ims_info.cmap
(braket
l_int|0
)braket
op_assign
id|iaddr
op_amp
l_int|0xff
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
r_return
id|ims_info.cmap
(braket
l_int|40
)braket
suffix:semicolon
)brace
macro_line|#endif
DECL|function|set_tvp_ireg
r_static
r_void
id|set_tvp_ireg
c_func
(paren
r_int
id|iaddr
comma
r_int
r_char
id|value
)paren
(brace
id|ims_info.cmap
(braket
l_int|0
)braket
op_assign
id|iaddr
op_amp
l_int|0xff
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
l_int|40
)braket
op_assign
id|value
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the monitor sense value.&n; * Note that this can be called before calibrate_delay,&n; * so we can&squot;t use udelay.&n; */
r_static
r_int
DECL|function|read_imstt_sense
id|read_imstt_sense
c_func
(paren
)paren
(brace
macro_line|#if 0
r_int
id|sense
suffix:semicolon
r_int
id|gio
comma
id|gioe
suffix:semicolon
id|gio
op_assign
id|ld_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIO
)paren
op_amp
op_complement
l_int|0x0038
suffix:semicolon
id|gioe
op_assign
id|ld_le32
(paren
id|dc_
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* drive all lines high */
id|__delay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
l_int|077
)paren
suffix:semicolon
multiline_comment|/* turn off drivers */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|sense
op_assign
(paren
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
)paren
op_amp
l_int|0x1c0
)paren
op_lshift
l_int|2
suffix:semicolon
multiline_comment|/* drive each sense line low in turn and collect the other 2 */
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
l_int|033
)paren
suffix:semicolon
multiline_comment|/* drive A low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
)paren
op_amp
l_int|0xc0
)paren
op_rshift
l_int|2
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
l_int|055
)paren
suffix:semicolon
multiline_comment|/* drive B low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
(paren
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
)paren
op_amp
l_int|0x40
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
l_int|066
)paren
suffix:semicolon
multiline_comment|/* drive C low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
)paren
op_amp
l_int|0x180
)paren
op_rshift
l_int|7
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|GIOE
comma
l_int|077
)paren
suffix:semicolon
multiline_comment|/* turn off drivers */
r_return
id|sense
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|function|imstt_vram_reqd
r_static
r_inline
r_int
id|imstt_vram_reqd
c_func
(paren
r_int
id|vmode
comma
r_int
id|cmode
)paren
(brace
r_return
id|vmode_attrs
(braket
id|vmode
op_minus
l_int|1
)braket
dot
id|vres
op_star
(paren
id|ims_info.mode
(braket
id|vmode
op_minus
l_int|1
)braket
)paren
op_member_access_from_pointer
id|pitch
op_star
(paren
l_int|1
op_lshift
id|cmode
)paren
suffix:semicolon
)brace
r_void
DECL|function|map_imstt_display_tvp
id|map_imstt_display_tvp
c_func
(paren
r_struct
id|device_node
op_star
id|dp
)paren
(brace
id|map_imstt_display
c_func
(paren
id|dp
comma
l_int|1
)paren
suffix:semicolon
)brace
r_void
DECL|function|map_imstt_display_ibm
id|map_imstt_display_ibm
c_func
(paren
r_struct
id|device_node
op_star
id|dp
)paren
(brace
id|map_imstt_display
c_func
(paren
id|dp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|map_imstt_display
id|map_imstt_display
c_func
(paren
r_struct
id|device_node
op_star
id|dp
comma
r_int
id|which
)paren
(brace
r_int
id|i
comma
id|sense
suffix:semicolon
r_int
r_int
id|addr
comma
id|size
comma
id|tmp
suffix:semicolon
r_int
r_char
id|bus
comma
id|devfn
suffix:semicolon
r_int
r_int
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|dp-&gt;next
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;Warning: only using first imstt display device&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;pmac_display_init: node = %p, addrs =&quot;
comma
id|dp-&gt;node
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dp-&gt;n_addrs
suffix:semicolon
op_increment
id|i
)paren
id|printk
c_func
(paren
l_string|&quot; %x(%x)&quot;
comma
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|address
comma
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, intrs =&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dp-&gt;n_intrs
suffix:semicolon
op_increment
id|i
)paren
id|printk
c_func
(paren
l_string|&quot; %x&quot;
comma
id|dp-&gt;intrs
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Map in frame buffer and registers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dp-&gt;n_addrs
suffix:semicolon
op_increment
id|i
)paren
(brace
id|addr
op_assign
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|address
suffix:semicolon
id|size
op_assign
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|size
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
l_int|0x02000000
)paren
(brace
id|ims_info.fb
op_assign
id|__ioremap
c_func
(paren
id|addr
comma
id|size
comma
id|_PAGE_NO_CACHE
)paren
suffix:semicolon
id|ims_info.fb_phys
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
id|ims_info.dc
op_assign
(paren
r_int
op_star
)paren
(paren
id|ims_info.fb
op_plus
l_int|0x00800000
)paren
suffix:semicolon
id|ims_info.dc_phys
op_assign
(paren
r_int
op_star
)paren
(paren
id|ims_info.fb_phys
op_plus
l_int|0x00800000
)paren
suffix:semicolon
id|ims_info.cmap
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|ims_info.fb
op_plus
l_int|0x00840000
)paren
suffix:semicolon
id|ims_info.cmap_phys
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|ims_info.fb_phys
op_plus
l_int|0x00840000
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mapped ims_info.fb=%x(%x)&quot;
comma
(paren
r_int
)paren
id|ims_info.fb
comma
(paren
r_int
)paren
id|size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; ims_info.dc=%x, ims_info.cmap=%x&bslash;n&quot;
comma
(paren
r_int
)paren
id|ims_info.dc
comma
(paren
r_int
)paren
id|ims_info.cmap
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* enable memory-space accesses using config-space command register */
r_if
c_cond
(paren
id|pci_device_loc
c_func
(paren
id|dp
comma
op_amp
id|bus
comma
op_amp
id|devfn
)paren
op_eq
l_int|0
)paren
(brace
id|pcibios_read_config_word
c_func
(paren
id|bus
comma
id|devfn
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;command word 0x%04X&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
l_int|0xffff
)paren
(brace
id|cmd
op_or_assign
id|PCI_COMMAND_MEMORY
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
id|bus
comma
id|devfn
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;unable to find pci device&bslash;n&quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|SSTATUS
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;chip version %ld, &quot;
comma
(paren
id|tmp
op_amp
l_int|0x0F00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|tmp
op_assign
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|PRC
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|which
)paren
id|ims_info.total_vram
op_assign
(paren
id|tmp
op_amp
l_int|0x0004
)paren
ques
c_cond
l_int|0x000400000L
suffix:colon
l_int|0x000200000L
suffix:semicolon
r_else
id|ims_info.total_vram
op_assign
l_int|0x000800000L
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;VRAM size %ldM&bslash;n&quot;
comma
id|ims_info.total_vram
op_div
l_int|0x000100000L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ims_info.total_vram
op_eq
l_int|0x000800000L
)paren
(brace
id|ims_info.dac
op_assign
id|TVPRAMDAC
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Selecting TVP 3030 RAMDAC&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ims_info.dac
op_assign
id|IBMRAMDAC
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Selecting  IBM RAMDAC&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sense
op_assign
id|read_imstt_sense
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Monitor sense value = 0x%x, &quot;
comma
id|sense
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|video_mode
op_eq
id|VMODE_NVRAM
)paren
(brace
id|video_mode
op_assign
id|nvram_read_byte
c_func
(paren
id|NV_VMODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_mode
op_le
l_int|0
op_logical_or
id|video_mode
OG
id|VMODE_MAX
op_logical_or
id|imstt_reg_init
(braket
id|video_mode
op_minus
l_int|1
)braket
op_eq
l_int|0
)paren
id|video_mode
op_assign
id|VMODE_CHOOSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|video_mode
op_eq
id|VMODE_CHOOSE
)paren
id|video_mode
op_assign
id|map_monitor_sense
c_func
(paren
id|sense
)paren
suffix:semicolon
r_if
c_cond
(paren
id|imstt_reg_init
(braket
id|video_mode
op_minus
l_int|1
)braket
op_eq
l_int|0
)paren
id|video_mode
op_assign
id|VMODE_640_480_67
suffix:semicolon
multiline_comment|/*&n;&t; * Reduce the pixel size if we don&squot;t have enough VRAM.&n;&t; */
r_if
c_cond
(paren
id|color_mode
op_eq
id|CMODE_NVRAM
)paren
id|color_mode
op_assign
id|nvram_read_byte
c_func
(paren
id|NV_CMODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|color_mode
template_param
id|CMODE_32
)paren
id|color_mode
op_assign
id|CMODE_8
suffix:semicolon
r_while
c_loop
(paren
id|color_mode
OG
id|CMODE_8
op_logical_and
id|imstt_vram_reqd
c_func
(paren
id|video_mode
comma
id|color_mode
)paren
OG
id|ims_info.total_vram
)paren
op_decrement
id|color_mode
suffix:semicolon
macro_line|#endif
singleline_comment|// Hack Hack Hack !!!
id|video_mode
op_assign
id|VMODE_640_480_67
suffix:semicolon
id|color_mode
op_assign
id|CMODE_8
suffix:semicolon
)brace
multiline_comment|/*&n; * We dont need it ( all is done in ims_init )&n;static void&n;set_imstt_clock_tvp(char* tvprv)&n;{&n;  int j;&n;  for (j=0;j&lt;3;j++)&n;&t;{&n;  &t;&t;set_tvp_ireg(TVPIRPLA,(j &lt;&lt; 4) | (j &lt;&lt; 2) | j); // Select same value for all plls&n;&t;&t;set_tvp_ireg(TVPIRPPD,tvprv[j]);&n;&t;&t;set_tvp_ireg(TVPIRMPD,tvprv[3+j]);&n;&t;&t;set_tvp_ireg(TVPIRLPD,tvprv[6+j]);&n;&t;}&n;}&n;&n;static void&n;set_imstt_clock_ibm(unsigned char *params)&n;{&n;  ims_info.cmap[PIDXHI] = 0; eieio();&n;  ims_info.cmap[PIDXLO] = PM0; eieio();&n;  ims_info.cmap[PIDXDATA] = params[0]; eieio();&n;&n;  ims_info.cmap[PIDXLO] = PN0; eieio();&n;  ims_info.cmap[PIDXDATA] = params[1]; eieio();&n;&n;  ims_info.cmap[PIDXLO] = PP0; eieio();&n;  ims_info.cmap[PIDXDATA] = params[2]; eieio();&n;&t;&n;  ims_info.cmap[PIDXLO] = PC0; eieio();&n;  ims_info.cmap[PIDXDATA] = params[3]; eieio();&n;}&n;*/
r_void
DECL|function|imstt_init
id|imstt_init
c_func
(paren
)paren
(brace
r_int
id|i
comma
id|yoff
comma
id|hres
suffix:semicolon
r_int
r_int
id|ctl
comma
id|pitch
comma
id|tmp
comma
id|scrCmode
suffix:semicolon
r_struct
id|ims_crmodevals
op_star
id|init
suffix:semicolon
r_if
c_cond
(paren
id|video_mode
op_le
l_int|0
op_logical_or
id|video_mode
OG
id|VMODE_MAX
)paren
id|panic
c_func
(paren
l_string|&quot;imstt: display mode %d not supported(not in valid range)&quot;
comma
id|video_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|init
op_assign
id|ims_info.mode
(braket
id|video_mode
op_minus
l_int|1
)braket
)paren
op_eq
l_int|0
)paren
id|panic
c_func
(paren
l_string|&quot;imstt: display mode %d not supported(no mode definition)&quot;
comma
id|video_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|vt
op_eq
l_int|0
)paren
id|panic
c_func
(paren
l_string|&quot;imstt: display mode %d not supported (no timing definition)&quot;
comma
id|video_mode
)paren
suffix:semicolon
id|n_scanlines
op_assign
id|vmode_attrs
(braket
id|video_mode
op_minus
l_int|1
)braket
dot
id|vres
suffix:semicolon
id|hres
op_assign
id|vmode_attrs
(braket
id|video_mode
op_minus
l_int|1
)braket
dot
id|hres
suffix:semicolon
id|pixel_size
op_assign
l_int|1
op_lshift
id|color_mode
suffix:semicolon
id|line_pitch
op_assign
id|init-&gt;pitch
op_star
id|pixel_size
suffix:semicolon
id|row_pitch
op_assign
id|line_pitch
op_star
l_int|16
suffix:semicolon
multiline_comment|/* initialize the card */
id|tmp
op_assign
id|in_le32
c_func
(paren
id|ims_info.dc
op_plus
id|STGCTL
)paren
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|STGCTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
macro_line|#if 0
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|SCR
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|ims_info.dac
)paren
(brace
r_case
id|IBMRAMDAC
suffix:colon
id|ims_info.cmap
(braket
id|PPMASK
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXHI
)braket
op_assign
l_int|0x00
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|ims_info.init
(braket
id|IBMRAMDAC
)braket
(braket
id|i
)braket
dot
id|addr
op_ne
l_int|0
op_logical_and
id|ims_info.init
(braket
id|IBMRAMDAC
)braket
(braket
id|i
)braket
dot
id|value
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|ims_info.init
(braket
id|IBMRAMDAC
)braket
(braket
id|i
)braket
dot
id|addr
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|ims_info.init
(braket
id|IBMRAMDAC
)braket
(braket
id|i
)braket
dot
id|value
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
id|ims_info.cmap
(braket
id|PIDXHI
)braket
op_assign
l_int|0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|PM0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|init-&gt;ibm_clock.pclk_m
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|PN0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|init-&gt;ibm_clock.pclk_n
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|PP0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|init-&gt;ibm_clock.pclk_p
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|PC0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|init-&gt;ibm_clock.pclk_c
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXLO
)braket
op_assign
id|PPIXREP
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PIDXDATA
)braket
op_assign
id|ims_info.ibm
(braket
id|color_mode
)braket
dot
id|pformat
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TVPRAMDAC
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|ims_info.init
(braket
id|TVPRAMDAC
)braket
(braket
id|i
)braket
dot
id|addr
op_ne
l_int|0
op_logical_and
id|ims_info.init
(braket
id|TVPRAMDAC
)braket
(braket
id|i
)braket
dot
id|value
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|set_tvp_ireg
c_func
(paren
id|ims_info.init
(braket
id|TVPRAMDAC
)braket
(braket
id|i
)braket
dot
id|addr
comma
id|ims_info.init
(braket
id|TVPRAMDAC
)braket
(braket
id|i
)braket
dot
id|value
)paren
suffix:semicolon
)brace
id|set_tvp_ireg
c_func
(paren
id|TVPIRPLA
comma
l_int|0x00
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPPD
comma
id|init-&gt;tvp_clock.pclk_n
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPPD
comma
id|init-&gt;tvp_clock.pclk_m
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPPD
comma
id|init-&gt;tvp_clock.pclk_p
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRTCC
comma
id|ims_info.tvp
(braket
id|color_mode
)braket
dot
id|tcc
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRMXC
comma
id|ims_info.tvp
(braket
id|color_mode
)braket
dot
id|mxc
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPLA
comma
l_int|0x00
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRLPD
comma
id|ims_info.tvp
(braket
id|color_mode
)braket
dot
id|lckl_n
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPLA
comma
l_int|0x15
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRMLC
comma
(paren
id|init-&gt;tvp
(braket
id|color_mode
)braket
)paren
dot
id|mlc
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRPLA
comma
l_int|0x2a
)paren
suffix:semicolon
id|set_tvp_ireg
c_func
(paren
id|TVPIRLPD
comma
id|init-&gt;tvp
(braket
id|color_mode
)braket
dot
id|lckl_p
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|color_mode
)paren
(brace
r_case
id|CMODE_32
suffix:colon
id|ctl
op_assign
l_int|0x1785
suffix:semicolon
id|pitch
op_assign
id|init-&gt;pitch
suffix:semicolon
id|scrCmode
op_assign
l_int|0x300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMODE_16
suffix:colon
id|ctl
op_assign
l_int|0x1783
suffix:semicolon
id|pitch
op_assign
id|init-&gt;pitch
op_div
l_int|2
suffix:semicolon
id|scrCmode
op_assign
l_int|0x100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMODE_8
suffix:colon
r_default
suffix:colon
id|ctl
op_assign
l_int|0x1781
suffix:semicolon
id|pitch
op_assign
id|init-&gt;pitch
op_div
l_int|4
suffix:semicolon
id|scrCmode
op_assign
l_int|0x000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HES
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|hes
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HEB
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|heb
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HSB
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|hsb
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HT
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|ht
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VES
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|ves
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VEB
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|veb
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VSB
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|vsb
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VT
)braket
comma
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|vt
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HCIV
)braket
comma
l_int|1
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VCIV
)braket
comma
l_int|1
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|TCDR
)braket
comma
l_int|4
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|VIL
)braket
comma
l_int|0
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SSR
)braket
comma
l_int|0
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|HRIR
)braket
comma
l_int|0x0200
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|CMR
)braket
comma
l_int|0x01FF
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SRGCTL
)braket
comma
l_int|0x0003
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ims_info.total_vram
)paren
(brace
r_case
l_int|0x000200000
suffix:colon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SCR
)braket
comma
l_int|0x0059D
op_or
id|scrCmode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x000400000
suffix:colon
id|pitch
op_div_assign
l_int|2
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SCR
)braket
comma
l_int|0x00D0DC
op_or
id|scrCmode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x000800000
suffix:colon
id|pitch
op_div_assign
l_int|2
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SCR
)braket
comma
l_int|0x0150DD
op_or
id|scrCmode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|SPR
)braket
comma
id|pitch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ims_info.dac
op_eq
id|IBMRAMDAC
)paren
(brace
)brace
id|pmac_init_palette
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialize colormap */
id|out_le32
c_func
(paren
op_amp
id|ims_info.dc
(braket
id|STGCTL
)braket
comma
id|ctl
)paren
suffix:semicolon
id|yoff
op_assign
(paren
id|n_scanlines
op_mod
l_int|16
)paren
op_div
l_int|2
suffix:semicolon
id|fb_start
op_assign
id|ims_info.fb
op_plus
id|yoff
op_star
id|line_pitch
suffix:semicolon
multiline_comment|/* Clear screen */
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|ims_info.fb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|n_scanlines
op_star
id|line_pitch
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
)brace
id|display_info.height
op_assign
id|n_scanlines
suffix:semicolon
id|display_info.width
op_assign
id|hres
suffix:semicolon
id|display_info.depth
op_assign
id|pixel_size
op_star
l_int|8
suffix:semicolon
id|display_info.pitch
op_assign
id|line_pitch
suffix:semicolon
id|display_info.mode
op_assign
id|video_mode
suffix:semicolon
r_if
c_cond
(paren
id|ims_info.dac
op_eq
id|IBMRAMDAC
)paren
id|strncpy
c_func
(paren
id|display_info.name
comma
l_string|&quot;IMS,tt128mb2/4&quot;
comma
r_sizeof
(paren
id|display_info.name
)paren
)paren
suffix:semicolon
r_else
id|strncpy
c_func
(paren
id|display_info.name
comma
l_string|&quot;IMS,tt128mb8/8A&quot;
comma
r_sizeof
(paren
id|display_info.name
)paren
)paren
suffix:semicolon
id|display_info.fb_address
op_assign
(paren
r_int
r_int
)paren
id|ims_info.fb_phys
suffix:semicolon
id|display_info.cmap_adr_address
op_assign
(paren
r_int
r_int
)paren
op_amp
id|ims_info.cmap_phys
(braket
id|PADDRW
)braket
suffix:semicolon
id|display_info.cmap_data_address
op_assign
(paren
r_int
r_int
)paren
op_amp
id|ims_info.cmap_phys
(braket
id|PDATA
)braket
suffix:semicolon
id|display_info.disp_reg_address
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
)brace
r_int
DECL|function|imstt_setmode
id|imstt_setmode
c_func
(paren
r_struct
id|vc_mode
op_star
id|mode
comma
r_int
id|doit
)paren
(brace
r_int
id|cmode
suffix:semicolon
r_struct
id|ims_crmodevals
op_star
id|init
suffix:semicolon
r_if
c_cond
(paren
id|video_mode
op_le
l_int|0
op_logical_or
id|video_mode
OG
id|VMODE_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|init
op_assign
id|ims_info.mode
(braket
id|video_mode
op_minus
l_int|1
)braket
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|init-&gt;tt
(braket
id|ims_info.dac
)braket
dot
id|vt
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mode-&gt;mode
op_le
l_int|0
op_logical_or
id|mode-&gt;mode
OG
id|VMODE_MAX
op_logical_or
(paren
id|ims_info.mode
(braket
id|mode-&gt;mode
op_minus
l_int|1
)braket
op_eq
l_int|0
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|mode-&gt;depth
)paren
(brace
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|cmode
op_assign
id|CMODE_32
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|cmode
op_assign
id|CMODE_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_case
l_int|0
suffix:colon
multiline_comment|/* (default) */
id|cmode
op_assign
id|CMODE_8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|imstt_vram_reqd
c_func
(paren
id|mode-&gt;mode
comma
id|cmode
)paren
OG
id|ims_info.total_vram
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|doit
)paren
(brace
id|video_mode
op_assign
id|mode-&gt;mode
suffix:semicolon
id|color_mode
op_assign
id|cmode
suffix:semicolon
id|imstt_init
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|// set palette for TI TVP3030 ramdac (used on 8MB version)
r_void
DECL|function|imstt_set_palette_tvp
id|imstt_set_palette_tvp
c_func
(paren
r_int
r_char
id|red
(braket
)braket
comma
r_int
r_char
id|green
(braket
)braket
comma
r_int
r_char
id|blue
(braket
)braket
comma
r_int
id|index
comma
r_int
id|ncolors
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ncolors
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ims_info.cmap
(braket
id|TVPADDRW
)braket
op_assign
id|index
op_plus
id|i
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|TVPPDATA
)braket
op_assign
id|red
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|TVPPDATA
)braket
op_assign
id|green
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|TVPPDATA
)braket
op_assign
id|blue
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// set palette for IBM ramdac (used on 2MB/4MB version)
r_void
DECL|function|imstt_set_palette_ibm
id|imstt_set_palette_ibm
c_func
(paren
r_int
r_char
id|red
(braket
)braket
comma
r_int
r_char
id|green
(braket
)braket
comma
r_int
r_char
id|blue
(braket
)braket
comma
r_int
id|index
comma
r_int
id|ncolors
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ncolors
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ims_info.cmap
(braket
id|PADDRW
)braket
op_assign
id|index
op_plus
id|i
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PDATA
)braket
op_assign
id|red
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PDATA
)braket
op_assign
id|green
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|ims_info.cmap
(braket
id|PDATA
)braket
op_assign
id|blue
(braket
id|i
)braket
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|imstt_set_blanking
id|imstt_set_blanking
c_func
(paren
r_int
id|blank_mode
)paren
(brace
r_int
id|ctrl
suffix:semicolon
id|ctrl
op_assign
id|ld_le32
c_func
(paren
id|ims_info.dc
op_plus
id|STGCTL
)paren
op_or
l_int|0x0030
suffix:semicolon
r_if
c_cond
(paren
id|blank_mode
op_amp
id|VESA_VSYNC_SUSPEND
)paren
id|ctrl
op_and_assign
op_complement
l_int|0x0020
suffix:semicolon
r_if
c_cond
(paren
id|blank_mode
op_amp
id|VESA_HSYNC_SUSPEND
)paren
id|ctrl
op_and_assign
op_complement
l_int|0x0010
suffix:semicolon
id|out_le32
c_func
(paren
id|ims_info.dc
op_plus
id|STGCTL
comma
id|ctrl
)paren
suffix:semicolon
)brace
eof
