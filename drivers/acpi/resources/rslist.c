multiline_comment|/*******************************************************************************&n; *&n; * Module Name: rslist - Acpi_rs_byte_stream_to_list&n; *                       Acpi_list_to_byte_stream&n; *              $Revision: 8 $&n; *&n; ******************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000 R. Byron Moore&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;acpi.h&quot;
macro_line|#include &quot;acresrc.h&quot;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          RESOURCE_MANAGER
id|MODULE_NAME
(paren
l_string|&quot;rslist&quot;
)paren
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_rs_byte_stream_to_list&n; *&n; * PARAMETERS:  Byte_stream_buffer      - Pointer to the resource byte stream&n; *              Byte_stream_buffer_length - Length of Byte_stream_buffer&n; *              Output_buffer           - Pointer to the buffer that will&n; *                                          contain the output structures&n; *&n; * RETURN:      Status  AE_OK if okay, else a valid ACPI_STATUS code&n; *&n; * DESCRIPTION: Takes the resource byte stream and parses it, creating a&n; *              linked list of resources in the caller&squot;s output buffer&n; *&n; ******************************************************************************/
id|ACPI_STATUS
DECL|function|acpi_rs_byte_stream_to_list
id|acpi_rs_byte_stream_to_list
(paren
id|u8
op_star
id|byte_stream_buffer
comma
id|u32
id|byte_stream_buffer_length
comma
id|u8
op_star
op_star
id|output_buffer
)paren
(brace
id|ACPI_STATUS
id|status
suffix:semicolon
id|u32
id|bytes_parsed
op_assign
l_int|0
suffix:semicolon
id|u8
id|resource_type
op_assign
l_int|0
suffix:semicolon
id|u32
id|bytes_consumed
op_assign
l_int|0
suffix:semicolon
id|u8
op_star
op_star
id|buffer
op_assign
id|output_buffer
suffix:semicolon
id|u32
id|structure_size
op_assign
l_int|0
suffix:semicolon
id|u8
id|end_tag_processed
op_assign
id|FALSE
suffix:semicolon
r_while
c_loop
(paren
id|bytes_parsed
OL
id|byte_stream_buffer_length
op_logical_and
id|FALSE
op_eq
id|end_tag_processed
)paren
(brace
multiline_comment|/*&n;&t;&t; * Look at the next byte in the stream&n;&t;&t; */
id|resource_type
op_assign
op_star
id|byte_stream_buffer
suffix:semicolon
multiline_comment|/*&n;&t;&t; * See if this is a small or large resource&n;&t;&t; */
r_if
c_cond
(paren
id|resource_type
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Large Resource Type&n;&t;&t;&t; */
r_switch
c_cond
(paren
id|resource_type
)paren
(brace
r_case
id|MEMORY_RANGE_24
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * 24-Bit Memory Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_memory24_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_VENDOR_DEFINED
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Vendor Defined Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_vendor_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEMORY_RANGE_32
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * 32-Bit Memory Range Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_memory32_range_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIXED_MEMORY_RANGE_32
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * 32-Bit Fixed Memory Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_fixed_memory32_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DWORD_ADDRESS_SPACE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * 32-Bit Address Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_address32_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WORD_ADDRESS_SPACE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * 16-Bit Address Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_address16_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXTENDED_IRQ
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Extended IRQ&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_extended_irq_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* TBD: [Future] 64-bit not currently supported */
multiline_comment|/*&n;&t;&t;&t;case 0x8A:&n;&t;&t;&t;&t;break;&n;*/
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * If we get here, everything is out of sync,&n;&t;&t;&t;&t; *  so exit with an error&n;&t;&t;&t;&t; */
r_return
(paren
id|AE_AML_ERROR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * Small Resource Type&n;&t;&t;&t; *  Only bits 7:3 are valid&n;&t;&t;&t; */
id|resource_type
op_rshift_assign
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|resource_type
)paren
(brace
r_case
id|IRQ_FORMAT
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * IRQ Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_irq_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_FORMAT
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * DMA Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_dma_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|START_DEPENDENT_TAG
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Start Dependent Functions Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_start_dependent_functions_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|END_DEPENDENT_TAG
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * End Dependent Functions Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_end_dependent_functions_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IO_PORT_DESCRIPTOR
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * IO Port Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_io_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIXED_LOCATION_IO_DESCRIPTOR
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Fixed IO Port Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_fixed_io_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_VENDOR_DEFINED
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Vendor Specific Resource&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_vendor_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|END_TAG
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * End Tag&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_end_tag_resource
c_func
(paren
id|byte_stream_buffer
comma
op_amp
id|bytes_consumed
comma
id|buffer
comma
op_amp
id|structure_size
)paren
suffix:semicolon
id|end_tag_processed
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * If we get here, everything is out of sync,&n;&t;&t;&t;&t; *  so exit with an error&n;&t;&t;&t;&t; */
r_return
(paren
id|AE_AML_ERROR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch */
)brace
multiline_comment|/* end else */
multiline_comment|/*&n;&t;&t; * Update the return value and counter&n;&t;&t; */
id|bytes_parsed
op_add_assign
id|bytes_consumed
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Set the byte stream to point to the next resource&n;&t;&t; */
id|byte_stream_buffer
op_add_assign
id|bytes_consumed
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Set the Buffer to the next structure&n;&t;&t; */
op_star
id|buffer
op_add_assign
id|structure_size
suffix:semicolon
)brace
multiline_comment|/*  end while */
multiline_comment|/*&n;&t; * Check the reason for exiting the while loop&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|byte_stream_buffer_length
op_eq
id|bytes_parsed
)paren
op_logical_or
(paren
id|TRUE
op_ne
id|end_tag_processed
)paren
)paren
(brace
r_return
(paren
id|AE_AML_ERROR
)paren
suffix:semicolon
)brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_rs_list_to_byte_stream&n; *&n; * PARAMETERS:  Linked_list             - Pointer to the resource linked list&n; *              Byte_steam_size_needed  - Calculated size of the byte stream&n; *                                          needed from calling&n; *                                          Acpi_rs_calculate_byte_stream_length()&n; *                                          The size of the Output_buffer is&n; *                                          guaranteed to be &gt;=&n; *                                          Byte_stream_size_needed&n; *              Output_buffer           - Pointer to the buffer that will&n; *                                          contain the byte stream&n; *&n; * RETURN:      Status  AE_OK if okay, else a valid ACPI_STATUS code&n; *&n; * DESCRIPTION: Takes the resource linked list and parses it, creating a&n; *              byte stream of resources in the caller&squot;s output buffer&n; *&n; ******************************************************************************/
id|ACPI_STATUS
DECL|function|acpi_rs_list_to_byte_stream
id|acpi_rs_list_to_byte_stream
(paren
id|RESOURCE
op_star
id|linked_list
comma
id|u32
id|byte_stream_size_needed
comma
id|u8
op_star
op_star
id|output_buffer
)paren
(brace
id|ACPI_STATUS
id|status
suffix:semicolon
id|u8
op_star
id|buffer
op_assign
op_star
id|output_buffer
suffix:semicolon
id|u32
id|bytes_consumed
op_assign
l_int|0
suffix:semicolon
id|u8
id|done
op_assign
id|FALSE
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|done
)paren
(brace
r_switch
c_cond
(paren
id|linked_list-&gt;id
)paren
(brace
r_case
id|irq
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * IRQ Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_irq_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|dma
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * DMA Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_dma_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|start_dependent_functions
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Start Dependent Functions Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_start_dependent_functions_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|end_dependent_functions
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * End Dependent Functions Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_end_dependent_functions_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|io
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * IO Port Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_io_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|fixed_io
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Fixed IO Port Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_fixed_io_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|vendor_specific
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Vendor Defined Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_vendor_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|end_tag
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * End Tag&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_end_tag_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * An End Tag indicates the end of the Resource Template&n;&t;&t;&t; */
id|done
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|memory24
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * 24-Bit Memory Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_memory24_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|memory32
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * 32-Bit Memory Range Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_memory32_range_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|fixed_memory32
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * 32-Bit Fixed Memory Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_fixed_memory32_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|address16
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * 16-Bit Address Descriptor Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_address16_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|address32
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * 32-Bit Address Descriptor Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_address32_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|extended_irq
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Extended IRQ Resource&n;&t;&t;&t; */
id|status
op_assign
id|acpi_rs_extended_irq_stream
(paren
id|linked_list
comma
op_amp
id|buffer
comma
op_amp
id|bytes_consumed
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * If we get here, everything is out of sync,&n;&t;&t;&t; *  so exit with an error&n;&t;&t;&t; */
r_return
(paren
id|AE_BAD_DATA
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch (Linked_list-&gt;Id) */
multiline_comment|/*&n;&t;&t; * Set the Buffer to point to the open byte&n;&t;&t; */
id|buffer
op_add_assign
id|bytes_consumed
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Point to the next object&n;&t;&t; */
id|linked_list
op_assign
(paren
id|RESOURCE
op_star
)paren
(paren
(paren
id|NATIVE_UINT
)paren
id|linked_list
op_plus
(paren
id|NATIVE_UINT
)paren
id|linked_list-&gt;length
)paren
suffix:semicolon
)brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
eof
