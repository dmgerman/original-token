multiline_comment|/*&n; *  osd.c - Linux specific code&n; *&n; *  Copyright (C) 2000 Andrew Henroid&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;acpi.h&quot;
DECL|macro|ACPI_MAX_THROTTLE
mdefine_line|#define ACPI_MAX_THROTTLE 10
DECL|macro|ACPI_INVALID
mdefine_line|#define ACPI_INVALID ~0UL
DECL|macro|ACPI_INFINITE
mdefine_line|#define ACPI_INFINITE ~0UL
DECL|variable|acpi_facp
r_static
r_struct
id|acpi_facp
op_star
id|acpi_facp
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_event_lock
r_static
id|spinlock_t
id|acpi_event_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|acpi_event_status
r_static
r_volatile
id|u32
id|acpi_event_status
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_event_state
r_static
r_volatile
id|acpi_sstate_t
id|acpi_event_state
op_assign
id|ACPI_S0
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|acpi_event_wait
)paren
suffix:semicolon
DECL|variable|acpi_irq_irq
r_static
r_int
id|acpi_irq_irq
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_irq_handler
r_static
id|OSD_HANDLER
id|acpi_irq_handler
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_irq_context
r_static
r_void
op_star
id|acpi_irq_context
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_pblk
r_static
r_int
r_int
id|acpi_pblk
op_assign
id|ACPI_INVALID
suffix:semicolon
DECL|variable|acpi_c2_exit_latency
r_static
r_int
r_int
id|acpi_c2_exit_latency
op_assign
id|ACPI_INFINITE
suffix:semicolon
DECL|variable|acpi_c3_exit_latency
r_static
r_int
r_int
id|acpi_c3_exit_latency
op_assign
id|ACPI_INFINITE
suffix:semicolon
DECL|variable|acpi_c2_enter_latency
r_static
r_int
r_int
id|acpi_c2_enter_latency
op_assign
id|ACPI_INFINITE
suffix:semicolon
DECL|variable|acpi_c3_enter_latency
r_static
r_int
r_int
id|acpi_c3_enter_latency
op_assign
id|ACPI_INFINITE
suffix:semicolon
DECL|variable|acpi_c2_tested
r_static
r_int
id|acpi_c2_tested
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_c3_tested
r_static
r_int
id|acpi_c3_tested
op_assign
l_int|0
suffix:semicolon
DECL|struct|acpi_intrp_entry
r_struct
id|acpi_intrp_entry
(brace
DECL|member|priority
r_int
id|priority
suffix:semicolon
DECL|member|callback
id|OSD_EXECUTION_CALLBACK
id|callback
suffix:semicolon
DECL|member|context
r_void
op_star
id|context
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|acpi_enter_sx_ctx
r_struct
id|acpi_enter_sx_ctx
(brace
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|state
r_int
id|state
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|acpi_intrp_pid
r_static
r_volatile
r_int
id|acpi_intrp_pid
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|acpi_intrp_wait
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|acpi_intrp_exec
)paren
suffix:semicolon
DECL|variable|acpi_intrp_exec_lock
r_static
id|spinlock_t
id|acpi_intrp_exec_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|ACPI_SLP_TYP
mdefine_line|#define ACPI_SLP_TYP(typa, typb) (((int)(typa) &lt;&lt; 8) | (int)(typb))
DECL|macro|ACPI_SLP_TYPA
mdefine_line|#define ACPI_SLP_TYPA(value) &bslash;&n;        ((((value) &gt;&gt; 8) &lt;&lt; ACPI_SLP_TYP_SHIFT) &amp; ACPI_SLP_TYP_MASK)
DECL|macro|ACPI_SLP_TYPB
mdefine_line|#define ACPI_SLP_TYPB(value) &bslash;&n;        ((((value) &amp; 0xff) &lt;&lt; ACPI_SLP_TYP_SHIFT) &amp; ACPI_SLP_TYP_MASK)
DECL|variable|acpi_sleep_state
r_static
r_volatile
id|acpi_sstate_t
id|acpi_sleep_state
op_assign
id|ACPI_S0
suffix:semicolon
DECL|variable|acpi_slptyp
r_static
r_int
r_int
id|acpi_slptyp
(braket
id|ACPI_S5
op_plus
l_int|1
)braket
op_assign
(brace
id|ACPI_INVALID
comma
)brace
suffix:semicolon
DECL|variable|acpi_sysctl
r_static
r_struct
id|ctl_table_header
op_star
id|acpi_sysctl
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|acpi_do_ulong
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_sleep
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_event
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
DECL|variable|acpi_table
r_static
r_struct
id|ctl_table
id|acpi_table
(braket
)braket
op_assign
(brace
(brace
id|ACPI_P_LVL2_LAT
comma
l_string|&quot;c2_exit_latency&quot;
comma
op_amp
id|acpi_c2_exit_latency
comma
r_sizeof
(paren
id|acpi_c2_exit_latency
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_ENTER_LVL2_LAT
comma
l_string|&quot;c2_enter_latency&quot;
comma
op_amp
id|acpi_c2_enter_latency
comma
r_sizeof
(paren
id|acpi_c2_enter_latency
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_P_LVL3_LAT
comma
l_string|&quot;c3_exit_latency&quot;
comma
op_amp
id|acpi_c3_exit_latency
comma
r_sizeof
(paren
id|acpi_c3_exit_latency
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_ENTER_LVL3_LAT
comma
l_string|&quot;c3_enter_latency&quot;
comma
op_amp
id|acpi_c3_enter_latency
comma
r_sizeof
(paren
id|acpi_c3_enter_latency
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_SLEEP
comma
l_string|&quot;sleep&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_sleep
)brace
comma
(brace
id|ACPI_EVENT
comma
l_string|&quot;event&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0400
comma
l_int|NULL
comma
op_amp
id|acpi_do_event
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|acpi_dir_table
r_static
r_struct
id|ctl_table
id|acpi_dir_table
(braket
)braket
op_assign
(brace
(brace
id|CTL_ACPI
comma
l_string|&quot;acpi&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|acpi_table
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * Get the value of the PM1 control register (ACPI_SCI_EN, ...)&n; */
r_static
id|u32
DECL|function|acpi_read_pm1_control
id|acpi_read_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_cnt
)paren
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_cnt
)paren
id|value
op_or_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_cnt
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the PM1 control register (ACPI_BM_RLD, ...)&n; */
r_static
r_void
DECL|function|acpi_write_pm1_control
id|acpi_write_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_if
c_cond
(paren
id|facp-&gt;pm1a_cnt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_cnt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_cnt
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the value of the fixed event status register&n; */
r_static
id|u32
DECL|function|acpi_read_pm1_status
id|acpi_read_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_evt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|value
op_or_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_evt
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the fixed event status register (clear events)&n; */
r_static
r_void
DECL|function|acpi_write_pm1_status
id|acpi_write_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_evt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_evt
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Examine/modify value&n; */
r_static
r_int
DECL|function|acpi_do_ulong
id|acpi_do_ulong
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
r_char
id|str
(braket
l_int|2
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_plus
l_int|4
)braket
comma
op_star
id|strend
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_pos
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ctl-&gt;data
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;0x%08lx&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
op_ge
id|size
)paren
(brace
id|copy_to_user
c_func
(paren
id|buffer
comma
id|str
comma
id|size
)paren
suffix:semicolon
op_star
id|len
op_assign
id|size
suffix:semicolon
)brace
r_else
op_star
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|size
op_assign
r_sizeof
(paren
id|str
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
op_star
id|len
)paren
id|size
op_assign
op_star
id|len
suffix:semicolon
id|copy_from_user
c_func
(paren
id|str
comma
id|buffer
comma
id|size
)paren
suffix:semicolon
id|str
(braket
id|size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|strend
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strend
op_eq
id|str
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
id|ctl-&gt;data
op_assign
id|val
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
op_star
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Handle ACPI event&n; */
id|u32
DECL|function|acpi_event
id|acpi_event
c_func
(paren
r_void
op_star
id|context
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|event
op_assign
(paren
r_int
)paren
id|context
suffix:semicolon
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|ACPI_EVENT_POWER_BUTTON
suffix:colon
id|mask
op_assign
id|ACPI_PWRBTN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_EVENT_SLEEP_BUTTON
suffix:colon
id|mask
op_assign
id|ACPI_SLPBTN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mask
)paren
(brace
singleline_comment|// notify process waiting on /dev/acpi
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|acpi_event_status
op_or_assign
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|acpi_event_state
op_assign
id|acpi_sleep_state
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|acpi_event_wait
)paren
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
multiline_comment|/*&n; * Wait for next event&n; */
r_int
DECL|function|acpi_do_event
id|acpi_do_event
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
id|u32
id|event_status
op_assign
l_int|0
suffix:semicolon
id|acpi_sstate_t
id|event_state
op_assign
l_int|0
suffix:semicolon
r_char
id|str
(braket
l_int|27
)braket
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|write
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
OL
r_sizeof
(paren
id|str
)paren
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
singleline_comment|// we need an atomic exchange here
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|event_status
op_assign
id|acpi_event_status
suffix:semicolon
id|acpi_event_status
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|event_state
op_assign
id|acpi_event_state
suffix:semicolon
r_if
c_cond
(paren
id|event_status
)paren
r_break
suffix:semicolon
singleline_comment|// wait for an event to arrive
id|interruptible_sleep_on
c_func
(paren
op_amp
id|acpi_event_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;0x%08x 0x%08x 0x%01x&bslash;n&quot;
comma
id|event_status
comma
l_int|0
comma
id|event_state
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
id|buffer
comma
id|str
comma
id|size
)paren
suffix:semicolon
op_star
id|len
op_assign
id|size
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Enter system sleep state&n; */
r_static
r_void
DECL|function|acpi_enter_sx
id|acpi_enter_sx
c_func
(paren
r_void
op_star
id|context
)paren
(brace
r_struct
id|acpi_enter_sx_ctx
op_star
id|ctx
op_assign
(paren
r_struct
id|acpi_enter_sx_ctx
op_star
)paren
id|context
suffix:semicolon
r_struct
id|acpi_facp
op_star
id|facp
op_assign
id|acpi_facp
suffix:semicolon
id|ACPI_OBJECT_LIST
id|arg_list
suffix:semicolon
id|ACPI_OBJECT
id|arg
suffix:semicolon
id|u16
id|value
suffix:semicolon
multiline_comment|/*&n;         * _PSW methods could be run here to enable wake-on keyboard, LAN, etc.&n;&t; */
singleline_comment|// run the _PTS method
id|memset
c_func
(paren
op_amp
id|arg_list
comma
l_int|0
comma
r_sizeof
(paren
id|arg_list
)paren
)paren
suffix:semicolon
id|arg_list.count
op_assign
l_int|1
suffix:semicolon
id|arg_list.pointer
op_assign
op_amp
id|arg
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|arg
comma
l_int|0
comma
r_sizeof
(paren
id|arg
)paren
)paren
suffix:semicolon
id|arg.type
op_assign
id|ACPI_TYPE_NUMBER
suffix:semicolon
id|arg.number.value
op_assign
id|ctx-&gt;state
suffix:semicolon
id|acpi_evaluate_object
c_func
(paren
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;_PTS&quot;
comma
op_amp
id|arg_list
comma
l_int|NULL
)paren
suffix:semicolon
singleline_comment|// clear wake status
id|acpi_write_pm1_status
c_func
(paren
id|facp
comma
id|ACPI_WAK
)paren
suffix:semicolon
id|acpi_sleep_state
op_assign
id|ctx-&gt;state
suffix:semicolon
singleline_comment|// set ACPI_SLP_TYPA/b and ACPI_SLP_EN
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_cnt
)paren
(brace
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_cnt
)paren
op_amp
op_complement
id|ACPI_SLP_TYP_MASK
suffix:semicolon
id|value
op_or_assign
(paren
id|ACPI_SLP_TYPA
c_func
(paren
id|acpi_slptyp
(braket
id|ctx-&gt;state
)braket
)paren
op_or
id|ACPI_SLP_EN
)paren
suffix:semicolon
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_cnt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|facp-&gt;pm1b_cnt
)paren
(brace
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_cnt
)paren
op_amp
op_complement
id|ACPI_SLP_TYP_MASK
suffix:semicolon
id|value
op_or_assign
(paren
id|ACPI_SLP_TYPB
c_func
(paren
id|acpi_slptyp
(braket
id|ctx-&gt;state
)braket
)paren
op_or
id|ACPI_SLP_EN
)paren
suffix:semicolon
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_cnt
)paren
suffix:semicolon
)brace
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;state
op_ne
id|ACPI_S1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: S%d failed&bslash;n&quot;
comma
id|ctx-&gt;state
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
singleline_comment|// wait until S1 is entered
r_while
c_loop
(paren
op_logical_neg
(paren
id|acpi_read_pm1_status
c_func
(paren
id|facp
)paren
op_amp
id|ACPI_WAK
)paren
)paren
id|safe_halt
c_func
(paren
)paren
suffix:semicolon
singleline_comment|// run the _WAK method
id|memset
c_func
(paren
op_amp
id|arg_list
comma
l_int|0
comma
r_sizeof
(paren
id|arg_list
)paren
)paren
suffix:semicolon
id|arg_list.count
op_assign
l_int|1
suffix:semicolon
id|arg_list.pointer
op_assign
op_amp
id|arg
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|arg
comma
l_int|0
comma
r_sizeof
(paren
id|arg
)paren
)paren
suffix:semicolon
id|arg.type
op_assign
id|ACPI_TYPE_NUMBER
suffix:semicolon
id|arg.number.value
op_assign
id|ctx-&gt;state
suffix:semicolon
id|acpi_evaluate_object
c_func
(paren
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;_WAK&quot;
comma
op_amp
id|arg_list
comma
l_int|NULL
)paren
suffix:semicolon
id|out
suffix:colon
id|acpi_sleep_state
op_assign
id|ACPI_S0
suffix:semicolon
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
id|ctx-&gt;wait
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|ctx-&gt;wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enter system sleep state and wait for completion&n; */
r_static
r_int
DECL|function|acpi_enter_sx_and_wait
id|acpi_enter_sx_and_wait
c_func
(paren
id|acpi_sstate_t
id|state
)paren
(brace
r_struct
id|acpi_enter_sx_ctx
id|ctx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
op_logical_or
id|acpi_facp-&gt;hdr.signature
op_ne
id|ACPI_FACP_SIG
op_logical_or
id|acpi_slptyp
(braket
id|state
)braket
op_eq
id|ACPI_INVALID
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ctx.wait
)paren
suffix:semicolon
id|ctx.state
op_assign
id|state
suffix:semicolon
r_if
c_cond
(paren
id|acpi_os_queue_for_execution
c_func
(paren
l_int|0
comma
id|acpi_enter_sx
comma
op_amp
id|ctx
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|ctx.wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Enter system sleep state&n; */
r_static
r_int
DECL|function|acpi_do_sleep
id|acpi_do_sleep
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_pos
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef CONFIG_ACPI_S1_SLEEP
r_int
id|status
op_assign
id|acpi_enter_sx_and_wait
c_func
(paren
id|ACPI_S1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
macro_line|#endif
)brace
id|file-&gt;f_pos
op_add_assign
op_star
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Clear busmaster activity flag&n; */
r_static
r_inline
r_void
DECL|function|acpi_clear_bm_activity
id|acpi_clear_bm_activity
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|acpi_write_pm1_status
c_func
(paren
id|facp
comma
id|ACPI_BM
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns 1 if there has been busmaster activity&n; */
r_static
r_inline
r_int
DECL|function|acpi_bm_activity
id|acpi_bm_activity
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
r_return
id|acpi_read_pm1_status
c_func
(paren
id|facp
)paren
op_amp
id|ACPI_BM
suffix:semicolon
)brace
multiline_comment|/*&n; * Set system to sleep through busmaster requests&n; */
r_static
r_void
DECL|function|acpi_sleep_on_busmaster
id|acpi_sleep_on_busmaster
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|pm1_cntr
op_assign
id|acpi_read_pm1_control
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm1_cntr
op_amp
id|ACPI_BM_RLD
)paren
(brace
id|pm1_cntr
op_and_assign
op_complement
id|ACPI_BM_RLD
suffix:semicolon
id|acpi_write_pm1_control
c_func
(paren
id|facp
comma
id|pm1_cntr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Set system to wake on busmaster requests&n; */
r_static
r_void
DECL|function|acpi_wake_on_busmaster
id|acpi_wake_on_busmaster
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|pm1_cntr
op_assign
id|acpi_read_pm1_control
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pm1_cntr
op_amp
id|ACPI_BM_RLD
)paren
)paren
(brace
id|pm1_cntr
op_or_assign
id|ACPI_BM_RLD
suffix:semicolon
id|acpi_write_pm1_control
c_func
(paren
id|facp
comma
id|pm1_cntr
)paren
suffix:semicolon
)brace
id|acpi_clear_bm_activity
c_func
(paren
id|facp
)paren
suffix:semicolon
)brace
multiline_comment|/* The ACPI timer is just the low 24 bits */
DECL|macro|TIME_BEGIN
mdefine_line|#define TIME_BEGIN(tmr) inl(tmr)
DECL|macro|TIME_END
mdefine_line|#define TIME_END(tmr, begin) ((inl(tmr) - (begin)) &amp; 0x00ffffff)
multiline_comment|/*&n; * Idle loop (uniprocessor only)&n; */
r_void
DECL|function|acpi_idle
id|acpi_idle
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|sleep_level
op_assign
l_int|1
suffix:semicolon
r_struct
id|acpi_facp
op_star
id|facp
op_assign
id|acpi_facp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|facp
op_logical_or
id|facp-&gt;hdr.signature
op_ne
id|ACPI_FACP_SIG
op_logical_or
op_logical_neg
id|facp-&gt;pm_tmr
op_logical_or
op_logical_neg
id|acpi_pblk
)paren
r_goto
id|not_initialized
suffix:semicolon
multiline_comment|/*&n;&t; * start from the previous sleep level..&n;&t; */
r_if
c_cond
(paren
id|sleep_level
op_eq
l_int|1
)paren
r_goto
id|sleep1
suffix:semicolon
r_if
c_cond
(paren
id|sleep_level
op_eq
l_int|2
)paren
r_goto
id|sleep2
suffix:semicolon
id|sleep3
suffix:colon
id|sleep_level
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_c3_tested
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ACPI C3 works&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_c3_tested
op_assign
l_int|1
suffix:semicolon
)brace
id|acpi_wake_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm2_cnt
)paren
r_goto
id|sleep3_with_arbiter
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bm_activity
c_func
(paren
id|facp
)paren
)paren
r_goto
id|sleep2
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|inb
c_func
(paren
id|acpi_pblk
op_plus
id|ACPI_P_LVL3
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_c3_exit_latency
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|sleep3_with_arbiter
suffix:colon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
id|u8
id|arbiter
suffix:semicolon
r_int
r_int
id|pm2_cntr
op_assign
id|facp-&gt;pm2_cnt
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bm_activity
c_func
(paren
id|facp
)paren
)paren
r_goto
id|sleep2
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|arbiter
op_assign
id|inb
c_func
(paren
id|pm2_cntr
)paren
op_amp
op_complement
id|ACPI_ARB_DIS
suffix:semicolon
multiline_comment|/* Disable arbiter, park on CPU */
id|outb
c_func
(paren
id|arbiter
op_or
id|ACPI_ARB_DIS
comma
id|pm2_cntr
)paren
suffix:semicolon
id|inb
c_func
(paren
id|acpi_pblk
op_plus
id|ACPI_P_LVL3
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
multiline_comment|/* Enable arbiter again.. */
id|outb
c_func
(paren
id|arbiter
comma
id|pm2_cntr
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_c3_exit_latency
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|sleep2
suffix:colon
id|sleep_level
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_c2_tested
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ACPI C2 works&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_c2_tested
op_assign
l_int|1
suffix:semicolon
)brace
id|acpi_wake_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
multiline_comment|/* Required to track BM activity.. */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|inb
c_func
(paren
id|acpi_pblk
op_plus
id|ACPI_P_LVL2
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_c2_exit_latency
)paren
r_goto
id|sleep1
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bm_activity
c_func
(paren
id|facp
)paren
)paren
(brace
id|acpi_clear_bm_activity
c_func
(paren
id|facp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|time
OG
id|acpi_c3_enter_latency
)paren
r_goto
id|sleep3
suffix:semicolon
)brace
id|sleep1
suffix:colon
id|sleep_level
op_assign
l_int|1
suffix:semicolon
id|acpi_sleep_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|safe_halt
c_func
(paren
)paren
suffix:semicolon
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OG
id|acpi_c2_enter_latency
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|not_initialized
suffix:colon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|safe_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|__sti
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enter soft-off (S5)&n; */
r_static
r_void
DECL|function|acpi_power_off
id|acpi_power_off
c_func
(paren
r_void
)paren
(brace
r_struct
id|acpi_enter_sx_ctx
id|ctx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
op_logical_or
id|acpi_facp-&gt;hdr.signature
op_ne
id|ACPI_FACP_SIG
op_logical_or
id|acpi_slptyp
(braket
id|ACPI_S5
)braket
op_eq
id|ACPI_INVALID
)paren
r_return
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ctx.wait
)paren
suffix:semicolon
id|ctx.state
op_assign
id|ACPI_S5
suffix:semicolon
id|acpi_enter_sx
c_func
(paren
op_amp
id|ctx
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get processor information&n; */
r_static
id|ACPI_STATUS
DECL|function|acpi_get_cpu_info
id|acpi_get_cpu_info
c_func
(paren
id|ACPI_HANDLE
id|handle
comma
id|u32
id|level
comma
r_void
op_star
id|ctx
comma
r_void
op_star
op_star
id|value
)paren
(brace
id|ACPI_OBJECT
id|obj
suffix:semicolon
id|ACPI_CX_STATE
id|lat
(braket
l_int|4
)braket
suffix:semicolon
id|ACPI_CPU_THROTTLING_STATE
id|throttle
(braket
id|ACPI_MAX_THROTTLE
)braket
suffix:semicolon
id|ACPI_BUFFER
id|buf
suffix:semicolon
r_int
id|i
comma
id|count
suffix:semicolon
id|buf.length
op_assign
r_sizeof
(paren
id|obj
)paren
suffix:semicolon
id|buf.pointer
op_assign
op_amp
id|obj
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_evaluate_object
c_func
(paren
id|handle
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|buf
)paren
)paren
)paren
r_return
id|AE_OK
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: PBLK %d @ 0x%04x:%d&bslash;n&quot;
comma
id|obj.processor.proc_id
comma
id|obj.processor.pblk_address
comma
id|obj.processor.pblk_length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_pblk
op_ne
id|ACPI_INVALID
op_logical_or
op_logical_neg
id|obj.processor.pblk_address
op_logical_or
id|obj.processor.pblk_length
op_ne
l_int|6
)paren
r_return
id|AE_OK
suffix:semicolon
id|acpi_pblk
op_assign
id|obj.processor.pblk_address
suffix:semicolon
id|buf.length
op_assign
r_sizeof
(paren
id|lat
)paren
suffix:semicolon
id|buf.pointer
op_assign
id|lat
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_get_processor_cx_info
c_func
(paren
id|handle
comma
op_amp
id|buf
)paren
)paren
)paren
r_return
id|AE_OK
suffix:semicolon
r_if
c_cond
(paren
id|lat
(braket
l_int|2
)braket
dot
id|latency
OL
id|MAX_CX_STATE_LATENCY
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: C2 supported&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_c2_exit_latency
op_assign
id|lat
(braket
l_int|2
)braket
dot
id|latency
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lat
(braket
l_int|3
)braket
dot
id|latency
OL
id|MAX_CX_STATE_LATENCY
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: C3 supported&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_c3_exit_latency
op_assign
id|lat
(braket
l_int|3
)braket
dot
id|latency
suffix:semicolon
)brace
id|memset
c_func
(paren
id|throttle
comma
l_int|0
comma
r_sizeof
(paren
id|throttle
)paren
)paren
suffix:semicolon
id|buf.length
op_assign
r_sizeof
(paren
id|throttle
)paren
suffix:semicolon
id|buf.pointer
op_assign
id|throttle
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_get_processor_throttling_info
c_func
(paren
id|handle
comma
op_amp
id|buf
)paren
)paren
)paren
r_return
id|AE_OK
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|count
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ACPI_MAX_THROTTLE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|throttle
(braket
id|i
)braket
dot
id|percent_of_clock
)paren
id|count
op_increment
suffix:semicolon
)brace
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: %d throttling states&bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
multiline_comment|/*&n; * Fetch the FACP information&n; */
r_static
r_int
DECL|function|acpi_fetch_facp
id|acpi_fetch_facp
c_func
(paren
r_void
)paren
(brace
id|ACPI_BUFFER
id|buffer
suffix:semicolon
id|buffer.pointer
op_assign
id|acpi_facp
suffix:semicolon
id|buffer.length
op_assign
r_sizeof
(paren
op_star
id|acpi_facp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_get_table
c_func
(paren
id|ACPI_TABLE_FACP
comma
l_int|1
comma
op_amp
id|buffer
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: no FACP&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_facp-&gt;p_lvl2_lat
op_logical_and
id|acpi_facp-&gt;p_lvl2_lat
op_le
id|ACPI_MAX_P_LVL2_LAT
)paren
(brace
id|acpi_c2_exit_latency
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl2_lat
)paren
suffix:semicolon
id|acpi_c2_enter_latency
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|ACPI_TMR_HZ
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_facp-&gt;p_lvl3_lat
op_logical_and
id|acpi_facp-&gt;p_lvl3_lat
op_le
id|ACPI_MAX_P_LVL3_LAT
)paren
(brace
id|acpi_c3_exit_latency
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl3_lat
)paren
suffix:semicolon
id|acpi_c3_enter_latency
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl3_lat
op_star
l_int|5
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Execute callbacks (interpret methods)&n; */
r_static
r_void
DECL|function|acpi_intrp_run
id|acpi_intrp_run
c_func
(paren
r_void
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_struct
id|acpi_intrp_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|acpi_intrp_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|entry
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_intrp_exec_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|acpi_intrp_exec
)paren
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|acpi_intrp_exec.next
comma
r_struct
id|acpi_intrp_entry
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|entry-&gt;list
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_intrp_exec_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
r_break
suffix:semicolon
(paren
op_star
id|entry-&gt;callback
)paren
(paren
id|entry-&gt;context
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Initialize and run interpreter within a kernel thread&n; */
r_static
r_int
DECL|function|acpi_intrp_thread
id|acpi_intrp_thread
c_func
(paren
r_void
op_star
id|context
)paren
(brace
id|ACPI_STATUS
id|status
suffix:semicolon
id|u8
id|sx
comma
id|typa
comma
id|typb
suffix:semicolon
multiline_comment|/*&n;&t; * initialize interpreter&n;&t; */
id|exit_files
c_func
(paren
id|current
)paren
suffix:semicolon
id|daemonize
c_func
(paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|current-&gt;comm
comma
l_string|&quot;acpi&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_initialize
c_func
(paren
l_int|NULL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: initialize failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_load_firmware_tables
c_func
(paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: table load failed&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_terminate
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_fetch_facp
c_func
(paren
)paren
)paren
(brace
id|acpi_terminate
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|status
op_assign
id|acpi_load_namespace
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|status
)paren
op_logical_and
id|status
op_ne
id|AE_CTRL_PENDING
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: namespace load failed&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_terminate
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: ACPI support found&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_walk_namespace
c_func
(paren
id|ACPI_TYPE_PROCESSOR
comma
id|ACPI_ROOT_OBJECT
comma
id|ACPI_INT32_MAX
comma
id|acpi_get_cpu_info
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sx
op_assign
id|ACPI_S0
suffix:semicolon
id|sx
op_le
id|ACPI_S5
suffix:semicolon
id|sx
op_increment
)paren
(brace
r_int
id|ca_sx
op_assign
(paren
id|sx
op_le
id|ACPI_S4
)paren
ques
c_cond
id|sx
suffix:colon
(paren
id|sx
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
c_func
(paren
id|acpi_hw_obtain_sleep_type_register_data
c_func
(paren
id|ca_sx
comma
op_amp
id|typa
comma
op_amp
id|typb
)paren
)paren
)paren
id|acpi_slptyp
(braket
id|sx
)braket
op_assign
id|ACPI_SLP_TYP
c_func
(paren
id|typa
comma
id|typb
)paren
suffix:semicolon
r_else
id|acpi_slptyp
(braket
id|sx
)braket
op_assign
id|ACPI_INVALID
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_slptyp
(braket
id|ACPI_S1
)braket
op_ne
id|ACPI_INVALID
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: S1 supported&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_slptyp
(braket
id|ACPI_S5
)braket
op_ne
id|ACPI_INVALID
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: S5 supported&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_enable
c_func
(paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: enable failed&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_terminate
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_install_fixed_event_handler
c_func
(paren
id|ACPI_EVENT_POWER_BUTTON
comma
id|acpi_event
comma
(paren
r_void
op_star
)paren
id|ACPI_EVENT_POWER_BUTTON
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: power button enable failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ACPI_SUCCESS
c_func
(paren
id|acpi_install_fixed_event_handler
c_func
(paren
id|ACPI_EVENT_SLEEP_BUTTON
comma
id|acpi_event
comma
(paren
r_void
op_star
)paren
id|ACPI_EVENT_SLEEP_BUTTON
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: sleep button enable failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
r_if
c_cond
(paren
id|smp_num_cpus
op_eq
l_int|1
)paren
id|pm_idle
op_assign
id|acpi_idle
suffix:semicolon
macro_line|#else
id|pm_idle
op_assign
id|acpi_idle
suffix:semicolon
macro_line|#endif
id|pm_power_off
op_assign
id|acpi_power_off
suffix:semicolon
id|acpi_sysctl
op_assign
id|register_sysctl_table
c_func
(paren
id|acpi_dir_table
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * run interpreter&n;&t; */
id|acpi_intrp_run
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * terminate interpreter&n;&t; */
id|unregister_sysctl_table
c_func
(paren
id|acpi_sysctl
)paren
suffix:semicolon
id|acpi_terminate
c_func
(paren
)paren
suffix:semicolon
id|acpi_intrp_pid
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Start the interpreter&n; */
r_int
id|__init
DECL|function|acpi_init
id|acpi_init
c_func
(paren
r_void
)paren
(brace
id|acpi_facp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|acpi_facp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|acpi_facp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|acpi_facp
)paren
)paren
suffix:semicolon
id|acpi_intrp_pid
op_assign
id|kernel_thread
c_func
(paren
id|acpi_intrp_thread
comma
l_int|NULL
comma
(paren
id|CLONE_FS
op_or
id|CLONE_FILES
op_or
id|CLONE_SIGHAND
op_or
id|SIGCHLD
)paren
)paren
suffix:semicolon
r_return
(paren
(paren
id|acpi_intrp_pid
op_ge
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Terminate the interpreter&n; */
r_void
id|__exit
DECL|function|acpi_exit
id|acpi_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kill_proc
c_func
(paren
id|acpi_intrp_pid
comma
id|SIGTERM
comma
l_int|1
)paren
)paren
(brace
singleline_comment|// wait until interpreter thread terminates (at most 5 seconds)
id|count
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
r_while
c_loop
(paren
id|acpi_intrp_pid
op_ge
l_int|0
op_logical_and
op_decrement
id|count
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// clean up after the interpreter
r_if
c_cond
(paren
id|acpi_irq_handler
)paren
(brace
id|acpi_os_remove_interrupt_handler
c_func
(paren
id|acpi_irq_irq
comma
id|acpi_irq_handler
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pm_power_off
op_eq
id|acpi_power_off
)paren
id|pm_power_off
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|pm_idle
op_eq
id|acpi_idle
)paren
id|pm_idle
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
)brace
DECL|variable|acpi_init
id|module_init
c_func
(paren
id|acpi_init
)paren
suffix:semicolon
DECL|variable|acpi_exit
id|module_exit
c_func
(paren
id|acpi_exit
)paren
suffix:semicolon
multiline_comment|/*&n; * OS-dependent functions&n; *&n; */
r_char
op_star
DECL|function|strupr
id|strupr
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|s
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
op_star
id|s
)paren
(brace
op_star
id|s
op_assign
id|TOUPPER
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
id|s
op_increment
suffix:semicolon
)brace
r_return
id|str
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_initialize
id|acpi_os_initialize
c_func
(paren
r_void
)paren
(brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_terminate
id|acpi_os_terminate
c_func
(paren
r_void
)paren
(brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|s32
DECL|function|acpi_os_printf
id|acpi_os_printf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|s32
id|size
suffix:semicolon
id|va_list
id|args
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|size
op_assign
id|acpi_os_vprintf
c_func
(paren
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
id|s32
DECL|function|acpi_os_vprintf
id|acpi_os_vprintf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
id|va_list
id|args
)paren
(brace
r_static
r_char
id|buffer
(braket
l_int|512
)braket
suffix:semicolon
r_int
id|size
op_assign
id|vsprintf
c_func
(paren
id|buffer
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&quot;
comma
id|buffer
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
r_void
op_star
DECL|function|acpi_os_allocate
id|acpi_os_allocate
c_func
(paren
id|u32
id|size
)paren
(brace
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
r_void
op_star
DECL|function|acpi_os_callocate
id|acpi_os_callocate
c_func
(paren
id|u32
id|size
)paren
(brace
r_void
op_star
id|ptr
op_assign
id|acpi_os_allocate
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|memset
c_func
(paren
id|ptr
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_free
id|acpi_os_free
c_func
(paren
r_void
op_star
id|ptr
)paren
(brace
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_map_memory
id|acpi_os_map_memory
c_func
(paren
r_void
op_star
id|phys
comma
id|u32
id|size
comma
r_void
op_star
op_star
id|virt
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|phys
OL
id|virt_to_phys
c_func
(paren
id|high_memory
)paren
)paren
(brace
op_star
id|virt
op_assign
id|phys_to_virt
c_func
(paren
(paren
r_int
r_int
)paren
id|phys
)paren
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
op_star
id|virt
op_assign
id|ioremap
c_func
(paren
(paren
r_int
r_int
)paren
id|phys
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|virt
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_unmap_memory
id|acpi_os_unmap_memory
c_func
(paren
r_void
op_star
id|virt
comma
id|u32
id|size
)paren
(brace
r_if
c_cond
(paren
id|virt
op_ge
id|high_memory
)paren
id|iounmap
c_func
(paren
id|virt
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|acpi_irq
id|acpi_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
(paren
op_star
id|acpi_irq_handler
)paren
(paren
id|acpi_irq_context
)paren
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_install_interrupt_handler
id|acpi_os_install_interrupt_handler
c_func
(paren
id|u32
id|irq
comma
id|OSD_HANDLER
id|handler
comma
r_void
op_star
id|context
)paren
(brace
id|acpi_irq_irq
op_assign
id|irq
suffix:semicolon
id|acpi_irq_handler
op_assign
id|handler
suffix:semicolon
id|acpi_irq_context
op_assign
id|context
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|acpi_irq
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;acpi&quot;
comma
id|acpi_irq
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: SCI (IRQ%d) allocation failed&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|AE_ERROR
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_remove_interrupt_handler
id|acpi_os_remove_interrupt_handler
c_func
(paren
id|u32
id|irq
comma
id|OSD_HANDLER
id|handler
)paren
(brace
r_if
c_cond
(paren
id|acpi_irq_handler
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
id|acpi_irq
)paren
suffix:semicolon
id|acpi_irq_handler
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
multiline_comment|/*&n; * Running in interpreter thread context, safe to sleep&n; */
r_void
DECL|function|acpi_os_sleep
id|acpi_os_sleep
c_func
(paren
id|u32
id|sec
comma
id|u32
id|ms
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_star
id|sec
op_plus
(paren
id|ms
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_sleep_usec
id|acpi_os_sleep_usec
c_func
(paren
id|u32
id|us
)paren
(brace
id|udelay
c_func
(paren
id|us
)paren
suffix:semicolon
)brace
id|u8
DECL|function|acpi_os_in8
id|acpi_os_in8
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
)paren
(brace
r_return
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|u16
DECL|function|acpi_os_in16
id|acpi_os_in16
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
)paren
(brace
r_return
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|u32
DECL|function|acpi_os_in32
id|acpi_os_in32
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
)paren
(brace
r_return
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_out8
id|acpi_os_out8
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
comma
id|u8
id|val
)paren
(brace
id|outb
c_func
(paren
id|val
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_out16
id|acpi_os_out16
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
comma
id|u16
id|val
)paren
(brace
id|outw
c_func
(paren
id|val
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_out32
id|acpi_os_out32
c_func
(paren
id|ACPI_IO_ADDRESS
id|port
comma
id|u32
id|val
)paren
(brace
id|outl
c_func
(paren
id|val
comma
id|port
)paren
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_read_pci_cfg_byte
id|acpi_os_read_pci_cfg_byte
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u8
op_star
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val
op_logical_or
op_logical_neg
id|dev
op_logical_or
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_read_pci_cfg_word
id|acpi_os_read_pci_cfg_word
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u16
op_star
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val
op_logical_or
op_logical_neg
id|dev
op_logical_or
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_read_pci_cfg_dword
id|acpi_os_read_pci_cfg_dword
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u32
op_star
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val
op_logical_or
op_logical_neg
id|dev
op_logical_or
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_write_pci_cfg_byte
id|acpi_os_write_pci_cfg_byte
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u8
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_write_pci_cfg_word
id|acpi_os_write_pci_cfg_word
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u16
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_write_pci_cfg_dword
id|acpi_os_write_pci_cfg_dword
c_func
(paren
id|u32
id|bus
comma
id|u32
id|func
comma
id|u32
id|addr
comma
id|u32
id|val
)paren
(brace
r_int
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
(paren
id|func
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|func
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_find_slot
c_func
(paren
id|bus
op_amp
l_int|0xffff
comma
id|devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|addr
comma
id|val
)paren
)paren
r_return
id|AE_ERROR
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
multiline_comment|/*&n; * Queue for interpreter thread&n; */
id|ACPI_STATUS
DECL|function|acpi_os_queue_for_execution
id|acpi_os_queue_for_execution
c_func
(paren
id|u32
id|priority
comma
id|OSD_EXECUTION_CALLBACK
id|callback
comma
r_void
op_star
id|context
)paren
(brace
r_struct
id|acpi_intrp_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|entry
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
r_return
id|AE_ERROR
suffix:semicolon
id|memset
c_func
(paren
id|entry
comma
l_int|0
comma
r_sizeof
(paren
id|entry
)paren
)paren
suffix:semicolon
id|entry-&gt;priority
op_assign
id|priority
suffix:semicolon
id|entry-&gt;callback
op_assign
id|callback
suffix:semicolon
id|entry-&gt;context
op_assign
id|context
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|entry-&gt;list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|waitqueue_active
c_func
(paren
op_amp
id|acpi_intrp_wait
)paren
)paren
(brace
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
id|AE_ERROR
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_intrp_exec_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|entry-&gt;list
comma
op_amp
id|acpi_intrp_exec
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|acpi_intrp_wait
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_intrp_exec_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
multiline_comment|/*&n; * Semaphores are unused, interpreter access is single threaded&n; */
id|ACPI_STATUS
DECL|function|acpi_os_create_semaphore
id|acpi_os_create_semaphore
c_func
(paren
id|u32
id|max_units
comma
id|u32
id|init
comma
id|ACPI_HANDLE
op_star
id|handle
)paren
(brace
op_star
id|handle
op_assign
(paren
id|ACPI_HANDLE
)paren
l_int|0
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_delete_semaphore
id|acpi_os_delete_semaphore
c_func
(paren
id|ACPI_HANDLE
id|handle
)paren
(brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_wait_semaphore
id|acpi_os_wait_semaphore
c_func
(paren
id|ACPI_HANDLE
id|handle
comma
id|u32
id|units
comma
id|u32
id|timeout
)paren
(brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_signal_semaphore
id|acpi_os_signal_semaphore
c_func
(paren
id|ACPI_HANDLE
id|handle
comma
id|u32
id|units
)paren
(brace
r_return
id|AE_OK
suffix:semicolon
)brace
id|ACPI_STATUS
DECL|function|acpi_os_breakpoint
id|acpi_os_breakpoint
c_func
(paren
r_char
op_star
id|msg
)paren
(brace
id|acpi_os_printf
c_func
(paren
l_string|&quot;breakpoint: %s&quot;
comma
id|msg
)paren
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_dbg_trap
id|acpi_os_dbg_trap
c_func
(paren
r_char
op_star
id|msg
)paren
(brace
id|acpi_os_printf
c_func
(paren
l_string|&quot;trap: %s&quot;
comma
id|msg
)paren
suffix:semicolon
)brace
r_void
DECL|function|acpi_os_dbg_assert
id|acpi_os_dbg_assert
c_func
(paren
r_void
op_star
id|failure
comma
r_void
op_star
id|file
comma
id|u32
id|line
comma
r_char
op_star
id|msg
)paren
(brace
id|acpi_os_printf
c_func
(paren
l_string|&quot;assert: %s&quot;
comma
id|msg
)paren
suffix:semicolon
)brace
id|u32
DECL|function|acpi_os_get_line
id|acpi_os_get_line
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * We just have to assume we&squot;re dealing with valid memory&n; */
id|BOOLEAN
DECL|function|acpi_os_readable
id|acpi_os_readable
c_func
(paren
r_void
op_star
id|ptr
comma
id|u32
id|len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|BOOLEAN
DECL|function|acpi_os_writable
id|acpi_os_writable
c_func
(paren
r_void
op_star
id|ptr
comma
id|u32
id|len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
eof
