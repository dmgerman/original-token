multiline_comment|/******************************************************************************&n; *&n; * Module Name: nsxfname - Public interfaces to the ACPI subsystem&n; *                         ACPI Namespace oriented interfaces&n; *              $Revision: 73 $&n; *&n; *****************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000 R. Byron Moore&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;acpi.h&quot;
macro_line|#include &quot;acinterp.h&quot;
macro_line|#include &quot;acnamesp.h&quot;
macro_line|#include &quot;amlcode.h&quot;
macro_line|#include &quot;acparser.h&quot;
macro_line|#include &quot;acdispat.h&quot;
macro_line|#include &quot;acevents.h&quot;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          NAMESPACE
id|MODULE_NAME
(paren
l_string|&quot;nsxfname&quot;
)paren
multiline_comment|/****************************************************************************&n; *&n; * FUNCTION:    Acpi_get_handle&n; *&n; * PARAMETERS:  Parent          - Object to search under (search scope).&n; *              Path_name       - Pointer to an asciiz string containing the&n; *                                  name&n; *              Ret_handle      - Where the return handle is placed&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: This routine will search for a caller specified name in the&n; *              name space.  The caller can restrict the search region by&n; *              specifying a non NULL parent.  The parent value is itself a&n; *              namespace handle.&n; *&n; ******************************************************************************/
id|ACPI_STATUS
DECL|function|acpi_get_handle
id|acpi_get_handle
(paren
id|ACPI_HANDLE
id|parent
comma
id|ACPI_STRING
id|pathname
comma
id|ACPI_HANDLE
op_star
id|ret_handle
)paren
(brace
id|ACPI_STATUS
id|status
suffix:semicolon
id|ACPI_NAMESPACE_NODE
op_star
id|node
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_NAMESPACE_NODE
op_star
id|prefix_node
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret_handle
op_logical_or
op_logical_neg
id|pathname
)paren
(brace
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
multiline_comment|/* Convert a parent handle to a prefix node */
r_if
c_cond
(paren
id|parent
)paren
(brace
id|acpi_cm_acquire_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
id|prefix_node
op_assign
id|acpi_ns_convert_handle_to_entry
(paren
id|parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prefix_node
)paren
(brace
id|acpi_cm_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|acpi_cm_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
)brace
multiline_comment|/* Special case for root, since we can&squot;t search for it */
r_if
c_cond
(paren
id|STRCMP
(paren
id|pathname
comma
id|NS_ROOT_PATH
)paren
op_eq
l_int|0
)paren
(brace
op_star
id|ret_handle
op_assign
id|acpi_ns_convert_entry_to_handle
(paren
id|acpi_gbl_root_node
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Find the Node and convert to a handle&n;&t; */
id|status
op_assign
id|acpi_ns_get_node
(paren
id|pathname
comma
id|prefix_node
comma
op_amp
id|node
)paren
suffix:semicolon
op_star
id|ret_handle
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
op_star
id|ret_handle
op_assign
id|acpi_ns_convert_entry_to_handle
(paren
id|node
)paren
suffix:semicolon
)brace
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * FUNCTION:    Acpi_get_pathname&n; *&n; * PARAMETERS:  Handle          - Handle to be converted to a pathname&n; *              Name_type       - Full pathname or single segment&n; *              Ret_path_ptr    - Buffer for returned path&n; *&n; * RETURN:      Pointer to a string containing the fully qualified Name.&n; *&n; * DESCRIPTION: This routine returns the fully qualified name associated with&n; *              the Handle parameter.  This and the Acpi_pathname_to_handle are&n; *              complementary functions.&n; *&n; ******************************************************************************/
id|ACPI_STATUS
DECL|function|acpi_get_name
id|acpi_get_name
(paren
id|ACPI_HANDLE
id|handle
comma
id|u32
id|name_type
comma
id|ACPI_BUFFER
op_star
id|ret_path_ptr
)paren
(brace
id|ACPI_STATUS
id|status
suffix:semicolon
id|ACPI_NAMESPACE_NODE
op_star
id|node
suffix:semicolon
multiline_comment|/* Buffer pointer must be valid always */
r_if
c_cond
(paren
op_logical_neg
id|ret_path_ptr
op_logical_or
(paren
id|name_type
OG
id|ACPI_NAME_TYPE_MAX
)paren
)paren
(brace
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
multiline_comment|/* Allow length to be zero and ignore the pointer */
r_if
c_cond
(paren
(paren
id|ret_path_ptr-&gt;length
)paren
op_logical_and
(paren
op_logical_neg
id|ret_path_ptr-&gt;pointer
)paren
)paren
(brace
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|name_type
op_eq
id|ACPI_FULL_PATHNAME
)paren
(brace
multiline_comment|/* Get the full pathname (From the namespace root) */
id|status
op_assign
id|acpi_ns_handle_to_pathname
(paren
id|handle
comma
op_amp
id|ret_path_ptr-&gt;length
comma
id|ret_path_ptr-&gt;pointer
)paren
suffix:semicolon
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Wants the single segment ACPI name.&n;&t; * Validate handle and convert to an Node&n;&t; */
id|acpi_cm_acquire_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
id|node
op_assign
id|acpi_ns_convert_handle_to_entry
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
(brace
id|status
op_assign
id|AE_BAD_PARAMETER
suffix:semicolon
r_goto
id|unlock_and_exit
suffix:semicolon
)brace
multiline_comment|/* Check if name will fit in buffer */
r_if
c_cond
(paren
id|ret_path_ptr-&gt;length
OL
id|PATH_SEGMENT_LENGTH
)paren
(brace
id|ret_path_ptr-&gt;length
op_assign
id|PATH_SEGMENT_LENGTH
suffix:semicolon
id|status
op_assign
id|AE_BUFFER_OVERFLOW
suffix:semicolon
r_goto
id|unlock_and_exit
suffix:semicolon
)brace
multiline_comment|/* Just copy the ACPI name from the Node and zero terminate it */
id|STRNCPY
(paren
id|ret_path_ptr-&gt;pointer
comma
(paren
id|NATIVE_CHAR
op_star
)paren
op_amp
id|node-&gt;name
comma
id|ACPI_NAME_SIZE
)paren
suffix:semicolon
(paren
(paren
id|NATIVE_CHAR
op_star
)paren
id|ret_path_ptr-&gt;pointer
)paren
(braket
id|ACPI_NAME_SIZE
)braket
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|AE_OK
suffix:semicolon
id|unlock_and_exit
suffix:colon
id|acpi_cm_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * FUNCTION:    Acpi_get_object_info&n; *&n; * PARAMETERS:  Handle          - Object Handle&n; *              Info            - Where the info is returned&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Returns information about an object as gleaned from the&n; *              namespace node and possibly by running several standard&n; *              control methods (Such as in the case of a device.)&n; *&n; ******************************************************************************/
id|ACPI_STATUS
DECL|function|acpi_get_object_info
id|acpi_get_object_info
(paren
id|ACPI_HANDLE
id|handle
comma
id|ACPI_DEVICE_INFO
op_star
id|info
)paren
(brace
id|DEVICE_ID
id|hid
suffix:semicolon
id|DEVICE_ID
id|uid
suffix:semicolon
id|ACPI_STATUS
id|status
suffix:semicolon
id|u32
id|device_status
op_assign
l_int|0
suffix:semicolon
id|ACPI_INTEGER
id|address
op_assign
l_int|0
suffix:semicolon
id|ACPI_NAMESPACE_NODE
op_star
id|node
suffix:semicolon
multiline_comment|/* Parameter validation */
r_if
c_cond
(paren
op_logical_neg
id|handle
op_logical_or
op_logical_neg
id|info
)paren
(brace
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|acpi_cm_acquire_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
id|node
op_assign
id|acpi_ns_convert_handle_to_entry
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
(brace
id|acpi_cm_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|info-&gt;type
op_assign
id|node-&gt;type
suffix:semicolon
id|info-&gt;name
op_assign
id|node-&gt;name
suffix:semicolon
id|acpi_cm_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If not a device, we are all done.&n;&t; */
r_if
c_cond
(paren
id|info-&gt;type
op_ne
id|ACPI_TYPE_DEVICE
)paren
(brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get extra info for ACPI devices only.  Run the&n;&t; * _HID, _UID, _STA, and _ADR methods.  Note: none&n;&t; * of these methods are required, so they may or may&n;&t; * not be present.  The Info-&gt;Valid bits are used&n;&t; * to indicate which methods ran successfully.&n;&t; */
id|info-&gt;valid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Execute the _HID method and save the result */
id|status
op_assign
id|acpi_cm_execute_HID
(paren
id|node
comma
op_amp
id|hid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|STRNCPY
(paren
id|info-&gt;hardware_id
comma
id|hid.buffer
comma
r_sizeof
(paren
id|info-&gt;hardware_id
)paren
)paren
suffix:semicolon
id|info-&gt;valid
op_or_assign
id|ACPI_VALID_HID
suffix:semicolon
)brace
multiline_comment|/* Execute the _UID method and save the result */
id|status
op_assign
id|acpi_cm_execute_UID
(paren
id|node
comma
op_amp
id|uid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|STRCPY
(paren
id|info-&gt;unique_id
comma
id|uid.buffer
)paren
suffix:semicolon
id|info-&gt;valid
op_or_assign
id|ACPI_VALID_UID
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Execute the _STA method and save the result&n;&t; * _STA is not always present&n;&t; */
id|status
op_assign
id|acpi_cm_execute_STA
(paren
id|node
comma
op_amp
id|device_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|info-&gt;current_status
op_assign
id|device_status
suffix:semicolon
id|info-&gt;valid
op_or_assign
id|ACPI_VALID_STA
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Execute the _ADR method and save result if successful&n;&t; * _ADR is not always present&n;&t; */
id|status
op_assign
id|acpi_cm_evaluate_numeric_object
(paren
id|METHOD_NAME__ADR
comma
id|node
comma
op_amp
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|info-&gt;address
op_assign
id|address
suffix:semicolon
id|info-&gt;valid
op_or_assign
id|ACPI_VALID_ADR
suffix:semicolon
)brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
eof
