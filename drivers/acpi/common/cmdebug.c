multiline_comment|/******************************************************************************&n; *&n; * Module Name: cmdebug - Debug print routines&n; *              $Revision: 61 $&n; *&n; *****************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000 R. Byron Moore&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;acpi.h&quot;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          MISCELLANEOUS
id|MODULE_NAME
(paren
l_string|&quot;cmdebug&quot;
)paren
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Get/Set debug level&n; *&n; * DESCRIPTION: Get or set value of the debug flag&n; *&n; *              These are used to allow user&squot;s to get/set the debug level&n; *&n; ****************************************************************************/
id|u32
DECL|function|get_debug_level
id|get_debug_level
(paren
r_void
)paren
(brace
r_return
(paren
id|acpi_dbg_level
)paren
suffix:semicolon
)brace
r_void
DECL|function|set_debug_level
id|set_debug_level
(paren
id|u32
id|new_debug_level
)paren
(brace
id|acpi_dbg_level
op_assign
id|new_debug_level
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_trace&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function entry trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level&n; *&n; ****************************************************************************/
r_void
DECL|function|function_trace
id|function_trace
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
)paren
(brace
id|acpi_gbl_nesting_level
op_increment
suffix:semicolon
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Entered Function: %s&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_trace_ptr&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              Pointer             - Pointer to display&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function entry trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level&n; *&n; ****************************************************************************/
r_void
DECL|function|function_trace_ptr
id|function_trace_ptr
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
r_void
op_star
id|pointer
)paren
(brace
id|acpi_gbl_nesting_level
op_increment
suffix:semicolon
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Entered Function: %s, %p&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|pointer
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_trace_str&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              String              - Additional string to display&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function entry trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level&n; *&n; ****************************************************************************/
r_void
DECL|function|function_trace_str
id|function_trace_str
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
id|NATIVE_CHAR
op_star
id|string
)paren
(brace
id|acpi_gbl_nesting_level
op_increment
suffix:semicolon
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Entered Function: %s, %s&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|string
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_trace_u32&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              Integer             - Integer to display&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function entry trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level&n; *&n; ****************************************************************************/
r_void
DECL|function|function_trace_u32
id|function_trace_u32
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
id|u32
id|integer
)paren
(brace
id|acpi_gbl_nesting_level
op_increment
suffix:semicolon
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Entered Function: %s, %lX&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|integer
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_exit&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function exit trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level&n; *&n; ****************************************************************************/
r_void
DECL|function|function_exit
id|function_exit
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
)paren
(brace
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Exiting Function: %s&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
)paren
suffix:semicolon
id|acpi_gbl_nesting_level
op_decrement
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_status_exit&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              Status              - Exit status code&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function exit trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level. Prints exit status also.&n; *&n; ****************************************************************************/
r_void
DECL|function|function_status_exit
id|function_status_exit
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
id|ACPI_STATUS
id|status
)paren
(brace
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Exiting Function: %s, %s&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|acpi_cm_format_exception
(paren
id|status
)paren
)paren
suffix:semicolon
id|acpi_gbl_nesting_level
op_decrement
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_value_exit&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              Value               - Value to be printed with exit msg&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function exit trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level. Prints exit value also.&n; *&n; ****************************************************************************/
r_void
DECL|function|function_value_exit
id|function_value_exit
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
id|NATIVE_UINT
id|value
)paren
(brace
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Exiting Function: %s, %X&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|value
)paren
suffix:semicolon
id|acpi_gbl_nesting_level
op_decrement
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Function_ptr_exit&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Function_name       - Name of Caller&squot;s function&n; *              Value               - Value to be printed with exit msg&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Function exit trace.  Prints only if TRACE_FUNCTIONS bit is&n; *              set in Debug_level. Prints exit value also.&n; *&n; ****************************************************************************/
r_void
DECL|function|function_ptr_exit
id|function_ptr_exit
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|NATIVE_CHAR
op_star
id|function_name
comma
id|u8
op_star
id|ptr
)paren
(brace
id|debug_print
(paren
id|module_name
comma
id|line_number
comma
id|component_id
comma
id|TRACE_FUNCTIONS
comma
l_string|&quot; %2.2ld Exiting Function: %s, %p&bslash;n&quot;
comma
id|acpi_gbl_nesting_level
comma
id|function_name
comma
id|ptr
)paren
suffix:semicolon
id|acpi_gbl_nesting_level
op_decrement
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Debug_print&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *              Print_level         - Requested debug print level&n; *              Format              - Printf format field&n; *              ...                 - Optional printf arguments&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Print error message with prefix consisting of the module name,&n; *              line number, and component ID.&n; *&n; ****************************************************************************/
r_void
DECL|function|debug_print
id|debug_print
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
comma
id|u32
id|component_id
comma
id|u32
id|print_level
comma
id|NATIVE_CHAR
op_star
id|format
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
multiline_comment|/* Both the level and the component must be enabled */
r_if
c_cond
(paren
(paren
id|print_level
op_amp
id|acpi_dbg_level
)paren
op_logical_and
(paren
id|component_id
op_amp
id|acpi_dbg_layer
)paren
)paren
(brace
id|va_start
(paren
id|args
comma
id|format
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;%8s-%04d: &quot;
comma
id|module_name
comma
id|line_number
)paren
suffix:semicolon
id|acpi_os_vprintf
(paren
id|format
comma
id|args
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Debug_print_prefix&n; *&n; * PARAMETERS:  Module_name         - Caller&squot;s module name (for error output)&n; *              Line_number         - Caller&squot;s line number (for error output)&n; *              Component_id        - Caller&squot;s component ID (for error output)&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Print the prefix part of an error message, consisting of the&n; *              module name, and line number&n; *&n; ****************************************************************************/
r_void
DECL|function|debug_print_prefix
id|debug_print_prefix
(paren
id|NATIVE_CHAR
op_star
id|module_name
comma
id|u32
id|line_number
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;%8s-%04d: &quot;
comma
id|module_name
comma
id|line_number
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Debug_print_raw&n; *&n; * PARAMETERS:  Format              - Printf format field&n; *              ...                 - Optional printf arguments&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Print error message -- without module/line indentifiers&n; *&n; ****************************************************************************/
r_void
DECL|function|debug_print_raw
id|debug_print_raw
(paren
id|NATIVE_CHAR
op_star
id|format
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
id|va_start
(paren
id|args
comma
id|format
)paren
suffix:semicolon
id|acpi_os_vprintf
(paren
id|format
comma
id|args
)paren
suffix:semicolon
id|va_end
(paren
id|args
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    Acpi_cm_dump_buffer&n; *&n; * PARAMETERS:  Buffer              - Buffer to dump&n; *              Count               - Amount to dump, in bytes&n; *              Component_iD        - Caller&squot;s component ID&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Generic dump buffer in both hex and ascii.&n; *&n; ****************************************************************************/
r_void
DECL|function|acpi_cm_dump_buffer
id|acpi_cm_dump_buffer
(paren
id|u8
op_star
id|buffer
comma
id|u32
id|count
comma
id|u32
id|display
comma
id|u32
id|component_id
)paren
(brace
id|u32
id|i
op_assign
l_int|0
suffix:semicolon
id|u32
id|j
suffix:semicolon
id|u32
id|temp32
suffix:semicolon
id|u8
id|buf_char
suffix:semicolon
multiline_comment|/* Only dump the buffer if tracing is enabled */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|TRACE_TABLES
op_amp
id|acpi_dbg_level
)paren
op_logical_and
(paren
id|component_id
op_amp
id|acpi_dbg_layer
)paren
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Nasty little dump buffer routine!&n;&t; */
r_while
c_loop
(paren
id|i
OL
id|count
)paren
(brace
multiline_comment|/* Print current offset */
id|acpi_os_printf
(paren
l_string|&quot;%05X  &quot;
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Print 16 hex chars */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|i
op_plus
id|j
op_ge
id|count
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Make sure that the s8 doesn&squot;t get sign-extended! */
r_switch
c_cond
(paren
id|display
)paren
(brace
multiline_comment|/* Default is BYTE display */
r_default
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;%02X &quot;
comma
op_star
(paren
(paren
id|u8
op_star
)paren
op_amp
id|buffer
(braket
id|i
op_plus
id|j
)braket
)paren
)paren
suffix:semicolon
id|j
op_add_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DB_WORD_DISPLAY
suffix:colon
id|MOVE_UNALIGNED16_TO_32
(paren
op_amp
id|temp32
comma
op_amp
id|buffer
(braket
id|i
op_plus
id|j
)braket
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;%04X &quot;
comma
id|temp32
)paren
suffix:semicolon
id|j
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DB_DWORD_DISPLAY
suffix:colon
id|MOVE_UNALIGNED32_TO_32
(paren
op_amp
id|temp32
comma
op_amp
id|buffer
(braket
id|i
op_plus
id|j
)braket
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;%08X &quot;
comma
id|temp32
)paren
suffix:semicolon
id|j
op_add_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DB_QWORD_DISPLAY
suffix:colon
id|MOVE_UNALIGNED32_TO_32
(paren
op_amp
id|temp32
comma
op_amp
id|buffer
(braket
id|i
op_plus
id|j
)braket
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;%08X&quot;
comma
id|temp32
)paren
suffix:semicolon
id|MOVE_UNALIGNED32_TO_32
(paren
op_amp
id|temp32
comma
op_amp
id|buffer
(braket
id|i
op_plus
id|j
op_plus
l_int|4
)braket
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;%08X &quot;
comma
id|temp32
)paren
suffix:semicolon
id|j
op_add_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * Print the ASCII equivalent characters&n;&t;&t; * But watch out for the bad unprintable ones...&n;&t;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_plus
id|j
op_ge
id|count
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|buf_char
op_assign
id|buffer
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf_char
OG
l_int|0x1F
op_logical_and
id|buf_char
OL
l_int|0x2E
)paren
op_logical_or
(paren
id|buf_char
OG
l_int|0x2F
op_logical_and
id|buf_char
OL
l_int|0x61
)paren
op_logical_or
(paren
id|buf_char
OG
l_int|0x60
op_logical_and
id|buf_char
OL
l_int|0x7F
)paren
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;%c&quot;
comma
id|buf_char
)paren
suffix:semicolon
)brace
r_else
(brace
id|acpi_os_printf
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Done with that line. */
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_add_assign
l_int|16
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
eof
