multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998,1999 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;See the file &quot;skfddi.c&quot; for further information.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/*&n; * *******************************************************************&n; * This SBA code implements the Synchronous Bandwidth Allocation&n; * functions described in the &quot;FDDI Synchronous Forum Implementer&squot;s&n; * Agreement&quot; dated December 1th, 1993.&n; * *******************************************************************&n; *&n; *&t;PURPOSE: The purpose of this function is to control&n; *&t;&t; synchronous allocations on a single FDDI segment.&n; *&t;&t; Allocations are limited to the primary FDDI ring.&n; *&t;&t; The SBM provides recovery mechanisms to recover&n; *&t;&t; unused bandwidth also resolves T_Neg and&n; *&t;&t; reconfiguration changes. Many of the SBM state&n; *&t;&t; machine inputs are sourced by the underlying&n; *&t;&t; FDDI sub-system supporting the SBA application.&n; *&n; * *******************************************************************&n; */
macro_line|#include &quot;h/types.h&quot;
macro_line|#include &quot;h/fddi.h&quot;
macro_line|#include &quot;h/smc.h&quot;
macro_line|#include &quot;h/smt_p.h&quot;
macro_line|#ifndef&t;SLIM_SMT
macro_line|#ifdef ESS
macro_line|#ifndef lint
DECL|variable|ID_sccs
r_static
r_const
r_char
id|ID_sccs
(braket
)braket
op_assign
l_string|&quot;@(#)ess.c&t;1.10 96/02/23 (C) SK&quot;
suffix:semicolon
DECL|macro|LINT_USE
mdefine_line|#define LINT_USE(x)
macro_line|#else
DECL|macro|LINT_USE
mdefine_line|#define LINT_USE(x)&t;(x)=(x)
macro_line|#endif
DECL|macro|MS2BCLK
mdefine_line|#define MS2BCLK(x)&t;((x)*12500L)
multiline_comment|/*&n;&t;-------------------------------------------------------------&n;&t;LOCAL VARIABLES:&n;&t;-------------------------------------------------------------&n;*/
DECL|variable|plist_raf_alc_res
r_static
r_const
id|u_short
id|plist_raf_alc_res
(braket
)braket
op_assign
(brace
id|SMT_P0012
comma
id|SMT_P320B
comma
id|SMT_P320F
comma
id|SMT_P3210
comma
id|SMT_P0019
comma
id|SMT_P001A
comma
id|SMT_P001D
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|plist_raf_chg_req
r_static
r_const
id|u_short
id|plist_raf_chg_req
(braket
)braket
op_assign
(brace
id|SMT_P320B
comma
id|SMT_P320F
comma
id|SMT_P3210
comma
id|SMT_P001A
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|smt_sba_da
r_static
r_const
r_struct
id|fddi_addr
id|smt_sba_da
op_assign
(brace
(brace
l_int|0x80
comma
l_int|0x01
comma
l_int|0x43
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0x0C
)brace
)brace
suffix:semicolon
DECL|variable|null_addr
r_static
r_const
r_struct
id|fddi_addr
id|null_addr
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*&n;&t;-------------------------------------------------------------&n;&t;GLOBAL VARIABLES:&n;&t;-------------------------------------------------------------&n;*/
multiline_comment|/*&n;&t;-------------------------------------------------------------&n;&t;LOCAL FUNCTIONS:&n;&t;-------------------------------------------------------------&n;*/
r_static
r_void
id|ess_send_response
c_func
(paren
)paren
comma
id|ess_config_fifo
c_func
(paren
)paren
comma
id|ess_send_alc_req
c_func
(paren
)paren
comma
id|ess_send_frame
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;-------------------------------------------------------------&n;&t;EXTERNAL FUNCTIONS:&n;&t;-------------------------------------------------------------&n;*/
r_extern
r_void
op_star
id|sm_to_para
c_func
(paren
)paren
suffix:semicolon
r_extern
r_void
id|smt_send_frame
c_func
(paren
)paren
comma
id|smt_free_mbuf
c_func
(paren
)paren
comma
id|set_formac_tsync
c_func
(paren
)paren
comma
id|formac_reinit_tx
c_func
(paren
)paren
suffix:semicolon
r_extern
r_int
id|smt_check_para
c_func
(paren
)paren
suffix:semicolon
r_extern
id|SMbuf
op_star
id|smt_get_mbuf
c_func
(paren
)paren
comma
op_star
id|smt_build_frame
c_func
(paren
)paren
suffix:semicolon
r_extern
id|u_long
id|smt_get_tid
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;-------------------------------------------------------------&n;&t;PUBLIC FUNCTIONS:&n;&t;-------------------------------------------------------------&n;*/
r_void
id|ess_timer_poll
c_func
(paren
)paren
comma
id|ess_para_change
c_func
(paren
)paren
suffix:semicolon
r_int
id|ess_raf_received_pack
c_func
(paren
)paren
comma
id|process_bw_alloc
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n; * --------------------------------------------------------------------------&n; *&t;End Station Support&t;(ESS)&n; * --------------------------------------------------------------------------&n; */
multiline_comment|/*&n; * evaluate the RAF frame&n; */
DECL|function|ess_raf_received_pack
r_int
id|ess_raf_received_pack
c_func
(paren
id|smc
comma
id|mb
comma
id|sm
comma
id|fs
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|fs
suffix:semicolon
(brace
r_void
op_star
id|p
suffix:semicolon
multiline_comment|/* universal pointer */
r_struct
id|smt_p_0016
op_star
id|cmd
suffix:semicolon
multiline_comment|/* para: command for the ESS */
id|SMbuf
op_star
id|db
suffix:semicolon
id|u_long
id|msg_res_type
suffix:semicolon
multiline_comment|/* recource type */
id|u_long
id|payload
comma
id|overhead
suffix:semicolon
r_int
id|local
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * Message Processing Code&n;&t; */
id|local
op_assign
(paren
(paren
id|fs
op_amp
id|L_INDICATOR
)paren
op_ne
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * get the resource type&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P0015
)paren
)paren
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: RAF frame error, parameter type not found&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
id|msg_res_type
op_assign
(paren
(paren
r_struct
id|smt_p_0015
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|res_type
suffix:semicolon
multiline_comment|/*&n;&t; * get the pointer to the ESS command&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd
op_assign
(paren
r_struct
id|smt_p_0016
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P0016
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * error in frame: para ESS command was not found&n;&t;&t; */
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: RAF frame error, parameter command not found&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;fc %x&t;ft %x&bslash;n&quot;
comma
id|sm-&gt;smt_class
comma
id|sm-&gt;smt_type
)paren
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ver %x&t;tran %lx&bslash;n&quot;
comma
id|sm-&gt;smt_version
comma
id|sm-&gt;smt_tid
)paren
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;stn_id %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;infolen %x&t;res %x&bslash;n&quot;
comma
id|sm-&gt;smt_len
comma
id|msg_res_type
)paren
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;sbacmd %x&bslash;n&quot;
comma
id|cmd-&gt;sba_cmd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * evaluate the ESS command&n;&t; */
r_switch
c_cond
(paren
id|cmd-&gt;sba_cmd
)paren
(brace
multiline_comment|/*&n;&t; * Process an ESS Allocation Request&n;&t; */
r_case
id|REQUEST_ALLOCATION
suffix:colon
multiline_comment|/*&n;&t;&t; * check for an RAF Request (Allocation Request)&n;&t;&t; */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_eq
id|SMT_REQUEST
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * process the Allocation request only if the frame is&n;&t;&t;&t; * local and no static allocation is used&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|local
op_logical_or
id|smc-&gt;mib.fddiESSPayload
)paren
r_return
(paren
id|fs
)paren
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P0019
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
r_struct
id|smt_p_0019
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|alloc_addr.a
(braket
id|i
)braket
)paren
(brace
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t;&t; * Note: The Application should send a LAN_LOC_FRAME.&n;&t;&t;&t; *&t; The ESS do not send the Frame to the network!&n;&t;&t;&t; */
id|smc-&gt;ess.alloc_trans_id
op_assign
id|sm-&gt;smt_tid
suffix:semicolon
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: save Alloc Req Trans ID %lx&bslash;n&quot;
comma
id|sm-&gt;smt_tid
comma
l_int|0
)paren
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P320F
)paren
suffix:semicolon
(paren
(paren
r_struct
id|smt_p_320f
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_payload
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P3210
)paren
suffix:semicolon
(paren
(paren
r_struct
id|smt_p_3210
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_overhead
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
suffix:semicolon
id|sm-&gt;smt_dest
op_assign
id|smt_sba_da
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;ess.local_sba_active
)paren
r_return
(paren
id|fs
op_or
id|I_INDICATOR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|db
op_assign
id|smt_get_mbuf
c_func
(paren
id|smc
)paren
)paren
)paren
r_return
(paren
id|fs
)paren
suffix:semicolon
id|db-&gt;sm_len
op_assign
id|mb-&gt;sm_len
suffix:semicolon
id|db-&gt;sm_off
op_assign
id|mb-&gt;sm_off
suffix:semicolon
id|memcpy
c_func
(paren
(paren
(paren
r_char
op_star
)paren
(paren
id|db-&gt;sm_data
op_plus
id|db-&gt;sm_off
)paren
)paren
comma
(paren
r_char
op_star
)paren
id|sm
comma
(paren
r_int
)paren
id|db-&gt;sm_len
)paren
suffix:semicolon
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
(paren
id|db-&gt;sm_data
op_plus
id|db-&gt;sm_off
)paren
comma
l_string|&quot;RAF&quot;
)paren
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|db
comma
id|FC_SMT_INFO
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * The RAF frame is an Allocation Response !&n;&t;&t; * check the parameters&n;&t;&t; */
r_if
c_cond
(paren
id|smt_check_para
c_func
(paren
id|smc
comma
id|sm
comma
id|plist_raf_alc_res
)paren
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: RAF with para problem, ignoring&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * VERIFY THE FRAME IS WELL BUILT:&n;&t;&t; *&n;&t;&t; *&t;1. path index = primary ring only&n;&t;&t; *&t;2. resource type = sync bw only&n;&t;&t; *&t;3. trans action id = alloc_trans_id&n;&t;&t; *&t;4. reason code = success&n;&t;&t; *&n;&t;&t; * If any are violated, discard the RAF frame&n;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
(paren
r_struct
id|smt_p_320b
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P320B
)paren
)paren
op_member_access_from_pointer
id|path_index
op_ne
id|PRIMARY_RING
)paren
op_logical_or
(paren
id|msg_res_type
op_ne
id|SYNC_BW
)paren
op_logical_or
(paren
(paren
(paren
r_struct
id|smt_p_reason
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P0012
)paren
)paren
op_member_access_from_pointer
id|rdf_reason
op_ne
id|SMT_RDF_SUCCESS
)paren
op_logical_or
(paren
id|sm-&gt;smt_tid
op_ne
id|smc-&gt;ess.alloc_trans_id
)paren
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: Allocation Responce not accepted&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Extract message parameters&n;&t;&t; */
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P320F
)paren
suffix:semicolon
id|payload
op_assign
(paren
(paren
r_struct
id|smt_p_320f
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_payload
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P3210
)paren
suffix:semicolon
id|overhead
op_assign
(paren
(paren
r_struct
id|smt_p_3210
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_overhead
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;payload= %lx&t;overhead= %lx&bslash;n&quot;
comma
id|payload
comma
id|overhead
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * process the bandwidth allocation&n;&t;&t; */
(paren
r_void
)paren
id|process_bw_alloc
c_func
(paren
id|smc
comma
(paren
r_int
)paren
id|payload
comma
(paren
r_int
)paren
id|overhead
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* end of Process Allocation Request */
multiline_comment|/*&n;&t; * Process an ESS Change Request&n;&t; */
r_case
id|CHANGE_ALLOCATION
suffix:colon
multiline_comment|/*&n;&t;&t; * except only replies&n;&t;&t; */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: Do not process Change Responses&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * check the para for the Change Request&n;&t;&t; */
r_if
c_cond
(paren
id|smt_check_para
c_func
(paren
id|smc
comma
id|sm
comma
id|plist_raf_chg_req
)paren
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: RAF with para problem, ignoring&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Verify the path index and resource&n;&t;&t; * type are correct. If any of&n;&t;&t; * these are false, don&squot;t process this&n;&t;&t; * change request frame.&n;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
(paren
r_struct
id|smt_p_320b
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P320B
)paren
)paren
op_member_access_from_pointer
id|path_index
op_ne
id|PRIMARY_RING
)paren
op_logical_or
(paren
id|msg_res_type
op_ne
id|SYNC_BW
)paren
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: RAF frame with para problem, ignoring&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Extract message queue parameters&n;&t;&t; */
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P320F
)paren
suffix:semicolon
id|payload
op_assign
(paren
(paren
r_struct
id|smt_p_320f
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_payload
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P3210
)paren
suffix:semicolon
id|overhead
op_assign
(paren
(paren
r_struct
id|smt_p_3210
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|mib_overhead
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: Change Request from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;payload= %lx&t;overhead= %lx&bslash;n&quot;
comma
id|payload
comma
id|overhead
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * process the bandwidth allocation&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|process_bw_alloc
c_func
(paren
id|smc
comma
(paren
r_int
)paren
id|payload
comma
(paren
r_int
)paren
id|overhead
)paren
)paren
(brace
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * send an RAF Change Reply&n;&t;&t; */
id|ess_send_response
c_func
(paren
id|smc
comma
id|sm
comma
id|CHANGE_ALLOCATION
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* end of Process Change Request */
multiline_comment|/*&n;&t; * Process Report Response&n;&t; */
r_case
id|REPORT_ALLOCATION
suffix:colon
multiline_comment|/*&n;&t;&t; * except only requests&n;&t;&t; */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: Do not process a Report Reply&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: Report Request from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
(paren
id|sm-&gt;smt_source
)paren
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * verify that the resource type is sync bw only&n;&t;&t; */
r_if
c_cond
(paren
id|msg_res_type
op_ne
id|SYNC_BW
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: ignoring RAF with para problem&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * send an RAF Change Reply&n;&t;&t; */
id|ess_send_response
c_func
(paren
id|smc
comma
id|sm
comma
id|REPORT_ALLOCATION
)paren
suffix:semicolon
r_return
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* end of Process Report Request */
r_default
suffix:colon
multiline_comment|/*&n;&t;&t; * error in frame&n;&t;&t; */
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: ignoring RAF with bad sba_cmd&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
id|fs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * determines the synchronous bandwidth, set the TSYNC register and the&n; * mib variables SBAPayload, SBAOverhead and fddiMACT-NEG.&n; */
DECL|function|process_bw_alloc
r_int
id|process_bw_alloc
c_func
(paren
id|smc
comma
id|payload
comma
id|overhead
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|payload
suffix:semicolon
r_int
id|overhead
suffix:semicolon
(brace
multiline_comment|/*&n;&t; * determine the synchronous bandwidth (sync_bw) in bytes per T-NEG,&n;&t; * if the payload is greater than zero.&n;&t; * For the SBAPayload and the SBAOverhead we have the following&n;&t; * unite quations&n; &t; *&t;&t;      _&t;&t;  _&n;&t; *&t;&t;     |&t;     bytes |&n;&t; *&t;SBAPayload = | 8000 ------ |&n;&t; *&t;&t;     |&t;&t;s  |&n;&t; *&t;&t;      -&t;&t;  -&n; &t; *&t;&t;       _       _&n;&t; *&t;&t;      |&t; bytes&t;|&n;&t; *&t;SBAOverhead = | ------&t;|&n;&t; *&t;&t;      |&t; T-NEG&t;|&n;&t; *&t;&t;       -       -&n; &t; *&n;&t; * T-NEG is discribed by the equation:&n;&t; *&n;&t; *&t;&t;     (-) fddiMACT-NEG&n;&t; *&t;T-NEG =&t;    -------------------&n;&t; *&t;&t;&t;12500000 1/s&n;&t; *&n;&t; * The number of bytes we are able to send is the payload&n;&t; * plus the overhead.&n;&t; *&n;&t; *&t;&t;&t;  bytes    T-NEG SBAPayload 8000 bytes/s&n;&t; * sync_bw =  SBAOverhead ------ + -----------------------------&n;&t; *&t;   &t;&t;  T-NEG&t;&t;T-NEG&n;&t; *&n;&t; *&n;&t; *&t;      &t;&t;     1&n;&t; * sync_bw =  SBAOverhead + ---- (-)fddiMACT-NEG * SBAPayload&n;&t; *&t;       &t;&t;    1562&n;&t; *&n;&t; */
multiline_comment|/*&n;&t; * set the mib attributes fddiPATHSbaOverhead, fddiPATHSbaPayload&n;&t; */
multiline_comment|/*&t;if (smt_set_obj(smc,SMT_P320F,payload,S_SET)) {&n;&t;&t;DB_ESS(&quot;ESS: SMT does not accept the payload value&bslash;n&quot;,0,0) ;&n;&t;&t;return(FALSE) ;&n;&t;}&n;&t;if (smt_set_obj(smc,SMT_P3210,overhead,S_SET)) {&n;&t;&t;DB_ESS(&quot;ESS: SMT does not accept the overhead value&bslash;n&quot;,0,0) ;&n;&t;&t;return(FALSE) ;&n;&t;} */
multiline_comment|/* premliminary */
r_if
c_cond
(paren
id|payload
OG
id|MAX_PAYLOAD
op_logical_or
id|overhead
OG
l_int|5000
)paren
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;ESS: payload / overhead not accepted&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * start the iterative allocation process if the payload or the overhead&n;&t; * are smaller than the parsed values&n;&t; */
r_if
c_cond
(paren
id|smc-&gt;mib.fddiESSPayload
op_logical_and
(paren
(paren
id|u_long
)paren
id|payload
op_ne
id|smc-&gt;mib.fddiESSPayload
op_logical_or
(paren
id|u_long
)paren
id|overhead
op_ne
id|smc-&gt;mib.fddiESSOverhead
)paren
)paren
(brace
id|smc-&gt;ess.raf_act_timer_poll
op_assign
id|TRUE
suffix:semicolon
id|smc-&gt;ess.timer_count
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * evulate the Payload&n;&t; */
r_if
c_cond
(paren
id|payload
)paren
(brace
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: turn SMT_ST_SYNC_SERVICE bit on&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;ess.sync_bw_available
op_assign
id|TRUE
suffix:semicolon
id|smc-&gt;ess.sync_bw
op_assign
id|overhead
op_minus
(paren
r_int
)paren
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACT_Neg
op_star
id|payload
op_div
l_int|1562
suffix:semicolon
)brace
r_else
(brace
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: turn SMT_ST_SYNC_SERVICE bit off&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;ess.sync_bw_available
op_assign
id|FALSE
suffix:semicolon
id|smc-&gt;ess.sync_bw
op_assign
l_int|0
suffix:semicolon
id|overhead
op_assign
l_int|0
suffix:semicolon
)brace
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
op_assign
id|payload
suffix:semicolon
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
op_assign
id|overhead
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;tsync = %lx&bslash;n&quot;
comma
id|smc-&gt;ess.sync_bw
comma
l_int|0
)paren
suffix:semicolon
id|ess_config_fifo
c_func
(paren
id|smc
)paren
suffix:semicolon
id|set_formac_tsync
c_func
(paren
id|smc
comma
id|smc-&gt;ess.sync_bw
)paren
suffix:semicolon
r_return
(paren
id|TRUE
)paren
suffix:semicolon
)brace
DECL|function|ess_send_response
r_static
r_void
id|ess_send_response
c_func
(paren
id|smc
comma
id|sm
comma
id|sba_cmd
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|sba_cmd
suffix:semicolon
(brace
r_struct
id|smt_sba_chg
op_star
id|chg
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_void
op_star
id|p
suffix:semicolon
multiline_comment|/*&n;&t; * get and initialize the responce frame&n;&t; */
r_if
c_cond
(paren
id|sba_cmd
op_eq
id|CHANGE_ALLOCATION
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_RAF
comma
id|SMT_REPLY
comma
r_sizeof
(paren
r_struct
id|smt_sba_chg
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_RAF
comma
id|SMT_REPLY
comma
r_sizeof
(paren
r_struct
id|smt_sba_rep_res
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
)brace
id|chg
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_sba_chg
op_star
)paren
suffix:semicolon
id|chg-&gt;smt.smt_tid
op_assign
id|sm-&gt;smt_tid
suffix:semicolon
id|chg-&gt;smt.smt_dest
op_assign
id|sm-&gt;smt_source
suffix:semicolon
multiline_comment|/* set P15 */
id|chg-&gt;s_type.para.p_type
op_assign
id|SMT_P0015
suffix:semicolon
id|chg-&gt;s_type.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0015
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|chg-&gt;s_type.res_type
op_assign
id|SYNC_BW
suffix:semicolon
multiline_comment|/* set P16 */
id|chg-&gt;cmd.para.p_type
op_assign
id|SMT_P0016
suffix:semicolon
id|chg-&gt;cmd.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0016
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|chg-&gt;cmd.sba_cmd
op_assign
id|sba_cmd
suffix:semicolon
multiline_comment|/* set P320B */
id|chg-&gt;path.para.p_type
op_assign
id|SMT_P320B
suffix:semicolon
id|chg-&gt;path.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_320b
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|chg-&gt;path.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|chg-&gt;path.path_pad
op_assign
(paren
id|u_short
)paren
l_int|NULL
suffix:semicolon
id|chg-&gt;path.path_index
op_assign
id|PRIMARY_RING
suffix:semicolon
multiline_comment|/* set P320F */
id|chg-&gt;payload.para.p_type
op_assign
id|SMT_P320F
suffix:semicolon
id|chg-&gt;payload.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_320f
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|chg-&gt;payload.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|chg-&gt;payload.mib_payload
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
suffix:semicolon
multiline_comment|/* set P3210 */
id|chg-&gt;overhead.para.p_type
op_assign
id|SMT_P3210
suffix:semicolon
id|chg-&gt;overhead.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_3210
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|chg-&gt;overhead.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|chg-&gt;overhead.mib_overhead
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
suffix:semicolon
r_if
c_cond
(paren
id|sba_cmd
op_eq
id|CHANGE_ALLOCATION
)paren
(brace
multiline_comment|/* set P1A */
id|chg-&gt;cat.para.p_type
op_assign
id|SMT_P001A
suffix:semicolon
id|chg-&gt;cat.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_001a
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|p
op_assign
(paren
r_void
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P001A
)paren
suffix:semicolon
id|chg-&gt;cat.category
op_assign
(paren
(paren
r_struct
id|smt_p_001a
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|category
suffix:semicolon
)brace
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|chg
comma
l_string|&quot;RAF&quot;
)paren
suffix:semicolon
id|ess_send_frame
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
)brace
DECL|function|ess_timer_poll
r_void
id|ess_timer_poll
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;ess.raf_act_timer_poll
)paren
r_return
suffix:semicolon
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: timer_poll&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;ess.timer_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;ess.timer_count
op_eq
l_int|10
)paren
(brace
id|smc-&gt;ess.timer_count
op_assign
l_int|0
suffix:semicolon
id|ess_send_alc_req
c_func
(paren
id|smc
)paren
suffix:semicolon
)brace
)brace
DECL|function|ess_send_alc_req
r_static
r_void
id|ess_send_alc_req
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|smt_sba_alc_req
op_star
id|req
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
multiline_comment|/*&n;&t; * send never allocation request where the requested payload and&n;&t; * overhead is zero or deallocate bandwidht when no bandwidth is&n;&t; * parsed&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;mib.fddiESSPayload
)paren
(brace
id|smc-&gt;mib.fddiESSOverhead
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;mib.fddiESSOverhead
)paren
id|smc-&gt;mib.fddiESSOverhead
op_assign
id|DEFAULT_OV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|smc-&gt;mib.fddiESSOverhead
op_eq
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
op_logical_and
id|smc-&gt;mib.fddiESSPayload
op_eq
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
)paren
(brace
id|smc-&gt;ess.raf_act_timer_poll
op_assign
id|FALSE
suffix:semicolon
id|smc-&gt;ess.timer_count
op_assign
l_int|7
suffix:semicolon
multiline_comment|/* next RAF alc req after 3 s */
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * get and initialize the responce frame&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_RAF
comma
id|SMT_REQUEST
comma
r_sizeof
(paren
r_struct
id|smt_sba_alc_req
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
id|req
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_sba_alc_req
op_star
)paren
suffix:semicolon
id|req-&gt;smt.smt_tid
op_assign
id|smc-&gt;ess.alloc_trans_id
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
id|req-&gt;smt.smt_dest
op_assign
id|smt_sba_da
suffix:semicolon
multiline_comment|/* set P15 */
id|req-&gt;s_type.para.p_type
op_assign
id|SMT_P0015
suffix:semicolon
id|req-&gt;s_type.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0015
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;s_type.res_type
op_assign
id|SYNC_BW
suffix:semicolon
multiline_comment|/* set P16 */
id|req-&gt;cmd.para.p_type
op_assign
id|SMT_P0016
suffix:semicolon
id|req-&gt;cmd.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0016
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;cmd.sba_cmd
op_assign
id|REQUEST_ALLOCATION
suffix:semicolon
multiline_comment|/*&n;&t; * set the parameter type and parameter lenght of all used&n;&t; * parameters&n;&t; */
multiline_comment|/* set P320B */
id|req-&gt;path.para.p_type
op_assign
id|SMT_P320B
suffix:semicolon
id|req-&gt;path.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_320b
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;path.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|req-&gt;path.path_pad
op_assign
(paren
id|u_short
)paren
l_int|NULL
suffix:semicolon
id|req-&gt;path.path_index
op_assign
id|PRIMARY_RING
suffix:semicolon
multiline_comment|/* set P0017 */
id|req-&gt;pl_req.para.p_type
op_assign
id|SMT_P0017
suffix:semicolon
id|req-&gt;pl_req.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0017
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;pl_req.sba_pl_req
op_assign
id|smc-&gt;mib.fddiESSPayload
op_minus
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
suffix:semicolon
multiline_comment|/* set P0018 */
id|req-&gt;ov_req.para.p_type
op_assign
id|SMT_P0018
suffix:semicolon
id|req-&gt;ov_req.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0018
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;ov_req.sba_ov_req
op_assign
id|smc-&gt;mib.fddiESSOverhead
op_minus
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
suffix:semicolon
multiline_comment|/* set P320F */
id|req-&gt;payload.para.p_type
op_assign
id|SMT_P320F
suffix:semicolon
id|req-&gt;payload.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_320f
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;payload.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|req-&gt;payload.mib_payload
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
suffix:semicolon
multiline_comment|/* set P3210 */
id|req-&gt;overhead.para.p_type
op_assign
id|SMT_P3210
suffix:semicolon
id|req-&gt;overhead.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_3210
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;overhead.mib_index
op_assign
id|SBAPATHINDEX
suffix:semicolon
id|req-&gt;overhead.mib_overhead
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
suffix:semicolon
multiline_comment|/* set P19 */
id|req-&gt;a_addr.para.p_type
op_assign
id|SMT_P0019
suffix:semicolon
id|req-&gt;a_addr.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_0019
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;a_addr.sba_pad
op_assign
(paren
id|u_short
)paren
l_int|NULL
suffix:semicolon
id|req-&gt;a_addr.alloc_addr
op_assign
id|null_addr
suffix:semicolon
multiline_comment|/* set P1A */
id|req-&gt;cat.para.p_type
op_assign
id|SMT_P001A
suffix:semicolon
id|req-&gt;cat.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_001a
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;cat.category
op_assign
id|smc-&gt;mib.fddiESSCategory
suffix:semicolon
multiline_comment|/* set P1B */
id|req-&gt;tneg.para.p_type
op_assign
id|SMT_P001B
suffix:semicolon
id|req-&gt;tneg.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_001b
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;tneg.max_t_neg
op_assign
id|smc-&gt;mib.fddiESSMaxTNeg
suffix:semicolon
multiline_comment|/* set P1C */
id|req-&gt;segm.para.p_type
op_assign
id|SMT_P001C
suffix:semicolon
id|req-&gt;segm.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_001c
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|req-&gt;segm.min_seg_siz
op_assign
id|smc-&gt;mib.fddiESSMinSegmentSize
suffix:semicolon
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|req
comma
l_string|&quot;RAF&quot;
)paren
suffix:semicolon
id|ess_send_frame
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
)brace
DECL|function|ess_send_frame
r_static
r_void
id|ess_send_frame
c_func
(paren
id|smc
comma
id|mb
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
(brace
multiline_comment|/*&n;&t; * check if the frame must be send to the own ESS&n;&t; */
r_if
c_cond
(paren
id|smc-&gt;ess.local_sba_active
)paren
(brace
multiline_comment|/*&n;&t;&t; * Send the Change Reply to the local SBA&n;&t;&t; */
id|DB_ESS
c_func
(paren
l_string|&quot;ESS:Send to the local SBA&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;ess.sba_reply_pend
)paren
id|smc-&gt;ess.sba_reply_pend
op_assign
id|mb
suffix:semicolon
r_else
(brace
id|DB_ESS
c_func
(paren
l_string|&quot;Frame is lost - another frame was pending&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Send the SBA RAF Change Reply to the network&n;&t;&t; */
id|DB_ESS
c_func
(paren
l_string|&quot;ESS:Send to the network&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|ess_para_change
r_void
id|ess_para_change
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
(paren
r_void
)paren
id|process_bw_alloc
c_func
(paren
id|smc
comma
(paren
r_int
)paren
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
comma
(paren
r_int
)paren
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaOverhead
)paren
suffix:semicolon
)brace
DECL|function|ess_config_fifo
r_static
r_void
id|ess_config_fifo
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
multiline_comment|/*&n;&t; * if nothing to do exit &n;&t; */
r_if
c_cond
(paren
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
)paren
(brace
r_if
c_cond
(paren
id|smc-&gt;hw.fp.fifo.fifo_config_mode
op_amp
id|SYNC_TRAFFIC_ON
op_logical_and
(paren
id|smc-&gt;hw.fp.fifo.fifo_config_mode
op_amp
id|SEND_ASYNC_AS_SYNC
)paren
op_eq
id|smc-&gt;mib.fddiESSSynchTxMode
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|smc-&gt;hw.fp.fifo.fifo_config_mode
op_amp
id|SYNC_TRAFFIC_ON
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * split up the FIFO and reinitialize the queues&n;&t; */
id|formac_reinit_tx
c_func
(paren
id|smc
)paren
suffix:semicolon
)brace
macro_line|#endif /* ESS */
macro_line|#endif&t;/* no SLIM_SMT */
eof
