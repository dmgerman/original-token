multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998,1999 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;See the file &quot;skfddi.c&quot; for further information.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
macro_line|#include &quot;h/types.h&quot;
macro_line|#include &quot;h/fddi.h&quot;
macro_line|#include &quot;h/smc.h&quot;
macro_line|#include &quot;h/smt_p.h&quot;
DECL|macro|KERNEL
mdefine_line|#define KERNEL
macro_line|#include &quot;h/smtstate.h&quot;
macro_line|#ifndef&t;lint
DECL|variable|ID_sccs
r_static
r_const
r_char
id|ID_sccs
(braket
)braket
op_assign
l_string|&quot;@(#)smt.c&t;2.43 98/11/23 (C) SK &quot;
suffix:semicolon
macro_line|#endif
r_extern
r_const
id|u_char
id|canonical
(braket
l_int|256
)braket
suffix:semicolon
multiline_comment|/*&n; * FC in SMbuf&n; */
DECL|macro|m_fc
mdefine_line|#define m_fc(mb)&t;((mb)-&gt;sm_data[0])
DECL|macro|SMT_TID_MAGIC
mdefine_line|#define SMT_TID_MAGIC&t;0x1f0a7b3c
macro_line|#ifdef&t;DEBUG
DECL|variable|smt_type_name
r_static
r_const
r_char
op_star
r_const
id|smt_type_name
(braket
)braket
op_assign
(brace
l_string|&quot;SMT_00??&quot;
comma
l_string|&quot;SMT_INFO&quot;
comma
l_string|&quot;SMT_02??&quot;
comma
l_string|&quot;SMT_03??&quot;
comma
l_string|&quot;SMT_04??&quot;
comma
l_string|&quot;SMT_05??&quot;
comma
l_string|&quot;SMT_06??&quot;
comma
l_string|&quot;SMT_07??&quot;
comma
l_string|&quot;SMT_08??&quot;
comma
l_string|&quot;SMT_09??&quot;
comma
l_string|&quot;SMT_0A??&quot;
comma
l_string|&quot;SMT_0B??&quot;
comma
l_string|&quot;SMT_0C??&quot;
comma
l_string|&quot;SMT_0D??&quot;
comma
l_string|&quot;SMT_0E??&quot;
comma
l_string|&quot;SMT_NSA&quot;
)brace
suffix:semicolon
DECL|variable|smt_class_name
r_static
r_const
r_char
op_star
r_const
id|smt_class_name
(braket
)braket
op_assign
(brace
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;NIF&quot;
comma
l_string|&quot;SIF_CONFIG&quot;
comma
l_string|&quot;SIF_OPER&quot;
comma
l_string|&quot;ECF&quot;
comma
l_string|&quot;RAF&quot;
comma
l_string|&quot;RDF&quot;
comma
l_string|&quot;SRF&quot;
comma
l_string|&quot;PMF_GET&quot;
comma
l_string|&quot;PMF_SET&quot;
comma
l_string|&quot;ESF&quot;
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|LAST_CLASS
mdefine_line|#define LAST_CLASS&t;(SMT_PMF_SET)
DECL|variable|SMT_Unknown
r_static
r_const
r_struct
id|fddi_addr
id|SMT_Unknown
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0x1f
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * external variables&n; */
r_extern
r_const
r_struct
id|fddi_addr
id|fddi_broadcast
suffix:semicolon
multiline_comment|/*&n; * external functions&n; */
r_int
id|pcm_status_twisted
c_func
(paren
)paren
suffix:semicolon
r_void
id|pcm_status_state
c_func
(paren
)paren
suffix:semicolon
r_int
id|pcm_status_type
c_func
(paren
)paren
suffix:semicolon
r_extern
id|SMbuf
op_star
id|smt_get_mbuf
c_func
(paren
)paren
suffix:semicolon
DECL|macro|EXPORT_PMF
mdefine_line|#define EXPORT_PMF
multiline_comment|/*&n; * function prototypes&n; */
id|u_long
id|smt_get_tid
c_func
(paren
)paren
suffix:semicolon
id|EXPORT_PMF
id|SMbuf
op_star
id|smt_build_frame
c_func
(paren
)paren
suffix:semicolon
id|EXPORT_PMF
r_void
op_star
id|sm_to_para
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef&t;LITTLE_ENDIAN
r_static
r_int
id|smt_swap_short
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|mac_index
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|phy_index
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|mac_con_resource_index
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|phy_con_resource_index
c_func
(paren
)paren
suffix:semicolon
id|EXPORT_PMF
r_void
id|smt_send_frame
c_func
(paren
)paren
suffix:semicolon
id|EXPORT_PMF
r_void
id|smt_set_timestamp
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_rdf
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_nif
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_ecf
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_echo_test
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_sif_config
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_sif_operation
c_func
(paren
)paren
suffix:semicolon
id|EXPORT_PMF
r_void
id|smt_swap_para
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef LITTLE_ENDIAN
r_static
r_void
id|smt_string_swap
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|smt_add_frame_len
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_una
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_sde
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_state
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_timestamp
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_policy
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_latency
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_neighbor
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|smt_fill_path
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_mac_status
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_lem
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_version
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_fsc
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_mac_counter
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_mac_fnc
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_manufacturer
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_user
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_setcount
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_fill_echo
c_func
(paren
)paren
suffix:semicolon
r_int
id|smt_check_para
c_func
(paren
)paren
suffix:semicolon
r_void
id|smt_clear_una_dna
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_clear_old_una_dna
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef&t;CONCENTRATOR
r_static
r_int
id|entity_to_index
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|update_dac
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|div_ratio
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef  USE_CAN_ADDR
r_void
id|hwm_conv_can
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
DECL|macro|hwm_conv_can
mdefine_line|#define&t;&t;hwm_conv_can(smc,data,len)
macro_line|#endif
multiline_comment|/*&n; * list of mandatory paras in frames&n; */
DECL|variable|plist_nif
r_static
r_const
id|u_short
id|plist_nif
(braket
)braket
op_assign
(brace
id|SMT_P_UNA
comma
id|SMT_P_SDE
comma
id|SMT_P_STATE
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/*&n; * init SMT agent&n; */
DECL|function|smt_agent_init
r_void
id|smt_agent_init
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * get MAC address&n;&t; */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress
op_assign
id|smc-&gt;hw.fddi_home_addr
suffix:semicolon
multiline_comment|/*&n;&t; * get OUI address from driver (bia == built-in-address)&n;&t; */
id|smc-&gt;mib.fddiSMTStationId.sid_oem
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|smc-&gt;mib.fddiSMTStationId.sid_oem
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|driver_get_bia
c_func
(paren
id|smc
comma
op_amp
id|smc-&gt;mib.fddiSMTStationId.sid_node
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|smc-&gt;mib.fddiSMTStationId.sid_node.a
(braket
id|i
)braket
op_assign
id|canonical
(braket
id|smc-&gt;mib.fddiSMTStationId.sid_node.a
(braket
id|i
)braket
)braket
suffix:semicolon
)brace
id|smc-&gt;mib.fddiSMTManufacturerData
(braket
l_int|0
)braket
op_assign
id|smc-&gt;mib.fddiSMTStationId.sid_node.a
(braket
l_int|0
)braket
suffix:semicolon
id|smc-&gt;mib.fddiSMTManufacturerData
(braket
l_int|1
)braket
op_assign
id|smc-&gt;mib.fddiSMTStationId.sid_node.a
(braket
l_int|1
)braket
suffix:semicolon
id|smc-&gt;mib.fddiSMTManufacturerData
(braket
l_int|2
)braket
op_assign
id|smc-&gt;mib.fddiSMTStationId.sid_node.a
(braket
l_int|2
)braket
suffix:semicolon
id|smc-&gt;sm.smt_tid
op_assign
l_int|0
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDupAddressTest
op_assign
id|DA_NONE
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUNDA_Flag
op_assign
id|FALSE
suffix:semicolon
macro_line|#ifndef&t;SLIM_SMT
id|smt_clear_una_dna
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_clear_old_una_dna
c_func
(paren
id|smc
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SMT_MAX_TEST
suffix:semicolon
id|i
op_increment
)paren
id|smc-&gt;sm.pend
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|smc-&gt;sm.please_reconnect
op_assign
l_int|0
suffix:semicolon
id|smc-&gt;sm.uniq_ticks
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * SMT task&n; * forever&n; *&t;delay 30 seconds&n; *&t;send NIF&n; *&t;check tvu &amp; tvd&n; * end&n; */
DECL|function|smt_agent_task
r_void
id|smt_agent_task
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
id|smt_timer_start
c_func
(paren
id|smc
comma
op_amp
id|smc-&gt;sm.smt_timer
comma
(paren
id|u_long
)paren
l_int|1000000L
comma
id|EV_TOKEN
c_func
(paren
id|EVENT_SMT
comma
id|SM_TIMER
)paren
)paren
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT agent task&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smt_please_reconnect
r_void
id|smt_please_reconnect
c_func
(paren
id|smc
comma
id|reconn_time
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
multiline_comment|/* Pointer to SMT context */
r_int
id|reconn_time
suffix:semicolon
multiline_comment|/* Wait for reconnect time in seconds */
(brace
multiline_comment|/*&n;&t; * The please reconnect variable is used as a timer.&n;&t; * It is decremented each time smt_event is called.&n;&t; * This happens every second or when smt_force_irq is called.&n;&t; * Note: smt_force_irq () is called on some packet receives and&n;&t; *       when a multicast address is changed. Since nothing&n;&t; *       is received during the disconnect and the multicast&n;&t; *       address changes can be viewed as not very often and&n;&t; *       the timer runs out close to its given value&n;&t; *       (reconn_time).&n;&t; */
id|smc-&gt;sm.please_reconnect
op_assign
id|reconn_time
suffix:semicolon
)brace
macro_line|#ifndef SMT_REAL_TOKEN_CT
DECL|function|smt_emulate_token_ct
r_void
id|smt_emulate_token_ct
c_func
(paren
id|smc
comma
id|mac_index
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|mac_index
suffix:semicolon
(brace
id|u_long
id|count
suffix:semicolon
id|u_long
id|time
suffix:semicolon
id|time
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|count
op_assign
(paren
(paren
id|time
op_minus
id|smc-&gt;sm.last_tok_time
(braket
id|mac_index
)braket
)paren
op_star
l_int|100
)paren
op_div
id|TICKS_PER_SECOND
suffix:semicolon
multiline_comment|/*&n;&t; * Only when ring is up we will have a token count. The&n;&t; * flag is unfortunatly a single instance value. This&n;&t; * doesn&squot;t matter now, because we currently have only&n;&t; * one MAC instance.&n;&t; */
r_if
c_cond
(paren
id|smc-&gt;hw.mac_ring_is_up
)paren
(brace
id|smc-&gt;mib.m
(braket
id|mac_index
)braket
dot
id|fddiMACToken_Ct
op_add_assign
id|count
suffix:semicolon
)brace
multiline_comment|/* Remember current time */
id|smc-&gt;sm.last_tok_time
(braket
id|mac_index
)braket
op_assign
id|time
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*ARGSUSED1*/
DECL|function|smt_event
r_void
id|smt_event
c_func
(paren
id|smc
comma
id|event
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|event
suffix:semicolon
(brace
id|u_long
id|time
suffix:semicolon
macro_line|#ifndef SMT_REAL_TOKEN_CT
r_int
id|i
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|smc-&gt;sm.please_reconnect
)paren
(brace
id|smc-&gt;sm.please_reconnect
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;sm.please_reconnect
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Counted down */
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_CONNECT
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|event
op_eq
id|SM_FAST
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * timer for periodic cleanup in driver&n;&t; * reset and start the watchdog (FM2)&n;&t; * ESS timer&n;&t; * SBA timer&n;&t; */
id|smt_timer_poll
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_start_watchdog
c_func
(paren
id|smc
)paren
suffix:semicolon
macro_line|#ifndef&t;SLIM_SMT
macro_line|#ifndef BOOT
macro_line|#ifdef&t;ESS
id|ess_timer_poll
c_func
(paren
id|smc
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef&t;SBA
id|sba_timer_poll
c_func
(paren
id|smc
)paren
suffix:semicolon
macro_line|#endif
id|smt_srf_event
c_func
(paren
id|smc
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* no SLIM_SMT */
id|time
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
op_minus
id|smc-&gt;sm.smt_last_lem
op_ge
id|TICKS_PER_SECOND
op_star
l_int|8
)paren
(brace
multiline_comment|/*&n;&t;&t; * Use 8 sec. for the time intervall, it simplifies the&n;&t;&t; * LER estimation.&n;&t;&t; */
r_struct
id|fddi_mib_m
op_star
id|mib
suffix:semicolon
id|u_long
id|upper
suffix:semicolon
id|u_long
id|lower
suffix:semicolon
r_int
id|cond
suffix:semicolon
r_int
id|port
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
multiline_comment|/*&n;&t;&t; * calculate LEM bit error rate&n;&t;&t; */
id|sm_lem_evaluate
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smc-&gt;sm.smt_last_lem
op_assign
id|time
suffix:semicolon
multiline_comment|/*&n;&t;&t; * check conditions&n;&t;&t; */
macro_line|#ifndef&t;SLIM_SMT
id|mac_update_counter
c_func
(paren
id|smc
)paren
suffix:semicolon
id|mib
op_assign
id|smc-&gt;mib.m
suffix:semicolon
id|upper
op_assign
(paren
id|mib-&gt;fddiMACLost_Ct
op_minus
id|mib-&gt;fddiMACOld_Lost_Ct
)paren
op_plus
(paren
id|mib-&gt;fddiMACError_Ct
op_minus
id|mib-&gt;fddiMACOld_Error_Ct
)paren
suffix:semicolon
id|lower
op_assign
(paren
id|mib-&gt;fddiMACFrame_Ct
op_minus
id|mib-&gt;fddiMACOld_Frame_Ct
)paren
op_plus
(paren
id|mib-&gt;fddiMACLost_Ct
op_minus
id|mib-&gt;fddiMACOld_Lost_Ct
)paren
suffix:semicolon
id|mib-&gt;fddiMACFrameErrorRatio
op_assign
id|div_ratio
c_func
(paren
id|upper
comma
id|lower
)paren
suffix:semicolon
id|cond
op_assign
(paren
(paren
op_logical_neg
id|mib-&gt;fddiMACFrameErrorThreshold
op_logical_and
id|mib-&gt;fddiMACError_Ct
op_ne
id|mib-&gt;fddiMACOld_Error_Ct
)paren
op_logical_or
(paren
id|mib-&gt;fddiMACFrameErrorRatio
OG
id|mib-&gt;fddiMACFrameErrorThreshold
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cond
op_ne
id|mib-&gt;fddiMACFrameErrorFlag
)paren
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_COND_MAC_FRAME_ERROR
comma
id|INDEX_MAC
comma
id|cond
)paren
suffix:semicolon
id|upper
op_assign
(paren
id|mib-&gt;fddiMACNotCopied_Ct
op_minus
id|mib-&gt;fddiMACOld_NotCopied_Ct
)paren
suffix:semicolon
id|lower
op_assign
id|upper
op_plus
(paren
id|mib-&gt;fddiMACCopied_Ct
op_minus
id|mib-&gt;fddiMACOld_Copied_Ct
)paren
suffix:semicolon
id|mib-&gt;fddiMACNotCopiedRatio
op_assign
id|div_ratio
c_func
(paren
id|upper
comma
id|lower
)paren
suffix:semicolon
id|cond
op_assign
(paren
(paren
op_logical_neg
id|mib-&gt;fddiMACNotCopiedThreshold
op_logical_and
id|mib-&gt;fddiMACNotCopied_Ct
op_ne
id|mib-&gt;fddiMACOld_NotCopied_Ct
)paren
op_logical_or
(paren
id|mib-&gt;fddiMACNotCopiedRatio
OG
id|mib-&gt;fddiMACNotCopiedThreshold
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cond
op_ne
id|mib-&gt;fddiMACNotCopiedFlag
)paren
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_COND_MAC_NOT_COPIED
comma
id|INDEX_MAC
comma
id|cond
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * set old values&n;&t;&t; */
id|mib-&gt;fddiMACOld_Frame_Ct
op_assign
id|mib-&gt;fddiMACFrame_Ct
suffix:semicolon
id|mib-&gt;fddiMACOld_Copied_Ct
op_assign
id|mib-&gt;fddiMACCopied_Ct
suffix:semicolon
id|mib-&gt;fddiMACOld_Error_Ct
op_assign
id|mib-&gt;fddiMACError_Ct
suffix:semicolon
id|mib-&gt;fddiMACOld_Lost_Ct
op_assign
id|mib-&gt;fddiMACLost_Ct
suffix:semicolon
id|mib-&gt;fddiMACOld_NotCopied_Ct
op_assign
id|mib-&gt;fddiMACNotCopied_Ct
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Check port EBError Condition&n;&t;&t; */
r_for
c_loop
(paren
id|port
op_assign
l_int|0
suffix:semicolon
id|port
OL
id|NUMPHYS
suffix:semicolon
id|port
op_increment
)paren
(brace
id|phy
op_assign
op_amp
id|smc-&gt;y
(braket
id|port
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|phy-&gt;mib-&gt;fddiPORTHardwarePresent
)paren
(brace
r_continue
suffix:semicolon
)brace
id|cond
op_assign
(paren
id|phy-&gt;mib-&gt;fddiPORTEBError_Ct
op_minus
id|phy-&gt;mib-&gt;fddiPORTOldEBError_Ct
OG
l_int|5
)paren
suffix:semicolon
multiline_comment|/* If ratio is more than 5 in 8 seconds&n;&t;&t;&t; * Set the condition.&n;&t;&t;&t; */
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_COND_PORT_EB_ERROR
comma
(paren
r_int
)paren
(paren
id|INDEX_PORT
op_plus
id|phy-&gt;np
)paren
comma
id|cond
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * set old values&n;&t;&t;&t; */
id|phy-&gt;mib-&gt;fddiPORTOldEBError_Ct
op_assign
id|phy-&gt;mib-&gt;fddiPORTEBError_Ct
suffix:semicolon
)brace
macro_line|#endif&t;/* no SLIM_SMT */
)brace
macro_line|#ifndef&t;SLIM_SMT
r_if
c_cond
(paren
id|time
op_minus
id|smc-&gt;sm.smt_last_notify
op_ge
(paren
id|u_long
)paren
(paren
id|smc-&gt;mib.fddiSMTTT_Notify
op_star
id|TICKS_PER_SECOND
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * we can either send an announcement or a request&n;&t;&t; * a request will trigger a reply so that we can update&n;&t;&t; * our dna&n;&t;&t; * note: same tid must be used until reply is received&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
)paren
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_send_nif
c_func
(paren
id|smc
comma
op_amp
id|fddi_broadcast
comma
id|FC_SMT_NSA
comma
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
comma
id|SMT_REQUEST
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;sm.smt_last_notify
op_assign
id|time
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * check timer&n;&t; */
r_if
c_cond
(paren
id|smc-&gt;sm.smt_tvu
op_logical_and
id|time
op_minus
id|smc-&gt;sm.smt_tvu
OG
l_int|228
op_star
id|TICKS_PER_SECOND
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : UNA expired&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;sm.smt_tvu
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
comma
op_amp
id|SMT_Unknown
)paren
)paren
(brace
multiline_comment|/* Do not update unknown address */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldUpstreamNbr
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUNDA_Flag
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Make sure the fddiMACUNDA_Flag = FALSE is&n;&t;&t; * included in the SRF so we don&squot;t generate&n;&t;&t; * a seperate SRF for the deassertion of this&n;&t;&t; * condition&n;&t;&t; */
id|update_dac
c_func
(paren
id|smc
comma
l_int|0
)paren
suffix:semicolon
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_MAC_NEIGHBOR_CHANGE
comma
id|INDEX_MAC
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|smc-&gt;sm.smt_tvd
op_logical_and
id|time
op_minus
id|smc-&gt;sm.smt_tvd
OG
l_int|228
op_star
id|TICKS_PER_SECOND
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : DNA expired&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;sm.smt_tvd
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
comma
op_amp
id|SMT_Unknown
)paren
)paren
(brace
multiline_comment|/* Do not update unknown address */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldDownstreamNbr
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_MAC_NEIGHBOR_CHANGE
comma
id|INDEX_MAC
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* no SLIM_SMT */
macro_line|#ifndef SMT_REAL_TOKEN_CT
multiline_comment|/*&n;&t; * Token counter emulation section. If hardware supports the token&n;&t; * count, the token counter will be updated in mac_update_counter.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
id|MAC0
suffix:semicolon
id|i
OL
id|NUMMACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|time
op_minus
id|smc-&gt;sm.last_tok_time
(braket
id|i
)braket
OG
l_int|2
op_star
id|TICKS_PER_SECOND
)paren
(brace
id|smt_emulate_token_ct
c_func
(paren
id|smc
comma
id|i
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|smt_timer_start
c_func
(paren
id|smc
comma
op_amp
id|smc-&gt;sm.smt_timer
comma
(paren
id|u_long
)paren
l_int|1000000L
comma
id|EV_TOKEN
c_func
(paren
id|EVENT_SMT
comma
id|SM_TIMER
)paren
)paren
suffix:semicolon
)brace
DECL|function|div_ratio
r_static
r_int
id|div_ratio
c_func
(paren
id|upper
comma
id|lower
)paren
id|u_long
id|upper
suffix:semicolon
id|u_long
id|lower
suffix:semicolon
(brace
r_if
c_cond
(paren
(paren
id|upper
op_lshift
l_int|16L
)paren
OL
id|upper
)paren
id|upper
op_assign
l_int|0xffff0000L
suffix:semicolon
r_else
id|upper
op_lshift_assign
l_int|16L
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lower
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_return
(paren
(paren
r_int
)paren
(paren
id|upper
op_div
id|lower
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifndef&t;SLIM_SMT
multiline_comment|/*&n; * receive packet handler&n; */
DECL|function|smt_received_pack
r_void
id|smt_received_pack
c_func
(paren
id|smc
comma
id|mb
comma
id|fs
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_int
id|fs
suffix:semicolon
multiline_comment|/* frame status */
(brace
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|local
suffix:semicolon
r_int
id|illegal
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|m_fc
c_func
(paren
id|mb
)paren
)paren
(brace
r_case
id|FC_SMT_INFO
suffix:colon
r_case
id|FC_SMT_LAN_LOC
suffix:colon
r_case
id|FC_SMT_LOC
suffix:colon
r_case
id|FC_SMT_NSA
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTCopied_Ct
op_increment
suffix:semicolon
id|sm
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|local
op_assign
(paren
(paren
id|fs
op_amp
id|L_INDICATOR
)paren
op_ne
l_int|0
)paren
suffix:semicolon
id|hwm_conv_can
c_func
(paren
id|smc
comma
(paren
r_char
op_star
)paren
id|sm
comma
l_int|12
)paren
suffix:semicolon
multiline_comment|/* check destination address */
r_if
c_cond
(paren
id|is_individual
c_func
(paren
op_amp
id|sm-&gt;smt_dest
)paren
op_logical_and
op_logical_neg
id|is_my_addr
c_func
(paren
id|smc
comma
op_amp
id|sm-&gt;smt_dest
)paren
)paren
(brace
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if&t;0&t;&t;/* for DUP recognition, do NOT filter them */
multiline_comment|/* ignore loop back packets */
r_if
c_cond
(paren
id|is_my_addr
c_func
(paren
id|smc
comma
op_amp
id|sm-&gt;smt_source
)paren
op_logical_and
op_logical_neg
id|local
)paren
(brace
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|smt_swap_para
c_func
(paren
id|sm
comma
(paren
r_int
)paren
id|mb-&gt;sm_len
comma
l_int|1
)paren
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : received packet [%s] at 0x%x&bslash;n&quot;
comma
id|smt_type_name
(braket
id|m_fc
c_func
(paren
id|mb
)paren
op_amp
l_int|0xf
)braket
comma
id|sm
)paren
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : version %d, class %s&bslash;n&quot;
comma
id|sm-&gt;smt_version
comma
id|smt_class_name
(braket
(paren
id|sm-&gt;smt_class
OG
id|LAST_CLASS
)paren
ques
c_cond
l_int|0
suffix:colon
id|sm-&gt;smt_class
)braket
)paren
suffix:semicolon
macro_line|#ifdef&t;SBA
multiline_comment|/*&n;&t; * check if NSA frame&n;&t; */
r_if
c_cond
(paren
id|m_fc
c_func
(paren
id|mb
)paren
op_eq
id|FC_SMT_NSA
op_logical_and
id|sm-&gt;smt_class
op_eq
id|SMT_NIF
op_logical_and
(paren
id|sm-&gt;smt_type
op_eq
id|SMT_ANNOUNCE
op_logical_or
id|sm-&gt;smt_type
op_eq
id|SMT_REQUEST
)paren
)paren
(brace
id|smc-&gt;sba.sm
op_assign
id|sm
suffix:semicolon
id|sba
c_func
(paren
id|smc
comma
id|NIF
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * ignore any packet with NSA and A-indicator set&n;&t; */
r_if
c_cond
(paren
(paren
id|fs
op_amp
id|A_INDICATOR
)paren
op_logical_and
id|m_fc
c_func
(paren
id|mb
)paren
op_eq
id|FC_SMT_NSA
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : ignoring NSA with A-indicator set from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * ignore frames with illegal length&n;&t; */
r_if
c_cond
(paren
(paren
(paren
id|sm-&gt;smt_class
op_eq
id|SMT_ECF
)paren
op_logical_and
(paren
id|sm-&gt;smt_len
OG
id|SMT_MAX_ECHO_LEN
)paren
)paren
op_logical_or
(paren
(paren
id|sm-&gt;smt_class
op_ne
id|SMT_ECF
)paren
op_logical_and
(paren
id|sm-&gt;smt_len
OG
id|SMT_MAX_INFO_LEN
)paren
)paren
)paren
(brace
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * check SMT version&n;&t; */
r_switch
c_cond
(paren
id|sm-&gt;smt_class
)paren
(brace
r_case
id|SMT_NIF
suffix:colon
r_case
id|SMT_SIF_CONFIG
suffix:colon
r_case
id|SMT_SIF_OPER
suffix:colon
r_case
id|SMT_ECF
suffix:colon
r_if
c_cond
(paren
id|sm-&gt;smt_version
op_ne
id|SMT_VID
)paren
id|illegal
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_if
c_cond
(paren
id|sm-&gt;smt_version
op_ne
id|SMT_VID_2
)paren
id|illegal
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|illegal
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : version = %d, dest = %s&bslash;n&quot;
comma
id|sm-&gt;smt_version
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
)paren
suffix:semicolon
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|mb
comma
id|m_fc
c_func
(paren
id|mb
)paren
comma
id|SMT_RDF_VERSION
comma
id|local
)paren
suffix:semicolon
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sm-&gt;smt_len
OG
id|mb-&gt;sm_len
op_minus
r_sizeof
(paren
r_struct
id|smt_header
)paren
)paren
op_logical_or
(paren
(paren
id|sm-&gt;smt_len
op_amp
l_int|3
)paren
op_logical_and
(paren
id|sm-&gt;smt_class
op_ne
id|SMT_ECF
)paren
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: info length error, len = %d&bslash;n&quot;
comma
id|sm-&gt;smt_len
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|mb
comma
id|m_fc
c_func
(paren
id|mb
)paren
comma
id|SMT_RDF_LENGTH
comma
id|local
)paren
suffix:semicolon
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sm-&gt;smt_class
)paren
(brace
r_case
id|SMT_NIF
suffix:colon
r_if
c_cond
(paren
id|smt_check_para
c_func
(paren
id|smc
comma
id|sm
comma
id|plist_nif
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: NIF with para problem, ignoring&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_switch
c_cond
(paren
id|sm-&gt;smt_type
)paren
(brace
r_case
id|SMT_ANNOUNCE
suffix:colon
r_case
id|SMT_REQUEST
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fs
op_amp
id|C_INDICATOR
)paren
op_logical_and
id|m_fc
c_func
(paren
id|mb
)paren
op_eq
id|FC_SMT_NSA
op_logical_and
id|is_broadcast
c_func
(paren
op_amp
id|sm-&gt;smt_dest
)paren
)paren
(brace
r_struct
id|smt_p_state
op_star
id|st
suffix:semicolon
multiline_comment|/* set my UNA */
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
comma
op_amp
id|sm-&gt;smt_source
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : updated my UNA = %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
comma
op_amp
id|SMT_Unknown
)paren
)paren
(brace
multiline_comment|/* Do not update unknown address */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldUpstreamNbr
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
op_assign
id|sm-&gt;smt_source
suffix:semicolon
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_MAC_NEIGHBOR_CHANGE
comma
id|INDEX_MAC
comma
l_int|0
)paren
suffix:semicolon
id|smt_echo_test
c_func
(paren
id|smc
comma
l_int|0
)paren
suffix:semicolon
)brace
id|smc-&gt;sm.smt_tvu
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|st
op_assign
(paren
r_struct
id|smt_p_state
op_star
)paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P_STATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st
)paren
(brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUNDA_Flag
op_assign
(paren
id|st-&gt;st_dupl_addr
op_amp
id|SMT_ST_MY_DUPA
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
id|update_dac
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|sm-&gt;smt_type
op_eq
id|SMT_REQUEST
)paren
op_logical_and
id|is_individual
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
op_logical_and
(paren
(paren
op_logical_neg
(paren
id|fs
op_amp
id|A_INDICATOR
)paren
op_logical_and
id|m_fc
c_func
(paren
id|mb
)paren
op_eq
id|FC_SMT_NSA
)paren
op_logical_or
(paren
id|m_fc
c_func
(paren
id|mb
)paren
op_ne
id|FC_SMT_NSA
)paren
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : replying to NIF request %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_nif
c_func
(paren
id|smc
comma
op_amp
id|sm-&gt;smt_source
comma
id|FC_SMT_INFO
comma
id|sm-&gt;smt_tid
comma
id|SMT_REPLY
comma
id|local
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_REPLY
suffix:colon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : received NIF response from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fs
op_amp
id|A_INDICATOR
)paren
(brace
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
op_assign
l_int|0
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : duplicate address&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDupAddressTest
op_assign
id|DA_FAILED
suffix:semicolon
id|smc-&gt;r.dup_addr_test
op_assign
id|DA_FAILED
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_RMT
comma
id|RM_DUP_ADDR
)paren
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDA_Flag
op_assign
id|TRUE
suffix:semicolon
id|update_dac
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;smt_tid
op_eq
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
)paren
(brace
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set my DNA */
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
comma
op_amp
id|sm-&gt;smt_source
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : updated my DNA&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_equal
c_func
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
comma
op_amp
id|SMT_Unknown
)paren
)paren
(brace
multiline_comment|/* Do not update unknown address */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldDownstreamNbr
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
op_assign
id|sm-&gt;smt_source
suffix:semicolon
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_MAC_NEIGHBOR_CHANGE
comma
id|INDEX_MAC
comma
l_int|0
)paren
suffix:semicolon
id|smt_echo_test
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
)brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDA_Flag
op_assign
id|FALSE
suffix:semicolon
id|update_dac
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|smc-&gt;sm.smt_tvd
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDupAddressTest
op_assign
id|DA_PASSED
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;r.dup_addr_test
op_ne
id|DA_PASSED
)paren
(brace
id|smc-&gt;r.dup_addr_test
op_assign
id|DA_PASSED
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_RMT
comma
id|RM_DUP_ADDR
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sm-&gt;smt_tid
op_eq
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF_TEST
)braket
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : NIF test TID ok&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : expected TID %lx, got %lx&bslash;n&quot;
comma
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF
)braket
comma
id|sm-&gt;smt_tid
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|illegal
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_SIF_CONFIG
suffix:colon
multiline_comment|/* station information */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
r_break
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : replying to SIF Config request from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_sif_config
c_func
(paren
id|smc
comma
op_amp
id|sm-&gt;smt_source
comma
id|sm-&gt;smt_tid
comma
id|local
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_SIF_OPER
suffix:colon
multiline_comment|/* station information */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
r_break
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : replying to SIF Operation request from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_sif_operation
c_func
(paren
id|smc
comma
op_amp
id|sm-&gt;smt_source
comma
id|sm-&gt;smt_tid
comma
id|local
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_ECF
suffix:colon
multiline_comment|/* echo frame */
r_switch
c_cond
(paren
id|sm-&gt;smt_type
)paren
(brace
r_case
id|SMT_REPLY
suffix:colon
id|smc-&gt;mib.priv.fddiPRIVECF_Reply_Rx
op_increment
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: received ECF reply from %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P_ECHODATA
)paren
op_eq
l_int|0
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: ECHODATA missing&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;smt_tid
op_eq
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF
)braket
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : ECF test TID ok&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sm-&gt;smt_tid
op_eq
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF_UNA
)braket
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : ECF test UNA ok&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sm-&gt;smt_tid
op_eq
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF_DNA
)braket
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : ECF test DNA ok&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : expected TID %lx, got %lx&bslash;n&quot;
comma
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF
)braket
comma
id|sm-&gt;smt_tid
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_REQUEST
suffix:colon
id|smc-&gt;mib.priv.fddiPRIVECF_Req_Rx
op_increment
suffix:semicolon
(brace
r_if
c_cond
(paren
id|sm-&gt;smt_len
op_logical_and
op_logical_neg
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|SMT_P_ECHODATA
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: ECF with para problem,sending RDF&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|mb
comma
id|m_fc
c_func
(paren
id|mb
)paren
comma
id|SMT_RDF_LENGTH
comma
id|local
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT - sending ECF reply to %s&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set destination addr.  &amp; reply */
id|sm-&gt;smt_dest
op_assign
id|sm-&gt;smt_source
suffix:semicolon
id|sm-&gt;smt_type
op_assign
id|SMT_REPLY
suffix:semicolon
id|dump_smt
c_func
(paren
id|smc
comma
id|sm
comma
l_string|&quot;ECF REPLY&quot;
)paren
suffix:semicolon
id|smc-&gt;mib.priv.fddiPRIVECF_Reply_Tx
op_increment
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
id|local
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* DON&squot;T free mbuf */
)brace
r_default
suffix:colon
id|illegal
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#ifndef&t;BOOT
r_case
id|SMT_RAF
suffix:colon
multiline_comment|/* resource allocation */
macro_line|#ifdef&t;ESS
id|DB_ESSN
c_func
(paren
l_int|2
comma
l_string|&quot;ESS: RAF frame received&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|fs
op_assign
id|ess_raf_received_pack
c_func
(paren
id|smc
comma
id|mb
comma
id|sm
comma
id|fs
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;SBA
id|DB_SBAN
c_func
(paren
l_int|2
comma
l_string|&quot;SBA: RAF frame received&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sba_raf_received_pack
c_func
(paren
id|smc
comma
id|sm
comma
id|fs
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|SMT_RDF
suffix:colon
multiline_comment|/* request denied */
id|smc-&gt;mib.priv.fddiPRIVRDF_Rx
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_ESF
suffix:colon
multiline_comment|/* extended service - not supported */
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_eq
id|SMT_REQUEST
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT - received ESF, sending RDF&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|mb
comma
id|m_fc
c_func
(paren
id|mb
)paren
comma
id|SMT_RDF_CLASS
comma
id|local
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_PMF_GET
suffix:colon
r_case
id|SMT_PMF_SET
suffix:colon
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
r_break
suffix:semicolon
multiline_comment|/* update statistics */
r_if
c_cond
(paren
id|sm-&gt;smt_class
op_eq
id|SMT_PMF_GET
)paren
id|smc-&gt;mib.priv.fddiPRIVPMF_Get_Rx
op_increment
suffix:semicolon
r_else
id|smc-&gt;mib.priv.fddiPRIVPMF_Set_Rx
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; * ignore PMF SET with I/G set&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|sm-&gt;smt_class
op_eq
id|SMT_PMF_SET
)paren
op_logical_and
op_logical_neg
id|is_individual
c_func
(paren
op_amp
id|sm-&gt;smt_dest
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: ignoring PMF-SET with I/G set&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|smt_pmf_received_pack
c_func
(paren
id|smc
comma
id|mb
comma
id|local
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_SRF
suffix:colon
id|dump_smt
c_func
(paren
id|smc
comma
id|sm
comma
l_string|&quot;SRF received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t; * For frames with unknown class:&n;&t;&t; * we need to send a RDF frame according to 8.1.3.1.1,&n;&t;&t; * only if it is a REQUEST.&n;&t;&t; */
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : class = %d, send RDF to %s&bslash;n&quot;
comma
id|sm-&gt;smt_class
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
)paren
suffix:semicolon
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|mb
comma
id|m_fc
c_func
(paren
id|mb
)paren
comma
id|SMT_RDF_CLASS
comma
id|local
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|illegal
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: discarding illegal frame, reason = %d&bslash;n&quot;
comma
id|illegal
comma
l_int|0
)paren
suffix:semicolon
)brace
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
)brace
DECL|function|update_dac
r_static
r_void
id|update_dac
c_func
(paren
id|smc
comma
id|report
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|report
suffix:semicolon
(brace
r_int
id|cond
suffix:semicolon
id|cond
op_assign
(paren
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUNDA_Flag
op_or
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDA_Flag
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|report
op_logical_and
(paren
id|cond
op_ne
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDuplicateAddressCond
)paren
)paren
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_COND_MAC_DUP_ADDR
comma
id|INDEX_MAC
comma
id|cond
)paren
suffix:semicolon
r_else
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDuplicateAddressCond
op_assign
id|cond
suffix:semicolon
)brace
multiline_comment|/*&n; * send SMT frame&n; *&t;set source address&n; *&t;set station ID&n; *&t;send frame&n; */
DECL|function|smt_send_frame
id|EXPORT_PMF
r_void
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|fc
comma
id|local
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
multiline_comment|/* buffer to send */
r_int
id|fc
suffix:semicolon
multiline_comment|/* FC value */
r_int
id|local
suffix:semicolon
(brace
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;r.sm_ma_avail
op_logical_and
op_logical_neg
id|local
)paren
(brace
id|smt_free_mbuf
c_func
(paren
id|smc
comma
id|mb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sm
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|sm-&gt;smt_source
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress
suffix:semicolon
id|sm-&gt;smt_sid
op_assign
id|smc-&gt;mib.fddiSMTStationId
suffix:semicolon
id|smt_swap_para
c_func
(paren
id|sm
comma
(paren
r_int
)paren
id|mb-&gt;sm_len
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* swap para &amp; header */
id|hwm_conv_can
c_func
(paren
id|smc
comma
(paren
r_char
op_star
)paren
id|sm
comma
l_int|12
)paren
suffix:semicolon
multiline_comment|/* convert SA and DA */
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTTransmit_Ct
op_increment
suffix:semicolon
id|smt_send_mbuf
c_func
(paren
id|smc
comma
id|mb
comma
id|local
ques
c_cond
id|FC_SMT_LOC
suffix:colon
id|fc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * generate and send RDF&n; */
DECL|function|smt_send_rdf
r_static
r_void
id|smt_send_rdf
c_func
(paren
id|smc
comma
id|rej
comma
id|fc
comma
id|reason
comma
id|local
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|SMbuf
op_star
id|rej
suffix:semicolon
multiline_comment|/* mbuf of offending frame */
r_int
id|fc
suffix:semicolon
multiline_comment|/* FC of denied frame */
r_int
id|reason
suffix:semicolon
multiline_comment|/* reason code */
r_int
id|local
suffix:semicolon
(brace
id|SMbuf
op_star
id|mb
suffix:semicolon
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
multiline_comment|/* header of offending frame */
r_struct
id|smt_rdf
op_star
id|rdf
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|frame_len
suffix:semicolon
id|sm
op_assign
id|smtod
c_func
(paren
id|rej
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;smt_type
op_ne
id|SMT_REQUEST
)paren
r_return
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: sending RDF to %s,reason = 0x%x&bslash;n&quot;
comma
id|addr_to_string
c_func
(paren
op_amp
id|sm-&gt;smt_source
)paren
comma
id|reason
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * note: get framelength from MAC length, NOT from SMT header&n;&t; * smt header length is included in sm_len&n;&t; */
id|frame_len
op_assign
id|rej-&gt;sm_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_RDF
comma
id|SMT_REPLY
comma
r_sizeof
(paren
r_struct
id|smt_rdf
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
id|rdf
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_rdf
op_star
)paren
suffix:semicolon
id|rdf-&gt;smt.smt_tid
op_assign
id|sm-&gt;smt_tid
suffix:semicolon
multiline_comment|/* use TID from sm */
id|rdf-&gt;smt.smt_dest
op_assign
id|sm-&gt;smt_source
suffix:semicolon
multiline_comment|/* set dest = source */
multiline_comment|/* set P12 */
id|rdf-&gt;reason.para.p_type
op_assign
id|SMT_P_REASON
suffix:semicolon
id|rdf-&gt;reason.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_reason
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|rdf-&gt;reason.rdf_reason
op_assign
id|reason
suffix:semicolon
multiline_comment|/* set P14 */
id|rdf-&gt;version.para.p_type
op_assign
id|SMT_P_VERSION
suffix:semicolon
id|rdf-&gt;version.para.p_len
op_assign
r_sizeof
(paren
r_struct
id|smt_p_version
)paren
op_minus
id|PARA_LEN
suffix:semicolon
id|rdf-&gt;version.v_pad
op_assign
l_int|0
suffix:semicolon
id|rdf-&gt;version.v_n
op_assign
l_int|1
suffix:semicolon
id|rdf-&gt;version.v_index
op_assign
l_int|1
suffix:semicolon
id|rdf-&gt;version.v_version
(braket
l_int|0
)braket
op_assign
id|SMT_VID_2
suffix:semicolon
id|rdf-&gt;version.v_pad2
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set P13 */
r_if
c_cond
(paren
(paren
r_int
)paren
id|frame_len
op_le
id|SMT_MAX_INFO_LEN
op_minus
r_sizeof
(paren
op_star
id|rdf
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|smt_header
)paren
)paren
id|len
op_assign
id|frame_len
suffix:semicolon
r_else
id|len
op_assign
id|SMT_MAX_INFO_LEN
op_minus
r_sizeof
(paren
op_star
id|rdf
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|smt_header
)paren
suffix:semicolon
multiline_comment|/* make length multiple of 4 */
id|len
op_and_assign
op_complement
l_int|3
suffix:semicolon
id|rdf-&gt;refused.para.p_type
op_assign
id|SMT_P_REFUSED
suffix:semicolon
multiline_comment|/* length of para is smt_frame + ref_fc */
id|rdf-&gt;refused.para.p_len
op_assign
id|len
op_plus
l_int|4
suffix:semicolon
id|rdf-&gt;refused.ref_fc
op_assign
id|fc
suffix:semicolon
multiline_comment|/* swap it back */
id|smt_swap_para
c_func
(paren
id|sm
comma
id|frame_len
comma
l_int|0
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|rdf-&gt;refused.ref_header
comma
(paren
r_char
op_star
)paren
id|sm
comma
id|len
)paren
suffix:semicolon
id|len
op_sub_assign
r_sizeof
(paren
r_struct
id|smt_header
)paren
suffix:semicolon
id|mb-&gt;sm_len
op_add_assign
id|len
suffix:semicolon
id|rdf-&gt;smt.smt_len
op_add_assign
id|len
suffix:semicolon
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|rdf
comma
l_string|&quot;RDF&quot;
)paren
suffix:semicolon
id|smc-&gt;mib.priv.fddiPRIVRDF_Tx
op_increment
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
id|local
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * generate and send NIF&n; */
DECL|function|smt_send_nif
r_static
r_void
id|smt_send_nif
c_func
(paren
id|smc
comma
id|dest
comma
id|fc
comma
id|tid
comma
id|type
comma
id|local
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
multiline_comment|/* dest address */
r_int
id|fc
suffix:semicolon
multiline_comment|/* frame control */
id|u_long
id|tid
suffix:semicolon
multiline_comment|/* transaction id */
r_int
id|type
suffix:semicolon
multiline_comment|/* frame type */
r_int
id|local
suffix:semicolon
(brace
r_struct
id|smt_nif
op_star
id|nif
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_NIF
comma
id|type
comma
r_sizeof
(paren
r_struct
id|smt_nif
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
id|nif
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_nif
op_star
)paren
suffix:semicolon
id|smt_fill_una
c_func
(paren
id|smc
comma
op_amp
id|nif-&gt;una
)paren
suffix:semicolon
multiline_comment|/* set UNA */
id|smt_fill_sde
c_func
(paren
id|smc
comma
op_amp
id|nif-&gt;sde
)paren
suffix:semicolon
multiline_comment|/* set station descriptor */
id|smt_fill_state
c_func
(paren
id|smc
comma
op_amp
id|nif-&gt;state
)paren
suffix:semicolon
multiline_comment|/* set state information */
macro_line|#ifdef&t;SMT6_10
id|smt_fill_fsc
c_func
(paren
id|smc
comma
op_amp
id|nif-&gt;fsc
)paren
suffix:semicolon
multiline_comment|/* set frame status cap. */
macro_line|#endif
id|nif-&gt;smt.smt_dest
op_assign
op_star
id|dest
suffix:semicolon
multiline_comment|/* destination address */
id|nif-&gt;smt.smt_tid
op_assign
id|tid
suffix:semicolon
multiline_comment|/* transaction ID */
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|nif
comma
l_string|&quot;NIF&quot;
)paren
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|fc
comma
id|local
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;DEBUG
multiline_comment|/*&n; * send NIF request (test purpose)&n; */
DECL|function|smt_send_nif_request
r_static
r_void
id|smt_send_nif_request
c_func
(paren
id|smc
comma
id|dest
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
(brace
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF_TEST
)braket
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_send_nif
c_func
(paren
id|smc
comma
id|dest
comma
id|FC_SMT_INFO
comma
id|smc-&gt;sm.pend
(braket
id|SMT_TID_NIF_TEST
)braket
comma
id|SMT_REQUEST
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * send ECF request (test purpose)&n; */
DECL|function|smt_send_ecf_request
r_static
r_void
id|smt_send_ecf_request
c_func
(paren
id|smc
comma
id|dest
comma
id|len
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF
)braket
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_send_ecf
c_func
(paren
id|smc
comma
id|dest
comma
id|FC_SMT_INFO
comma
id|smc-&gt;sm.pend
(braket
id|SMT_TID_ECF
)braket
comma
id|SMT_REQUEST
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * echo test&n; */
DECL|function|smt_echo_test
r_static
r_void
id|smt_echo_test
c_func
(paren
id|smc
comma
id|dna
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|dna
suffix:semicolon
(brace
id|u_long
id|tid
suffix:semicolon
id|smc-&gt;sm.pend
(braket
id|dna
ques
c_cond
id|SMT_TID_ECF_DNA
suffix:colon
id|SMT_TID_ECF_UNA
)braket
op_assign
id|tid
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
id|smt_send_ecf
c_func
(paren
id|smc
comma
id|dna
ques
c_cond
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
suffix:colon
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
comma
id|FC_SMT_INFO
comma
id|tid
comma
id|SMT_REQUEST
comma
(paren
id|SMT_TEST_ECHO_LEN
op_amp
op_complement
l_int|3
)paren
op_minus
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * generate and send ECF&n; */
DECL|function|smt_send_ecf
r_static
r_void
id|smt_send_ecf
c_func
(paren
id|smc
comma
id|dest
comma
id|fc
comma
id|tid
comma
id|type
comma
id|len
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
multiline_comment|/* dest address */
r_int
id|fc
suffix:semicolon
multiline_comment|/* frame control */
id|u_long
id|tid
suffix:semicolon
multiline_comment|/* transaction id */
r_int
id|type
suffix:semicolon
multiline_comment|/* frame type */
r_int
id|len
suffix:semicolon
multiline_comment|/* frame length */
(brace
r_struct
id|smt_ecf
op_star
id|ecf
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_ECF
comma
id|type
comma
id|SMT_ECF_LEN
op_plus
id|len
)paren
)paren
)paren
r_return
suffix:semicolon
id|ecf
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_ecf
op_star
)paren
suffix:semicolon
id|smt_fill_echo
c_func
(paren
id|smc
comma
op_amp
id|ecf-&gt;ec_echo
comma
id|tid
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* set ECHO */
id|ecf-&gt;smt.smt_dest
op_assign
op_star
id|dest
suffix:semicolon
multiline_comment|/* destination address */
id|ecf-&gt;smt.smt_tid
op_assign
id|tid
suffix:semicolon
multiline_comment|/* transaction ID */
id|smc-&gt;mib.priv.fddiPRIVECF_Req_Tx
op_increment
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|fc
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * generate and send SIF config response&n; */
DECL|function|smt_send_sif_config
r_static
r_void
id|smt_send_sif_config
c_func
(paren
id|smc
comma
id|dest
comma
id|tid
comma
id|local
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
multiline_comment|/* dest address */
id|u_long
id|tid
suffix:semicolon
multiline_comment|/* transaction id */
r_int
id|local
suffix:semicolon
(brace
r_struct
id|smt_sif_config
op_star
id|sif
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_SIF_CONFIG
comma
id|SMT_REPLY
comma
id|SIZEOF_SMT_SIF_CONFIG
)paren
)paren
)paren
r_return
suffix:semicolon
id|sif
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_sif_config
op_star
)paren
suffix:semicolon
id|smt_fill_timestamp
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;ts
)paren
suffix:semicolon
multiline_comment|/* set time stamp */
id|smt_fill_sde
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;sde
)paren
suffix:semicolon
multiline_comment|/* set station descriptor */
id|smt_fill_version
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;version
)paren
suffix:semicolon
multiline_comment|/* set version information */
id|smt_fill_state
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;state
)paren
suffix:semicolon
multiline_comment|/* set state information */
id|smt_fill_policy
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;policy
)paren
suffix:semicolon
multiline_comment|/* set station policy */
id|smt_fill_latency
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;latency
)paren
suffix:semicolon
multiline_comment|/* set station latency */
id|smt_fill_neighbor
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;neighbor
)paren
suffix:semicolon
multiline_comment|/* set station neighbor */
id|smt_fill_setcount
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;setcount
)paren
suffix:semicolon
multiline_comment|/* set count */
id|len
op_assign
id|smt_fill_path
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;path
)paren
suffix:semicolon
multiline_comment|/* set station path descriptor*/
id|sif-&gt;smt.smt_dest
op_assign
op_star
id|dest
suffix:semicolon
multiline_comment|/* destination address */
id|sif-&gt;smt.smt_tid
op_assign
id|tid
suffix:semicolon
multiline_comment|/* transaction ID */
id|smt_add_frame_len
c_func
(paren
id|mb
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* adjust length fields */
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|sif
comma
l_string|&quot;SIF Configuration Reply&quot;
)paren
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
id|local
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * generate and send SIF operation response&n; */
DECL|function|smt_send_sif_operation
r_static
r_void
id|smt_send_sif_operation
c_func
(paren
id|smc
comma
id|dest
comma
id|tid
comma
id|local
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
multiline_comment|/* dest address */
id|u_long
id|tid
suffix:semicolon
multiline_comment|/* transaction id */
r_int
id|local
suffix:semicolon
(brace
r_struct
id|smt_sif_operation
op_star
id|sif
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_int
id|ports
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ports
op_assign
id|NUMPHYS
suffix:semicolon
macro_line|#ifndef&t;CONCENTRATOR
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
)paren
id|ports
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_SIF_OPER
comma
id|SMT_REPLY
comma
id|SIZEOF_SMT_SIF_OPERATION
op_plus
id|ports
op_star
r_sizeof
(paren
r_struct
id|smt_p_lem
)paren
)paren
)paren
)paren
r_return
suffix:semicolon
id|sif
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_sif_operation
op_star
)paren
suffix:semicolon
id|smt_fill_timestamp
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;ts
)paren
suffix:semicolon
multiline_comment|/* set time stamp */
id|smt_fill_mac_status
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;status
)paren
suffix:semicolon
multiline_comment|/* set mac status */
id|smt_fill_mac_counter
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;mc
)paren
suffix:semicolon
multiline_comment|/* set mac counter field */
id|smt_fill_mac_fnc
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;fnc
)paren
suffix:semicolon
multiline_comment|/* set frame not copied counter */
id|smt_fill_manufacturer
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;man
)paren
suffix:semicolon
multiline_comment|/* set manufacturer field */
id|smt_fill_user
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;user
)paren
suffix:semicolon
multiline_comment|/* set user field */
id|smt_fill_setcount
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;setcount
)paren
suffix:semicolon
multiline_comment|/* set count */
multiline_comment|/*&n;&t; * set link error mon information&n;&t; */
r_if
c_cond
(paren
id|ports
op_eq
l_int|1
)paren
(brace
id|smt_fill_lem
c_func
(paren
id|smc
comma
id|sif-&gt;lem
comma
id|PS
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ports
suffix:semicolon
id|i
op_increment
)paren
(brace
id|smt_fill_lem
c_func
(paren
id|smc
comma
op_amp
id|sif-&gt;lem
(braket
id|i
)braket
comma
id|i
)paren
suffix:semicolon
)brace
)brace
id|sif-&gt;smt.smt_dest
op_assign
op_star
id|dest
suffix:semicolon
multiline_comment|/* destination address */
id|sif-&gt;smt.smt_tid
op_assign
id|tid
suffix:semicolon
multiline_comment|/* transaction ID */
id|dump_smt
c_func
(paren
id|smc
comma
(paren
r_struct
id|smt_header
op_star
)paren
id|sif
comma
l_string|&quot;SIF Operation Reply&quot;
)paren
suffix:semicolon
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
id|local
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * get and initialize SMT frame&n; */
DECL|function|smt_build_frame
id|EXPORT_PMF
id|SMbuf
op_star
id|smt_build_frame
c_func
(paren
id|smc
comma
r_class
comma
id|type
comma
id|length
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
r_class
suffix:semicolon
r_int
id|type
suffix:semicolon
r_int
id|length
suffix:semicolon
(brace
id|SMbuf
op_star
id|mb
suffix:semicolon
r_struct
id|smt_header
op_star
id|smt
suffix:semicolon
macro_line|#if&t;0
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;r.sm_ma_avail
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_get_mbuf
c_func
(paren
id|smc
)paren
)paren
)paren
r_return
(paren
id|mb
)paren
suffix:semicolon
id|mb-&gt;sm_len
op_assign
id|length
suffix:semicolon
id|smt
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|smt-&gt;smt_dest
op_assign
id|fddi_broadcast
suffix:semicolon
multiline_comment|/* set dest = broadcast */
id|smt-&gt;smt_class
op_assign
r_class
suffix:semicolon
id|smt-&gt;smt_type
op_assign
id|type
suffix:semicolon
r_switch
c_cond
(paren
r_class
)paren
(brace
r_case
id|SMT_NIF
suffix:colon
r_case
id|SMT_SIF_CONFIG
suffix:colon
r_case
id|SMT_SIF_OPER
suffix:colon
r_case
id|SMT_ECF
suffix:colon
id|smt-&gt;smt_version
op_assign
id|SMT_VID
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|smt-&gt;smt_version
op_assign
id|SMT_VID_2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|smt-&gt;smt_tid
op_assign
id|smt_get_tid
c_func
(paren
id|smc
)paren
suffix:semicolon
multiline_comment|/* set transaction ID */
id|smt-&gt;smt_pad
op_assign
l_int|0
suffix:semicolon
id|smt-&gt;smt_len
op_assign
id|length
op_minus
r_sizeof
(paren
r_struct
id|smt_header
)paren
suffix:semicolon
r_return
(paren
id|mb
)paren
suffix:semicolon
)brace
DECL|function|smt_add_frame_len
r_static
r_void
id|smt_add_frame_len
c_func
(paren
id|mb
comma
id|len
)paren
id|SMbuf
op_star
id|mb
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
r_struct
id|smt_header
op_star
id|smt
suffix:semicolon
id|smt
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|smt-&gt;smt_len
op_add_assign
id|len
suffix:semicolon
id|mb-&gt;sm_len
op_add_assign
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in UNA parameter&n; */
DECL|function|smt_fill_una
r_static
r_void
id|smt_fill_una
c_func
(paren
id|smc
comma
id|una
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_una
op_star
id|una
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|una
comma
id|SMT_P_UNA
)paren
suffix:semicolon
id|una-&gt;una_pad
op_assign
l_int|0
suffix:semicolon
id|una-&gt;una_node
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in SDE parameter&n; */
DECL|function|smt_fill_sde
r_static
r_void
id|smt_fill_sde
c_func
(paren
id|smc
comma
id|sde
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_sde
op_star
id|sde
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|sde
comma
id|SMT_P_SDE
)paren
suffix:semicolon
id|sde-&gt;sde_non_master
op_assign
id|smc-&gt;mib.fddiSMTNonMaster_Ct
suffix:semicolon
id|sde-&gt;sde_master
op_assign
id|smc-&gt;mib.fddiSMTMaster_Ct
suffix:semicolon
id|sde-&gt;sde_mac_count
op_assign
id|NUMMACS
suffix:semicolon
multiline_comment|/* only 1 MAC */
macro_line|#ifdef&t;CONCENTRATOR
id|sde-&gt;sde_type
op_assign
id|SMT_SDE_CONCENTRATOR
suffix:semicolon
macro_line|#else
id|sde-&gt;sde_type
op_assign
id|SMT_SDE_STATION
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * fill in values in station state parameter&n; */
DECL|function|smt_fill_state
r_static
r_void
id|smt_fill_state
c_func
(paren
id|smc
comma
id|state
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_state
op_star
id|state
suffix:semicolon
(brace
r_int
id|top
suffix:semicolon
r_int
id|twist
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|state
comma
id|SMT_P_STATE
)paren
suffix:semicolon
id|state-&gt;st_pad
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* determine topology */
id|top
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;mib.fddiSMTPeerWrapFlag
)paren
(brace
id|top
op_or_assign
id|SMT_ST_WRAPPED
suffix:semicolon
multiline_comment|/* state wrapped */
)brace
macro_line|#ifdef&t;CONCENTRATOR
r_if
c_cond
(paren
id|cfm_status_unattached
c_func
(paren
id|smc
)paren
)paren
(brace
id|top
op_or_assign
id|SMT_ST_UNATTACHED
suffix:semicolon
multiline_comment|/* unattached concentrator */
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|twist
op_assign
id|pcm_status_twisted
c_func
(paren
id|smc
)paren
)paren
op_amp
l_int|1
)paren
(brace
id|top
op_or_assign
id|SMT_ST_TWISTED_A
suffix:semicolon
multiline_comment|/* twisted cable */
)brace
r_if
c_cond
(paren
id|twist
op_amp
l_int|2
)paren
(brace
id|top
op_or_assign
id|SMT_ST_TWISTED_B
suffix:semicolon
multiline_comment|/* twisted cable */
)brace
macro_line|#ifdef&t;OPT_SRF
id|top
op_or_assign
id|SMT_ST_SRF
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pcm_rooted_station
c_func
(paren
id|smc
)paren
)paren
id|top
op_or_assign
id|SMT_ST_ROOTED_S
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;mib.a
(braket
l_int|0
)braket
dot
id|fddiPATHSbaPayload
op_ne
l_int|0
)paren
id|top
op_or_assign
id|SMT_ST_SYNC_SERVICE
suffix:semicolon
id|state-&gt;st_topology
op_assign
id|top
suffix:semicolon
id|state-&gt;st_dupl_addr
op_assign
(paren
(paren
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDA_Flag
ques
c_cond
id|SMT_ST_MY_DUPA
suffix:colon
l_int|0
)paren
op_or
(paren
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUNDA_Flag
ques
c_cond
id|SMT_ST_UNA_DUPA
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in timestamp parameter&n; */
DECL|function|smt_fill_timestamp
r_static
r_void
id|smt_fill_timestamp
c_func
(paren
id|smc
comma
id|ts
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_timestamp
op_star
id|ts
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|ts
comma
id|SMT_P_TIMESTAMP
)paren
suffix:semicolon
id|smt_set_timestamp
c_func
(paren
id|smc
comma
id|ts-&gt;ts_time
)paren
suffix:semicolon
)brace
DECL|function|smt_set_timestamp
id|EXPORT_PMF
r_void
id|smt_set_timestamp
c_func
(paren
id|smc
comma
id|p
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
(brace
id|u_long
id|time
suffix:semicolon
id|u_long
id|utime
suffix:semicolon
multiline_comment|/*&n;&t; * timestamp is 64 bits long ; resolution is 80 nS&n;&t; * our clock resolution is 10mS&n;&t; * 10mS/80ns = 125000 ~ 2^17 = 131072&n;&t; */
id|utime
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|time
op_assign
id|utime
op_star
l_int|100
suffix:semicolon
id|time
op_div_assign
id|TICKS_PER_SECOND
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
(paren
id|u_char
)paren
(paren
(paren
id|time
op_rshift
(paren
l_int|8
op_plus
l_int|8
op_plus
l_int|8
op_plus
l_int|8
op_minus
l_int|1
)paren
)paren
op_amp
l_int|1
)paren
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
(paren
id|u_char
)paren
(paren
id|time
op_rshift
(paren
l_int|8
op_plus
l_int|8
op_plus
l_int|8
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
(paren
id|u_char
)paren
(paren
id|time
op_rshift
(paren
l_int|8
op_plus
l_int|8
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|p
(braket
l_int|4
)braket
op_assign
(paren
id|u_char
)paren
(paren
id|time
op_rshift
(paren
l_int|8
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|p
(braket
l_int|5
)braket
op_assign
(paren
id|u_char
)paren
(paren
id|time
op_lshift
l_int|1
)paren
suffix:semicolon
id|p
(braket
l_int|6
)braket
op_assign
(paren
id|u_char
)paren
(paren
id|smc-&gt;sm.uniq_ticks
op_rshift
l_int|8
)paren
suffix:semicolon
id|p
(braket
l_int|7
)braket
op_assign
(paren
id|u_char
)paren
id|smc-&gt;sm.uniq_ticks
suffix:semicolon
multiline_comment|/*&n;&t; * make sure we don&squot;t wrap: restart whenever the upper digits change&n;&t; */
r_if
c_cond
(paren
id|utime
op_ne
id|smc-&gt;sm.uniq_time
)paren
(brace
id|smc-&gt;sm.uniq_ticks
op_assign
l_int|0
suffix:semicolon
)brace
id|smc-&gt;sm.uniq_ticks
op_increment
suffix:semicolon
id|smc-&gt;sm.uniq_time
op_assign
id|utime
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in station policy parameter&n; */
DECL|function|smt_fill_policy
r_static
r_void
id|smt_fill_policy
c_func
(paren
id|smc
comma
id|policy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_policy
op_star
id|policy
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
id|u_char
op_star
id|map
suffix:semicolon
id|u_short
id|in
suffix:semicolon
id|u_short
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * MIB para 101b (fddiSMTConnectionPolicy) coding&n;&t; * is different from 0005 coding&n;&t; */
r_static
id|u_char
id|ansi_weirdness
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|7
comma
l_int|5
comma
l_int|3
comma
l_int|8
comma
l_int|1
comma
l_int|6
comma
l_int|4
comma
l_int|9
comma
l_int|10
comma
l_int|2
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
)brace
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|policy
comma
id|SMT_P_POLICY
)paren
suffix:semicolon
id|out
op_assign
l_int|0
suffix:semicolon
id|in
op_assign
id|smc-&gt;mib.fddiSMTConnectionPolicy
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|map
op_assign
id|ansi_weirdness
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|in
op_amp
l_int|1
)paren
id|out
op_or_assign
(paren
l_int|1
op_lshift
op_star
id|map
)paren
suffix:semicolon
id|in
op_rshift_assign
l_int|1
suffix:semicolon
id|map
op_increment
suffix:semicolon
)brace
id|policy-&gt;pl_config
op_assign
id|smc-&gt;mib.fddiSMTConfigPolicy
suffix:semicolon
id|policy-&gt;pl_connect
op_assign
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in latency equivalent parameter&n; */
DECL|function|smt_fill_latency
r_static
r_void
id|smt_fill_latency
c_func
(paren
id|smc
comma
id|latency
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_latency
op_star
id|latency
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|latency
comma
id|SMT_P_LATENCY
)paren
suffix:semicolon
id|latency-&gt;lt_phyout_idx1
op_assign
id|phy_index
c_func
(paren
id|smc
comma
l_int|0
)paren
suffix:semicolon
id|latency-&gt;lt_latency1
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* in octets (byte clock) */
multiline_comment|/*&n;&t; * note: latency has two phy entries by definition&n;&t; * for a SAS, the 2nd one is null&n;&t; */
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_DAS
)paren
(brace
id|latency-&gt;lt_phyout_idx2
op_assign
id|phy_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|latency-&gt;lt_latency2
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* in octets (byte clock) */
)brace
r_else
(brace
id|latency-&gt;lt_phyout_idx2
op_assign
l_int|0
suffix:semicolon
id|latency-&gt;lt_latency2
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * fill values in MAC neighbors parameter&n; */
DECL|function|smt_fill_neighbor
r_static
r_void
id|smt_fill_neighbor
c_func
(paren
id|smc
comma
id|neighbor
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_neighbor
op_star
id|neighbor
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|neighbor
comma
id|SMT_P_NEIGHBORS
)paren
suffix:semicolon
id|neighbor-&gt;nb_mib_index
op_assign
id|INDEX_MAC
suffix:semicolon
id|neighbor-&gt;nb_mac_index
op_assign
id|mac_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|neighbor-&gt;nb_una
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
suffix:semicolon
id|neighbor-&gt;nb_dna
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in path descriptor&n; */
macro_line|#ifdef&t;CONCENTRATOR
DECL|macro|ALLPHYS
mdefine_line|#define ALLPHYS&t;NUMPHYS
macro_line|#else
DECL|macro|ALLPHYS
mdefine_line|#define ALLPHYS&t;((smc-&gt;s.sas == SMT_SAS) ? 1 : 2)
macro_line|#endif
DECL|function|smt_fill_path
r_static
r_int
id|smt_fill_path
c_func
(paren
id|smc
comma
id|path
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_path
op_star
id|path
suffix:semicolon
(brace
id|SK_LOC_DECL
c_func
(paren
r_int
comma
id|type
)paren
suffix:semicolon
id|SK_LOC_DECL
c_func
(paren
r_int
comma
id|state
)paren
suffix:semicolon
id|SK_LOC_DECL
c_func
(paren
r_int
comma
id|remote
)paren
suffix:semicolon
id|SK_LOC_DECL
c_func
(paren
r_int
comma
id|mac
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|p
suffix:semicolon
r_int
id|physp
suffix:semicolon
r_struct
id|smt_phy_rec
op_star
id|phy
suffix:semicolon
r_struct
id|smt_mac_rec
op_star
id|pd_mac
suffix:semicolon
id|len
op_assign
id|PARA_LEN
op_plus
r_sizeof
(paren
r_struct
id|smt_mac_rec
)paren
op_star
id|NUMMACS
op_plus
r_sizeof
(paren
r_struct
id|smt_phy_rec
)paren
op_star
id|ALLPHYS
suffix:semicolon
id|path-&gt;para.p_type
op_assign
id|SMT_P_PATH
suffix:semicolon
id|path-&gt;para.p_len
op_assign
id|len
op_minus
id|PARA_LEN
suffix:semicolon
multiline_comment|/* PHYs */
r_for
c_loop
(paren
id|p
op_assign
l_int|0
comma
id|phy
op_assign
id|path-&gt;pd_phy
suffix:semicolon
id|p
OL
id|ALLPHYS
suffix:semicolon
id|p
op_increment
comma
id|phy
op_increment
)paren
(brace
id|physp
op_assign
id|p
suffix:semicolon
macro_line|#ifndef&t;CONCENTRATOR
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
)paren
id|physp
op_assign
id|PS
suffix:semicolon
macro_line|#endif
id|pcm_status_state
c_func
(paren
id|smc
comma
id|physp
comma
op_amp
id|type
comma
op_amp
id|state
comma
op_amp
id|remote
comma
op_amp
id|mac
)paren
suffix:semicolon
macro_line|#ifdef&t;LITTLE_ENDIAN
id|phy-&gt;phy_mib_index
op_assign
id|smt_swap_short
c_func
(paren
(paren
id|u_short
)paren
id|p
op_plus
id|INDEX_PORT
)paren
suffix:semicolon
macro_line|#else
id|phy-&gt;phy_mib_index
op_assign
id|p
op_plus
id|INDEX_PORT
suffix:semicolon
macro_line|#endif
id|phy-&gt;phy_type
op_assign
id|type
suffix:semicolon
id|phy-&gt;phy_connect_state
op_assign
id|state
suffix:semicolon
id|phy-&gt;phy_remote_type
op_assign
id|remote
suffix:semicolon
id|phy-&gt;phy_remote_mac
op_assign
id|mac
suffix:semicolon
id|phy-&gt;phy_resource_idx
op_assign
id|phy_con_resource_index
c_func
(paren
id|smc
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* MAC */
id|pd_mac
op_assign
(paren
r_struct
id|smt_mac_rec
op_star
)paren
id|phy
suffix:semicolon
id|pd_mac-&gt;mac_addr
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress
suffix:semicolon
id|pd_mac-&gt;mac_resource_idx
op_assign
id|mac_con_resource_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in mac status&n; */
DECL|function|smt_fill_mac_status
r_static
r_void
id|smt_fill_mac_status
c_func
(paren
id|smc
comma
id|st
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_mac_status
op_star
id|st
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|st
comma
id|SMT_P_MAC_STATUS
)paren
suffix:semicolon
id|st-&gt;st_mib_index
op_assign
id|INDEX_MAC
suffix:semicolon
id|st-&gt;st_mac_index
op_assign
id|mac_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|mac_update_counter
c_func
(paren
id|smc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * timer values are represented in SMT as 2&squot;s complement numbers&n;&t; * units :&t;internal :  2&squot;s complement BCLK&n;&t; */
id|st-&gt;st_t_req
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACT_Req
suffix:semicolon
id|st-&gt;st_t_neg
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACT_Neg
suffix:semicolon
id|st-&gt;st_t_max
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACT_Max
suffix:semicolon
id|st-&gt;st_tvx_value
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACTvxValue
suffix:semicolon
id|st-&gt;st_t_min
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACT_Min
suffix:semicolon
id|st-&gt;st_sba
op_assign
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHSbaPayload
suffix:semicolon
id|st-&gt;st_frame_ct
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACFrame_Ct
suffix:semicolon
id|st-&gt;st_error_ct
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACError_Ct
suffix:semicolon
id|st-&gt;st_lost_ct
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACLost_Ct
suffix:semicolon
)brace
multiline_comment|/*&n; * fill values in LEM status&n; */
DECL|function|smt_fill_lem
r_static
r_void
id|smt_fill_lem
c_func
(paren
id|smc
comma
id|lem
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_lem
op_star
id|lem
suffix:semicolon
r_int
id|phy
suffix:semicolon
(brace
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
id|mib
op_assign
id|smc-&gt;y
(braket
id|phy
)braket
dot
id|mib
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|lem
comma
id|SMT_P_LEM
)paren
suffix:semicolon
id|lem-&gt;lem_mib_index
op_assign
id|phy
op_plus
id|INDEX_PORT
suffix:semicolon
id|lem-&gt;lem_phy_index
op_assign
id|phy_index
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
id|lem-&gt;lem_pad2
op_assign
l_int|0
suffix:semicolon
id|lem-&gt;lem_cutoff
op_assign
id|mib-&gt;fddiPORTLer_Cutoff
suffix:semicolon
id|lem-&gt;lem_alarm
op_assign
id|mib-&gt;fddiPORTLer_Alarm
suffix:semicolon
multiline_comment|/* long term bit error rate */
id|lem-&gt;lem_estimate
op_assign
id|mib-&gt;fddiPORTLer_Estimate
suffix:semicolon
multiline_comment|/* # of rejected connections */
id|lem-&gt;lem_reject_ct
op_assign
id|mib-&gt;fddiPORTLem_Reject_Ct
suffix:semicolon
id|lem-&gt;lem_ct
op_assign
id|mib-&gt;fddiPORTLem_Ct
suffix:semicolon
multiline_comment|/* total number of errors */
)brace
multiline_comment|/*&n; * fill version parameter&n; */
DECL|function|smt_fill_version
r_static
r_void
id|smt_fill_version
c_func
(paren
id|smc
comma
id|vers
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_version
op_star
id|vers
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|vers
comma
id|SMT_P_VERSION
)paren
suffix:semicolon
id|vers-&gt;v_pad
op_assign
l_int|0
suffix:semicolon
id|vers-&gt;v_n
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* one version is enough .. */
id|vers-&gt;v_index
op_assign
l_int|1
suffix:semicolon
id|vers-&gt;v_version
(braket
l_int|0
)braket
op_assign
id|SMT_VID_2
suffix:semicolon
id|vers-&gt;v_pad2
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef&t;SMT6_10
multiline_comment|/*&n; * fill frame status capabilities&n; */
multiline_comment|/*&n; * note: this para 200B is NOT in swap table, because it&squot;s also set in&n; * PMF add_para&n; */
DECL|function|smt_fill_fsc
r_static
r_void
id|smt_fill_fsc
c_func
(paren
id|smc
comma
id|fsc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_fsc
op_star
id|fsc
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|fsc
comma
id|SMT_P_FSC
)paren
suffix:semicolon
id|fsc-&gt;fsc_pad0
op_assign
l_int|0
suffix:semicolon
id|fsc-&gt;fsc_mac_index
op_assign
id|INDEX_MAC
suffix:semicolon
multiline_comment|/* this is MIB ; MIB is NOT&n;&t;&t;&t;&t;&t;&t; * mac_index ()i !&n;&t;&t;&t;&t;&t;&t; */
id|fsc-&gt;fsc_pad1
op_assign
l_int|0
suffix:semicolon
id|fsc-&gt;fsc_value
op_assign
id|FSC_TYPE0
suffix:semicolon
multiline_comment|/* &quot;normal&quot; node */
macro_line|#ifdef&t;LITTLE_ENDIAN
id|fsc-&gt;fsc_mac_index
op_assign
id|smt_swap_short
c_func
(paren
id|INDEX_MAC
)paren
suffix:semicolon
id|fsc-&gt;fsc_value
op_assign
id|smt_swap_short
c_func
(paren
id|FSC_TYPE0
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
multiline_comment|/*&n; * fill mac counter field&n; */
DECL|function|smt_fill_mac_counter
r_static
r_void
id|smt_fill_mac_counter
c_func
(paren
id|smc
comma
id|mc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_mac_counter
op_star
id|mc
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|mc
comma
id|SMT_P_MAC_COUNTER
)paren
suffix:semicolon
id|mc-&gt;mc_mib_index
op_assign
id|INDEX_MAC
suffix:semicolon
id|mc-&gt;mc_index
op_assign
id|mac_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|mc-&gt;mc_receive_ct
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACCopied_Ct
suffix:semicolon
id|mc-&gt;mc_transmit_ct
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACTransmit_Ct
suffix:semicolon
)brace
multiline_comment|/*&n; * fill mac frame not copied counter&n; */
DECL|function|smt_fill_mac_fnc
r_static
r_void
id|smt_fill_mac_fnc
c_func
(paren
id|smc
comma
id|fnc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_mac_fnc
op_star
id|fnc
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|fnc
comma
id|SMT_P_MAC_FNC
)paren
suffix:semicolon
id|fnc-&gt;nc_mib_index
op_assign
id|INDEX_MAC
suffix:semicolon
id|fnc-&gt;nc_index
op_assign
id|mac_index
c_func
(paren
id|smc
comma
l_int|1
)paren
suffix:semicolon
id|fnc-&gt;nc_counter
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACNotCopied_Ct
suffix:semicolon
)brace
multiline_comment|/*&n; * fill manufacturer field&n; */
DECL|function|smt_fill_manufacturer
r_static
r_void
id|smt_fill_manufacturer
c_func
(paren
id|smc
comma
id|man
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smp_p_manufacturer
op_star
id|man
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|man
comma
id|SMT_P_MANUFACTURER
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|man-&gt;mf_data
comma
(paren
r_char
op_star
)paren
id|smc-&gt;mib.fddiSMTManufacturerData
comma
r_sizeof
(paren
id|man-&gt;mf_data
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill user field&n; */
DECL|function|smt_fill_user
r_static
r_void
id|smt_fill_user
c_func
(paren
id|smc
comma
id|user
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smp_p_user
op_star
id|user
suffix:semicolon
(brace
id|SMTSETPARA
c_func
(paren
id|user
comma
id|SMT_P_USER
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|user-&gt;us_data
comma
(paren
r_char
op_star
)paren
id|smc-&gt;mib.fddiSMTUserData
comma
r_sizeof
(paren
id|user-&gt;us_data
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill set count&n; */
DECL|function|smt_fill_setcount
r_static
r_void
id|smt_fill_setcount
c_func
(paren
id|smc
comma
id|setcount
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_setcount
op_star
id|setcount
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|setcount
comma
id|SMT_P_SETCOUNT
)paren
suffix:semicolon
id|setcount-&gt;count
op_assign
id|smc-&gt;mib.fddiSMTSetCount.count
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|setcount-&gt;timestamp
comma
(paren
r_char
op_star
)paren
id|smc-&gt;mib.fddiSMTSetCount.timestamp
comma
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill echo data&n; */
DECL|function|smt_fill_echo
r_static
r_void
id|smt_fill_echo
c_func
(paren
id|smc
comma
id|echo
comma
id|seed
comma
id|len
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_p_echo
op_star
id|echo
suffix:semicolon
id|u_long
id|seed
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
id|u_char
op_star
id|p
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SMTSETPARA
c_func
(paren
id|echo
comma
id|SMT_P_ECHODATA
)paren
suffix:semicolon
id|echo-&gt;para.p_len
op_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|echo-&gt;ec_data
suffix:semicolon
id|len
suffix:semicolon
id|len
op_decrement
)paren
(brace
op_star
id|p
op_increment
op_assign
(paren
id|u_char
)paren
id|seed
suffix:semicolon
id|seed
op_add_assign
l_int|13
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * clear DNA and UNA&n; * called from CFM if configuration changes&n; */
DECL|function|smt_clear_una_dna
r_void
id|smt_clear_una_dna
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACUpstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDownstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
)brace
DECL|function|smt_clear_old_una_dna
r_static
r_void
id|smt_clear_old_una_dna
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldUpstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACOldDownstreamNbr
op_assign
id|SMT_Unknown
suffix:semicolon
)brace
DECL|function|smt_get_tid
id|u_long
id|smt_get_tid
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
id|u_long
id|tid
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tid
op_assign
op_increment
(paren
id|smc-&gt;sm.smt_tid
)paren
op_xor
id|SMT_TID_MAGIC
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|tid
op_amp
l_int|0x3fffffffL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * table of parameter lengths&n; */
DECL|struct|smt_pdef
r_static
r_const
r_struct
id|smt_pdef
(brace
DECL|member|ptype
r_int
id|ptype
suffix:semicolon
DECL|member|plen
r_int
id|plen
suffix:semicolon
DECL|member|pswap
r_const
r_char
op_star
id|pswap
suffix:semicolon
DECL|variable|smt_pdef
)brace
id|smt_pdef
(braket
)braket
op_assign
(brace
(brace
id|SMT_P_UNA
comma
r_sizeof
(paren
r_struct
id|smt_p_una
)paren
comma
id|SWAP_SMT_P_UNA
)brace
comma
(brace
id|SMT_P_SDE
comma
r_sizeof
(paren
r_struct
id|smt_p_sde
)paren
comma
id|SWAP_SMT_P_SDE
)brace
comma
(brace
id|SMT_P_STATE
comma
r_sizeof
(paren
r_struct
id|smt_p_state
)paren
comma
id|SWAP_SMT_P_STATE
)brace
comma
(brace
id|SMT_P_TIMESTAMP
comma
r_sizeof
(paren
r_struct
id|smt_p_timestamp
)paren
comma
id|SWAP_SMT_P_TIMESTAMP
)brace
comma
(brace
id|SMT_P_POLICY
comma
r_sizeof
(paren
r_struct
id|smt_p_policy
)paren
comma
id|SWAP_SMT_P_POLICY
)brace
comma
(brace
id|SMT_P_LATENCY
comma
r_sizeof
(paren
r_struct
id|smt_p_latency
)paren
comma
id|SWAP_SMT_P_LATENCY
)brace
comma
(brace
id|SMT_P_NEIGHBORS
comma
r_sizeof
(paren
r_struct
id|smt_p_neighbor
)paren
comma
id|SWAP_SMT_P_NEIGHBORS
)brace
comma
(brace
id|SMT_P_PATH
comma
r_sizeof
(paren
r_struct
id|smt_p_path
)paren
comma
id|SWAP_SMT_P_PATH
)brace
comma
(brace
id|SMT_P_MAC_STATUS
comma
r_sizeof
(paren
r_struct
id|smt_p_mac_status
)paren
comma
id|SWAP_SMT_P_MAC_STATUS
)brace
comma
(brace
id|SMT_P_LEM
comma
r_sizeof
(paren
r_struct
id|smt_p_lem
)paren
comma
id|SWAP_SMT_P_LEM
)brace
comma
(brace
id|SMT_P_MAC_COUNTER
comma
r_sizeof
(paren
r_struct
id|smt_p_mac_counter
)paren
comma
id|SWAP_SMT_P_MAC_COUNTER
)brace
comma
(brace
id|SMT_P_MAC_FNC
comma
r_sizeof
(paren
r_struct
id|smt_p_mac_fnc
)paren
comma
id|SWAP_SMT_P_MAC_FNC
)brace
comma
(brace
id|SMT_P_PRIORITY
comma
r_sizeof
(paren
r_struct
id|smt_p_priority
)paren
comma
id|SWAP_SMT_P_PRIORITY
)brace
comma
(brace
id|SMT_P_EB
comma
r_sizeof
(paren
r_struct
id|smt_p_eb
)paren
comma
id|SWAP_SMT_P_EB
)brace
comma
(brace
id|SMT_P_MANUFACTURER
comma
r_sizeof
(paren
r_struct
id|smp_p_manufacturer
)paren
comma
id|SWAP_SMT_P_MANUFACTURER
)brace
comma
(brace
id|SMT_P_REASON
comma
r_sizeof
(paren
r_struct
id|smt_p_reason
)paren
comma
id|SWAP_SMT_P_REASON
)brace
comma
(brace
id|SMT_P_REFUSED
comma
r_sizeof
(paren
r_struct
id|smt_p_refused
)paren
comma
id|SWAP_SMT_P_REFUSED
)brace
comma
(brace
id|SMT_P_VERSION
comma
r_sizeof
(paren
r_struct
id|smt_p_version
)paren
comma
id|SWAP_SMT_P_VERSION
)brace
comma
macro_line|#ifdef ESS
(brace
id|SMT_P0015
comma
r_sizeof
(paren
r_struct
id|smt_p_0015
)paren
comma
id|SWAP_SMT_P0015
)brace
comma
(brace
id|SMT_P0016
comma
r_sizeof
(paren
r_struct
id|smt_p_0016
)paren
comma
id|SWAP_SMT_P0016
)brace
comma
(brace
id|SMT_P0017
comma
r_sizeof
(paren
r_struct
id|smt_p_0017
)paren
comma
id|SWAP_SMT_P0017
)brace
comma
(brace
id|SMT_P0018
comma
r_sizeof
(paren
r_struct
id|smt_p_0018
)paren
comma
id|SWAP_SMT_P0018
)brace
comma
(brace
id|SMT_P0019
comma
r_sizeof
(paren
r_struct
id|smt_p_0019
)paren
comma
id|SWAP_SMT_P0019
)brace
comma
(brace
id|SMT_P001A
comma
r_sizeof
(paren
r_struct
id|smt_p_001a
)paren
comma
id|SWAP_SMT_P001A
)brace
comma
(brace
id|SMT_P001B
comma
r_sizeof
(paren
r_struct
id|smt_p_001b
)paren
comma
id|SWAP_SMT_P001B
)brace
comma
(brace
id|SMT_P001C
comma
r_sizeof
(paren
r_struct
id|smt_p_001c
)paren
comma
id|SWAP_SMT_P001C
)brace
comma
(brace
id|SMT_P001D
comma
r_sizeof
(paren
r_struct
id|smt_p_001d
)paren
comma
id|SWAP_SMT_P001D
)brace
comma
macro_line|#endif
macro_line|#if&t;0
(brace
id|SMT_P_FSC
comma
r_sizeof
(paren
r_struct
id|smt_p_fsc
)paren
comma
id|SWAP_SMT_P_FSC
)brace
comma
macro_line|#endif
(brace
id|SMT_P_SETCOUNT
comma
l_int|0
comma
id|SWAP_SMT_P_SETCOUNT
)brace
comma
(brace
id|SMT_P1048
comma
l_int|0
comma
id|SWAP_SMT_P1048
)brace
comma
(brace
id|SMT_P208C
comma
l_int|0
comma
id|SWAP_SMT_P208C
)brace
comma
(brace
id|SMT_P208D
comma
l_int|0
comma
id|SWAP_SMT_P208D
)brace
comma
(brace
id|SMT_P208E
comma
l_int|0
comma
id|SWAP_SMT_P208E
)brace
comma
(brace
id|SMT_P208F
comma
l_int|0
comma
id|SWAP_SMT_P208F
)brace
comma
(brace
id|SMT_P2090
comma
l_int|0
comma
id|SWAP_SMT_P2090
)brace
comma
macro_line|#ifdef&t;ESS
(brace
id|SMT_P320B
comma
r_sizeof
(paren
r_struct
id|smt_p_320b
)paren
comma
id|SWAP_SMT_P320B
)brace
comma
(brace
id|SMT_P320F
comma
r_sizeof
(paren
r_struct
id|smt_p_320f
)paren
comma
id|SWAP_SMT_P320F
)brace
comma
(brace
id|SMT_P3210
comma
r_sizeof
(paren
r_struct
id|smt_p_3210
)paren
comma
id|SWAP_SMT_P3210
)brace
comma
macro_line|#endif
(brace
id|SMT_P4050
comma
l_int|0
comma
id|SWAP_SMT_P4050
)brace
comma
(brace
id|SMT_P4051
comma
l_int|0
comma
id|SWAP_SMT_P4051
)brace
comma
(brace
id|SMT_P4052
comma
l_int|0
comma
id|SWAP_SMT_P4052
)brace
comma
(brace
id|SMT_P4053
comma
l_int|0
comma
id|SWAP_SMT_P4053
)brace
comma
)brace
suffix:semicolon
DECL|macro|N_SMT_PLEN
mdefine_line|#define N_SMT_PLEN&t;(sizeof(smt_pdef)/sizeof(smt_pdef[0]))
DECL|function|smt_check_para
r_int
id|smt_check_para
c_func
(paren
id|smc
comma
id|sm
comma
id|list
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_const
id|u_short
id|list
(braket
)braket
suffix:semicolon
(brace
r_const
id|u_short
op_star
id|p
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
(paren
r_int
)paren
op_star
id|p
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: smt_check_para - missing para %x&bslash;n&quot;
comma
op_star
id|p
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sm_to_para
id|EXPORT_PMF
r_void
op_star
id|sm_to_para
c_func
(paren
id|smc
comma
id|sm
comma
id|para
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|para
suffix:semicolon
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|plen
suffix:semicolon
r_void
op_star
id|found
op_assign
l_int|0
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|len
op_assign
id|sm-&gt;smt_len
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|sm
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* pointer to info */
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
r_struct
id|smt_para
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|p_type
op_eq
id|para
)paren
id|found
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|plen
op_assign
(paren
(paren
r_struct
id|smt_para
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|p_len
op_plus
id|PARA_LEN
suffix:semicolon
id|p
op_add_assign
id|plen
suffix:semicolon
id|len
op_sub_assign
id|plen
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : sm_to_para - length error %d&bslash;n&quot;
comma
id|plen
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|plen
op_amp
l_int|3
)paren
op_logical_and
(paren
id|para
op_ne
id|SMT_P_ECHODATA
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SMT : sm_to_para - odd length %d&bslash;n&quot;
comma
id|plen
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
r_return
(paren
id|found
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|is_my_addr
r_int
id|is_my_addr
c_func
(paren
id|smc
comma
id|addr
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|addr
suffix:semicolon
(brace
r_return
(paren
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|0
)braket
)paren
op_eq
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress.a
(braket
l_int|0
)braket
)paren
op_logical_and
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|2
)braket
)paren
op_eq
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress.a
(braket
l_int|2
)braket
)paren
op_logical_and
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|4
)braket
)paren
op_eq
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress.a
(braket
l_int|4
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|is_zero
r_int
id|is_zero
c_func
(paren
id|addr
)paren
r_struct
id|fddi_addr
op_star
id|addr
suffix:semicolon
(brace
r_return
(paren
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|0
)braket
)paren
op_eq
l_int|0
op_logical_and
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|2
)braket
)paren
op_eq
l_int|0
op_logical_and
op_star
(paren
r_int
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|4
)braket
)paren
op_eq
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|is_broadcast
r_int
id|is_broadcast
c_func
(paren
id|addr
)paren
r_struct
id|fddi_addr
op_star
id|addr
suffix:semicolon
(brace
r_return
(paren
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|0
)braket
)paren
op_eq
l_int|0xffff
op_logical_and
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|2
)braket
)paren
op_eq
l_int|0xffff
op_logical_and
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr-&gt;a
(braket
l_int|4
)braket
)paren
op_eq
l_int|0xffff
)paren
suffix:semicolon
)brace
DECL|function|is_individual
r_int
id|is_individual
c_func
(paren
id|addr
)paren
r_struct
id|fddi_addr
op_star
id|addr
suffix:semicolon
(brace
r_return
(paren
op_logical_neg
(paren
id|addr-&gt;a
(braket
l_int|0
)braket
op_amp
id|GROUP_ADDR
)paren
)paren
suffix:semicolon
)brace
DECL|function|is_equal
r_int
id|is_equal
c_func
(paren
id|addr1
comma
id|addr2
)paren
r_struct
id|fddi_addr
op_star
id|addr1
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|addr2
suffix:semicolon
(brace
r_return
(paren
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr1-&gt;a
(braket
l_int|0
)braket
)paren
op_eq
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr2-&gt;a
(braket
l_int|0
)braket
)paren
op_logical_and
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr1-&gt;a
(braket
l_int|2
)braket
)paren
op_eq
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr2-&gt;a
(braket
l_int|2
)braket
)paren
op_logical_and
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr1-&gt;a
(braket
l_int|4
)braket
)paren
op_eq
op_star
(paren
id|u_short
op_star
)paren
(paren
op_amp
id|addr2-&gt;a
(braket
l_int|4
)braket
)paren
)paren
suffix:semicolon
)brace
macro_line|#if&t;0
multiline_comment|/*&n; * send ANTC data test frame&n; */
r_void
id|fddi_send_antc
c_func
(paren
id|smc
comma
id|dest
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|fddi_addr
op_star
id|dest
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|dest
)paren
suffix:semicolon
macro_line|#if&t;0
id|SMbuf
op_star
id|mb
suffix:semicolon
r_struct
id|smt_header
op_star
id|smt
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
id|mb
op_assign
id|smt_get_mbuf
c_func
(paren
)paren
suffix:semicolon
id|mb-&gt;sm_len
op_assign
l_int|3000
op_plus
l_int|12
suffix:semicolon
id|p
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_char
op_star
)paren
op_plus
l_int|12
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3000
suffix:semicolon
id|i
op_increment
)paren
op_star
id|p
op_increment
op_assign
l_int|1
op_lshift
(paren
id|i
op_amp
l_int|7
)paren
suffix:semicolon
id|smt
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|smt-&gt;smt_dest
op_assign
op_star
id|dest
suffix:semicolon
id|smt-&gt;smt_source
op_assign
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACSMTAddress
suffix:semicolon
id|smt_send_mbuf
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_ASYNC_LLC
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
macro_line|#ifdef&t;DEBUG
DECL|macro|hextoasc
mdefine_line|#define hextoasc(x)&t;&quot;0123456789abcdef&quot;[x]
DECL|function|addr_to_string
r_char
op_star
id|addr_to_string
c_func
(paren
id|addr
)paren
r_struct
id|fddi_addr
op_star
id|addr
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_static
r_char
id|string
(braket
l_int|6
op_star
l_int|3
)braket
op_assign
l_string|&quot;****&quot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|string
(braket
id|i
op_star
l_int|3
)braket
op_assign
id|hextoasc
c_func
(paren
(paren
id|addr-&gt;a
(braket
id|i
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|string
(braket
id|i
op_star
l_int|3
op_plus
l_int|1
)braket
op_assign
id|hextoasc
c_func
(paren
(paren
id|addr-&gt;a
(braket
id|i
)braket
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|string
(braket
id|i
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
l_char|&squot;:&squot;
suffix:semicolon
)brace
id|string
(braket
l_int|5
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
r_return
(paren
id|string
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef&t;AM29K
DECL|function|smt_ifconfig
id|smt_ifconfig
c_func
(paren
id|argc
comma
id|argv
)paren
r_int
id|argc
suffix:semicolon
r_char
op_star
id|argv
(braket
)braket
suffix:semicolon
(brace
r_if
c_cond
(paren
id|argc
op_ge
l_int|2
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;opt_bypass&quot;
)paren
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;yes&quot;
)paren
)paren
(brace
id|smc-&gt;mib.fddiSMTBypassPresent
op_assign
l_int|1
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
(paren
id|amdfddi_config
c_func
(paren
l_int|0
comma
id|argc
comma
id|argv
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * return static mac index&n; */
DECL|function|mac_index
r_static
r_int
id|mac_index
c_func
(paren
id|smc
comma
id|mac
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|mac
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|mac
)paren
suffix:semicolon
macro_line|#ifdef&t;CONCENTRATOR
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_return
(paren
id|NUMPHYS
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#else
r_return
(paren
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|3
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * return static phy index&n; */
DECL|function|phy_index
r_static
r_int
id|phy_index
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|phy
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_return
id|phy
op_plus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * return dynamic mac connection resource index&n; */
DECL|function|mac_con_resource_index
r_static
r_int
id|mac_con_resource_index
c_func
(paren
id|smc
comma
id|mac
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|mac
suffix:semicolon
(brace
macro_line|#ifdef&t;CONCENTRATOR
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|mac
)paren
suffix:semicolon
r_return
(paren
id|entity_to_index
c_func
(paren
id|smc
comma
id|cem_get_downstream
c_func
(paren
id|smc
comma
id|ENTITY_MAC
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|SK_UNUSED
c_func
(paren
id|mac
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|smc-&gt;mib.fddiSMTCF_State
)paren
(brace
r_case
id|SC9_C_WRAP_A
suffix:colon
r_case
id|SC5_THRU_B
suffix:colon
r_case
id|SC11_C_WRAP_S
suffix:colon
r_return
(paren
l_int|1
)paren
suffix:semicolon
r_case
id|SC10_C_WRAP_B
suffix:colon
r_case
id|SC4_THRU_A
suffix:colon
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_return
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
ques
c_cond
l_int|2
suffix:colon
l_int|3
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * return dynamic phy connection resource index&n; */
DECL|function|phy_con_resource_index
r_static
r_int
id|phy_con_resource_index
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|phy
suffix:semicolon
(brace
macro_line|#ifdef&t;CONCENTRATOR
r_return
(paren
id|entity_to_index
c_func
(paren
id|smc
comma
id|cem_get_downstream
c_func
(paren
id|smc
comma
id|ENTITY_PHY
c_func
(paren
id|phy
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
r_switch
c_cond
(paren
id|smc-&gt;mib.fddiSMTCF_State
)paren
(brace
r_case
id|SC9_C_WRAP_A
suffix:colon
r_return
(paren
id|phy
op_eq
id|PA
ques
c_cond
l_int|3
suffix:colon
l_int|2
)paren
suffix:semicolon
r_case
id|SC10_C_WRAP_B
suffix:colon
r_return
(paren
id|phy
op_eq
id|PA
ques
c_cond
l_int|1
suffix:colon
l_int|3
)paren
suffix:semicolon
r_case
id|SC4_THRU_A
suffix:colon
r_return
(paren
id|phy
op_eq
id|PA
ques
c_cond
l_int|3
suffix:colon
l_int|1
)paren
suffix:semicolon
r_case
id|SC5_THRU_B
suffix:colon
r_return
(paren
id|phy
op_eq
id|PA
ques
c_cond
l_int|2
suffix:colon
l_int|3
)paren
suffix:semicolon
r_case
id|SC11_C_WRAP_S
suffix:colon
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_return
(paren
id|phy
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef&t;CONCENTRATOR
DECL|function|entity_to_index
r_static
r_int
id|entity_to_index
c_func
(paren
id|smc
comma
id|e
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|e
suffix:semicolon
(brace
r_if
c_cond
(paren
id|e
op_eq
id|ENTITY_MAC
)paren
r_return
(paren
id|mac_index
c_func
(paren
id|smc
comma
l_int|1
)paren
)paren
suffix:semicolon
r_else
r_return
(paren
id|phy_index
c_func
(paren
id|smc
comma
id|e
op_minus
id|ENTITY_PHY
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef&t;LITTLE_ENDIAN
DECL|function|smt_swap_short
r_static
r_int
id|smt_swap_short
c_func
(paren
id|s
)paren
id|u_short
id|s
suffix:semicolon
(brace
r_return
(paren
(paren
(paren
id|s
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|s
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
DECL|function|smt_swap_para
r_void
id|smt_swap_para
c_func
(paren
id|sm
comma
id|len
comma
id|direction
)paren
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|direction
suffix:semicolon
multiline_comment|/* 0 encode 1 decode */
(brace
r_struct
id|smt_para
op_star
id|pa
suffix:semicolon
r_const
r_struct
id|smt_pdef
op_star
id|pd
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|plen
suffix:semicolon
r_int
id|type
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&t;printf(&quot;smt_swap_para sm %x len %d dir %d&bslash;n&quot;,&n;&t;&t;sm,len,direction) ;&n; */
id|smt_string_swap
c_func
(paren
(paren
r_char
op_star
)paren
id|sm
comma
id|SWAP_SMTHEADER
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* swap args */
id|len
op_sub_assign
r_sizeof
(paren
r_struct
id|smt_header
)paren
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|sm
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
id|pa
op_assign
(paren
r_struct
id|smt_para
op_star
)paren
id|p
suffix:semicolon
id|plen
op_assign
id|pa-&gt;p_len
suffix:semicolon
id|type
op_assign
id|pa-&gt;p_type
suffix:semicolon
id|pa-&gt;p_type
op_assign
id|smt_swap_short
c_func
(paren
id|pa-&gt;p_type
)paren
suffix:semicolon
id|pa-&gt;p_len
op_assign
id|smt_swap_short
c_func
(paren
id|pa-&gt;p_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|direction
)paren
(brace
id|plen
op_assign
id|pa-&gt;p_len
suffix:semicolon
id|type
op_assign
id|pa-&gt;p_type
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * note: paras can have 0 length !&n;&t;&t; */
r_if
c_cond
(paren
id|plen
OL
l_int|0
)paren
r_break
suffix:semicolon
id|plen
op_add_assign
id|PARA_LEN
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|N_SMT_PLEN
comma
id|pd
op_assign
id|smt_pdef
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
comma
id|pd
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pd-&gt;ptype
op_eq
id|type
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_logical_and
id|pd-&gt;pswap
)paren
(brace
id|smt_string_swap
c_func
(paren
id|p
op_plus
id|PARA_LEN
comma
id|pd-&gt;pswap
comma
id|len
)paren
suffix:semicolon
)brace
id|len
op_sub_assign
id|plen
suffix:semicolon
id|p
op_add_assign
id|plen
suffix:semicolon
)brace
)brace
DECL|function|smt_string_swap
r_static
r_void
id|smt_string_swap
c_func
(paren
id|data
comma
id|format
comma
id|len
)paren
r_char
op_star
id|data
suffix:semicolon
r_const
r_char
op_star
id|format
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
r_const
r_char
op_star
id|open_paren
op_assign
l_int|0
suffix:semicolon
r_int
id|x
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
op_logical_and
op_star
id|format
)paren
(brace
r_switch
c_cond
(paren
op_star
id|format
)paren
(brace
r_case
l_char|&squot;[&squot;
suffix:colon
id|open_paren
op_assign
id|format
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;]&squot;
suffix:colon
id|format
op_assign
id|open_paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;1&squot;
suffix:colon
r_case
l_char|&squot;2&squot;
suffix:colon
r_case
l_char|&squot;3&squot;
suffix:colon
r_case
l_char|&squot;4&squot;
suffix:colon
r_case
l_char|&squot;5&squot;
suffix:colon
r_case
l_char|&squot;6&squot;
suffix:colon
r_case
l_char|&squot;7&squot;
suffix:colon
r_case
l_char|&squot;8&squot;
suffix:colon
r_case
l_char|&squot;9&squot;
suffix:colon
id|data
op_add_assign
op_star
id|format
op_minus
l_char|&squot;0&squot;
suffix:semicolon
id|len
op_sub_assign
op_star
id|format
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
id|data
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|x
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|x
suffix:semicolon
id|data
op_add_assign
l_int|2
suffix:semicolon
id|len
op_sub_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;l&squot;
suffix:colon
id|x
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|x
suffix:semicolon
id|x
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|x
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
id|len
op_sub_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|format
op_increment
suffix:semicolon
)brace
)brace
macro_line|#else
DECL|function|smt_swap_para
r_void
id|smt_swap_para
c_func
(paren
id|sm
comma
id|len
comma
id|direction
)paren
r_struct
id|smt_header
op_star
id|sm
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|direction
suffix:semicolon
multiline_comment|/* 0 encode 1 decode */
(brace
id|SK_UNUSED
c_func
(paren
id|sm
)paren
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|len
)paren
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|direction
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * PMF actions&n; */
DECL|function|smt_action
r_int
id|smt_action
c_func
(paren
id|smc
comma
r_class
comma
id|code
comma
id|index
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
r_class
suffix:semicolon
r_int
id|code
suffix:semicolon
r_int
id|index
suffix:semicolon
(brace
r_int
id|event
suffix:semicolon
r_int
id|port
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SMT: action %d code %d&bslash;n&quot;
comma
r_class
comma
id|code
)paren
suffix:semicolon
r_switch
c_cond
(paren
r_class
)paren
(brace
r_case
id|SMT_STATION_ACTION
suffix:colon
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
id|SMT_STATION_ACTION_CONNECT
suffix:colon
id|smc-&gt;mib.fddiSMTRemoteDisconnectFlag
op_assign
id|FALSE
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_CONNECT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_DISCONNECT
suffix:colon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_DISCONNECT
)paren
suffix:semicolon
id|smc-&gt;mib.fddiSMTRemoteDisconnectFlag
op_assign
id|TRUE
suffix:semicolon
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_DISCONNECT
)paren
suffix:semicolon
id|AIX_EVENT
c_func
(paren
id|smc
comma
(paren
id|u_long
)paren
id|FDDI_RING_STATUS
comma
(paren
id|u_long
)paren
id|FDDI_SMT_EVENT
comma
(paren
id|u_long
)paren
id|FDDI_REMOTE_DISCONNECT
comma
id|smt_get_event_word
c_func
(paren
id|smc
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_PATHTEST
suffix:colon
id|AIX_EVENT
c_func
(paren
id|smc
comma
(paren
id|u_long
)paren
id|FDDI_RING_STATUS
comma
(paren
id|u_long
)paren
id|FDDI_SMT_EVENT
comma
(paren
id|u_long
)paren
id|FDDI_PATH_TEST
comma
id|smt_get_event_word
c_func
(paren
id|smc
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_SELFTEST
suffix:colon
id|AIX_EVENT
c_func
(paren
id|smc
comma
(paren
id|u_long
)paren
id|FDDI_RING_STATUS
comma
(paren
id|u_long
)paren
id|FDDI_SMT_EVENT
comma
(paren
id|u_long
)paren
id|FDDI_REMOTE_SELF_TEST
comma
id|smt_get_event_word
c_func
(paren
id|smc
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_DISABLE_A
suffix:colon
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|PA
)braket
dot
id|pc_mode
op_eq
id|PM_PEER
)paren
(brace
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|PA
comma
id|PC_DISABLE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_DISABLE_B
suffix:colon
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|pc_mode
op_eq
id|PM_PEER
)paren
(brace
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|PB
comma
id|PC_DISABLE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_STATION_ACTION_DISABLE_M
suffix:colon
r_for
c_loop
(paren
id|port
op_assign
l_int|0
suffix:semicolon
id|port
OL
id|NUMPHYS
suffix:semicolon
id|port
op_increment
)paren
(brace
r_if
c_cond
(paren
id|smc-&gt;mib.p
(braket
id|port
)braket
dot
id|fddiPORTMy_Type
op_ne
id|TM
)paren
r_continue
suffix:semicolon
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|port
comma
id|PC_DISABLE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_PORT_ACTION
suffix:colon
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
id|SMT_PORT_ACTION_ENABLE
suffix:colon
id|event
op_assign
id|PC_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_PORT_ACTION_DISABLE
suffix:colon
id|event
op_assign
id|PC_DISABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_PORT_ACTION_MAINT
suffix:colon
id|event
op_assign
id|PC_MAINT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_PORT_ACTION_START
suffix:colon
id|event
op_assign
id|PC_START
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_PORT_ACTION_STOP
suffix:colon
id|event
op_assign
id|PC_STOP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|index
comma
id|event
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * change tneg&n; *&t;set T_Req in MIB (Path Attribute)&n; *&t;calculate new values for MAC&n; *&t;if change required&n; *&t;&t;disconnect&n; *&t;&t;set reconnect&n; *&t;end&n; */
DECL|function|smt_change_t_neg
r_void
id|smt_change_t_neg
c_func
(paren
id|smc
comma
id|tneg
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|u_long
id|tneg
suffix:semicolon
(brace
id|smc-&gt;mib.a
(braket
id|PATH0
)braket
dot
id|fddiPATHMaxT_Req
op_assign
id|tneg
suffix:semicolon
r_if
c_cond
(paren
id|smt_set_mac_opvalues
c_func
(paren
id|smc
)paren
)paren
(brace
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
id|smc-&gt;sm.please_reconnect
op_assign
l_int|1
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_DISCONNECT
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * canonical conversion of &lt;len&gt; bytes beginning form *data&n; */
macro_line|#ifdef  USE_CAN_ADDR
DECL|function|hwm_conv_can
r_void
id|hwm_conv_can
c_func
(paren
id|smc
comma
id|data
comma
id|len
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_char
op_star
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|len
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
comma
id|data
op_increment
)paren
(brace
op_star
id|data
op_assign
id|canonical
(braket
op_star
(paren
id|u_char
op_star
)paren
id|data
)braket
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#endif&t;/* no SLIM_SMT */
eof
