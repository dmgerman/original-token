multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998,1999 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;See the file &quot;skfddi.c&quot; for further information.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/*&n;&t;PCM&n;&t;Physical Connection Management&n;*/
multiline_comment|/*&n; * Hardware independant state machine implemantation&n; * The following external SMT functions are referenced :&n; *&n; * &t;&t;queue_event()&n; * &t;&t;smt_timer_start()&n; * &t;&t;smt_timer_stop()&n; *&n; * &t;The following external HW dependant functions are referenced :&n; * &t;&t;sm_pm_control()&n; *&t;&t;sm_ph_linestate()&n; *&t;&t;sm_pm_ls_latch()&n; *&n; * &t;The following HW dependant events are required :&n; *&t;&t;PC_QLS&n; *&t;&t;PC_ILS&n; *&t;&t;PC_HLS&n; *&t;&t;PC_MLS&n; *&t;&t;PC_NSE&n; *&t;&t;PC_LEM&n; *&n; */
macro_line|#include &quot;h/types.h&quot;
macro_line|#include &quot;h/fddi.h&quot;
macro_line|#include &quot;h/smc.h&quot;
macro_line|#include &quot;h/supern_2.h&quot;
DECL|macro|KERNEL
mdefine_line|#define KERNEL
macro_line|#include &quot;h/smtstate.h&quot;
macro_line|#ifndef&t;lint
DECL|variable|ID_sccs
r_static
r_const
r_char
id|ID_sccs
(braket
)braket
op_assign
l_string|&quot;@(#)pcmplc.c&t;2.55 99/08/05 (C) SK &quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;FDDI_MIB
r_extern
r_int
id|snmp_fddi_trap
c_func
(paren
macro_line|#ifdef&t;ANSIC
r_struct
id|s_smc
op_star
id|smc
comma
r_int
id|type
comma
r_int
id|index
macro_line|#endif
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;CONCENTRATOR
r_extern
r_int
id|plc_is_installed
c_func
(paren
macro_line|#ifdef&t;ANSIC
r_struct
id|s_smc
op_star
id|smc
comma
r_int
id|p
macro_line|#endif
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * FSM Macros&n; */
DECL|macro|AFLAG
mdefine_line|#define AFLAG&t;&t;(0x20)
DECL|macro|GO_STATE
mdefine_line|#define GO_STATE(x)&t;(mib-&gt;fddiPORTPCMState = (x)|AFLAG)
DECL|macro|ACTIONS_DONE
mdefine_line|#define ACTIONS_DONE()&t;(mib-&gt;fddiPORTPCMState &amp;= ~AFLAG)
DECL|macro|ACTIONS
mdefine_line|#define ACTIONS(x)&t;(x|AFLAG)
multiline_comment|/*&n; * PCM states&n; */
DECL|macro|PC0_OFF
mdefine_line|#define PC0_OFF&t;&t;&t;0
DECL|macro|PC1_BREAK
mdefine_line|#define PC1_BREAK&t;&t;1
DECL|macro|PC2_TRACE
mdefine_line|#define PC2_TRACE&t;&t;2
DECL|macro|PC3_CONNECT
mdefine_line|#define PC3_CONNECT&t;&t;3
DECL|macro|PC4_NEXT
mdefine_line|#define PC4_NEXT&t;&t;4
DECL|macro|PC5_SIGNAL
mdefine_line|#define PC5_SIGNAL&t;&t;5
DECL|macro|PC6_JOIN
mdefine_line|#define PC6_JOIN&t;&t;6
DECL|macro|PC7_VERIFY
mdefine_line|#define PC7_VERIFY&t;&t;7
DECL|macro|PC8_ACTIVE
mdefine_line|#define PC8_ACTIVE&t;&t;8
DECL|macro|PC9_MAINT
mdefine_line|#define PC9_MAINT&t;&t;9
macro_line|#ifdef&t;DEBUG
multiline_comment|/*&n; * symbolic state names&n; */
DECL|variable|pcm_states
r_static
r_const
r_char
op_star
r_const
id|pcm_states
(braket
)braket
op_assign
(brace
l_string|&quot;PC0_OFF&quot;
comma
l_string|&quot;PC1_BREAK&quot;
comma
l_string|&quot;PC2_TRACE&quot;
comma
l_string|&quot;PC3_CONNECT&quot;
comma
l_string|&quot;PC4_NEXT&quot;
comma
l_string|&quot;PC5_SIGNAL&quot;
comma
l_string|&quot;PC6_JOIN&quot;
comma
l_string|&quot;PC7_VERIFY&quot;
comma
l_string|&quot;PC8_ACTIVE&quot;
comma
l_string|&quot;PC9_MAINT&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * symbolic event names&n; */
DECL|variable|pcm_events
r_static
r_const
r_char
op_star
r_const
id|pcm_events
(braket
)braket
op_assign
(brace
l_string|&quot;NONE&quot;
comma
l_string|&quot;PC_START&quot;
comma
l_string|&quot;PC_STOP&quot;
comma
l_string|&quot;PC_LOOP&quot;
comma
l_string|&quot;PC_JOIN&quot;
comma
l_string|&quot;PC_SIGNAL&quot;
comma
l_string|&quot;PC_REJECT&quot;
comma
l_string|&quot;PC_MAINT&quot;
comma
l_string|&quot;PC_TRACE&quot;
comma
l_string|&quot;PC_PDR&quot;
comma
l_string|&quot;PC_ENABLE&quot;
comma
l_string|&quot;PC_DISABLE&quot;
comma
l_string|&quot;PC_QLS&quot;
comma
l_string|&quot;PC_ILS&quot;
comma
l_string|&quot;PC_MLS&quot;
comma
l_string|&quot;PC_HLS&quot;
comma
l_string|&quot;PC_LS_PDR&quot;
comma
l_string|&quot;PC_LS_NONE&quot;
comma
l_string|&quot;PC_TIMEOUT_TB_MAX&quot;
comma
l_string|&quot;PC_TIMEOUT_TB_MIN&quot;
comma
l_string|&quot;PC_TIMEOUT_C_MIN&quot;
comma
l_string|&quot;PC_TIMEOUT_T_OUT&quot;
comma
l_string|&quot;PC_TIMEOUT_TL_MIN&quot;
comma
l_string|&quot;PC_TIMEOUT_T_NEXT&quot;
comma
l_string|&quot;PC_TIMEOUT_LCT&quot;
comma
l_string|&quot;PC_NSE&quot;
comma
l_string|&quot;PC_LEM&quot;
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;MOT_ELM
multiline_comment|/*&n; * PCL-S control register&n; * this register in the PLC-S controls the scrambling parameters&n; */
DECL|macro|PLCS_CONTROL_C_U
mdefine_line|#define PLCS_CONTROL_C_U&t;0
DECL|macro|PLCS_CONTROL_C_S
mdefine_line|#define PLCS_CONTROL_C_S&t;(PL_C_SDOFF_ENABLE | PL_C_SDON_ENABLE | &bslash;&n;&t;&t;&t;&t; PL_C_CIPHER_ENABLE)
DECL|macro|PLCS_FASSERT_U
mdefine_line|#define&t;PLCS_FASSERT_U&t;&t;0
DECL|macro|PLCS_FASSERT_S
mdefine_line|#define&t;PLCS_FASSERT_S&t;&t;0xFd76&t;/* 52.0 us */
DECL|macro|PLCS_FDEASSERT_U
mdefine_line|#define&t;PLCS_FDEASSERT_U&t;0
DECL|macro|PLCS_FDEASSERT_S
mdefine_line|#define&t;PLCS_FDEASSERT_S&t;0
macro_line|#else&t;/* nMOT_ELM */
multiline_comment|/*&n; * PCL-S control register&n; * this register in the PLC-S controls the scrambling parameters&n; * can be patched for ANSI compliance if standard changes&n; */
DECL|variable|plcs_control_c_u
r_static
r_const
id|u_char
id|plcs_control_c_u
(braket
l_int|17
)braket
op_assign
l_string|&quot;PLC_CNTRL_C_U=&bslash;0&bslash;0&quot;
suffix:semicolon
DECL|variable|plcs_control_c_s
r_static
r_const
id|u_char
id|plcs_control_c_s
(braket
l_int|17
)braket
op_assign
l_string|&quot;PLC_CNTRL_C_S=&bslash;01&bslash;02&quot;
suffix:semicolon
DECL|macro|PLCS_CONTROL_C_U
mdefine_line|#define PLCS_CONTROL_C_U (plcs_control_c_u[14] | (plcs_control_c_u[15]&lt;&lt;8))
DECL|macro|PLCS_CONTROL_C_S
mdefine_line|#define PLCS_CONTROL_C_S (plcs_control_c_s[14] | (plcs_control_c_s[15]&lt;&lt;8))
macro_line|#endif&t;/* nMOT_ELM */
multiline_comment|/*&n; * external vars&n; */
multiline_comment|/* struct definition see &squot;cmtdef.h&squot; (also used by CFM) */
DECL|macro|PS_OFF
mdefine_line|#define PS_OFF&t;&t;0
DECL|macro|PS_BIT3
mdefine_line|#define PS_BIT3&t;&t;1
DECL|macro|PS_BIT4
mdefine_line|#define PS_BIT4&t;&t;2
DECL|macro|PS_BIT7
mdefine_line|#define PS_BIT7&t;&t;3
DECL|macro|PS_LCT
mdefine_line|#define PS_LCT&t;&t;4
DECL|macro|PS_BIT8
mdefine_line|#define PS_BIT8&t;&t;5
DECL|macro|PS_JOIN
mdefine_line|#define PS_JOIN&t;&t;6
DECL|macro|PS_ACTIVE
mdefine_line|#define PS_ACTIVE&t;7
DECL|macro|LCT_LEM_MAX
mdefine_line|#define LCT_LEM_MAX&t;255
multiline_comment|/*&n; * PLC timing parameter&n; */
DECL|macro|PLC_MS
mdefine_line|#define PLC_MS(m)&t;((int)((0x10000L-(m*100000L/2048))))
DECL|macro|SLOW_TL_MIN
mdefine_line|#define SLOW_TL_MIN&t;PLC_MS(6)
DECL|macro|SLOW_C_MIN
mdefine_line|#define SLOW_C_MIN&t;PLC_MS(10)
DECL|struct|plt
r_static
r_const
r_struct
id|plt
(brace
DECL|member|timer
r_int
id|timer
suffix:semicolon
multiline_comment|/* relative plc timer address */
DECL|member|para
r_int
id|para
suffix:semicolon
multiline_comment|/* default timing parameters */
DECL|variable|pltm
)brace
id|pltm
(braket
)braket
op_assign
(brace
(brace
id|PL_C_MIN
comma
id|SLOW_C_MIN
)brace
comma
multiline_comment|/* min t. to remain Connect State */
(brace
id|PL_TL_MIN
comma
id|SLOW_TL_MIN
)brace
comma
multiline_comment|/* min t. to transmit a Line State */
(brace
id|PL_TB_MIN
comma
id|TP_TB_MIN
)brace
comma
multiline_comment|/* min break time */
(brace
id|PL_T_OUT
comma
id|TP_T_OUT
)brace
comma
multiline_comment|/* Signaling timeout */
(brace
id|PL_LC_LENGTH
comma
id|TP_LC_LENGTH
)brace
comma
multiline_comment|/* Link Confidence Test Time */
(brace
id|PL_T_SCRUB
comma
id|TP_T_SCRUB
)brace
comma
multiline_comment|/* Scrub Time == MAC TVX time ! */
(brace
id|PL_NS_MAX
comma
id|TP_NS_MAX
)brace
comma
multiline_comment|/* max t. that noise is tolerated */
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * interrupt mask&n; */
macro_line|#ifdef&t;SUPERNET_3
multiline_comment|/*&n; * Do we need the EBUF error during signaling, too, to detect SUPERNET_3&n; * PLL bug?&n; */
DECL|variable|plc_imsk_na
r_static
r_int
id|plc_imsk_na
op_assign
id|PL_PCM_CODE
op_or
id|PL_TRACE_PROP
op_or
id|PL_PCM_BREAK
op_or
id|PL_PCM_ENABLED
op_or
id|PL_SELF_TEST
op_or
id|PL_EBUF_ERR
suffix:semicolon
macro_line|#else&t;/* SUPERNET_3 */
multiline_comment|/*&n; * We do NOT need the elasticity buffer error during signaling.&n; */
DECL|variable|plc_imsk_na
r_static
r_int
id|plc_imsk_na
op_assign
id|PL_PCM_CODE
op_or
id|PL_TRACE_PROP
op_or
id|PL_PCM_BREAK
op_or
id|PL_PCM_ENABLED
op_or
id|PL_SELF_TEST
suffix:semicolon
macro_line|#endif&t;/* SUPERNET_3 */
DECL|variable|plc_imsk_act
r_static
r_int
id|plc_imsk_act
op_assign
id|PL_PCM_CODE
op_or
id|PL_TRACE_PROP
op_or
id|PL_PCM_BREAK
op_or
id|PL_PCM_ENABLED
op_or
id|PL_SELF_TEST
op_or
id|PL_EBUF_ERR
suffix:semicolon
multiline_comment|/* external functions */
r_void
id|all_selection_criteria
(paren
)paren
suffix:semicolon
multiline_comment|/* internal functions */
r_static
r_void
id|pcm_fsm
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|pc_rcode_actions
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|pc_tcode_actions
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|reset_lem_struct
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|plc_init
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|sm_ph_lem_start
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|sm_ph_lem_stop
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|sm_ph_linestate
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|real_init_plc
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n; * SMT timer interface&n; *      start PCM timer 0&n; */
DECL|function|start_pcm_timer0
r_static
r_void
id|start_pcm_timer0
c_func
(paren
id|smc
comma
id|value
comma
id|event
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
id|u_long
id|value
suffix:semicolon
r_int
id|event
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
id|phy-&gt;timer0_exp
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* clear timer event flag */
id|smt_timer_start
c_func
(paren
id|smc
comma
op_amp
id|phy-&gt;pcm_timer0
comma
id|value
comma
id|EV_TOKEN
c_func
(paren
id|EVENT_PCM
op_plus
id|phy-&gt;np
comma
id|event
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * SMT timer interface&n; *      stop PCM timer 0&n; */
DECL|function|stop_pcm_timer0
r_static
r_void
id|stop_pcm_timer0
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_if
c_cond
(paren
id|phy-&gt;pcm_timer0.tm_active
)paren
id|smt_timer_stop
c_func
(paren
id|smc
comma
op_amp
id|phy-&gt;pcm_timer0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;init PCM state machine (called by driver)&n;&t;clear all PCM vars and flags&n;*/
DECL|function|pcm_init
r_void
id|pcm_init
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_int
id|np
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
r_for
c_loop
(paren
id|np
op_assign
l_int|0
comma
id|phy
op_assign
id|smc-&gt;y
suffix:semicolon
id|np
OL
id|NUMPHYS
suffix:semicolon
id|np
op_increment
comma
id|phy
op_increment
)paren
(brace
multiline_comment|/* Indicates the type of PHY being used */
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|mib-&gt;fddiPORTPCMState
op_assign
id|ACTIONS
c_func
(paren
id|PC0_OFF
)paren
suffix:semicolon
id|phy-&gt;np
op_assign
id|np
suffix:semicolon
r_switch
c_cond
(paren
id|smc-&gt;s.sas
)paren
(brace
macro_line|#ifdef&t;CONCENTRATOR
r_case
id|SMT_SAS
suffix:colon
id|mib-&gt;fddiPORTMy_Type
op_assign
(paren
id|np
op_eq
id|PS
)paren
ques
c_cond
id|TS
suffix:colon
id|TM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_DAS
suffix:colon
id|mib-&gt;fddiPORTMy_Type
op_assign
(paren
id|np
op_eq
id|PA
)paren
ques
c_cond
id|TA
suffix:colon
(paren
id|np
op_eq
id|PB
)paren
ques
c_cond
id|TB
suffix:colon
id|TM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMT_NAC
suffix:colon
id|mib-&gt;fddiPORTMy_Type
op_assign
id|TM
suffix:semicolon
r_break
suffix:semicolon
macro_line|#else
r_case
id|SMT_SAS
suffix:colon
id|mib-&gt;fddiPORTMy_Type
op_assign
(paren
id|np
op_eq
id|PS
)paren
ques
c_cond
id|TS
suffix:colon
id|TNONE
suffix:semicolon
id|mib-&gt;fddiPORTHardwarePresent
op_assign
(paren
id|np
op_eq
id|PS
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
macro_line|#ifndef&t;SUPERNET_3
id|smc-&gt;y
(braket
id|PA
)braket
dot
id|mib-&gt;fddiPORTPCMState
op_assign
id|PC0_OFF
suffix:semicolon
macro_line|#else
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|mib-&gt;fddiPORTPCMState
op_assign
id|PC0_OFF
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|SMT_DAS
suffix:colon
id|mib-&gt;fddiPORTMy_Type
op_assign
(paren
id|np
op_eq
id|PB
)paren
ques
c_cond
id|TB
suffix:colon
id|TA
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&t;&t; * set PMD-type&n;&t;&t; */
id|phy-&gt;pmd_scramble
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|phy-&gt;pmd_type
(braket
id|PMD_SK_PMD
)braket
)paren
(brace
r_case
l_char|&squot;P&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_MULTI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_LCF
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_TP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;S&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_TP
suffix:semicolon
id|phy-&gt;pmd_scramble
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;U&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_TP
suffix:semicolon
id|phy-&gt;pmd_scramble
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;1&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_SINGLE1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;2&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_SINGLE2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;3&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_SINGLE2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;4&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_SINGLE1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;I&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_TP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;G&squot;
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_TP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|mib-&gt;fddiPORTPMDClass
op_assign
id|MIB_PMDCLASS_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * A and B port can be on primary and secondary path&n;&t;&t; */
r_switch
c_cond
(paren
id|mib-&gt;fddiPORTMy_Type
)paren
(brace
r_case
id|TA
suffix:colon
id|mib-&gt;fddiPORTAvailablePaths
op_or_assign
id|MIB_PATH_S
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|1
)braket
op_assign
id|MIB_P_PATH_LOCAL
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|2
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_CON_ALTER
op_or
id|MIB_P_PATH_SEC_PREFER
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|3
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_CON_ALTER
op_or
id|MIB_P_PATH_SEC_PREFER
op_or
id|MIB_P_PATH_THRU
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TB
suffix:colon
id|mib-&gt;fddiPORTAvailablePaths
op_or_assign
id|MIB_PATH_S
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|1
)braket
op_assign
id|MIB_P_PATH_LOCAL
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|2
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_PRIM_PREFER
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|3
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_PRIM_PREFER
op_or
id|MIB_P_PATH_CON_PREFER
op_or
id|MIB_P_PATH_THRU
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TS
suffix:colon
id|mib-&gt;fddiPORTAvailablePaths
op_or_assign
id|MIB_PATH_S
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|1
)braket
op_assign
id|MIB_P_PATH_LOCAL
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|2
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_CON_ALTER
op_or
id|MIB_P_PATH_PRIM_PREFER
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|3
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_CON_ALTER
op_or
id|MIB_P_PATH_PRIM_PREFER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TM
suffix:colon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|1
)braket
op_assign
id|MIB_P_PATH_LOCAL
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|2
)braket
op_assign
id|MIB_P_PATH_LOCAL
op_or
id|MIB_P_PATH_SEC_ALTER
op_or
id|MIB_P_PATH_PRIM_ALTER
suffix:semicolon
id|mib-&gt;fddiPORTRequestedPaths
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|phy-&gt;pc_lem_fail
op_assign
id|FALSE
suffix:semicolon
id|mib-&gt;fddiPORTPCMStateX
op_assign
id|mib-&gt;fddiPORTPCMState
suffix:semicolon
id|mib-&gt;fddiPORTLCTFail_Ct
op_assign
l_int|0
suffix:semicolon
id|mib-&gt;fddiPORTBS_Flag
op_assign
l_int|0
suffix:semicolon
id|mib-&gt;fddiPORTCurrentPath
op_assign
id|MIB_PATH_ISOLATED
suffix:semicolon
id|mib-&gt;fddiPORTNeighborType
op_assign
id|TNONE
suffix:semicolon
id|phy-&gt;ls_flag
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;rc_flag
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;tc_flag
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;td_flag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np
op_ge
id|PM
)paren
id|phy-&gt;phy_name
op_assign
l_char|&squot;0&squot;
op_plus
id|np
op_minus
id|PM
suffix:semicolon
r_else
id|phy-&gt;phy_name
op_assign
l_char|&squot;A&squot;
op_plus
id|np
suffix:semicolon
id|phy-&gt;wc_flag
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* set by SMT */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phy-&gt;lem
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|lem_counter
)paren
)paren
suffix:semicolon
id|reset_lem_struct
c_func
(paren
id|phy
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phy-&gt;plc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|s_plc
)paren
)paren
suffix:semicolon
id|phy-&gt;plc.p_state
op_assign
id|PS_OFF
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMBITS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|phy-&gt;t_next
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|real_init_plc
c_func
(paren
id|smc
)paren
suffix:semicolon
)brace
DECL|function|init_plc
r_void
id|init_plc
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * dummy&n;&t; * this is an obsolete public entry point that has to remain&n;&t; * for compat. It is used by various drivers.&n;&t; * the work is now done in real_init_plc()&n;&t; * which is called from pcm_init() ;&n;&t; */
)brace
DECL|function|real_init_plc
r_static
r_void
id|real_init_plc
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
l_int|0
suffix:semicolon
id|p
OL
id|NUMPHYS
suffix:semicolon
id|p
op_increment
)paren
id|plc_init
c_func
(paren
id|smc
comma
id|p
)paren
suffix:semicolon
)brace
DECL|function|plc_init
r_static
r_void
id|plc_init
c_func
(paren
id|smc
comma
id|p
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|p
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifndef&t;MOT_ELM
r_int
id|rev
suffix:semicolon
multiline_comment|/* Revision of PLC-x */
macro_line|#endif&t;/* MOT_ELM */
multiline_comment|/* transit PCM state machine to MAINT state */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_B
)paren
comma
l_int|0
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_A
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * if PLC-S then set control register C&n;&t; */
macro_line|#ifndef&t;MOT_ELM
id|rev
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PLC_REV_MASK
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ne
id|PLC_REVISION_A
)paren
macro_line|#endif&t;/* MOT_ELM */
(brace
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|p
)braket
dot
id|pmd_scramble
)paren
(brace
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_C
)paren
comma
id|PLCS_CONTROL_C_S
)paren
suffix:semicolon
macro_line|#ifdef&t;MOT_ELM
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_T_FOT_ASS
)paren
comma
id|PLCS_FASSERT_S
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_T_FOT_DEASS
)paren
comma
id|PLCS_FDEASSERT_S
)paren
suffix:semicolon
macro_line|#endif&t;/* MOT_ELM */
)brace
r_else
(brace
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_C
)paren
comma
id|PLCS_CONTROL_C_U
)paren
suffix:semicolon
macro_line|#ifdef&t;MOT_ELM
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_T_FOT_ASS
)paren
comma
id|PLCS_FASSERT_U
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_T_FOT_DEASS
)paren
comma
id|PLCS_FDEASSERT_U
)paren
suffix:semicolon
macro_line|#endif&t;/* MOT_ELM */
)brace
)brace
multiline_comment|/*&n;&t; * set timer register&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|pltm
(braket
id|i
)braket
dot
id|timer
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* set timer parameter reg */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|pltm
(braket
id|i
)braket
dot
id|timer
)paren
comma
id|pltm
(braket
id|i
)braket
dot
id|para
)paren
suffix:semicolon
(paren
r_void
)paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_INTR_EVENT
)paren
)paren
suffix:semicolon
multiline_comment|/* clear interrupt event reg */
id|plc_clear_irq
c_func
(paren
id|smc
comma
id|p
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_INTR_MASK
)paren
comma
id|plc_imsk_na
)paren
suffix:semicolon
multiline_comment|/* enable non active irq&squot;s */
multiline_comment|/*&n;&t; * if PCM is configured for class s, it will NOT go to the&n;&t; * REMOVE state if offline (page 3-36;)&n;&t; * in the concentrator, all inactive PHYS always must be in&n;&t; * the remove state&n;&t; * there&squot;s no real need to use this feature at all ..&n;&t; */
macro_line|#ifndef&t;CONCENTRATOR
r_if
c_cond
(paren
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
)paren
op_logical_and
(paren
id|p
op_eq
id|PS
)paren
)paren
(brace
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_B
)paren
comma
id|PL_CLASS_S
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * control PCM state machine&n; */
DECL|function|plc_go_state
r_static
r_void
id|plc_go_state
c_func
(paren
id|smc
comma
id|p
comma
id|state
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|p
suffix:semicolon
r_int
id|state
suffix:semicolon
(brace
id|HW_PTR
id|port
suffix:semicolon
r_int
id|val
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|port
op_assign
(paren
id|HW_PTR
)paren
(paren
id|PLC
c_func
(paren
id|p
comma
id|PL_CNTRL_B
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inpw
c_func
(paren
id|port
)paren
op_amp
op_complement
(paren
id|PL_PCM_CNTRL
op_or
id|PL_MAINT
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|port
comma
id|val
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|port
comma
id|val
op_or
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * read current line state (called by ECM &amp; PCM)&n; */
DECL|function|sm_pm_get_ls
r_int
id|sm_pm_get_ls
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|phy
suffix:semicolon
(brace
r_int
id|state
suffix:semicolon
macro_line|#ifdef&t;CONCENTRATOR
r_if
c_cond
(paren
op_logical_neg
id|plc_is_installed
c_func
(paren
id|smc
comma
id|phy
)paren
)paren
r_return
(paren
id|PC_QLS
)paren
suffix:semicolon
macro_line|#endif
id|state
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|phy
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PL_LINE_ST
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|PL_L_QLS
suffix:colon
id|state
op_assign
id|PC_QLS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_MLS
suffix:colon
id|state
op_assign
id|PC_MLS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_HLS
suffix:colon
id|state
op_assign
id|PC_HLS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_ILS4
suffix:colon
r_case
id|PL_L_ILS16
suffix:colon
id|state
op_assign
id|PC_ILS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_ALS
suffix:colon
id|state
op_assign
id|PC_LS_PDR
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|state
op_assign
id|PC_LS_NONE
suffix:semicolon
)brace
r_return
(paren
id|state
)paren
suffix:semicolon
)brace
DECL|function|plc_send_bits
r_static
r_int
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
id|len
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_int
id|len
suffix:semicolon
(brace
r_int
id|np
op_assign
id|phy-&gt;np
suffix:semicolon
multiline_comment|/* PHY index */
r_int
id|n
suffix:semicolon
r_int
id|i
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
multiline_comment|/* create bit vector */
r_for
c_loop
(paren
id|i
op_assign
id|len
op_minus
l_int|1
comma
id|n
op_assign
l_int|0
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|n
op_assign
(paren
id|n
op_lshift
l_int|1
)paren
op_or
id|phy-&gt;t_val
(braket
id|phy-&gt;bitn
op_plus
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_SIGNAL
)paren
(brace
macro_line|#if&t;0
id|printf
c_func
(paren
l_string|&quot;PL_PCM_SIGNAL is set&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* write bit[n] &amp; length = 1 to regs */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_VECTOR_LEN
)paren
comma
id|len
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* len=nr-1 */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_XMIT_VECTOR
)paren
comma
id|n
)paren
suffix:semicolon
macro_line|#ifdef&t;DEBUG
macro_line|#if 1
macro_line|#ifdef&t;DEBUG_BRD
r_if
c_cond
(paren
id|smc-&gt;debug.d_plc
op_amp
l_int|0x80
)paren
macro_line|#else
r_if
c_cond
(paren
id|debug.d_plc
op_amp
l_int|0x80
)paren
macro_line|#endif
id|printf
c_func
(paren
l_string|&quot;SIGNALING bit %d .. %d&bslash;n&quot;
comma
id|phy-&gt;bitn
comma
id|phy-&gt;bitn
op_plus
id|len
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * config plc muxes&n; */
DECL|function|plc_config_mux
r_void
id|plc_config_mux
c_func
(paren
id|smc
comma
id|mux
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|mux
suffix:semicolon
(brace
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_ne
id|SMT_DAS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|mux
op_eq
id|MUX_WRAPB
)paren
(brace
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|PA
comma
id|PL_CNTRL_B
)paren
comma
id|PL_CONFIG_CNTRL
comma
id|PL_CONFIG_CNTRL
)paren
suffix:semicolon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|PA
comma
id|PL_CNTRL_A
)paren
comma
id|PL_SC_REM_LOOP
comma
id|PL_SC_REM_LOOP
)paren
suffix:semicolon
)brace
r_else
(brace
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|PA
comma
id|PL_CNTRL_B
)paren
comma
id|PL_CONFIG_CNTRL
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|PA
comma
id|PL_CNTRL_A
)paren
comma
id|PL_SC_REM_LOOP
)paren
suffix:semicolon
)brace
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|PB
comma
id|PL_CNTRL_B
)paren
comma
id|PL_CONFIG_CNTRL
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|PB
comma
id|PL_CNTRL_A
)paren
comma
id|PL_SC_REM_LOOP
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;PCM state machine&n;&t;called by dispatcher  &amp; fddi_init() (driver)&n;&t;do&n;&t;&t;display state change&n;&t;&t;process event&n;&t;until SM is stable&n;*/
DECL|function|pcm
r_void
id|pcm
c_func
(paren
id|smc
comma
id|np
comma
id|event
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_const
r_int
id|np
suffix:semicolon
r_int
id|event
suffix:semicolon
(brace
r_int
id|state
suffix:semicolon
r_int
id|oldstate
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
macro_line|#ifndef&t;CONCENTRATOR
multiline_comment|/*&n;&t; * ignore 2nd PHY if SAS&n;&t; */
r_if
c_cond
(paren
(paren
id|np
op_ne
id|PS
)paren
op_logical_and
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_SAS
)paren
)paren
r_return
suffix:semicolon
macro_line|#endif
id|phy
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|oldstate
op_assign
id|mib-&gt;fddiPORTPCMState
suffix:semicolon
r_do
(brace
id|DB_PCM
c_func
(paren
l_string|&quot;PCM %c: state %s&quot;
comma
id|phy-&gt;phy_name
comma
(paren
id|mib-&gt;fddiPORTPCMState
op_amp
id|AFLAG
)paren
ques
c_cond
l_string|&quot;ACTIONS &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|DB_PCM
c_func
(paren
l_string|&quot;%s, event %s&bslash;n&quot;
comma
id|pcm_states
(braket
id|mib-&gt;fddiPORTPCMState
op_amp
op_complement
id|AFLAG
)braket
comma
id|pcm_events
(braket
id|event
)braket
)paren
suffix:semicolon
id|state
op_assign
id|mib-&gt;fddiPORTPCMState
suffix:semicolon
id|pcm_fsm
c_func
(paren
id|smc
comma
id|phy
comma
id|event
)paren
suffix:semicolon
id|event
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|state
op_ne
id|mib-&gt;fddiPORTPCMState
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * because the PLC does the bit signaling for us,&n;&t; * we&squot;re always in SIGNAL state&n;&t; * the MIB want&squot;s to see CONNECT&n;&t; * we therefore fake an entry in the MIB&n;&t; */
r_if
c_cond
(paren
id|state
op_eq
id|PC5_SIGNAL
)paren
id|mib-&gt;fddiPORTPCMStateX
op_assign
id|PC3_CONNECT
suffix:semicolon
r_else
id|mib-&gt;fddiPORTPCMStateX
op_assign
id|state
suffix:semicolon
macro_line|#ifndef&t;SLIM_SMT
multiline_comment|/*&n;&t; * path change&n;&t; */
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_ne
id|oldstate
op_logical_and
(paren
(paren
id|oldstate
op_eq
id|PC8_ACTIVE
)paren
op_logical_or
(paren
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
)paren
)paren
(brace
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_PORT_PATH_CHANGE
comma
(paren
r_int
)paren
(paren
id|INDEX_PORT
op_plus
id|phy-&gt;np
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FDDI_MIB
multiline_comment|/* check whether a snmp-trap has to be sent */
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_ne
id|oldstate
)paren
(brace
multiline_comment|/* a real state change took place */
id|DB_SNMP
(paren
l_string|&quot;PCM from %d to %d&bslash;n&quot;
comma
id|oldstate
comma
id|mib-&gt;fddiPORTPCMState
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC0_OFF
)paren
(brace
multiline_comment|/* send first trap */
id|snmp_fddi_trap
(paren
id|smc
comma
l_int|1
comma
(paren
r_int
)paren
id|mib-&gt;fddiPORTIndex
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oldstate
op_eq
id|PC0_OFF
)paren
(brace
multiline_comment|/* send second trap */
id|snmp_fddi_trap
(paren
id|smc
comma
l_int|2
comma
(paren
r_int
)paren
id|mib-&gt;fddiPORTIndex
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_ne
id|PC2_TRACE
op_logical_and
id|oldstate
op_eq
id|PC8_ACTIVE
)paren
(brace
multiline_comment|/* send third trap */
id|snmp_fddi_trap
(paren
id|smc
comma
l_int|3
comma
(paren
r_int
)paren
id|mib-&gt;fddiPORTIndex
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
(brace
multiline_comment|/* send fourth trap */
id|snmp_fddi_trap
(paren
id|smc
comma
l_int|4
comma
(paren
r_int
)paren
id|mib-&gt;fddiPORTIndex
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|pcm_state_change
c_func
(paren
id|smc
comma
id|np
comma
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * PCM state machine&n; */
DECL|function|pcm_fsm
r_static
r_void
id|pcm_fsm
c_func
(paren
id|smc
comma
id|phy
comma
id|cmd
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_int
id|cmd
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_int
id|np
op_assign
id|phy-&gt;np
suffix:semicolon
multiline_comment|/* PHY index */
r_struct
id|s_plc
op_star
id|plc
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
macro_line|#ifndef&t;MOT_ELM
id|u_short
id|plc_rev
suffix:semicolon
multiline_comment|/* Revision of the plc */
macro_line|#endif&t;/* nMOT_ELM */
id|plc
op_assign
op_amp
id|phy-&gt;plc
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
multiline_comment|/*&n;&t; * general transitions independant of state&n;&t; */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PC_STOP
suffix:colon
multiline_comment|/*PC00-PC80*/
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_ne
id|PC9_MAINT
)paren
(brace
id|GO_STATE
c_func
(paren
id|PC0_OFF
)paren
suffix:semicolon
id|AIX_EVENT
c_func
(paren
id|smc
comma
(paren
id|u_long
)paren
id|FDDI_RING_STATUS
comma
(paren
id|u_long
)paren
id|FDDI_PORT_EVENT
comma
(paren
id|u_long
)paren
id|FDDI_PORT_STOP
comma
id|smt_get_port_event_word
c_func
(paren
id|smc
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|PC_START
suffix:colon
multiline_comment|/*PC01-PC81*/
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
op_ne
id|PC9_MAINT
)paren
id|GO_STATE
c_func
(paren
id|PC1_BREAK
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|PC_DISABLE
suffix:colon
multiline_comment|/* PC09-PC99 */
id|GO_STATE
c_func
(paren
id|PC9_MAINT
)paren
suffix:semicolon
id|AIX_EVENT
c_func
(paren
id|smc
comma
(paren
id|u_long
)paren
id|FDDI_RING_STATUS
comma
(paren
id|u_long
)paren
id|FDDI_PORT_EVENT
comma
(paren
id|u_long
)paren
id|FDDI_PORT_DISABLED
comma
id|smt_get_port_event_word
c_func
(paren
id|smc
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|PC_TIMEOUT_LCT
suffix:colon
multiline_comment|/* if long or extended LCT */
id|stop_pcm_timer0
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
)paren
suffix:semicolon
multiline_comment|/* end of LCT is indicate by PCM_CODE (initiate PCM event) */
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
)paren
(brace
r_case
id|ACTIONS
c_func
(paren
id|PC0_OFF
)paren
suffix:colon
id|stop_pcm_timer0
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_A
)paren
comma
l_int|0
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PC_JOIN
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
)paren
suffix:semicolon
id|sm_ph_lem_stop
c_func
(paren
id|smc
comma
id|np
)paren
suffix:semicolon
multiline_comment|/* disable LEM */
id|phy-&gt;cf_loop
op_assign
id|FALSE
suffix:semicolon
id|phy-&gt;cf_join
op_assign
id|FALSE
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_CFM
comma
id|CF_JOIN
op_plus
id|np
)paren
suffix:semicolon
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_DISABLED
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC0_OFF
suffix:colon
multiline_comment|/*PC09*/
r_if
c_cond
(paren
id|cmd
op_eq
id|PC_MAINT
)paren
(brace
id|GO_STATE
c_func
(paren
id|PC9_MAINT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC1_BREAK
)paren
suffix:colon
multiline_comment|/* Stop the LCT timer if we came from Signal state */
id|stop_pcm_timer0
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
l_int|0
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PC_JOIN
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
)paren
suffix:semicolon
id|sm_ph_lem_stop
c_func
(paren
id|smc
comma
id|np
)paren
suffix:semicolon
multiline_comment|/* disable LEM */
multiline_comment|/*&n;&t;&t; * if vector is already loaded, go to OFF to clear PCM_SIGNAL&n;&t;&t; */
macro_line|#if&t;0
r_if
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_SIGNAL
)paren
(brace
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
multiline_comment|/* TB_MIN ? */
)brace
macro_line|#endif
multiline_comment|/*&n;&t;&t; * Go to OFF state in any case.&n;&t;&t; */
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPC_Withhold
op_eq
id|PC_WH_NONE
)paren
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_CONNECTING
suffix:semicolon
id|phy-&gt;cf_loop
op_assign
id|FALSE
suffix:semicolon
id|phy-&gt;cf_join
op_assign
id|FALSE
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_CFM
comma
id|CF_JOIN
op_plus
id|np
)paren
suffix:semicolon
id|phy-&gt;ls_flag
op_assign
id|FALSE
suffix:semicolon
id|phy-&gt;pc_mode
op_assign
id|PM_NONE
suffix:semicolon
multiline_comment|/* needed by CFM */
id|phy-&gt;bitn
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* bit signaling start bit */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|pc_tcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
multiline_comment|/* Set the non-active interrupt mask register */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|plc_imsk_na
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If the LCT was stopped. There might be a&n;&t;&t; * PCM_CODE interrupt event present.&n;&t;&t; * This must be cleared.&n;&t;&t; */
(paren
r_void
)paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_EVENT
)paren
)paren
suffix:semicolon
macro_line|#ifndef&t;MOT_ELM
multiline_comment|/* Get the plc revision for revision dependent code */
id|plc_rev
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PLC_REV_MASK
suffix:semicolon
r_if
c_cond
(paren
id|plc_rev
op_ne
id|PLC_REV_SN3
)paren
macro_line|#endif&t;/* MOT_ELM */
(brace
multiline_comment|/*&n;&t;&t;&t; * No supernet III PLC, so set Xmit verctor and&n;&t;&t;&t; * length BEFORE starting the state machine.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|3
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * Now give the Start command.&n;&t;&t; * - The start command shall be done before setting the bits&n;&t;&t; *   to be signaled. (In PLC-S description and PLCS in SN3.&n;&t;&t; * - The start command shall be issued AFTER setting the&n;&t;&t; *   XMIT vector and the XMIT length register.&n;&t;&t; *&n;&t;&t; * We do it exactly according this specs for the old PLC and&n;&t;&t; * the new PLCS inside the SN3.&n;&t;&t; * For the usual PLCS we try it the way it is done for the&n;&t;&t; * old PLC and set the XMIT registers again, if the PLC is&n;&t;&t; * not in SIGNAL state. This is done according to an PLCS&n;&t;&t; * errata workaround.&n;&t;&t; */
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_START
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * workaround for PLC-S eng. sample errata&n;&t;&t; */
macro_line|#ifdef&t;MOT_ELM
r_if
c_cond
(paren
op_logical_neg
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_SIGNAL
)paren
)paren
macro_line|#else&t;/* nMOT_ELM */
r_if
c_cond
(paren
(paren
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PLC_REV_MASK
)paren
op_ne
id|PLC_REVISION_A
)paren
op_logical_and
op_logical_neg
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_SIGNAL
)paren
)paren
macro_line|#endif&t;/* nMOT_ELM */
(brace
multiline_comment|/*&n;&t;&t;&t; * Set register again (PLCS errata) or the first time&n;&t;&t;&t; * (new SN3 PLCS).&n;&t;&t;&t; */
(paren
r_void
)paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|3
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * end of workaround&n;&t;&t; */
id|GO_STATE
c_func
(paren
id|PC5_SIGNAL
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_BIT3
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|3
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC1_BREAK
suffix:colon
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC2_TRACE
)paren
suffix:colon
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_TRACE
)paren
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC2_TRACE
suffix:colon
r_break
suffix:semicolon
r_case
id|PC3_CONNECT
suffix:colon
multiline_comment|/* these states are done by hardware */
r_case
id|PC4_NEXT
suffix:colon
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC5_SIGNAL
)paren
suffix:colon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
r_case
id|PC5_SIGNAL
suffix:colon
r_if
c_cond
(paren
(paren
id|cmd
op_ne
id|PC_SIGNAL
)paren
op_logical_and
(paren
id|cmd
op_ne
id|PC_TIMEOUT_LCT
)paren
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|plc-&gt;p_state
)paren
(brace
r_case
id|PS_BIT3
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|pc_rcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
id|pc_tcode_actions
c_func
(paren
id|smc
comma
l_int|3
comma
id|phy
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_BIT4
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|1
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|3
suffix:semicolon
id|phy-&gt;bitn
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|1
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PS_BIT4
suffix:colon
id|pc_rcode_actions
c_func
(paren
id|smc
comma
l_int|3
comma
id|phy
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|4
suffix:semicolon
id|i
op_le
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|pc_tcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_BIT7
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|3
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|4
suffix:semicolon
id|phy-&gt;bitn
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|3
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PS_BIT7
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
op_le
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|pc_rcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_LCT
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|0
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|7
suffix:semicolon
id|phy-&gt;bitn
op_assign
l_int|7
suffix:semicolon
id|sm_ph_lem_start
c_func
(paren
id|smc
comma
id|np
comma
(paren
r_int
)paren
id|smc-&gt;s.lct_short
)paren
suffix:semicolon
multiline_comment|/* enable LEM */
multiline_comment|/* start LCT */
id|i
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
)paren
op_amp
op_complement
id|PL_PC_LOOP
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* must be cleared */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|i
op_or
id|PL_RLBP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PS_LCT
suffix:colon
multiline_comment|/* check for local LCT failure */
id|pc_tcode_actions
c_func
(paren
id|smc
comma
l_int|7
comma
id|phy
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * set tval[7]&n;&t;&t;&t; */
id|plc-&gt;p_state
op_assign
id|PS_BIT8
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|1
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|7
suffix:semicolon
id|phy-&gt;bitn
op_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|1
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PS_BIT8
suffix:colon
multiline_comment|/* check for remote LCT failure */
id|pc_rcode_actions
c_func
(paren
id|smc
comma
l_int|7
comma
id|phy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|7
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|7
)braket
)paren
(brace
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
id|GO_STATE
c_func
(paren
id|PC1_BREAK
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_le
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|pc_tcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_JOIN
suffix:semicolon
id|plc-&gt;p_bits
op_assign
l_int|2
suffix:semicolon
id|plc-&gt;p_start
op_assign
l_int|8
suffix:semicolon
id|phy-&gt;bitn
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|plc_send_bits
c_func
(paren
id|smc
comma
id|phy
comma
l_int|2
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PS_JOIN
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_le
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|pc_rcode_actions
c_func
(paren
id|smc
comma
id|i
comma
id|phy
)paren
suffix:semicolon
id|plc-&gt;p_state
op_assign
id|PS_ACTIVE
suffix:semicolon
id|GO_STATE
c_func
(paren
id|PC6_JOIN
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC6_JOIN
)paren
suffix:colon
multiline_comment|/*&n;&t;&t; * prevent mux error when going from WRAP_A to WRAP_B&n;&t;&t; */
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_DAS
op_logical_and
id|np
op_eq
id|PB
op_logical_and
(paren
id|smc-&gt;y
(braket
id|PA
)braket
dot
id|pc_mode
op_eq
id|PM_TREE
op_logical_or
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|pc_mode
op_eq
id|PM_TREE
)paren
)paren
(brace
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_A
)paren
comma
id|PL_SC_REM_LOOP
comma
id|PL_SC_REM_LOOP
)paren
suffix:semicolon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_CONFIG_CNTRL
comma
id|PL_CONFIG_CNTRL
)paren
suffix:semicolon
)brace
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PC_JOIN
comma
id|PL_PC_JOIN
)paren
suffix:semicolon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PC_JOIN
comma
id|PL_PC_JOIN
)paren
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
id|cmd
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* fall thru */
r_case
id|PC6_JOIN
suffix:colon
r_switch
c_cond
(paren
id|plc-&gt;p_state
)paren
(brace
r_case
id|PS_ACTIVE
suffix:colon
multiline_comment|/*PC88b*/
r_if
c_cond
(paren
op_logical_neg
id|phy-&gt;cf_join
)paren
(brace
id|phy-&gt;cf_join
op_assign
id|TRUE
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_CFM
comma
id|CF_JOIN
op_plus
id|np
)paren
suffix:semicolon
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|PC_JOIN
)paren
id|GO_STATE
c_func
(paren
id|PC8_ACTIVE
)paren
suffix:semicolon
multiline_comment|/*PC82*/
r_if
c_cond
(paren
id|cmd
op_eq
id|PC_TRACE
)paren
(brace
id|GO_STATE
c_func
(paren
id|PC2_TRACE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PC7_VERIFY
suffix:colon
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC8_ACTIVE
)paren
suffix:colon
multiline_comment|/*&n;&t;&t; * start LEM for SMT&n;&t;&t; */
id|sm_ph_lem_start
c_func
(paren
id|smc
comma
(paren
r_int
)paren
id|phy-&gt;np
comma
id|LCT_LEM_MAX
)paren
suffix:semicolon
id|phy-&gt;tr_flag
op_assign
id|FALSE
suffix:semicolon
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_ACTIVE
suffix:semicolon
multiline_comment|/* Set the active interrupt mask register */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|plc_imsk_act
)paren
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC8_ACTIVE
suffix:colon
multiline_comment|/*PC81 is done by PL_TNE_EXPIRED irq */
multiline_comment|/*PC82*/
r_if
c_cond
(paren
id|cmd
op_eq
id|PC_TRACE
)paren
(brace
id|GO_STATE
c_func
(paren
id|PC2_TRACE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*PC88c: is done by TRACE_PROP irq */
r_break
suffix:semicolon
r_case
id|ACTIONS
c_func
(paren
id|PC9_MAINT
)paren
suffix:colon
id|stop_pcm_timer0
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_PC_JOIN
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
)paren
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|PL_LE_CTR
)paren
suffix:semicolon
multiline_comment|/* disable LEM int. */
id|sm_ph_lem_stop
c_func
(paren
id|smc
comma
id|np
)paren
suffix:semicolon
multiline_comment|/* disable LEM */
id|phy-&gt;cf_loop
op_assign
id|FALSE
suffix:semicolon
id|phy-&gt;cf_join
op_assign
id|FALSE
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_CFM
comma
id|CF_JOIN
op_plus
id|np
)paren
suffix:semicolon
id|plc_go_state
c_func
(paren
id|smc
comma
id|np
comma
id|PL_PCM_STOP
)paren
suffix:semicolon
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_DISABLED
suffix:semicolon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_MAINT
comma
id|PL_MAINT
)paren
suffix:semicolon
id|sm_ph_linestate
c_func
(paren
id|smc
comma
id|np
comma
(paren
r_int
)paren
id|MIB2LS
c_func
(paren
id|mib-&gt;fddiPORTMaint_LS
)paren
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_A
)paren
comma
id|PL_SC_BYPASS
)paren
suffix:semicolon
id|ACTIONS_DONE
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC9_MAINT
suffix:colon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : MAINT&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*PC90*/
r_if
c_cond
(paren
id|cmd
op_eq
id|PC_ENABLE
)paren
(brace
id|GO_STATE
c_func
(paren
id|PC0_OFF
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|SMT_PANIC
c_func
(paren
id|smc
comma
id|SMT_E0118
comma
id|SMT_E0118_MSG
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * force line state on a PHY output&t;(only in MAINT state)&n; */
DECL|function|sm_ph_linestate
r_static
r_void
id|sm_ph_linestate
c_func
(paren
id|smc
comma
id|phy
comma
id|ls
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|phy
suffix:semicolon
r_int
id|ls
suffix:semicolon
(brace
r_int
id|cntrl
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|cntrl
op_assign
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|phy
comma
id|PL_CNTRL_B
)paren
)paren
op_amp
op_complement
id|PL_MAINT_LS
)paren
op_or
id|PL_PCM_STOP
op_or
id|PL_MAINT
suffix:semicolon
r_switch
c_cond
(paren
id|ls
)paren
(brace
r_case
id|PC_QLS
suffix:colon
multiline_comment|/* Force Quiet */
id|cntrl
op_or_assign
id|PL_M_QUI0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC_MLS
suffix:colon
multiline_comment|/* Force Master */
id|cntrl
op_or_assign
id|PL_M_MASTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC_HLS
suffix:colon
multiline_comment|/* Force Halt */
id|cntrl
op_or_assign
id|PL_M_HALT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|PC_ILS
suffix:colon
multiline_comment|/* Force Idle */
id|cntrl
op_or_assign
id|PL_M_IDLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC_LS_PDR
suffix:colon
multiline_comment|/* Enable repeat filter */
id|cntrl
op_or_assign
id|PL_M_TPDR
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|phy
comma
id|PL_CNTRL_B
)paren
comma
id|cntrl
)paren
suffix:semicolon
)brace
DECL|function|reset_lem_struct
r_static
r_void
id|reset_lem_struct
c_func
(paren
id|phy
)paren
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_struct
id|lem_counter
op_star
id|lem
op_assign
op_amp
id|phy-&gt;lem
suffix:semicolon
id|phy-&gt;mib-&gt;fddiPORTLer_Estimate
op_assign
l_int|15
suffix:semicolon
id|lem-&gt;lem_float_ber
op_assign
l_int|15
op_star
l_int|100
suffix:semicolon
)brace
multiline_comment|/*&n; * link error monitor&n; */
DECL|function|lem_evaluate
r_static
r_void
id|lem_evaluate
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_int
id|ber
suffix:semicolon
id|u_long
id|errors
suffix:semicolon
r_struct
id|lem_counter
op_star
id|lem
op_assign
op_amp
id|phy-&gt;lem
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
r_int
id|cond
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lem-&gt;lem_on
)paren
r_return
suffix:semicolon
id|errors
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
(paren
(paren
r_int
)paren
id|phy-&gt;np
)paren
comma
id|PL_LINK_ERR_CTR
)paren
)paren
suffix:semicolon
id|lem-&gt;lem_errors
op_add_assign
id|errors
suffix:semicolon
id|mib-&gt;fddiPORTLem_Ct
op_add_assign
id|errors
suffix:semicolon
id|errors
op_assign
id|lem-&gt;lem_errors
suffix:semicolon
multiline_comment|/*&n;&t; * calculation is called on a intervall of 8 seconds&n;&t; *&t;-&gt; this means, that one error in 8 sec. is one of 8*125*10E6&n;&t; *&t;the same as BER = 10E-9&n;&t; * Please note:&n;&t; *&t;-&gt; 9 errors in 8 seconds mean:&n;&t; *&t;   BER = 9 * 10E-9  and this is&n;&t; *&t;    &lt; 10E-8, so the limit of 10E-8 is not reached!&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|errors
)paren
id|ber
op_assign
l_int|15
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|9
)paren
id|ber
op_assign
l_int|9
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|99
)paren
id|ber
op_assign
l_int|8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|999
)paren
id|ber
op_assign
l_int|7
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|9999
)paren
id|ber
op_assign
l_int|6
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|99999
)paren
id|ber
op_assign
l_int|5
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|999999
)paren
id|ber
op_assign
l_int|4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|9999999
)paren
id|ber
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|99999999
)paren
id|ber
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|errors
op_le
l_int|999999999
)paren
id|ber
op_assign
l_int|1
suffix:semicolon
r_else
id|ber
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * weighted average&n;&t; */
id|ber
op_mul_assign
l_int|100
suffix:semicolon
id|lem-&gt;lem_float_ber
op_assign
id|lem-&gt;lem_float_ber
op_star
l_int|7
op_plus
id|ber
op_star
l_int|3
suffix:semicolon
id|lem-&gt;lem_float_ber
op_div_assign
l_int|10
suffix:semicolon
id|mib-&gt;fddiPORTLer_Estimate
op_assign
id|lem-&gt;lem_float_ber
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTLer_Estimate
OL
l_int|4
)paren
(brace
id|mib-&gt;fddiPORTLer_Estimate
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lem-&gt;lem_errors
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;LEM %c :&bslash;n&quot;
comma
id|phy-&gt;np
op_eq
id|PB
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
l_int|0
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;errors      : %ld&bslash;n&quot;
comma
id|lem-&gt;lem_errors
comma
l_int|0
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;sum_errors  : %ld&bslash;n&quot;
comma
id|mib-&gt;fddiPORTLem_Ct
comma
l_int|0
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;current BER : 10E-%d&bslash;n&quot;
comma
id|ber
op_div
l_int|100
comma
l_int|0
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;float BER   : 10E-(%d/100)&bslash;n&quot;
comma
id|lem-&gt;lem_float_ber
comma
l_int|0
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;avg. BER    : 10E-%d&bslash;n&quot;
comma
id|mib-&gt;fddiPORTLer_Estimate
comma
l_int|0
)paren
suffix:semicolon
)brace
id|lem-&gt;lem_errors
op_assign
l_int|0L
suffix:semicolon
macro_line|#ifndef&t;SLIM_SMT
id|cond
op_assign
(paren
id|mib-&gt;fddiPORTLer_Estimate
op_le
id|mib-&gt;fddiPORTLer_Alarm
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
macro_line|#ifdef&t;SMT_EXT_CUTOFF
id|smt_ler_alarm_check
c_func
(paren
id|smc
comma
id|phy
comma
id|cond
)paren
suffix:semicolon
macro_line|#endif&t;/* nSMT_EXT_CUTOFF */
r_if
c_cond
(paren
id|cond
op_ne
id|mib-&gt;fddiPORTLerFlag
)paren
(brace
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_COND_PORT_LER
comma
(paren
r_int
)paren
(paren
id|INDEX_PORT
op_plus
id|phy-&gt;np
)paren
comma
id|cond
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|mib-&gt;fddiPORTLer_Estimate
op_le
id|mib-&gt;fddiPORTLer_Cutoff
)paren
(brace
id|phy-&gt;pc_lem_fail
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* flag */
id|mib-&gt;fddiPORTLem_Reject_Ct
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; * &quot;forgive 10e-2&quot; if we cutoff so we can come&n;&t;&t; * up again ..&n;&t;&t; */
id|lem-&gt;lem_float_ber
op_add_assign
l_int|2
op_star
l_int|100
suffix:semicolon
multiline_comment|/*PC81b*/
macro_line|#ifdef&t;CONCENTRATOR
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM: LER cutoff on port %d cutoff %d&bslash;n&quot;
comma
id|phy-&gt;np
comma
id|mib-&gt;fddiPORTLer_Cutoff
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;SMT_EXT_CUTOFF
id|smt_port_off_event
c_func
(paren
id|smc
comma
id|phy-&gt;np
)paren
suffix:semicolon
macro_line|#else&t;/* nSMT_EXT_CUTOFF */
id|queue_event
c_func
(paren
id|smc
comma
(paren
r_int
)paren
(paren
id|EVENT_PCM
op_plus
id|phy-&gt;np
)paren
comma
id|PC_START
)paren
suffix:semicolon
macro_line|#endif&t;/* nSMT_EXT_CUTOFF */
)brace
)brace
multiline_comment|/*&n; * called by SMT to calculate LEM bit error rate&n; */
DECL|function|sm_lem_evaluate
r_void
id|sm_lem_evaluate
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|np
suffix:semicolon
r_for
c_loop
(paren
id|np
op_assign
l_int|0
suffix:semicolon
id|np
OL
id|NUMPHYS
suffix:semicolon
id|np
op_increment
)paren
id|lem_evaluate
c_func
(paren
id|smc
comma
op_amp
id|smc-&gt;y
(braket
id|np
)braket
)paren
suffix:semicolon
)brace
DECL|function|lem_check_lct
r_static
r_void
id|lem_check_lct
c_func
(paren
id|smc
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_struct
id|lem_counter
op_star
id|lem
op_assign
op_amp
id|phy-&gt;lem
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
r_int
id|errors
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|phy-&gt;pc_lem_fail
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* flag */
id|errors
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
(paren
(paren
r_int
)paren
id|phy-&gt;np
)paren
comma
id|PL_LINK_ERR_CTR
)paren
)paren
suffix:semicolon
id|lem-&gt;lem_errors
op_add_assign
id|errors
suffix:semicolon
id|mib-&gt;fddiPORTLem_Ct
op_add_assign
id|errors
suffix:semicolon
r_if
c_cond
(paren
id|lem-&gt;lem_errors
)paren
(brace
r_switch
c_cond
(paren
id|phy-&gt;lc_test
)paren
(brace
r_case
id|LC_SHORT
suffix:colon
r_if
c_cond
(paren
id|lem-&gt;lem_errors
op_ge
id|smc-&gt;s.lct_short
)paren
id|phy-&gt;pc_lem_fail
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_MEDIUM
suffix:colon
r_if
c_cond
(paren
id|lem-&gt;lem_errors
op_ge
id|smc-&gt;s.lct_medium
)paren
id|phy-&gt;pc_lem_fail
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_LONG
suffix:colon
r_if
c_cond
(paren
id|lem-&gt;lem_errors
op_ge
id|smc-&gt;s.lct_long
)paren
id|phy-&gt;pc_lem_fail
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_EXTENDED
suffix:colon
r_if
c_cond
(paren
id|lem-&gt;lem_errors
op_ge
id|smc-&gt;s.lct_extended
)paren
id|phy-&gt;pc_lem_fail
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot; &gt;&gt;errors : %d&bslash;n&quot;
comma
id|lem-&gt;lem_errors
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|phy-&gt;pc_lem_fail
)paren
(brace
id|mib-&gt;fddiPORTLCTFail_Ct
op_increment
suffix:semicolon
id|mib-&gt;fddiPORTLem_Reject_Ct
op_increment
suffix:semicolon
)brace
r_else
id|mib-&gt;fddiPORTLCTFail_Ct
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * LEM functions&n; */
DECL|function|sm_ph_lem_start
r_static
r_void
id|sm_ph_lem_start
c_func
(paren
id|smc
comma
id|np
comma
id|threshold
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
r_int
id|threshold
suffix:semicolon
(brace
r_struct
id|lem_counter
op_star
id|lem
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
dot
id|lem
suffix:semicolon
id|lem-&gt;lem_on
op_assign
l_int|1
suffix:semicolon
id|lem-&gt;lem_errors
op_assign
l_int|0L
suffix:semicolon
multiline_comment|/* Do NOT reset mib-&gt;fddiPORTLer_Estimate here. It is called too&n;&t; * often.&n;&t; */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_LE_THRESHOLD
)paren
comma
id|threshold
)paren
suffix:semicolon
(paren
r_void
)paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_LINK_ERR_CTR
)paren
)paren
suffix:semicolon
multiline_comment|/* clear error counter */
multiline_comment|/* enable LE INT */
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|PL_LE_CTR
comma
id|PL_LE_CTR
)paren
suffix:semicolon
)brace
DECL|function|sm_ph_lem_stop
r_static
r_void
id|sm_ph_lem_stop
c_func
(paren
id|smc
comma
id|np
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
(brace
r_struct
id|lem_counter
op_star
id|lem
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
dot
id|lem
suffix:semicolon
id|lem-&gt;lem_on
op_assign
l_int|0
suffix:semicolon
id|CLEAR
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|PL_LE_CTR
)paren
suffix:semicolon
)brace
multiline_comment|/* ARGSUSED */
DECL|function|sm_pm_ls_latch
r_void
id|sm_pm_ls_latch
c_func
(paren
id|smc
comma
id|phy
comma
id|on_off
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|phy
suffix:semicolon
r_int
id|on_off
suffix:semicolon
multiline_comment|/* en- or disable ident. ls */
(brace
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
id|phy
op_assign
id|phy
suffix:semicolon
id|on_off
op_assign
id|on_off
suffix:semicolon
)brace
multiline_comment|/*&n; * PCM pseudo code&n; * receive actions are called AFTER the bit n is received,&n; * i.e. if pc_rcode_actions(5) is called, bit 6 is the next bit to be received&n; */
multiline_comment|/*&n; * PCM pseudo code 5.1 .. 6.1&n; */
DECL|function|pc_rcode_actions
r_static
r_void
id|pc_rcode_actions
c_func
(paren
id|smc
comma
id|bit
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;SIG rec %x %x: &bslash;n&quot;
comma
id|bit
comma
id|phy-&gt;r_val
(braket
id|bit
)braket
)paren
suffix:semicolon
id|bit
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|bit
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
l_int|1
)braket
op_eq
l_int|0
op_logical_and
id|phy-&gt;r_val
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
id|mib-&gt;fddiPORTNeighborType
op_assign
id|TA
suffix:semicolon
r_else
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
l_int|1
)braket
op_eq
l_int|0
op_logical_and
id|phy-&gt;r_val
(braket
l_int|2
)braket
op_eq
l_int|1
)paren
id|mib-&gt;fddiPORTNeighborType
op_assign
id|TB
suffix:semicolon
r_else
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
l_int|1
)braket
op_eq
l_int|1
op_logical_and
id|phy-&gt;r_val
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
id|mib-&gt;fddiPORTNeighborType
op_assign
id|TS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
l_int|1
)braket
op_eq
l_int|1
op_logical_and
id|phy-&gt;r_val
(braket
l_int|2
)braket
op_eq
l_int|1
)paren
id|mib-&gt;fddiPORTNeighborType
op_assign
id|TM
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TM
op_logical_and
id|mib-&gt;fddiPORTNeighborType
op_eq
id|TM
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : E100 withhold M-M&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_int|0
)paren
suffix:semicolon
id|mib-&gt;fddiPORTPC_Withhold
op_assign
id|PC_WH_M_M
suffix:semicolon
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|3
)braket
)paren
(brace
id|mib-&gt;fddiPORTPC_Withhold
op_assign
id|PC_WH_NONE
suffix:semicolon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TM
op_logical_or
id|mib-&gt;fddiPORTNeighborType
op_eq
id|TM
)paren
id|phy-&gt;pc_mode
op_assign
id|PM_TREE
suffix:semicolon
r_else
id|phy-&gt;pc_mode
op_assign
id|PM_PEER
suffix:semicolon
multiline_comment|/* reevaluate the selection criteria (wc_flag) */
id|all_selection_criteria
(paren
id|smc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;wc_flag
)paren
(brace
id|mib-&gt;fddiPORTPC_Withhold
op_assign
id|PC_WH_PATH
suffix:semicolon
)brace
)brace
r_else
(brace
id|mib-&gt;fddiPORTPC_Withhold
op_assign
id|PC_WH_OTHER
suffix:semicolon
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_EVENT
)paren
suffix:semicolon
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : E101 withhold other&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_int|0
)paren
suffix:semicolon
)brace
id|phy-&gt;twisted
op_assign
(paren
(paren
id|mib-&gt;fddiPORTMy_Type
op_ne
id|TS
)paren
op_logical_and
(paren
id|mib-&gt;fddiPORTMy_Type
op_ne
id|TM
)paren
op_logical_and
(paren
id|mib-&gt;fddiPORTNeighborType
op_eq
id|mib-&gt;fddiPORTMy_Type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;twisted
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : E102 !!! TWISTED !!!&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|4
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|4
)braket
)paren
(brace
r_if
c_cond
(paren
(paren
id|phy-&gt;t_val
(braket
l_int|4
)braket
op_logical_and
id|phy-&gt;t_val
(braket
l_int|5
)braket
)paren
op_logical_or
(paren
id|phy-&gt;r_val
(braket
l_int|4
)braket
op_logical_and
id|phy-&gt;r_val
(braket
l_int|5
)braket
)paren
)paren
id|phy-&gt;lc_test
op_assign
id|LC_EXTENDED
suffix:semicolon
r_else
id|phy-&gt;lc_test
op_assign
id|LC_LONG
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|5
)braket
)paren
id|phy-&gt;lc_test
op_assign
id|LC_MEDIUM
suffix:semicolon
r_else
id|phy-&gt;lc_test
op_assign
id|LC_SHORT
suffix:semicolon
r_switch
c_cond
(paren
id|phy-&gt;lc_test
)paren
(brace
r_case
id|LC_SHORT
suffix:colon
multiline_comment|/* 50ms */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
(paren
r_int
)paren
id|phy-&gt;np
comma
id|PL_LC_LENGTH
)paren
comma
id|TP_LC_LENGTH
)paren
suffix:semicolon
id|phy-&gt;t_next
(braket
l_int|7
)braket
op_assign
id|smc-&gt;s.pcm_lc_short
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_MEDIUM
suffix:colon
multiline_comment|/* 500ms */
id|outpw
c_func
(paren
id|PLC
c_func
(paren
(paren
r_int
)paren
id|phy-&gt;np
comma
id|PL_LC_LENGTH
)paren
comma
id|TP_LC_LONGLN
)paren
suffix:semicolon
id|phy-&gt;t_next
(braket
l_int|7
)braket
op_assign
id|smc-&gt;s.pcm_lc_medium
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_LONG
suffix:colon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
(paren
r_int
)paren
id|phy-&gt;np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
comma
id|PL_LONG
)paren
suffix:semicolon
id|phy-&gt;t_next
(braket
l_int|7
)braket
op_assign
id|smc-&gt;s.pcm_lc_long
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC_EXTENDED
suffix:colon
id|SETMASK
c_func
(paren
id|PLC
c_func
(paren
(paren
r_int
)paren
id|phy-&gt;np
comma
id|PL_CNTRL_B
)paren
comma
id|PL_LONG
comma
id|PL_LONG
)paren
suffix:semicolon
id|phy-&gt;t_next
(braket
l_int|7
)braket
op_assign
id|smc-&gt;s.pcm_lc_extended
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|phy-&gt;t_next
(braket
l_int|7
)braket
OG
id|smc-&gt;s.pcm_lc_medium
)paren
(brace
id|start_pcm_timer0
c_func
(paren
id|smc
comma
id|phy-&gt;t_next
(braket
l_int|7
)braket
comma
id|PC_TIMEOUT_LCT
comma
id|phy
)paren
suffix:semicolon
)brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;LCT timer = %ld us&bslash;n&quot;
comma
id|phy-&gt;t_next
(braket
l_int|7
)braket
comma
l_int|0
)paren
suffix:semicolon
id|phy-&gt;t_next
(braket
l_int|9
)braket
op_assign
id|smc-&gt;s.pcm_t_next_9
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|6
)braket
)paren
(brace
id|phy-&gt;cf_loop
op_assign
id|TRUE
suffix:semicolon
)brace
id|phy-&gt;td_flag
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|7
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|7
)braket
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : E103 LCT fail %s&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
id|phy-&gt;t_val
(braket
l_int|7
)braket
ques
c_cond
l_string|&quot;local&quot;
suffix:colon
l_string|&quot;remote&quot;
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
(paren
r_int
)paren
(paren
id|EVENT_PCM
op_plus
id|phy-&gt;np
)paren
comma
id|PC_START
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|8
)braket
op_logical_or
id|phy-&gt;r_val
(braket
l_int|8
)braket
)paren
(brace
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
l_int|8
)braket
)paren
id|phy-&gt;cf_loop
op_assign
id|TRUE
suffix:semicolon
id|phy-&gt;td_flag
op_assign
id|TRUE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
l_int|9
)braket
)paren
(brace
multiline_comment|/* neighbor intends to have MAC on output */
suffix:semicolon
id|mib-&gt;fddiPORTMacIndicated.R_val
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* neighbor does not intend to have MAC on output */
suffix:semicolon
id|mib-&gt;fddiPORTMacIndicated.R_val
op_assign
id|FALSE
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * PCM pseudo code 5.1 .. 6.1&n; */
DECL|function|pc_tcode_actions
r_static
r_void
id|pc_tcode_actions
c_func
(paren
id|smc
comma
id|bit
comma
id|phy
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_const
r_int
id|bit
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
(brace
r_int
id|np
op_assign
id|phy-&gt;np
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
r_switch
c_cond
(paren
id|bit
)paren
(brace
r_case
l_int|0
suffix:colon
id|phy-&gt;t_val
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no escape used */
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TS
op_logical_or
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TM
)paren
id|phy-&gt;t_val
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|phy-&gt;t_val
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TB
op_logical_or
id|mib-&gt;fddiPORTMy_Type
op_eq
id|TM
)paren
id|phy-&gt;t_val
(braket
l_int|2
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|phy-&gt;t_val
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
(brace
r_int
id|type
comma
id|ne
suffix:semicolon
r_int
id|policy
suffix:semicolon
id|type
op_assign
id|mib-&gt;fddiPORTMy_Type
suffix:semicolon
id|ne
op_assign
id|mib-&gt;fddiPORTNeighborType
suffix:semicolon
id|policy
op_assign
id|smc-&gt;mib.fddiSMTConnectionPolicy
suffix:semicolon
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Accept connection */
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|TA
suffix:colon
r_if
c_cond
(paren
(paren
(paren
id|policy
op_amp
id|POLICY_AA
)paren
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_AB
)paren
op_logical_and
id|ne
op_eq
id|TB
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_AS
)paren
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_AM
)paren
op_logical_and
id|ne
op_eq
id|TM
)paren
)paren
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reject */
r_break
suffix:semicolon
r_case
id|TB
suffix:colon
r_if
c_cond
(paren
(paren
(paren
id|policy
op_amp
id|POLICY_BA
)paren
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_BB
)paren
op_logical_and
id|ne
op_eq
id|TB
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_BS
)paren
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_BM
)paren
op_logical_and
id|ne
op_eq
id|TM
)paren
)paren
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reject */
r_break
suffix:semicolon
r_case
id|TS
suffix:colon
r_if
c_cond
(paren
(paren
(paren
id|policy
op_amp
id|POLICY_SA
)paren
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_SB
)paren
op_logical_and
id|ne
op_eq
id|TB
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_SS
)paren
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_SM
)paren
op_logical_and
id|ne
op_eq
id|TM
)paren
)paren
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reject */
r_break
suffix:semicolon
r_case
id|TM
suffix:colon
r_if
c_cond
(paren
id|ne
op_eq
id|TM
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_MA
)paren
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_MB
)paren
op_logical_and
id|ne
op_eq
id|TB
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_MS
)paren
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
(paren
id|policy
op_amp
id|POLICY_MM
)paren
op_logical_and
id|ne
op_eq
id|TM
)paren
)paren
id|phy-&gt;t_val
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reject */
r_break
suffix:semicolon
)brace
macro_line|#ifndef&t;SLIM_SMT
multiline_comment|/*&n;&t;&t; * detect undesirable connection attempt event&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|type
op_eq
id|TA
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
id|type
op_eq
id|TA
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
id|type
op_eq
id|TB
op_logical_and
id|ne
op_eq
id|TB
)paren
op_logical_or
(paren
id|type
op_eq
id|TB
op_logical_and
id|ne
op_eq
id|TS
)paren
op_logical_or
(paren
id|type
op_eq
id|TS
op_logical_and
id|ne
op_eq
id|TA
)paren
op_logical_or
(paren
id|type
op_eq
id|TS
op_logical_and
id|ne
op_eq
id|TB
)paren
)paren
(brace
id|smt_srf_event
c_func
(paren
id|smc
comma
id|SMT_EVENT_PORT_CONNECTION
comma
(paren
r_int
)paren
(paren
id|INDEX_PORT
op_plus
id|phy-&gt;np
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTPC_Withhold
op_eq
id|PC_WH_NONE
)paren
(brace
r_if
c_cond
(paren
id|phy-&gt;pc_lem_fail
)paren
(brace
id|phy-&gt;t_val
(braket
l_int|4
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* long */
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|phy-&gt;t_val
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mib-&gt;fddiPORTLCTFail_Ct
OG
l_int|0
)paren
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* medium */
r_else
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* short */
multiline_comment|/*&n;&t;&t;&t;&t; * Implementers choice: use medium&n;&t;&t;&t;&t; * instead of short when undesired&n;&t;&t;&t;&t; * connection attempt is made.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|phy-&gt;wc_flag
)paren
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* medium */
)brace
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_CONNECTING
suffix:semicolon
)brace
r_else
(brace
id|mib-&gt;fddiPORTConnectState
op_assign
id|PCM_STANDBY
suffix:semicolon
id|phy-&gt;t_val
(braket
l_int|4
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* extended */
id|phy-&gt;t_val
(braket
l_int|5
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* we do NOT have a MAC for LCT */
id|phy-&gt;t_val
(braket
l_int|6
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|phy-&gt;cf_loop
op_assign
id|FALSE
suffix:semicolon
id|lem_check_lct
c_func
(paren
id|smc
comma
id|phy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;pc_lem_fail
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : E104 LCT failed&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_int|0
)paren
suffix:semicolon
id|phy-&gt;t_val
(braket
l_int|7
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|phy-&gt;t_val
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|phy-&gt;t_val
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Don&squot;t request MAC loopback */
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|phy-&gt;cf_loop
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mib-&gt;fddiPORTPC_Withhold
op_ne
id|PC_WH_NONE
)paren
op_logical_or
(paren
(paren
id|smc-&gt;s.sas
op_eq
id|SMT_DAS
)paren
op_logical_and
(paren
id|phy-&gt;wc_flag
)paren
)paren
)paren
(brace
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|np
comma
id|PC_START
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|phy-&gt;t_val
(braket
l_int|9
)braket
op_assign
id|FALSE
suffix:semicolon
r_switch
c_cond
(paren
id|smc-&gt;s.sas
)paren
(brace
r_case
id|SMT_DAS
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * MAC intended on output&n;&t;&t;&t; */
r_if
c_cond
(paren
id|phy-&gt;pc_mode
op_eq
id|PM_TREE
)paren
(brace
r_if
c_cond
(paren
(paren
id|np
op_eq
id|PB
)paren
op_logical_or
(paren
(paren
id|np
op_eq
id|PA
)paren
op_logical_and
(paren
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|mib-&gt;fddiPORTConnectState
op_ne
id|PCM_ACTIVE
)paren
)paren
)paren
id|phy-&gt;t_val
(braket
l_int|9
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|np
op_eq
id|PB
)paren
id|phy-&gt;t_val
(braket
l_int|9
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SMT_SAS
suffix:colon
r_if
c_cond
(paren
id|np
op_eq
id|PS
)paren
id|phy-&gt;t_val
(braket
l_int|9
)braket
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef&t;CONCENTRATOR
r_case
id|SMT_NAC
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * MAC intended on output&n;&t;&t;&t; */
r_if
c_cond
(paren
id|np
op_eq
id|PB
)paren
id|phy-&gt;t_val
(braket
l_int|9
)braket
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|mib-&gt;fddiPORTMacIndicated.T_val
op_assign
id|phy-&gt;t_val
(braket
l_int|9
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;SIG snd %x %x: &bslash;n&quot;
comma
id|bit
comma
id|phy-&gt;t_val
(braket
id|bit
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * return status twisted (called by SMT)&n; */
DECL|function|pcm_status_twisted
r_int
id|pcm_status_twisted
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|twist
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;s.sas
op_ne
id|SMT_DAS
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|PA
)braket
dot
id|twisted
op_logical_and
(paren
id|smc-&gt;y
(braket
id|PA
)braket
dot
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
)paren
id|twist
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|twisted
op_logical_and
(paren
id|smc-&gt;y
(braket
id|PB
)braket
dot
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
)paren
id|twist
op_or_assign
l_int|2
suffix:semicolon
r_return
(paren
id|twist
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * return status&t;(called by SMT)&n; *&t;type&n; *&t;state&n; *&t;remote phy type&n; *&t;remote mac yes/no&n; */
DECL|function|pcm_status_state
r_void
id|pcm_status_state
c_func
(paren
id|smc
comma
id|np
comma
id|type
comma
id|state
comma
id|remote
comma
id|mac
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
r_int
op_star
id|type
suffix:semicolon
r_int
op_star
id|state
suffix:semicolon
r_int
op_star
id|remote
suffix:semicolon
r_int
op_star
id|mac
suffix:semicolon
(brace
r_struct
id|s_phy
op_star
id|phy
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
multiline_comment|/* remote PHY type and MAC - set only if active */
op_star
id|mac
op_assign
l_int|0
suffix:semicolon
op_star
id|type
op_assign
id|mib-&gt;fddiPORTMy_Type
suffix:semicolon
multiline_comment|/* our PHY type */
op_star
id|state
op_assign
id|mib-&gt;fddiPORTConnectState
suffix:semicolon
op_star
id|remote
op_assign
id|mib-&gt;fddiPORTNeighborType
suffix:semicolon
r_switch
c_cond
(paren
id|mib-&gt;fddiPORTPCMState
)paren
(brace
r_case
id|PC8_ACTIVE
suffix:colon
op_star
id|mac
op_assign
id|mib-&gt;fddiPORTMacIndicated.R_val
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * return rooted station status (called by SMT)&n; */
DECL|function|pcm_rooted_station
r_int
id|pcm_rooted_station
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|NUMPHYS
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|smc-&gt;y
(braket
id|n
)braket
dot
id|mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
op_logical_and
id|smc-&gt;y
(braket
id|n
)braket
dot
id|mib-&gt;fddiPORTNeighborType
op_eq
id|TM
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Interrupt actions for PLC &amp; PCM events&n; */
DECL|function|plc_irq
r_void
id|plc_irq
c_func
(paren
id|smc
comma
id|np
comma
id|cmd
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
multiline_comment|/* PHY index */
r_int
r_int
id|cmd
suffix:semicolon
(brace
r_struct
id|s_phy
op_star
id|phy
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
suffix:semicolon
r_struct
id|s_plc
op_star
id|plc
op_assign
op_amp
id|phy-&gt;plc
suffix:semicolon
r_int
id|n
suffix:semicolon
macro_line|#ifdef&t;SUPERNET_3
r_int
id|corr_mask
suffix:semicolon
macro_line|#endif&t;/* SUPERNET_3 */
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|np
op_ge
id|smc-&gt;s.numphys
)paren
(brace
id|plc-&gt;soft_err
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_EBUF_ERR
)paren
(brace
multiline_comment|/* elastic buff. det. over-|underflow*/
multiline_comment|/*&n;&t;&t; * Check whether the SRF Condition occured.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|plc-&gt;ebuf_cont
op_logical_and
id|phy-&gt;mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * This is the real Elasticity Error.&n;&t;&t;&t; * More than one in a row are treated as a&n;&t;&t;&t; * single one.&n;&t;&t;&t; * Only count this in the active state.&n;&t;&t;&t; */
id|phy-&gt;mib-&gt;fddiPORTEBError_Ct
op_increment
suffix:semicolon
)brace
id|plc-&gt;ebuf_err
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|plc-&gt;ebuf_cont
op_le
l_int|1000
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Prevent counter from being wrapped after&n;&t;&t;&t; * hanging years in that interrupt.&n;&t;&t;&t; */
id|plc-&gt;ebuf_cont
op_increment
suffix:semicolon
multiline_comment|/* Ebuf continous error */
)brace
macro_line|#ifdef&t;SUPERNET_3
r_if
c_cond
(paren
id|plc-&gt;ebuf_cont
op_eq
l_int|1000
op_logical_and
(paren
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PLC_REV_MASK
)paren
op_eq
id|PLC_REV_SN3
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * This interrupt remeained high for at least&n;&t;&t;&t; * 1000 consecutive interrupt calls.&n;&t;&t;&t; *&n;&t;&t;&t; * This is caused by a hardware error of the&n;&t;&t;&t; * ORION part of the Supernet III chipset.&n;&t;&t;&t; *&n;&t;&t;&t; * Disable this bit from the mask.&n;&t;&t;&t; */
id|corr_mask
op_assign
(paren
id|plc_imsk_na
op_amp
op_complement
id|PL_EBUF_ERR
)paren
suffix:semicolon
id|outpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_INTR_MASK
)paren
comma
id|corr_mask
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Disconnect from the ring.&n;&t;&t;&t; * Call the driver with the reset indication.&n;&t;&t;&t; */
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_DISCONNECT
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Make an error log entry.&n;&t;&t;&t; */
id|SMT_ERR_LOG
c_func
(paren
id|smc
comma
id|SMT_E0136
comma
id|SMT_E0136_MSG
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Indicate the Reset.&n;&t;&t;&t; */
id|drv_reset_indication
c_func
(paren
id|smc
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* SUPERNET_3 */
)brace
r_else
(brace
multiline_comment|/* Reset the continous error variable */
id|plc-&gt;ebuf_cont
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset Ebuf continous error */
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_PHYINV
)paren
(brace
multiline_comment|/* physical layer invalid signal */
id|plc-&gt;phyinv
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_VSYM_CTR
)paren
(brace
multiline_comment|/* violation symbol counter has incr.*/
id|plc-&gt;vsym_ctr
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_MINI_CTR
)paren
(brace
multiline_comment|/* dep. on PLC_CNTRL_A&squot;s MINI_CTR_INT*/
id|plc-&gt;mini_ctr
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_LE_CTR
)paren
(brace
multiline_comment|/* link error event counter */
r_int
id|j
suffix:semicolon
multiline_comment|/*&n;&t;&t; * note: PL_LINK_ERR_CTR MUST be read to clear it&n;&t;&t; */
id|j
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_LE_THRESHOLD
)paren
)paren
suffix:semicolon
id|i
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_LINK_ERR_CTR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|j
)paren
(brace
multiline_comment|/* wrapped around */
id|i
op_add_assign
l_int|256
suffix:semicolon
)brace
r_if
c_cond
(paren
id|phy-&gt;lem.lem_on
)paren
(brace
multiline_comment|/* Note: Lem errors shall only be counted when&n;&t;&t;&t; * link is ACTIVE or LCT is active.&n;&t;&t;&t; */
id|phy-&gt;lem.lem_errors
op_add_assign
id|i
suffix:semicolon
id|phy-&gt;mib-&gt;fddiPORTLem_Ct
op_add_assign
id|i
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_TPC_EXPIRED
)paren
(brace
multiline_comment|/* TPC timer reached zero */
r_if
c_cond
(paren
id|plc-&gt;p_state
op_eq
id|PS_LCT
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * end of LCT&n;&t;&t;&t; */
suffix:semicolon
)brace
id|plc-&gt;tpc_exp
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_LS_MATCH
)paren
(brace
multiline_comment|/* LS == LS in PLC_CNTRL_B&squot;s MATCH_LS*/
r_switch
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_CNTRL_B
)paren
)paren
op_amp
id|PL_MATCH_LS
)paren
(brace
r_case
id|PL_I_IDLE
suffix:colon
id|phy-&gt;curr_ls
op_assign
id|PC_ILS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_I_HALT
suffix:colon
id|phy-&gt;curr_ls
op_assign
id|PC_HLS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_I_MASTR
suffix:colon
id|phy-&gt;curr_ls
op_assign
id|PC_MLS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_I_QUIET
suffix:colon
id|phy-&gt;curr_ls
op_assign
id|PC_QLS
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_PCM_BREAK
)paren
(brace
multiline_comment|/* PCM has entered the BREAK state */
r_int
id|reason
suffix:semicolon
id|reason
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_BREAK_REASON
suffix:semicolon
r_switch
c_cond
(paren
id|reason
)paren
(brace
r_case
id|PL_B_PCS
suffix:colon
id|plc-&gt;b_pcs
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_B_TPC
suffix:colon
id|plc-&gt;b_tpc
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_B_TNE
suffix:colon
id|plc-&gt;b_tne
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_B_QLS
suffix:colon
id|plc-&gt;b_qls
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_B_ILS
suffix:colon
id|plc-&gt;b_ils
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_B_HLS
suffix:colon
id|plc-&gt;b_hls
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*jd 05-Aug-1999 changed: Bug #10419 */
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PLC %d: MDcF = %x&bslash;n&quot;
comma
id|np
comma
id|smc-&gt;e.DisconnectFlag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;e.DisconnectFlag
op_eq
id|FALSE
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PLC %d: restart (reason %x)&bslash;n&quot;
comma
id|np
comma
id|reason
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|np
comma
id|PC_START
)paren
suffix:semicolon
)brace
r_else
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PLC %d: NO!! restart (reason %x)&bslash;n&quot;
comma
id|np
comma
id|reason
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If both CODE &amp; ENABLE are set ignore enable&n;&t; */
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_PCM_CODE
)paren
(brace
multiline_comment|/* receive last sign.-bit | LCT complete */
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|np
comma
id|PC_SIGNAL
)paren
suffix:semicolon
id|n
op_assign
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_RCV_VECTOR
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|plc-&gt;p_bits
suffix:semicolon
id|i
op_increment
)paren
(brace
id|phy-&gt;r_val
(braket
id|plc-&gt;p_start
op_plus
id|i
)braket
op_assign
id|n
op_amp
l_int|1
suffix:semicolon
id|n
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_PCM_ENABLED
)paren
(brace
multiline_comment|/* asserted SC_JOIN, scrub.completed*/
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|np
comma
id|PC_JOIN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_TRACE_PROP
)paren
(brace
multiline_comment|/* MLS while PC8_ACTIV || PC2_TRACE */
multiline_comment|/*PC22b*/
r_if
c_cond
(paren
op_logical_neg
id|phy-&gt;tr_flag
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM : irq TRACE_PROP %d %d&bslash;n&quot;
comma
id|np
comma
id|smc-&gt;mib.fddiSMTECMState
)paren
suffix:semicolon
id|phy-&gt;tr_flag
op_assign
id|TRUE
suffix:semicolon
id|smc-&gt;e.trace_prop
op_or_assign
id|ENTITY_BIT
c_func
(paren
id|ENTITY_PHY
c_func
(paren
id|np
)paren
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_TRACE_PROP
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * filter PLC glitch ???&n;&t; * QLS || HLS only while in PC2_TRACE state&n;&t; */
r_if
c_cond
(paren
(paren
id|cmd
op_amp
id|PL_SELF_TEST
)paren
op_logical_and
(paren
id|phy-&gt;mib-&gt;fddiPORTPCMState
op_eq
id|PC2_TRACE
)paren
)paren
(brace
multiline_comment|/*PC22a*/
r_if
c_cond
(paren
id|smc-&gt;e.path_test
op_eq
id|PT_PASSED
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM : state = %s %d&bslash;n&quot;
comma
id|get_pcmstate
c_func
(paren
id|smc
comma
id|np
)paren
comma
id|phy-&gt;mib-&gt;fddiPORTPCMState
)paren
suffix:semicolon
id|smc-&gt;e.path_test
op_assign
id|PT_PENDING
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_ECM
comma
id|EC_PATH_TEST
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_TNE_EXPIRED
)paren
(brace
multiline_comment|/* TNE: length of noise events */
multiline_comment|/* break_required (TNE &gt; NS_Max) */
r_if
c_cond
(paren
id|phy-&gt;mib-&gt;fddiPORTPCMState
op_eq
id|PC8_ACTIVE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|phy-&gt;tr_flag
)paren
(brace
id|DB_PCMN
c_func
(paren
l_int|1
comma
l_string|&quot;PCM %c : PC81 %s&bslash;n&quot;
comma
id|phy-&gt;phy_name
comma
l_string|&quot;NSE&quot;
)paren
suffix:semicolon
id|queue_event
c_func
(paren
id|smc
comma
id|EVENT_PCM
op_plus
id|np
comma
id|PC_START
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
macro_line|#if&t;0
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_NP_ERR
)paren
(brace
multiline_comment|/* NP has requested to r/w an inv reg*/
multiline_comment|/*&n;&t;&t; * It&squot;s a bug by AMD&n;&t;&t; */
id|plc-&gt;np_err
op_increment
suffix:semicolon
)brace
multiline_comment|/* pin inactiv (GND) */
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_PARITY_ERR
)paren
(brace
multiline_comment|/* p. error dedected on TX9-0 inp */
id|plc-&gt;parity_err
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_amp
id|PL_LSDO
)paren
(brace
multiline_comment|/* carrier detected */
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|pcm_set_lct_short
r_void
id|pcm_set_lct_short
c_func
(paren
id|smc
comma
id|n
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|n
suffix:semicolon
(brace
r_if
c_cond
(paren
id|n
op_le
l_int|0
op_logical_or
id|n
OG
l_int|1000
)paren
r_return
suffix:semicolon
id|smc-&gt;s.lct_short
op_assign
id|n
suffix:semicolon
)brace
macro_line|#ifdef&t;DEBUG
multiline_comment|/*&n; * fill state struct&n; */
DECL|function|pcm_get_state
r_void
id|pcm_get_state
c_func
(paren
id|smc
comma
id|state
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_struct
id|smt_state
op_star
id|state
suffix:semicolon
(brace
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_struct
id|pcm_state
op_star
id|pcs
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ii
suffix:semicolon
r_int
id|rbits
suffix:semicolon
r_int
id|tbits
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|phy
op_assign
id|smc-&gt;y
comma
id|pcs
op_assign
id|state-&gt;pcm_state
suffix:semicolon
id|i
OL
id|NUMPHYS
suffix:semicolon
id|i
op_increment
comma
id|phy
op_increment
comma
id|pcs
op_increment
)paren
(brace
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|pcs-&gt;pcm_type
op_assign
(paren
id|u_char
)paren
id|mib-&gt;fddiPORTMy_Type
suffix:semicolon
id|pcs-&gt;pcm_state
op_assign
(paren
id|u_char
)paren
id|mib-&gt;fddiPORTPCMState
suffix:semicolon
id|pcs-&gt;pcm_mode
op_assign
id|phy-&gt;pc_mode
suffix:semicolon
id|pcs-&gt;pcm_neighbor
op_assign
(paren
id|u_char
)paren
id|mib-&gt;fddiPORTNeighborType
suffix:semicolon
id|pcs-&gt;pcm_bsf
op_assign
id|mib-&gt;fddiPORTBS_Flag
suffix:semicolon
id|pcs-&gt;pcm_lsf
op_assign
id|phy-&gt;ls_flag
suffix:semicolon
id|pcs-&gt;pcm_lct_fail
op_assign
(paren
id|u_char
)paren
id|mib-&gt;fddiPORTLCTFail_Ct
suffix:semicolon
id|pcs-&gt;pcm_ls_rx
op_assign
id|LS2MIB
c_func
(paren
id|sm_pm_get_ls
c_func
(paren
id|smc
comma
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ii
op_assign
l_int|0
comma
id|rbits
op_assign
id|tbits
op_assign
l_int|0
suffix:semicolon
id|ii
OL
id|NUMBITS
suffix:semicolon
id|ii
op_increment
)paren
(brace
id|rbits
op_lshift_assign
l_int|1
suffix:semicolon
id|tbits
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;r_val
(braket
id|NUMBITS
op_minus
l_int|1
op_minus
id|ii
)braket
)paren
id|rbits
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;t_val
(braket
id|NUMBITS
op_minus
l_int|1
op_minus
id|ii
)braket
)paren
id|tbits
op_or_assign
l_int|1
suffix:semicolon
)brace
id|pcs-&gt;pcm_r_val
op_assign
id|rbits
suffix:semicolon
id|pcs-&gt;pcm_t_val
op_assign
id|tbits
suffix:semicolon
)brace
)brace
DECL|function|get_pcm_state
r_int
id|get_pcm_state
c_func
(paren
id|smc
comma
id|np
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
(brace
r_int
id|pcs
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_STATE
)paren
(brace
r_case
id|PL_PC0
suffix:colon
id|pcs
op_assign
id|PC_STOP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC1
suffix:colon
id|pcs
op_assign
id|PC_START
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC2
suffix:colon
id|pcs
op_assign
id|PC_TRACE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC3
suffix:colon
id|pcs
op_assign
id|PC_SIGNAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC4
suffix:colon
id|pcs
op_assign
id|PC_SIGNAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC5
suffix:colon
id|pcs
op_assign
id|PC_SIGNAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC6
suffix:colon
id|pcs
op_assign
id|PC_JOIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC7
suffix:colon
id|pcs
op_assign
id|PC_JOIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC8
suffix:colon
id|pcs
op_assign
id|PC_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC9
suffix:colon
id|pcs
op_assign
id|PC_MAINT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|pcs
op_assign
id|PC_DISABLE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
id|pcs
)paren
suffix:semicolon
)brace
DECL|function|get_linestate
r_char
op_star
id|get_linestate
c_func
(paren
id|smc
comma
id|np
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
(brace
r_char
op_star
id|ls
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_A
)paren
)paren
op_amp
id|PL_LINE_ST
)paren
(brace
r_case
id|PL_L_NLS
suffix:colon
id|ls
op_assign
l_string|&quot;NOISE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_ALS
suffix:colon
id|ls
op_assign
l_string|&quot;ACTIV&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_UND
suffix:colon
id|ls
op_assign
l_string|&quot;UNDEF&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_ILS4
suffix:colon
id|ls
op_assign
l_string|&quot;ILS 4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_QLS
suffix:colon
id|ls
op_assign
l_string|&quot;QLS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_MLS
suffix:colon
id|ls
op_assign
l_string|&quot;MLS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_HLS
suffix:colon
id|ls
op_assign
l_string|&quot;HLS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_L_ILS16
suffix:colon
id|ls
op_assign
l_string|&quot;ILS16&quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef&t;lint
r_default
suffix:colon
id|ls
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
(paren
id|ls
)paren
suffix:semicolon
)brace
DECL|function|get_pcmstate
r_char
op_star
id|get_pcmstate
c_func
(paren
id|smc
comma
id|np
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|np
suffix:semicolon
(brace
r_char
op_star
id|pcs
suffix:semicolon
id|SK_UNUSED
c_func
(paren
id|smc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inpw
c_func
(paren
id|PLC
c_func
(paren
id|np
comma
id|PL_STATUS_B
)paren
)paren
op_amp
id|PL_PCM_STATE
)paren
(brace
r_case
id|PL_PC0
suffix:colon
id|pcs
op_assign
l_string|&quot;OFF&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC1
suffix:colon
id|pcs
op_assign
l_string|&quot;BREAK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC2
suffix:colon
id|pcs
op_assign
l_string|&quot;TRACE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC3
suffix:colon
id|pcs
op_assign
l_string|&quot;CONNECT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC4
suffix:colon
id|pcs
op_assign
l_string|&quot;NEXT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC5
suffix:colon
id|pcs
op_assign
l_string|&quot;SIGNAL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC6
suffix:colon
id|pcs
op_assign
l_string|&quot;JOIN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC7
suffix:colon
id|pcs
op_assign
l_string|&quot;VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC8
suffix:colon
id|pcs
op_assign
l_string|&quot;ACTIV&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PL_PC9
suffix:colon
id|pcs
op_assign
l_string|&quot;MAINT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|pcs
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
id|pcs
)paren
suffix:semicolon
)brace
DECL|function|list_phy
r_void
id|list_phy
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|s_plc
op_star
id|plc
suffix:semicolon
r_int
id|np
suffix:semicolon
r_for
c_loop
(paren
id|np
op_assign
l_int|0
suffix:semicolon
id|np
OL
id|NUMPHYS
suffix:semicolon
id|np
op_increment
)paren
(brace
id|plc
op_assign
op_amp
id|smc-&gt;y
(braket
id|np
)braket
dot
id|plc
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;PHY %d:&bslash;tERRORS&bslash;t&bslash;t&bslash;tBREAK_REASONS&bslash;t&bslash;tSTATES:&bslash;n&quot;
comma
id|np
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tsoft_error: %ld &bslash;t&bslash;tPC_Start : %ld&bslash;n&quot;
comma
id|plc-&gt;soft_err
comma
id|plc-&gt;b_pcs
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tparity_err: %ld &bslash;t&bslash;tTPC exp. : %ld&bslash;t&bslash;tLine: %s&bslash;n&quot;
comma
id|plc-&gt;parity_err
comma
id|plc-&gt;b_tpc
comma
id|get_linestate
c_func
(paren
id|smc
comma
id|np
)paren
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tebuf_error: %ld &bslash;t&bslash;tTNE exp. : %ld&bslash;n&quot;
comma
id|plc-&gt;ebuf_err
comma
id|plc-&gt;b_tne
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tphyinvalid: %ld &bslash;t&bslash;tQLS det. : %ld&bslash;t&bslash;tPCM : %s&bslash;n&quot;
comma
id|plc-&gt;phyinv
comma
id|plc-&gt;b_qls
comma
id|get_pcmstate
c_func
(paren
id|smc
comma
id|np
)paren
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tviosym_ctr: %ld &bslash;t&bslash;tILS det. : %ld&bslash;n&quot;
comma
id|plc-&gt;vsym_ctr
comma
id|plc-&gt;b_ils
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tmingap_ctr: %ld &bslash;t&bslash;tHLS det. : %ld&bslash;n&quot;
comma
id|plc-&gt;mini_ctr
comma
id|plc-&gt;b_hls
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tnodepr_err: %ld&bslash;n&quot;
comma
id|plc-&gt;np_err
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tTPC_exp : %ld&bslash;n&quot;
comma
id|plc-&gt;tpc_exp
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;tLEM_err : %ld&bslash;n&quot;
comma
id|smc-&gt;y
(braket
id|np
)braket
dot
id|lem.lem_errors
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef&t;CONCENTRATOR
DECL|function|pcm_lem_dump
r_void
id|pcm_lem_dump
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_struct
id|s_phy
op_star
id|phy
suffix:semicolon
r_struct
id|fddi_mib_p
op_star
id|mib
suffix:semicolon
r_char
op_star
id|entostring
c_func
(paren
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;PHY&t;errors&t;BER&bslash;n&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;----------------------&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|phy
op_assign
id|smc-&gt;y
suffix:semicolon
id|i
OL
id|NUMPHYS
suffix:semicolon
id|i
op_increment
comma
id|phy
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|plc_is_installed
c_func
(paren
id|smc
comma
id|i
)paren
)paren
r_continue
suffix:semicolon
id|mib
op_assign
id|phy-&gt;mib
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%s&bslash;t%ld&bslash;t10E-%d&bslash;n&quot;
comma
id|entostring
c_func
(paren
id|smc
comma
id|ENTITY_PHY
c_func
(paren
id|i
)paren
)paren
comma
id|mib-&gt;fddiPORTLem_Ct
comma
id|mib-&gt;fddiPORTLer_Estimate
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#endif
eof
