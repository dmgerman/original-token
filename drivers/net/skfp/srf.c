multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998,1999 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;See the file &quot;skfddi.c&quot; for further information.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/*&n;&t;SMT 7.2 Status Response Frame Implementation&n;&t;SRF state machine and frame generation&n;*/
macro_line|#include &quot;h/types.h&quot;
macro_line|#include &quot;h/fddi.h&quot;
macro_line|#include &quot;h/smc.h&quot;
macro_line|#include &quot;h/smt_p.h&quot;
DECL|macro|KERNEL
mdefine_line|#define KERNEL
macro_line|#include &quot;h/smtstate.h&quot;
macro_line|#ifndef&t;SLIM_SMT
macro_line|#ifndef&t;BOOT
macro_line|#ifndef&t;lint
DECL|variable|ID_sccs
r_static
r_const
r_char
id|ID_sccs
(braket
)braket
op_assign
l_string|&quot;@(#)srf.c&t;1.18 97/08/04 (C) SK &quot;
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * function declarations&n; */
r_static
r_void
id|clear_all_rep
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|clear_reported
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|smt_send_srf
c_func
(paren
)paren
suffix:semicolon
r_static
r_struct
id|s_srf_evc
op_star
id|smt_get_evc
c_func
(paren
)paren
suffix:semicolon
DECL|macro|MAX_EVCS
mdefine_line|#define MAX_EVCS&t;(sizeof(smc-&gt;evcs)/sizeof(smc-&gt;evcs[0]))
DECL|struct|evc_init
r_struct
id|evc_init
(brace
DECL|member|code
id|u_char
id|code
suffix:semicolon
DECL|member|index
id|u_char
id|index
suffix:semicolon
DECL|member|n
id|u_char
id|n
suffix:semicolon
DECL|member|para
id|u_short
id|para
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|evc_inits
r_static
r_const
r_struct
id|evc_init
id|evc_inits
(braket
)braket
op_assign
(brace
(brace
id|SMT_COND_SMT_PEER_WRAP
comma
l_int|0
comma
l_int|1
comma
id|SMT_P1048
)brace
comma
(brace
id|SMT_COND_MAC_DUP_ADDR
comma
id|INDEX_MAC
comma
id|NUMMACS
comma
id|SMT_P208C
)brace
comma
(brace
id|SMT_COND_MAC_FRAME_ERROR
comma
id|INDEX_MAC
comma
id|NUMMACS
comma
id|SMT_P208D
)brace
comma
(brace
id|SMT_COND_MAC_NOT_COPIED
comma
id|INDEX_MAC
comma
id|NUMMACS
comma
id|SMT_P208E
)brace
comma
(brace
id|SMT_EVENT_MAC_NEIGHBOR_CHANGE
comma
id|INDEX_MAC
comma
id|NUMMACS
comma
id|SMT_P208F
)brace
comma
(brace
id|SMT_EVENT_MAC_PATH_CHANGE
comma
id|INDEX_MAC
comma
id|NUMMACS
comma
id|SMT_P2090
)brace
comma
(brace
id|SMT_COND_PORT_LER
comma
id|INDEX_PORT
comma
id|NUMPHYS
comma
id|SMT_P4050
)brace
comma
(brace
id|SMT_COND_PORT_EB_ERROR
comma
id|INDEX_PORT
comma
id|NUMPHYS
comma
id|SMT_P4052
)brace
comma
(brace
id|SMT_EVENT_PORT_CONNECTION
comma
id|INDEX_PORT
comma
id|NUMPHYS
comma
id|SMT_P4051
)brace
comma
(brace
id|SMT_EVENT_PORT_PATH_CHANGE
comma
id|INDEX_PORT
comma
id|NUMPHYS
comma
id|SMT_P4053
)brace
comma
)brace
suffix:semicolon
DECL|macro|MAX_INIT_EVC
mdefine_line|#define MAX_INIT_EVC&t;(sizeof(evc_inits)/sizeof(evc_inits[0]))
DECL|function|smt_init_evc
r_void
id|smt_init_evc
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
r_const
r_struct
id|evc_init
op_star
id|init
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_static
id|u_char
id|fail_safe
op_assign
id|FALSE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|smc-&gt;evcs
comma
l_int|0
comma
r_sizeof
(paren
id|smc-&gt;evcs
)paren
)paren
suffix:semicolon
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
id|init
op_assign
id|evc_inits
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_INIT_EVC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|init-&gt;n
suffix:semicolon
id|index
op_increment
)paren
(brace
id|evc-&gt;evc_code
op_assign
id|init-&gt;code
suffix:semicolon
id|evc-&gt;evc_para
op_assign
id|init-&gt;para
suffix:semicolon
id|evc-&gt;evc_index
op_assign
id|init-&gt;index
op_plus
id|index
suffix:semicolon
macro_line|#ifndef&t;DEBUG
id|evc-&gt;evc_multiple
op_assign
op_amp
id|fail_safe
suffix:semicolon
id|evc-&gt;evc_cond_state
op_assign
op_amp
id|fail_safe
suffix:semicolon
macro_line|#endif
id|evc
op_increment
suffix:semicolon
)brace
id|init
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|evc
op_minus
id|smc-&gt;evcs
)paren
OG
id|MAX_EVCS
)paren
(brace
id|SMT_PANIC
c_func
(paren
id|smc
comma
id|SMT_E0127
comma
id|SMT_E0127_MSG
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * conditions&n;&t; */
id|smc-&gt;evcs
(braket
l_int|0
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.fddiSMTPeerWrapFlag
suffix:semicolon
id|smc-&gt;evcs
(braket
l_int|1
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACDuplicateAddressCond
suffix:semicolon
id|smc-&gt;evcs
(braket
l_int|2
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACFrameErrorFlag
suffix:semicolon
id|smc-&gt;evcs
(braket
l_int|3
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACNotCopiedFlag
suffix:semicolon
multiline_comment|/*&n;&t; * events&n;&t; */
id|smc-&gt;evcs
(braket
l_int|4
)braket
dot
id|evc_multiple
op_assign
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACMultiple_N
suffix:semicolon
id|smc-&gt;evcs
(braket
l_int|5
)braket
dot
id|evc_multiple
op_assign
op_amp
id|smc-&gt;mib.m
(braket
id|MAC0
)braket
dot
id|fddiMACMultiple_P
suffix:semicolon
id|offset
op_assign
l_int|6
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMPHYS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; * conditions&n;&t;&t; */
id|smc-&gt;evcs
(braket
id|offset
op_plus
l_int|0
op_star
id|NUMPHYS
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.p
(braket
id|i
)braket
dot
id|fddiPORTLerFlag
suffix:semicolon
id|smc-&gt;evcs
(braket
id|offset
op_plus
l_int|1
op_star
id|NUMPHYS
)braket
dot
id|evc_cond_state
op_assign
op_amp
id|smc-&gt;mib.p
(braket
id|i
)braket
dot
id|fddiPORTEB_Condition
suffix:semicolon
multiline_comment|/*&n;&t;&t; * events&n;&t;&t; */
id|smc-&gt;evcs
(braket
id|offset
op_plus
l_int|2
op_star
id|NUMPHYS
)braket
dot
id|evc_multiple
op_assign
op_amp
id|smc-&gt;mib.p
(braket
id|i
)braket
dot
id|fddiPORTMultiple_U
suffix:semicolon
id|smc-&gt;evcs
(braket
id|offset
op_plus
l_int|3
op_star
id|NUMPHYS
)braket
dot
id|evc_multiple
op_assign
op_amp
id|smc-&gt;mib.p
(braket
id|i
)braket
dot
id|fddiPORTMultiple_P
suffix:semicolon
id|offset
op_increment
suffix:semicolon
)brace
macro_line|#ifdef&t;DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_EVCS
suffix:semicolon
id|i
op_increment
comma
id|evc
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SMT_IS_CONDITION
c_func
(paren
id|evc-&gt;evc_code
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|evc-&gt;evc_cond_state
)paren
(brace
id|SMT_PANIC
c_func
(paren
id|smc
comma
id|SMT_E0128
comma
id|SMT_E0128_MSG
)paren
suffix:semicolon
)brace
id|evc-&gt;evc_multiple
op_assign
op_amp
id|fail_safe
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|evc-&gt;evc_multiple
)paren
(brace
id|SMT_PANIC
c_func
(paren
id|smc
comma
id|SMT_E0129
comma
id|SMT_E0129_MSG
)paren
suffix:semicolon
)brace
id|evc-&gt;evc_cond_state
op_assign
op_amp
id|fail_safe
suffix:semicolon
)brace
)brace
macro_line|#endif
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smc-&gt;srf.sr_state
op_assign
id|SR0_WAIT
suffix:semicolon
)brace
DECL|function|smt_get_evc
r_static
r_struct
id|s_srf_evc
op_star
id|smt_get_evc
c_func
(paren
id|smc
comma
id|code
comma
id|index
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|code
suffix:semicolon
r_int
id|index
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_EVCS
suffix:semicolon
id|i
op_increment
comma
id|evc
op_increment
)paren
(brace
r_if
c_cond
(paren
id|evc-&gt;evc_code
op_eq
id|code
op_logical_and
id|evc-&gt;evc_index
op_eq
id|index
)paren
r_return
(paren
id|evc
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|macro|THRESHOLD_2
mdefine_line|#define THRESHOLD_2&t;(2*TICKS_PER_SECOND)
DECL|macro|THRESHOLD_32
mdefine_line|#define THRESHOLD_32&t;(32*TICKS_PER_SECOND)
macro_line|#ifdef&t;DEBUG
DECL|variable|srf_names
r_static
r_const
r_char
op_star
r_const
id|srf_names
(braket
)braket
op_assign
(brace
l_string|&quot;None&quot;
comma
l_string|&quot;MACPathChangeEvent&quot;
comma
l_string|&quot;MACNeighborChangeEvent&quot;
comma
l_string|&quot;PORTPathChangeEvent&quot;
comma
l_string|&quot;PORTUndesiredConnectionAttemptEvent&quot;
comma
l_string|&quot;SMTPeerWrapCondition&quot;
comma
l_string|&quot;SMTHoldCondition&quot;
comma
l_string|&quot;MACFrameErrorCondition&quot;
comma
l_string|&quot;MACDuplicateAddressCondition&quot;
comma
l_string|&quot;MACNotCopiedCondition&quot;
comma
l_string|&quot;PORTEBErrorCondition&quot;
comma
l_string|&quot;PORTLerCondition&quot;
)brace
suffix:semicolon
macro_line|#endif
DECL|function|smt_srf_event
r_void
id|smt_srf_event
c_func
(paren
id|smc
comma
id|code
comma
id|index
comma
id|cond
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
r_int
id|code
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|cond
suffix:semicolon
(brace
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
r_int
id|cond_asserted
op_assign
l_int|0
suffix:semicolon
r_int
id|cond_deasserted
op_assign
l_int|0
suffix:semicolon
r_int
id|event_occured
op_assign
l_int|0
suffix:semicolon
r_int
id|tsr
suffix:semicolon
r_int
id|T_Limit
op_assign
l_int|2
op_star
id|TICKS_PER_SECOND
suffix:semicolon
r_if
c_cond
(paren
id|code
op_eq
id|SMT_COND_MAC_DUP_ADDR
op_logical_and
id|cond
)paren
(brace
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_DUPADDR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|code
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SRF: %s index %d&bslash;n&quot;
comma
id|srf_names
(braket
id|code
)braket
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|evc
op_assign
id|smt_get_evc
c_func
(paren
id|smc
comma
id|code
comma
id|index
)paren
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SRF : smt_get_evc() failed&bslash;n&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * ignore condition if no change&n;&t;&t; */
r_if
c_cond
(paren
id|SMT_IS_CONDITION
c_func
(paren
id|code
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|evc-&gt;evc_cond_state
op_eq
id|cond
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * set transition time stamp&n;&t;&t; */
id|smt_set_timestamp
c_func
(paren
id|smc
comma
id|smc-&gt;mib.fddiSMTTransitionTimeStamp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SMT_IS_CONDITION
c_func
(paren
id|code
)paren
)paren
(brace
id|DB_SMT
c_func
(paren
l_string|&quot;SRF: condition is %s&bslash;n&quot;
comma
id|cond
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cond
)paren
(brace
op_star
id|evc-&gt;evc_cond_state
op_assign
id|TRUE
suffix:semicolon
id|evc-&gt;evc_rep_required
op_assign
id|TRUE
suffix:semicolon
id|smc-&gt;srf.any_report
op_assign
id|TRUE
suffix:semicolon
id|cond_asserted
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
op_star
id|evc-&gt;evc_cond_state
op_assign
id|FALSE
suffix:semicolon
id|cond_deasserted
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|evc-&gt;evc_rep_required
)paren
(brace
op_star
id|evc-&gt;evc_multiple
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|evc-&gt;evc_rep_required
op_assign
id|TRUE
suffix:semicolon
op_star
id|evc-&gt;evc_multiple
op_assign
id|FALSE
suffix:semicolon
)brace
id|smc-&gt;srf.any_report
op_assign
id|TRUE
suffix:semicolon
id|event_occured
op_assign
id|TRUE
suffix:semicolon
)brace
macro_line|#ifdef&t;FDDI_MIB
id|snmp_srf_event
c_func
(paren
id|smc
comma
id|evc
)paren
suffix:semicolon
macro_line|#endif&t;/* FDDI_MIB */
)brace
id|tsr
op_assign
id|smt_get_time
c_func
(paren
)paren
op_minus
id|smc-&gt;srf.TSR
suffix:semicolon
r_switch
c_cond
(paren
id|smc-&gt;srf.sr_state
)paren
(brace
r_case
id|SR0_WAIT
suffix:colon
multiline_comment|/* SR01a */
r_if
c_cond
(paren
id|cond_asserted
op_logical_and
id|tsr
OL
id|T_Limit
)paren
(brace
id|smc-&gt;srf.SRThreshold
op_assign
id|THRESHOLD_2
suffix:semicolon
id|smc-&gt;srf.sr_state
op_assign
id|SR1_HOLDOFF
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR01b */
r_if
c_cond
(paren
id|cond_deasserted
op_logical_and
id|tsr
OL
id|T_Limit
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR1_HOLDOFF
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR01c */
r_if
c_cond
(paren
id|event_occured
op_logical_and
id|tsr
OL
id|T_Limit
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR1_HOLDOFF
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR00b */
r_if
c_cond
(paren
id|cond_asserted
op_logical_and
id|tsr
op_ge
id|T_Limit
)paren
(brace
id|smc-&gt;srf.SRThreshold
op_assign
id|THRESHOLD_2
suffix:semicolon
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smt_send_srf
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR00c */
r_if
c_cond
(paren
id|cond_deasserted
op_logical_and
id|tsr
op_ge
id|T_Limit
)paren
(brace
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smt_send_srf
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR00d */
r_if
c_cond
(paren
id|event_occured
op_logical_and
id|tsr
op_ge
id|T_Limit
)paren
(brace
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smt_send_srf
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR00e */
r_if
c_cond
(paren
id|smc-&gt;srf.any_report
op_logical_and
(paren
id|u_long
)paren
id|tsr
op_ge
id|smc-&gt;srf.SRThreshold
)paren
(brace
id|smc-&gt;srf.SRThreshold
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|smc-&gt;srf.SRThreshold
OG
id|THRESHOLD_32
)paren
id|smc-&gt;srf.SRThreshold
op_assign
id|THRESHOLD_32
suffix:semicolon
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smt_send_srf
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR02 */
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;mib.fddiSMTStatRptPolicy
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR2_DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SR1_HOLDOFF
suffix:colon
multiline_comment|/* SR10b */
r_if
c_cond
(paren
id|tsr
op_ge
id|T_Limit
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR0_WAIT
suffix:semicolon
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smt_send_srf
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* SR11a */
r_if
c_cond
(paren
id|cond_asserted
)paren
(brace
id|smc-&gt;srf.SRThreshold
op_assign
id|THRESHOLD_2
suffix:semicolon
)brace
multiline_comment|/* SR11b */
multiline_comment|/* SR11c */
multiline_comment|/* handled above */
multiline_comment|/* SR12 */
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;mib.fddiSMTStatRptPolicy
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR2_DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SR2_DISABLED
suffix:colon
r_if
c_cond
(paren
id|smc-&gt;mib.fddiSMTStatRptPolicy
)paren
(brace
id|smc-&gt;srf.sr_state
op_assign
id|SR0_WAIT
suffix:semicolon
id|smc-&gt;srf.TSR
op_assign
id|smt_get_time
c_func
(paren
)paren
suffix:semicolon
id|smc-&gt;srf.SRThreshold
op_assign
id|THRESHOLD_2
suffix:semicolon
id|clear_all_rep
c_func
(paren
id|smc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|clear_all_rep
r_static
r_void
id|clear_all_rep
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_EVCS
suffix:semicolon
id|i
op_increment
comma
id|evc
op_increment
)paren
(brace
id|evc-&gt;evc_rep_required
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|SMT_IS_CONDITION
c_func
(paren
id|evc-&gt;evc_code
)paren
)paren
op_star
id|evc-&gt;evc_cond_state
op_assign
id|FALSE
suffix:semicolon
)brace
id|smc-&gt;srf.any_report
op_assign
id|FALSE
suffix:semicolon
)brace
DECL|function|clear_reported
r_static
r_void
id|clear_reported
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
r_int
id|i
suffix:semicolon
id|smc-&gt;srf.any_report
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_EVCS
suffix:semicolon
id|i
op_increment
comma
id|evc
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SMT_IS_CONDITION
c_func
(paren
id|evc-&gt;evc_code
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|evc-&gt;evc_cond_state
op_eq
id|FALSE
)paren
id|evc-&gt;evc_rep_required
op_assign
id|FALSE
suffix:semicolon
r_else
id|smc-&gt;srf.any_report
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|evc-&gt;evc_rep_required
op_assign
id|FALSE
suffix:semicolon
op_star
id|evc-&gt;evc_multiple
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
)brace
r_extern
id|SMbuf
op_star
id|smt_build_frame
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n; * build and send SMT SRF frame&n; */
DECL|function|smt_send_srf
r_static
r_void
id|smt_send_srf
c_func
(paren
id|smc
)paren
r_struct
id|s_smc
op_star
id|smc
suffix:semicolon
(brace
r_struct
id|smt_header
op_star
id|smt
suffix:semicolon
r_struct
id|s_srf_evc
op_star
id|evc
suffix:semicolon
id|SK_LOC_DECL
c_func
(paren
r_struct
id|s_pcon
comma
id|pcon
)paren
suffix:semicolon
id|SMbuf
op_star
id|mb
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_const
r_struct
id|fddi_addr
id|SMT_SRF_DA
op_assign
(brace
(brace
l_int|0x80
comma
l_int|0x01
comma
l_int|0x43
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0x08
)brace
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * build SMT header&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|smc-&gt;r.sm_ma_avail
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mb
op_assign
id|smt_build_frame
c_func
(paren
id|smc
comma
id|SMT_SRF
comma
id|SMT_ANNOUNCE
comma
l_int|0
)paren
)paren
)paren
r_return
suffix:semicolon
id|RS_SET
c_func
(paren
id|smc
comma
id|RS_SOFTERROR
)paren
suffix:semicolon
id|smt
op_assign
id|smtod
c_func
(paren
id|mb
comma
r_struct
id|smt_header
op_star
)paren
suffix:semicolon
id|smt-&gt;smt_dest
op_assign
id|SMT_SRF_DA
suffix:semicolon
multiline_comment|/* DA == SRF multicast */
multiline_comment|/*&n;&t; * setup parameter status&n;&t; */
id|pcon.pc_len
op_assign
id|SMT_MAX_INFO_LEN
suffix:semicolon
multiline_comment|/* max para length */
id|pcon.pc_err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no error */
id|pcon.pc_badset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no bad set count */
id|pcon.pc_p
op_assign
(paren
r_void
op_star
)paren
(paren
id|smt
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* paras start here */
id|smt_add_para
c_func
(paren
id|smc
comma
op_amp
id|pcon
comma
(paren
id|u_short
)paren
id|SMT_P1033
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|smt_add_para
c_func
(paren
id|smc
comma
op_amp
id|pcon
comma
(paren
id|u_short
)paren
id|SMT_P1034
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|evc
op_assign
id|smc-&gt;evcs
suffix:semicolon
(paren
r_int
)paren
id|i
OL
id|MAX_EVCS
suffix:semicolon
id|i
op_increment
comma
id|evc
op_increment
)paren
(brace
r_if
c_cond
(paren
id|evc-&gt;evc_rep_required
)paren
(brace
id|smt_add_para
c_func
(paren
id|smc
comma
op_amp
id|pcon
comma
id|evc-&gt;evc_para
comma
(paren
r_int
)paren
id|evc-&gt;evc_index
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|smt-&gt;smt_len
op_assign
id|SMT_MAX_INFO_LEN
op_minus
id|pcon.pc_len
suffix:semicolon
id|mb-&gt;sm_len
op_assign
id|smt-&gt;smt_len
op_plus
r_sizeof
(paren
r_struct
id|smt_header
)paren
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SRF: sending SRF at %x, len %d &bslash;n&quot;
comma
id|smt
comma
id|mb-&gt;sm_len
)paren
suffix:semicolon
id|DB_SMT
c_func
(paren
l_string|&quot;SRF: state SR%d Threshold %d&bslash;n&quot;
comma
id|smc-&gt;srf.sr_state
comma
id|smc-&gt;srf.SRThreshold
op_div
id|TICKS_PER_SECOND
)paren
suffix:semicolon
macro_line|#ifdef&t;DEBUG
id|dump_smt
c_func
(paren
id|smc
comma
id|smt
comma
l_string|&quot;SRF Send&quot;
)paren
suffix:semicolon
macro_line|#endif
id|smt_send_frame
c_func
(paren
id|smc
comma
id|mb
comma
id|FC_SMT_INFO
comma
l_int|0
)paren
suffix:semicolon
id|clear_reported
c_func
(paren
id|smc
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* no BOOT */
macro_line|#endif&t;/* no SLIM_SMT */
eof
