multiline_comment|/* tulip.c: A DEC 21040 ethernet driver for linux. */
multiline_comment|/*&n;   NOTICE: this version works with kernels 1.1.82 and later only!&n;&t;Written 1994,1995 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU Public License, incorporated herein by reference.&n;&n;&t;This driver is for the SMC EtherPower PCI ethernet adapter.&n;&t;It should work with most other DEC 21*40-based ethercards.&n;&n;&t;The author may be reached as becker@CESDIS.gsfc.nasa.gov, or C/O&n;&t;Center of Excellence in Space Data and Information Sciences&n;&t;   Code 930.5, Goddard Space Flight Center, Greenbelt MD 20771&n;&n;&t;Subscribe to linux-tulip@cesdis.gsfc.nasa.gov and linux-tulip-bugs@cesdis.gsfc.nasa.gov&n;&t;for late breaking news and exciting develovements.&n;&t;&n;&t;This has Baldur Norddahl&squot;s one liner fix for the AC/AE boards. If it&n;&t;stops working please change TINTR_ENABLE to 0xFFFFFFFF&n;*/
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;tulip.c:v0.10 8/11/95 becker@cesdis.gsfc.nasa.gov&bslash;n&quot;
l_string|&quot;        +0.72 4/17/96 &quot;
l_string|&quot;http://www.dsl.tutics.tut.ac.jp/~linux/tulip&bslash;n&quot;
l_string|&quot;        +0.02 12/15/96 mjacob@feral.com (2.0.27)&bslash;n&quot;
suffix:semicolon
multiline_comment|/* A few user-configurable values. */
multiline_comment|/* Default to using 10baseT (i.e. AUI/10base2/100baseT port) port. */
DECL|macro|TULIP_10TP_PORT
mdefine_line|#define&t;TULIP_10TP_PORT&t;&t;0
DECL|macro|TULIP_100TP_PORT
mdefine_line|#define&t;TULIP_100TP_PORT&t;1
DECL|macro|TULIP_AUI_PORT
mdefine_line|#define&t;TULIP_AUI_PORT&t;&t;1
DECL|macro|TULIP_BNC_PORT
mdefine_line|#define&t;TULIP_BNC_PORT&t;&t;2
DECL|macro|TULIP_MAX_PORT
mdefine_line|#define&t;TULIP_MAX_PORT&t;&t;3
DECL|macro|TULIP_AUTO_PORT
mdefine_line|#define&t;TULIP_AUTO_PORT&t;&t;-1
macro_line|#ifndef&t;TULIP_PORT
DECL|macro|TULIP_PORT
mdefine_line|#define&t;TULIP_PORT&t;&t;&t;TULIP_10TP_PORT
macro_line|#endif
multiline_comment|/* Define to force full-duplex operation on all Tulip interfaces. */
multiline_comment|/* #define  TULIP_FULL_DUPLEX 1 */
multiline_comment|/* Define to fix port. */
multiline_comment|/* #define  TULIP_FIX_PORT 1 */
multiline_comment|/* Define to probe only first detected device */
multiline_comment|/*#define&t;TULIP_MAX_CARDS 1*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
multiline_comment|/* The total size is unusually large: The 21040 aligns each of its 16&n;   longword-wide registers on a quadword boundary. */
DECL|macro|TULIP_TOTAL_SIZE
mdefine_line|#define TULIP_TOTAL_SIZE 0x80
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This device driver is designed for the DECchip 21040 &quot;Tulip&quot;, Digital&squot;s&n;single-chip ethernet controller for PCI, as used on the SMC EtherPower&n;ethernet adapter.  It also works with boards based the 21041 (new/experimental)&n;and 21140 (10/100mbps).&n;&n;&n;II. Board-specific settings&n;&n;PCI bus devices are configured by the system at boot time, so no jumpers&n;need to be set on the board.  The system BIOS should be set to assign the&n;PCI INTA signal to an otherwise unused system IRQ line.  While it&squot;s&n;physically possible to shared PCI interrupt lines, the kernel doesn&squot;t&n;support it. &n;&n;III. Driver operation&n;&n;IIIa. Ring buffers&n;The Tulip can use either ring buffers or lists of Tx and Rx descriptors.&n;The current driver uses a statically allocated Rx ring of descriptors and&n;buffers, and a list of the Tx buffers.&n;&n;IIIC. Synchronization&n;The driver runs as two independent, single-threaded flows of control.  One&n;is the send-packet routine, which enforces single-threaded use by the&n;dev-&gt;tbusy flag.  The other thread is the interrupt handler, which is single&n;threaded by the hardware and other software.&n;&n;The send packet thread has partial control over the Tx ring and &squot;dev-&gt;tbusy&squot;&n;flag.  It sets the tbusy flag whenever it&squot;s queuing a Tx packet. If the next&n;queue slot is empty, it clears the tbusy flag when finished otherwise it sets&n;the &squot;tp-&gt;tx_full&squot; flag.&n;&n;The interrupt handler has exclusive control over the Rx ring and records stats&n;from the Tx ring.  (The Tx-done interrupt can&squot;t be selectively turned off, so&n;we can&squot;t avoid the interrupt overhead by having the Tx routine reap the Tx&n;stats.)&t; After reaping the stats, it marks the queue entry as empty by setting&n;the &squot;base&squot; to zero.&t; Iff the &squot;tp-&gt;tx_full&squot; flag is set, it clears both the&n;tx_full and tbusy flags.&n;&n;IV. Notes&n;&n;Thanks to Duke Kamstra of SMC for providing an EtherPower board.&n;&n;The DEC databook doesn&squot;t document which Rx filter settings accept broadcast&n;packets.  Nor does it document how to configure the part to configure the&n;serial subsystem for normal (vs. loopback) operation or how to have it&n;autoswitch between internal 10baseT, SIA and AUI transceivers.&n;&n;The databook claims that CSR13, CSR14, and CSR15 should each be the last&n;register of the set CSR12-15 written.   Hmmm, now how is that possible?&n;*/
multiline_comment|/* A few values that may be tweaked. */
multiline_comment|/* Keep the ring sizes a power of two for efficiency. */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;4
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;4
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
multiline_comment|/* This is a mysterious value that can be written to CSR11 in the 21040&n;   to detect a full-duplex frame.  No one knows what it should be, but if&n;   left at its default value some 10base2(!) packets trigger a&n;   full-duplex-request interrupt. */
DECL|macro|FULL_DUPLEX_MAGIC
mdefine_line|#define FULL_DUPLEX_MAGIC&t;0x6969
multiline_comment|/* The rest of these values should never change. */
DECL|macro|PCI_DEVICE_ID_NONE
mdefine_line|#define PCI_DEVICE_ID_NONE&t;0xFFFF
DECL|macro|ETHNAMSIZ
mdefine_line|#define&t;ETHNAMSIZ&t;8
DECL|macro|ROUND_UP
mdefine_line|#define&t;ROUND_UP(size, n)&t;((size + n - 1) &amp; ~(n - 1))
multiline_comment|/* Offsets to the Command and Status Registers, &quot;CSRs&quot;.  All accesses&n;   must be longword instructions and quadword aligned. */
DECL|enum|tulip_offsets
r_enum
id|tulip_offsets
(brace
multiline_comment|/* 21040&t;&t;21041&t;&t;21140&t;&t;*/
DECL|enumerator|CSR0
id|CSR0
op_assign
l_int|0
comma
multiline_comment|/* BUS mode&t;&t;&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR1
id|CSR1
op_assign
l_int|0x08
comma
multiline_comment|/* TX poll demand&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR2
id|CSR2
op_assign
l_int|0x10
comma
multiline_comment|/* RX poll demand&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR3
id|CSR3
op_assign
l_int|0x18
comma
multiline_comment|/* RX ring base addr&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR4
id|CSR4
op_assign
l_int|0x20
comma
multiline_comment|/* TX ring base addr&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR5
id|CSR5
op_assign
l_int|0x28
comma
multiline_comment|/* Status&t;&t;&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR6
id|CSR6
op_assign
l_int|0x30
comma
multiline_comment|/* Command mode&t;&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR7
id|CSR7
op_assign
l_int|0x38
comma
multiline_comment|/* Interrupt Mask&t;&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR8
id|CSR8
op_assign
l_int|0x40
comma
multiline_comment|/* Missed frame counter&t;&t;&t;&t;&t;*/
DECL|enumerator|CSR9
id|CSR9
op_assign
l_int|0x48
comma
multiline_comment|/* Eth.addrROM&t;SROM mii&t;SROM mii&t;*/
DECL|enumerator|CSR10
id|CSR10
op_assign
l_int|0x50
comma
multiline_comment|/* Diagn.&t;&t;boot ROM&t;-&t;&t;&t;*/
DECL|enumerator|CSR11
id|CSR11
op_assign
l_int|0x58
comma
multiline_comment|/* Full duplex&t;G.P. timer&t;G.P. timer&t;*/
DECL|enumerator|CSR12
id|CSR12
op_assign
l_int|0x60
comma
multiline_comment|/* SIA status&t;&t;&t;&t;G.P.&t;&t;*/
DECL|enumerator|CSR13
id|CSR13
op_assign
l_int|0x68
comma
multiline_comment|/* SIA connectivity&t;&t;&t;-&t;&t;&t;*/
DECL|enumerator|CSR14
id|CSR14
op_assign
l_int|0x70
comma
multiline_comment|/* SIA TX/RX&t;&t;&t;&t;-&t;&t;&t;*/
DECL|enumerator|CSR15
id|CSR15
op_assign
l_int|0x78
multiline_comment|/* SIA general&t;&t;&t;&t;watchdog&t;*/
)brace
suffix:semicolon
multiline_comment|/* description of CSR0 bus mode register */
DECL|macro|TBMOD_RESERVED
mdefine_line|#define&t;TBMOD_RESERVED&t;&t;0xfff80000&t;/* I don&squot;t know */
DECL|macro|TBMOD_RESET
mdefine_line|#define&t;TBMOD_RESET&t;&t;&t;0x00000001
DECL|macro|TBMOD_BIGENDIAN
mdefine_line|#define&t;TBMOD_BIGENDIAN&t;&t;0x00000080
multiline_comment|/*&n;&t;   Cache alignment bits 15:14&t;     Burst length 13:8&n;    &t;0000&t;No alignment  0x00000000 unlimited&t;&t;0800 8 longwords&n;&t;&t;4000&t;8  longwords&t;&t;0100 1 longword&t;&t;1000 16 longwords&n;&t;&t;8000&t;16 longwords&t;&t;0200 2 longwords&t;2000 32 longwords&n;&t;&t;C000&t;32  longwords&t;&t;0400 4 longwords&n;*/
DECL|macro|TBMOD_ALIGN0
mdefine_line|#define&t;TBMOD_ALIGN0&t;&t;0x00000000&t;/* no cache alignment */
DECL|macro|TBMOD_ALIGN8
mdefine_line|#define&t;TBMOD_ALIGN8&t;&t;0x00004000&t;/* 8 longwords */
DECL|macro|TBMOD_ALIGN16
mdefine_line|#define&t;TBMOD_ALIGN16&t;&t;0x00008000
DECL|macro|TBMOD_ALIGN32
mdefine_line|#define&t;TBMOD_ALIGN32&t;&t;(TBMOD_ALIGN8|TBMOD_ALIGN16)
DECL|macro|TBMOD_BURST0
mdefine_line|#define&t;TBMOD_BURST0&t;&t;0x00000000&t;/* unlimited=rx buffer size */
DECL|macro|TBMOD_BURST1
mdefine_line|#define&t;TBMOD_BURST1&t;&t;0x00000100&t;/* 1 longwords */
DECL|macro|TBMOD_BURST2
mdefine_line|#define&t;TBMOD_BURST2&t;&t;0x00000200
DECL|macro|TBMOD_BURST4
mdefine_line|#define&t;TBMOD_BURST4&t;&t;0x00000400
DECL|macro|TBMOD_BURST8
mdefine_line|#define&t;TBMOD_BURST8&t;&t;0x00000800
DECL|macro|TBMOD_BURST16
mdefine_line|#define&t;TBMOD_BURST16&t;&t;0x00001000
DECL|macro|TBMOD_BURST32
mdefine_line|#define&t;TBMOD_BURST32&t;&t;0x00002000
multiline_comment|/* description of CSR1 Tx poll demand register */
multiline_comment|/* description of CSR2 Rx poll demand register */
DECL|macro|TPOLL_START
mdefine_line|#define&t;TPOLL_START&t;&t;&t;0x00000001&t;/* ? */
DECL|macro|TPOLL_TRIGGER
mdefine_line|#define&t;TPOLL_TRIGGER&t;&t;0x00000000&t;/* ? */
multiline_comment|/* description of CSR5 status register from de4x5.h */
DECL|macro|TSTAT_BUSERROR
mdefine_line|#define&t;TSTAT_BUSERROR&t;&t;0x03800000
DECL|macro|TSTAT_SYSERROR
mdefine_line|#define&t;TSTAT_SYSERROR&t;&t;0x00002000
DECL|macro|TSTAT_TxSTAT
mdefine_line|#define&t;TSTAT_TxSTAT&t;&t;0x00700000
DECL|macro|TSTAT_RxSTAT
mdefine_line|#define&t;TSTAT_RxSTAT&t;&t;0x000e0000
DECL|macro|TSTAT_LKFAIL
mdefine_line|#define&t;TSTAT_LKFAIL&t;&t;0x00001000
DECL|macro|TSTAT_NORINTR
mdefine_line|#define&t;TSTAT_NORINTR&t;&t;0x00010000&t;/* Normal interrupt */
DECL|macro|TSTAT_ABNINTR
mdefine_line|#define&t;TSTAT_ABNINTR&t;&t;0x00008000&t;/* Abnormal interrupt */
DECL|macro|TSTAT_RxMISSED
mdefine_line|#define&t;TSTAT_RxMISSED&t;&t;0x00000100&t;/* Rx frame missed */
DECL|macro|TSTAT_RxUNABL
mdefine_line|#define&t;TSTAT_RxUNABL&t;&t;0x00000080
DECL|macro|TSTAT_RxINTR
mdefine_line|#define&t;TSTAT_RxINTR&t;&t;0x00000040
DECL|macro|TSTAT_LKPASS
mdefine_line|#define&t;TSTAT_LKPASS&t;&t;0x00000010
DECL|macro|TSTAT_TEXPIRED
mdefine_line|#define&t;TSTAT_TEXPIRED&t;&t;0x00000800&t;/* Timer Expired */
DECL|macro|TSTAT_TxTOUT
mdefine_line|#define&t;TSTAT_TxTOUT&t;&t;0x00000008
DECL|macro|TSTAT_TxUNABL
mdefine_line|#define&t;TSTAT_TxUNABL&t;&t;0x00000004
DECL|macro|TSTAT_TxINTR
mdefine_line|#define&t;TSTAT_TxINTR&t;&t;0x00000001
DECL|macro|TSTAT_CLEARINTR
mdefine_line|#define&t;TSTAT_CLEARINTR&t;&t;0x0001ffff&t;/* clear all interrupt sources */
multiline_comment|/* description of CSR6 command mode register */
DECL|macro|TCMOD_SCRM
mdefine_line|#define&t;TCMOD_SCRM&t;&t;&t;0x01000000&t;/* scrambler mode */
DECL|macro|TCMOD_PCS
mdefine_line|#define&t;TCMOD_PCS&t;&t;&t;0x00800000&t;/* PCS function */
DECL|macro|TCMOD_TxTHMODE
mdefine_line|#define&t;TCMOD_TxTHMODE&t;&t;0x00400000&t;/* Tx threshold mode */
DECL|macro|TCMOD_SW100TP
mdefine_line|#define&t;TCMOD_SW100TP&t;&t;0x00040000  /* 21140: 100MB */
DECL|macro|TCMOD_CAPTURE
mdefine_line|#define&t;TCMOD_CAPTURE&t;&t;0x00020000&t;/* capture effect */
DECL|macro|TCMOD_FULLDUPLEX
mdefine_line|#define&t;TCMOD_FULLDUPLEX&t;0x00000200
DECL|macro|TCMOD_TH128
mdefine_line|#define TCMOD_TH128&t;&t;&t;0x00008000&t;/* 10 - 128 bytes threshold */
DECL|macro|TCMOD_TxSTART
mdefine_line|#define&t;TCMOD_TxSTART&t;&t;0x00002000
DECL|macro|TCMOD_RxSTART
mdefine_line|#define&t;TCMOD_RxSTART&t;&t;0x00000002
DECL|macro|TCMOD_ALLMCAST
mdefine_line|#define&t;TCMOD_ALLMCAST&t;&t;0x00000080&t;/* pass all multicast */
DECL|macro|TCMOD_PROMISC
mdefine_line|#define&t;TCMOD_PROMISC&t;&t;0x00000040&t;/* promisc */
DECL|macro|TCMOD_BOFFCOUNTER
mdefine_line|#define&t;TCMOD_BOFFCOUNTER&t;0x00000020&t;/* backoff counter */
DECL|macro|TCMOD_INVFILTER
mdefine_line|#define&t;TCMOD_INVFILTER&t;&t;0x00000010&t;/* invert filtering */
DECL|macro|TCMOD_HONLYFILTER
mdefine_line|#define&t;TCMOD_HONLYFILTER&t;0x00000004&t;/* hash only filtering */
DECL|macro|TCMOD_HPFILTER
mdefine_line|#define TCMOD_HPFILTER&t;&t;0x00000001&t;/* hash/perfect Rx filtering */
DECL|macro|TCMOD_MODEMASK
mdefine_line|#define&t;TCMOD_MODEMASK&t;&t;(TCMOD_ALLMCAST|TCMOD_PROMISC)
DECL|macro|TCMOD_FILTERMASK
mdefine_line|#define&t;TCMOD_FILTERMASK&t;(TCMOD_HONLYFILTER|TCMOD_HPFILTER|TCMOD_INVFILTER)
DECL|macro|TCMOD_TRxSTART
mdefine_line|#define&t;TCMOD_TRxSTART&t;&t;(TCMOD_TxSTART|TCMOD_RxSTART)
DECL|macro|TCMOD_BASE
mdefine_line|#define&t;TCMOD_BASE&t;&t;&t;(TCMOD_CAPTURE|TCMOD_BOFFCOUNTER)
DECL|macro|TCMOD_10TP
mdefine_line|#define&t;TCMOD_10TP&t;&t;&t;(TCMOD_TxTHMODE|TCMOD_BASE)
DECL|macro|TCMOD_100TP
mdefine_line|#define&t;TCMOD_100TP&t;&t;&t;(TCMOD_SCRM|TCMOD_PCS|TCMOD_SW100TP|TCMOD_BASE)
DECL|macro|TCMOD_AUTO
mdefine_line|#define&t;TCMOD_AUTO&t;&t;&t;(TCMOD_SW100TP|TCMOD_TH128|TCMOD_10TP)
multiline_comment|/* description of CSR7 interrupt mask register */
DECL|macro|TINTR_ENABLE
mdefine_line|#define&t;TINTR_ENABLE&t;&t;0xFFFFBBFF
DECL|macro|TINTR_DISABLE
mdefine_line|#define&t;TINTR_DISABLE&t;&t;0x00000000
multiline_comment|/* description of CSR11 G.P. timer (21041/21140) register */
DECL|macro|TGEPT_COUNT
mdefine_line|#define&t;TGEPT_COUNT&t;&t;&t;0x0001FFFF
multiline_comment|/* description of CSR12 SIA status(2104x)/GP(21140) register */
DECL|macro|TSIAS_CONERROR
mdefine_line|#define&t;TSIAS_CONERROR&t;&t;0x00000002&t;/* connection error */
DECL|macro|TSIAS_LNKERROR
mdefine_line|#define&t;TSIAS_LNKERROR&t;&t;0x00000004&t;/* link error */
DECL|macro|TSIAS_ACTERROR
mdefine_line|#define TSIAS_ACTERROR&t;&t;0x00000200  /* port Rx activity */
DECL|macro|TSIAS_RxACTIVE
mdefine_line|#define TSIAS_RxACTIVE&t;&t;0x00000100  /* port Rx activity */
DECL|macro|TGEPR_LK10NG
mdefine_line|#define&t;TGEPR_LK10NG&t;&t;0x00000080&t;/* 10Mbps N.G. (R) */
DECL|macro|TGEPR_LK100NG
mdefine_line|#define&t;TGEPR_LK100NG&t;&t;0x00000040&t;/* 100Mbps N.G. (R) */
DECL|macro|TGEPR_DETECT
mdefine_line|#define&t;TGEPR_DETECT&t;&t;0x00000020&t;/* detect signal (R) */
DECL|macro|TGEPR_HALFDUPLEX
mdefine_line|#define&t;TGEPR_HALFDUPLEX&t;0x00000008&t;/* half duplex (W) */
DECL|macro|TGEPR_PHYLOOPBACK
mdefine_line|#define&t;TGEPR_PHYLOOPBACK&t;0x00000004&t;/* PHY loopback (W) */
DECL|macro|TGEPR_FORCEALED
mdefine_line|#define&t;TGEPR_FORCEALED&t;&t;0x00000002&t;/* force activity LED on (W) */
DECL|macro|TGEPR_FORCE100
mdefine_line|#define&t;TGEPR_FORCE100&t;&t;0x00000001&t;/* force 100Mbps mode */
multiline_comment|/* description of CSR13 SIA connectivity register */
DECL|macro|TSIAC_OUTEN
mdefine_line|#define&t;TSIAC_OUTEN&t;&t;&t;0x0000e000&t;/* 21041: Output enable */
DECL|macro|TSIAC_SELED
mdefine_line|#define TSIAC_SELED&t;&t;&t;0x00000f00&t;/* 21041: AUI or TP with LEDs */
DECL|macro|TSIAC_INEN
mdefine_line|#define&t;TSIAC_INEN&t;&t;&t;0x00001000&t;/* 21041: Input enable */
DECL|macro|TSIAC_NO10TP
mdefine_line|#define&t;TSIAC_NO10TP&t;&t;0x00000008&t;/* 10baseT(0) or not(1) */
DECL|macro|TSIAC_CONFIG
mdefine_line|#define TSIAC_CONFIG&t;&t;0x00000004&t;/* Configuration */
DECL|macro|TSIAC_SWRESET
mdefine_line|#define&t;TSIAC_SWRESET&t;&t;0x00000001&t;/* 21041: software reset */
DECL|macro|TSIAC_RESET
mdefine_line|#define&t;TSIAC_RESET&t;&t;&t;0x00000000&t;/* reset */
DECL|macro|TSIAC_C21041
mdefine_line|#define&t;TSIAC_C21041&t;&t;(TSIAC_OUTEN|TSIAC_SELED|TSIAC_SWRESET)
DECL|macro|TSIAC_C21040
mdefine_line|#define&t;TSIAC_C21040&t;&t;TSIAC_CONFIG
multiline_comment|/* description of CSR14 SIA TX/RX register */
DECL|macro|TSIAX_NO10TP
mdefine_line|#define&t;TSIAX_NO10TP&t;&t;0x0000f73d
DECL|macro|TSIAX_10TP
mdefine_line|#define&t;TSIAX_10TP&t;&t;&t;0x0000ff3f
multiline_comment|/* description of CSR15 SIA general register */
DECL|macro|TSIAG_SWBNCAUI
mdefine_line|#define&t;TSIAG_SWBNCAUI&t;&t;0x00000008 /* BNC(0) or AUI(1) */
DECL|macro|TSIAG_BNC
mdefine_line|#define&t;TSIAG_BNC&t;&t;&t;0x00000006
DECL|macro|TSIAG_AUI
mdefine_line|#define&t;TSIAG_AUI&t;&t;&t;(TSIAG_BNC|TSIAG_SWBNCAUI)
DECL|macro|TSIAG_10TP
mdefine_line|#define&t;TSIAG_10TP&t;&t;&t;0x00000000
multiline_comment|/* description of rx_ring.status */
DECL|macro|TRING_OWN
mdefine_line|#define&t;TRING_OWN&t;&t;&t;0x80000000&t;/* Owned by chip */
DECL|macro|TRING_CLEAR
mdefine_line|#define&t;TRING_CLEAR&t;&t;&t;0x00000000&t;/* clear */
DECL|macro|TRING_ERROR
mdefine_line|#define&t;TRING_ERROR&t;&t;&t;0x00008000&t;/* error summary */
DECL|macro|TRING_ETxTO
mdefine_line|#define&t;TRING_ETxTO&t;&t;&t;0x00004000&t;/* Tx time out */
DECL|macro|TRING_ELCOLL
mdefine_line|#define&t;TRING_ELCOLL&t;&t;0x00000200&t;/* late collision */
DECL|macro|TRING_EFCOLL
mdefine_line|#define&t;TRING_EFCOLL&t;&t;0x00000100&t;/* fatal collision */
DECL|macro|TRING_ELCARR
mdefine_line|#define&t;TRING_ELCARR&t;&t;0x00000800&t;/* carrier lost */
DECL|macro|TRING_ENCARR
mdefine_line|#define&t;TRING_ENCARR&t;&t;0x00000400&t;/* no carrier */
DECL|macro|TRING_ENOHB
mdefine_line|#define&t;TRING_ENOHB&t;&t;&t;0x00000080&t;/* heartbeat fail */
DECL|macro|TRING_ELINK
mdefine_line|#define&t;TRING_ELINK&t;&t;&t;0x00000004&t;/* link fail */
DECL|macro|TRING_EUFLOW
mdefine_line|#define&t;TRING_EUFLOW&t;&t;0x00000002&t;/* underflow */
DECL|macro|TRING_ELEN
mdefine_line|#define&t;TRING_ELEN&t;&t;&t;0x00004000&t;/* length error */
DECL|macro|TRING_FDESC
mdefine_line|#define&t;TRING_FDESC&t;&t;&t;0x00000200&t;/* first descriptor */
DECL|macro|TRING_LDESC
mdefine_line|#define&t;TRING_LDESC&t;&t;&t;0x00000100&t;/* last descriptor */
DECL|macro|TRING_ERUNT
mdefine_line|#define&t;TRING_ERUNT&t;&t;&t;0x00000800&t;/* runt frame */
DECL|macro|TRING_ELONG
mdefine_line|#define&t;TRING_ELONG&t;&t;&t;0x00000080&t;/* frame too long */
DECL|macro|TRING_EWATCHDOG
mdefine_line|#define&t;TRING_EWATCHDOG&t;&t;0x00000010&t;/* receive watchdog */
DECL|macro|TRING_EDRBIT
mdefine_line|#define&t;TRING_EDRBIT&t;&t;0x00000004&t;/* dribble bit */
DECL|macro|TRING_ECRC
mdefine_line|#define&t;TRING_ECRC&t;&t;&t;0x00000002&t;/* CRC error */
DECL|macro|TRING_EOVERFLOW
mdefine_line|#define&t;TRING_EOVERFLOW&t;&t;0x00000001&t;/* overflow */
DECL|macro|TRING_RxDESCMASK
mdefine_line|#define&t;TRING_RxDESCMASK&t;(TRING_FDESC|TRING_LDESC)
DECL|macro|TRING_RxLENGTH
mdefine_line|#define&t;TRING_RxLENGTH&t;&t;(TRING_ERUNT|TRING_ELONG|TRING_EWATCHDOG)
DECL|macro|TRING_RxFRAME
mdefine_line|#define&t;TRING_RxFRAME&t;&t;(TRING_EDRBIT)
DECL|macro|TRING_RxCRC
mdefine_line|#define&t;TRING_RxCRC&t;&t;&t;(TRING_ECRC)
DECL|macro|TRING_RxFIFO
mdefine_line|#define&t;TRING_RxFIFO&t;&t;(TRING_EOVERFLOW)
DECL|macro|TRING_TxABORT
mdefine_line|#define&t;TRING_TxABORT&t;&t;(TRING_ETxTO|TRING_EFCOLL|TRING_ELINK)
DECL|macro|TRING_TxCARR
mdefine_line|#define&t;TRING_TxCARR&t;&t;(TRING_ELCARR|TRING_ENCARR)
DECL|macro|TRING_TxWINDOW
mdefine_line|#define&t;TRING_TxWINDOW&t;&t;(TRING_ELCOLL)
DECL|macro|TRING_TxFIFO
mdefine_line|#define&t;TRING_TxFIFO&t;&t;(TRING_EUFLOW)
DECL|macro|TRING_TxHEARTBEAT
mdefine_line|#define&t;TRING_TxHEARTBEAT&t;(TRING_ENOHB)
multiline_comment|/* The Tulip Rx and Tx buffer descriptors. */
DECL|struct|tulip_rx_desc
r_struct
id|tulip_rx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
DECL|member|buffer2
id|u32
id|buffer1
comma
id|buffer2
suffix:semicolon
multiline_comment|/* We use only buffer 1.  */
)brace
suffix:semicolon
DECL|struct|tulip_tx_desc
r_struct
id|tulip_tx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
DECL|member|buffer2
id|u32
id|buffer1
comma
id|buffer2
suffix:semicolon
multiline_comment|/* We use only buffer 1.  */
)brace
suffix:semicolon
DECL|struct|tulip_private
r_struct
id|tulip_private
(brace
DECL|member|rx_ring
r_struct
id|tulip_rx_desc
id|rx_ring
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_ring
r_struct
id|tulip_tx_desc
id|tx_ring
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* The saved address of a sent-in-place packet/buffer, for skfree(). */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
DECL|member|rx_buffs
r_char
id|rx_buffs
(braket
id|RX_RING_SIZE
)braket
(braket
id|PKT_BUF_SZ
)braket
suffix:semicolon
multiline_comment|/* temporary Rx buffers. */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|setup_frame
r_int
id|setup_frame
(braket
l_int|48
)braket
suffix:semicolon
multiline_comment|/* Pseudo-Tx frame to init address table. */
DECL|member|port_select
r_void
(paren
op_star
id|port_select
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|member|port_fail
r_int
(paren
op_star
id|port_fail
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|member|next_module
r_struct
id|device
op_star
id|next_module
suffix:semicolon
DECL|member|signature
r_char
op_star
id|signature
suffix:semicolon
DECL|member|cur_rx
DECL|member|cur_tx
r_int
r_int
id|cur_rx
comma
id|cur_tx
suffix:semicolon
multiline_comment|/* The next free ring entry */
DECL|member|dirty_rx
DECL|member|dirty_tx
r_int
r_int
id|dirty_rx
comma
id|dirty_tx
suffix:semicolon
multiline_comment|/* The ring entries to be free()ed. */
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* The Tx queue is full. */
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Full-duplex operation requested. */
DECL|member|port_fix
r_int
r_int
id|port_fix
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Fix if_port to specified port. */
)brace
suffix:semicolon
DECL|struct|eeprom
r_struct
id|eeprom
(brace
r_union
(brace
r_struct
(brace
multiline_comment|/* broken EEPROM structure */
DECL|member|addr
id|u_char
id|addr
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|ng
)brace
id|ng
suffix:semicolon
r_struct
(brace
multiline_comment|/* DEC EtherWorks&n;&t;&t;&t;&t;&t;and other cards which have correct eeprom structure */
DECL|member|dum1
id|u_char
id|dum1
(braket
l_int|20
)braket
suffix:semicolon
DECL|member|addr
id|u_char
id|addr
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|ok
)brace
id|ok
suffix:semicolon
DECL|member|hw
)brace
id|hw
suffix:semicolon
DECL|macro|ng_addr
mdefine_line|#define&t;ng_addr&t;hw.ng.addr
DECL|macro|ok_addr
mdefine_line|#define&t;ok_addr&t;hw.ok.addr
DECL|macro|EE_SIGNLEN
mdefine_line|#define&t;EE_SIGNLEN&t;14&t;&t;/* should be 102 ? */
DECL|member|sign
id|u_char
id|sign
(braket
id|EE_SIGNLEN
)braket
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
id|read_eeprom
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_struct
id|eeprom
op_star
id|eepp
)paren
suffix:semicolon
r_static
r_int
id|tulip_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_init_ring
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|tulip_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|macro|generic21140_fail
mdefine_line|#define&t;generic21140_fail&t;NULL
r_static
r_void
id|generic21040_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|generic21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|generic21041_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|auto21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|cogent21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|generic21040_fail
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|generic21041_fail
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/* A list of all installed Tulip devices, for removing the driver module. */
DECL|variable|root_tulip_dev
r_static
r_struct
id|device
op_star
id|root_tulip_dev
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_static
r_struct
(brace
DECL|member|port_select
r_void
(paren
op_star
id|port_select
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|member|port_fail
r_int
(paren
op_star
id|port_fail
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|member|vendor_id
DECL|member|device_id
r_int
r_int
id|vendor_id
comma
id|device_id
suffix:semicolon
DECL|member|signature
r_char
op_star
id|signature
suffix:semicolon
DECL|member|array
r_int
r_int
id|array
suffix:colon
l_int|1
suffix:semicolon
DECL|variable|cardVendor
)brace
id|cardVendor
(braket
)braket
op_assign
(brace
(brace
id|generic21140_select
comma
id|generic21140_fail
comma
l_int|0x0000c000
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
l_string|&quot;smc9332&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21041_select
comma
id|generic21041_fail
comma
l_int|0x0000c000
comma
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
comma
l_string|&quot;smc8432&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x0000c000
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;old smc8432&quot;
comma
l_int|0
)brace
comma
(brace
id|auto21140_select
comma
id|generic21140_fail
comma
l_int|0x0000f400
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
l_string|&quot;LA100PCI&quot;
comma
l_int|0
)brace
comma
(brace
id|cogent21140_select
comma
id|generic21140_fail
comma
l_int|0x00009200
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
l_string|&quot;cogent_em110&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x00009200
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;cogent_em96x&quot;
comma
l_int|1
)brace
comma
(brace
id|generic21140_select
comma
id|generic21140_fail
comma
l_int|0x0000f800
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
l_string|&quot;DE500&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21041_select
comma
id|generic21041_fail
comma
l_int|0x0000f800
comma
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
comma
l_string|&quot;DE450&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x0000f800
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;DE43x&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x0040c700
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;EN9400&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x00c09500
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;ZNYX312&quot;
comma
l_int|1
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0x08002b00
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;QSILVER&squot;s&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21040_select
comma
id|generic21040_fail
comma
l_int|0
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
l_string|&quot;21040&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21140_select
comma
id|generic21140_fail
comma
l_int|0
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
l_string|&quot;21140&quot;
comma
l_int|0
)brace
comma
(brace
id|generic21041_select
comma
id|generic21041_fail
comma
l_int|0
comma
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
comma
l_string|&quot;21041&quot;
comma
l_int|0
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Unknown&quot;
comma
l_int|0
)brace
)brace
suffix:semicolon
"&f;"
multiline_comment|/* Serial EEPROM section.&n;   A &quot;bit&quot; grungy, but we work our way through bit-by-bit :-&gt;. */
multiline_comment|/*  EEPROM_Ctrl bits. */
DECL|macro|EE_SHIFT_CLK
mdefine_line|#define EE_SHIFT_CLK&t;0x02&t;/* EEPROM shift clock. */
DECL|macro|EE_CS
mdefine_line|#define EE_CS&t;&t;&t;0x01&t;/* EEPROM chip select. */
DECL|macro|EE_DATA_WRITE
mdefine_line|#define EE_DATA_WRITE&t;0x04&t;/* EEPROM chip data in. */
DECL|macro|EE_WRITE_0
mdefine_line|#define EE_WRITE_0&t;&t;0x01
DECL|macro|EE_WRITE_1
mdefine_line|#define EE_WRITE_1&t;&t;0x05
DECL|macro|EE_DATA_READ
mdefine_line|#define EE_DATA_READ&t;0x08&t;/* EEPROM chip data out. */
DECL|macro|EE_ENB
mdefine_line|#define EE_ENB&t;&t;&t;(0x4800 | EE_CS)
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|macro|EE_WRITE_CMD
mdefine_line|#define EE_WRITE_CMD&t;(5 &lt;&lt; 6)
DECL|macro|EE_READ_CMD
mdefine_line|#define EE_READ_CMD&t;&t;(6 &lt;&lt; 6)
DECL|macro|EE_ERASE_CMD
mdefine_line|#define EE_ERASE_CMD&t;(7 &lt;&lt; 6)
macro_line|#ifdef MODULE
DECL|variable|if_port
r_static
r_int
id|if_port
op_assign
id|TULIP_AUTO_PORT
suffix:semicolon
macro_line|#ifdef TULIP_FULL_DUPLEX
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
op_assign
l_int|1
suffix:semicolon
macro_line|#else
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|macro|tio_write
mdefine_line|#define&t;tio_write(val, port)&t;outl(val, ioaddr + port)
DECL|macro|tio_read
mdefine_line|#define&t;tio_read(port)&t;&t;&t;inl(ioaddr + port)
r_static
r_void
r_inline
DECL|function|tio_sia_write
id|tio_sia_write
c_func
(paren
r_int
r_int
id|ioaddr
comma
id|u32
id|val13
comma
id|u32
id|val14
comma
id|u32
id|val15
)paren
(brace
id|tio_write
c_func
(paren
l_int|0
comma
id|CSR13
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|val15
comma
id|CSR15
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|val14
comma
id|CSR14
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|val13
comma
id|CSR13
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;   card_type returns 1 if the card is &squot;etherarray&squot;&n;*/
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|card_type
c_func
(paren
r_struct
id|tulip_private
op_star
id|tp
comma
r_int
id|device_id
comma
r_int
id|vendor_id
)paren
)paren
(brace
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|cardVendor
(braket
id|n
)braket
dot
id|device_id
suffix:semicolon
id|n
op_increment
)paren
r_if
c_cond
(paren
id|cardVendor
(braket
id|n
)braket
dot
id|device_id
op_eq
id|device_id
op_logical_and
(paren
id|cardVendor
(braket
id|n
)braket
dot
id|vendor_id
op_eq
id|vendor_id
op_logical_or
id|cardVendor
(braket
id|n
)braket
dot
id|vendor_id
op_eq
l_int|0
)paren
)paren
r_break
suffix:semicolon
id|tp-&gt;port_select
op_assign
id|cardVendor
(braket
id|n
)braket
dot
id|port_select
suffix:semicolon
id|tp-&gt;port_fail
op_assign
id|cardVendor
(braket
id|n
)braket
dot
id|port_fail
suffix:semicolon
id|tp-&gt;signature
op_assign
id|cardVendor
(braket
id|n
)braket
dot
id|signature
suffix:semicolon
r_return
id|cardVendor
(braket
id|n
)braket
dot
id|array
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|read_eeprom
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_struct
id|eeprom
op_star
id|eepp
)paren
)paren
(brace
r_int
id|i
comma
id|n
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|read_cmd
op_assign
id|EE_READ_CMD
suffix:semicolon
id|u_char
op_star
id|p
op_assign
(paren
id|u_char
op_star
)paren
id|eepp
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
r_sizeof
(paren
r_struct
id|eeprom
)paren
op_div
l_int|2
suffix:semicolon
id|n
op_increment
comma
id|read_cmd
op_increment
)paren
(brace
id|tio_write
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|CSR9
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|EE_ENB
comma
id|CSR9
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|10
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_DATA_WRITE
suffix:colon
l_int|0
suffix:semicolon
id|tio_write
c_func
(paren
id|EE_ENB
op_or
id|dataval
comma
id|CSR9
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|EE_ENB
op_or
id|dataval
op_or
id|EE_SHIFT_CLK
comma
id|CSR9
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|150
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|EE_ENB
op_or
id|dataval
comma
id|CSR9
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
id|tio_write
c_func
(paren
id|EE_ENB
comma
id|CSR9
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tio_write
c_func
(paren
id|EE_ENB
op_or
id|EE_SHIFT_CLK
comma
id|CSR9
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|tio_read
c_func
(paren
id|CSR9
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|EE_ENB
comma
id|CSR9
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|tio_write
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|CSR9
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|le16_to_cpu
c_func
(paren
id|val
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|le16_to_cpu
c_func
(paren
id|val
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
multiline_comment|/* broken eeprom ? */
id|p
op_assign
(paren
id|u_char
op_star
)paren
id|eepp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|p
(braket
id|i
)braket
op_ne
id|p
(braket
l_int|15
op_minus
id|i
)braket
op_logical_or
id|p
(braket
id|i
)braket
op_ne
id|p
(braket
l_int|16
op_plus
id|i
)braket
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* broken */
)brace
multiline_comment|/* Is this required ? */
r_static
r_int
DECL|function|generic21040_fail
id|generic21040_fail
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_return
id|tio_read
c_func
(paren
id|CSR12
)paren
op_amp
id|TSIAS_CONERROR
suffix:semicolon
)brace
r_static
r_int
DECL|function|generic21041_fail
id|generic21041_fail
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|csr12
op_assign
id|tio_read
c_func
(paren
id|CSR12
)paren
suffix:semicolon
r_return
(paren
op_logical_neg
(paren
id|csr12
op_amp
id|TSIAS_CONERROR
)paren
op_logical_or
op_logical_neg
(paren
id|csr12
op_amp
id|TSIAS_LNKERROR
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|generic21040_select
id|generic21040_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_const
r_char
op_star
id|media
suffix:semicolon
id|dev-&gt;if_port
op_and_assign
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|TULIP_10TP_PORT
suffix:colon
id|media
op_assign
l_string|&quot;10baseT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TULIP_AUI_PORT
suffix:colon
id|media
op_assign
l_string|&quot;AUI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TULIP_BNC_PORT
suffix:colon
id|media
op_assign
l_string|&quot;BNC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|media
op_assign
l_string|&quot;unknown type&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: enabling %s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media
)paren
suffix:semicolon
multiline_comment|/* Set the full duplex match frame. */
id|tio_write
c_func
(paren
id|FULL_DUPLEX_MAGIC
comma
id|CSR11
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TSIAC_RESET
comma
id|CSR13
)paren
suffix:semicolon
multiline_comment|/* Reset the serial interface */
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TSIAC_NO10TP
suffix:colon
l_int|0
)paren
op_or
id|TSIAC_C21040
comma
id|CSR13
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|generic_timer
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|count
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|tio_write
c_func
(paren
id|count
comma
id|CSR11
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tio_read
c_func
(paren
id|CSR11
)paren
op_amp
id|TGEPT_COUNT
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|generic21041_select
id|generic21041_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|tsiac
op_assign
id|TSIAC_C21041
suffix:semicolon
id|u32
id|tsiax
op_assign
id|TSIAX_10TP
suffix:semicolon
id|u32
id|tsiag
op_assign
id|TSIAG_10TP
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|TULIP_AUI_PORT
suffix:colon
id|tsiac
op_or_assign
id|TSIAC_NO10TP
suffix:semicolon
id|tsiax
op_assign
id|TSIAX_NO10TP
suffix:semicolon
id|tsiag
op_assign
id|TSIAG_AUI
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TULIP_BNC_PORT
suffix:colon
id|tsiac
op_or_assign
id|TSIAC_NO10TP
suffix:semicolon
id|tsiax
op_assign
id|TSIAX_NO10TP
suffix:semicolon
id|tsiag
op_assign
id|TSIAG_BNC
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev-&gt;if_port
op_assign
id|TULIP_10TP_PORT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tio_sia_write
c_func
(paren
id|ioaddr
comma
id|tsiac
comma
id|tsiax
comma
id|tsiag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;start
)paren
id|printk
c_func
(paren
l_string|&quot;%s: enabling %s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|dev-&gt;if_port
op_eq
id|TULIP_AUI_PORT
)paren
ques
c_cond
l_string|&quot;AUI&quot;
suffix:colon
(paren
id|dev-&gt;if_port
op_eq
id|TULIP_BNC_PORT
)paren
ques
c_cond
l_string|&quot;BNC&quot;
suffix:colon
l_string|&quot;10TP&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|auto21140_select
id|auto21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* kick port */
id|tio_write
c_func
(paren
id|TPOLL_TRIGGER
comma
id|CSR1
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TINTR_ENABLE
comma
id|CSR7
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TCMOD_AUTO
op_or
id|TCMOD_TRxSTART
comma
id|CSR6
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
op_logical_neg
(paren
id|tio_read
c_func
(paren
id|CSR12
)paren
op_amp
id|TGEPR_FORCEALED
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: probed %s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;if_port
ques
c_cond
l_string|&quot;100TX&quot;
suffix:colon
l_string|&quot;10TP&quot;
)paren
suffix:semicolon
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TGEPR_FORCE100
suffix:colon
l_int|0
)paren
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0
suffix:colon
id|TGEPR_HALFDUPLEX
)paren
comma
id|CSR12
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TINTR_DISABLE
comma
id|CSR7
)paren
suffix:semicolon
id|i
op_assign
id|tio_read
c_func
(paren
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|tio_write
c_func
(paren
id|TCMOD_AUTO
comma
id|CSR6
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|cogent21140_select
id|cogent21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
comma
id|csr6
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;if_port
op_and_assign
l_int|1
suffix:semicolon
id|csr6
op_assign
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_10TP
op_or
id|TCMOD_100TP
op_or
id|TCMOD_TRxSTART
op_or
id|TCMOD_SCRM
)paren
suffix:semicolon
multiline_comment|/* Stop the transmit process. */
id|tio_write
c_func
(paren
id|csr6
op_or
id|TCMOD_RxSTART
comma
id|CSR6
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: enabling %s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;if_port
ques
c_cond
l_string|&quot;100baseTx&quot;
suffix:colon
l_string|&quot;10baseT&quot;
)paren
suffix:semicolon
multiline_comment|/* Turn on the output drivers */
id|tio_write
c_func
(paren
l_int|0x0000013F
comma
id|CSR12
)paren
suffix:semicolon
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TGEPR_FORCE100
suffix:colon
l_int|0
)paren
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0
suffix:colon
id|TGEPR_HALFDUPLEX
)paren
comma
id|CSR12
)paren
suffix:semicolon
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TCMOD_100TP
suffix:colon
id|TCMOD_10TP
)paren
op_or
id|TCMOD_TRxSTART
op_or
id|TCMOD_TH128
op_or
id|csr6
comma
id|CSR6
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|generic21140_select
id|generic21140_select
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
comma
id|csr6
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;if_port
op_and_assign
l_int|1
suffix:semicolon
id|csr6
op_assign
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_10TP
op_or
id|TCMOD_100TP
op_or
id|TCMOD_TRxSTART
op_or
id|TCMOD_SCRM
)paren
suffix:semicolon
multiline_comment|/* Stop the transmit process. */
id|tio_write
c_func
(paren
id|csr6
op_or
id|TCMOD_RxSTART
comma
id|CSR6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;start
)paren
id|printk
c_func
(paren
l_string|&quot;%s: enabling %s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;if_port
ques
c_cond
l_string|&quot;100TX&quot;
suffix:colon
l_string|&quot;10TP&quot;
)paren
suffix:semicolon
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TCMOD_100TP
suffix:colon
id|TCMOD_10TP
)paren
op_or
id|TCMOD_TRxSTART
op_or
id|TCMOD_TH128
op_or
id|csr6
comma
id|CSR6
)paren
suffix:semicolon
id|tio_write
c_func
(paren
(paren
id|dev-&gt;if_port
ques
c_cond
id|TGEPR_FORCE100
suffix:colon
l_int|0
)paren
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0
suffix:colon
id|TGEPR_HALFDUPLEX
)paren
comma
id|CSR12
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_open
id|tulip_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Reset the chip, holding bit 0 set at least 10 PCI cycles. */
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR0
)paren
op_or
id|TBMOD_RESET
comma
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Deassert reset.  Set 8 longword cache alignment, 8 longword burst.&n;&t;   -&gt; Set 32 longword cache alignment, unlimited longword burst ?&n;&t;   Wait the specified 50 PCI cycles after a reset by initializing&n;&t;   Tx and Rx queues and the address filter list. */
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR0
)paren
op_or
id|TBMOD_ALIGN32
op_or
id|TBMOD_BURST0
comma
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
(paren
r_void
op_star
)paren
op_amp
id|tulip_interrupt
comma
id|SA_SHIRQ
comma
id|tp-&gt;signature
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|tulip_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Fill the whole address filter table with our physical address. */
(brace
r_int
r_int
op_star
id|eaddrs
op_assign
(paren
r_int
r_int
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
r_int
op_star
id|setup_frm
op_assign
id|tp-&gt;setup_frame
comma
id|i
suffix:semicolon
multiline_comment|/* You must add the broadcast address when doing perfect filtering! */
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* Fill the rest of the accept table with our physical address. */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Put the setup frame on the Tx list. */
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x08000000
op_or
l_int|192
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;setup_frame
)paren
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|TRING_OWN
)paren
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
comma
id|tp-&gt;dirty_tx
op_increment
suffix:semicolon
)brace
id|tio_write
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;rx_ring
)paren
comma
id|CSR3
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;tx_ring
)paren
comma
id|CSR4
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * process setup frame completely prior to fiddling with media.&n;&t; */
id|tio_write
c_func
(paren
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
id|TCMOD_PROMISC
)paren
op_or
id|TCMOD_TxSTART
comma
id|CSR6
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TPOLL_TRIGGER
comma
id|CSR1
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|s32
)paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|status
)paren
)paren
op_ge
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|500
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: initial setup frame didn&squot;t complete.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|tio_write
c_func
(paren
id|TINTR_DISABLE
comma
id|CSR7
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_TRxSTART
)paren
comma
id|CSR6
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TSIAC_CONFIG
comma
id|CSR13
)paren
suffix:semicolon
id|tio_write
c_func
(paren
l_int|0
comma
id|CSR13
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EIO
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Whack the chip to stop it and *then* do initial media setup.&n;&t; */
id|tio_write
c_func
(paren
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_PROMISC
op_or
id|TCMOD_TxSTART
)paren
)paren
comma
id|CSR6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;port_select
)paren
id|tp
op_member_access_from_pointer
id|port_select
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Tx and Rx processes. */
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_or
id|TCMOD_TRxSTART
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
id|TCMOD_FULLDUPLEX
suffix:colon
l_int|0
)paren
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|tio_write
c_func
(paren
id|TINTR_ENABLE
comma
id|CSR7
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
r_static
r_void
DECL|function|tulip_init_ring
id|tulip_init_ring
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_rx
op_assign
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|TRING_OWN
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;rx_buffs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;rx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
op_or
l_int|0x02000000
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;rx_ring
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* The Tx buffer descriptor is filled in as needed, but we&n;&t;   do need to clear the ownership bit. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|tulip_start_xmit
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|entry
comma
id|len
suffix:semicolon
r_int
r_int
id|daddr
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
r_if
c_cond
(paren
id|dev-&gt;tbusy
op_logical_or
(paren
id|tp-&gt;port_fail
op_logical_and
id|tp
op_member_access_from_pointer
id|port_fail
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|40
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;port_select
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;port_fix
)paren
id|dev-&gt;if_port
op_increment
suffix:semicolon
id|tp
op_member_access_from_pointer
id|port_select
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, status %8.8x,&quot;
l_string|&quot;SIA %8.8x %8.8x %8.8x %8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tio_read
c_func
(paren
id|CSR5
)paren
comma
id|tio_read
c_func
(paren
id|CSR12
)paren
comma
id|tio_read
c_func
(paren
id|CSR13
)paren
comma
id|tio_read
c_func
(paren
id|CSR14
)paren
comma
id|tio_read
c_func
(paren
id|CSR15
)paren
)paren
suffix:semicolon
macro_line|#if !defined(__alpha__) &amp;&amp; !defined(__sparc_v9__)
id|printk
c_func
(paren
l_string|&quot;  Rx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;rx_ring
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
macro_line|#if !defined(__alpha__) &amp;&amp; !defined(__sparc_v9__)
id|printk
c_func
(paren
l_string|&quot;&bslash;n  Tx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;tx_ring
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Perhaps we should reinitialize the hardware here. */
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tio_write
c_func
(paren
id|TSIAC_CONFIG
comma
id|CSR13
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Tx and Rx processes . */
id|tio_write
c_func
(paren
id|TCMOD_10TP
op_or
id|TCMOD_TRxSTART
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|tio_write
c_func
(paren
id|TPOLL_TRIGGER
comma
id|CSR1
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Block a timer-based transmit from overlapping.  This could better be&n;&t;   done with atomic_swap(1, dev-&gt;tbusy), but set_bit() works as well.&n;&t;   If this ever occurs the queue layer is doing something evil! */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Caution: the write order is important here, set the base address&n;&t;   with the &quot;ownership&quot; bits last. */
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * If skb is == -1, then this is a funky setup_frame redo.&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
(paren
r_struct
id|sk_buff
op_star
)paren
op_minus
l_int|1
)paren
(brace
id|daddr
op_assign
id|virt_to_bus
c_func
(paren
(paren
r_char
op_star
)paren
id|tp-&gt;setup_frame
)paren
suffix:semicolon
macro_line|#ifdef NO_ANK_FIX
id|len
op_assign
l_int|192
suffix:semicolon
macro_line|#else
id|len
op_assign
l_int|192
op_or
l_int|0x08000000
suffix:semicolon
macro_line|#endif
id|skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|daddr
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|tp-&gt;stats.tx_bytes
op_add_assign
id|len
suffix:semicolon
)brace
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|len
op_or
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
ques
c_cond
l_int|0xe2000000
suffix:colon
l_int|0xe0000000
)paren
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|daddr
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|TRING_OWN
)paren
suffix:semicolon
multiline_comment|/* Pass ownership to the chip. */
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|tio_write
c_func
(paren
id|TPOLL_TRIGGER
comma
id|CSR1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|tulip_interrupt
r_static
r_void
id|tulip_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
(paren
r_struct
id|device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|tulip_private
op_star
id|lp
suffix:semicolon
r_int
id|csr5
comma
id|boguscnt
op_assign
l_int|10
suffix:semicolon
r_int
r_int
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;tulip_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Re-entering the interrupt handler.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
r_do
(brace
id|csr5
op_assign
id|tio_read
c_func
(paren
id|CSR5
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|tio_write
c_func
(paren
id|csr5
op_amp
id|TSTAT_CLEARINTR
comma
id|CSR5
)paren
suffix:semicolon
multiline_comment|/* check interrupt ? */
r_if
c_cond
(paren
(paren
id|csr5
op_amp
(paren
id|TSTAT_NORINTR
op_or
id|TSTAT_ABNINTR
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_RxINTR
)paren
multiline_comment|/* Rx interrupt */
id|tulip_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_TxINTR
)paren
(brace
multiline_comment|/* Tx-done interrupt */
r_int
id|dirty_tx
op_assign
id|lp-&gt;dirty_tx
suffix:semicolon
r_while
c_loop
(paren
id|dirty_tx
OL
id|lp-&gt;cur_tx
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been Txed */
r_if
c_cond
(paren
id|status
op_amp
id|TRING_ERROR
)paren
(brace
multiline_comment|/* There was an major error, log it. */
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_TxABORT
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_TxCARR
)paren
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_TxWINDOW
)paren
id|lp-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_TxFIFO
)paren
id|lp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|TRING_TxHEARTBEAT
)paren
op_logical_and
op_logical_neg
id|lp-&gt;full_duplex
)paren
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0100
)paren
id|lp-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0001
)paren
id|lp-&gt;stats.tx_deferred
op_increment
suffix:semicolon
macro_line|#endif
id|lp-&gt;stats.collisions
op_add_assign
(paren
id|status
op_rshift
l_int|3
)paren
op_amp
l_int|15
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
r_if
c_cond
(paren
id|lp-&gt;tx_skbuff
(braket
id|entry
)braket
op_ne
l_int|NULL
)paren
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;tx_skbuff
(braket
id|entry
)braket
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|dirty_tx
op_increment
suffix:semicolon
)brace
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|lp-&gt;cur_tx
op_minus
id|dirty_tx
op_ge
id|TX_RING_SIZE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;out-of-sync dirty pointer, %d vs. %d, full=%d.&bslash;n&quot;
comma
id|dirty_tx
comma
id|lp-&gt;cur_tx
comma
id|lp-&gt;tx_full
)paren
suffix:semicolon
id|dirty_tx
op_add_assign
id|TX_RING_SIZE
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|lp-&gt;tx_full
op_logical_and
id|dev-&gt;tbusy
op_logical_and
id|dirty_tx
OG
id|lp-&gt;cur_tx
op_minus
id|TX_RING_SIZE
op_plus
l_int|2
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tbusy. */
id|lp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
id|lp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
)brace
multiline_comment|/* Log errors. */
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_ABNINTR
)paren
(brace
multiline_comment|/* Abnormal error summary bit. */
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_TxTOUT
)paren
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Tx babble. */
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_RxMISSED
)paren
(brace
multiline_comment|/* Missed a Rx frame. */
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_missed_errors
op_add_assign
id|tio_read
c_func
(paren
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr5
op_amp
id|TSTAT_TEXPIRED
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Something Wicked happened! %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr5
)paren
suffix:semicolon
multiline_comment|/* Hmmmmm, it&squot;s not clear what to do here. */
)brace
)brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Too much work at interrupt, csr5=0x%8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr5
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupt sources. */
id|tio_write
c_func
(paren
id|TSTAT_CLEARINTR
comma
id|CSR5
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Special code for testing *only*. */
(brace
r_static
r_int
id|stopit
op_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;start
op_eq
l_int|0
op_logical_and
op_decrement
id|stopit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Emergency stop, looping startup interrupt.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_rx
id|tulip_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|lp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
op_assign
id|lp-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* If we own the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
(paren
(paren
id|s32
)paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
)paren
op_ge
l_int|0
)paren
(brace
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|TRING_RxDESCMASK
)paren
op_ne
id|TRING_RxDESCMASK
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Ethernet frame spanned multiple buffers,&quot;
l_string|&quot;status %8.8x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|TRING_ERROR
)paren
(brace
multiline_comment|/* There was a fatal error. */
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* end of a packet.*/
r_if
c_cond
(paren
id|status
op_amp
id|TRING_RxLENGTH
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_RxFRAME
)paren
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_RxCRC
)paren
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TRING_RxFIFO
)paren
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Malloc up new buffer, compatible with net-2e. */
multiline_comment|/* Omit the four octet CRC from the length. */
r_int
id|pkt_len
op_assign
(paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
op_rshift
l_int|16
)paren
op_minus
l_int|4
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze, deferring packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Check that at least two ring entries are free.&n;&t;&t;&t;&t;   If not, free one and mark stats-&gt;rx_dropped++. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
(paren
id|s32
)paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
(paren
id|entry
op_plus
id|i
)paren
op_mod
id|RX_RING_SIZE
)braket
dot
id|status
)paren
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
id|RX_RING_SIZE
op_minus
l_int|2
)paren
(brace
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|TRING_OWN
)paren
suffix:semicolon
id|lp-&gt;cur_rx
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|bus_to_virt
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|buffer1
)paren
comma
id|pkt_len
)paren
suffix:semicolon
multiline_comment|/* Needed for 1.3.x */
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
id|lp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|TRING_OWN
)paren
suffix:semicolon
id|entry
op_assign
(paren
op_increment
id|lp-&gt;cur_rx
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_close
id|tulip_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|tio_write
c_func
(paren
id|TINTR_DISABLE
comma
id|CSR7
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_TRxSTART
)paren
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Leave the card in 10baseT state. */
id|tio_write
c_func
(paren
id|TSIAC_CONFIG
comma
id|CSR13
)paren
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|tio_read
c_func
(paren
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|tio_write
c_func
(paren
l_int|0
comma
id|CSR13
)paren
suffix:semicolon
multiline_comment|/*&t;tio_write(0, CSR8);&t;wake up chip ? */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_config
id|tulip_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|map-&gt;port
op_eq
l_int|0xff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
id|tp-&gt;port_fix
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;port_select
)paren
id|tp
op_member_access_from_pointer
id|port_select
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*&t;unsigned long ioaddr = dev-&gt;base_addr;*/
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Set or clear the multicast filter for this adaptor.&n; */
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|csr6
op_assign
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
(paren
id|TCMOD_MODEMASK
op_or
id|TCMOD_FILTERMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. why ALLMULTI ? */
id|tio_write
c_func
(paren
id|csr6
op_or
id|TCMOD_PROMISC
op_or
id|TCMOD_ALLMCAST
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Log any net taps. */
id|printk
c_func
(paren
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|14
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|tio_write
c_func
(paren
id|csr6
op_or
id|TCMOD_ALLMCAST
comma
id|CSR6
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_int
op_star
id|setup_frm
op_assign
id|tp-&gt;setup_frame
suffix:semicolon
r_int
r_int
op_star
id|eaddrs
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* We have &lt; 15 addresses that we can use the wonderful&n;&t;&t;   16 address perfect filtering of the Tulip.  Note that only&n;&t;&t;   the low shortword of setup_frame[] is valid. */
id|tio_write
c_func
(paren
id|csr6
op_or
l_int|0x0000
comma
id|CSR6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eaddrs
op_assign
(paren
r_int
r_int
op_star
)paren
id|dmi-&gt;dmi_addr
suffix:semicolon
id|dmi
op_assign
id|dmi-&gt;next
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
op_star
id|eaddrs
op_increment
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
op_star
id|eaddrs
op_increment
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
op_star
id|eaddrs
op_increment
)paren
suffix:semicolon
)brace
multiline_comment|/* Fill the rest of the table with our physical address. */
id|eaddrs
op_assign
(paren
r_int
r_int
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
multiline_comment|/* Always accept broadcast packets */
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xffff
)paren
suffix:semicolon
r_do
(brace
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
l_int|15
)paren
suffix:semicolon
multiline_comment|/* Now add this frame to the Tx list. */
id|tulip_start_xmit
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
op_minus
l_int|1
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|tulip_hwinit
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|device_id
)paren
)paren
(brace
multiline_comment|/* See note below on the Znyx 315 etherarray. */
r_static
r_int
r_char
id|last_phys_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x00
comma
l_char|&squot;L&squot;
comma
l_char|&squot;i&squot;
comma
l_char|&squot;n&squot;
comma
l_char|&squot;u&squot;
comma
l_char|&squot;x&squot;
)brace
suffix:semicolon
r_static
r_int
id|last_irq
suffix:semicolon
r_char
id|detect_mesg
(braket
l_int|80
)braket
comma
op_star
id|mesgp
op_assign
id|detect_mesg
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|sum
comma
id|bitsum
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|TULIP_TOTAL_SIZE
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tulip_hwinit: region already allocated at %#3lx.&bslash;n&quot;
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|mesgp
op_add_assign
id|sprintf
c_func
(paren
id|mesgp
comma
l_string|&quot;(DEC 21%d4%d Tulip&quot;
comma
id|device_id
op_eq
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
id|device_id
op_eq
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|tio_write
c_func
(paren
id|tio_read
c_func
(paren
id|CSR6
)paren
op_amp
op_complement
id|TCMOD_TRxSTART
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Clear the missed-packet counter. */
id|i
op_assign
id|tio_read
c_func
(paren
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|device_id
op_eq
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
op_logical_and
(paren
id|tio_read
c_func
(paren
id|CSR9
)paren
op_amp
l_int|0x8000
)paren
)paren
(brace
id|mesgp
op_add_assign
id|sprintf
c_func
(paren
id|mesgp
comma
l_string|&quot; treat as 21040&quot;
)paren
suffix:semicolon
id|device_id
op_assign
id|PCI_DEVICE_ID_DEC_TULIP
suffix:semicolon
)brace
multiline_comment|/* The station address ROM is read byte serially.  The register must&n;&t;   be polled, waiting for the value to be read bit serially from the&n;&t;   EEPROM.&n;&t;   */
id|sum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|device_id
op_eq
id|PCI_DEVICE_ID_DEC_TULIP
)paren
(brace
id|tio_write
c_func
(paren
l_int|0
comma
id|CSR9
)paren
suffix:semicolon
multiline_comment|/* Reset the pointer with a dummy write. */
id|bitsum
op_assign
l_int|0xff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|value
comma
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
r_do
id|value
op_assign
id|tio_read
c_func
(paren
id|CSR9
)paren
suffix:semicolon
r_while
c_loop
(paren
id|value
template_param
l_int|0
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|value
suffix:semicolon
id|sum
op_add_assign
id|value
op_amp
l_int|0xFF
suffix:semicolon
id|bitsum
op_and_assign
id|value
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Must be a 21140/21041, with a serial EEPROM interface. */
r_struct
id|eeprom
id|eep
suffix:semicolon
id|u_char
op_star
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
op_amp
id|eep
)paren
OL
l_int|0
)paren
(brace
id|addr
op_assign
id|eep.ng_addr
suffix:semicolon
multiline_comment|/* broken EEPROM structure */
)brace
r_else
(brace
id|addr
op_assign
id|eep.ok_addr
suffix:semicolon
multiline_comment|/* DEC EtherWorks */
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sum
op_add_assign
id|addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|addr
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Make certain the data structures are quadword aligned. */
id|mesgp
op_add_assign
id|sprintf
c_func
(paren
id|mesgp
comma
l_string|&quot;) at %016lx, &quot;
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* On the Zynx 315 etherarray boards only the first Tulip has an EEPROM.&n;&t;   The addresses of the subsequent ports are derived from the first. */
r_if
c_cond
(paren
id|sum
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
op_plus
l_int|1
suffix:semicolon
id|irq
op_assign
id|last_irq
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
id|mesgp
op_add_assign
id|sprintf
c_func
(paren
id|mesgp
comma
l_string|&quot;%2.2x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|mesgp
op_add_assign
id|sprintf
c_func
(paren
id|mesgp
comma
l_string|&quot;%2.2x, IRQ %d&bslash;n&quot;
comma
id|last_phys_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|irq
)paren
suffix:semicolon
id|last_irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* copy ethernet address */
r_if
c_cond
(paren
id|card_type
c_func
(paren
id|tp
comma
id|device_id
comma
id|htonl
c_func
(paren
(paren
op_star
(paren
r_int
op_star
)paren
id|dev-&gt;dev_addr
)paren
op_amp
l_int|0xFFFFFF
)paren
)paren
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
id|last_phys_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* We do a request_region() only to register /proc/ioports info. */
id|request_region
c_func
(paren
id|ioaddr
comma
id|TULIP_TOTAL_SIZE
comma
id|tp-&gt;signature
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* The Tulip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|tulip_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|tulip_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|tulip_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|tulip_get_stats
suffix:semicolon
id|dev-&gt;set_config
op_assign
op_amp
id|tulip_config
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast_list
suffix:semicolon
macro_line|#ifdef&t;MODULE
r_if
c_cond
(paren
id|if_port
op_eq
id|TULIP_AUTO_PORT
)paren
id|if_port
op_assign
id|TULIP_PORT
suffix:semicolon
r_else
id|tp-&gt;port_fix
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|if_port
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
id|full_duplex
suffix:semicolon
id|tp-&gt;next_module
op_assign
id|root_tulip_dev
suffix:semicolon
id|root_tulip_dev
op_assign
id|dev
suffix:semicolon
macro_line|#else
macro_line|#ifdef TULIP_FULL_DUPLEX
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|dev-&gt;if_port
op_assign
id|TULIP_PORT
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;TULIP_FIX_PORT
id|tp-&gt;port_fix
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;%s: %s %s&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;signature
comma
id|detect_mesg
)paren
suffix:semicolon
multiline_comment|/* Reset the xcvr interface and turn on heartbeat. */
id|tio_write
c_func
(paren
id|TSIAC_RESET
comma
id|CSR13
)paren
suffix:semicolon
id|tio_write
c_func
(paren
id|TSIAC_CONFIG
comma
id|CSR13
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|tulip_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
)paren
(brace
r_static
r_struct
id|device
op_star
id|tulip_head
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef __sparc_v9__
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
macro_line|#else
id|u_char
id|btmp
suffix:semicolon
id|u_int
id|itmp
suffix:semicolon
macro_line|#endif
id|u_char
id|pci_bus
comma
id|pci_device_fn
comma
id|pci_latency
suffix:semicolon
id|u_int
id|pci_irq
suffix:semicolon
r_int
r_int
id|pci_ioaddr
suffix:semicolon
id|u_short
id|pci_command
comma
id|vendor_id
comma
id|device_id
suffix:semicolon
id|u_int
id|pci_chips
(braket
)braket
op_assign
(brace
id|PCI_DEVICE_ID_DEC_TULIP
comma
id|PCI_DEVICE_ID_DEC_TULIP_FAST
comma
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
comma
id|PCI_DEVICE_ID_NONE
)brace
suffix:semicolon
r_int
id|num
op_assign
l_int|0
comma
id|cno
suffix:semicolon
r_static
r_int
id|pci_index
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|pci_index
OL
l_int|0xff
suffix:semicolon
id|pci_index
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pcibios_find_class
c_func
(paren
id|PCI_CLASS_NETWORK_ETHERNET
op_lshift
l_int|8
comma
id|pci_index
comma
op_amp
id|pci_bus
comma
op_amp
id|pci_device_fn
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_break
suffix:semicolon
macro_line|#ifdef __sparc_v9__
r_for
c_loop
(paren
id|pdev
op_assign
id|pci_devices
suffix:semicolon
id|pdev
suffix:semicolon
id|pdev
op_assign
id|pdev-&gt;next
)paren
r_if
c_cond
(paren
id|pdev-&gt;bus-&gt;number
op_eq
id|pci_bus
op_logical_and
id|pdev-&gt;devfn
op_eq
id|pci_device_fn
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;tulip: Cannot find pci_dev for [%x:%x]&bslash;n&quot;
comma
id|pci_bus
comma
id|pci_device_fn
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* get vendor id */
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_VENDOR_ID
comma
op_amp
id|vendor_id
)paren
suffix:semicolon
multiline_comment|/* get device id */
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_DEVICE_ID
comma
op_amp
id|device_id
)paren
suffix:semicolon
macro_line|#ifndef __sparc_v9__
multiline_comment|/* get IO address */
id|pcibios_read_config_dword
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_BASE_ADDRESS_0
comma
op_amp
id|itmp
)paren
suffix:semicolon
id|pci_ioaddr
op_assign
id|itmp
suffix:semicolon
multiline_comment|/* get IRQ */
id|pcibios_read_config_byte
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_INTERRUPT_LINE
comma
op_amp
id|btmp
)paren
suffix:semicolon
id|pci_irq
op_assign
id|btmp
suffix:semicolon
macro_line|#else
multiline_comment|/* get IO address */
id|pci_ioaddr
op_assign
id|pdev-&gt;base_address
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* get IRQ */
id|pci_irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
macro_line|#endif
multiline_comment|/* Remove I/O space marker in bit 0. */
id|pci_ioaddr
op_and_assign
op_complement
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|vendor_id
op_ne
id|PCI_VENDOR_ID_DEC
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|cno
op_assign
l_int|0
suffix:semicolon
id|pci_chips
(braket
id|cno
)braket
op_ne
id|PCI_DEVICE_ID_NONE
suffix:semicolon
id|cno
op_increment
)paren
r_if
c_cond
(paren
id|device_id
op_eq
id|pci_chips
(braket
id|cno
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|pci_chips
(braket
id|cno
)braket
op_eq
id|PCI_DEVICE_ID_NONE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Unknown Digital PCI ethernet chip type %4.4x detected:&quot;
l_string|&quot; not configured.&bslash;n&quot;
comma
id|device_id
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
id|ROUND_UP
c_func
(paren
r_sizeof
(paren
r_struct
id|device
)paren
op_plus
r_sizeof
(paren
r_struct
id|tulip_private
)paren
op_plus
id|ETHNAMSIZ
comma
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tulip_head
)paren
(brace
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
id|tulip_head
op_assign
id|dev
suffix:semicolon
)brace
multiline_comment|/* Get and check the bus-master and latency values. */
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_command
op_amp
id|PCI_COMMAND_MASTER
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  PCI Master Bit has not been set!&quot;
l_string|&quot; Setting...&bslash;n&quot;
)paren
suffix:semicolon
id|pci_command
op_or_assign
id|PCI_COMMAND_MASTER
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
suffix:semicolon
)brace
id|pcibios_read_config_byte
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|pci_latency
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_latency
OL
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  PCI latency timer (CFLT) is&quot;
l_string|&quot; unreasonably low at %d.&quot;
l_string|&quot;  Setting to 100 clocks.&bslash;n&quot;
comma
id|pci_latency
)paren
suffix:semicolon
id|pcibios_write_config_byte
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_LATENCY_TIMER
comma
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tulip_hwinit
c_func
(paren
id|dev
comma
id|pci_ioaddr
comma
id|pci_irq
comma
id|pci_chips
(braket
id|cno
)braket
)paren
OL
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
id|num
op_increment
suffix:semicolon
macro_line|#ifdef&t;TULIP_MAX_CARDS
r_if
c_cond
(paren
id|num
op_ge
id|TULIP_MAX_CARDS
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_return
id|num
OG
l_int|0
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/* The parameters that may be passed in... */
multiline_comment|/* This driver does nothing with options yet.  It will later be used to&n;   pass the full-duplex flag, etc. */
DECL|variable|debug
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
id|root_tulip_dev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|tulip_probe
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|device
op_star
id|next_dev
suffix:semicolon
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
r_while
c_loop
(paren
id|root_tulip_dev
)paren
(brace
id|next_dev
op_assign
(paren
(paren
r_struct
id|tulip_private
op_star
)paren
id|root_tulip_dev-&gt;priv
)paren
op_member_access_from_pointer
id|next_module
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|root_tulip_dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|root_tulip_dev-&gt;base_addr
comma
id|TULIP_TOTAL_SIZE
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|root_tulip_dev
)paren
suffix:semicolon
id|root_tulip_dev
op_assign
id|next_dev
suffix:semicolon
)brace
)brace
macro_line|#endif /* MODULE */
"&f;"
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -D__KERNEL__ -I/usr/src/linux/net/inet -Wall -Wstrict-prototypes -O6 -m486 -c tulip.c&quot;&n; *  c-indent-level: 4&n; *  tab-width: 4&n; * End:&n; */
eof
