multiline_comment|/* 82596.c: A generic 82596 ethernet driver for linux. */
multiline_comment|/*&n;   Based on Apricot.c&n;   Written 1994 by Mark Evans.&n;   This driver is for the Apricot 82596 bus-master interface&n;&n;   Modularised 12/94 Mark Evans&n;&n;&n;   Modified to support the 82596 ethernet chips on 680x0 VME boards.&n;   by Richard Hirst &lt;richard@sleepie.demon.co.uk&gt;&n;   Renamed to be 82596.c&n;&n;   *** Untested on Apricot hardware, and may require some hacking&n;   *** to make it work.  The old 82596.c reported hasn&squot;t worked&n;   *** since 1.3.xx anyway.  I have been unable to find any users&n;   *** of Apricot hardware to test this on.&n;&n;   Most of my modifications relate to the braindead big-endian&n;   implementation by Intel.  When the i596 is operating in&n;   &squot;big-endian&squot; mode, it thinks a 32 bit value of 0x12345678&n;   should be stored as 0x56781234.  This is a real pain, when&n;   you have linked lists which are shared by the 680x0 and the&n;   i596.&n;&n;   Driver skeleton&n;   Written 1993 by Donald Becker.&n;   Copyright 1993 United States Government as represented by the Director,&n;   National Security Agency. This software may only be used and distributed&n;   according to the terms of the GNU Public License as modified by SRC,&n;   incorporated herein by reference.&n;&n;   The author may be reached as becker@super.org or&n;   C/O Supercomputing Research Ctr., 17100 Science Dr., Bowie MD 20715&n;&n; */
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;82596.c:v1.0 15/07/98&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;&t;/*?? */
macro_line|#ifdef CONFIG_MVME16x_NET
macro_line|#include &lt;asm/mvme16xhw.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
macro_line|#include &lt;asm/bvme6000hw.h&gt;
macro_line|#endif
multiline_comment|/*&n; * Define various macros for Channel Attention, word swapping etc., dependent&n; * on architecture.  MVME and BVME are 680x0 based, otherwise it is Intel.&n; */
macro_line|#ifdef __mc68000__
DECL|macro|WSWAPrfd
mdefine_line|#define WSWAPrfd(x)  ((struct i596_rfd *) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPrbd
mdefine_line|#define WSWAPrbd(x)  ((struct i596_rbd *) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPiscp
mdefine_line|#define WSWAPiscp(x) ((struct i596_iscp *)(((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPscb
mdefine_line|#define WSWAPscb(x)  ((struct i596_scb *) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPcmd
mdefine_line|#define WSWAPcmd(x)  ((struct i596_cmd *) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPtbd
mdefine_line|#define WSWAPtbd(x)  ((struct i596_tbd *) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|WSWAPchar
mdefine_line|#define WSWAPchar(x) ((char *)            (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16)))
DECL|macro|ISCP_BUSY
mdefine_line|#define ISCP_BUSY&t;0x00010000
DECL|macro|MACH_IS_APRICOT
mdefine_line|#define MACH_IS_APRICOT&t;0
macro_line|#else
DECL|macro|WSWAPrfd
mdefine_line|#define WSWAPrfd(x)&t;x
DECL|macro|WSWAPiscp
mdefine_line|#define WSWAPiscp(x)&t;((struct i596_iscp *)(x))
DECL|macro|WSWAPscb
mdefine_line|#define WSWAPscb(x)&t;((struct i596_scb *)(x))
DECL|macro|WSWAPcmd
mdefine_line|#define WSWAPcmd(x)&t;x
DECL|macro|WSWAPtbd
mdefine_line|#define WSWAPtbd(x)&t;x
DECL|macro|WSWAPchar
mdefine_line|#define WSWAPchar(x)&t;x
DECL|macro|ISCP_BUSY
mdefine_line|#define ISCP_BUSY&t;0x0001
DECL|macro|MACH_IS_APRICOT
mdefine_line|#define MACH_IS_APRICOT&t;1
macro_line|#endif
multiline_comment|/*&n; * The MPU_PORT command allows direct access to the 82596. With PORT access&n; * the following commands are available (p5-18). The 32-bit port command&n; * must be word-swapped with the most significant word written first.&n; * This only applies to VME boards.&n; */
DECL|macro|PORT_RESET
mdefine_line|#define PORT_RESET&t;&t;0x00&t;/* reset 82596 */
DECL|macro|PORT_SELFTEST
mdefine_line|#define PORT_SELFTEST&t;&t;0x01&t;/* selftest */
DECL|macro|PORT_ALTSCP
mdefine_line|#define PORT_ALTSCP&t;&t;0x02&t;/* alternate SCB address */
DECL|macro|PORT_ALTDUMP
mdefine_line|#define PORT_ALTDUMP&t;&t;0x03&t;/* Alternate DUMP address */
macro_line|#ifndef HAVE_PORTRESERVE
DECL|macro|check_region
mdefine_line|#define check_region(addr, size)&t;0
DECL|macro|request_region
mdefine_line|#define request_region(addr, size,name)&t;do ; while(0)
macro_line|#endif
macro_line|#ifndef HAVE_ALLOC_SKB
DECL|macro|alloc_skb
mdefine_line|#define alloc_skb(size, priority) (struct sk_buff *) kmalloc(size,priority)
DECL|macro|kfree_skbmem
mdefine_line|#define kfree_skbmem(buff, size) kfree_s(buff,size)
macro_line|#endif
DECL|macro|APRICOT_DEBUG
mdefine_line|#define APRICOT_DEBUG 2
macro_line|#ifdef APRICOT_DEBUG
DECL|variable|i596_debug
r_int
id|i596_debug
op_assign
id|APRICOT_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|i596_debug
r_int
id|i596_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
DECL|macro|I596_TOTAL_SIZE
mdefine_line|#define I596_TOTAL_SIZE 17
DECL|macro|I596_NULL
mdefine_line|#define I596_NULL -1
DECL|macro|CMD_EOL
mdefine_line|#define CMD_EOL&t;&t;0x8000&t;/* The last command of the list, stop. */
DECL|macro|CMD_SUSP
mdefine_line|#define CMD_SUSP&t;0x4000&t;/* Suspend after doing cmd. */
DECL|macro|CMD_INTR
mdefine_line|#define CMD_INTR&t;0x2000&t;/* Interrupt after doing cmd. */
DECL|macro|CMD_FLEX
mdefine_line|#define CMD_FLEX&t;0x0008&t;/* Enable flexible memory model */
DECL|enum|commands
r_enum
id|commands
(brace
DECL|enumerator|CmdNOp
DECL|enumerator|CmdSASetup
DECL|enumerator|CmdConfigure
DECL|enumerator|CmdMulticastList
id|CmdNOp
op_assign
l_int|0
comma
id|CmdSASetup
op_assign
l_int|1
comma
id|CmdConfigure
op_assign
l_int|2
comma
id|CmdMulticastList
op_assign
l_int|3
comma
DECL|enumerator|CmdTx
DECL|enumerator|CmdTDR
DECL|enumerator|CmdDump
DECL|enumerator|CmdDiagnose
id|CmdTx
op_assign
l_int|4
comma
id|CmdTDR
op_assign
l_int|5
comma
id|CmdDump
op_assign
l_int|6
comma
id|CmdDiagnose
op_assign
l_int|7
)brace
suffix:semicolon
DECL|macro|STAT_C
mdefine_line|#define STAT_C&t;&t;0x8000&t;/* Set to 0 after execution */
DECL|macro|STAT_B
mdefine_line|#define STAT_B&t;&t;0x4000&t;/* Command being executed */
DECL|macro|STAT_OK
mdefine_line|#define STAT_OK&t;&t;0x2000&t;/* Command executed ok */
DECL|macro|STAT_A
mdefine_line|#define STAT_A&t;&t;0x1000&t;/* Command aborted */
DECL|macro|CUC_START
mdefine_line|#define&t; CUC_START&t;0x0100
DECL|macro|CUC_RESUME
mdefine_line|#define&t; CUC_RESUME&t;0x0200
DECL|macro|CUC_SUSPEND
mdefine_line|#define&t; CUC_SUSPEND    0x0300
DECL|macro|CUC_ABORT
mdefine_line|#define&t; CUC_ABORT&t;0x0400
DECL|macro|RX_START
mdefine_line|#define&t; RX_START&t;0x0010
DECL|macro|RX_RESUME
mdefine_line|#define&t; RX_RESUME&t;0x0020
DECL|macro|RX_SUSPEND
mdefine_line|#define&t; RX_SUSPEND&t;0x0030
DECL|macro|RX_ABORT
mdefine_line|#define&t; RX_ABORT&t;0x0040
DECL|struct|i596_reg
r_struct
id|i596_reg
(brace
DECL|member|porthi
r_int
r_int
id|porthi
suffix:semicolon
DECL|member|portlo
r_int
r_int
id|portlo
suffix:semicolon
DECL|member|ca
r_int
r_int
id|ca
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_cmd
r_struct
id|i596_cmd
(brace
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
DECL|member|next
r_struct
id|i596_cmd
op_star
id|next
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|EOF
mdefine_line|#define EOF&t;&t;0x8000
DECL|macro|SIZE_MASK
mdefine_line|#define SIZE_MASK&t;0x3fff
DECL|struct|i596_tbd
r_struct
id|i596_tbd
(brace
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|next
r_struct
id|i596_tbd
op_star
id|next
suffix:semicolon
DECL|member|data
r_char
op_star
id|data
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|tx_cmd
r_struct
id|tx_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|tbd
r_struct
id|i596_tbd
op_star
id|tbd
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* So we can free it after tx */
)brace
suffix:semicolon
DECL|struct|i596_rfd
r_struct
id|i596_rfd
(brace
DECL|member|stat
r_int
r_int
id|stat
suffix:semicolon
DECL|member|cmd
r_int
r_int
id|cmd
suffix:semicolon
DECL|member|next
r_struct
id|i596_rfd
op_star
id|next
suffix:semicolon
DECL|member|rbd
r_int
id|rbd
suffix:semicolon
DECL|member|count
r_int
r_int
id|count
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|1532
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE 16
DECL|struct|i596_scb
r_struct
id|i596_scb
(brace
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
DECL|member|cmd
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
DECL|member|rfd
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
DECL|member|crc_err
r_int
r_int
id|crc_err
suffix:semicolon
DECL|member|align_err
r_int
r_int
id|align_err
suffix:semicolon
DECL|member|resource_err
r_int
r_int
id|resource_err
suffix:semicolon
DECL|member|over_err
r_int
r_int
id|over_err
suffix:semicolon
DECL|member|rcvdt_err
r_int
r_int
id|rcvdt_err
suffix:semicolon
DECL|member|short_err
r_int
r_int
id|short_err
suffix:semicolon
DECL|member|t_on
r_int
r_int
id|t_on
suffix:semicolon
DECL|member|t_off
r_int
r_int
id|t_off
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_iscp
r_struct
id|i596_iscp
(brace
DECL|member|stat
r_int
r_int
id|stat
suffix:semicolon
DECL|member|scb
r_struct
id|i596_scb
op_star
id|scb
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_scp
r_struct
id|i596_scp
(brace
DECL|member|sysbus
r_int
r_int
id|sysbus
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|iscp
r_struct
id|i596_iscp
op_star
id|iscp
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_private
r_struct
id|i596_private
(brace
DECL|member|scp
r_volatile
r_struct
id|i596_scp
id|scp
suffix:semicolon
DECL|member|iscp
r_volatile
r_struct
id|i596_iscp
id|iscp
suffix:semicolon
DECL|member|scb
r_volatile
r_struct
id|i596_scb
id|scb
suffix:semicolon
DECL|member|set_add
r_struct
id|i596_cmd
id|set_add
suffix:semicolon
DECL|member|eth_addr
r_char
id|eth_addr
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|set_conf
r_struct
id|i596_cmd
id|set_conf
suffix:semicolon
DECL|member|i596_config
r_char
id|i596_config
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|tdr
r_struct
id|i596_cmd
id|tdr
suffix:semicolon
DECL|member|stat
r_int
r_int
id|stat
suffix:semicolon
DECL|member|last_restart
r_int
id|last_restart
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|4
)paren
)paren
)paren
suffix:semicolon
DECL|member|rx_tail
r_struct
id|i596_rfd
op_star
id|rx_tail
suffix:semicolon
DECL|member|cmd_tail
r_struct
id|i596_cmd
op_star
id|cmd_tail
suffix:semicolon
DECL|member|cmd_head
r_struct
id|i596_cmd
op_star
id|cmd_head
suffix:semicolon
DECL|member|cmd_backlog
r_int
id|cmd_backlog
suffix:semicolon
DECL|member|last_cmd
r_int
r_int
id|last_cmd
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|init_setup
r_char
id|init_setup
(braket
)braket
op_assign
(brace
l_int|0x8E
comma
multiline_comment|/* length, prefetch on */
l_int|0xC8
comma
multiline_comment|/* fifo to 8, monitor off */
macro_line|#ifdef CONFIG_VME
l_int|0xc0
comma
multiline_comment|/* don&squot;t save bad frames */
macro_line|#else
l_int|0x80
comma
multiline_comment|/* don&squot;t save bad frames */
macro_line|#endif
l_int|0x2E
comma
multiline_comment|/* No source address insertion, 8 byte preamble */
l_int|0x00
comma
multiline_comment|/* priority and backoff defaults */
l_int|0x60
comma
multiline_comment|/* interframe spacing */
l_int|0x00
comma
multiline_comment|/* slot time LSB */
l_int|0xf2
comma
multiline_comment|/* slot time and retries */
l_int|0x00
comma
multiline_comment|/* promiscuous mode */
l_int|0x00
comma
multiline_comment|/* collision detect */
l_int|0x40
comma
multiline_comment|/* minimum frame length */
l_int|0xff
comma
l_int|0x00
comma
l_int|0x7f
multiline_comment|/*  *multi IA */
)brace
suffix:semicolon
r_static
r_int
id|i596_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|i596_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|i596_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|print_eth
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|ticks_limit
r_static
r_int
id|ticks_limit
op_assign
l_int|25
suffix:semicolon
DECL|variable|max_cmd_backlog
r_static
r_int
id|max_cmd_backlog
op_assign
l_int|16
suffix:semicolon
"&f;"
DECL|function|CA
r_static
r_inline
r_void
id|CA
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
(paren
(paren
r_struct
id|i596_reg
op_star
)paren
id|dev-&gt;base_addr
)paren
op_member_access_from_pointer
id|ca
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
id|u32
id|i
op_assign
op_star
(paren
r_volatile
id|u32
op_star
)paren
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_APRICOT_i596
r_if
c_cond
(paren
id|MACH_IS_APRICOT
)paren
(brace
id|outw
c_func
(paren
l_int|0
comma
(paren
r_int
)paren
(paren
id|dev-&gt;base_addr
)paren
op_plus
l_int|4
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|MPU_PORT
r_static
r_inline
r_void
id|MPU_PORT
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|c
comma
r_volatile
r_void
op_star
id|x
)paren
(brace
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_struct
id|i596_reg
op_star
id|p
op_assign
(paren
r_struct
id|i596_reg
op_star
)paren
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|p-&gt;porthi
op_assign
(paren
(paren
id|c
)paren
op_or
(paren
id|u32
)paren
(paren
id|x
)paren
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|p-&gt;portlo
op_assign
(paren
(paren
id|c
)paren
op_or
(paren
id|u32
)paren
(paren
id|x
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
id|u32
id|v
op_assign
(paren
id|u32
)paren
(paren
id|c
)paren
op_or
(paren
id|u32
)paren
(paren
id|x
)paren
suffix:semicolon
id|v
op_assign
(paren
(paren
id|u32
)paren
(paren
id|v
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
(paren
id|v
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
op_star
(paren
r_volatile
id|u32
op_star
)paren
id|dev-&gt;base_addr
op_assign
id|v
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
op_star
(paren
r_volatile
id|u32
op_star
)paren
id|dev-&gt;base_addr
op_assign
id|v
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#if defined(CONFIG_MVME16x_NET) || defined(CONFIG_BVME6000_NET)
DECL|function|i596_error
r_static
r_void
id|i596_error
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;i596_error: lp = 0x%08x&bslash;n&quot;
comma
(paren
id|u32
)paren
id|lp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scp at %08x, .sysbus = %08x, .iscp = %08x&bslash;n&quot;
comma
(paren
id|u32
)paren
op_amp
id|lp-&gt;scp
comma
(paren
id|u32
)paren
id|lp-&gt;scp.sysbus
comma
(paren
id|u32
)paren
id|lp-&gt;scp.iscp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;iscp at %08x, .stat = %08x, .scb = %08x&bslash;n&quot;
comma
(paren
id|u32
)paren
op_amp
id|lp-&gt;iscp
comma
(paren
id|u32
)paren
id|lp-&gt;iscp.stat
comma
(paren
id|u32
)paren
id|lp-&gt;iscp.scb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scb at %08x, .status = %04x, .command = %04x&bslash;n&quot;
comma
(paren
id|u32
)paren
op_amp
id|lp-&gt;scb
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   .cmd = %08x, .rfd = %08x&bslash;n&quot;
comma
(paren
id|u32
)paren
id|lp-&gt;scb.cmd
comma
(paren
id|u32
)paren
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
id|cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;scb.cmd
)paren
suffix:semicolon
r_while
c_loop
(paren
id|cmd
op_logical_and
(paren
id|u32
)paren
id|cmd
OL
l_int|0x1000000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;cmd at %08x, .status = %04x, .command = %04x, .next = %08x&bslash;n&quot;
comma
(paren
id|u32
)paren
id|cmd
comma
id|cmd-&gt;status
comma
id|cmd-&gt;command
comma
(paren
id|u32
)paren
id|cmd-&gt;next
)paren
suffix:semicolon
id|cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|cmd-&gt;next
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|init_rx_bufs
r_static
r_inline
r_int
id|init_rx_bufs
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|num
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
(paren
r_struct
id|i596_rfd
op_star
)paren
id|I596_NULL
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: init_rx_bufs %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|num
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rfd
op_assign
(paren
r_struct
id|i596_rfd
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_break
suffix:semicolon
id|rfd-&gt;stat
op_assign
l_int|0x0000
suffix:semicolon
id|rfd-&gt;rbd
op_assign
id|I596_NULL
suffix:semicolon
id|rfd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;size
op_assign
l_int|1532
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
suffix:semicolon
id|lp-&gt;rx_tail
op_assign
id|rfd
suffix:semicolon
)brace
r_else
id|rfd-&gt;cmd
op_assign
l_int|0x0000
suffix:semicolon
id|rfd-&gt;next
op_assign
id|lp-&gt;scb.rfd
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|rfd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
l_int|0
)paren
id|lp-&gt;rx_tail-&gt;next
op_assign
id|lp-&gt;scb.rfd
suffix:semicolon
r_return
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|function|remove_rx_bufs
r_static
r_inline
r_void
id|remove_rx_bufs
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
id|lp-&gt;rx_tail-&gt;next
op_assign
(paren
r_struct
id|i596_rfd
op_star
)paren
id|I596_NULL
suffix:semicolon
r_do
(brace
id|lp-&gt;scb.rfd
op_assign
id|rfd-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|rfd
)paren
suffix:semicolon
id|rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rfd
op_ne
id|lp-&gt;rx_tail
)paren
suffix:semicolon
)brace
DECL|function|init_i596_mem
r_static
r_inline
r_void
id|init_i596_mem
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#if !defined(CONFIG_MVME16x_NET) &amp;&amp; !defined(CONFIG_BVME6000_NET)
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
macro_line|#endif
r_int
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#if defined(CONFIG_MVME16x_NET) || defined(CONFIG_BVME6000_NET)
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_volatile
r_int
r_char
op_star
id|pcc2
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0xfff42000
suffix:semicolon
multiline_comment|/* Disable all ints for now */
id|pcc2
(braket
l_int|0x28
)braket
op_assign
l_int|1
suffix:semicolon
id|pcc2
(braket
l_int|0x2a
)braket
op_assign
l_int|0x40
suffix:semicolon
id|pcc2
(braket
l_int|0x2b
)braket
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* Set snooping bits now! */
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
r_int
r_char
op_star
id|ethirq
op_assign
(paren
r_int
r_char
op_star
)paren
id|BVME_ETHIRQ_REG
suffix:semicolon
op_star
id|ethirq
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|MPU_PORT
c_func
(paren
id|dev
comma
id|PORT_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Wait 100us - seems to help */
multiline_comment|/* change the scp address */
id|MPU_PORT
c_func
(paren
id|dev
comma
id|PORT_ALTSCP
comma
op_amp
id|lp-&gt;scp
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* change the scp address */
id|outw
c_func
(paren
l_int|0
comma
id|ioaddr
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0
comma
id|ioaddr
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|4
comma
id|ioaddr
op_plus
l_int|0xf
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
(paren
(paren
r_int
)paren
op_amp
id|lp-&gt;scp
)paren
op_amp
l_int|0xffff
)paren
op_or
l_int|2
)paren
comma
id|ioaddr
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
(paren
r_int
)paren
op_amp
id|lp-&gt;scp
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|ioaddr
)paren
suffix:semicolon
macro_line|#endif
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
id|lp-&gt;scp.sysbus
op_assign
l_int|0x00000054
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
id|lp-&gt;scp.sysbus
op_assign
l_int|0x0000004c
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_APRICOT_i596
r_if
c_cond
(paren
id|MACH_IS_APRICOT
)paren
id|lp-&gt;scp.sysbus
op_assign
l_int|0x00440000
suffix:semicolon
macro_line|#endif
id|lp-&gt;scp.iscp
op_assign
id|WSWAPiscp
c_func
(paren
op_amp
(paren
id|lp-&gt;iscp
)paren
)paren
suffix:semicolon
id|lp-&gt;iscp.scb
op_assign
id|WSWAPscb
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
)paren
suffix:semicolon
id|lp-&gt;iscp.stat
op_assign
id|ISCP_BUSY
suffix:semicolon
id|lp-&gt;cmd_backlog
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|lp-&gt;scb.cmd
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: starting i82596.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#if !defined(CONFIG_MVME16x_NET) &amp;&amp; !defined(CONFIG_BVME6000_NET)
(paren
r_void
)paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|4
comma
id|ioaddr
op_plus
l_int|0xf
)paren
suffix:semicolon
macro_line|#endif
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;iscp.stat
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i82596 initialization timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_volatile
r_int
r_char
op_star
id|pcc2
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0xfff42000
suffix:semicolon
multiline_comment|/* Enable ints, etc. now */
id|pcc2
(braket
l_int|0x2a
)braket
op_assign
l_int|0x08
suffix:semicolon
id|pcc2
(braket
l_int|0x2a
)braket
op_assign
l_int|0x55
suffix:semicolon
multiline_comment|/* Edge sensitive */
id|pcc2
(braket
l_int|0x2b
)braket
op_assign
l_int|0x55
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
r_int
r_char
op_star
id|ethirq
op_assign
(paren
r_int
r_char
op_star
)paren
id|BVME_ETHIRQ_REG
suffix:semicolon
op_star
id|ethirq
op_assign
l_int|3
suffix:semicolon
)brace
macro_line|#endif
id|memcpy
c_func
(paren
id|lp-&gt;i596_config
comma
id|init_setup
comma
l_int|14
)paren
suffix:semicolon
id|lp-&gt;set_conf.command
op_assign
id|CmdConfigure
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;set_conf
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|lp-&gt;eth_addr
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|lp-&gt;set_add.command
op_assign
id|CmdSASetup
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;set_add
)paren
suffix:semicolon
id|lp-&gt;tdr.command
op_assign
id|CmdTDR
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;tdr
)paren
suffix:semicolon
id|boguscnt
op_assign
l_int|200000
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: receive unit start timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.command
op_assign
id|RX_START
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|boguscnt
op_assign
l_int|2000
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i82596 init timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|i596_rx
r_static
r_inline
r_int
id|i596_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_int
id|frames
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;i596_rx()&bslash;n&quot;
)paren
suffix:semicolon
id|rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
multiline_comment|/* Reference next frame descriptor to check */
r_while
c_loop
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
id|STAT_C
)paren
(brace
multiline_comment|/* Loop while we have complete frames */
r_if
c_cond
(paren
id|i596_debug
OG
l_int|2
)paren
id|print_eth
c_func
(paren
id|rfd-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
id|STAT_OK
)paren
(brace
multiline_comment|/* a good frame */
r_int
id|pkt_len
op_assign
id|rfd-&gt;count
op_amp
l_int|0x3fff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
suffix:semicolon
id|frames
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596_rx Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|rfd-&gt;data
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
)brace
r_else
(brace
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0001
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0080
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0100
)paren
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0200
)paren
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0400
)paren
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0800
)paren
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x1000
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
multiline_comment|/* Clear the buffer descriptor count and EOF + F flags */
id|rfd-&gt;stat
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
suffix:semicolon
id|lp-&gt;rx_tail-&gt;cmd
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;rx_tail
op_assign
id|rfd
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|rfd-&gt;next
suffix:semicolon
id|rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
multiline_comment|/* Next frame descriptor to check */
)brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;frames %d&bslash;n&quot;
comma
id|frames
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_cleanup_cmd
r_static
r_inline
r_void
id|i596_cleanup_cmd
c_func
(paren
r_struct
id|i596_private
op_star
id|lp
)paren
(brace
r_struct
id|i596_cmd
op_star
id|ptr
suffix:semicolon
r_int
id|boguscnt
op_assign
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;i596_cleanup_cmd&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;cmd_head
op_ne
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
)paren
(brace
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;cmd_head-&gt;next
)paren
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|ptr-&gt;command
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tx_cmd-&gt;skb
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
id|tx_cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CmdMulticastList
suffix:colon
(brace
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_cleanup_cmd timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;cmd_head
)paren
suffix:semicolon
)brace
DECL|function|i596_reset
r_static
r_inline
r_void
id|i596_reset
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|i596_private
op_star
id|lp
comma
r_int
id|ioaddr
)paren
(brace
r_int
id|boguscnt
op_assign
l_int|1000
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;i596_reset&bslash;n&quot;
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_reset timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_ABORT
op_or
id|RX_ABORT
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* wait for shutdown */
id|boguscnt
op_assign
l_int|4000
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_reset 2 timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|lp
)paren
suffix:semicolon
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|init_i596_mem
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|i596_add_cmd
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|boguscnt
op_assign
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;i596_add_cmd&bslash;n&quot;
)paren
suffix:semicolon
id|cmd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;command
op_or_assign
(paren
id|CMD_EOL
op_or
id|CMD_INTR
)paren
suffix:semicolon
id|cmd-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * RGH  300597:  Looks to me like there could be a race condition&n;&t; * here.  Just because we havn&squot;t picked up all the command items&n;&t; * yet, doesn&squot;t mean that the 82596 hasn&squot;t finished processing&n;&t; * them.  So, we may need to do a CUC_START anyway.&n;&t; * Maybe not.  If it interrupts saying the CU is idle when there&n;&t; * is still something in the cmd queue, the int handler with restart&n;&t; * the CU.&n;&t; */
r_if
c_cond
(paren
id|lp-&gt;cmd_head
op_ne
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
)paren
(brace
id|lp-&gt;cmd_tail-&gt;next
op_assign
id|WSWAPcmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;cmd_head
op_assign
id|cmd
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_add_cmd timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_START
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|lp-&gt;cmd_tail
op_assign
id|cmd
suffix:semicolon
id|lp-&gt;cmd_backlog
op_increment
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;scb.cmd
)paren
suffix:semicolon
multiline_comment|/* Is this redundant?  RGH 300597 */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cmd_backlog
OG
id|max_cmd_backlog
)paren
(brace
r_int
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|lp-&gt;last_cmd
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
id|ticks_limit
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: command unit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|i596_reset
c_func
(paren
id|dev
comma
id|lp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
)brace
DECL|function|i596_open
r_static
r_int
id|i596_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596_open() irq %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|i596_interrupt
comma
l_int|0
comma
l_string|&quot;apricot&quot;
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
l_int|0x56
comma
op_amp
id|i596_error
comma
l_int|0
comma
l_string|&quot;apricot_error&quot;
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|i
op_assign
id|init_rx_bufs
c_func
(paren
id|dev
comma
id|RX_RING_SIZE
)paren
)paren
OL
id|RX_RING_SIZE
)paren
id|printk
c_func
(paren
l_string|&quot;%s: only able to allocate %d receive buffers&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|4
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
multiline_comment|/* Initialize the 82596 memory */
id|init_i596_mem
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Always succeed */
)brace
DECL|function|i596_start_xmit
r_static
r_int
id|i596_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tx_cmd
op_star
id|tx_cmd
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%s: 82596 start xmit&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|5
)paren
r_return
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Try to restart the adaptor */
r_if
c_cond
(paren
id|lp-&gt;last_restart
op_eq
id|lp-&gt;stats.tx_packets
)paren
(brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;Resetting board.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Shutdown and restart */
id|i596_reset
c_func
(paren
id|dev
comma
id|lp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Issue a channel attention signal */
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;Kicking board.&bslash;n&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_START
op_or
id|RX_START
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;last_restart
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
)brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596_start_xmit() called&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Block a timer-based transmit from overlapping.  This could better be&n;&t;   done with atomic_swap(1, dev-&gt;tbusy), but set_bit() works as well. */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
r_int
id|length
op_assign
id|ETH_ZLEN
OL
id|skb-&gt;len
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|kmalloc
c_func
(paren
(paren
r_sizeof
(paren
r_struct
id|tx_cmd
)paren
op_plus
r_sizeof
(paren
r_struct
id|i596_tbd
)paren
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_cmd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596_xmit Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|i596_tbd
op_star
id|tbd
op_assign
(paren
r_struct
id|i596_tbd
op_star
)paren
(paren
id|tx_cmd
op_plus
l_int|1
)paren
suffix:semicolon
id|tx_cmd-&gt;tbd
op_assign
id|WSWAPtbd
c_func
(paren
id|tbd
)paren
suffix:semicolon
id|tbd-&gt;next
op_assign
(paren
r_struct
id|i596_tbd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|tx_cmd-&gt;cmd.command
op_assign
id|CMD_FLEX
op_or
id|CmdTx
suffix:semicolon
id|tx_cmd-&gt;skb
op_assign
id|skb
suffix:semicolon
id|tx_cmd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tx_cmd-&gt;size
op_assign
l_int|0
suffix:semicolon
id|tbd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tbd-&gt;size
op_assign
id|EOF
op_or
id|length
suffix:semicolon
id|tbd-&gt;data
op_assign
id|WSWAPchar
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|print_eth
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
(paren
r_struct
id|i596_cmd
op_star
)paren
id|tx_cmd
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|length
suffix:semicolon
)brace
)brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
DECL|function|print_eth
r_static
r_void
id|print_eth
c_func
(paren
r_char
op_star
id|add
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;print_eth(%08x)&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|add
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Dest  &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Source&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
op_plus
l_int|6
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;type %2.2X%2.2X&bslash;n&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|12
)braket
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|13
)braket
)paren
suffix:semicolon
)brace
DECL|function|i82596_probe
r_int
id|__init
id|i82596_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_char
id|eth_addr
(braket
l_int|6
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_static
r_int
id|probed
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mvme16x_config
op_amp
id|MVME16x_CONFIG_NO_ETHERNET
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Ethernet probe disabled - chip not present&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|probed
)paren
r_return
id|ENODEV
suffix:semicolon
id|probed
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
id|eth_addr
comma
(paren
r_void
op_star
)paren
l_int|0xfffc1f2c
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* YUCK! Get addr from NOVRAM */
id|dev-&gt;base_addr
op_assign
id|MVME_I596_BASE
suffix:semicolon
id|dev-&gt;irq
op_assign
(paren
r_int
)paren
id|MVME16x_IRQ_I596
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
r_int
r_char
op_star
id|rtc
op_assign
(paren
r_int
r_char
op_star
)paren
id|BVME_RTC_BASE
suffix:semicolon
r_int
r_char
id|msr
op_assign
id|rtc
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rtc
(braket
l_int|3
)braket
op_or_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|eth_addr
(braket
id|i
)braket
op_assign
id|rtc
(braket
id|i
op_star
l_int|4
op_plus
l_int|7
)braket
suffix:semicolon
multiline_comment|/* Stored in RTC RAM at offset 1 */
id|rtc
(braket
l_int|3
)braket
op_assign
id|msr
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|BVME_I596_BASE
suffix:semicolon
id|dev-&gt;irq
op_assign
(paren
r_int
)paren
id|BVME_IRQ_I596
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_APRICOT_INTEL
r_int
id|checksum
op_assign
l_int|0
suffix:semicolon
r_int
id|ioaddr
op_assign
l_int|0x300
suffix:semicolon
multiline_comment|/* this is easy the ethernet interface can only be at 0x300 */
multiline_comment|/* first check nothing is already registered here */
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|I596_TOTAL_SIZE
)paren
)paren
r_return
id|ENODEV
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eth_addr
(braket
id|i
)braket
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|8
op_plus
id|i
)paren
suffix:semicolon
id|checksum
op_add_assign
id|eth_addr
(braket
id|i
)braket
suffix:semicolon
)brace
multiline_comment|/* checksum is a multiple of 0x100, got this wrong first time&n;&t;   some machines have 0x100, some 0x200. The DOS driver doesn&squot;t&n;&t;   even bother with the checksum */
r_if
c_cond
(paren
id|checksum
op_mod
l_int|0x100
)paren
r_return
id|ENODEV
suffix:semicolon
multiline_comment|/* Some other boards trip the checksum.. but then appear as ether&n;&t;   address 0. Trap these - AC */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth_addr
comma
l_string|&quot;&bslash;x00&bslash;x00&bslash;x49&quot;
comma
l_int|3
)paren
op_ne
l_int|0
)paren
r_return
id|ENODEV
suffix:semicolon
id|request_region
c_func
(paren
id|ioaddr
comma
id|I596_TOTAL_SIZE
comma
l_string|&quot;i596&quot;
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|10
suffix:semicolon
macro_line|#endif
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: 82596 at %#3lx,&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|eth_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
multiline_comment|/* The APRICOT-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|i596_open
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|i596_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|i596_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|i596_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast_list
suffix:semicolon
id|dev-&gt;mem_start
op_assign
(paren
r_int
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_private
)paren
op_plus
l_int|0x0f
comma
id|GFP_KERNEL
)paren
suffix:semicolon
multiline_comment|/* align for scp */
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
id|dev-&gt;mem_start
op_plus
l_int|0xf
)paren
op_amp
l_int|0xfffffff0
)paren
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: lp at 0x%08lx, lp-&gt;scb at 0x%08lx&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|lp
comma
(paren
r_int
r_int
)paren
op_amp
id|lp-&gt;scb
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|lp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
(paren
r_struct
id|i596_rfd
op_star
)paren
id|I596_NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_interrupt
r_static
r_void
id|i596_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|boguscnt
op_assign
l_int|2000
suffix:semicolon
r_int
r_int
id|status
comma
id|ack_cmd
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
r_char
op_star
)paren
id|BVME_LOCAL_IRQ_STAT
op_amp
id|BVME_ETHERR
)paren
(brace
id|i596_error
c_func
(paren
id|BVME_IRQ_I596
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596_interrupt(): irq %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Re-entering the interrupt handler.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt, timeout status %4.4x command %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|status
op_assign
id|lp-&gt;scb.status
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|ack_cmd
op_assign
id|status
op_amp
l_int|0xf000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x8000
)paren
op_logical_or
(paren
id|status
op_amp
l_int|0x2000
)paren
)paren
(brace
r_struct
id|i596_cmd
op_star
id|ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i596_debug
OG
l_int|4
)paren
op_logical_and
(paren
id|status
op_amp
l_int|0x8000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt completed command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i596_debug
OG
l_int|4
)paren
op_logical_and
(paren
id|status
op_amp
l_int|0x2000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt command unit inactive %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x0700
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|lp-&gt;cmd_head
op_ne
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
)paren
op_logical_and
(paren
id|lp-&gt;cmd_head-&gt;status
op_amp
id|STAT_C
)paren
)paren
(brace
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;cmd_head-&gt;status = %04x, -&gt;command = %04x&bslash;n&quot;
comma
id|lp-&gt;cmd_head-&gt;status
comma
id|lp-&gt;cmd_head-&gt;command
)paren
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;cmd_head-&gt;next
)paren
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|ptr-&gt;command
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tx_cmd-&gt;skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
id|STAT_OK
)paren
(brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|2
)paren
id|print_eth
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0020
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0040
)paren
)paren
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0400
)paren
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0800
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x1000
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
id|tx_cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CmdMulticastList
suffix:colon
(brace
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CmdTDR
suffix:colon
(brace
r_int
r_int
id|status
op_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x8000
)paren
(brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: link ok.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x4000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Transceiver problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Termination problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Short circuit.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Time %ld.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x07ff
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|CmdConfigure
suffix:colon
(brace
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
multiline_comment|/* Zap command so set_multicast_list() knows it is free */
id|ptr-&gt;command
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ptr-&gt;next
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
suffix:semicolon
)brace
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
)brace
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ptr
op_ne
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
)paren
op_logical_and
(paren
id|ptr
op_ne
id|lp-&gt;cmd_tail
)paren
)paren
(brace
id|ptr-&gt;command
op_and_assign
l_int|0x1fff
suffix:semicolon
id|ptr
op_assign
id|WSWAPcmd
c_func
(paren
id|ptr-&gt;next
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lp-&gt;cmd_head
op_ne
(paren
r_struct
id|i596_cmd
op_star
)paren
id|I596_NULL
)paren
op_logical_and
(paren
id|dev-&gt;start
)paren
)paren
id|ack_cmd
op_or_assign
id|CUC_START
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|lp-&gt;cmd_head
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x1000
)paren
op_logical_or
(paren
id|status
op_amp
l_int|0x4000
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|i596_debug
OG
l_int|4
)paren
op_logical_and
(paren
id|status
op_amp
l_int|0x4000
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt received a frame.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Only RX_START if stopped - RGH 07-07-96 */
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1000
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;start
)paren
id|ack_cmd
op_or_assign
id|RX_START
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt receive unit inactive %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x00f0
)paren
suffix:semicolon
)brace
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* acknowledge the interrupt */
multiline_comment|/*      COMMENTED OUT &lt;&lt;&lt;&lt;&lt;&n;   if ((lp-&gt;scb.cmd != (struct i596_cmd *) I596_NULL) &amp;&amp; (dev-&gt;start))&n;   ack_cmd |= CUC_START;&n; */
id|boguscnt
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt, timeout status %4.4x command %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.command
op_assign
id|ack_cmd
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
multiline_comment|/* Ack the interrupt */
r_volatile
r_int
r_char
op_star
id|pcc2
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0xfff42000
suffix:semicolon
id|pcc2
(braket
l_int|0x2a
)braket
op_or_assign
l_int|0x08
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
r_int
r_char
op_star
id|ethirq
op_assign
(paren
r_int
r_char
op_star
)paren
id|BVME_ETHIRQ_REG
suffix:semicolon
op_star
id|ethirq
op_assign
l_int|1
suffix:semicolon
op_star
id|ethirq
op_assign
l_int|3
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_APRICOT_INTEL
(paren
r_void
)paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|4
comma
id|ioaddr
op_plus
l_int|0xf
)paren
suffix:semicolon
macro_line|#endif
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: exiting interrupt.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|i596_close
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
l_int|2000
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Shutting down ethercard, status was %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: close1 timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;scb.command
op_assign
id|CUC_ABORT
op_or
id|RX_ABORT
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|boguscnt
op_assign
l_int|2000
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: close2 timed out with status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|lp
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MVME16x_NET
r_if
c_cond
(paren
id|MACH_IS_MVME16x
)paren
(brace
r_volatile
r_int
r_char
op_star
id|pcc2
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0xfff42000
suffix:semicolon
multiline_comment|/* Disable all ints */
id|pcc2
(braket
l_int|0x28
)braket
op_assign
l_int|1
suffix:semicolon
id|pcc2
(braket
l_int|0x2a
)braket
op_assign
l_int|0x40
suffix:semicolon
id|pcc2
(braket
l_int|0x2b
)braket
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* Set snooping bits now! */
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BVME6000_NET
r_if
c_cond
(paren
id|MACH_IS_BVME6000
)paren
(brace
r_volatile
r_int
r_char
op_star
id|ethirq
op_assign
(paren
r_int
r_char
op_star
)paren
id|BVME_ETHIRQ_REG
suffix:semicolon
op_star
id|ethirq
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|remove_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|net_device_stats
op_star
DECL|function|i596_get_stats
id|i596_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set or clear the multicast filter for this adaptor.&n; */
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
r_int
id|config
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: set multicast list, %d entries, promisc %s, allmulti %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mc_count
comma
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF&quot;
comma
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
op_logical_and
op_logical_neg
(paren
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_amp
l_int|0x01
)paren
)paren
(brace
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_or_assign
l_int|0x01
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
op_logical_and
(paren
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_amp
l_int|0x01
)paren
)paren
(brace
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_and
(paren
id|lp-&gt;i596_config
(braket
l_int|11
)braket
op_amp
l_int|0x20
)paren
)paren
(brace
id|lp-&gt;i596_config
(braket
l_int|11
)braket
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_and
op_logical_neg
(paren
id|lp-&gt;i596_config
(braket
l_int|11
)braket
op_amp
l_int|0x20
)paren
)paren
(brace
id|lp-&gt;i596_config
(braket
l_int|11
)braket
op_or_assign
l_int|0x20
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|config
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;set_conf.command
)paren
id|printk
c_func
(paren
l_string|&quot;%s: config change request already queued&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|lp-&gt;set_conf.command
op_assign
id|CmdConfigure
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;set_conf
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|0
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|dmi
suffix:semicolon
r_int
r_char
op_star
id|cp
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
op_plus
l_int|2
op_plus
id|dev-&gt;mc_count
op_star
l_int|6
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: set_multicast Memory squeeze.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cmd-&gt;command
op_assign
id|CmdMulticastList
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_assign
id|dev-&gt;mc_count
op_star
l_int|6
suffix:semicolon
id|cp
op_assign
(paren
(paren
r_int
r_char
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_plus
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|dmi
op_ne
l_int|NULL
suffix:semicolon
id|dmi
op_assign
id|dmi-&gt;next
)paren
(brace
id|memcpy
c_func
(paren
id|cp
comma
id|dmi-&gt;dmi_addr
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Adding address %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
op_star
(paren
id|cp
op_plus
l_int|0
)paren
comma
op_star
(paren
id|cp
op_plus
l_int|1
)paren
comma
op_star
(paren
id|cp
op_plus
l_int|2
)paren
comma
op_star
(paren
id|cp
op_plus
l_int|3
)paren
comma
op_star
(paren
id|cp
op_plus
l_int|4
)paren
comma
op_star
(paren
id|cp
op_plus
l_int|5
)paren
)paren
suffix:semicolon
id|cp
op_add_assign
l_int|6
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i596_debug
OG
l_int|2
)paren
id|print_eth
c_func
(paren
(paren
(paren
r_char
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef HAVE_DEVLIST
DECL|variable|__initdata
r_static
r_int
r_int
id|i596_portlist
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x300
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|i596_drv
r_struct
id|netdev_entry
id|i596_drv
op_assign
(brace
l_string|&quot;apricot&quot;
comma
id|i82596_probe
comma
id|I596_TOTAL_SIZE
comma
id|apricot_portlist
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef MODULE
DECL|variable|devicename
r_static
r_char
id|devicename
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dev_apricot
r_static
r_struct
id|device
id|dev_apricot
op_assign
(brace
id|devicename
comma
multiline_comment|/* device name inserted by /linux/drivers/net/net_init.c */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x300
comma
l_int|10
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|i82596_probe
)brace
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
l_int|0x300
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
op_assign
l_int|10
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|dev_apricot.base_addr
op_assign
id|io
suffix:semicolon
id|dev_apricot.irq
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_apricot
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_apricot
)paren
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|dev_apricot.mem_start
)paren
suffix:semicolon
id|dev_apricot.priv
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* If we don&squot;t do this, we can&squot;t re-insmod it later. */
id|release_region
c_func
(paren
id|dev_apricot.base_addr
comma
id|I596_TOTAL_SIZE
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* MODULE */
"&f;"
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -D__KERNEL__ -I/usr/src/linux/net/inet -Wall -Wstrict-prototypes -O6 -m486 -c 82596.c&quot;&n; * End:&n; */
eof
