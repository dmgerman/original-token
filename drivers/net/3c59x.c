multiline_comment|/* EtherLinkXL.c: A 3Com EtherLink PCI III/XL ethernet driver for linux. */
multiline_comment|/*&n;&t;Written 1996-1999 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU Public License, incorporated herein by reference.&n;&n;&t;This driver is for the 3Com &quot;Vortex&quot; and &quot;Boomerang&quot; series ethercards.&n;&t;Members of the series include Fast EtherLink 3c590/3c592/3c595/3c597&n;&t;and the EtherLink XL 3c900 and 3c905 cards.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Center of Excellence in Space Data and Information Sciences&n;&t;   Code 930.5, Goddard Space Flight Center, Greenbelt MD 20771&n;&n;&t;Linux Kernel Additions:&n;&t;&n; &t;0.99H+lk0.9 - David S. Miller - softnet, PCI DMA updates&n; &t;0.99H+lk1.0 - Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n;&t;&t;Remove compatibility defines for kernel versions &lt; 2.2.x.&n;&t;&t;Update for new 2.3.x module interface&n;&t;LK1.1.2 (March 19, 2000)&n;&t;* New PCI interface (jgarzik)&n;&n;    LK1.1.3 25 April 2000, Andrew Morton &lt;andrewm@uow.edu.au&gt;&n;    - Merged with 3c575_cb.c&n;    - Don&squot;t set RxComplete in boomerang interrupt enable reg&n;    - spinlock in vortex_timer to protect mdio functions&n;    - disable local interrupts around call to vortex_interrupt in&n;      vortex_tx_timeout() (So vortex_interrupt can use spin_lock())&n;    - Select window 3 in vortex_timer()&squot;s write to Wn3_MAC_Ctrl&n;    - In vortex_start_xmit(), move the lock to _after_ we&squot;ve altered&n;      vp-&gt;cur_tx and vp-&gt;tx_full.  This defeats the race between&n;      vortex_start_xmit() and vortex_interrupt which was identified&n;      by Bogdan Costescu.&n;    - Merged back support for six new cards from various sources&n;    - Set vortex_have_pci if pci_module_init returns zero (fixes cardbus&n;      insertion oops)&n;    - Tell it that 3c905C has NWAY for 100bT autoneg&n;    - Fix handling of SetStatusEnd in &squot;Too much work..&squot; code, as&n;      per 2.3.99&squot;s 3c575_cb (Dave Hinds).&n;    - Split ISR into two for vortex &amp; boomerang&n;    - Fix MOD_INC/DEC races&n;    - Handle resource allocation failures.&n;    - Fix 3CCFE575CT LED polarity&n;    - Make tx_interrupt_mitigation the default&n;&n;    LK1.1.4 25 April 2000, Andrew Morton &lt;andrewm@uow.edu.au&gt;    &n;    - Add extra TxReset to vortex_up() to fix 575_cb hotplug initialisation probs.&n;    - Put vortex_info_tbl into __devinitdata&n;    - In the vortex_error StatsFull HACK, disable stats in vp-&gt;intr_enable as well&n;      as in the hardware.&n;    - Increased the loop counter in wait_for_completion from 2,000 to 4,000.&n;&n;    LK1.1.5 28 April 2000, andrewm&n;    - Added powerpc defines (John Daniel &lt;jdaniel@etresoft.com&gt; said these work...)&n;    - Some extra diagnostics&n;    - In vortex_error(), reset the Tx on maxCollisions.  Otherwise most&n;      chips usually get a Tx timeout.&n;    - Added extra_reset module parm&n;    - Replaced some inline timer manip with mod_timer&n;      (Franois romieu &lt;Francois.Romieu@nic.fr&gt;)&n;    - In vortex_up(), don&squot;t make Wn3_config initialisation dependent upon has_nway&n;      (this came across from 3c575_cb).&n;&n;    LK1.1.6 06 Jun 2000, andrewm&n;    - Backed out the PPC defines.&n;    - Use del_timer_sync(), mod_timer().&n;    - Fix wrapped ulong comparison in boomerang_rx()&n;    - Add IS_TORNADO, use it to suppress 3c905C checksum error msg&n;      (Donald Becker, I Lee Hetherington &lt;ilh@sls.lcs.mit.edu&gt;)&n;    - Replace union wn3_config with BFINS/BFEXT manipulation for&n;      sparc64 (Pete Zaitcev, Peter Jones)&n;    - In vortex_error, do_tx_reset and vortex_tx_timeout(Vortex):&n;      do a netif_wake_queue() to better recover from errors. (Anders Pedersen,&n;      Donald Becker)&n;    - Print a warning on out-of-memory (rate limited to 1 per 10 secs)&n;    - Added two more Cardbus 575 NICs: 5b57 and 6564 (Paul Wagland)&n;&n;    LK1.1.7 2 Jul 2000 andrewm&n;    - Better handling of shared IRQs&n;    - Reset the transmitter on a Tx reclaim error&n;    - Fixed crash under OOM during vortex_open() (Mark Hemment)&n;    - Fix Rx cessation problem during OOM (help from Mark Hemment)&n;    - The spinlocks around the mdio access were blocking interrupts for 300uS.&n;      Fix all this to use spin_lock_bh() within mdio_read/write&n;    - Only write to TxFreeThreshold if it&squot;s a boomerang - other NICs don&squot;t&n;      have one.&n;    - Added 802.3x MAC-layer flow control support&n;&n;   LK1.1.8 13 Aug 2000 andrewm&n;    - Ignore request_region() return value - already reserved if Cardbus.&n;    - Merged some additional Cardbus flags from Don&squot;s 0.99Qk&n;    - Some fixes for 3c556 (Fred Maciel)&n;    - Fix for EISA initialisation (Jan Rkorajski)&n;    - Renamed MII_XCVR_PWR and EEPROM_230 to align with 3c575_cb and D. Becker&squot;s drivers&n;    - Fixed MII_XCVR_PWR for 3CCFE575CT&n;    - Added INVERT_LED_PWR, used it.&n;    - Backed out the extra_reset stuff&n;&n;   LK1.1.9 12 Sep 2000 andrewm&n;    - Backed out the tx_reset_resume flags.  It was a no-op.&n;    - In vortex_error, don&squot;t reset the Tx on txReclaim errors&n;    - In vortex_error, don&squot;t reset the Tx on maxCollisions errors.&n;      Hence backed out all the DownListPtr logic here.&n;    - In vortex_error, give Tornado cards a partial TxReset on&n;      maxCollisions (David Hinds).  Defined MAX_COLLISION_RESET for this.&n;    - Redid some driver flags and device names based on pcmcia_cs-3.1.20.&n;    - Fixed a bug where, if vp-&gt;tx_full is set when the interface&n;      is downed, it remains set when the interface is upped.  Bad&n;      things happen.&n;&n;   LK1.1.10 17 Sep 2000 andrewm&n;    - Added EEPROM_8BIT for 3c555 (Fred Maciel)&n;    - Added experimental support for the 3c556B Laptop Hurricane (Louis Gerbarg)&n;    - Add HAS_NWAY to &quot;3c900 Cyclone 10Mbps TPO&quot;&n;&n;   LK1.1.11 13 Nov 2000 andrewm&n;    - Dump MOD_INC/DEC_USE_COUNT, use SET_MODULE_OWNER&n;&n;    - See http://www.uow.edu.au/~andrewm/linux/#3c59x-2.3 for more details.&n;    - Also see Documentation/networking/vortex.txt&n;*/
multiline_comment|/*&n; * FIXME: This driver _could_ support MTU changing, but doesn&squot;t.  See Don&squot;s hamaci.c implementation&n; * as well as other drivers&n; *&n; * NOTE: If you make &squot;vortex_debug&squot; a constant (#define vortex_debug 0) the driver shrinks by 2k&n; * due to dead code elimination.  There will be some performance benefits from this due to&n; * elimination of all the tests and reduced cache footprint.&n; */
multiline_comment|/* A few values that may be tweaked. */
multiline_comment|/* Keep the ring sizes a power of two for efficiency. */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;16
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;32
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
multiline_comment|/* &quot;Knobs&quot; that adjust features and parameters. */
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-frames scheme.&n;   Setting to &gt; 1512 effectively disables this feature. */
DECL|variable|rx_copybreak
r_static
r_const
r_int
id|rx_copybreak
op_assign
l_int|200
suffix:semicolon
multiline_comment|/* Allow setting MTU to a larger size, bypassing the normal ethernet setup. */
DECL|variable|mtu
r_static
r_const
r_int
id|mtu
op_assign
l_int|1500
suffix:semicolon
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Tx timeout interval (millisecs) */
DECL|variable|watchdog
r_static
r_int
id|watchdog
op_assign
l_int|400
suffix:semicolon
multiline_comment|/* Allow aggregation of Tx interrupts.  Saves CPU load at the cost&n; * of possible Tx stalls if the system is blocking interrupts&n; * somewhere else.  Undefine this to disable.&n; * AKPM 26 April 2000: enabling this still gets vestigial Tx timeouts&n; * in a heavily loaded (collision-prone) 10BaseT LAN.  Should be OK with&n; * switched Ethernet.&n; * AKPM 24May00: vestigial timeouts have been removed by later fixes.&n; */
DECL|macro|tx_interrupt_mitigation
mdefine_line|#define tx_interrupt_mitigation 1
multiline_comment|/* Put out somewhat more debugging messages. (0: no msg, 1 minimal .. 6). */
DECL|macro|vortex_debug
mdefine_line|#define vortex_debug debug
macro_line|#ifdef VORTEX_DEBUG
DECL|variable|vortex_debug
r_static
r_int
id|vortex_debug
op_assign
id|VORTEX_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|vortex_debug
r_static
r_int
id|vortex_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/* Some values here only for performance evaluation and path-coverage&n;   debugging. */
DECL|variable|rx_nocopy
DECL|variable|rx_copy
DECL|variable|queued_packet
DECL|variable|rx_csumhits
r_static
r_int
id|rx_nocopy
op_assign
l_int|0
comma
id|rx_copy
op_assign
l_int|0
comma
id|queued_packet
op_assign
l_int|0
comma
id|rx_csumhits
suffix:semicolon
macro_line|#ifndef __OPTIMIZE__
macro_line|#error You must compile this file with the correct options!
macro_line|#error See the last lines of the source file.
macro_line|#error You must compile this driver with &quot;-O&quot;.
macro_line|#endif
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;asm/irq.h&gt;&t;&t;&t;/* For NR_IRQS only. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* Kernel compatibility defines, some common to David Hinds&squot; PCMCIA package.&n;   This is only in the support-all-kernels source code. */
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
macro_line|#include &lt;linux/delay.h&gt;
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
l_string|&quot;3c59x.c:LK1.1.11 13 Nov 2000  Donald Becker and others. http://www.scyld.com/network/vortex.html &quot;
l_string|&quot;$Revision: 1.102.2.46 $&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Donald Becker &lt;becker@scyld.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;3Com 3c59x/3c90x/3c575 series Vortex/Boomerang/Cyclone driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
l_int|8
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
l_int|8
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|flow_ctrl
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
l_int|8
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|compaq_ioaddr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|compaq_irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|compaq_device_id
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|watchdog
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Operational parameter that usually are not changed. */
multiline_comment|/* The Vortex size is twice that of the original EtherLinkIII series: the&n;   runtime register window, window 1, is now always mapped in.&n;   The Boomerang size is twice as large as the Vortex -- it has additional&n;   bus master control registers. */
DECL|macro|VORTEX_TOTAL_SIZE
mdefine_line|#define VORTEX_TOTAL_SIZE 0x20
DECL|macro|BOOMERANG_TOTAL_SIZE
mdefine_line|#define BOOMERANG_TOTAL_SIZE 0x40
multiline_comment|/* Set iff a MII transceiver on any interface requires mdio preamble.&n;   This only set with the original DP83840 on older 3c905 boards, so the extra&n;   code size of a per-interface flag is not worthwhile. */
DECL|variable|mii_preamble_required
r_static
r_char
id|mii_preamble_required
suffix:semicolon
DECL|macro|PFX
mdefine_line|#define PFX &quot;3c59x: &quot;
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This device driver is designed for the 3Com FastEtherLink and FastEtherLink&n;XL, 3Com&squot;s PCI to 10/100baseT adapters.  It also works with the 10Mbs&n;versions of the FastEtherLink cards.  The supported product IDs are&n;  3c590, 3c592, 3c595, 3c597, 3c900, 3c905&n;&n;The related ISA 3c515 is supported with a separate driver, 3c515.c, included&n;with the kernel source or available from&n;    cesdis.gsfc.nasa.gov:/pub/linux/drivers/3c515.html&n;&n;II. Board-specific settings&n;&n;PCI bus devices are configured by the system at boot time, so no jumpers&n;need to be set on the board.  The system BIOS should be set to assign the&n;PCI INTA signal to an otherwise unused system IRQ line.&n;&n;The EEPROM settings for media type and forced-full-duplex are observed.&n;The EEPROM media type should be left at the default &quot;autoselect&quot; unless using&n;10base2 or AUI connections which cannot be reliably detected.&n;&n;III. Driver operation&n;&n;The 3c59x series use an interface that&squot;s very similar to the previous 3c5x9&n;series.  The primary interface is two programmed-I/O FIFOs, with an&n;alternate single-contiguous-region bus-master transfer (see next).&n;&n;The 3c900 &quot;Boomerang&quot; series uses a full-bus-master interface with separate&n;lists of transmit and receive descriptors, similar to the AMD LANCE/PCnet,&n;DEC Tulip and Intel Speedo3.  The first chip version retains a compatible&n;programmed-I/O interface that has been removed in &squot;B&squot; and subsequent board&n;revisions.&n;&n;One extension that is advertised in a very large font is that the adapters&n;are capable of being bus masters.  On the Vortex chip this capability was&n;only for a single contiguous region making it far less useful than the full&n;bus master capability.  There is a significant performance impact of taking&n;an extra interrupt or polling for the completion of each transfer, as well&n;as difficulty sharing the single transfer engine between the transmit and&n;receive threads.  Using DMA transfers is a win only with large blocks or&n;with the flawed versions of the Intel Orion motherboard PCI controller.&n;&n;The Boomerang chip&squot;s full-bus-master interface is useful, and has the&n;currently-unused advantages over other similar chips that queued transmit&n;packets may be reordered and receive buffer groups are associated with a&n;single frame.&n;&n;With full-bus-master support, this driver uses a &quot;RX_COPYBREAK&quot; scheme.&n;Rather than a fixed intermediate receive buffer, this scheme allocates&n;full-sized skbuffs as receive buffers.  The value RX_COPYBREAK is used as&n;the copying breakpoint: it is chosen to trade-off the memory wasted by&n;passing the full-sized skbuff to the queue layer for all frames vs. the&n;copying cost of copying a frame to a correctly-sized skbuff.&n;&n;IIIC. Synchronization&n;The driver runs as two independent, single-threaded flows of control.  One&n;is the send-packet routine, which enforces single-threaded use by the&n;dev-&gt;tbusy flag.  The other thread is the interrupt handler, which is single&n;threaded by the hardware and other software.&n;&n;IV. Notes&n;&n;Thanks to Cameron Spitzer and Terry Murphy of 3Com for providing development&n;3c590, 3c595, and 3c900 boards.&n;The name &quot;Vortex&quot; is the internal 3Com project name for the PCI ASIC, and&n;the EISA version is called &quot;Demon&quot;.  According to Terry these names come&n;from rides at the local amusement park.&n;&n;The new chips support both ethernet (1.5K) and FDDI (4.5K) packet sizes!&n;This driver only supports ethernet packets because of the skbuff allocation&n;limit of 4K.&n;*/
multiline_comment|/* This table drives the PCI probe routines.  It&squot;s mostly boilerplate in all&n;   of the drivers, and will likely be provided by some future kernel.&n;*/
DECL|enum|pci_flags_bit
r_enum
id|pci_flags_bit
(brace
DECL|enumerator|PCI_USES_IO
DECL|enumerator|PCI_USES_MEM
DECL|enumerator|PCI_USES_MASTER
id|PCI_USES_IO
op_assign
l_int|1
comma
id|PCI_USES_MEM
op_assign
l_int|2
comma
id|PCI_USES_MASTER
op_assign
l_int|4
comma
DECL|enumerator|PCI_ADDR0
DECL|enumerator|PCI_ADDR1
DECL|enumerator|PCI_ADDR2
DECL|enumerator|PCI_ADDR3
id|PCI_ADDR0
op_assign
l_int|0x10
op_lshift
l_int|0
comma
id|PCI_ADDR1
op_assign
l_int|0x10
op_lshift
l_int|1
comma
id|PCI_ADDR2
op_assign
l_int|0x10
op_lshift
l_int|2
comma
id|PCI_ADDR3
op_assign
l_int|0x10
op_lshift
l_int|3
comma
)brace
suffix:semicolon
DECL|enumerator|IS_VORTEX
DECL|enumerator|IS_BOOMERANG
DECL|enumerator|IS_CYCLONE
DECL|enumerator|IS_TORNADO
r_enum
(brace
id|IS_VORTEX
op_assign
l_int|1
comma
id|IS_BOOMERANG
op_assign
l_int|2
comma
id|IS_CYCLONE
op_assign
l_int|4
comma
id|IS_TORNADO
op_assign
l_int|8
comma
DECL|enumerator|EEPROM_8BIT
id|EEPROM_8BIT
op_assign
l_int|0x10
comma
multiline_comment|/* AKPM: Uses 0x230 as the base bitmaps for EEPROM reads */
DECL|enumerator|HAS_PWR_CTRL
DECL|enumerator|HAS_MII
DECL|enumerator|HAS_NWAY
DECL|enumerator|HAS_CB_FNS
id|HAS_PWR_CTRL
op_assign
l_int|0x20
comma
id|HAS_MII
op_assign
l_int|0x40
comma
id|HAS_NWAY
op_assign
l_int|0x80
comma
id|HAS_CB_FNS
op_assign
l_int|0x100
comma
DECL|enumerator|INVERT_MII_PWR
DECL|enumerator|INVERT_LED_PWR
DECL|enumerator|MAX_COLLISION_RESET
id|INVERT_MII_PWR
op_assign
l_int|0x200
comma
id|INVERT_LED_PWR
op_assign
l_int|0x400
comma
id|MAX_COLLISION_RESET
op_assign
l_int|0x800
comma
DECL|enumerator|EEPROM_OFFSET
id|EEPROM_OFFSET
op_assign
l_int|0x1000
)brace
suffix:semicolon
DECL|enum|vortex_chips
r_enum
id|vortex_chips
(brace
DECL|enumerator|CH_3C590
id|CH_3C590
op_assign
l_int|0
comma
DECL|enumerator|CH_3C592
id|CH_3C592
comma
DECL|enumerator|CH_3C597
id|CH_3C597
comma
DECL|enumerator|CH_3C595_1
id|CH_3C595_1
comma
DECL|enumerator|CH_3C595_2
id|CH_3C595_2
comma
DECL|enumerator|CH_3C595_3
id|CH_3C595_3
comma
DECL|enumerator|CH_3C900_1
id|CH_3C900_1
comma
DECL|enumerator|CH_3C900_2
id|CH_3C900_2
comma
DECL|enumerator|CH_3C900_3
id|CH_3C900_3
comma
DECL|enumerator|CH_3C900_4
id|CH_3C900_4
comma
DECL|enumerator|CH_3C900_5
id|CH_3C900_5
comma
DECL|enumerator|CH_3C900B_FL
id|CH_3C900B_FL
comma
DECL|enumerator|CH_3C905_1
id|CH_3C905_1
comma
DECL|enumerator|CH_3C905_2
id|CH_3C905_2
comma
DECL|enumerator|CH_3C905B_1
id|CH_3C905B_1
comma
DECL|enumerator|CH_3C905B_2
id|CH_3C905B_2
comma
DECL|enumerator|CH_3C905B_FX
id|CH_3C905B_FX
comma
DECL|enumerator|CH_3C905C
id|CH_3C905C
comma
DECL|enumerator|CH_3C980
id|CH_3C980
comma
DECL|enumerator|CH_3C9805
id|CH_3C9805
comma
DECL|enumerator|CH_3CSOHO100_TX
id|CH_3CSOHO100_TX
comma
DECL|enumerator|CH_3C555
id|CH_3C555
comma
DECL|enumerator|CH_3C556
id|CH_3C556
comma
DECL|enumerator|CH_3C556B
id|CH_3C556B
comma
DECL|enumerator|CH_3C575
id|CH_3C575
comma
DECL|enumerator|CH_3C575_1
id|CH_3C575_1
comma
DECL|enumerator|CH_3CCFE575
id|CH_3CCFE575
comma
DECL|enumerator|CH_3CCFE575CT
id|CH_3CCFE575CT
comma
DECL|enumerator|CH_3CCFE656
id|CH_3CCFE656
comma
DECL|enumerator|CH_3CCFEM656
id|CH_3CCFEM656
comma
DECL|enumerator|CH_3CCFEM656_1
id|CH_3CCFEM656_1
comma
DECL|enumerator|CH_3C450
id|CH_3C450
comma
)brace
suffix:semicolon
multiline_comment|/* note: this array directly indexed by above enums, and MUST&n; * be kept in sync with both the enums above, and the PCI device&n; * table below&n; */
DECL|struct|vortex_chip_info
r_static
r_struct
id|vortex_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|vortex_info_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
DECL|macro|EISA_TBL_OFFSET
mdefine_line|#define EISA_TBL_OFFSET&t;0&t;&t;/* Offset of this entry for vortex_eisa_init */
(brace
l_string|&quot;3c590 Vortex 10Mbps&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c592 EISA 10mbps Demon/Vortex&quot;
comma
multiline_comment|/* AKPM: from Don&squot;s 3c59x_cb.c 0.49H */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c597 EISA Fast Demon/Vortex&quot;
comma
multiline_comment|/* AKPM: from Don&squot;s 3c59x_cb.c 0.49H */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c595 Vortex 100baseTx&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c595 Vortex 100baseT4&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c595 Vortex 100base-MII&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_VORTEX
comma
l_int|32
comma
)brace
comma
(brace
l_string|&quot;3c900 Boomerang 10baseT&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
comma
l_int|64
comma
)brace
comma
(brace
l_string|&quot;3c900 Boomerang 10Mbps Combo&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
comma
l_int|64
comma
)brace
comma
(brace
l_string|&quot;3c900 Cyclone 10Mbps TPO&quot;
comma
multiline_comment|/* AKPM: from Don&squot;s 0.99M */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c900 Cyclone 10Mbps Combo&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c900 Cyclone 10Mbps TPC&quot;
comma
multiline_comment|/* AKPM: from Don&squot;s 0.99M */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c900B-FL Cyclone 10base-FL&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c905 Boomerang 100baseTx&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
op_or
id|HAS_MII
comma
l_int|64
comma
)brace
comma
(brace
l_string|&quot;3c905 Boomerang 100baseT4&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
op_or
id|HAS_MII
comma
l_int|64
comma
)brace
comma
(brace
l_string|&quot;3c905B Cyclone 100baseTx&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c905B Cyclone 10/100/BNC&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c905B-FX Cyclone 100baseFx&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c905C Tornado&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c980 Cyclone&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c980 10/100 Base-TX NIC(Python-T)&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3cSOHO100-TX Hurricane&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c555 Laptop Hurricane&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|EEPROM_8BIT
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c556 Laptop Tornado&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
op_or
id|EEPROM_8BIT
op_or
id|HAS_CB_FNS
op_or
id|INVERT_MII_PWR
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c556B Laptop Hurricane&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
op_or
id|EEPROM_OFFSET
op_or
id|HAS_CB_FNS
op_or
id|INVERT_MII_PWR
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c575 [Megahertz] 10/100 LAN &t;CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
op_or
id|HAS_MII
op_or
id|EEPROM_8BIT
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c575 Boomerang CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_BOOMERANG
op_or
id|HAS_MII
op_or
id|EEPROM_8BIT
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3CCFE575BT Cyclone CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
op_or
id|HAS_CB_FNS
op_or
id|EEPROM_8BIT
op_or
id|INVERT_LED_PWR
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3CCFE575CT Tornado CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
op_or
id|HAS_CB_FNS
op_or
id|EEPROM_8BIT
op_or
id|INVERT_MII_PWR
op_or
id|MAX_COLLISION_RESET
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3CCFE656 Cyclone CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
op_or
id|HAS_CB_FNS
op_or
id|EEPROM_8BIT
op_or
id|INVERT_MII_PWR
op_or
id|INVERT_LED_PWR
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3CCFEM656B Cyclone+Winmodem CardBus&quot;
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_CYCLONE
op_or
id|HAS_NWAY
op_or
id|HAS_CB_FNS
op_or
id|EEPROM_8BIT
op_or
id|INVERT_MII_PWR
op_or
id|INVERT_LED_PWR
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3CXFEM656C Tornado+Winmodem CardBus&quot;
comma
multiline_comment|/* From pcmcia-cs-3.1.5 */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
op_or
id|HAS_CB_FNS
op_or
id|EEPROM_8BIT
op_or
id|INVERT_MII_PWR
op_or
id|MAX_COLLISION_RESET
comma
l_int|128
comma
)brace
comma
(brace
l_string|&quot;3c450 HomePNA Tornado&quot;
comma
multiline_comment|/* AKPM: from Don&squot;s 0.99Q */
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
id|IS_TORNADO
op_or
id|HAS_NWAY
comma
l_int|128
comma
)brace
comma
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* 0 terminated list. */
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|vortex_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x10B7
comma
l_int|0x5900
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C590
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5920
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C592
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5970
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C597
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5950
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C595_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5951
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C595_2
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5952
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C595_3
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9001
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900_2
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9004
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900_3
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9005
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900_4
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9006
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900_5
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x900A
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C900B_FL
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9050
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9051
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905_2
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9055
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905B_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9058
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905B_2
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x905A
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905B_FX
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9200
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C905C
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9800
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C980
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x9805
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C9805
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x7646
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CSOHO100_TX
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5055
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C555
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x6055
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C556
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x6056
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C556B
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5b57
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C575
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5057
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C575_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5157
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CCFE575
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x5257
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CCFE575CT
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x6560
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CCFE656
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x6562
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CCFEM656
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x6564
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3CCFEM656_1
)brace
comma
(brace
l_int|0x10B7
comma
l_int|0x4500
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_3C450
)brace
comma
(brace
l_int|0
comma
)brace
multiline_comment|/* 0 terminated list. */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|vortex_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* Operational definitions.&n;   These are not used by other compilation units and thus are not&n;   exported in a &quot;.h&quot; file.&n;&n;   First the windows.  There are eight register windows, with the command&n;   and status registers available in each.&n;   */
DECL|macro|EL3WINDOW
mdefine_line|#define EL3WINDOW(win_num) outw(SelectWindow + (win_num), ioaddr + EL3_CMD)
DECL|macro|EL3_CMD
mdefine_line|#define EL3_CMD 0x0e
DECL|macro|EL3_STATUS
mdefine_line|#define EL3_STATUS 0x0e
multiline_comment|/* The top five bits written to EL3_CMD are a command, the lower&n;   11 bits are the parameter, if applicable.&n;   Note that 11 parameters bits was fine for ethernet, but the new chip&n;   can handle FDDI length frames (~4500 octets) and now parameters count&n;   32-bit &squot;Dwords&squot; rather than octets. */
DECL|enum|vortex_cmd
r_enum
id|vortex_cmd
(brace
DECL|enumerator|TotalReset
DECL|enumerator|SelectWindow
DECL|enumerator|StartCoax
id|TotalReset
op_assign
l_int|0
op_lshift
l_int|11
comma
id|SelectWindow
op_assign
l_int|1
op_lshift
l_int|11
comma
id|StartCoax
op_assign
l_int|2
op_lshift
l_int|11
comma
DECL|enumerator|RxDisable
DECL|enumerator|RxEnable
DECL|enumerator|RxReset
id|RxDisable
op_assign
l_int|3
op_lshift
l_int|11
comma
id|RxEnable
op_assign
l_int|4
op_lshift
l_int|11
comma
id|RxReset
op_assign
l_int|5
op_lshift
l_int|11
comma
DECL|enumerator|UpStall
DECL|enumerator|UpUnstall
id|UpStall
op_assign
l_int|6
op_lshift
l_int|11
comma
id|UpUnstall
op_assign
(paren
l_int|6
op_lshift
l_int|11
)paren
op_plus
l_int|1
comma
DECL|enumerator|DownStall
DECL|enumerator|DownUnstall
id|DownStall
op_assign
(paren
l_int|6
op_lshift
l_int|11
)paren
op_plus
l_int|2
comma
id|DownUnstall
op_assign
(paren
l_int|6
op_lshift
l_int|11
)paren
op_plus
l_int|3
comma
DECL|enumerator|RxDiscard
DECL|enumerator|TxEnable
DECL|enumerator|TxDisable
DECL|enumerator|TxReset
id|RxDiscard
op_assign
l_int|8
op_lshift
l_int|11
comma
id|TxEnable
op_assign
l_int|9
op_lshift
l_int|11
comma
id|TxDisable
op_assign
l_int|10
op_lshift
l_int|11
comma
id|TxReset
op_assign
l_int|11
op_lshift
l_int|11
comma
DECL|enumerator|FakeIntr
DECL|enumerator|AckIntr
DECL|enumerator|SetIntrEnb
id|FakeIntr
op_assign
l_int|12
op_lshift
l_int|11
comma
id|AckIntr
op_assign
l_int|13
op_lshift
l_int|11
comma
id|SetIntrEnb
op_assign
l_int|14
op_lshift
l_int|11
comma
DECL|enumerator|SetStatusEnb
DECL|enumerator|SetRxFilter
DECL|enumerator|SetRxThreshold
id|SetStatusEnb
op_assign
l_int|15
op_lshift
l_int|11
comma
id|SetRxFilter
op_assign
l_int|16
op_lshift
l_int|11
comma
id|SetRxThreshold
op_assign
l_int|17
op_lshift
l_int|11
comma
DECL|enumerator|SetTxThreshold
DECL|enumerator|SetTxStart
id|SetTxThreshold
op_assign
l_int|18
op_lshift
l_int|11
comma
id|SetTxStart
op_assign
l_int|19
op_lshift
l_int|11
comma
DECL|enumerator|StartDMAUp
DECL|enumerator|StartDMADown
DECL|enumerator|StatsEnable
id|StartDMAUp
op_assign
l_int|20
op_lshift
l_int|11
comma
id|StartDMADown
op_assign
(paren
l_int|20
op_lshift
l_int|11
)paren
op_plus
l_int|1
comma
id|StatsEnable
op_assign
l_int|21
op_lshift
l_int|11
comma
DECL|enumerator|StatsDisable
DECL|enumerator|StopCoax
DECL|enumerator|SetFilterBit
id|StatsDisable
op_assign
l_int|22
op_lshift
l_int|11
comma
id|StopCoax
op_assign
l_int|23
op_lshift
l_int|11
comma
id|SetFilterBit
op_assign
l_int|25
op_lshift
l_int|11
comma
)brace
suffix:semicolon
multiline_comment|/* The SetRxFilter command accepts the following classes: */
DECL|enum|RxFilter
r_enum
id|RxFilter
(brace
DECL|enumerator|RxStation
DECL|enumerator|RxMulticast
DECL|enumerator|RxBroadcast
DECL|enumerator|RxProm
id|RxStation
op_assign
l_int|1
comma
id|RxMulticast
op_assign
l_int|2
comma
id|RxBroadcast
op_assign
l_int|4
comma
id|RxProm
op_assign
l_int|8
)brace
suffix:semicolon
multiline_comment|/* Bits in the general status register. */
DECL|enum|vortex_status
r_enum
id|vortex_status
(brace
DECL|enumerator|IntLatch
DECL|enumerator|HostError
DECL|enumerator|TxComplete
id|IntLatch
op_assign
l_int|0x0001
comma
id|HostError
op_assign
l_int|0x0002
comma
id|TxComplete
op_assign
l_int|0x0004
comma
DECL|enumerator|TxAvailable
DECL|enumerator|RxComplete
DECL|enumerator|RxEarly
id|TxAvailable
op_assign
l_int|0x0008
comma
id|RxComplete
op_assign
l_int|0x0010
comma
id|RxEarly
op_assign
l_int|0x0020
comma
DECL|enumerator|IntReq
DECL|enumerator|StatsFull
id|IntReq
op_assign
l_int|0x0040
comma
id|StatsFull
op_assign
l_int|0x0080
comma
DECL|enumerator|DMADone
DECL|enumerator|DownComplete
DECL|enumerator|UpComplete
id|DMADone
op_assign
l_int|1
op_lshift
l_int|8
comma
id|DownComplete
op_assign
l_int|1
op_lshift
l_int|9
comma
id|UpComplete
op_assign
l_int|1
op_lshift
l_int|10
comma
DECL|enumerator|DMAInProgress
id|DMAInProgress
op_assign
l_int|1
op_lshift
l_int|11
comma
multiline_comment|/* DMA controller is still busy.*/
DECL|enumerator|CmdInProgress
id|CmdInProgress
op_assign
l_int|1
op_lshift
l_int|12
comma
multiline_comment|/* EL3_CMD is still busy.*/
)brace
suffix:semicolon
multiline_comment|/* Register window 1 offsets, the window used in normal operation.&n;   On the Vortex this window is always mapped at offsets 0x10-0x1f. */
DECL|enum|Window1
r_enum
id|Window1
(brace
DECL|enumerator|TX_FIFO
DECL|enumerator|RX_FIFO
DECL|enumerator|RxErrors
id|TX_FIFO
op_assign
l_int|0x10
comma
id|RX_FIFO
op_assign
l_int|0x10
comma
id|RxErrors
op_assign
l_int|0x14
comma
DECL|enumerator|RxStatus
DECL|enumerator|Timer
DECL|enumerator|TxStatus
id|RxStatus
op_assign
l_int|0x18
comma
id|Timer
op_assign
l_int|0x1A
comma
id|TxStatus
op_assign
l_int|0x1B
comma
DECL|enumerator|TxFree
id|TxFree
op_assign
l_int|0x1C
comma
multiline_comment|/* Remaining free bytes in Tx buffer. */
)brace
suffix:semicolon
DECL|enum|Window0
r_enum
id|Window0
(brace
DECL|enumerator|Wn0EepromCmd
id|Wn0EepromCmd
op_assign
l_int|10
comma
multiline_comment|/* Window 0: EEPROM command register. */
DECL|enumerator|Wn0EepromData
id|Wn0EepromData
op_assign
l_int|12
comma
multiline_comment|/* Window 0: EEPROM results register. */
DECL|enumerator|IntrStatus
id|IntrStatus
op_assign
l_int|0x0E
comma
multiline_comment|/* Valid in all windows. */
)brace
suffix:semicolon
DECL|enum|Win0_EEPROM_bits
r_enum
id|Win0_EEPROM_bits
(brace
DECL|enumerator|EEPROM_Read
DECL|enumerator|EEPROM_WRITE
DECL|enumerator|EEPROM_ERASE
id|EEPROM_Read
op_assign
l_int|0x80
comma
id|EEPROM_WRITE
op_assign
l_int|0x40
comma
id|EEPROM_ERASE
op_assign
l_int|0xC0
comma
DECL|enumerator|EEPROM_EWENB
id|EEPROM_EWENB
op_assign
l_int|0x30
comma
multiline_comment|/* Enable erasing/writing for 10 msec. */
DECL|enumerator|EEPROM_EWDIS
id|EEPROM_EWDIS
op_assign
l_int|0x00
comma
multiline_comment|/* Disable EWENB before 10 msec timeout. */
)brace
suffix:semicolon
multiline_comment|/* EEPROM locations. */
DECL|enum|eeprom_offset
r_enum
id|eeprom_offset
(brace
DECL|enumerator|PhysAddr01
DECL|enumerator|PhysAddr23
DECL|enumerator|PhysAddr45
DECL|enumerator|ModelID
id|PhysAddr01
op_assign
l_int|0
comma
id|PhysAddr23
op_assign
l_int|1
comma
id|PhysAddr45
op_assign
l_int|2
comma
id|ModelID
op_assign
l_int|3
comma
DECL|enumerator|EtherLink3ID
DECL|enumerator|IFXcvrIO
DECL|enumerator|IRQLine
id|EtherLink3ID
op_assign
l_int|7
comma
id|IFXcvrIO
op_assign
l_int|8
comma
id|IRQLine
op_assign
l_int|9
comma
DECL|enumerator|NodeAddr01
DECL|enumerator|NodeAddr23
DECL|enumerator|NodeAddr45
id|NodeAddr01
op_assign
l_int|10
comma
id|NodeAddr23
op_assign
l_int|11
comma
id|NodeAddr45
op_assign
l_int|12
comma
DECL|enumerator|DriverTune
DECL|enumerator|Checksum
id|DriverTune
op_assign
l_int|13
comma
id|Checksum
op_assign
l_int|15
)brace
suffix:semicolon
DECL|enum|Window2
r_enum
id|Window2
(brace
multiline_comment|/* Window 2. */
DECL|enumerator|Wn2_ResetOptions
id|Wn2_ResetOptions
op_assign
l_int|12
comma
)brace
suffix:semicolon
DECL|enum|Window3
r_enum
id|Window3
(brace
multiline_comment|/* Window 3: MAC/config bits. */
DECL|enumerator|Wn3_Config
DECL|enumerator|Wn3_MAC_Ctrl
DECL|enumerator|Wn3_Options
id|Wn3_Config
op_assign
l_int|0
comma
id|Wn3_MAC_Ctrl
op_assign
l_int|6
comma
id|Wn3_Options
op_assign
l_int|8
comma
)brace
suffix:semicolon
DECL|macro|BFEXT
mdefine_line|#define BFEXT(value, offset, bitcount)  &bslash;&n;    ((((unsigned long)(value)) &gt;&gt; (offset)) &amp; ((1 &lt;&lt; (bitcount)) - 1))
DECL|macro|BFINS
mdefine_line|#define BFINS(lhs, rhs, offset, bitcount)&t;&t;&t;&t;&t;&bslash;&n;&t;(((lhs) &amp; ~((((1 &lt;&lt; (bitcount)) - 1)) &lt;&lt; (offset))) |&t;&bslash;&n;&t;(((rhs) &amp; ((1 &lt;&lt; (bitcount)) - 1)) &lt;&lt; (offset)))
DECL|macro|RAM_SIZE
mdefine_line|#define RAM_SIZE(v)&t;&t;BFEXT(v, 0, 3)
DECL|macro|RAM_WIDTH
mdefine_line|#define RAM_WIDTH(v)&t;BFEXT(v, 3, 1)
DECL|macro|RAM_SPEED
mdefine_line|#define RAM_SPEED(v)&t;BFEXT(v, 4, 2)
DECL|macro|ROM_SIZE
mdefine_line|#define ROM_SIZE(v)&t;&t;BFEXT(v, 6, 2)
DECL|macro|RAM_SPLIT
mdefine_line|#define RAM_SPLIT(v)&t;BFEXT(v, 16, 2)
DECL|macro|XCVR
mdefine_line|#define XCVR(v)&t;&t;&t;BFEXT(v, 20, 4)
DECL|macro|AUTOSELECT
mdefine_line|#define AUTOSELECT(v)&t;BFEXT(v, 24, 1)
DECL|enum|Window4
r_enum
id|Window4
(brace
multiline_comment|/* Window 4: Xcvr/media bits. */
DECL|enumerator|Wn4_FIFODiag
DECL|enumerator|Wn4_NetDiag
DECL|enumerator|Wn4_PhysicalMgmt
DECL|enumerator|Wn4_Media
id|Wn4_FIFODiag
op_assign
l_int|4
comma
id|Wn4_NetDiag
op_assign
l_int|6
comma
id|Wn4_PhysicalMgmt
op_assign
l_int|8
comma
id|Wn4_Media
op_assign
l_int|10
comma
)brace
suffix:semicolon
DECL|enum|Win4_Media_bits
r_enum
id|Win4_Media_bits
(brace
DECL|enumerator|Media_SQE
id|Media_SQE
op_assign
l_int|0x0008
comma
multiline_comment|/* Enable SQE error counting for AUI. */
DECL|enumerator|Media_10TP
id|Media_10TP
op_assign
l_int|0x00C0
comma
multiline_comment|/* Enable link beat and jabber for 10baseT. */
DECL|enumerator|Media_Lnk
id|Media_Lnk
op_assign
l_int|0x0080
comma
multiline_comment|/* Enable just link beat for 100TX/100FX. */
DECL|enumerator|Media_LnkBeat
id|Media_LnkBeat
op_assign
l_int|0x0800
comma
)brace
suffix:semicolon
DECL|enum|Window7
r_enum
id|Window7
(brace
multiline_comment|/* Window 7: Bus Master control. */
DECL|enumerator|Wn7_MasterAddr
DECL|enumerator|Wn7_MasterLen
DECL|enumerator|Wn7_MasterStatus
id|Wn7_MasterAddr
op_assign
l_int|0
comma
id|Wn7_MasterLen
op_assign
l_int|6
comma
id|Wn7_MasterStatus
op_assign
l_int|12
comma
)brace
suffix:semicolon
multiline_comment|/* Boomerang bus master control registers. */
DECL|enum|MasterCtrl
r_enum
id|MasterCtrl
(brace
DECL|enumerator|PktStatus
DECL|enumerator|DownListPtr
DECL|enumerator|FragAddr
DECL|enumerator|FragLen
id|PktStatus
op_assign
l_int|0x20
comma
id|DownListPtr
op_assign
l_int|0x24
comma
id|FragAddr
op_assign
l_int|0x28
comma
id|FragLen
op_assign
l_int|0x2c
comma
DECL|enumerator|TxFreeThreshold
DECL|enumerator|UpPktStatus
DECL|enumerator|UpListPtr
id|TxFreeThreshold
op_assign
l_int|0x2f
comma
id|UpPktStatus
op_assign
l_int|0x30
comma
id|UpListPtr
op_assign
l_int|0x38
comma
)brace
suffix:semicolon
multiline_comment|/* The Rx and Tx descriptor lists.&n;   Caution Alpha hackers: these types are 32 bits!  Note also the 8 byte&n;   alignment contraint on tx_ring[] and rx_ring[]. */
DECL|macro|LAST_FRAG
mdefine_line|#define LAST_FRAG &t;0x80000000&t;&t;&t;/* Last Addr/Len pair in descriptor. */
DECL|macro|DN_COMPLETE
mdefine_line|#define DN_COMPLETE&t;0x00010000&t;&t;&t;/* This packet has been downloaded */
DECL|struct|boom_rx_desc
r_struct
id|boom_rx_desc
(brace
DECL|member|next
id|u32
id|next
suffix:semicolon
multiline_comment|/* Last entry points to 0.   */
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|addr
id|u32
id|addr
suffix:semicolon
multiline_comment|/* Up to 63 addr/len pairs possible. */
DECL|member|length
id|s32
id|length
suffix:semicolon
multiline_comment|/* Set LAST_FRAG to indicate last pair. */
)brace
suffix:semicolon
multiline_comment|/* Values for the Rx status entry. */
DECL|enum|rx_desc_status
r_enum
id|rx_desc_status
(brace
DECL|enumerator|RxDComplete
DECL|enumerator|RxDError
id|RxDComplete
op_assign
l_int|0x00008000
comma
id|RxDError
op_assign
l_int|0x4000
comma
multiline_comment|/* See boomerang_rx() for actual error bits */
DECL|enumerator|IPChksumErr
DECL|enumerator|TCPChksumErr
DECL|enumerator|UDPChksumErr
id|IPChksumErr
op_assign
l_int|1
op_lshift
l_int|25
comma
id|TCPChksumErr
op_assign
l_int|1
op_lshift
l_int|26
comma
id|UDPChksumErr
op_assign
l_int|1
op_lshift
l_int|27
comma
DECL|enumerator|IPChksumValid
DECL|enumerator|TCPChksumValid
DECL|enumerator|UDPChksumValid
id|IPChksumValid
op_assign
l_int|1
op_lshift
l_int|29
comma
id|TCPChksumValid
op_assign
l_int|1
op_lshift
l_int|30
comma
id|UDPChksumValid
op_assign
l_int|1
op_lshift
l_int|31
comma
)brace
suffix:semicolon
DECL|struct|boom_tx_desc
r_struct
id|boom_tx_desc
(brace
DECL|member|next
id|u32
id|next
suffix:semicolon
multiline_comment|/* Last entry points to 0.   */
DECL|member|status
id|s32
id|status
suffix:semicolon
multiline_comment|/* bits 0:12 length, others see below.  */
DECL|member|addr
id|u32
id|addr
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Values for the Tx status entry. */
DECL|enum|tx_desc_status
r_enum
id|tx_desc_status
(brace
DECL|enumerator|CRCDisable
DECL|enumerator|TxDComplete
id|CRCDisable
op_assign
l_int|0x2000
comma
id|TxDComplete
op_assign
l_int|0x8000
comma
DECL|enumerator|AddIPChksum
DECL|enumerator|AddTCPChksum
DECL|enumerator|AddUDPChksum
id|AddIPChksum
op_assign
l_int|0x02000000
comma
id|AddTCPChksum
op_assign
l_int|0x04000000
comma
id|AddUDPChksum
op_assign
l_int|0x08000000
comma
DECL|enumerator|TxIntrUploaded
id|TxIntrUploaded
op_assign
l_int|0x80000000
comma
multiline_comment|/* IRQ when in FIFO, but maybe not sent. */
)brace
suffix:semicolon
multiline_comment|/* Chip features we care about in vp-&gt;capabilities, read from the EEPROM. */
DECL|enum|ChipCaps
DECL|enumerator|CapBusMaster
DECL|enumerator|CapPwrMgmt
r_enum
id|ChipCaps
(brace
id|CapBusMaster
op_assign
l_int|0x20
comma
id|CapPwrMgmt
op_assign
l_int|0x2000
)brace
suffix:semicolon
DECL|struct|vortex_private
r_struct
id|vortex_private
(brace
multiline_comment|/* The Rx and Tx rings should be quad-word-aligned. */
DECL|member|rx_ring
r_struct
id|boom_rx_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring
r_struct
id|boom_tx_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|rx_ring_dma
id|dma_addr_t
id|rx_ring_dma
suffix:semicolon
DECL|member|tx_ring_dma
id|dma_addr_t
id|tx_ring_dma
suffix:semicolon
multiline_comment|/* The addresses of transmit- and receive-in-place skbuffs. */
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
DECL|member|next_module
r_struct
id|net_device
op_star
id|next_module
suffix:semicolon
multiline_comment|/* NULL if PCI device */
DECL|member|cur_rx
DECL|member|cur_tx
r_int
r_int
id|cur_rx
comma
id|cur_tx
suffix:semicolon
multiline_comment|/* The next free ring entry */
DECL|member|dirty_rx
DECL|member|dirty_tx
r_int
r_int
id|dirty_rx
comma
id|dirty_tx
suffix:semicolon
multiline_comment|/* The ring entries to be free()ed. */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|tx_skb
r_struct
id|sk_buff
op_star
id|tx_skb
suffix:semicolon
multiline_comment|/* Packet being eaten by bus master ctrl.  */
DECL|member|tx_skb_dma
id|dma_addr_t
id|tx_skb_dma
suffix:semicolon
multiline_comment|/* Allocated DMA address for bus master ctrl DMA.   */
multiline_comment|/* PCI configuration space information. */
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|cb_fn_base
r_char
op_star
id|cb_fn_base
suffix:semicolon
multiline_comment|/* CardBus function status addr space. */
multiline_comment|/* The remainder are related to chip state, mostly media selection. */
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Media selection timer. */
DECL|member|rx_oom_timer
r_struct
id|timer_list
id|rx_oom_timer
suffix:semicolon
multiline_comment|/* Rx skb allocation retry timer */
DECL|member|options
r_int
id|options
suffix:semicolon
multiline_comment|/* User-settable misc. driver options. */
DECL|member|media_override
r_int
r_int
id|media_override
suffix:colon
l_int|4
comma
multiline_comment|/* Passed-in media type. */
DECL|member|default_media
id|default_media
suffix:colon
l_int|4
comma
multiline_comment|/* Read from the EEPROM/Wn3_Config. */
DECL|member|full_duplex
DECL|member|force_fd
DECL|member|autoselect
id|full_duplex
suffix:colon
l_int|1
comma
id|force_fd
suffix:colon
l_int|1
comma
id|autoselect
suffix:colon
l_int|1
comma
DECL|member|bus_master
id|bus_master
suffix:colon
l_int|1
comma
multiline_comment|/* Vortex can only do a fragment bus-m. */
DECL|member|full_bus_master_tx
DECL|member|full_bus_master_rx
id|full_bus_master_tx
suffix:colon
l_int|1
comma
id|full_bus_master_rx
suffix:colon
l_int|2
comma
multiline_comment|/* Boomerang  */
DECL|member|flow_ctrl
id|flow_ctrl
suffix:colon
l_int|1
comma
multiline_comment|/* Use 802.3x flow control (PAUSE only) */
DECL|member|partner_flow_ctrl
id|partner_flow_ctrl
suffix:colon
l_int|1
comma
multiline_comment|/* Partner supports flow control */
DECL|member|tx_full
id|tx_full
suffix:colon
l_int|1
comma
DECL|member|has_nway
id|has_nway
suffix:colon
l_int|1
comma
DECL|member|open
id|open
suffix:colon
l_int|1
comma
DECL|member|must_free_region
id|must_free_region
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Flag: if zero, Cardbus owns the I/O region */
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
DECL|member|status_enable
id|u16
id|status_enable
suffix:semicolon
DECL|member|intr_enable
id|u16
id|intr_enable
suffix:semicolon
DECL|member|available_media
id|u16
id|available_media
suffix:semicolon
multiline_comment|/* From Wn3_Options. */
DECL|member|capabilities
DECL|member|info1
DECL|member|info2
id|u16
id|capabilities
comma
id|info1
comma
id|info2
suffix:semicolon
multiline_comment|/* Various, from EEPROM. */
DECL|member|advertising
id|u16
id|advertising
suffix:semicolon
multiline_comment|/* NWay media advertisement */
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|deferred
id|u16
id|deferred
suffix:semicolon
multiline_comment|/* Resend these interrupts when we&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t; * bale from the ISR */
DECL|member|io_size
id|u16
id|io_size
suffix:semicolon
multiline_comment|/* Size of PCI region (for release_region) */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* Serialise access to device &amp; its vortex_private */
DECL|member|mdio_lock
id|spinlock_t
id|mdio_lock
suffix:semicolon
multiline_comment|/* Serialise access to mdio hardware */
)brace
suffix:semicolon
multiline_comment|/* The action to take with a media selection timer tick.&n;   Note that we deviate from the 3Com order by checking 10base2 before AUI.&n; */
DECL|enum|xcvr_types
r_enum
id|xcvr_types
(brace
DECL|enumerator|XCVR_10baseT
DECL|enumerator|XCVR_AUI
DECL|enumerator|XCVR_10baseTOnly
DECL|enumerator|XCVR_10base2
DECL|enumerator|XCVR_100baseTx
id|XCVR_10baseT
op_assign
l_int|0
comma
id|XCVR_AUI
comma
id|XCVR_10baseTOnly
comma
id|XCVR_10base2
comma
id|XCVR_100baseTx
comma
DECL|enumerator|XCVR_100baseFx
DECL|enumerator|XCVR_MII
DECL|enumerator|XCVR_NWAY
DECL|enumerator|XCVR_ExtMII
DECL|enumerator|XCVR_Default
id|XCVR_100baseFx
comma
id|XCVR_MII
op_assign
l_int|6
comma
id|XCVR_NWAY
op_assign
l_int|8
comma
id|XCVR_ExtMII
op_assign
l_int|9
comma
id|XCVR_Default
op_assign
l_int|10
comma
)brace
suffix:semicolon
DECL|struct|media_table
r_static
r_struct
id|media_table
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|media_bits
r_int
r_int
id|media_bits
suffix:colon
l_int|16
comma
multiline_comment|/* Bits to set in Wn4_Media register. */
DECL|member|mask
id|mask
suffix:colon
l_int|8
comma
multiline_comment|/* The transceiver-present bit in Wn3_Config.*/
DECL|member|next
id|next
suffix:colon
l_int|8
suffix:semicolon
multiline_comment|/* The media type to try next. */
DECL|member|wait
r_int
id|wait
suffix:semicolon
multiline_comment|/* Time before we check media status. */
DECL|variable|media_tbl
)brace
id|media_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;10baseT&quot;
comma
id|Media_10TP
comma
l_int|0x08
comma
id|XCVR_10base2
comma
(paren
l_int|14
op_star
id|HZ
)paren
op_div
l_int|10
)brace
comma
(brace
l_string|&quot;10Mbs AUI&quot;
comma
id|Media_SQE
comma
l_int|0x20
comma
id|XCVR_Default
comma
(paren
l_int|1
op_star
id|HZ
)paren
op_div
l_int|10
)brace
comma
(brace
l_string|&quot;undefined&quot;
comma
l_int|0
comma
l_int|0x80
comma
id|XCVR_10baseT
comma
l_int|10000
)brace
comma
(brace
l_string|&quot;10base2&quot;
comma
l_int|0
comma
l_int|0x10
comma
id|XCVR_AUI
comma
(paren
l_int|1
op_star
id|HZ
)paren
op_div
l_int|10
)brace
comma
(brace
l_string|&quot;100baseTX&quot;
comma
id|Media_Lnk
comma
l_int|0x02
comma
id|XCVR_100baseFx
comma
(paren
l_int|14
op_star
id|HZ
)paren
op_div
l_int|10
)brace
comma
(brace
l_string|&quot;100baseFX&quot;
comma
id|Media_Lnk
comma
l_int|0x04
comma
id|XCVR_MII
comma
(paren
l_int|14
op_star
id|HZ
)paren
op_div
l_int|10
)brace
comma
(brace
l_string|&quot;MII&quot;
comma
l_int|0
comma
l_int|0x41
comma
id|XCVR_10baseT
comma
l_int|3
op_star
id|HZ
)brace
comma
(brace
l_string|&quot;undefined&quot;
comma
l_int|0
comma
l_int|0x01
comma
id|XCVR_10baseT
comma
l_int|10000
)brace
comma
(brace
l_string|&quot;Autonegotiate&quot;
comma
l_int|0
comma
l_int|0x41
comma
id|XCVR_10baseT
comma
l_int|3
op_star
id|HZ
)brace
comma
(brace
l_string|&quot;MII-External&quot;
comma
l_int|0
comma
l_int|0x41
comma
id|XCVR_10baseT
comma
l_int|3
op_star
id|HZ
)brace
comma
(brace
l_string|&quot;Default&quot;
comma
l_int|0
comma
l_int|0xFF
comma
id|XCVR_10baseT
comma
l_int|10000
)brace
comma
)brace
suffix:semicolon
r_static
r_int
id|vortex_probe1
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|chip_idx
comma
r_int
id|card_idx
)paren
suffix:semicolon
r_static
r_void
id|vortex_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|vortex_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|vortex_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|mdio_sync
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|bits
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|vp
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|vortex_timer
c_func
(paren
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|rx_oom_timer
c_func
(paren
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_int
id|vortex_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|boomerang_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|vortex_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|boomerang_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|vortex_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|boomerang_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|vortex_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|dump_tx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|update_stats
c_func
(paren
r_int
id|ioaddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|vortex_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|vortex_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|vortex_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|acpi_set_WOL
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
"&f;"
multiline_comment|/* This driver uses &squot;options&squot; to pass the media type, full-duplex flag, etc. */
multiline_comment|/* Option count limit only -- unlimited interfaces are supported. */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|flow_ctrl
r_static
r_int
id|flow_ctrl
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* #define dev_alloc_skb dev_alloc_skb_debug */
multiline_comment|/* A list of all installed Vortex EISA devices, for removing the driver module. */
DECL|variable|root_vortex_eisa_dev
r_static
r_struct
id|net_device
op_star
id|root_vortex_eisa_dev
suffix:semicolon
multiline_comment|/* Variables to work-around the Compaq PCI BIOS32 problem. */
DECL|variable|compaq_ioaddr
DECL|variable|compaq_irq
DECL|variable|compaq_device_id
r_static
r_int
id|compaq_ioaddr
comma
id|compaq_irq
comma
id|compaq_device_id
op_assign
l_int|0x5900
suffix:semicolon
DECL|variable|vortex_cards_found
r_static
r_int
id|vortex_cards_found
suffix:semicolon
DECL|function|vortex_suspend
r_static
r_void
id|vortex_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vortex_suspend(%s)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|dev-&gt;priv
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;open
)paren
(brace
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|vortex_down
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|vortex_resume
r_static
r_void
id|vortex_resume
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vortex_resume(%s)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|dev-&gt;priv
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;open
)paren
(brace
id|vortex_up
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* returns count found (&gt;= 0), or negative on error */
DECL|function|vortex_eisa_init
r_static
r_int
id|__init
id|vortex_eisa_init
(paren
r_void
)paren
(brace
r_int
id|ioaddr
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
id|orig_cards_found
op_assign
id|vortex_cards_found
suffix:semicolon
multiline_comment|/* Now check all slots of the EISA bus. */
r_if
c_cond
(paren
op_logical_neg
id|EISA_bus
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|ioaddr
op_assign
l_int|0x1000
suffix:semicolon
id|ioaddr
OL
l_int|0x9000
suffix:semicolon
id|ioaddr
op_add_assign
l_int|0x1000
)paren
(brace
r_int
id|device_id
suffix:semicolon
r_if
c_cond
(paren
id|request_region
c_func
(paren
id|ioaddr
comma
id|VORTEX_TOTAL_SIZE
comma
l_string|&quot;3c59x&quot;
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
multiline_comment|/* Check the standard EISA ID register for an encoded &squot;3Com&squot;. */
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0xC80
)paren
op_ne
l_int|0x6d50
)paren
(brace
id|release_region
(paren
id|ioaddr
comma
id|VORTEX_TOTAL_SIZE
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* Check for a product that we support, 3c59{2,7} any rev. */
id|device_id
op_assign
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0xC82
)paren
op_lshift
l_int|8
)paren
op_plus
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0xC83
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|device_id
op_amp
l_int|0xFF00
)paren
op_ne
l_int|0x5900
)paren
(brace
id|release_region
(paren
id|ioaddr
comma
id|VORTEX_TOTAL_SIZE
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rc
op_assign
id|vortex_probe1
c_func
(paren
l_int|NULL
comma
id|ioaddr
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0xC88
)paren
op_rshift
l_int|12
comma
id|EISA_TBL_OFFSET
comma
id|vortex_cards_found
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|vortex_cards_found
op_increment
suffix:semicolon
r_else
id|release_region
(paren
id|ioaddr
comma
id|VORTEX_TOTAL_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/* Special code to work-around the Compaq PCI BIOS32 problem. */
r_if
c_cond
(paren
id|compaq_ioaddr
)paren
(brace
id|vortex_probe1
c_func
(paren
l_int|NULL
comma
id|compaq_ioaddr
comma
id|compaq_irq
comma
id|compaq_device_id
comma
id|vortex_cards_found
op_increment
)paren
suffix:semicolon
)brace
r_return
id|vortex_cards_found
op_minus
id|orig_cards_found
suffix:semicolon
)brace
multiline_comment|/* returns count (&gt;= 0), or negative on error */
DECL|function|vortex_init_one
r_static
r_int
id|__devinit
id|vortex_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|vortex_probe1
(paren
id|pdev
comma
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pdev-&gt;irq
comma
id|ent-&gt;driver_data
comma
id|vortex_cards_found
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|vortex_cards_found
op_increment
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Start up the PCI device which is described by *pdev.&n; * Return 0 on success.&n; *&n; * NOTE: pdev can be NULL, for the case of an EISA driver&n; */
DECL|function|vortex_probe1
r_static
r_int
id|__devinit
id|vortex_probe1
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|chip_idx
comma
r_int
id|card_idx
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
suffix:semicolon
r_int
id|option
suffix:semicolon
r_int
r_int
id|eeprom
(braket
l_int|0x40
)braket
comma
id|checksum
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EEPROM contents */
r_int
id|i
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_static
r_int
id|printed_version
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|vortex_chip_info
op_star
r_const
id|vci
op_assign
op_amp
id|vortex_info_tbl
(braket
id|chip_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;See Documentation/networking/vortex.txt&bslash;n&quot;
)paren
suffix:semicolon
id|printed_version
op_assign
l_int|1
suffix:semicolon
)brace
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|vp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to allocate etherdev, aborting&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: 3Com %s %s at 0x%lx, &quot;
comma
id|dev-&gt;name
comma
id|pdev
ques
c_cond
l_string|&quot;PCI&quot;
suffix:colon
l_string|&quot;EISA&quot;
comma
id|vci-&gt;name
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* private struct aligned and zeroed by init_etherdev */
id|vp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
id|vp-&gt;drv_flags
op_assign
id|vci-&gt;drv_flags
suffix:semicolon
id|vp-&gt;has_nway
op_assign
(paren
id|vci-&gt;drv_flags
op_amp
id|HAS_NWAY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|vp-&gt;io_size
op_assign
id|vci-&gt;io_size
suffix:semicolon
multiline_comment|/* module list only for EISA devices */
r_if
c_cond
(paren
id|pdev
op_eq
l_int|NULL
)paren
(brace
id|vp-&gt;next_module
op_assign
id|root_vortex_eisa_dev
suffix:semicolon
id|root_vortex_eisa_dev
op_assign
id|dev
suffix:semicolon
)brace
multiline_comment|/* PCI-only startup logic */
r_if
c_cond
(paren
id|pdev
)paren
(brace
multiline_comment|/* EISA resources already marked, so only PCI needs to do this here */
multiline_comment|/* Ignore return value, because Cardbus drivers already allocate for us */
r_if
c_cond
(paren
id|request_region
c_func
(paren
id|ioaddr
comma
id|vci-&gt;io_size
comma
id|dev-&gt;name
)paren
op_ne
l_int|NULL
)paren
(brace
id|vp-&gt;must_free_region
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* wake up and enable device */
r_if
c_cond
(paren
id|pci_enable_device
(paren
id|pdev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|free_region
suffix:semicolon
)brace
multiline_comment|/* enable bus-mastering if necessary */
r_if
c_cond
(paren
id|vci-&gt;flags
op_amp
id|PCI_USES_MASTER
)paren
id|pci_set_master
(paren
id|pdev
)paren
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|vp-&gt;mdio_lock
)paren
suffix:semicolon
id|vp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
multiline_comment|/* Makes sure rings are at least 16 byte aligned. */
id|vp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|boom_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|boom_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
op_amp
id|vp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;rx_ring
op_eq
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|free_region
suffix:semicolon
)brace
id|vp-&gt;tx_ring
op_assign
(paren
r_struct
id|boom_tx_desc
op_star
)paren
(paren
id|vp-&gt;rx_ring
op_plus
id|RX_RING_SIZE
)paren
suffix:semicolon
id|vp-&gt;tx_ring_dma
op_assign
id|vp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|boom_rx_desc
)paren
op_star
id|RX_RING_SIZE
suffix:semicolon
multiline_comment|/* if we are a PCI driver, we store info in pdev-&gt;driver_data&n;&t; * instead of a module list */
r_if
c_cond
(paren
id|pdev
)paren
id|pdev-&gt;driver_data
op_assign
id|dev
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
(brace
multiline_comment|/*&n;&t;&t; * AKPM: ewww..  The &squot;options&squot; param is passed in as the third arg to the&n;&t;&t; * LILO &squot;ether=&squot; argument for non-modular use&n;&t;&t; */
id|option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|card_idx
OL
id|MAX_UNITS
)paren
id|option
op_assign
id|options
(braket
id|card_idx
)braket
suffix:semicolon
r_else
id|option
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;media_override
op_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|option
op_ge
l_int|0
)paren
(brace
id|vp-&gt;media_override
op_assign
(paren
(paren
id|option
op_amp
l_int|7
)paren
op_eq
l_int|2
)paren
ques
c_cond
l_int|0
suffix:colon
id|option
op_amp
l_int|15
suffix:semicolon
id|vp-&gt;full_duplex
op_assign
(paren
id|option
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|vp-&gt;bus_master
op_assign
(paren
id|option
op_amp
l_int|16
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card_idx
OL
id|MAX_UNITS
)paren
(brace
r_if
c_cond
(paren
id|full_duplex
(braket
id|card_idx
)braket
OG
l_int|0
)paren
id|vp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|flow_ctrl
(braket
id|card_idx
)braket
OG
l_int|0
)paren
id|vp-&gt;flow_ctrl
op_assign
l_int|1
suffix:semicolon
)brace
id|vp-&gt;force_fd
op_assign
id|vp-&gt;full_duplex
suffix:semicolon
id|vp-&gt;options
op_assign
id|option
suffix:semicolon
multiline_comment|/* Read the station address from the EEPROM. */
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
(brace
r_int
id|base
suffix:semicolon
r_if
c_cond
(paren
id|vci-&gt;drv_flags
op_amp
id|EEPROM_8BIT
)paren
id|base
op_assign
l_int|0x230
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vci-&gt;drv_flags
op_amp
id|EEPROM_OFFSET
)paren
id|base
op_assign
id|EEPROM_Read
op_plus
l_int|0x30
suffix:semicolon
r_else
id|base
op_assign
id|EEPROM_Read
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x40
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|timer
suffix:semicolon
id|outw
c_func
(paren
id|base
op_plus
id|i
comma
id|ioaddr
op_plus
id|Wn0EepromCmd
)paren
suffix:semicolon
multiline_comment|/* Pause for at least 162 us. for the read to take place. */
r_for
c_loop
(paren
id|timer
op_assign
l_int|10
suffix:semicolon
id|timer
op_ge
l_int|0
suffix:semicolon
id|timer
op_decrement
)paren
(brace
id|udelay
c_func
(paren
l_int|162
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn0EepromCmd
)paren
op_amp
l_int|0x8000
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|eeprom
(braket
id|i
)braket
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn0EepromData
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x18
suffix:semicolon
id|i
op_increment
)paren
id|checksum
op_xor_assign
id|eeprom
(braket
id|i
)braket
suffix:semicolon
id|checksum
op_assign
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|8
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|checksum
op_ne
l_int|0x00
)paren
(brace
multiline_comment|/* Grrr, needless incompatible change 3Com. */
r_while
c_loop
(paren
id|i
OL
l_int|0x21
)paren
id|checksum
op_xor_assign
id|eeprom
(braket
id|i
op_increment
)braket
suffix:semicolon
id|checksum
op_assign
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|8
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|checksum
op_ne
l_int|0x00
)paren
op_logical_and
op_logical_neg
(paren
id|vci-&gt;drv_flags
op_amp
id|IS_TORNADO
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; ***INVALID CHECKSUM %4.4x*** &quot;
comma
id|checksum
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
(braket
id|i
)braket
op_assign
id|htons
c_func
(paren
id|eeprom
(braket
id|i
op_plus
l_int|10
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%c%2.2x&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|outb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
macro_line|#ifdef __sparc__
id|printk
c_func
(paren
l_string|&quot;, IRQ %s&bslash;n&quot;
comma
id|__irq_itoa
c_func
(paren
id|dev-&gt;irq
)paren
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;, IRQ %d&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Tell them about an invalid IRQ. */
r_if
c_cond
(paren
id|vortex_debug
op_logical_and
(paren
id|dev-&gt;irq
op_le
l_int|0
op_logical_or
id|dev-&gt;irq
op_ge
id|NR_IRQS
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; *** Warning: IRQ %d is unlikely to work! ***&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pdev
op_logical_and
id|vci-&gt;drv_flags
op_amp
id|HAS_CB_FNS
)paren
(brace
r_int
r_int
id|fn_st_addr
suffix:semicolon
multiline_comment|/* Cardbus function status space */
r_int
r_int
id|n
suffix:semicolon
id|fn_st_addr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn_st_addr
)paren
id|vp-&gt;cb_fn_base
op_assign
id|ioremap
c_func
(paren
id|fn_st_addr
comma
l_int|128
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: CardBus functions mapped %8.8lx-&gt;%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fn_st_addr
comma
id|vp-&gt;cb_fn_base
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|n
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn2_ResetOptions
)paren
op_amp
op_complement
l_int|0x4010
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|INVERT_LED_PWR
)paren
id|n
op_or_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|INVERT_MII_PWR
)paren
id|n
op_or_assign
l_int|0x4000
suffix:semicolon
id|outw
c_func
(paren
id|n
comma
id|ioaddr
op_plus
id|Wn2_ResetOptions
)paren
suffix:semicolon
)brace
multiline_comment|/* Extract our information from the EEPROM data. */
id|vp-&gt;info1
op_assign
id|eeprom
(braket
l_int|13
)braket
suffix:semicolon
id|vp-&gt;info2
op_assign
id|eeprom
(braket
l_int|15
)braket
suffix:semicolon
id|vp-&gt;capabilities
op_assign
id|eeprom
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;info1
op_amp
l_int|0x8000
)paren
(brace
id|vp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Full duplex capable&bslash;n&quot;
)paren
suffix:semicolon
)brace
(brace
r_static
r_const
r_char
op_star
id|ram_split
(braket
)braket
op_assign
(brace
l_string|&quot;5:3&quot;
comma
l_string|&quot;3:1&quot;
comma
l_string|&quot;1:1&quot;
comma
l_string|&quot;3:5&quot;
)brace
suffix:semicolon
r_int
r_int
id|config
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|vp-&gt;available_media
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn3_Options
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp-&gt;available_media
op_amp
l_int|0xff
)paren
op_eq
l_int|0
)paren
multiline_comment|/* Broken 3c916 */
id|vp-&gt;available_media
op_assign
l_int|0x40
suffix:semicolon
id|config
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|Wn3_Config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Internal config register is %4.4x, &quot;
l_string|&quot;transceivers %#x.&bslash;n&quot;
comma
id|config
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn3_Options
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  %dK %s-wide RAM %s Rx:Tx split, %s%s interface.&bslash;n&quot;
comma
l_int|8
op_lshift
id|RAM_SIZE
c_func
(paren
id|config
)paren
comma
id|RAM_WIDTH
c_func
(paren
id|config
)paren
ques
c_cond
l_string|&quot;word&quot;
suffix:colon
l_string|&quot;byte&quot;
comma
id|ram_split
(braket
id|RAM_SPLIT
c_func
(paren
id|config
)paren
)braket
comma
id|AUTOSELECT
c_func
(paren
id|config
)paren
ques
c_cond
l_string|&quot;autoselect/&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|XCVR
c_func
(paren
id|config
)paren
OG
id|XCVR_ExtMII
ques
c_cond
l_string|&quot;&lt;invalid transceiver&gt;&quot;
suffix:colon
id|media_tbl
(braket
id|XCVR
c_func
(paren
id|config
)paren
)braket
dot
id|name
)paren
suffix:semicolon
id|vp-&gt;default_media
op_assign
id|XCVR
c_func
(paren
id|config
)paren
suffix:semicolon
id|vp-&gt;autoselect
op_assign
id|AUTOSELECT
c_func
(paren
id|config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;media_override
op_ne
l_int|7
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  Media override to transceiver type %d (%s).&bslash;n&quot;
comma
id|vp-&gt;media_override
comma
id|media_tbl
(braket
id|vp-&gt;media_override
)braket
dot
id|name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|vp-&gt;media_override
suffix:semicolon
)brace
r_else
id|dev-&gt;if_port
op_assign
id|vp-&gt;default_media
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_MII
op_logical_or
id|dev-&gt;if_port
op_eq
id|XCVR_NWAY
)paren
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mii_preamble_required
op_increment
suffix:semicolon
id|mii_preamble_required
op_increment
suffix:semicolon
id|mdio_read
c_func
(paren
id|dev
comma
l_int|24
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|1
suffix:semicolon
id|phy
op_le
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|vp-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
comma
id|phyx
op_assign
id|phy
op_amp
l_int|0x1f
suffix:semicolon
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phyx
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_logical_and
id|mii_status
op_ne
l_int|0xffff
)paren
(brace
id|vp-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phyx
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  MII transceiver found at address %d,&quot;
l_string|&quot; status %4x.&bslash;n&quot;
comma
id|phyx
comma
id|mii_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_status
op_amp
l_int|0x0040
)paren
op_eq
l_int|0
)paren
id|mii_preamble_required
op_increment
suffix:semicolon
)brace
)brace
id|mii_preamble_required
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;  ***WARNING*** No MII transceivers found!&bslash;n&quot;
)paren
suffix:semicolon
id|vp-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|24
suffix:semicolon
)brace
r_else
(brace
id|vp-&gt;advertising
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_duplex
)paren
(brace
multiline_comment|/* Only advertise the FD media types. */
id|vp-&gt;advertising
op_and_assign
op_complement
l_int|0x02A0
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|4
comma
id|vp-&gt;advertising
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|vp-&gt;capabilities
op_amp
id|CapPwrMgmt
)paren
id|acpi_set_WOL
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;capabilities
op_amp
id|CapBusMaster
)paren
(brace
id|vp-&gt;full_bus_master_tx
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  Enabling bus-master transmits and %s receives.&bslash;n&quot;
comma
(paren
id|vp-&gt;info2
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;early&quot;
suffix:colon
l_string|&quot;whole-frame&quot;
)paren
suffix:semicolon
id|vp-&gt;full_bus_master_rx
op_assign
(paren
id|vp-&gt;info2
op_amp
l_int|1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|2
suffix:semicolon
id|vp-&gt;bus_master
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* AKPM: vortex only */
)brace
multiline_comment|/* The 3c59x-specific entries in the device structure. */
id|dev-&gt;open
op_assign
id|vortex_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|vp-&gt;full_bus_master_tx
ques
c_cond
id|boomerang_start_xmit
suffix:colon
id|vortex_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
id|vortex_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|vortex_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|vortex_ioctl
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_rx_mode
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|vortex_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
(paren
id|watchdog
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free_region
suffix:colon
r_if
c_cond
(paren
id|vp-&gt;must_free_region
)paren
id|release_region
c_func
(paren
id|ioaddr
comma
id|vci-&gt;io_size
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;vortex_probe1 fails.  Returns %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|wait_for_completion
r_static
r_void
id|wait_for_completion
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|cmd
)paren
(brace
r_int
id|i
op_assign
l_int|4000
suffix:semicolon
id|outw
c_func
(paren
id|cmd
comma
id|dev-&gt;base_addr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|i
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|EL3_STATUS
)paren
op_amp
id|CmdInProgress
)paren
)paren
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: command 0x%04x did not complete! Status=0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cmd
comma
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_up
id|vortex_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|config
suffix:semicolon
r_int
id|i
comma
id|device_id
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;pdev
)paren
id|device_id
op_assign
id|vp-&gt;pdev-&gt;device
suffix:semicolon
r_else
id|device_id
op_assign
l_int|0x5900
suffix:semicolon
multiline_comment|/* EISA */
multiline_comment|/* Before initializing select the active media port. */
id|EL3WINDOW
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|config
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|Wn3_Config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;media_override
op_ne
l_int|7
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media override to transceiver %d (%s).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|vp-&gt;media_override
comma
id|media_tbl
(braket
id|vp-&gt;media_override
)braket
dot
id|name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|vp-&gt;media_override
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vp-&gt;autoselect
)paren
(brace
r_if
c_cond
(paren
id|vp-&gt;has_nway
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: using NWAY autonegotiation&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|XCVR_NWAY
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Find first available media type, starting with 100baseTx. */
id|dev-&gt;if_port
op_assign
id|XCVR_100baseTx
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|vp-&gt;available_media
op_amp
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|mask
)paren
)paren
id|dev-&gt;if_port
op_assign
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|next
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: first available media type: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|dev-&gt;if_port
op_assign
id|vp-&gt;default_media
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: using default media %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|vp-&gt;timer
)paren
suffix:semicolon
id|vp-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|wait
)paren
suffix:semicolon
id|vp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|vp-&gt;timer.function
op_assign
id|vortex_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|vp-&gt;timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|vp-&gt;rx_oom_timer
)paren
suffix:semicolon
id|vp-&gt;rx_oom_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|vp-&gt;rx_oom_timer.function
op_assign
id|rx_oom_timer
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Initial media type %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
id|vp-&gt;full_duplex
op_assign
id|vp-&gt;force_fd
suffix:semicolon
id|config
op_assign
id|BFINS
c_func
(paren
id|config
comma
id|dev-&gt;if_port
comma
l_int|20
comma
l_int|4
)paren
suffix:semicolon
singleline_comment|//AKPM&t;if (!vp-&gt;has_nway)
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vortex_up(): writing 0x%x to InternalConfig&bslash;n&quot;
comma
id|config
)paren
suffix:semicolon
id|outl
c_func
(paren
id|config
comma
id|ioaddr
op_plus
id|Wn3_Config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_MII
op_logical_or
id|dev-&gt;if_port
op_eq
id|XCVR_NWAY
)paren
(brace
r_int
id|mii_reg1
comma
id|mii_reg5
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Read BMSR (reg1) only to clear old status. */
id|mii_reg1
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
suffix:semicolon
id|mii_reg5
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_reg5
op_eq
l_int|0xffff
op_logical_or
id|mii_reg5
op_eq
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* No MII device or no link partner report */
r_else
r_if
c_cond
(paren
(paren
id|mii_reg5
op_amp
l_int|0x0100
)paren
op_ne
l_int|0
multiline_comment|/* 100baseTx-FD */
op_logical_or
(paren
id|mii_reg5
op_amp
l_int|0x00C0
)paren
op_eq
l_int|0x0040
)paren
multiline_comment|/* 10T-FD, but not 100-HD */
id|vp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|vp-&gt;partner_flow_ctrl
op_assign
(paren
(paren
id|mii_reg5
op_amp
l_int|0x0400
)paren
op_ne
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII #%d status %4.4x, link partner capability %4.4x,&quot;
l_string|&quot; setting %s-duplex.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
id|mii_reg1
comma
id|mii_reg5
comma
id|vp-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|3
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the full-duplex bit. */
id|outw
c_func
(paren
(paren
(paren
id|vp-&gt;info1
op_amp
l_int|0x8000
)paren
op_logical_or
id|vp-&gt;full_duplex
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_or
(paren
id|dev-&gt;mtu
OG
l_int|1500
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|vp-&gt;full_duplex
op_logical_and
id|vp-&gt;flow_ctrl
op_logical_and
id|vp-&gt;partner_flow_ctrl
)paren
ques
c_cond
l_int|0x100
suffix:colon
l_int|0
)paren
comma
id|ioaddr
op_plus
id|Wn3_MAC_Ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: vortex_up() InternalConfig %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|config
)paren
suffix:semicolon
)brace
id|wait_for_completion
c_func
(paren
id|dev
comma
id|TxReset
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|dev
comma
id|RxReset
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetStatusEnb
op_or
l_int|0x00
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
(brace
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: vortex_up() irq %d media status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn4_Media
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the station address and mask in window 2 each time opened. */
id|EL3WINDOW
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|outb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|outw
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;cb_fn_base
)paren
(brace
r_int
r_int
id|n
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn2_ResetOptions
)paren
op_amp
op_complement
l_int|0x4010
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|INVERT_LED_PWR
)paren
id|n
op_or_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|INVERT_MII_PWR
)paren
id|n
op_or_assign
l_int|0x4000
suffix:semicolon
id|outw
c_func
(paren
id|n
comma
id|ioaddr
op_plus
id|Wn2_ResetOptions
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_10base2
)paren
multiline_comment|/* Start the thinnet transceiver. We should really wait 50ms...*/
id|outw
c_func
(paren
id|StartCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_ne
id|XCVR_NWAY
)paren
(brace
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn4_Media
)paren
op_amp
op_complement
(paren
id|Media_10TP
op_or
id|Media_SQE
)paren
)paren
op_or
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|media_bits
comma
id|ioaddr
op_plus
id|Wn4_Media
)paren
suffix:semicolon
)brace
multiline_comment|/* Switch to the stats window, and clear all stats by reading. */
id|outw
c_func
(paren
id|StatsDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* New: On the Vortex we must also clear the BadSSD counter. */
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* ..and on the Boomerang we enable the extra statistics bits. */
id|outw
c_func
(paren
l_int|0x0040
comma
id|ioaddr
op_plus
id|Wn4_NetDiag
)paren
suffix:semicolon
multiline_comment|/* Switch to register set 7 for normal use. */
id|EL3WINDOW
c_func
(paren
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_rx
)paren
(brace
multiline_comment|/* Boomerang bus master. */
id|vp-&gt;cur_rx
op_assign
id|vp-&gt;dirty_rx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialize the RxEarly register as recommended. */
id|outw
c_func
(paren
id|SetRxThreshold
op_plus
(paren
l_int|1536
op_rshift
l_int|2
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0020
comma
id|ioaddr
op_plus
id|PktStatus
)paren
suffix:semicolon
id|outl
c_func
(paren
id|vp-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|UpListPtr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
(brace
multiline_comment|/* Boomerang bus master Tx. */
id|vp-&gt;cur_tx
op_assign
id|vp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|IS_BOOMERANG
)paren
id|outb
c_func
(paren
id|PKT_BUF_SZ
op_rshift
l_int|8
comma
id|ioaddr
op_plus
id|TxFreeThreshold
)paren
suffix:semicolon
multiline_comment|/* Room for a packet. */
multiline_comment|/* Clear the Rx, Tx rings. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* AKPM: this is done in vortex_open, too */
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|vp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|DownListPtr
)paren
suffix:semicolon
)brace
multiline_comment|/* Set receiver mode: presumably accept b-case and phys addr only. */
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|StatsEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Turn on statistics. */
id|outw
c_func
(paren
id|RxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable the receiver. */
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable transmitter. */
multiline_comment|/* Allow status bits to be seen. */
id|vp-&gt;status_enable
op_assign
id|SetStatusEnb
op_or
id|HostError
op_or
id|IntReq
op_or
id|StatsFull
op_or
id|TxComplete
op_or
(paren
id|vp-&gt;full_bus_master_tx
ques
c_cond
id|DownComplete
suffix:colon
id|TxAvailable
)paren
op_or
(paren
id|vp-&gt;full_bus_master_rx
ques
c_cond
id|UpComplete
suffix:colon
id|RxComplete
)paren
op_or
(paren
id|vp-&gt;bus_master
ques
c_cond
id|DMADone
suffix:colon
l_int|0
)paren
suffix:semicolon
id|vp-&gt;intr_enable
op_assign
id|SetIntrEnb
op_or
id|IntLatch
op_or
id|TxAvailable
op_or
(paren
id|vp-&gt;full_bus_master_rx
ques
c_cond
l_int|0
suffix:colon
id|RxComplete
)paren
op_or
id|StatsFull
op_or
id|HostError
op_or
id|TxComplete
op_or
id|IntReq
op_or
(paren
id|vp-&gt;bus_master
ques
c_cond
id|DMADone
suffix:colon
l_int|0
)paren
op_or
id|UpComplete
op_or
id|DownComplete
suffix:semicolon
id|outw
c_func
(paren
id|vp-&gt;status_enable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack all pending events, and set active indicator mask. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntLatch
op_or
id|TxAvailable
op_or
id|RxEarly
op_or
id|IntReq
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|vp-&gt;intr_enable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;cb_fn_base
)paren
multiline_comment|/* The PCMCIA people are idiots.  */
id|writel
c_func
(paren
l_int|0x8000
comma
id|vp-&gt;cb_fn_base
op_plus
l_int|4
)paren
suffix:semicolon
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_open
id|vortex_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|retval
suffix:semicolon
multiline_comment|/* Use the now-standard shared IRQ implementation. */
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|vp-&gt;full_bus_master_rx
ques
c_cond
op_amp
id|boomerang_interrupt
suffix:colon
op_amp
id|vortex_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Could not reserve IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_rx
)paren
(brace
multiline_comment|/* Boomerang bus master. */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Filling in the Rx ring.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|next
op_assign
id|cpu_to_le32
c_func
(paren
id|vp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|boom_rx_desc
)paren
op_star
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Clear complete bit. */
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
op_or
id|LAST_FRAG
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|vp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
multiline_comment|/* Bad news!  */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte boundaries */
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr
op_assign
id|cpu_to_le32
c_func
(paren
id|pci_map_single
c_func
(paren
id|vp-&gt;pdev
comma
id|skb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|RX_RING_SIZE
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|RX_RING_SIZE
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vp-&gt;rx_skbuff
(braket
id|j
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|vp-&gt;rx_skbuff
(braket
id|j
)braket
)paren
suffix:semicolon
id|vp-&gt;rx_skbuff
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_free_irq
suffix:semicolon
)brace
multiline_comment|/* Wrap the ring. */
id|vp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next
op_assign
id|cpu_to_le32
c_func
(paren
id|vp-&gt;rx_ring_dma
)paren
suffix:semicolon
)brace
id|vortex_up
c_func
(paren
id|dev
)paren
suffix:semicolon
id|vp-&gt;open
op_assign
l_int|1
suffix:semicolon
id|vp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: vortex_open() fails: returning %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|vortex_timer
r_static
r_void
id|vortex_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
r_int
id|ok
op_assign
l_int|0
suffix:semicolon
r_int
id|media_status
comma
id|mii_status
comma
id|old_window
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection timer tick happened, %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dev-&gt;watchdog_timeo=%d&bslash;n&quot;
comma
id|dev-&gt;watchdog_timeo
)paren
suffix:semicolon
)brace
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|old_window
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_CMD
)paren
op_rshift
l_int|13
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|media_status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn4_Media
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|XCVR_10baseT
suffix:colon
r_case
id|XCVR_100baseTx
suffix:colon
r_case
id|XCVR_100baseFx
suffix:colon
r_if
c_cond
(paren
id|media_status
op_amp
id|Media_LnkBeat
)paren
(brace
id|ok
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media %s has link beat, %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
comma
id|media_status
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media %s has no link beat, %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
comma
id|media_status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|XCVR_MII
suffix:colon
r_case
id|XCVR_NWAY
suffix:colon
(brace
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
suffix:semicolon
id|ok
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MII transceiver has status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mii_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_amp
l_int|0x0004
)paren
(brace
r_int
id|mii_reg5
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vp-&gt;force_fd
op_logical_and
id|mii_reg5
op_ne
l_int|0xffff
)paren
(brace
r_int
id|duplex
op_assign
(paren
id|mii_reg5
op_amp
l_int|0x0100
)paren
op_logical_or
(paren
id|mii_reg5
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_duplex
op_ne
id|duplex
)paren
(brace
id|vp-&gt;full_duplex
op_assign
id|duplex
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII &quot;
l_string|&quot;#%d link partner capability of %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|vp-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|vp-&gt;phys
(braket
l_int|0
)braket
comma
id|mii_reg5
)paren
suffix:semicolon
multiline_comment|/* Set the full-duplex bit. */
id|EL3WINDOW
c_func
(paren
l_int|3
)paren
suffix:semicolon
multiline_comment|/* AKPM: this was missing from 2.3.99 3c59x.c! */
id|outw
c_func
(paren
(paren
id|vp-&gt;full_duplex
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_or
(paren
id|dev-&gt;mtu
OG
l_int|1500
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|vp-&gt;full_duplex
op_logical_and
id|vp-&gt;flow_ctrl
op_logical_and
id|vp-&gt;partner_flow_ctrl
)paren
ques
c_cond
l_int|0x100
suffix:colon
l_int|0
)paren
comma
id|ioaddr
op_plus
id|Wn3_MAC_Ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Setting duplex in Wn3_MAC_Ctrl&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* AKPM: bug: should reset Tx and Rx after setting Duplex.  Page 180 */
)brace
)brace
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* Other media types handled by Tx timeouts. */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media %s has no indication, %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
comma
id|media_status
)paren
suffix:semicolon
id|ok
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
r_int
r_int
id|config
suffix:semicolon
r_do
(brace
id|dev-&gt;if_port
op_assign
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|next
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|vp-&gt;available_media
op_amp
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|mask
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_Default
)paren
(brace
multiline_comment|/* Go back to default. */
id|dev-&gt;if_port
op_assign
id|vp-&gt;default_media
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection failing, using default &quot;
l_string|&quot;%s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection failed, now trying &quot;
l_string|&quot;%s port.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
id|next_tick
op_assign
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|wait
suffix:semicolon
)brace
id|outw
c_func
(paren
(paren
id|media_status
op_amp
op_complement
(paren
id|Media_10TP
op_or
id|Media_SQE
)paren
)paren
op_or
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|media_bits
comma
id|ioaddr
op_plus
id|Wn4_Media
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|config
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|Wn3_Config
)paren
suffix:semicolon
id|config
op_assign
id|BFINS
c_func
(paren
id|config
comma
id|dev-&gt;if_port
comma
l_int|20
comma
l_int|4
)paren
suffix:semicolon
id|outl
c_func
(paren
id|config
comma
id|ioaddr
op_plus
id|Wn3_Config
)paren
suffix:semicolon
id|outw
c_func
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_10base2
ques
c_cond
id|StartCoax
suffix:colon
id|StopCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;wrote 0x%08x to Wn3_Config&bslash;n&quot;
comma
id|config
)paren
suffix:semicolon
multiline_comment|/* AKPM: FIXME: Should reset Rx &amp; Tx here.  P60 of 3c90xc.pdf */
)brace
id|EL3WINDOW
c_func
(paren
id|old_window
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection timer finished, %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_tbl
(braket
id|dev-&gt;if_port
)braket
dot
id|name
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|vp-&gt;timer
comma
id|RUN_AT
c_func
(paren
id|next_tick
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;deferred
)paren
id|outw
c_func
(paren
id|FakeIntr
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|vortex_tx_timeout
r_static
r_void
id|vortex_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: transmit timed out, tx_status %2.2x status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Slight code bloat to be user friendly. */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
op_amp
l_int|0x88
)paren
op_eq
l_int|0x88
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Transmitter encountered 16 collisions --&quot;
l_string|&quot; network cable problem?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
id|IntLatch
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Interrupt posted but not delivered --&quot;
l_string|&quot; IRQ blocked by another device?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Bad idea here.. but we might as well handle a few events. */
(brace
multiline_comment|/*&n;&t;&t;&t; * AKPM: block interrupts because vortex_interrupt&n;&t;&t;&t; * does a bare spin_lock()&n;&t;&t;&t; */
r_int
r_int
id|flags
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
id|boomerang_interrupt
c_func
(paren
id|dev-&gt;irq
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_else
id|vortex_interrupt
c_func
(paren
id|dev-&gt;irq
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
id|dump_tx_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|dev
comma
id|TxReset
)paren
suffix:semicolon
id|vp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Resetting the Tx ring pointer.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;cur_tx
op_minus
id|vp-&gt;dirty_tx
OG
l_int|0
op_logical_and
id|inl
c_func
(paren
id|ioaddr
op_plus
id|DownListPtr
)paren
op_eq
l_int|0
)paren
id|outl
c_func
(paren
id|vp-&gt;tx_ring_dma
op_plus
(paren
id|vp-&gt;dirty_tx
op_mod
id|TX_RING_SIZE
)paren
op_star
r_sizeof
(paren
r_struct
id|boom_tx_desc
)paren
comma
id|ioaddr
op_plus
id|DownListPtr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;tx_full
op_logical_and
(paren
id|vp-&gt;cur_tx
op_minus
id|vp-&gt;dirty_tx
op_le
id|TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
(brace
id|vp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;tx_full
)paren
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;drv_flags
op_amp
id|IS_BOOMERANG
)paren
id|outb
c_func
(paren
id|PKT_BUF_SZ
op_rshift
l_int|8
comma
id|ioaddr
op_plus
id|TxFreeThreshold
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DownUnstall
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_else
(brace
id|vp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Issue Tx Enable */
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Switch to register set 7 for normal use. */
id|EL3WINDOW
c_func
(paren
l_int|7
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Handle uncommon interrupt sources.  This is a separate routine to minimize&n; * the cache impact.&n; */
r_static
r_void
DECL|function|vortex_error
id|vortex_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|status
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|do_tx_reset
op_assign
l_int|0
comma
id|reset_mask
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|tx_status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: vortex_error(), status=0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|TxComplete
)paren
(brace
multiline_comment|/* Really &quot;TxError&quot; for us. */
id|tx_status
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
suffix:semicolon
multiline_comment|/* Presumably a tx-timeout. We must merely re-enable. */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
op_logical_or
(paren
id|tx_status
op_ne
l_int|0x88
op_logical_and
id|vortex_debug
OG
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit error, Tx status register %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tx_status
)paren
suffix:semicolon
id|dump_tx_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x14
)paren
id|vp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x38
)paren
id|vp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|TxStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x30
)paren
(brace
multiline_comment|/* txJabber or txUnderrun */
id|do_tx_reset
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
l_int|0x08
)paren
op_logical_and
(paren
id|vp-&gt;drv_flags
op_amp
id|MAX_COLLISION_RESET
)paren
)paren
(brace
multiline_comment|/* maxCollisions */
id|do_tx_reset
op_assign
l_int|1
suffix:semicolon
id|reset_mask
op_assign
l_int|0x0108
suffix:semicolon
multiline_comment|/* Reset interface logic, but not download logic */
)brace
r_else
(brace
multiline_comment|/* Merely re-enable the transmitter. */
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|RxEarly
)paren
(brace
multiline_comment|/* Rx early is unused. */
id|vortex_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
id|RxEarly
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|StatsFull
)paren
(brace
multiline_comment|/* Empty statistics. */
r_static
r_int
id|DoneDidThat
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Updating stats.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|ioaddr
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* HACK: Disable statistics as an interrupt source. */
multiline_comment|/* This occurs when we have the wrong media type! */
r_if
c_cond
(paren
id|DoneDidThat
op_eq
l_int|0
op_logical_and
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
id|StatsFull
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Updating statistics failed, disabling &quot;
l_string|&quot;stats as an interrupt source.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetIntrEnb
op_or
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
op_amp
op_complement
id|StatsFull
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|vp-&gt;intr_enable
op_and_assign
op_complement
id|StatsFull
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|DoneDidThat
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IntReq
)paren
(brace
multiline_comment|/* Restore all interrupt sources.  */
id|outw
c_func
(paren
id|vp-&gt;status_enable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|vp-&gt;intr_enable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|HostError
)paren
(brace
id|u16
id|fifo_diag
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|fifo_diag
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn4_FIFODiag
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Host error, FIFO diagnostic register %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fifo_diag
)paren
suffix:semicolon
multiline_comment|/* Adapter failure requires Tx/Rx reset and reinit. */
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
(brace
multiline_comment|/* In this case, blow the card away */
id|vortex_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|dev
comma
id|TotalReset
op_or
l_int|0xff
)paren
suffix:semicolon
id|vortex_up
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* AKPM: bug.  vortex_up() assumes that the rx ring is full. It may not be. */
)brace
r_else
r_if
c_cond
(paren
id|fifo_diag
op_amp
l_int|0x0400
)paren
id|do_tx_reset
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fifo_diag
op_amp
l_int|0x3000
)paren
(brace
id|wait_for_completion
c_func
(paren
id|dev
comma
id|RxReset
)paren
suffix:semicolon
multiline_comment|/* Set the Rx filter to the current state. */
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|RxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Re-enable the receiver. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|HostError
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|do_tx_reset
)paren
(brace
id|wait_for_completion
c_func
(paren
id|dev
comma
id|TxReset
op_or
id|reset_mask
)paren
suffix:semicolon
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vp-&gt;full_bus_master_tx
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|vortex_start_xmit
id|vortex_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Put out the doubleword header... */
id|outl
c_func
(paren
id|skb-&gt;len
comma
id|ioaddr
op_plus
id|TX_FIFO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;bus_master
)paren
(brace
multiline_comment|/* Set the bus-master controller to transfer the packet. */
r_int
id|len
op_assign
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|outl
c_func
(paren
id|vp-&gt;tx_skb_dma
op_assign
id|pci_map_single
c_func
(paren
id|vp-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
comma
id|ioaddr
op_plus
id|Wn7_MasterAddr
)paren
suffix:semicolon
id|outw
c_func
(paren
id|len
comma
id|ioaddr
op_plus
id|Wn7_MasterLen
)paren
suffix:semicolon
id|vp-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|outw
c_func
(paren
id|StartDMADown
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* netif_wake_queue() will be called at the DMADone interrupt. */
)brace
r_else
(brace
multiline_comment|/* ... and the packet rounded to a doubleword. */
id|outsl
c_func
(paren
id|ioaddr
op_plus
id|TX_FIFO
comma
id|skb-&gt;data
comma
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TxFree
)paren
OG
l_int|1536
)paren
(brace
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* AKPM: redundant? */
)brace
r_else
(brace
multiline_comment|/* Interrupt us when the FIFO has room for max-sized packet. */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetTxThreshold
op_plus
(paren
l_int|1536
op_rshift
l_int|2
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Clear the Tx status stack. */
(brace
r_int
id|tx_status
suffix:semicolon
r_int
id|i
op_assign
l_int|32
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|i
OG
l_int|0
op_logical_and
(paren
id|tx_status
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x3C
)paren
(brace
multiline_comment|/* A Tx-disabling error occurred.  */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx error, status %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x04
)paren
id|vp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x38
)paren
id|vp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x30
)paren
(brace
id|wait_for_completion
c_func
(paren
id|dev
comma
id|TxReset
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TxStatus
)paren
suffix:semicolon
multiline_comment|/* Pop the status stack. */
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|boomerang_start_xmit
id|boomerang_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
r_int
id|entry
op_assign
id|vp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_struct
id|boom_tx_desc
op_star
id|prev_entry
op_assign
op_amp
id|vp-&gt;tx_ring
(braket
(paren
id|vp-&gt;cur_tx
op_minus
l_int|1
)paren
op_mod
id|TX_RING_SIZE
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|6
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_start_xmit()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Trying to send a packet, Tx index %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|vp-&gt;cur_tx
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;tx_full
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tx Ring full, refusing to send buffer.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|vp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|next
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|addr
op_assign
id|cpu_to_le32
c_func
(paren
id|pci_map_single
c_func
(paren
id|vp-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
)paren
suffix:semicolon
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
id|LAST_FRAG
)paren
suffix:semicolon
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
id|TxIntrUploaded
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Wait for the stall to complete. */
id|wait_for_completion
c_func
(paren
id|dev
comma
id|DownStall
)paren
suffix:semicolon
id|prev_entry-&gt;next
op_assign
id|cpu_to_le32
c_func
(paren
id|vp-&gt;tx_ring_dma
op_plus
id|entry
op_star
r_sizeof
(paren
r_struct
id|boom_tx_desc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|DownListPtr
)paren
op_eq
l_int|0
)paren
(brace
id|outl
c_func
(paren
id|vp-&gt;tx_ring_dma
op_plus
id|entry
op_star
r_sizeof
(paren
r_struct
id|boom_tx_desc
)paren
comma
id|ioaddr
op_plus
id|DownListPtr
)paren
suffix:semicolon
id|queued_packet
op_increment
suffix:semicolon
)brace
id|vp-&gt;cur_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;cur_tx
op_minus
id|vp-&gt;dirty_tx
OG
id|TX_RING_SIZE
op_minus
l_int|1
)paren
(brace
id|vp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Clear previous interrupt enable. */
macro_line|#if defined(tx_interrupt_mitigation)
id|prev_entry-&gt;status
op_and_assign
id|cpu_to_le32
c_func
(paren
op_complement
id|TxIntrUploaded
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* netif_start_queue (dev); */
multiline_comment|/* AKPM: redundant? */
)brace
id|outw
c_func
(paren
id|DownUnstall
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
multiline_comment|/*&n; * This is the ISR for the vortex series chips.&n; * full_bus_master_tx == 0 &amp;&amp; full_bus_master_rx == 0&n; */
DECL|function|vortex_interrupt
r_static
r_void
id|vortex_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|work_done
op_assign
id|max_interrupt_work
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
l_string|&quot;vortex_interrupt(). status=0x%4x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|IntLatch
)paren
op_eq
l_int|0
)paren
r_goto
id|handler_exit
suffix:semicolon
multiline_comment|/* No interrupt: shared IRQs cause this */
r_if
c_cond
(paren
id|status
op_amp
id|IntReq
)paren
(brace
id|status
op_or_assign
id|vp-&gt;deferred
suffix:semicolon
id|vp-&gt;deferred
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffff
)paren
multiline_comment|/* AKPM: h/w no longer present (hotplug)? */
r_goto
id|handler_exit
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: interrupt, status %4.4x, latency %d ticks.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|Timer
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: In interrupt loop, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxComplete
)paren
id|vortex_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxAvailable
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&t;TX room bit was handled.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* There&squot;s room in the FIFO for a full-sized packet. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|TxAvailable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|DMADone
)paren
(brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn7_MasterStatus
)paren
op_amp
l_int|0x1000
)paren
(brace
id|outw
c_func
(paren
l_int|0x1000
comma
id|ioaddr
op_plus
id|Wn7_MasterStatus
)paren
suffix:semicolon
multiline_comment|/* Ack the event. */
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|vp-&gt;tx_skb_dma
comma
(paren
id|vp-&gt;tx_skb-&gt;len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|vp-&gt;tx_skb
)paren
suffix:semicolon
multiline_comment|/* Release the transferred buffer */
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TxFree
)paren
OG
l_int|1536
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; * AKPM: FIXME: I don&squot;t think we need this.  If the queue was stopped due to&n;&t;&t;&t;&t;&t; * insufficient FIFO room, the TxAvailable test will succeed and call&n;&t;&t;&t;&t;&t; * netif_wake_queue()&n;&t;&t;&t;&t;&t; */
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Interrupt when FIFO has room for max-sized packet. */
id|outw
c_func
(paren
id|SetTxThreshold
op_plus
(paren
l_int|1536
op_rshift
l_int|2
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* AKPM: This is new */
)brace
)brace
)brace
multiline_comment|/* Check for all uncommon interrupts at once. */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|HostError
op_or
id|RxEarly
op_or
id|StatsFull
op_or
id|TxComplete
op_or
id|IntReq
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffff
)paren
r_break
suffix:semicolon
id|vortex_error
c_func
(paren
id|dev
comma
id|status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|work_done
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work in interrupt, status &quot;
l_string|&quot;%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Disable all pending interrupts. */
r_do
(brace
id|vp-&gt;deferred
op_or_assign
id|status
suffix:semicolon
id|outw
c_func
(paren
id|SetStatusEnb
op_or
(paren
op_complement
id|vp-&gt;deferred
op_amp
id|vp-&gt;status_enable
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
(paren
id|vp-&gt;deferred
op_amp
l_int|0x7ff
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_CMD
)paren
)paren
op_amp
id|IntLatch
)paren
suffix:semicolon
multiline_comment|/* The timer will reenable interrupts. */
id|mod_timer
c_func
(paren
op_amp
id|vp-&gt;timer
comma
id|jiffies
op_plus
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Acknowledge the IRQ. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntReq
op_or
id|IntLatch
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
op_amp
(paren
id|IntLatch
op_or
id|RxComplete
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|handler_exit
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is the ISR for the boomerang series chips.&n; * full_bus_master_tx == 1 &amp;&amp; full_bus_master_rx == 1&n; */
DECL|function|boomerang_interrupt
r_static
r_void
id|boomerang_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|work_done
op_assign
id|max_interrupt_work
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/*&n;&t; * It seems dopey to put the spinlock this early, but we could race against vortex_tx_timeout&n;&t; * and boomerang_start_xmit&n;&t; */
id|spin_lock
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_interrupt. status=0x%4x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|IntLatch
)paren
op_eq
l_int|0
)paren
r_goto
id|handler_exit
suffix:semicolon
multiline_comment|/* No interrupt: shared IRQs can cause this */
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffff
)paren
(brace
multiline_comment|/* AKPM: h/w no longer present (hotplug)? */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_interrupt(1): status = 0xffff&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|handler_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IntReq
)paren
(brace
id|status
op_or_assign
id|vp-&gt;deferred
suffix:semicolon
id|vp-&gt;deferred
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: interrupt, status %4.4x, latency %d ticks.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|Timer
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: In interrupt loop, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UpComplete
)paren
(brace
id|outw
c_func
(paren
id|AckIntr
op_or
id|UpComplete
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_interrupt-&gt;boomerang_rx&bslash;n&quot;
)paren
suffix:semicolon
id|boomerang_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|DownComplete
)paren
(brace
r_int
r_int
id|dirty_tx
op_assign
id|vp-&gt;dirty_tx
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
id|DownComplete
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_while
c_loop
(paren
id|vp-&gt;cur_tx
op_minus
id|dirty_tx
OG
l_int|0
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
macro_line|#if 1&t;/* AKPM: the latter is faster, but cyclone-only */
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|DownListPtr
)paren
op_eq
id|vp-&gt;tx_ring_dma
op_plus
id|entry
op_star
r_sizeof
(paren
r_struct
id|boom_tx_desc
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been processed. */
macro_line|#else
r_if
c_cond
(paren
(paren
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_amp
id|DN_COMPLETE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been processed. */
macro_line|#endif
r_if
c_cond
(paren
id|vp-&gt;tx_skbuff
(braket
id|entry
)braket
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|vp-&gt;tx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|le32_to_cpu
c_func
(paren
id|vp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|addr
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|vp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_interrupt: no skb!&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* vp-&gt;stats.tx_packets++;  Counted below. */
id|dirty_tx
op_increment
suffix:semicolon
)brace
id|vp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;tx_full
op_logical_and
(paren
id|vp-&gt;cur_tx
op_minus
id|dirty_tx
op_le
id|TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_interrupt: clearing tx_full&bslash;n&quot;
)paren
suffix:semicolon
id|vp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Check for all uncommon interrupts at once. */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|HostError
op_or
id|RxEarly
op_or
id|StatsFull
op_or
id|TxComplete
op_or
id|IntReq
)paren
)paren
id|vortex_error
c_func
(paren
id|dev
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|work_done
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work in interrupt, status &quot;
l_string|&quot;%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Disable all pending interrupts. */
r_do
(brace
id|vp-&gt;deferred
op_or_assign
id|status
suffix:semicolon
id|outw
c_func
(paren
id|SetStatusEnb
op_or
(paren
op_complement
id|vp-&gt;deferred
op_amp
id|vp-&gt;status_enable
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
(paren
id|vp-&gt;deferred
op_amp
l_int|0x7ff
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_CMD
)paren
)paren
op_amp
id|IntLatch
)paren
suffix:semicolon
multiline_comment|/* The timer will reenable interrupts. */
id|mod_timer
c_func
(paren
op_amp
id|vp-&gt;timer
comma
id|jiffies
op_plus
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Acknowledge the IRQ. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntReq
op_or
id|IntLatch
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;cb_fn_base
)paren
multiline_comment|/* The PCMCIA people are idiots.  */
id|writel
c_func
(paren
l_int|0x8000
comma
id|vp-&gt;cb_fn_base
op_plus
l_int|4
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
op_amp
id|IntLatch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|handler_exit
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|vortex_rx
r_static
r_int
id|vortex_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|rx_status
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vortex_rx(): status %4.4x, rx_status %4.4x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RxStatus
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rx_status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RxStatus
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x4000
)paren
(brace
multiline_comment|/* Error, update stats. */
r_int
r_char
id|rx_error
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|RxErrors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; Rx error: status %2.2x.&bslash;n&quot;
comma
id|rx_error
)paren
suffix:semicolon
id|vp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x01
)paren
id|vp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x02
)paren
id|vp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x04
)paren
id|vp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x08
)paren
id|vp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x10
)paren
id|vp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* The packet length: up to 4.5K!. */
r_int
id|pkt_len
op_assign
id|rx_status
op_amp
l_int|0x1fff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Receiving packet size %d status %4.4x.&bslash;n&quot;
comma
id|pkt_len
comma
id|rx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte boundaries */
multiline_comment|/* &squot;skb_put()&squot; points to the start of sk_buff data area. */
r_if
c_cond
(paren
id|vp-&gt;bus_master
op_logical_and
op_logical_neg
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn7_MasterStatus
)paren
op_amp
l_int|0x8000
)paren
)paren
(brace
id|dma_addr_t
id|dma
op_assign
id|pci_map_single
c_func
(paren
id|vp-&gt;pdev
comma
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|pkt_len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dma
comma
id|ioaddr
op_plus
id|Wn7_MasterAddr
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
comma
id|ioaddr
op_plus
id|Wn7_MasterLen
)paren
suffix:semicolon
id|outw
c_func
(paren
id|StartDMAUp
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|Wn7_MasterStatus
)paren
op_amp
l_int|0x8000
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|dma
comma
id|pkt_len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
r_else
(brace
id|insl
c_func
(paren
id|ioaddr
op_plus
id|RX_FIFO
comma
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
id|RxDiscard
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Pop top Rx packet. */
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|vp-&gt;stats.rx_packets
op_increment
suffix:semicolon
multiline_comment|/* Wait a limited time to go to next packet. */
r_for
c_loop
(paren
id|i
op_assign
l_int|200
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
id|CmdInProgress
)paren
)paren
r_break
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: No memory to allocate a sk_buff of &quot;
l_string|&quot;size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
)paren
suffix:semicolon
)brace
id|vp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|dev
comma
id|RxDiscard
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|boomerang_rx
id|boomerang_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
op_assign
id|vp-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|rx_status
suffix:semicolon
r_int
id|rx_work_limit
op_assign
id|vp-&gt;dirty_rx
op_plus
id|RX_RING_SIZE
op_minus
id|vp-&gt;cur_rx
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;boomerang_rx(): status %4.4x&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rx_status
op_assign
id|le32_to_cpu
c_func
(paren
id|vp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
)paren
op_amp
id|RxDComplete
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|rx_work_limit
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|RxDError
)paren
(brace
multiline_comment|/* Error, update stats. */
r_int
r_char
id|rx_error
op_assign
id|rx_status
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; Rx error: status %2.2x.&bslash;n&quot;
comma
id|rx_error
)paren
suffix:semicolon
id|vp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x01
)paren
id|vp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x02
)paren
id|vp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x04
)paren
id|vp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x08
)paren
id|vp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_error
op_amp
l_int|0x10
)paren
id|vp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* The packet length: up to 4.5K!. */
r_int
id|pkt_len
op_assign
id|rx_status
op_amp
l_int|0x1fff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|dma
op_assign
id|le32_to_cpu
c_func
(paren
id|vp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|addr
)paren
suffix:semicolon
id|vp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Receiving packet size %d status %4.4x.&bslash;n&quot;
comma
id|pkt_len
comma
id|rx_status
)paren
suffix:semicolon
multiline_comment|/* Check if the packet is long enough to just accept without&n;&t;&t;&t;   copying to a properly sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte boundaries */
id|pci_dma_sync_single
c_func
(paren
id|vp-&gt;pdev
comma
id|dma
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* &squot;skb_put()&squot; points to the start of sk_buff data area. */
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|vp-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
)paren
suffix:semicolon
id|rx_copy
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Pass up the skbuff already on the Rx ring. */
id|skb
op_assign
id|vp-&gt;rx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|vp-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|dma
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|rx_nocopy
op_increment
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
(brace
multiline_comment|/* Use hardware checksum info. */
r_int
id|csum_bits
op_assign
id|rx_status
op_amp
l_int|0xee000000
suffix:semicolon
r_if
c_cond
(paren
id|csum_bits
op_logical_and
(paren
id|csum_bits
op_eq
(paren
id|IPChksumValid
op_or
id|TCPChksumValid
)paren
op_logical_or
id|csum_bits
op_eq
(paren
id|IPChksumValid
op_or
id|UDPChksumValid
)paren
)paren
)paren
(brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
id|rx_csumhits
op_increment
suffix:semicolon
)brace
)brace
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|vp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
id|entry
op_assign
(paren
op_increment
id|vp-&gt;cur_rx
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
multiline_comment|/* Refill the Rx ring buffers. */
r_for
c_loop
(paren
suffix:semicolon
id|vp-&gt;cur_rx
op_minus
id|vp-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|vp-&gt;dirty_rx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|entry
op_assign
id|vp-&gt;dirty_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_static
r_int
r_int
id|last_jif
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|last_jif
)paren
OG
l_int|10
op_star
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: memory shortage&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|last_jif
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|vp-&gt;cur_rx
op_minus
id|vp-&gt;dirty_rx
)paren
op_eq
id|RX_RING_SIZE
)paren
id|mod_timer
c_func
(paren
op_amp
id|vp-&gt;rx_oom_timer
comma
id|RUN_AT
c_func
(paren
id|HZ
op_star
l_int|1
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Bad news!  */
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte boundaries */
id|vp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|addr
op_assign
id|cpu_to_le32
c_func
(paren
id|pci_map_single
c_func
(paren
id|vp-&gt;pdev
comma
id|skb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
)paren
suffix:semicolon
id|vp-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
)brace
id|vp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Clear complete bit. */
id|outw
c_func
(paren
id|UpUnstall
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * If we&squot;ve hit a total OOM refilling the Rx ring we poll once a second&n; * for some memory.  Otherwise there is no way to restart the rx process.&n; */
r_static
r_void
DECL|function|rx_oom_timer
id|rx_oom_timer
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp-&gt;cur_rx
op_minus
id|vp-&gt;dirty_rx
)paren
op_eq
id|RX_RING_SIZE
)paren
multiline_comment|/* This test is redundant, but makes me feel good */
id|boomerang_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx_oom_timer %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
(paren
id|vp-&gt;cur_rx
op_minus
id|vp-&gt;dirty_rx
)paren
op_ne
id|RX_RING_SIZE
)paren
ques
c_cond
l_string|&quot;succeeded&quot;
suffix:colon
l_string|&quot;retrying&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|vp-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_down
id|vortex_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|vp-&gt;rx_oom_timer
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|vp-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* Turn off statistics ASAP.  We update vp-&gt;stats below. */
id|outw
c_func
(paren
id|StatsDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Disable the receiver and transmitter. */
id|outw
c_func
(paren
id|RxDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|TxDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|XCVR_10base2
)paren
multiline_comment|/* Turn off thinnet power.  Green! */
id|outw
c_func
(paren
id|StopCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetIntrEnb
op_or
l_int|0x0000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|ioaddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_rx
)paren
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|UpListPtr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|DownListPtr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;capabilities
op_amp
id|CapPwrMgmt
)paren
id|acpi_set_WOL
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_close
id|vortex_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
id|vortex_down
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: vortex_close() status %4.4x, Tx status %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: vortex close stats: rx_nocopy %d rx_copy %d&quot;
l_string|&quot; tx_queued %d Rx pre-checksummed %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_nocopy
comma
id|rx_copy
comma
id|queued_packet
comma
id|rx_csumhits
)paren
suffix:semicolon
)brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_rx
)paren
(brace
multiline_comment|/* Free Boomerang bus master Rx buffers. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|vp-&gt;rx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|le32_to_cpu
c_func
(paren
id|vp-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr
)paren
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|vp-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|vp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
(brace
multiline_comment|/* Free Boomerang bus master Tx buffers. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|vp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|vp-&gt;tx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|vp-&gt;pdev
comma
id|le32_to_cpu
c_func
(paren
id|vp-&gt;tx_ring
(braket
id|i
)braket
dot
id|addr
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|vp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|vp-&gt;open
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|dump_tx_ring
id|dump_tx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;full_bus_master_tx
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|stalled
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|PktStatus
)paren
op_amp
l_int|0x04
suffix:semicolon
multiline_comment|/* Possible racy. But it&squot;s only debug stuff */
id|wait_for_completion
c_func
(paren
id|dev
comma
id|DownStall
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  Flags; bus-master %d, full %d; dirty %d(%d) &quot;
l_string|&quot;current %d(%d).&bslash;n&quot;
comma
id|vp-&gt;full_bus_master_tx
comma
id|vp-&gt;tx_full
comma
id|vp-&gt;dirty_tx
comma
id|vp-&gt;dirty_tx
op_mod
id|TX_RING_SIZE
comma
id|vp-&gt;cur_tx
comma
id|vp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  Transmit list %8.8x vs. %p.&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|DownListPtr
)paren
comma
op_amp
id|vp-&gt;tx_ring
(braket
id|vp-&gt;dirty_tx
op_mod
id|TX_RING_SIZE
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  %d: @%p  length %8.8x status %8.8x&bslash;n&quot;
comma
id|i
comma
op_amp
id|vp-&gt;tx_ring
(braket
id|i
)braket
comma
id|le32_to_cpu
c_func
(paren
id|vp-&gt;tx_ring
(braket
id|i
)braket
dot
id|length
)paren
comma
id|le32_to_cpu
c_func
(paren
id|vp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|stalled
)paren
id|outw
c_func
(paren
id|DownUnstall
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|vortex_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|vortex_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* AKPM: Used to be netif_running */
id|spin_lock_irqsave
(paren
op_amp
id|vp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|dev-&gt;base_addr
comma
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|vp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|vp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*  Update statistics.&n;&t;Unlike with the EL3 we need not worry about interrupts changing&n;&t;the window setting from underneath us, but we must still guard&n;&t;against a race condition with a StatsUpdate interrupt updating the&n;&t;table.  This is done by checking that the ASM (!) code generated uses&n;&t;atomic updates with &squot;+=&squot;.&n;&t;*/
DECL|function|update_stats
r_static
r_void
id|update_stats
c_func
(paren
r_int
id|ioaddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|old_window
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_window
op_eq
l_int|0xffff
)paren
multiline_comment|/* Chip suspended or ejected. */
r_return
suffix:semicolon
multiline_comment|/* Unlike the 3c5x9 we need not turn off stats updates while reading. */
multiline_comment|/* Switch to the stats window, and read everything. */
id|EL3WINDOW
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|vp-&gt;stats.tx_carrier_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0
)paren
suffix:semicolon
id|vp-&gt;stats.tx_heartbeat_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Multiple collisions. */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|2
)paren
suffix:semicolon
id|vp-&gt;stats.collisions
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|3
)paren
suffix:semicolon
id|vp-&gt;stats.tx_window_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|4
)paren
suffix:semicolon
id|vp-&gt;stats.rx_fifo_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|5
)paren
suffix:semicolon
id|vp-&gt;stats.tx_packets
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|6
)paren
suffix:semicolon
id|vp-&gt;stats.tx_packets
op_add_assign
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|9
)paren
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
suffix:semicolon
multiline_comment|/* Rx packets&t;*/
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* Must read to clear */
multiline_comment|/* Tx deferrals */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Don&squot;t bother with register 9, an extension of registers 6&amp;7.&n;&t;   If we do use the 6&amp;7 values the atomic update assumption above&n;&t;   is invalid. */
id|vp-&gt;stats.rx_bytes
op_add_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
id|vp-&gt;stats.tx_bytes
op_add_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* New: On the Vortex we must also clear the BadSSD counter. */
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
(brace
id|u8
id|up
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|13
)paren
suffix:semicolon
id|vp-&gt;stats.rx_bytes
op_add_assign
(paren
id|up
op_amp
l_int|0x0f
)paren
op_lshift
l_int|16
suffix:semicolon
id|vp-&gt;stats.tx_bytes
op_add_assign
(paren
id|up
op_amp
l_int|0xf0
)paren
op_lshift
l_int|12
suffix:semicolon
)brace
multiline_comment|/* We change back to window 7 (not 1) with the Vortex. */
multiline_comment|/* AKPM: the previous comment is obsolete - we switch back to the old window */
id|EL3WINDOW
c_func
(paren
id|old_window
op_rshift
l_int|13
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|vortex_ioctl
r_static
r_int
id|vortex_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_int
id|phy
op_assign
id|vp-&gt;phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
id|data
(braket
l_int|0
)braket
op_assign
id|phy
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EPERM
suffix:semicolon
)brace
r_else
(brace
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Pre-Cyclone chips have no documented multicast filter, so the only&n;   multicast setting is to receive all multicast frames.  At least&n;   the chip has a very clean way to set the mode, unlike many others. */
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|new_mode
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Setting promiscuous mode.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|new_mode
op_assign
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxMulticast
op_or
id|RxBroadcast
op_or
id|RxProm
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_list
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
id|new_mode
op_assign
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxMulticast
op_or
id|RxBroadcast
suffix:semicolon
)brace
r_else
id|new_mode
op_assign
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxBroadcast
suffix:semicolon
id|outw
c_func
(paren
id|new_mode
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
multiline_comment|/* MII transceiver control section.&n;   Read and write the MII registers using software-generated serial&n;   MDIO protocol.  See the MII specifications or DP83840A data sheet&n;   for details. */
multiline_comment|/* The maximum data clock rate is 2.5 Mhz.  The minimum timing is usually&n;   met by back-to-back PCI I/O cycles, but we insert a delay to avoid&n;   &quot;overclocking&quot; issues. */
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay() inl(mdio_addr)
DECL|macro|MDIO_SHIFT_CLK
mdefine_line|#define MDIO_SHIFT_CLK&t;0x01
DECL|macro|MDIO_DIR_WRITE
mdefine_line|#define MDIO_DIR_WRITE&t;0x04
DECL|macro|MDIO_DATA_WRITE0
mdefine_line|#define MDIO_DATA_WRITE0 (0x00 | MDIO_DIR_WRITE)
DECL|macro|MDIO_DATA_WRITE1
mdefine_line|#define MDIO_DATA_WRITE1 (0x02 | MDIO_DIR_WRITE)
DECL|macro|MDIO_DATA_READ
mdefine_line|#define MDIO_DATA_READ&t;0x02
DECL|macro|MDIO_ENB_IN
mdefine_line|#define MDIO_ENB_IN&t;&t;0x00
multiline_comment|/* Generate the preamble required for initial synchronization and&n;   a few older transceivers. */
DECL|function|mdio_sync
r_static
r_void
id|mdio_sync
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|bits
)paren
(brace
r_int
id|mdio_addr
op_assign
id|ioaddr
op_plus
id|Wn4_PhysicalMgmt
suffix:semicolon
multiline_comment|/* Establish sync by sending at least 32 logic ones. */
r_while
c_loop
(paren
op_decrement
id|bits
op_ge
l_int|0
)paren
(brace
id|outw
c_func
(paren
id|MDIO_DATA_WRITE1
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|MDIO_DATA_WRITE1
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|read_cmd
op_assign
(paren
l_int|0xf6
op_lshift
l_int|10
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|5
)paren
op_or
id|location
suffix:semicolon
r_int
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|mdio_addr
op_assign
id|ioaddr
op_plus
id|Wn4_PhysicalMgmt
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|vp-&gt;mdio_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_preamble_required
)paren
id|mdio_sync
c_func
(paren
id|ioaddr
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|14
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_DATA_WRITE1
suffix:colon
id|MDIO_DATA_WRITE0
suffix:semicolon
id|outw
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|dataval
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the two transition, 16 data, and wire-idle bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|19
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outw
c_func
(paren
id|MDIO_ENB_IN
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inw
c_func
(paren
id|mdio_addr
)paren
op_amp
id|MDIO_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outw
c_func
(paren
id|MDIO_ENB_IN
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|vp-&gt;mdio_lock
)paren
suffix:semicolon
r_return
id|retval
op_amp
l_int|0x20000
ques
c_cond
l_int|0xffff
suffix:colon
id|retval
op_rshift
l_int|1
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|write_cmd
op_assign
l_int|0x50020000
op_or
(paren
id|phy_id
op_lshift
l_int|23
)paren
op_or
(paren
id|location
op_lshift
l_int|18
)paren
op_or
id|value
suffix:semicolon
r_int
id|mdio_addr
op_assign
id|ioaddr
op_plus
id|Wn4_PhysicalMgmt
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|vp-&gt;mdio_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_preamble_required
)paren
id|mdio_sync
c_func
(paren
id|ioaddr
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|write_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_DATA_WRITE1
suffix:colon
id|MDIO_DATA_WRITE0
suffix:semicolon
id|outw
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|dataval
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Leave the interface idle. */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outw
c_func
(paren
id|MDIO_ENB_IN
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|MDIO_ENB_IN
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|vp-&gt;mdio_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
"&f;"
multiline_comment|/* ACPI: Advanced Configuration and Power Interface. */
multiline_comment|/* Set Wake-On-LAN mode and put the board into D3 (power-down) state. */
DECL|function|acpi_set_WOL
r_static
r_void
id|acpi_set_WOL
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|vortex_private
op_star
id|vp
op_assign
(paren
r_struct
id|vortex_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* AKPM: This kills the 905 */
r_if
c_cond
(paren
id|vortex_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Wake-on-LAN functions disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
multiline_comment|/* Power up on: 1==Downloaded Filter, 2==Magic Packets, 4==Link Status. */
id|EL3WINDOW
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|2
comma
id|ioaddr
op_plus
l_int|0x0c
)paren
suffix:semicolon
multiline_comment|/* The RxFilter must accept the WOL frames. */
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxMulticast
op_or
id|RxBroadcast
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|RxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Change the power state to D3; RxEnable doesn&squot;t take effect. */
id|pci_write_config_word
c_func
(paren
id|vp-&gt;pdev
comma
l_int|0xe0
comma
l_int|0x8103
)paren
suffix:semicolon
)brace
DECL|function|vortex_remove_one
r_static
r_void
id|__devexit
id|vortex_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;vortex_remove_one called for EISA device!&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|vp
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
multiline_comment|/* AKPM: FIXME: we should have&n;&t; *&t;if (vp-&gt;cb_fn_base) iounmap(vp-&gt;cb_fn_base);&n;&t; * here&n;&t; */
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|TotalReset
comma
id|dev-&gt;base_addr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;must_free_region
)paren
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|vp-&gt;io_size
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|vortex_driver
r_static
r_struct
id|pci_driver
id|vortex_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;3c575_cb&quot;
comma
id|probe
suffix:colon
id|vortex_init_one
comma
id|remove
suffix:colon
id|vortex_remove_one
comma
id|suspend
suffix:colon
id|vortex_suspend
comma
id|resume
suffix:colon
id|vortex_resume
comma
id|id_table
suffix:colon
id|vortex_pci_tbl
comma
)brace
suffix:semicolon
DECL|variable|vortex_have_pci
r_static
r_int
id|vortex_have_pci
suffix:semicolon
DECL|variable|vortex_have_eisa
r_static
r_int
id|vortex_have_eisa
suffix:semicolon
DECL|function|vortex_init
r_static
r_int
id|__init
id|vortex_init
(paren
r_void
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|vortex_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|rc
op_assign
id|vortex_eisa_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OG
l_int|0
)paren
id|vortex_have_eisa
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|vortex_have_pci
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|vortex_eisa_cleanup
r_static
r_void
id|__exit
id|vortex_eisa_cleanup
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|vortex_private
op_star
id|vp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
id|dev
op_assign
id|root_vortex_eisa_dev
suffix:semicolon
r_while
c_loop
(paren
id|dev
)paren
(brace
id|vp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|outw
(paren
id|TotalReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|release_region
(paren
id|ioaddr
comma
id|VORTEX_TOTAL_SIZE
)paren
suffix:semicolon
id|tmp
op_assign
id|dev
suffix:semicolon
id|dev
op_assign
id|vp-&gt;next_module
suffix:semicolon
id|kfree
(paren
id|tmp
)paren
suffix:semicolon
)brace
)brace
DECL|function|vortex_cleanup
r_static
r_void
id|__exit
id|vortex_cleanup
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|vortex_have_pci
)paren
id|pci_unregister_driver
(paren
op_amp
id|vortex_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vortex_have_eisa
)paren
id|vortex_eisa_cleanup
(paren
)paren
suffix:semicolon
)brace
DECL|variable|vortex_init
id|module_init
c_func
(paren
id|vortex_init
)paren
suffix:semicolon
DECL|variable|vortex_cleanup
id|module_exit
c_func
(paren
id|vortex_cleanup
)paren
suffix:semicolon
"&f;"
multiline_comment|/*&n; * Local variables:&n; *  c-indent-level: 4&n; *  c-basic-offset: 4&n; *  tab-width: 4&n; * End:&n; */
eof
