multiline_comment|/**********************************************************************&n; * iph5526.c: IP/SCSI driver for the Interphase 5526 PCI Fibre Channel&n; *&t;&t;&t;  Card.&n; * Copyright (C) 1999 Vineet M Abraham &lt;vmabraham@hotmail.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or &n; * modify it under the terms of the GNU General Public License as &n; * published by the Free Software Foundation; either version 2, or &n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; *********************************************************************/
multiline_comment|/**********************************************************************&n;Log:&n;Vineet M Abraham&n;02.12.99 Support multiple cards.&n;03.15.99 Added Fabric support.&n;04.04.99 Added N_Port support.&n;04.15.99 Added SCSI support.&n;06.18.99 Added ABTS Protocol.&n;06.24.99 Fixed data corruption when multiple XFER_RDYs are received.&n;07.07.99 Can be loaded as part of the Kernel. Changed semaphores. Added&n;         more checks before invalidating SEST entries.&n;07.08.99 Added Broadcast IP stuff and fixed an unicast timeout bug.&n;***********************************************************************/
multiline_comment|/* TODO:&n;&t;R_T_TOV set to 15msec in Loop topology. Need to be 100 msec.&n;    SMP testing.&n;&t;Fix ADISC Tx before completing FLOGI. &n;*/
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;iph5526.c:v1.0 07.08.99 Vineet Abraham (vmabraham@hotmail.com)&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/fcdevice.h&gt; /* had the declarations for init_fcdev among others + includes if_fcdevice.h */
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;../../scsi/sd.h&quot;
macro_line|#include &quot;../../scsi/scsi.h&quot;
macro_line|#include &quot;../../scsi/hosts.h&quot;
macro_line|#include &quot;../../fc4/fcp.h&quot;
multiline_comment|/* driver specific header files */
macro_line|#include &quot;tach.h&quot;
macro_line|#include &quot;tach_structs.h&quot;
macro_line|#include &quot;iph5526_ip.h&quot;
macro_line|#include &quot;iph5526_scsi.h&quot;
macro_line|#include &quot;iph5526_novram.c&quot;
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
DECL|macro|DEBUG_5526_0
mdefine_line|#define DEBUG_5526_0 0
DECL|macro|DEBUG_5526_1
mdefine_line|#define DEBUG_5526_1 0
DECL|macro|DEBUG_5526_2
mdefine_line|#define DEBUG_5526_2 0
macro_line|#if DEBUG_5526_0
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format, a...) {printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(format, ##a); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(&quot;&bslash;n&quot;);}
DECL|macro|ENTER
mdefine_line|#define ENTER(x)&t;{printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t; printk(&quot;iph5526.c : entering %s()&bslash;n&quot;, x);}
DECL|macro|LEAVE
mdefine_line|#define LEAVE(x)&t;{printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t; printk(&quot;iph5526.c : leaving %s()&bslash;n&quot;,x);}
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format, a...) {}
DECL|macro|ENTER
mdefine_line|#define ENTER(x)&t;{}
DECL|macro|LEAVE
mdefine_line|#define LEAVE(x)&t;{}
macro_line|#endif
macro_line|#if DEBUG_5526_1
DECL|macro|DPRINTK1
mdefine_line|#define DPRINTK1(format, a...) {printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(format, ##a); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(&quot;&bslash;n&quot;);}
macro_line|#else
DECL|macro|DPRINTK1
mdefine_line|#define DPRINTK1(format, a...) {}
macro_line|#endif
macro_line|#if DEBUG_5526_2
DECL|macro|DPRINTK2
mdefine_line|#define DPRINTK2(format, a...) {printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(format, ##a); &bslash;&n;&t;&t;&t;&t;&t;&t;&t;   printk(&quot;&bslash;n&quot;);}
macro_line|#else
DECL|macro|DPRINTK2
mdefine_line|#define DPRINTK2(format, a...) {}
macro_line|#endif
DECL|macro|T_MSG
mdefine_line|#define T_MSG(format, a...) {printk(&quot;%s: &quot;, fi-&gt;name); &bslash;&n;&t;&t;&t;&t;&t;&t;&t; printk(format, ##a);&bslash;&n;&t;&t;&t;&t;&t;&t;&t; printk(&quot;&bslash;n&quot;);}
DECL|macro|ALIGNED_SFS_ADDR
mdefine_line|#define ALIGNED_SFS_ADDR(addr) ((((unsigned long)(addr) + (SFS_BUFFER_SIZE - 1)) &amp; ~(SFS_BUFFER_SIZE - 1)) - (unsigned long)(addr))
DECL|macro|ALIGNED_ADDR
mdefine_line|#define ALIGNED_ADDR(addr, len) ((((unsigned long)(addr) + (len - 1)) &amp; ~(len - 1)) - (unsigned long)(addr))
DECL|variable|__initdata
r_static
r_struct
id|pci_device_id
id|iph5526_pci_tbl
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_INTERPHASE
comma
id|PCI_DEVICE_ID_INTERPHASE_5526
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
id|PCI_VENDOR_ID_INTERPHASE
comma
id|PCI_DEVICE_ID_INTERPHASE_55x6
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|iph5526_pci_tbl
)paren
suffix:semicolon
DECL|macro|MAX_FC_CARDS
mdefine_line|#define MAX_FC_CARDS 2
DECL|variable|fc
r_static
r_struct
id|fc_info
op_star
id|fc
(braket
id|MAX_FC_CARDS
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|pci_irq_line
r_static
r_int
r_int
id|pci_irq_line
suffix:semicolon
r_static
r_struct
(brace
DECL|member|vendor_id
r_int
r_int
id|vendor_id
suffix:semicolon
DECL|member|device_id
r_int
r_int
id|device_id
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
)brace
DECL|variable|__initdata
id|clone_list
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_INTERPHASE
comma
id|PCI_DEVICE_ID_INTERPHASE_5526
comma
l_string|&quot;Interphase Fibre Channel HBA&quot;
)brace
comma
(brace
id|PCI_VENDOR_ID_INTERPHASE
comma
id|PCI_DEVICE_ID_INTERPHASE_55x6
comma
l_string|&quot;Interphase Fibre Channel HBA&quot;
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
r_static
r_void
id|tachyon_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|tachyon_interrupt_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|initialize_register_pointers
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_void
id|clean_up_memory
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_int
id|tachyon_init
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_int
id|build_queues
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|build_tachyon_header
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|my_id
comma
id|u_int
id|r_ctl
comma
id|u_int
id|d_id
comma
id|u_int
id|type
comma
id|u_char
id|seq_id
comma
id|u_char
id|df_ctl
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|get_free_header
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|build_EDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_short
id|flags
comma
id|u_short
id|len
)paren
suffix:semicolon
r_static
r_int
id|get_free_EDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|build_ODB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_char
id|seq_id
comma
id|u_int
id|d_id
comma
id|u_int
id|len
comma
id|u_int
id|cntl
comma
id|u_short
id|mtu
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
r_int
id|NW_header
comma
r_int
id|int_required
comma
id|u_int
id|frame_class
)paren
suffix:semicolon
r_static
r_void
id|write_to_tachyon_registers
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|reset_latch
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|reset_tachyon
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|take_tachyon_offline
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|read_novram
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|reset_ichip
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_OCQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_IMQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|update_SFSBQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_MFSBQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|update_tachyon_header_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_EDB_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_FM_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_MFS_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_OOO_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_SFS_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_OCI_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_SFS_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_MFS_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_IMQ_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_Unknown_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_Busied_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_Bad_SCSI_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_Inbound_SCSI_Status_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|handle_Inbound_SCSI_Command_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|completion_message_handler
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|imq_int_type
)paren
suffix:semicolon
r_static
r_void
id|fill_login_frame
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
)paren
suffix:semicolon
r_static
r_int
id|tx_exchange
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_int
id|len
comma
id|u_int
id|r_ctl
comma
id|u_int
id|type
comma
id|u_int
id|d_id
comma
id|u_int
id|mtu
comma
r_int
id|int_required
comma
id|u_short
id|ox_id
comma
id|u_int
id|frame_class
)paren
suffix:semicolon
r_static
r_int
id|tx_sequence
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_int
id|len
comma
id|u_int
id|mtu
comma
id|u_int
id|d_id
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
id|u_char
id|seq_id
comma
r_int
id|NW_flag
comma
r_int
id|int_required
comma
id|u_int
id|frame_class
)paren
suffix:semicolon
r_static
r_int
id|validate_login
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|base_ptr
)paren
suffix:semicolon
r_static
r_void
id|add_to_address_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|base_ptr
)paren
suffix:semicolon
r_static
r_void
id|remove_from_address_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|data
comma
id|u_int
id|cmnd_code
)paren
suffix:semicolon
r_static
r_int
id|node_logged_in_prev
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
)paren
suffix:semicolon
r_static
r_int
id|sid_logged_in
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|s_id
)paren
suffix:semicolon
r_static
r_struct
id|fc_node_info
op_star
id|look_up_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|display_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|tx_logi
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
comma
id|u_int
id|d_id
)paren
suffix:semicolon
r_static
r_void
id|tx_logi_acc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|tx_prli
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|command_code
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|tx_logo
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|tx_adisc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|cmnd_code
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|tx_ls_rjt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
comma
id|u_short
id|reason_code
comma
id|u_short
id|expln_code
)paren
suffix:semicolon
r_static
id|u_int
id|plogi_ok
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
comma
r_int
id|size
)paren
suffix:semicolon
r_static
r_void
id|tx_acc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|tx_name_server_req
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|req
)paren
suffix:semicolon
r_static
r_void
id|rscn_handler
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|node_id
)paren
suffix:semicolon
r_static
r_void
id|tx_scr
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|scr_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|explore_fabric
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
)paren
suffix:semicolon
r_static
r_void
id|perform_adisc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|local_port_discovery
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|add_to_ox_id_list
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|transaction_id
comma
id|u_int
id|cmnd_code
)paren
suffix:semicolon
r_static
id|u_int
id|remove_from_ox_id_list
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_void
id|add_display_cache_timer
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
multiline_comment|/* Timers... */
r_static
r_void
id|nos_ols_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|loop_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|fabric_explore_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|port_discovery_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|display_cache_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
multiline_comment|/* SCSI Stuff */
r_static
r_int
id|add_to_sest
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|Scsi_Cmnd
op_star
id|Cmnd
comma
r_struct
id|fc_node_info
op_star
id|ni
)paren
suffix:semicolon
r_static
r_struct
id|fc_node_info
op_star
id|resolve_target
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_char
id|target
)paren
suffix:semicolon
r_static
r_void
id|update_FCP_CMND_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_int
id|get_free_SDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_SDB_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|mark_scsi_sid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
comma
id|u_char
id|action
)paren
suffix:semicolon
r_static
r_void
id|invalidate_SEST_entry
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|received_ox_id
)paren
suffix:semicolon
r_static
r_int
id|abort_exchange
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|ox_id
)paren
suffix:semicolon
r_static
r_void
id|flush_tachyon_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|ox_id
)paren
suffix:semicolon
r_static
r_int
id|get_scsi_oxid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
r_static
r_void
id|update_scsi_oxid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
suffix:semicolon
DECL|variable|driver_template
id|Scsi_Host_Template
id|driver_template
op_assign
id|IPH5526_SCSI_FC
suffix:semicolon
r_static
r_void
id|iph5526_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|iph5526_probe_pci
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|iph5526_probe
r_int
id|__init
id|iph5526_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
op_logical_and
(paren
id|iph5526_probe_pci
c_func
(paren
id|dev
)paren
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|iph5526_probe_pci
r_static
r_int
id|__init
id|iph5526_probe_pci
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#ifdef MODULE
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#else
r_struct
id|fc_info
op_star
id|fi
suffix:semicolon
r_static
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fc
(braket
id|count
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|dev
op_assign
id|init_fcdev
c_func
(paren
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|fi
op_assign
id|fc
(braket
id|count
)braket
suffix:semicolon
macro_line|#endif
id|fi-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|fi-&gt;base_addr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|fi-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
id|dev-&gt;priv
op_assign
id|fi
suffix:semicolon
id|fcdev_init
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Assign ur MAC address.&n;&t;&t; */
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
id|fi-&gt;g.my_port_name_high
op_amp
l_int|0x0000FF00
)paren
op_rshift
l_int|8
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
id|fi-&gt;g.my_port_name_high
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
id|fi-&gt;g.my_port_name_low
op_amp
l_int|0xFF000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
id|fi-&gt;g.my_port_name_low
op_amp
l_int|0x00FF0000
)paren
op_rshift
l_int|16
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
id|fi-&gt;g.my_port_name_low
op_amp
l_int|0x0000FF00
)paren
op_rshift
l_int|8
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
id|fi-&gt;g.my_port_name_low
suffix:semicolon
macro_line|#ifndef MODULE
id|count
op_increment
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#endif
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fcdev_init
r_static
r_int
id|__init
id|fcdev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;open
op_assign
id|iph5526_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|iph5526_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|iph5526_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|iph5526_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|iph5526_change_mtu
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|iph5526_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
macro_line|#ifndef MODULE
id|fc_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* initialize tachyon and take it OnLine */
DECL|function|tachyon_init
r_static
r_int
id|tachyon_init
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|ENTER
c_func
(paren
l_string|&quot;tachyon_init&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|build_queues
c_func
(paren
id|fi
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;build_queues() failed&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Retrieve your port/node name.&n;&t; */
id|read_novram
c_func
(paren
id|fi
)paren
suffix:semicolon
id|reset_ichip
c_func
(paren
id|fi
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tachyon_init&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Build the 4 Qs - IMQ, OCQ, MFSBQ, SFSBQ */
multiline_comment|/* Lots of dma_pages needed as Tachyon DMAs almost everything into &n; * host memory.&n; */
DECL|function|build_queues
r_static
r_int
id|build_queues
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|u_char
op_star
id|addr
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;build_queues&quot;
)paren
suffix:semicolon
multiline_comment|/* Initializing Queue Variables.&n;&t; */
id|fi-&gt;q.ptr_host_ocq_cons_indx
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.ptr_host_hpcq_cons_indx
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.ptr_host_imq_prod_indx
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.ptr_ocq_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.ocq_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ocq_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ocq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ptr_imq_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.imq_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.imq_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.imq_cons_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.imq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ptr_mfsbq_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.mfsbq_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.mfsbq_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.mfsbq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.mfsbq_cons_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.mfsbuff_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.mfsbuff_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.mfs_buffer_count
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ptr_sfsbq_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.sfsbq_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sfsbq_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sfsbq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sfsbq_cons_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sfsbuff_len
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sfsbuff_end
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.sdb_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.fcp_cmnd_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ptr_edb_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.edb_buffer_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;q.ptr_tachyon_header_base
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;q.tachyon_header_indx
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;node_info_list
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;ox_id_list
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;g.loop_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.ptp_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.link_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.fabric_present
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.n_port_try
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.dont_init
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.nport_timer_set
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.lport_timer_set
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.no_of_targets
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.sem
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.perform_adisc
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* build OCQ */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_ocq_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get OCQ page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set up the OCQ structures */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OCQ_LENGTH
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_odb
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_ocq_base
op_plus
id|NO_OF_ENTRIES
op_star
id|i
suffix:semicolon
multiline_comment|/* build IMQ */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_imq_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get IMQ page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IMQ_LENGTH
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_imqe
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_imq_base
op_plus
id|NO_OF_ENTRIES
op_star
id|i
suffix:semicolon
multiline_comment|/* build MFSBQ */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_mfsbq_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get MFSBQ page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_mfsbq_base
comma
l_int|0
comma
id|MFSBQ_LENGTH
op_star
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Allocate one huge chunk of memory... helps while reassembling&n;&t; * frames.&n;&t; */
r_if
c_cond
(paren
(paren
id|addr
op_assign
(paren
id|u_char
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|5
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get MFSBQ page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* fill in addresses of empty buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MFSBQ_LENGTH
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NO_OF_ENTRIES
suffix:semicolon
id|j
op_increment
)paren
(brace
op_star
(paren
id|fi-&gt;q.ptr_mfsbq_base
op_plus
id|i
op_star
id|NO_OF_ENTRIES
op_plus
id|j
)paren
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
id|addr
op_add_assign
id|MFS_BUFFER_SIZE
suffix:semicolon
)brace
)brace
multiline_comment|/* The number of entries in each MFS buffer is 8. There are 8&n;&t; * MFS buffers. That leaves us with 4096-256 bytes. We use them&n;&t; * as temporary space for ELS frames. This is done to make sure that&n;&t; * the addresses are aligned.&n;&t; */
id|fi-&gt;g.els_buffer
(braket
l_int|0
)braket
op_assign
id|fi-&gt;q.ptr_mfsbq_base
op_plus
id|MFSBQ_LENGTH
op_star
id|NO_OF_ENTRIES
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_PENDING_FRAMES
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;g.els_buffer
(braket
id|i
)braket
op_assign
id|fi-&gt;g.els_buffer
(braket
id|i
op_minus
l_int|1
)braket
op_plus
l_int|64
suffix:semicolon
multiline_comment|/* build SFSBQ */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get SFSBQ page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_sfsbq_base
comma
l_int|0
comma
id|SFSBQ_LENGTH
op_star
l_int|32
)paren
suffix:semicolon
multiline_comment|/* fill in addresses of empty buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SFSBQ_LENGTH
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NO_OF_ENTRIES
suffix:semicolon
id|j
op_increment
)paren
(brace
id|addr
op_assign
id|kmalloc
c_func
(paren
id|SFS_BUFFER_SIZE
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;ptr_sfs_buffer : memory not allocated&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|offset
op_assign
id|ALIGNED_SFS_ADDR
c_func
(paren
id|addr
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|addr
comma
l_int|0
comma
id|SFS_BUFFER_SIZE
)paren
suffix:semicolon
id|fi-&gt;q.ptr_sfs_buffers
(braket
id|i
op_star
id|NO_OF_ENTRIES
op_plus
id|j
)braket
op_assign
(paren
id|u_int
op_star
)paren
id|addr
suffix:semicolon
id|addr
op_add_assign
id|offset
suffix:semicolon
op_star
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|i
op_star
id|NO_OF_ENTRIES
op_plus
id|j
)paren
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The number of entries in each SFS buffer is 8. There are 8&n;&t; * MFS buffers. That leaves us with 4096-256 bytes. We use them&n;&t; * as temporary space for ARP frames. This is done inorder to &n;&t; * support HW_Types of 0x1 and 0x6. &n;&t; */
id|fi-&gt;g.arp_buffer
op_assign
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|SFSBQ_LENGTH
op_star
id|NO_OF_ENTRIES
op_star
l_int|4
suffix:semicolon
multiline_comment|/* build EDB */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_edb_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|5
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get EDB page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EDB_LEN
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_edb
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_edb_base
op_plus
l_int|2
op_star
id|i
suffix:semicolon
multiline_comment|/* build SEST */
multiline_comment|/* OX_IDs range from 0x0 - 0x4FFF.&n;&t; */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_sest_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|5
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get SEST page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SEST_LENGTH
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_sest
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_sest_base
op_plus
id|NO_OF_ENTRIES
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_sdb_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|5
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get SDB page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_SDB_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_sdb_slot
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_sdb_base
op_plus
(paren
id|SDB_SIZE
op_div
l_int|4
)paren
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_fcp_cmnd_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get FCP_CMND page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_FCP_CMNDS
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_fcp_cmnd
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_fcp_cmnd_base
op_plus
id|NO_OF_ENTRIES
op_star
id|i
suffix:semicolon
multiline_comment|/* Allocate space for Tachyon Header as well... &n;&t; */
r_if
c_cond
(paren
(paren
id|fi-&gt;q.ptr_tachyon_header_base
op_assign
(paren
id|u_int
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;failed to get tachyon_header page&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_TACH_HEADERS
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|i
)braket
op_assign
id|fi-&gt;q.ptr_tachyon_header_base
op_plus
l_int|16
op_star
id|i
suffix:semicolon
multiline_comment|/* Allocate memory for indices.&n;&t; * Indices should be aligned on 32 byte boundries. &n;&t; */
id|fi-&gt;q.host_ocq_cons_indx
op_assign
id|kmalloc
c_func
(paren
l_int|2
op_star
l_int|32
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.host_ocq_cons_indx
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;fi-&gt;q.host_ocq_cons_indx : memory not allocated&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|fi-&gt;q.ptr_host_ocq_cons_indx
op_assign
id|fi-&gt;q.host_ocq_cons_indx
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u_long
)paren
(paren
id|fi-&gt;q.host_ocq_cons_indx
)paren
op_mod
l_int|32
)paren
id|fi-&gt;q.host_ocq_cons_indx
op_increment
suffix:semicolon
id|fi-&gt;q.host_hpcq_cons_indx
op_assign
id|kmalloc
c_func
(paren
l_int|2
op_star
l_int|32
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.host_hpcq_cons_indx
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;fi-&gt;q.host_hpcq_cons_indx : memory not allocated&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|fi-&gt;q.ptr_host_hpcq_cons_indx
op_assign
id|fi-&gt;q.host_hpcq_cons_indx
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u_long
)paren
(paren
id|fi-&gt;q.host_hpcq_cons_indx
)paren
op_mod
l_int|32
)paren
id|fi-&gt;q.host_hpcq_cons_indx
op_increment
suffix:semicolon
id|fi-&gt;q.host_imq_prod_indx
op_assign
id|kmalloc
c_func
(paren
l_int|2
op_star
l_int|32
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.host_imq_prod_indx
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;fi-&gt;q.host_imq_prod_indx : memory not allocated&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|fi-&gt;q.ptr_host_imq_prod_indx
op_assign
id|fi-&gt;q.host_imq_prod_indx
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u_long
)paren
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
op_mod
l_int|32
)paren
id|fi-&gt;q.host_imq_prod_indx
op_increment
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;build_queues&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|write_to_tachyon_registers
r_static
r_void
id|write_to_tachyon_registers
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
id|bus_addr
comma
id|bus_indx_addr
comma
id|i
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;write_to_tachyon_registers&quot;
)paren
suffix:semicolon
multiline_comment|/* Clear Queues each time Tachyon is reset */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_ocq_base
comma
l_int|0
comma
id|OCQ_LENGTH
op_star
l_int|32
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_imq_base
comma
l_int|0
comma
id|IMQ_LENGTH
op_star
l_int|32
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_edb_base
comma
l_int|0
comma
id|EDB_LEN
op_star
l_int|8
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_sest_base
comma
l_int|0
comma
id|SEST_LENGTH
op_star
l_int|32
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_sdb_base
comma
l_int|0
comma
id|NO_OF_SDB_ENTRIES
op_star
id|SDB_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|fi-&gt;q.ptr_tachyon_header_base
comma
l_int|0xFF
comma
id|NO_OF_TACH_HEADERS
op_star
id|TACH_HEADER_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SEST_LENGTH
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.free_scsi_oxid
(braket
id|i
)braket
op_assign
id|OXID_AVAILABLE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_SDB_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;q.sdb_slot_status
(braket
id|i
)braket
op_assign
id|SDB_FREE
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_config_reg
)paren
op_or
id|SCSI_ENABLE
op_or
id|WRITE_STREAM_SIZE
op_or
id|READ_STREAM_SIZE
op_or
id|PARITY_EVEN
op_or
id|OOO_REASSEMBLY_DISABLE
comma
id|fi-&gt;t_r.ptr_tach_config_reg
)paren
suffix:semicolon
multiline_comment|/* Write OCQ registers */
id|fi-&gt;q.ocq_prod_indx
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|fi-&gt;q.host_ocq_cons_indx
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* The Tachyon needs to be passed the &quot;real&quot; address */
id|bus_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_ocq_base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_addr
comma
id|fi-&gt;t_r.ptr_ocq_base_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|OCQ_LENGTH
op_minus
l_int|1
comma
id|fi-&gt;t_r
dot
id|ptr_ocq_len_reg
)paren
suffix:semicolon
id|bus_indx_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.host_ocq_cons_indx
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_indx_addr
comma
id|fi-&gt;t_r.ptr_ocq_cons_indx_reg
)paren
suffix:semicolon
multiline_comment|/* Write IMQ registers */
id|fi-&gt;q.imq_cons_indx
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
op_assign
l_int|0
suffix:semicolon
id|bus_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_imq_base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_addr
comma
id|fi-&gt;t_r.ptr_imq_base_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|IMQ_LENGTH
op_minus
l_int|1
comma
id|fi-&gt;t_r.ptr_imq_len_reg
)paren
suffix:semicolon
id|bus_indx_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_indx_addr
comma
id|fi-&gt;t_r.ptr_imq_prod_indx_reg
)paren
suffix:semicolon
multiline_comment|/* Write MFSBQ registers */
id|fi-&gt;q.mfsbq_prod_indx
op_assign
id|MFSBQ_LENGTH
op_minus
l_int|1
suffix:semicolon
id|fi-&gt;q.mfsbuff_end
op_assign
id|MFS_BUFFER_SIZE
op_minus
l_int|1
suffix:semicolon
id|fi-&gt;q.mfsbq_cons_indx
op_assign
l_int|0
suffix:semicolon
id|bus_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_addr
comma
id|fi-&gt;t_r.ptr_mfsbq_base_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|MFSBQ_LENGTH
op_minus
l_int|1
comma
id|fi-&gt;t_r.ptr_mfsbq_len_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.mfsbuff_end
comma
id|fi-&gt;t_r.ptr_mfsbuff_len_reg
)paren
suffix:semicolon
multiline_comment|/* Do this last as tachyon will prefetch the &n;&t; * first entry as soon as we write to it.&n;&t; */
id|writel
c_func
(paren
id|fi-&gt;q.mfsbq_prod_indx
comma
id|fi-&gt;t_r.ptr_mfsbq_prod_reg
)paren
suffix:semicolon
multiline_comment|/* Write SFSBQ registers */
id|fi-&gt;q.sfsbq_prod_indx
op_assign
id|SFSBQ_LENGTH
op_minus
l_int|1
suffix:semicolon
id|fi-&gt;q.sfsbuff_end
op_assign
id|SFS_BUFFER_SIZE
op_minus
l_int|1
suffix:semicolon
id|fi-&gt;q.sfsbq_cons_indx
op_assign
l_int|0
suffix:semicolon
id|bus_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_sfsbq_base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_addr
comma
id|fi-&gt;t_r.ptr_sfsbq_base_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SFSBQ_LENGTH
op_minus
l_int|1
comma
id|fi-&gt;t_r.ptr_sfsbq_len_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.sfsbuff_end
comma
id|fi-&gt;t_r.ptr_sfsbuff_len_reg
)paren
suffix:semicolon
multiline_comment|/* Do this last as tachyon will prefetch the first &n;&t; * entry as soon as we write to it. &n;&t; */
id|writel
c_func
(paren
id|fi-&gt;q.sfsbq_prod_indx
comma
id|fi-&gt;t_r.ptr_sfsbq_prod_reg
)paren
suffix:semicolon
multiline_comment|/* Write SEST registers */
id|bus_addr
op_assign
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_sest_base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|bus_addr
comma
id|fi-&gt;t_r.ptr_sest_base_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SEST_LENGTH
op_minus
l_int|1
comma
id|fi-&gt;t_r.ptr_sest_len_reg
)paren
suffix:semicolon
multiline_comment|/* the last 2 bits _should_ be 1 */
id|writel
c_func
(paren
id|SEST_BUFFER_SIZE
op_minus
l_int|1
comma
id|fi-&gt;t_r.ptr_scsibuff_len_reg
)paren
suffix:semicolon
multiline_comment|/* write AL_TIME &amp; E_D_TOV into the registers */
id|writel
c_func
(paren
id|TOV_VALUES
comma
id|fi-&gt;t_r.ptr_fm_tov_reg
)paren
suffix:semicolon
multiline_comment|/* Tell Tachyon to pick a Soft Assigned AL_PA */
id|writel
c_func
(paren
id|LOOP_INIT_SOFT_ADDRESS
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
multiline_comment|/* Read the WWN from EEPROM . But, for now we assign it here. */
id|writel
c_func
(paren
id|WORLD_WIDE_NAME_LOW
comma
id|fi-&gt;t_r.ptr_fm_wwn_low_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|WORLD_WIDE_NAME_HIGH
comma
id|fi-&gt;t_r.ptr_fm_wwn_hi_reg
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;TACHYON initializing as L_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;write_to_tachyon_registers&quot;
)paren
suffix:semicolon
)brace
DECL|function|tachyon_interrupt
r_static
r_void
id|tachyon_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|dev_id
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
id|hostdata-&gt;fi
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
id|tachyon_interrupt_handler
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|tachyon_interrupt_handler
r_static
r_void
id|tachyon_interrupt_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|dev_id
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
id|hostdata-&gt;fi
suffix:semicolon
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
id|u_int
id|imq_int_type
comma
id|current_IMQ_index
op_assign
l_int|0
comma
id|prev_IMQ_index
suffix:semicolon
r_int
id|index
comma
id|no_of_entries
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tachyon_interrupt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.host_imq_prod_indx
op_ne
l_int|NULL
)paren
(brace
id|current_IMQ_index
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* _Should not_ happen */
id|T_MSG
c_func
(paren
l_string|&quot;IMQ_indx NULL. DISABLING INTERRUPTS!!!&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_IMQ_index
OG
id|fi-&gt;q.imq_cons_indx
)paren
id|no_of_entries
op_assign
id|current_IMQ_index
op_minus
id|fi-&gt;q.imq_cons_indx
suffix:semicolon
r_else
r_if
c_cond
(paren
id|current_IMQ_index
OL
id|fi-&gt;q.imq_cons_indx
)paren
id|no_of_entries
op_assign
id|IMQ_LENGTH
op_minus
(paren
id|fi-&gt;q.imq_cons_indx
op_minus
id|current_IMQ_index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|no_of_entries
op_eq
l_int|0
)paren
(brace
id|u_int
id|ichip_status
suffix:semicolon
id|ichip_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;i_r.ptr_ichip_hw_status_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ichip_status
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Should _never_ happen. Might require a hard reset */
id|T_MSG
c_func
(paren
l_string|&quot;Too bad... PCI Bus Error. Resetting (i)chip&quot;
)paren
suffix:semicolon
id|reset_ichip
c_func
(paren
id|fi
)paren
suffix:semicolon
id|T_MSG
c_func
(paren
l_string|&quot;DISABLING INTERRUPTS!!!&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
)paren
suffix:semicolon
)brace
)brace
id|prev_IMQ_index
op_assign
id|current_IMQ_index
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|no_of_entries
suffix:semicolon
id|index
op_increment
)paren
(brace
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|imq_int_type
op_assign
id|ntohl
c_func
(paren
op_star
id|ptr_imq_entry
)paren
suffix:semicolon
id|completion_message_handler
c_func
(paren
id|fi
comma
id|imq_int_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.link_up
op_eq
id|FALSE
)paren
op_logical_and
(paren
(paren
id|imq_int_type
op_eq
id|MFS_BUF_WARN
)paren
op_logical_or
(paren
id|imq_int_type
op_eq
id|SFS_BUF_WARN
)paren
op_logical_or
(paren
id|imq_int_type
op_eq
id|IMQ_BUF_WARN
)paren
)paren
)paren
r_break
suffix:semicolon
id|update_IMQ_indx
c_func
(paren
id|fi
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Check for more entries */
id|current_IMQ_index
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_IMQ_index
op_ne
id|prev_IMQ_index
)paren
(brace
id|no_of_entries
op_increment
suffix:semicolon
id|prev_IMQ_index
op_assign
id|current_IMQ_index
suffix:semicolon
)brace
)brace
multiline_comment|/*end of for loop*/
r_return
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tachyon_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_SFS_BUF_WARN_interrupt
r_static
r_void
id|handle_SFS_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|i
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_SFS_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.link_up
op_eq
id|FALSE
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Free up all but one entry in the Q. &n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
(paren
id|SFSBQ_LENGTH
op_minus
l_int|1
)paren
op_star
id|NO_OF_ENTRIES
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|handle_SFS_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
id|update_IMQ_indx
c_func
(paren
id|fi
comma
l_int|1
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;handle_SFS_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Untested_Code_Begin */
DECL|function|handle_MFS_BUF_WARN_interrupt
r_static
r_void
id|handle_MFS_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|i
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_MFS_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.link_up
op_eq
id|FALSE
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* FIXME: freeing up 8 entries. &n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|handle_MFS_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
id|update_IMQ_indx
c_func
(paren
id|fi
comma
l_int|1
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;handle_MFS_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*Untested_Code_End */
DECL|function|handle_IMQ_BUF_WARN_interrupt
r_static
r_void
id|handle_IMQ_BUF_WARN_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
id|u_int
id|imq_int_type
comma
id|current_IMQ_index
op_assign
l_int|0
comma
id|temp_imq_cons_indx
suffix:semicolon
r_int
id|index
comma
id|no_of_entries
op_assign
l_int|0
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_IMQ_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.link_up
op_eq
id|FALSE
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|current_IMQ_index
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.host_imq_prod_indx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_IMQ_index
OG
id|fi-&gt;q.imq_cons_indx
)paren
id|no_of_entries
op_assign
id|current_IMQ_index
op_minus
id|fi-&gt;q.imq_cons_indx
suffix:semicolon
r_else
r_if
c_cond
(paren
id|current_IMQ_index
OL
id|fi-&gt;q.imq_cons_indx
)paren
id|no_of_entries
op_assign
id|IMQ_LENGTH
op_minus
(paren
id|fi-&gt;q.imq_cons_indx
op_minus
id|current_IMQ_index
)paren
suffix:semicolon
multiline_comment|/* We dont want to look at the same IMQ entry again. &n;&t; */
id|temp_imq_cons_indx
op_assign
id|fi-&gt;q.imq_cons_indx
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|no_of_entries
op_ne
l_int|0
)paren
id|no_of_entries
op_sub_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|no_of_entries
suffix:semicolon
id|index
op_increment
)paren
(brace
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|temp_imq_cons_indx
)braket
suffix:semicolon
id|imq_int_type
op_assign
id|ntohl
c_func
(paren
op_star
id|ptr_imq_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|imq_int_type
op_ne
id|IMQ_BUF_WARN
)paren
id|completion_message_handler
c_func
(paren
id|fi
comma
id|imq_int_type
)paren
suffix:semicolon
id|temp_imq_cons_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|temp_imq_cons_indx
op_eq
id|IMQ_LENGTH
)paren
id|temp_imq_cons_indx
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*end of for loop*/
r_if
c_cond
(paren
id|no_of_entries
op_ne
l_int|0
)paren
id|update_IMQ_indx
c_func
(paren
id|fi
comma
id|no_of_entries
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_IMQ_BUF_WARN_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|completion_message_handler
r_static
r_void
id|completion_message_handler
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|imq_int_type
)paren
(brace
r_switch
c_cond
(paren
id|imq_int_type
)paren
(brace
r_case
id|OUTBOUND_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;OUTBOUND_COMPLETION message received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OUTBOUND_COMPLETION_I
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;OUTBOUND_COMPLETION_I message received&quot;
)paren
suffix:semicolon
id|handle_OCI_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OUT_HI_PRI_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;OUT_HI_PRI_COMPLETION message received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OUT_HI_PRI_COMPLETION_I
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;OUT_HI_PRI_COMPLETION_I message received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_MFS_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_MFS_COMPLETION message received&quot;
)paren
suffix:semicolon
id|handle_MFS_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_OOO_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_OOO_COMPLETION message received&quot;
)paren
suffix:semicolon
id|handle_OOO_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_SFS_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_SFS_COMPLETION message received&quot;
)paren
suffix:semicolon
id|handle_SFS_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_UNKNOWN_FRAME_I
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_UNKNOWN_FRAME message received&quot;
)paren
suffix:semicolon
id|handle_Unknown_Frame_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_BUSIED_FRAME
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_BUSIED_FRAME message received&quot;
)paren
suffix:semicolon
id|handle_Busied_Frame_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FRAME_MGR_INTERRUPT
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;FRAME_MGR_INTERRUPT message received&quot;
)paren
suffix:semicolon
id|handle_FM_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_STATUS
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;READ_STATUS message received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SFS_BUF_WARN
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;SFS_BUF_WARN message received&quot;
)paren
suffix:semicolon
id|handle_SFS_BUF_WARN_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MFS_BUF_WARN
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;MFS_BUF_WARN message received&quot;
)paren
suffix:semicolon
id|handle_MFS_BUF_WARN_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMQ_BUF_WARN
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;IMQ_BUF_WARN message received&quot;
)paren
suffix:semicolon
id|handle_IMQ_BUF_WARN_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_C1_TIMEOUT
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_C1_TIMEOUT message received&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BAD_SCSI_FRAME
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;BAD_SCSI_FRAME message received&quot;
)paren
suffix:semicolon
id|handle_Bad_SCSI_Frame_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INB_SCSI_STATUS_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INB_SCSI_STATUS_COMPL message received&quot;
)paren
suffix:semicolon
id|handle_Inbound_SCSI_Status_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_SCSI_COMMAND
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_SCSI_COMMAND message received&quot;
)paren
suffix:semicolon
id|handle_Inbound_SCSI_Command_interrupt
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INBOUND_SCSI_DATA_COMPLETION
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;INBOUND_SCSI_DATA message received&quot;
)paren
suffix:semicolon
multiline_comment|/* Only for targets */
r_break
suffix:semicolon
r_default
suffix:colon
id|T_MSG
c_func
(paren
l_string|&quot;DEFAULT message received, type = %x&quot;
comma
id|imq_int_type
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|reset_latch
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
DECL|function|handle_OCI_interrupt
r_static
r_void
id|handle_OCI_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
id|u_long
id|transaction_id
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|status
comma
id|seq_count
comma
id|transmitted_ox_id
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|fi-&gt;host
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|Scsi_Cmnd
op_star
id|Cmnd
suffix:semicolon
id|u_int
id|tag
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_OCI_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|transaction_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|seq_count
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;transaction_id= %x&quot;
comma
(paren
id|u_int
)paren
id|transaction_id
)paren
suffix:semicolon
id|tag
op_assign
id|transaction_id
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|transmitted_ox_id
op_assign
id|transaction_id
suffix:semicolon
multiline_comment|/* The INT could be either due to TIME_OUT | BAD_ALPA. &n;&t; * But we check only for TimeOuts. Bad AL_PA will &n;&t; * caught by FM_interrupt handler. &n;&t; */
r_if
c_cond
(paren
(paren
id|status
op_eq
id|OCM_TIMEOUT_OR_BAD_ALPA
)paren
op_logical_and
(paren
op_logical_neg
id|fi-&gt;g.port_discovery
)paren
op_logical_and
(paren
op_logical_neg
id|fi-&gt;g.perform_adisc
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Frame TimeOut on OX_ID = %x&quot;
comma
(paren
id|u_int
)paren
id|transaction_id
)paren
suffix:semicolon
multiline_comment|/* Is it a SCSI frame that is timing out ? Not a very good check... &n;&t;&t; */
r_if
c_cond
(paren
(paren
id|transmitted_ox_id
op_le
id|MAX_SCSI_OXID
)paren
op_logical_and
(paren
(paren
id|tag
op_eq
id|FC_SCSI_BAD_TARGET
)paren
op_logical_or
(paren
id|tag
OL
l_int|0x00FF0000
)paren
)paren
)paren
(brace
multiline_comment|/* If it is a Bad AL_PA, we report it as BAD_TARGET.&n;&t;&t;&t; * Else, we allow the command to time-out. A Link&n;&t;&t;&t; * re-initialization could be taking place.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|tag
op_eq
id|FC_SCSI_BAD_TARGET
)paren
(brace
id|Cmnd
op_assign
id|hostdata-&gt;cmnd_handler
(braket
id|transmitted_ox_id
op_amp
id|MAX_SCSI_XID
)braket
suffix:semicolon
id|hostdata-&gt;cmnd_handler
(braket
id|transmitted_ox_id
op_amp
id|MAX_SCSI_XID
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd
op_ne
l_int|NULL
)paren
(brace
id|Cmnd-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
(paren
op_star
id|Cmnd-&gt;scsi_done
)paren
(paren
id|Cmnd
)paren
suffix:semicolon
)brace
r_else
id|T_MSG
c_func
(paren
l_string|&quot;NULL Command out of handler!&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* if Bad Target */
r_else
(brace
id|u_char
id|missing_target
op_assign
id|tag
op_rshift
l_int|16
suffix:semicolon
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
multiline_comment|/* A Node that we thought was logged in has gone&n;&t;&t;&t;&t; * away. We are the optimistic kind and we keep&n;&t;&t;&t;&t; * hoping that our dear little Target will come back&n;&t;&t;&t;&t; * to us. For now we log him out.&n;&t;&t;&t;&t; */
id|DPRINTK2
c_func
(paren
l_string|&quot;Missing Target = %d&quot;
comma
id|missing_target
)paren
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;target_id
op_eq
id|missing_target
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Target %d Logged out&quot;
comma
id|q-&gt;target_id
)paren
suffix:semicolon
id|q-&gt;login
op_assign
id|LOGIN_ATTEMPTED
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;num_nodes
OG
l_int|0
)paren
id|fi-&gt;num_nodes
op_decrement
suffix:semicolon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|q-&gt;d_id
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* End of SCSI frame timing out. */
r_else
(brace
r_if
c_cond
(paren
id|seq_count
OG
l_int|1
)paren
(brace
multiline_comment|/* An IP frame was transmitted to a Bad AL_PA. Free up&n;&t;&t;&t; &t; * the skb used.&n;&t;&t;&t; &t; */
id|dev_kfree_skb_irq
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
(paren
id|bus_to_virt
c_func
(paren
id|transaction_id
)paren
)paren
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|fi-&gt;dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* End of IP frame timing out. */
)brace
multiline_comment|/* End of frame timing out. */
r_else
(brace
multiline_comment|/* Frame was transmitted successfully. Check if it was an ELS&n;&t;&t; * frame or an IP frame or a Bad_Target_Notification frame (in&n;&t;&t; * case of a ptp_link). Ugly!&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|status
op_eq
l_int|0
)paren
op_logical_and
(paren
id|seq_count
op_eq
l_int|0
)paren
)paren
(brace
id|u_int
id|tag
op_assign
id|transaction_id
op_amp
l_int|0xFFFF0000
suffix:semicolon
multiline_comment|/* Continue with port discovery after an ELS is successfully &n;&t;&t; * transmitted. (status == 0). &n;&t;&t; */
id|DPRINTK
c_func
(paren
l_string|&quot;tag = %x&quot;
comma
id|tag
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tag
)paren
(brace
r_case
id|ELS_FLOGI
suffix:colon
multiline_comment|/* Letz use the Name Server instead */
id|fi-&gt;g.explore_fabric
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.alpa_list_index
op_assign
id|MAX_NODES
suffix:semicolon
id|add_to_ox_id_list
c_func
(paren
id|fi
comma
id|transaction_id
comma
id|tag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_PLOGI
suffix:colon
r_if
c_cond
(paren
id|fi-&gt;g.fabric_present
op_logical_and
(paren
id|fi-&gt;g.name_server
op_eq
id|FALSE
)paren
)paren
id|add_to_ox_id_list
c_func
(paren
id|fi
comma
id|transaction_id
comma
id|ELS_NS_PLOGI
)paren
suffix:semicolon
r_else
id|add_to_ox_id_list
c_func
(paren
id|fi
comma
id|transaction_id
comma
id|tag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_SCSI_BAD_TARGET
suffix:colon
id|Cmnd
op_assign
id|hostdata-&gt;cmnd_handler
(braket
id|transmitted_ox_id
op_amp
id|MAX_SCSI_XID
)braket
suffix:semicolon
id|hostdata-&gt;cmnd_handler
(braket
id|transmitted_ox_id
op_amp
id|MAX_SCSI_XID
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd
op_ne
l_int|NULL
)paren
(brace
id|Cmnd-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
(paren
op_star
id|Cmnd-&gt;scsi_done
)paren
(paren
id|Cmnd
)paren
suffix:semicolon
)brace
r_else
id|T_MSG
c_func
(paren
l_string|&quot;NULL Command out of handler!&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|add_to_ox_id_list
c_func
(paren
id|fi
comma
id|transaction_id
comma
id|tag
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.alpa_list_index
op_ge
id|MAX_NODES
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
(brace
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|add_display_cache_timer
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|fi-&gt;g.alpa_list_index
op_assign
id|MAX_NODES
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
id|local_port_discovery
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* An IP frame has been successfully transmitted.&n;&t;&t;&t; * Free the skb that was used for this IP frame.&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|status
op_eq
l_int|0
)paren
op_logical_and
(paren
id|seq_count
OG
l_int|1
)paren
)paren
(brace
id|dev_kfree_skb_irq
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
(paren
id|bus_to_virt
c_func
(paren
id|transaction_id
)paren
)paren
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|fi-&gt;dev
)paren
suffix:semicolon
)brace
)brace
)brace
id|LEAVE
c_func
(paren
l_string|&quot;handle_OCI_interrupt&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Right now we discard OOO frames */
DECL|function|handle_OOO_interrupt
r_static
r_void
id|handle_OOO_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
comma
id|payload_size
suffix:semicolon
r_int
id|no_of_buffers
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* header is in a separate buffer */
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
id|payload_size
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
op_minus
id|TACHYON_HEADER_LEN
suffix:semicolon
multiline_comment|/* Calculate total number of buffers */
id|no_of_buffers
op_add_assign
id|payload_size
op_div
id|MFS_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|payload_size
op_mod
id|MFS_BUFFER_SIZE
)paren
id|no_of_buffers
op_increment
suffix:semicolon
multiline_comment|/* provide Tachyon will another set of buffers */
id|fi-&gt;g.mfs_buffer_count
op_add_assign
id|no_of_buffers
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.mfs_buffer_count
op_ge
id|NO_OF_ENTRIES
)paren
(brace
r_int
id|count
op_assign
id|fi-&gt;g.mfs_buffer_count
op_div
id|NO_OF_ENTRIES
suffix:semicolon
id|fi-&gt;g.mfs_buffer_count
op_sub_assign
id|NO_OF_ENTRIES
op_star
id|count
suffix:semicolon
id|update_MFSBQ_indx
c_func
(paren
id|fi
comma
id|count
)paren
suffix:semicolon
)brace
)brace
DECL|function|handle_MFS_interrupt
r_static
r_void
id|handle_MFS_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
comma
op_star
id|buff_addr
suffix:semicolon
id|u_int
id|type_of_frame
comma
id|s_id
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
comma
id|payload_size
comma
id|starting_indx
comma
id|starting_offset
suffix:semicolon
id|u_short
id|received_ox_id
suffix:semicolon
r_int
id|no_of_buffers
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* header is in a separate buffer */
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|wrap_around
op_assign
id|FALSE
comma
id|no_of_wrap_buffs
op_assign
id|NO_OF_ENTRIES
op_minus
l_int|1
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_MFS_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;queue_indx = %d, offset  = %d&bslash;n&quot;
comma
id|queue_indx
comma
id|offset
)paren
suffix:semicolon
id|payload_size
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
op_minus
id|TACHYON_HEADER_LEN
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;payload_size = %d&quot;
comma
id|payload_size
)paren
suffix:semicolon
multiline_comment|/* Calculate total number of buffers */
id|no_of_buffers
op_add_assign
id|payload_size
op_div
id|MFS_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|payload_size
op_mod
id|MFS_BUFFER_SIZE
)paren
id|no_of_buffers
op_increment
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;no_of_buffers = %d&quot;
comma
id|no_of_buffers
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|no_of_buffers
op_minus
l_int|1
)paren
op_le
id|offset
)paren
(brace
id|starting_offset
op_assign
id|offset
op_minus
(paren
id|no_of_buffers
op_minus
l_int|1
)paren
suffix:semicolon
id|starting_indx
op_assign
id|queue_indx
suffix:semicolon
)brace
r_else
(brace
r_int
id|temp
op_assign
id|no_of_buffers
op_minus
(paren
id|offset
op_plus
l_int|1
)paren
suffix:semicolon
r_int
id|no_of_queues
op_assign
id|temp
op_div
id|NO_OF_ENTRIES
suffix:semicolon
id|starting_offset
op_assign
id|temp
op_mod
id|NO_OF_ENTRIES
suffix:semicolon
r_if
c_cond
(paren
id|starting_offset
op_ne
l_int|0
)paren
(brace
id|no_of_wrap_buffs
op_assign
id|starting_offset
op_minus
l_int|1
suffix:semicolon
singleline_comment|//exclude header
id|starting_offset
op_assign
id|NO_OF_ENTRIES
op_minus
id|starting_offset
suffix:semicolon
id|no_of_queues
op_increment
suffix:semicolon
)brace
id|starting_indx
op_assign
id|queue_indx
op_minus
id|no_of_queues
suffix:semicolon
r_if
c_cond
(paren
id|starting_indx
OL
l_int|0
)paren
(brace
id|no_of_wrap_buffs
op_sub_assign
(paren
id|starting_indx
op_plus
l_int|1
)paren
op_star
id|NO_OF_ENTRIES
suffix:semicolon
id|starting_indx
op_assign
id|MFSBQ_LENGTH
op_plus
id|starting_indx
suffix:semicolon
id|wrap_around
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;starting_indx = %d, starting offset = %d no_of_wrap_buffs = %d&bslash;n&quot;
comma
id|starting_indx
comma
id|starting_offset
comma
id|no_of_wrap_buffs
)paren
suffix:semicolon
multiline_comment|/* Get Tachyon Header from first buffer */
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_mfsbq_base
op_plus
id|starting_indx
op_star
id|NO_OF_ENTRIES
op_plus
id|starting_offset
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* extract Type of Frame */
id|type_of_frame
op_assign
(paren
id|u_int
)paren
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|4
)paren
)paren
op_amp
l_int|0xFF000000
suffix:semicolon
id|s_id
op_assign
(paren
id|u_int
)paren
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|received_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|buff_addr
op_add_assign
id|MFS_BUFFER_SIZE
op_div
l_int|4
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;type_of_frame = %x, s_id = %x, ox_id = %x&quot;
comma
id|type_of_frame
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type_of_frame
)paren
(brace
r_case
id|TYPE_LLC_SNAP
suffix:colon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|payload_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: In handle_MFS_interrupt() Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|fi-&gt;name
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_dropped
op_increment
suffix:semicolon
id|fi-&gt;g.mfs_buffer_count
op_add_assign
id|no_of_buffers
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.mfs_buffer_count
op_ge
id|NO_OF_ENTRIES
)paren
(brace
r_int
id|count
op_assign
id|fi-&gt;g.mfs_buffer_count
op_div
id|NO_OF_ENTRIES
suffix:semicolon
id|fi-&gt;g.mfs_buffer_count
op_sub_assign
id|NO_OF_ENTRIES
op_star
id|count
suffix:semicolon
id|update_MFSBQ_indx
c_func
(paren
id|fi
comma
id|count
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|wrap_around
)paren
(brace
r_int
id|wrap_size
op_assign
id|no_of_wrap_buffs
op_star
id|MFS_BUFFER_SIZE
suffix:semicolon
r_int
id|tail_size
op_assign
id|payload_size
op_minus
id|wrap_size
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;wrap_size = %d, tail_size = %d&bslash;n&quot;
comma
id|wrap_size
comma
id|tail_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|no_of_wrap_buffs
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|wrap_size
)paren
comma
id|buff_addr
comma
id|wrap_size
)paren
suffix:semicolon
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|tail_size
)paren
comma
id|buff_addr
comma
id|tail_size
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|payload_size
)paren
comma
id|buff_addr
comma
id|payload_size
)paren
suffix:semicolon
id|rx_net_mfs_packet
c_func
(paren
id|fi
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|T_MSG
c_func
(paren
l_string|&quot;Unknown Frame Type received. Type = %x&quot;
comma
id|type_of_frame
)paren
suffix:semicolon
)brace
multiline_comment|/* provide Tachyon will another set of buffers */
id|fi-&gt;g.mfs_buffer_count
op_add_assign
id|no_of_buffers
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.mfs_buffer_count
op_ge
id|NO_OF_ENTRIES
)paren
(brace
r_int
id|count
op_assign
id|fi-&gt;g.mfs_buffer_count
op_div
id|NO_OF_ENTRIES
suffix:semicolon
id|fi-&gt;g.mfs_buffer_count
op_sub_assign
id|NO_OF_ENTRIES
op_star
id|count
suffix:semicolon
id|update_MFSBQ_indx
c_func
(paren
id|fi
comma
id|count
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;handle_MFS_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_Unknown_Frame_interrupt
r_static
r_void
id|handle_Unknown_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_Unknown_Frame_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* We discard the &quot;unknown&quot; frame */
multiline_comment|/* provide Tachyon will another set of buffers */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_Unknown_Frame_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_Busied_Frame_interrupt
r_static
r_void
id|handle_Busied_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_Busied_Frame_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* We discard the &quot;busied&quot; frame */
multiline_comment|/* provide Tachyon will another set of buffers */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_Busied_Frame_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_Bad_SCSI_Frame_interrupt
r_static
r_void
id|handle_Bad_SCSI_Frame_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
comma
op_star
id|buff_addr
comma
op_star
id|tach_header
comma
op_star
id|ptr_edb
suffix:semicolon
id|u_int
id|s_id
comma
id|rctl
comma
id|frame_class
comma
id|burst_len
comma
id|transfered_len
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
comma
id|payload_size
comma
id|i
suffix:semicolon
id|u_short
id|ox_id
comma
id|rx_id
comma
id|x_id
comma
id|mtu
op_assign
l_int|512
suffix:semicolon
id|u_char
id|target_id
op_assign
l_int|0xFF
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_Bad_SCSI_Frame_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
id|payload_size
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|queue_indx
op_star
id|NO_OF_ENTRIES
op_plus
id|offset
)paren
)paren
)paren
suffix:semicolon
id|rctl
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|2
)paren
)paren
op_amp
l_int|0xFF000000
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|rx_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|6
)paren
)paren
suffix:semicolon
id|x_id
op_assign
id|ox_id
op_amp
id|MAX_SCSI_XID
suffix:semicolon
multiline_comment|/* Any frame that comes in with OX_ID that matches an OX_ID &n;&t; * that has been allocated for SCSI, will be called a Bad&n;&t; * SCSI frame if the Exchange is not valid any more.&n;&t; *&n;&t; * We will also get a Bad SCSI frame interrupt if we receive&n;&t; * a XFER_RDY with offset != 0. Tachyon washes its hands off&n;&t; * this Exchange. We have to take care of ourselves. Grrr...&n;&t; */
r_if
c_cond
(paren
id|rctl
op_eq
id|DATA_DESCRIPTOR
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;d_id
op_eq
id|s_id
)paren
(brace
id|target_id
op_assign
id|q-&gt;target_id
suffix:semicolon
id|mtu
op_assign
id|q-&gt;mtu
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|frame_class
op_assign
id|target_id
suffix:semicolon
id|transfered_len
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|burst_len
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|9
)paren
)paren
suffix:semicolon
id|build_ODB
c_func
(paren
id|fi
comma
id|fi-&gt;g.seq_id
comma
id|s_id
comma
id|burst_len
comma
l_int|0
comma
id|mtu
comma
id|ox_id
comma
id|rx_id
comma
l_int|0
comma
l_int|0
comma
id|frame_class
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Update the SEQ_ID and Relative Offset in the &n;&t;&t; * Tachyon Header Structure.&n;&t;&t; */
id|tach_header
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|5
)paren
)paren
)paren
suffix:semicolon
op_star
(paren
id|tach_header
op_plus
l_int|5
)paren
op_assign
id|htonl
c_func
(paren
id|fi-&gt;g.seq_id
op_lshift
l_int|24
)paren
suffix:semicolon
op_star
(paren
id|tach_header
op_plus
l_int|7
)paren
op_assign
id|htonl
c_func
(paren
id|transfered_len
)paren
suffix:semicolon
id|fi-&gt;g.odb.hdr_addr
op_assign
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Invalidate the EDBs used &n;&t;&t; */
id|ptr_edb
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|7
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EDB_LEN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_edb
(braket
id|i
)braket
op_eq
id|ptr_edb
)paren
r_break
suffix:semicolon
id|ptr_edb
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|EDB_LEN
)paren
(brace
r_int
id|j
suffix:semicolon
r_do
(brace
id|ptr_edb
op_add_assign
l_int|2
suffix:semicolon
id|len
op_add_assign
(paren
id|htonl
c_func
(paren
op_star
id|ptr_edb
)paren
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
id|j
op_assign
id|i
suffix:semicolon
id|fi-&gt;q.free_edb_list
(braket
id|i
op_increment
)braket
op_assign
id|EDB_FREE
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|EDB_LEN
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
id|ptr_edb
op_assign
id|fi-&gt;q.ptr_edb_base
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|len
OL
id|transfered_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|transfered_len
)paren
(brace
id|ptr_edb
op_decrement
suffix:semicolon
id|fi-&gt;q.free_edb_list
(braket
id|j
)braket
op_assign
id|EDB_BUSY
suffix:semicolon
)brace
r_else
id|ptr_edb
op_increment
suffix:semicolon
)brace
r_else
(brace
id|T_MSG
c_func
(paren
l_string|&quot;EDB not found while freeing&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Update the EDB pointer in the ODB.&n;&t;&t; */
id|fi-&gt;g.odb.edb_addr
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|ptr_edb
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_odb
(braket
id|fi-&gt;q.ocq_prod_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.odb
)paren
comma
r_sizeof
(paren
id|ODB
)paren
)paren
suffix:semicolon
multiline_comment|/* Update the EDB pointer in the SEST entry. We might need&n;&t;&t; * this if get another XFER_RDY for the same Exchange.&n;&t;&t; */
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|7
)paren
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|ptr_edb
)paren
)paren
suffix:semicolon
id|update_OCQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.seq_id
op_eq
id|MAX_SEQ_ID
)paren
id|fi-&gt;g.seq_id
op_assign
l_int|0
suffix:semicolon
r_else
id|fi-&gt;g.seq_id
op_increment
suffix:semicolon
)brace
r_else
multiline_comment|/* Could be a BA_ACC or a BA_RJT.&n;&t; */
r_if
c_cond
(paren
id|rctl
op_eq
id|RCTL_BASIC_ACC
)paren
(brace
id|u_int
id|bls_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;BA_ACC received from S_ID 0x%x with OX_ID = %x in response to %x&quot;
comma
id|s_id
comma
id|ox_id
comma
id|bls_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bls_type
op_eq
id|RCTL_BASIC_ABTS
)paren
(brace
id|u_int
id|STE_bit
suffix:semicolon
multiline_comment|/* Invalidate resources for that Exchange.&n;&t;&t;&t; */
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|STE_bit
op_amp
id|SEST_V
)paren
(brace
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
op_and_assign
id|htonl
c_func
(paren
id|SEST_INV
)paren
suffix:semicolon
id|invalidate_SEST_entry
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|rctl
op_eq
id|RCTL_BASIC_RJT
)paren
(brace
id|u_int
id|bls_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;BA_RJT received from S_ID 0x%x with OX_ID = %x in response to %x&quot;
comma
id|s_id
comma
id|ox_id
comma
id|bls_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bls_type
op_eq
id|RCTL_BASIC_ABTS
)paren
(brace
id|u_int
id|STE_bit
suffix:semicolon
multiline_comment|/* Invalidate resources for that Exchange.&n;&t;&t;&t; */
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|STE_bit
op_amp
id|SEST_V
)paren
(brace
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
op_and_assign
id|htonl
c_func
(paren
id|SEST_INV
)paren
suffix:semicolon
id|invalidate_SEST_entry
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
id|DPRINTK1
c_func
(paren
l_string|&quot;Frame with R_CTL = %x received from S_ID 0x%x with OX_ID %x&quot;
comma
id|rctl
comma
id|s_id
comma
id|ox_id
)paren
suffix:semicolon
multiline_comment|/* Else, discard the &quot;Bad&quot; SCSI frame.&n;&t; */
multiline_comment|/* provide Tachyon will another set of buffers &n;&t; */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_Bad_SCSI_Frame_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_Inbound_SCSI_Status_interrupt
r_static
r_void
id|handle_Inbound_SCSI_Status_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|fi-&gt;host
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|u_int
op_star
id|ptr_imq_entry
comma
op_star
id|buff_addr
comma
op_star
id|ptr_rsp_info
comma
op_star
id|ptr_sense_info
op_assign
l_int|NULL
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
comma
id|payload_size
suffix:semicolon
id|u_short
id|received_ox_id
comma
id|x_id
suffix:semicolon
id|Scsi_Cmnd
op_star
id|Cmnd
suffix:semicolon
id|u_int
id|fcp_status
comma
id|fcp_rsp_info_len
op_assign
l_int|0
comma
id|fcp_sense_info_len
op_assign
l_int|0
comma
id|s_id
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_SCSI_status_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|queue_indx
op_star
id|NO_OF_ENTRIES
op_plus
id|offset
)paren
)paren
)paren
suffix:semicolon
id|payload_size
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|received_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|queue_indx
op_star
id|NO_OF_ENTRIES
op_plus
id|offset
)paren
)paren
)paren
suffix:semicolon
id|fcp_status
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|ptr_rsp_info
op_assign
id|buff_addr
op_plus
l_int|14
suffix:semicolon
r_if
c_cond
(paren
id|fcp_status
op_amp
id|FCP_STATUS_RSP_LEN
)paren
id|fcp_rsp_info_len
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|13
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fcp_status
op_amp
id|FCP_STATUS_SENSE_LEN
)paren
(brace
id|ptr_sense_info
op_assign
id|ptr_rsp_info
op_plus
id|fcp_rsp_info_len
op_div
l_int|4
suffix:semicolon
id|fcp_sense_info_len
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sense_info = %x&quot;
comma
(paren
id|u_int
)paren
id|ntohl
c_func
(paren
op_star
id|ptr_sense_info
)paren
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;fcp_status = %x, fcp_rsp_len = %x&quot;
comma
id|fcp_status
comma
id|fcp_rsp_info_len
)paren
suffix:semicolon
id|x_id
op_assign
id|received_ox_id
op_amp
id|MAX_SCSI_XID
suffix:semicolon
id|Cmnd
op_assign
id|hostdata-&gt;cmnd_handler
(braket
id|x_id
)braket
suffix:semicolon
id|hostdata-&gt;cmnd_handler
(braket
id|x_id
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd
op_ne
l_int|NULL
)paren
(brace
id|memset
c_func
(paren
id|Cmnd-&gt;sense_buffer
comma
l_int|0
comma
r_sizeof
(paren
id|Cmnd-&gt;sense_buffer
)paren
)paren
suffix:semicolon
multiline_comment|/* Check if there is a Sense field */
r_if
c_cond
(paren
id|fcp_status
op_amp
id|FCP_STATUS_SENSE_LEN
)paren
(brace
r_int
id|size
op_assign
r_sizeof
(paren
id|Cmnd-&gt;sense_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fcp_sense_info_len
OL
id|size
)paren
id|size
op_assign
id|fcp_sense_info_len
suffix:semicolon
id|memcpy
c_func
(paren
id|Cmnd-&gt;sense_buffer
comma
(paren
r_char
op_star
)paren
id|ptr_sense_info
comma
id|size
)paren
suffix:semicolon
)brace
id|Cmnd-&gt;result
op_assign
id|fcp_status
op_amp
id|FCP_STATUS_MASK
suffix:semicolon
(paren
op_star
id|Cmnd-&gt;scsi_done
)paren
(paren
id|Cmnd
)paren
suffix:semicolon
)brace
r_else
id|T_MSG
c_func
(paren
l_string|&quot;NULL Command out of handler!&quot;
)paren
suffix:semicolon
id|invalidate_SEST_entry
c_func
(paren
id|fi
comma
id|received_ox_id
)paren
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|fi-&gt;q.free_scsi_oxid
(braket
id|x_id
)braket
op_assign
id|OXID_AVAILABLE
suffix:semicolon
multiline_comment|/* provide Tachyon will another set of buffers */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_SCSI_status_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|invalidate_SEST_entry
r_static
r_void
id|invalidate_SEST_entry
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|received_ox_id
)paren
(brace
id|u_short
id|x_id
op_assign
id|received_ox_id
op_amp
id|MAX_SCSI_XID
suffix:semicolon
multiline_comment|/* Invalidate SEST entry if it is an OutBound SEST Entry &n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|received_ox_id
op_amp
id|SCSI_READ_BIT
)paren
)paren
(brace
id|u_int
op_star
id|ptr_tach_header
comma
op_star
id|ptr_edb
suffix:semicolon
id|u_short
id|temp_ox_id
op_assign
id|NOT_SCSI_XID
suffix:semicolon
r_int
id|i
suffix:semicolon
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
op_and_assign
id|htonl
c_func
(paren
id|SEST_INV
)paren
suffix:semicolon
multiline_comment|/* Invalidate the Tachyon Header structure &n;&t;&t; */
id|ptr_tach_header
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|5
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_TACH_HEADERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|i
)braket
op_eq
id|ptr_tach_header
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|NO_OF_TACH_HEADERS
)paren
id|memset
c_func
(paren
id|ptr_tach_header
comma
l_int|0xFF
comma
l_int|32
)paren
suffix:semicolon
r_else
id|T_MSG
c_func
(paren
l_string|&quot;Tachyon Header not found while freeing in invalidate_SEST_entry()&quot;
)paren
suffix:semicolon
multiline_comment|/* Invalidate the EDB used &n;&t;&t; */
id|ptr_edb
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|7
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EDB_LEN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_edb
(braket
id|i
)braket
op_eq
id|ptr_edb
)paren
r_break
suffix:semicolon
id|ptr_edb
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|EDB_LEN
)paren
(brace
r_do
(brace
id|ptr_edb
op_add_assign
l_int|2
suffix:semicolon
id|fi-&gt;q.free_edb_list
(braket
id|i
op_increment
)braket
op_assign
id|EDB_FREE
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|EDB_LEN
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
id|ptr_edb
op_assign
id|fi-&gt;q.ptr_edb_base
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|htonl
c_func
(paren
op_star
id|ptr_edb
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0x80000000
)paren
suffix:semicolon
)brace
r_else
id|T_MSG
c_func
(paren
l_string|&quot;EDB not found while freeing in invalidate_SEST_entry()&quot;
)paren
suffix:semicolon
multiline_comment|/* Search for its other header structure and destroy it! &n;&t;&t; */
r_if
c_cond
(paren
(paren
id|ptr_tach_header
op_plus
l_int|16
)paren
OL
(paren
id|fi-&gt;q.ptr_tachyon_header_base
op_plus
(paren
id|MY_PAGE_SIZE
op_div
l_int|4
)paren
)paren
)paren
id|ptr_tach_header
op_add_assign
l_int|16
suffix:semicolon
r_else
id|ptr_tach_header
op_assign
id|fi-&gt;q.ptr_tachyon_header_base
suffix:semicolon
r_while
c_loop
(paren
id|temp_ox_id
op_ne
id|x_id
)paren
(brace
id|temp_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_tach_header
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|temp_ox_id
op_eq
id|x_id
)paren
(brace
multiline_comment|/* Paranoid checking...&n;&t;&t;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_TACH_HEADERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|i
)braket
op_eq
id|ptr_tach_header
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|NO_OF_TACH_HEADERS
)paren
id|memset
c_func
(paren
id|ptr_tach_header
comma
l_int|0xFF
comma
l_int|32
)paren
suffix:semicolon
r_else
id|T_MSG
c_func
(paren
l_string|&quot;Tachyon Header not found while freeing in invalidate_SEST_entry()&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ptr_tach_header
op_plus
l_int|16
)paren
OL
(paren
id|fi-&gt;q.ptr_tachyon_header_base
op_plus
(paren
id|MY_PAGE_SIZE
op_div
l_int|4
)paren
)paren
)paren
id|ptr_tach_header
op_add_assign
l_int|16
suffix:semicolon
r_else
id|ptr_tach_header
op_assign
id|fi-&gt;q.ptr_tachyon_header_base
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|u_short
id|sdb_table_indx
suffix:semicolon
multiline_comment|/* An Inbound Command has completed or needs to be Aborted. &n;&t; &t; * Clear up the SDB buffers.&n;&t;&t; */
id|sdb_table_indx
op_assign
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|5
)paren
suffix:semicolon
id|fi-&gt;q.sdb_slot_status
(braket
id|sdb_table_indx
)braket
op_assign
id|SDB_FREE
suffix:semicolon
)brace
)brace
DECL|function|handle_Inbound_SCSI_Command_interrupt
r_static
r_void
id|handle_Inbound_SCSI_Command_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_Inbound_SCSI_Command_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* We discard the SCSI frame as we shouldn&squot;t be receiving&n;&t; * a SCSI Command in the first place &n;&t; */
multiline_comment|/* provide Tachyon will another set of buffers */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_Inbound_SCSI_Command_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_SFS_interrupt
r_static
r_void
id|handle_SFS_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
op_star
id|ptr_imq_entry
comma
op_star
id|buff_addr
suffix:semicolon
id|u_int
id|class_of_frame
comma
id|type_of_frame
comma
id|s_id
comma
id|els_type
op_assign
l_int|0
comma
id|rctl
suffix:semicolon
r_int
id|queue_indx
comma
id|offset
comma
id|payload_size
comma
id|login_state
suffix:semicolon
id|u_short
id|received_ox_id
comma
id|fs_cmnd_code
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_SFS_interrupt&quot;
)paren
suffix:semicolon
id|ptr_imq_entry
op_assign
id|fi-&gt;q.ptr_imqe
(braket
id|fi-&gt;q.imq_cons_indx
)braket
suffix:semicolon
id|offset
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0x00000007
suffix:semicolon
id|queue_indx
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xFFFF0000
suffix:semicolon
id|queue_indx
op_assign
id|queue_indx
op_rshift
l_int|16
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;queue_indx = %d, offset  = %d&bslash;n&quot;
comma
id|queue_indx
comma
id|offset
)paren
suffix:semicolon
id|payload_size
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|ptr_imq_entry
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;payload_size = %d&quot;
comma
id|payload_size
)paren
suffix:semicolon
id|buff_addr
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sfsbq_base
op_plus
id|queue_indx
op_star
id|NO_OF_ENTRIES
op_plus
id|offset
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* extract Type of Frame */
id|type_of_frame
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|4
)paren
)paren
op_amp
l_int|0xFF000000
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|received_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|type_of_frame
)paren
(brace
r_case
id|TYPE_BLS
suffix:colon
id|rctl
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|2
)paren
)paren
op_amp
l_int|0xFF000000
suffix:semicolon
r_switch
c_cond
(paren
id|rctl
)paren
(brace
r_case
id|RCTL_BASIC_ABTS
suffix:colon
multiline_comment|/* As an Initiator, we should never be receiving &n;&t;&t;&t;&t;&t; * this.&n;&t;&t; &t;&t;&t; */
id|DPRINTK1
c_func
(paren
l_string|&quot;ABTS received from S_ID 0x%x with OX_ID = %x&quot;
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TYPE_ELS
suffix:colon
id|class_of_frame
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|login_state
op_assign
id|sid_logged_in
c_func
(paren
id|fi
comma
id|s_id
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|class_of_frame
op_amp
l_int|0xFF000000
)paren
(brace
r_case
id|ELS_PLOGI
suffix:colon
r_if
c_cond
(paren
id|s_id
op_ne
id|fi-&gt;g.my_id
)paren
(brace
id|u_int
id|ret_code
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;PLOGI received from D_ID 0x%x with 0X_ID = %x&quot;
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret_code
op_assign
id|plogi_ok
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|payload_size
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|tx_logi_acc
c_func
(paren
id|fi
comma
id|ELS_ACC
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
id|add_to_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
)paren
suffix:semicolon
)brace
r_else
(brace
id|u_short
id|cmnd_code
op_assign
id|ret_code
op_rshift
l_int|16
suffix:semicolon
id|u_short
id|expln_code
op_assign
id|ret_code
suffix:semicolon
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|cmnd_code
comma
id|expln_code
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|ELS_ACC
suffix:colon
id|els_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|received_ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ACC received from D_ID 0x%x in response to ELS %x&quot;
comma
id|s_id
comma
id|els_type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|els_type
)paren
(brace
r_case
id|ELS_PLOGI
suffix:colon
id|add_to_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
)paren
suffix:semicolon
id|tx_prli
c_func
(paren
id|fi
comma
id|ELS_PRLI
comma
id|s_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FLOGI
suffix:colon
id|add_to_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
)paren
suffix:semicolon
id|fi-&gt;g.my_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|2
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|fi-&gt;g.fabric_present
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.my_ddaa
op_assign
id|fi-&gt;g.my_id
op_amp
l_int|0xFFFF00
suffix:semicolon
multiline_comment|/* Login to the Name Server &n;&t;&t;&t;&t;&t;&t;&t; */
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|DIRECTORY_SERVER
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_NS_PLOGI
suffix:colon
id|fi-&gt;g.name_server
op_assign
id|TRUE
suffix:semicolon
id|add_to_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
)paren
suffix:semicolon
id|tx_name_server_req
c_func
(paren
id|fi
comma
id|FCS_RFC_4
)paren
suffix:semicolon
id|tx_scr
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* Some devices have a delay before &n;&t;&t;&t;&t;&t;&t;&t; * registering with the Name Server &n;&t;&t;&t;&t;&t;&t;&t; */
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|tx_name_server_req
c_func
(paren
id|fi
comma
id|FCS_GP_ID4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_PRLI
suffix:colon
id|mark_scsi_sid
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|ADD_ENTRY
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ADISC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|validate_login
c_func
(paren
id|fi
comma
id|buff_addr
)paren
)paren
)paren
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ELS_PDISC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_PDISC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ADISC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ADISC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node_logged_in_prev
c_func
(paren
id|fi
comma
id|buff_addr
)paren
)paren
id|tx_adisc
c_func
(paren
id|fi
comma
id|ELS_ACC
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_PRLI
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_PRLI received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
(brace
id|tx_prli
c_func
(paren
id|fi
comma
id|ELS_ACC
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
id|mark_scsi_sid
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|ADD_ENTRY
)paren
suffix:semicolon
)brace
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_PRLO
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_PRLO received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_OUT
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_NOT_PRESENT
)paren
)paren
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
(brace
id|tx_prli
c_func
(paren
id|fi
comma
id|ELS_ACC
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
id|mark_scsi_sid
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|DELETE_ENTRY
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ELS_LS_RJT
suffix:colon
id|els_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|received_ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_LS_RJT received from D_ID 0x%x in response to %x&quot;
comma
id|s_id
comma
id|els_type
)paren
suffix:semicolon
multiline_comment|/* We should be chking the reason code.&n;&t;&t;&t;&t;&t; */
r_switch
c_cond
(paren
id|els_type
)paren
(brace
r_case
id|ELS_ADISC
suffix:colon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|s_id
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ELS_LOGO
suffix:colon
id|els_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|received_ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_LOGO received from D_ID 0x%x in response to %x&quot;
comma
id|s_id
comma
id|els_type
)paren
suffix:semicolon
id|remove_from_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|ELS_LOGO
)paren
suffix:semicolon
id|tx_acc
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|els_type
op_eq
id|ELS_ADISC
)paren
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|s_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RSCN
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RSCN received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
id|tx_acc
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
id|remove_from_address_cache
c_func
(paren
id|fi
comma
id|buff_addr
comma
id|ELS_RSCN
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FARP_REQ
suffix:colon
multiline_comment|/* We do not support FARP.&n;&t;&t;&t;&t;&t;   So, silently discard it */
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FARP_REQ received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ABTX
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ABTX received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FLOGI
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FLOGI received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
(brace
multiline_comment|/* The node could have come up as an N_Port&n;&t;&t;&t;&t;&t;&t; * in a Loop! So,try initializing as an NL_port&n;&t;&t;&t;&t;&t;&t; */
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* write AL_TIME &amp; E_D_TOV into the registers */
id|writel
c_func
(paren
id|TOV_VALUES
comma
id|fi-&gt;t_r.ptr_fm_tov_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|LOOP_INIT_SOFT_ADDRESS
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;FLOGI received, TACHYON initializing as L_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ELS_ADVC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ADVC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ECHO
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ECHO received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ESTC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ESTC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_ESTS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_ESTS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RCS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RCS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RES
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RES received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RLS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RLS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RRQ
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RRQ received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RSS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RSS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RTV
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RTV received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RSI
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RSI received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_TEST
suffix:colon
multiline_comment|/* No reply sequence */
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_TEST received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RNC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RNC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RVCS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_RVCS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_TPLS
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_TPLS received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_GAID
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_GAID received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FACT
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FACT received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FAN
suffix:colon
multiline_comment|/* Hmmm... You don&squot;t support FAN ??? */
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FAN received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FDACT
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FDACT received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_NACT
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_NACT received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_NDACT
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_NDACT received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_QoSR
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_QoSR received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_FDISC
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_FDISC received from D_ID 0x%x&quot;
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS Frame %x received from D_ID 0x%x&quot;
comma
id|class_of_frame
comma
id|s_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|CMND_NOT_SUPP
comma
id|NO_EXPLN
)paren
suffix:semicolon
r_else
id|tx_logo
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TYPE_FC_SERVICES
suffix:colon
id|fs_cmnd_code
op_assign
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|10
)paren
)paren
op_amp
l_int|0xFFFF0000
)paren
op_rshift
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|fs_cmnd_code
)paren
(brace
r_case
id|FCS_ACC
suffix:colon
id|els_type
op_assign
id|remove_from_ox_id_list
c_func
(paren
id|fi
comma
id|received_ox_id
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;FCS_ACC received from D_ID 0x%x in response to %x&quot;
comma
id|s_id
comma
id|els_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|els_type
op_eq
id|FCS_GP_ID4
)paren
id|explore_fabric
c_func
(paren
id|fi
comma
id|buff_addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FCS_REJECT
suffix:colon
id|DPRINTK1
c_func
(paren
l_string|&quot;FCS_REJECT received from D_ID 0x%x in response to %x&quot;
comma
id|s_id
comma
id|els_type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TYPE_LLC_SNAP
suffix:colon
id|rx_net_packet
c_func
(paren
id|fi
comma
(paren
id|u_char
op_star
)paren
id|buff_addr
comma
id|payload_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|T_MSG
c_func
(paren
l_string|&quot;Frame Type %x received from %x&quot;
comma
id|type_of_frame
comma
id|s_id
)paren
suffix:semicolon
)brace
multiline_comment|/* provide Tachyon will another set of buffers */
r_if
c_cond
(paren
id|offset
op_eq
(paren
id|NO_OF_ENTRIES
op_minus
l_int|1
)paren
)paren
id|update_SFSBQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_SFS_interrupt&quot;
)paren
suffix:semicolon
)brace
DECL|function|handle_FM_interrupt
r_static
r_void
id|handle_FM_interrupt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
id|fm_status
suffix:semicolon
id|u_int
id|tachyon_status
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;handle_FM_interrupt&quot;
)paren
suffix:semicolon
id|fm_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_status_reg
)paren
suffix:semicolon
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;FM_status = %x, Tachyon_status = %x&quot;
comma
id|fm_status
comma
id|tachyon_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fm_status
op_amp
id|LINK_DOWN
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Fibre Channel Link DOWN&quot;
)paren
suffix:semicolon
id|fm_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_status_reg
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;nport_timer
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;lport_timer
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;display_cache_timer
)paren
suffix:semicolon
id|fi-&gt;g.link_up
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
id|fi-&gt;g.n_port_try
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.ptp_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.explore_fabric
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.perform_adisc
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* Logout will all nodes */
r_if
c_cond
(paren
id|fi-&gt;node_info_list
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp_list
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|temp_list
)paren
(brace
id|temp_list-&gt;login
op_assign
id|LOGIN_ATTEMPTED
suffix:semicolon
id|temp_list
op_assign
id|temp_list-&gt;next
suffix:semicolon
)brace
id|fi-&gt;num_nodes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fi-&gt;g.n_port_try
op_eq
id|FALSE
)paren
op_logical_and
(paren
id|fi-&gt;g.dont_init
op_eq
id|FALSE
)paren
)paren
(brace
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* write AL_TIME &amp; E_D_TOV into the registers */
id|writel
c_func
(paren
id|TOV_VALUES
comma
id|fi-&gt;t_r.ptr_fm_tov_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.fabric_present
op_eq
id|TRUE
)paren
op_logical_and
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
)paren
(brace
id|u_int
id|al_pa
op_assign
id|fi-&gt;g.my_id
op_amp
l_int|0xFF
suffix:semicolon
id|writel
c_func
(paren
(paren
id|al_pa
op_lshift
l_int|24
)paren
op_or
id|LOOP_INIT_FABRIC_ADDRESS
op_or
id|LOOP_INIT_PREVIOUS_ADDRESS
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
(brace
id|u_int
id|al_pa
op_assign
id|fi-&gt;g.my_id
op_amp
l_int|0xFF
suffix:semicolon
id|writel
c_func
(paren
(paren
id|al_pa
op_lshift
l_int|24
)paren
op_or
id|LOOP_INIT_PREVIOUS_ADDRESS
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
)brace
r_else
id|writel
c_func
(paren
id|LOOP_INIT_SOFT_ADDRESS
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
id|fi-&gt;g.loop_up
op_assign
id|FALSE
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;In LDWN TACHYON initializing as L_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|NON_PARTICIPATING
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Did not acquire an AL_PA. I am not participating&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
id|LINK_UP
)paren
op_logical_and
(paren
(paren
id|fm_status
op_amp
id|LINK_DOWN
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Fibre Channel Link UP&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
id|NON_PARTICIPATING
)paren
op_ne
id|TRUE
)paren
(brace
id|fi-&gt;g.link_up
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|tachyon_status
op_amp
id|OSM_FROZEN
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|ERROR_RELEASE
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|OCQ_RESET
)paren
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;nport_timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;lport_timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;display_cache_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
id|OLD_PORT
)paren
op_eq
l_int|0
)paren
(brace
id|fi-&gt;g.loop_up
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.ptp_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.my_id
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
op_rshift
l_int|24
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;My AL_PA = %x&quot;
comma
id|fi-&gt;g.my_id
)paren
suffix:semicolon
id|fi-&gt;g.port_discovery
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.explore_fabric
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OLD_PORT
)paren
op_logical_and
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_ACTIVE
)paren
)paren
(brace
id|fi-&gt;g.loop_up
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.my_id
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* In a point-to-point configuration, we expect to be&n;&t;&t;&t; * connected to an F_Port. This driver does not yet support&n;&t;&t;&t; * a configuration where it is connected to another N_Port&n;&t;&t;&t; * directly.&n;&t;&t;&t; */
id|fi-&gt;g.explore_fabric
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.n_port_try
op_eq
id|FALSE
)paren
(brace
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* write R_T_TOV &amp; E_D_TOV into the registers */
id|writel
c_func
(paren
id|PTP_TOV_VALUES
comma
id|fi-&gt;t_r.ptr_fm_tov_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|BB_CREDIT
op_or
id|NPORT
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
id|fi-&gt;g.n_port_try
op_assign
id|TRUE
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;In LUP TACHYON initializing as N_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|fi-&gt;g.ptp_up
op_assign
id|TRUE
suffix:semicolon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_FLOGI
comma
id|F_PORT
)paren
suffix:semicolon
)brace
)brace
id|fi-&gt;g.my_ddaa
op_assign
l_int|0x0
suffix:semicolon
id|fi-&gt;g.fabric_present
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* We havn&squot;t sent out any Name Server Reqs */
id|fi-&gt;g.name_server
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.alpa_list_index
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.ox_id
op_assign
id|NOT_SCSI_XID
suffix:semicolon
id|fi-&gt;g.my_mtu
op_assign
id|FRAME_SIZE
suffix:semicolon
multiline_comment|/* Implicitly LOGO with all logged-in nodes. &n;&t;&t; */
r_if
c_cond
(paren
id|fi-&gt;node_info_list
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp_list
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|temp_list
)paren
(brace
id|temp_list-&gt;login
op_assign
id|LOGIN_ATTEMPTED
suffix:semicolon
id|temp_list
op_assign
id|temp_list-&gt;next
suffix:semicolon
)brace
id|fi-&gt;num_nodes
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.perform_adisc
op_assign
id|TRUE
suffix:semicolon
singleline_comment|//fi-&gt;g.perform_adisc = FALSE;
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_FLOGI
comma
id|F_PORT
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* If Link coming up for the _first_ time or no nodes&n;&t;&t;&t; * were logged in before...&n;&t;&t;&t; */
id|fi-&gt;g.scsi_oxid
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.seq_id
op_assign
l_int|0x00
suffix:semicolon
id|fi-&gt;g.perform_adisc
op_assign
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* reset OX_ID table */
r_while
c_loop
(paren
id|fi-&gt;ox_id_list
)paren
(brace
r_struct
id|ox_id_els_map
op_star
id|temp
op_assign
id|fi-&gt;ox_id_list
suffix:semicolon
id|fi-&gt;ox_id_list
op_assign
id|fi-&gt;ox_id_list-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
)brace
id|fi-&gt;ox_id_list
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* End of if partipating */
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|ELASTIC_STORE_ERROR
)paren
(brace
multiline_comment|/* Too much junk on the Link &n;&t;&t; */
multiline_comment|/* Trying to clear it up by Txing PLOGI to urself */
r_if
c_cond
(paren
id|fi-&gt;g.link_up
op_eq
id|TRUE
)paren
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|fi-&gt;g.my_id
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|LOOP_UP
)paren
(brace
r_if
c_cond
(paren
id|tachyon_status
op_amp
id|OSM_FROZEN
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|ERROR_RELEASE
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|OCQ_RESET
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|NOS_OLS_RECEIVED
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.nport_timer_set
op_eq
id|FALSE
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;NOS/OLS Received&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;FM_status = %x&quot;
comma
id|fm_status
)paren
suffix:semicolon
id|fi-&gt;nport_timer.function
op_assign
id|nos_ols_timer
suffix:semicolon
id|fi-&gt;nport_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
id|fi-&gt;nport_timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|100
)paren
suffix:semicolon
multiline_comment|/* 30 msec */
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;nport_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;nport_timer
)paren
suffix:semicolon
id|fi-&gt;g.nport_timer_set
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OLD_PORT
)paren
op_logical_and
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_LF1
)paren
op_logical_or
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_LF2
)paren
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Link Fail-I in OLD-PORT.&quot;
)paren
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|LOOP_STATE_TIMEOUT
)paren
(brace
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|ARBITRATING
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In ARBITRATING state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|ARB_WON
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In ARBITRATION WON state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OPEN
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In OPEN state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OPENED
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In OPENED state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|TX_CLS
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In XMITTED CLOSE state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|RX_CLS
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In RECEIVED CLOSE state...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|INITIALIZING
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;ED_TOV timesout.In INITIALIZING state...&quot;
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;Initializing Loop...&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fm_status
op_amp
id|BAD_ALPA
)paren
op_logical_and
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
)paren
(brace
id|u_char
id|bad_alpa
op_assign
(paren
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_rx_al_pa_reg
)paren
op_amp
l_int|0xFF00
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|tachyon_status
op_amp
id|OSM_FROZEN
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|ERROR_RELEASE
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|OCQ_RESET
)paren
suffix:semicolon
)brace
multiline_comment|/* Fix for B34 */
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|fi-&gt;g.my_id
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi-&gt;g.port_discovery
op_logical_and
op_logical_neg
id|fi-&gt;g.perform_adisc
)paren
(brace
r_if
c_cond
(paren
id|bad_alpa
op_ne
l_int|0xFE
)paren
id|DPRINTK
c_func
(paren
l_string|&quot;Bad AL_PA = %x&quot;
comma
id|bad_alpa
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|fi-&gt;g.perform_adisc
op_eq
id|TRUE
)paren
op_logical_and
(paren
id|bad_alpa
op_eq
l_int|0x00
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Performing ADISC...&quot;
)paren
suffix:semicolon
id|fi-&gt;g.fabric_present
op_assign
id|FALSE
suffix:semicolon
id|perform_adisc
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|LIPF_RECEIVED
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;LIP(F8) Received&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|LINK_FAILURE
)paren
(brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|LOSS_OF_SIGNAL
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;Detected Loss of Signal.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fm_status
op_amp
id|OUT_OF_SYNC
)paren
id|DPRINTK1
c_func
(paren
l_string|&quot;Detected Loss of Synchronization.&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fm_status
op_amp
id|TRANSMIT_PARITY_ERROR
)paren
(brace
multiline_comment|/* Bad! Should not happen. Solution-&gt; Hard Reset.&n;&t;&t; */
id|T_MSG
c_func
(paren
l_string|&quot;Parity Error. Perform Hard Reset!&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.alpa_list_index
op_ge
id|MAX_NODES
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
(brace
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|add_display_cache_timer
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|fi-&gt;g.alpa_list_index
op_assign
id|MAX_NODES
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
id|local_port_discovery
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;handle_FM_interrupt&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|local_port_discovery
r_static
r_void
id|local_port_discovery
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
(brace
multiline_comment|/* If this is not here, some of the Bad AL_PAs are missed. &n;&t;&t; */
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.alpa_list_index
op_eq
l_int|0
)paren
op_logical_and
(paren
id|fi-&gt;g.fabric_present
op_eq
id|FALSE
)paren
)paren
(brace
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_FLOGI
comma
id|F_PORT
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|login_state
op_assign
id|sid_logged_in
c_func
(paren
id|fi
comma
id|fi-&gt;g.my_ddaa
op_or
id|alpa_list
(braket
id|fi-&gt;g.alpa_list_index
)braket
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|fi-&gt;g.alpa_list_index
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
id|fi-&gt;g.alpa_list_index
OL
id|MAX_NODES
)paren
op_logical_and
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
op_logical_or
(paren
id|alpa_list
(braket
id|fi-&gt;g.alpa_list_index
)braket
op_eq
(paren
id|fi-&gt;g.my_id
op_amp
l_int|0xFF
)paren
)paren
)paren
)paren
)paren
id|fi-&gt;g.alpa_list_index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.alpa_list_index
OL
id|MAX_NODES
)paren
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|alpa_list
(braket
id|fi-&gt;g.alpa_list_index
)braket
)paren
suffix:semicolon
)brace
id|fi-&gt;g.alpa_list_index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.alpa_list_index
op_ge
id|MAX_NODES
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
(brace
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
id|add_display_cache_timer
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|fi-&gt;g.alpa_list_index
op_assign
id|MAX_NODES
suffix:semicolon
)brace
)brace
)brace
DECL|function|nos_ols_timer
r_static
r_void
id|nos_ols_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|u_int
id|fm_status
suffix:semicolon
id|fm_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_status_reg
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;FM_status in timer= %x&quot;
comma
id|fm_status
)paren
suffix:semicolon
id|fi-&gt;g.nport_timer_set
op_assign
id|FALSE
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;nport_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
op_logical_or
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OLD_PORT
)paren
op_logical_and
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_ACTIVE
)paren
op_logical_or
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_OFFLINE
)paren
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;In OLD-PORT after E_D_TOV.&quot;
)paren
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* write R_T_TOV &amp; E_D_TOV into the registers */
id|writel
c_func
(paren
id|PTP_TOV_VALUES
comma
id|fi-&gt;t_r.ptr_fm_tov_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|BB_CREDIT
op_or
id|NPORT
comma
id|fi-&gt;t_r.ptr_fm_config_reg
)paren
suffix:semicolon
id|fi-&gt;g.n_port_try
op_assign
id|TRUE
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;In timer, TACHYON initializing as N_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|fi-&gt;g.lport_timer_set
op_eq
id|FALSE
)paren
op_logical_and
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|LOOP_FAIL
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Loop Fail after E_D_TOV.&quot;
)paren
suffix:semicolon
id|fi-&gt;lport_timer.function
op_assign
id|loop_timer
suffix:semicolon
id|fi-&gt;lport_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
id|fi-&gt;lport_timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
l_int|8
op_star
id|HZ
)paren
op_div
l_int|100
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;lport_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;lport_timer
)paren
suffix:semicolon
id|fi-&gt;g.lport_timer_set
op_assign
id|TRUE
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0xF0
)paren
op_eq
id|OLD_PORT
)paren
op_logical_and
(paren
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_LF1
)paren
op_logical_or
(paren
(paren
id|fm_status
op_amp
l_int|0x0F
)paren
op_eq
id|PORT_STATE_LF2
)paren
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Link Fail-II in OLD-PORT.&quot;
)paren
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
)brace
)brace
DECL|function|loop_timer
r_static
r_void
id|loop_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|fi-&gt;g.lport_timer_set
op_assign
id|FALSE
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;lport_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
op_logical_or
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
)paren
r_return
suffix:semicolon
)brace
DECL|function|add_display_cache_timer
r_static
r_void
id|add_display_cache_timer
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;display_cache_timer.function
op_assign
id|display_cache_timer
suffix:semicolon
id|fi-&gt;display_cache_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
id|fi-&gt;display_cache_timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|fi-&gt;num_nodes
op_star
id|HZ
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;display_cache_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;display_cache_timer
)paren
suffix:semicolon
)brace
DECL|function|display_cache_timer
r_static
r_void
id|display_cache_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;display_cache_timer
)paren
suffix:semicolon
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|reset_tachyon
r_static
r_void
id|reset_tachyon
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|value
)paren
(brace
id|u_int
id|tachyon_status
comma
id|reset_done
op_assign
id|OCQ_RESET_STATUS
op_or
id|SCSI_FREEZE_STATUS
suffix:semicolon
r_int
id|not_done
op_assign
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|fi-&gt;t_r.ptr_tach_control_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_eq
id|OCQ_RESET
)paren
id|fi-&gt;q.ocq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
multiline_comment|/* Software resets are immediately done, whereas other aren&squot;t. It &n;&t;about 30 clocks to do the reset */
r_if
c_cond
(paren
id|value
op_ne
id|SOFTWARE_RESET
)paren
(brace
r_while
c_loop
(paren
id|not_done
)paren
(brace
r_if
c_cond
(paren
id|i
op_increment
OG
l_int|100000
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Reset was unsuccessful! Tachyon Status = %x&quot;
comma
id|tachyon_status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tachyon_status
op_amp
id|reset_done
)paren
op_eq
l_int|0
)paren
id|not_done
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|write_to_tachyon_registers
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
)brace
DECL|function|take_tachyon_offline
r_static
r_void
id|take_tachyon_offline
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
id|fm_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_fm_status_reg
)paren
suffix:semicolon
multiline_comment|/* The first two conditions will never be true. The Manual and&n;&t; * the errata say this. But the current implementation is&n;&t; * decently stable.&n;&t; */
singleline_comment|//if ((fm_status &amp; 0xF0) == LOOP_FAIL) {
r_if
c_cond
(paren
id|fm_status
op_eq
id|LOOP_FAIL
)paren
(brace
singleline_comment|// workaround as in P. 89 
id|writel
c_func
(paren
id|HOST_CONTROL
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
id|writel
c_func
(paren
id|SOFTWARE_RESET
comma
id|fi-&gt;t_r.ptr_tach_control_reg
)paren
suffix:semicolon
r_else
(brace
id|writel
c_func
(paren
id|OFFLINE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EXIT_HOST_CONTROL
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
)brace
r_else
singleline_comment|//if ((fm_status &amp; LOOP_UP) == LOOP_UP) {
r_if
c_cond
(paren
id|fm_status
op_eq
id|LOOP_UP
)paren
(brace
id|writel
c_func
(paren
id|SOFTWARE_RESET
comma
id|fi-&gt;t_r.ptr_tach_control_reg
)paren
suffix:semicolon
)brace
r_else
id|writel
c_func
(paren
id|OFFLINE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
DECL|function|read_novram
r_static
r_void
id|read_novram
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|off
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;n_r.ptr_novram_hw_control_reg
op_assign
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
suffix:semicolon
id|fi-&gt;n_r.ptr_novram_hw_status_reg
op_assign
id|fi-&gt;i_r.ptr_ichip_hw_status_reg
suffix:semicolon
id|iph5526_nr_do_init
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;clone_id
op_eq
id|PCI_VENDOR_ID_INTERPHASE
)paren
id|off
op_assign
l_int|32
suffix:semicolon
id|fi-&gt;g.my_node_name_high
op_assign
(paren
id|fi-&gt;n_r.data
(braket
id|off
)braket
op_lshift
l_int|16
)paren
op_or
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|1
)braket
suffix:semicolon
id|fi-&gt;g.my_node_name_low
op_assign
(paren
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|3
)braket
suffix:semicolon
id|fi-&gt;g.my_port_name_high
op_assign
(paren
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|4
)braket
op_lshift
l_int|16
)paren
op_or
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|5
)braket
suffix:semicolon
id|fi-&gt;g.my_port_name_low
op_assign
(paren
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|6
)braket
op_lshift
l_int|16
)paren
op_or
id|fi-&gt;n_r.data
(braket
id|off
op_plus
l_int|7
)braket
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;node_name = %x %x&quot;
comma
id|fi-&gt;g.my_node_name_high
comma
id|fi-&gt;g.my_node_name_low
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;port_name = %x %x&quot;
comma
id|fi-&gt;g.my_port_name_high
comma
id|fi-&gt;g.my_port_name_low
)paren
suffix:semicolon
)brace
DECL|function|reset_ichip
r_static
r_void
id|reset_ichip
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
multiline_comment|/* (i)chip reset */
id|writel
c_func
(paren
id|ICHIP_HCR_RESET
comma
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
)paren
suffix:semicolon
multiline_comment|/*wait for chip to get reset */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*de-assert reset */
id|writel
c_func
(paren
id|ICHIP_HCR_DERESET
comma
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
)paren
suffix:semicolon
multiline_comment|/* enable INT lines on the (i)chip */
id|writel
c_func
(paren
id|ICHIP_HCR_ENABLE_INTA
comma
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
)paren
suffix:semicolon
multiline_comment|/* enable byte swap */
id|writel
c_func
(paren
id|ICHIP_HAMR_BYTE_SWAP_ADDR_TR
comma
id|fi-&gt;i_r.ptr_ichip_hw_addr_mask_reg
)paren
suffix:semicolon
)brace
DECL|function|tx_logi
r_static
r_void
id|tx_logi
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
comma
id|u_int
id|d_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_UCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_logi&quot;
)paren
suffix:semicolon
multiline_comment|/* We dont want interrupted for our own logi. &n;&t; * It screws up the port discovery process. &n;&t; */
r_if
c_cond
(paren
id|d_id
op_eq
id|fi-&gt;g.my_id
)paren
id|int_required
op_assign
l_int|0
suffix:semicolon
id|fill_login_frame
c_func
(paren
id|fi
comma
id|logi
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.login
comma
r_sizeof
(paren
id|LOGIN
)paren
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
r_sizeof
(paren
id|LOGIN
)paren
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|logi
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_logi&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|tx_logi_acc
r_static
r_void
id|tx_logi_acc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|0
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_SCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|LAST_SEQUENCE
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_logi_acc&quot;
)paren
suffix:semicolon
id|fill_login_frame
c_func
(paren
id|fi
comma
id|logi
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.login
comma
r_sizeof
(paren
id|LOGIN
)paren
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
r_sizeof
(paren
id|LOGIN
)paren
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|logi
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_logi_acc&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|tx_prli
r_static
r_void
id|tx_prli
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|command_code
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_UCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_prli&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|command_code
op_eq
id|ELS_PRLI
)paren
id|fi-&gt;g.prli.cmnd_code
op_assign
id|htons
c_func
(paren
(paren
id|ELS_PRLI
op_or
id|PAGE_LEN
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
r_else
(brace
id|fi-&gt;g.prli.cmnd_code
op_assign
id|htons
c_func
(paren
(paren
id|ELS_ACC
op_or
id|PAGE_LEN
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
id|int_required
op_assign
l_int|0
suffix:semicolon
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|LAST_SEQUENCE
suffix:semicolon
id|r_ctl
op_assign
id|RCTL_ELS_SCTL
suffix:semicolon
)brace
id|fi-&gt;g.prli.payload_length
op_assign
id|htons
c_func
(paren
id|PRLI_LEN
)paren
suffix:semicolon
id|fi-&gt;g.prli.type_code
op_assign
id|htons
c_func
(paren
id|FCP_TYPE_CODE
)paren
suffix:semicolon
id|fi-&gt;g.prli.est_image_pair
op_assign
id|htons
c_func
(paren
id|IMAGE_PAIR
)paren
suffix:semicolon
id|fi-&gt;g.prli.responder_pa
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.prli.originator_pa
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.prli.service_params
op_assign
id|htonl
c_func
(paren
id|INITIATOR_FUNC
op_or
id|READ_XFER_RDY_DISABLED
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.prli
comma
r_sizeof
(paren
id|PRLI
)paren
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
r_sizeof
(paren
id|PRLI
)paren
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|command_code
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_prli&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|tx_logo
r_static
r_void
id|tx_logo
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_UCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|SEQUENCE_RESPONDER
op_or
id|FIRST_SEQUENCE
op_or
id|END_SEQUENCE
op_or
id|SEQUENCE_INITIATIVE
suffix:semicolon
r_int
id|size
op_assign
r_sizeof
(paren
id|LOGO
)paren
suffix:semicolon
r_char
id|fc_id
(braket
l_int|3
)braket
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_logo&quot;
)paren
suffix:semicolon
id|fi-&gt;g.logo.logo_cmnd
op_assign
id|htonl
c_func
(paren
id|ELS_LOGO
)paren
suffix:semicolon
id|fi-&gt;g.logo.reserved
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|fc_id
comma
op_amp
(paren
id|fi-&gt;g.my_id
)paren
comma
l_int|3
)paren
suffix:semicolon
id|fi-&gt;g.logo.n_port_id_0
op_assign
id|fc_id
(braket
l_int|0
)braket
suffix:semicolon
id|fi-&gt;g.logo.n_port_id_1
op_assign
id|fc_id
(braket
l_int|1
)braket
suffix:semicolon
id|fi-&gt;g.logo.n_port_id_2
op_assign
id|fc_id
(braket
l_int|2
)braket
suffix:semicolon
id|fi-&gt;g.logo.port_name_up
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_HIGH
)paren
suffix:semicolon
id|fi-&gt;g.logo.port_name_low
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_LOW
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.logo
comma
r_sizeof
(paren
id|LOGO
)paren
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|ELS_LOGO
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_logo&quot;
)paren
suffix:semicolon
)brace
DECL|function|tx_adisc
r_static
r_void
id|tx_adisc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|cmnd_code
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|0
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_SCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|SEQUENCE_RESPONDER
op_or
id|FIRST_SEQUENCE
op_or
id|END_SEQUENCE
suffix:semicolon
r_int
id|size
op_assign
r_sizeof
(paren
id|ADISC
)paren
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|fi-&gt;g.adisc.ls_cmnd_code
op_assign
id|htonl
c_func
(paren
id|cmnd_code
)paren
suffix:semicolon
id|fi-&gt;g.adisc.hard_address
op_assign
id|htonl
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.adisc.port_name_high
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_HIGH
)paren
suffix:semicolon
id|fi-&gt;g.adisc.port_name_low
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_LOW
)paren
suffix:semicolon
id|fi-&gt;g.adisc.node_name_high
op_assign
id|htonl
c_func
(paren
id|NODE_NAME_HIGH
)paren
suffix:semicolon
id|fi-&gt;g.adisc.node_name_low
op_assign
id|htonl
c_func
(paren
id|NODE_NAME_LOW
)paren
suffix:semicolon
id|fi-&gt;g.adisc.n_port_id
op_assign
id|htonl
c_func
(paren
id|fi-&gt;g.my_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmnd_code
op_eq
id|ELS_ADISC
)paren
(brace
id|int_required
op_assign
l_int|1
suffix:semicolon
id|r_ctl
op_assign
id|RCTL_ELS_UCTL
suffix:semicolon
id|type
op_assign
id|TYPE_ELS
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
)brace
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.adisc
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|cmnd_code
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|tx_ls_rjt
r_static
r_void
id|tx_ls_rjt
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
comma
id|u_short
id|reason_code
comma
id|u_short
id|expln_code
)paren
(brace
r_int
id|int_required
op_assign
l_int|0
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_SCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|LAST_SEQUENCE
suffix:semicolon
r_int
id|size
op_assign
r_sizeof
(paren
id|LS_RJT
)paren
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_ls_rjt&quot;
)paren
suffix:semicolon
id|fi-&gt;g.ls_rjt.cmnd_code
op_assign
id|htonl
c_func
(paren
id|ELS_LS_RJT
)paren
suffix:semicolon
id|fi-&gt;g.ls_rjt.reason_code
op_assign
id|htonl
c_func
(paren
(paren
id|reason_code
op_lshift
l_int|16
)paren
op_or
id|expln_code
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.ls_rjt
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|ELS_LS_RJT
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_ls_rjt&quot;
)paren
suffix:semicolon
)brace
DECL|function|tx_abts
r_static
r_void
id|tx_abts
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_BASIC_ABTS
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_BLS
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
r_int
id|size
op_assign
l_int|0
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_abts&quot;
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_BLS
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
l_int|NULL
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|RCTL_BASIC_ABTS
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_abts&quot;
)paren
suffix:semicolon
)brace
DECL|function|plogi_ok
r_static
id|u_int
id|plogi_ok
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
comma
r_int
id|size
)paren
(brace
r_int
id|ret_code
op_assign
l_int|0
suffix:semicolon
id|u_short
id|mtu
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|10
)paren
)paren
op_amp
l_int|0x00000FFF
suffix:semicolon
id|u_short
id|class3
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|25
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|u_short
id|class3_conc_seq
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|27
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|u_short
id|open_seq
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|28
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;mtu = %x class3 = %x conc_seq = %x open_seq = %x&quot;
comma
id|mtu
comma
id|class3
comma
id|class3_conc_seq
comma
id|open_seq
)paren
suffix:semicolon
id|size
op_sub_assign
id|TACHYON_HEADER_LEN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|class3
op_amp
l_int|0x8000
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Received PLOGI with class3 = %x&quot;
comma
id|class3
)paren
suffix:semicolon
id|ret_code
op_assign
(paren
id|LOGICAL_ERR
op_lshift
l_int|16
)paren
op_or
id|NO_EXPLN
suffix:semicolon
r_return
id|ret_code
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mtu
OL
l_int|256
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Received PLOGI with MTU set to %x&quot;
comma
id|mtu
)paren
suffix:semicolon
id|ret_code
op_assign
(paren
id|LOGICAL_ERR
op_lshift
l_int|16
)paren
op_or
id|RECV_FIELD_SIZE
suffix:semicolon
r_return
id|ret_code
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_ne
id|PLOGI_LEN
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Received PLOGI of size %x&quot;
comma
id|size
)paren
suffix:semicolon
id|ret_code
op_assign
(paren
id|LOGICAL_ERR
op_lshift
l_int|16
)paren
op_or
id|INV_PAYLOAD_LEN
suffix:semicolon
r_return
id|ret_code
suffix:semicolon
)brace
r_if
c_cond
(paren
id|class3_conc_seq
op_eq
l_int|0
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Received PLOGI with conc_seq == 0&quot;
)paren
suffix:semicolon
id|ret_code
op_assign
(paren
id|LOGICAL_ERR
op_lshift
l_int|16
)paren
op_or
id|CONC_SEQ
suffix:semicolon
r_return
id|ret_code
suffix:semicolon
)brace
r_if
c_cond
(paren
id|open_seq
op_eq
l_int|0
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Received PLOGI with open_seq == 0&quot;
)paren
suffix:semicolon
id|ret_code
op_assign
(paren
id|LOGICAL_ERR
op_lshift
l_int|16
)paren
op_or
id|NO_EXPLN
suffix:semicolon
r_return
id|ret_code
suffix:semicolon
)brace
multiline_comment|/* Could potentially check for more fields, but might end up&n;&t;   not talking to most of the devices. ;-) */
multiline_comment|/* Things that could get checked are:&n;&t;   common_features = 0x8800&n;&t;   total_concurrent_seq = at least 1&n;&t;*/
r_return
id|ret_code
suffix:semicolon
)brace
DECL|function|tx_acc
r_static
r_void
id|tx_acc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|d_id
comma
id|u_short
id|received_ox_id
)paren
(brace
r_int
id|int_required
op_assign
l_int|0
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_SCTL
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|EXCHANGE_RESPONDER
op_or
id|LAST_SEQUENCE
suffix:semicolon
r_int
id|size
op_assign
r_sizeof
(paren
id|ACC
)paren
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_acc&quot;
)paren
suffix:semicolon
id|fi-&gt;g.acc.cmnd_code
op_assign
id|htonl
c_func
(paren
id|ELS_ACC
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.acc
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|received_ox_id
comma
id|ELS_ACC
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_acc&quot;
)paren
suffix:semicolon
)brace
DECL|function|tx_name_server_req
r_static
r_void
id|tx_name_server_req
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|req
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
comma
id|i
comma
id|size
op_assign
l_int|0
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_FC_SERVICES
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|UNSOLICITED_CONTROL
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
comma
id|d_id
op_assign
id|DIRECTORY_SERVER
suffix:semicolon
id|CT_HDR
id|ct_hdr
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_name_server_req&quot;
)paren
suffix:semicolon
multiline_comment|/* Fill up CT_Header */
id|ct_hdr.rev_in_id
op_assign
id|htonl
c_func
(paren
id|FC_CT_REV
)paren
suffix:semicolon
id|ct_hdr.fs_type
op_assign
id|DIRECTORY_SERVER_APP
suffix:semicolon
id|ct_hdr.fs_subtype
op_assign
id|NAME_SERVICE
suffix:semicolon
id|ct_hdr.options
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.resv1
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.cmnd_resp_code
op_assign
id|htons
c_func
(paren
id|req
op_rshift
l_int|16
)paren
suffix:semicolon
id|ct_hdr.max_res_size
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.resv2
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.reason_code
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.expln_code
op_assign
l_int|0
suffix:semicolon
id|ct_hdr.vendor_unique
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
r_switch
c_cond
(paren
id|req
)paren
(brace
r_case
id|FCS_RFC_4
suffix:colon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.rfc_4.ct_hdr
)paren
comma
op_amp
id|ct_hdr
comma
r_sizeof
(paren
id|CT_HDR
)paren
)paren
suffix:semicolon
id|fi-&gt;g.rfc_4.s_id
op_assign
id|htonl
c_func
(paren
id|fi-&gt;g.my_id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
id|fi-&gt;g.rfc_4.bit_map
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We support IP &amp; SCSI */
id|fi-&gt;g.rfc_4.bit_map
(braket
l_int|2
)braket
op_assign
l_int|0x01
suffix:semicolon
id|fi-&gt;g.rfc_4.bit_map
(braket
l_int|3
)braket
op_assign
l_int|0x20
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
id|RFC_4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.rfc_4
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|req
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FCS_GP_ID4
suffix:colon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.gp_id4.ct_hdr
)paren
comma
op_amp
id|ct_hdr
comma
r_sizeof
(paren
id|CT_HDR
)paren
)paren
suffix:semicolon
id|fi-&gt;g.gp_id4.port_type
op_assign
id|htonl
c_func
(paren
id|PORT_TYPE_NX_PORTS
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
id|GP_ID4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.gp_id4
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|req
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_name_server_req&quot;
)paren
suffix:semicolon
)brace
DECL|function|tx_scr
r_static
r_void
id|tx_scr
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|int_required
op_assign
l_int|1
comma
id|size
op_assign
r_sizeof
(paren
id|SCR
)paren
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_ELS
op_or
id|SEQUENCE_INITIATIVE
op_or
id|FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|RCTL_ELS_UCTL
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
comma
id|d_id
op_assign
id|FABRIC_CONTROLLER
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_scr&quot;
)paren
suffix:semicolon
id|fi-&gt;g.scr.cmnd_code
op_assign
id|htonl
c_func
(paren
id|ELS_SCR
)paren
suffix:semicolon
id|fi-&gt;g.scr.reg_function
op_assign
id|htonl
c_func
(paren
id|FULL_REGISTRATION
)paren
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_ELS
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
comma
op_amp
id|fi-&gt;g.scr
comma
id|size
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.els_buffer
(braket
id|fi-&gt;g.e_i
)braket
)paren
comma
id|size
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|ELS_SCR
)paren
suffix:semicolon
id|fi-&gt;g.e_i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.e_i
op_eq
id|MAX_PENDING_FRAMES
)paren
id|fi-&gt;g.e_i
op_assign
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_scr&quot;
)paren
suffix:semicolon
)brace
DECL|function|perform_adisc
r_static
r_void
id|perform_adisc
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Will be set to TRUE when timer expires in a PLDA environment. &n;&t; */
id|fi-&gt;g.port_discovery
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;node_info_list
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp_list
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|temp_list
)paren
(brace
multiline_comment|/* Tx ADISC to all non-fabric based &n;&t; &t; &t; * entities.&n;&t; &t; &t; */
r_if
c_cond
(paren
(paren
id|temp_list-&gt;d_id
op_amp
l_int|0xFF0000
)paren
op_ne
l_int|0xFF0000
)paren
id|tx_adisc
c_func
(paren
id|fi
comma
id|ELS_ADISC
comma
id|temp_list-&gt;d_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
id|temp_list
op_assign
id|temp_list-&gt;next
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* Perform Port Discovery after timer expires.&n;&t; * We are giving time for the ADISCed nodes to respond&n;&t; * so that we dont have to perform PLOGI to those whose&n;&t; * login are _still_ valid.&n;&t; */
id|fi-&gt;explore_timer.function
op_assign
id|port_discovery_timer
suffix:semicolon
id|fi-&gt;explore_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
id|fi-&gt;explore_timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
id|count
op_star
l_int|3
op_star
id|HZ
)paren
op_div
l_int|100
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
)brace
DECL|function|explore_fabric
r_static
r_void
id|explore_fabric
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
)paren
(brace
id|u_int
op_star
id|addr
op_assign
id|buff_addr
op_plus
l_int|12
suffix:semicolon
multiline_comment|/* index into payload */
id|u_char
id|control_code
suffix:semicolon
id|u_int
id|d_id
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;explore_fabric&quot;
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;entering explore_fabric&quot;
)paren
suffix:semicolon
multiline_comment|/*fi-&gt;g.perform_adisc = TRUE;&n;&t;fi-&gt;g.explore_fabric = TRUE;&n;&t;perform_adisc(fi);*/
r_do
(brace
id|d_id
op_assign
id|ntohl
c_func
(paren
op_star
id|addr
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
r_if
c_cond
(paren
id|d_id
op_ne
id|fi-&gt;g.my_id
)paren
(brace
r_if
c_cond
(paren
id|sid_logged_in
c_func
(paren
id|fi
comma
id|d_id
)paren
op_eq
id|NODE_NOT_PRESENT
)paren
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|d_id
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sid_logged_in
c_func
(paren
id|fi
comma
id|d_id
)paren
op_eq
id|NODE_LOGGED_OUT
)paren
id|tx_adisc
c_func
(paren
id|fi
comma
id|ELS_ADISC
comma
id|d_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
id|control_code
op_assign
(paren
id|ntohl
c_func
(paren
op_star
id|addr
)paren
op_amp
l_int|0xFF000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|addr
op_increment
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;cc = %x, d_id = %x&quot;
comma
id|control_code
comma
id|d_id
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|control_code
op_ne
l_int|0x80
)paren
suffix:semicolon
id|fi-&gt;explore_timer.function
op_assign
id|fabric_explore_timer
suffix:semicolon
id|fi-&gt;explore_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
multiline_comment|/* We give 30 msec for each device to respond and then send out&n;&t; * our SCSI enquiries. &n;&t; */
id|fi-&gt;explore_timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
id|count
op_star
l_int|3
op_star
id|HZ
)paren
op_div
l_int|100
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;leaving explore_fabric&quot;
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;explore_fabric&quot;
)paren
suffix:semicolon
)brace
DECL|function|fabric_explore_timer
r_static
r_void
id|fabric_explore_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
op_logical_and
(paren
id|fi-&gt;g.ptp_up
op_eq
id|FALSE
)paren
)paren
(brace
multiline_comment|/* Initiate Local Port Discovery on the Local Loop.&n;&t;&t; */
id|fi-&gt;g.port_discovery
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.alpa_list_index
op_assign
l_int|1
suffix:semicolon
id|local_port_discovery
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|fi-&gt;g.explore_fabric
op_assign
id|FALSE
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|port_discovery_timer
r_static
r_void
id|port_discovery_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
op_logical_and
(paren
id|fi-&gt;g.explore_fabric
op_ne
id|TRUE
)paren
)paren
(brace
id|fi-&gt;g.port_discovery
op_assign
id|TRUE
suffix:semicolon
id|fi-&gt;g.alpa_list_index
op_assign
l_int|1
suffix:semicolon
id|local_port_discovery
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|fi-&gt;g.perform_adisc
op_assign
id|FALSE
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|add_to_ox_id_list
r_static
r_void
id|add_to_ox_id_list
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|transaction_id
comma
id|u_int
id|cmnd_code
)paren
(brace
r_struct
id|ox_id_els_map
op_star
id|p
comma
op_star
id|q
op_assign
id|fi-&gt;ox_id_list
comma
op_star
id|r
op_assign
l_int|NULL
suffix:semicolon
r_int
id|size
op_assign
r_sizeof
(paren
r_struct
id|ox_id_els_map
)paren
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
id|r
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|p
op_assign
(paren
r_struct
id|ox_id_els_map
op_star
)paren
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;kmalloc failed in add_to_ox_id_list()&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p-&gt;ox_id
op_assign
id|transaction_id
suffix:semicolon
id|p-&gt;els
op_assign
id|cmnd_code
suffix:semicolon
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;ox_id_list
op_eq
l_int|NULL
)paren
id|fi-&gt;ox_id_list
op_assign
id|p
suffix:semicolon
r_else
id|r-&gt;next
op_assign
id|p
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|remove_from_ox_id_list
r_static
id|u_int
id|remove_from_ox_id_list
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|received_ox_id
)paren
(brace
r_struct
id|ox_id_els_map
op_star
id|p
op_assign
id|fi-&gt;ox_id_list
comma
op_star
id|q
op_assign
id|fi-&gt;ox_id_list
suffix:semicolon
id|u_int
id|els_type
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;ox_id
op_eq
id|received_ox_id
)paren
(brace
r_if
c_cond
(paren
id|q
op_eq
id|fi-&gt;ox_id_list
)paren
id|fi-&gt;ox_id_list
op_assign
id|fi-&gt;ox_id_list-&gt;next
suffix:semicolon
r_else
r_if
c_cond
(paren
id|q-&gt;next
op_eq
l_int|NULL
)paren
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_else
id|p-&gt;next
op_assign
id|q-&gt;next
suffix:semicolon
id|els_type
op_assign
id|q-&gt;els
suffix:semicolon
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
r_return
id|els_type
suffix:semicolon
)brace
id|p
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
id|DPRINTK2
c_func
(paren
l_string|&quot;Could not find ox_id %x in ox_id_els_map&quot;
comma
id|received_ox_id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|build_tachyon_header
r_static
r_void
id|build_tachyon_header
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|my_id
comma
id|u_int
id|r_ctl
comma
id|u_int
id|d_id
comma
id|u_int
id|type
comma
id|u_char
id|seq_id
comma
id|u_char
id|df_ctl
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
r_char
op_star
id|data
)paren
(brace
id|u_char
id|alpa
op_assign
id|d_id
op_amp
l_int|0x0000FF
suffix:semicolon
id|u_int
id|dest_ddaa
op_assign
id|d_id
op_amp
l_int|0xFFFF00
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;build_tachyon_header&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;d_id = %x, my_ddaa = %x&quot;
comma
id|d_id
comma
id|fi-&gt;g.my_ddaa
)paren
suffix:semicolon
multiline_comment|/* Does it have to go to/thru a Fabric? */
r_if
c_cond
(paren
(paren
id|dest_ddaa
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|d_id
op_eq
id|F_PORT
)paren
op_logical_or
(paren
id|fi-&gt;g.fabric_present
op_logical_and
(paren
id|dest_ddaa
op_ne
id|fi-&gt;g.my_ddaa
)paren
)paren
)paren
)paren
id|alpa
op_assign
l_int|0x00
suffix:semicolon
id|fi-&gt;g.tach_header.resv
op_assign
l_int|0x00000000
suffix:semicolon
id|fi-&gt;g.tach_header.sof_and_eof
op_assign
id|SOFI3
op_or
id|EOFN
suffix:semicolon
id|fi-&gt;g.tach_header.dest_alpa
op_assign
id|alpa
suffix:semicolon
multiline_comment|/* Set LCr properly to have enuff credit */
r_if
c_cond
(paren
id|alpa
op_eq
id|REPLICATE
)paren
id|fi-&gt;g.tach_header.lcr_and_time_stamp
op_assign
id|htons
c_func
(paren
l_int|0xC00
)paren
suffix:semicolon
multiline_comment|/* LCr=3 */
r_else
id|fi-&gt;g.tach_header.lcr_and_time_stamp
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.tach_header.r_ctl_and_d_id
op_assign
id|htonl
c_func
(paren
id|r_ctl
op_or
id|d_id
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.vc_id_and_s_id
op_assign
id|htonl
c_func
(paren
id|my_id
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.type_and_f_cntl
op_assign
id|htonl
c_func
(paren
id|type
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.seq_id
op_assign
id|seq_id
suffix:semicolon
id|fi-&gt;g.tach_header.df_cntl
op_assign
id|df_ctl
suffix:semicolon
id|fi-&gt;g.tach_header.seq_cnt
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.tach_header.ox_id
op_assign
id|htons
c_func
(paren
id|ox_id
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.rx_id
op_assign
id|htons
c_func
(paren
id|rx_id
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.ro
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
(brace
multiline_comment|/* We use the Seq_Count to keep track of IP frames in the&n;&t;&t; * OCI_interrupt handler. Initial Seq_Count of IP frames is 1.&n;&t;&t; */
r_if
c_cond
(paren
id|fi-&gt;g.type_of_frame
op_eq
id|FC_BROADCAST
)paren
id|fi-&gt;g.tach_header.seq_cnt
op_assign
id|htons
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
r_else
id|fi-&gt;g.tach_header.seq_cnt
op_assign
id|htons
c_func
(paren
l_int|0x2
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.nw_header.d_naa
op_assign
id|htons
c_func
(paren
l_int|0x1000
)paren
suffix:semicolon
id|fi-&gt;g.tach_header.nw_header.s_naa
op_assign
id|htons
c_func
(paren
l_int|0x1000
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.tach_header.nw_header.dest_high
)paren
comma
id|data
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.tach_header.nw_header.dest_low
)paren
comma
id|data
op_plus
l_int|2
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.tach_header.nw_header.source_high
)paren
comma
id|data
op_plus
l_int|6
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|fi-&gt;g.tach_header.nw_header.source_low
)paren
comma
id|data
op_plus
l_int|8
comma
l_int|4
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;build_tachyon_header&quot;
)paren
suffix:semicolon
)brace
DECL|function|build_EDB
r_static
r_void
id|build_EDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_short
id|flags
comma
id|u_short
id|len
)paren
(brace
id|fi-&gt;g.edb.buf_addr
op_assign
id|ntohl
c_func
(paren
(paren
id|u_int
)paren
id|virt_to_bus
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
id|fi-&gt;g.edb.ehf
op_assign
id|ntohs
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_mod
l_int|4
)paren
id|len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|len
op_mod
l_int|4
)paren
)paren
suffix:semicolon
id|fi-&gt;g.edb.buf_len
op_assign
id|ntohs
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
DECL|function|build_ODB
r_static
r_void
id|build_ODB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_char
id|seq_id
comma
id|u_int
id|d_id
comma
id|u_int
id|len
comma
id|u_int
id|cntl
comma
id|u_short
id|mtu
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
r_int
id|NW_header
comma
r_int
id|int_required
comma
id|u_int
id|frame_class
)paren
(brace
id|fi-&gt;g.odb.seq_d_id
op_assign
id|htonl
c_func
(paren
id|seq_id
op_lshift
l_int|24
op_or
id|d_id
)paren
suffix:semicolon
id|fi-&gt;g.odb.tot_len
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|NW_header
)paren
id|fi-&gt;g.odb.tot_len
op_add_assign
id|NW_HEADER_LEN
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.odb.tot_len
op_mod
l_int|4
)paren
id|fi-&gt;g.odb.tot_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|fi-&gt;g.odb.tot_len
op_mod
l_int|4
)paren
)paren
suffix:semicolon
id|fi-&gt;g.odb.tot_len
op_assign
id|htonl
c_func
(paren
id|fi-&gt;g.odb.tot_len
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|int_required
)paren
(brace
r_case
id|NO_COMP_AND_INT
suffix:colon
id|fi-&gt;g.odb.cntl
op_assign
id|htons
c_func
(paren
id|ODB_CLASS_3
op_or
id|ODB_EE_CREDIT
op_or
id|ODB_NO_INT
op_or
id|ODB_NO_COMP
op_or
id|cntl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INT_AND_COMP_REQ
suffix:colon
id|fi-&gt;g.odb.cntl
op_assign
id|htons
c_func
(paren
id|ODB_CLASS_3
op_or
id|ODB_EE_CREDIT
op_or
id|cntl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NO_INT_COMP_REQ
suffix:colon
id|fi-&gt;g.odb.cntl
op_assign
id|htons
c_func
(paren
id|ODB_CLASS_3
op_or
id|ODB_EE_CREDIT
op_or
id|ODB_NO_INT
op_or
id|cntl
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|fi-&gt;g.odb.rx_id
op_assign
id|htons
c_func
(paren
id|rx_id
)paren
suffix:semicolon
id|fi-&gt;g.odb.cs_enable
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.odb.cs_seed
op_assign
id|htons
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|fi-&gt;g.odb.hdr_addr
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
)paren
)paren
suffix:semicolon
id|fi-&gt;g.odb.frame_len
op_assign
id|htons
c_func
(paren
id|mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NW_header
)paren
(brace
multiline_comment|/* The pointer to the sk_buff is in here. Freed up when the&n;&t;&t; * OCI_interrupt is received.&n;&t;&t; */
id|fi-&gt;g.odb.trans_id
op_assign
id|htonl
c_func
(paren
id|frame_class
)paren
suffix:semicolon
id|fi-&gt;g.odb.hdr_len
op_assign
id|TACHYON_HEADER_LEN
op_plus
id|NW_HEADER_LEN
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* helps in tracking transmitted OX_IDs */
id|fi-&gt;g.odb.trans_id
op_assign
id|htonl
c_func
(paren
(paren
id|frame_class
op_amp
l_int|0xFFFF0000
)paren
op_or
id|ox_id
)paren
suffix:semicolon
id|fi-&gt;g.odb.hdr_len
op_assign
id|TACHYON_HEADER_LEN
suffix:semicolon
)brace
id|fi-&gt;g.odb.hdr_len
op_assign
id|htons
c_func
(paren
id|fi-&gt;g.odb.hdr_len
)paren
suffix:semicolon
id|fi-&gt;g.odb.edb_addr
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|fill_login_frame
r_static
r_void
id|fill_login_frame
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|logi
)paren
(brace
r_int
id|i
suffix:semicolon
id|fi-&gt;g.login.ls_cmnd_code
op_assign
id|htonl
c_func
(paren
id|logi
)paren
suffix:semicolon
id|fi-&gt;g.login.fc_ph_version
op_assign
id|htons
c_func
(paren
id|PH_VERSION
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
)paren
id|fi-&gt;g.login.buff_to_buff_credit
op_assign
id|htons
c_func
(paren
id|LOOP_BB_CREDIT
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
)paren
id|fi-&gt;g.login.buff_to_buff_credit
op_assign
id|htons
c_func
(paren
id|PT2PT_BB_CREDIT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|logi
op_ne
id|ELS_FLOGI
)paren
op_logical_or
(paren
id|logi
op_eq
id|ELS_ACC
)paren
)paren
id|fi-&gt;g.login.common_features
op_assign
id|htons
c_func
(paren
id|PLOGI_C_F
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|logi
op_eq
id|ELS_FLOGI
)paren
id|fi-&gt;g.login.common_features
op_assign
id|htons
c_func
(paren
id|FLOGI_C_F
)paren
suffix:semicolon
id|fi-&gt;g.login.recv_data_field_size
op_assign
id|htons
c_func
(paren
id|FRAME_SIZE
)paren
suffix:semicolon
id|fi-&gt;g.login.n_port_total_conc_seq
op_assign
id|htons
c_func
(paren
id|CONCURRENT_SEQUENCES
)paren
suffix:semicolon
id|fi-&gt;g.login.rel_off_by_info_cat
op_assign
id|htons
c_func
(paren
id|RO_INFO_CATEGORY
)paren
suffix:semicolon
id|fi-&gt;g.login.ED_TOV
op_assign
id|htonl
c_func
(paren
id|E_D_TOV
)paren
suffix:semicolon
id|fi-&gt;g.login.n_port_name_high
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_HIGH
)paren
suffix:semicolon
id|fi-&gt;g.login.n_port_name_low
op_assign
id|htonl
c_func
(paren
id|N_PORT_NAME_LOW
)paren
suffix:semicolon
id|fi-&gt;g.login.node_name_high
op_assign
id|htonl
c_func
(paren
id|NODE_NAME_HIGH
)paren
suffix:semicolon
id|fi-&gt;g.login.node_name_low
op_assign
id|htonl
c_func
(paren
id|NODE_NAME_LOW
)paren
suffix:semicolon
multiline_comment|/* Fill Class 1 parameters */
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|service_options
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|initiator_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|recipient_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|recv_data_field_size
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|concurrent_sequences
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|n_port_end_to_end_credit
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|open_seq_per_exchange
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|0
)braket
dot
id|resv
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Fill Class 2 parameters */
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|service_options
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|initiator_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|recipient_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|recv_data_field_size
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|concurrent_sequences
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|n_port_end_to_end_credit
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|open_seq_per_exchange
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|1
)braket
dot
id|resv
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Fill Class 3 parameters */
r_if
c_cond
(paren
id|logi
op_eq
id|ELS_FLOGI
)paren
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|service_options
op_assign
id|htons
c_func
(paren
id|SERVICE_VALID
op_or
id|SEQUENCE_DELIVERY
)paren
suffix:semicolon
r_else
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|service_options
op_assign
id|htons
c_func
(paren
id|SERVICE_VALID
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|initiator_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|recipient_ctl
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|recv_data_field_size
op_assign
id|htons
c_func
(paren
id|FRAME_SIZE
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|concurrent_sequences
op_assign
id|htons
c_func
(paren
id|CLASS3_CONCURRENT_SEQUENCE
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|n_port_end_to_end_credit
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|open_seq_per_exchange
op_assign
id|htons
c_func
(paren
id|CLASS3_OPEN_SEQUENCE
)paren
suffix:semicolon
id|fi-&gt;g.login.c_of_s
(braket
l_int|2
)braket
dot
id|resv
op_assign
id|htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fi-&gt;g.login.resv
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.login.vendor_version_level
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* clear the Interrupt Latch on the (i)chip, so that you can receive &n; * Interrupts from Tachyon in future &n; */
DECL|function|reset_latch
r_static
r_void
id|reset_latch
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|fi-&gt;i_r.ptr_ichip_hw_status_reg
)paren
op_or
id|ICHIP_HSR_INT_LATCH
comma
id|fi-&gt;i_r.ptr_ichip_hw_status_reg
)paren
suffix:semicolon
)brace
DECL|function|update_OCQ_indx
r_static
r_void
id|update_OCQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.ocq_prod_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ocq_prod_indx
op_eq
id|OCQ_LENGTH
)paren
id|fi-&gt;q.ocq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.ocq_prod_indx
comma
id|fi-&gt;t_r.ptr_ocq_prod_indx_reg
)paren
suffix:semicolon
)brace
DECL|function|update_IMQ_indx
r_static
r_void
id|update_IMQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_int
id|count
)paren
(brace
id|fi-&gt;q.imq_cons_indx
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.imq_cons_indx
op_ge
id|IMQ_LENGTH
)paren
id|fi-&gt;q.imq_cons_indx
op_sub_assign
id|IMQ_LENGTH
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.imq_cons_indx
comma
id|fi-&gt;t_r.ptr_imq_cons_indx_reg
)paren
suffix:semicolon
)brace
DECL|function|update_SFSBQ_indx
r_static
r_void
id|update_SFSBQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.sfsbq_prod_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.sfsbq_prod_indx
op_eq
id|SFSBQ_LENGTH
)paren
id|fi-&gt;q.sfsbq_prod_indx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.sfsbq_prod_indx
comma
id|fi-&gt;t_r.ptr_sfsbq_prod_reg
)paren
suffix:semicolon
)brace
DECL|function|update_MFSBQ_indx
r_static
r_void
id|update_MFSBQ_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_int
id|count
)paren
(brace
id|fi-&gt;q.mfsbq_prod_indx
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.mfsbq_prod_indx
op_ge
id|MFSBQ_LENGTH
)paren
id|fi-&gt;q.mfsbq_prod_indx
op_sub_assign
id|MFSBQ_LENGTH
suffix:semicolon
id|writel
c_func
(paren
id|fi-&gt;q.mfsbq_prod_indx
comma
id|fi-&gt;t_r.ptr_mfsbq_prod_reg
)paren
suffix:semicolon
)brace
DECL|function|update_tachyon_header_indx
r_static
r_void
id|update_tachyon_header_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.tachyon_header_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.tachyon_header_indx
op_eq
id|NO_OF_TACH_HEADERS
)paren
id|fi-&gt;q.tachyon_header_indx
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|update_EDB_indx
r_static
r_void
id|update_EDB_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.edb_buffer_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.edb_buffer_indx
op_eq
id|EDB_LEN
)paren
id|fi-&gt;q.edb_buffer_indx
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_open
r_static
r_int
id|iph5526_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_close
r_static
r_int
id|iph5526_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_timeout
r_static
r_void
id|iph5526_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: timed out on send.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_dropped
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|iph5526_send_packet
r_static
r_int
id|iph5526_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_int
id|type
op_assign
l_int|0
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
r_struct
id|fcllc
op_star
id|fcllc
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;iph5526_send_packet&quot;
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Strip off the pseudo header.&n;&t; */
id|skb-&gt;data
op_assign
id|skb-&gt;data
op_plus
l_int|2
op_star
id|FC_ALEN
suffix:semicolon
id|skb-&gt;len
op_assign
id|skb-&gt;len
op_minus
l_int|2
op_star
id|FC_ALEN
suffix:semicolon
id|fcllc
op_assign
(paren
r_struct
id|fcllc
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|type
op_assign
id|ntohs
c_func
(paren
id|fcllc-&gt;ethertype
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
id|status
op_assign
id|tx_ip_packet
c_func
(paren
id|skb
comma
id|skb-&gt;len
comma
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_ARP
suffix:colon
id|status
op_assign
id|tx_arp_packet
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|T_MSG
c_func
(paren
l_string|&quot;WARNING!!! Received Unknown Packet Type... Discarding...&quot;
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_dropped
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|fi-&gt;fc_stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|fi-&gt;fc_stats.tx_packets
op_increment
suffix:semicolon
)brace
r_else
id|fi-&gt;fc_stats.rx_dropped
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* We free up the IP buffers in the OCI_interrupt handler.&n;&t; * status == 0 implies that the frame was not transmitted. So the&n;&t; * skb is freed here.&n;&t; */
r_if
c_cond
(paren
(paren
id|type
op_eq
id|ETH_P_ARP
)paren
op_logical_or
(paren
id|status
op_eq
l_int|0
)paren
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_else
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;iph5526_send_packet&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_change_mtu
r_static
r_int
id|iph5526_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tx_ip_packet
r_static
r_int
id|tx_ip_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|len
comma
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
id|d_id
suffix:semicolon
r_int
id|int_required
op_assign
l_int|1
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|UNSOLICITED_DATA
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_LLC_SNAP
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|mtu
suffix:semicolon
r_struct
id|fc_node_info
op_star
id|q
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_ip_packet&quot;
)paren
suffix:semicolon
id|q
op_assign
id|look_up_cache
c_func
(paren
id|fi
comma
id|skb-&gt;data
op_minus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
id|d_id
op_assign
id|q-&gt;d_id
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Look-Up Cache Succeeded for d_id = %x&quot;
comma
id|d_id
)paren
suffix:semicolon
id|mtu
op_assign
id|q-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
(brace
id|fi-&gt;g.type_of_frame
op_assign
id|FC_IP
suffix:semicolon
r_return
id|tx_exchange
c_func
(paren
id|fi
comma
id|skb-&gt;data
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|mtu
comma
id|int_required
comma
id|ox_id
comma
id|virt_to_bus
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;d_id
op_eq
id|BROADCAST
)paren
(brace
r_struct
id|fc_node_info
op_star
id|p
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_int
id|return_value
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_BROADCAST
suffix:semicolon
multiline_comment|/* Do unicast to local nodes.&n;&t;&t;&t; */
id|int_required
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|p
op_ne
l_int|NULL
)paren
(brace
id|d_id
op_assign
id|p-&gt;d_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|d_id
op_amp
l_int|0xFFFF00
)paren
op_eq
id|fi-&gt;g.my_ddaa
)paren
id|return_value
op_or_assign
id|tx_exchange
c_func
(paren
id|fi
comma
id|skb-&gt;data
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|fi-&gt;g.my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|q
)paren
suffix:semicolon
r_return
id|return_value
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;login
op_ne
id|LOGIN_COMPLETED
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Node not logged in... Txing PLOGI to %x&quot;
comma
id|d_id
)paren
suffix:semicolon
multiline_comment|/* FIXME: we are dumping the frame here */
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|d_id
)paren
suffix:semicolon
)brace
)brace
id|DPRINTK2
c_func
(paren
l_string|&quot;Look-Up Cache Failed&quot;
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_ip_packet&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tx_arp_packet
r_static
r_int
id|tx_arp_packet
c_func
(paren
r_char
op_star
id|data
comma
r_int
r_int
id|len
comma
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_int
id|opcode
op_assign
id|data
(braket
id|ARP_OPCODE_0
)braket
suffix:semicolon
id|u_int
id|d_id
suffix:semicolon
r_int
id|int_required
op_assign
l_int|0
comma
id|return_value
op_assign
id|FALSE
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|UNSOLICITED_DATA
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_LLC_SNAP
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|my_mtu
op_assign
id|fi-&gt;g.my_mtu
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_arp_packet&quot;
)paren
suffix:semicolon
id|opcode
op_assign
id|opcode
op_lshift
l_int|8
op_or
id|data
(braket
id|ARP_OPCODE_1
)braket
suffix:semicolon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_IP
suffix:semicolon
r_if
c_cond
(paren
id|opcode
op_eq
id|ARPOP_REQUEST
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
id|d_id
op_assign
id|BROADCAST
suffix:semicolon
id|return_value
op_or_assign
id|tx_exchange
c_func
(paren
id|fi
comma
id|data
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
multiline_comment|/* Some devices support HW_TYPE 0x01 */
id|memcpy
c_func
(paren
id|fi-&gt;g.arp_buffer
comma
id|data
op_minus
l_int|2
op_star
id|FC_ALEN
comma
id|len
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
id|fi-&gt;g.arp_buffer
(braket
l_int|9
op_plus
l_int|2
op_star
id|FC_ALEN
)braket
op_assign
l_int|0x01
suffix:semicolon
id|return_value
op_or_assign
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.arp_buffer
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
multiline_comment|/* Do unicast to local nodes.&n;&t;&t; */
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
id|fi-&gt;g.type_of_frame
op_assign
id|FC_BROADCAST
suffix:semicolon
id|d_id
op_assign
id|q-&gt;d_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|d_id
op_amp
l_int|0xFFFF00
)paren
op_eq
id|fi-&gt;g.my_ddaa
)paren
(brace
id|return_value
op_or_assign
id|tx_exchange
c_func
(paren
id|fi
comma
id|data
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
singleline_comment|// Some devices support HW_TYPE 0x01
id|memcpy
c_func
(paren
id|fi-&gt;g.arp_buffer
comma
id|data
op_minus
l_int|2
op_star
id|FC_ALEN
comma
id|len
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
id|fi-&gt;g.arp_buffer
(braket
l_int|9
op_plus
l_int|2
op_star
id|FC_ALEN
)braket
op_assign
l_int|0x01
suffix:semicolon
id|return_value
op_or_assign
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.arp_buffer
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
)brace
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_return
id|return_value
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opcode
op_eq
id|ARPOP_REPLY
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
suffix:semicolon
id|u_int
id|mtu
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;We are sending out an ARP reply&quot;
)paren
suffix:semicolon
id|q
op_assign
id|look_up_cache
c_func
(paren
id|fi
comma
id|data
op_minus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
id|d_id
op_assign
id|q-&gt;d_id
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Look-Up Cache Succeeded for d_id = %x&quot;
comma
id|d_id
)paren
suffix:semicolon
id|mtu
op_assign
id|q-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
(brace
id|tx_exchange
c_func
(paren
id|fi
comma
id|data
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
multiline_comment|/* Some devices support HW_TYPE 0x01 */
id|memcpy
c_func
(paren
id|fi-&gt;g.arp_buffer
comma
id|data
op_minus
l_int|2
op_star
id|FC_ALEN
comma
id|len
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
id|fi-&gt;g.arp_buffer
(braket
l_int|9
op_plus
l_int|2
op_star
id|FC_ALEN
)braket
op_assign
l_int|0x01
suffix:semicolon
r_return
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;g.arp_buffer
op_plus
l_int|2
op_star
id|FC_ALEN
)paren
comma
id|len
comma
id|r_ctl
comma
id|type
comma
id|d_id
comma
id|my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|TYPE_LLC_SNAP
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Node not logged in... Txing PLOGI to %x&quot;
comma
id|d_id
)paren
suffix:semicolon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|d_id
)paren
suffix:semicolon
multiline_comment|/* FIXME: we are dumping the frame here */
)brace
)brace
id|DPRINTK2
c_func
(paren
l_string|&quot;Look-Up Cache Failed&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Warning!!! Invalid Opcode in ARP Packet!&quot;
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;tx_arp_packet&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rx_net_packet
r_static
r_void
id|rx_net_packet
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_char
op_star
id|buff_addr
comma
r_int
id|payload_size
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|fi-&gt;dev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u_int
id|skb_size
op_assign
l_int|0
suffix:semicolon
r_struct
id|fch_hdr
id|fch
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;rx_net_packet&quot;
)paren
suffix:semicolon
id|skb_size
op_assign
id|payload_size
op_minus
id|TACHYON_HEADER_LEN
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;skb_size = %d&quot;
comma
id|skb_size
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_bytes
op_add_assign
id|skb_size
op_minus
l_int|2
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|skb_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: In rx_net_packet() Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Skip over the Tachyon Frame Header.&n;&t; */
id|buff_addr
op_add_assign
id|TACHYON_HEADER_LEN
suffix:semicolon
id|memcpy
c_func
(paren
id|fch.daddr
comma
id|buff_addr
op_plus
l_int|2
comma
id|FC_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fch.saddr
comma
id|buff_addr
op_plus
l_int|10
comma
id|FC_ALEN
)paren
suffix:semicolon
id|buff_addr
op_add_assign
l_int|2
suffix:semicolon
id|memcpy
c_func
(paren
id|buff_addr
comma
id|fch.daddr
comma
id|FC_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buff_addr
op_plus
l_int|6
comma
id|fch.saddr
comma
id|FC_ALEN
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|skb_size
op_minus
l_int|2
)paren
comma
id|buff_addr
comma
id|skb_size
op_minus
l_int|2
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|fc_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;protocol = %x&quot;
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
multiline_comment|/* Hmmm... to accept HW Type 0x01 as well... &n;&t; */
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ntohs
c_func
(paren
id|ETH_P_ARP
)paren
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_assign
l_int|0x06
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|fi-&gt;fc_stats.rx_packets
op_increment
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;rx_net_packet&quot;
)paren
suffix:semicolon
)brace
DECL|function|rx_net_mfs_packet
r_static
r_void
id|rx_net_mfs_packet
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|fi-&gt;dev
suffix:semicolon
r_struct
id|fch_hdr
id|fch
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;rx_net_mfs_packet&quot;
)paren
suffix:semicolon
multiline_comment|/* Construct your Hard Header */
id|memcpy
c_func
(paren
id|fch.daddr
comma
id|skb-&gt;data
op_plus
l_int|2
comma
id|FC_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fch.saddr
comma
id|skb-&gt;data
op_plus
l_int|10
comma
id|FC_ALEN
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|fch.daddr
comma
id|FC_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
op_plus
l_int|6
comma
id|fch.saddr
comma
id|FC_ALEN
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|fc_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;protocol = %x&quot;
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;rx_net_mfs_packet&quot;
)paren
suffix:semicolon
)brace
DECL|function|fc_type_trans
r_int
r_int
id|fc_type_trans
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fch_hdr
op_star
id|fch
op_assign
(paren
r_struct
id|fch_hdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|fcllc
op_star
id|fcllc
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|fcllc
op_assign
(paren
r_struct
id|fcllc
op_star
)paren
(paren
id|skb-&gt;data
op_plus
r_sizeof
(paren
r_struct
id|fch_hdr
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|fch_hdr
)paren
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|fch-&gt;daddr
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|fch-&gt;daddr
comma
id|dev-&gt;broadcast
comma
id|FC_ALEN
)paren
)paren
(brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_BROADCAST
suffix:semicolon
)brace
r_else
id|skb-&gt;pkt_type
op_assign
id|PACKET_MULTICAST
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|fch-&gt;daddr
comma
id|dev-&gt;dev_addr
comma
id|FC_ALEN
)paren
)paren
(brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_OTHERHOST
suffix:semicolon
)brace
)brace
multiline_comment|/* Strip the SNAP header from ARP packets since we don&squot;t &n;&t; * pass them through to the 802.2/SNAP layers.&n;&t; */
r_if
c_cond
(paren
id|fcllc-&gt;dsap
op_eq
id|EXTENDED_SAP
op_logical_and
(paren
id|fcllc-&gt;ethertype
op_eq
id|ntohs
c_func
(paren
id|ETH_P_IP
)paren
op_logical_or
id|fcllc-&gt;ethertype
op_eq
id|ntohs
c_func
(paren
id|ETH_P_ARP
)paren
)paren
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|fcllc
)paren
)paren
suffix:semicolon
r_return
id|fcllc-&gt;ethertype
suffix:semicolon
)brace
r_return
id|ntohs
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
DECL|function|tx_exchange
r_static
r_int
id|tx_exchange
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_int
id|len
comma
id|u_int
id|r_ctl
comma
id|u_int
id|type
comma
id|u_int
id|d_id
comma
id|u_int
id|mtu
comma
r_int
id|int_required
comma
id|u_short
id|tx_ox_id
comma
id|u_int
id|frame_class
)paren
(brace
id|u_char
id|df_ctl
suffix:semicolon
r_int
id|NW_flag
op_assign
l_int|0
comma
id|h_size
comma
id|return_value
suffix:semicolon
id|u_short
id|rx_id
op_assign
id|RX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|tachyon_status
suffix:semicolon
id|u_int
id|my_id
op_assign
id|fi-&gt;g.my_id
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_exchange&quot;
)paren
suffix:semicolon
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Tachyon Status = %x len = %d MTU = %d&quot;
comma
id|tachyon_status
comma
id|len
comma
id|mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tachyon_status
op_amp
id|OSM_FROZEN
)paren
(brace
id|reset_tachyon
c_func
(paren
id|fi
comma
id|ERROR_RELEASE
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|OCQ_RESET
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Tachyon Status = %x len = %d MTU = %d&quot;
comma
id|tachyon_status
comma
id|len
comma
id|mtu
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_ox_id
op_eq
id|OX_ID_FIRST_SEQUENCE
)paren
(brace
r_switch
c_cond
(paren
id|fi-&gt;g.type_of_frame
)paren
(brace
r_case
id|FC_SCSI_READ
suffix:colon
id|tx_ox_id
op_assign
id|fi-&gt;g.scsi_oxid
op_or
id|SCSI_READ_BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_SCSI_WRITE
suffix:colon
id|tx_ox_id
op_assign
id|fi-&gt;g.scsi_oxid
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|tx_ox_id
op_assign
id|fi-&gt;g.ox_id
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|fi-&gt;g.type_of_frame
)paren
(brace
r_case
id|FC_SCSI_READ
suffix:colon
id|rx_id
op_assign
id|fi-&gt;g.scsi_oxid
op_or
id|SCSI_READ_BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_SCSI_WRITE
suffix:colon
id|rx_id
op_assign
id|fi-&gt;g.scsi_oxid
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_BLS
suffix:colon
id|rx_id
op_assign
id|RX_ID_FIRST_SEQUENCE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rx_id
op_assign
id|fi-&gt;g.ox_id
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|type
op_eq
id|TYPE_LLC_SNAP
)paren
(brace
id|df_ctl
op_assign
l_int|0x20
suffix:semicolon
id|NW_flag
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Multi Frame Sequence ? If yes, set RO bit */
r_if
c_cond
(paren
id|len
OG
id|mtu
)paren
id|type
op_or_assign
id|RELATIVE_OFF_PRESENT
suffix:semicolon
id|build_tachyon_header
c_func
(paren
id|fi
comma
id|my_id
comma
id|r_ctl
comma
id|d_id
comma
id|type
comma
id|fi-&gt;g.seq_id
comma
id|df_ctl
comma
id|tx_ox_id
comma
id|rx_id
comma
id|data
op_minus
l_int|2
op_star
id|FC_ALEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|df_ctl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Multi Frame Sequence ? If yes, set RO bit */
r_if
c_cond
(paren
id|len
OG
id|mtu
)paren
id|type
op_or_assign
id|RELATIVE_OFF_PRESENT
suffix:semicolon
id|build_tachyon_header
c_func
(paren
id|fi
comma
id|my_id
comma
id|r_ctl
comma
id|d_id
comma
id|type
comma
id|fi-&gt;g.seq_id
comma
id|df_ctl
comma
id|tx_ox_id
comma
id|rx_id
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Get free Tachyon Headers and EDBs */
r_if
c_cond
(paren
id|get_free_header
c_func
(paren
id|fi
)paren
op_logical_or
id|get_free_EDB
c_func
(paren
id|fi
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_amp
l_int|0xFF000000
)paren
op_eq
id|TYPE_LLC_SNAP
)paren
(brace
id|h_size
op_assign
id|TACHYON_HEADER_LEN
op_plus
id|NW_HEADER_LEN
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.tach_header
)paren
comma
id|h_size
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.tach_header
)paren
comma
id|TACHYON_HEADER_LEN
)paren
suffix:semicolon
id|return_value
op_assign
id|tx_sequence
c_func
(paren
id|fi
comma
id|data
comma
id|len
comma
id|mtu
comma
id|d_id
comma
id|tx_ox_id
comma
id|rx_id
comma
id|fi-&gt;g.seq_id
comma
id|NW_flag
comma
id|int_required
comma
id|frame_class
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fi-&gt;g.type_of_frame
)paren
(brace
r_case
id|FC_SCSI_READ
suffix:colon
r_case
id|FC_SCSI_WRITE
suffix:colon
id|update_scsi_oxid
c_func
(paren
id|fi
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_BLS
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|fi-&gt;g.ox_id
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.ox_id
op_eq
l_int|0xFFFF
)paren
id|fi-&gt;g.ox_id
op_assign
id|NOT_SCSI_XID
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.seq_id
op_eq
id|MAX_SEQ_ID
)paren
id|fi-&gt;g.seq_id
op_assign
l_int|0
suffix:semicolon
r_else
id|fi-&gt;g.seq_id
op_increment
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_exchange&quot;
)paren
suffix:semicolon
r_return
id|return_value
suffix:semicolon
)brace
DECL|function|tx_sequence
r_static
r_int
id|tx_sequence
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
comma
id|u_int
id|len
comma
id|u_int
id|mtu
comma
id|u_int
id|d_id
comma
id|u_short
id|ox_id
comma
id|u_short
id|rx_id
comma
id|u_char
id|seq_id
comma
r_int
id|NW_flag
comma
r_int
id|int_required
comma
id|u_int
id|frame_class
)paren
(brace
id|u_int
id|cntl
op_assign
l_int|0
suffix:semicolon
r_int
id|return_value
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;tx_sequence&quot;
)paren
suffix:semicolon
id|build_EDB
c_func
(paren
id|fi
comma
id|data
comma
id|EDB_END
comma
id|len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.edb
)paren
comma
r_sizeof
(paren
id|EDB
)paren
)paren
suffix:semicolon
id|build_ODB
c_func
(paren
id|fi
comma
id|seq_id
comma
id|d_id
comma
id|len
comma
id|cntl
comma
id|mtu
comma
id|ox_id
comma
id|rx_id
comma
id|NW_flag
comma
id|int_required
comma
id|frame_class
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_odb
(braket
id|fi-&gt;q.ocq_prod_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.odb
)paren
comma
r_sizeof
(paren
id|ODB
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.link_up
op_ne
id|TRUE
)paren
(brace
id|DPRINTK2
c_func
(paren
l_string|&quot;Fibre Channel Link not up. Dropping Exchange!&quot;
)paren
suffix:semicolon
id|return_value
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* To be on the safe side, a check should be included&n;&t;&t; * at this point to check if we are overrunning &n;&t;&t; * Tachyon.&n;&t;&t; */
id|update_OCQ_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|return_value
op_assign
id|TRUE
suffix:semicolon
)brace
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|update_tachyon_header_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;tx_sequence&quot;
)paren
suffix:semicolon
r_return
id|return_value
suffix:semicolon
)brace
DECL|function|get_free_header
r_static
r_int
id|get_free_header
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_short
id|temp_ox_id
suffix:semicolon
id|u_int
op_star
id|tach_header
comma
id|initial_indx
op_assign
id|fi-&gt;q.tachyon_header_indx
suffix:semicolon
multiline_comment|/* Check if the header is in use.&n;&t; * We could have an outstanding command.&n;&t; * We should find a free slot as we can queue a&n;&t; * maximum of 32 SCSI commands only. &n;&t; */
id|tach_header
op_assign
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
suffix:semicolon
id|temp_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|tach_header
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* We care about the SCSI writes only. Those are the wicked ones&n;&t; * that need an additional set of buffers.&n;&t; */
r_while
c_loop
(paren
id|temp_ox_id
op_le
id|MAX_SCSI_XID
)paren
(brace
id|update_tachyon_header_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.tachyon_header_indx
op_eq
id|initial_indx
)paren
(brace
multiline_comment|/* Should never happen.&n;&t;&t;&t; */
id|T_MSG
c_func
(paren
l_string|&quot;No free Tachyon headers available&quot;
)paren
suffix:semicolon
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|tach_header
op_assign
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
suffix:semicolon
id|temp_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|tach_header
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_free_EDB
r_static
r_int
id|get_free_EDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
r_int
id|initial_indx
op_assign
id|fi-&gt;q.edb_buffer_indx
suffix:semicolon
multiline_comment|/* Check if the EDB is in use.&n;&t; * We could have an outstanding SCSI Write command.&n;&t; * We should find a free slot as we can queue a&n;&t; * maximum of 32 SCSI commands only. &n;&t; */
r_while
c_loop
(paren
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
op_ne
id|EDB_FREE
)paren
(brace
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.edb_buffer_indx
op_eq
id|initial_indx
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;No free EDB buffers avaliable&quot;
)paren
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|validate_login
r_static
r_int
id|validate_login
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|base_ptr
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_char
id|n_port_name
(braket
id|PORT_NAME_LEN
)braket
suffix:semicolon
r_char
id|node_name
(braket
id|NODE_NAME_LEN
)braket
suffix:semicolon
id|u_int
id|s_id
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;validate_login&quot;
)paren
suffix:semicolon
multiline_comment|/*index to Port Name in the payload. We need the 8 byte Port Name */
id|memcpy
c_func
(paren
id|n_port_name
comma
id|base_ptr
op_plus
l_int|10
comma
id|PORT_NAME_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|node_name
comma
id|base_ptr
op_plus
l_int|12
comma
id|NODE_NAME_LEN
)paren
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
multiline_comment|/* check if Fibre Channel IDs have changed */
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|n_port_name
comma
id|q-&gt;hw_addr
comma
id|PORT_NAME_LEN
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|s_id
op_ne
id|q-&gt;d_id
)paren
op_logical_or
(paren
id|memcmp
c_func
(paren
id|node_name
comma
id|q-&gt;node_name
comma
id|NODE_NAME_LEN
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Fibre Channel ID of Node has changed. Txing LOGO.&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|q-&gt;login
op_assign
id|LOGIN_COMPLETED
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Port Name does not match. Txing LOGO.&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;validate_login&quot;
)paren
suffix:semicolon
)brace
DECL|function|add_to_address_cache
r_static
r_void
id|add_to_address_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|base_ptr
)paren
(brace
r_int
id|size
op_assign
r_sizeof
(paren
r_struct
id|fc_node_info
)paren
suffix:semicolon
r_struct
id|fc_node_info
op_star
id|p
comma
op_star
id|q
op_assign
id|fi-&gt;node_info_list
comma
op_star
id|r
op_assign
l_int|NULL
suffix:semicolon
r_char
id|n_port_name
(braket
id|PORT_NAME_LEN
)braket
suffix:semicolon
id|u_int
id|s_id
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;add_to_address_cache&quot;
)paren
suffix:semicolon
multiline_comment|/*index to Port Name in the payload. We need the 8 byte Port Name */
id|memcpy
c_func
(paren
id|n_port_name
comma
id|base_ptr
op_plus
l_int|13
comma
id|PORT_NAME_LEN
)paren
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
multiline_comment|/* check if info already exists */
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|n_port_name
comma
id|q-&gt;hw_addr
comma
id|PORT_NAME_LEN
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s_id
op_ne
id|q-&gt;d_id
)paren
(brace
id|memcpy
c_func
(paren
op_amp
(paren
id|q-&gt;c_of_s
(braket
l_int|0
)braket
)paren
comma
id|base_ptr
op_plus
l_int|17
comma
l_int|3
op_star
r_sizeof
(paren
id|CLASS_OF_SERVICE
)paren
)paren
suffix:semicolon
id|q-&gt;mtu
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|10
)paren
)paren
op_amp
l_int|0x00000FFF
suffix:semicolon
id|q-&gt;d_id
op_assign
id|s_id
suffix:semicolon
id|memcpy
c_func
(paren
id|q-&gt;node_name
comma
id|base_ptr
op_plus
l_int|15
comma
id|NODE_NAME_LEN
)paren
suffix:semicolon
)brace
id|q-&gt;login
op_assign
id|LOGIN_COMPLETED
suffix:semicolon
id|q-&gt;scsi
op_assign
id|FALSE
suffix:semicolon
id|fi-&gt;num_nodes
op_increment
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|r
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|p
op_assign
(paren
r_struct
id|fc_node_info
op_star
)paren
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;kmalloc failed in add_to_address_cache()&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
(paren
id|p-&gt;c_of_s
(braket
l_int|0
)braket
)paren
comma
id|base_ptr
op_plus
l_int|17
comma
l_int|3
op_star
r_sizeof
(paren
id|CLASS_OF_SERVICE
)paren
)paren
suffix:semicolon
id|p-&gt;mtu
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|10
)paren
)paren
op_amp
l_int|0x00000FFF
suffix:semicolon
id|p-&gt;d_id
op_assign
id|s_id
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;hw_addr
comma
id|base_ptr
op_plus
l_int|13
comma
id|PORT_NAME_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;node_name
comma
id|base_ptr
op_plus
l_int|15
comma
id|NODE_NAME_LEN
)paren
suffix:semicolon
id|p-&gt;login
op_assign
id|LOGIN_COMPLETED
suffix:semicolon
id|p-&gt;scsi
op_assign
id|FALSE
suffix:semicolon
id|p-&gt;target_id
op_assign
l_int|0xFF
suffix:semicolon
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;node_info_list
op_eq
l_int|NULL
)paren
id|fi-&gt;node_info_list
op_assign
id|p
suffix:semicolon
r_else
id|r-&gt;next
op_assign
id|p
suffix:semicolon
id|fi-&gt;num_nodes
op_increment
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
id|LEAVE
c_func
(paren
l_string|&quot;add_to_address_cache&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|remove_from_address_cache
r_static
r_void
id|remove_from_address_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|base_ptr
comma
id|u_int
id|cmnd_code
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
id|u_int
id|s_id
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;remove_from_address_cache&quot;
)paren
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
r_switch
c_cond
(paren
id|cmnd_code
)paren
(brace
r_case
id|ELS_LOGO
suffix:colon
multiline_comment|/* check if info exists */
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|s_id
op_eq
id|q-&gt;d_id
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
id|q-&gt;login
op_assign
id|LOGIN_ATTEMPTED
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;num_nodes
OG
l_int|0
)paren
id|fi-&gt;num_nodes
op_decrement
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
id|DPRINTK1
c_func
(paren
l_string|&quot;ELS_LOGO received from node 0x%x which is not logged-in&quot;
comma
id|s_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ELS_RSCN
suffix:colon
(brace
r_int
id|payload_len
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|8
)paren
)paren
op_amp
l_int|0xFF
suffix:semicolon
r_int
id|no_of_pages
comma
id|i
suffix:semicolon
id|u_char
id|address_format
suffix:semicolon
id|u_short
id|received_ox_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|base_ptr
op_plus
l_int|6
)paren
)paren
op_rshift
l_int|16
suffix:semicolon
id|u_int
id|node_id
comma
id|mask
comma
op_star
id|page_ptr
op_assign
id|base_ptr
op_plus
l_int|9
suffix:semicolon
r_if
c_cond
(paren
(paren
id|payload_len
OL
l_int|4
)paren
op_logical_or
(paren
id|payload_len
OG
l_int|256
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;RSCN with invalid payload length received&quot;
)paren
suffix:semicolon
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|LOGICAL_ERR
comma
id|RECV_FIELD_SIZE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Page_size includes the Command Code */
id|no_of_pages
op_assign
(paren
id|payload_len
op_div
l_int|4
)paren
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_pages
suffix:semicolon
id|i
op_increment
)paren
(brace
id|address_format
op_assign
id|ntohl
c_func
(paren
op_star
id|page_ptr
)paren
op_rshift
l_int|24
suffix:semicolon
id|node_id
op_assign
id|ntohl
c_func
(paren
op_star
id|page_ptr
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
r_switch
c_cond
(paren
id|address_format
)paren
(brace
r_case
id|PORT_ADDRESS_FORMAT
suffix:colon
id|rscn_handler
c_func
(paren
id|fi
comma
id|node_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AREA_ADDRESS_FORMAT
suffix:colon
r_case
id|DOMAIN_ADDRESS_FORMAT
suffix:colon
r_if
c_cond
(paren
id|address_format
op_eq
id|AREA_ADDRESS_FORMAT
)paren
id|mask
op_assign
l_int|0xFFFF00
suffix:semicolon
r_else
id|mask
op_assign
l_int|0xFF0000
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|q-&gt;d_id
op_amp
id|mask
)paren
op_eq
(paren
id|node_id
op_amp
id|mask
)paren
)paren
id|rscn_handler
c_func
(paren
id|fi
comma
id|q-&gt;d_id
)paren
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
multiline_comment|/* There might be some new nodes to be &n;&t;&t;&t;&t;&t;&t; * discovered. But, some of the earlier &n;&t;&t;&t;&t;&t;&t; * requests as a result of the RSCN might be &n;&t;&t;&t;&t;&t;&t; * in progress. We dont want to duplicate that &n;&t;&t;&t;&t;&t;&t; * effort. So letz call SCR after a lag.&n;&t;&t;&t;&t;&t;&t; */
id|fi-&gt;explore_timer.function
op_assign
id|scr_timer
suffix:semicolon
id|fi-&gt;explore_timer.data
op_assign
(paren
r_int
r_int
)paren
id|fi
suffix:semicolon
id|fi-&gt;explore_timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
id|no_of_pages
op_star
l_int|3
op_star
id|HZ
)paren
op_div
l_int|100
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|T_MSG
c_func
(paren
l_string|&quot;RSCN with invalid address format received&quot;
)paren
suffix:semicolon
id|tx_ls_rjt
c_func
(paren
id|fi
comma
id|s_id
comma
id|received_ox_id
comma
id|LOGICAL_ERR
comma
id|NO_EXPLN
)paren
suffix:semicolon
)brace
id|page_ptr
op_add_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* end of for loop */
)brace
multiline_comment|/* end of case RSCN: */
r_break
suffix:semicolon
)brace
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
id|LEAVE
c_func
(paren
l_string|&quot;remove_from_address_cache&quot;
)paren
suffix:semicolon
)brace
DECL|function|rscn_handler
r_static
r_void
id|rscn_handler
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|node_id
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_int
id|login_state
op_assign
id|sid_logged_in
c_func
(paren
id|fi
comma
id|node_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|login_state
op_eq
id|NODE_LOGGED_IN
)paren
op_logical_or
(paren
id|login_state
op_eq
id|NODE_PROCESS_LOGGED_IN
)paren
)paren
(brace
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;d_id
op_eq
id|node_id
)paren
(brace
id|q-&gt;login
op_assign
id|LOGIN_ATTEMPTED
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;num_nodes
OG
l_int|0
)paren
id|fi-&gt;num_nodes
op_decrement
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|q
op_assign
id|q-&gt;next
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|login_state
op_eq
id|NODE_LOGGED_OUT
)paren
id|tx_adisc
c_func
(paren
id|fi
comma
id|ELS_ADISC
comma
id|node_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|login_state
op_eq
id|NODE_LOGGED_OUT
)paren
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|node_id
)paren
suffix:semicolon
)brace
DECL|function|scr_timer
r_static
r_void
id|scr_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fi-&gt;explore_timer
)paren
suffix:semicolon
id|tx_name_server_req
c_func
(paren
id|fi
comma
id|FCS_GP_ID4
)paren
suffix:semicolon
)brace
DECL|function|sid_logged_in
r_static
r_int
id|sid_logged_in
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
id|s_id
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|temp
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
(paren
id|temp-&gt;d_id
op_eq
id|s_id
)paren
op_logical_and
(paren
id|temp-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
)paren
(brace
r_if
c_cond
(paren
id|temp-&gt;scsi
op_ne
id|FALSE
)paren
r_return
id|NODE_PROCESS_LOGGED_IN
suffix:semicolon
r_else
r_return
id|NODE_LOGGED_IN
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|temp-&gt;d_id
op_eq
id|s_id
)paren
op_logical_and
(paren
id|temp-&gt;login
op_ne
id|LOGIN_COMPLETED
)paren
)paren
r_return
id|NODE_LOGGED_OUT
suffix:semicolon
r_else
id|temp
op_assign
id|temp-&gt;next
suffix:semicolon
r_return
id|NODE_NOT_PRESENT
suffix:semicolon
)brace
DECL|function|mark_scsi_sid
r_static
r_void
id|mark_scsi_sid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
comma
id|u_char
id|action
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
id|u_int
id|s_id
suffix:semicolon
id|u_int
id|service_params
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|service_params
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|12
)paren
)paren
op_amp
l_int|0x000000F0
suffix:semicolon
r_while
c_loop
(paren
id|temp
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
(paren
id|temp-&gt;d_id
op_eq
id|s_id
)paren
op_logical_and
(paren
id|temp-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
)paren
(brace
r_if
c_cond
(paren
id|action
op_eq
id|DELETE_ENTRY
)paren
(brace
id|temp-&gt;scsi
op_assign
id|FALSE
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/* Check if it is a SCSI Target */
r_if
c_cond
(paren
op_logical_neg
(paren
id|service_params
op_amp
id|TARGET_FUNC
)paren
)paren
(brace
id|temp-&gt;scsi
op_assign
id|INITIATOR
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|temp-&gt;scsi
op_assign
id|TARGET
suffix:semicolon
multiline_comment|/* This helps to maintain the target_id no matter what your&n;&t;&t;&t; *  Fibre Channel ID is.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|temp-&gt;target_id
op_eq
l_int|0xFF
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;g.no_of_targets
op_le
id|MAX_SCSI_TARGETS
)paren
id|temp-&gt;target_id
op_assign
id|fi-&gt;g.no_of_targets
op_increment
suffix:semicolon
r_else
id|T_MSG
c_func
(paren
l_string|&quot;MAX TARGETS reached!&quot;
)paren
suffix:semicolon
)brace
r_else
id|DPRINTK1
c_func
(paren
l_string|&quot;Target_id %d already present&quot;
comma
id|temp-&gt;target_id
)paren
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
r_else
id|temp
op_assign
id|temp-&gt;next
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|node_logged_in_prev
r_static
r_int
id|node_logged_in_prev
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_int
op_star
id|buff_addr
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp
suffix:semicolon
id|u_char
op_star
id|data
op_assign
(paren
id|u_char
op_star
)paren
id|buff_addr
suffix:semicolon
id|u_int
id|s_id
suffix:semicolon
r_char
id|node_name
(braket
id|NODE_NAME_LEN
)braket
suffix:semicolon
id|s_id
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|buff_addr
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x00FFFFFF
suffix:semicolon
id|memcpy
c_func
(paren
id|node_name
comma
id|buff_addr
op_plus
l_int|12
comma
id|NODE_NAME_LEN
)paren
suffix:semicolon
multiline_comment|/* point to port_name in the ADISC payload */
id|data
op_add_assign
l_int|10
op_star
l_int|4
suffix:semicolon
multiline_comment|/* point to last 6 bytes of port_name */
id|data
op_add_assign
l_int|2
suffix:semicolon
id|temp
op_assign
id|look_up_cache
c_func
(paren
id|fi
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|temp-&gt;d_id
op_eq
id|s_id
)paren
op_logical_and
(paren
id|memcmp
c_func
(paren
id|node_name
comma
id|temp-&gt;node_name
comma
id|NODE_NAME_LEN
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|temp-&gt;login
op_assign
id|LOGIN_COMPLETED
suffix:semicolon
macro_line|#if DEBUG_5526_2
id|display_cache
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#endif
r_return
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|look_up_cache
r_static
r_struct
id|fc_node_info
op_star
id|look_up_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
r_char
op_star
id|data
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp_list
op_assign
id|fi-&gt;node_info_list
comma
op_star
id|q
suffix:semicolon
id|u_char
id|n_port_name
(braket
id|FC_ALEN
)braket
comma
id|temp_addr
(braket
id|FC_ALEN
)braket
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;look_up_cache&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|n_port_name
comma
id|data
comma
id|FC_ALEN
)paren
suffix:semicolon
r_while
c_loop
(paren
id|temp_list
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|n_port_name
comma
op_amp
(paren
id|temp_list-&gt;hw_addr
(braket
l_int|2
)braket
)paren
comma
id|FC_ALEN
)paren
op_eq
l_int|0
)paren
r_return
id|temp_list
suffix:semicolon
r_else
id|temp_list
op_assign
id|temp_list-&gt;next
suffix:semicolon
)brace
multiline_comment|/* Broadcast IP ?&n;&t; */
id|temp_addr
(braket
l_int|0
)braket
op_assign
id|temp_addr
(braket
l_int|1
)braket
op_assign
id|temp_addr
(braket
l_int|2
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|temp_addr
(braket
l_int|3
)braket
op_assign
id|temp_addr
(braket
l_int|4
)braket
op_assign
id|temp_addr
(braket
l_int|5
)braket
op_assign
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|n_port_name
comma
id|temp_addr
comma
id|FC_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|q
op_assign
(paren
r_struct
id|fc_node_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fc_node_info
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;kmalloc failed in look_up_cache()&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|q-&gt;d_id
op_assign
id|BROADCAST
suffix:semicolon
r_return
id|q
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;look_up_cache&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|display_cache
r_static
r_int
id|display_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_struct
id|fc_node_info
op_star
id|q
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
macro_line|#if DEBUG_5526_2
r_struct
id|ox_id_els_map
op_star
id|temp_ox_id_list
op_assign
id|fi-&gt;ox_id_list
suffix:semicolon
macro_line|#endif
r_int
id|count
op_assign
l_int|0
comma
id|j
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nFibre Channel Node Information for %s&bslash;n&quot;
comma
id|fi-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;My FC_ID = %x, My WWN = %x %x, &quot;
comma
id|fi-&gt;g.my_id
comma
id|fi-&gt;g.my_node_name_high
comma
id|fi-&gt;g.my_node_name_low
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
id|printk
c_func
(paren
l_string|&quot;Port_Type = N_Port&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
id|printk
c_func
(paren
l_string|&quot;Port_Type = L_Port&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|q
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;WWN = &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|PORT_NAME_LEN
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%x &quot;
comma
id|q-&gt;hw_addr
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FC_ID = %x, &quot;
comma
id|q-&gt;d_id
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Login = &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
id|printk
c_func
(paren
l_string|&quot;ON &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;OFF &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;scsi
op_eq
id|TARGET
)paren
id|printk
c_func
(paren
l_string|&quot;Target_ID = %d &quot;
comma
id|q-&gt;target_id
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|q
op_assign
id|q-&gt;next
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
macro_line|#if DEBUG_5526_2
id|printk
c_func
(paren
l_string|&quot;OX_ID -&gt; ELS Map&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|temp_ox_id_list
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ox_id = %x, ELS = %x&bslash;n&quot;
comma
id|temp_ox_id_list-&gt;ox_id
comma
id|temp_ox_id_list-&gt;els
)paren
suffix:semicolon
id|temp_ox_id_list
op_assign
id|temp_ox_id_list-&gt;next
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|iph5526_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fc_info
op_star
id|fi
op_assign
(paren
r_struct
id|fc_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
op_amp
id|fi-&gt;fc_stats
suffix:semicolon
)brace
multiline_comment|/* SCSI stuff starts here */
DECL|function|iph5526_detect
r_int
id|iph5526_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|tmpt
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_int
id|no_of_hosts
op_assign
l_int|0
comma
id|timeout
comma
id|i
comma
id|j
comma
id|count
op_assign
l_int|0
suffix:semicolon
id|u_int
id|pci_maddr
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
id|tmpt-&gt;proc_name
op_assign
l_string|&quot;iph5526&quot;
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526: PCI not present&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|MAX_FC_CARDS
suffix:semicolon
id|i
op_increment
)paren
id|fc
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|clone_list
(braket
id|i
)braket
dot
id|vendor_id
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|clone_list
(braket
id|i
)braket
dot
id|vendor_id
comma
id|clone_list
(braket
id|i
)braket
dot
id|device_id
comma
id|pdev
)paren
)paren
)paren
(brace
r_int
r_int
id|pci_command
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|MAX_FC_CARDS
)paren
(brace
id|fc
(braket
id|count
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fc_info
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc
(braket
id|count
)braket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c: Unable to register card # %d&bslash;n&quot;
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
r_return
id|no_of_hosts
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fc
(braket
id|count
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fc_info
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c: Maximum Number of cards reached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|no_of_hosts
suffix:semicolon
)brace
id|fi
op_assign
id|fc
(braket
id|count
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|fi-&gt;name
comma
l_string|&quot;fc%d&quot;
comma
id|count
)paren
suffix:semicolon
id|host
op_assign
id|scsi_register
c_func
(paren
id|tmpt
comma
r_sizeof
(paren
r_struct
id|iph5526_hostdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|host
op_eq
l_int|NULL
)paren
(brace
r_return
id|no_of_hosts
suffix:semicolon
)brace
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
id|memset
c_func
(paren
id|hostdata
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iph5526_hostdata
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAX_SCSI_TARGETS
suffix:semicolon
id|j
op_increment
)paren
id|hostdata-&gt;tag_ages
(braket
id|j
)braket
op_assign
id|jiffies
suffix:semicolon
id|hostdata-&gt;fi
op_assign
id|fi
suffix:semicolon
id|fi-&gt;host
op_assign
id|host
suffix:semicolon
singleline_comment|//host-&gt;max_id = MAX_SCSI_TARGETS;
id|host-&gt;max_id
op_assign
l_int|5
suffix:semicolon
id|host-&gt;hostt-&gt;use_new_eh_code
op_assign
l_int|1
suffix:semicolon
id|host-&gt;this_id
op_assign
id|tmpt-&gt;this_id
suffix:semicolon
id|pci_maddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_IO
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c : Cannot find proper PCI device base address.&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|host
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|fc
(braket
id|count
)braket
)paren
suffix:semicolon
id|fc
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;pci_maddr = %x&quot;
comma
id|pci_maddr
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
id|pci_irq_line
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;iph5526.c: PCI BIOS reports %s at i/o %#x, irq %d.&bslash;n&quot;
comma
id|clone_list
(braket
id|i
)braket
dot
id|name
comma
id|pci_maddr
comma
id|pci_irq_line
)paren
suffix:semicolon
id|fi-&gt;g.mem_base
op_assign
id|ioremap
c_func
(paren
id|pci_maddr
op_amp
id|PAGE_MASK
comma
l_int|1024
)paren
suffix:semicolon
multiline_comment|/* We use Memory Mapped IO. The initial space contains the&n;&t;&t; * PCI Configuration registers followed by the (i) chip&n;&t;&t; * registers followed by the Tachyon registers.&n;&t;&t; */
multiline_comment|/* Thatz where (i)chip maps Tachyon Address Space.&n;&t;&t; */
id|fi-&gt;g.tachyon_base
op_assign
(paren
id|u_long
)paren
id|fi-&gt;g.mem_base
op_plus
id|TACHYON_OFFSET
op_plus
(paren
id|pci_maddr
op_amp
op_complement
id|PAGE_MASK
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;fi-&gt;g.tachyon_base = %x&quot;
comma
(paren
id|u_int
)paren
id|fi-&gt;g.tachyon_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.mem_base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c : ioremap failed!!!&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|host
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|fc
(braket
id|count
)braket
)paren
suffix:semicolon
id|fc
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;IRQ1 = %d&bslash;n&quot;
comma
id|pci_irq_line
)paren
suffix:semicolon
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
id|fi-&gt;base_addr
op_assign
(paren
r_int
)paren
id|pdev
suffix:semicolon
r_if
c_cond
(paren
id|pci_irq_line
)paren
(brace
r_int
id|irqval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Found it, get IRQ.&n;&t;&t;&t; */
id|irqval
op_assign
id|request_irq
c_func
(paren
id|pci_irq_line
comma
op_amp
id|tachyon_interrupt
comma
id|pci_irq_line
ques
c_cond
id|SA_SHIRQ
suffix:colon
l_int|0
comma
id|fi-&gt;name
comma
id|host
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irqval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c : Unable to get IRQ %d (irqval = %d).&bslash;n&quot;
comma
id|pci_irq_line
comma
id|irqval
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|host
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|fc
(braket
id|count
)braket
)paren
suffix:semicolon
id|fc
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|host-&gt;irq
op_assign
id|fi-&gt;irq
op_assign
id|pci_irq_line
suffix:semicolon
id|pci_irq_line
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;clone_id
op_assign
id|clone_list
(braket
id|i
)braket
dot
id|vendor_id
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|initialize_register_pointers
c_func
(paren
id|fi
)paren
op_logical_or
op_logical_neg
id|tachyon_init
c_func
(paren
id|fi
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c: TACHYON initialization failed for card # %d!!!&bslash;n&quot;
comma
id|count
op_plus
l_int|1
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|host-&gt;irq
comma
id|host
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|host
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
id|clean_up_memory
c_func
(paren
id|fi
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|fc
(braket
id|count
)braket
)paren
suffix:semicolon
id|fc
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Fibre Channel card initialized&quot;
)paren
suffix:semicolon
multiline_comment|/* Wait for the Link to come up and the login process &n;&t;&t; * to complete. &n;&t;&t; */
r_for
c_loop
(paren
id|timeout
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
(paren
id|timeout
OG
id|jiffies
)paren
op_logical_and
(paren
(paren
id|fi-&gt;g.link_up
op_eq
id|FALSE
)paren
op_logical_or
(paren
id|fi-&gt;g.port_discovery
op_eq
id|TRUE
)paren
op_logical_or
(paren
id|fi-&gt;g.explore_fabric
op_eq
id|TRUE
)paren
op_logical_or
(paren
id|fi-&gt;g.perform_adisc
op_eq
id|TRUE
)paren
)paren
suffix:semicolon
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
id|count
op_increment
suffix:semicolon
id|no_of_hosts
op_increment
suffix:semicolon
)brace
id|DPRINTK1
c_func
(paren
l_string|&quot;no_of_hosts = %d&quot;
comma
id|no_of_hosts
)paren
suffix:semicolon
multiline_comment|/* This is to make sure that the ACC to the PRLI comes in &n;&t; * for the last ALPA. &n;&t; */
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Ugly! Let the Gods forgive me */
id|DPRINTK1
c_func
(paren
l_string|&quot;leaving iph5526_detect&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|no_of_hosts
suffix:semicolon
)brace
DECL|function|iph5526_biosparam
r_int
id|iph5526_biosparam
c_func
(paren
id|Disk
op_star
id|disk
comma
id|kdev_t
id|n
comma
r_int
id|ip
(braket
)braket
)paren
(brace
r_int
id|size
op_assign
id|disk-&gt;capacity
suffix:semicolon
id|ip
(braket
l_int|0
)braket
op_assign
l_int|64
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
l_int|32
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|size
op_rshift
l_int|11
suffix:semicolon
r_if
c_cond
(paren
id|ip
(braket
l_int|2
)braket
OG
l_int|1024
)paren
(brace
id|ip
(braket
l_int|0
)braket
op_assign
l_int|255
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
l_int|63
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|size
op_div
(paren
id|ip
(braket
l_int|0
)braket
op_star
id|ip
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_queuecommand
r_int
id|iph5526_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|Cmnd
comma
r_void
(paren
op_star
id|done
)paren
(paren
id|Scsi_Cmnd
op_star
)paren
)paren
(brace
r_int
id|int_required
op_assign
l_int|0
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|UNSOLICITED_COMMAND
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_FCP
op_or
id|SEQUENCE_INITIATIVE
suffix:semicolon
id|u_int
id|frame_class
op_assign
id|Cmnd-&gt;target
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|Cmnd-&gt;host
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
id|hostdata-&gt;fi
suffix:semicolon
r_struct
id|fc_node_info
op_star
id|q
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;iph5526_queuecommand&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
id|Cmnd-&gt;scsi_done
op_assign
id|done
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;device-&gt;tagged_supported
)paren
(brace
r_switch
c_cond
(paren
id|Cmnd-&gt;tag
)paren
(brace
r_case
id|SIMPLE_QUEUE_TAG
suffix:colon
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|FCP_CNTL_QTYPE_SIMPLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HEAD_OF_QUEUE_TAG
suffix:colon
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|FCP_CNTL_QTYPE_HEAD_OF_Q
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ORDERED_QUEUE_TAG
suffix:colon
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|FCP_CNTL_QTYPE_ORDERED
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|hostdata-&gt;tag_ages
(braket
id|Cmnd-&gt;target
)braket
)paren
OG
(paren
l_int|5
op_star
id|HZ
)paren
)paren
(brace
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|FCP_CNTL_QTYPE_ORDERED
suffix:semicolon
id|hostdata-&gt;tag_ages
(braket
id|Cmnd-&gt;target
)braket
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|FCP_CNTL_QTYPE_SIMPLE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*else&n;&t;&t;hostdata-&gt;cmnd.fcp_cntl = FCP_CNTL_QTYPE_UNTAGGED;&n;&t;*/
id|hostdata-&gt;cmnd.fcp_addr
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_addr
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_addr
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_addr
(braket
l_int|0
)braket
op_assign
id|htons
c_func
(paren
id|Cmnd-&gt;lun
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|hostdata-&gt;cmnd.fcp_cdb
comma
id|Cmnd-&gt;cmnd
comma
id|Cmnd-&gt;cmd_len
)paren
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_data_len
op_assign
id|htonl
c_func
(paren
id|Cmnd-&gt;request_bufflen
)paren
suffix:semicolon
multiline_comment|/* Get an used OX_ID. We could have pending commands.&n;&t; */
r_if
c_cond
(paren
id|get_scsi_oxid
c_func
(paren
id|fi
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|fi-&gt;q.free_scsi_oxid
(braket
id|fi-&gt;g.scsi_oxid
)braket
op_assign
id|OXID_INUSE
suffix:semicolon
multiline_comment|/* Maintain a handler so that we can associate the done() function&n;&t; * on completion of the SCSI command. &n;&t; */
id|hostdata-&gt;cmnd_handler
(braket
id|fi-&gt;g.scsi_oxid
)braket
op_assign
id|Cmnd
suffix:semicolon
r_switch
c_cond
(paren
id|Cmnd-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|WRITE_6
suffix:colon
r_case
id|WRITE_10
suffix:colon
r_case
id|WRITE_12
suffix:colon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_SCSI_WRITE
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|htonl
c_func
(paren
id|FCP_CNTL_WRITE
op_or
id|hostdata-&gt;cmnd.fcp_cntl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|fi-&gt;g.type_of_frame
op_assign
id|FC_SCSI_READ
suffix:semicolon
id|hostdata-&gt;cmnd.fcp_cntl
op_assign
id|htonl
c_func
(paren
id|FCP_CNTL_READ
op_or
id|hostdata-&gt;cmnd.fcp_cntl
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_fcp_cmnd
(braket
id|fi-&gt;q.fcp_cmnd_indx
)braket
comma
op_amp
(paren
id|hostdata-&gt;cmnd
)paren
comma
r_sizeof
(paren
id|fcp_cmd
)paren
)paren
suffix:semicolon
id|q
op_assign
id|resolve_target
c_func
(paren
id|fi
comma
id|Cmnd-&gt;target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|u_int
id|bad_id
op_assign
id|fi-&gt;g.my_ddaa
op_or
l_int|0xFE
suffix:semicolon
multiline_comment|/* We transmit to an non-existant AL_PA so that the &quot;done&quot; &n;&t;&t; * function can be called while receiving the interrupt &n;&t;&t; * due to a Timeout for a bad AL_PA. In a PTP configuration,&n;&t;&t; * the int_required field is set, since there is no notion&n;&t;&t; * of AL_PAs. This approach sucks, but works alright!&n;&t;&t; */
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
id|int_required
op_assign
l_int|1
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
op_amp
(paren
id|hostdata-&gt;cmnd
)paren
)paren
comma
r_sizeof
(paren
id|fcp_cmd
)paren
comma
id|r_ctl
comma
id|type
comma
id|bad_id
comma
id|fi-&gt;g.my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|FC_SCSI_BAD_TARGET
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;Target ID %x not present&quot;
comma
id|Cmnd-&gt;target
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
(brace
r_if
c_cond
(paren
id|add_to_sest
c_func
(paren
id|fi
comma
id|Cmnd
comma
id|q
)paren
)paren
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;add_to_sest() failed.&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
id|fi-&gt;q.ptr_fcp_cmnd
(braket
id|fi-&gt;q.fcp_cmnd_indx
)braket
)paren
comma
r_sizeof
(paren
id|fcp_cmd
)paren
comma
id|r_ctl
comma
id|type
comma
id|q-&gt;d_id
comma
id|q-&gt;mtu
comma
id|int_required
comma
id|ox_id
comma
id|frame_class
op_lshift
l_int|16
)paren
suffix:semicolon
id|update_FCP_CMND_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* If q != NULL, then we have a SCSI Target. &n;&t; * If q-&gt;login != LOGIN_COMPLETED, then that device could be &n;&t; * offline temporarily. So we let the command to time-out. &n;&t; */
id|LEAVE
c_func
(paren
l_string|&quot;iph5526_queuecommand&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_abort
r_int
id|iph5526_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|Cmnd
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
id|Cmnd-&gt;host
suffix:semicolon
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
id|hostdata-&gt;fi
suffix:semicolon
r_struct
id|fc_node_info
op_star
id|q
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|UNSOLICITED_COMMAND
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_FCP
op_or
id|SEQUENCE_INITIATIVE
suffix:semicolon
id|u_short
id|ox_id
op_assign
id|OX_ID_FIRST_SEQUENCE
suffix:semicolon
r_int
id|int_required
op_assign
l_int|1
comma
id|i
comma
id|abort_status
op_assign
id|FALSE
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;iph5526_abort&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
id|q
op_assign
id|resolve_target
c_func
(paren
id|fi
comma
id|Cmnd-&gt;target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|u_int
id|bad_id
op_assign
id|fi-&gt;g.my_ddaa
op_or
l_int|0xFE
suffix:semicolon
multiline_comment|/* This should not happen as we should always be able to&n;&t;&t; * resolve a target id. But, jus in case...&n;&t;&t; * We transmit to an non-existant AL_PA so that the done &n;&t;&t; * function can be called while receiving the interrupt &n;&t;&t; * for a bad AL_PA. &n;&t;&t; */
id|DPRINTK1
c_func
(paren
l_string|&quot;Unresolved Target ID!&quot;
)paren
suffix:semicolon
id|tx_exchange
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
(paren
op_amp
(paren
id|hostdata-&gt;cmnd
)paren
)paren
comma
r_sizeof
(paren
id|fcp_cmd
)paren
comma
id|r_ctl
comma
id|type
comma
id|bad_id
comma
id|fi-&gt;g.my_mtu
comma
id|int_required
comma
id|ox_id
comma
id|FC_SCSI_BAD_TARGET
)paren
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;Target ID %x not present&quot;
comma
id|Cmnd-&gt;target
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
multiline_comment|/* If q != NULL, then we have a SCSI Target. If &n;&t; * q-&gt;login != LOGIN_COMPLETED, then that device could &n;&t; * be offline temporarily. So we let the command to time-out. &n;&t; */
multiline_comment|/* Get the OX_ID for the Command to be aborted.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|MAX_SCSI_XID
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|hostdata-&gt;cmnd_handler
(braket
id|i
)braket
op_eq
id|Cmnd
)paren
(brace
id|hostdata-&gt;cmnd_handler
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ox_id
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
OG
id|MAX_SCSI_XID
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Command could not be resolved to OX_ID&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|Cmnd-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|WRITE_6
suffix:colon
r_case
id|WRITE_10
suffix:colon
r_case
id|WRITE_12
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|ox_id
op_or_assign
id|SCSI_READ_BIT
suffix:semicolon
)brace
id|abort_status
op_assign
id|abort_exchange
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|q-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
op_logical_and
(paren
id|abort_status
op_eq
id|TRUE
)paren
)paren
(brace
multiline_comment|/* Then, transmit an ABTS to the target. The rest &n;&t;&t; * is done when the BA_ACC is received for the ABTS.&n; &t; &t; */
id|tx_abts
c_func
(paren
id|fi
comma
id|q-&gt;d_id
comma
id|ox_id
)paren
suffix:semicolon
)brace
r_else
(brace
id|u_int
id|STE_bit
suffix:semicolon
id|u_short
id|x_id
suffix:semicolon
multiline_comment|/* Invalidate resources for that Exchange.&n;&t;&t; */
id|x_id
op_assign
id|ox_id
op_amp
id|MAX_SCSI_XID
suffix:semicolon
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|STE_bit
op_amp
id|SEST_V
)paren
(brace
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
op_and_assign
id|htonl
c_func
(paren
id|SEST_INV
)paren
suffix:semicolon
id|invalidate_SEST_entry
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
)brace
)brace
id|LEAVE
c_func
(paren
l_string|&quot;iph5526_abort&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|fi-&gt;fc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|abort_exchange
r_static
r_int
id|abort_exchange
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|ox_id
)paren
(brace
id|u_short
id|x_id
suffix:semicolon
r_volatile
id|u_int
id|flush_SEST
comma
id|STE_bit
suffix:semicolon
id|x_id
op_assign
id|ox_id
op_amp
id|MAX_SCSI_XID
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;Aborting Exchange %x&quot;
comma
id|ox_id
)paren
suffix:semicolon
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
multiline_comment|/* Is the Exchange still active?.&n;&t; */
r_if
c_cond
(paren
id|STE_bit
op_amp
id|SEST_V
)paren
(brace
r_if
c_cond
(paren
id|ox_id
op_amp
id|SCSI_READ_BIT
)paren
(brace
multiline_comment|/* If the Exchange to be aborted is Inbound, &n;&t;&t;&t; * Flush the SEST Entry from Tachyon&squot;s Cache.&n;&t;&t;&t; */
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
op_and_assign
id|htonl
c_func
(paren
id|SEST_INV
)paren
suffix:semicolon
id|flush_tachyon_cache
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
id|flush_SEST
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|flush_SEST
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
id|flush_SEST
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
)paren
suffix:semicolon
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|STE_bit
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
id|STE_bit
op_assign
id|ntohl
c_func
(paren
op_star
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
)paren
suffix:semicolon
id|flush_SEST
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
)paren
suffix:semicolon
id|invalidate_SEST_entry
c_func
(paren
id|fi
comma
id|ox_id
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
id|u_int
op_star
id|ptr_edb
suffix:semicolon
multiline_comment|/* For In-Order Reassembly, the following is done:&n;&t;&t;&t; * First, write zero as the buffer length in the EDB. &n;&t;&t; &t; */
id|ptr_edb
op_assign
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_sest
(braket
id|x_id
)braket
op_plus
l_int|7
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EDB_LEN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_edb
(braket
id|i
)braket
op_eq
id|ptr_edb
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|EDB_LEN
)paren
op_star
id|ptr_edb
op_assign
op_star
id|ptr_edb
op_amp
l_int|0x0000FFFF
suffix:semicolon
r_else
id|T_MSG
c_func
(paren
l_string|&quot;EDB not found while clearing in abort_exchange()&quot;
)paren
suffix:semicolon
)brace
id|DPRINTK1
c_func
(paren
l_string|&quot;Exchange %x invalidated&quot;
comma
id|ox_id
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK1
c_func
(paren
l_string|&quot;SEST Entry for exchange %x not valid&quot;
comma
id|ox_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
DECL|function|flush_tachyon_cache
r_static
r_void
id|flush_tachyon_cache
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_short
id|ox_id
)paren
(brace
r_volatile
id|u_int
id|tachyon_status
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.loop_up
op_eq
id|TRUE
)paren
(brace
id|writel
c_func
(paren
id|HOST_CONTROL
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
multiline_comment|/* Make sure that the Inbound FIFO is empty.&n;&t;&t; */
r_do
(brace
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|tachyon_status
op_amp
id|RECEIVE_FIFO_EMPTY
)paren
op_eq
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Ok. Go ahead and flushhhhhhhhh!&n;&t;&t; */
id|writel
c_func
(paren
l_int|0x80000000
op_or
id|ox_id
comma
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EXIT_HOST_CONTROL
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;g.ptp_up
op_eq
id|TRUE
)paren
(brace
id|take_tachyon_offline
c_func
(paren
id|fi
)paren
suffix:semicolon
multiline_comment|/* Make sure that the Inbound FIFO is empty.&n;&t;&t; */
r_do
(brace
id|tachyon_status
op_assign
id|readl
c_func
(paren
id|fi-&gt;t_r.ptr_tach_status_reg
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|tachyon_status
op_amp
id|RECEIVE_FIFO_EMPTY
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x80000000
op_or
id|ox_id
comma
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
)paren
suffix:semicolon
multiline_comment|/* Write the Initialize command to the FM Control reg.&n;&t;&t; */
id|fi-&gt;g.n_port_try
op_assign
id|TRUE
suffix:semicolon
id|DPRINTK1
c_func
(paren
l_string|&quot;In abort_exchange, TACHYON initializing as N_Port...&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|INITIALIZE
comma
id|fi-&gt;t_r.ptr_fm_control_reg
)paren
suffix:semicolon
)brace
)brace
DECL|function|resolve_target
r_static
r_struct
id|fc_node_info
op_star
id|resolve_target
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|u_char
id|target
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
r_while
c_loop
(paren
id|temp
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|temp-&gt;target_id
op_eq
id|target
)paren
(brace
r_if
c_cond
(paren
(paren
id|temp-&gt;scsi
op_eq
id|TARGET
)paren
op_logical_and
(paren
id|temp-&gt;login
op_eq
id|LOGIN_COMPLETED
)paren
)paren
r_return
id|temp
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|temp-&gt;login
op_ne
id|LOGIN_COMPLETED
)paren
(brace
multiline_comment|/* The Target is not currently logged in.&n;&t;&t;&t;&t;&t; * It could be a Target on the Local Loop or&n;&t;&t;&t;&t;&t; * on a Remote Loop connected through a switch.&n;&t;&t;&t;&t;&t; * In either case, we will know whenever the Target&n;&t;&t;&t;&t;&t; * comes On-Line again. We let the command to &n;&t;&t;&t;&t;&t; * time-out so that it gets retried.&n;&t;&t;&t;&t;&t; */
id|T_MSG
c_func
(paren
l_string|&quot;Target %d not logged in.&quot;
comma
id|temp-&gt;target_id
)paren
suffix:semicolon
id|tx_logi
c_func
(paren
id|fi
comma
id|ELS_PLOGI
comma
id|temp-&gt;d_id
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|temp-&gt;scsi
op_ne
id|TARGET
)paren
(brace
multiline_comment|/* For some reason, we did not get a response to&n;&t;&t;&t;&t;&t;&t; * PRLI. Letz try it again...&n;&t;&t;&t;&t;&t;&t; */
id|DPRINTK1
c_func
(paren
l_string|&quot;Node not PRLIied. Txing PRLI...&quot;
)paren
suffix:semicolon
id|tx_prli
c_func
(paren
id|fi
comma
id|ELS_PRLI
comma
id|temp-&gt;d_id
comma
id|OX_ID_FIRST_SEQUENCE
)paren
suffix:semicolon
)brace
)brace
r_return
id|temp
suffix:semicolon
)brace
)brace
r_else
id|temp
op_assign
id|temp-&gt;next
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|add_to_sest
r_static
r_int
id|add_to_sest
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
comma
id|Scsi_Cmnd
op_star
id|Cmnd
comma
r_struct
id|fc_node_info
op_star
id|ni
)paren
(brace
multiline_comment|/* we have at least 1 buffer, the terminator */
r_int
id|no_of_sdb_buffers
op_assign
l_int|1
comma
id|i
suffix:semicolon
r_int
id|no_of_edb_buffers
op_assign
l_int|0
suffix:semicolon
id|u_int
op_star
id|req_buffer
op_assign
(paren
id|u_int
op_star
)paren
id|Cmnd-&gt;request_buffer
suffix:semicolon
id|u_int
op_star
id|ptr_sdb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl1
comma
op_star
id|sl2
op_assign
l_int|NULL
suffix:semicolon
r_int
id|no_of_sg
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|fi-&gt;g.type_of_frame
)paren
(brace
r_case
id|FC_SCSI_READ
suffix:colon
id|fi-&gt;g.inb_sest_entry.flags_and_byte_offset
op_assign
id|htonl
c_func
(paren
id|INB_SEST_VED
)paren
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.byte_count
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.no_of_recvd_frames
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.no_of_expected_frames
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.last_fctl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
(brace
id|no_of_sg
op_assign
id|Cmnd-&gt;use_sg
suffix:semicolon
id|sl1
op_assign
id|sl2
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|Cmnd-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_sg
suffix:semicolon
id|i
op_increment
)paren
(brace
id|no_of_sdb_buffers
op_add_assign
id|sl1-&gt;length
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|sl1-&gt;length
op_mod
id|SEST_BUFFER_SIZE
)paren
id|no_of_sdb_buffers
op_increment
suffix:semicolon
id|sl1
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|no_of_sdb_buffers
op_add_assign
id|Cmnd-&gt;request_bufflen
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
op_mod
id|SEST_BUFFER_SIZE
)paren
id|no_of_sdb_buffers
op_increment
suffix:semicolon
)brace
multiline_comment|/* if !use_sg */
multiline_comment|/* We are working with the premise that at the max we would&n;&t;&t;&t; * get a scatter-gather buffer containing 63 buffers&n;&t;&t;&t; * of size 1024 bytes each. Is it a _bad_ assumption?&n;&t;&t;&t; */
r_if
c_cond
(paren
id|no_of_sdb_buffers
OG
l_int|512
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;Number of SDB buffers needed = %d&quot;
comma
id|no_of_sdb_buffers
)paren
suffix:semicolon
id|T_MSG
c_func
(paren
l_string|&quot;Disable Scatter-Gather!!!&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Store it in the sdb_table so that we can retrieve that&n;&t;&t;&t; * free up the memory when the Read Command completes.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|get_free_SDB
c_func
(paren
id|fi
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|ptr_sdb
op_assign
id|fi-&gt;q.ptr_sdb_slot
(braket
id|fi-&gt;q.sdb_indx
)braket
suffix:semicolon
id|fi-&gt;q.sdb_slot_status
(braket
id|fi-&gt;q.sdb_indx
)braket
op_assign
id|SDB_BUSY
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.sdb_address
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|ptr_sdb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
(brace
r_int
id|count
op_assign
l_int|0
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_sg
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
op_star
id|addr_ptr
op_assign
id|sl2-&gt;address
suffix:semicolon
id|count
op_assign
id|sl2-&gt;length
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|sl2-&gt;length
op_mod
id|SEST_BUFFER_SIZE
)paren
id|count
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|count
suffix:semicolon
id|j
op_increment
)paren
(brace
op_star
(paren
id|ptr_sdb
)paren
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|addr_ptr
)paren
)paren
suffix:semicolon
id|addr_ptr
op_add_assign
id|SEST_BUFFER_SIZE
suffix:semicolon
id|ptr_sdb
op_increment
suffix:semicolon
)brace
id|count
op_assign
l_int|0
suffix:semicolon
id|sl2
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_sdb_buffers
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
(paren
id|ptr_sdb
)paren
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|req_buffer
)paren
)paren
suffix:semicolon
id|req_buffer
op_add_assign
id|SEST_BUFFER_SIZE
op_div
l_int|4
suffix:semicolon
id|ptr_sdb
op_increment
suffix:semicolon
)brace
)brace
op_star
(paren
id|ptr_sdb
)paren
op_assign
id|htonl
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* Terminator */
multiline_comment|/* The scratch pad is used to hold the index into the SDB.&n;&t;&t;&t; */
id|fi-&gt;g.inb_sest_entry.scratch_pad
op_assign
id|fi-&gt;q.sdb_indx
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.expected_ro
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.buffer_index
op_assign
l_int|0
suffix:semicolon
id|fi-&gt;g.inb_sest_entry.buffer_offset
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_sest
(braket
id|fi-&gt;g.scsi_oxid
)braket
comma
op_amp
id|fi-&gt;g.inb_sest_entry
comma
r_sizeof
(paren
id|INB_SEST_ENTRY
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_SCSI_WRITE
suffix:colon
id|fi-&gt;g.outb_sest_entry.flags_and_did
op_assign
id|htonl
c_func
(paren
id|OUTB_SEST_VED
op_or
id|ni-&gt;d_id
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.max_frame_len
op_assign
id|htons
c_func
(paren
id|ni-&gt;mtu
op_lshift
l_int|4
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.cntl
op_assign
id|htons
c_func
(paren
id|ODB_CLASS_3
op_or
id|ODB_EE_CREDIT
op_or
id|ODB_NO_INT
op_or
id|ODB_NO_COMP
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.total_seq_length
op_assign
id|INV_SEQ_LEN
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.link
op_assign
id|htons
c_func
(paren
id|OUTB_SEST_LINK
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.transaction_id
op_assign
id|htonl
c_func
(paren
id|fi-&gt;g.scsi_oxid
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.seq_id
op_assign
id|fi-&gt;g.seq_id
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.reserved
op_assign
l_int|0x0
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.header_length
op_assign
id|htons
c_func
(paren
id|TACHYON_HEADER_LEN
)paren
suffix:semicolon
(brace
id|u_char
id|df_ctl
op_assign
l_int|0
suffix:semicolon
id|u_short
id|rx_id
op_assign
id|RX_ID_FIRST_SEQUENCE
suffix:semicolon
id|u_int
id|r_ctl
op_assign
id|FC4_DEVICE_DATA
op_or
id|SOLICITED_DATA
suffix:semicolon
id|u_int
id|type
op_assign
id|TYPE_FCP
op_or
id|SEQUENCE_INITIATIVE
suffix:semicolon
multiline_comment|/* Multi Frame Sequence ? If yes, set RO bit. &n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
OG
id|ni-&gt;mtu
)paren
id|type
op_or_assign
id|RELATIVE_OFF_PRESENT
suffix:semicolon
id|build_tachyon_header
c_func
(paren
id|fi
comma
id|fi-&gt;g.my_id
comma
id|r_ctl
comma
id|ni-&gt;d_id
comma
id|type
comma
id|fi-&gt;g.seq_id
comma
id|df_ctl
comma
id|fi-&gt;g.scsi_oxid
comma
id|rx_id
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_free_header
c_func
(paren
id|fi
)paren
op_logical_or
id|get_free_EDB
c_func
(paren
id|fi
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.tach_header
)paren
comma
id|TACHYON_HEADER_LEN
)paren
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.header_address
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_tachyon_header
(braket
id|fi-&gt;q.tachyon_header_indx
)braket
)paren
)paren
suffix:semicolon
id|update_tachyon_header_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
(brace
id|no_of_sg
op_assign
id|Cmnd-&gt;use_sg
suffix:semicolon
id|sl1
op_assign
id|sl2
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|Cmnd-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_sg
suffix:semicolon
id|i
op_increment
)paren
(brace
id|no_of_edb_buffers
op_add_assign
id|sl1-&gt;length
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|sl1-&gt;length
op_mod
id|SEST_BUFFER_SIZE
)paren
id|no_of_edb_buffers
op_increment
suffix:semicolon
id|sl1
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|no_of_edb_buffers
op_add_assign
id|Cmnd-&gt;request_bufflen
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
op_mod
id|SEST_BUFFER_SIZE
)paren
id|no_of_edb_buffers
op_increment
suffix:semicolon
)brace
multiline_comment|/* if !use_sg */
multiline_comment|/* We need &quot;no_of_edb_buffers&quot; _contiguous_ EDBs &n;&t;&t;&t; * that are FREE. Check for that first.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_edb_buffers
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi-&gt;q.edb_buffer_indx
op_plus
id|no_of_edb_buffers
)paren
op_ge
id|EDB_LEN
)paren
id|fi-&gt;q.edb_buffer_indx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
op_plus
id|i
)braket
op_ne
id|EDB_FREE
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_free_EDB
c_func
(paren
id|fi
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* We got enuff FREE EDBs.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|Cmnd-&gt;use_sg
)paren
(brace
id|fi-&gt;g.outb_sest_entry.edb_address
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
)paren
)paren
suffix:semicolon
id|sl1
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|Cmnd-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_of_sg
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|count
op_assign
l_int|0
comma
id|j
suffix:semicolon
id|count
op_assign
id|sl1-&gt;length
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|count
suffix:semicolon
id|j
op_increment
)paren
(brace
id|build_EDB
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
id|sl1-&gt;address
comma
l_int|0
comma
id|SEST_BUFFER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.edb
)paren
comma
r_sizeof
(paren
id|EDB
)paren
)paren
suffix:semicolon
multiline_comment|/* Mark this EDB as being in use */
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
op_assign
id|EDB_BUSY
suffix:semicolon
multiline_comment|/* We have already made sure that we have enuff&n;&t;&t;&t;&t; &t; &t; * free EDBs that are contiguous. So this is &n;&t;&t;&t;&t;&t;&t; * safe.&n;&t;&t;&t;&t; &t; &t; */
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|sl1-&gt;address
op_add_assign
id|SEST_BUFFER_SIZE
suffix:semicolon
)brace
multiline_comment|/* Just in case itz not a multiple of &n;&t;&t;&t;&t;&t; * SEST_BUFFER_SIZE bytes.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|sl1-&gt;length
op_mod
id|SEST_BUFFER_SIZE
)paren
(brace
id|build_EDB
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
id|sl1-&gt;address
comma
l_int|0
comma
id|sl1-&gt;length
op_mod
id|SEST_BUFFER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.edb
)paren
comma
r_sizeof
(paren
id|EDB
)paren
)paren
suffix:semicolon
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
op_assign
id|EDB_BUSY
suffix:semicolon
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|sl1
op_increment
suffix:semicolon
)brace
multiline_comment|/* The last EDB is special. It needs the &quot;end bit&quot; to&n;&t;&t;&t;&t; * be set.&n;&t;&t;&t;&t; */
op_star
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
op_minus
l_int|1
)braket
op_plus
l_int|1
)paren
op_assign
op_star
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
op_minus
l_int|1
)braket
op_plus
l_int|1
)paren
op_or
id|ntohs
c_func
(paren
id|EDB_END
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|count
op_assign
l_int|0
comma
id|j
suffix:semicolon
id|fi-&gt;g.outb_sest_entry.edb_address
op_assign
id|htonl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
)paren
)paren
suffix:semicolon
id|count
op_assign
id|Cmnd-&gt;request_bufflen
op_div
id|SEST_BUFFER_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|count
suffix:semicolon
id|j
op_increment
)paren
(brace
id|build_EDB
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
id|req_buffer
comma
l_int|0
comma
id|SEST_BUFFER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.edb
)paren
comma
r_sizeof
(paren
id|EDB
)paren
)paren
suffix:semicolon
multiline_comment|/* Mark this EDB as being in use */
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
op_assign
id|EDB_BUSY
suffix:semicolon
multiline_comment|/* We have already made sure that we have enuff&n;&t;&t;&t; &t; &t; * free EDBs that are contiguous. So this is &n;&t;&t;&t;&t;&t; * safe.&n;&t;&t;&t; &t; &t; */
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
id|req_buffer
op_add_assign
id|SEST_BUFFER_SIZE
suffix:semicolon
)brace
multiline_comment|/* Just in case itz not a multiple of &n;&t;&t;&t;&t; * SEST_BUFFER_SIZE bytes.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|Cmnd-&gt;request_bufflen
op_mod
id|SEST_BUFFER_SIZE
)paren
(brace
id|build_EDB
c_func
(paren
id|fi
comma
(paren
r_char
op_star
)paren
id|req_buffer
comma
id|EDB_END
comma
id|Cmnd-&gt;request_bufflen
op_mod
id|SEST_BUFFER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
comma
op_amp
(paren
id|fi-&gt;g.edb
)paren
comma
r_sizeof
(paren
id|EDB
)paren
)paren
suffix:semicolon
id|fi-&gt;q.free_edb_list
(braket
id|fi-&gt;q.edb_buffer_indx
)braket
op_assign
id|EDB_BUSY
suffix:semicolon
id|update_EDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Mark the last EDB as the &quot;end edb&quot;.&n;&t;&t;&t;&t;&t; */
op_star
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
op_minus
l_int|1
)braket
op_plus
l_int|1
)paren
op_assign
op_star
(paren
id|fi-&gt;q.ptr_edb
(braket
id|fi-&gt;q.edb_buffer_indx
op_minus
l_int|1
)braket
op_plus
l_int|1
)paren
op_or
id|htons
c_func
(paren
id|EDB_END
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Finally we have something to send!.&n;&t;&t;&t; */
id|memcpy
c_func
(paren
id|fi-&gt;q.ptr_sest
(braket
id|fi-&gt;g.scsi_oxid
)braket
comma
op_amp
id|fi-&gt;g.outb_sest_entry
comma
r_sizeof
(paren
id|OUTB_SEST_ENTRY
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|update_FCP_CMND_indx
r_static
r_void
id|update_FCP_CMND_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.fcp_cmnd_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.fcp_cmnd_indx
op_eq
id|NO_OF_FCP_CMNDS
)paren
id|fi-&gt;q.fcp_cmnd_indx
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|get_scsi_oxid
r_static
r_int
id|get_scsi_oxid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|u_short
id|initial_oxid
op_assign
id|fi-&gt;g.scsi_oxid
suffix:semicolon
multiline_comment|/* Check if the OX_ID is in use.&n;&t; * We could have an outstanding SCSI command.&n;&t; */
r_while
c_loop
(paren
id|fi-&gt;q.free_scsi_oxid
(braket
id|fi-&gt;g.scsi_oxid
)braket
op_ne
id|OXID_AVAILABLE
)paren
(brace
id|update_scsi_oxid
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.scsi_oxid
op_eq
id|initial_oxid
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;No free OX_IDs avaliable&quot;
)paren
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|update_scsi_oxid
r_static
r_void
id|update_scsi_oxid
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;g.scsi_oxid
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.scsi_oxid
op_eq
(paren
id|MAX_SCSI_XID
op_plus
l_int|1
)paren
)paren
id|fi-&gt;g.scsi_oxid
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|get_free_SDB
r_static
r_int
id|get_free_SDB
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
r_int
id|initial_indx
op_assign
id|fi-&gt;q.sdb_indx
suffix:semicolon
multiline_comment|/* Check if the SDB is in use.&n;&t; * We could have an outstanding SCSI Read command.&n;&t; * We should find a free slot as we can queue a&n;&t; * maximum of 32 SCSI commands only. &n;&t; */
r_while
c_loop
(paren
id|fi-&gt;q.sdb_slot_status
(braket
id|fi-&gt;q.sdb_indx
)braket
op_ne
id|SDB_FREE
)paren
(brace
id|update_SDB_indx
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.sdb_indx
op_eq
id|initial_indx
)paren
(brace
id|T_MSG
c_func
(paren
l_string|&quot;No free SDB buffers avaliable&quot;
)paren
id|reset_tachyon
c_func
(paren
id|fi
comma
id|SOFTWARE_RESET
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|update_SDB_indx
r_static
r_void
id|update_SDB_indx
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|fi-&gt;q.sdb_indx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.sdb_indx
op_eq
id|NO_OF_SDB_ENTRIES
)paren
id|fi-&gt;q.sdb_indx
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_release
r_int
id|iph5526_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_struct
id|iph5526_hostdata
op_star
id|hostdata
op_assign
(paren
r_struct
id|iph5526_hostdata
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_struct
id|fc_info
op_star
id|fi
op_assign
id|hostdata-&gt;fi
suffix:semicolon
id|free_irq
c_func
(paren
id|host-&gt;irq
comma
id|host
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|fi-&gt;g.mem_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|iph5526_info
r_const
r_char
op_star
id|iph5526_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;Interphase 5526 Fibre Channel PCI SCSI Adapter using IRQ %d&bslash;n&quot;
comma
id|host-&gt;irq
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|macro|NAMELEN
mdefine_line|#define NAMELEN&t;&t;8&t;/* # of chars for storing dev-&gt;name */
DECL|variable|dev_fc
r_static
r_struct
id|net_device
op_star
id|dev_fc
(braket
id|MAX_FC_CARDS
)braket
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
l_int|0
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
op_assign
l_int|0
suffix:semicolon
DECL|variable|bad
r_static
r_int
id|bad
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0xbad = bad sig or no reset ack */
DECL|variable|scsi_registered
r_static
r_int
id|scsi_registered
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|driver_template.module
op_assign
op_amp
id|__this_module
suffix:semicolon
id|scsi_register_module
c_func
(paren
id|MODULE_SCSI_HA
comma
op_amp
id|driver_template
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver_template.present
)paren
id|scsi_registered
op_assign
id|TRUE
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526: SCSI registeration failed!!!&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_registered
op_assign
id|FALSE
suffix:semicolon
id|scsi_unregister_module
c_func
(paren
id|MODULE_SCSI_HA
comma
op_amp
id|driver_template
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|fc
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|dev_fc
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_assign
id|init_fcdev
c_func
(paren
id|dev_fc
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_fc
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c: init_fcdev failed for card #%d&bslash;n&quot;
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dev_fc
(braket
id|i
)braket
op_member_access_from_pointer
id|irq
op_assign
id|irq
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_member_access_from_pointer
id|mem_end
op_assign
id|bad
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_member_access_from_pointer
id|base_addr
op_assign
id|io
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_member_access_from_pointer
id|init
op_assign
id|iph5526_probe
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
op_assign
id|fc
(braket
id|i
)braket
suffix:semicolon
id|fc
(braket
id|i
)braket
op_member_access_from_pointer
id|dev
op_assign
id|dev_fc
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|register_fcdev
c_func
(paren
id|dev_fc
(braket
id|i
)braket
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|dev_fc
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_fc
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iph5526.c: IP registeration failed!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fc
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|fc
(braket
id|i
)braket
op_member_access_from_pointer
id|dev
suffix:semicolon
r_void
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|fc
(braket
id|i
)braket
op_member_access_from_pointer
id|g.dont_init
op_assign
id|TRUE
suffix:semicolon
id|take_tachyon_offline
c_func
(paren
id|fc
(braket
id|i
)braket
)paren
suffix:semicolon
id|unregister_fcdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|clean_up_memory
c_func
(paren
id|fc
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
)paren
id|kfree
c_func
(paren
id|priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scsi_registered
op_eq
id|TRUE
)paren
id|scsi_unregister_module
c_func
(paren
id|MODULE_SCSI_HA
comma
op_amp
id|driver_template
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|clean_up_memory
r_void
id|clean_up_memory
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|ENTER
c_func
(paren
l_string|&quot;clean_up_memory&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
id|free_pages
c_func
(paren
(paren
id|u_long
)paren
id|bus_to_virt
c_func
(paren
id|ntohl
c_func
(paren
op_star
(paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
)paren
)paren
comma
l_int|5
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;after kfree2&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SFSBQ_LENGTH
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NO_OF_ENTRIES
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|fi-&gt;q.ptr_sfs_buffers
(braket
id|i
op_star
id|NO_OF_ENTRIES
op_plus
id|j
)braket
)paren
id|kfree
c_func
(paren
id|fi-&gt;q.ptr_sfs_buffers
(braket
id|i
op_star
id|NO_OF_ENTRIES
op_plus
id|j
)braket
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;after kfree1&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_ocq_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_ocq_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_imq_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_imq_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_mfsbq_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_sfsbq_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_sfsbq_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_edb_base
)paren
id|free_pages
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_edb_base
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_sest_base
)paren
id|free_pages
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_sest_base
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_tachyon_header_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_tachyon_header_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_sdb_base
)paren
id|free_pages
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_sdb_base
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_fcp_cmnd_base
)paren
id|free_page
c_func
(paren
(paren
id|u_long
)paren
id|fi-&gt;q.ptr_fcp_cmnd_base
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;after free_pages&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_host_ocq_cons_indx
)paren
id|kfree
c_func
(paren
id|fi-&gt;q.ptr_host_ocq_cons_indx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_host_hpcq_cons_indx
)paren
id|kfree
c_func
(paren
id|fi-&gt;q.ptr_host_hpcq_cons_indx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;q.ptr_host_imq_prod_indx
)paren
id|kfree
c_func
(paren
id|fi-&gt;q.ptr_host_imq_prod_indx
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;after kfree3&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|fi-&gt;node_info_list
)paren
(brace
r_struct
id|fc_node_info
op_star
id|temp_list
op_assign
id|fi-&gt;node_info_list
suffix:semicolon
id|fi-&gt;node_info_list
op_assign
id|fi-&gt;node_info_list-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|temp_list
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|fi-&gt;ox_id_list
)paren
(brace
r_struct
id|ox_id_els_map
op_star
id|temp
op_assign
id|fi-&gt;ox_id_list
suffix:semicolon
id|fi-&gt;ox_id_list
op_assign
id|fi-&gt;ox_id_list-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
)brace
id|LEAVE
c_func
(paren
l_string|&quot;clean_up_memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|initialize_register_pointers
r_static
r_int
id|initialize_register_pointers
c_func
(paren
r_struct
id|fc_info
op_star
id|fi
)paren
(brace
id|ENTER
c_func
(paren
l_string|&quot;initialize_register_pointers&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;g.tachyon_base
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|fi-&gt;i_r.ptr_ichip_hw_control_reg
op_assign
id|ICHIP_HW_CONTROL_REG_OFF
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;i_r.ptr_ichip_hw_status_reg
op_assign
id|ICHIP_HW_STATUS_REG_OFF
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;i_r.ptr_ichip_hw_addr_mask_reg
op_assign
id|ICHIP_HW_ADDR_MASK_REG_OFF
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_ocq_base_reg
op_assign
id|OCQ_BASE_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_ocq_len_reg
op_assign
id|OCQ_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_ocq_prod_indx_reg
op_assign
id|OCQ_PRODUCER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_ocq_cons_indx_reg
op_assign
id|OCQ_CONSUMER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_imq_base_reg
op_assign
id|IMQ_BASE_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_imq_len_reg
op_assign
id|IMQ_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_imq_cons_indx_reg
op_assign
id|IMQ_CONSUMER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_imq_prod_indx_reg
op_assign
id|IMQ_PRODUCER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_mfsbq_base_reg
op_assign
id|MFSBQ_BASE_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_mfsbq_len_reg
op_assign
id|MFSBQ_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_mfsbq_prod_reg
op_assign
id|MFSBQ_PRODUCER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_mfsbq_cons_reg
op_assign
id|MFSBQ_CONSUMER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_mfsbuff_len_reg
op_assign
id|MFS_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sfsbq_base_reg
op_assign
id|SFSBQ_BASE_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sfsbq_len_reg
op_assign
id|SFSBQ_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sfsbq_prod_reg
op_assign
id|SFSBQ_PRODUCER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sfsbq_cons_reg
op_assign
id|SFSBQ_CONSUMER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sfsbuff_len_reg
op_assign
id|SFS_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sest_base_reg
op_assign
id|SEST_BASE_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_sest_len_reg
op_assign
id|SEST_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_scsibuff_len_reg
op_assign
id|SCSI_LENGTH_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_tach_config_reg
op_assign
id|TACHYON_CONFIG_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_tach_control_reg
op_assign
id|TACHYON_CONTROL_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_tach_status_reg
op_assign
id|TACHYON_STATUS_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_tach_flush_oxid_reg
op_assign
id|TACHYON_FLUSH_SEST_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_config_reg
op_assign
id|FMGR_CONFIG_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_control_reg
op_assign
id|FMGR_CONTROL_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_status_reg
op_assign
id|FMGR_STATUS_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_tov_reg
op_assign
id|FMGR_TIMER_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_wwn_hi_reg
op_assign
id|FMGR_WWN_HI_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_wwn_low_reg
op_assign
id|FMGR_WWN_LO_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|fi-&gt;t_r.ptr_fm_rx_al_pa_reg
op_assign
id|FMGR_RCVD_ALPA_REGISTER_OFFSET
op_plus
id|fi-&gt;g.tachyon_base
suffix:semicolon
id|LEAVE
c_func
(paren
l_string|&quot;initialize_register_pointers&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -DKERNEL -Wall -O6 -fomit-frame-pointer -I/usr/src/linux/net/tcp -c iph5526.c&quot;&n; *  version-control: t&n; *  kept-new-versions: 5&n; * End:&n; */
eof
