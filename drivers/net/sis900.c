multiline_comment|/*****************************************************************************/
multiline_comment|/*      sis900.c: A SiS 900 PCI Fast Ethernet driver for Linux.              */
multiline_comment|/*                                                                           */
multiline_comment|/*                Silicon Integrated System Corporation                      */
multiline_comment|/*                Revision:&t;1.05&t;Aug 7 1999                           */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                            &n;      Modified from the driver which is originally written by Donald Becker. &n;&n;      This software may be used and distributed according to the terms&n;      of the GNU Public License (GPL), incorporated herein by reference.&n;      Drivers based on this skeleton fall under the GPL and must retain&n;      the authorship (implicit copyright) notice.&n;&n;      The author may be reached as becker@tidalwave.net, or&n;      Donald Becker&n;      312 Severn Ave. #W302&n;      Annapolis MD 21403&n;&n;      Support and updates [to the original skeleton] available at&n;      http://www.tidalwave.net/~becker/pci-skeleton.html&n;*/
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;sis900.c:v1.05  8/07/99&bslash;n&quot;
suffix:semicolon
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
DECL|macro|sis900_debug
mdefine_line|#define sis900_debug debug
DECL|variable|sis900_debug
r_static
r_int
id|sis900_debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|128
suffix:semicolon
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8             /* More are supported, limit only on options */
DECL|variable|speeds
r_static
r_int
id|speeds
(braket
id|MAX_UNITS
)braket
op_assign
(brace
l_int|100
comma
l_int|100
comma
l_int|100
comma
l_int|100
comma
l_int|100
comma
l_int|100
comma
l_int|100
comma
l_int|100
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
)brace
suffix:semicolon
DECL|macro|TX_BUF_SIZE
mdefine_line|#define TX_BUF_SIZE     1536
DECL|macro|RX_BUF_SIZE
mdefine_line|#define RX_BUF_SIZE     1536
DECL|macro|TX_DMA_BURST
mdefine_line|#define TX_DMA_BURST    0
DECL|macro|RX_DMA_BURST
mdefine_line|#define RX_DMA_BURST    0
DECL|macro|TX_FIFO_THRESH
mdefine_line|#define TX_FIFO_THRESH  16
DECL|macro|TxDRNT_100
mdefine_line|#define TxDRNT_100      (1536&gt;&gt;5)
DECL|macro|TxDRNT_10
mdefine_line|#define TxDRNT_10       16 
DECL|macro|RxDRNT_100
mdefine_line|#define RxDRNT_100      8
DECL|macro|RxDRNT_10
mdefine_line|#define RxDRNT_10       8 
DECL|macro|TRUE
mdefine_line|#define TRUE            1
DECL|macro|FALSE
mdefine_line|#define FALSE           0
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (4*HZ)
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;asm/processor.h&gt;      /* Processor type for cache alignment. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; 0x20123
DECL|macro|test_and_set_bit
mdefine_line|#define test_and_set_bit(val, addr) set_bit(val, addr)
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt;= 0x20139
DECL|macro|net_device_stats
mdefine_line|#define net_device_stats enet_statistics
macro_line|#else
DECL|macro|NETSTATS_VER2
mdefine_line|#define NETSTATS_VER2
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; 0x20155  ||  defined(CARDBUS)
multiline_comment|/* Grrrr, the PCI code changed, but did not consider CardBus... */
macro_line|#include &lt;linux/bios32.h&gt;
DECL|macro|PCI_SUPPORT_VER1
mdefine_line|#define PCI_SUPPORT_VER1
macro_line|#else
DECL|macro|PCI_SUPPORT_VER2
mdefine_line|#define PCI_SUPPORT_VER2
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; 0x20159
DECL|macro|dev_free_skb
mdefine_line|#define dev_free_skb(skb) dev_kfree_skb(skb, FREE_WRITE);
macro_line|#else
DECL|macro|dev_free_skb
mdefine_line|#define dev_free_skb(skb) dev_kfree_skb(skb);
macro_line|#endif
multiline_comment|/* The I/O extent. */
DECL|macro|SIS900_TOTAL_SIZE
mdefine_line|#define SIS900_TOTAL_SIZE 0x100
multiline_comment|/* This table drives the PCI probe routines.  It&squot;s mostly boilerplate in all&n;   of the drivers, and will likely be provided by some future kernel.&n;   Note the matching code -- the first table entry matchs all 56** cards but&n;   second only the 1234 card.&n;*/
DECL|enum|pci_flags_bit
r_enum
id|pci_flags_bit
(brace
DECL|enumerator|PCI_USES_IO
DECL|enumerator|PCI_USES_MEM
DECL|enumerator|PCI_USES_MASTER
id|PCI_USES_IO
op_assign
l_int|1
comma
id|PCI_USES_MEM
op_assign
l_int|2
comma
id|PCI_USES_MASTER
op_assign
l_int|4
comma
)brace
suffix:semicolon
DECL|struct|pci_id_info
r_struct
id|pci_id_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|vendor_id
DECL|member|device_id
DECL|member|device_id_mask
DECL|member|flags
id|u16
id|vendor_id
comma
id|device_id
comma
id|device_id_mask
comma
id|flags
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
DECL|member|probe1
r_struct
id|net_device
op_star
(paren
op_star
id|probe1
)paren
(paren
r_int
id|pci_bus
comma
r_int
id|pci_devfn
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|chip_idx
comma
r_int
id|fnd_cnt
)paren
suffix:semicolon
)brace
suffix:semicolon
r_static
r_struct
id|net_device
op_star
id|sis900_probe1
c_func
(paren
r_int
id|pci_bus
comma
r_int
id|pci_devfn
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|chp_idx
comma
r_int
id|fnd_cnt
)paren
suffix:semicolon
DECL|variable|pci_tbl
r_static
r_struct
id|pci_id_info
id|pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;SiS 900 PCI Fast Ethernet&quot;
comma
l_int|0x1039
comma
l_int|0x0900
comma
l_int|0xffff
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
l_int|0x100
comma
id|sis900_probe1
)brace
comma
(brace
l_string|&quot;SiS 7016 PCI Fast Ethernet&quot;
comma
l_int|0x1039
comma
l_int|0x7016
comma
l_int|0xffff
comma
id|PCI_USES_IO
op_or
id|PCI_USES_MASTER
comma
l_int|0x100
comma
id|sis900_probe1
)brace
comma
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* 0 terminated list. */
)brace
suffix:semicolon
multiline_comment|/* The capability table matches the chip table above. */
DECL|enumerator|HAS_MII_XCVR
DECL|enumerator|HAS_CHIP_XCVR
DECL|enumerator|HAS_LNK_CHNG
r_enum
(brace
id|HAS_MII_XCVR
op_assign
l_int|0x01
comma
id|HAS_CHIP_XCVR
op_assign
l_int|0x02
comma
id|HAS_LNK_CHNG
op_assign
l_int|0x04
)brace
suffix:semicolon
DECL|variable|sis_cap_tbl
r_static
r_int
id|sis_cap_tbl
(braket
)braket
op_assign
(brace
id|HAS_MII_XCVR
op_or
id|HAS_CHIP_XCVR
op_or
id|HAS_LNK_CHNG
comma
id|HAS_MII_XCVR
op_or
id|HAS_CHIP_XCVR
op_or
id|HAS_LNK_CHNG
comma
)brace
suffix:semicolon
multiline_comment|/* The rest of these values should never change. */
DECL|macro|NUM_TX_DESC
mdefine_line|#define NUM_TX_DESC     16      /* Number of Tx descriptor registers. */
DECL|macro|NUM_RX_DESC
mdefine_line|#define NUM_RX_DESC     8       /* Number of Rx descriptor registers. */
multiline_comment|/* Symbolic offsets to registers. */
DECL|enum|SIS900_registers
r_enum
id|SIS900_registers
(brace
DECL|enumerator|cr
id|cr
op_assign
l_int|0x0
comma
singleline_comment|//Command Register
DECL|enumerator|cfg
id|cfg
op_assign
l_int|0x4
comma
singleline_comment|//Configuration Register
DECL|enumerator|mear
id|mear
op_assign
l_int|0x8
comma
singleline_comment|//EEPROM Access Register
DECL|enumerator|ptscr
id|ptscr
op_assign
l_int|0xc
comma
singleline_comment|//PCI Test Control Register
DECL|enumerator|isr
id|isr
op_assign
l_int|0x10
comma
singleline_comment|//Interrupt Status Register
DECL|enumerator|imr
id|imr
op_assign
l_int|0x14
comma
singleline_comment|//Interrupt Mask Register
DECL|enumerator|ier
id|ier
op_assign
l_int|0x18
comma
singleline_comment|//Interrupt Enable Register
DECL|enumerator|epar
id|epar
op_assign
l_int|0x18
comma
singleline_comment|//Enhanced PHY Access Register
DECL|enumerator|txdp
id|txdp
op_assign
l_int|0x20
comma
singleline_comment|//Transmit Descriptor Pointer Register
DECL|enumerator|txcfg
id|txcfg
op_assign
l_int|0x24
comma
singleline_comment|//Transmit Configuration Register
DECL|enumerator|rxdp
id|rxdp
op_assign
l_int|0x30
comma
singleline_comment|//Receive Descriptor Pointer Register
DECL|enumerator|rxcfg
id|rxcfg
op_assign
l_int|0x34
comma
singleline_comment|//Receive Configuration Register
DECL|enumerator|flctrl
id|flctrl
op_assign
l_int|0x38
comma
singleline_comment|//Flow Control Register
DECL|enumerator|rxlen
id|rxlen
op_assign
l_int|0x3c
comma
singleline_comment|//Receive Packet Length Register
DECL|enumerator|rfcr
id|rfcr
op_assign
l_int|0x48
comma
singleline_comment|//Receive Filter Control Register
DECL|enumerator|rfdr
id|rfdr
op_assign
l_int|0x4C
comma
singleline_comment|//Receive Filter Data Register
DECL|enumerator|pmctrl
id|pmctrl
op_assign
l_int|0xB0
comma
singleline_comment|//Power Management Control Register
DECL|enumerator|pmer
id|pmer
op_assign
l_int|0xB4
singleline_comment|//Power Management Wake-up Event Register
)brace
suffix:semicolon
DECL|macro|RESET
mdefine_line|#define RESET           0x00000100
DECL|macro|SWI
mdefine_line|#define SWI             0x00000080
DECL|macro|RxRESET
mdefine_line|#define RxRESET         0x00000020
DECL|macro|TxRESET
mdefine_line|#define TxRESET         0x00000010
DECL|macro|RxDIS
mdefine_line|#define RxDIS           0x00000008
DECL|macro|RxENA
mdefine_line|#define RxENA           0x00000004
DECL|macro|TxDIS
mdefine_line|#define TxDIS           0x00000002
DECL|macro|TxENA
mdefine_line|#define TxENA           0x00000001
DECL|macro|BISE
mdefine_line|#define BISE            0x80000000
DECL|macro|EUPHCOM
mdefine_line|#define EUPHCOM         0x00000100
DECL|macro|REQALG
mdefine_line|#define REQALG          0x00000080
DECL|macro|SB
mdefine_line|#define SB              0x00000040
DECL|macro|POW
mdefine_line|#define POW             0x00000020
DECL|macro|EXD
mdefine_line|#define EXD             0x00000010
DECL|macro|PESEL
mdefine_line|#define PESEL           0x00000008
DECL|macro|LPM
mdefine_line|#define LPM             0x00000004
DECL|macro|BEM
mdefine_line|#define BEM             0x00000001
multiline_comment|/* Interrupt register bits, using my own meaningful names. */
DECL|macro|WKEVT
mdefine_line|#define WKEVT           0x10000000
DECL|macro|TxPAUSEEND
mdefine_line|#define TxPAUSEEND      0x08000000
DECL|macro|TxPAUSE
mdefine_line|#define TxPAUSE         0x04000000
DECL|macro|TxRCMP
mdefine_line|#define TxRCMP          0x02000000
DECL|macro|RxRCMP
mdefine_line|#define RxRCMP          0x01000000
DECL|macro|DPERR
mdefine_line|#define DPERR           0x00800000
DECL|macro|SSERR
mdefine_line|#define SSERR           0x00400000
DECL|macro|RMABT
mdefine_line|#define RMABT           0x00200000
DECL|macro|RTABT
mdefine_line|#define RTABT           0x00100000
DECL|macro|RxSOVR
mdefine_line|#define RxSOVR          0x00010000
DECL|macro|HIBERR
mdefine_line|#define HIBERR          0x00008000
DECL|macro|SWINT
mdefine_line|#define SWINT           0x00001000
DECL|macro|MIBINT
mdefine_line|#define MIBINT          0x00000800
DECL|macro|TxURN
mdefine_line|#define TxURN           0x00000400
DECL|macro|TxIDLE
mdefine_line|#define TxIDLE          0x00000200
DECL|macro|TxERR
mdefine_line|#define TxERR           0x00000100
DECL|macro|TxDESC
mdefine_line|#define TxDESC          0x00000080
DECL|macro|TxOK
mdefine_line|#define TxOK            0x00000040
DECL|macro|RxORN
mdefine_line|#define RxORN           0x00000020
DECL|macro|RxIDLE
mdefine_line|#define RxIDLE          0x00000010
DECL|macro|RxEARLY
mdefine_line|#define RxEARLY         0x00000008
DECL|macro|RxERR
mdefine_line|#define RxERR           0x00000004
DECL|macro|RxDESC
mdefine_line|#define RxDESC          0x00000002
DECL|macro|RxOK
mdefine_line|#define RxOK            0x00000001
DECL|macro|IE
mdefine_line|#define IE              0x00000001
DECL|macro|TxCSI
mdefine_line|#define TxCSI           0x80000000
DECL|macro|TxHBI
mdefine_line|#define TxHBI           0x40000000
DECL|macro|TxMLB
mdefine_line|#define TxMLB           0x20000000
DECL|macro|TxATP
mdefine_line|#define TxATP           0x10000000
DECL|macro|TxIFG
mdefine_line|#define TxIFG           0x0C000000
DECL|macro|TxMXF
mdefine_line|#define TxMXF           0x03800000
DECL|macro|TxMXF_shift
mdefine_line|#define TxMXF_shift     0x23
DECL|macro|TxMXDMA
mdefine_line|#define TxMXDMA         0x00700000
DECL|macro|TxMXDMA_shift
mdefine_line|#define TxMXDMA_shift   20
DECL|macro|TxRTCNT
mdefine_line|#define TxRTCNT         0x000F0000
DECL|macro|TxRTCNT_shift
mdefine_line|#define TxRTCNT_shift   16
DECL|macro|TxFILLT
mdefine_line|#define TxFILLT         0x00007F00
DECL|macro|TxFILLT_shift
mdefine_line|#define TxFILLT_shift   8
DECL|macro|TxDRNT
mdefine_line|#define TxDRNT          0x0000007F
DECL|macro|RxAEP
mdefine_line|#define RxAEP           0x80000000
DECL|macro|RxARP
mdefine_line|#define RxARP           0x40000000
DECL|macro|RxATP
mdefine_line|#define RxATP           0x10000000
DECL|macro|RxAJAB
mdefine_line|#define RxAJAB          0x08000000
DECL|macro|RxMXF
mdefine_line|#define RxMXF           0x03800000
DECL|macro|RxMXF_shift
mdefine_line|#define RxMXF_shift     23
DECL|macro|RxMXDMA
mdefine_line|#define RxMXDMA         0x00700000
DECL|macro|RxMXDMA_shift
mdefine_line|#define RxMXDMA_shift   20
DECL|macro|RxDRNT
mdefine_line|#define RxDRNT          0x0000007F
DECL|macro|RFEN
mdefine_line|#define RFEN            0x80000000
DECL|macro|RFAAB
mdefine_line|#define RFAAB           0x40000000
DECL|macro|RFAAM
mdefine_line|#define RFAAM           0x20000000
DECL|macro|RFAAP
mdefine_line|#define RFAAP           0x10000000
DECL|macro|RFPromiscuous
mdefine_line|#define RFPromiscuous   (RFAAB|RFAAM|RFAAP)
DECL|macro|RFAA_shift
mdefine_line|#define RFAA_shift      28
DECL|macro|RFEP
mdefine_line|#define RFEP            0x00070000
DECL|macro|RFEP_shift
mdefine_line|#define RFEP_shift      16
DECL|macro|RFDAT
mdefine_line|#define RFDAT           0x0000FFFF
DECL|macro|OWN
mdefine_line|#define OWN             0x80000000
DECL|macro|MORE
mdefine_line|#define MORE            0x40000000
DECL|macro|INTR
mdefine_line|#define INTR            0x20000000
DECL|macro|OK
mdefine_line|#define OK              0x08000000
DECL|macro|DSIZE
mdefine_line|#define DSIZE           0x00000FFF
DECL|macro|SUPCRC
mdefine_line|#define SUPCRC          0x10000000
DECL|macro|ABORT
mdefine_line|#define ABORT           0x04000000
DECL|macro|UNDERRUN
mdefine_line|#define UNDERRUN        0x02000000
DECL|macro|NOCARRIER
mdefine_line|#define NOCARRIER       0x01000000
DECL|macro|DEFERD
mdefine_line|#define DEFERD          0x00800000
DECL|macro|EXCDEFER
mdefine_line|#define EXCDEFER        0x00400000
DECL|macro|OWCOLL
mdefine_line|#define OWCOLL          0x00200000
DECL|macro|EXCCOLL
mdefine_line|#define EXCCOLL         0x00100000
DECL|macro|COLCNT
mdefine_line|#define COLCNT          0x000F0000
DECL|macro|INCCRC
mdefine_line|#define INCCRC          0x10000000
singleline_comment|//      ABORT           0x04000000
DECL|macro|OVERRUN
mdefine_line|#define OVERRUN         0x02000000
DECL|macro|DEST
mdefine_line|#define DEST            0x01800000
DECL|macro|BCAST
mdefine_line|#define BCAST           0x01800000
DECL|macro|MCAST
mdefine_line|#define MCAST           0x01000000
DECL|macro|UNIMATCH
mdefine_line|#define UNIMATCH        0x00800000
DECL|macro|TOOLONG
mdefine_line|#define TOOLONG         0x00400000
DECL|macro|RUNT
mdefine_line|#define RUNT            0x00200000
DECL|macro|RXISERR
mdefine_line|#define RXISERR         0x00100000
DECL|macro|CRCERR
mdefine_line|#define CRCERR          0x00080000
DECL|macro|FAERR
mdefine_line|#define FAERR           0x00040000
DECL|macro|LOOPBK
mdefine_line|#define LOOPBK          0x00020000
DECL|macro|RXCOL
mdefine_line|#define RXCOL           0x00010000
DECL|macro|EuphLiteEEMACAddr
mdefine_line|#define EuphLiteEEMACAddr               0x08
DECL|macro|EuphLiteEEVendorID
mdefine_line|#define EuphLiteEEVendorID              0x02
DECL|macro|EuphLiteEEDeviceID
mdefine_line|#define EuphLiteEEDeviceID              0x03
DECL|macro|EuphLiteEECardTypeRev
mdefine_line|#define EuphLiteEECardTypeRev           0x0b
DECL|macro|EuphLiteEEPlexusRev
mdefine_line|#define EuphLiteEEPlexusRev             0x0c
DECL|macro|EuphLiteEEChecksum
mdefine_line|#define EuphLiteEEChecksum              0x0f
DECL|macro|RXSTS_shift
mdefine_line|#define RXSTS_shift     18
DECL|macro|OWN
mdefine_line|#define OWN             0x80000000
DECL|macro|MORE
mdefine_line|#define MORE            0x40000000
DECL|macro|INTR
mdefine_line|#define INTR            0x20000000
DECL|macro|OK
mdefine_line|#define OK              0x08000000
DECL|macro|DSIZE
mdefine_line|#define DSIZE           0x00000FFF
multiline_comment|/* MII register offsets */
DECL|macro|MII_CONTROL
mdefine_line|#define MII_CONTROL             0x0000
DECL|macro|MII_STATUS
mdefine_line|#define MII_STATUS              0x0001
DECL|macro|MII_PHY_ID0
mdefine_line|#define MII_PHY_ID0             0x0002
DECL|macro|MII_PHY_ID1
mdefine_line|#define MII_PHY_ID1             0x0003
DECL|macro|MII_ANAR
mdefine_line|#define MII_ANAR                0x0004
DECL|macro|MII_ANLPAR
mdefine_line|#define MII_ANLPAR              0x0005
DECL|macro|MII_ANER
mdefine_line|#define MII_ANER                0x0006
multiline_comment|/* MII Control register bit definitions. */
DECL|macro|MIICNTL_FDX
mdefine_line|#define MIICNTL_FDX             0x0100
DECL|macro|MIICNTL_RST_AUTO
mdefine_line|#define MIICNTL_RST_AUTO        0x0200
DECL|macro|MIICNTL_ISOLATE
mdefine_line|#define MIICNTL_ISOLATE         0x0400
DECL|macro|MIICNTL_PWRDWN
mdefine_line|#define MIICNTL_PWRDWN          0x0800
DECL|macro|MIICNTL_AUTO
mdefine_line|#define MIICNTL_AUTO            0x1000
DECL|macro|MIICNTL_SPEED
mdefine_line|#define MIICNTL_SPEED           0x2000
DECL|macro|MIICNTL_LPBK
mdefine_line|#define MIICNTL_LPBK            0x4000
DECL|macro|MIICNTL_RESET
mdefine_line|#define MIICNTL_RESET           0x8000
multiline_comment|/* MII Status register bit significance. */
DECL|macro|MIISTAT_EXT
mdefine_line|#define MIISTAT_EXT             0x0001
DECL|macro|MIISTAT_JAB
mdefine_line|#define MIISTAT_JAB             0x0002
DECL|macro|MIISTAT_LINK
mdefine_line|#define MIISTAT_LINK            0x0004
DECL|macro|MIISTAT_CAN_AUTO
mdefine_line|#define MIISTAT_CAN_AUTO        0x0008
DECL|macro|MIISTAT_FAULT
mdefine_line|#define MIISTAT_FAULT           0x0010
DECL|macro|MIISTAT_AUTO_DONE
mdefine_line|#define MIISTAT_AUTO_DONE       0x0020
DECL|macro|MIISTAT_CAN_T
mdefine_line|#define MIISTAT_CAN_T           0x0800
DECL|macro|MIISTAT_CAN_T_FDX
mdefine_line|#define MIISTAT_CAN_T_FDX       0x1000
DECL|macro|MIISTAT_CAN_TX
mdefine_line|#define MIISTAT_CAN_TX          0x2000
DECL|macro|MIISTAT_CAN_TX_FDX
mdefine_line|#define MIISTAT_CAN_TX_FDX      0x4000
DECL|macro|MIISTAT_CAN_T4
mdefine_line|#define MIISTAT_CAN_T4          0x8000
multiline_comment|/* MII NWAY Register Bits ...&n;** valid for the ANAR (Auto-Negotiation Advertisement) and&n;** ANLPAR (Auto-Negotiation Link Partner) registers */
DECL|macro|MII_NWAY_NODE_SEL
mdefine_line|#define MII_NWAY_NODE_SEL       0x001f
DECL|macro|MII_NWAY_CSMA_CD
mdefine_line|#define MII_NWAY_CSMA_CD        0x0001
DECL|macro|MII_NWAY_T
mdefine_line|#define MII_NWAY_T              0x0020
DECL|macro|MII_NWAY_T_FDX
mdefine_line|#define MII_NWAY_T_FDX          0x0040
DECL|macro|MII_NWAY_TX
mdefine_line|#define MII_NWAY_TX             0x0080
DECL|macro|MII_NWAY_TX_FDX
mdefine_line|#define MII_NWAY_TX_FDX         0x0100
DECL|macro|MII_NWAY_T4
mdefine_line|#define MII_NWAY_T4             0x0200
DECL|macro|MII_NWAY_RF
mdefine_line|#define MII_NWAY_RF             0x2000
DECL|macro|MII_NWAY_ACK
mdefine_line|#define MII_NWAY_ACK            0x4000
DECL|macro|MII_NWAY_NP
mdefine_line|#define MII_NWAY_NP             0x8000
multiline_comment|/* MII Auto-Negotiation Expansion Register Bits */
DECL|macro|MII_ANER_PDF
mdefine_line|#define MII_ANER_PDF            0x0010
DECL|macro|MII_ANER_LP_NP_ABLE
mdefine_line|#define MII_ANER_LP_NP_ABLE     0x0008
DECL|macro|MII_ANER_NP_ABLE
mdefine_line|#define MII_ANER_NP_ABLE        0x0004
DECL|macro|MII_ANER_RX_PAGE
mdefine_line|#define MII_ANER_RX_PAGE        0x0002
DECL|macro|MII_ANER_LP_AN_ABLE
mdefine_line|#define MII_ANER_LP_AN_ABLE     0x0001
DECL|macro|HALF_DUPLEX
mdefine_line|#define HALF_DUPLEX                     1
DECL|macro|FDX_CAPABLE_DUPLEX_UNKNOWN
mdefine_line|#define FDX_CAPABLE_DUPLEX_UNKNOWN      2
DECL|macro|FDX_CAPABLE_HALF_SELECTED
mdefine_line|#define FDX_CAPABLE_HALF_SELECTED       3
DECL|macro|FDX_CAPABLE_FULL_SELECTED
mdefine_line|#define FDX_CAPABLE_FULL_SELECTED       4
DECL|macro|HW_SPEED_UNCONFIG
mdefine_line|#define HW_SPEED_UNCONFIG       0
DECL|macro|HW_SPEED_10_MBPS
mdefine_line|#define HW_SPEED_10_MBPS        10
DECL|macro|HW_SPEED_100_MBPS
mdefine_line|#define HW_SPEED_100_MBPS       100
DECL|macro|HW_SPEED_DEFAULT
mdefine_line|#define HW_SPEED_DEFAULT        (HW_SPEED_10_MBPS)
DECL|macro|ACCEPT_ALL_PHYS
mdefine_line|#define ACCEPT_ALL_PHYS         0x01
DECL|macro|ACCEPT_ALL_MCASTS
mdefine_line|#define ACCEPT_ALL_MCASTS       0x02
DECL|macro|ACCEPT_ALL_BCASTS
mdefine_line|#define ACCEPT_ALL_BCASTS       0x04
DECL|macro|ACCEPT_ALL_ERRORS
mdefine_line|#define ACCEPT_ALL_ERRORS       0x08
DECL|macro|ACCEPT_CAM_QUALIFIED
mdefine_line|#define ACCEPT_CAM_QUALIFIED    0x10
DECL|macro|MAC_LOOPBACK
mdefine_line|#define MAC_LOOPBACK            0x20
singleline_comment|//#define FDX_CAPABLE_FULL_SELECTED     4
DECL|macro|CRC_SIZE
mdefine_line|#define CRC_SIZE                4
DECL|macro|MAC_HEADER_SIZE
mdefine_line|#define MAC_HEADER_SIZE         14
DECL|struct|_EuphLiteDesc
r_typedef
r_struct
id|_EuphLiteDesc
(brace
DECL|member|llink
id|u32
id|llink
suffix:semicolon
DECL|member|buf
r_int
r_char
op_star
id|buf
suffix:semicolon
DECL|member|physAddr
id|u32
id|physAddr
suffix:semicolon
multiline_comment|/* Hardware sees the physical address of descriptor */
DECL|member|plink
id|u32
id|plink
suffix:semicolon
DECL|member|cmdsts
id|u32
id|cmdsts
suffix:semicolon
DECL|member|bufPhys
id|u32
id|bufPhys
suffix:semicolon
DECL|typedef|EuphLiteDesc
)brace
id|EuphLiteDesc
suffix:semicolon
DECL|struct|sis900_private
r_struct
id|sis900_private
(brace
DECL|member|devname
r_char
id|devname
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Used only for kernel debugging. */
DECL|member|product_name
r_const
r_char
op_star
id|product_name
suffix:semicolon
DECL|member|next_module
r_struct
id|net_device
op_star
id|next_module
suffix:semicolon
DECL|member|chip_id
r_int
id|chip_id
suffix:semicolon
DECL|member|chip_revision
r_int
id|chip_revision
suffix:semicolon
DECL|member|pci_bus
DECL|member|pci_devfn
r_int
r_char
id|pci_bus
comma
id|pci_devfn
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; 0x20139
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
macro_line|#else
DECL|member|stats
r_struct
id|enet_statistics
id|stats
suffix:semicolon
macro_line|#endif
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Media selection timer. */
DECL|member|cur_rx
r_int
r_int
id|cur_rx
suffix:semicolon
multiline_comment|/* Index into the Rx buffer of next Rx pkt. */
DECL|member|cur_tx
DECL|member|dirty_tx
DECL|member|tx_flag
r_int
r_int
id|cur_tx
comma
id|dirty_tx
comma
id|tx_flag
suffix:semicolon
multiline_comment|/* The saved address of a sent-in-place packet/buffer, for skfree(). */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
DECL|member|tx_buf
id|EuphLiteDesc
id|tx_buf
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
multiline_comment|/* Tx bounce buffers */
DECL|member|rx_buf
id|EuphLiteDesc
id|rx_buf
(braket
id|NUM_RX_DESC
)braket
suffix:semicolon
DECL|member|rx_bufs
r_int
r_char
op_star
id|rx_bufs
suffix:semicolon
DECL|member|tx_bufs
r_int
r_char
op_star
id|tx_bufs
suffix:semicolon
multiline_comment|/* Tx bounce buffer region. */
DECL|member|phys
r_char
id|phys
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* MII device addresses.    */
DECL|member|phy_idx
r_int
id|phy_idx
suffix:semicolon
multiline_comment|/* Support Max 4 PHY        */
DECL|member|pmd_status
id|u16
id|pmd_status
suffix:semicolon
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:semicolon
multiline_comment|/* The Tx queue is full.    */
DECL|member|MediaSpeed
r_int
id|MediaSpeed
suffix:semicolon
multiline_comment|/* user force speed         */
DECL|member|MediaDuplex
r_int
id|MediaDuplex
suffix:semicolon
multiline_comment|/* user force duplex        */
DECL|member|full_duplex
r_int
id|full_duplex
suffix:semicolon
multiline_comment|/* Full/Half-duplex.        */
DECL|member|speeds
r_int
id|speeds
suffix:semicolon
multiline_comment|/* 100/10 Mbps.             */
DECL|member|LinkOn
id|u16
id|LinkOn
suffix:semicolon
DECL|member|LinkChange
id|u16
id|LinkChange
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef MODULE
macro_line|#if LINUX_VERSION_CODE &gt; 0x20115
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jim Huang &lt;cmhuang@sis.com.tw&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 900 PCI Fast Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|speeds
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_static
r_int
id|sis900_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|u16
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_void
id|sis900_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|sis900_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sis900_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sis900_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|sis900_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_struct
id|enet_statistics
op_star
id|sis900_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|u16
id|elAutoNegotiate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
op_star
id|duplex
comma
r_int
op_star
id|speed
)paren
suffix:semicolon
r_static
r_void
id|elSetCapability
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|duplex
comma
r_int
id|speed
)paren
suffix:semicolon
r_static
id|u16
id|elPMDreadMode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
op_star
id|speed
comma
r_int
op_star
id|duplex
)paren
suffix:semicolon
r_static
id|u16
id|elMIIpollBit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
id|u16
id|mask
comma
id|u16
id|polarity
comma
id|u16
op_star
id|value
)paren
suffix:semicolon
r_static
r_void
id|elSetMediaType
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|speed
comma
r_int
id|duplex
)paren
suffix:semicolon
multiline_comment|/* A list of all installed SiS900 devices, for removing the driver module. */
DECL|variable|root_sis900_dev
r_static
r_struct
id|net_device
op_star
id|root_sis900_dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Ideally we would detect all network cards in slot order.  That would&n;   be best done a central PCI probe dispatch, which wouldn&squot;t work&n;   well when dynamically adding drivers.  So instead we detect just the&n;   SiS 900 cards in slot order. */
DECL|function|sis900_probe
r_int
id|sis900_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|cards_found
op_assign
l_int|0
suffix:semicolon
r_int
id|pci_index
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|pci_bus
comma
id|pci_device_fn
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcibios_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|pci_index
OL
l_int|0xff
suffix:semicolon
id|pci_index
op_increment
)paren
(brace
id|u16
id|vendor
comma
id|device
comma
id|pci_command
comma
id|new_command
suffix:semicolon
r_int
id|chip_idx
comma
id|irq
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
id|pcibios_find_class
(paren
id|PCI_CLASS_NETWORK_ETHERNET
op_lshift
l_int|8
comma
id|pci_index
comma
op_amp
id|pci_bus
comma
op_amp
id|pci_device_fn
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
(brace
r_break
suffix:semicolon
)brace
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_VENDOR_ID
comma
op_amp
id|vendor
)paren
suffix:semicolon
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_DEVICE_ID
comma
op_amp
id|device
)paren
suffix:semicolon
r_for
c_loop
(paren
id|chip_idx
op_assign
l_int|0
suffix:semicolon
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|vendor_id
suffix:semicolon
id|chip_idx
op_increment
)paren
r_if
c_cond
(paren
id|vendor
op_eq
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|vendor_id
op_logical_and
(paren
id|device
op_amp
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|device_id_mask
)paren
op_eq
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|device_id
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|vendor_id
op_eq
l_int|0
)paren
multiline_comment|/* Compiled out! */
r_continue
suffix:semicolon
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|pci_find_slot
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
)paren
suffix:semicolon
id|ioaddr
op_assign
id|pdev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
id|PCI_USES_IO
)paren
op_logical_and
id|check_region
c_func
(paren
id|ioaddr
comma
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* Activate the card: fix for brain-damaged Win98 BIOSes. */
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
id|new_command
op_assign
id|pci_command
op_or
(paren
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_command
op_ne
id|new_command
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  The PCI BIOS has not enabled the&quot;
l_string|&quot; device at %d/%d!&quot;
l_string|&quot;Updating PCI command %4.4x-&gt;%4.4x.&bslash;n&quot;
comma
id|pci_bus
comma
id|pci_device_fn
comma
id|pci_command
comma
id|new_command
)paren
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
id|new_command
)paren
suffix:semicolon
)brace
id|dev
op_assign
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|probe1
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|dev
comma
id|ioaddr
comma
id|irq
comma
id|chip_idx
comma
id|cards_found
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
(paren
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
id|PCI_COMMAND_MASTER
)paren
)paren
(brace
id|u8
id|pci_latency
suffix:semicolon
id|pcibios_read_config_byte
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|pci_latency
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_latency
OL
l_int|32
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;  PCI latency timer (CFLT) is &quot;
l_string|&quot;unreasonably low at %d.  Setting to 64 clocks.&bslash;n&quot;
comma
id|pci_latency
)paren
suffix:semicolon
id|pcibios_write_config_byte
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_LATENCY_TIMER
comma
l_int|64
)paren
suffix:semicolon
)brace
)brace
id|dev
op_assign
l_int|0
suffix:semicolon
id|cards_found
op_increment
suffix:semicolon
)brace
r_return
id|cards_found
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|sis900_probe1
r_static
r_struct
id|net_device
op_star
id|sis900_probe1
c_func
(paren
r_int
id|pci_bus
comma
r_int
id|pci_devfn
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|chip_idx
comma
r_int
id|found_cnt
)paren
(brace
r_static
r_int
id|did_version
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Already printed version info. */
r_struct
id|sis900_private
op_star
id|tp
suffix:semicolon
id|u16
id|status
suffix:semicolon
r_int
id|duplex
op_assign
id|found_cnt
OL
id|MAX_UNITS
ques
c_cond
id|full_duplex
(braket
id|found_cnt
)braket
suffix:colon
l_int|0
suffix:semicolon
r_int
id|speed
op_assign
id|found_cnt
OL
id|MAX_UNITS
ques
c_cond
id|speeds
(braket
id|found_cnt
)braket
suffix:colon
l_int|0
suffix:semicolon
r_int
id|phy
op_assign
l_int|0
comma
id|phy_idx
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|did_version
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|dev
op_assign
id|init_etherdev
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at %#lx, IRQ %d, &quot;
comma
id|dev-&gt;name
comma
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|name
comma
id|ioaddr
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u16
)paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|EuphLiteEEVendorID
)paren
op_ne
l_int|0xffff
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
op_plus
id|EuphLiteEEMACAddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
(paren
id|u8
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x.&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Error EEPROM read&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* We do a request_region() to register /proc/ioports info. */
id|request_region
c_func
(paren
id|ioaddr
comma
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* Some data structures must be quadword aligned. */
id|tp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|tp
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp
op_eq
l_int|NULL
)paren
(brace
id|release_region
c_func
(paren
id|ioaddr
comma
id|pci_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|tp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|tp
suffix:semicolon
id|tp-&gt;next_module
op_assign
id|root_sis900_dev
suffix:semicolon
id|root_sis900_dev
op_assign
id|dev
suffix:semicolon
id|tp-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
id|tp-&gt;pci_bus
op_assign
id|pci_bus
suffix:semicolon
id|tp-&gt;pci_devfn
op_assign
id|pci_devfn
suffix:semicolon
multiline_comment|/* Find the connected MII xcvrs.&n;           Doing this in open() would allow detecting external xcvrs later, but&n;           takes too much time. */
r_if
c_cond
(paren
id|sis_cap_tbl
(braket
id|chip_idx
)braket
op_amp
id|HAS_MII_XCVR
)paren
(brace
r_for
c_loop
(paren
id|phy
op_assign
l_int|0
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|tp-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
suffix:semicolon
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|tp-&gt;phy_idx
op_assign
id|phy_idx
suffix:semicolon
id|tp-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|tp-&gt;pmd_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_STATUS
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII transceiver found &quot;
l_string|&quot;at address %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No MII transceivers found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|tp-&gt;pmd_status
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|tp-&gt;pmd_status
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;pmd_status
OG
l_int|0
)paren
op_logical_and
(paren
id|phy_idx
OG
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;duplex=%d, speed=%d&bslash;n&quot;
comma
id|duplex
comma
id|speed
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|duplex
op_logical_and
op_logical_neg
id|speed
)paren
(brace
singleline_comment|// auto-config media type
singleline_comment|// Set full capability
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Auto Config ...&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|elSetCapability
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
l_int|1
comma
l_int|100
)paren
suffix:semicolon
id|tp-&gt;pmd_status
op_assign
id|elAutoNegotiate
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
op_amp
id|tp-&gt;full_duplex
comma
op_amp
id|tp-&gt;speeds
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;MediaSpeed
op_assign
id|speed
suffix:semicolon
id|tp-&gt;MediaDuplex
op_assign
id|duplex
suffix:semicolon
id|elSetCapability
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
id|duplex
comma
id|speed
)paren
suffix:semicolon
id|elAutoNegotiate
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
op_amp
id|tp-&gt;full_duplex
comma
op_amp
id|tp-&gt;speeds
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_ANLPAR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|MII_NWAY_T
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
)paren
)paren
)paren
(brace
id|u16
id|cmd
op_assign
l_int|0
suffix:semicolon
id|cmd
op_or_assign
(paren
id|speed
op_eq
l_int|100
ques
c_cond
id|MIICNTL_SPEED
suffix:colon
l_int|0
)paren
suffix:semicolon
id|cmd
op_or_assign
(paren
id|duplex
ques
c_cond
id|MIICNTL_FDX
suffix:colon
l_int|0
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_CONTROL
comma
id|cmd
)paren
suffix:semicolon
id|elSetMediaType
c_func
(paren
id|dev
comma
id|speed
op_eq
l_int|100
ques
c_cond
id|HW_SPEED_100_MBPS
suffix:colon
id|HW_SPEED_10_MBPS
comma
id|duplex
ques
c_cond
id|FDX_CAPABLE_FULL_SELECTED
suffix:colon
id|FDX_CAPABLE_HALF_SELECTED
)paren
suffix:semicolon
id|elMIIpollBit
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_STATUS
comma
id|MIISTAT_LINK
comma
id|TRUE
comma
op_amp
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_STATUS
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tp-&gt;pmd_status
op_amp
id|MIISTAT_LINK
)paren
id|tp-&gt;LinkOn
op_assign
id|TRUE
suffix:semicolon
r_else
id|tp-&gt;LinkOn
op_assign
id|FALSE
suffix:semicolon
id|tp-&gt;LinkChange
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;full_duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media type is Full Duplex.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media type is Half Duplex.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;speeds
op_eq
id|HW_SPEED_100_MBPS
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Speed is 100mbps.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Speed is 10mbps.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The SiS900-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|sis900_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|sis900_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|sis900_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|sis900_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
multiline_comment|/* Serial EEPROM section. */
multiline_comment|/*  EEPROM_Ctrl bits. */
DECL|macro|EECLK
mdefine_line|#define EECLK           0x00000004      /* EEPROM shift clock. */
DECL|macro|EECS
mdefine_line|#define EECS            0x00000008      /* EEPROM chip select. */
DECL|macro|EEDO
mdefine_line|#define EEDO            0x00000002      /* EEPROM chip data out. */
DECL|macro|EEDI
mdefine_line|#define EEDI            0x00000001      /* EEPROM chip data in. */
multiline_comment|/* Delay between EEPROM clock transitions.&n;   No extra delay is needed with 33Mhz PCI, but 66Mhz may change this.&n; */
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay()  inl(ee_addr)
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|macro|EEread
mdefine_line|#define EEread          0x0180
DECL|macro|EEwrite
mdefine_line|#define EEwrite         0x0140
DECL|macro|EEerase
mdefine_line|#define EEerase         0x01C0
DECL|macro|EEwriteEnable
mdefine_line|#define EEwriteEnable   0x0130
DECL|macro|EEwriteDisable
mdefine_line|#define EEwriteDisable  0x0100
DECL|macro|EEeraseAll
mdefine_line|#define EEeraseAll      0x0120
DECL|macro|EEwriteAll
mdefine_line|#define EEwriteAll      0x0110
DECL|macro|EEaddrMask
mdefine_line|#define EEaddrMask      0x013F
DECL|macro|EEcmdShift
mdefine_line|#define EEcmdShift      16
DECL|function|read_eeprom
r_static
id|u16
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
id|u16
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr
op_assign
id|ioaddr
op_plus
id|mear
suffix:semicolon
id|u32
id|read_cmd
op_assign
id|location
op_or
id|EEread
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|u32
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EEDI
op_or
id|EECS
suffix:colon
id|EECS
suffix:semicolon
id|outl
c_func
(paren
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dataval
op_or
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|EECS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|EECS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EECS
op_or
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EEDO
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|outl
c_func
(paren
l_int|0
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
r_return
(paren
id|retval
)paren
suffix:semicolon
)brace
multiline_comment|/* MII serial management: mostly bogus for now. */
multiline_comment|/* Read and write the MII management registers using software-generated&n;   serial MDIO protocol.&n;   The maximum data clock rate is 2.5 Mhz.  The minimum timing is usually&n;   met by back-to-back PCI I/O cycles, but we insert a delay to avoid&n;   &quot;overclocking&quot; issues. */
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay()    inl(mdio_addr)
DECL|macro|MIIread
mdefine_line|#define MIIread         0x6000
DECL|macro|MIIwrite
mdefine_line|#define MIIwrite        0x6002
DECL|macro|MIIpmdMask
mdefine_line|#define MIIpmdMask      0x0F80
DECL|macro|MIIpmdShift
mdefine_line|#define MIIpmdShift     7
DECL|macro|MIIregMask
mdefine_line|#define MIIregMask      0x007C
DECL|macro|MIIregShift
mdefine_line|#define MIIregShift     2
DECL|macro|MIIturnaroundBits
mdefine_line|#define MIIturnaroundBits       2
DECL|macro|MIIcmdLen
mdefine_line|#define MIIcmdLen       16
DECL|macro|MIIcmdShift
mdefine_line|#define MIIcmdShift     16
DECL|macro|MIIreset
mdefine_line|#define MIIreset        0xFFFFFFFF
DECL|macro|MIIwrLen
mdefine_line|#define MIIwrLen        32
DECL|macro|MDC
mdefine_line|#define MDC             0x00000040
DECL|macro|MDDIR
mdefine_line|#define MDDIR           0x00000020
DECL|macro|MDIO
mdefine_line|#define MDIO            0x00000010
DECL|function|mdio_idle
r_static
r_void
id|mdio_idle
c_func
(paren
r_int
id|mdio_addr
)paren
(brace
id|outl
c_func
(paren
id|MDIO
op_or
id|MDDIR
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO
op_or
id|MDDIR
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Syncronize the MII management interface by shifting 32 one bits out. */
DECL|function|mdio_reset
r_static
r_void
id|mdio_reset
c_func
(paren
r_int
id|mdio_addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDDIR
op_or
id|MDIO
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDDIR
op_or
id|MDIO
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|mear
suffix:semicolon
r_int
id|mii_cmd
op_assign
id|MIIread
op_or
(paren
id|phy_id
op_lshift
id|MIIpmdShift
)paren
op_or
(paren
id|location
op_lshift
id|MIIregShift
)paren
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdio_reset
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|mdio_idle
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDDIR
op_or
id|MDIO
suffix:colon
id|MDDIR
suffix:semicolon
id|outl
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dataval
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the two transition, 16 data, and wire-idle bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
singleline_comment|//mdio_delay();
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|mdio_addr
)paren
op_amp
id|MDIO
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|mear
suffix:semicolon
r_int
id|mii_cmd
op_assign
id|MIIwrite
op_or
(paren
id|phy_id
op_lshift
id|MIIpmdShift
)paren
op_or
(paren
id|location
op_lshift
id|MIIregShift
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdio_reset
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|mdio_idle
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDDIR
op_or
id|MDIO
suffix:colon
id|MDDIR
suffix:semicolon
id|outb
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dataval
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Clear out extra bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|sis900_open
id|sis900_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s sis900_open, IO Addr=%x, Irq=%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|ioaddr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|RESET
op_or
id|RxRESET
op_or
id|TxRESET
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|sis900_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|tp-&gt;tx_bufs
op_assign
id|kmalloc
c_func
(paren
id|TX_BUF_SIZE
op_star
id|NUM_TX_DESC
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|tp-&gt;rx_bufs
op_assign
id|kmalloc
c_func
(paren
id|RX_BUF_SIZE
op_star
id|NUM_RX_DESC
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tx_bufs
op_eq
l_int|NULL
op_logical_or
id|tp-&gt;rx_bufs
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;tx_bufs
)paren
id|kfree
c_func
(paren
id|tp-&gt;tx_bufs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;rx_bufs
)paren
id|kfree
c_func
(paren
id|tp-&gt;rx_bufs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;tx_bufs
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t allocate a %d byte TX Bufs.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|TX_BUF_SIZE
op_star
id|NUM_TX_DESC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_bufs
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t allocate a %d byte RX Bufs.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RX_BUF_SIZE
op_star
id|NUM_RX_DESC
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
(brace
id|u32
id|rfcrSave
suffix:semicolon
id|u32
id|w
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|rfcrSave
op_assign
id|inl
c_func
(paren
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|rfcrSave
op_amp
op_complement
id|RFEN
comma
id|rfcr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|w
op_assign
(paren
id|u16
)paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
)paren
op_plus
id|i
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
(paren
(paren
id|u32
)paren
id|i
)paren
op_lshift
id|RFEP_shift
)paren
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|u32
)paren
id|w
comma
id|ioaddr
op_plus
id|rfdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Filter Addr[%d]=%x&bslash;n&quot;
comma
id|i
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rfdr
)paren
)paren
suffix:semicolon
)brace
)brace
id|outl
c_func
(paren
id|rfcrSave
comma
id|rfcr
)paren
suffix:semicolon
)brace
id|sis900_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|u32
)paren
id|tp-&gt;tx_buf
(braket
l_int|0
)braket
dot
id|physAddr
comma
id|ioaddr
op_plus
id|txdp
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|u32
)paren
id|tp-&gt;rx_buf
(braket
l_int|0
)braket
dot
id|physAddr
comma
id|ioaddr
op_plus
id|rxdp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;txdp:%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txdp
)paren
)paren
suffix:semicolon
multiline_comment|/* Check that the chip has finished the reset. */
(brace
id|u32
id|status
suffix:semicolon
r_int
id|j
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|TxRCMP
op_or
id|RxRCMP
suffix:semicolon
r_while
c_loop
(paren
id|status
op_logical_and
(paren
id|j
op_increment
OL
l_int|30000
)paren
)paren
(brace
id|status
op_xor_assign
(paren
id|inl
c_func
(paren
id|isr
)paren
op_amp
id|status
)paren
suffix:semicolon
)brace
)brace
id|outl
c_func
(paren
id|PESEL
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
multiline_comment|/* Must enable Tx/Rx before setting transfer thresholds! */
multiline_comment|/*&n;         *      #define TX_DMA_BURST    0&n;         *      #define RX_DMA_BURST    0&n;         *      #define TX_FIFO_THRESH  16&n;         *      #define TxDRNT_100      (1536&gt;&gt;5)&n;         *      #define TxDRNT_10       (1536&gt;&gt;5)&n;         *      #define RxDRNT_100      (1536&gt;&gt;5)&n;         *      #define RxDRNT_10       (1536&gt;&gt;5)&n;         */
id|outl
c_func
(paren
(paren
id|RX_DMA_BURST
op_lshift
l_int|20
)paren
op_or
(paren
id|RxDRNT_10
op_lshift
l_int|1
)paren
comma
id|ioaddr
op_plus
id|rxcfg
)paren
suffix:semicolon
id|outl
c_func
(paren
id|TxATP
op_or
(paren
id|TX_DMA_BURST
op_lshift
l_int|20
)paren
op_or
(paren
id|TX_FIFO_THRESH
op_lshift
l_int|8
)paren
op_or
id|TxDRNT_10
comma
id|ioaddr
op_plus
id|txcfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;LinkOn
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Type %s%s-duplex.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;speeds
op_eq
id|HW_SPEED_100_MBPS
ques
c_cond
l_string|&quot;100mbps &quot;
suffix:colon
l_string|&quot;10mbps &quot;
comma
id|tp-&gt;full_duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link Off&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|RxOK
op_or
id|RxERR
op_or
id|RxORN
op_or
id|RxSOVR
op_or
id|TxOK
op_or
id|TxERR
op_or
id|TxURN
)paren
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|RxENA
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|IE
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: sis900_open() ioaddr %#lx IRQ %d &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Set the timer to switch to check for link beat and perhaps switch&n;           to an alternate media type. */
id|init_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
l_int|24
op_star
id|HZ
)paren
op_div
l_int|10
)paren
suffix:semicolon
multiline_comment|/* 2.4 sec. */
id|tp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|tp-&gt;timer.function
op_assign
op_amp
id|sis900_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sis900_timer
r_static
r_void
id|sis900_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|0
suffix:semicolon
id|u16
id|status
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;LinkOn
)paren
(brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|MIISTAT_LINK
)paren
(brace
id|elPMDreadMode
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
op_amp
id|tp-&gt;speeds
comma
op_amp
id|tp-&gt;full_duplex
)paren
suffix:semicolon
id|tp-&gt;LinkOn
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link On %s%s-duplex &quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;speeds
op_eq
id|HW_SPEED_100_MBPS
ques
c_cond
l_string|&quot;100mbps &quot;
suffix:colon
l_string|&quot;10mbps &quot;
comma
id|tp-&gt;full_duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
singleline_comment|// previous link on
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|MIISTAT_LINK
)paren
)paren
(brace
id|tp-&gt;LinkOn
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link Off&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|next_tick
op_assign
l_int|2
op_star
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|next_tick
)paren
(brace
id|tp-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|next_tick
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
)brace
)brace
DECL|function|sis900_tx_timeout
r_static
r_void
id|sis900_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Transmit timeout, status %2.2x %4.4x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
multiline_comment|/* Emit info to figure out what went wrong. */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:Tx queue start entry %d dirty entry %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;dirty_tx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  Tx descriptor %d is %8.8x.%s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
comma
(paren
r_int
r_int
)paren
op_amp
id|tp-&gt;tx_buf
(braket
id|i
)braket
comma
id|i
op_eq
id|tp-&gt;dirty_tx
op_mod
id|NUM_TX_DESC
ques
c_cond
l_string|&quot; (queue head)&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Soft reset the chip. */
singleline_comment|//outb(RESET, ioaddr + cr);
multiline_comment|/* Check that the chip has finished the reset. */
multiline_comment|/*&n;        for (i = 1000; i &gt; 0; i--)&n;                if ((inb(ioaddr + cr) &amp; RESET) == 0)&n;                        break;&n;        */
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Must enable Tx/Rx before setting transfer thresholds! */
multiline_comment|/*&n;        set_rx_mode(dev);&n;        */
(brace
multiline_comment|/* Save the unsent Tx packets. */
r_struct
id|sk_buff
op_star
id|saved_skb
(braket
id|NUM_TX_DESC
)braket
comma
op_star
id|skb
suffix:semicolon
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OG
l_int|0
suffix:semicolon
id|j
op_increment
comma
id|tp-&gt;dirty_tx
op_increment
)paren
id|saved_skb
(braket
id|j
)braket
op_assign
id|tp-&gt;tx_skbuff
(braket
id|tp-&gt;dirty_tx
op_mod
id|NUM_TX_DESC
)braket
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|j
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb
op_assign
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
id|saved_skb
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Always alignment */
id|memcpy
c_func
(paren
(paren
r_int
r_char
op_star
)paren
(paren
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|buf
)paren
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|cmdsts
op_assign
id|OWN
op_or
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* Note: the chip doesn&squot;t have auto-pad! */
multiline_comment|/*&n;                        outl(tp-&gt;tx_flag|(skb-&gt;len&gt;=ETH_ZLEN?skb-&gt;len:ETH_ZLEN),&n;                                 ioaddr + TxStatus0 + i*4);&n;                        */
)brace
id|outl
c_func
(paren
id|TxENA
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
id|i
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|NUM_TX_DESC
)paren
id|tp-&gt;tx_skbuff
(braket
id|i
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|NUM_TX_DESC
)paren
(brace
multiline_comment|/* Typical path */
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|RxOK
op_or
id|RxERR
op_or
id|RxORN
op_or
id|RxSOVR
op_or
id|TxOK
op_or
id|TxERR
op_or
id|TxURN
)paren
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
r_static
r_void
DECL|function|sis900_init_ring
id|sis900_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Tx Buffer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|buf
op_assign
op_amp
id|tp-&gt;tx_bufs
(braket
id|i
op_star
id|TX_BUF_SIZE
)braket
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|bufPhys
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;tx_bufs
(braket
id|i
op_star
id|TX_BUF_SIZE
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Tx Descriptor */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|llink
op_assign
(paren
id|u32
)paren
op_amp
(paren
id|tp-&gt;tx_buf
(braket
(paren
(paren
id|i
op_plus
l_int|1
)paren
OL
id|NUM_TX_DESC
)paren
ques
c_cond
(paren
id|i
op_plus
l_int|1
)paren
suffix:colon
l_int|0
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|plink
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
op_amp
(paren
id|tp-&gt;tx_buf
(braket
(paren
(paren
id|i
op_plus
l_int|1
)paren
OL
id|NUM_TX_DESC
)paren
ques
c_cond
(paren
id|i
op_plus
l_int|1
)paren
suffix:colon
l_int|0
)braket
dot
id|plink
)paren
)paren
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|physAddr
op_assign
id|virt_to_bus
c_func
(paren
op_amp
(paren
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|plink
)paren
)paren
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|i
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Rx Buffer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|buf
op_assign
op_amp
id|tp-&gt;rx_bufs
(braket
id|i
op_star
id|RX_BUF_SIZE
)braket
suffix:semicolon
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|bufPhys
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;rx_bufs
(braket
id|i
op_star
id|RX_BUF_SIZE
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Rx Descriptor */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|llink
op_assign
(paren
id|u32
)paren
op_amp
(paren
id|tp-&gt;rx_buf
(braket
(paren
(paren
id|i
op_plus
l_int|1
)paren
OL
id|NUM_RX_DESC
)paren
ques
c_cond
(paren
id|i
op_plus
l_int|1
)paren
suffix:colon
l_int|0
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|plink
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
op_amp
(paren
id|tp-&gt;rx_buf
(braket
(paren
(paren
id|i
op_plus
l_int|1
)paren
OL
id|NUM_RX_DESC
)paren
ques
c_cond
(paren
id|i
op_plus
l_int|1
)paren
suffix:colon
l_int|0
)braket
dot
id|plink
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|physAddr
op_assign
id|virt_to_bus
c_func
(paren
op_amp
(paren
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|plink
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_buf
(braket
id|i
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sis900_start_xmit
id|sis900_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|entry
suffix:semicolon
multiline_comment|/* Block a timer-based transmit from overlapping.  This could better be&n;           done with atomic_swap(1, dev-&gt;tbusy), but set_bit() works as well. */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|dev-&gt;trans_start
OL
id|TX_TIMEOUT
)paren
r_return
l_int|1
suffix:semicolon
id|sis900_tx_timeout
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Calculate the next Tx descriptor entry. ????? */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|5
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: SKB Tx Frame contents:(len=%d)&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x &quot;
comma
(paren
id|u8
)paren
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|tp-&gt;tx_buf
(braket
id|entry
)braket
dot
id|buf
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|tp-&gt;tx_buf
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
(paren
id|OWN
op_or
id|skb-&gt;len
)paren
suffix:semicolon
singleline_comment|//tp-&gt;tx_buf[entry].plink = 0;
id|outl
c_func
(paren
id|TxENA
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|NUM_TX_DESC
)paren
(brace
multiline_comment|/* Typical path */
id|clear_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Note: the chip doesn&squot;t have auto-pad! */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Queued Tx packet at &quot;
l_string|&quot;%p size %d to slot %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;data
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|sis900_interrupt
r_static
r_void
id|sis900_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
macro_line|#if defined(__i386__)
multiline_comment|/* A lock to prevent simultaneous entry bug on Intel SMP machines. */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;interrupt
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: SMP simultaneous entry of &quot;
l_string|&quot;an interrupt handler.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Avoid halting machine. */
r_return
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Re-entering the &quot;
l_string|&quot;interrupt handler.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_do
(brace
id|status
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|outl
c_func
(paren
id|status
comma
id|ioaddr
op_plus
id|isr
)paren
suffix:semicolon
singleline_comment|// ?????
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: interrupt  status=%#4.4x &quot;
l_string|&quot;new intstat=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|TxURN
op_or
id|TxERR
op_or
id|TxOK
op_or
id|RxORN
op_or
id|RxERR
op_or
id|RxOK
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxOK
op_or
id|RxORN
op_or
id|RxERR
)paren
)paren
multiline_comment|/* Rx interrupt */
id|sis900_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxOK
op_or
id|TxERR
)paren
)paren
(brace
r_int
r_int
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;TxOK:tp-&gt;cur_tx:%d,&quot;
l_string|&quot;tp-&gt;dirty_tx:%x&bslash;n&quot;
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;dirty_tx
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|dirty_tx
OL
id|tp-&gt;cur_tx
suffix:semicolon
id|dirty_tx
op_increment
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
r_int
id|txstatus
op_assign
id|tp-&gt;tx_buf
(braket
id|entry
)braket
dot
id|cmdsts
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:     Tx Frame contents:&quot;
l_string|&quot;(len=%d)&quot;
comma
id|dev-&gt;name
comma
(paren
id|txstatus
op_amp
id|DSIZE
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|txstatus
op_amp
id|DSIZE
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x &quot;
comma
(paren
id|u8
)paren
(paren
id|tp-&gt;tx_buf
(braket
id|entry
)braket
dot
id|buf
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|txstatus
op_amp
(paren
id|OK
op_or
id|UNDERRUN
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Tx NOT (OK,&quot;
l_string|&quot;UnderRun)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been Txed */
)brace
multiline_comment|/* Note: TxCarrierLost is always asserted&n;                                                at 100mbps.                 */
r_if
c_cond
(paren
id|txstatus
op_amp
(paren
id|OWCOLL
op_or
id|ABORT
)paren
)paren
(brace
multiline_comment|/* There was an major error, log it. */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Tx Out of &quot;
l_string|&quot; Window,Abort&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Transmit &quot;
l_string|&quot;error, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|txstatus
)paren
suffix:semicolon
macro_line|#endif
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
id|ABORT
)paren
(brace
id|tp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|txstatus
op_amp
id|NOCARRIER
)paren
id|tp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
id|OWCOLL
)paren
id|tp-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
(paren
id|txstatus
op_amp
id|COLCNT
)paren
op_eq
id|COLCNT
)paren
id|tp-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef ETHER_STATS
multiline_comment|/* No count for tp-&gt;stats.tx_deferred */
macro_line|#endif
r_if
c_cond
(paren
id|txstatus
op_amp
id|UNDERRUN
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Tx UnderRun&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|tp-&gt;stats.collisions
op_add_assign
(paren
id|txstatus
op_rshift
l_int|16
)paren
op_amp
l_int|0xF
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; 0x20119
id|tp-&gt;stats.tx_bytes
op_add_assign
id|txstatus
op_amp
id|DSIZE
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Tx Transmit OK&bslash;n&quot;
)paren
suffix:semicolon
id|tp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Free original skb&bslash;n&quot;
)paren
suffix:semicolon
id|dev_free_skb
c_func
(paren
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
)brace
singleline_comment|// for dirty
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OG
id|NUM_TX_DESC
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Out-of-sync dirty pointer,&quot;
l_string|&quot; %d vs. %d, full=%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dirty_tx
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;tx_full
)paren
suffix:semicolon
id|dirty_tx
op_add_assign
id|NUM_TX_DESC
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tx_full
op_logical_and
id|dirty_tx
OG
id|tp-&gt;cur_tx
op_minus
id|NUM_TX_DESC
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tbusy. */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Tx Ring NO LONGER Full&bslash;n&quot;
)paren
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
id|tp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;TxOK,tp-&gt;cur_tx:%d,tp-&gt;dirty:%d&bslash;n&quot;
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;dirty_tx
)paren
suffix:semicolon
)brace
singleline_comment|// if (TxOK | TxERR)
multiline_comment|/* Check uncommon events with one test. */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxORN
op_or
id|TxERR
op_or
id|RxERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Abnormal interrupt,&quot;
l_string|&quot;status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffffffff
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxORN
op_or
id|RxERR
)paren
)paren
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxORN
)paren
(brace
id|tp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;IntrStatus=0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: exiting interrupt, intr_status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
macro_line|#if defined(__i386__)
id|clear_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;interrupt
)paren
suffix:semicolon
macro_line|#else
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/* The data sheet doesn&squot;t describe the Rx ring at all, so I&squot;m guessing at the&n;   field alignments and semantics. */
DECL|function|sis900_rx
r_static
r_int
id|sis900_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
id|cur_rx
op_assign
id|tp-&gt;cur_rx
op_mod
id|NUM_RX_DESC
suffix:semicolon
r_int
id|rx_status
op_assign
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|cmdsts
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: sis900_rx, current %4.4x,&quot;
l_string|&quot; rx status=%8.8x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cur_rx
comma
id|rx_status
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rx_status
op_amp
id|OWN
)paren
(brace
r_int
id|rx_size
op_assign
id|rx_status
op_amp
id|DSIZE
suffix:semicolon
id|rx_size
op_sub_assign
id|CRC_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  sis900_rx, rx status %8.8x,&quot;
l_string|&quot; size %4.4x, cur %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
comma
id|rx_size
comma
id|cur_rx
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Rx Frame contents:&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rx_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x &quot;
comma
(paren
id|u8
)paren
(paren
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|buf
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_status
op_amp
id|TOOLONG
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Oversized Ethernet frame,&quot;
l_string|&quot; status %4.4x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RXISERR
op_or
id|RUNT
op_or
id|CRCERR
op_or
id|FAERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ethernet frame had errors,&quot;
l_string|&quot; status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RXISERR
op_or
id|FAERR
)paren
)paren
id|tp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RUNT
op_or
id|TOOLONG
)paren
)paren
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|CRCERR
)paren
id|tp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Malloc up new buffer, compatible with net-2e. */
multiline_comment|/* Omit the four octet CRC from the length. */
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|rx_size
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Memory squeeze,&quot;
l_string|&quot;deferring packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* We should check that some rx space is free.&n;                                   If not,&n;                                   free one and mark stats-&gt;rx_dropped++. */
id|tp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP fields. */
r_if
c_cond
(paren
id|rx_size
op_plus
id|CRC_SIZE
OG
id|RX_BUF_SIZE
)paren
(brace
multiline_comment|/*&n;                                int semi_count = RX_BUF_LEN - ring_offset - 4;&n;                                memcpy(skb_put(skb, semi_count),&n;                                        &amp;rx_bufs[ring_offset + 4], semi_count);&n;                                memcpy(skb_put(skb, rx_size-semi_count),&n;                                        rx_bufs, rx_size - semi_count);&n;                                if (sis900_debug &gt; 4) {&n;                                        int i;&n;                                        printk(KERN_DEBUG&quot;%s:  Frame wrap @%d&quot;,&n;                                                   dev-&gt;name, semi_count);&n;                                        for (i = 0; i &lt; 16; i++)&n;                                                printk(&quot; %2.2x&quot;, rx_bufs[i]);&n;                                        printk(&quot;.&bslash;n&quot;);&n;                                        memset(rx_bufs, 0xcc, 16);&n;                                }&n;                                */
)brace
r_else
(brace
macro_line|#if 0  /* USE_IP_COPYSUM */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|buf
comma
id|rx_size
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|rx_size
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|rx_size
)paren
comma
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|buf
comma
id|rx_size
)paren
suffix:semicolon
macro_line|#endif
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; 0x20119
id|tp-&gt;stats.rx_bytes
op_add_assign
id|rx_size
suffix:semicolon
macro_line|#endif
id|tp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
id|cur_rx
op_assign
(paren
(paren
id|cur_rx
op_plus
l_int|1
)paren
op_mod
id|NUM_RX_DESC
)paren
suffix:semicolon
id|rx_status
op_assign
id|tp-&gt;rx_buf
(braket
id|cur_rx
)braket
dot
id|cmdsts
suffix:semicolon
)brace
singleline_comment|// while
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Done sis900_rx(), current %4.4x &quot;
l_string|&quot;Cmd %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cur_rx
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|cur_rx
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sis900_close
id|sis900_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was 0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx DMA processes. */
id|outl
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
id|dev_free_skb
c_func
(paren
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|tp-&gt;rx_bufs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tp-&gt;tx_bufs
)paren
suffix:semicolon
multiline_comment|/* Green! Put the chip in low-power mode. */
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
id|data
(braket
l_int|0
)braket
op_assign
id|tp-&gt;phys
(braket
id|tp-&gt;phy_idx
)braket
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
r_static
r_struct
id|enet_statistics
op_star
DECL|function|sis900_get_stats
id|sis900_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   This routine is not state sensitive and need not be SMP locked. */
DECL|function|elComputeHashTableIndex
r_static
id|u16
id|elComputeHashTableIndex
c_func
(paren
id|u8
op_star
id|addr
)paren
(brace
DECL|macro|POLYNOMIAL
mdefine_line|#define POLYNOMIAL 0x04C11DB6L
id|u32
id|crc
op_assign
l_int|0xffffffff
comma
id|msb
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|u8
id|byte
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|byte
op_assign
op_star
id|addr
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|msb
op_assign
id|crc
op_rshift
l_int|31
suffix:semicolon
id|crc
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msb
op_xor
(paren
id|byte
op_amp
l_int|1
)paren
)paren
(brace
id|crc
op_xor_assign
id|POLYNOMIAL
suffix:semicolon
id|crc
op_or_assign
l_int|1
suffix:semicolon
)brace
id|byte
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
singleline_comment|// 7 bit crc for 128 bit hash table
r_return
(paren
r_int
)paren
(paren
id|crc
op_rshift
l_int|25
)paren
suffix:semicolon
)brace
DECL|function|elMIIpollBit
r_static
id|u16
id|elMIIpollBit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
id|u16
id|mask
comma
id|u16
id|polarity
comma
id|u16
op_star
id|value
)paren
(brace
id|u32
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
op_star
id|value
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|location
)paren
suffix:semicolon
r_if
c_cond
(paren
id|polarity
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
op_star
id|value
)paren
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mask
op_amp
op_complement
(paren
op_star
id|value
)paren
)paren
r_return
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|i
op_eq
l_int|1200
)paren
r_break
suffix:semicolon
)brace
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|elPMDreadMode
r_static
id|u16
id|elPMDreadMode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
op_star
id|speed
comma
r_int
op_star
id|duplex
)paren
(brace
id|u16
id|status
comma
id|OurCap
suffix:semicolon
op_star
id|speed
op_assign
id|HW_SPEED_10_MBPS
suffix:semicolon
op_star
id|duplex
op_assign
id|FDX_CAPABLE_HALF_SELECTED
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_ANLPAR
)paren
suffix:semicolon
id|OurCap
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_ANAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Link Part Status %4X&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Our Status %4X&bslash;n&quot;
comma
id|OurCap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Status Reg %4X&bslash;n&quot;
comma
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_STATUS
)paren
)paren
suffix:semicolon
)brace
id|status
op_and_assign
id|OurCap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|MII_NWAY_T
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;The other end NOT support NWAY...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
l_int|18
)paren
)paren
op_amp
l_int|0x4000
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
l_int|18
)paren
)paren
op_amp
l_int|0x0020
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x80
)paren
op_star
id|speed
op_assign
id|HW_SPEED_100_MBPS
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x40
)paren
op_star
id|duplex
op_assign
id|FDX_CAPABLE_FULL_SELECTED
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s%s-duplex.&bslash;n&quot;
comma
id|dev-&gt;name
comma
op_star
id|speed
op_eq
id|HW_SPEED_100_MBPS
ques
c_cond
l_string|&quot;100mbps &quot;
suffix:colon
l_string|&quot;10mbps &quot;
comma
op_star
id|duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;The other end support NWAY...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
)paren
)paren
(brace
op_star
id|duplex
op_assign
id|FDX_CAPABLE_FULL_SELECTED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_TX
)paren
)paren
(brace
op_star
id|speed
op_assign
id|HW_SPEED_100_MBPS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s%s-duplex based on&quot;
l_string|&quot; auto-negotiated partner ability.&bslash;n&quot;
comma
id|dev-&gt;name
comma
op_star
id|speed
op_eq
id|HW_SPEED_100_MBPS
ques
c_cond
l_string|&quot;100mbps &quot;
suffix:colon
l_string|&quot;10mbps &quot;
comma
op_star
id|duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
DECL|function|elAutoNegotiate
r_static
id|u16
id|elAutoNegotiate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
op_star
id|duplex
comma
r_int
op_star
id|speed
)paren
(brace
id|u16
id|status
comma
id|retnVal
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AutoNegotiate...&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_CONTROL
comma
l_int|0
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_CONTROL
comma
id|MIICNTL_AUTO
op_or
id|MIICNTL_RST_AUTO
)paren
suffix:semicolon
id|retnVal
op_assign
id|elMIIpollBit
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_CONTROL
comma
id|MIICNTL_RST_AUTO
comma
id|FALSE
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retnVal
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Not wait for Reset Complete&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|retnVal
op_assign
id|elMIIpollBit
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_STATUS
comma
id|MIISTAT_AUTO_DONE
comma
id|TRUE
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retnVal
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Not wait for AutoNego Complete&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|retnVal
op_assign
id|elMIIpollBit
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_STATUS
comma
id|MIISTAT_LINK
comma
id|TRUE
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retnVal
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Not wait for Link Complete&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|MIISTAT_LINK
)paren
(brace
id|elPMDreadMode
c_func
(paren
id|dev
comma
id|phy_id
comma
id|speed
comma
id|duplex
)paren
suffix:semicolon
id|elSetMediaType
c_func
(paren
id|dev
comma
op_star
id|speed
comma
op_star
id|duplex
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
DECL|function|elSetCapability
r_static
r_void
id|elSetCapability
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|duplex
comma
r_int
id|speed
)paren
(brace
id|u16
id|cap
op_assign
(paren
id|MII_NWAY_T
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_CSMA_CD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|speed
op_ne
l_int|100
)paren
(brace
id|cap
op_and_assign
op_complement
(paren
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;UNSET 100Mbps&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|duplex
)paren
(brace
id|cap
op_and_assign
op_complement
(paren
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_TX_FDX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;UNSET full-duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_id
comma
id|MII_ANAR
comma
id|cap
)paren
suffix:semicolon
)brace
DECL|function|elSetMediaType
r_static
r_void
id|elSetMediaType
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|speed
comma
r_int
id|duplex
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|txCfgOn
op_assign
l_int|0
comma
id|txCfgOff
op_assign
id|TxDRNT
suffix:semicolon
id|u32
id|rxCfgOn
op_assign
l_int|0
comma
id|rxCfgOff
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|speed
op_eq
id|HW_SPEED_100_MBPS
)paren
(brace
id|txCfgOn
op_or_assign
(paren
id|TxDRNT_100
op_or
id|TxHBI
)paren
suffix:semicolon
)brace
r_else
(brace
id|txCfgOn
op_or_assign
id|TxDRNT_10
suffix:semicolon
)brace
r_if
c_cond
(paren
id|duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
)paren
(brace
id|txCfgOn
op_or_assign
(paren
id|TxCSI
op_or
id|TxHBI
)paren
suffix:semicolon
id|rxCfgOn
op_or_assign
id|RxATP
suffix:semicolon
)brace
r_else
(brace
id|txCfgOff
op_or_assign
(paren
id|TxCSI
op_or
id|TxHBI
)paren
suffix:semicolon
id|rxCfgOff
op_or_assign
id|RxATP
suffix:semicolon
)brace
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txcfg
)paren
op_amp
op_complement
id|txCfgOff
)paren
op_or
id|txCfgOn
comma
id|ioaddr
op_plus
id|txcfg
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
op_amp
op_complement
id|rxCfgOff
)paren
op_or
id|rxCfgOn
comma
id|ioaddr
op_plus
id|rxcfg
)paren
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
id|mc_filter
(braket
l_int|8
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|rx_mode
suffix:semicolon
id|u32
id|rxCfgOn
op_assign
l_int|0
comma
id|rxCfgOff
op_assign
l_int|0
suffix:semicolon
id|u32
id|txCfgOn
op_assign
l_int|0
comma
id|txCfgOff
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: set_rx_mode (%4.4x) done--&quot;
l_string|&quot;RxCfg %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;flags
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
)paren
suffix:semicolon
multiline_comment|/* Note: do not reorder, GCC is clever about common statements. */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|ACCEPT_ALL_BCASTS
op_or
id|ACCEPT_ALL_MCASTS
op_or
id|ACCEPT_CAM_QUALIFIED
op_or
id|ACCEPT_ALL_PHYS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|mc_filter
(braket
id|i
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
id|rx_mode
op_assign
id|ACCEPT_ALL_BCASTS
op_or
id|ACCEPT_ALL_MCASTS
op_or
id|ACCEPT_CAM_QUALIFIED
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|mc_filter
(braket
id|i
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|ACCEPT_ALL_BCASTS
op_or
id|ACCEPT_ALL_MCASTS
op_or
id|ACCEPT_CAM_QUALIFIED
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|mc_filter
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
id|set_bit
c_func
(paren
id|elComputeHashTableIndex
c_func
(paren
id|mclist-&gt;dmi_addr
)paren
comma
id|mc_filter
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outl
c_func
(paren
(paren
id|u32
)paren
(paren
l_int|0x00000004
op_plus
id|i
)paren
op_lshift
l_int|16
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|rfdr
)paren
suffix:semicolon
)brace
multiline_comment|/* We can safely update without stopping the chip. */
singleline_comment|//rx_mode = ACCEPT_CAM_QUALIFIED | ACCEPT_ALL_BCASTS | ACCEPT_ALL_PHYS;
singleline_comment|//rx_mode = ACCEPT_CAM_QUALIFIED | ACCEPT_ALL_BCASTS;
id|outl
c_func
(paren
id|RFEN
op_or
(paren
(paren
id|rx_mode
op_amp
(paren
id|ACCEPT_ALL_MCASTS
op_or
id|ACCEPT_ALL_BCASTS
op_or
id|ACCEPT_ALL_PHYS
)paren
)paren
op_lshift
id|RFAA_shift
)paren
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_mode
op_amp
id|ACCEPT_ALL_ERRORS
)paren
(brace
id|rxCfgOn
op_assign
id|RxAEP
op_or
id|RxARP
op_or
id|RxAJAB
suffix:semicolon
)brace
r_else
(brace
id|rxCfgOff
op_assign
id|RxAEP
op_or
id|RxARP
op_or
id|RxAJAB
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_mode
op_amp
id|MAC_LOOPBACK
)paren
(brace
id|rxCfgOn
op_or_assign
id|RxATP
suffix:semicolon
id|txCfgOn
op_or_assign
id|TxMLB
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
(paren
r_struct
id|sis900_private
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|full_duplex
)paren
)paren
id|rxCfgOff
op_or_assign
id|RxATP
suffix:semicolon
id|txCfgOff
op_or_assign
id|TxMLB
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Before Set TxCfg=%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txcfg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Before Set RxCfg=%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
op_or
id|rxCfgOn
)paren
op_amp
op_complement
id|rxCfgOff
comma
id|ioaddr
op_plus
id|rxcfg
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txcfg
)paren
op_or
id|txCfgOn
)paren
op_amp
op_complement
id|txCfgOff
comma
id|ioaddr
op_plus
id|txcfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;After Set TxCfg=%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txcfg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;After Set RxCfg=%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Receive Filter Register:%8.8x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rfcr
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|sis900_reset
r_static
r_void
id|sis900_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|RxRESET
op_or
id|TxRESET
op_or
id|RESET
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|PESEL
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|sis900_probe
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|next_dev
suffix:semicolon
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
r_while
c_loop
(paren
id|root_sis900_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis900_private
op_star
)paren
id|root_sis900_dev-&gt;priv
suffix:semicolon
id|next_dev
op_assign
id|tp-&gt;next_module
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|root_sis900_dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|root_sis900_dev-&gt;base_addr
comma
id|pci_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|io_size
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|root_sis900_dev
)paren
suffix:semicolon
id|root_sis900_dev
op_assign
id|next_dev
suffix:semicolon
)brace
)brace
macro_line|#endif  /* MODULE */
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -DMODULE -D__KERNEL__ -Wall -Wstrict-prototypes -O6 -c sis900.c `[ -f /usr/include/linux/modversions.h ] &amp;&amp; echo -DMODVERSIONS`&quot;&n; *  SMP-compile-command: &quot;gcc -D__SMP__ -DMODULE -D__KERNEL__ -Wall -Wstrict-prototypes -O6 -c sis900.c `[ -f /usr/include/linux/modversions.h ] &amp;&amp; echo -DMODVERSIONS`&quot;&n; *  c-indent-level: 4&n; *  c-basic-offset: 4&n; *  tab-width: 4&n; * End:&n; */
eof
