multiline_comment|/******************************************************************************&n; *&n; * Name:&t;skgesirq.c&n; * Project:&t;GEnesis, PCI Gigabit Ethernet Adapter&n; * Version:&t;$Revision: 1.55 $&n; * Date:&t;$Date: 2000/06/19 08:36:25 $&n; * Purpose:&t;Special IRQ module&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998,1999 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * History:&n; *&n; *&t;$Log: skgesirq.c,v $&n; *&t;Revision 1.55  2000/06/19 08:36:25  cgoos&n; *&t;Changed comment.&n; *&t;&n; *&t;Revision 1.54  2000/05/22 08:45:57  malthoff&n; *&t;Fix: #10523 is valid for all BCom PHYs.&n; *&t;&n; *&t;Revision 1.53  2000/05/19 10:20:30  cgoos&n; *&t;Removed Solaris debug output code.&n; *&t;&n; *&t;Revision 1.52  2000/05/19 10:19:37  cgoos&n; *&t;Added PHY state check in HWLinkDown.&n; *&t;Move PHY interrupt code to IS_EXT_REG case in SkGeSirqIsr.&n; *&t;&n; *&t;Revision 1.51  2000/05/18 05:56:20  cgoos&n; *&t;Fixed typo.&n; *&t;&n; *&t;Revision 1.50  2000/05/17 12:49:49  malthoff&n; *&t;Fixes BCom link bugs (#10523).&n; *&t;&n; *&t;Revision 1.49  1999/12/17 11:02:50  gklug&n; *&t;fix: read PHY_STAT of Broadcom chip more often to assure good status&n; *&t;&n; *&t;Revision 1.48  1999/12/06 10:01:17  cgoos&n; *&t;Added SET function for Role.&n; *&t;&n; *&t;Revision 1.47  1999/11/22 13:34:24  cgoos&n; *&t;Changed license header to GPL.&n; *&t;&n; *&t;Revision 1.46  1999/09/16 10:30:07  cgoos&n; *&t;Removed debugging output statement from Linux.&n; *&t;&n; *&t;Revision 1.45  1999/09/16 07:32:55  cgoos&n; *&t;Fixed dual-port copperfield bug (PHY_READ from resetted port).&n; *&t;Removed some unused variables.&n; *&t;&n; *&t;Revision 1.44  1999/08/03 15:25:04  cgoos&n; *&t;Removed workaround for disabled interrupts in half duplex mode.&n; *&t;&n; *&t;Revision 1.43  1999/08/03 14:27:58  cgoos&n; *&t;Removed SENSE mode code from SkGePortCheckUpBcom.&n; *&t;&n; *&t;Revision 1.42  1999/07/26 09:16:54  cgoos&n; *&t;Added some typecasts to avoid compiler warnings.&n; *&t;&n; *&t;Revision 1.41  1999/05/19 07:28:59  cgoos&n; *&t;Changes for 1000Base-T.&n; *&t;&n; *&t;Revision 1.40  1999/04/08 13:59:39  gklug&n; *&t;fix: problem with 3Com switches endless RESTARTs&n; *&t;&n; *&t;Revision 1.39  1999/03/08 10:10:52  gklug&n; *&t;fix: AutoSensing did switch to next mode even if LiPa indicated offline&n; *&t;&n; *&t;Revision 1.38  1999/03/08 09:49:03  gklug&n; *&t;fix: Bug using pAC instead of IoC, causing AIX problems&n; *&t;fix: change compare for Linux compiler bug workaround&n; *&t;&n; *&t;Revision 1.37  1999/01/28 14:51:33  gklug&n; *&t;fix: monitor for autosensing and extra RESETS the RX on wire counters&n; *&t;&n; *&t;Revision 1.36  1999/01/22 09:19:55  gklug&n; *&t;fix: Init DupMode and InitPauseMd are now called in RxTxEnable&n; *&t;&n; *&t;Revision 1.35  1998/12/11 15:22:59  gklug&n; *&t;chg: autosensing: check for receive if manual mode was guessed&n; *&t;chg: simplified workaround for XMAC errata&n; *&t;chg: wait additional 100 ms before link goes up.&n; *&t;chg: autoneg timeout to 600 ms&n; *&t;chg: restart autoneg even if configured to autonegotiation&n; *&t;&n; *&t;Revision 1.34  1998/12/10 10:33:14  gklug&n; *&t;add: more debug messages&n; *&t;fix: do a new InitPhy if link went down (AutoSensing problem)&n; *&t;chg: Check for zero shorts if link is NOT up&n; *&t;chg: reset Port if link goes down&n; *&t;chg: wait additional 100 ms when link comes up to check shorts&n; *&t;fix: dummy read extended autoneg status to prevent link going down immediately&n; *&t;&n; *&t;Revision 1.33  1998/12/07 12:18:29  gklug&n; *&t;add: refinement of autosense mode: take into account the autoneg cap of LiPa&n; *&t;&n; *&t;Revision 1.32  1998/12/07 07:11:21  gklug&n; *&t;fix: compiler warning&n; *&t;&n; *&t;Revision 1.31  1998/12/02 09:29:05  gklug&n; *&t;fix: WA XMAC Errata: FCSCt check was not correct.&n; *&t;fix: WA XMAC Errata: Prec Counter were NOT updated in case of short checks.&n; *&t;fix: Clear Stat : now clears the Prev counters of all known Ports&n; *&t;&n; *&t;Revision 1.30  1998/12/01 10:54:15  gklug&n; *&t;dd: workaround for XMAC errata changed. Check RX count and CRC err Count, too.&n; *&t;&n; *&t;Revision 1.29  1998/12/01 10:01:53  gklug&n; *&t;fix: if MAC IRQ occurs during port down, this will be handled correctly&n; *&t;&n; *&t;Revision 1.28  1998/11/26 16:22:11  gklug&n; *&t;fix: bug in autosense if manual modes are used&n; *&t;&n; *&t;Revision 1.27  1998/11/26 15:50:06  gklug&n; *&t;fix: PNMI needs to set PLinkModeConf&n; *&t;&n; *&t;Revision 1.26  1998/11/26 14:51:58  gklug&n; *&t;add: AutoSensing functionalty&n; *&t;&n; *&t;Revision 1.25  1998/11/26 07:34:37  gklug&n; *&t;fix: Init PrevShorts when restarting port due to Link connection&n; *&t;&n; *&t;Revision 1.24  1998/11/25 10:57:32  gklug&n; *&t;fix: remove unreferenced local vars&n; *&t;&n; *&t;Revision 1.23  1998/11/25 08:26:40  gklug&n; *&t;fix: don&squot;t do a RESET on a starting or stopping port&n; *&t;&n; *&t;Revision 1.22  1998/11/24 13:29:44  gklug&n; *&t;add: Workaround for MAC parity errata&n; *&t;&n; *&t;Revision 1.21  1998/11/18 15:31:06  gklug&n; *&t;fix: lint bugs&n; *&t;&n; *&t;Revision 1.20  1998/11/18 12:58:54  gklug&n; *&t;fix: use PNMI query instead of hardware access&n; *&t;&n; *&t;Revision 1.19  1998/11/18 12:54:55  gklug&n; *&t;chg: add new workaround for XMAC Errata&n; *&t;add: short event counter monitoring on active link too&n; *&t;&n; *&t;Revision 1.18  1998/11/13 14:27:41  malthoff&n; *&t;Bug Fix: Packet Arbiter Timeout was not cleared correctly&n; *&t;for timeout on TX1 and TX2.&n; *&t;&n; *&t;Revision 1.17  1998/11/04 07:01:59  cgoos&n; *&t;Moved HW link poll sequence.&n; *&t;Added call to SkXmRxTxEnable.&n; *&t;&n; *&t;Revision 1.16  1998/11/03 13:46:03  gklug&n; *&t;add: functionality of SET_LMODE and SET_FLOW_MODE&n; *&t;fix: send RLMT LinkDown event when Port stop is given with LinkUp&n; *&t;&n; *&t;Revision 1.15  1998/11/03 12:56:47  gklug&n; *&t;fix: Needs more events&n; *&t;&n; *&t;Revision 1.14  1998/10/30 07:36:35  gklug&n; *&t;rmv: unnecessary code&n; *&t;&n; *&t;Revision 1.13  1998/10/29 15:21:57  gklug&n; *&t;add: Poll link feature for activating HW link&n; *&t;fix: Deactivate HWLink when Port STOP is given&n; *&t;&n; *&t;Revision 1.12  1998/10/28 07:38:57  cgoos&n; *&t;Checking link status at begin of SkHWLinkUp.&n; *&t;&n; *&t;Revision 1.11  1998/10/22 09:46:50  gklug&n; *&t;fix SysKonnectFileId typo&n; *&t;&n; *&t;Revision 1.10  1998/10/14 13:57:47  gklug&n; *&t;add: Port start/stop event&n; *&t;&n; *&t;Revision 1.9  1998/10/14 05:48:29  cgoos&n; *&t;Added definition for Para.&n; *&t;&n; *&t;Revision 1.8  1998/10/14 05:40:09  gklug&n; *&t;add: Hardware Linkup signal used&n; *&t;&n; *&t;Revision 1.7  1998/10/09 06:50:20  malthoff&n; *&t;Remove ID_sccs by SysKonnectFileId.&n; *&n; *&t;Revision 1.6  1998/10/08 09:11:49  gklug&n; *&t;add: clear IRQ commands&n; *&t;&n; *&t;Revision 1.5  1998/10/02 14:27:35  cgoos&n; *&t;Fixed some typos and wrong event names.&n; *&t;&n; *&t;Revision 1.4  1998/10/02 06:24:17  gklug&n; *&t;add: HW error function&n; *&t;fix: OUT macros&n; *&t;&n; *&t;Revision 1.3  1998/10/01 07:03:00  gklug&n; *&t;add: ISR for the usual interrupt source register&n; *&t;&n; *&t;Revision 1.2  1998/09/03 13:50:33  gklug&n; *&t;add: function prototypes&n; *&t;&n; *&t;Revision 1.1  1998/08/27 11:50:21  gklug&n; *&t;initial revision&n; *&t;&n; *&n; *&n; ******************************************************************************/
multiline_comment|/*&n;&t;Special Interrupt handler&n;&n;&t;The following abstract should show how this module is included&n;&t;in the driver path:&n;&n;&t;In the ISR of the driver the bits for frame transmission complete and&n;&t;for receive complete are checked and handled by the driver itself.&n;&t;The bits of the slow path mask are checked after this and then the&n;&t;entry into the so-called &quot;slow path&quot; is prepared. It is an implemetors&n;&t;decision whether this is executed directly or just scheduled by&n;&t;disabling the mask. In the interrupt service routine events may be&n;&t;generated, so it would be a good idea to call the EventDispatcher&n;&t;right after this ISR.&n;&n;&t;The Interrupt service register of the adapter is NOT read by this&n;&t;module. SO if the drivers implemetor needs a while loop around the&n;&t;slow data paths Interrupt bits, he needs to call the SkGeIsr() for&n;&t;each loop entered.&n;&n;&t;However, the XMAC Interrupt status registers are read in a while loop.&n;&n;*/
DECL|variable|SysKonnectFileId
r_static
r_const
r_char
id|SysKonnectFileId
(braket
)braket
op_assign
l_string|&quot;$Id: skgesirq.c,v 1.55 2000/06/19 08:36:25 cgoos Exp $&quot;
suffix:semicolon
macro_line|#include &quot;h/skdrv1st.h&quot;&t;&t;/* Driver Specific Definitions */
macro_line|#include &quot;h/skgepnmi.h&quot;&t;&t;/* PNMI Definitions */
macro_line|#include &quot;h/skrlmt.h&quot;&t;&t;/* RLMT Definitions */
macro_line|#include &quot;h/skdrv2nd.h&quot;&t;&t;/* Adapter Control- and Driver specific Def. */
multiline_comment|/* local function prototypes */
r_static
r_int
id|SkGePortCheckUpXmac
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|SkGePortCheckUpBcom
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|SkGePortCheckUpLone
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|SkGePortCheckUpNat
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|SkPhyIsrBcom
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
comma
id|SK_U16
)paren
suffix:semicolon
r_static
r_void
id|SkPhyIsrLone
c_func
(paren
id|SK_AC
op_star
comma
id|SK_IOC
comma
r_int
comma
id|SK_U16
)paren
suffix:semicolon
macro_line|#ifdef __C2MAN__
multiline_comment|/*&n;&t;Special IRQ function&n;&n;&t;General Description:&n;&n; */
DECL|function|intro
id|intro
c_func
(paren
)paren
(brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Define return codes of SkGePortCheckUp and CheckShort&n; */
DECL|macro|SK_HW_PS_NONE
mdefine_line|#define&t;SK_HW_PS_NONE&t;&t;0&t;/* No action needed */
DECL|macro|SK_HW_PS_RESTART
mdefine_line|#define&t;SK_HW_PS_RESTART&t;1&t;/* Restart needed */
DECL|macro|SK_HW_PS_LINK
mdefine_line|#define&t;SK_HW_PS_LINK&t;&t;2&t;/* Link Up actions needed */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkHWInitDefSense() - Default Autosensing mode initialization&n; *&n; * Description:&n; *&t;This function handles the Hardware link down signal&n; *&n; * Note:&n; *&n; */
DECL|function|SkHWInitDefSense
r_void
id|SkHWInitDefSense
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
)paren
multiline_comment|/* Port Index (MAC_1 + n) */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
id|pPrt-&gt;PAutoNegTimeOut
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_ne
id|SK_LMODE_AUTOSENSE
)paren
(brace
id|pPrt-&gt;PLinkMode
op_assign
id|pPrt-&gt;PLinkModeConf
suffix:semicolon
r_return
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;AutoSensing: First mode %d on Port %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|SK_LMODE_AUTOFULL
comma
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PLinkMode
op_assign
id|SK_LMODE_AUTOFULL
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkHWSenseGetNext() - GetNextAutosensing Mode&n; *&n; * Description:&n; *&t;This function handles the AutoSensing&n; *&n; * Note:&n; *&n; */
DECL|function|SkHWSenseGetNext
id|SK_U8
id|SkHWSenseGetNext
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
)paren
multiline_comment|/* Port Index (MAC_1 + n) */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
id|pPrt-&gt;PAutoNegTimeOut
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_ne
id|SK_LMODE_AUTOSENSE
)paren
(brace
multiline_comment|/* Leave all as configured */
r_return
id|pPrt-&gt;PLinkModeConf
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_AUTOFULL
)paren
(brace
multiline_comment|/* Return next mode AUTOBOTH */
r_return
id|SK_LMODE_AUTOBOTH
suffix:semicolon
)brace
multiline_comment|/* Return default autofull */
r_return
id|SK_LMODE_AUTOFULL
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkHWSenseSetNext() - Autosensing Set next mode&n; *&n; * Description:&n; *&t;This function sets the appropriate next mode.&n; *&n; * Note:&n; *&n; */
DECL|function|SkHWSenseSetNext
r_void
id|SkHWSenseSetNext
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
comma
multiline_comment|/* Port Index (MAC_1 + n) */
id|SK_U8
id|NewMode
)paren
multiline_comment|/* New Mode to be written in sense mode */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
id|pPrt-&gt;PAutoNegTimeOut
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_ne
id|SK_LMODE_AUTOSENSE
)paren
(brace
r_return
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;AutoSensing: next mode %d on Port %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|NewMode
comma
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PLinkMode
op_assign
id|NewMode
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkHWLinkDown() - Link Down handling&n; *&n; * Description:&n; *&t;This function handles the Hardware link down signal&n; *&n; * Note:&n; *&n; */
DECL|function|SkHWLinkDown
r_void
id|SkHWLinkDown
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
)paren
multiline_comment|/* Port Index (MAC_1 + n) */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
id|SK_U16
id|Word
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
multiline_comment|/* Disable all XMAC interrupts */
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_IMSK
comma
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* Disable Receive and Transmitter */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_MMU_CMD
comma
op_amp
id|Word
)paren
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_MMU_CMD
comma
id|Word
op_amp
op_complement
(paren
id|XM_MMU_ENA_RX
op_or
id|XM_MMU_ENA_TX
)paren
)paren
suffix:semicolon
multiline_comment|/* disable all PHY interrupts */
r_switch
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PhyType
)paren
(brace
r_case
id|SK_PHY_BCOM
suffix:colon
multiline_comment|/* make sure that PHY is initialized */
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PState
)paren
(brace
multiline_comment|/* Workaround BCOM Errata (#10523) all BCom */
multiline_comment|/* Disable Power Management if link is down */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_AUX_CTRL
comma
op_amp
id|Word
)paren
suffix:semicolon
id|PHY_WRITE
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_AUX_CTRL
comma
id|Word
op_or
id|PHY_B_AC_DIS_PM
)paren
suffix:semicolon
)brace
id|PHY_WRITE
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_INT_MASK
comma
l_int|0xffff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_PHY_LONE
suffix:colon
id|PHY_WRITE
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_INT_ENAB
comma
l_int|0x0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_PHY_NAT
suffix:colon
multiline_comment|/* todo: National&n;&t;&t;&t;PHY_WRITE(IoC, pPrt, Port, PHY_NAT_INT_MASK, &n;&t;&t;&t;&t;0xffff); */
r_break
suffix:semicolon
)brace
multiline_comment|/* Init default sense mode */
id|SkHWInitDefSense
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pPrt-&gt;PHWLinkUp
)paren
(brace
r_return
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link down Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
multiline_comment|/* Set Link to DOWN */
id|pPrt-&gt;PHWLinkUp
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Reset Port stati */
id|pPrt-&gt;PLinkModeStatus
op_assign
id|SK_LMODE_STAT_UNKNOWN
suffix:semicolon
id|pPrt-&gt;PFlowCtrlStatus
op_assign
id|SK_FLOW_STAT_NONE
suffix:semicolon
multiline_comment|/*&n;&t; * Reinit Phy especially when the AutoSense default is set now&n;&t; */
id|SkXmInitPhy
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|SK_FALSE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP0: used for workaround of Rev. C&n;&t; * Errata 2&n;&t; */
multiline_comment|/* Do NOT signal to RLMT */
multiline_comment|/* Do NOT start the timer here */
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkHWLinkUp() - Link Up handling&n; *&n; * Description:&n; *&t;This function handles the Hardware link up signal&n; *&n; * Note:&n; *&n; */
DECL|function|SkHWLinkUp
r_void
id|SkHWLinkUp
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
)paren
multiline_comment|/* Port Index (MAC_1 + n) */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PHWLinkUp
)paren
(brace
multiline_comment|/* We do NOT need to proceed on active link */
r_return
suffix:semicolon
)brace
id|pPrt-&gt;PHWLinkUp
op_assign
id|SK_TRUE
suffix:semicolon
id|pPrt-&gt;PAutoNegFail
op_assign
id|SK_FALSE
suffix:semicolon
id|pPrt-&gt;PLinkModeStatus
op_assign
id|SK_LMODE_STAT_UNKNOWN
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_ne
id|SK_LMODE_AUTOHALF
op_logical_and
id|pPrt-&gt;PLinkMode
op_ne
id|SK_LMODE_AUTOFULL
op_logical_and
id|pPrt-&gt;PLinkMode
op_ne
id|SK_LMODE_AUTOBOTH
)paren
(brace
multiline_comment|/* Link is up and no Autonegotiation should be done */
multiline_comment|/* Configure Port */
multiline_comment|/* Set Link Mode */
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_FULL
)paren
(brace
id|pPrt-&gt;PLinkModeStatus
op_assign
id|SK_LMODE_STAT_FULL
suffix:semicolon
)brace
r_else
(brace
id|pPrt-&gt;PLinkModeStatus
op_assign
id|SK_LMODE_STAT_HALF
suffix:semicolon
)brace
multiline_comment|/* No flow control without autonegotiation */
id|pPrt-&gt;PFlowCtrlStatus
op_assign
id|SK_FLOW_STAT_NONE
suffix:semicolon
multiline_comment|/* RX/TX enable */
id|SkXmRxTxEnable
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkMacParity&t;- does everything to handle MAC parity errors correctly&n; *&n; */
DECL|function|SkMacParity
r_static
r_void
id|SkMacParity
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
r_int
id|Port
)paren
multiline_comment|/* Port Index of the port failed */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
id|SK_U64
id|TxMax
suffix:semicolon
multiline_comment|/* TxMax Counter */
r_int
r_int
id|Len
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
multiline_comment|/* Clear IRQ */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|Port
comma
id|TX_MFF_CTRL1
)paren
comma
id|MFF_CLR_PERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PCheckPar
)paren
(brace
r_if
c_cond
(paren
id|Port
op_eq
id|MAC_1
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E016
comma
id|SKERR_SIRQ_E016MSG
)paren
suffix:semicolon
)brace
r_else
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E017
comma
id|SKERR_SIRQ_E017MSG
)paren
suffix:semicolon
)brace
id|Para.Para64
op_assign
id|Port
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|Port
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Check whether frames with a size of 1k were sent */
id|Len
op_assign
r_sizeof
(paren
id|SK_U64
)paren
suffix:semicolon
id|SkPnmiGetVar
c_func
(paren
id|pAC
comma
id|IoC
comma
id|OID_SKGE_STAT_TX_MAX
comma
(paren
r_char
op_star
)paren
op_amp
id|TxMax
comma
op_amp
id|Len
comma
(paren
id|SK_U32
)paren
id|SK_PNMI_PORT_PHYS2INST
c_func
(paren
id|Port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TxMax
OG
l_int|0
)paren
(brace
multiline_comment|/* From now on check the parity */
id|pPrt-&gt;PCheckPar
op_assign
id|SK_TRUE
suffix:semicolon
)brace
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;Hardware Error service routine&n; *&n; * Description:&n; *&n; * Notes:&n; */
DECL|function|SkGeHwErr
r_static
r_void
id|SkGeHwErr
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
id|SK_U32
id|HwStatus
)paren
multiline_comment|/* Interrupt status word */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_IRQ_STAT
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E013
comma
id|SKERR_SIRQ_E013MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
l_int|0
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_ADAP_FAIL
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_IRQ_MST_ERR
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E012
comma
id|SKERR_SIRQ_E012MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
l_int|0
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_ADAP_FAIL
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_NO_STAT_M1
)paren
(brace
multiline_comment|/* Ignore it */
multiline_comment|/* This situation is also indicated in the descriptor */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_1
comma
id|RX_MFF_CTRL1
)paren
comma
id|MFF_CLR_INSTAT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_NO_STAT_M2
)paren
(brace
multiline_comment|/* Ignore it */
multiline_comment|/* This situation is also indicated in the descriptor */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_2
comma
id|RX_MFF_CTRL1
)paren
comma
id|MFF_CLR_INSTAT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_NO_TIST_M1
)paren
(brace
multiline_comment|/* Ignore it */
multiline_comment|/* This situation is also indicated in the descriptor */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_1
comma
id|RX_MFF_CTRL1
)paren
comma
id|MFF_CLR_INTIST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_NO_TIST_M2
)paren
(brace
multiline_comment|/* Ignore it */
multiline_comment|/* This situation is also indicated in the descriptor */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_2
comma
id|RX_MFF_CTRL1
)paren
comma
id|MFF_CLR_INTIST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_RAM_RD_PAR
)paren
(brace
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_RI_CTRL
comma
id|RI_CLR_RD_PERR
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E014
comma
id|SKERR_SIRQ_E014MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
l_int|0
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_ADAP_FAIL
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_RAM_WR_PAR
)paren
(brace
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_RI_CTRL
comma
id|RI_CLR_WR_PERR
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E015
comma
id|SKERR_SIRQ_E015MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
l_int|0
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_ADAP_FAIL
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_M1_PAR_ERR
)paren
(brace
id|SkMacParity
c_func
(paren
id|pAC
comma
id|IoC
comma
id|MAC_1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_M2_PAR_ERR
)paren
(brace
id|SkMacParity
c_func
(paren
id|pAC
comma
id|IoC
comma
id|MAC_2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_R1_PAR_ERR
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_R1_CSR
comma
id|CSR_IRQ_CL_P
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E018
comma
id|SKERR_SIRQ_E018MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|HwStatus
op_amp
id|IS_R2_PAR_ERR
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_R2_CSR
comma
id|CSR_IRQ_CL_P
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
comma
id|SKERR_SIRQ_E019
comma
id|SKERR_SIRQ_E019MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;Interrupt service routine&n; *&n; * Description:&n; *&n; * Notes:&n; */
DECL|function|SkGeSirqIsr
r_void
id|SkGeSirqIsr
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO context */
id|SK_U32
id|Istatus
)paren
multiline_comment|/* Interrupt status word */
(brace
id|SK_U32
id|RegVal32
suffix:semicolon
multiline_comment|/* Read register Value */
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_U16
id|XmIsr
suffix:semicolon
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_HW_ERR
)paren
(brace
id|SK_IN32
c_func
(paren
id|IoC
comma
id|B0_HWE_ISRC
comma
op_amp
id|RegVal32
)paren
suffix:semicolon
id|SkGeHwErr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|RegVal32
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Packet Timeout interrupts&n;&t; */
multiline_comment|/* Check whether XMACs are correctly initialized */
r_if
c_cond
(paren
(paren
id|Istatus
op_amp
(paren
id|IS_PA_TO_RX1
op_or
id|IS_PA_TO_TX1
)paren
)paren
op_logical_and
op_logical_neg
id|pAC-&gt;GIni.GP
(braket
id|MAC_1
)braket
dot
id|PState
)paren
(brace
multiline_comment|/* XMAC was not initialized but Packet timeout occured */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E004
comma
id|SKERR_SIRQ_E004MSG
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|Istatus
op_amp
(paren
id|IS_PA_TO_RX2
op_or
id|IS_PA_TO_TX2
)paren
)paren
op_logical_and
op_logical_neg
id|pAC-&gt;GIni.GP
(braket
id|MAC_2
)braket
dot
id|PState
)paren
(brace
multiline_comment|/* XMAC was not initialized but Packet timeout occured */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E005
comma
id|SKERR_SIRQ_E005MSG
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_PA_TO_RX1
)paren
(brace
multiline_comment|/* Means network is filling us up */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E002
comma
id|SKERR_SIRQ_E002MSG
)paren
suffix:semicolon
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_PA_CTRL
comma
id|PA_CLR_TO_RX1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_PA_TO_RX2
)paren
(brace
multiline_comment|/* Means network is filling us up */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_HW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E003
comma
id|SKERR_SIRQ_E003MSG
)paren
suffix:semicolon
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_PA_CTRL
comma
id|PA_CLR_TO_RX2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_PA_TO_TX1
)paren
(brace
multiline_comment|/* May be a normal situation in a server with a slow network */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_PA_CTRL
comma
id|PA_CLR_TO_TX1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_PA_TO_TX2
)paren
(brace
multiline_comment|/* May be a normal situation in a server with a slow network */
id|SK_OUT16
c_func
(paren
id|IoC
comma
id|B3_PA_CTRL
comma
id|PA_CLR_TO_TX2
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Check interrupts of the particular queues.&n;&t; */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_R1_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_R1_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E006
comma
id|SKERR_SIRQ_E006MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_R2_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_R2_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E007
comma
id|SKERR_SIRQ_E007MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_XS1_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_XS1_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E008
comma
id|SKERR_SIRQ_E008MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_XA1_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_XA1_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E009
comma
id|SKERR_SIRQ_E009MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_XS2_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_XS2_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E010
comma
id|SKERR_SIRQ_E010MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_XA2_C
)paren
(brace
multiline_comment|/* Clear IRQ */
id|SK_OUT32
c_func
(paren
id|IoC
comma
id|B0_XA2_CSR
comma
id|CSR_IRQ_CL_C
)paren
suffix:semicolon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E011
comma
id|SKERR_SIRQ_E011MSG
)paren
suffix:semicolon
id|Para.Para64
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_FAIL
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|MAC_2
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * external reg interrupt&n;&t; */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_EXT_REG
)paren
(brace
id|SK_U16
id|PhyInt
suffix:semicolon
id|SK_U16
id|PhyIMsk
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* test IRQs from PHY */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PhyType
)paren
(brace
r_case
id|SK_PHY_XMAC
suffix:colon
r_break
suffix:semicolon
r_case
id|SK_PHY_BCOM
suffix:colon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PState
)paren
(brace
id|PHY_READ
c_func
(paren
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
comma
id|i
comma
id|PHY_BCOM_INT_STAT
comma
op_amp
id|PhyInt
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
comma
id|i
comma
id|PHY_BCOM_INT_MASK
comma
op_amp
id|PhyIMsk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhyInt
op_amp
(paren
op_complement
id|PhyIMsk
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Port %d Bcom Int: %x &quot;
l_string|&quot; Mask: %x&bslash;n&quot;
comma
id|i
comma
id|PhyInt
comma
id|PhyIMsk
)paren
)paren
suffix:semicolon
id|SkPhyIsrBcom
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
(paren
id|SK_U16
)paren
(paren
id|PhyInt
op_amp
(paren
op_complement
id|PhyIMsk
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
)brace
r_break
suffix:semicolon
r_case
id|SK_PHY_LONE
suffix:colon
id|PHY_READ
c_func
(paren
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
comma
id|i
comma
id|PHY_LONE_INT_STAT
comma
op_amp
id|PhyInt
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
comma
id|i
comma
id|PHY_LONE_INT_ENAB
comma
op_amp
id|PhyIMsk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhyInt
op_amp
id|PhyIMsk
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Port %d  Lone Int: %x &quot;
l_string|&quot; Mask: %x&bslash;n&quot;
comma
id|i
comma
id|PhyInt
comma
id|PhyIMsk
)paren
)paren
suffix:semicolon
id|SkPhyIsrLone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
(paren
id|SK_U16
)paren
(paren
id|PhyInt
op_amp
id|PhyIMsk
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_PHY_NAT
suffix:colon
multiline_comment|/* todo: National */
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; * I2C Ready interrupt&n;&t; */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_I2C_READY
)paren
(brace
id|SkI2cIsr
c_func
(paren
id|pAC
comma
id|IoC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_LNK_SYNC_M1
)paren
(brace
multiline_comment|/*&n;&t;&t; * We do NOT need the Link Sync interrupt, because it shows&n;&t;&t; * us only a link going down.&n;&t;&t; */
multiline_comment|/* clear interrupt */
id|SK_OUT8
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_1
comma
id|LNK_SYNC_CTRL
)paren
comma
id|LED_CLR_IRQ
)paren
suffix:semicolon
)brace
multiline_comment|/* Check MAC after link sync counter */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_MAC1
)paren
(brace
id|XM_IN16
c_func
(paren
id|IoC
comma
id|MAC_1
comma
id|XM_ISRC
comma
op_amp
id|XmIsr
)paren
suffix:semicolon
id|SkXmIrq
c_func
(paren
id|pAC
comma
id|IoC
comma
id|MAC_1
comma
id|XmIsr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_LNK_SYNC_M2
)paren
(brace
multiline_comment|/*&n;&t;&t; * We do NOT need the Link Sync interrupt, because it shows&n;&t;&t; * us only a link going down.&n;&t;&t; */
multiline_comment|/* clear interrupt */
id|SK_OUT8
c_func
(paren
id|IoC
comma
id|MR_ADDR
c_func
(paren
id|MAC_2
comma
id|LNK_SYNC_CTRL
)paren
comma
id|LED_CLR_IRQ
)paren
suffix:semicolon
)brace
multiline_comment|/* Check MAC after link sync counter */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_MAC2
)paren
(brace
id|XM_IN16
c_func
(paren
id|IoC
comma
id|MAC_2
comma
id|XM_ISRC
comma
op_amp
id|XmIsr
)paren
suffix:semicolon
id|SkXmIrq
c_func
(paren
id|pAC
comma
id|IoC
comma
id|MAC_2
comma
id|XmIsr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Timer interrupt&n;&t; *  To be served last&n;&t; */
r_if
c_cond
(paren
id|Istatus
op_amp
id|IS_TIMINT
)paren
(brace
id|SkHwtIsr
c_func
(paren
id|pAC
comma
id|IoC
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Define an array of RX counter which are checked&n; * in AutoSense mode to check whether a link is not able to autonegotiate.&n; */
DECL|variable|SkGeRxOids
r_static
r_const
id|SK_U32
id|SkGeRxOids
(braket
)braket
op_assign
(brace
id|OID_SKGE_STAT_RX_64
comma
id|OID_SKGE_STAT_RX_127
comma
id|OID_SKGE_STAT_RX_255
comma
id|OID_SKGE_STAT_RX_511
comma
id|OID_SKGE_STAT_RX_1023
comma
id|OID_SKGE_STAT_RX_MAX
comma
)brace
suffix:semicolon
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckShorts - Implementing of the Workaround Errata # 2&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; */
DECL|function|SkGePortCheckShorts
r_int
id|SkGePortCheckShorts
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
id|SK_U64
id|Shorts
suffix:semicolon
multiline_comment|/* Short Event Counter */
id|SK_U64
id|CheckShorts
suffix:semicolon
multiline_comment|/* Check value for Short Event Counter */
id|SK_U64
id|RxCts
suffix:semicolon
multiline_comment|/* RX Counter (packets on network) */
id|SK_U64
id|RxTmp
suffix:semicolon
multiline_comment|/* RX temp. Counter */
id|SK_U64
id|FcsErrCts
suffix:semicolon
multiline_comment|/* FCS Error Counter */
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
r_int
r_int
id|Len
suffix:semicolon
r_int
id|Rtv
suffix:semicolon
multiline_comment|/* Return value */
r_int
id|i
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
multiline_comment|/* Default: no action */
id|Rtv
op_assign
id|SK_HW_PS_NONE
suffix:semicolon
multiline_comment|/*&n;&t; * Extra precaution: check for short Event counter&n;&t; */
id|Len
op_assign
r_sizeof
(paren
id|SK_U64
)paren
suffix:semicolon
id|SkPnmiGetVar
c_func
(paren
id|pAC
comma
id|IoC
comma
id|OID_SKGE_STAT_RX_SHORTS
comma
(paren
r_char
op_star
)paren
op_amp
id|Shorts
comma
op_amp
id|Len
comma
(paren
id|SK_U32
)paren
id|SK_PNMI_PORT_PHYS2INST
c_func
(paren
id|Port
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Read RX counter (packets seen on the network and not neccesarily&n;&t; * really received.&n;&t; */
id|Len
op_assign
r_sizeof
(paren
id|SK_U64
)paren
suffix:semicolon
id|RxCts
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|SkGeRxOids
)paren
op_div
r_sizeof
(paren
id|SK_U32
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SkPnmiGetVar
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SkGeRxOids
(braket
id|i
)braket
comma
(paren
r_char
op_star
)paren
op_amp
id|RxTmp
comma
op_amp
id|Len
comma
(paren
id|SK_U32
)paren
id|SK_PNMI_PORT_PHYS2INST
c_func
(paren
id|Port
)paren
)paren
suffix:semicolon
id|RxCts
op_add_assign
id|RxTmp
suffix:semicolon
)brace
multiline_comment|/* On default: check shorts against zero */
id|CheckShorts
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Extra extra precaution on active links:&n;&t; */
r_if
c_cond
(paren
id|pPrt-&gt;PHWLinkUp
)paren
(brace
multiline_comment|/*&n;&t;&t; * Reset Link Restart counter&n;&t;&t; */
id|pPrt-&gt;PLinkResCt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If link is up check for 2 */
id|CheckShorts
op_assign
l_int|2
suffix:semicolon
id|Len
op_assign
r_sizeof
(paren
id|SK_U64
)paren
suffix:semicolon
id|SkPnmiGetVar
c_func
(paren
id|pAC
comma
id|IoC
comma
id|OID_SKGE_STAT_RX_FCS
comma
(paren
r_char
op_star
)paren
op_amp
id|FcsErrCts
comma
op_amp
id|Len
comma
(paren
id|SK_U32
)paren
id|SK_PNMI_PORT_PHYS2INST
c_func
(paren
id|Port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_eq
id|SK_LMODE_AUTOSENSE
op_logical_and
id|pPrt-&gt;PLipaAutoNeg
op_eq
id|SK_LIPA_UNKNOWN
op_logical_and
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_HALF
op_logical_or
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_FULL
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * This is autosensing and we are in the fallback&n;&t;&t;&t; * manual full/half duplex mode.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|RxCts
op_eq
id|pPrt-&gt;PPrevRx
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Nothing received&n;&t;&t;&t;&t; * restart link&n;&t;&t;&t;&t; */
id|pPrt-&gt;PPrevFcs
op_assign
id|FcsErrCts
suffix:semicolon
id|pPrt-&gt;PPrevShorts
op_assign
id|Shorts
suffix:semicolon
r_return
id|SK_HW_PS_RESTART
suffix:semicolon
)brace
r_else
(brace
id|pPrt-&gt;PLipaAutoNeg
op_assign
id|SK_LIPA_MANUAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|RxCts
op_minus
id|pPrt-&gt;PPrevRx
)paren
OG
id|pPrt-&gt;PRxLim
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|FcsErrCts
op_minus
id|pPrt-&gt;PPrevFcs
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Note: The compare with zero above has to be done&n;&t;&t;&t; * the way shown, otherwise the Linux driver will&n;&t;&t;&t; * have a problem.&n;&t;&t;&t; */
multiline_comment|/*&n;&t;&t;&t; * we received a bunch of frames or no&n;&t;&t;&t; * CRC error occured on the network -&gt;&n;&t;&t;&t; * ok.&n;&t;&t;&t; */
id|pPrt-&gt;PPrevRx
op_assign
id|RxCts
suffix:semicolon
id|pPrt-&gt;PPrevFcs
op_assign
id|FcsErrCts
suffix:semicolon
id|pPrt-&gt;PPrevShorts
op_assign
id|Shorts
suffix:semicolon
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
id|pPrt-&gt;PPrevFcs
op_assign
id|FcsErrCts
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|Shorts
op_minus
id|pPrt-&gt;PPrevShorts
)paren
OG
id|CheckShorts
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Short Event Count Restart Port %d &bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|Rtv
op_assign
id|SK_HW_PS_RESTART
suffix:semicolon
)brace
id|pPrt-&gt;PPrevShorts
op_assign
id|Shorts
suffix:semicolon
id|pPrt-&gt;PPrevRx
op_assign
id|RxCts
suffix:semicolon
r_return
id|Rtv
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckUp - Implementing of the Workaround Errata # 2&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; *&t;2&t;Link came up&n; */
DECL|function|SkGePortCheckUp
r_int
id|SkGePortCheckUp
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|pPrt-&gt;PhyType
)paren
(brace
r_case
id|SK_PHY_XMAC
suffix:colon
r_return
(paren
id|SkGePortCheckUpXmac
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
)paren
suffix:semicolon
r_case
id|SK_PHY_BCOM
suffix:colon
r_return
(paren
id|SkGePortCheckUpBcom
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
)paren
suffix:semicolon
r_case
id|SK_PHY_LONE
suffix:colon
r_return
(paren
id|SkGePortCheckUpLone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
)paren
suffix:semicolon
r_case
id|SK_PHY_NAT
suffix:colon
r_return
(paren
id|SkGePortCheckUpNat
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckUpXmac - Implementing of the Workaround Errata # 2&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; *&t;2&t;Link came up&n; */
DECL|function|SkGePortCheckUpXmac
r_static
r_int
id|SkGePortCheckUpXmac
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
id|SK_BOOL
id|AutoNeg
suffix:semicolon
multiline_comment|/* Is Autonegotiation used ? */
id|SK_U16
id|Isrc
suffix:semicolon
multiline_comment|/* Interrupt source register */
id|SK_U32
id|GpReg
suffix:semicolon
multiline_comment|/* General Purpose register value */
id|SK_U16
id|IsrcSum
suffix:semicolon
multiline_comment|/* Interrupt source register sum */
id|SK_U16
id|LpAb
suffix:semicolon
multiline_comment|/* Link Partner Ability */
id|SK_U16
id|ResAb
suffix:semicolon
multiline_comment|/* Resolved Ability */
id|SK_U64
id|Shorts
suffix:semicolon
multiline_comment|/* Short Event Counter */
r_int
r_int
id|Len
suffix:semicolon
id|SK_U8
id|NextMode
suffix:semicolon
multiline_comment|/* Next AutoSensing Mode */
id|SK_U16
id|ExtStat
suffix:semicolon
multiline_comment|/* Extended Status Register */
r_int
id|Done
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PHWLinkUp
)paren
(brace
r_if
c_cond
(paren
id|pPrt-&gt;PhyType
op_ne
id|SK_PHY_XMAC
)paren
(brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SkGePortCheckShorts
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
)brace
id|IsrcSum
op_assign
id|pPrt-&gt;PIsave
suffix:semicolon
id|pPrt-&gt;PIsave
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now wait for each ports link */
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_HALF
op_logical_or
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_FULL
)paren
(brace
id|AutoNeg
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
(brace
id|AutoNeg
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pPrt-&gt;PLinkBroken
)paren
(brace
multiline_comment|/* Link was broken */
id|XM_IN32
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_GP_PORT
comma
op_amp
id|GpReg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|GpReg
op_amp
id|XM_GP_INP_ASS
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* The Link is in sync */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|IsrcSum
op_or_assign
id|Isrc
suffix:semicolon
id|SkXmAutoNegLipaXmac
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|IsrcSum
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Isrc
op_amp
id|XM_IS_INP_ASS
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* It has been in sync since last Time */
multiline_comment|/* Restart the PORT */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link in sync Restart Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * We now need to reinitialize the PrevSHorts&n;&t;&t;&t;&t; * counter.&n;&t;&t;&t;&t; */
id|Len
op_assign
r_sizeof
(paren
id|SK_U64
)paren
suffix:semicolon
id|SkPnmiGetVar
c_func
(paren
id|pAC
comma
id|IoC
comma
id|OID_SKGE_STAT_RX_SHORTS
comma
(paren
r_char
op_star
)paren
op_amp
id|Shorts
comma
op_amp
id|Len
comma
(paren
id|SK_U32
)paren
id|SK_PNMI_PORT_PHYS2INST
c_func
(paren
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PPrevShorts
op_assign
id|Shorts
suffix:semicolon
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkBroken
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Link Restart Workaround:&n;&t;&t;&t;&t; *  it may be possible that the other Link side&n;&t;&t;&t;&t; *  restarts its link as well an we detect&n;&t;&t;&t;&t; *  another LinkBroken. To prevent this&n;&t;&t;&t;&t; *  happening we check for a maximum number&n;&t;&t;&t;&t; *  of consecutive restart. If those happens,&n;&t;&t;&t;&t; *  we do NOT restart the active link and&n;&t;&t;&t;&t; *  check whether the lionk is now o.k.&n;&t;&t;&t;&t; */
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkResCt
op_increment
suffix:semicolon
id|pPrt-&gt;PAutoNegTimeOut
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkResCt
OL
id|SK_MAX_LRESTART
)paren
(brace
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Do NOT restart on Port %d %x %x&bslash;n&quot;
comma
id|Port
comma
id|Isrc
comma
id|IsrcSum
)paren
)paren
suffix:semicolon
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkResCt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|pPrt-&gt;PIsave
op_assign
(paren
id|SK_U16
)paren
(paren
id|IsrcSum
op_amp
(paren
id|XM_IS_AND
)paren
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Save Sync/nosync Port %d %x %x&bslash;n&quot;
comma
id|Port
comma
id|Isrc
comma
id|IsrcSum
)paren
)paren
suffix:semicolon
multiline_comment|/* Do nothing more if link is broken */
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Do nothing more if link is broken */
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Link was not broken, check if it is */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|IsrcSum
op_or_assign
id|Isrc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Isrc
op_amp
id|XM_IS_INP_ASS
)paren
op_eq
id|XM_IS_INP_ASS
)paren
(brace
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|IsrcSum
op_or_assign
id|Isrc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Isrc
op_amp
id|XM_IS_INP_ASS
)paren
op_eq
id|XM_IS_INP_ASS
)paren
(brace
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|IsrcSum
op_or_assign
id|Isrc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Isrc
op_amp
id|XM_IS_INP_ASS
)paren
op_eq
id|XM_IS_INP_ASS
)paren
(brace
id|pPrt-&gt;PLinkBroken
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Re-Init Link partner Autoneg flag&n;&t;&t;&t;&t;&t; */
id|pPrt-&gt;PLipaAutoNeg
op_assign
id|SK_LIPA_UNKNOWN
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link broken Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
multiline_comment|/* cable removed-&gt; reinit Sensemode */
multiline_comment|/* Init default sense mode */
id|SkHWInitDefSense
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|SkXmAutoNegLipaXmac
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|Isrc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SkGePortCheckShorts
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
op_eq
id|SK_HW_PS_RESTART
)paren
(brace
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; * here we usually can check whether the link is in sync and&n;&t; * autonegotiation is done.&n;&t; */
id|XM_IN32
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_GP_PORT
comma
op_amp
id|GpReg
)paren
suffix:semicolon
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|IsrcSum
op_or_assign
id|Isrc
suffix:semicolon
id|SkXmAutoNegLipaXmac
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|IsrcSum
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|GpReg
op_amp
id|XM_GP_INP_ASS
)paren
op_ne
l_int|0
op_logical_or
(paren
id|IsrcSum
op_amp
id|XM_IS_INP_ASS
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|GpReg
op_amp
id|XM_GP_INP_ASS
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Save Autonegotiation Done interrupt only if link &n;&t;&t;&t; * is in sync&n;&t;&t;&t; */
id|pPrt-&gt;PIsave
op_assign
(paren
id|SK_U16
)paren
(paren
id|IsrcSum
op_amp
(paren
id|XM_IS_AND
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;DEBUG
r_if
c_cond
(paren
id|pPrt-&gt;PIsave
op_amp
(paren
id|XM_IS_AND
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg done rescheduled Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoNeg
)paren
(brace
r_if
c_cond
(paren
id|IsrcSum
op_amp
id|XM_IS_AND
)paren
(brace
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
id|Done
op_assign
id|SkXmAutoNegDone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Done
op_ne
id|SK_AND_OK
)paren
(brace
multiline_comment|/* Get PHY parameters, for debuging only */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_XMAC_AUNE_LP
comma
op_amp
id|LpAb
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_XMAC_RES_ABI
comma
op_amp
id|ResAb
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg FAIL Port %d (LpAb %x, ResAb %x)&bslash;n&quot;
comma
id|Port
comma
id|LpAb
comma
id|ResAb
)paren
)paren
suffix:semicolon
multiline_comment|/* Try next possible mode */
id|NextMode
op_assign
id|SkHWSenseGetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Done
op_eq
id|SK_AND_DUP_CAP
)paren
(brace
multiline_comment|/* GoTo next mode */
id|SkHWSenseSetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|NextMode
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Dummy Read extended status to prevent&n;&t;&t;&t;&t; * extra link down/ups&n;&t;&t;&t;&t; * (clear Page Received bit if set)&n;&t;&t;&t;&t; */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_XMAC_AUNE_EXP
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg done Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * AutoNeg not done, but HW link is up. Check for timeouts&n;&t;&t; */
id|pPrt-&gt;PAutoNegTimeOut
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PAutoNegTimeOut
op_ge
id|SK_AND_MAX_TO
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Timeout occured.&n;&t;&t;&t; * What do we need now?&n;&t;&t;&t; */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;AutoNeg timeout Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_eq
id|SK_LMODE_AUTOSENSE
op_logical_and
id|pPrt-&gt;PLipaAutoNeg
op_ne
id|SK_LIPA_AUTO
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Timeout occured&n;&t;&t;&t;&t; * Set Link manually up.&n;&t;&t;&t;&t; */
id|SkHWSenseSetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|SK_LMODE_FULL
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Set manual full duplex Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * Do the restart&n;&t;&t;&t; */
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Link is up and we don&squot;t need more.&n;&t;&t; */
macro_line|#ifdef&t;DEBUG
r_if
c_cond
(paren
id|pPrt-&gt;PLipaAutoNeg
op_eq
id|SK_LIPA_AUTO
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;ERROR: Lipa auto detected on port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link sync(GP), Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckUpBcom - Check, if the link is up&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; *&t;2&t;Link came up&n; */
DECL|function|SkGePortCheckUpBcom
r_static
r_int
id|SkGePortCheckUpBcom
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
id|SK_BOOL
id|AutoNeg
suffix:semicolon
multiline_comment|/* Is Autonegotiation used ? */
id|SK_U16
id|Isrc
suffix:semicolon
multiline_comment|/* Interrupt source register */
id|SK_U16
id|LpAb
suffix:semicolon
multiline_comment|/* Link Partner Ability */
id|SK_U16
id|ExtStat
suffix:semicolon
multiline_comment|/* Extended Status Register */
id|SK_U16
id|PhyStat
suffix:semicolon
multiline_comment|/* Phy Status Register */
r_int
id|Done
suffix:semicolon
id|SK_U16
id|ResAb
suffix:semicolon
id|SK_U16
id|SWord
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
multiline_comment|/* Check for No HCD Link events (#10523) */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_INT_STAT
comma
op_amp
id|Isrc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Isrc
op_amp
id|PHY_B_IS_NO_HDCL
)paren
op_eq
id|PHY_B_IS_NO_HDCL
)paren
(brace
multiline_comment|/* Workaround BCOM Errata */
multiline_comment|/* enable and disable Loopback mode if NO HCD occurs */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_CTRL
comma
op_amp
id|SWord
)paren
suffix:semicolon
id|PHY_WRITE
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_CTRL
comma
id|SWord
op_or
id|PHY_CT_LOOP
)paren
suffix:semicolon
id|PHY_WRITE
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_CTRL
comma
id|SWord
op_amp
op_complement
id|PHY_CT_LOOP
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;No HCD Link event, Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_STAT
comma
op_amp
id|PhyStat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PHWLinkUp
)paren
(brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
id|pPrt-&gt;PIsave
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now wait for each port&squot;s link */
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_HALF
op_logical_or
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_FULL
)paren
(brace
id|AutoNeg
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
(brace
id|AutoNeg
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * here we usually can check whether the link is in sync and&n;&t; * autonegotiation is done.&n;&t; */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_STAT
comma
op_amp
id|PhyStat
)paren
suffix:semicolon
id|SkXmAutoNegLipaBcom
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|PhyStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg:%d, PhyStat: %Xh.&bslash;n&quot;
comma
id|AutoNeg
comma
id|PhyStat
)paren
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_1000T_STAT
comma
op_amp
id|ResAb
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|PhyStat
op_amp
id|PHY_ST_LSYNC
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ResAb
op_amp
(paren
id|PHY_B_1000S_MSF
)paren
)paren
(brace
multiline_comment|/* Error */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Master/Slave Fault port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PAutoNegFail
op_assign
id|SK_TRUE
suffix:semicolon
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_FAULT
suffix:semicolon
r_return
(paren
id|SK_AND_OTHER
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ResAb
op_amp
(paren
id|PHY_B_1000S_MSF
)paren
)paren
(brace
multiline_comment|/* Error */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Master/Slave Fault port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PAutoNegFail
op_assign
id|SK_TRUE
suffix:semicolon
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_FAULT
suffix:semicolon
r_return
(paren
id|SK_AND_OTHER
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ResAb
op_amp
id|PHY_B_1000S_MSR
)paren
(brace
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_MASTER
suffix:semicolon
)brace
r_else
(brace
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_SLAVE
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg:%d, PhyStat: %Xh.&bslash;n&quot;
comma
id|AutoNeg
comma
id|PhyStat
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AutoNeg
)paren
(brace
r_if
c_cond
(paren
id|PhyStat
op_amp
id|PHY_ST_AN_OVER
)paren
(brace
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
id|Done
op_assign
id|SkXmAutoNegDone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Done
op_ne
id|SK_AND_OK
)paren
(brace
multiline_comment|/* Get PHY parameters, for debuging only */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_AUNE_LP
comma
op_amp
id|LpAb
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_1000T_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg FAIL Port %d (LpAb %x, &quot;
l_string|&quot;1000TStat %x)&bslash;n&quot;
comma
id|Port
comma
id|LpAb
comma
id|ExtStat
)paren
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Dummy Read interrupt status to prevent&n;&t;&t;&t;&t; * extra link down/ups&n;&t;&t;&t;&t; */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_INT_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg done Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Link is up and we don&squot;t need more.&n;&t;&t; */
macro_line|#ifdef&t;DEBUG
r_if
c_cond
(paren
id|pPrt-&gt;PLipaAutoNeg
op_eq
id|SK_LIPA_AUTO
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;ERROR: Lipa auto detected on port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if 0
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_1000T_STAT
comma
op_amp
id|ResAb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ResAb
op_amp
(paren
id|PHY_B_1000S_MSF
)paren
)paren
(brace
multiline_comment|/* Error */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Master/Slave Fault port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|pPrt-&gt;PAutoNegFail
op_assign
id|SK_TRUE
suffix:semicolon
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_FAULT
suffix:semicolon
r_return
(paren
id|SK_AND_OTHER
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ResAb
op_amp
id|PHY_B_1000S_MSR
)paren
(brace
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_MASTER
suffix:semicolon
)brace
r_else
(brace
id|pPrt-&gt;PMSStatus
op_assign
id|SK_MS_STAT_SLAVE
suffix:semicolon
)brace
macro_line|#endif&t;/* 0 */
multiline_comment|/*&n;&t;&t; * Dummy Read interrupt status to prevent&n;&t;&t; * extra link down/ups&n;&t;&t; */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_BCOM_INT_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link sync(GP), Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckUpLone - Check if the link is up&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; *&t;2&t;Link came up&n; */
DECL|function|SkGePortCheckUpLone
r_static
r_int
id|SkGePortCheckUpLone
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
id|SK_GEPORT
op_star
id|pPrt
suffix:semicolon
multiline_comment|/* GIni Port struct pointer */
id|SK_BOOL
id|AutoNeg
suffix:semicolon
multiline_comment|/* Is Autonegotiation used ? */
id|SK_U16
id|Isrc
suffix:semicolon
multiline_comment|/* Interrupt source register */
id|SK_U16
id|LpAb
suffix:semicolon
multiline_comment|/* Link Partner Ability */
id|SK_U8
id|NextMode
suffix:semicolon
multiline_comment|/* Next AutoSensing Mode */
id|SK_U16
id|ExtStat
suffix:semicolon
multiline_comment|/* Extended Status Register */
id|SK_U16
id|PhyStat
suffix:semicolon
multiline_comment|/* Phy Status Register */
id|SK_U16
id|StatSum
suffix:semicolon
r_int
id|Done
suffix:semicolon
id|pPrt
op_assign
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PHWLinkUp
)paren
(brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
id|StatSum
op_assign
id|pPrt-&gt;PIsave
suffix:semicolon
id|pPrt-&gt;PIsave
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now wait for each ports link */
r_if
c_cond
(paren
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_HALF
op_logical_or
id|pPrt-&gt;PLinkMode
op_eq
id|SK_LMODE_FULL
)paren
(brace
id|AutoNeg
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
(brace
id|AutoNeg
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * here we usually can check whether the link is in sync and&n;&t; * autonegotiation is done.&n;&t; */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|Port
comma
id|XM_ISRC
comma
op_amp
id|Isrc
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_STAT
comma
op_amp
id|PhyStat
)paren
suffix:semicolon
id|StatSum
op_or_assign
id|PhyStat
suffix:semicolon
id|SkXmAutoNegLipaLone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|PhyStat
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|PhyStat
op_amp
id|PHY_ST_LSYNC
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * Save Autonegotiation Done bit&n;&t;&t; */
id|pPrt-&gt;PIsave
op_assign
(paren
id|SK_U16
)paren
(paren
id|StatSum
op_amp
id|PHY_ST_AN_OVER
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|pPrt-&gt;PIsave
op_amp
id|PHY_ST_AN_OVER
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg done rescheduled Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoNeg
)paren
(brace
r_if
c_cond
(paren
id|StatSum
op_amp
id|PHY_ST_AN_OVER
)paren
(brace
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
id|Done
op_assign
id|SkXmAutoNegDone
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Done
op_ne
id|SK_AND_OK
)paren
(brace
multiline_comment|/* Get PHY parameters, for debuging only */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_AUNE_LP
comma
op_amp
id|LpAb
)paren
suffix:semicolon
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_1000T_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg FAIL Port %d (LpAb %x, 1000TStat %x)&bslash;n&quot;
comma
id|Port
comma
id|LpAb
comma
id|ExtStat
)paren
)paren
suffix:semicolon
multiline_comment|/* Try next possible mode */
id|NextMode
op_assign
id|SkHWSenseGetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Done
op_eq
id|SK_AND_DUP_CAP
)paren
(brace
multiline_comment|/* GoTo next mode */
id|SkHWSenseSetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|NextMode
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Dummy Read interrupt status to prevent&n;&t;&t;&t;&t; * extra link down/ups&n;&t;&t;&t;&t; */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_INT_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;AutoNeg done Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * AutoNeg not done, but HW link is up. Check for timeouts&n;&t;&t; */
id|pPrt-&gt;PAutoNegTimeOut
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PAutoNegTimeOut
op_ge
id|SK_AND_MAX_TO
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Timeout occured.&n;&t;&t;&t; * What do we need now?&n;&t;&t;&t; */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;AutoNeg timeout Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pPrt-&gt;PLinkModeConf
op_eq
id|SK_LMODE_AUTOSENSE
op_logical_and
id|pPrt-&gt;PLipaAutoNeg
op_ne
id|SK_LIPA_AUTO
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Timeout occured&n;&t;&t;&t;&t; * Set Link manually up.&n;&t;&t;&t;&t; */
id|SkHWSenseSetNext
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
comma
id|SK_LMODE_FULL
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Set manual full duplex Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * Do the restart&n;&t;&t;&t; */
r_return
(paren
id|SK_HW_PS_RESTART
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Link is up and we don&squot;t need more.&n;&t;&t; */
macro_line|#ifdef&t;DEBUG
r_if
c_cond
(paren
id|pPrt-&gt;PLipaAutoNeg
op_eq
id|SK_LIPA_AUTO
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;ERROR: Lipa auto detected on port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t;&t; * Dummy Read interrupt status to prevent&n;&t;&t; * extra link down/ups&n;&t;&t; */
id|PHY_READ
c_func
(paren
id|IoC
comma
id|pPrt
comma
id|Port
comma
id|PHY_LONE_INT_STAT
comma
op_amp
id|ExtStat
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_HWM
comma
id|SK_DBGCAT_IRQ
comma
(paren
l_string|&quot;Link sync(GP), Port %d&bslash;n&quot;
comma
id|Port
)paren
)paren
suffix:semicolon
id|SkHWLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_return
(paren
id|SK_HW_PS_LINK
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * SkGePortCheckUpNat - Check if the link is up&n; *&n; * return:&n; *&t;0&t;o.k. nothing needed&n; *&t;1&t;Restart needed on this port&n; *&t;2&t;Link came up&n; */
DECL|function|SkGePortCheckUpNat
r_static
r_int
id|SkGePortCheckUpNat
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* IO Context */
r_int
id|Port
)paren
multiline_comment|/* Which port should be checked */
(brace
multiline_comment|/* todo: National */
r_return
(paren
id|SK_HW_PS_NONE
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;Event service routine&n; *&n; * Description:&n; *&n; * Notes:&n; */
DECL|function|SkGeSirqEvent
r_int
id|SkGeSirqEvent
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* Io Context */
id|SK_U32
id|Event
comma
multiline_comment|/* Module specific Event */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* Event specific Parameter */
(brace
id|SK_U32
id|Port
suffix:semicolon
id|SK_U32
id|Time
suffix:semicolon
id|SK_U8
id|Val8
suffix:semicolon
r_int
id|PortStat
suffix:semicolon
id|Port
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|Event
)paren
(brace
r_case
id|SK_HWEV_WATIM
suffix:colon
multiline_comment|/* Check whether port came up */
id|PortStat
op_assign
id|SkGePortCheckUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|PortStat
)paren
(brace
r_case
id|SK_HW_PS_RESTART
suffix:colon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PHWLinkUp
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Set Link to down.&n;&t;&t;&t;&t; */
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Signal directly to RLMT to ensure correct&n;&t;&t;&t;&t; * sequence of SWITCH and RESET event.&n;&t;&t;&t;&t; */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
(paren
id|SK_U32
)paren
id|Port
suffix:semicolon
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
multiline_comment|/* Start workaround Errata #2 timer */
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
comma
id|SK_WA_INA_TIME
comma
id|SKGE_HWAC
comma
id|SK_HWEV_WATIM
comma
id|Para
)paren
suffix:semicolon
)brace
multiline_comment|/* Restart needed */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_RESET
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_HW_PS_LINK
suffix:colon
multiline_comment|/* Signal to RLMT */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_UP
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Start again the check Timer */
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PHWLinkUp
)paren
(brace
id|Time
op_assign
id|SK_WA_ACT_TIME
suffix:semicolon
)brace
r_else
(brace
id|Time
op_assign
id|SK_WA_INA_TIME
suffix:semicolon
)brace
multiline_comment|/* todo: still needed for non-Xmac-PHYs ??? */
multiline_comment|/* Start workaround Errata #2 timer */
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
comma
id|Time
comma
id|SKGE_HWAC
comma
id|SK_HWEV_WATIM
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_HWEV_PORT_START
suffix:colon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PHWLinkUp
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Signal directly to RLMT to ensure correct&n;&t;&t;&t; * sequence of SWITCH and RESET event.&n;&t;&t;&t; */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
(paren
id|SK_U32
)paren
id|Port
suffix:semicolon
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
multiline_comment|/* Schedule Port RESET */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_PORT_RESET
comma
id|Para
)paren
suffix:semicolon
multiline_comment|/* Start workaround Errata #2 timer */
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
comma
id|SK_WA_INA_TIME
comma
id|SKGE_HWAC
comma
id|SK_HWEV_WATIM
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_HWEV_PORT_STOP
suffix:colon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PHWLinkUp
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Signal directly to RLMT to ensure correct&n;&t;&t;&t; * sequence of SWITCH and RESET event.&n;&t;&t;&t; */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
(paren
id|SK_U32
)paren
id|Port
suffix:semicolon
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
multiline_comment|/* Stop Workaround Timer */
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
)paren
suffix:semicolon
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_HWEV_UPDATE_STAT
suffix:colon
multiline_comment|/* We do NOT need to update any statistics */
r_break
suffix:semicolon
r_case
id|SK_HWEV_CLEAR_STAT
suffix:colon
multiline_comment|/* We do NOT need to clear any statistics */
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PPrevRx
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PPrevFcs
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PPrevShorts
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_HWEV_SET_LMODE
suffix:colon
id|Val8
op_assign
(paren
id|SK_U8
)paren
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkModeConf
op_ne
id|Val8
)paren
(brace
multiline_comment|/* Set New link mode */
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PLinkModeConf
op_assign
id|Val8
suffix:semicolon
multiline_comment|/* Restart Port */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_STOP
comma
id|Para
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_START
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_HWEV_SET_FLOWMODE
suffix:colon
id|Val8
op_assign
(paren
id|SK_U8
)paren
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PFlowCtrlMode
op_ne
id|Val8
)paren
(brace
multiline_comment|/* Set New Flow Control mode */
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PFlowCtrlMode
op_assign
id|Val8
suffix:semicolon
multiline_comment|/* Restart Port */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_STOP
comma
id|Para
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_START
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_HWEV_SET_ROLE
suffix:colon
id|Val8
op_assign
(paren
id|SK_U8
)paren
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PMSMode
op_ne
id|Val8
)paren
(brace
multiline_comment|/* Set New link mode */
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PMSMode
op_assign
id|Val8
suffix:semicolon
multiline_comment|/* Restart Port */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_STOP
comma
id|Para
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_START
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_SIRQ_E001
comma
id|SKERR_SIRQ_E001MSG
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkPhyIsrBcom - PHY interrupt service routine&n; *&n; * Description: handle all interrupts from BCOM PHY&n; *&n; * Returns: N/A&n; */
DECL|function|SkPhyIsrBcom
r_static
r_void
id|SkPhyIsrBcom
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* Io Context */
r_int
id|Port
comma
multiline_comment|/* Port Num = PHY Num */
id|SK_U16
id|IStatus
)paren
multiline_comment|/* Interrupts masked with PHY-Mask */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_PSE
)paren
(brace
multiline_comment|/* incorrectable pair swap error */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
op_or
id|SK_ERRCL_INIT
comma
id|SKERR_SIRQ_E022
comma
id|SKERR_SIRQ_E022MSG
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_MDXI_SC
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_HCT
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_LCT
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
(paren
id|PHY_B_IS_AN_PR
op_or
id|PHY_B_IS_LST_CHANGE
)paren
)paren
(brace
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
multiline_comment|/* Signal to RLMT */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
(paren
id|SK_U32
)paren
id|Port
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
multiline_comment|/* Start workaround Errata #2 timer */
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
comma
id|SK_WA_INA_TIME
comma
id|SKGE_HWAC
comma
id|SK_HWEV_WATIM
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_NO_HDCL
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_NO_HDC
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_NEG_USHDC
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_SCR_S_ER
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_RRS_CHANGE
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_LRS_CHANGE
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_DUP_CHANGE
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_LSP_CHANGE
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_B_IS_CRC_ER
)paren
(brace
multiline_comment|/* not used */
)brace
)brace
multiline_comment|/******************************************************************************&n; *&n; *&t;SkPhyIsrLone - PHY interrupt service routine&n; *&n; * Description: handle all interrupts from LONE PHY&n; *&n; * Returns: N/A&n; */
DECL|function|SkPhyIsrLone
r_static
r_void
id|SkPhyIsrLone
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapters context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* Io Context */
r_int
id|Port
comma
multiline_comment|/* Port Num = PHY Num */
id|SK_U16
id|IStatus
)paren
multiline_comment|/* Interrupts masked with PHY-Mask */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_CROSS
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_POL
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_SS
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_CFULL
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_AN_C
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_SPEED
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_CFULL
)paren
(brace
multiline_comment|/* not used */
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
(paren
id|PHY_L_IS_DUP
op_or
id|PHY_L_IS_ISOL
)paren
)paren
(brace
id|SkHWLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Port
)paren
suffix:semicolon
multiline_comment|/* Signal to RLMT */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
(paren
id|SK_U32
)paren
id|Port
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_LINK_DOWN
comma
id|Para
)paren
suffix:semicolon
multiline_comment|/* Start workaround Errata #2 timer */
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;GIni.GP
(braket
id|Port
)braket
dot
id|PWaTimer
comma
id|SK_WA_INA_TIME
comma
id|SKGE_HWAC
comma
id|SK_HWEV_WATIM
comma
id|Para
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IStatus
op_amp
id|PHY_L_IS_MDINT
)paren
(brace
multiline_comment|/* not used */
)brace
)brace
multiline_comment|/* End of File */
eof
