multiline_comment|/******************************************************************************&n; *&n; * Name:&t;skaddr.c&n; * Project:&t;GEnesis, PCI Gigabit Ethernet Adapter&n; * Version:&t;$Revision: 1.36 $&n; * Date:&t;$Date: 2000/08/07 11:10:39 $&n; * Purpose:&t;Manage Addresses (Multicast and Unicast) and Promiscuous Mode.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998-2000 SysKonnect,&n; *&t;a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * History:&n; *&n; *&t;$Log: skaddr.c,v $&n; *&t;Revision 1.36  2000/08/07 11:10:39  rassmann&n; *&t;Editorial changes.&n; *&t;&n; *&t;Revision 1.35  2000/05/04 09:38:41  rassmann&n; *&t;Editorial changes.&n; *&t;Corrected multicast address hashing.&n; *&t;&n; *&t;Revision 1.34  1999/11/22 13:23:44  cgoos&n; *&t;Changed license header to GPL.&n; *&t;&n; *&t;Revision 1.33  1999/05/28 10:56:06  rassmann&n; *&t;Editorial changes.&n; *&t;&n; *&t;Revision 1.32  1999/03/31 10:59:20  rassmann&n; *&t;Returning Success instead of DupAddr if address shall be overridden&n; *&t;with same value.&n; *&t;&n; *&t;Revision 1.31  1999/01/14 16:18:17  rassmann&n; *&t;Corrected multicast initialization.&n; *&t;&n; *&t;Revision 1.30  1999/01/04 10:30:35  rassmann&n; *&t;SkAddrOverride only possible after SK_INIT_IO phase.&n; *&t;&n; *&t;Revision 1.29  1998/12/29 13:13:10  rassmann&n; *&t;An address override is now preserved in the SK_INIT_IO phase.&n; *&t;All functions return an int now.&n; *&t;Extended parameter checking.&n; *&t;&n; *&t;Revision 1.28  1998/12/01 11:45:53  rassmann&n; *&t;Code cleanup.&n; *&t;&n; *&t;Revision 1.27  1998/12/01 09:22:49  rassmann&n; *&t;SkAddrMcAdd and SkAddrMcUpdate returned SK_MC_FILTERING_INEXACT&n; *&t;too often.&n; *&t;&n; *&t;Revision 1.26  1998/11/24 12:39:44  rassmann&n; *&t;Reserved multicast entry for BPDU address.&n; *&t;13 multicast entries left for protocol.&n; *&t;&n; *&t;Revision 1.25  1998/11/17 16:54:23  rassmann&n; *&t;Using exact match for up to 14 multicast addresses.&n; *&t;Still receiving all multicasts if more addresses are added.&n; *&t;&n; *&t;Revision 1.24  1998/11/13 17:24:31  rassmann&n; *&t;Changed return value of SkAddrOverride to int.&n; *&t;&n; *&t;Revision 1.23  1998/11/13 16:56:18  rassmann&n; *&t;Added macro SK_ADDR_COMPARE.&n; *&t;Changed return type of SkAddrOverride to SK_BOOL.&n; *&t;&n; *&t;Revision 1.22  1998/11/04 17:06:17  rassmann&n; *&t;Corrected McUpdate and PromiscuousChange functions.&n; *&t;&n; *&t;Revision 1.21  1998/10/29 14:34:04  rassmann&n; *&t;Clearing SK_ADDR struct at startup.&n; *&t;&n; *&t;Revision 1.20  1998/10/28 18:16:34  rassmann&n; *&t;Avoiding I/Os before SK_INIT_RUN level.&n; *&t;Aligning InexactFilter.&n; *&t;&n; *&t;Revision 1.19  1998/10/28 11:29:28  rassmann&n; *&t;Programming physical address in SkAddrMcUpdate.&n; *&t;Corrected programming of exact match entries.&n; *&t;&n; *&t;Revision 1.18  1998/10/28 10:34:48  rassmann&n; *&t;Corrected reading of physical addresses.&n; *&t;&n; *&t;Revision 1.17  1998/10/28 10:26:13  rassmann&n; *&t;Getting ports&squot; current MAC addresses from EPROM now.&n; *&t;Added debug output.&n; *&t;&n; *&t;Revision 1.16  1998/10/27 16:20:12  rassmann&n; *&t;Reading MAC address byte by byte.&n; *&t;&n; *&t;Revision 1.15  1998/10/22 11:39:09  rassmann&n; *&t;Corrected signed/unsigned mismatches.&n; *&t;&n; *&t;Revision 1.14  1998/10/19 17:12:35  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.13  1998/10/19 17:02:19  rassmann&n; *&t;Now reading permanent MAC addresses from CRF.&n; *&t;&n; *&t;Revision 1.12  1998/10/15 15:15:48  rassmann&n; *&t;Changed Flags Parameters from SK_U8 to int.&n; *&t;Checked with lint.&n; *&t;&n; *&t;Revision 1.11  1998/09/24 19:15:12  rassmann&n; *&t;Code cleanup.&n; *&t;&n; *&t;Revision 1.10  1998/09/18 20:18:54  rassmann&n; *&t;Added HW access.&n; *&t;Implemented swapping.&n; *&t;&n; *&t;Revision 1.9  1998/09/16 11:32:00  rassmann&n; *&t;Including skdrv1st.h again. :(&n; *&t;&n; *&t;Revision 1.8  1998/09/16 11:09:34  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.7  1998/09/14 17:06:34  rassmann&n; *&t;Minor changes.&n; *&t;&n; *&t;Revision 1.6  1998/09/07 08:45:41  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.5  1998/09/04 19:40:19  rassmann&n; *&t;Interface enhancements.&n; *&t;&n; *&t;Revision 1.4  1998/09/04 12:14:12  rassmann&n; *&t;Interface cleanup.&n; *&t;&n; *&t;Revision 1.3  1998/09/02 16:56:40  rassmann&n; *&t;Updated interface.&n; *&t;&n; *&t;Revision 1.2  1998/08/27 14:26:09  rassmann&n; *&t;Updated interface.&n; *&t;&n; *&t;Revision 1.1  1998/08/21 08:30:22  rassmann&n; *&t;First public version.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * Description:&n; *&n; * This module is intended to manage multicast addresses, address override,&n; * and promiscuous mode on GEnesis adapters.&n; *&n; * Address Layout:&n; *&t;port address:&t;&t;physical MAC address&n; *&t;1st exact match:&t;logical MAC address&n; *&t;2nd exact match:&t;RLMT multicast&n; *&t;exact match 3-13:&t;OS-specific multicasts&n; *&n; * Include File Hierarchy:&n; *&n; *&t;&quot;skdrv1st.h&quot;&n; *&t;&quot;skdrv2nd.h&quot;&n; *&n; ******************************************************************************/
macro_line|#ifndef&t;lint
DECL|variable|SysKonnectFileId
r_static
r_const
r_char
id|SysKonnectFileId
(braket
)braket
op_assign
l_string|&quot;@(#) $Id: skaddr.c,v 1.36 2000/08/07 11:10:39 rassmann Exp $ (C) SysKonnect.&quot;
suffix:semicolon
macro_line|#endif&t;/* !defined(lint) */
DECL|macro|__SKADDR_C
mdefine_line|#define __SKADDR_C
macro_line|#ifdef __cplusplus
macro_line|#error C++ is not yet supported.
r_extern
l_string|&quot;C&quot;
(brace
macro_line|#endif&t;/* cplusplus */
macro_line|#include &quot;h/skdrv1st.h&quot;
macro_line|#include &quot;h/skdrv2nd.h&quot;
multiline_comment|/* defines ********************************************************************/
DECL|macro|CRC32_POLY
mdefine_line|#define CRC32_POLY&t;0xEDB88320UL&t;/* CRC32-Poly - XMAC: Little Endian */
DECL|macro|HASH_BITS
mdefine_line|#define HASH_BITS&t;6&t;&t;&t;&t;/* #bits in hash */
DECL|macro|SK_MC_BIT
mdefine_line|#define&t;SK_MC_BIT&t;0x01
multiline_comment|/* Error numbers and messages. */
DECL|macro|SKERR_ADDR_E001
mdefine_line|#define SKERR_ADDR_E001&t;&t;(SK_ERRBASE_ADDR + 0)
DECL|macro|SKERR_ADDR_E001MSG
mdefine_line|#define SKERR_ADDR_E001MSG&t;&quot;Bad Flags.&quot;
DECL|macro|SKERR_ADDR_E002
mdefine_line|#define SKERR_ADDR_E002&t;&t;(SKERR_ADDR_E001 + 1)
DECL|macro|SKERR_ADDR_E002MSG
mdefine_line|#define SKERR_ADDR_E002MSG&t;&quot;New Error.&quot;
multiline_comment|/* typedefs *******************************************************************/
multiline_comment|/* None. */
multiline_comment|/* global variables ***********************************************************/
multiline_comment|/* 64-bit hash values with all bits set. */
DECL|variable|OnesHash
id|SK_U16
id|OnesHash
(braket
l_int|4
)braket
op_assign
(brace
l_int|0xFFFF
comma
l_int|0xFFFF
comma
l_int|0xFFFF
comma
l_int|0xFFFF
)brace
suffix:semicolon
multiline_comment|/* local variables ************************************************************/
macro_line|#ifdef DEBUG
DECL|variable|Next0
r_static
r_int
id|Next0
(braket
id|SK_MAX_MACS
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* functions ******************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrInit - initialize data, set state to init&n; *&n; * Description:&n; *&n; *&t;SK_INIT_DATA&n; *&t;============&n; *&n; *&t;This routine clears the multicast tables and resets promiscuous mode.&n; *&t;Some entries are reserved for the &quot;logical MAC address&quot;, the&n; *&t;SK-RLMT multicast address, and the BPDU multicast address.&n; *&n; *&n; *&t;SK_INIT_IO&n; *&t;==========&n; *&n; *&t;All permanent MAC addresses are read from EPROM.&n; *&t;If the current MAC addresses are not already set in software,&n; *&t;they are set to the values of the permanent addresses.&n; *&t;The current addresses are written to the corresponding XMAC.&n; *&n; *&n; *&t;SK_INIT_RUN&n; *&t;===========&n; *&n; *&t;Nothing.&n; *&n; * Context:&n; *&t;init, pageable&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; */
DECL|function|SkAddrInit
r_int
id|SkAddrInit
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* the adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
r_int
id|Level
)paren
multiline_comment|/* initialization level */
(brace
r_int
id|j
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_U8
op_star
id|InAddr
suffix:semicolon
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
r_switch
c_cond
(paren
id|Level
)paren
(brace
r_case
id|SK_INIT_DATA
suffix:colon
id|SK_MEMSET
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pAC-&gt;Addr
comma
l_int|0
comma
r_sizeof
(paren
id|SK_ADDR
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
suffix:semicolon
id|pAPort-&gt;PromMode
op_assign
id|SK_PROM_MODE_NONE
suffix:semicolon
id|pAPort-&gt;FirstExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
id|pAPort-&gt;FirstExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
id|pAPort-&gt;NextExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
id|pAPort-&gt;NextExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Don&squot;t do this here ... */
multiline_comment|/* Reset Promiscuous mode. */
(paren
r_void
)paren
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
id|SK_PROM_MODE_NONE
)paren
suffix:semicolon
macro_line|#endif&t;/* 0 */
)brace
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|4
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_DATA; */
r_break
suffix:semicolon
r_case
id|SK_INIT_IO
suffix:colon
id|pAC-&gt;Addr.ActivePort
op_assign
id|pAC-&gt;Rlmt.MacActive
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|8
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* Read permanent logical MAC address from Control Register File. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|InAddr
op_assign
(paren
id|SK_U8
op_star
)paren
op_amp
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
id|j
)braket
suffix:semicolon
id|SK_IN8
c_func
(paren
id|IoC
comma
id|B2_MAC_1
op_plus
id|j
comma
id|InAddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.CurrentMacAddressSet
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Set the current logical MAC address&n;&t;&t;&t; * to the permanent one.&n;&t;&t;&t; */
id|pAC-&gt;Addr.CurrentMacAddress
op_assign
id|pAC-&gt;Addr.PermanentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/* Set the current logical MAC address. */
id|pAC-&gt;Addr.Port
(braket
id|pAC-&gt;Addr.ActivePort
)braket
dot
id|Exact
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Addr.CurrentMacAddress
suffix:semicolon
macro_line|#ifdef xDEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Permanent MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Logical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
macro_line|#if 0
multiline_comment|/* Don&squot;t do this here ... */
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Addr.ActivePort
)paren
suffix:semicolon
macro_line|#endif&t;/* 0 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Read permanent port addresses from&n;&t;&t;&t; * Control Register File.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|InAddr
op_assign
(paren
id|SK_U8
op_star
)paren
op_amp
id|pAPort-&gt;PermanentMacAddress.a
(braket
id|j
)braket
suffix:semicolon
id|SK_IN8
c_func
(paren
id|IoC
comma
id|B2_MAC_2
op_plus
l_int|8
op_star
id|i
op_plus
id|j
comma
id|InAddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAPort-&gt;CurrentMacAddressSet
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Set the current and previous physical&n;&t;&t;&t;&t; * MAC address of this port to its permanent&n;&t;&t;&t;&t; * MAC address.&n;&t;&t;&t;&t; */
id|pAPort-&gt;CurrentMacAddress
op_assign
id|pAPort-&gt;PermanentMacAddress
suffix:semicolon
id|pAPort-&gt;PreviousMacAddress
op_assign
id|pAPort-&gt;PermanentMacAddress
suffix:semicolon
id|pAPort-&gt;CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/* Set port&squot;s current MAC addresses. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|i
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
macro_line|#ifdef xDEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Permanent Physical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Phsical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
)brace
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_IO; */
r_break
suffix:semicolon
r_case
id|SK_INIT_RUN
suffix:colon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|16
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_RUN; */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* error */
r_break
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrInit */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcClear - clear the multicast table&n; *&n; * Description:&n; *&t;This routine clears the multicast table&n; *&t;(either entry 2 or entries 3-16 and InexactFilter) of the given port.&n; *&t;If not suppressed by Flag SK_MC_SW_ONLY, the hardware is updated&n; *&t;immediately.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called starting with SK_INIT_DATA with flag SK_MC_SW_ONLY&n; *&t;may be called after SK_INIT_IO without limitation&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrMcClear
r_int
id|SkAddrMcClear
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortIdx
comma
multiline_comment|/* Index of affected port */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-perm, sw-only */
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|PortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
multiline_comment|/* Clear RLMT multicast addresses. */
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* not permanent =&gt; DRV */
multiline_comment|/* Clear InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Clear DRV multicast addresses. */
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|Flags
op_amp
id|SK_MC_SW_ONLY
)paren
)paren
(brace
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortIdx
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrMcClear */
macro_line|#ifndef SK_ADDR_CHEAT
multiline_comment|/******************************************************************************&n; *&n; *&t;SkCrc32McHash - hash multicast address&n; *&n; * Description:&n; *&t;This routine computes the hash value for a multicast address.&n; *&n; * Notes:&n; *&t;The code was adapted from the XaQti data sheet.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&n; * Returns:&n; *&t;Hash value of multicast address.&n; */
DECL|function|SkCrc32McHash
r_int
id|SkCrc32McHash
c_func
(paren
r_int
r_char
op_star
id|pMc
)paren
multiline_comment|/* Multicast address */
(brace
r_int
id|Idx
suffix:semicolon
r_int
id|Bit
suffix:semicolon
r_int
id|Data
suffix:semicolon
r_int
id|Crc
suffix:semicolon
id|Crc
op_assign
l_int|0xFFFFFFFFUL
suffix:semicolon
r_for
c_loop
(paren
id|Idx
op_assign
l_int|0
suffix:semicolon
id|Idx
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|Idx
op_increment
)paren
(brace
id|Data
op_assign
op_star
id|pMc
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|Bit
op_assign
l_int|0
suffix:semicolon
id|Bit
OL
l_int|8
suffix:semicolon
id|Bit
op_increment
comma
id|Data
op_rshift_assign
l_int|1
)paren
(brace
id|Crc
op_assign
(paren
id|Crc
op_rshift
l_int|1
)paren
op_xor
(paren
(paren
(paren
id|Crc
op_xor
id|Data
)paren
op_amp
l_int|1
)paren
ques
c_cond
id|CRC32_POLY
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
id|Crc
op_amp
(paren
(paren
l_int|1
op_lshift
id|HASH_BITS
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* SkCrc32McHash */
macro_line|#endif&t;/* not SK_ADDR_CHEAT */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcAdd - add a multicast address to a port&n; *&n; * Description:&n; *&t;This routine enables reception for a given address on the given port.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; *&t;In the current version, only RLMT may add addresses to the non-active&n; *&t;port.&n; *&n; *&t;The multicast bit is only checked if there are no free exact match&n; *&t;entries.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_DATA&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_MC_ILLEGAL_ADDRESS&n; *&t;SK_MC_ILLEGAL_PORT&n; *&t;SK_MC_RLMT_OVERFLOW&n; */
DECL|function|SkAddrMcAdd
r_int
id|SkAddrMcAdd
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortIdx
comma
multiline_comment|/* Port Index */
id|SK_MAC_ADDR
op_star
id|pMc
comma
multiline_comment|/* multicast address to be added */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-permanent */
(brace
r_int
id|i
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
macro_line|#ifndef SK_ADDR_CHEAT
r_int
id|HashBit
suffix:semicolon
macro_line|#endif&t;/* !defined(SK_ADDR_CHEAT) */
r_if
c_cond
(paren
id|PortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|PortIdx
)braket
op_or_assign
l_int|1
suffix:semicolon
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchRlmt
OG
id|SK_ADDR_LAST_MATCH_RLMT
)paren
(brace
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
multiline_comment|/* Set an RLMT multicast address. */
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|Exact
(braket
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchRlmt
op_increment
)braket
op_assign
op_star
id|pMc
suffix:semicolon
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
multiline_comment|/* Not PERMANENT =&gt; DRV */
r_if
c_cond
(paren
id|PortIdx
op_ne
id|pAC-&gt;Addr.ActivePort
)paren
(brace
multiline_comment|/* Only RLMT is allowed to do this. */
r_return
(paren
id|SK_MC_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchDrv
OL
id|SK_ADDR_FIRST_MATCH_DRV
)paren
(brace
id|Next0
(braket
id|PortIdx
)braket
op_or_assign
l_int|2
suffix:semicolon
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchDrv
op_le
id|SK_ADDR_LAST_MATCH_DRV
)paren
(brace
multiline_comment|/* Set exact match entry. */
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|Exact
(braket
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|NextExactMatchDrv
op_increment
)braket
op_assign
op_star
id|pMc
suffix:semicolon
multiline_comment|/* Clear InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pMc-&gt;a
(braket
l_int|0
)braket
op_amp
id|SK_MC_BIT
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Hashing only possible with&n;&t;&t;&t; * multicast addresses.&n;&t;&t;&t; */
r_return
(paren
id|SK_MC_ILLEGAL_ADDRESS
)paren
suffix:semicolon
)brace
macro_line|#ifndef SK_ADDR_CHEAT
multiline_comment|/* Compute hash value of address. */
id|HashBit
op_assign
l_int|63
op_minus
id|SkCrc32McHash
c_func
(paren
op_amp
id|pMc-&gt;a
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Add bit to InexactFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|HashBit
op_div
l_int|8
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|HashBit
op_mod
l_int|8
)paren
suffix:semicolon
macro_line|#else&t;/* SK_ADDR_CHEAT */
multiline_comment|/* Set all bits in InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0xFF
suffix:semicolon
)brace
macro_line|#endif&t;/* SK_ADDR_CHEAT */
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
op_logical_and
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|PromMode
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SkAddrMcAdd */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcUpdate - update the HW MC address table and set the MAC address&n; *&n; * Description:&n; *&t;This routine enables reception of the addresses contained in a local&n; *&t;table for a given port.&n; *&t;It also programs the port&squot;s current physical MAC address.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrMcUpdate
r_int
id|SkAddrMcUpdate
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortIdx
)paren
multiline_comment|/* Port Index */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_U16
id|LoMode
suffix:semicolon
multiline_comment|/* Lower 16 bits of XMAC Mode Reg. */
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
r_if
c_cond
(paren
id|PortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrMcUpdate on Port %u.&bslash;n&quot;
comma
id|PortIdx
)paren
)paren
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Next0 on Port %d: %d&bslash;n&quot;
comma
id|PortIdx
comma
id|Next0
(braket
id|PortIdx
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Also program the logical MAC address. */
id|i
OL
id|pAPort-&gt;NextExactMatchRlmt
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Set exact match address i on HW. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|OutAddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear other permanent exact match addresses on HW. */
r_if
c_cond
(paren
id|pAPort-&gt;NextExactMatchRlmt
op_le
id|SK_ADDR_LAST_MATCH_RLMT
)paren
(brace
id|SkXmClrExactAddr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortIdx
comma
id|pAPort-&gt;NextExactMatchRlmt
comma
id|SK_ADDR_LAST_MATCH_RLMT
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|pAPort-&gt;FirstExactMatchDrv
suffix:semicolon
id|i
OL
id|pAPort-&gt;NextExactMatchDrv
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|OutAddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear other non-permanent exact match addresses on HW. */
r_if
c_cond
(paren
id|pAPort-&gt;NextExactMatchDrv
op_le
id|SK_ADDR_LAST_MATCH_DRV
)paren
(brace
id|SkXmClrExactAddr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortIdx
comma
id|pAPort-&gt;NextExactMatchDrv
comma
id|SK_ADDR_LAST_MATCH_DRV
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAPort-&gt;InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
(brace
multiline_comment|/* Set all bits in 64-bit hash register. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_HSM
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Set bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_or_assign
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Inexact
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_HSM
comma
op_amp
id|pAPort-&gt;InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Set bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_or_assign
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Clear bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_and_assign
op_complement
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_ne
id|SK_PROM_MODE_NONE
)paren
(brace
(paren
r_void
)paren
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortIdx
comma
id|pAPort-&gt;PromMode
)paren
suffix:semicolon
)brace
multiline_comment|/* Set port&squot;s current MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Also program the logical MAC address. */
id|i
OL
id|pAPort-&gt;NextExactMatchRlmt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_U8
id|InAddr8
(braket
l_int|6
)braket
suffix:semicolon
id|SK_U16
op_star
id|InAddr
suffix:semicolon
multiline_comment|/* Get exact match address i from port PortIdx. */
id|InAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|InAddr8
(braket
l_int|0
)braket
suffix:semicolon
id|XM_INADDR
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|InAddr
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;MC address %d on Port %u: %02x %02x %02x %02x %02x %02x --  %02x %02x %02x %02x %02x %02x.&bslash;n&quot;
comma
id|i
comma
id|PortIdx
comma
id|InAddr8
(braket
l_int|0
)braket
comma
id|InAddr8
(braket
l_int|1
)braket
comma
id|InAddr8
(braket
l_int|2
)braket
comma
id|InAddr8
(braket
l_int|3
)braket
comma
id|InAddr8
(braket
l_int|4
)braket
comma
id|InAddr8
(braket
l_int|5
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|5
)braket
)paren
)paren
)brace
macro_line|#endif&t;/* DEBUG */&t;&t;
multiline_comment|/* Determine return value. */
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
op_logical_and
id|pAPort-&gt;PromMode
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SkAddrMcUpdate */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrOverride - override a port&squot;s MAC address&n; *&n; * Description:&n; *&t;This routine overrides the MAC address of one port.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS if successful.&n; *&t;SK_ADDR_DUPLICATE_ADDRESS if duplicate MAC address.&n; *&t;SK_ADDR_MULTICAST_ADDRESS if multicast or broadcast address.&n; *&t;SK_ADDR_TOO_EARLY if SK_INIT_IO was not executed before.&n; */
DECL|function|SkAddrOverride
r_int
id|SkAddrOverride
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortIdx
comma
multiline_comment|/* Port Index */
id|SK_MAC_ADDR
op_star
id|pNewAddr
comma
multiline_comment|/* new MAC address */
r_int
id|Flags
)paren
multiline_comment|/* logical/physical MAC address */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
macro_line|#if 0
id|SK_MAC_ADDR
id|NewAddr
suffix:semicolon
multiline_comment|/* new MAC address */
id|SK_U8
id|AddrBits
suffix:semicolon
macro_line|#endif&t;/* 0 */
r_if
c_cond
(paren
id|PortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pNewAddr-&gt;a
(braket
l_int|0
)braket
op_amp
id|SK_MC_BIT
)paren
(brace
r_return
(paren
id|SK_ADDR_MULTICAST_ADDRESS
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|DANGEROUS
op_logical_neg
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PHYSICAL_ADDRESS
)paren
(brace
multiline_comment|/* Physical address. */
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|PreviousMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.CurrentMacAddressSet
)paren
(brace
id|pAC-&gt;Addr.CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
id|pAC-&gt;Addr.CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
)brace
id|DANGEROUS
op_logical_neg
macro_line|#endif&t;/* 0 */
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PHYSICAL_ADDRESS
)paren
(brace
multiline_comment|/* Physical MAC address. */
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|PortIdx
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
)brace
)brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|PreviousMacAddress
op_assign
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|CurrentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
multiline_comment|/* Change port&squot;s address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
id|pNewAddr
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
multiline_comment|/* Report address change to RLMT. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortIdx
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORT_ADDR
comma
id|Para
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Logical MAC address. */
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
)brace
id|pAC-&gt;Addr.CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|Exact
(braket
l_int|0
)braket
op_assign
op_star
id|pNewAddr
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Permanent MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;New logical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* Write address to first exact match entry of active port. */
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortIdx
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrOverride */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrPromiscuousChange - set promiscuous mode for given port&n; *&n; * Description:&n; *&t;This routine manages promiscuous mode:&n; *&t;- none&n; *&t;- all LLC frames&n; *&t;- all MC frames&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrPromiscuousChange
r_int
id|SkAddrPromiscuousChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortIdx
comma
multiline_comment|/* port whose promiscuous mode changes */
r_int
id|NewPromMode
)paren
multiline_comment|/* new promiscuous mode */
(brace
r_int
id|i
suffix:semicolon
id|SK_BOOL
id|InexactModeBit
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
id|SK_U8
id|HwInexact
suffix:semicolon
id|SK_FILTER64
id|HwInexactFilter
suffix:semicolon
id|SK_U16
id|LoMode
suffix:semicolon
multiline_comment|/* Lower 16 bits of XMAC Mode Register. */
r_int
id|CurPromMode
op_assign
id|SK_PROM_MODE_NONE
suffix:semicolon
r_if
c_cond
(paren
id|PortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
multiline_comment|/* Read CurPromMode from Hardware. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LoMode
op_amp
id|XM_MD_ENA_PROM
)paren
(brace
id|CurPromMode
op_or_assign
id|SK_PROM_MODE_LLC
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0xFF
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_and_assign
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0xFF
)paren
(brace
id|CurPromMode
op_or_assign
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Read InexactModeBit (bit 15 in mode register). */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|InexactModeBit
op_assign
(paren
id|LoMode
op_amp
id|XM_MD_ENA_HSH
)paren
op_ne
l_int|0
suffix:semicolon
multiline_comment|/* Read 64-bit hash register from HW. */
id|XM_INHASH
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_HSM
comma
op_amp
id|HwInexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|HwInexact
op_assign
l_int|0xFF
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|HwInexact
op_and_assign
id|HwInexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|InexactModeBit
op_logical_and
(paren
id|HwInexact
op_eq
l_int|0xFF
)paren
)paren
(brace
id|CurPromMode
op_or_assign
id|SK_PROM_MODE_ALL_MC
suffix:semicolon
)brace
)brace
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|PromMode
op_assign
id|NewPromMode
suffix:semicolon
r_if
c_cond
(paren
id|NewPromMode
op_eq
id|CurPromMode
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* All MC. */
multiline_comment|/* Set all bits in 64-bit hash register. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_HSM
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Set bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_or_assign
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* Norm MC. */
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Clear bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_and_assign
op_complement
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_HSM
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Set bit 15 in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|LoMode
op_or_assign
id|XM_MD_ENA_HSH
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Prom. LLC */
multiline_comment|/* Set promiscuous bit in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Receive MAC frames. */
id|LoMode
op_or_assign
id|XM_MD_RX_MCTRL
suffix:semicolon
macro_line|#endif&t;/* 0 */
id|LoMode
op_or_assign
id|XM_MD_ENA_PROM
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Norm. LLC. */
multiline_comment|/* Clear promiscuous bit in mode register. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Don&squot;t receive MAC frames. */
id|LoMode
op_and_assign
op_complement
id|XM_MD_RX_MCTRL
suffix:semicolon
macro_line|#endif&t;/* 0 */
id|LoMode
op_and_assign
op_complement
id|XM_MD_ENA_PROM
suffix:semicolon
id|XM_OUT16
c_func
(paren
id|IoC
comma
id|PortIdx
comma
id|XM_MODE
comma
id|LoMode
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrPromiscuousChange */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrSwap - swap address info&n; *&n; * Description:&n; *&t;This routine swaps address info of two ports.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrSwap
r_int
id|SkAddrSwap
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|FromPortIdx
comma
multiline_comment|/* Port1 Index */
id|SK_U32
id|ToPortIdx
)paren
multiline_comment|/* Port2 Index */
(brace
r_int
id|i
suffix:semicolon
id|SK_U8
id|Byte
suffix:semicolon
id|SK_MAC_ADDR
id|MacAddr
suffix:semicolon
id|SK_U32
id|DWord
suffix:semicolon
r_if
c_cond
(paren
id|FromPortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ToPortIdx
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Swap&n;&t; * - Exact Match Entries&n;&t; * - FirstExactMatchRlmt;&n;&t; * - NextExactMatchRlmt;&n;&t; * - FirstExactMatchDrv;&n;&t; * - NextExactMatchDrv;&n;&t; * - 64-bit filter&n;&t; * - Promiscuous Mode&n;&t; * of ports.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_ADDR_EXACT_MATCHES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|MacAddr
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|Exact
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|Exact
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|Exact
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|Exact
(braket
id|i
)braket
op_assign
id|MacAddr
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Byte
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
id|Byte
suffix:semicolon
)brace
id|i
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|PromMode
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|PromMode
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|PromMode
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|PromMode
op_assign
id|i
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|FirstExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|FirstExactMatchRlmt
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|FirstExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|FirstExactMatchRlmt
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|NextExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|NextExactMatchRlmt
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|NextExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|NextExactMatchRlmt
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|FirstExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|FirstExactMatchDrv
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|FirstExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|FirstExactMatchDrv
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|NextExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortIdx
)braket
dot
id|NextExactMatchDrv
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|NextExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortIdx
)braket
dot
id|NextExactMatchDrv
op_assign
id|DWord
suffix:semicolon
id|pAC-&gt;Addr.ActivePort
op_assign
id|ToPortIdx
suffix:semicolon
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPortIdx
)paren
suffix:semicolon
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPortIdx
)paren
suffix:semicolon
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrSwap */
macro_line|#ifdef __cplusplus
)brace
macro_line|#endif&t;/* __cplusplus */
eof
