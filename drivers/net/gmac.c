multiline_comment|/*&n; * Network device driver for the GMAC ethernet controller on&n; * Apple G4 Powermacs.&n; *&n; * Copyright (C) 2000 Paul Mackerras.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &quot;gmac.h&quot;
DECL|macro|DEBUG_PHY
mdefine_line|#define DEBUG_PHY
DECL|macro|NTX
mdefine_line|#define NTX&t;&t;32&t;&t;/* must be power of 2 */
DECL|macro|NRX
mdefine_line|#define NRX&t;&t;32&t;&t;/* must be power of 2 */
DECL|macro|RX_BUFLEN
mdefine_line|#define RX_BUFLEN&t;(ETH_FRAME_LEN + 8)
DECL|struct|gmac_dma_desc
r_struct
id|gmac_dma_desc
(brace
DECL|member|cmd
r_int
r_int
id|cmd
suffix:semicolon
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|address
r_int
r_int
id|address
suffix:semicolon
multiline_comment|/* phys addr, low 32 bits */
DECL|member|hi_addr
r_int
r_int
id|hi_addr
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Bits in cmd */
DECL|macro|RX_OWN
mdefine_line|#define RX_OWN&t;0x80000000&t;&t;/* 1 = owned by chip */
DECL|macro|TX_SOP
mdefine_line|#define TX_SOP&t;0x80000000
DECL|macro|TX_EOP
mdefine_line|#define TX_EOP&t;0x40000000
DECL|struct|gmac
r_struct
id|gmac
(brace
DECL|member|regs
r_volatile
r_int
r_int
op_star
id|regs
suffix:semicolon
multiline_comment|/* hardware registers, virtual addr */
DECL|member|sysregs
r_volatile
r_int
r_int
op_star
id|sysregs
suffix:semicolon
DECL|member|desc_page
r_int
r_int
id|desc_page
suffix:semicolon
multiline_comment|/* page for DMA descriptors */
DECL|member|rxring
r_volatile
r_struct
id|gmac_dma_desc
op_star
id|rxring
suffix:semicolon
DECL|member|rx_buff
r_struct
id|sk_buff
op_star
id|rx_buff
(braket
id|NRX
)braket
suffix:semicolon
DECL|member|next_rx
r_int
id|next_rx
suffix:semicolon
DECL|member|txring
r_volatile
r_struct
id|gmac_dma_desc
op_star
id|txring
suffix:semicolon
DECL|member|tx_buff
r_struct
id|sk_buff
op_star
id|tx_buff
(braket
id|NTX
)braket
suffix:semicolon
DECL|member|next_tx
r_int
id|next_tx
suffix:semicolon
DECL|member|tx_gone
r_int
id|tx_gone
suffix:semicolon
DECL|member|tx_full
r_int
r_char
id|tx_full
suffix:semicolon
DECL|member|phy_addr
r_int
id|phy_addr
suffix:semicolon
DECL|member|full_duplex
r_int
id|full_duplex
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|next_gmac
r_struct
id|net_device
op_star
id|next_gmac
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|GM_OUT
mdefine_line|#define GM_OUT(r, v)&t;out_le32(gm-&gt;regs + (r)/4, (v))
DECL|macro|GM_IN
mdefine_line|#define GM_IN(r)&t;in_le32(gm-&gt;regs + (r)/4)
DECL|macro|GM_BIS
mdefine_line|#define GM_BIS(r, v)&t;GM_OUT((r), GM_IN(r) | (v))
DECL|macro|GM_BIC
mdefine_line|#define GM_BIC(r, v)&t;GM_OUT((r), GM_IN(r) &amp; ~(v))
DECL|macro|PHY_B5400
mdefine_line|#define PHY_B5400&t;0x6040
DECL|macro|PHY_B5201
mdefine_line|#define PHY_B5201&t;0x6212
DECL|variable|dummy_buf
r_static
r_int
r_char
id|dummy_buf
(braket
id|RX_BUFLEN
op_plus
l_int|2
)braket
suffix:semicolon
DECL|variable|gmacs
r_static
r_struct
id|net_device
op_star
id|gmacs
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Prototypes */
r_static
r_int
id|mii_read
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
id|phy
comma
r_int
id|r
)paren
suffix:semicolon
r_static
r_int
id|mii_write
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
id|phy
comma
r_int
id|r
comma
r_int
id|v
)paren
suffix:semicolon
r_static
r_void
id|powerup_transceiver
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
suffix:semicolon
r_static
r_int
id|gmac_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|gmac_mac_init
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
r_char
op_star
id|mac_addr
)paren
suffix:semicolon
r_static
r_void
id|gmac_init_rings
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
suffix:semicolon
r_static
r_void
id|gmac_start_dma
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
suffix:semicolon
r_static
r_int
id|gmac_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|gmac_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|gmac_xmit_start
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|gmac_tx_cleanup
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
suffix:semicolon
r_static
r_void
id|gmac_receive
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|gmac_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|gmac_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|gmac_probe
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|gmac_probe1
c_func
(paren
r_struct
id|device_node
op_star
id|gmac
)paren
suffix:semicolon
multiline_comment|/* Stuff for talking to the physical-layer chip */
r_static
r_int
DECL|function|mii_read
id|mii_read
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
id|phy
comma
r_int
id|r
)paren
(brace
r_int
id|timeout
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MIFFRAME
comma
l_int|0x60020000
op_or
(paren
id|phy
op_lshift
l_int|23
)paren
op_or
(paren
id|r
op_lshift
l_int|18
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|1000
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|GM_IN
c_func
(paren
id|MIFFRAME
)paren
op_amp
l_int|0x10000
)paren
r_return
id|GM_IN
c_func
(paren
id|MIFFRAME
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_write
id|mii_write
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
id|phy
comma
r_int
id|r
comma
r_int
id|v
)paren
(brace
r_int
id|timeout
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MIFFRAME
comma
l_int|0x50020000
op_or
(paren
id|phy
op_lshift
l_int|23
)paren
op_or
(paren
id|r
op_lshift
l_int|18
)paren
op_or
(paren
id|v
op_amp
l_int|0xffff
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|1000
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|GM_IN
c_func
(paren
id|MIFFRAME
)paren
op_amp
l_int|0x10000
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|mii_poll_start
id|mii_poll_start
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/* Start the MIF polling on the external transceiver. */
id|tmp
op_assign
id|GM_IN
c_func
(paren
id|MIFCONFIG
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|GMAC_MIF_CFGPR_MASK
op_or
id|GMAC_MIF_CFGPD_MASK
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|gm-&gt;phy_addr
op_amp
l_int|0x1f
)paren
op_lshift
id|GMAC_MIF_CFGPD_SHIFT
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
l_int|0x19
op_lshift
id|GMAC_MIF_CFGPR_SHIFT
)paren
suffix:semicolon
id|tmp
op_or_assign
id|GMAC_MIF_CFGPE
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MIFCONFIG
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Let the bits set. */
id|udelay
c_func
(paren
id|GMAC_MIF_POLL_DELAY
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MIFINTMASK
comma
l_int|0xffc0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|mii_poll_stop
id|mii_poll_stop
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
id|GM_OUT
c_func
(paren
id|MIFINTMASK
comma
l_int|0xffff
)paren
suffix:semicolon
id|GM_BIC
c_func
(paren
id|MIFCONFIG
comma
id|GMAC_MIF_CFGPE
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|GMAC_MIF_POLL_DELAY
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|mii_interrupt
id|mii_interrupt
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|phy_status
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|mii_poll_stop
c_func
(paren
id|gm
)paren
suffix:semicolon
multiline_comment|/* May the status change before polling is re-enabled ? */
id|mii_poll_start
c_func
(paren
id|gm
)paren
suffix:semicolon
multiline_comment|/* We read the Auxilliary Status Summary register */
id|phy_status
op_assign
id|mii_read
c_func
(paren
id|gm
comma
id|gm-&gt;phy_addr
comma
l_int|0x19
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_PHY
id|printk
c_func
(paren
l_string|&quot;mii_interrupt, phy_status: %x&bslash;n&quot;
comma
id|phy_status
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Auto-neg. complete ? */
r_if
c_cond
(paren
id|phy_status
op_amp
l_int|0x8000
)paren
(brace
r_int
id|full_duplex
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|phy_status
op_rshift
l_int|8
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|5
suffix:colon
id|full_duplex
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|full_duplex
op_ne
id|gm-&gt;full_duplex
)paren
(brace
id|GM_BIC
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
r_if
c_cond
(paren
id|full_duplex
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;full duplex active&bslash;n&quot;
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|6
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|XIF_CONFIG
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;half duplex active&bslash;n&quot;
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|XIF_CONFIG
comma
l_int|5
)paren
suffix:semicolon
)brace
id|GM_BIS
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|gm-&gt;full_duplex
op_assign
id|full_duplex
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|powerup_transceiver
id|powerup_transceiver
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
r_int
id|phytype
op_assign
id|mii_read
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|3
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_PHY
r_int
id|i
suffix:semicolon
macro_line|#endif&t;
r_switch
c_cond
(paren
id|phytype
)paren
(brace
r_case
id|PHY_B5400
suffix:colon
id|mii_write
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|0
comma
id|mii_read
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|0
)paren
op_amp
op_complement
l_int|0x800
)paren
suffix:semicolon
id|mii_write
c_func
(paren
id|gm
comma
l_int|31
comma
l_int|30
comma
id|mii_read
c_func
(paren
id|gm
comma
l_int|31
comma
l_int|30
)paren
op_amp
op_complement
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PHY_B5201
suffix:colon
id|mii_write
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|30
comma
id|mii_read
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|30
)paren
op_amp
op_complement
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GMAC: unknown PHY type %x&bslash;n&quot;
comma
id|phytype
)paren
suffix:semicolon
)brace
multiline_comment|/* Check this */
id|gm-&gt;phy_addr
op_assign
l_int|0
suffix:semicolon
id|gm-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG_PHY
id|printk
c_func
(paren
l_string|&quot;PHY regs:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x20
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%04x &quot;
comma
id|mii_read
c_func
(paren
id|gm
comma
l_int|0
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|4
)paren
op_eq
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_static
r_int
DECL|function|gmac_reset
id|gmac_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|timeout
suffix:semicolon
multiline_comment|/* turn on GB clock */
id|out_le32
c_func
(paren
id|gm-&gt;sysregs
op_plus
l_int|0x20
op_div
l_int|4
comma
id|in_le32
c_func
(paren
id|gm-&gt;sysregs
op_plus
l_int|0x20
op_div
l_int|4
)paren
op_or
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|SW_RESET
comma
l_int|3
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|GM_IN
c_func
(paren
id|SW_RESET
)paren
op_amp
l_int|3
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GMAC: reset failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|gmac_mac_init
id|gmac_mac_init
c_func
(paren
r_struct
id|gmac
op_star
id|gm
comma
r_int
r_char
op_star
id|mac_addr
)paren
(brace
r_int
id|i
suffix:semicolon
id|GM_OUT
c_func
(paren
id|RANSEED
comma
l_int|937
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|DATAPATHMODE
comma
l_int|4
)paren
suffix:semicolon
id|mii_write
c_func
(paren
id|gm
comma
l_int|0
comma
l_int|0
comma
l_int|0x1000
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXDMA_CONFIG
comma
l_int|0xffc00
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|RXDMA_CONFIG
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MACPAUSE
comma
l_int|0x1bf0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|IPG0
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|IPG1
comma
l_int|8
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|IPG2
comma
l_int|4
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MINFRAMESIZE
comma
l_int|64
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAXFRAMESIZE
comma
l_int|2000
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|PASIZE
comma
l_int|7
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|JAMSIZE
comma
l_int|4
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|ATTEMPT_LIMIT
comma
l_int|16
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|SLOTTIME
comma
l_int|64
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MACCNTL_TYPE
comma
l_int|0x8808
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_0
comma
(paren
id|mac_addr
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
id|mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_1
comma
(paren
id|mac_addr
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_plus
id|mac_addr
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_2
comma
(paren
id|mac_addr
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_plus
id|mac_addr
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_3
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_4
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_5
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_6
comma
l_int|0x0180
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_7
comma
l_int|0xc200
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_8
comma
l_int|0x0001
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_FILTER_0
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_FILTER_1
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_FILTER_2
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_FILTER_MASK21
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MAC_ADDR_FILTER_MASK0
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|27
suffix:semicolon
op_increment
id|i
)paren
id|GM_OUT
c_func
(paren
id|MAC_HASHTABLE
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|MACCNTL_CONFIG
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* default to half duplex */
id|GM_OUT
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|XIF_CONFIG
comma
l_int|5
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|gmac_init_rings
id|gmac_init_rings
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
r_struct
id|gmac_dma_desc
op_star
id|ring
suffix:semicolon
multiline_comment|/* init rx ring */
id|ring
op_assign
(paren
r_struct
id|gmac_dma_desc
op_star
)paren
id|gm-&gt;rxring
suffix:semicolon
id|memset
c_func
(paren
id|ring
comma
l_int|0
comma
id|NRX
op_star
r_sizeof
(paren
r_struct
id|gmac_dma_desc
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NRX
suffix:semicolon
op_increment
id|i
comma
op_increment
id|ring
)paren
(brace
id|data
op_assign
id|dummy_buf
suffix:semicolon
id|gm-&gt;rx_buff
(braket
id|i
)braket
op_assign
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUFLEN
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|0
)paren
(brace
multiline_comment|/*skb_reserve(skb, 2);*/
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
)brace
id|st_le32
c_func
(paren
op_amp
id|ring-&gt;address
comma
id|virt_to_bus
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|ring-&gt;cmd
comma
id|RX_OWN
)paren
suffix:semicolon
)brace
multiline_comment|/* init tx ring */
id|ring
op_assign
(paren
r_struct
id|gmac_dma_desc
op_star
)paren
id|gm-&gt;txring
suffix:semicolon
id|memset
c_func
(paren
id|ring
comma
l_int|0
comma
id|NRX
op_star
r_sizeof
(paren
r_struct
id|gmac_dma_desc
)paren
)paren
suffix:semicolon
multiline_comment|/* set pointers in chip */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|RXDMA_BASE_HIGH
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|RXDMA_BASE_LOW
comma
id|virt_to_bus
c_func
(paren
id|gm-&gt;rxring
)paren
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXDMA_BASE_HIGH
comma
l_int|0
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXDMA_BASE_LOW
comma
id|virt_to_bus
c_func
(paren
id|gm-&gt;txring
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|gmac_start_dma
id|gmac_start_dma
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
id|GM_BIS
c_func
(paren
id|RXDMA_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_BIS
c_func
(paren
id|RXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|RXDMA_KICK
comma
id|NRX
)paren
suffix:semicolon
id|GM_BIS
c_func
(paren
id|TXDMA_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_BIS
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|gmac_open
r_static
r_int
id|gmac_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|gmac_reset
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|powerup_transceiver
c_func
(paren
id|gm
)paren
suffix:semicolon
id|gmac_mac_init
c_func
(paren
id|gm
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
id|gmac_init_rings
c_func
(paren
id|gm
)paren
suffix:semicolon
id|gmac_start_dma
c_func
(paren
id|gm
)paren
suffix:semicolon
id|mii_interrupt
c_func
(paren
id|gm
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|INTR_DISABLE
comma
l_int|0xfffdffe8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gmac_close
r_static
r_int
id|gmac_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mii_poll_stop
c_func
(paren
id|gm
)paren
suffix:semicolon
id|GM_BIC
c_func
(paren
id|RXDMA_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_BIC
c_func
(paren
id|RXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_BIC
c_func
(paren
id|TXDMA_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_BIC
c_func
(paren
id|TXMAC_CONFIG
comma
l_int|1
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|INTR_DISABLE
comma
op_complement
l_int|0U
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NRX
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gm-&gt;rx_buff
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|gm-&gt;rx_buff
(braket
id|i
)braket
)paren
suffix:semicolon
id|gm-&gt;rx_buff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NTX
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gm-&gt;tx_buff
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|gm-&gt;tx_buff
(braket
id|i
)braket
)paren
suffix:semicolon
id|gm-&gt;tx_buff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gmac_xmit_start
r_static
r_int
id|gmac_xmit_start
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
r_struct
id|gmac_dma_desc
op_star
id|dp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|i
op_assign
id|gm-&gt;next_tx
suffix:semicolon
r_if
c_cond
(paren
id|gm-&gt;tx_buff
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
multiline_comment|/* buffer is full, can&squot;t send this packet at the moment */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|gm-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|gm-&gt;next_tx
op_assign
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|NTX
op_minus
l_int|1
)paren
suffix:semicolon
id|gm-&gt;tx_buff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dp
op_assign
op_amp
id|gm-&gt;txring
(braket
id|i
)braket
suffix:semicolon
id|dp-&gt;status
op_assign
l_int|0
suffix:semicolon
id|dp-&gt;hi_addr
op_assign
l_int|0
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|dp-&gt;address
comma
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|dp-&gt;cmd
comma
id|TX_SOP
op_or
id|TX_EOP
op_or
id|skb-&gt;len
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|TXDMA_KICK
comma
id|gm-&gt;next_tx
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gmac_tx_cleanup
r_static
r_int
id|gmac_tx_cleanup
c_func
(paren
r_struct
id|gmac
op_star
id|gm
)paren
(brace
r_int
id|i
op_assign
id|gm-&gt;tx_gone
suffix:semicolon
r_volatile
r_struct
id|gmac_dma_desc
op_star
id|dp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|gone
op_assign
id|GM_IN
c_func
(paren
id|TXDMA_COMPLETE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_ne
id|gone
)paren
(brace
id|skb
op_assign
id|gm-&gt;tx_buff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|dp
op_assign
op_amp
id|gm-&gt;txring
(braket
id|i
)braket
suffix:semicolon
id|gm-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
op_increment
id|gm-&gt;stats.tx_packets
suffix:semicolon
id|gm-&gt;tx_buff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|NTX
)paren
id|i
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|gm-&gt;tx_gone
)paren
(brace
id|ret
op_assign
id|gm-&gt;tx_full
suffix:semicolon
id|gm-&gt;tx_gone
op_assign
id|i
suffix:semicolon
id|gm-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|gmac_receive
r_static
r_void
id|gmac_receive
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
op_assign
id|gm-&gt;next_rx
suffix:semicolon
r_volatile
r_struct
id|gmac_dma_desc
op_star
id|dp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|dp
op_assign
op_amp
id|gm-&gt;rxring
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ld_le32
c_func
(paren
op_amp
id|dp-&gt;cmd
)paren
op_amp
id|RX_OWN
)paren
r_break
suffix:semicolon
id|len
op_assign
(paren
id|ld_le32
c_func
(paren
op_amp
id|dp-&gt;cmd
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0x7fff
suffix:semicolon
id|skb
op_assign
id|gm-&gt;rx_buff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
(brace
op_increment
id|gm-&gt;stats.rx_dropped
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ld_le32
c_func
(paren
op_amp
id|dp-&gt;status
)paren
op_amp
l_int|0x40000000
)paren
(brace
op_increment
id|gm-&gt;stats.rx_errors
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|gm-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
op_increment
id|gm-&gt;stats.rx_packets
suffix:semicolon
)brace
id|data
op_assign
id|dummy_buf
suffix:semicolon
id|gm-&gt;rx_buff
(braket
id|i
)braket
op_assign
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUFLEN
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|0
)paren
(brace
multiline_comment|/*skb_reserve(skb, 2);*/
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
)brace
id|st_le32
c_func
(paren
op_amp
id|dp-&gt;address
comma
id|virt_to_bus
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
id|dp-&gt;hi_addr
op_assign
l_int|0
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|dp-&gt;cmd
comma
id|RX_OWN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|NRX
)paren
id|i
op_assign
l_int|0
suffix:semicolon
)brace
id|gm-&gt;next_rx
op_assign
id|i
suffix:semicolon
)brace
DECL|function|gmac_interrupt
r_static
r_void
id|gmac_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
id|status
op_assign
id|GM_IN
c_func
(paren
id|INTR_STATUS
)paren
suffix:semicolon
id|GM_OUT
c_func
(paren
id|INTR_ACK
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|GMAC_IRQ_MIF
)paren
id|mii_interrupt
c_func
(paren
id|gm
)paren
suffix:semicolon
id|gmac_receive
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gmac_tx_cleanup
c_func
(paren
id|gm
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|gmac_stats
r_static
r_struct
id|net_device_stats
op_star
id|gmac_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|gmac
op_star
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|gm-&gt;stats
suffix:semicolon
)brace
DECL|function|gmac_probe
r_static
r_int
id|__init
id|gmac_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|device_node
op_star
id|gmac
suffix:semicolon
multiline_comment|/*&n;&t; * We could (and maybe should) do this using PCI scanning&n;&t; * for vendor/net_device ID 0x106b/0x21.&n;&t; */
r_for
c_loop
(paren
id|gmac
op_assign
id|find_compatible_devices
c_func
(paren
l_string|&quot;network&quot;
comma
l_string|&quot;gmac&quot;
)paren
suffix:semicolon
id|gmac
op_ne
l_int|0
suffix:semicolon
id|gmac
op_assign
id|gmac-&gt;next
)paren
id|gmac_probe1
c_func
(paren
id|gmac
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gmac_probe1
r_static
r_void
id|gmac_probe1
c_func
(paren
r_struct
id|device_node
op_star
id|gmac
)paren
(brace
r_struct
id|gmac
op_star
id|gm
suffix:semicolon
r_int
r_int
id|descpage
suffix:semicolon
r_int
r_char
op_star
id|addr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|gmac-&gt;n_addrs
OL
l_int|1
op_logical_or
id|gmac-&gt;n_intrs
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;can&squot;t use GMAC %s: %d addrs and %d intrs&bslash;n&quot;
comma
id|gmac-&gt;full_name
comma
id|gmac-&gt;n_addrs
comma
id|gmac-&gt;n_intrs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|addr
op_assign
id|get_property
c_func
(paren
id|gmac
comma
l_string|&quot;local-mac-address&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Can&squot;t get mac-address for GMAC %s&bslash;n&quot;
comma
id|gmac-&gt;full_name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|descpage
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|descpage
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GMAC: can&squot;t get a page for descriptors&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|0
comma
r_sizeof
(paren
r_struct
id|gmac
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|gmac
)paren
)paren
suffix:semicolon
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|gmac-&gt;addrs
(braket
l_int|0
)braket
dot
id|address
suffix:semicolon
id|gm-&gt;regs
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
id|ioremap
c_func
(paren
id|gmac-&gt;addrs
(braket
l_int|0
)braket
dot
id|address
comma
l_int|0x10000
)paren
suffix:semicolon
id|gm-&gt;sysregs
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
id|ioremap
c_func
(paren
l_int|0xf8000000
comma
l_int|0x1000
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|gmac-&gt;intrs
(braket
l_int|0
)braket
dot
id|line
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: GMAC at&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|addr
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%c%.2x&quot;
comma
(paren
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
)paren
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|gm-&gt;desc_page
op_assign
id|descpage
suffix:semicolon
id|gm-&gt;rxring
op_assign
(paren
r_volatile
r_struct
id|gmac_dma_desc
op_star
)paren
id|descpage
suffix:semicolon
id|gm-&gt;txring
op_assign
(paren
r_volatile
r_struct
id|gmac_dma_desc
op_star
)paren
(paren
id|descpage
op_plus
l_int|0x800
)paren
suffix:semicolon
id|gm-&gt;phy_addr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;open
op_assign
id|gmac_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|gmac_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|gmac_xmit_start
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|gmac_stats
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|gmac_interrupt
comma
l_int|0
comma
l_string|&quot;GMAC&quot;
comma
id|dev
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GMAC: can&squot;t get irq %d&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|gm-&gt;next_gmac
op_assign
id|gmacs
suffix:semicolon
id|gmacs
op_assign
id|dev
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Paul Mackerras/Ben Herrenschmidt&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;PowerMac GMAC driver.&quot;
)paren
suffix:semicolon
DECL|function|gmac_cleanup_module
r_static
r_void
id|__exit
id|gmac_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|gmac
op_star
id|gm
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|gmacs
)paren
op_ne
l_int|NULL
)paren
(brace
id|gm
op_assign
(paren
r_struct
id|gmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|gmacs
op_assign
id|gm-&gt;next_gmac
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|gm-&gt;desc_page
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|variable|gmac_probe
id|module_init
c_func
(paren
id|gmac_probe
)paren
suffix:semicolon
DECL|variable|gmac_cleanup_module
id|module_exit
c_func
(paren
id|gmac_cleanup_module
)paren
suffix:semicolon
eof
