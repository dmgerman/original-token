multiline_comment|/*&n; * ni6510 (am7990 &squot;lance&squot; chip) driver for Linux-net-3&n; * BETAcode v0.71 (96/09/29) for 2.0.0 (or later)&n; * copyrights (c) 1994,1995,1996 by M.Hipp&n; *&n; * This driver can handle the old ni6510 board and the newer ni6510&n; * EtherBlaster. (probably it also works with every full NE2100&n; * compatible card)&n; *&n; * To compile as module, type:&n; *     gcc -O2 -fomit-frame-pointer -m486 -D__KERNEL__ -DMODULE -c ni65.c&n; * driver probes: io: 0x360,0x300,0x320,0x340 / dma: 3,5,6,7&n; *&n; * This is an extension to the Linux operating system, and is covered by the&n; * same Gnu Public License that covers the Linux-kernel.&n; *&n; * comments/bugs/suggestions can be sent to:&n; *   Michael Hipp&n; *   email: hippm@informatik.uni-tuebingen.de&n; *&n; * sources:&n; *   some things are from the &squot;ni6510-packet-driver for dos by Russ Nelson&squot;&n; *   and from the original drivers by D.Becker&n; *&n; * known problems:&n; *   - on some PCI boards (including my own) the card/board/ISA-bridge has&n; *     problems with bus master DMA. This results in lotsa overruns.&n; *     It may help to &squot;#define RCV_PARANOIA_CHECK&squot; or try to #undef&n; *     the XMT and RCV_VIA_SKB option .. this reduces driver performance.&n; *     Or just play with your BIOS options to optimize ISA-DMA access.&n; *     Maybe you also wanna play with the LOW_PERFORAMCE and MID_PERFORMANCE&n; *     defines -&gt; please report me your experience then&n; *   - Harald reported for ASUS SP3G mainboards, that you should use&n; *     the &squot;optimal settings&squot; from the user&squot;s manual on page 3-12!&n; *&n; * credits:&n; *   thanx to Jason Sullivan for sending me a ni6510 card!&n; *   lot of debug runs with ASUS SP3G Boards (Intel Saturn) by Harald Koenig&n; *&n; * simple performance test: (486DX-33/Ni6510-EB receives from 486DX4-100/Ni6510-EB)&n; *    average: FTP -&gt; 8384421 bytes received in 8.5 seconds&n; *           (no RCV_VIA_SKB,no XMT_VIA_SKB,PARANOIA_CHECK,4 XMIT BUFS, 8 RCV_BUFFS)&n; *    peak: FTP -&gt; 8384421 bytes received in 7.5 seconds&n; *           (RCV_VIA_SKB,XMT_VIA_SKB,no PARANOIA_CHECK,1(!) XMIT BUF, 16 RCV BUFFS)&n; */
multiline_comment|/*&n; * 99.Jun.8: added support for /proc/net/dev byte count for xosview (HK)&n; * 96.Sept.29: virt_to_bus stuff added for new memory modell&n; * 96.April.29: Added Harald Koenig&squot;s Patches (MH)&n; * 96.April.13: enhanced error handling .. more tests (MH)&n; * 96.April.5/6: a lot of performance tests. Got it stable now (hopefully) (MH)&n; * 96.April.1: (no joke ;) .. added EtherBlaster and Module support (MH)&n; * 96.Feb.19: fixed a few bugs .. cleanups .. tested for 1.3.66 (MH)&n; *            hopefully no more 16MB limit&n; *&n; * 95.Nov.18: multicast tweaked (AC).&n; *&n; * 94.Aug.22: changes in xmit_intr (ack more than one xmitted-packet), ni65_send_packet (p-&gt;lock) (MH)&n; *&n; * 94.July.16: fixed bugs in recv_skb and skb-alloc stuff  (MH)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;ni65.h&quot;
multiline_comment|/*&n; * the current setting allows an acceptable performance&n; * for &squot;RCV_PARANOIA_CHECK&squot; read the &squot;known problems&squot; part in&n; * the header of this file&n; * &squot;invert&squot; the defines for max. performance. This may cause DMA problems&n; * on some boards (e.g on my ASUS SP3G)&n; */
DECL|macro|XMT_VIA_SKB
macro_line|#undef XMT_VIA_SKB
DECL|macro|RCV_VIA_SKB
macro_line|#undef RCV_VIA_SKB
DECL|macro|RCV_PARANOIA_CHECK
mdefine_line|#define RCV_PARANOIA_CHECK
DECL|macro|MID_PERFORMANCE
mdefine_line|#define MID_PERFORMANCE
macro_line|#if   defined( LOW_PERFORMANCE )
DECL|variable|isa0
DECL|variable|isa1
DECL|variable|csr80
r_static
r_int
id|isa0
op_assign
l_int|7
comma
id|isa1
op_assign
l_int|7
comma
id|csr80
op_assign
l_int|0x0c10
suffix:semicolon
macro_line|#elif defined( MID_PERFORMANCE )
DECL|variable|isa0
DECL|variable|isa1
DECL|variable|csr80
r_static
r_int
id|isa0
op_assign
l_int|5
comma
id|isa1
op_assign
l_int|5
comma
id|csr80
op_assign
l_int|0x2810
suffix:semicolon
macro_line|#else&t;/* high performance */
DECL|variable|isa0
DECL|variable|isa1
DECL|variable|csr80
r_static
r_int
id|isa0
op_assign
l_int|4
comma
id|isa1
op_assign
l_int|4
comma
id|csr80
op_assign
l_int|0x0017
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * a few card/vendor specific defines&n; */
DECL|macro|NI65_ID0
mdefine_line|#define NI65_ID0    0x00
DECL|macro|NI65_ID1
mdefine_line|#define NI65_ID1    0x55
DECL|macro|NI65_EB_ID0
mdefine_line|#define NI65_EB_ID0 0x52
DECL|macro|NI65_EB_ID1
mdefine_line|#define NI65_EB_ID1 0x44
DECL|macro|NE2100_ID0
mdefine_line|#define NE2100_ID0  0x57
DECL|macro|NE2100_ID1
mdefine_line|#define NE2100_ID1  0x57
DECL|macro|PORT
mdefine_line|#define PORT p-&gt;cmdr_addr
multiline_comment|/*&n; * buffer configuration&n; */
macro_line|#if 1
DECL|macro|RMDNUM
mdefine_line|#define RMDNUM 16
DECL|macro|RMDNUMMASK
mdefine_line|#define RMDNUMMASK 0x80000000
macro_line|#else
DECL|macro|RMDNUM
mdefine_line|#define RMDNUM 8
DECL|macro|RMDNUMMASK
mdefine_line|#define RMDNUMMASK 0x60000000 /* log2(RMDNUM)&lt;&lt;29 */
macro_line|#endif
macro_line|#if 0
mdefine_line|#define TMDNUM 1
mdefine_line|#define TMDNUMMASK 0x00000000
macro_line|#else
DECL|macro|TMDNUM
mdefine_line|#define TMDNUM 4
DECL|macro|TMDNUMMASK
mdefine_line|#define TMDNUMMASK 0x40000000 /* log2(TMDNUM)&lt;&lt;29 */
macro_line|#endif
multiline_comment|/* slightly oversized */
DECL|macro|R_BUF_SIZE
mdefine_line|#define R_BUF_SIZE 1544
DECL|macro|T_BUF_SIZE
mdefine_line|#define T_BUF_SIZE 1544
multiline_comment|/*&n; * lance register defines&n; */
DECL|macro|L_DATAREG
mdefine_line|#define L_DATAREG 0x00
DECL|macro|L_ADDRREG
mdefine_line|#define L_ADDRREG 0x02
DECL|macro|L_RESET
mdefine_line|#define L_RESET   0x04
DECL|macro|L_CONFIG
mdefine_line|#define L_CONFIG  0x05
DECL|macro|L_BUSIF
mdefine_line|#define L_BUSIF   0x06
multiline_comment|/*&n; * to access the lance/am7990-regs, you have to write&n; * reg-number into L_ADDRREG, then you can access it using L_DATAREG&n; */
DECL|macro|CSR0
mdefine_line|#define CSR0  0x00
DECL|macro|CSR1
mdefine_line|#define CSR1  0x01
DECL|macro|CSR2
mdefine_line|#define CSR2  0x02
DECL|macro|CSR3
mdefine_line|#define CSR3  0x03
DECL|macro|INIT_RING_BEFORE_START
mdefine_line|#define INIT_RING_BEFORE_START&t;0x1
DECL|macro|FULL_RESET_ON_ERROR
mdefine_line|#define FULL_RESET_ON_ERROR&t;0x2
macro_line|#if 0
mdefine_line|#define writereg(val,reg) {outw(reg,PORT+L_ADDRREG);inw(PORT+L_ADDRREG); &bslash;&n;                           outw(val,PORT+L_DATAREG);inw(PORT+L_DATAREG);}
mdefine_line|#define readreg(reg) (outw(reg,PORT+L_ADDRREG),inw(PORT+L_ADDRREG),&bslash;&n;                       inw(PORT+L_DATAREG))
macro_line|#if 0
mdefine_line|#define writedatareg(val) {outw(val,PORT+L_DATAREG);inw(PORT+L_DATAREG);}
macro_line|#else
mdefine_line|#define writedatareg(val) {  writereg(val,CSR0); }
macro_line|#endif
macro_line|#else
DECL|macro|writereg
mdefine_line|#define writereg(val,reg) {outw(reg,PORT+L_ADDRREG);outw(val,PORT+L_DATAREG);}
DECL|macro|readreg
mdefine_line|#define readreg(reg) (outw(reg,PORT+L_ADDRREG),inw(PORT+L_DATAREG))
DECL|macro|writedatareg
mdefine_line|#define writedatareg(val) { writereg(val,CSR0); }
macro_line|#endif
DECL|variable|ni_vendor
r_static
r_int
r_char
id|ni_vendor
(braket
)braket
op_assign
(brace
l_int|0x02
comma
l_int|0x07
comma
l_int|0x01
)brace
suffix:semicolon
DECL|struct|card
r_static
r_struct
id|card
(brace
DECL|member|id0
DECL|member|id1
r_int
r_char
id|id0
comma
id|id1
suffix:semicolon
DECL|member|id_offset
r_int
id|id_offset
suffix:semicolon
DECL|member|total_size
r_int
id|total_size
suffix:semicolon
DECL|member|cmd_offset
r_int
id|cmd_offset
suffix:semicolon
DECL|member|addr_offset
r_int
id|addr_offset
suffix:semicolon
DECL|member|vendor_id
r_int
r_char
op_star
id|vendor_id
suffix:semicolon
DECL|member|cardname
r_char
op_star
id|cardname
suffix:semicolon
DECL|member|config
r_int
r_char
id|config
suffix:semicolon
DECL|variable|cards
)brace
id|cards
(braket
)braket
op_assign
(brace
(brace
id|NI65_ID0
comma
id|NI65_ID1
comma
l_int|0x0e
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x8
comma
id|ni_vendor
comma
l_string|&quot;ni6510&quot;
comma
l_int|0x1
)brace
comma
(brace
id|NI65_EB_ID0
comma
id|NI65_EB_ID1
comma
l_int|0x0e
comma
l_int|0x18
comma
l_int|0x10
comma
l_int|0x0
comma
id|ni_vendor
comma
l_string|&quot;ni6510 EtherBlaster&quot;
comma
l_int|0x2
)brace
comma
(brace
id|NE2100_ID0
comma
id|NE2100_ID1
comma
l_int|0x0e
comma
l_int|0x18
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|NULL
comma
l_string|&quot;generic NE2100&quot;
comma
l_int|0x0
)brace
)brace
suffix:semicolon
DECL|macro|NUM_CARDS
mdefine_line|#define NUM_CARDS 3
DECL|struct|priv
r_struct
id|priv
(brace
DECL|member|rmdhead
r_struct
id|rmd
id|rmdhead
(braket
id|RMDNUM
)braket
suffix:semicolon
DECL|member|tmdhead
r_struct
id|tmd
id|tmdhead
(braket
id|TMDNUM
)braket
suffix:semicolon
DECL|member|ib
r_struct
id|init_block
id|ib
suffix:semicolon
DECL|member|rmdnum
r_int
id|rmdnum
suffix:semicolon
DECL|member|tmdnum
DECL|member|tmdlast
r_int
id|tmdnum
comma
id|tmdlast
suffix:semicolon
macro_line|#ifdef RCV_VIA_SKB
DECL|member|recv_skb
r_struct
id|sk_buff
op_star
id|recv_skb
(braket
id|RMDNUM
)braket
suffix:semicolon
macro_line|#else
DECL|member|recvbounce
r_void
op_star
id|recvbounce
(braket
id|RMDNUM
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef XMT_VIA_SKB
DECL|member|tmd_skb
r_struct
id|sk_buff
op_star
id|tmd_skb
(braket
id|TMDNUM
)braket
suffix:semicolon
macro_line|#endif
DECL|member|tmdbounce
r_void
op_star
id|tmdbounce
(braket
id|TMDNUM
)braket
suffix:semicolon
DECL|member|tmdbouncenum
r_int
id|tmdbouncenum
suffix:semicolon
DECL|member|lock
DECL|member|xmit_queued
r_int
id|lock
comma
id|xmit_queued
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|self
r_void
op_star
id|self
suffix:semicolon
DECL|member|cmdr_addr
r_int
id|cmdr_addr
suffix:semicolon
DECL|member|cardno
r_int
id|cardno
suffix:semicolon
DECL|member|features
r_int
id|features
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
id|ni65_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ni65_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ni65_recv_intr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ni65_xmit_intr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|ni65_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ni65_lance_reinit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ni65_init_lance
c_func
(paren
r_struct
id|priv
op_star
id|p
comma
r_int
r_char
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|ni65_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ni65_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ni65_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ni65_alloc_buffer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ni65_free_buffer
c_func
(paren
r_struct
id|priv
op_star
id|p
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|ni65_get_stats
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|irqtab
(braket
)braket
id|__initdata
op_assign
(brace
l_int|9
comma
l_int|12
comma
l_int|15
comma
l_int|5
)brace
suffix:semicolon
multiline_comment|/* irq config-translate */
DECL|variable|__initdata
r_static
r_int
id|dmatab
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
l_int|3
comma
l_int|5
comma
l_int|6
comma
l_int|7
)brace
suffix:semicolon
multiline_comment|/* dma config-translate and autodetect */
DECL|variable|debuglevel
r_static
r_int
id|debuglevel
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n; * set &squot;performance&squot; registers .. we must STOP lance for that&n; */
DECL|function|ni65_set_performance
r_static
r_void
id|ni65_set_performance
c_func
(paren
r_struct
id|priv
op_star
id|p
)paren
(brace
id|writereg
c_func
(paren
id|CSR0_STOP
op_or
id|CSR0_CLRALL
comma
id|CSR0
)paren
suffix:semicolon
multiline_comment|/* STOP */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|config
op_amp
l_int|0x02
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|80
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_ADDRREG
)paren
op_ne
l_int|80
)paren
(brace
r_return
suffix:semicolon
)brace
id|writereg
c_func
(paren
(paren
id|csr80
op_amp
l_int|0x3fff
)paren
comma
l_int|80
)paren
suffix:semicolon
multiline_comment|/* FIFO watermarks */
id|outw
c_func
(paren
l_int|0
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
r_int
)paren
id|isa0
comma
id|PORT
op_plus
id|L_BUSIF
)paren
suffix:semicolon
multiline_comment|/* write ISA 0: DMA_R : isa0 * 50ns */
id|outw
c_func
(paren
l_int|1
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
r_int
)paren
id|isa1
comma
id|PORT
op_plus
id|L_BUSIF
)paren
suffix:semicolon
multiline_comment|/* write ISA 1: DMA_W : isa1 * 50ns&t;*/
id|outw
c_func
(paren
id|CSR0
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
multiline_comment|/* switch back to CSR0 */
)brace
multiline_comment|/*&n; * open interface (up)&n; */
DECL|function|ni65_open
r_static
r_int
id|ni65_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|irqval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|ni65_interrupt
comma
l_int|0
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|cardname
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irqval
)paren
(brace
id|printk
(paren
l_string|&quot;%s: unable to get IRQ %d (irqval=%d).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|irqval
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ni65_lance_reinit
c_func
(paren
id|dev
)paren
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * close interface (down)&n; */
DECL|function|ni65_close
r_static
r_int
id|ni65_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_RESET
)paren
comma
id|PORT
op_plus
id|L_RESET
)paren
suffix:semicolon
multiline_comment|/* that&squot;s the hard way */
macro_line|#ifdef XMT_VIA_SKB
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
suffix:semicolon
id|p-&gt;tmd_skb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Probe The Card (not the lance-chip)&n; */
macro_line|#ifdef MODULE
r_static
macro_line|#endif
DECL|function|ni65_probe
r_int
id|__init
id|ni65_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
op_star
id|port
suffix:semicolon
r_static
r_int
id|ports
(braket
)braket
op_assign
(brace
l_int|0x360
comma
l_int|0x300
comma
l_int|0x320
comma
l_int|0x340
comma
l_int|0
)brace
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;base_addr
OG
l_int|0x1ff
)paren
multiline_comment|/* Check a single specified location. */
r_return
id|ni65_probe1
c_func
(paren
id|dev
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;base_addr
OG
l_int|0
)paren
multiline_comment|/* Don&squot;t probe at all. */
r_return
op_minus
id|ENXIO
suffix:semicolon
r_for
c_loop
(paren
id|port
op_assign
id|ports
suffix:semicolon
op_star
id|port
suffix:semicolon
id|port
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ni65_probe1
c_func
(paren
id|dev
comma
op_star
id|port
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * this is the real card probe ..&n; */
DECL|function|ni65_probe1
r_static
r_int
id|__init
id|ni65_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|priv
op_star
id|p
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|cards
(braket
id|i
)braket
dot
id|total_size
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|id_offset
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|cards
(braket
id|i
)braket
dot
id|id_offset
op_plus
l_int|0
)paren
op_ne
id|cards
(braket
id|i
)braket
dot
id|id0
op_logical_or
id|inb
c_func
(paren
id|ioaddr
op_plus
id|cards
(braket
id|i
)braket
dot
id|id_offset
op_plus
l_int|1
)paren
op_ne
id|cards
(braket
id|i
)braket
dot
id|id1
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cards
(braket
id|i
)braket
dot
id|vendor_id
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|3
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|cards
(braket
id|i
)braket
dot
id|addr_offset
op_plus
id|j
)paren
op_ne
id|cards
(braket
id|i
)braket
dot
id|vendor_id
(braket
id|j
)braket
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|NUM_CARDS
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|6
suffix:semicolon
id|j
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|j
)braket
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|cards
(braket
id|i
)braket
dot
id|addr_offset
op_plus
id|j
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|j
op_assign
id|ni65_alloc_buffer
c_func
(paren
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|j
suffix:semicolon
)brace
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|p-&gt;cmdr_addr
op_assign
id|ioaddr
op_plus
id|cards
(braket
id|i
)braket
dot
id|cmd_offset
suffix:semicolon
id|p-&gt;cardno
op_assign
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s found at %#3x, &quot;
comma
id|dev-&gt;name
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|cardname
comma
id|ioaddr
)paren
suffix:semicolon
id|outw
c_func
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_RESET
)paren
comma
id|PORT
op_plus
id|L_RESET
)paren
suffix:semicolon
multiline_comment|/* first: reset the card */
r_if
c_cond
(paren
(paren
id|j
op_assign
id|readreg
c_func
(paren
id|CSR0
)paren
)paren
op_ne
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;can&squot;t RESET card: %04x&bslash;n&quot;
comma
id|j
)paren
suffix:semicolon
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|88
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_ADDRREG
)paren
op_eq
l_int|88
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
id|v
op_assign
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
suffix:semicolon
id|v
op_lshift_assign
l_int|16
suffix:semicolon
id|outw
c_func
(paren
l_int|89
comma
id|PORT
op_plus
id|L_ADDRREG
)paren
suffix:semicolon
id|v
op_or_assign
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Version %#08lx, &quot;
comma
id|v
)paren
suffix:semicolon
id|p-&gt;features
op_assign
id|INIT_RING_BEFORE_START
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;ancient LANCE, &quot;
)paren
suffix:semicolon
id|p-&gt;features
op_assign
l_int|0x0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|cards
(braket
id|i
)braket
dot
id|config
)paren
)paren
(brace
id|dev-&gt;irq
op_assign
id|irqtab
(braket
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|L_CONFIG
)paren
op_rshift
l_int|2
)paren
op_amp
l_int|3
)braket
suffix:semicolon
id|dev-&gt;dma
op_assign
id|dmatab
(braket
id|inw
c_func
(paren
id|ioaddr
op_plus
id|L_CONFIG
)paren
op_amp
l_int|3
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IRQ %d (from card), DMA %d (from card).&bslash;n&quot;
comma
id|dev-&gt;irq
comma
id|dev-&gt;dma
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev-&gt;dma
op_eq
l_int|0
)paren
(brace
multiline_comment|/* &squot;stuck test&squot; from lance.c */
r_int
id|dma_channels
op_assign
(paren
(paren
id|inb
c_func
(paren
id|DMA1_STAT_REG
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
)paren
op_or
(paren
id|inb
c_func
(paren
id|DMA2_STAT_REG
)paren
op_amp
l_int|0xf0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|dma
op_assign
id|dmatab
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|dma
comma
op_amp
id|dma_channels
)paren
op_logical_or
id|request_dma
c_func
(paren
id|dma
comma
l_string|&quot;ni6510&quot;
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|flags
op_assign
id|claim_dma_lock
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
id|set_dma_mode
c_func
(paren
id|dma
comma
id|DMA_MODE_CASCADE
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
id|release_dma_lock
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ni65_init_lance
c_func
(paren
id|p
comma
id|dev-&gt;dev_addr
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* trigger memory access */
id|flags
op_assign
id|claim_dma_lock
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
id|free_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
id|release_dma_lock
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readreg
c_func
(paren
id|CSR0
)paren
op_amp
id|CSR0_IDON
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|5
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Can&squot;t detect DMA channel!&bslash;n&quot;
)paren
suffix:semicolon
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|dev-&gt;dma
op_assign
id|dmatab
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DMA %d (autodetected), &quot;
comma
id|dev-&gt;dma
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;DMA %d (assigned), &quot;
comma
id|dev-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
OL
l_int|2
)paren
(brace
id|ni65_init_lance
c_func
(paren
id|p
comma
id|dev-&gt;dev_addr
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|autoirq_setup
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|writereg
c_func
(paren
id|CSR0_INIT
op_or
id|CSR0_INEA
comma
id|CSR0
)paren
suffix:semicolon
multiline_comment|/* trigger interrupt */
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;irq
op_assign
id|autoirq_report
c_func
(paren
l_int|2
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Failed to detect IRQ line!&bslash;n&quot;
)paren
suffix:semicolon
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;IRQ %d (autodetected).&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;IRQ %d (assigned).&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dev-&gt;dma
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|cardname
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t request dma-channel %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|dev-&gt;dma
)paren
suffix:semicolon
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Grab the region so we can find another board.&n;&t; */
id|request_region
c_func
(paren
id|ioaddr
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|total_size
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|cardname
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;open
op_assign
id|ni65_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|ni65_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|ni65_send_packet
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|ni65_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|HZ
op_div
l_int|2
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|ni65_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_multicast_list
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* everything is OK */
)brace
multiline_comment|/*&n; * set lance register and trigger init&n; */
DECL|function|ni65_init_lance
r_static
r_void
id|ni65_init_lance
c_func
(paren
r_struct
id|priv
op_star
id|p
comma
r_int
r_char
op_star
id|daddr
comma
r_int
id|filter
comma
r_int
id|mode
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|pib
suffix:semicolon
id|writereg
c_func
(paren
id|CSR0_CLRALL
op_or
id|CSR0_STOP
comma
id|CSR0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;ib.eaddr
(braket
id|i
)braket
op_assign
id|daddr
(braket
id|i
)braket
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;ib.filter
(braket
id|i
)braket
op_assign
id|filter
suffix:semicolon
)brace
id|p-&gt;ib.mode
op_assign
id|mode
suffix:semicolon
id|p-&gt;ib.trp
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|p-&gt;tmdhead
)paren
op_or
id|TMDNUMMASK
suffix:semicolon
id|p-&gt;ib.rrp
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|p-&gt;rmdhead
)paren
op_or
id|RMDNUMMASK
suffix:semicolon
id|writereg
c_func
(paren
l_int|0
comma
id|CSR3
)paren
suffix:semicolon
multiline_comment|/* busmaster/no word-swap */
id|pib
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
op_amp
id|p-&gt;ib
)paren
suffix:semicolon
id|writereg
c_func
(paren
id|pib
op_amp
l_int|0xffff
comma
id|CSR1
)paren
suffix:semicolon
id|writereg
c_func
(paren
id|pib
op_rshift
l_int|16
comma
id|CSR2
)paren
suffix:semicolon
id|writereg
c_func
(paren
id|CSR0_INIT
comma
id|CSR0
)paren
suffix:semicolon
multiline_comment|/* this changes L_ADDRREG to CSR0 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mdelay
c_func
(paren
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
op_amp
(paren
id|CSR0_IDON
op_or
id|CSR0_MERR
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* init ok ? */
)brace
)brace
multiline_comment|/*&n; * allocate memory area and check the 16MB border&n; */
DECL|function|ni65_alloc_mem
r_static
r_void
op_star
id|ni65_alloc_mem
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|what
comma
r_int
id|size
comma
r_int
id|type
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_void
op_star
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|type
)paren
(brace
id|ret
op_assign
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|2
op_plus
l_int|16
op_plus
id|size
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unable to allocate %s memory.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|what
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
op_plus
l_int|16
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|R_BUF_SIZE
)paren
suffix:semicolon
multiline_comment|/* grab the whole space .. (not necessary) */
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|ptr
op_assign
id|kmalloc
c_func
(paren
id|T_BUF_SIZE
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unable to allocate %s memory.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|what
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|ptr
op_plus
id|size
)paren
OG
l_int|0x1000000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unable to allocate %s memory in lower 16MB!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|what
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * allocate all memory structures .. send/recv buffers etc ...&n; */
DECL|function|ni65_alloc_buffer
r_static
r_int
id|ni65_alloc_buffer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_struct
id|priv
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * we need 8-aligned memory ..&n;&t; */
id|ptr
op_assign
id|ni65_alloc_mem
c_func
(paren
id|dev
comma
l_string|&quot;BUFFER&quot;
comma
r_sizeof
(paren
r_struct
id|priv
)paren
op_plus
l_int|8
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p
op_assign
id|dev-&gt;priv
op_assign
(paren
r_struct
id|priv
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|ptr
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|0x7
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|priv
)paren
)paren
suffix:semicolon
id|p-&gt;self
op_assign
id|ptr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef XMT_VIA_SKB
id|p-&gt;tmd_skb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|p-&gt;tmdbounce
(braket
id|i
)braket
op_assign
id|ni65_alloc_mem
c_func
(paren
id|dev
comma
l_string|&quot;XMIT&quot;
comma
id|T_BUF_SIZE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;tmdbounce
(braket
id|i
)braket
)paren
(brace
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef RCV_VIA_SKB
id|p-&gt;recv_skb
(braket
id|i
)braket
op_assign
id|ni65_alloc_mem
c_func
(paren
id|dev
comma
l_string|&quot;RECV&quot;
comma
id|R_BUF_SIZE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;recv_skb
(braket
id|i
)braket
)paren
(brace
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#else
id|p-&gt;recvbounce
(braket
id|i
)braket
op_assign
id|ni65_alloc_mem
c_func
(paren
id|dev
comma
l_string|&quot;RECV&quot;
comma
id|R_BUF_SIZE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;recvbounce
(braket
id|i
)braket
)paren
(brace
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* everything is OK */
)brace
multiline_comment|/*&n; * free buffers and private struct&n; */
DECL|function|ni65_free_buffer
r_static
r_void
id|ni65_free_buffer
c_func
(paren
r_struct
id|priv
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;tmdbounce
(braket
id|i
)braket
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;tmdbounce
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#ifdef XMT_VIA_SKB
r_if
c_cond
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef RCV_VIA_SKB
r_if
c_cond
(paren
id|p-&gt;recv_skb
(braket
id|i
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|p-&gt;recv_skb
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|p-&gt;recvbounce
(braket
id|i
)braket
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;recvbounce
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|p-&gt;self
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;self
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * stop and (re)start lance .. e.g after an error&n; */
DECL|function|ni65_stop_start
r_static
r_void
id|ni65_stop_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|priv
op_star
id|p
)paren
(brace
r_int
id|csr0
op_assign
id|CSR0_INEA
suffix:semicolon
id|writedatareg
c_func
(paren
id|CSR0_STOP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ni65_stop_start&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|INIT_RING_BEFORE_START
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef XMT_VIA_SKB
r_struct
id|sk_buff
op_star
id|skb_save
(braket
id|TMDNUM
)braket
suffix:semicolon
macro_line|#endif
r_int
r_int
id|buffer
(braket
id|TMDNUM
)braket
suffix:semicolon
r_int
id|blen
(braket
id|TMDNUM
)braket
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;xmit_queued
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;tmdhead
(braket
id|p-&gt;tmdlast
)braket
dot
id|u.s.status
op_amp
id|XMIT_OWN
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|p-&gt;tmdlast
op_assign
(paren
id|p-&gt;tmdlast
op_plus
l_int|1
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;tmdlast
op_eq
id|p-&gt;tmdnum
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|tmd
op_star
id|tmdp
op_assign
id|p-&gt;tmdhead
op_plus
id|i
suffix:semicolon
macro_line|#ifdef XMT_VIA_SKB
id|skb_save
(braket
id|i
)braket
op_assign
id|p-&gt;tmd_skb
(braket
id|i
)braket
suffix:semicolon
macro_line|#endif
id|buffer
(braket
id|i
)braket
op_assign
(paren
id|u32
)paren
id|bus_to_virt
c_func
(paren
id|tmdp-&gt;u.buffer
)paren
suffix:semicolon
id|blen
(braket
id|i
)braket
op_assign
id|tmdp-&gt;blen
suffix:semicolon
id|tmdp-&gt;u.s.status
op_assign
l_int|0x0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|rmd
op_star
id|rmdp
op_assign
id|p-&gt;rmdhead
op_plus
id|i
suffix:semicolon
id|rmdp-&gt;u.s.status
op_assign
id|RCV_OWN
suffix:semicolon
)brace
id|p-&gt;tmdnum
op_assign
id|p-&gt;xmit_queued
op_assign
l_int|0
suffix:semicolon
id|writedatareg
c_func
(paren
id|CSR0_STRT
op_or
id|csr0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|num
op_assign
(paren
id|i
op_plus
id|p-&gt;tmdlast
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
id|p-&gt;tmdhead
(braket
id|i
)braket
dot
id|u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
(paren
r_char
op_star
)paren
id|buffer
(braket
id|num
)braket
)paren
suffix:semicolon
multiline_comment|/* status is part of buffer field */
id|p-&gt;tmdhead
(braket
id|i
)braket
dot
id|blen
op_assign
id|blen
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;tmdhead
(braket
id|i
)braket
dot
id|u.s.status
op_amp
id|XMIT_OWN
)paren
(brace
id|p-&gt;tmdnum
op_assign
(paren
id|p-&gt;tmdnum
op_plus
l_int|1
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
id|p-&gt;xmit_queued
op_assign
l_int|1
suffix:semicolon
id|writedatareg
c_func
(paren
id|CSR0_TDMD
op_or
id|CSR0_INEA
op_or
id|csr0
)paren
suffix:semicolon
)brace
macro_line|#ifdef XMT_VIA_SKB
id|p-&gt;tmd_skb
(braket
id|i
)braket
op_assign
id|skb_save
(braket
id|num
)braket
suffix:semicolon
macro_line|#endif
)brace
id|p-&gt;rmdnum
op_assign
id|p-&gt;tmdlast
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;lock
)paren
r_if
c_cond
(paren
id|p-&gt;tmdnum
op_logical_or
op_logical_neg
id|p-&gt;xmit_queued
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
id|writedatareg
c_func
(paren
id|CSR0_STRT
op_or
id|csr0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * init lance (write init-values .. init-buffers) (open-helper)&n; */
DECL|function|ni65_lance_reinit
r_static
r_int
id|ni65_lance_reinit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|p-&gt;lock
op_assign
l_int|0
suffix:semicolon
id|p-&gt;xmit_queued
op_assign
l_int|0
suffix:semicolon
id|flags
op_assign
id|claim_dma_lock
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|dev-&gt;dma
)paren
suffix:semicolon
multiline_comment|/* I&squot;ve never worked with dma, but we do it like the packetdriver */
id|set_dma_mode
c_func
(paren
id|dev-&gt;dma
comma
id|DMA_MODE_CASCADE
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
id|dev-&gt;dma
)paren
suffix:semicolon
id|release_dma_lock
c_func
(paren
id|flags
)paren
suffix:semicolon
id|outw
c_func
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_RESET
)paren
comma
id|PORT
op_plus
id|L_RESET
)paren
suffix:semicolon
multiline_comment|/* first: reset the card */
r_if
c_cond
(paren
(paren
id|i
op_assign
id|readreg
c_func
(paren
id|CSR0
)paren
)paren
op_ne
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t RESET %s card: %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|cardname
comma
(paren
r_int
)paren
id|i
)paren
suffix:semicolon
id|flags
op_assign
id|claim_dma_lock
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|dev-&gt;dma
)paren
suffix:semicolon
id|release_dma_lock
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|p-&gt;rmdnum
op_assign
id|p-&gt;tmdnum
op_assign
id|p-&gt;tmdlast
op_assign
id|p-&gt;tmdbouncenum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|tmd
op_star
id|tmdp
op_assign
id|p-&gt;tmdhead
op_plus
id|i
suffix:semicolon
macro_line|#ifdef XMT_VIA_SKB
r_if
c_cond
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|p-&gt;tmd_skb
(braket
id|i
)braket
)paren
suffix:semicolon
id|p-&gt;tmd_skb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|tmdp-&gt;u.buffer
op_assign
l_int|0x0
suffix:semicolon
id|tmdp-&gt;u.s.status
op_assign
id|XMIT_START
op_or
id|XMIT_END
suffix:semicolon
id|tmdp-&gt;blen
op_assign
id|tmdp-&gt;status2
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|rmd
op_star
id|rmdp
op_assign
id|p-&gt;rmdhead
op_plus
id|i
suffix:semicolon
macro_line|#ifdef RCV_VIA_SKB
id|rmdp-&gt;u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|p-&gt;recv_skb
(braket
id|i
)braket
op_member_access_from_pointer
id|data
)paren
suffix:semicolon
macro_line|#else
id|rmdp-&gt;u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|p-&gt;recvbounce
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#endif
id|rmdp-&gt;blen
op_assign
op_minus
(paren
id|R_BUF_SIZE
op_minus
l_int|8
)paren
suffix:semicolon
id|rmdp-&gt;mlen
op_assign
l_int|0
suffix:semicolon
id|rmdp-&gt;u.s.status
op_assign
id|RCV_OWN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|ni65_init_lance
c_func
(paren
id|p
comma
id|dev-&gt;dev_addr
comma
l_int|0x00
comma
id|M_PROM
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_logical_or
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
id|ni65_init_lance
c_func
(paren
id|p
comma
id|dev-&gt;dev_addr
comma
l_int|0xff
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_else
id|ni65_init_lance
c_func
(paren
id|p
comma
id|dev-&gt;dev_addr
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ni65_set_lance_mem() sets L_ADDRREG to CSR0&n;&t; * NOW, WE WILL NEVER CHANGE THE L_ADDRREG, CSR0 IS ALWAYS SELECTED&n;&t; */
r_if
c_cond
(paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
op_amp
id|CSR0_IDON
)paren
(brace
id|ni65_set_performance
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* init OK: start lance , enable interrupts */
id|writedatareg
c_func
(paren
id|CSR0_CLRALL
op_or
id|CSR0_INEA
op_or
id|CSR0_STRT
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* -&gt;OK */
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t init lance, status: %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
)paren
suffix:semicolon
id|flags
op_assign
id|claim_dma_lock
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|dev-&gt;dma
)paren
suffix:semicolon
id|release_dma_lock
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* -&gt;Error */
)brace
multiline_comment|/*&n; * interrupt handler&n; */
DECL|function|ni65_interrupt
r_static
r_void
id|ni65_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|csr0
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|priv
op_star
id|p
suffix:semicolon
r_int
id|bcnt
op_assign
l_int|32
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|bcnt
)paren
(brace
id|csr0
op_assign
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
suffix:semicolon
macro_line|#if 0
id|writedatareg
c_func
(paren
(paren
id|csr0
op_amp
id|CSR0_CLRALL
)paren
)paren
suffix:semicolon
multiline_comment|/* ack interrupts, disable int. */
macro_line|#else
id|writedatareg
c_func
(paren
(paren
id|csr0
op_amp
id|CSR0_CLRALL
)paren
op_or
id|CSR0_INEA
)paren
suffix:semicolon
multiline_comment|/* ack interrupts, interrupts enabled */
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|csr0
op_amp
(paren
id|CSR0_ERR
op_or
id|CSR0_RINT
op_or
id|CSR0_TINT
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_RINT
)paren
(brace
multiline_comment|/* RECV-int? */
id|ni65_recv_intr
c_func
(paren
id|dev
comma
id|csr0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_TINT
)paren
(brace
multiline_comment|/* XMIT-int? */
id|ni65_xmit_intr
c_func
(paren
id|dev
comma
id|csr0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_ERR
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: general error: %04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_BABL
)paren
(brace
id|p-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_MISS
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|p-&gt;rmdhead
(braket
id|i
)braket
dot
id|u.s.status
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|p-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr0
op_amp
id|CSR0_MERR
)paren
(brace
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Ooops .. memory error: %04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr0
)paren
suffix:semicolon
)brace
id|ni65_stop_start
c_func
(paren
id|dev
comma
id|p
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef RCV_PARANOIA_CHECK
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|RMDNUM
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
comma
id|k
comma
id|num1
comma
id|num2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|RMDNUM
op_minus
l_int|1
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|num2
op_assign
(paren
id|p-&gt;rmdnum
op_plus
id|i
)paren
op_amp
(paren
id|RMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;rmdhead
(braket
id|num2
)braket
dot
id|u.s.status
op_amp
id|RCV_OWN
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|RMDNUM
suffix:semicolon
id|k
op_increment
)paren
(brace
id|num1
op_assign
(paren
id|p-&gt;rmdnum
op_plus
id|k
)paren
op_amp
(paren
id|RMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;rmdhead
(braket
id|num1
)braket
dot
id|u.s.status
op_amp
id|RCV_OWN
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|k
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
r_char
id|buf
(braket
l_int|256
)braket
comma
op_star
id|buf1
suffix:semicolon
r_int
id|k
suffix:semicolon
id|buf1
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|RMDNUM
suffix:semicolon
id|k
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buf1
comma
l_string|&quot;%02x &quot;
comma
(paren
id|p-&gt;rmdhead
(braket
id|k
)braket
dot
id|u.s.status
)paren
)paren
suffix:semicolon
multiline_comment|/* &amp; RCV_OWN) ); */
id|buf1
op_add_assign
l_int|3
suffix:semicolon
)brace
op_star
id|buf1
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Ooops, receive ring corrupted %2d %2d | %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|p-&gt;rmdnum
comma
id|i
comma
id|buf
)paren
suffix:semicolon
)brace
id|p-&gt;rmdnum
op_assign
id|num1
suffix:semicolon
id|ni65_recv_intr
c_func
(paren
id|dev
comma
id|csr0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;rmdhead
(braket
id|num2
)braket
dot
id|u.s.status
op_amp
id|RCV_OWN
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* ok, we are &squot;in sync&squot; again */
)brace
r_else
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|csr0
op_amp
(paren
id|CSR0_RXON
op_or
id|CSR0_TXON
)paren
)paren
op_ne
(paren
id|CSR0_RXON
op_or
id|CSR0_TXON
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: RX or TX was offline -&gt; restart&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ni65_stop_start
c_func
(paren
id|dev
comma
id|p
)paren
suffix:semicolon
)brace
r_else
id|writedatareg
c_func
(paren
id|CSR0_INEA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * We have received an Xmit-Interrupt ..&n; * send a new packet if necessary&n; */
DECL|function|ni65_xmit_intr
r_static
r_void
id|ni65_xmit_intr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|csr0
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
id|p-&gt;xmit_queued
)paren
(brace
r_struct
id|tmd
op_star
id|tmdp
op_assign
id|p-&gt;tmdhead
op_plus
id|p-&gt;tmdlast
suffix:semicolon
r_int
id|tmdstat
op_assign
id|tmdp-&gt;u.s.status
suffix:semicolon
r_if
c_cond
(paren
id|tmdstat
op_amp
id|XMIT_OWN
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmdstat
op_amp
id|XMIT_ERR
)paren
(brace
macro_line|#if 0
r_if
c_cond
(paren
id|tmdp-&gt;status2
op_amp
id|XMIT_TDRMASK
op_logical_and
id|debuglevel
OG
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: tdr-problems (e.g. no resistor)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* checking some errors */
r_if
c_cond
(paren
id|tmdp-&gt;status2
op_amp
id|XMIT_RTRY
)paren
(brace
id|p-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmdp-&gt;status2
op_amp
id|XMIT_LCAR
)paren
(brace
id|p-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmdp-&gt;status2
op_amp
(paren
id|XMIT_BUFF
op_or
id|XMIT_UFLO
)paren
)paren
(brace
multiline_comment|/* this stops the xmitter */
id|p-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Xmit FIFO/BUFF error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;features
op_amp
id|INIT_RING_BEFORE_START
)paren
(brace
id|tmdp-&gt;u.s.status
op_assign
id|XMIT_OWN
op_or
id|XMIT_START
op_or
id|XMIT_END
suffix:semicolon
multiline_comment|/* test: resend this frame */
id|ni65_stop_start
c_func
(paren
id|dev
comma
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* no more Xmit processing .. */
)brace
r_else
id|ni65_stop_start
c_func
(paren
id|dev
comma
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debuglevel
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: xmit-error: %04x %02x-%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr0
comma
(paren
r_int
)paren
id|tmdstat
comma
(paren
r_int
)paren
id|tmdp-&gt;status2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|csr0
op_amp
id|CSR0_BABL
)paren
)paren
(brace
multiline_comment|/* don&squot;t count errors twice */
id|p-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
id|tmdp-&gt;status2
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;stats.tx_bytes
op_sub_assign
(paren
r_int
)paren
(paren
id|tmdp-&gt;blen
)paren
suffix:semicolon
id|p-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
macro_line|#ifdef XMT_VIA_SKB
r_if
c_cond
(paren
id|p-&gt;tmd_skb
(braket
id|p-&gt;tmdlast
)braket
)paren
(brace
id|dev_kfree_skb_irq
c_func
(paren
id|p-&gt;tmd_skb
(braket
id|p-&gt;tmdlast
)braket
)paren
suffix:semicolon
id|p-&gt;tmd_skb
(braket
id|p-&gt;tmdlast
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|p-&gt;tmdlast
op_assign
(paren
id|p-&gt;tmdlast
op_plus
l_int|1
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;tmdlast
op_eq
id|p-&gt;tmdnum
)paren
(brace
id|p-&gt;xmit_queued
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * We have received a packet&n; */
DECL|function|ni65_recv_intr
r_static
r_void
id|ni65_recv_intr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|csr0
)paren
(brace
r_struct
id|rmd
op_star
id|rmdp
suffix:semicolon
r_int
id|rmdstat
comma
id|len
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|rmdp
op_assign
id|p-&gt;rmdhead
op_plus
id|p-&gt;rmdnum
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|rmdstat
op_assign
id|rmdp-&gt;u.s.status
)paren
op_amp
id|RCV_OWN
)paren
)paren
(brace
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rmdstat
op_amp
(paren
id|RCV_START
op_or
id|RCV_END
op_or
id|RCV_ERR
)paren
)paren
op_ne
(paren
id|RCV_START
op_or
id|RCV_END
)paren
)paren
multiline_comment|/* error or oversized? */
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rmdstat
op_amp
id|RCV_ERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|rmdstat
op_amp
id|RCV_START
)paren
(brace
id|p-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: recv, packet too long: %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rmdp-&gt;mlen
op_amp
l_int|0x0fff
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|debuglevel
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: receive-error: %04x, lance-status: %04x/%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|rmdstat
comma
id|csr0
comma
(paren
r_int
)paren
id|inw
c_func
(paren
id|PORT
op_plus
id|L_DATAREG
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmdstat
op_amp
id|RCV_FRAM
)paren
(brace
id|p-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmdstat
op_amp
id|RCV_OFLO
)paren
(brace
id|p-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmdstat
op_amp
id|RCV_CRC
)paren
(brace
id|p-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmdstat
op_amp
id|RCV_BUF_ERR
)paren
(brace
id|p-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|csr0
op_amp
id|CSR0_MISS
)paren
)paren
(brace
multiline_comment|/* don&squot;t count errors twice */
id|p-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|len
op_assign
(paren
id|rmdp-&gt;mlen
op_amp
l_int|0x0fff
)paren
op_minus
l_int|4
)paren
op_ge
l_int|60
)paren
(brace
macro_line|#ifdef RCV_VIA_SKB
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|R_BUF_SIZE
op_plus
l_int|2
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|16
)paren
suffix:semicolon
macro_line|#else
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|2
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|skb
)paren
(brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
macro_line|#ifdef RCV_VIA_SKB
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|skb-&gt;data
op_plus
id|R_BUF_SIZE
)paren
OG
l_int|0x1000000
)paren
(brace
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
(paren
id|p-&gt;recv_skb
(braket
id|p-&gt;rmdnum
)braket
op_member_access_from_pointer
id|data
)paren
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb1
op_assign
id|p-&gt;recv_skb
(braket
id|p-&gt;rmdnum
)braket
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|R_BUF_SIZE
)paren
suffix:semicolon
id|p-&gt;recv_skb
(braket
id|p-&gt;rmdnum
)braket
op_assign
id|skb
suffix:semicolon
id|rmdp-&gt;u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|skb
op_assign
id|skb1
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#else
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
id|p-&gt;recvbounce
(braket
id|p-&gt;rmdnum
)braket
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|p-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|p-&gt;stats.rx_bytes
op_add_assign
id|len
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t alloc new sk_buff&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|p-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: received runt packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|p-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
id|rmdp-&gt;blen
op_assign
op_minus
(paren
id|R_BUF_SIZE
op_minus
l_int|8
)paren
suffix:semicolon
id|rmdp-&gt;mlen
op_assign
l_int|0
suffix:semicolon
id|rmdp-&gt;u.s.status
op_assign
id|RCV_OWN
suffix:semicolon
multiline_comment|/* change owner */
id|p-&gt;rmdnum
op_assign
(paren
id|p-&gt;rmdnum
op_plus
l_int|1
)paren
op_amp
(paren
id|RMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
id|rmdp
op_assign
id|p-&gt;rmdhead
op_plus
id|p-&gt;rmdnum
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * kick xmitter ..&n; */
DECL|function|ni65_timeout
r_static
r_void
id|ni65_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: xmitter timed out, try to restart!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|p-&gt;tmdhead
(braket
id|i
)braket
dot
id|u.s.status
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|ni65_lance_reinit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send a packet&n; */
DECL|function|ni65_send_packet
r_static
r_int
id|ni65_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|p-&gt;lock
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Queue was locked.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
(brace
r_int
id|len
op_assign
id|ETH_ZLEN
OL
id|skb-&gt;len
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
r_struct
id|tmd
op_star
id|tmdp
suffix:semicolon
r_int
id|flags
suffix:semicolon
macro_line|#ifdef XMT_VIA_SKB
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|skb-&gt;data
op_plus
id|skb-&gt;len
)paren
OG
l_int|0x1000000
)paren
(brace
macro_line|#endif
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;tmdbounce
(braket
id|p-&gt;tmdbouncenum
)braket
comma
(paren
r_char
op_star
)paren
id|skb-&gt;data
comma
(paren
id|skb-&gt;len
OG
id|T_BUF_SIZE
)paren
ques
c_cond
id|T_BUF_SIZE
suffix:colon
id|skb-&gt;len
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|tmdp
op_assign
id|p-&gt;tmdhead
op_plus
id|p-&gt;tmdnum
suffix:semicolon
id|tmdp-&gt;u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|p-&gt;tmdbounce
(braket
id|p-&gt;tmdbouncenum
)braket
)paren
suffix:semicolon
id|p-&gt;tmdbouncenum
op_assign
(paren
id|p-&gt;tmdbouncenum
op_plus
l_int|1
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef XMT_VIA_SKB
)brace
r_else
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|tmdp
op_assign
id|p-&gt;tmdhead
op_plus
id|p-&gt;tmdnum
suffix:semicolon
id|tmdp-&gt;u.buffer
op_assign
(paren
id|u32
)paren
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|p-&gt;tmd_skb
(braket
id|p-&gt;tmdnum
)braket
op_assign
id|skb
suffix:semicolon
)brace
macro_line|#endif
id|tmdp-&gt;blen
op_assign
op_minus
id|len
suffix:semicolon
id|tmdp-&gt;u.s.status
op_assign
id|XMIT_OWN
op_or
id|XMIT_START
op_or
id|XMIT_END
suffix:semicolon
id|writedatareg
c_func
(paren
id|CSR0_TDMD
op_or
id|CSR0_INEA
)paren
suffix:semicolon
multiline_comment|/* enable xmit &amp; interrupt */
id|p-&gt;xmit_queued
op_assign
l_int|1
suffix:semicolon
id|p-&gt;tmdnum
op_assign
(paren
id|p-&gt;tmdnum
op_plus
l_int|1
)paren
op_amp
(paren
id|TMDNUM
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;tmdnum
op_ne
id|p-&gt;tmdlast
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|p-&gt;lock
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ni65_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|ni65_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#if 0
r_int
id|i
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RMDNUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|rmd
op_star
id|rmdp
op_assign
id|p-&gt;rmdhead
op_plus
(paren
(paren
id|p-&gt;rmdnum
op_plus
id|i
)paren
op_amp
(paren
id|RMDNUM
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|rmdp-&gt;u.s.status
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_amp
(paren
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ni65_lance_reinit
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t switch card into MC mode!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|dev_ni65
r_static
r_struct
id|net_device
id|dev_ni65
op_assign
(brace
l_string|&quot;&quot;
comma
multiline_comment|/* &quot;ni6510&quot;: device name inserted by net_init.c */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x360
comma
l_int|9
comma
multiline_comment|/* I/O address, IRQ */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|ni65_probe
)brace
suffix:semicolon
multiline_comment|/* set: io,irq,dma or set it when calling insmod */
DECL|variable|irq
r_static
r_int
id|irq
op_assign
l_int|0
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
l_int|0
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|dma
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|dev_ni65.irq
op_assign
id|irq
suffix:semicolon
id|dev_ni65.dma
op_assign
id|dma
suffix:semicolon
id|dev_ni65.base_addr
op_assign
id|io
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_ni65
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|priv
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev_ni65.priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Ooops .. no private struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|disable_dma
c_func
(paren
id|dev_ni65.dma
)paren
suffix:semicolon
id|free_dma
c_func
(paren
id|dev_ni65.dma
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
op_amp
id|dev_ni65
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_ni65.base_addr
comma
id|cards
(braket
id|p-&gt;cardno
)braket
dot
id|total_size
)paren
suffix:semicolon
id|ni65_free_buffer
c_func
(paren
id|p
)paren
suffix:semicolon
id|dev_ni65.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
multiline_comment|/*&n; * END of ni65.c&n; */
eof
