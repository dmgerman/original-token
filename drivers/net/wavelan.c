multiline_comment|/*&n; * AT&amp;T GIS (nee NCR) WaveLAN card:&n; *&t;An Ethernet-like radio transceiver&n; *&t;controlled by an Intel 82586 coprocessor.&n; */
macro_line|#include&t;&lt;linux/config.h&gt;
macro_line|#if&t;defined(MODULE)
macro_line|#include&t;&lt;linux/module.h&gt;
macro_line|#include&t;&lt;linux/version.h&gt;
macro_line|#endif&t;/* defined(MODULE) */
macro_line|#include&t;&lt;linux/kernel.h&gt;
macro_line|#include&t;&lt;linux/sched.h&gt;
macro_line|#include&t;&lt;linux/types.h&gt;
macro_line|#include&t;&lt;linux/fcntl.h&gt;
macro_line|#include&t;&lt;linux/interrupt.h&gt;
macro_line|#include&t;&lt;linux/stat.h&gt;
macro_line|#include&t;&lt;linux/ptrace.h&gt;
macro_line|#include&t;&lt;linux/ioport.h&gt;
macro_line|#include&t;&lt;linux/in.h&gt;
macro_line|#include&t;&lt;linux/string.h&gt;
macro_line|#include&t;&lt;linux/delay.h&gt;
macro_line|#include&t;&lt;asm/system.h&gt;
macro_line|#include&t;&lt;asm/bitops.h&gt;
macro_line|#include&t;&lt;asm/io.h&gt;
macro_line|#include&t;&lt;asm/dma.h&gt;
macro_line|#include&t;&lt;linux/errno.h&gt;
macro_line|#include&t;&lt;linux/netdevice.h&gt;
macro_line|#include&t;&lt;linux/etherdevice.h&gt;
macro_line|#include&t;&lt;linux/skbuff.h&gt;
macro_line|#include&t;&lt;linux/malloc.h&gt;
macro_line|#include&t;&lt;linux/timer.h&gt;
macro_line|#include&t;&lt;linux/proc_fs.h&gt;
DECL|macro|STRUCT_CHECK
mdefine_line|#define&t;STRUCT_CHECK&t;1
macro_line|#include&t;&quot;i82586.h&quot;
macro_line|#include&t;&quot;wavelan.h&quot;
macro_line|#ifndef WAVELAN_DEBUG
DECL|macro|WAVELAN_DEBUG
mdefine_line|#define WAVELAN_DEBUG&t;&t;&t;0
macro_line|#endif&t;/* WAVELAN_DEBUG */
DECL|macro|WATCHDOG_JIFFIES
mdefine_line|#define&t;WATCHDOG_JIFFIES&t;&t;512&t;/* TODO: express in HZ. */
DECL|macro|ENABLE_FULL_PROMISCUOUS
mdefine_line|#define&t;ENABLE_FULL_PROMISCUOUS&t;&t;0x10000
DECL|macro|nels
mdefine_line|#define&t;nels(a)&t;&t;&t;&t;(sizeof(a) / sizeof(a[0]))
DECL|typedef|device
r_typedef
r_struct
id|device
id|device
suffix:semicolon
DECL|typedef|en_stats
r_typedef
r_struct
id|enet_statistics
id|en_stats
suffix:semicolon
DECL|typedef|net_local
r_typedef
r_struct
id|net_local
id|net_local
suffix:semicolon
DECL|typedef|timer_list
r_typedef
r_struct
id|timer_list
id|timer_list
suffix:semicolon
DECL|struct|net_local
r_struct
id|net_local
(brace
DECL|member|stats
id|en_stats
id|stats
suffix:semicolon
DECL|member|tx_n_in_use
r_int
r_int
id|tx_n_in_use
suffix:semicolon
DECL|member|nwid
r_int
r_char
id|nwid
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|hacr
r_int
r_int
id|hacr
suffix:semicolon
DECL|member|rx_head
r_int
r_int
id|rx_head
suffix:semicolon
DECL|member|rx_last
r_int
r_int
id|rx_last
suffix:semicolon
DECL|member|tx_first_free
r_int
r_int
id|tx_first_free
suffix:semicolon
DECL|member|tx_first_in_use
r_int
r_int
id|tx_first_in_use
suffix:semicolon
DECL|member|nresets
r_int
r_int
id|nresets
suffix:semicolon
DECL|member|correct_nwid
r_int
r_int
id|correct_nwid
suffix:semicolon
DECL|member|wrong_nwid
r_int
r_int
id|wrong_nwid
suffix:semicolon
DECL|member|promiscuous
r_int
r_int
id|promiscuous
suffix:semicolon
DECL|member|full_promiscuous
r_int
r_int
id|full_promiscuous
suffix:semicolon
DECL|member|watchdog
id|timer_list
id|watchdog
suffix:semicolon
DECL|member|dev
id|device
op_star
id|dev
suffix:semicolon
DECL|member|prev
id|net_local
op_star
id|prev
suffix:semicolon
DECL|member|next
id|net_local
op_star
id|next
suffix:semicolon
)brace
suffix:semicolon
r_extern
r_int
id|wavelan_probe
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
multiline_comment|/* See Space.c */
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;wavelan.c:v7 95/4/8&bslash;n&quot;
suffix:semicolon
multiline_comment|/*&n; * Entry point forward declarations.&n; */
r_static
r_int
id|wavelan_probe1
c_func
(paren
id|device
op_star
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
id|wavelan_open
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_int
id|wavelan_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
comma
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_interrupt
c_func
(paren
r_int
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_static
r_int
id|wavelan_close
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
id|en_stats
op_star
id|wavelan_get_stats
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_set_multicast_list
c_func
(paren
id|device
op_star
comma
r_int
comma
r_void
op_star
)paren
suffix:semicolon
r_static
r_int
id|wavelan_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * Other forward declarations.&n; */
r_static
r_void
id|wavelan_cu_show_one
c_func
(paren
id|device
op_star
comma
id|net_local
op_star
comma
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|wavelan_cu_start
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_ru_start
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_watchdog
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
macro_line|#if&t;0
r_static
r_void
id|wavelan_psa_show
c_func
(paren
id|psa_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_mmc_show
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
macro_line|#endif&t;/* 0 */
r_static
r_void
id|wavelan_scb_show
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|wavelan_ru_show
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_cu_show
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_dev_show
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
r_static
r_void
id|wavelan_local_show
c_func
(paren
id|device
op_star
)paren
suffix:semicolon
DECL|variable|wavelan_debug
r_static
r_int
r_int
id|wavelan_debug
op_assign
id|WAVELAN_DEBUG
suffix:semicolon
DECL|variable|first_wavelan
r_static
id|net_local
op_star
id|first_wavelan
op_assign
(paren
id|net_local
op_star
)paren
l_int|0
suffix:semicolon
r_static
r_int
r_int
DECL|function|wavelan_splhi
id|wavelan_splhi
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_return
id|flags
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_splx
id|wavelan_splx
c_func
(paren
r_int
r_int
id|flags
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|hasr_read
id|hasr_read
c_func
(paren
r_int
r_int
id|ioaddr
)paren
(brace
r_return
id|inw
c_func
(paren
id|HASR
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hacr_write
id|hacr_write
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
id|hacr
)paren
(brace
id|outw
c_func
(paren
id|hacr
comma
id|HACR
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hacr_write_slow
id|hacr_write_slow
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
id|hacr
)paren
(brace
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
multiline_comment|/* delay might only be needed sometimes */
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the channel attention bit.&n; */
r_static
r_void
DECL|function|set_chan_attn
id|set_chan_attn
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|current_hacr
)paren
(brace
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|current_hacr
op_or
id|HACR_CA
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Reset, and then set host adaptor into default mode.&n; */
r_static
r_void
DECL|function|wavelan_reset
id|wavelan_reset
c_func
(paren
r_int
r_int
id|ioaddr
)paren
(brace
id|hacr_write_slow
c_func
(paren
id|ioaddr
comma
id|HACR_RESET
)paren
suffix:semicolon
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|HACR_DEFAULT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_16_off
id|wavelan_16_off
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|hacr
)paren
(brace
id|hacr
op_and_assign
op_complement
id|HACR_16BITS
suffix:semicolon
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_16_on
id|wavelan_16_on
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|hacr
)paren
(brace
id|hacr
op_or_assign
id|HACR_16BITS
suffix:semicolon
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_ints_off
id|wavelan_ints_off
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;hacr
op_and_assign
op_complement
id|HACR_INTRON
suffix:semicolon
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_ints_on
id|wavelan_ints_on
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;hacr
op_or_assign
id|HACR_INTRON
suffix:semicolon
id|hacr_write
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Read bytes from the PSA.&n; */
r_static
r_void
DECL|function|psa_read
id|psa_read
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|hacr
comma
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
id|wavelan_16_off
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|n
op_decrement
OG
l_int|0
)paren
(brace
id|outw
c_func
(paren
id|o
comma
id|PIOR2
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|o
op_increment
suffix:semicolon
op_star
id|b
op_increment
op_assign
id|inb
c_func
(paren
id|PIOP2
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
)brace
id|wavelan_16_on
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
)brace
macro_line|#if&t;defined(IRQ_SET_WORKS)
multiline_comment|/*&n; * Write bytes to the PSA.&n; */
r_static
r_void
DECL|function|psa_write
id|psa_write
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|hacr
comma
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
id|wavelan_16_off
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|n
op_decrement
OG
l_int|0
)paren
(brace
id|outw
c_func
(paren
id|o
comma
id|PIOR2
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|o
op_increment
suffix:semicolon
id|outb
c_func
(paren
op_star
id|b
comma
id|PIOP2
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|b
op_increment
suffix:semicolon
)brace
id|wavelan_16_on
c_func
(paren
id|ioaddr
comma
id|hacr
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* defined(IRQ_SET_WORKS) */
multiline_comment|/*&n; * Read bytes from the on-board RAM.&n; */
r_static
r_void
DECL|function|obram_read
id|obram_read
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
id|n
op_assign
(paren
id|n
op_plus
l_int|1
)paren
op_div
(paren
r_sizeof
(paren
r_int
r_int
)paren
op_div
r_sizeof
(paren
r_int
r_char
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|o
comma
id|PIOR1
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|insw
c_func
(paren
id|PIOP1
c_func
(paren
id|ioaddr
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|b
comma
id|n
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Write bytes to the on-board RAM.&n; */
r_static
r_void
DECL|function|obram_write
id|obram_write
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
id|n
op_assign
(paren
id|n
op_plus
l_int|1
)paren
op_div
(paren
r_sizeof
(paren
r_int
r_int
)paren
op_div
r_sizeof
(paren
r_int
r_char
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|o
comma
id|PIOR1
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|outsw
c_func
(paren
id|PIOP1
c_func
(paren
id|ioaddr
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|b
comma
id|n
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Read bytes from the MMC.&n; */
r_static
r_void
DECL|function|mmc_read
id|mmc_read
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
r_while
c_loop
(paren
id|n
op_decrement
OG
l_int|0
)paren
(brace
r_while
c_loop
(paren
id|inw
c_func
(paren
id|HASR
c_func
(paren
id|ioaddr
)paren
)paren
op_amp
id|HASR_MMC_BUSY
)paren
suffix:semicolon
id|outw
c_func
(paren
id|o
op_lshift
l_int|1
comma
id|MMCR
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|o
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|inw
c_func
(paren
id|HASR
c_func
(paren
id|ioaddr
)paren
)paren
op_amp
id|HASR_MMC_BUSY
)paren
suffix:semicolon
op_star
id|b
op_increment
op_assign
(paren
r_int
r_char
)paren
(paren
id|inw
c_func
(paren
id|MMCR
c_func
(paren
id|ioaddr
)paren
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Write bytes to the MMC.&n; */
r_static
r_void
DECL|function|mmc_write
id|mmc_write
c_func
(paren
r_int
r_int
id|ioaddr
comma
r_int
r_int
id|o
comma
r_int
r_char
op_star
id|b
comma
r_int
id|n
)paren
(brace
r_while
c_loop
(paren
id|n
op_decrement
OG
l_int|0
)paren
(brace
r_while
c_loop
(paren
id|inw
c_func
(paren
id|HASR
c_func
(paren
id|ioaddr
)paren
)paren
op_amp
id|HASR_MMC_BUSY
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
(paren
(paren
(paren
r_int
r_int
)paren
op_star
id|b
op_lshift
l_int|8
)paren
op_or
(paren
id|o
op_lshift
l_int|1
)paren
op_or
l_int|1
)paren
comma
id|MMCR
c_func
(paren
id|ioaddr
)paren
)paren
suffix:semicolon
id|b
op_increment
suffix:semicolon
id|o
op_increment
suffix:semicolon
)brace
)brace
DECL|variable|irqvals
r_static
r_int
id|irqvals
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0
comma
l_int|0x08
comma
l_int|0
comma
l_int|0
comma
l_int|0x10
comma
l_int|0x20
comma
l_int|0x40
comma
l_int|0
comma
l_int|0
comma
l_int|0x80
comma
)brace
suffix:semicolon
macro_line|#if&t;defined(IRQ_SET_WORKS)
r_static
r_int
DECL|function|wavelan_unmap_irq
id|wavelan_unmap_irq
c_func
(paren
r_int
id|irq
comma
r_int
r_char
op_star
id|irqval
)paren
(brace
r_if
c_cond
(paren
id|irq
OL
l_int|0
op_logical_or
id|irq
op_ge
id|nels
c_func
(paren
id|irqvals
)paren
op_logical_or
id|irqvals
(braket
id|irq
)braket
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
op_star
id|irqval
op_assign
(paren
r_int
r_char
)paren
id|irqvals
(braket
id|irq
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;/* defined(IRQ_SET_WORKS) */
multiline_comment|/*&n; * Map values from the irq parameter register to irq numbers.&n; */
r_static
r_int
DECL|function|wavelan_map_irq
id|wavelan_map_irq
c_func
(paren
r_int
r_char
id|irqval
)paren
(brace
r_int
id|irq
suffix:semicolon
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
id|nels
c_func
(paren
id|irqvals
)paren
suffix:semicolon
id|irq
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irqvals
(braket
id|irq
)braket
op_eq
(paren
r_int
)paren
id|irqval
)paren
r_return
id|irq
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize the Modem Management Controller.&n; */
r_static
r_void
DECL|function|wavelan_mmc_init
id|wavelan_mmc_init
c_func
(paren
id|device
op_star
id|dev
comma
id|psa_t
op_star
id|psa
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
id|mmw_t
id|m
suffix:semicolon
r_int
id|configured
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|m
comma
l_int|0x00
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;configured = psa-&gt;psa_conf_status &amp; 1;&n;&t; *&n;&t; * For now we use the persistent PSA&n;&t; * information as little as possible, thereby&n;&t; * allowing us to return to the same known state&n;&t; * during a hardware reset.&n;&t; */
id|configured
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Set default modem control parameters.&n;&t; * See NCR document 407-0024326 Rev. A.&n;&t; */
id|m.mmw_jabber_enable
op_assign
l_int|0x01
suffix:semicolon
id|m.mmw_anten_sel
op_assign
id|MMW_ANTEN_SEL_ALG_EN
suffix:semicolon
id|m.mmw_ifs
op_assign
l_int|0x20
suffix:semicolon
id|m.mmw_mod_delay
op_assign
l_int|0x04
suffix:semicolon
id|m.mmw_jam_time
op_assign
l_int|0x38
suffix:semicolon
id|m.mmw_encr_enable
op_assign
l_int|0
suffix:semicolon
id|m.mmw_des_io_invert
op_assign
l_int|0
suffix:semicolon
id|m.mmw_freeze
op_assign
l_int|0
suffix:semicolon
id|m.mmw_decay_prm
op_assign
l_int|0
suffix:semicolon
id|m.mmw_decay_updat_prm
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|configured
)paren
(brace
multiline_comment|/*&n;&t;&t; * Use configuration defaults from parameter storage area.&n;&t;&t; */
r_if
c_cond
(paren
id|psa-&gt;psa_undefined
op_amp
l_int|1
)paren
id|m.mmw_loopt_sel
op_assign
l_int|0x00
suffix:semicolon
r_else
id|m.mmw_loopt_sel
op_assign
id|MMW_LOOPT_SEL_UNDEFINED
suffix:semicolon
id|m.mmw_thr_pre_set
op_assign
id|psa-&gt;psa_thr_pre_set
op_amp
l_int|0x3F
suffix:semicolon
id|m.mmw_quality_thr
op_assign
id|psa-&gt;psa_quality_thr
op_amp
l_int|0x0F
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|lp-&gt;promiscuous
op_logical_and
id|lp-&gt;full_promiscuous
)paren
id|m.mmw_loopt_sel
op_assign
id|MMW_LOOPT_SEL_UNDEFINED
suffix:semicolon
r_else
id|m.mmw_loopt_sel
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/*&n;&t;&t; * 0x04 for AT,&n;&t;&t; * 0x01 for MCA.&n;&t;&t; */
r_if
c_cond
(paren
id|psa-&gt;psa_comp_number
op_amp
l_int|1
)paren
id|m.mmw_thr_pre_set
op_assign
l_int|0x01
suffix:semicolon
r_else
id|m.mmw_thr_pre_set
op_assign
l_int|0x04
suffix:semicolon
id|m.mmw_quality_thr
op_assign
l_int|0x03
suffix:semicolon
)brace
id|m.mmw_netw_id_l
op_assign
id|lp-&gt;nwid
(braket
l_int|1
)braket
suffix:semicolon
id|m.mmw_netw_id_h
op_assign
id|lp-&gt;nwid
(braket
l_int|0
)braket
suffix:semicolon
id|mmc_write
c_func
(paren
id|ioaddr
comma
l_int|0
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_ack
id|wavelan_ack
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|scb_cs
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
id|scb_cs
op_and_assign
id|SCB_ST_INT
suffix:semicolon
r_if
c_cond
(paren
id|scb_cs
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb_cs
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_ack(): board not accepting command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set channel attention bit and busy wait until command has&n; * completed, then acknowledge the command completion.&n; */
r_static
r_int
DECL|function|wavelan_synchronous_cmd
id|wavelan_synchronous_cmd
c_func
(paren
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|str
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|scb_cmd
suffix:semicolon
id|ach_t
id|cb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|scb_cmd
op_assign
id|SCB_CMD_CUC
op_amp
id|SCB_CMD_CUC_GO
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cmd
comma
r_sizeof
(paren
id|scb_cmd
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|64
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|OFFSET_CU
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|cb
comma
r_sizeof
(paren
id|cb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb.ac_status
op_amp
id|AC_SFLD_C
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
op_logical_or
op_logical_neg
(paren
id|cb.ac_status
op_amp
id|AC_SFLD_OK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s failed; status = 0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|str
comma
id|cb.ac_status
)paren
suffix:semicolon
id|wavelan_scb_show
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|wavelan_ack
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|wavelan_hardware_reset
id|wavelan_hardware_reset
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|psa_t
id|psa
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
id|scp_t
id|scp
suffix:semicolon
id|iscp_t
id|iscp
suffix:semicolon
id|scb_t
id|scb
suffix:semicolon
id|ach_t
id|cb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ac_cfg_t
id|cfg
suffix:semicolon
id|ac_ias_t
id|ias
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_hardware_reset(dev=0x%x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;nresets
op_increment
suffix:semicolon
id|wavelan_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|lp-&gt;hacr
op_assign
id|HACR_DEFAULT
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the onboard RAM.&n;&t; */
(brace
r_int
r_char
id|zeroes
(braket
l_int|512
)braket
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|zeroes
(braket
l_int|0
)braket
comma
l_int|0x00
comma
r_sizeof
(paren
id|zeroes
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I82586_MEMZ
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|zeroes
)paren
)paren
id|obram_write
c_func
(paren
id|ioaddr
comma
id|i
comma
op_amp
id|zeroes
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|zeroes
)paren
)paren
suffix:semicolon
)brace
id|psa_read
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
comma
l_int|0
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|psa
comma
r_sizeof
(paren
id|psa
)paren
)paren
suffix:semicolon
id|wavelan_mmc_init
c_func
(paren
id|dev
comma
op_amp
id|psa
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Construct the command unit structures:&n;&t; * scp, iscp, scb, cb.&n;&t; */
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0x00
comma
r_sizeof
(paren
id|scp
)paren
)paren
suffix:semicolon
id|scp.scp_sysbus
op_assign
id|SCP_SY_16BBUS
suffix:semicolon
id|scp.scp_iscpl
op_assign
id|OFFSET_ISCP
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_SCP
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scp
comma
r_sizeof
(paren
id|scp
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|iscp
comma
l_int|0x00
comma
r_sizeof
(paren
id|iscp
)paren
)paren
suffix:semicolon
id|iscp.iscp_busy
op_assign
l_int|1
suffix:semicolon
id|iscp.iscp_offset
op_assign
id|OFFSET_SCB
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_ISCP
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|iscp
comma
r_sizeof
(paren
id|iscp
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scb
comma
l_int|0x00
comma
r_sizeof
(paren
id|scb
)paren
)paren
suffix:semicolon
id|scb.scb_command
op_assign
id|SCB_CMD_RESET
suffix:semicolon
id|scb.scb_cbl_offset
op_assign
id|OFFSET_CU
suffix:semicolon
id|scb.scb_rfa_offset
op_assign
id|OFFSET_RU
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_SCB
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb
comma
r_sizeof
(paren
id|scb
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|OFFSET_ISCP
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|iscp
comma
r_sizeof
(paren
id|iscp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iscp.iscp_busy
op_eq
(paren
r_int
r_int
)paren
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_hardware_reset(): iscp_busy timeout.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|OFFSET_SCB
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb
comma
r_sizeof
(paren
id|scb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb.scb_status
op_eq
(paren
id|SCB_ST_CX
op_or
id|SCB_ST_CNA
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_hardware_reset(): status: expected 0x%02x, got 0x%02x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|SCB_ST_CX
op_or
id|SCB_ST_CNA
comma
id|scb.scb_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|wavelan_ack
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cb
comma
l_int|0x00
comma
r_sizeof
(paren
id|cb
)paren
)paren
suffix:semicolon
id|cb.ac_command
op_assign
id|AC_CFLD_EL
op_or
(paren
id|AC_CFLD_CMD
op_amp
id|acmd_diagnose
)paren
suffix:semicolon
id|cb.ac_link
op_assign
id|OFFSET_CU
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_CU
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|cb
comma
r_sizeof
(paren
id|cb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_synchronous_cmd
c_func
(paren
id|dev
comma
l_string|&quot;diag()&quot;
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|OFFSET_CU
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|cb
comma
r_sizeof
(paren
id|cb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb.ac_status
op_amp
id|AC_SFLD_FAIL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_hardware_reset(): i82586 Self Test failed.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|cfg
comma
l_int|0x00
comma
r_sizeof
(paren
id|cfg
)paren
)paren
suffix:semicolon
macro_line|#if&t;0
multiline_comment|/*&n;&t; * The default board configuration.&n;&t; */
id|cfg.fifolim_bytecnt
op_assign
l_int|0x080c
suffix:semicolon
id|cfg.addrlen_mode
op_assign
l_int|0x2600
suffix:semicolon
id|cfg.linprio_interframe
op_assign
l_int|0x7820
suffix:semicolon
multiline_comment|/* IFS=120, ACS=2 */
id|cfg.slot_time
op_assign
l_int|0xf00c
suffix:semicolon
multiline_comment|/* slottime=12    */
id|cfg.hardware
op_assign
l_int|0x0008
suffix:semicolon
multiline_comment|/* tx even w/o CD */
id|cfg.min_frame_len
op_assign
l_int|0x0040
suffix:semicolon
macro_line|#endif&t;/* 0 */
multiline_comment|/*&n;&t; * For Linux we invert AC_CFG_ALOC(..) so as to conform&n;&t; * to the way that net packets reach us from above.&n;&t; * (See also ac_tx_t.)&n;&t; */
id|cfg.cfg_byte_cnt
op_assign
id|AC_CFG_BYTE_CNT
c_func
(paren
r_sizeof
(paren
id|ac_cfg_t
)paren
op_minus
r_sizeof
(paren
id|ach_t
)paren
)paren
suffix:semicolon
id|cfg.cfg_fifolim
op_assign
id|AC_CFG_FIFOLIM
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|cfg.cfg_byte8
op_assign
id|AC_CFG_SAV_BF
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_SRDY
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cfg.cfg_byte9
op_assign
id|AC_CFG_ELPBCK
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_ILPBCK
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_PRELEN
c_func
(paren
id|AC_CFG_PLEN_2
)paren
op_or
id|AC_CFG_ALOC
c_func
(paren
l_int|1
)paren
op_or
id|AC_CFG_ADDRLEN
c_func
(paren
id|WAVELAN_ADDR_SIZE
)paren
suffix:semicolon
id|cfg.cfg_byte10
op_assign
id|AC_CFG_BOFMET
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_ACR
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_LINPRIO
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cfg.cfg_ifs
op_assign
l_int|32
suffix:semicolon
id|cfg.cfg_slotl
op_assign
l_int|0
suffix:semicolon
id|cfg.cfg_byte13
op_assign
id|AC_CFG_RETRYNUM
c_func
(paren
l_int|15
)paren
op_or
id|AC_CFG_SLTTMHI
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|cfg.cfg_byte14
op_assign
id|AC_CFG_FLGPAD
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_BTSTF
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_CRC16
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_NCRC
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_TNCRS
c_func
(paren
l_int|1
)paren
op_or
id|AC_CFG_MANCH
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_BCDIS
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_PRM
c_func
(paren
id|lp-&gt;promiscuous
)paren
suffix:semicolon
id|cfg.cfg_byte15
op_assign
id|AC_CFG_ICDS
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_CDTF
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_ICSS
c_func
(paren
l_int|0
)paren
op_or
id|AC_CFG_CSTF
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;cfg.cfg_min_frm_len = AC_CFG_MNFRM(64);&n;*/
id|cfg.cfg_min_frm_len
op_assign
id|AC_CFG_MNFRM
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|cfg.cfg_h.ac_command
op_assign
id|AC_CFLD_EL
op_or
(paren
id|AC_CFLD_CMD
op_amp
id|acmd_configure
)paren
suffix:semicolon
id|cfg.cfg_h.ac_link
op_assign
id|OFFSET_CU
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_CU
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_synchronous_cmd
c_func
(paren
id|dev
comma
l_string|&quot;reset()-configure&quot;
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|ias
comma
l_int|0x00
comma
r_sizeof
(paren
id|ias
)paren
)paren
suffix:semicolon
id|ias.ias_h.ac_command
op_assign
id|AC_CFLD_EL
op_or
(paren
id|AC_CFLD_CMD
op_amp
id|acmd_ia_setup
)paren
suffix:semicolon
id|ias.ias_h.ac_link
op_assign
id|OFFSET_CU
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ias.ias_addr
(braket
l_int|0
)braket
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|ias.ias_addr
)paren
)paren
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|OFFSET_CU
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|ias
comma
r_sizeof
(paren
id|ias
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_synchronous_cmd
c_func
(paren
id|dev
comma
l_string|&quot;reset()-address&quot;
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): -1&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|wavelan_ints_on
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|4
)paren
id|wavelan_scb_show
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|wavelan_ru_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_cu_start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_hardware_reset(): 0&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if&t;STRUCT_CHECK == 1
r_static
r_const
r_char
op_star
DECL|function|wavelan_struct_check
id|wavelan_struct_check
c_func
(paren
r_void
)paren
(brace
DECL|macro|SC
mdefine_line|#define&t;SC(t,s,n)&t;if (sizeof(t) != s) return n
id|SC
c_func
(paren
id|psa_t
comma
id|PSA_SIZE
comma
l_string|&quot;psa_t&quot;
)paren
suffix:semicolon
id|SC
c_func
(paren
id|mmw_t
comma
id|MMW_SIZE
comma
l_string|&quot;mmw_t&quot;
)paren
suffix:semicolon
id|SC
c_func
(paren
id|mmr_t
comma
id|MMR_SIZE
comma
l_string|&quot;mmr_t&quot;
)paren
suffix:semicolon
id|SC
c_func
(paren
id|ha_t
comma
id|HA_SIZE
comma
l_string|&quot;ha_t&quot;
)paren
suffix:semicolon
DECL|macro|SC
macro_line|#undef&t;SC
r_return
(paren
r_char
op_star
)paren
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;/* STRUCT_CHECK == 1 */
multiline_comment|/*&n; * Check for a network adaptor of this type.&n; * Return &squot;0&squot; iff one exists.&n; * (There seem to be different interpretations of&n; * the initial value of dev-&gt;base_addr.&n; * We follow the example in drivers/net/ne.c.)&n; */
r_int
DECL|function|wavelan_probe
id|wavelan_probe
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|r
suffix:semicolon
r_int
id|base_addr
suffix:semicolon
r_static
r_int
r_int
id|iobase
(braket
)braket
op_assign
(brace
macro_line|#if&t;0
id|Leave
id|out
l_int|0x3C0
r_for
c_loop
id|now
op_decrement
id|seems
id|to
id|clash
id|with
id|some
id|video
id|controllers
dot
id|Leave
id|out
id|the
id|others
id|too
op_decrement
id|we
id|will
id|always
id|use
l_int|0x390
op_logical_and
id|leave
l_int|0x300
r_for
c_loop
id|the
id|Ethernet
id|device
dot
l_int|0x300
comma
l_int|0x390
comma
l_int|0x3E0
comma
l_int|0x3C0
comma
macro_line|#endif&t;/* 0 */
l_int|0x390
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_probe(dev=0x%x (base_addr=0x%x))&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
macro_line|#if&t;STRUCT_CHECK == 1
r_if
c_cond
(paren
id|wavelan_struct_check
c_func
(paren
)paren
op_ne
(paren
r_char
op_star
)paren
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: structure/compiler botch: &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|wavelan_struct_check
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe(): ENODEV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif&t;/* STRUCT_CHECK == 1 */
id|base_addr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|base_addr
OL
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * Don&squot;t probe at all.&n;&t;&t; */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe(): ENXIO&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|base_addr
OG
l_int|0x100
)paren
(brace
multiline_comment|/*&n;&t;&t; * Check a single specified location.&n;&t;&t; */
id|r
op_assign
id|wavelan_probe1
c_func
(paren
id|dev
comma
id|base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe(): %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|r
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nels
c_func
(paren
id|iobase
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|iobase
(braket
id|i
)braket
comma
r_sizeof
(paren
id|ha_t
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_probe1
c_func
(paren
id|dev
comma
id|iobase
(braket
id|i
)braket
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe(): 0&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_WAVELAN
comma
l_int|7
comma
l_string|&quot;wavelan&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|wavelan_get_info
)brace
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe(): ENODEV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|wavelan_probe1
id|wavelan_probe1
c_func
(paren
id|device
op_star
id|dev
comma
r_int
r_int
id|ioaddr
)paren
(brace
id|psa_t
id|psa
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|i
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
id|enable_full_promiscuous
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_probe1(dev=0x%x, ioaddr=0x%x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
comma
id|ioaddr
)paren
suffix:semicolon
id|wavelan_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|psa_read
c_func
(paren
id|ioaddr
comma
id|HACR_DEFAULT
comma
l_int|0
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|psa
comma
r_sizeof
(paren
id|psa
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Check the first three octets of the MAC address&n;&t; * for the manufacturer&squot;s code.&n;&t; */
r_if
c_cond
(paren
id|psa.psa_univ_mac_addr
(braket
l_int|0
)braket
op_ne
id|SA_ADDR0
op_logical_or
id|psa.psa_univ_mac_addr
(braket
l_int|1
)braket
op_ne
id|SA_ADDR1
op_logical_or
id|psa.psa_univ_mac_addr
(braket
l_int|2
)braket
op_ne
id|SA_ADDR2
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe1(): ENODEV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: WaveLAN at %#x,&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[WARNING: explicit IRQ value %d ignored: using PSA value instead]&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
macro_line|#if&t;defined(IRQ_SET_WORKS)
id|Leave
id|this
id|out
id|until
id|I
id|can
id|get
id|it
id|to
id|work
op_decrement
id|BJ
dot
r_if
c_cond
(paren
id|wavelan_unmap_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|psa.psa_int_req_no
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; could not wavelan_unmap_irq(%d, ..) -- ignored.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|psa_write
c_func
(paren
id|ioaddr
comma
id|HACR_DEFAULT
comma
(paren
r_char
op_star
)paren
op_amp
id|psa.psa_int_req_no
op_minus
(paren
r_char
op_star
)paren
op_amp
id|psa
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|psa.psa_int_req_no
comma
r_sizeof
(paren
id|psa.psa_int_req_no
)paren
)paren
suffix:semicolon
id|wavelan_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* defined(IRQ_SET_WORKS) */
)brace
r_if
c_cond
(paren
(paren
id|irq
op_assign
id|wavelan_map_irq
c_func
(paren
id|psa.psa_int_req_no
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; could not wavelan_map_irq(%d).&bslash;n&quot;
comma
id|psa.psa_int_req_no
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe1(): EAGAIN&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|EAGAIN
suffix:semicolon
)brace
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|request_region
c_func
(paren
id|ioaddr
comma
r_sizeof
(paren
id|ha_t
)paren
comma
l_string|&quot;wavelan&quot;
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
multiline_comment|/*&n;&t; * The third numeric argument to LILO&squot;s&n;&t; * `ether=&squot; control line arrives here as `dev-&gt;mem_start&squot;.&n;&t; *&n;&t; * If bit 16 of dev-&gt;mem_start is non-zero we enable&n;&t; * full promiscuity.&n;&t; *&n;&t; * If either of the least significant two bytes of&n;&t; * dev-&gt;mem_start are non-zero we use them instead&n;&t; * of the PSA NWID.&n;&t; */
id|enable_full_promiscuous
op_assign
(paren
id|dev-&gt;mem_start
op_amp
id|ENABLE_FULL_PROMISCUOUS
)paren
op_eq
id|ENABLE_FULL_PROMISCUOUS
suffix:semicolon
id|dev-&gt;mem_start
op_and_assign
op_complement
id|ENABLE_FULL_PROMISCUOUS
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
op_ne
l_int|0
)paren
(brace
id|psa.psa_nwid
(braket
l_int|0
)braket
op_assign
(paren
id|dev-&gt;mem_start
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|psa.psa_nwid
(braket
l_int|1
)braket
op_assign
(paren
id|dev-&gt;mem_start
op_rshift
l_int|0
)paren
op_amp
l_int|0xFF
suffix:semicolon
)brace
id|dev-&gt;mem_start
op_assign
l_int|0x0000
suffix:semicolon
id|dev-&gt;mem_end
op_assign
l_int|0x0000
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
op_amp
id|psa.psa_univ_mac_addr
(braket
l_int|0
)braket
comma
id|WAVELAN_ADDR_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable_full_promiscuous
)paren
id|printk
c_func
(paren
l_string|&quot;, promisc&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, nwid 0x%02x%02x&quot;
comma
id|psa.psa_nwid
(braket
l_int|0
)braket
comma
id|psa.psa_nwid
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, PC&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|psa.psa_comp_number
)paren
(brace
r_case
id|PSA_COMP_PC_AT_915
suffix:colon
r_case
id|PSA_COMP_PC_AT_2400
suffix:colon
id|printk
c_func
(paren
l_string|&quot;-AT&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_COMP_PC_MC_915
suffix:colon
r_case
id|PSA_COMP_PC_MC_2400
suffix:colon
id|printk
c_func
(paren
l_string|&quot;-MC&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_COMP_PCMCIA_915
suffix:colon
id|printk
c_func
(paren
l_string|&quot;MCIA&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;, &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|psa.psa_subband
)paren
(brace
r_case
id|PSA_SUBBAND_915
suffix:colon
id|printk
c_func
(paren
l_string|&quot;915&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_SUBBAND_2425
suffix:colon
id|printk
c_func
(paren
l_string|&quot;2425&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_SUBBAND_2460
suffix:colon
id|printk
c_func
(paren
l_string|&quot;2460&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_SUBBAND_2484
suffix:colon
id|printk
c_func
(paren
l_string|&quot;2484&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSA_SUBBAND_2430_5
suffix:colon
id|printk
c_func
(paren
l_string|&quot;2430.5&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; MHz&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|net_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0x00
comma
r_sizeof
(paren
id|net_local
)paren
)paren
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|first_wavelan
op_eq
(paren
id|net_local
op_star
)paren
l_int|0
)paren
(brace
id|first_wavelan
op_assign
id|lp
suffix:semicolon
id|lp-&gt;prev
op_assign
id|lp
suffix:semicolon
id|lp-&gt;next
op_assign
id|lp
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;prev
op_assign
id|first_wavelan-&gt;prev
suffix:semicolon
id|lp-&gt;next
op_assign
id|first_wavelan
suffix:semicolon
id|first_wavelan-&gt;prev-&gt;next
op_assign
id|lp
suffix:semicolon
id|first_wavelan-&gt;prev
op_assign
id|lp
suffix:semicolon
)brace
id|lp-&gt;dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;hacr
op_assign
id|HACR_DEFAULT
suffix:semicolon
id|lp-&gt;full_promiscuous
op_assign
id|enable_full_promiscuous
suffix:semicolon
id|lp-&gt;nwid
(braket
l_int|0
)braket
op_assign
id|psa.psa_nwid
(braket
l_int|0
)braket
suffix:semicolon
id|lp-&gt;nwid
(braket
l_int|1
)braket
op_assign
id|psa.psa_nwid
(braket
l_int|1
)braket
suffix:semicolon
id|lp-&gt;watchdog.function
op_assign
id|wavelan_watchdog
suffix:semicolon
id|lp-&gt;watchdog.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|dev-&gt;open
op_assign
id|wavelan_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|wavelan_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|wavelan_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|wavelan_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|wavelan_set_multicast_list
suffix:semicolon
multiline_comment|/*&n;&t; * Fill in the fields of the device structure&n;&t; * with ethernet-generic values.&n;&t; */
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|WAVELAN_MTU
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_probe1(): 0&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Construct the fd and rbd structures.&n; * Start the receive unit.&n; */
r_static
r_void
DECL|function|wavelan_ru_start
id|wavelan_ru_start
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|scb_cs
suffix:semicolon
id|fd_t
id|fd
suffix:semicolon
id|rbd_t
id|rbd
suffix:semicolon
r_int
r_int
id|rx
suffix:semicolon
r_int
r_int
id|rx_next
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scb_cs
op_amp
id|SCB_ST_RUS
)paren
op_eq
id|SCB_ST_RUS_RDY
)paren
r_return
suffix:semicolon
id|lp-&gt;rx_head
op_assign
id|OFFSET_RU
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|rx
op_assign
id|lp-&gt;rx_head
suffix:semicolon
id|i
OL
id|NRXBLOCKS
suffix:semicolon
id|i
op_increment
comma
id|rx
op_assign
id|rx_next
)paren
(brace
id|rx_next
op_assign
(paren
id|i
op_eq
id|NRXBLOCKS
op_minus
l_int|1
)paren
ques
c_cond
id|lp-&gt;rx_head
suffix:colon
id|rx
op_plus
id|RXBLOCKZ
suffix:semicolon
id|fd.fd_status
op_assign
l_int|0
suffix:semicolon
id|fd.fd_command
op_assign
(paren
id|i
op_eq
id|NRXBLOCKS
op_minus
l_int|1
)paren
ques
c_cond
id|FD_COMMAND_EL
suffix:colon
l_int|0
suffix:semicolon
id|fd.fd_link_offset
op_assign
id|rx_next
suffix:semicolon
id|fd.fd_rbd_offset
op_assign
id|rx
op_plus
r_sizeof
(paren
id|fd
)paren
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|rx
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|fd
comma
r_sizeof
(paren
id|fd
)paren
)paren
suffix:semicolon
id|rbd.rbd_status
op_assign
l_int|0
suffix:semicolon
id|rbd.rbd_next_rbd_offset
op_assign
id|I82586NULL
suffix:semicolon
id|rbd.rbd_bufl
op_assign
id|rx
op_plus
r_sizeof
(paren
id|fd
)paren
op_plus
r_sizeof
(paren
id|rbd
)paren
suffix:semicolon
id|rbd.rbd_bufh
op_assign
l_int|0
suffix:semicolon
id|rbd.rbd_el_size
op_assign
id|RBD_EL
op_or
(paren
id|RBD_SIZE
op_amp
id|MAXDATAZ
)paren
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|rx
op_plus
r_sizeof
(paren
id|fd
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|rbd
comma
r_sizeof
(paren
id|rbd
)paren
)paren
suffix:semicolon
id|lp-&gt;rx_last
op_assign
id|rx
suffix:semicolon
)brace
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_rfa_offset
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|lp-&gt;rx_head
comma
r_sizeof
(paren
id|lp-&gt;rx_head
)paren
)paren
suffix:semicolon
id|scb_cs
op_assign
id|SCB_CMD_RUC_GO
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb_cs
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_ru_start(): board not accepting command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the transmit blocks.&n; * Start the command unit executing the NOP&n; * self-loop of the first transmit block.&n; */
r_static
r_void
DECL|function|wavelan_cu_start
id|wavelan_cu_start
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|txblock
suffix:semicolon
r_int
r_int
id|first_nop
suffix:semicolon
r_int
r_int
id|scb_cs
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;tx_first_free
op_assign
id|OFFSET_CU
suffix:semicolon
id|lp-&gt;tx_first_in_use
op_assign
id|I82586NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|txblock
op_assign
id|OFFSET_CU
suffix:semicolon
id|i
OL
id|NTXBLOCKS
suffix:semicolon
id|i
op_increment
comma
id|txblock
op_add_assign
id|TXBLOCKZ
)paren
(brace
id|ac_tx_t
id|tx
suffix:semicolon
id|ac_nop_t
id|nop
suffix:semicolon
id|tbd_t
id|tbd
suffix:semicolon
r_int
r_int
id|tx_addr
suffix:semicolon
r_int
r_int
id|nop_addr
suffix:semicolon
r_int
r_int
id|tbd_addr
suffix:semicolon
r_int
r_int
id|buf_addr
suffix:semicolon
id|tx_addr
op_assign
id|txblock
suffix:semicolon
id|nop_addr
op_assign
id|tx_addr
op_plus
r_sizeof
(paren
id|tx
)paren
suffix:semicolon
id|tbd_addr
op_assign
id|nop_addr
op_plus
r_sizeof
(paren
id|nop
)paren
suffix:semicolon
id|buf_addr
op_assign
id|tbd_addr
op_plus
r_sizeof
(paren
id|tbd
)paren
suffix:semicolon
id|tx.tx_h.ac_status
op_assign
l_int|0
suffix:semicolon
id|tx.tx_h.ac_command
op_assign
id|acmd_transmit
op_or
id|AC_CFLD_I
suffix:semicolon
id|tx.tx_h.ac_link
op_assign
id|nop_addr
suffix:semicolon
id|tx.tx_tbd_offset
op_assign
id|tbd_addr
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|tx_addr
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|tx
comma
r_sizeof
(paren
id|tx
)paren
)paren
suffix:semicolon
id|nop.nop_h.ac_status
op_assign
l_int|0
suffix:semicolon
id|nop.nop_h.ac_command
op_assign
id|acmd_nop
suffix:semicolon
id|nop.nop_h.ac_link
op_assign
id|nop_addr
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|nop_addr
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|nop
comma
r_sizeof
(paren
id|nop
)paren
)paren
suffix:semicolon
id|tbd.tbd_status
op_assign
id|TBD_STATUS_EOF
suffix:semicolon
id|tbd.tbd_next_bd_offset
op_assign
id|I82586NULL
suffix:semicolon
id|tbd.tbd_bufl
op_assign
id|buf_addr
suffix:semicolon
id|tbd.tbd_bufh
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|tbd_addr
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|tbd
comma
r_sizeof
(paren
id|tbd
)paren
)paren
suffix:semicolon
)brace
id|first_nop
op_assign
id|OFFSET_CU
op_plus
(paren
id|NTXBLOCKS
op_minus
l_int|1
)paren
op_star
id|TXBLOCKZ
op_plus
r_sizeof
(paren
id|ac_tx_t
)paren
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_cbl_offset
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|first_nop
comma
r_sizeof
(paren
id|first_nop
)paren
)paren
suffix:semicolon
id|scb_cs
op_assign
id|SCB_CMD_CUC_GO
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cs
comma
r_sizeof
(paren
id|scb_cs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb_cs
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: wavelan_cu_start(): board not accepting command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;tx_n_in_use
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|wavelan_open
id|wavelan_open
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_open(dev=0x%x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_open(): -ENXIO&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_ne
(paren
id|device
op_star
)paren
l_int|0
multiline_comment|/* This is always true, but avoid the false IRQ. */
op_logical_or
(paren
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
id|dev
)paren
op_eq
(paren
id|device
op_star
)paren
l_int|0
op_logical_or
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|wavelan_interrupt
comma
l_int|0
comma
l_string|&quot;WaveLAN&quot;
)paren
op_ne
l_int|0
)paren
(brace
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
(paren
id|device
op_star
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_open(): -EAGAIN&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
)brace
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
op_minus
l_int|1
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
(paren
id|device
op_star
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_open(): -EAGAIN(2)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
macro_line|#if&t;defined(MODULE)
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#endif&t;/* defined(MODULE) */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_open(): 0&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|hardware_send_packet
id|hardware_send_packet
c_func
(paren
id|device
op_star
id|dev
comma
r_void
op_star
id|buf
comma
r_int
id|length
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|txblock
suffix:semicolon
r_int
r_int
id|txpred
suffix:semicolon
r_int
r_int
id|tx_addr
suffix:semicolon
r_int
r_int
id|nop_addr
suffix:semicolon
r_int
r_int
id|tbd_addr
suffix:semicolon
r_int
r_int
id|buf_addr
suffix:semicolon
id|ac_tx_t
id|tx
suffix:semicolon
id|ac_nop_t
id|nop
suffix:semicolon
id|tbd_t
id|tbd
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
id|txblock
op_assign
id|lp-&gt;tx_first_free
suffix:semicolon
id|txpred
op_assign
id|txblock
op_minus
id|TXBLOCKZ
suffix:semicolon
r_if
c_cond
(paren
id|txpred
OL
id|OFFSET_CU
)paren
id|txpred
op_add_assign
id|NTXBLOCKS
op_star
id|TXBLOCKZ
suffix:semicolon
id|lp-&gt;tx_first_free
op_add_assign
id|TXBLOCKZ
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_first_free
op_ge
id|OFFSET_CU
op_plus
id|NTXBLOCKS
op_star
id|TXBLOCKZ
)paren
id|lp-&gt;tx_first_free
op_sub_assign
id|NTXBLOCKS
op_star
id|TXBLOCKZ
suffix:semicolon
multiline_comment|/*&n;if (lp-&gt;tx_n_in_use &gt; 0)&n;&t;printk(&quot;%c&quot;, &quot;0123456789abcdefghijk&quot;[lp-&gt;tx_n_in_use]);&n;*/
id|lp-&gt;tx_n_in_use
op_increment
suffix:semicolon
id|tx_addr
op_assign
id|txblock
suffix:semicolon
id|nop_addr
op_assign
id|tx_addr
op_plus
r_sizeof
(paren
id|tx
)paren
suffix:semicolon
id|tbd_addr
op_assign
id|nop_addr
op_plus
r_sizeof
(paren
id|nop
)paren
suffix:semicolon
id|buf_addr
op_assign
id|tbd_addr
op_plus
r_sizeof
(paren
id|tbd
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Transmit command.&n;&t; */
id|tx.tx_h.ac_status
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|toff
c_func
(paren
id|ac_tx_t
comma
id|tx_addr
comma
id|tx_h.ac_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|tx.tx_h.ac_status
comma
r_sizeof
(paren
id|tx.tx_h.ac_status
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * NOP command.&n;&t; */
id|nop.nop_h.ac_status
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|toff
c_func
(paren
id|ac_nop_t
comma
id|nop_addr
comma
id|nop_h.ac_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|nop.nop_h.ac_status
comma
r_sizeof
(paren
id|nop.nop_h.ac_status
)paren
)paren
suffix:semicolon
id|nop.nop_h.ac_link
op_assign
id|nop_addr
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|toff
c_func
(paren
id|ac_nop_t
comma
id|nop_addr
comma
id|nop_h.ac_link
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|nop.nop_h.ac_link
comma
r_sizeof
(paren
id|nop.nop_h.ac_link
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Transmit buffer descriptor. &n;&t; */
id|tbd.tbd_status
op_assign
id|TBD_STATUS_EOF
op_or
(paren
id|TBD_STATUS_ACNT
op_amp
id|length
)paren
suffix:semicolon
id|tbd.tbd_next_bd_offset
op_assign
id|I82586NULL
suffix:semicolon
id|tbd.tbd_bufl
op_assign
id|buf_addr
suffix:semicolon
id|tbd.tbd_bufh
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|tbd_addr
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|tbd
comma
r_sizeof
(paren
id|tbd
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Data.&n;&t; */
id|obram_write
c_func
(paren
id|ioaddr
comma
id|buf_addr
comma
id|buf
comma
id|length
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Overwrite the predecessor NOP link&n;&t; * so that it points to this txblock.&n;&t; */
id|nop_addr
op_assign
id|txpred
op_plus
r_sizeof
(paren
id|tx
)paren
suffix:semicolon
id|nop.nop_h.ac_status
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|toff
c_func
(paren
id|ac_nop_t
comma
id|nop_addr
comma
id|nop_h.ac_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|nop.nop_h.ac_status
comma
r_sizeof
(paren
id|nop.nop_h.ac_status
)paren
)paren
suffix:semicolon
id|nop.nop_h.ac_link
op_assign
id|txblock
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|toff
c_func
(paren
id|ac_nop_t
comma
id|nop_addr
comma
id|nop_h.ac_link
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|nop.nop_h.ac_link
comma
r_sizeof
(paren
id|nop.nop_h.ac_link
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_first_in_use
op_eq
id|I82586NULL
)paren
id|lp-&gt;tx_first_in_use
op_assign
id|txblock
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_n_in_use
OL
id|NTXBLOCKS
op_minus
l_int|1
)paren
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;watchdog.next
op_eq
(paren
id|timer_list
op_star
)paren
l_int|0
)paren
id|wavelan_watchdog
c_func
(paren
(paren
r_int
r_int
)paren
id|dev
)paren
suffix:semicolon
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|4
)paren
(brace
r_int
r_char
op_star
id|a
suffix:semicolon
id|a
op_assign
(paren
r_int
r_char
op_star
)paren
id|buf
suffix:semicolon
id|printk
(paren
l_string|&quot;%s: tx: dest %02x:%02x:%02x:%02x:%02x:%02x, length %d, tbd.tbd_bufl 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|a
(braket
l_int|0
)braket
comma
id|a
(braket
l_int|1
)braket
comma
id|a
(braket
l_int|2
)braket
comma
id|a
(braket
l_int|3
)braket
comma
id|a
(braket
l_int|4
)braket
comma
id|a
(braket
l_int|5
)braket
comma
id|length
comma
id|buf_addr
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|wavelan_send_packet
id|wavelan_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
multiline_comment|/*&n;&t;&t; * If we get here, some higher level&n;&t;&t; * has decided we are broken.&n;&t;&t; */
r_int
id|tickssofar
suffix:semicolon
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
multiline_comment|/*&n;&t;&t; * But for the moment, we will rely on wavelan_watchdog()&n;&t;&t; * instead as it allows finer control over exactly when we&n;&t;&t; * make the determination of failure.&n;&t;&t; *&n;&t;&t;if (tickssofar &lt; 5)&n;&t;&t; */
r_return
l_int|1
suffix:semicolon
id|wavelan_scb_show
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|wavelan_ru_show
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_cu_show
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_dev_show
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_local_show
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out -- resetting board.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If some higher layer thinks we&squot;ve missed&n;&t; * a tx-done interrupt we are passed NULL.&n;&t; * Caution: dev_tint() handles the cli()/sti() itself.&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
(paren
r_struct
id|sk_buff
op_star
)paren
l_int|0
)paren
(brace
id|dev_tint
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Block a timer-based transmit from overlapping.&n;&t; */
r_if
c_cond
(paren
id|set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|length
suffix:semicolon
r_int
r_char
op_star
id|buf
suffix:semicolon
id|length
op_assign
(paren
id|ETH_ZLEN
OL
id|skb-&gt;len
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
id|hardware_send_packet
c_func
(paren
id|dev
comma
id|buf
comma
id|length
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if&t;0
r_static
r_int
id|addrcmp
c_func
(paren
r_int
r_char
op_star
id|a0
comma
r_int
r_char
op_star
id|a1
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|a0
(braket
id|i
)braket
op_ne
id|a1
(braket
id|i
)braket
)paren
r_return
id|a0
(braket
id|i
)braket
op_minus
id|a1
(braket
id|i
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;/* 0 */
multiline_comment|/*&n; * Transfer as many packets as we can&n; * from the device RAM.&n; * Called by the interrupt handler.&n; */
r_static
r_void
DECL|function|wavelan_receive
id|wavelan_receive
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
id|nreaped
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|nreaped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|fd_t
id|fd
suffix:semicolon
id|rbd_t
id|rbd
suffix:semicolon
id|ushort
id|pkt_len
suffix:semicolon
r_int
id|sksize
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|lp-&gt;rx_head
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|fd
comma
r_sizeof
(paren
id|fd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_C
)paren
op_ne
id|FD_STATUS_C
)paren
r_break
suffix:semicolon
id|nreaped
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
(paren
id|FD_STATUS_B
op_or
id|FD_STATUS_OK
)paren
)paren
op_ne
(paren
id|FD_STATUS_B
op_or
id|FD_STATUS_OK
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Not sure about this one -- it does not seem&n;&t;&t;&t; * to be an error so we will keep quiet about it.&n;&t;&t;&t;if ((fd.fd_status &amp; FD_STATUS_B) != FD_STATUS_B)&n;&t;&t;&t;&t;printk(&quot;%s: frame not consumed by RU.&bslash;n&quot;, dev-&gt;name);&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_OK
)paren
op_ne
id|FD_STATUS_OK
)paren
id|printk
c_func
(paren
l_string|&quot;%s: frame not received successfully.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
(paren
id|FD_STATUS_S6
op_or
id|FD_STATUS_S7
op_or
id|FD_STATUS_S8
op_or
id|FD_STATUS_S9
op_or
id|FD_STATUS_S10
op_or
id|FD_STATUS_S11
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S6
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: no EOF flag.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S7
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: frame too short.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S8
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: rx DMA overrun.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S9
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ran out of resources.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S10
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: alignment error.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.fd_status
op_amp
id|FD_STATUS_S11
)paren
op_ne
l_int|0
)paren
(brace
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: CRC error.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fd.fd_rbd_offset
op_eq
id|I82586NULL
)paren
id|printk
c_func
(paren
l_string|&quot;%s: frame has no data.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|fd.fd_rbd_offset
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|rbd
comma
r_sizeof
(paren
id|rbd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rbd.rbd_status
op_amp
id|RBD_STATUS_EOF
)paren
op_ne
id|RBD_STATUS_EOF
)paren
id|printk
c_func
(paren
l_string|&quot;%s: missing EOF flag.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rbd.rbd_status
op_amp
id|RBD_STATUS_F
)paren
op_ne
id|RBD_STATUS_F
)paren
id|printk
c_func
(paren
l_string|&quot;%s: missing F flag.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|pkt_len
op_assign
id|rbd.rbd_status
op_amp
id|RBD_STATUS_ACNT
suffix:semicolon
macro_line|#if&t;0
(brace
r_int
r_char
id|addr
(braket
id|WAVELAN_ADDR_SIZE
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_int
r_char
id|toweraddr
(braket
id|WAVELAN_ADDR_SIZE
)braket
op_assign
(brace
l_int|0x08
comma
l_int|0x00
comma
l_int|0x0e
comma
l_int|0x20
comma
l_int|0x3e
comma
l_int|0xd3
comma
)brace
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|rbd.rbd_bufl
op_plus
r_sizeof
(paren
id|addr
)paren
comma
op_amp
id|addr
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
multiline_comment|/*&n;&t;&t;&t;&t;&t;addrcmp(&amp;addr[0], &amp;dev-&gt;dev_addr[0]) != 0&n;&t;&t;&t;&t;&t;&amp;&amp;&n;&t;&t;&t;&t;&t;*/
id|addrcmp
c_func
(paren
op_amp
id|addr
(braket
l_int|0
)braket
comma
id|toweraddr
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: foreign MAC source addr=&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* 0 */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
(brace
r_int
r_char
id|addr
(braket
id|WAVELAN_ADDR_SIZE
)braket
suffix:semicolon
r_int
r_int
id|ltype
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#if&t;0
id|printk
c_func
(paren
l_string|&quot;%s: fd_dest=&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|fd.fd_dest
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: fd_src=&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|fd.fd_src
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: fd_length=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fd.fd_length
)paren
suffix:semicolon
macro_line|#endif&t;/* 0 */
id|obram_read
c_func
(paren
id|ioaddr
comma
id|rbd.rbd_bufl
comma
op_amp
id|addr
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: dest=&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|rbd.rbd_bufl
op_plus
r_sizeof
(paren
id|addr
)paren
comma
op_amp
id|addr
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: src=&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WAVELAN_ADDR_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s%02x&quot;
comma
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;:&quot;
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|rbd.rbd_bufl
op_plus
r_sizeof
(paren
id|addr
)paren
op_star
l_int|2
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|ltype
comma
r_sizeof
(paren
id|ltype
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ntohs(length/type)=0x%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ntohs
c_func
(paren
id|ltype
)paren
)paren
suffix:semicolon
)brace
id|sksize
op_assign
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|sksize
)paren
)paren
op_eq
(paren
r_struct
id|sk_buff
op_star
)paren
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: could not alloc_skb(%d, GFP_ATOMIC).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sksize
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|rbd.rbd_bufl
comma
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|pkt_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|maxi
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: pkt_len=%d, data=&bslash;&quot;&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|maxi
op_assign
id|pkt_len
)paren
OG
l_int|16
)paren
id|maxi
op_assign
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxi
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
id|c
op_assign
id|skb-&gt;data
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot; &squot;
op_logical_and
id|c
op_le
l_char|&squot;~&squot;
)paren
id|printk
c_func
(paren
l_string|&quot; %c&quot;
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|maxi
OL
id|pkt_len
)paren
id|printk
c_func
(paren
l_string|&quot;..&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
)brace
id|fd.fd_status
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|fdoff
c_func
(paren
id|lp-&gt;rx_head
comma
id|fd_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|fd.fd_status
comma
r_sizeof
(paren
id|fd.fd_status
)paren
)paren
suffix:semicolon
id|fd.fd_command
op_assign
id|FD_COMMAND_EL
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|fdoff
c_func
(paren
id|lp-&gt;rx_head
comma
id|fd_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|fd.fd_command
comma
r_sizeof
(paren
id|fd.fd_command
)paren
)paren
suffix:semicolon
id|fd.fd_command
op_assign
l_int|0
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|fdoff
c_func
(paren
id|lp-&gt;rx_last
comma
id|fd_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|fd.fd_command
comma
r_sizeof
(paren
id|fd.fd_command
)paren
)paren
suffix:semicolon
id|lp-&gt;rx_last
op_assign
id|lp-&gt;rx_head
suffix:semicolon
id|lp-&gt;rx_head
op_assign
id|fd.fd_link_offset
suffix:semicolon
)brace
multiline_comment|/*&n;&t;if (nreaped &gt; 1)&n;&t;&t;printk(&quot;r%d&quot;, nreaped);&n;*/
)brace
multiline_comment|/*&n; * Command completion interrupt.&n; * Reclaim as many freed tx buffers as we can.&n; */
r_static
r_int
DECL|function|wavelan_complete
id|wavelan_complete
c_func
(paren
id|device
op_star
id|dev
comma
r_int
r_int
id|ioaddr
comma
id|net_local
op_star
id|lp
)paren
(brace
r_int
id|nreaped
suffix:semicolon
id|nreaped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|tx_status
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_first_in_use
op_eq
id|I82586NULL
)paren
r_break
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|acoff
c_func
(paren
id|lp-&gt;tx_first_in_use
comma
id|ac_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|tx_status
comma
r_sizeof
(paren
id|tx_status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
id|AC_SFLD_C
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|nreaped
op_increment
suffix:semicolon
op_decrement
id|lp-&gt;tx_n_in_use
suffix:semicolon
multiline_comment|/*&n;if (lp-&gt;tx_n_in_use &gt; 0)&n;&t;printk(&quot;%c&quot;, &quot;0123456789abcdefghijk&quot;[lp-&gt;tx_n_in_use]);&n;*/
r_if
c_cond
(paren
id|lp-&gt;tx_n_in_use
op_le
l_int|0
)paren
id|lp-&gt;tx_first_in_use
op_assign
id|I82586NULL
suffix:semicolon
r_else
(brace
id|lp-&gt;tx_first_in_use
op_add_assign
id|TXBLOCKZ
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_first_in_use
op_ge
id|OFFSET_CU
op_plus
id|NTXBLOCKS
op_star
id|TXBLOCKZ
)paren
id|lp-&gt;tx_first_in_use
op_sub_assign
id|NTXBLOCKS
op_star
id|TXBLOCKZ
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_OK
)paren
(brace
r_int
id|ncollisions
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ncollisions
op_assign
id|tx_status
op_amp
id|AC_SFLD_MAXCOL
suffix:semicolon
id|lp-&gt;stats.collisions
op_add_assign
id|ncollisions
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;if (ncollisions &gt; 0)&n;&t;&t;&t;&t;printk(&quot;%s: tx completed after %d collisions.&bslash;n&quot;, dev-&gt;name, ncollisions);&n;&t;&t;&t;*/
)brace
r_else
(brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_S10
)paren
(brace
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s:     tx error: no CS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_S9
)paren
(brace
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:     tx error: lost CTS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_S8
)paren
(brace
id|lp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:     tx error: slow DMA.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_S6
)paren
(brace
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s:     tx error: heart beat.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|AC_SFLD_S5
)paren
(brace
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s:     tx error: too many collisions.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s:     tx completed, tx_status 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tx_status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;if (nreaped &gt; 1)&n;&t;&t;printk(&quot;c%d&quot;, nreaped);&n;*/
multiline_comment|/*&n;&t; * Inform upper layers.&n;&t; */
r_if
c_cond
(paren
id|lp-&gt;tx_n_in_use
OL
id|NTXBLOCKS
op_minus
l_int|1
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
r_return
id|nreaped
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_watchdog
id|wavelan_watchdog
c_func
(paren
r_int
r_int
id|a
)paren
(brace
id|device
op_star
id|dev
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|ioaddr
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
r_int
r_int
id|nreaped
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
(paren
id|device
op_star
)paren
id|a
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_n_in_use
op_le
l_int|0
)paren
(brace
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lp-&gt;watchdog.expires
op_assign
id|jiffies
op_plus
id|WATCHDOG_JIFFIES
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;watchdog
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|dev-&gt;trans_start
OL
id|WATCHDOG_JIFFIES
)paren
(brace
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|nreaped
op_assign
id|wavelan_complete
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|lp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: warning: wavelan_watchdog(): %d reaped, %d remain.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|nreaped
comma
id|lp-&gt;tx_n_in_use
)paren
suffix:semicolon
multiline_comment|/*&n;&t;wavelan_scb_show(ioaddr);&n;&t;wavelan_ru_show(dev);&n;&t;wavelan_cu_show(dev);&n;&t;wavelan_dev_show(dev);&n;&t;wavelan_local_show(dev);&n;&t;*/
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_interrupt
id|wavelan_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|hasr
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
r_int
r_int
id|ack_cmd
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
(paren
id|device
op_star
)paren
(paren
id|irq2dev_map
(braket
id|irq
)braket
)paren
)paren
op_eq
(paren
id|device
op_star
)paren
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;wavelan_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hasr
op_assign
id|hasr_read
c_func
(paren
id|ioaddr
)paren
)paren
op_amp
id|HASR_MMC_INTR
)paren
(brace
r_int
r_char
id|dce_status
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Interrupt from the modem management controller.&n;&t;&t; * This will clear it -- ignored for now.&n;&t;&t; */
id|mmc_read
c_func
(paren
id|ioaddr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_dce_status
)paren
comma
op_amp
id|dce_status
comma
r_sizeof
(paren
id|dce_status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: warning: wavelan_interrupt(): unexpected mmc interrupt: status 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dce_status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|hasr
op_amp
id|HASR_82586_INTR
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: warning: wavelan_interrupt() but (hasr &amp; HASR_82586_INTR) == 0.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|obram_read
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_status
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|status
comma
r_sizeof
(paren
id|status
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Acknowledge the interrupt(s).&n;&t; */
id|ack_cmd
op_assign
id|status
op_amp
id|SCB_ST_INT
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|ack_cmd
comma
r_sizeof
(paren
id|ack_cmd
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s: interrupt, status 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SCB_ST_CX
)paren
op_eq
id|SCB_ST_CX
)paren
(brace
multiline_comment|/*&n;&t;&t; * Command completed.&n;&t;&t; */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s: command completed.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_complete
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|lp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SCB_ST_FR
)paren
op_eq
id|SCB_ST_FR
)paren
(brace
multiline_comment|/*&n;&t;&t; * Frame received.&n;&t;&t; */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s: received packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|wavelan_receive
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SCB_ST_CNA
)paren
op_eq
id|SCB_ST_CNA
op_logical_or
(paren
(paren
(paren
id|status
op_amp
id|SCB_ST_CUS
)paren
op_ne
id|SCB_ST_CUS_ACTV
)paren
op_logical_and
id|dev-&gt;start
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: warning: CU inactive -- restarting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SCB_ST_RNR
)paren
op_eq
id|SCB_ST_RNR
op_logical_or
(paren
(paren
(paren
id|status
op_amp
id|SCB_ST_RUS
)paren
op_ne
id|SCB_ST_RUS_RDY
)paren
op_logical_and
id|dev-&gt;start
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: warning: RU not ready -- restarting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|wavelan_close
id|wavelan_close
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|scb_cmd
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_close(dev=0x%x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Flush the Tx and disable Rx.&n;&t; */
id|scb_cmd
op_assign
(paren
id|SCB_CMD_CUC
op_amp
id|SCB_CMD_CUC_SUS
)paren
op_or
(paren
id|SCB_CMD_RUC
op_amp
id|SCB_CMD_RUC_SUS
)paren
suffix:semicolon
id|obram_write
c_func
(paren
id|ioaddr
comma
id|scboff
c_func
(paren
id|OFFSET_SCB
comma
id|scb_command
)paren
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb_cmd
comma
r_sizeof
(paren
id|scb_cmd
)paren
)paren
suffix:semicolon
id|set_chan_attn
c_func
(paren
id|ioaddr
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
id|wavelan_ints_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
(paren
id|device
op_star
)paren
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Release the ioport-region.&n;&t; */
id|release_region
c_func
(paren
id|ioaddr
comma
r_sizeof
(paren
id|ha_t
)paren
)paren
suffix:semicolon
macro_line|#if&t;defined(MODULE)
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif&t;/* defined(MODULE) */
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_close(): 0&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the current statistics.&n; * This may be called with the card open or closed.&n; */
r_static
id|en_stats
op_star
DECL|function|wavelan_get_stats
id|wavelan_get_stats
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_set_multicast_list
id|wavelan_set_multicast_list
c_func
(paren
id|device
op_star
id|dev
comma
r_int
id|num_addrs
comma
r_void
op_star
id|addrs
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: -&gt;wavelan_set_multicast_list(dev=0x%x, num_addrs=%d, addrs=0x%x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev
comma
id|num_addrs
comma
(paren
r_int
r_int
)paren
id|addrs
)paren
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|num_addrs
)paren
(brace
r_case
op_minus
l_int|1
suffix:colon
multiline_comment|/*&n;&t;&t; * Promiscuous mode: receive all packets.&n;&t;&t; */
id|lp-&gt;promiscuous
op_assign
l_int|1
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/*&n;&t;&t; * Normal mode: disable promiscuous mode,&n;&t;&t; * clear multicast list.&n;&t;&t; */
id|lp-&gt;promiscuous
op_assign
l_int|0
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|wavelan_hardware_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&n;&t;&t; * Multicast mode: receive normal and&n;&t;&t; * multicast packets and do best-effort filtering.&n;&t;&t; */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wavelan_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: &lt;-wavelan_set_multicast_list()&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Extra WaveLAN-specific device data.&n; * &quot;cat /proc/net/wavelan&quot; -- see fs/proc/net.c.&n; */
r_static
r_int
DECL|function|sprintf_stats
id|sprintf_stats
c_func
(paren
r_char
op_star
id|buffer
comma
id|device
op_star
id|dev
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_char
id|v
suffix:semicolon
id|mmr_t
id|m
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_eq
(paren
id|net_local
op_star
)paren
l_int|0
)paren
r_return
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%6s: No statistics available.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|v
op_assign
(paren
r_int
r_char
)paren
l_int|1
suffix:semicolon
id|mmc_write
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmwoff
c_func
(paren
l_int|0
comma
id|mmw_freeze
)paren
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_dce_status
)paren
comma
op_amp
id|m.mmr_dce_status
comma
r_sizeof
(paren
id|m.mmr_dce_status
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_correct_nwid_h
)paren
comma
op_amp
id|m.mmr_correct_nwid_h
comma
r_sizeof
(paren
id|m.mmr_correct_nwid_h
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_correct_nwid_l
)paren
comma
op_amp
id|m.mmr_correct_nwid_l
comma
r_sizeof
(paren
id|m.mmr_correct_nwid_l
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_wrong_nwid_h
)paren
comma
op_amp
id|m.mmr_wrong_nwid_h
comma
r_sizeof
(paren
id|m.mmr_wrong_nwid_h
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_wrong_nwid_l
)paren
comma
op_amp
id|m.mmr_wrong_nwid_l
comma
r_sizeof
(paren
id|m.mmr_wrong_nwid_l
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_signal_lvl
)paren
comma
op_amp
id|m.mmr_signal_lvl
comma
r_sizeof
(paren
id|m.mmr_signal_lvl
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_silence_lvl
)paren
comma
op_amp
id|m.mmr_silence_lvl
comma
r_sizeof
(paren
id|m.mmr_silence_lvl
)paren
)paren
suffix:semicolon
id|mmc_read
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmroff
c_func
(paren
l_int|0
comma
id|mmr_sgnl_qual
)paren
comma
op_amp
id|m.mmr_sgnl_qual
comma
r_sizeof
(paren
id|m.mmr_sgnl_qual
)paren
)paren
suffix:semicolon
id|v
op_assign
(paren
r_int
r_char
)paren
l_int|0
suffix:semicolon
id|mmc_write
c_func
(paren
id|dev-&gt;base_addr
comma
id|mmwoff
c_func
(paren
l_int|0
comma
id|mmw_freeze
)paren
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
id|lp-&gt;correct_nwid
op_add_assign
(paren
id|m.mmr_correct_nwid_h
op_lshift
l_int|8
)paren
op_or
id|m.mmr_correct_nwid_l
suffix:semicolon
id|lp-&gt;wrong_nwid
op_add_assign
(paren
id|m.mmr_wrong_nwid_h
op_lshift
l_int|8
)paren
op_or
id|m.mmr_wrong_nwid_l
suffix:semicolon
r_return
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%6s:   %02x %08x %08x   %02x   %02x   %02x   %02x    %u&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|m.mmr_dce_status
comma
id|lp-&gt;correct_nwid
comma
id|lp-&gt;wrong_nwid
comma
id|m.mmr_signal_lvl
comma
id|m.mmr_silence_lvl
comma
id|m.mmr_sgnl_qual
comma
id|lp-&gt;tx_n_in_use
comma
id|lp-&gt;nresets
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|wavelan_get_info
id|wavelan_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
suffix:semicolon
id|off_t
id|begin
suffix:semicolon
id|off_t
id|pos
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
r_int
id|x
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
l_int|0
suffix:semicolon
id|pos
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&quot;
comma
l_string|&quot;Iface |  dce    +nwid    -nwid  lvl slnc qual ntxq nrst&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|x
op_assign
id|wavelan_splhi
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|first_wavelan
op_ne
(paren
id|net_local
op_star
)paren
l_int|0
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
id|lp
op_assign
id|first_wavelan
suffix:semicolon
r_do
(brace
id|size
op_assign
id|sprintf_stats
c_func
(paren
id|buffer
op_plus
id|len
comma
id|lp-&gt;dev
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|lp
op_assign
id|lp-&gt;next
)paren
op_ne
id|first_wavelan
)paren
suffix:semicolon
)brace
id|wavelan_splx
c_func
(paren
id|x
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start slop */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
multiline_comment|/* Ending slop */
r_return
id|len
suffix:semicolon
)brace
macro_line|#if&t;defined(MODULE)
DECL|variable|kernel_version
r_char
id|kernel_version
(braket
)braket
op_assign
id|UTS_RELEASE
suffix:semicolon
DECL|variable|devicename
r_static
r_char
id|devicename
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dev_wavelan
r_static
r_struct
id|device
id|dev_wavelan
op_assign
(brace
id|devicename
comma
multiline_comment|/* device name is inserted by linux/drivers/net/net_init.c */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|wavelan_probe
)brace
suffix:semicolon
DECL|variable|io
r_int
id|io
op_assign
l_int|0x390
suffix:semicolon
multiline_comment|/* Default from above.. */
DECL|variable|irq
r_int
id|irq
op_assign
l_int|0
suffix:semicolon
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
id|dev_wavelan.base_addr
op_assign
id|io
suffix:semicolon
id|dev_wavelan.irq
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_wavelan
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|MOD_IN_USE
)paren
id|printk
c_func
(paren
l_string|&quot;wavelan: device busy, remove delayed&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|proc_net_unregister
c_func
(paren
id|PROC_NET_WAVELAN
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
op_amp
id|dev_wavelan
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|dev_wavelan.priv
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev_wavelan.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* defined(MODULE) */
r_static
r_void
DECL|function|wavelan_cu_show_one
id|wavelan_cu_show_one
c_func
(paren
id|device
op_star
id|dev
comma
id|net_local
op_star
id|lp
comma
r_int
id|i
comma
r_int
r_int
id|p
)paren
(brace
r_int
r_int
id|ioaddr
suffix:semicolon
id|ac_tx_t
id|actx
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%d: 0x%x:&quot;
comma
id|i
comma
id|p
)paren
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|p
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|actx
comma
r_sizeof
(paren
id|actx
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; status=0x%x,&quot;
comma
id|actx.tx_h.ac_status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; command=0x%x,&quot;
comma
id|actx.tx_h.ac_command
)paren
suffix:semicolon
multiline_comment|/*&n;&t;{&n;&t;&t;tbd_t&t;tbd;&n;&n;&t;&t;obram_read(ioaddr, actx.tx_tbd_offset, (unsigned char *)&amp;tbd, sizeof(tbd));&n;&t;&t;printk(&quot; tbd_status=0x%x,&quot;, tbd.tbd_status);&n;&t;}&n;*/
id|printk
c_func
(paren
l_string|&quot;|&quot;
)paren
suffix:semicolon
)brace
macro_line|#if&t;0
r_static
r_void
id|wavelan_psa_show
c_func
(paren
id|psa_t
op_star
id|p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;psa:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_io_base_addr_1: 0x%02x,&quot;
comma
id|p-&gt;psa_io_base_addr_1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_io_base_addr_2: 0x%02x,&quot;
comma
id|p-&gt;psa_io_base_addr_2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_io_base_addr_3: 0x%02x,&quot;
comma
id|p-&gt;psa_io_base_addr_3
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_io_base_addr_4: 0x%02x,&quot;
comma
id|p-&gt;psa_io_base_addr_4
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_rem_boot_addr_1: 0x%02x,&quot;
comma
id|p-&gt;psa_rem_boot_addr_1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_rem_boot_addr_2: 0x%02x,&quot;
comma
id|p-&gt;psa_rem_boot_addr_2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_rem_boot_addr_3: 0x%02x,&quot;
comma
id|p-&gt;psa_rem_boot_addr_3
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_holi_params: 0x%02x,&quot;
comma
id|p-&gt;psa_holi_params
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_int_req_no: %d,&quot;
comma
id|p-&gt;psa_int_req_no
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;psa_univ_mac_addr[]: %02x:%02x:%02x:%02x:%02x:%02x,&quot;
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|0
)braket
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|1
)braket
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|2
)braket
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|3
)braket
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|4
)braket
comma
id|p-&gt;psa_univ_mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;psa_local_mac_addr[]: %02x:%02x:%02x:%02x:%02x:%02x,&quot;
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|0
)braket
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|1
)braket
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|2
)braket
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|3
)braket
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|4
)braket
comma
id|p-&gt;psa_local_mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_univ_local_sel: %d,&quot;
comma
id|p-&gt;psa_univ_local_sel
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_comp_number: %d,&quot;
comma
id|p-&gt;psa_comp_number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_thr_pre_set: 0x%02x,&quot;
comma
id|p-&gt;psa_thr_pre_set
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_feature_select/decay_prm: 0x%02x,&quot;
comma
id|p-&gt;psa_feature_select
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_subband/decay_update_prm: %d,&quot;
comma
id|p-&gt;psa_subband
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_quality_thr: 0x%02x,&quot;
comma
id|p-&gt;psa_quality_thr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_mod_delay: 0x%02x,&quot;
comma
id|p-&gt;psa_mod_delay
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_nwid: 0x%02x%02x,&quot;
comma
id|p-&gt;psa_nwid
(braket
l_int|0
)braket
comma
id|p-&gt;psa_nwid
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_undefined: %d,&quot;
comma
id|p-&gt;psa_undefined
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_encryption_select: %d,&quot;
comma
id|p-&gt;psa_encryption_select
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;psa_encryption_key[]: %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x,&quot;
comma
id|p-&gt;psa_encryption_key
(braket
l_int|0
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|1
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|2
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|3
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|4
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|5
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|6
)braket
comma
id|p-&gt;psa_encryption_key
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_databus_width: %d,&quot;
comma
id|p-&gt;psa_databus_width
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_call_code/auto_squelch: 0x%02x,&quot;
comma
id|p-&gt;psa_call_code
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_no_of_retries: %d,&quot;
comma
id|p-&gt;psa_no_of_retries
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_acr: %d,&quot;
comma
id|p-&gt;psa_acr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_dump_count: %d,&quot;
comma
id|p-&gt;psa_dump_count
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_nwid_prefix: 0x%02x,&quot;
comma
id|p-&gt;psa_nwid_prefix
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_conf_status: %d,&quot;
comma
id|p-&gt;psa_conf_status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_crc: 0x%02x%02x,&quot;
comma
id|p-&gt;psa_crc
(braket
l_int|0
)braket
comma
id|p-&gt;psa_crc
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psa_crc_status: 0x%02x,&quot;
comma
id|p-&gt;psa_crc_status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|wavelan_mmc_show
c_func
(paren
r_int
r_int
id|ioaddr
)paren
(brace
id|mmr_t
id|m
suffix:semicolon
id|mmc_read
c_func
(paren
id|ioaddr
comma
l_int|0
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mmr:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; des_status: 0x%x&quot;
comma
id|m.mmr_des_status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; des_avail: 0x%x&quot;
comma
id|m.mmr_des_avail
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; des_io_invert: 0x%x&quot;
comma
id|m.mmr_des_io_invert
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; dce_status: 0x%x[%s%s%s%s]&quot;
comma
id|m.mmr_dce_status
op_amp
l_int|0x0F
comma
(paren
id|m.mmr_dce_status
op_amp
id|MMR_DCE_STATUS_ENERG_DET
)paren
ques
c_cond
l_string|&quot;energy detected,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|m.mmr_dce_status
op_amp
id|MMR_DCE_STATUS_LOOPT_IND
)paren
ques
c_cond
l_string|&quot;loop test indicated,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|m.mmr_dce_status
op_amp
id|MMR_DCE_STATUS_XMTITR_IND
)paren
ques
c_cond
l_string|&quot;transmitter on,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|m.mmr_dce_status
op_amp
id|MMR_DCE_STATUS_JBR_EXPIRED
)paren
ques
c_cond
l_string|&quot;jabber timer expired,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; correct_nwid: %d&quot;
comma
id|m.mmr_correct_nwid_h
op_lshift
l_int|8
op_or
id|m.mmr_correct_nwid_l
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; wrong_nwid: %d&quot;
comma
(paren
id|m.mmr_wrong_nwid_h
op_lshift
l_int|8
)paren
op_or
id|m.mmr_wrong_nwid_l
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; thr_pre_set: 0x%x&quot;
comma
id|m.mmr_thr_pre_set
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; signal_lvl: %d&quot;
comma
id|m.mmr_signal_lvl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; silence_lvl: %d&quot;
comma
id|m.mmr_silence_lvl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; sgnl_qual: 0x%x&quot;
comma
id|m.mmr_sgnl_qual
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; netw_id_l: %x&quot;
comma
id|m.mmr_netw_id_l
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* 0 */
r_static
r_void
DECL|function|wavelan_scb_show
id|wavelan_scb_show
c_func
(paren
r_int
r_int
id|ioaddr
)paren
(brace
id|scb_t
id|scb
suffix:semicolon
id|obram_read
c_func
(paren
id|ioaddr
comma
id|OFFSET_SCB
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|scb
comma
r_sizeof
(paren
id|scb
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scb:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; status:&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; stat 0x%x[%s%s%s%s]&quot;
comma
(paren
id|scb.scb_status
op_amp
(paren
id|SCB_ST_CX
op_or
id|SCB_ST_FR
op_or
id|SCB_ST_CNA
op_or
id|SCB_ST_RNR
)paren
)paren
op_rshift
l_int|12
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CX
)paren
ques
c_cond
l_string|&quot;cmd completion interrupt,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_FR
)paren
ques
c_cond
l_string|&quot;frame received,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CNA
)paren
ques
c_cond
l_string|&quot;cmd unit not active,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RNR
)paren
ques
c_cond
l_string|&quot;rcv unit not ready,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; cus 0x%x[%s%s%s]&quot;
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CUS
)paren
op_rshift
l_int|8
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CUS
)paren
op_eq
id|SCB_ST_CUS_IDLE
)paren
ques
c_cond
l_string|&quot;idle&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CUS
)paren
op_eq
id|SCB_ST_CUS_SUSP
)paren
ques
c_cond
l_string|&quot;suspended&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_CUS
)paren
op_eq
id|SCB_ST_CUS_ACTV
)paren
ques
c_cond
l_string|&quot;active&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; rus 0x%x[%s%s%s%s]&quot;
comma
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RUS
)paren
op_rshift
l_int|4
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RUS
)paren
op_eq
id|SCB_ST_RUS_IDLE
)paren
ques
c_cond
l_string|&quot;idle&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RUS
)paren
op_eq
id|SCB_ST_RUS_SUSP
)paren
ques
c_cond
l_string|&quot;suspended&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RUS
)paren
op_eq
id|SCB_ST_RUS_NRES
)paren
ques
c_cond
l_string|&quot;no resources&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_status
op_amp
id|SCB_ST_RUS
)paren
op_eq
id|SCB_ST_RUS_RDY
)paren
ques
c_cond
l_string|&quot;ready&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; command:&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; ack 0x%x[%s%s%s%s]&quot;
comma
(paren
id|scb.scb_command
op_amp
(paren
id|SCB_CMD_ACK_CX
op_or
id|SCB_CMD_ACK_FR
op_or
id|SCB_CMD_ACK_CNA
op_or
id|SCB_CMD_ACK_RNR
)paren
)paren
op_rshift
l_int|12
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_ACK_CX
)paren
ques
c_cond
l_string|&quot;ack cmd completion,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_ACK_FR
)paren
ques
c_cond
l_string|&quot;ack frame received,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_ACK_CNA
)paren
ques
c_cond
l_string|&quot;ack CU not active,&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_ACK_RNR
)paren
ques
c_cond
l_string|&quot;ack RU not ready,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; cuc 0x%x[%s%s%s%s%s]&quot;
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_rshift
l_int|8
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_eq
id|SCB_CMD_CUC_NOP
)paren
ques
c_cond
l_string|&quot;nop&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_eq
id|SCB_CMD_CUC_GO
)paren
ques
c_cond
l_string|&quot;start cbl_offset&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_eq
id|SCB_CMD_CUC_RES
)paren
ques
c_cond
l_string|&quot;resume execution&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_eq
id|SCB_CMD_CUC_SUS
)paren
ques
c_cond
l_string|&quot;suspend execution&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_CUC
)paren
op_eq
id|SCB_CMD_CUC_ABT
)paren
ques
c_cond
l_string|&quot;abort execution&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; ruc 0x%x[%s%s%s%s%s]&quot;
comma
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_rshift
l_int|4
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_eq
id|SCB_CMD_RUC_NOP
)paren
ques
c_cond
l_string|&quot;nop&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_eq
id|SCB_CMD_RUC_GO
)paren
ques
c_cond
l_string|&quot;start rfa_offset&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_eq
id|SCB_CMD_RUC_RES
)paren
ques
c_cond
l_string|&quot;resume reception&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_eq
id|SCB_CMD_RUC_SUS
)paren
ques
c_cond
l_string|&quot;suspend reception&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
(paren
id|scb.scb_command
op_amp
id|SCB_CMD_RUC
)paren
op_eq
id|SCB_CMD_RUC_ABT
)paren
ques
c_cond
l_string|&quot;abort reception&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; cbl_offset 0x%x&quot;
comma
id|scb.scb_cbl_offset
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; rfa_offset 0x%x&quot;
comma
id|scb.scb_rfa_offset
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; crcerrs %d&quot;
comma
id|scb.scb_crcerrs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; alnerrs %d&quot;
comma
id|scb.scb_alnerrs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; rscerrs %d&quot;
comma
id|scb.scb_rscerrs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; ovrnerrs %d&quot;
comma
id|scb.scb_ovrnerrs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_ru_show
id|wavelan_ru_show
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ru:&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Not implemented yet...&n;&t; */
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_cu_show
id|wavelan_cu_show
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;cu:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|p
op_assign
id|lp-&gt;tx_first_in_use
suffix:semicolon
id|i
OL
id|NTXBLOCKS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wavelan_cu_show_one
c_func
(paren
id|dev
comma
id|lp
comma
id|i
comma
id|p
)paren
suffix:semicolon
id|p
op_add_assign
id|TXBLOCKZ
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|OFFSET_CU
op_plus
id|NTXBLOCKS
op_star
id|TXBLOCKZ
)paren
id|p
op_sub_assign
id|NTXBLOCKS
op_star
id|TXBLOCKZ
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|wavelan_dev_show
id|wavelan_dev_show
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dev:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; start=%d,&quot;
comma
id|dev-&gt;start
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; tbusy=%ld,&quot;
comma
id|dev-&gt;tbusy
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; interrupt=%d,&quot;
comma
id|dev-&gt;interrupt
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; trans_start=%ld,&quot;
comma
id|dev-&gt;trans_start
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; flags=0x%x,&quot;
comma
id|dev-&gt;flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|wavelan_local_show
id|wavelan_local_show
c_func
(paren
id|device
op_star
id|dev
)paren
(brace
id|net_local
op_star
id|lp
suffix:semicolon
id|lp
op_assign
(paren
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;local:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; tx_n_in_use=%d,&quot;
comma
id|lp-&gt;tx_n_in_use
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; hacr=0x%x,&quot;
comma
id|lp-&gt;hacr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; rx_head=0x%x,&quot;
comma
id|lp-&gt;rx_head
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; rx_last=0x%x,&quot;
comma
id|lp-&gt;rx_last
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; tx_first_free=0x%x,&quot;
comma
id|lp-&gt;tx_first_free
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; tx_first_in_use=0x%x,&quot;
comma
id|lp-&gt;tx_first_in_use
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This software may only be used and distributed&n; * according to the terms of the GNU Public License.&n; *&n; * This software was developed as a component of the&n; * Linux operating system.&n; * It is based on other device drivers and information&n; * either written or supplied by:&n; *&t;Ajay Bakre (bakre@paul.rutgers.edu),&n; *&t;Donald Becker (becker@cesdis.gsfc.nasa.gov),&n; *&t;Loeke Brederveld (Loeke.Brederveld@Utrecht.NCR.com),&n; *&t;Anders Klemets (klemets@it.kth.se),&n; *&t;Vladimir V. Kolpakov (w@stier.koenig.ru),&n; *&t;Marc Meertens (Marc.Meertens@Utrecht.NCR.com),&n; *&t;Pauline Middelink (middelin@polyware.iaf.nl),&n; *&t;Robert Morris (rtm@das.harvard.edu),&n; *&t;Girish Welling (welling@paul.rutgers.edu),&n; *&n; * Thanks go also to:&n; *&t;James Ashton (jaa101@syseng.anu.edu.au),&n; *&t;Alan Cox (iialan@iiit.swan.ac.uk),&n; *&t;Allan Creighton (allanc@cs.usyd.edu.au),&n; *&t;Matthew Geier (matthew@cs.usyd.edu.au),&n; *&t;Remo di Giovanni (remo@cs.usyd.edu.au),&n; *&t;Eckhard Grah (grah@wrcs1.urz.uni-wuppertal.de),&n; *&t;Vipul Gupta (vgupta@cs.binghamton.edu),&n; *&t;Mark Hagan (mhagan@wtcpost.daytonoh.NCR.COM),&n; *&t;Tim Nicholson (tim@cs.usyd.edu.au),&n; *&t;Ian Parkin (ian@cs.usyd.edu.au),&n; *&t;John Rosenberg (johnr@cs.usyd.edu.au),&n; *&t;George Rossi (george@phm.gov.au),&n; *&t;Arthur Scott (arthur@cs.usyd.edu.au),&n; *&t;Peter Storey,&n; * for their assistance and advice.&n; *&n; * Please send bug reports, updates, comments to:&n; *&n; * Bruce Janson                                    Email:  bruce@cs.usyd.edu.au&n; * Basser Department of Computer Science           Phone:  +61-2-351-3423&n; * University of Sydney, N.S.W., 2006, AUSTRALIA   Fax:    +61-2-351-3838&n; */
eof
