multiline_comment|/* starfire.c: Linux device driver for the Adaptec Starfire network adapter. */
multiline_comment|/*&n;&t;Written 1998-2000 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;Support and updates available at&n;&t;http://www.scyld.com/network/starfire.html&n;&n;&t;-----------------------------------------------------------&n;&n;&t;Linux kernel-specific changes:&n;&t;&n;&t;LK1.1.1 (jgarzik):&n;&t;- Use PCI driver interface&n;&t;- Fix MOD_xxx races&n;&t;- softnet fixups&n;&n;&t;LK1.1.2 (jgarzik):&n;&t;- Merge Becker version 0.15&n;&n;&t;LK1.1.3 (Andrew Morton)&n;&t;- Timer cleanups&n;&t;&n;&t;LK1.1.4 (jgarzik):&n;&t;- Merge Becker version 1.03&n;*/
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|version1
r_static
r_const
r_char
id|version1
(braket
)braket
op_assign
l_string|&quot;starfire.c:v1.03 7/26/2000  Written by Donald Becker &lt;becker@scyld.com&gt;&bslash;n&quot;
suffix:semicolon
DECL|variable|version2
r_static
r_const
r_char
id|version2
(braket
)braket
op_assign
l_string|&quot; Updates and info at http://www.scyld.com/network/starfire.html&bslash;n&quot;
suffix:semicolon
DECL|variable|version3
r_static
r_const
r_char
id|version3
(braket
)braket
op_assign
l_string|&quot; (unofficial 2.4.x kernel port, version 1.1.4, August 10, 2000)&bslash;n&quot;
suffix:semicolon
multiline_comment|/* The user-configurable values.&n;   These may be modified when a driver module is loaded.*/
multiline_comment|/* Used for tuning interrupt latency vs. overhead. */
DECL|variable|interrupt_mitigation
r_static
r_int
id|interrupt_mitigation
op_assign
l_int|0x0
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 1 normal messages, 0 quiet .. 7 verbose. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
DECL|variable|mtu
r_static
r_int
id|mtu
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. rx-all-multicast).&n;   The Starfire has a 512 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-frames scheme.&n;   Setting to &gt; 1518 effectively disables this feature. */
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Used to pass the media type, etc.&n;   Both &squot;options[]&squot; and &squot;full_duplex[]&squot; exist for driver interoperability.&n;   The media type is usually passed in &squot;options[]&squot;.&n;*/
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8&t;&t;/* More are supported, limit only on options */
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Operational parameters that are set at compile time. */
multiline_comment|/* The &quot;native&quot; ring sizes are either 256 or 2048.&n;   However in some modes a descriptor may be marked to wrap the ring earlier.&n;   The driver allocates a single page for each descriptor ring, constraining&n;   the maximum size in an architecture-dependent way.&n;*/
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;256
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;32
multiline_comment|/* The completion queues are fixed at 1024 entries i.e. 4K or 8KB. */
DECL|macro|DONE_Q_SIZE
mdefine_line|#define DONE_Q_SIZE&t;1024
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (2*HZ)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
macro_line|#if !defined(__OPTIMIZE__)
macro_line|#warning  You must compile this file with the correct options!
macro_line|#warning  See the last lines of the source file.
macro_line|#error You must compile this driver with &quot;-O&quot;.
macro_line|#endif
multiline_comment|/* Include files, designed to support most kernel versions 2.0.0 and later. */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; 0x20300  &amp;&amp;  defined(MODVERSIONS)
macro_line|#include &lt;linux/modversions.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/processor.h&gt;&t;&t;/* Processor type for cache alignment. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Donald Becker &lt;becker@scyld.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Adaptec Starfire Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mtu
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This driver is for the Adaptec 6915 &quot;Starfire&quot; 64 bit PCI Ethernet adapter.&n;&n;II. Board-specific settings&n;&n;III. Driver operation&n;&n;IIIa. Ring buffers&n;&n;The Starfire hardware uses multiple fixed-size descriptor queues/rings.  The&n;ring sizes are set fixed by the hardware, but may optionally be wrapped&n;earlier by the END bit in the descriptor.&n;This driver uses that hardware queue size for the Rx ring, where a large&n;number of entries has no ill effect beyond increases the potential backlog.&n;The Tx ring is wrapped with the END bit, since a large hardware Tx queue&n;disables the queue layer priority ordering and we have no mechanism to&n;utilize the hardware two-level priority queue.  When modifying the&n;RX/TX_RING_SIZE pay close attention to page sizes and the ring-empty warning&n;levels.&n;&n;IIIb/c. Transmit/Receive Structure&n;&n;See the Adaptec manual for the many possible structures, and options for&n;each structure.  There are far too many to document here.&n;&n;For transmit this driver uses type 1 transmit descriptors, and relies on&n;automatic minimum-length padding.  It does not use the completion queue&n;consumer index, but instead checks for non-zero status entries.&n;&n;For receive this driver uses type 0 receive descriptors.  The driver&n;allocates full frame size skbuffs for the Rx ring buffers, so all frames&n;should fit in a single descriptor.  The driver does not use the completion&n;queue consumer index, but instead checks for non-zero status entries.&n;&n;When an incoming frame is less than RX_COPYBREAK bytes long, a fresh skbuff&n;is allocated and the frame is copied to the new skbuff.  When the incoming&n;frame is larger, the skbuff is passed directly up the protocol stack.&n;Buffers consumed this way are replaced by newly allocated skbuffs in a later&n;phase of receive.&n;&n;A notable aspect of operation is that unaligned buffers are not permitted by&n;the Starfire hardware.  The IP header at offset 14 in an ethernet frame thus&n;isn&squot;t longword aligned, which may cause problems on some machine&n;e.g. Alphas.  Copied frames are put into the skbuff at an offset of &quot;+2&quot;,&n;16-byte aligning the IP header.&n;&n;IIId. Synchronization&n;&n;The driver runs as two independent, single-threaded flows of control.  One&n;is the send-packet routine, which enforces single-threaded use by the&n;dev-&gt;tbusy flag.  The other thread is the interrupt handler, which is single&n;threaded by the hardware and interrupt handling software.&n;&n;The send packet thread has partial control over the Tx ring and &squot;dev-&gt;tbusy&squot;&n;flag.  It sets the tbusy flag whenever it&squot;s queuing a Tx packet. If the next&n;queue slot is empty, it clears the tbusy flag when finished otherwise it sets&n;the &squot;lp-&gt;tx_full&squot; flag.&n;&n;The interrupt handler has exclusive control over the Rx ring and records stats&n;from the Tx ring.  After reaping the stats, it marks the Tx queue entry as&n;empty by incrementing the dirty_tx mark. Iff the &squot;lp-&gt;tx_full&squot; flag is set, it&n;clears both the tx_full and tbusy flags.&n;&n;IV. Notes&n;&n;IVb. References&n;&n;The Adaptec Starfire manuals, available only from Adaptec.&n;http://www.scyld.com/expert/100mbps.html&n;http://www.scyld.com/expert/NWay.html&n;&n;IVc. Errata&n;&n;*/
"&f;"
DECL|enum|chip_capability_flags
DECL|enumerator|CanHaveMII
r_enum
id|chip_capability_flags
(brace
id|CanHaveMII
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|macro|PCI_IOTYPE
mdefine_line|#define PCI_IOTYPE (PCI_USES_MASTER | PCI_USES_MEM | PCI_ADDR0)
DECL|macro|MEM_ADDR_SZ
mdefine_line|#define MEM_ADDR_SZ 0x80000&t;&t;/* And maps in 0.5MB(!).  */
macro_line|#if 0
mdefine_line|#define ADDR_64BITS 1&t;&t;&t;/* This chip uses 64 bit addresses. */
macro_line|#endif
DECL|macro|HAS_IP_COPYSUM
mdefine_line|#define HAS_IP_COPYSUM 1
DECL|enum|chipset
r_enum
id|chipset
(brace
DECL|enumerator|CH_6915
id|CH_6915
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|starfire_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x9004
comma
l_int|0x6915
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_6915
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|starfire_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* A chip capabilities table, matching the CH_xxx entries in xxx_pci_tbl[] above. */
DECL|struct|chip_info
r_static
r_struct
id|chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|netdrv_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;Adaptec Starfire 6915&quot;
comma
id|MEM_ADDR_SZ
comma
id|CanHaveMII
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* Offsets to the device registers.&n;   Unlike software-only systems, device drivers interact with complex hardware.&n;   It&squot;s not useful to define symbolic names for every register bit in the&n;   device.  The name can only partially document the semantics and make&n;   the driver longer and more difficult to read.&n;   In general, only the important configuration values or bits changed&n;   multiple times should be defined symbolically.&n;*/
DECL|enum|register_offsets
r_enum
id|register_offsets
(brace
DECL|enumerator|PCIDeviceConfig
DECL|enumerator|GenCtrl
DECL|enumerator|IntrTimerCtrl
id|PCIDeviceConfig
op_assign
l_int|0x50040
comma
id|GenCtrl
op_assign
l_int|0x50070
comma
id|IntrTimerCtrl
op_assign
l_int|0x50074
comma
DECL|enumerator|IntrClear
DECL|enumerator|IntrStatus
DECL|enumerator|IntrEnable
id|IntrClear
op_assign
l_int|0x50080
comma
id|IntrStatus
op_assign
l_int|0x50084
comma
id|IntrEnable
op_assign
l_int|0x50088
comma
DECL|enumerator|MIICtrl
DECL|enumerator|StationAddr
DECL|enumerator|EEPROMCtrl
id|MIICtrl
op_assign
l_int|0x52000
comma
id|StationAddr
op_assign
l_int|0x50120
comma
id|EEPROMCtrl
op_assign
l_int|0x51000
comma
DECL|enumerator|TxDescCtrl
id|TxDescCtrl
op_assign
l_int|0x50090
comma
DECL|enumerator|TxRingPtr
DECL|enumerator|HiPriTxRingPtr
id|TxRingPtr
op_assign
l_int|0x50098
comma
id|HiPriTxRingPtr
op_assign
l_int|0x50094
comma
multiline_comment|/* Low and High priority. */
DECL|enumerator|TxRingHiAddr
id|TxRingHiAddr
op_assign
l_int|0x5009C
comma
multiline_comment|/* 64 bit address extension. */
DECL|enumerator|TxProducerIdx
DECL|enumerator|TxConsumerIdx
id|TxProducerIdx
op_assign
l_int|0x500A0
comma
id|TxConsumerIdx
op_assign
l_int|0x500A4
comma
DECL|enumerator|TxThreshold
id|TxThreshold
op_assign
l_int|0x500B0
comma
DECL|enumerator|CompletionHiAddr
DECL|enumerator|TxCompletionAddr
id|CompletionHiAddr
op_assign
l_int|0x500B4
comma
id|TxCompletionAddr
op_assign
l_int|0x500B8
comma
DECL|enumerator|RxCompletionAddr
DECL|enumerator|RxCompletionQ2Addr
id|RxCompletionAddr
op_assign
l_int|0x500BC
comma
id|RxCompletionQ2Addr
op_assign
l_int|0x500C0
comma
DECL|enumerator|CompletionQConsumerIdx
id|CompletionQConsumerIdx
op_assign
l_int|0x500C4
comma
DECL|enumerator|RxDescQCtrl
DECL|enumerator|RxDescQHiAddr
DECL|enumerator|RxDescQAddr
id|RxDescQCtrl
op_assign
l_int|0x500D4
comma
id|RxDescQHiAddr
op_assign
l_int|0x500DC
comma
id|RxDescQAddr
op_assign
l_int|0x500E0
comma
DECL|enumerator|RxDescQIdx
DECL|enumerator|RxDMAStatus
DECL|enumerator|RxFilterMode
id|RxDescQIdx
op_assign
l_int|0x500E8
comma
id|RxDMAStatus
op_assign
l_int|0x500F0
comma
id|RxFilterMode
op_assign
l_int|0x500F4
comma
DECL|enumerator|TxMode
id|TxMode
op_assign
l_int|0x55000
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in the interrupt status/mask registers. */
DECL|enum|intr_status_bits
r_enum
id|intr_status_bits
(brace
DECL|enumerator|IntrNormalSummary
DECL|enumerator|IntrAbnormalSummary
id|IntrNormalSummary
op_assign
l_int|0x8000
comma
id|IntrAbnormalSummary
op_assign
l_int|0x02000000
comma
DECL|enumerator|IntrRxDone
DECL|enumerator|IntrRxEmpty
DECL|enumerator|IntrRxPCIErr
id|IntrRxDone
op_assign
l_int|0x0300
comma
id|IntrRxEmpty
op_assign
l_int|0x10040
comma
id|IntrRxPCIErr
op_assign
l_int|0x80000
comma
DECL|enumerator|IntrTxDone
DECL|enumerator|IntrTxEmpty
DECL|enumerator|IntrTxPCIErr
id|IntrTxDone
op_assign
l_int|0x4000
comma
id|IntrTxEmpty
op_assign
l_int|0x1000
comma
id|IntrTxPCIErr
op_assign
l_int|0x80000
comma
DECL|enumerator|StatsMax
DECL|enumerator|LinkChange
id|StatsMax
op_assign
l_int|0x08000000
comma
id|LinkChange
op_assign
l_int|0xf0000000
comma
DECL|enumerator|IntrTxDataLow
id|IntrTxDataLow
op_assign
l_int|0x00040000
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in the RxFilterMode register. */
DECL|enum|rx_mode_bits
r_enum
id|rx_mode_bits
(brace
DECL|enumerator|AcceptBroadcast
DECL|enumerator|AcceptAllMulticast
DECL|enumerator|AcceptAll
id|AcceptBroadcast
op_assign
l_int|0x04
comma
id|AcceptAllMulticast
op_assign
l_int|0x02
comma
id|AcceptAll
op_assign
l_int|0x01
comma
DECL|enumerator|AcceptMulticast
DECL|enumerator|AcceptMyPhys
id|AcceptMulticast
op_assign
l_int|0x10
comma
id|AcceptMyPhys
op_assign
l_int|0xE040
comma
)brace
suffix:semicolon
multiline_comment|/* The Rx and Tx buffer descriptors. */
DECL|struct|starfire_rx_desc
r_struct
id|starfire_rx_desc
(brace
DECL|member|rxaddr
id|u32
id|rxaddr
suffix:semicolon
multiline_comment|/* Optionally 64 bits. */
)brace
suffix:semicolon
DECL|enum|rx_desc_bits
r_enum
id|rx_desc_bits
(brace
DECL|enumerator|RxDescValid
DECL|enumerator|RxDescEndRing
id|RxDescValid
op_assign
l_int|1
comma
id|RxDescEndRing
op_assign
l_int|2
comma
)brace
suffix:semicolon
multiline_comment|/* Completion queue entry.&n;   You must update the page allocation, init_ring and the shift count in rx()&n;   if using a larger format. */
DECL|struct|rx_done_desc
r_struct
id|rx_done_desc
(brace
DECL|member|status
id|u32
id|status
suffix:semicolon
multiline_comment|/* Low 16 bits is length. */
macro_line|#ifdef full_rx_status
DECL|member|status2
id|u32
id|status2
suffix:semicolon
DECL|member|vlanid
id|u16
id|vlanid
suffix:semicolon
DECL|member|csum
id|u16
id|csum
suffix:semicolon
multiline_comment|/* partial checksum */
DECL|member|timestamp
id|u32
id|timestamp
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|enum|rx_done_bits
r_enum
id|rx_done_bits
(brace
DECL|enumerator|RxOK
DECL|enumerator|RxFIFOErr
DECL|enumerator|RxBufQ2
id|RxOK
op_assign
l_int|0x20000000
comma
id|RxFIFOErr
op_assign
l_int|0x10000000
comma
id|RxBufQ2
op_assign
l_int|0x08000000
comma
)brace
suffix:semicolon
multiline_comment|/* Type 1 Tx descriptor. */
DECL|struct|starfire_tx_desc
r_struct
id|starfire_tx_desc
(brace
DECL|member|status
id|u32
id|status
suffix:semicolon
multiline_comment|/* Upper bits are status, lower 16 length. */
DECL|member|addr
id|u32
id|addr
suffix:semicolon
)brace
suffix:semicolon
DECL|enum|tx_desc_bits
r_enum
id|tx_desc_bits
(brace
DECL|enumerator|TxDescID
id|TxDescID
op_assign
l_int|0xB1010000
comma
multiline_comment|/* Also marks single fragment, add CRC.  */
DECL|enumerator|TxDescIntr
DECL|enumerator|TxRingWrap
id|TxDescIntr
op_assign
l_int|0x08000000
comma
id|TxRingWrap
op_assign
l_int|0x04000000
comma
)brace
suffix:semicolon
DECL|struct|tx_done_report
r_struct
id|tx_done_report
(brace
DECL|member|status
id|u32
id|status
suffix:semicolon
multiline_comment|/* timestamp, index. */
macro_line|#if 0
id|u32
id|intrstatus
suffix:semicolon
multiline_comment|/* interrupt status */
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|PRIV_ALIGN
mdefine_line|#define PRIV_ALIGN&t;15 &t;/* Required alignment mask */
DECL|struct|ring_info
r_struct
id|ring_info
(brace
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|mapping
id|dma_addr_t
id|mapping
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|netdev_private
r_struct
id|netdev_private
(brace
multiline_comment|/* Descriptor rings first for alignment. */
DECL|member|rx_ring
r_struct
id|starfire_rx_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring
r_struct
id|starfire_tx_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|rx_ring_dma
id|dma_addr_t
id|rx_ring_dma
suffix:semicolon
DECL|member|tx_ring_dma
id|dma_addr_t
id|tx_ring_dma
suffix:semicolon
multiline_comment|/* The addresses of rx/tx-in-place skbuffs. */
DECL|member|rx_info
r_struct
id|ring_info
id|rx_info
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_info
r_struct
id|ring_info
id|tx_info
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* Pointers to completion queues (full pages).  I should cache line pad..*/
DECL|member|pad0
id|u8
id|pad0
(braket
l_int|100
)braket
suffix:semicolon
DECL|member|rx_done_q
r_struct
id|rx_done_desc
op_star
id|rx_done_q
suffix:semicolon
DECL|member|rx_done_q_dma
id|dma_addr_t
id|rx_done_q_dma
suffix:semicolon
DECL|member|rx_done
r_int
r_int
id|rx_done
suffix:semicolon
DECL|member|tx_done_q
r_struct
id|tx_done_report
op_star
id|tx_done_q
suffix:semicolon
DECL|member|tx_done
r_int
r_int
id|tx_done
suffix:semicolon
DECL|member|tx_done_q_dma
id|dma_addr_t
id|tx_done_q_dma
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Media monitoring timer. */
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
multiline_comment|/* Frequently used values: keep some adjacent for cache effect. */
DECL|member|cur_rx
DECL|member|dirty_rx
r_int
r_int
id|cur_rx
comma
id|dirty_rx
suffix:semicolon
multiline_comment|/* Producer/consumer ring indices */
DECL|member|cur_tx
DECL|member|dirty_tx
r_int
r_int
id|cur_tx
comma
id|dirty_tx
suffix:semicolon
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
multiline_comment|/* Based on MTU+slack. */
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* The Tx queue is full. */
multiline_comment|/* These values are keep track of the transceiver/media in use. */
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
comma
multiline_comment|/* Full-duplex operation requested. */
DECL|member|medialock
id|medialock
suffix:colon
l_int|1
comma
multiline_comment|/* Xcvr set to fixed speed/duplex. */
DECL|member|rx_flowctrl
id|rx_flowctrl
suffix:colon
l_int|1
comma
DECL|member|tx_flowctrl
id|tx_flowctrl
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Use 802.3x flow control. */
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
DECL|member|tx_mode
id|u32
id|tx_mode
suffix:semicolon
DECL|member|tx_threshold
id|u8
id|tx_threshold
suffix:semicolon
multiline_comment|/* MII transceiver section. */
DECL|member|mii_cnt
r_int
id|mii_cnt
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|advertising
id|u16
id|advertising
suffix:semicolon
multiline_comment|/* NWay media advertisement */
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
)brace
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|startup
)paren
suffix:semicolon
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|netdev_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|intr_status
)paren
suffix:semicolon
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|netdev_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|intr_status
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
"&f;"
DECL|function|starfire_init_one
r_static
r_int
id|__devinit
id|starfire_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|i
comma
id|irq
comma
id|option
comma
id|chip_idx
op_assign
id|ent-&gt;driver_data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_static
r_int
id|card_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_int
id|printed_version
op_assign
l_int|0
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|drv_flags
comma
id|io_size
op_assign
id|netdrv_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
suffix:semicolon
id|card_idx
op_increment
suffix:semicolon
id|option
op_assign
id|card_idx
OL
id|MAX_UNITS
ques
c_cond
id|options
(braket
id|card_idx
)braket
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version1
comma
id|version2
comma
id|version3
)paren
suffix:semicolon
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
op_logical_or
(paren
(paren
id|pci_resource_flags
(paren
id|pdev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_MEM
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;starfire %d: no PCI MEM resources, aborting&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|np
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;starfire %d: cannot alloc etherdev, aborting&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|request_mem_region
(paren
id|ioaddr
comma
id|io_size
comma
id|dev-&gt;name
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;starfire %d: resource 0x%x @ 0x%lx busy, aborting&bslash;n&quot;
comma
id|card_idx
comma
id|io_size
comma
id|ioaddr
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
(paren
id|pdev
)paren
)paren
r_goto
id|err_out_free_res
suffix:semicolon
id|ioaddr
op_assign
(paren
r_int
)paren
id|ioremap
(paren
id|ioaddr
comma
id|io_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;starfire %d: cannot remap 0x%x @ 0x%lx, aborting&bslash;n&quot;
comma
id|card_idx
comma
id|io_size
comma
id|ioaddr
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|pci_set_master
(paren
id|pdev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
comma
id|dev-&gt;name
comma
id|netdrv_tbl
(braket
id|chip_idx
)braket
dot
id|name
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Serial EEPROM reads are hidden by the hardware. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
id|ioaddr
op_plus
id|EEPROMCtrl
op_plus
l_int|20
op_minus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|irq
)paren
suffix:semicolon
macro_line|#if ! defined(final_version) /* Dump the EEPROM contents during development. */
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x20
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x%s&quot;
comma
(paren
r_int
r_int
)paren
id|readb
c_func
(paren
id|ioaddr
op_plus
id|EEPROMCtrl
op_plus
id|i
)paren
comma
id|i
op_mod
l_int|16
op_ne
l_int|15
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Reset the chip to erase previous misconfiguration. */
id|writel
c_func
(paren
l_int|1
comma
id|ioaddr
op_plus
id|PCIDeviceConfig
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pdev-&gt;driver_data
op_assign
id|dev
suffix:semicolon
id|np-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|drv_flags
op_assign
id|netdrv_tbl
(braket
id|chip_idx
)braket
dot
id|drv_flags
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
id|option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|option
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|option
op_amp
l_int|0x200
)paren
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|np-&gt;default_port
op_assign
id|option
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;default_port
)paren
id|np-&gt;medialock
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card_idx
template_param
l_int|0
)paren
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
id|np-&gt;medialock
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* The chip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|netdev_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|start_tx
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
op_amp
id|tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|netdev_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
r_if
c_cond
(paren
id|mtu
)paren
id|dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
r_if
c_cond
(paren
id|drv_flags
op_amp
id|CanHaveMII
)paren
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|0
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
l_int|4
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|np-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|np-&gt;advertising
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII PHY found at address %d, status &quot;
l_string|&quot;0x%4.4x advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_status
comma
id|np-&gt;advertising
)paren
suffix:semicolon
)brace
)brace
id|np-&gt;mii_cnt
op_assign
id|phy_idx
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_out_free_res
suffix:colon
id|release_mem_region
(paren
id|ioaddr
comma
id|io_size
)paren
suffix:semicolon
id|err_out_free_netdev
suffix:colon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|kfree
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
"&f;"
multiline_comment|/* Read the MII Management Data I/O (MDIO) interfaces. */
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|MIICtrl
op_plus
(paren
id|phy_id
op_lshift
l_int|7
)paren
op_plus
(paren
id|location
op_lshift
l_int|2
)paren
suffix:semicolon
r_int
id|result
comma
id|boguscnt
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* ??? Should we add a busy-wait here? */
r_do
id|result
op_assign
id|readl
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|result
op_amp
l_int|0xC0000000
)paren
op_ne
l_int|0x80000000
op_logical_and
op_decrement
id|boguscnt
op_ge
l_int|0
)paren
suffix:semicolon
r_return
id|result
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|MIICtrl
op_plus
(paren
id|phy_id
op_lshift
l_int|7
)paren
op_plus
(paren
id|location
op_lshift
l_int|2
)paren
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* The busy-wait will occur before a read. */
r_return
suffix:semicolon
)brace
"&f;"
DECL|function|netdev_open
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
multiline_comment|/* Do we ever need to reset the chip??? */
id|MOD_INC_USE_COUNT
suffix:semicolon
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|intr_handler
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Disable the Rx and Tx, and reset the chip. */
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|GenCtrl
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|1
comma
id|ioaddr
op_plus
id|PCIDeviceConfig
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: netdev_open() irq %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Allocate the various queues, failing gracefully. */
r_if
c_cond
(paren
id|np-&gt;tx_done_q
op_eq
l_int|0
)paren
id|np-&gt;tx_done_q
op_assign
id|pci_alloc_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
op_amp
id|np-&gt;tx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_done_q
op_eq
l_int|0
)paren
id|np-&gt;rx_done_q
op_assign
id|pci_alloc_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
op_amp
id|np-&gt;rx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_ring
op_eq
l_int|0
)paren
id|np-&gt;tx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
op_amp
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_ring
op_eq
l_int|0
)paren
id|np-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
op_amp
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_done_q
op_eq
l_int|0
op_logical_or
id|np-&gt;rx_done_q
op_eq
l_int|0
op_logical_or
id|np-&gt;rx_ring
op_eq
l_int|0
op_logical_or
id|np-&gt;tx_ring
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|np-&gt;tx_done_q
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;tx_done_q
comma
id|np-&gt;tx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_done_q
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;rx_done_q
comma
id|np-&gt;rx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_ring
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_ring
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Set the size of the Rx buffers. */
id|writel
c_func
(paren
(paren
id|np-&gt;rx_buf_sz
op_lshift
l_int|16
)paren
op_or
l_int|0xA000
comma
id|ioaddr
op_plus
id|RxDescQCtrl
)paren
suffix:semicolon
multiline_comment|/* Set Tx descriptor to type 1 and padding to 0 bytes. */
id|writel
c_func
(paren
l_int|0x02000401
comma
id|ioaddr
op_plus
id|TxDescCtrl
)paren
suffix:semicolon
macro_line|#if defined(ADDR_64BITS) &amp;&amp; defined(__alpha__)
multiline_comment|/* XXX We really need a 64-bit PCI dma interfaces too... -DaveM */
id|writel
c_func
(paren
id|np-&gt;rx_ring_dma
op_rshift
l_int|32
comma
id|ioaddr
op_plus
id|RxDescQHiAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_ring_dma
op_rshift
l_int|32
comma
id|ioaddr
op_plus
id|TxRingHiAddr
)paren
suffix:semicolon
macro_line|#else
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|RxDescQHiAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|TxRingHiAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CompletionHiAddr
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|np-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|RxDescQAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|TxRingPtr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_done_q_dma
comma
id|ioaddr
op_plus
id|TxCompletionAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;rx_done_q_dma
comma
id|ioaddr
op_plus
id|RxCompletionAddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Filling in the station address.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Fill both the unused Tx SA register and the Rx perfect filter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|writeb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|StationAddr
op_plus
l_int|5
op_minus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u16
op_star
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
r_int
id|setup_frm
op_assign
id|ioaddr
op_plus
l_int|0x56000
op_plus
id|i
op_star
l_int|16
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
comma
id|setup_frm
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
comma
id|setup_frm
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
comma
id|setup_frm
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|8
suffix:semicolon
)brace
multiline_comment|/* Initialize other registers. */
multiline_comment|/* Configure the PCI bus bursts and FIFO thresholds. */
id|np-&gt;tx_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialized when TxMode set. */
id|np-&gt;tx_threshold
op_assign
l_int|4
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_threshold
comma
id|ioaddr
op_plus
id|TxThreshold
)paren
suffix:semicolon
id|writel
c_func
(paren
id|interrupt_mitigation
comma
id|ioaddr
op_plus
id|IntrTimerCtrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|np-&gt;default_port
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Setting the Rx and Tx modes.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;advertising
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
id|check_duplex
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Set the interrupt mask and enable PCI interrupts. */
id|writel
c_func
(paren
id|IntrRxDone
op_or
id|IntrRxEmpty
op_or
id|IntrRxPCIErr
op_or
id|IntrTxDone
op_or
id|IntrTxEmpty
op_or
id|IntrTxPCIErr
op_or
id|StatsMax
op_or
id|LinkChange
op_or
id|IntrNormalSummary
op_or
id|IntrAbnormalSummary
op_or
l_int|0x0010
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00800000
op_or
id|readl
c_func
(paren
id|ioaddr
op_plus
id|PCIDeviceConfig
)paren
comma
id|ioaddr
op_plus
id|PCIDeviceConfig
)paren
suffix:semicolon
multiline_comment|/* Enable the Rx and Tx units. */
id|writel
c_func
(paren
l_int|0x000F
comma
id|ioaddr
op_plus
id|GenCtrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done netdev_open().&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Set the timer to check for link beat. */
id|init_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|3
op_star
id|HZ
suffix:semicolon
id|np-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;timer.function
op_assign
op_amp
id|netdev_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_duplex
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|startup
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|new_tx_mode
suffix:semicolon
id|new_tx_mode
op_assign
l_int|0x0C04
op_or
(paren
id|np-&gt;tx_flowctrl
ques
c_cond
l_int|0x0800
suffix:colon
l_int|0
)paren
op_or
(paren
id|np-&gt;rx_flowctrl
ques
c_cond
l_int|0x0400
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;medialock
)paren
(brace
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
id|new_tx_mode
op_or_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_int
id|mii_reg5
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:semicolon
r_int
id|negotiated
op_assign
id|mii_reg5
op_amp
id|np-&gt;advertising
suffix:semicolon
r_int
id|duplex
op_assign
(paren
id|negotiated
op_amp
l_int|0x0100
)paren
op_logical_or
(paren
id|negotiated
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
suffix:semicolon
r_if
c_cond
(paren
id|duplex
)paren
id|new_tx_mode
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
op_ne
id|duplex
)paren
(brace
id|np-&gt;full_duplex
op_assign
id|duplex
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII #%d&quot;
l_string|&quot; negotiated capability %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|negotiated
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|new_tx_mode
op_ne
id|np-&gt;tx_mode
)paren
(brace
id|np-&gt;tx_mode
op_assign
id|new_tx_mode
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_mode
op_or
l_int|0x8000
comma
id|ioaddr
op_plus
id|TxMode
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_mode
comma
id|ioaddr
op_plus
id|TxMode
)paren
suffix:semicolon
)brace
)brace
DECL|function|netdev_timer
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Check before driver release. */
r_if
c_cond
(paren
id|debug
OG
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection timer tick, status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
)brace
id|check_duplex
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if ! defined(final_version)
multiline_comment|/* This is often falsely triggered. */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
op_amp
l_int|1
)paren
(brace
r_int
id|new_status
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
suffix:semicolon
multiline_comment|/* Bogus hardware IRQ: Fake an interrupt handler call. */
r_if
c_cond
(paren
id|new_status
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Interrupt blocked, status %8.8x/%8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|new_status
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
id|intr_handler
c_func
(paren
id|dev-&gt;irq
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|next_tick
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|tx_timeout
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timed out, status %8.8x,&quot;
l_string|&quot; resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
macro_line|#ifndef __alpha__
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %p: &quot;
comma
id|np-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxaddr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %p: &quot;
comma
id|np-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %4.4x&quot;
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Perhaps we should reinitialize the hardware here. */
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Stop and restart the chip&squot;s Tx processes . */
multiline_comment|/* Trigger an immediate transmit demand. */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|init_ring
r_static
r_void
id|init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|np-&gt;cur_rx
op_assign
id|np-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|np-&gt;dirty_rx
op_assign
id|np-&gt;rx_done
op_assign
id|np-&gt;dirty_tx
op_assign
id|np-&gt;tx_done
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PKT_BUF_SZ
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Fill in the Rx buffers.  Handle allocation failure gracefully. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
multiline_comment|/* Grrr, we cannot offset to correctly align the IP header. */
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxaddr
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|mapping
op_or
id|RxDescValid
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
id|i
op_minus
l_int|1
comma
id|dev-&gt;base_addr
op_plus
id|RxDescQIdx
)paren
suffix:semicolon
id|np-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* Clear the remainder of the Rx buffer ring. */
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxaddr
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|np-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|rxaddr
op_or_assign
id|cpu_to_le32
c_func
(paren
id|RxDescEndRing
)paren
suffix:semicolon
multiline_comment|/* Clear the completion rings. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DONE_Q_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_done_q
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_done_q
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
multiline_comment|/* Caution: the write order is important here, set the field&n;&t;   with the &quot;ownership&quot; bits last. */
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|np-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|addr
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|mapping
)paren
suffix:semicolon
multiline_comment|/* Add  &quot;| TxDescIntr&quot; to generate Tx-done interrupts. */
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
id|TxDescID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx #%d slot %d  %8.8x %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_tx
comma
id|entry
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
)paren
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|addr
)paren
)paren
suffix:semicolon
)brace
id|np-&gt;cur_tx
op_increment
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|entry
op_ge
id|TX_RING_SIZE
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Wrap ring */
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_or_assign
id|cpu_to_le32
c_func
(paren
id|TxRingWrap
op_or
id|TxDescIntr
)paren
suffix:semicolon
id|entry
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Non-x86: explicitly flush descriptor cache lines here. */
multiline_comment|/* Update the producer index. */
id|writel
c_func
(paren
op_increment
id|entry
comma
id|dev-&gt;base_addr
op_plus
id|TxProducerIdx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_tx
op_minus
id|np-&gt;dirty_tx
op_ge
id|TX_RING_SIZE
op_minus
l_int|1
)paren
(brace
id|np-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit frame #%d queued in slot %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_tx
comma
id|entry
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|intr_handler
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|rgs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
macro_line|#ifndef final_version&t;&t;&t;/* Can never occur. */
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;Netdev interrupt handler(): IRQ %d for unknown &quot;
l_string|&quot;device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_do
(brace
id|u32
id|intr_status
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrClear
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Interrupt status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrRxDone
)paren
id|netdev_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Scavenge the skbuff list based on the Tx-done queue.&n;&t;&t;   There are redundant checks here that may be cleaned up&n;&t;&t;   after the driver has proven to be reliable. */
(brace
r_int
id|consumer
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TxConsumerIdx
)paren
suffix:semicolon
r_int
id|tx_status
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx Consumer index is %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|consumer
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|np-&gt;tx_done
op_ge
l_int|250
op_logical_or
id|np-&gt;tx_done
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx completion entry %d is %8.8x, &quot;
l_string|&quot;%d is %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;tx_done
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_done_q
(braket
id|np-&gt;tx_done
)braket
dot
id|status
)paren
comma
(paren
id|np-&gt;tx_done
op_plus
l_int|1
)paren
op_amp
(paren
id|DONE_Q_SIZE
op_minus
l_int|1
)paren
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_done_q
(braket
(paren
id|np-&gt;tx_done
op_plus
l_int|1
)paren
op_amp
(paren
id|DONE_Q_SIZE
op_minus
l_int|1
)paren
)braket
dot
id|status
)paren
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
(paren
id|tx_status
op_assign
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_done_q
(braket
id|np-&gt;tx_done
)braket
dot
id|status
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx completion entry %d is %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;tx_done
comma
id|tx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
l_int|0xe0000000
)paren
op_eq
l_int|0xa0000000
)paren
(brace
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
l_int|0xe0000000
)paren
op_eq
l_int|0x80000000
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u16
id|entry
op_assign
id|tx_status
suffix:semicolon
multiline_comment|/* Implicit truncate */
id|entry
op_rshift_assign
l_int|3
suffix:semicolon
id|skb
op_assign
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|skb
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* Scavenge the descriptor. */
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;tx_info
(braket
id|entry
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|np-&gt;dirty_tx
op_increment
suffix:semicolon
)brace
id|np-&gt;tx_done_q
(braket
id|np-&gt;tx_done
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_done
op_assign
(paren
id|np-&gt;tx_done
op_plus
l_int|1
)paren
op_amp
(paren
id|DONE_Q_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
id|np-&gt;tx_done
comma
id|ioaddr
op_plus
id|CompletionQConsumerIdx
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;tx_full
op_logical_and
id|np-&gt;cur_tx
op_minus
id|np-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_minus
l_int|4
)paren
(brace
multiline_comment|/* The ring is no longer full, wake the queue. */
id|np-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Abnormal error summary/uncommon events handlers. */
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrAbnormalSummary
)paren
id|netdev_error
c_func
(paren
id|dev
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;status=0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
macro_line|#ifndef final_version
multiline_comment|/* Code that should never be run!  Remove after testing.. */
(brace
r_static
r_int
id|stopit
op_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
op_logical_and
op_decrement
id|stopit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Emergency stop, looping startup interrupt.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
multiline_comment|/* This routine is logically part of the interrupt handler, but separated&n;   for clarity and better register allocation. */
DECL|function|netdev_rx
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
id|np-&gt;dirty_rx
op_plus
id|RX_RING_SIZE
op_minus
id|np-&gt;cur_rx
suffix:semicolon
id|u32
id|desc_status
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_done_q
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s:  rx_done_q is NULL!  rx_done is %d. %p.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;rx_done
comma
id|np-&gt;tx_done_q
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* If EOP is set on the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
(paren
id|desc_status
op_assign
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_done_q
(braket
id|np-&gt;rx_done
)braket
dot
id|status
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() status of %d was %8.8x.&bslash;n&quot;
comma
id|np-&gt;rx_done
comma
id|desc_status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|desc_status
op_amp
id|RxOK
)paren
)paren
(brace
multiline_comment|/* There was a error. */
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() Rx error was %8.8x.&bslash;n&quot;
comma
id|desc_status
)paren
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|desc_status
op_amp
id|RxFIFOErr
)paren
id|np-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u16
id|pkt_len
op_assign
id|desc_status
suffix:semicolon
multiline_comment|/* Implicitly Truncate */
r_int
id|entry
op_assign
(paren
id|desc_status
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
suffix:semicolon
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() normal Rx pkt length %d&quot;
l_string|&quot;, bogus_cnt %d.&bslash;n&quot;
comma
id|pkt_len
comma
id|boguscnt
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Check if the packet is long enough to accept without copying&n;&t;&t;&t;   to a minimally-sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
id|pci_dma_sync_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|mapping
comma
id|pkt_len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
macro_line|#if HAS_IP_COPYSUM&t;&t;&t;/* Call copy + cksum if available. */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb-&gt;tail
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb-&gt;tail
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_char
op_star
id|temp
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|mapping
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb
op_assign
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb
suffix:semicolon
id|temp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
macro_line|#ifndef final_version&t;&t;&t;&t;/* Remove after testing. */
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxaddr
op_amp
op_complement
l_int|3
)paren
op_ne
(paren
(paren
r_int
r_int
)paren
id|temp
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Internal fault: The skbuff addresses &quot;
l_string|&quot;do not match in netdev_rx: %d vs. %p / %p.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxaddr
)paren
comma
id|skb-&gt;head
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifndef final_version&t;&t;&t;&t;/* Remove after testing. */
multiline_comment|/* You will want this info for the initial debug. */
r_if
c_cond
(paren
id|debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx data %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:&quot;
l_string|&quot;%2.2x %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x %2.2x%2.2x &quot;
l_string|&quot;%d.%d.%d.%d.&bslash;n&quot;
comma
id|skb-&gt;data
(braket
l_int|0
)braket
comma
id|skb-&gt;data
(braket
l_int|1
)braket
comma
id|skb-&gt;data
(braket
l_int|2
)braket
comma
id|skb-&gt;data
(braket
l_int|3
)braket
comma
id|skb-&gt;data
(braket
l_int|4
)braket
comma
id|skb-&gt;data
(braket
l_int|5
)braket
comma
id|skb-&gt;data
(braket
l_int|6
)braket
comma
id|skb-&gt;data
(braket
l_int|7
)braket
comma
id|skb-&gt;data
(braket
l_int|8
)braket
comma
id|skb-&gt;data
(braket
l_int|9
)braket
comma
id|skb-&gt;data
(braket
l_int|10
)braket
comma
id|skb-&gt;data
(braket
l_int|11
)braket
comma
id|skb-&gt;data
(braket
l_int|12
)braket
comma
id|skb-&gt;data
(braket
l_int|13
)braket
comma
id|skb-&gt;data
(braket
l_int|14
)braket
comma
id|skb-&gt;data
(braket
l_int|15
)braket
comma
id|skb-&gt;data
(braket
l_int|16
)braket
comma
id|skb-&gt;data
(braket
l_int|17
)braket
)paren
suffix:semicolon
macro_line|#endif
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#ifdef full_rx_status
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_done_q
(braket
id|np-&gt;rx_done
)braket
dot
id|status2
)paren
op_amp
l_int|0x01000000
)paren
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
macro_line|#endif
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
id|np-&gt;cur_rx
op_increment
suffix:semicolon
id|np-&gt;rx_done_q
(braket
id|np-&gt;rx_done
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_done
op_assign
(paren
id|np-&gt;rx_done
op_plus
l_int|1
)paren
op_amp
(paren
id|DONE_Q_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
id|np-&gt;rx_done
comma
id|dev-&gt;base_addr
op_plus
id|CompletionQConsumerIdx
)paren
suffix:semicolon
multiline_comment|/* Refill the Rx ring buffers. */
r_for
c_loop
(paren
suffix:semicolon
id|np-&gt;cur_rx
op_minus
id|np-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|np-&gt;dirty_rx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|entry
op_assign
id|np-&gt;dirty_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
multiline_comment|/* Better luck next round. */
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxaddr
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_info
(braket
id|entry
)braket
dot
id|mapping
op_or
id|RxDescValid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
id|RX_RING_SIZE
op_minus
l_int|1
)paren
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxaddr
op_or_assign
id|cpu_to_le32
c_func
(paren
id|RxDescEndRing
)paren
suffix:semicolon
multiline_comment|/* We could defer this until later... */
id|writew
c_func
(paren
id|entry
comma
id|dev-&gt;base_addr
op_plus
id|RxDescQIdx
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debug
OG
l_int|5
op_logical_or
id|memcmp
c_func
(paren
id|np-&gt;pad0
comma
id|np-&gt;pad0
op_plus
l_int|1
comma
r_sizeof
(paren
id|np-&gt;pad0
)paren
op_minus
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  exiting netdev_rx() status of %d was %8.8x %d.&bslash;n&quot;
comma
id|np-&gt;rx_done
comma
id|desc_status
comma
id|memcmp
c_func
(paren
id|np-&gt;pad0
comma
id|np-&gt;pad0
op_plus
l_int|1
comma
r_sizeof
(paren
id|np-&gt;pad0
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* Restart Rx engine if stopped. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netdev_error
r_static
r_void
id|netdev_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|intr_status
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
id|LinkChange
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Link changed: Autonegotiation advertising&quot;
l_string|&quot; %4.4x  partner %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|4
)paren
comma
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
)paren
suffix:semicolon
id|check_duplex
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intr_status
op_amp
id|StatsMax
)paren
(brace
id|get_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Came close to underrunning the Tx FIFO, increase threshold. */
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrTxDataLow
)paren
id|writel
c_func
(paren
op_increment
id|np-&gt;tx_threshold
comma
id|dev-&gt;base_addr
op_plus
id|TxThreshold
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|intr_status
op_amp
op_complement
(paren
id|IntrAbnormalSummary
op_or
id|LinkChange
op_or
id|StatsMax
op_or
id|IntrTxDataLow
op_or
l_int|1
)paren
)paren
op_logical_and
id|debug
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Something Wicked happened! %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
multiline_comment|/* Hmmmmm, it&squot;s not clear how to recover from PCI faults. */
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrTxPCIErr
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrRxPCIErr
)paren
id|np-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
DECL|function|get_stats
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* This adapter architecture needs no SMP locks. */
id|np-&gt;stats.tx_bytes
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57010
)paren
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57044
)paren
suffix:semicolon
id|np-&gt;stats.tx_packets
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57000
)paren
suffix:semicolon
id|np-&gt;stats.tx_aborted_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57024
)paren
op_plus
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57028
)paren
suffix:semicolon
id|np-&gt;stats.tx_window_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57018
)paren
suffix:semicolon
id|np-&gt;stats.collisions
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57004
)paren
op_plus
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57008
)paren
suffix:semicolon
multiline_comment|/* The chip only need report frame silently dropped. */
id|np-&gt;stats.rx_dropped
op_add_assign
id|readw
c_func
(paren
id|ioaddr
op_plus
id|RxDMAStatus
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|RxDMAStatus
)paren
suffix:semicolon
id|np-&gt;stats.rx_crc_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x5703C
)paren
suffix:semicolon
id|np-&gt;stats.rx_frame_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57040
)paren
suffix:semicolon
id|np-&gt;stats.rx_length_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x57058
)paren
suffix:semicolon
id|np-&gt;stats.rx_missed_errors
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x5707C
)paren
suffix:semicolon
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* The little-endian AUTODIN II ethernet CRC calculations.&n;   A big-endian version is also available.&n;   This is slow but compact code.  Do not use this routine for bulk data,&n;   use a table-based routine instead.&n;   This is common code and should be moved to net/core/crc.c.&n;   Chips may use the upper or lower CRC bits, and may reverse and/or invert&n;   them.  Select the endian-ness that results in minimal calculations.&n;*/
DECL|variable|ethernet_polynomial_le
r_static
r_int
r_const
id|ethernet_polynomial_le
op_assign
l_int|0xedb88320U
suffix:semicolon
DECL|function|ether_crc_le
r_static
r_inline
r_int
id|ether_crc_le
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
r_int
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Initial value. */
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|8
suffix:semicolon
op_decrement
id|bit
op_ge
l_int|0
suffix:semicolon
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|current_octet
)paren
op_amp
l_int|1
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|ethernet_polynomial_le
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|rx_mode
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptAllMulticast
op_or
id|AcceptAll
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to match, or accept all multicasts. */
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptAllMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_le
l_int|15
)paren
(brace
multiline_comment|/* Use the 16 element perfect filter. */
r_int
id|filter_addr
op_assign
id|ioaddr
op_plus
l_int|0x56000
op_plus
l_int|1
op_star
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
op_le
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|u16
op_star
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|mclist-&gt;dmi_addr
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
id|cpu_to_be16
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|8
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_increment
OL
l_int|16
)paren
(brace
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|8
suffix:semicolon
)brace
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Must use a multicast hash table. */
r_int
id|filter_addr
suffix:semicolon
id|u16
id|mc_filter
(braket
l_int|32
)braket
id|__attribute__
(paren
(paren
id|aligned
c_func
(paren
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Multicast hash filter */
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|set_bit
c_func
(paren
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|23
comma
id|mc_filter
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear the perfect filter list. */
id|filter_addr
op_assign
id|ioaddr
op_plus
l_int|0x56000
op_plus
l_int|1
op_star
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|4
suffix:semicolon
id|writew
c_func
(paren
l_int|0xffff
comma
id|filter_addr
)paren
suffix:semicolon
id|filter_addr
op_add_assign
l_int|8
suffix:semicolon
)brace
r_for
c_loop
(paren
id|filter_addr
op_assign
id|ioaddr
op_plus
l_int|0x56100
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|filter_addr
op_add_assign
l_int|16
comma
id|i
op_increment
)paren
id|writew
c_func
(paren
id|mc_filter
(braket
id|i
)braket
comma
id|filter_addr
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
id|writel
c_func
(paren
id|rx_mode
comma
id|ioaddr
op_plus
id|RxFilterMode
)paren
suffix:semicolon
)brace
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
id|data
(braket
l_int|0
)braket
op_assign
id|np-&gt;phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
id|np-&gt;phys
(braket
l_int|0
)braket
)paren
(brace
id|u16
id|value
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|data
(braket
l_int|1
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|value
op_amp
l_int|0x9000
)paren
multiline_comment|/* Autonegotiation. */
id|np-&gt;medialock
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|np-&gt;full_duplex
op_assign
(paren
id|value
op_amp
l_int|0x0100
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|np-&gt;medialock
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|np-&gt;advertising
op_assign
id|value
suffix:semicolon
r_break
suffix:semicolon
)brace
id|check_duplex
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|netdev_close
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, Intr status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Queue pointers were Tx %d / %d,  Rx %d / %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_tx
comma
id|np-&gt;dirty_tx
comma
id|np-&gt;cur_rx
comma
id|np-&gt;dirty_rx
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
macro_line|#ifdef __i386__
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring at %8.8x:&bslash;n&quot;
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
multiline_comment|/* TX_RING_SIZE is huge! */
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; #%d desc. %8.8x %8.8x -&gt; %8.8x.&bslash;n&quot;
comma
id|i
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|addr
)paren
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_done_q
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring at %8.8x -&gt; %p:&bslash;n&quot;
comma
id|np-&gt;rx_ring_dma
comma
id|np-&gt;rx_done_q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_done_q
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
multiline_comment|/* RX_RING_SIZE */
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; #%d desc. %8.8x -&gt; %8.8x&bslash;n&quot;
comma
id|i
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxaddr
)paren
comma
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_done_q
(braket
id|i
)braket
dot
id|status
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* __i386__ debugging only */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxaddr
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xBADF00D0
)paren
suffix:semicolon
multiline_comment|/* An invalid address. */
r_if
c_cond
(paren
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|skb
op_ne
l_int|NULL
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|mapping
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|skb
)paren
suffix:semicolon
)brace
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;rx_info
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;tx_info
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|starfire_remove_one
r_static
r_void
id|__devexit
id|starfire_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_done_q
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;tx_done_q
comma
id|np-&gt;tx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_done_q
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;rx_done_q
comma
id|np-&gt;rx_done_q_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_ring
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_ring
)paren
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|starfire_driver
r_static
r_struct
id|pci_driver
id|starfire_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;starfire&quot;
comma
id|probe
suffix:colon
id|starfire_init_one
comma
id|remove
suffix:colon
id|starfire_remove_one
comma
id|id_table
suffix:colon
id|starfire_pci_tbl
comma
)brace
suffix:semicolon
DECL|function|starfire_init
r_static
r_int
id|__init
id|starfire_init
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
(paren
op_amp
id|starfire_driver
)paren
suffix:semicolon
)brace
DECL|function|starfire_cleanup
r_static
r_void
id|__exit
id|starfire_cleanup
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|starfire_driver
)paren
suffix:semicolon
)brace
DECL|variable|starfire_init
id|module_init
c_func
(paren
id|starfire_init
)paren
suffix:semicolon
DECL|variable|starfire_cleanup
id|module_exit
c_func
(paren
id|starfire_cleanup
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -DMODULE -Wall -Wstrict-prototypes -O6 -c starfire.c&quot;&n; *  simple-compile-command: &quot;gcc -DMODULE -O6 -c starfire.c&quot;&n; *  c-indent-level: 4&n; *  c-basic-offset: 4&n; *  tab-width: 4&n; * End:&n; */
eof
