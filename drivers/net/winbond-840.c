multiline_comment|/* winbond-840.c: A Linux PCI network adapter skeleton device driver. */
multiline_comment|/*&n;&t;Written 1998-2000 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;Support and updates available at&n;&t;http://www.scyld.com/network/drivers.html&n;&n;&t;Do not remove the copyright infomation.&n;&t;Do not change the version information unless an improvement has been made.&n;&t;Merely removing my name, as Compex has done in the past, does not count&n;&t;as an improvement.&n;&n;&t;Changelog:&n;&t;* ported to 2.4&n;&t;&t;???&n;&t;* spin lock update, memory barriers, new style dma mappings&n;&t;&t;limit each tx buffer to &lt; 1024 bytes&n;&t;&t;remove DescIntr from Rx descriptors (that&squot;s an Tx flag)&n;&t;&t;remove next pointer from Tx descriptors&n;&t;&t;synchronize tx_q_bytes&n;&t;&t;software reset in tx_timeout&n;&t;&t;&t;Copyright (C) 2000 Manfred Spraul&n;&n;&t;TODO:&n;&t;* according to the documentation, the chip supports big endian&n;&t;&t;descriptors. Remove cpu_to_le32, enable BE descriptors.&n;*/
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|version1
r_static
r_const
r_char
id|version1
(braket
)braket
op_assign
l_string|&quot;winbond-840.c:v1.01 (2.4 port) 5/15/2000  Donald Becker &lt;becker@scyld.com&gt;&bslash;n&quot;
suffix:semicolon
DECL|variable|version2
r_static
r_const
r_char
id|version2
(braket
)braket
op_assign
l_string|&quot;  http://www.scyld.com/network/drivers.html&bslash;n&quot;
suffix:semicolon
multiline_comment|/* Automatically extracted configuration info:&n;probe-func: winbond840_probe&n;config-in: tristate &squot;Winbond W89c840 Ethernet support&squot; CONFIG_WINBOND_840&n;&n;c-help-name: Winbond W89c840 PCI Ethernet support&n;c-help-symbol: CONFIG_WINBOND_840&n;c-help: This driver is for the Winbond W89c840 chip.  It also works with&n;c-help: the TX9882 chip on the Compex RL100-ATX board.&n;c-help: More specific information and updates are available from &n;c-help: http://www.scyld.com/network/drivers.html&n;*/
multiline_comment|/* The user-configurable values.&n;   These may be modified when a driver module is loaded.*/
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 1 normal messages, 0 quiet .. 7 verbose. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast).&n;   The &squot;840 uses a 64 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-frames scheme.&n;   Setting to &gt; 1518 effectively disables this feature. */
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Used to pass the media type, etc.&n;   Both &squot;options[]&squot; and &squot;full_duplex[]&squot; should exist for driver&n;   interoperability.&n;   The media type is usually passed in &squot;options[]&squot;.&n;*/
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8&t;&t;/* More are supported, limit only on options */
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Operational parameters that are set at compile time. */
multiline_comment|/* Keep the ring sizes a power of two for compile efficiency.&n;   The compiler will convert &lt;unsigned&gt;&squot;%&squot;&lt;2^N&gt; into a bit mask.&n;   Making the Tx ring too large decreases the effectiveness of channel&n;   bonding and packet priority.&n;   There are no ill effects from too-large receive rings. */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;16
DECL|macro|TX_QUEUE_LEN
mdefine_line|#define TX_QUEUE_LEN&t;10&t;&t;/* Limit ring entries actually used.  */
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;32
multiline_comment|/* The presumed FIFO size for working around the Tx-FIFO-overflow bug.&n;   To avoid overflowing we don&squot;t queue again until we have room for a&n;   full-size packet.&n; */
DECL|macro|TX_FIFO_SIZE
mdefine_line|#define TX_FIFO_SIZE (2048)
DECL|macro|TX_BUG_FIFO_LIMIT
mdefine_line|#define TX_BUG_FIFO_LIMIT (TX_FIFO_SIZE-1514-16)
DECL|macro|TX_BUFLIMIT
mdefine_line|#define TX_BUFLIMIT&t;(1024-128)
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (2*HZ)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
macro_line|#ifndef __KERNEL__
DECL|macro|__KERNEL__
mdefine_line|#define __KERNEL__
macro_line|#endif
macro_line|#if !defined(__OPTIMIZE__)
macro_line|#warning  You must compile this file with the correct options!
macro_line|#warning  See the last lines of the source file.
macro_line|#error You must compile this driver with &quot;-O&quot;.
macro_line|#endif
multiline_comment|/* Include files, designed to support most kernel versions 2.0.0 and later. */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/processor.h&gt;&t;&t;/* Processor type for cache alignment. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Donald Becker &lt;becker@scyld.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Winbond W89c840 Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This driver is for the Winbond w89c840 chip.&n;&n;II. Board-specific settings&n;&n;None.&n;&n;III. Driver operation&n;&n;This chip is very similar to the Digital 21*4* &quot;Tulip&quot; family.  The first&n;twelve registers and the descriptor format are nearly identical.  Read a&n;Tulip manual for operational details.&n;&n;A significant difference is that the multicast filter and station address are&n;stored in registers rather than loaded through a pseudo-transmit packet.&n;&n;Unlike the Tulip, transmit buffers are limited to 1KB.  To transmit a&n;full-sized packet we must use both data buffers in a descriptor.  Thus the&n;driver uses ring mode where descriptors are implicitly sequential in memory,&n;rather than using the second descriptor address as a chain pointer to&n;subsequent descriptors.&n;&n;IV. Notes&n;&n;If you are going to almost clone a Tulip, why not go all the way and avoid&n;the need for a new driver?&n;&n;IVb. References&n;&n;http://www.scyld.com/expert/100mbps.html&n;http://www.scyld.com/expert/NWay.html&n;http://www.winbond.com.tw/&n;&n;IVc. Errata&n;&n;A horrible bug exists in the transmit FIFO.  Apparently the chip doesn&squot;t&n;correctly detect a full FIFO, and queuing more than 2048 bytes may result in&n;silent data corruption.&n;&n;*/
"&f;"
multiline_comment|/*&n;  PCI probe table.&n;*/
DECL|enum|pci_id_flags_bits
r_enum
id|pci_id_flags_bits
(brace
multiline_comment|/* Set PCI command register bits before calling probe1(). */
DECL|enumerator|PCI_USES_IO
DECL|enumerator|PCI_USES_MEM
DECL|enumerator|PCI_USES_MASTER
id|PCI_USES_IO
op_assign
l_int|1
comma
id|PCI_USES_MEM
op_assign
l_int|2
comma
id|PCI_USES_MASTER
op_assign
l_int|4
comma
multiline_comment|/* Read and map the single following PCI BAR. */
DECL|enumerator|PCI_ADDR0
DECL|enumerator|PCI_ADDR1
DECL|enumerator|PCI_ADDR2
DECL|enumerator|PCI_ADDR3
id|PCI_ADDR0
op_assign
l_int|0
op_lshift
l_int|4
comma
id|PCI_ADDR1
op_assign
l_int|1
op_lshift
l_int|4
comma
id|PCI_ADDR2
op_assign
l_int|2
op_lshift
l_int|4
comma
id|PCI_ADDR3
op_assign
l_int|3
op_lshift
l_int|4
comma
DECL|enumerator|PCI_ADDR_64BITS
DECL|enumerator|PCI_NO_ACPI_WAKE
DECL|enumerator|PCI_NO_MIN_LATENCY
id|PCI_ADDR_64BITS
op_assign
l_int|0x100
comma
id|PCI_NO_ACPI_WAKE
op_assign
l_int|0x200
comma
id|PCI_NO_MIN_LATENCY
op_assign
l_int|0x400
comma
)brace
suffix:semicolon
DECL|enum|chip_capability_flags
DECL|enumerator|CanHaveMII
DECL|enumerator|HasBrokenTx
r_enum
id|chip_capability_flags
(brace
id|CanHaveMII
op_assign
l_int|1
comma
id|HasBrokenTx
op_assign
l_int|2
)brace
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
DECL|macro|W840_FLAGS
mdefine_line|#define W840_FLAGS (PCI_USES_IO | PCI_ADDR0 | PCI_USES_MASTER)
macro_line|#else
DECL|macro|W840_FLAGS
mdefine_line|#define W840_FLAGS (PCI_USES_MEM | PCI_ADDR1 | PCI_USES_MASTER)
macro_line|#endif
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|w840_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1050
comma
l_int|0x0840
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0x11f6
comma
l_int|0x2011
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|w840_pci_tbl
)paren
suffix:semicolon
DECL|struct|pci_id_info
r_struct
id|pci_id_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|struct|match_info
r_struct
id|match_info
(brace
DECL|member|pci
DECL|member|pci_mask
DECL|member|subsystem
DECL|member|subsystem_mask
r_int
id|pci
comma
id|pci_mask
comma
id|subsystem
comma
id|subsystem_mask
suffix:semicolon
DECL|member|revision
DECL|member|revision_mask
r_int
id|revision
comma
id|revision_mask
suffix:semicolon
multiline_comment|/* Only 8 bits. */
DECL|member|id
)brace
id|id
suffix:semicolon
DECL|member|pci_flags
r_enum
id|pci_id_flags_bits
id|pci_flags
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
multiline_comment|/* Needed for I/O region check or ioremap(). */
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
multiline_comment|/* Driver use, intended as capability flags. */
)brace
suffix:semicolon
DECL|variable|pci_id_tbl
r_static
r_struct
id|pci_id_info
id|pci_id_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Winbond W89c840&quot;
comma
(brace
l_int|0x08401050
comma
l_int|0xffffffff
comma
)brace
comma
id|W840_FLAGS
comma
l_int|128
comma
id|CanHaveMII
op_or
id|HasBrokenTx
)brace
comma
(brace
l_string|&quot;Compex RL100-ATX&quot;
comma
(brace
l_int|0x201111F6
comma
l_int|0xffffffff
comma
)brace
comma
id|W840_FLAGS
comma
l_int|128
comma
id|CanHaveMII
op_or
id|HasBrokenTx
)brace
comma
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* 0 terminated list. */
)brace
suffix:semicolon
multiline_comment|/* This driver was written to use PCI memory space, however some x86 systems&n;   work only with I/O space accesses.  Pass -DUSE_IO_OPS to use PCI I/O space&n;   accesses instead of memory space. */
macro_line|#ifdef USE_IO_OPS
DECL|macro|readb
macro_line|#undef readb
DECL|macro|readw
macro_line|#undef readw
DECL|macro|readl
macro_line|#undef readl
DECL|macro|writeb
macro_line|#undef writeb
DECL|macro|writew
macro_line|#undef writew
DECL|macro|writel
macro_line|#undef writel
DECL|macro|readb
mdefine_line|#define readb inb
DECL|macro|readw
mdefine_line|#define readw inw
DECL|macro|readl
mdefine_line|#define readl inl
DECL|macro|writeb
mdefine_line|#define writeb outb
DECL|macro|writew
mdefine_line|#define writew outw
DECL|macro|writel
mdefine_line|#define writel outl
macro_line|#endif
multiline_comment|/* Offsets to the Command and Status Registers, &quot;CSRs&quot;.&n;   While similar to the Tulip, these registers are longword aligned.&n;   Note: It&squot;s not useful to define symbolic names for every register bit in&n;   the device.  The name can only partially document the semantics and make&n;   the driver longer and more difficult to read.&n;*/
DECL|enum|w840_offsets
r_enum
id|w840_offsets
(brace
DECL|enumerator|PCIBusCfg
DECL|enumerator|TxStartDemand
DECL|enumerator|RxStartDemand
id|PCIBusCfg
op_assign
l_int|0x00
comma
id|TxStartDemand
op_assign
l_int|0x04
comma
id|RxStartDemand
op_assign
l_int|0x08
comma
DECL|enumerator|RxRingPtr
DECL|enumerator|TxRingPtr
id|RxRingPtr
op_assign
l_int|0x0C
comma
id|TxRingPtr
op_assign
l_int|0x10
comma
DECL|enumerator|IntrStatus
DECL|enumerator|NetworkConfig
DECL|enumerator|IntrEnable
id|IntrStatus
op_assign
l_int|0x14
comma
id|NetworkConfig
op_assign
l_int|0x18
comma
id|IntrEnable
op_assign
l_int|0x1C
comma
DECL|enumerator|RxMissed
DECL|enumerator|EECtrl
DECL|enumerator|MIICtrl
DECL|enumerator|BootRom
DECL|enumerator|GPTimer
id|RxMissed
op_assign
l_int|0x20
comma
id|EECtrl
op_assign
l_int|0x24
comma
id|MIICtrl
op_assign
l_int|0x24
comma
id|BootRom
op_assign
l_int|0x28
comma
id|GPTimer
op_assign
l_int|0x2C
comma
DECL|enumerator|CurRxDescAddr
DECL|enumerator|CurRxBufAddr
id|CurRxDescAddr
op_assign
l_int|0x30
comma
id|CurRxBufAddr
op_assign
l_int|0x34
comma
multiline_comment|/* Debug use */
DECL|enumerator|MulticastFilter0
DECL|enumerator|MulticastFilter1
DECL|enumerator|StationAddr
id|MulticastFilter0
op_assign
l_int|0x38
comma
id|MulticastFilter1
op_assign
l_int|0x3C
comma
id|StationAddr
op_assign
l_int|0x40
comma
DECL|enumerator|CurTxDescAddr
DECL|enumerator|CurTxBufAddr
id|CurTxDescAddr
op_assign
l_int|0x4C
comma
id|CurTxBufAddr
op_assign
l_int|0x50
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in the interrupt status/enable registers. */
multiline_comment|/* The bits in the Intr Status/Enable registers, mostly interrupt sources. */
DECL|enum|intr_status_bits
r_enum
id|intr_status_bits
(brace
DECL|enumerator|NormalIntr
DECL|enumerator|AbnormalIntr
id|NormalIntr
op_assign
l_int|0x10000
comma
id|AbnormalIntr
op_assign
l_int|0x8000
comma
DECL|enumerator|IntrPCIErr
DECL|enumerator|TimerInt
id|IntrPCIErr
op_assign
l_int|0x2000
comma
id|TimerInt
op_assign
l_int|0x800
comma
DECL|enumerator|IntrRxDied
DECL|enumerator|RxNoBuf
DECL|enumerator|IntrRxDone
id|IntrRxDied
op_assign
l_int|0x100
comma
id|RxNoBuf
op_assign
l_int|0x80
comma
id|IntrRxDone
op_assign
l_int|0x40
comma
DECL|enumerator|TxFIFOUnderflow
DECL|enumerator|RxErrIntr
id|TxFIFOUnderflow
op_assign
l_int|0x20
comma
id|RxErrIntr
op_assign
l_int|0x10
comma
DECL|enumerator|TxIdle
DECL|enumerator|IntrTxStopped
DECL|enumerator|IntrTxDone
id|TxIdle
op_assign
l_int|0x04
comma
id|IntrTxStopped
op_assign
l_int|0x02
comma
id|IntrTxDone
op_assign
l_int|0x01
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in the NetworkConfig register. */
DECL|enum|rx_mode_bits
r_enum
id|rx_mode_bits
(brace
DECL|enumerator|AcceptErr
DECL|enumerator|AcceptRunt
id|AcceptErr
op_assign
l_int|0x80
comma
id|AcceptRunt
op_assign
l_int|0x40
comma
DECL|enumerator|AcceptBroadcast
DECL|enumerator|AcceptMulticast
id|AcceptBroadcast
op_assign
l_int|0x20
comma
id|AcceptMulticast
op_assign
l_int|0x10
comma
DECL|enumerator|AcceptAllPhys
DECL|enumerator|AcceptMyPhys
id|AcceptAllPhys
op_assign
l_int|0x08
comma
id|AcceptMyPhys
op_assign
l_int|0x02
comma
)brace
suffix:semicolon
DECL|enum|mii_reg_bits
r_enum
id|mii_reg_bits
(brace
DECL|enumerator|MDIO_ShiftClk
DECL|enumerator|MDIO_DataIn
DECL|enumerator|MDIO_DataOut
id|MDIO_ShiftClk
op_assign
l_int|0x10000
comma
id|MDIO_DataIn
op_assign
l_int|0x80000
comma
id|MDIO_DataOut
op_assign
l_int|0x20000
comma
DECL|enumerator|MDIO_EnbOutput
DECL|enumerator|MDIO_EnbIn
id|MDIO_EnbOutput
op_assign
l_int|0x40000
comma
id|MDIO_EnbIn
op_assign
l_int|0x00000
comma
)brace
suffix:semicolon
multiline_comment|/* The Tulip Rx and Tx buffer descriptors. */
DECL|struct|w840_rx_desc
r_struct
id|w840_rx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
id|u32
id|buffer1
suffix:semicolon
DECL|member|buffer2
id|u32
id|buffer2
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|w840_tx_desc
r_struct
id|w840_tx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
DECL|member|buffer2
id|u32
id|buffer1
comma
id|buffer2
suffix:semicolon
multiline_comment|/* We use only buffer 1.  */
)brace
suffix:semicolon
multiline_comment|/* Bits in network_desc.status */
DECL|enum|desc_status_bits
r_enum
id|desc_status_bits
(brace
DECL|enumerator|DescOwn
DECL|enumerator|DescEndRing
DECL|enumerator|DescUseLink
id|DescOwn
op_assign
l_int|0x80000000
comma
id|DescEndRing
op_assign
l_int|0x02000000
comma
id|DescUseLink
op_assign
l_int|0x01000000
comma
DECL|enumerator|DescWholePkt
DECL|enumerator|DescStartPkt
DECL|enumerator|DescEndPkt
id|DescWholePkt
op_assign
l_int|0x60000000
comma
id|DescStartPkt
op_assign
l_int|0x20000000
comma
id|DescEndPkt
op_assign
l_int|0x40000000
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in w840_tx_desc.length */
DECL|enum|desc_length_bits
r_enum
id|desc_length_bits
(brace
DECL|enumerator|DescIntr
id|DescIntr
op_assign
l_int|0x80000000
comma
)brace
suffix:semicolon
DECL|macro|PRIV_ALIGN
mdefine_line|#define PRIV_ALIGN&t;15 &t;/* Required alignment mask */
DECL|struct|netdev_private
r_struct
id|netdev_private
(brace
DECL|member|rx_ring
r_struct
id|w840_rx_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|rx_addr
id|dma_addr_t
id|rx_addr
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_ring
r_struct
id|w840_tx_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|tx_addr
id|dma_addr_t
id|tx_addr
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|ring_dma_addr
id|dma_addr_t
id|ring_dma_addr
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
multiline_comment|/* The addresses of receive-in-place skbuffs. */
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* The saved address of a sent-in-place packet/buffer, for later free(). */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Media monitoring timer. */
multiline_comment|/* Frequently used values: keep some adjacent for cache effect. */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|chip_id
DECL|member|drv_flags
r_int
id|chip_id
comma
id|drv_flags
suffix:semicolon
DECL|member|csr6
r_int
id|csr6
suffix:semicolon
DECL|member|rx_head_desc
r_struct
id|w840_rx_desc
op_star
id|rx_head_desc
suffix:semicolon
DECL|member|cur_rx
DECL|member|dirty_rx
r_int
r_int
id|cur_rx
comma
id|dirty_rx
suffix:semicolon
multiline_comment|/* Producer/consumer ring indices */
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
multiline_comment|/* Based on MTU+slack. */
DECL|member|cur_tx
DECL|member|dirty_tx
r_int
r_int
id|cur_tx
comma
id|dirty_tx
suffix:semicolon
DECL|member|tx_q_bytes
r_int
id|tx_q_bytes
suffix:semicolon
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* The Tx queue is full. */
multiline_comment|/* These values are keep track of the transceiver/media in use. */
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Full-duplex operation requested. */
DECL|member|duplex_lock
r_int
r_int
id|duplex_lock
suffix:colon
l_int|1
suffix:semicolon
DECL|member|medialock
r_int
r_int
id|medialock
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Do not sense media. */
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
multiline_comment|/* MII transceiver section. */
DECL|member|mii_cnt
r_int
id|mii_cnt
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|advertising
id|u16
id|advertising
suffix:semicolon
multiline_comment|/* NWay media advertisement */
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
)brace
suffix:semicolon
r_static
r_int
id|eeprom_read
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|init_rxtx_rings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|free_rxtx_rings
c_func
(paren
r_struct
id|netdev_private
op_star
id|np
)paren
suffix:semicolon
r_static
r_void
id|init_registers
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|alloc_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|netdev_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|intr_status
)paren
suffix:semicolon
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_inline
r_int
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
"&f;"
DECL|function|w840_probe1
r_static
r_int
id|__devinit
id|w840_probe1
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_static
r_int
id|find_cnt
suffix:semicolon
r_int
id|chip_idx
op_assign
id|ent-&gt;driver_data
suffix:semicolon
r_int
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_int
id|i
comma
id|option
op_assign
id|find_cnt
OL
id|MAX_UNITS
ques
c_cond
id|options
(braket
id|find_cnt
)braket
suffix:colon
l_int|0
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pdev
comma
l_int|0xFFFFffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Winbond-840: Device %s disabled due to DMA limitations.&bslash;n&quot;
comma
id|pdev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|np
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ioaddr
comma
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
comma
id|dev-&gt;name
)paren
)paren
r_goto
id|err_out_netdev
suffix:semicolon
macro_line|#else
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ioaddr
comma
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
comma
id|dev-&gt;name
)paren
)paren
r_goto
id|err_out_netdev
suffix:semicolon
id|ioaddr
op_assign
(paren
r_int
)paren
id|ioremap
(paren
id|ioaddr
comma
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
r_goto
id|err_out_iomem
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
comma
id|dev-&gt;name
comma
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|name
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Warning: broken for big-endian machines. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
c_func
(paren
id|eeprom_read
c_func
(paren
id|ioaddr
comma
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/* Reset the chip to erase previous misconfiguration.&n;&t;   No hold time required! */
id|writel
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|np-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
id|np-&gt;drv_flags
op_assign
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|drv_flags
suffix:semicolon
id|np-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|pdev-&gt;driver_data
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
id|option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|option
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|option
op_amp
l_int|0x200
)paren
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|np-&gt;default_port
op_assign
id|option
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;default_port
)paren
id|np-&gt;medialock
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|find_cnt
template_param
l_int|0
)paren
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
id|np-&gt;duplex_lock
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* The chip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|netdev_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|start_tx
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|netdev_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
op_amp
id|tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;drv_flags
op_amp
id|CanHaveMII
)paren
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|1
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
l_int|4
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|np-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|np-&gt;advertising
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII PHY found at address %d, status &quot;
l_string|&quot;0x%4.4x advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_status
comma
id|np-&gt;advertising
)paren
suffix:semicolon
)brace
)brace
id|np-&gt;mii_cnt
op_assign
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MII PHY not found -- this device may &quot;
l_string|&quot;not operate correctly.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|find_cnt
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|err_out_iomem
suffix:colon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_id_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
suffix:semicolon
macro_line|#endif
id|err_out_netdev
suffix:colon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|kfree
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
"&f;"
multiline_comment|/* Read the EEPROM and MII Management Data I/O (MDIO) interfaces.  These are&n;   often serial bit streams generated by the host processor.&n;   The example below is for the common 93c46 EEPROM, 64 16 bit words. */
multiline_comment|/* Delay between EEPROM clock transitions.&n;   No extra delay is needed with 33Mhz PCI, but future 66Mhz access may need&n;   a delay.  Note that pre-2.0.34 kernels had a cache-alignment bug that&n;   made udelay() unreliable.&n;   The old method of using an ISA access as a delay, __SLOW_DOWN_IO__, is&n;   depricated.&n;*/
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay(ee_addr)&t;readl(ee_addr)
DECL|enum|EEPROM_Ctrl_Bits
r_enum
id|EEPROM_Ctrl_Bits
(brace
DECL|enumerator|EE_ShiftClk
DECL|enumerator|EE_Write0
DECL|enumerator|EE_Write1
id|EE_ShiftClk
op_assign
l_int|0x02
comma
id|EE_Write0
op_assign
l_int|0x801
comma
id|EE_Write1
op_assign
l_int|0x805
comma
DECL|enumerator|EE_ChipSelect
DECL|enumerator|EE_DataIn
id|EE_ChipSelect
op_assign
l_int|0x801
comma
id|EE_DataIn
op_assign
l_int|0x08
comma
)brace
suffix:semicolon
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|enum|EEPROM_Cmds
r_enum
id|EEPROM_Cmds
(brace
DECL|enumerator|EE_WriteCmd
DECL|enumerator|EE_ReadCmd
DECL|enumerator|EE_EraseCmd
id|EE_WriteCmd
op_assign
(paren
l_int|5
op_lshift
l_int|6
)paren
comma
id|EE_ReadCmd
op_assign
(paren
l_int|6
op_lshift
l_int|6
)paren
comma
id|EE_EraseCmd
op_assign
(paren
l_int|7
op_lshift
l_int|6
)paren
comma
)brace
suffix:semicolon
DECL|function|eeprom_read
r_static
r_int
id|eeprom_read
c_func
(paren
r_int
id|addr
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr
op_assign
id|addr
op_plus
id|EECtrl
suffix:semicolon
r_int
id|read_cmd
op_assign
id|location
op_or
id|EE_ReadCmd
suffix:semicolon
id|writel
c_func
(paren
id|EE_ChipSelect
comma
id|ee_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|10
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_Write1
suffix:colon
id|EE_Write0
suffix:semicolon
id|writel
c_func
(paren
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dataval
op_or
id|EE_ShiftClk
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|EE_ChipSelect
comma
id|ee_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writel
c_func
(paren
id|EE_ChipSelect
op_or
id|EE_ShiftClk
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EE_DataIn
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EE_ChipSelect
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|writel
c_func
(paren
l_int|0
comma
id|ee_addr
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*  MII transceiver control section.&n;&t;Read and write the MII registers using software-generated serial&n;&t;MDIO protocol.  See the MII specifications or DP83840A data sheet&n;&t;for details.&n;&n;&t;The maximum data clock rate is 2.5 Mhz.  The minimum timing is usually&n;&t;met by back-to-back 33Mhz PCI cycles. */
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay(mdio_addr) readl(mdio_addr)
multiline_comment|/* Set iff a MII transceiver on any interface requires mdio preamble.&n;   This only set with older tranceivers, so the extra&n;   code size of a per-interface flag is not worthwhile. */
DECL|variable|mii_preamble_required
r_static
r_char
id|mii_preamble_required
op_assign
l_int|1
suffix:semicolon
DECL|macro|MDIO_WRITE0
mdefine_line|#define MDIO_WRITE0 (MDIO_EnbOutput)
DECL|macro|MDIO_WRITE1
mdefine_line|#define MDIO_WRITE1 (MDIO_DataOut | MDIO_EnbOutput)
multiline_comment|/* Generate the preamble required for initial synchronization and&n;   a few older transceivers. */
DECL|function|mdio_sync
r_static
r_void
id|mdio_sync
c_func
(paren
r_int
id|mdio_addr
)paren
(brace
r_int
id|bits
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Establish sync by sending at least 32 logic ones. */
r_while
c_loop
(paren
op_decrement
id|bits
op_ge
l_int|0
)paren
(brace
id|writel
c_func
(paren
id|MDIO_WRITE1
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|MDIO_WRITE1
op_or
id|MDIO_ShiftClk
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
)brace
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|MIICtrl
suffix:semicolon
r_int
id|mii_cmd
op_assign
(paren
l_int|0xf6
op_lshift
l_int|10
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|5
)paren
op_or
id|location
suffix:semicolon
r_int
id|i
comma
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mii_preamble_required
)paren
id|mdio_sync
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_WRITE1
suffix:colon
id|MDIO_WRITE0
suffix:semicolon
id|writel
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dataval
op_or
id|MDIO_ShiftClk
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the two transition, 16 data, and wire-idle bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|20
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writel
c_func
(paren
id|MDIO_EnbIn
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readl
c_func
(paren
id|mdio_addr
)paren
op_amp
id|MDIO_DataIn
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|MDIO_EnbIn
op_or
id|MDIO_ShiftClk
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
r_return
(paren
id|retval
op_rshift
l_int|1
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|mdio_addr
op_assign
id|dev-&gt;base_addr
op_plus
id|MIICtrl
suffix:semicolon
r_int
id|mii_cmd
op_assign
(paren
l_int|0x5002
op_lshift
l_int|16
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|23
)paren
op_or
(paren
id|location
op_lshift
l_int|18
)paren
op_or
id|value
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|location
op_eq
l_int|4
op_logical_and
id|phy_id
op_eq
id|np-&gt;phys
(braket
l_int|0
)braket
)paren
id|np-&gt;advertising
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|mii_preamble_required
)paren
id|mdio_sync
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_WRITE1
suffix:colon
id|MDIO_WRITE0
suffix:semicolon
id|writel
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dataval
op_or
id|MDIO_ShiftClk
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear out extra bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writel
c_func
(paren
id|MDIO_EnbIn
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|MDIO_EnbIn
op_or
id|MDIO_ShiftClk
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
"&f;"
DECL|function|netdev_open
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
multiline_comment|/* Reset */
id|i
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|intr_handler
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: w89c840_open() irq %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|alloc_ring
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
id|init_registers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done netdev_open().&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Set the timer to check for link beat. */
id|init_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|3
op_star
id|HZ
suffix:semicolon
id|np-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;timer.function
op_assign
op_amp
id|netdev_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_duplex
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|mii_reg5
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:semicolon
r_int
id|negotiated
op_assign
id|mii_reg5
op_amp
id|np-&gt;advertising
suffix:semicolon
r_int
id|duplex
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;duplex_lock
op_logical_or
id|mii_reg5
op_eq
l_int|0xffff
)paren
r_return
suffix:semicolon
id|duplex
op_assign
(paren
id|negotiated
op_amp
l_int|0x0100
)paren
op_logical_or
(paren
id|negotiated
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
op_ne
id|duplex
)paren
(brace
id|np-&gt;full_duplex
op_assign
id|duplex
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII #%d &quot;
l_string|&quot;negotiated capability %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|negotiated
)paren
suffix:semicolon
id|np-&gt;csr6
op_and_assign
op_complement
l_int|0x200
suffix:semicolon
id|np-&gt;csr6
op_or_assign
id|duplex
ques
c_cond
l_int|0x200
suffix:colon
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|netdev_timer
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
r_int
id|old_csr6
op_assign
id|np-&gt;csr6
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection timer tick, status %8.8x &quot;
l_string|&quot;config %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|NetworkConfig
)paren
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;csr6
op_ne
id|old_csr6
)paren
(brace
id|writel
c_func
(paren
id|np-&gt;csr6
op_amp
op_complement
l_int|0x0002
comma
id|ioaddr
op_plus
id|NetworkConfig
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;csr6
op_or
l_int|0x2002
comma
id|ioaddr
op_plus
id|NetworkConfig
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|next_tick
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|init_rxtx_rings
r_static
r_void
id|init_rxtx_rings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np-&gt;rx_head_desc
op_assign
op_amp
id|np-&gt;rx_ring
(braket
l_int|0
)braket
suffix:semicolon
id|np-&gt;tx_ring
op_assign
(paren
r_struct
id|w840_tx_desc
op_star
)paren
op_amp
id|np-&gt;rx_ring
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* Initial all Rx descriptors. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|np-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|length
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DescEndRing
)paren
suffix:semicolon
multiline_comment|/* Fill in the Rx buffers.  Handle allocation failure gracefully. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;rx_addr
(braket
id|i
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pdev
comma
id|skb-&gt;tail
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
)brace
id|np-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|np-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* Initialize the Tx descriptors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
id|np-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_q_bytes
op_assign
id|np-&gt;dirty_tx
op_assign
id|np-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;ring_dma_addr
comma
id|dev-&gt;base_addr
op_plus
id|RxRingPtr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;ring_dma_addr
op_plus
r_sizeof
(paren
r_struct
id|w840_rx_desc
)paren
op_star
id|RX_RING_SIZE
comma
id|dev-&gt;base_addr
op_plus
id|TxRingPtr
)paren
suffix:semicolon
)brace
DECL|function|free_rxtx_rings
r_static
r_void
id|free_rxtx_rings
c_func
(paren
r_struct
id|netdev_private
op_star
id|np
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pdev
comma
id|np-&gt;rx_addr
(braket
id|i
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pdev
comma
id|np-&gt;tx_addr
(braket
id|i
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|init_registers
r_static
r_void
id|init_registers
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|writeb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|StationAddr
op_plus
id|i
)paren
suffix:semicolon
multiline_comment|/* Initialize other registers. */
multiline_comment|/* Configure the PCI bus bursts and FIFO thresholds.&n;&t;   486: Set 8 longword cache alignment, 8 longword burst.&n;&t;   586: Set 16 longword cache alignment, no burst limit.&n;&t;   Cache alignment bits 15:14&t;     Burst length 13:8&n;&t;&t;0000&t;&lt;not allowed&gt; &t;&t;0000 align to cache&t;0800 8 longwords&n;&t;&t;4000&t;8  longwords&t;&t;0100 1 longword&t;&t;1000 16 longwords&n;&t;&t;8000&t;16 longwords&t;&t;0200 2 longwords&t;2000 32 longwords&n;&t;&t;C000&t;32  longwords&t;&t;0400 4 longwords&n;&t;   Wait the specified 50 PCI cycles after a reset by initializing&n;&t;   Tx and Rx queues and the address filter list. */
macro_line|#if defined(__powerpc__)&t;&t;/* Big-endian */
id|writel
c_func
(paren
l_int|0x00100080
op_or
l_int|0xE010
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
macro_line|#elif defined(__alpha__)
id|writel
c_func
(paren
l_int|0xE010
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
macro_line|#elif defined(__i386__)
macro_line|#if defined(MODULE)
id|writel
c_func
(paren
l_int|0xE010
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* When not a module we can work around broken &squot;486 PCI boards. */
mdefine_line|#define x86 boot_cpu_data.x86
id|writel
c_func
(paren
(paren
id|x86
op_le
l_int|4
ques
c_cond
l_int|0x4810
suffix:colon
l_int|0xE010
)paren
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x86
op_le
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: This is a 386/486 PCI system, setting cache &quot;
l_string|&quot;alignment to %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|x86
op_le
l_int|4
ques
c_cond
l_int|0x4810
suffix:colon
l_int|0x8010
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
id|writel
c_func
(paren
l_int|0xE010
comma
id|ioaddr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
macro_line|#warning Processor architecture undefined!
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|np-&gt;default_port
suffix:semicolon
multiline_comment|/* Fast Ethernet; 128 byte Tx threshold; &n;&t;&t;Transmit on; Receive on; */
id|np-&gt;csr6
op_assign
l_int|0x20022002
suffix:semicolon
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|RxStartDemand
)paren
suffix:semicolon
multiline_comment|/* Clear and Enable interrupts by setting the interrupt mask. */
id|writel
c_func
(paren
l_int|0x1A0F5
comma
id|ioaddr
op_plus
id|IntrStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x1A0F5
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
)brace
DECL|function|tx_timeout
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timed out, status %8.8x,&quot;
l_string|&quot; resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
macro_line|#ifndef __alpha__
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|np-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|np-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Tx cur %d Tx dirty %d Tx Full %d, q bytes %d.&bslash;n&quot;
comma
id|np-&gt;cur_tx
comma
id|np-&gt;dirty_tx
comma
id|np-&gt;tx_full
comma
id|np-&gt;tx_q_bytes
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Tx Descriptor addr %xh.&bslash;n&quot;
comma
id|readl
c_func
(paren
id|ioaddr
op_plus
l_int|0x4C
)paren
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Under high load dirty_tx and the internal tx descriptor pointer&n;&t; * come out of sync, thus perform a software reset and reinitialize&n;&t; * everything.&n;&t; */
id|writel
c_func
(paren
l_int|1
comma
id|dev-&gt;base_addr
op_plus
id|PCIBusCfg
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|free_rxtx_rings
c_func
(paren
id|np
)paren
suffix:semicolon
id|init_rxtx_rings
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init_registers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|alloc_ring
r_static
r_int
id|alloc_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|np-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PKT_BUF_SZ
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
id|np-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|np-&gt;pdev
comma
r_sizeof
(paren
r_struct
id|w840_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|w840_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
op_amp
id|np-&gt;ring_dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;rx_ring
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_rxtx_rings
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
r_int
id|len1
comma
id|len2
suffix:semicolon
multiline_comment|/* Caution: the write order is important here, set the field&n;&t;   with the &quot;ownership&quot; bits last. */
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|np-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|np-&gt;tx_addr
(braket
id|entry
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;tx_addr
(braket
id|entry
)braket
)paren
suffix:semicolon
id|len2
op_assign
l_int|0
suffix:semicolon
id|len1
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|len1
OG
id|TX_BUFLIMIT
)paren
(brace
id|len1
op_assign
id|TX_BUFLIMIT
suffix:semicolon
id|len2
op_assign
id|skb-&gt;len
op_minus
id|len1
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;tx_addr
(braket
id|entry
)braket
op_plus
id|TX_BUFLIMIT
)paren
suffix:semicolon
)brace
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|DescWholePkt
op_or
(paren
id|len2
op_lshift
l_int|11
)paren
op_or
id|len1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ge
id|TX_RING_SIZE
op_minus
l_int|1
)paren
multiline_comment|/* Wrap ring */
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DescIntr
op_or
id|DescEndRing
)paren
suffix:semicolon
id|np-&gt;cur_tx
op_increment
suffix:semicolon
multiline_comment|/* The spinlock protects against 2 races:&n;&t; * - tx_q_bytes is updated by this function and intr_handler&n;&t; * - our hardware is extremely fast and finishes the packet between&n;&t; *&t;our check for &quot;queue full&quot; and netif_stop_queue.&n;&t; *&t;Thus setting DescOwn and netif_stop_queue must be atomic.&n;&t; */
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* flush length, buffer1, buffer2 */
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* flush status and kick the hardware */
id|writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|TxStartDemand
)paren
suffix:semicolon
id|np-&gt;tx_q_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* Work around horrible bug in the chip by marking the queue as full&n;&t;   when we do not have FIFO room for a maximum sized packet. */
r_if
c_cond
(paren
id|np-&gt;cur_tx
op_minus
id|np-&gt;dirty_tx
OG
id|TX_QUEUE_LEN
)paren
id|np-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|np-&gt;drv_flags
op_amp
id|HasBrokenTx
)paren
op_logical_and
id|np-&gt;tx_q_bytes
OG
id|TX_BUG_FIFO_LIMIT
)paren
id|np-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_full
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit frame #%d queued in slot %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_tx
comma
id|entry
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|intr_handler
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|rgs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|work_limit
op_assign
id|max_interrupt_work
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_do
(brace
id|u32
id|intr_status
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|writel
c_func
(paren
id|intr_status
op_amp
l_int|0x001ffff
comma
id|ioaddr
op_plus
id|IntrStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|intr_status
op_amp
(paren
id|NormalIntr
op_or
id|AbnormalIntr
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
(paren
id|IntrRxDone
op_or
id|RxNoBuf
)paren
)paren
id|netdev_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|np-&gt;cur_tx
op_minus
id|np-&gt;dirty_tx
OG
l_int|0
suffix:semicolon
id|np-&gt;dirty_tx
op_increment
)paren
(brace
r_int
id|entry
op_assign
id|np-&gt;dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|tx_status
op_assign
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x8000
)paren
(brace
multiline_comment|/* There was an error, log it. */
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit error, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tx_status
)paren
suffix:semicolon
macro_line|#endif
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0104
)paren
id|np-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0C80
)paren
id|np-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0200
)paren
id|np-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0002
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
l_int|0x0080
)paren
op_logical_and
id|np-&gt;full_duplex
op_eq
l_int|0
)paren
id|np-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0100
)paren
id|np-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x0001
)paren
id|np-&gt;stats.tx_deferred
op_increment
suffix:semicolon
macro_line|#endif
id|np-&gt;stats.tx_bytes
op_add_assign
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
id|np-&gt;stats.collisions
op_add_assign
(paren
id|tx_status
op_rshift
l_int|3
)paren
op_amp
l_int|15
suffix:semicolon
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
id|pci_unmap_single
c_func
(paren
id|np-&gt;pdev
comma
id|np-&gt;tx_addr
(braket
id|entry
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;tx_q_bytes
op_sub_assign
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;tx_full
op_logical_and
id|np-&gt;cur_tx
op_minus
id|np-&gt;dirty_tx
OL
id|TX_QUEUE_LEN
op_minus
l_int|4
op_logical_and
id|np-&gt;tx_q_bytes
OL
id|TX_BUG_FIFO_LIMIT
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tbusy. */
id|np-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Abnormal error summary/uncommon events handlers. */
r_if
c_cond
(paren
id|intr_status
op_amp
(paren
id|AbnormalIntr
op_or
id|TxFIFOUnderflow
op_or
id|IntrPCIErr
op_or
id|TimerInt
op_or
id|IntrTxStopped
)paren
)paren
id|netdev_error
c_func
(paren
id|dev
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|work_limit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;status=0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
multiline_comment|/* Set the timer to re-enable the other interrupts after&n;&t;&t;&t;   10*82usec ticks. */
id|writel
c_func
(paren
id|AbnormalIntr
op_or
id|TimerInt
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|10
comma
id|ioaddr
op_plus
id|GPTimer
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/* This routine is logically part of the interrupt handler, but separated&n;   for clarity and better register allocation. */
DECL|function|netdev_rx
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
op_assign
id|np-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|work_limit
op_assign
id|np-&gt;dirty_rx
op_plus
id|RX_RING_SIZE
op_minus
id|np-&gt;cur_rx
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; In netdev_rx(), entry %d status %4.4x.&bslash;n&quot;
comma
id|entry
comma
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* If EOP is set on the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
op_decrement
id|work_limit
op_ge
l_int|0
)paren
(brace
r_struct
id|w840_rx_desc
op_star
id|desc
op_assign
id|np-&gt;rx_head_desc
suffix:semicolon
id|s32
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|desc-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() status was %8.8x.&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x38008300
)paren
op_ne
l_int|0x0300
)paren
(brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x38000300
)paren
op_ne
l_int|0x0300
)paren
(brace
multiline_comment|/* Ingore earlier buffers. */
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0xffff
)paren
op_ne
l_int|0x7fff
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized Ethernet frame spanned &quot;
l_string|&quot;multiple buffers, entry %#x status %4.4x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_rx
comma
id|status
)paren
suffix:semicolon
id|np-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
l_int|0x8000
)paren
(brace
multiline_comment|/* There was a fatal error. */
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Receive error, Rx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* end of a packet.*/
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0890
)paren
id|np-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x004C
)paren
id|np-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0002
)paren
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* Omit the four octet CRC from the length. */
r_int
id|pkt_len
op_assign
(paren
(paren
id|status
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_minus
l_int|4
suffix:semicolon
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() normal Rx pkt length %d&quot;
l_string|&quot; status %x.&bslash;n&quot;
comma
id|pkt_len
comma
id|status
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Check if the packet is long enough to accept without copying&n;&t;&t;&t;   to a minimally-sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
id|pci_dma_sync_single
c_func
(paren
id|np-&gt;pdev
comma
id|np-&gt;rx_addr
(braket
id|entry
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* Call copy + cksum if available. */
macro_line|#if HAS_IP_COPYSUM
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pdev
comma
id|np-&gt;rx_addr
(braket
id|entry
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
comma
id|pkt_len
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifndef final_version&t;&t;&t;&t;/* Remove after testing. */
multiline_comment|/* You will want this info for the initial debug. */
r_if
c_cond
(paren
id|debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx data %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:&quot;
l_string|&quot;%2.2x %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x %2.2x%2.2x &quot;
l_string|&quot;%d.%d.%d.%d.&bslash;n&quot;
comma
id|skb-&gt;data
(braket
l_int|0
)braket
comma
id|skb-&gt;data
(braket
l_int|1
)braket
comma
id|skb-&gt;data
(braket
l_int|2
)braket
comma
id|skb-&gt;data
(braket
l_int|3
)braket
comma
id|skb-&gt;data
(braket
l_int|4
)braket
comma
id|skb-&gt;data
(braket
l_int|5
)braket
comma
id|skb-&gt;data
(braket
l_int|6
)braket
comma
id|skb-&gt;data
(braket
l_int|7
)braket
comma
id|skb-&gt;data
(braket
l_int|8
)braket
comma
id|skb-&gt;data
(braket
l_int|9
)braket
comma
id|skb-&gt;data
(braket
l_int|10
)braket
comma
id|skb-&gt;data
(braket
l_int|11
)braket
comma
id|skb-&gt;data
(braket
l_int|12
)braket
comma
id|skb-&gt;data
(braket
l_int|13
)braket
comma
id|skb-&gt;data
(braket
l_int|14
)braket
comma
id|skb-&gt;data
(braket
l_int|15
)braket
comma
id|skb-&gt;data
(braket
l_int|16
)braket
comma
id|skb-&gt;data
(braket
l_int|17
)braket
)paren
suffix:semicolon
macro_line|#endif
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
id|entry
op_assign
(paren
op_increment
id|np-&gt;cur_rx
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
id|np-&gt;rx_head_desc
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|entry
)braket
suffix:semicolon
)brace
multiline_comment|/* Refill the Rx ring buffers. */
r_for
c_loop
(paren
suffix:semicolon
id|np-&gt;cur_rx
op_minus
id|np-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|np-&gt;dirty_rx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|entry
op_assign
id|np-&gt;dirty_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
multiline_comment|/* Better luck next round. */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;rx_addr
(braket
id|entry
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pdev
comma
id|skb-&gt;tail
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_addr
(braket
id|entry
)braket
)paren
suffix:semicolon
)brace
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netdev_error
r_static
r_void
id|netdev_error
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|intr_status
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Abnormal event, %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_eq
l_int|0xffffffff
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
id|TxFIFOUnderflow
)paren
(brace
multiline_comment|/* Bump up the Tx threshold */
macro_line|#if 0
multiline_comment|/* This causes lots of dropped packets,&n;&t;&t; * and under high load even tx_timeouts&n;&t;&t; */
id|np-&gt;csr6
op_add_assign
l_int|0x4000
suffix:semicolon
macro_line|#else
r_int
id|cur
op_assign
(paren
id|np-&gt;csr6
op_rshift
l_int|14
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|cur
OL
l_int|64
)paren
id|cur
op_mul_assign
l_int|2
suffix:semicolon
r_else
id|cur
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* load full packet before starting */
id|np-&gt;csr6
op_and_assign
op_complement
(paren
l_int|0x7F
op_lshift
l_int|14
)paren
suffix:semicolon
id|np-&gt;csr6
op_or_assign
id|cur
op_lshift
l_int|14
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx underflow, increasing threshold to %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;csr6
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;csr6
comma
id|ioaddr
op_plus
id|NetworkConfig
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intr_status
op_amp
id|IntrRxDied
)paren
(brace
multiline_comment|/* Missed a Rx frame. */
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intr_status
op_amp
id|TimerInt
)paren
(brace
multiline_comment|/* Re-enable other interrupts. */
id|writel
c_func
(paren
l_int|0x1A0F5
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
)brace
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|RxMissed
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|RxStartDemand
)paren
suffix:semicolon
)brace
DECL|function|get_stats
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* The chip only need report frame silently dropped. */
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|RxMissed
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
id|u32
id|rx_mode
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptAllPhys
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to match, or accept all multicasts. */
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|set_bit
c_func
(paren
(paren
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
)paren
op_xor
l_int|0x3F
comma
id|mc_filter
)paren
suffix:semicolon
)brace
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
)brace
id|writel
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
id|MulticastFilter0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
id|MulticastFilter1
)paren
suffix:semicolon
id|np-&gt;csr6
op_and_assign
op_complement
l_int|0x00F8
suffix:semicolon
id|np-&gt;csr6
op_or_assign
id|rx_mode
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;csr6
comma
id|ioaddr
op_plus
id|NetworkConfig
)paren
suffix:semicolon
)brace
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
id|data
(braket
l_int|0
)braket
op_assign
(paren
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|netdev_close
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was %8.8x &quot;
l_string|&quot;Config %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|IntrStatus
)paren
comma
(paren
r_int
)paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|NetworkConfig
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Queue pointers were Tx %d / %d,  Rx %d / %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_tx
comma
id|np-&gt;dirty_tx
comma
id|np-&gt;cur_rx
comma
id|np-&gt;dirty_rx
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|writel
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|IntrEnable
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|writel
c_func
(paren
id|np-&gt;csr6
op_and_assign
op_complement
l_int|0x20FA
comma
id|ioaddr
op_plus
id|NetworkConfig
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|NetworkConfig
)paren
op_ne
l_int|0xffffffff
)paren
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|RxMissed
)paren
op_amp
l_int|0xffff
suffix:semicolon
macro_line|#ifdef __i386__
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring at %8.8x:&bslash;n&quot;
comma
(paren
r_int
)paren
id|np-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; #%d desc. %4.4x %4.4x %8.8x.&bslash;n&quot;
comma
id|i
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|length
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|buffer1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Rx ring %8.8x:&bslash;n&quot;
comma
(paren
r_int
)paren
id|np-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; #%d desc. %4.4x %4.4x %8.8x&bslash;n&quot;
comma
id|i
comma
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
comma
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
comma
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* __i386__ debugging only */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|free_rxtx_rings
c_func
(paren
id|np
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w840_remove1
r_static
r_void
id|__devexit
id|w840_remove1
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|pci_id_tbl
(braket
id|np-&gt;chip_id
)braket
dot
id|io_size
)paren
suffix:semicolon
macro_line|#else
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_id_tbl
(braket
id|np-&gt;chip_id
)braket
dot
id|io_size
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_char
op_star
)paren
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|pdev-&gt;driver_data
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|w840_driver
r_static
r_struct
id|pci_driver
id|w840_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;winbond-840&quot;
comma
id|id_table
suffix:colon
id|w840_pci_tbl
comma
id|probe
suffix:colon
id|w840_probe1
comma
id|remove
suffix:colon
id|w840_remove1
comma
)brace
suffix:semicolon
DECL|function|w840_init
r_static
r_int
id|__init
id|w840_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|w840_driver
)paren
suffix:semicolon
)brace
DECL|function|w840_exit
r_static
r_void
id|__exit
id|w840_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|w840_driver
)paren
suffix:semicolon
)brace
DECL|variable|w840_init
id|module_init
c_func
(paren
id|w840_init
)paren
suffix:semicolon
DECL|variable|w840_exit
id|module_exit
c_func
(paren
id|w840_exit
)paren
suffix:semicolon
eof
