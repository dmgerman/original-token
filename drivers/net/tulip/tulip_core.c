multiline_comment|/* tulip_core.c: A DEC 21040-family ethernet driver for Linux. */
multiline_comment|/*&n;&t;Maintained by Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n;&t;Copyright 2000  The Linux Kernel Team&n;&t;Written/copyright 1994-1999 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU Public License, incorporated herein by reference.&n;&n;&t;Please read Documentation/networking/tulip.txt for more&n;&t;information.&n;&n;&t;For this specific driver variant please use linux-kernel for&n;&t;bug reports.&n;&n;&t;Additional information available at&n;&t;http://cesdis.gsfc.nasa.gov/linux/drivers/tulip.html&n;&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;tulip.h&quot;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
l_string|&quot;Linux Tulip driver version 0.9.13 (January 2, 2001)&bslash;n&quot;
suffix:semicolon
multiline_comment|/* A few user-configurable values. */
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
r_int
id|max_interrupt_work
op_assign
l_int|25
suffix:semicolon
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
multiline_comment|/* Used to pass the full-duplex flag, etc. */
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|mtu
r_static
r_int
id|mtu
(braket
id|MAX_UNITS
)braket
suffix:semicolon
multiline_comment|/* Jumbo MTU for interfaces. */
multiline_comment|/*  The possible media types that can be set in options[] are: */
DECL|variable|medianame
r_const
r_char
op_star
r_const
id|medianame
(braket
)braket
op_assign
(brace
l_string|&quot;10baseT&quot;
comma
l_string|&quot;10base2&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;100baseTx&quot;
comma
l_string|&quot;10baseT-FD&quot;
comma
l_string|&quot;100baseTx-FD&quot;
comma
l_string|&quot;100baseT4&quot;
comma
l_string|&quot;100baseFx&quot;
comma
l_string|&quot;100baseFx-FD&quot;
comma
l_string|&quot;MII 10baseT&quot;
comma
l_string|&quot;MII 10baseT-FD&quot;
comma
l_string|&quot;MII&quot;
comma
l_string|&quot;10baseT(forced)&quot;
comma
l_string|&quot;MII 100baseTx&quot;
comma
l_string|&quot;MII 100baseTx-FD&quot;
comma
l_string|&quot;MII 100baseT4&quot;
comma
)brace
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-buffer Rx structure. */
macro_line|#if defined(__alpha__) || defined(__arm__) || defined(__hppa__) &bslash;&n;&t;|| defined(__sparc_) || defined(__ia64__)
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|1518
suffix:semicolon
macro_line|#else
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|100
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;  Set the bus performance register.&n;&t;Typical: Set 16 longword cache alignment, no burst limit.&n;&t;Cache alignment bits 15:14&t;     Burst length 13:8&n;&t;&t;0000&t;No alignment  0x00000000 unlimited&t;&t;0800 8 longwords&n;&t;&t;4000&t;8  longwords&t;&t;0100 1 longword&t;&t;1000 16 longwords&n;&t;&t;8000&t;16 longwords&t;&t;0200 2 longwords&t;2000 32 longwords&n;&t;&t;C000&t;32  longwords&t;&t;0400 4 longwords&n;&t;Warning: many older 486 systems are broken and require setting 0x00A04800&n;&t;   8 longword cache alignment, 8 longword burst.&n;&t;ToDo: Non-Intel setting could be better.&n;*/
macro_line|#if defined(__alpha__) || defined(__ia64__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0xE000
suffix:semicolon
macro_line|#elif defined(__i386__) || defined(__powerpc__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x8000
suffix:semicolon
macro_line|#elif defined(__sparc__) || defined(__hppa__)
multiline_comment|/* The UltraSparc PCI controllers will disconnect at every 64-byte&n; * crossing anyways so it makes no sense to tell Tulip to burst&n; * any more than that.&n; */
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x9000
suffix:semicolon
macro_line|#elif defined(__arm__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x4800
suffix:semicolon
macro_line|#else
macro_line|#warning Processor architecture undefined!
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x00A00000
op_or
l_int|0x4800
suffix:semicolon
macro_line|#endif
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (4*HZ)
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;The Linux Kernel Team&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Digital 21*4* Tulip ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tulip_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|csr0
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|TULIP_MODULE_NAME
mdefine_line|#define TULIP_MODULE_NAME &quot;tulip&quot;
DECL|macro|PFX
mdefine_line|#define PFX TULIP_MODULE_NAME &quot;: &quot;
macro_line|#ifdef TULIP_DEBUG
DECL|variable|tulip_debug
r_int
id|tulip_debug
op_assign
id|TULIP_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|tulip_debug
r_int
id|tulip_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * This table use during operation for capabilities and media timer.&n; *&n; * It is indexed via the values in &squot;enum chips&squot;&n; */
DECL|variable|tulip_tbl
r_struct
id|tulip_chip_table
id|tulip_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Digital DC21040 Tulip&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
l_int|0
comma
id|tulip_timer
)brace
comma
(brace
l_string|&quot;Digital DC21041 Tulip&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MEDIA_TABLE
op_or
id|HAS_NWAY
comma
id|tulip_timer
)brace
comma
(brace
l_string|&quot;Digital DS21140 Tulip&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
comma
id|tulip_timer
)brace
comma
(brace
l_string|&quot;Digital DS21143 Tulip&quot;
comma
l_int|128
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|ALWAYS_CHECK_MII
op_or
id|HAS_ACPI
op_or
id|HAS_NWAY
op_or
id|HAS_INTR_MITIGATION
comma
id|t21142_timer
)brace
comma
(brace
l_string|&quot;Lite-On 82c168 PNIC&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_PNICNWAY
comma
id|pnic_timer
)brace
comma
(brace
l_string|&quot;Macronix 98713 PMAC&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
comma
id|mxic_timer
)brace
comma
(brace
l_string|&quot;Macronix 98715 PMAC&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MEDIA_TABLE
comma
id|mxic_timer
)brace
comma
(brace
l_string|&quot;Macronix 98725 PMAC&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MEDIA_TABLE
comma
id|mxic_timer
)brace
comma
(brace
l_string|&quot;ASIX AX88140&quot;
comma
l_int|128
comma
l_int|0x0001fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
op_or
id|MC_HASH_ONLY
op_or
id|IS_ASIX
comma
id|tulip_timer
)brace
comma
(brace
l_string|&quot;Lite-On PNIC-II&quot;
comma
l_int|256
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_NWAY
op_or
id|HAS_8023X
comma
id|t21142_timer
)brace
comma
(brace
l_string|&quot;ADMtek Comet&quot;
comma
l_int|256
comma
l_int|0x0001abef
comma
id|MC_HASH_ONLY
comma
id|comet_timer
)brace
comma
(brace
l_string|&quot;Compex 9881 PMAC&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
comma
id|mxic_timer
)brace
comma
(brace
l_string|&quot;Intel DS21145 Tulip&quot;
comma
l_int|128
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|ALWAYS_CHECK_MII
op_or
id|HAS_ACPI
op_or
id|HAS_NWAY
comma
id|t21142_timer
)brace
comma
(brace
l_string|&quot;Davicom DM9102/DM9102A&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
op_or
id|HAS_ACPI
comma
id|tulip_timer
)brace
comma
(brace
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|tulip_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1011
comma
l_int|0x0002
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21040
)brace
comma
(brace
l_int|0x1011
comma
l_int|0x0014
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21041
)brace
comma
(brace
l_int|0x1011
comma
l_int|0x0009
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21140
)brace
comma
(brace
l_int|0x1011
comma
l_int|0x0019
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21143
)brace
comma
(brace
l_int|0x11AD
comma
l_int|0x0002
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|LC82C168
)brace
comma
(brace
l_int|0x10d9
comma
l_int|0x0512
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98713
)brace
comma
(brace
l_int|0x10d9
comma
l_int|0x0531
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98715
)brace
comma
multiline_comment|/*&t;{ 0x10d9, 0x0531, PCI_ANY_ID, PCI_ANY_ID, 0, 0, MX98725 },*/
(brace
l_int|0x125B
comma
l_int|0x1400
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|AX88140
)brace
comma
(brace
l_int|0x11AD
comma
l_int|0xc115
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|PNIC2
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x0981
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x0985
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x1985
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x13D1
comma
l_int|0xAB02
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x13D1
comma
l_int|0xAB03
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x104A
comma
l_int|0x0981
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x104A
comma
l_int|0x2774
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x11F6
comma
l_int|0x9881
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMPEX9881
)brace
comma
(brace
l_int|0x8086
comma
l_int|0x0039
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|I21145
)brace
comma
(brace
l_int|0x1282
comma
l_int|0x9100
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DM910X
)brace
comma
(brace
l_int|0x1282
comma
l_int|0x9102
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DM910X
)brace
comma
(brace
l_int|0x1113
comma
l_int|0x1217
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98715
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|tulip_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* A full-duplex map for media types. */
DECL|variable|tulip_media_cap
r_const
r_char
id|tulip_media_cap
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|3
comma
l_int|19
comma
l_int|16
comma
l_int|24
comma
l_int|27
comma
l_int|4
comma
l_int|7
comma
l_int|5
comma
l_int|0
comma
l_int|20
comma
l_int|23
comma
l_int|20
)brace
suffix:semicolon
DECL|variable|t21040_csr13
id|u8
id|t21040_csr13
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|0x0C
comma
l_int|8
comma
l_int|4
comma
l_int|4
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|4
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 21041 transceiver register settings: 10-T, 10-2, AUI, 10-T, 10T-FD*/
DECL|variable|t21041_csr13
id|u16
id|t21041_csr13
(braket
)braket
op_assign
(brace
id|csr13_mask_10bt
comma
multiline_comment|/* 10-T */
id|csr13_mask_auibnc
comma
multiline_comment|/* 10-2 */
id|csr13_mask_auibnc
comma
multiline_comment|/* AUI */
id|csr13_mask_10bt
comma
multiline_comment|/* 10-T */
id|csr13_mask_10bt
comma
multiline_comment|/* 10T-FD */
)brace
suffix:semicolon
DECL|variable|t21041_csr14
id|u16
id|t21041_csr14
(braket
)braket
op_assign
(brace
l_int|0xFFFF
comma
l_int|0xF7FD
comma
l_int|0xF7FD
comma
l_int|0x7F3F
comma
l_int|0x7F3D
comma
)brace
suffix:semicolon
DECL|variable|t21041_csr15
id|u16
id|t21041_csr15
(braket
)braket
op_assign
(brace
l_int|0x0008
comma
l_int|0x0006
comma
l_int|0x000E
comma
l_int|0x0008
comma
l_int|0x0008
comma
)brace
suffix:semicolon
r_static
r_void
id|tulip_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|private_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|tulip_up
r_static
r_void
id|tulip_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|3
op_star
id|HZ
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Wake the chip from sleep/snooze mode. */
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_ACPI
)paren
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
l_int|0x40
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* On some chip revs we must set the MII/SYM port before the reset!? */
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
op_logical_or
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
)paren
id|tulip_outl_csr
(paren
id|tp
comma
l_int|0x00040000
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Reset the chip, holding bit 0 set at least 50 PCI cycles. */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Deassert reset.&n;&t;   Wait the specified 50 PCI cycles after a reset by initializing&n;&t;   Tx and Rx queues and the address filter list. */
id|outl
c_func
(paren
id|tp-&gt;csr0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tulip_up(), irq==%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|MC_HASH_ONLY
)paren
(brace
id|u32
id|addr_low
op_assign
id|cpu_to_le32
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|u32
op_star
)paren
id|dev-&gt;dev_addr
)paren
)paren
suffix:semicolon
id|u32
id|addr_high
op_assign
id|cpu_to_le32
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|AX88140
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_low
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|1
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_high
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
)paren
(brace
id|outl
c_func
(paren
id|addr_low
comma
id|ioaddr
op_plus
l_int|0xA4
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_high
comma
id|ioaddr
op_plus
l_int|0xA8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
l_int|0xAC
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
l_int|0xB0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* This is set_rx_mode(), but without starting the transmitter. */
id|u16
op_star
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
id|u16
op_star
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|15
op_star
l_int|6
)braket
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
multiline_comment|/* 21140 bug: you must add the broadcast address. */
id|memset
c_func
(paren
id|tp-&gt;setup_frame
comma
l_int|0xff
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
)paren
suffix:semicolon
multiline_comment|/* Fill the final entry of the table with our physical address. */
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;setup_frame
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
l_int|0
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
l_int|0
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x08000000
op_or
l_int|192
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
)brace
id|outl
c_func
(paren
id|tp-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|CSR3
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tp-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|CSR4
)paren
suffix:semicolon
id|tp-&gt;saved_if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|tp-&gt;default_port
suffix:semicolon
multiline_comment|/* Allow selecting a default media. */
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mtable
op_eq
l_int|NULL
)paren
r_goto
id|media_picked
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_int
id|looking_for
op_assign
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
ques
c_cond
l_int|11
suffix:colon
(paren
id|dev-&gt;if_port
op_eq
l_int|12
ques
c_cond
l_int|0
suffix:colon
id|dev-&gt;if_port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
id|looking_for
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using user-specified media %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|dev-&gt;if_port
)braket
)paren
suffix:semicolon
r_goto
id|media_picked
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;mtable-&gt;defaultmedia
op_amp
l_int|0x0800
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|looking_for
op_assign
id|tp-&gt;mtable-&gt;defaultmedia
op_amp
l_int|15
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
id|looking_for
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using EEPROM-set media %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|looking_for
)braket
)paren
suffix:semicolon
r_goto
id|media_picked
suffix:semicolon
)brace
)brace
multiline_comment|/* Start sensing first non-full-duplex media. */
r_for
c_loop
(paren
id|i
op_assign
id|tp-&gt;mtable-&gt;leafcount
op_minus
l_int|1
suffix:semicolon
(paren
id|tulip_media_cap
(braket
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
)braket
op_amp
id|MediaAlwaysFD
)paren
op_logical_and
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
id|media_picked
suffix:colon
id|tp-&gt;csr6
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_index
op_assign
id|i
suffix:semicolon
id|tp-&gt;nwayset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
op_logical_and
id|tp-&gt;chip_id
op_eq
id|DC21041
)paren
id|tp-&gt;nway
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
op_logical_and
id|tp-&gt;chip_id
op_eq
id|DC21142
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
(brace
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using MII transceiver %d, status &quot;
l_string|&quot;%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|csr6_mask_defstate
comma
id|CSR6
)paren
suffix:semicolon
id|tp-&gt;csr6
op_assign
id|csr6_mask_hdcap
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|11
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
id|t21142_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|PNIC2
)paren
(brace
id|t21142_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|LC82C168
op_logical_and
op_logical_neg
id|tp-&gt;medialock
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|11
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x814C0000
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0x0200
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0001
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
op_amp
id|TPLnkPass
)paren
id|pnic_do_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Start with 10mbps to do autonegotiation. */
id|outl
c_func
(paren
l_int|0x32
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x00420000
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0001B078
comma
id|ioaddr
op_plus
l_int|0xB8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0201B078
comma
id|ioaddr
op_plus
l_int|0xB8
)paren
suffix:semicolon
id|next_tick
op_assign
l_int|1
op_star
id|HZ
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|tp-&gt;chip_id
op_eq
id|MX98713
op_logical_or
id|tp-&gt;chip_id
op_eq
id|COMPEX9881
)paren
op_logical_and
op_logical_neg
id|tp-&gt;medialock
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x01880000
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0x0200
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0f370000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0x80
)paren
comma
id|ioaddr
op_plus
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|MX98715
op_logical_or
id|tp-&gt;chip_id
op_eq
id|MX98725
)paren
(brace
multiline_comment|/* Provided by BOLO, Macronix - 12/10/1998. */
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x01a80200
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0f370000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0x80
)paren
comma
id|ioaddr
op_plus
l_int|0x80
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x11000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0xa0
)paren
comma
id|ioaddr
op_plus
l_int|0xa0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21143
op_logical_and
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
multiline_comment|/* We must reset the media CSRs when we force-select MII mode. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x00040000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|AX88140
)paren
(brace
id|tp-&gt;csr6
op_assign
id|tp-&gt;mii_cnt
ques
c_cond
l_int|0x00040100
suffix:colon
l_int|0x00000100
suffix:semicolon
)brace
r_else
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Tx to process setup frame. */
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|tp-&gt;csr6
comma
id|CSR6
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|tp-&gt;csr6
op_or
id|csr6_st
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|tp-&gt;csr6
op_or
id|csr6_st
op_or
id|csr6_sr
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR2
)paren
suffix:semicolon
multiline_comment|/* Rx poll demand */
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done tulip_open(), CSR0 %8.8x, CSR5 %8.8x CSR6 %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR0
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the timer to switch to check for link beat and perhaps switch&n;&t;   to an alternate media type. */
id|init_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|next_tick
)paren
suffix:semicolon
id|tp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|tp-&gt;timer.function
op_assign
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|media_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_open
id|tulip_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|retval
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|tulip_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|tulip_init_ring
(paren
id|dev
)paren
suffix:semicolon
id|tulip_up
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_tx_timeout
r_static
r_void
id|tulip_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
multiline_comment|/* Do nothing -- the media monitor should handle this. */
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timeout using MII device.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21040
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;medialock
op_logical_and
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
op_amp
l_int|0x0002
)paren
(brace
id|dev-&gt;if_port
op_assign
(paren
id|dev-&gt;if_port
op_eq
l_int|2
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: 21040 transmit timed out, switching to &quot;
l_string|&quot;%s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|dev-&gt;if_port
)braket
)paren
suffix:semicolon
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21041
)paren
(brace
r_int
id|csr12
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: 21041 transmit timed out, status %8.8x, &quot;
l_string|&quot;CSR12 %8.8x, CSR13 %8.8x, CSR14 %8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|csr12
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR13
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR14
)paren
)paren
suffix:semicolon
id|tp-&gt;mediasense
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;medialock
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|1
op_logical_or
id|dev-&gt;if_port
op_eq
l_int|2
)paren
r_if
c_cond
(paren
id|csr12
op_amp
l_int|0x0004
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|2
op_minus
id|dev-&gt;if_port
suffix:semicolon
)brace
r_else
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
r_else
id|dev-&gt;if_port
op_assign
l_int|1
suffix:semicolon
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21140
op_logical_or
id|tp-&gt;chip_id
op_eq
id|DC21142
op_logical_or
id|tp-&gt;chip_id
op_eq
id|MX98713
op_logical_or
id|tp-&gt;chip_id
op_eq
id|COMPEX9881
op_logical_or
id|tp-&gt;chip_id
op_eq
id|DM910X
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: 21140 transmit timed out, status %8.8x, &quot;
l_string|&quot;SIA %8.8x %8.8x %8.8x %8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR13
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR14
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR15
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;medialock
op_logical_and
id|tp-&gt;mtable
)paren
(brace
r_do
op_decrement
id|tp-&gt;cur_index
suffix:semicolon
r_while
c_loop
(paren
id|tp-&gt;cur_index
op_ge
l_int|0
op_logical_and
(paren
id|tulip_media_cap
(braket
id|tp-&gt;mtable-&gt;mleaf
(braket
id|tp-&gt;cur_index
)braket
dot
id|media
)braket
op_amp
id|MediaIsFD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|tp-&gt;cur_index
OL
l_int|0
)paren
(brace
multiline_comment|/* We start again, but should instead look for default. */
id|tp-&gt;cur_index
op_assign
id|tp-&gt;mtable-&gt;leafcount
op_minus
l_int|1
suffix:semicolon
)brace
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: transmit timed out, switching to %s &quot;
l_string|&quot;media.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|dev-&gt;if_port
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timed out, status %8.8x, CSR12 &quot;
l_string|&quot;%8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if defined(way_too_many_messages)
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|3
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
op_star
id|buf
op_assign
(paren
id|u8
op_star
)paren
(paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
)paren
suffix:semicolon
r_int
id|j
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%2d: %8.8x %8.8x %8.8x %8.8x  &quot;
l_string|&quot;%2.2x %2.2x %2.2x.&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
comma
id|buf
(braket
l_int|0
)braket
comma
id|buf
(braket
l_int|1
)braket
comma
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|buf
(braket
id|j
)braket
op_ne
l_int|0xee
op_logical_and
id|j
OL
l_int|1600
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|j
OL
l_int|100
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|buf
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; j=%d.&bslash;n&quot;
comma
id|j
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Stop and restart the chip&squot;s Tx processes . */
id|tulip_restart_rxtx
c_func
(paren
id|tp
comma
id|tp-&gt;csr6
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|out
suffix:colon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|tulip_init_ring
r_static
r_void
id|tulip_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_rx
op_assign
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;susp_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;ttimer
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;nir
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0x00000000
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
op_or
id|DESC_RING_WRAP
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dma_addr_t
id|mapping
suffix:semicolon
multiline_comment|/* Note the receive buffer must be longword aligned.&n;&t;&t;   dev_alloc_skb() provides 16 byte alignment.  But do *not*&n;&t;&t;   use skb_reserve() to align the IP header! */
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
multiline_comment|/* Owned by Tulip chip */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
)brace
id|tp-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* The Tx buffer descriptor is filled in as needed, but we&n;&t;   do need to clear the ownership bit. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0x00000000
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_ring_dma
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_start_xmit
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|u32
id|flag
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
multiline_comment|/* Typical path */
id|flag
op_assign
l_int|0x60000000
suffix:semicolon
multiline_comment|/* No interrupt */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_eq
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
id|flag
op_assign
l_int|0xe0000000
suffix:semicolon
multiline_comment|/* Tx-done intr. */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
id|flag
op_assign
l_int|0x60000000
suffix:semicolon
multiline_comment|/* No Tx-done intr. */
)brace
r_else
(brace
multiline_comment|/* Leave room for set_rx_mode() to fill entries. */
id|flag
op_assign
l_int|0xe0000000
suffix:semicolon
multiline_comment|/* Tx-done intr. */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|flag
op_assign
l_int|0xe0000000
op_or
id|DESC_RING_WRAP
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
id|flag
)paren
suffix:semicolon
multiline_comment|/* if we were using Transmit Automatic Polling, we would need a&n;&t; * wmb() here. */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_down
r_static
r_void
id|tulip_down
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|del_timer_sync
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
multiline_comment|/* Stop the Tx and Rx processes. */
id|tulip_stop_rxtx
c_func
(paren
id|tp
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
)paren
suffix:semicolon
multiline_comment|/* 21040 -- Leave the card in 10baseT state. */
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21040
)paren
id|outl
(paren
l_int|0x00000004
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_ne
l_int|0xffffffff
)paren
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;saved_if_port
suffix:semicolon
multiline_comment|/* Leave the driver in snooze, not sleep, mode. */
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_ACPI
)paren
id|pci_write_config_dword
(paren
id|tp-&gt;pdev
comma
l_int|0x40
comma
l_int|0x40000000
)paren
suffix:semicolon
)brace
DECL|function|tulip_close
r_static
r_int
id|tulip_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
id|tulip_down
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
(paren
id|ioaddr
op_plus
id|CSR5
)paren
)paren
suffix:semicolon
id|free_irq
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
id|dma_addr_t
id|mapping
op_assign
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not owned by Tulip chip. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
l_int|0xBADF00D0
suffix:semicolon
multiline_comment|/* An invalid address. */
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|mapping
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Provide ioctl() calls to examine the MII xcvr state. */
DECL|function|private_ioctl
r_static
r_int
id|private_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_int
id|phy
op_assign
id|tp-&gt;phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
id|data
(braket
l_int|0
)braket
op_assign
id|phy
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
id|data
(braket
l_int|0
)braket
op_assign
l_int|32
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
)paren
id|data
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|32
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
)paren
(brace
r_int
id|csr12
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_int
id|csr14
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|data
(braket
l_int|1
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
(brace
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|csr14
op_lshift
l_int|5
)paren
op_amp
l_int|0x1000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x7848
op_plus
(paren
(paren
id|csr12
op_amp
l_int|0x7000
)paren
op_eq
l_int|0x5000
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
id|csr12
op_amp
l_int|0x06
ques
c_cond
l_int|0x04
suffix:colon
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
(brace
id|data
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|csr14
op_rshift
l_int|9
)paren
op_amp
l_int|0x07C0
)paren
op_plus
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_rshift
l_int|3
)paren
op_amp
l_int|0x0040
)paren
op_plus
(paren
(paren
id|csr14
op_rshift
l_int|1
)paren
op_amp
l_int|0x20
)paren
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
id|data
(braket
l_int|3
)braket
op_assign
id|csr12
op_rshift
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|32
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
)paren
(brace
r_if
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_eq
l_int|5
)paren
id|tp-&gt;to_advertise
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tulip_mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   Note that we only use exclusion around actually queueing the&n;   new frame, not around filling tp-&gt;setup_frame.  This is non-deterministic&n;   when re-entered but still correct. */
multiline_comment|/* The little-endian AUTODIN32 ethernet CRC calculation.&n;   N.B. Do not use for bulk data, use a table-based routine instead.&n;   This is common code and should be moved to net/core/crc.c */
DECL|variable|ethernet_polynomial_le
r_static
r_int
r_const
id|ethernet_polynomial_le
op_assign
l_int|0xedb88320U
suffix:semicolon
DECL|function|ether_crc_le
r_static
r_inline
id|u32
id|ether_crc_le
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
id|u32
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Initial value. */
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|8
suffix:semicolon
op_decrement
id|bit
op_ge
l_int|0
suffix:semicolon
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|current_octet
)paren
op_amp
l_int|1
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|ethernet_polynomial_le
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|macro|set_bit_le
macro_line|#undef set_bit_le
DECL|macro|set_bit_le
mdefine_line|#define set_bit_le(i,p) do { ((char *)(p))[(i)/8] |= (1&lt;&lt;((i)%8)); } while(0)
DECL|function|build_setup_frame_hash
r_static
r_void
id|build_setup_frame_hash
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|hash_table
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
id|memset
c_func
(paren
id|hash_table
comma
l_int|0
comma
r_sizeof
(paren
id|hash_table
)paren
)paren
suffix:semicolon
id|set_bit_le
c_func
(paren
l_int|255
comma
id|hash_table
)paren
suffix:semicolon
multiline_comment|/* Broadcast entry */
multiline_comment|/* This should work on big-endian machines as well. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|index
op_assign
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_amp
l_int|0x1ff
suffix:semicolon
id|set_bit_le
c_func
(paren
id|index
comma
id|hash_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
)brace
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|13
op_star
l_int|6
)braket
suffix:semicolon
)brace
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|build_setup_frame_perfect
r_static
r_void
id|build_setup_frame_perfect
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
multiline_comment|/* We have &lt;= 14 addresses so we can use the wonderful&n;&t;   16 address perfect filtering of the Tulip. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|mclist-&gt;dmi_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
)brace
multiline_comment|/* Fill the unused entries with the broadcast address. */
id|memset
c_func
(paren
id|setup_frm
comma
l_int|0xff
comma
(paren
l_int|15
op_minus
id|i
)paren
op_star
l_int|12
)paren
suffix:semicolon
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|15
op_star
l_int|6
)braket
suffix:semicolon
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|csr6
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|csr6
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_amp
op_complement
l_int|0x00D5
suffix:semicolon
id|tp-&gt;csr6
op_and_assign
op_complement
l_int|0x00D5
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|tp-&gt;csr6
op_or_assign
l_int|0x00C0
suffix:semicolon
id|csr6
op_or_assign
l_int|0x00C0
suffix:semicolon
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
l_int|1000
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter well -- accept all multicasts. */
id|tp-&gt;csr6
op_or_assign
l_int|0x0080
suffix:semicolon
id|csr6
op_or_assign
l_int|0x0080
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|MC_HASH_ONLY
)paren
(brace
multiline_comment|/* Some work-alikes have only a 64-entry hash filter table. */
multiline_comment|/* Should verify correctness on big-endian/__powerpc__ */
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|64
)paren
(brace
multiline_comment|/* Arbitrary non-effective limit. */
id|tp-&gt;csr6
op_or_assign
l_int|0x0080
suffix:semicolon
id|csr6
op_or_assign
l_int|0x0080
suffix:semicolon
)brace
r_else
(brace
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
id|set_bit
c_func
(paren
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
comma
id|mc_filter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|AX88140
)paren
(brace
id|outl
c_func
(paren
l_int|2
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|3
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
)paren
(brace
multiline_comment|/* Has a simple hash filter. */
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
l_int|0xAC
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
l_int|0xB0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Note that only the low-address shortword of setup_frame is valid!&n;&t;&t;   The values are doubled for big-endian architectures. */
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|14
)paren
(brace
multiline_comment|/* Must use a multicast hash table. */
id|build_setup_frame_hash
c_func
(paren
id|tp-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|build_setup_frame_perfect
c_func
(paren
id|tp-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OG
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
multiline_comment|/* Same setup recently queued, we need not add it. */
)brace
r_else
(brace
id|u32
id|tx_flags
op_assign
l_int|0x08000000
op_or
l_int|192
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
id|dummy
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Now add this frame to the Tx list. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Avoid a chip errata by prefixing a dummy entry. */
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
ques
c_cond
id|cpu_to_le32
c_func
(paren
id|DESC_RING_WRAP
)paren
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Must set DescOwned later to avoid race with chip */
id|dummy
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
)brace
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;setup_frame
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|tx_flags
op_or_assign
id|DESC_RING_WRAP
suffix:semicolon
multiline_comment|/* Wrap ring. */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|tx_flags
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy
op_ge
l_int|0
)paren
id|tp-&gt;tx_ring
(braket
id|dummy
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_ge
id|TX_RING_SIZE
op_minus
l_int|2
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Can someone explain to me what the OR here is supposed to accomplish???? */
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|csr6
op_or
l_int|0x0000
comma
id|CSR6
)paren
suffix:semicolon
)brace
DECL|function|tulip_init_one
r_static
r_int
id|__devinit
id|tulip_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|did_version
suffix:semicolon
multiline_comment|/* Already printed version info. */
r_struct
id|tulip_private
op_star
id|tp
suffix:semicolon
multiline_comment|/* See note below on the multiport cards. */
r_static
r_int
r_char
id|last_phys_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x00
comma
l_char|&squot;L&squot;
comma
l_char|&squot;i&squot;
comma
l_char|&squot;n&squot;
comma
l_char|&squot;u&squot;
comma
l_char|&squot;x&squot;
)brace
suffix:semicolon
r_static
r_int
id|last_irq
suffix:semicolon
r_static
r_int
id|multiport_cnt
suffix:semicolon
multiline_comment|/* For four-port boards w/one EEPROM */
id|u8
id|chip_rev
suffix:semicolon
r_int
id|i
comma
id|irq
suffix:semicolon
r_int
r_int
id|sum
suffix:semicolon
id|u8
id|ee_data
(braket
id|EEPROM_SIZE
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|chip_idx
op_assign
id|ent-&gt;driver_data
suffix:semicolon
id|board_idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|0
op_logical_and
id|did_version
op_increment
op_eq
l_int|0
)paren
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Lan media wire a tulip chip to a wan interface. Needs a very&n;&t; *&t;different driver (lmc driver)&n;&t; */
r_if
c_cond
(paren
id|pdev-&gt;subsystem_vendor
op_eq
l_int|0x1376
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;skipping LMC card.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Early DM9100&squot;s need software CRC and the DMFE driver&n;&t; */
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
l_int|0x1282
op_logical_and
id|pdev-&gt;device
op_eq
l_int|0x9100
)paren
(brace
id|u32
id|dev_rev
suffix:semicolon
multiline_comment|/* Read Chip revision */
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|dev_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_rev
OL
l_int|0x02000030
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;skipping early DM9100 with Crc bug (use dmfe)&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;Looks for early PCI chipsets where people report hangs &n;&t; *&t;without the workarounds being on.&n;&t; */
multiline_comment|/* Intel Saturn. Switch to 8 long words burst, 8 long word cache aligned &n;&t;   Aries might need this too. The Saturn errata are not pretty reading but&n;&t;   thankfully its an old 486 chipset.&n;&t;*/
r_if
c_cond
(paren
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
l_int|0x0483
comma
l_int|NULL
)paren
)paren
id|csr0
op_assign
l_int|0x00A04800
suffix:semicolon
multiline_comment|/* The dreaded SiS496 486 chipset. Same workaround as above. */
r_if
c_cond
(paren
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
l_int|0x0496
comma
l_int|NULL
)paren
)paren
id|csr0
op_assign
l_int|0x00A04800
suffix:semicolon
multiline_comment|/*&n;&t; *&t;And back to business&n;&t; */
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
multiline_comment|/* init_etherdev ensures aligned and zeroed private structures */
id|dev
op_assign
id|init_etherdev
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;ether device alloc failed, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
OL
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: I/O region (0x%lx@0x%lx) too small, &quot;
l_string|&quot;aborting&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
multiline_comment|/* grab all resources from both PIO and MMIO regions, as we&n;&t; * don&squot;t want anyone else messing around with our hardware */
r_if
c_cond
(paren
op_logical_neg
id|request_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: I/O region (0x%lx@0x%lx) unavailable, &quot;
l_string|&quot;aborting&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: MMIO region (0x%lx@0x%lx) unavailable, &quot;
l_string|&quot;aborting&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
r_goto
id|err_out_free_pio_res
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Cannot enable PCI device, aborting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|err_out_free_mmio_res
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_read_config_byte
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|chip_rev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * initialize priviate data structure &squot;tp&squot;&n;&t; * it is zeroed and aligned in init_etherdev&n;&t; */
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
op_amp
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_ring
)paren
r_goto
id|err_out_free_mmio_res
suffix:semicolon
id|tp-&gt;tx_ring
op_assign
(paren
r_struct
id|tulip_tx_desc
op_star
)paren
(paren
id|tp-&gt;rx_ring
op_plus
id|RX_RING_SIZE
)paren
suffix:semicolon
id|tp-&gt;tx_ring_dma
op_assign
id|tp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
suffix:semicolon
id|tp-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
id|tp-&gt;flags
op_assign
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|flags
suffix:semicolon
id|tp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|tp-&gt;revision
op_assign
id|chip_rev
suffix:semicolon
id|tp-&gt;csr0
op_assign
id|csr0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
macro_line|#ifdef TULIP_FULL_DUPLEX
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;full_duplex_lock
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
macro_line|#ifdef TULIP_DEFAULT_MEDIA
id|tp-&gt;default_port
op_assign
id|TULIP_DEFAULT_MEDIA
suffix:semicolon
macro_line|#endif
macro_line|#ifdef TULIP_NO_MEDIA_SWITCH
id|tp-&gt;medialock
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s rev %d at %#3lx,&quot;
comma
id|dev-&gt;name
comma
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|chip_name
comma
id|chip_rev
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* bugfix: the ASIX must have a burst limit or horrible things happen. */
r_if
c_cond
(paren
id|chip_idx
op_eq
id|AX88140
)paren
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;csr0
op_amp
l_int|0x3f00
)paren
op_eq
l_int|0
)paren
id|tp-&gt;csr0
op_or_assign
l_int|0x2000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chip_idx
op_eq
id|DC21143
op_logical_and
id|chip_rev
op_eq
l_int|65
)paren
id|tp-&gt;csr0
op_and_assign
op_complement
l_int|0x01000000
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|tulip_stop_rxtx
c_func
(paren
id|tp
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear the missed-packet counter. */
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip_idx
op_eq
id|DC21041
)paren
(brace
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0x8000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; 21040 compatible mode,&quot;
)paren
suffix:semicolon
id|chip_idx
op_assign
id|DC21040
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot; 21041 mode,&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The station address ROM is read byte serially.  The register must&n;&t;   be polled, waiting for the value to be read bit serially from the&n;&t;   EEPROM.&n;&t;   */
id|sum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chip_idx
op_eq
id|DC21040
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR9
)paren
suffix:semicolon
multiline_comment|/* Reset the pointer with a dummy write. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|value
comma
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
r_do
id|value
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
suffix:semicolon
r_while
c_loop
(paren
id|value
template_param
l_int|0
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|value
suffix:semicolon
id|sum
op_add_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|chip_idx
op_eq
id|LC82C168
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|value
comma
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
id|outl
c_func
(paren
l_int|0x600
op_or
id|i
comma
id|ioaddr
op_plus
l_int|0x98
)paren
suffix:semicolon
r_do
id|value
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
suffix:semicolon
r_while
c_loop
(paren
id|value
template_param
l_int|0
)paren
suffix:semicolon
id|put_unaligned
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|value
)paren
comma
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
op_plus
id|i
)paren
suffix:semicolon
id|sum
op_add_assign
id|value
op_amp
l_int|0xffff
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|chip_idx
op_eq
id|COMET
)paren
(brace
multiline_comment|/* No need to read the EEPROM. */
id|put_unaligned
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
l_int|0xA4
)paren
comma
(paren
id|u32
op_star
)paren
id|dev-&gt;dev_addr
)paren
suffix:semicolon
id|put_unaligned
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
l_int|0xA8
)paren
comma
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|sum
op_add_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* A serial EEPROM interface, we read now and sort it out later. */
r_int
id|sa_offset
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr_size
op_assign
id|tulip_read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|0xff
comma
l_int|8
)paren
op_amp
l_int|0x40000
ques
c_cond
l_int|8
suffix:colon
l_int|6
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|ee_data
)paren
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|ee_data
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
c_func
(paren
id|tulip_read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
comma
id|ee_addr_size
)paren
)paren
suffix:semicolon
multiline_comment|/* DEC now has a specification (see Notes) but early board makers&n;&t;&t;   just put the address in the first EEPROM locations. */
multiline_comment|/* This does  memcmp(eedata, eedata+16, 8) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ee_data
(braket
id|i
)braket
op_ne
id|ee_data
(braket
l_int|16
op_plus
id|i
)braket
)paren
id|sa_offset
op_assign
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|ee_data
(braket
l_int|0
)braket
op_eq
l_int|0xff
op_logical_and
id|ee_data
(braket
l_int|1
)braket
op_eq
l_int|0xff
op_logical_and
id|ee_data
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
(brace
id|sa_offset
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Grrr, damn Matrox boards. */
id|multiport_cnt
op_assign
l_int|4
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|ee_data
(braket
id|i
op_plus
id|sa_offset
)braket
suffix:semicolon
id|sum
op_add_assign
id|ee_data
(braket
id|i
op_plus
id|sa_offset
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Lite-On boards have the address byte-swapped. */
r_if
c_cond
(paren
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0xA0
op_logical_or
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0xC0
)paren
op_logical_and
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_eq
l_int|0x00
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_char
id|tmp
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* On the Zynx 315 Etherarray and other multiport boards only the&n;&t;   first Tulip has an EEPROM.&n;&t;   The addresses of the subsequent ports are derived from the first.&n;&t;   Many PCI BIOSes also incorrectly report the IRQ line, so we correct&n;&t;   that here as well. */
r_if
c_cond
(paren
id|sum
op_eq
l_int|0
op_logical_or
id|sum
op_eq
l_int|6
op_star
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; EEPROM not present,&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
op_plus
l_int|1
suffix:semicolon
macro_line|#if defined(__i386__)&t;&t;/* Patch up x86 BIOS bug. */
r_if
c_cond
(paren
id|last_irq
)paren
id|irq
op_assign
id|last_irq
suffix:semicolon
macro_line|#endif
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%c%2.2X&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|last_phys_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|last_irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|board_idx
op_ge
l_int|0
op_logical_and
id|board_idx
OL
id|MAX_UNITS
)paren
(brace
id|tp-&gt;default_port
op_assign
id|options
(braket
id|board_idx
)braket
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
(paren
id|options
(braket
id|board_idx
)braket
op_amp
l_int|0x90
)paren
op_logical_or
id|full_duplex
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mtu
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|dev-&gt;mtu
op_assign
id|mtu
(braket
id|board_idx
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
id|tp-&gt;default_port
op_assign
id|dev-&gt;mem_start
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;default_port
)paren
(brace
id|tp-&gt;medialock
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaAlwaysFD
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;full_duplex
)paren
id|tp-&gt;full_duplex_lock
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
id|u16
id|media2advert
(braket
)braket
op_assign
(brace
l_int|0x20
comma
l_int|0x40
comma
l_int|0x03e0
comma
l_int|0x60
comma
l_int|0x80
comma
l_int|0x100
comma
l_int|0x200
)brace
suffix:semicolon
id|tp-&gt;to_advertise
op_assign
id|media2advert
(braket
id|tp-&gt;default_port
op_minus
l_int|9
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_8023X
)paren
id|tp-&gt;to_advertise
op_assign
l_int|0x05e1
suffix:semicolon
r_else
id|tp-&gt;to_advertise
op_assign
l_int|0x01e1
suffix:semicolon
multiline_comment|/* This is logically part of _init_one(), but too complex to write inline. */
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_MEDIA_TABLE
)paren
(brace
id|memcpy
c_func
(paren
id|tp-&gt;eeprom
comma
id|ee_data
comma
r_sizeof
(paren
id|tp-&gt;eeprom
)paren
)paren
suffix:semicolon
id|tulip_parse_eeprom
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;flags
op_amp
id|ALWAYS_CHECK_MII
)paren
op_logical_or
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
op_logical_or
(paren
op_logical_neg
id|tp-&gt;mtable
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_MII
)paren
)paren
)paren
(brace
r_int
id|phy
comma
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
l_int|11
)paren
(brace
id|tp-&gt;cur_index
op_assign
id|i
suffix:semicolon
id|tp-&gt;saved_if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;saved_if_port
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Find the connected MII xcvrs.&n;&t;&t;   Doing this in open() would allow detecting external xcvrs later,&n;&t;&t;   but takes much time. */
r_for
c_loop
(paren
id|phy
op_assign
l_int|0
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|tp-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_status
op_amp
l_int|0x8301
)paren
op_eq
l_int|0x8001
op_logical_or
(paren
(paren
id|mii_status
op_amp
l_int|0x8000
)paren
op_eq
l_int|0
op_logical_and
(paren
id|mii_status
op_amp
l_int|0x7800
)paren
op_ne
l_int|0
)paren
)paren
(brace
r_int
id|mii_reg0
op_assign
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|0
)paren
suffix:semicolon
r_int
id|mii_advert
op_assign
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|4
)paren
suffix:semicolon
r_int
id|reg4
op_assign
(paren
(paren
id|mii_status
op_rshift
l_int|6
)paren
op_amp
id|tp-&gt;to_advertise
)paren
op_or
l_int|1
suffix:semicolon
id|tp-&gt;phys
(braket
id|phy_idx
)braket
op_assign
id|phy
suffix:semicolon
id|tp-&gt;advertising
(braket
id|phy_idx
op_increment
)braket
op_assign
id|reg4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  MII transceiver #%d &quot;
l_string|&quot;config %4.4x status %4.4x advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_reg0
comma
id|mii_status
comma
id|mii_advert
)paren
suffix:semicolon
multiline_comment|/* Fixup for DLink with miswired PHY. */
r_if
c_cond
(paren
id|mii_advert
op_ne
id|reg4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Advertising %4.4x on PHY %d,&quot;
l_string|&quot; previously advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|reg4
comma
id|phy
comma
id|mii_advert
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Advertising %4.4x (to advertise&quot;
l_string|&quot; is %4.4x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|reg4
comma
id|tp-&gt;to_advertise
)paren
suffix:semicolon
id|tulip_mdio_write
c_func
(paren
id|dev
comma
id|phy
comma
l_int|4
comma
id|reg4
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable autonegotiation: some boards default to off. */
id|tulip_mdio_write
c_func
(paren
id|dev
comma
id|phy
comma
l_int|0
comma
id|mii_reg0
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0x1100
suffix:colon
l_int|0x1000
)paren
op_or
(paren
id|tulip_media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaIs100
ques
c_cond
l_int|0x2000
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
)brace
)brace
id|tp-&gt;mii_cnt
op_assign
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
op_logical_and
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: ***WARNING***: No MII transceiver found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* The Tulip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
id|tulip_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|tulip_start_xmit
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tulip_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;stop
op_assign
id|tulip_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|tulip_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|private_ioctl
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_rx_mode
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
op_logical_or
id|tp-&gt;chip_id
op_eq
id|DC21041
)paren
id|tp-&gt;link_change
op_assign
id|t21142_lnk_change
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_PNICNWAY
)paren
id|tp-&gt;link_change
op_assign
id|pnic_lnk_change
suffix:semicolon
multiline_comment|/* Reset the xcvr interface and turn on heartbeat. */
r_switch
c_cond
(paren
id|chip_idx
)paren
(brace
r_case
id|DC21041
suffix:colon
id|tp-&gt;to_advertise
op_assign
l_int|0x0061
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xFFFFFFFF
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000008
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
multiline_comment|/* Listen on AUI also. */
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_or
id|csr6_fd
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000EF05
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DC21040
suffix:colon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000004
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DC21140
suffix:colon
r_case
id|DM910X
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|tp-&gt;mtable
)paren
id|outl
c_func
(paren
id|tp-&gt;mtable-&gt;csr12dir
op_or
l_int|0x100
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DC21142
suffix:colon
r_case
id|PNIC2
suffix:colon
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
op_logical_or
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|csr6_mask_defstate
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|csr6_mask_hdcap
comma
id|CSR6
)paren
suffix:semicolon
)brace
r_else
id|t21142_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC82C168
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;mii_cnt
)paren
(brace
id|tp-&gt;nway
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;nwayset
op_assign
l_int|0
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
id|csr6_ttm
op_or
id|csr6_ca
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x30
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
l_int|0x0001F078
comma
id|CSR6
)paren
suffix:semicolon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
l_int|0x0201F078
comma
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Turn on autonegotiation. */
)brace
r_break
suffix:semicolon
r_case
id|MX98713
suffix:colon
r_case
id|COMPEX9881
suffix:colon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
l_int|0x00000000
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x000711C0
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
multiline_comment|/* Turn on NWay. */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MX98715
suffix:colon
r_case
id|MX98725
suffix:colon
id|tulip_outl_csr
c_func
(paren
id|tp
comma
l_int|0x01a80000
comma
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xFFFFFFFF
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00001000
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMET
suffix:colon
multiline_comment|/* No initialization necessary. */
r_break
suffix:semicolon
)brace
multiline_comment|/* put the chip in snooze mode until opened */
r_if
c_cond
(paren
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
id|HAS_ACPI
)paren
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
l_int|0x40
comma
l_int|0x40000000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free_mmio_res
suffix:colon
id|release_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|err_out_free_pio_res
suffix:colon
id|release_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|err_out_free_netdev
suffix:colon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|kfree
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|tulip_suspend
r_static
r_void
id|tulip_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|netif_device_present
(paren
id|dev
)paren
)paren
(brace
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
id|tulip_down
(paren
id|dev
)paren
suffix:semicolon
)brace
singleline_comment|//&t;pci_set_power_state(pdev, 3);
)brace
DECL|function|tulip_resume
r_static
r_void
id|tulip_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
op_logical_neg
id|netif_device_present
(paren
id|dev
)paren
)paren
(brace
id|tulip_up
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_attach
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|tulip_remove_one
r_static
r_void
id|__devexit
id|tulip_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
id|tp-&gt;rx_ring
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|release_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
DECL|variable|tulip_driver
r_static
r_struct
id|pci_driver
id|tulip_driver
op_assign
(brace
id|name
suffix:colon
id|TULIP_MODULE_NAME
comma
id|id_table
suffix:colon
id|tulip_pci_tbl
comma
id|probe
suffix:colon
id|tulip_init_one
comma
id|remove
suffix:colon
id|tulip_remove_one
comma
id|suspend
suffix:colon
id|tulip_suspend
comma
id|resume
suffix:colon
id|tulip_resume
comma
)brace
suffix:semicolon
DECL|function|tulip_init
r_static
r_int
id|__init
id|tulip_init
(paren
r_void
)paren
(brace
multiline_comment|/* copy module parms into globals */
id|tulip_rx_copybreak
op_assign
id|rx_copybreak
suffix:semicolon
id|tulip_max_interrupt_work
op_assign
id|max_interrupt_work
suffix:semicolon
multiline_comment|/* probe for and init boards */
r_return
id|pci_module_init
(paren
op_amp
id|tulip_driver
)paren
suffix:semicolon
)brace
DECL|function|tulip_cleanup
r_static
r_void
id|__exit
id|tulip_cleanup
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|tulip_driver
)paren
suffix:semicolon
)brace
DECL|variable|tulip_init
id|module_init
c_func
(paren
id|tulip_init
)paren
suffix:semicolon
DECL|variable|tulip_cleanup
id|module_exit
c_func
(paren
id|tulip_cleanup
)paren
suffix:semicolon
eof
