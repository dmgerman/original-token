multiline_comment|/*&n; * Device driver framework for the COMX line of synchronous serial boards&n; * &n; * for Linux kernel 2.2.X&n; *&n; * Original authors:  Arpad Bakay &lt;bakay.arpad@synergon.hu&gt;,&n; *                    Peter Bajan &lt;bajan.peter@synergon.hu&gt;,&n; * Previous maintainer: Tivadar Szemethy &lt;tiv@itc.hu&gt;&n; * Current maintainer: Gergely Madarasz &lt;gorgo@itc.hu&gt;&n; *&n; * Copyright (C) 1995-1999 ITConsult-Pro Co.&n; *&n; * Contributors:&n; * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; (0.85)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; *&n; * Version 0.80 (99/06/11):&n; *&t;&t;- clean up source code (playing a bit of indent)&n; *&t;&t;- port back to kernel, add support for non-module versions&n; *&t;&t;- add support for board resets when channel protocol is down&n; *&t;&t;- reset the device structure after protocol exit&n; *&t;&t;  the syncppp driver needs it&n; *&t;&t;- add support for /proc/comx/protocols and &n; *&t;&t;  /proc/comx/boardtypes&n; *&n; * Version 0.81 (99/06/21):&n; *&t;&t;- comment out the board reset support code, the locomx&n; *&t;&t;  driver seems not buggy now&n; *&t;&t;- printk() levels fixed&n; *&n; * Version 0.82 (99/07/08):&n; *&t;&t;- Handle stats correctly if the lowlevel driver is&n; *&t;&t;  is not a comx one (locomx - z85230)&n; *&n; * Version 0.83 (99/07/15):&n; *&t;&t;- reset line_status when interface is down&n; *&n; * Version 0.84 (99/12/01):&n; *&t;&t;- comx_status should not check for IFF_UP (to report&n; *&t;&t;  line status from dev-&gt;open())&n; *&n; * Version 0.85 (00/08/15):&n; * &t;&t;- resource release on failure in comx_mkdir&n; * &t;&t;- fix return value on failure at comx_write_proc&n; *&n; * Changed      (00/10/29, Henner Eisen):&n; * &t;&t;- comx_rx() / comxlapb_data_indication() return status.&n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;0.85&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_KMOD
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#endif
macro_line|#ifndef CONFIG_PROC_FS
macro_line|#error For now, COMX really needs the /proc filesystem
macro_line|#endif
macro_line|#include &quot;comx.h&quot;
macro_line|#include &quot;syncppp.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gergely Madarasz &lt;gorgo@itc.hu&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Common code for the COMX synchronous serial adapters&quot;
)paren
suffix:semicolon
r_extern
r_int
id|comx_hw_comx_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_hw_locomx_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_hw_mixcom_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_proto_hdlc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_proto_ppp_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_proto_syncppp_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_proto_lapb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|comx_proto_fr_init
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|comx_channels
r_static
r_struct
id|comx_hardware
op_star
id|comx_channels
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|comx_lines
r_static
r_struct
id|comx_protocol
op_star
id|comx_lines
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|comx_mkdir
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|comx_rmdir
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
)paren
suffix:semicolon
r_static
r_struct
id|dentry
op_star
id|comx_lookup
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
)paren
suffix:semicolon
DECL|variable|comx_root_inode_ops
r_static
r_struct
id|inode_operations
id|comx_root_inode_ops
op_assign
(brace
id|lookup
suffix:colon
id|comx_lookup
comma
id|mkdir
suffix:colon
id|comx_mkdir
comma
id|rmdir
suffix:colon
id|comx_rmdir
comma
)brace
suffix:semicolon
r_static
r_int
id|comx_delete_dentry
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
suffix:semicolon
r_static
r_struct
id|proc_dir_entry
op_star
id|create_comx_proc_entry
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|mode
comma
r_int
id|size
comma
r_struct
id|proc_dir_entry
op_star
id|dir
)paren
suffix:semicolon
DECL|variable|comx_dentry_operations
r_static
r_struct
id|dentry_operations
id|comx_dentry_operations
op_assign
(brace
id|d_delete
suffix:colon
id|comx_delete_dentry
comma
)brace
suffix:semicolon
DECL|variable|comx_root_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|comx_root_dir
suffix:semicolon
DECL|variable|comx_debugflags
r_struct
id|comx_debugflags_struct
id|comx_debugflags
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;comx_rx&quot;
comma
id|DEBUG_COMX_RX
)brace
comma
(brace
l_string|&quot;comx_tx&quot;
comma
id|DEBUG_COMX_TX
)brace
comma
(brace
l_string|&quot;hw_tx&quot;
comma
id|DEBUG_HW_TX
)brace
comma
(brace
l_string|&quot;hw_rx&quot;
comma
id|DEBUG_HW_RX
)brace
comma
(brace
l_string|&quot;hdlc_keepalive&quot;
comma
id|DEBUG_HDLC_KEEPALIVE
)brace
comma
(brace
l_string|&quot;comxppp&quot;
comma
id|DEBUG_COMX_PPP
)brace
comma
(brace
l_string|&quot;comxlapb&quot;
comma
id|DEBUG_COMX_LAPB
)brace
comma
(brace
l_string|&quot;dlci&quot;
comma
id|DEBUG_COMX_DLCI
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|comx_debug
r_int
id|comx_debug
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
op_star
id|page
comma
op_star
id|str
suffix:semicolon
id|va_list
id|args
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;debug_area
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_ATOMIC
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|len
op_assign
id|vsprintf
c_func
(paren
id|str
op_assign
id|page
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
id|PAGE_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comx_debug: PANIC! len = %d !!!&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
)paren
(brace
r_int
id|to_copy
suffix:semicolon
r_int
id|free
op_assign
(paren
id|ch-&gt;debug_start
op_minus
id|ch-&gt;debug_end
op_plus
id|ch-&gt;debug_size
)paren
op_mod
id|ch-&gt;debug_size
suffix:semicolon
id|to_copy
op_assign
id|min
c_func
(paren
id|free
ques
c_cond
id|free
suffix:colon
id|ch-&gt;debug_size
comma
id|min
(paren
id|ch-&gt;debug_size
op_minus
id|ch-&gt;debug_end
comma
id|len
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ch-&gt;debug_area
op_plus
id|ch-&gt;debug_end
comma
id|str
comma
id|to_copy
)paren
suffix:semicolon
id|str
op_add_assign
id|to_copy
suffix:semicolon
id|len
op_sub_assign
id|to_copy
suffix:semicolon
id|ch-&gt;debug_end
op_assign
(paren
id|ch-&gt;debug_end
op_plus
id|to_copy
)paren
op_mod
id|ch-&gt;debug_size
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_start
op_eq
id|ch-&gt;debug_end
)paren
singleline_comment|// Full ? push start away
id|ch-&gt;debug_start
op_assign
(paren
id|ch-&gt;debug_start
op_plus
id|len
op_plus
l_int|1
)paren
op_mod
id|ch-&gt;debug_size
suffix:semicolon
id|ch-&gt;debug_file-&gt;size
op_assign
(paren
id|ch-&gt;debug_end
op_minus
id|ch-&gt;debug_start
op_plus
id|ch-&gt;debug_size
)paren
op_mod
id|ch-&gt;debug_size
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_debug_skb
r_int
id|comx_debug_skb
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|msg
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;debug_area
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;%s: %s NULL skb&bslash;n&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|msg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;len
)paren
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;%s: %s empty skb&bslash;n&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|msg
)paren
suffix:semicolon
r_return
id|comx_debug_bytes
c_func
(paren
id|dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|msg
)paren
suffix:semicolon
)brace
DECL|function|comx_debug_bytes
r_int
id|comx_debug_bytes
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_char
op_star
id|bytes
comma
r_int
id|len
comma
r_char
op_star
id|msg
)paren
(brace
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;debug_area
)paren
r_return
l_int|0
suffix:semicolon
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;%s: %s len %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|msg
comma
id|len
)paren
suffix:semicolon
r_while
c_loop
(paren
id|pos
op_ne
id|len
)paren
(brace
r_char
id|line
(braket
l_int|80
)braket
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|line
comma
l_int|0
comma
l_int|80
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|line
comma
l_string|&quot;%04d &quot;
comma
id|pos
)paren
suffix:semicolon
r_do
(brace
id|sprintf
c_func
(paren
id|line
op_plus
l_int|5
op_plus
(paren
id|pos
op_mod
l_int|16
)paren
op_star
l_int|3
comma
l_string|&quot;%02x&quot;
comma
id|bytes
(braket
id|pos
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|line
op_plus
l_int|60
op_plus
(paren
id|pos
op_mod
l_int|16
)paren
comma
l_string|&quot;%c&quot;
comma
id|isprint
c_func
(paren
id|bytes
(braket
id|pos
)braket
)paren
ques
c_cond
id|bytes
(braket
id|pos
)braket
suffix:colon
l_char|&squot;.&squot;
)paren
suffix:semicolon
id|pos
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pos
op_ne
id|len
op_logical_and
id|pos
op_mod
l_int|16
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
op_ne
l_int|78
)paren
r_if
c_cond
(paren
id|line
(braket
id|i
)braket
op_eq
l_int|0
)paren
id|line
(braket
id|i
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|line
(braket
l_int|77
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|line
(braket
l_int|78
)braket
op_assign
l_int|0
suffix:semicolon
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;%s&quot;
comma
id|line
)paren
suffix:semicolon
)brace
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_loadavg_timerfun
r_static
r_void
id|comx_loadavg_timerfun
c_func
(paren
r_int
r_int
id|d
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|d
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ch-&gt;avg_bytes
(braket
id|ch-&gt;loadavg_counter
)braket
op_assign
id|ch-&gt;current_stats-&gt;rx_bytes
suffix:semicolon
id|ch-&gt;avg_bytes
(braket
id|ch-&gt;loadavg_counter
op_plus
id|ch-&gt;loadavg_size
)braket
op_assign
id|ch-&gt;current_stats-&gt;tx_bytes
suffix:semicolon
id|ch-&gt;loadavg_counter
op_assign
(paren
id|ch-&gt;loadavg_counter
op_plus
l_int|1
)paren
op_mod
id|ch-&gt;loadavg_size
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|ch-&gt;loadavg_timer
comma
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;loadavg
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|comx_reset_timerfun
c_func
(paren
r_int
r_int
id|d
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|d
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;line_status
op_amp
(paren
id|PROTO_LOOP
op_or
id|PROTO_UP
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;reset_pending
)paren
op_logical_and
id|ch-&gt;HW_reset
)paren
(brace
id|ch
op_member_access_from_pointer
id|HW_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
id|mod_timer
c_func
(paren
op_amp
id|ch-&gt;reset_timer
comma
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;reset_timeout
)paren
suffix:semicolon
)brace
macro_line|#endif                                            
DECL|function|comx_open
r_static
r_int
id|comx_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|comxdir
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;protocol
op_logical_or
op_logical_neg
id|ch-&gt;hardware
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|ch
op_member_access_from_pointer
id|HW_open
c_func
(paren
id|dev
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|ch
op_member_access_from_pointer
id|LINE_open
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|ch
op_member_access_from_pointer
id|HW_close
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|comxdir
suffix:semicolon
id|comxdir
op_assign
id|comxdir-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_HARDWARE
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_PROTOCOL
)paren
op_eq
l_int|0
)paren
id|comxdir-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0444
suffix:semicolon
)brace
macro_line|#if 0
id|ch-&gt;reset_pending
op_assign
l_int|1
suffix:semicolon
id|ch-&gt;reset_timeout
op_assign
l_int|30
suffix:semicolon
id|ch-&gt;reset_timer.function
op_assign
id|comx_reset_timerfun
suffix:semicolon
id|ch-&gt;reset_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ch-&gt;reset_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;reset_timeout
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ch-&gt;reset_timer
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_close
r_static
r_int
id|comx_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|comxdir
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
)brace
macro_line|#if 0&t;
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;reset_timer
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|LINE_OPEN
op_logical_and
id|ch-&gt;protocol
op_logical_and
id|ch-&gt;LINE_close
)paren
(brace
id|ret
op_assign
id|ch
op_member_access_from_pointer
id|LINE_close
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
op_logical_and
id|ch-&gt;hardware
op_logical_and
id|ch-&gt;HW_close
)paren
(brace
id|ret
op_assign
id|ch
op_member_access_from_pointer
id|HW_close
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|ch-&gt;line_status
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|comxdir
suffix:semicolon
id|comxdir
op_assign
id|comxdir-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_HARDWARE
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_PROTOCOL
)paren
op_eq
l_int|0
)paren
id|comxdir-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0644
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|comx_status
r_void
id|comx_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|status
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|status
op_amp
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;reset_pending
)paren
suffix:semicolon
)brace
macro_line|#endif
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Interface %s: modem status %s, line protocol %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
id|LINE_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
comma
id|status
op_amp
id|PROTO_LOOP
ques
c_cond
l_string|&quot;LOOP&quot;
suffix:colon
id|status
op_amp
id|PROTO_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
)paren
suffix:semicolon
id|ch-&gt;line_status
op_assign
id|status
suffix:semicolon
)brace
DECL|function|comx_xmit
r_static
r_int
id|comx_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|dev-&gt;mtu
op_plus
id|dev-&gt;hard_header_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comx_xmit: %s: skb-&gt;len %d &gt; dev-&gt;mtu %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_COMX_TX
)paren
(brace
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|skb
comma
l_string|&quot;comx_xmit skb&quot;
)paren
suffix:semicolon
)brace
id|rc
op_assign
id|ch
op_member_access_from_pointer
id|LINE_xmit
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
singleline_comment|//&t;if (!rc) dev_kfree_skb(skb);
r_return
id|rc
suffix:semicolon
)brace
DECL|function|comx_header
r_static
r_int
id|comx_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_header
)paren
(brace
r_return
(paren
id|ch
op_member_access_from_pointer
id|LINE_header
c_func
(paren
id|skb
comma
id|dev
comma
id|type
comma
id|daddr
comma
id|saddr
comma
id|len
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|comx_rebuild_header
r_static
r_int
id|comx_rebuild_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_rebuild_header
)paren
(brace
r_return
id|ch
op_member_access_from_pointer
id|LINE_rebuild_header
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|comx_rx
r_int
id|comx_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_COMX_RX
)paren
(brace
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|skb
comma
l_string|&quot;comx_rx skb&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
)paren
(brace
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_stats
r_static
r_struct
id|net_device_stats
op_star
id|comx_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
(paren
r_struct
id|comx_channel
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
id|ch-&gt;current_stats
suffix:semicolon
)brace
DECL|function|comx_lineup_func
r_void
id|comx_lineup_func
c_func
(paren
r_int
r_int
id|d
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|d
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_status
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
op_or_assign
id|LINE_UP
)paren
suffix:semicolon
)brace
)brace
DECL|macro|LOADAVG
mdefine_line|#define LOADAVG(avg, off) (int) &bslash;&n;&t;((ch-&gt;avg_bytes[(ch-&gt;loadavg_counter - 1 + ch-&gt;loadavg_size * 2) &bslash;&n;&t;% ch-&gt;loadavg_size + off] -  ch-&gt;avg_bytes[(ch-&gt;loadavg_counter - 1 &bslash;&n;&t;&t;- ch-&gt;loadavg[avg] / ch-&gt;loadavg[0] + ch-&gt;loadavg_size * 2) &bslash;&n;&t;&t;% ch-&gt;loadavg_size + off]) / ch-&gt;loadavg[avg] * 8)
DECL|function|comx_statistics
r_static
r_int
id|comx_statistics
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_char
id|tmpstr
(braket
l_int|20
)braket
suffix:semicolon
r_int
id|tmpstrlen
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Interface administrative status is %s, &quot;
l_string|&quot;modem status is %s, protocol is %s&bslash;n&quot;
comma
id|dev-&gt;flags
op_amp
id|IFF_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
comma
id|ch-&gt;line_status
op_amp
id|LINE_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
comma
id|ch-&gt;line_status
op_amp
id|PROTO_LOOP
ques
c_cond
l_string|&quot;LOOP&quot;
suffix:colon
id|ch-&gt;line_status
op_amp
id|PROTO_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Modem status changes: %lu, Transmitter status &quot;
l_string|&quot;is %s, tbusy: %d&bslash;n&quot;
comma
id|ch-&gt;current_stats-&gt;tx_carrier_errors
comma
id|ch-&gt;HW_txe
ques
c_cond
id|ch
op_member_access_from_pointer
id|HW_txe
c_func
(paren
id|dev
)paren
ques
c_cond
l_string|&quot;IDLE&quot;
suffix:colon
l_string|&quot;BUSY&quot;
suffix:colon
l_string|&quot;NOT READY&quot;
comma
id|netif_running
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Interface load (input): %d / %d / %d bits/s (&quot;
comma
id|LOADAVG
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|LOADAVG
c_func
(paren
l_int|1
comma
l_int|0
)paren
comma
id|LOADAVG
c_func
(paren
l_int|2
comma
l_int|0
)paren
)paren
suffix:semicolon
id|tmpstr
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_ne
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
id|tf
suffix:semicolon
id|tf
op_assign
id|ch-&gt;loadavg
(braket
id|i
)braket
op_mod
l_int|60
op_eq
l_int|0
op_logical_and
id|ch-&gt;loadavg
(braket
id|i
)braket
op_div
l_int|60
OG
l_int|0
ques
c_cond
l_char|&squot;m&squot;
suffix:colon
l_char|&squot;s&squot;
suffix:semicolon
id|tmpstrlen
op_add_assign
id|sprintf
c_func
(paren
id|tmpstr
op_plus
id|tmpstrlen
comma
l_string|&quot;%d%c%s&quot;
comma
id|ch-&gt;loadavg
(braket
id|i
)braket
op_div
(paren
id|tf
op_eq
l_char|&squot;m&squot;
ques
c_cond
l_int|60
suffix:colon
l_int|1
)paren
comma
id|tf
comma
id|i
op_eq
l_int|2
ques
c_cond
l_string|&quot;)&bslash;n&quot;
suffix:colon
l_string|&quot;/&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s              (output): %d / %d / %d bits/s (%s&quot;
comma
id|tmpstr
comma
id|LOADAVG
c_func
(paren
l_int|0
comma
id|ch-&gt;loadavg_size
)paren
comma
id|LOADAVG
c_func
(paren
l_int|1
comma
id|ch-&gt;loadavg_size
)paren
comma
id|LOADAVG
c_func
(paren
l_int|2
comma
id|ch-&gt;loadavg_size
)paren
comma
id|tmpstr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Debug flags: &quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|len
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|comx_debugflags
(braket
id|i
)braket
dot
id|name
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|comx_debugflags
(braket
id|i
)braket
dot
id|value
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s &quot;
comma
id|comx_debugflags
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|tmp
op_eq
id|len
ques
c_cond
l_string|&quot;none&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;RX errors: len: %lu, overrun: %lu, crc: %lu, &quot;
l_string|&quot;aborts: %lu&bslash;n           buffer overrun: %lu, pbuffer overrun: %lu&bslash;n&quot;
l_string|&quot;TX errors: underrun: %lu&bslash;n&quot;
comma
id|ch-&gt;current_stats-&gt;rx_length_errors
comma
id|ch-&gt;current_stats-&gt;rx_over_errors
comma
id|ch-&gt;current_stats-&gt;rx_crc_errors
comma
id|ch-&gt;current_stats-&gt;rx_frame_errors
comma
id|ch-&gt;current_stats-&gt;rx_missed_errors
comma
id|ch-&gt;current_stats-&gt;rx_fifo_errors
comma
id|ch-&gt;current_stats-&gt;tx_fifo_errors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_statistics
op_logical_and
(paren
id|ch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
)paren
(brace
id|len
op_add_assign
id|ch
op_member_access_from_pointer
id|LINE_statistics
c_func
(paren
id|dev
comma
id|page
op_plus
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Line status: driver not initialized&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;HW_statistics
op_logical_and
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
id|len
op_add_assign
id|ch
op_member_access_from_pointer
id|HW_statistics
c_func
(paren
id|dev
comma
id|page
op_plus
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Board status: driver not initialized&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|comx_ioctl
r_static
r_int
id|comx_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_ioctl
)paren
(brace
r_return
id|ch
op_member_access_from_pointer
id|LINE_ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|comx_reset_dev
r_static
r_void
id|comx_reset_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;open
op_assign
id|comx_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|comx_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|comx_xmit
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|comx_header
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|comx_rebuild_header
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|comx_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|comx_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|20
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_NOARP
suffix:semicolon
)brace
DECL|function|comx_init_dev
r_static
r_int
id|comx_init_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|comx_channel
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ch
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|comx_channel
)paren
)paren
suffix:semicolon
id|ch-&gt;loadavg
(braket
l_int|0
)braket
op_assign
l_int|5
suffix:semicolon
id|ch-&gt;loadavg
(braket
l_int|1
)braket
op_assign
l_int|300
suffix:semicolon
id|ch-&gt;loadavg
(braket
l_int|2
)braket
op_assign
l_int|900
suffix:semicolon
id|ch-&gt;loadavg_size
op_assign
id|ch-&gt;loadavg
(braket
l_int|2
)braket
op_div
id|ch-&gt;loadavg
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;avg_bytes
op_assign
id|kmalloc
c_func
(paren
id|ch-&gt;loadavg_size
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|ch
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ch-&gt;avg_bytes
comma
l_int|0
comma
id|ch-&gt;loadavg_size
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|ch-&gt;loadavg_counter
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;loadavg_timer.function
op_assign
id|comx_loadavg_timerfun
suffix:semicolon
id|ch-&gt;loadavg_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ch-&gt;loadavg_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;loadavg
(braket
l_int|0
)braket
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ch-&gt;loadavg_timer
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|ch
suffix:semicolon
id|ch-&gt;dev
op_assign
id|dev
suffix:semicolon
id|ch-&gt;line_status
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
id|ch-&gt;current_stats
op_assign
op_amp
id|ch-&gt;stats
suffix:semicolon
id|comx_reset_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_read_proc
r_static
r_int
id|comx_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|file
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|file-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
(paren
r_struct
id|comx_channel
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_STATUS
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|comx_statistics
c_func
(paren
id|dev
comma
id|page
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_HARDWARE
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|ch-&gt;hardware
ques
c_cond
id|ch-&gt;hardware-&gt;name
suffix:colon
id|HWNAME_NONE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_PROTOCOL
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|ch-&gt;protocol
ques
c_cond
id|ch-&gt;protocol-&gt;name
suffix:colon
id|PROTONAME_NONE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_LINEUPDELAY
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%01d&bslash;n&quot;
comma
id|ch-&gt;lineup_delay
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|len
op_minus
id|off
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|min
c_func
(paren
id|count
comma
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
DECL|function|comx_root_read_proc
r_static
r_int
id|comx_root_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|file
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|comx_hardware
op_star
id|hw
suffix:semicolon
r_struct
id|comx_protocol
op_star
id|line
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_HARDWARELIST
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|hw
op_assign
id|comx_channels
suffix:semicolon
id|hw
suffix:semicolon
id|hw
op_assign
id|hw-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|hw-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_PROTOCOLLIST
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
id|comx_lines
suffix:semicolon
id|line
suffix:semicolon
id|line
op_assign
id|line-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|line-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|len
op_minus
id|off
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|min
c_func
(paren
id|count
comma
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
DECL|function|comx_write_proc
r_static
r_int
id|comx_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
id|u_long
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|entry-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
(paren
r_struct
id|comx_channel
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_char
op_star
id|page
suffix:semicolon
r_struct
id|comx_hardware
op_star
id|hw
op_assign
id|comx_channels
suffix:semicolon
r_struct
id|comx_protocol
op_star
id|line
op_assign
id|comx_lines
suffix:semicolon
r_char
id|str
(braket
l_int|30
)braket
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|PAGE_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;count is %lu &gt; %d!!!&bslash;n&quot;
comma
id|count
comma
(paren
r_int
)paren
id|PAGE_SIZE
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|copy_from_user
c_func
(paren
id|page
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_eq
l_char|&squot;&bslash;n&squot;
)paren
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_DEBUG
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|10
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_area
)paren
id|kfree
c_func
(paren
id|ch-&gt;debug_area
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;debug_area
op_assign
id|kmalloc
c_func
(paren
id|ch-&gt;debug_size
op_assign
id|i
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ch-&gt;debug_start
op_assign
id|ch-&gt;debug_end
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|page
op_ne
l_char|&squot;+&squot;
op_logical_and
op_star
id|page
op_ne
l_char|&squot;-&squot;
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|comx_debugflags
(braket
id|i
)braket
dot
id|value
op_logical_and
id|strncmp
c_func
(paren
id|comx_debugflags
(braket
id|i
)braket
dot
id|name
comma
id|page
op_plus
l_int|1
comma
id|strlen
c_func
(paren
id|comx_debugflags
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|comx_debugflags
(braket
id|i
)braket
dot
id|value
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid debug option&bslash;n&quot;
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|page
op_eq
l_char|&squot;+&squot;
)paren
(brace
id|ch-&gt;debug_flags
op_or_assign
id|comx_debugflags
(braket
id|i
)braket
dot
id|value
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;debug_flags
op_and_assign
op_complement
id|comx_debugflags
(braket
id|i
)braket
dot
id|value
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_HARDWARE
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|page
)paren
OG
l_int|10
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|hw
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|hw-&gt;name
comma
id|page
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|hw
op_assign
id|hw-&gt;next
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
op_logical_neg
id|hw
op_logical_and
id|comx_strcasecmp
c_func
(paren
id|HWNAME_NONE
comma
id|page
)paren
op_ne
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;comx-hw-%s&quot;
comma
id|page
)paren
suffix:semicolon
id|request_module
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
id|hw
op_assign
id|comx_channels
suffix:semicolon
r_while
c_loop
(paren
id|hw
)paren
(brace
r_if
c_cond
(paren
id|comx_strcasecmp
c_func
(paren
id|hw-&gt;name
comma
id|page
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|hw
op_assign
id|hw-&gt;next
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|comx_strcasecmp
c_func
(paren
id|HWNAME_NONE
comma
id|page
)paren
op_ne
l_int|0
op_logical_and
op_logical_neg
id|hw
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;hardware
op_logical_and
id|ch-&gt;hardware-&gt;hw_exit
op_logical_and
(paren
id|ret
op_assign
id|ch-&gt;hardware
op_member_access_from_pointer
id|hw_exit
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|ch-&gt;hardware
op_assign
id|hw
suffix:semicolon
id|entry-&gt;size
op_assign
id|strlen
c_func
(paren
id|page
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hw
op_logical_and
id|hw-&gt;hw_init
)paren
id|hw
op_member_access_from_pointer
id|hw_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_PROTOCOL
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|page
)paren
OG
l_int|10
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|line
)paren
(brace
r_if
c_cond
(paren
id|comx_strcasecmp
c_func
(paren
id|line-&gt;name
comma
id|page
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|line
op_assign
id|line-&gt;next
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
op_logical_neg
id|line
op_logical_and
id|comx_strcasecmp
c_func
(paren
id|PROTONAME_NONE
comma
id|page
)paren
op_ne
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;comx-proto-%s&quot;
comma
id|page
)paren
suffix:semicolon
id|request_module
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
id|line
op_assign
id|comx_lines
suffix:semicolon
r_while
c_loop
(paren
id|line
)paren
(brace
r_if
c_cond
(paren
id|comx_strcasecmp
c_func
(paren
id|line-&gt;name
comma
id|page
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|line
op_assign
id|line-&gt;next
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|comx_strcasecmp
c_func
(paren
id|PROTONAME_NONE
comma
id|page
)paren
op_ne
l_int|0
op_logical_and
op_logical_neg
id|line
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;protocol
op_logical_and
id|ch-&gt;protocol-&gt;line_exit
op_logical_and
(paren
id|ret
op_assign
id|ch-&gt;protocol
op_member_access_from_pointer
id|line_exit
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|ch-&gt;protocol
op_assign
id|line
suffix:semicolon
id|entry-&gt;size
op_assign
id|strlen
c_func
(paren
id|page
)paren
op_plus
l_int|1
suffix:semicolon
id|comx_reset_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|line
op_logical_and
id|line-&gt;line_init
)paren
id|line
op_member_access_from_pointer
id|line_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_LINEUPDELAY
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|10
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
l_int|0
op_logical_and
id|i
OL
l_int|10
)paren
(brace
id|ch-&gt;lineup_delay
op_assign
id|i
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comx: invalid lineup_delay value&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|comx_mkdir
r_static
r_int
id|comx_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|new_dir
comma
op_star
id|debug_file
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_device
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_dir
op_assign
id|create_proc_entry
c_func
(paren
id|dentry-&gt;d_name.name
comma
id|mode
op_or
id|S_IFDIR
comma
id|comx_root_dir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_dev
suffix:semicolon
)brace
id|new_dir-&gt;nlink
op_assign
l_int|2
suffix:semicolon
id|new_dir-&gt;data
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|// ide jon majd a struct dev
multiline_comment|/* Ezek kellenek */
r_if
c_cond
(paren
op_logical_neg
id|create_comx_proc_entry
c_func
(paren
id|FILENAME_HARDWARE
comma
l_int|0644
comma
id|strlen
c_func
(paren
id|HWNAME_NONE
)paren
op_plus
l_int|1
comma
id|new_dir
)paren
)paren
(brace
r_goto
id|cleanup_new_dir
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|create_comx_proc_entry
c_func
(paren
id|FILENAME_PROTOCOL
comma
l_int|0644
comma
id|strlen
c_func
(paren
id|PROTONAME_NONE
)paren
op_plus
l_int|1
comma
id|new_dir
)paren
)paren
(brace
r_goto
id|cleanup_filename_hardware
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|create_comx_proc_entry
c_func
(paren
id|FILENAME_STATUS
comma
l_int|0444
comma
l_int|0
comma
id|new_dir
)paren
)paren
(brace
r_goto
id|cleanup_filename_protocol
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|create_comx_proc_entry
c_func
(paren
id|FILENAME_LINEUPDELAY
comma
l_int|0644
comma
l_int|2
comma
id|new_dir
)paren
)paren
(brace
r_goto
id|cleanup_filename_status
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|debug_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_DEBUG
comma
id|S_IFREG
op_or
l_int|0644
comma
id|new_dir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_lineupdelay
suffix:semicolon
)brace
id|debug_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|debug_file
suffix:semicolon
id|debug_file-&gt;read_proc
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|// see below
id|debug_file-&gt;write_proc
op_assign
op_amp
id|comx_write_proc
suffix:semicolon
id|debug_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;name
comma
(paren
r_char
op_star
)paren
id|new_dir-&gt;name
)paren
suffix:semicolon
id|dev-&gt;init
op_assign
id|comx_init_dev
suffix:semicolon
r_if
c_cond
(paren
id|register_netdevice
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|cleanup_filename_debug
suffix:semicolon
)brace
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;if_ptr
op_assign
(paren
r_void
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ppp_device
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_register
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ch-&gt;if_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ppp_device
)paren
)paren
suffix:semicolon
id|ch-&gt;debug_file
op_assign
id|debug_file
suffix:semicolon
id|ch-&gt;procdir
op_assign
id|new_dir
suffix:semicolon
id|new_dir-&gt;data
op_assign
id|dev
suffix:semicolon
id|ch-&gt;debug_start
op_assign
id|ch-&gt;debug_end
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;debug_area
op_assign
id|kmalloc
c_func
(paren
id|ch-&gt;debug_size
op_assign
id|DEFAULT_DEBUG_SIZE
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|cleanup_if_ptr
suffix:semicolon
)brace
id|ch-&gt;lineup_delay
op_assign
id|DEFAULT_LINEUP_DELAY
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_if_ptr
suffix:colon
id|kfree
c_func
(paren
id|ch-&gt;if_ptr
)paren
suffix:semicolon
id|cleanup_register
suffix:colon
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|cleanup_filename_debug
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_DEBUG
comma
id|new_dir
)paren
suffix:semicolon
id|cleanup_filename_lineupdelay
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_LINEUPDELAY
comma
id|new_dir
)paren
suffix:semicolon
id|cleanup_filename_status
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_STATUS
comma
id|new_dir
)paren
suffix:semicolon
id|cleanup_filename_protocol
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_PROTOCOL
comma
id|new_dir
)paren
suffix:semicolon
id|cleanup_filename_hardware
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_HARDWARE
comma
id|new_dir
)paren
suffix:semicolon
id|cleanup_new_dir
suffix:colon
id|remove_proc_entry
c_func
(paren
id|dentry-&gt;d_name.name
comma
id|comx_root_dir
)paren
suffix:semicolon
id|cleanup_dev
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|comx_rmdir
r_static
r_int
id|comx_rmdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
id|dentry-&gt;d_inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|entry-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: down interface before removing it&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;protocol
op_logical_and
id|ch-&gt;protocol-&gt;line_exit
op_logical_and
(paren
id|ret
op_assign
id|ch-&gt;protocol
op_member_access_from_pointer
id|line_exit
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;hardware
op_logical_and
id|ch-&gt;hardware-&gt;hw_exit
op_logical_and
(paren
id|ret
op_assign
id|ch-&gt;hardware
op_member_access_from_pointer
id|hw_exit
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;protocol
op_logical_and
id|ch-&gt;protocol-&gt;line_init
)paren
(brace
id|ch-&gt;protocol
op_member_access_from_pointer
id|line_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
id|ch-&gt;protocol
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;hardware
op_assign
l_int|NULL
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;loadavg_timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ch-&gt;avg_bytes
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_area
)paren
(brace
id|kfree
c_func
(paren
id|ch-&gt;debug_area
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;priv
)paren
(brace
id|kfree
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_DEBUG
comma
id|entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_LINEUPDELAY
comma
id|entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_STATUS
comma
id|entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_HARDWARE
comma
id|entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_PROTOCOL
comma
id|entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|dentry-&gt;d_name.name
comma
id|comx_root_dir
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_lookup
r_static
r_struct
id|dentry
op_star
id|comx_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|de
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|de
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|dir-&gt;u.generic_ip
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|de
op_assign
id|de-&gt;subdir
suffix:semicolon
id|de
suffix:semicolon
id|de
op_assign
id|de-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|de
op_logical_and
id|de-&gt;low_ino
)paren
op_logical_and
(paren
id|de-&gt;namelen
op_eq
id|dentry-&gt;d_name.len
)paren
op_logical_and
(paren
id|memcmp
c_func
(paren
id|dentry-&gt;d_name.name
comma
id|de-&gt;name
comma
id|de-&gt;namelen
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|inode
op_assign
id|proc_get_inode
c_func
(paren
id|dir-&gt;i_sb
comma
id|de-&gt;low_ino
comma
id|de
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;COMX: lookup error&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
id|dentry-&gt;d_op
op_assign
op_amp
id|comx_dentry_operations
suffix:semicolon
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|comx_strcasecmp
r_int
id|comx_strcasecmp
c_func
(paren
r_const
r_char
op_star
id|cs
comma
r_const
r_char
op_star
id|ct
)paren
(brace
r_register
r_int
r_char
id|__res
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|__res
op_assign
id|toupper
c_func
(paren
op_star
id|cs
)paren
op_minus
id|toupper
c_func
(paren
op_star
id|ct
op_increment
)paren
)paren
op_ne
l_int|0
op_logical_or
op_logical_neg
op_star
id|cs
op_increment
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
id|__res
suffix:semicolon
)brace
DECL|function|comx_delete_dentry
r_static
r_int
id|comx_delete_dentry
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|create_comx_proc_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|create_comx_proc_entry
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|mode
comma
r_int
id|size
comma
r_struct
id|proc_dir_entry
op_star
id|dir
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
id|S_IFREG
op_or
id|mode
comma
id|dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comx_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comx_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
id|size
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|new_file
suffix:semicolon
)brace
DECL|function|comx_register_hardware
r_int
id|comx_register_hardware
c_func
(paren
r_struct
id|comx_hardware
op_star
id|comx_hw
)paren
(brace
r_struct
id|comx_hardware
op_star
id|hw
op_assign
id|comx_channels
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hw
)paren
(brace
id|comx_channels
op_assign
id|comx_hw
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|hw-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|comx_hw-&gt;name
comma
id|hw-&gt;name
)paren
op_ne
l_int|0
)paren
(brace
id|hw
op_assign
id|hw-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comx_hw-&gt;name
comma
id|hw-&gt;name
)paren
op_eq
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|hw-&gt;next
op_assign
id|comx_hw
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;COMX: driver for hardware type %s, version %s&bslash;n&quot;
comma
id|comx_hw-&gt;name
comma
id|comx_hw-&gt;version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_unregister_hardware
r_int
id|comx_unregister_hardware
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_struct
id|comx_hardware
op_star
id|hw
op_assign
id|comx_channels
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hw
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|hw-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|comx_channels
op_assign
id|comx_channels-&gt;next
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|hw-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|hw-&gt;next-&gt;name
comma
id|name
)paren
op_ne
l_int|0
)paren
(brace
id|hw
op_assign
id|hw-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|hw-&gt;next-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|hw-&gt;next
op_assign
id|hw-&gt;next-&gt;next
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|comx_register_protocol
r_int
id|comx_register_protocol
c_func
(paren
r_struct
id|comx_protocol
op_star
id|comx_line
)paren
(brace
r_struct
id|comx_protocol
op_star
id|pr
op_assign
id|comx_lines
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
(brace
id|comx_lines
op_assign
id|comx_line
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|pr-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|comx_line-&gt;name
comma
id|pr-&gt;name
)paren
op_ne
l_int|0
)paren
(brace
id|pr
op_assign
id|pr-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comx_line-&gt;name
comma
id|pr-&gt;name
)paren
op_eq
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pr-&gt;next
op_assign
id|comx_line
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;COMX: driver for protocol type %s, version %s&bslash;n&quot;
comma
id|comx_line-&gt;name
comma
id|comx_line-&gt;version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|comx_unregister_protocol
r_int
id|comx_unregister_protocol
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_struct
id|comx_protocol
op_star
id|pr
op_assign
id|comx_lines
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|pr-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|comx_lines
op_assign
id|comx_lines-&gt;next
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pr-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|pr-&gt;next-&gt;name
comma
id|name
)paren
op_ne
l_int|0
)paren
(brace
id|pr
op_assign
id|pr-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pr-&gt;next
op_ne
l_int|NULL
op_logical_and
id|strcmp
c_func
(paren
id|pr-&gt;next-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
(brace
id|pr-&gt;next
op_assign
id|pr-&gt;next-&gt;next
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|macro|comx_init
mdefine_line|#define comx_init init_module
macro_line|#endif
DECL|function|comx_init
r_int
id|__init
id|comx_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
id|comx_root_dir
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;comx&quot;
comma
id|S_IFDIR
op_or
id|S_IWUSR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|comx_root_dir
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|comx_root_dir-&gt;proc_iops
op_assign
op_amp
id|comx_root_inode_ops
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_HARDWARELIST
comma
id|S_IFREG
op_or
l_int|0444
comma
id|comx_root_dir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comx_root_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_PROTOCOLLIST
comma
id|S_IFREG
op_or
l_int|0444
comma
id|comx_root_dir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comx_root_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;COMX: driver version %s (C) 1995-1999 ITConsult-Pro Co. &lt;info@itc.hu&gt;&bslash;n&quot;
comma
id|VERSION
)paren
suffix:semicolon
macro_line|#ifndef MODULE
macro_line|#ifdef CONFIG_COMX_HW_COMX
id|comx_hw_comx_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_HW_LOCOMX
id|comx_hw_locomx_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_HW_MIXCOM
id|comx_hw_mixcom_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_PROTO_HDLC
id|comx_proto_hdlc_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_PROTO_PPP
id|comx_proto_ppp_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_PROTO_LAPB
id|comx_proto_lapb_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_COMX_PROTO_FR
id|comx_proto_fr_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|FILENAME_HARDWARELIST
comma
id|comx_root_dir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_PROTOCOLLIST
comma
id|comx_root_dir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|comx_root_dir-&gt;name
comma
op_amp
id|proc_root
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|comx_register_hardware
id|EXPORT_SYMBOL
c_func
(paren
id|comx_register_hardware
)paren
suffix:semicolon
DECL|variable|comx_unregister_hardware
id|EXPORT_SYMBOL
c_func
(paren
id|comx_unregister_hardware
)paren
suffix:semicolon
DECL|variable|comx_register_protocol
id|EXPORT_SYMBOL
c_func
(paren
id|comx_register_protocol
)paren
suffix:semicolon
DECL|variable|comx_unregister_protocol
id|EXPORT_SYMBOL
c_func
(paren
id|comx_unregister_protocol
)paren
suffix:semicolon
DECL|variable|comx_debug_skb
id|EXPORT_SYMBOL
c_func
(paren
id|comx_debug_skb
)paren
suffix:semicolon
DECL|variable|comx_debug_bytes
id|EXPORT_SYMBOL
c_func
(paren
id|comx_debug_bytes
)paren
suffix:semicolon
DECL|variable|comx_debug
id|EXPORT_SYMBOL
c_func
(paren
id|comx_debug
)paren
suffix:semicolon
DECL|variable|comx_lineup_func
id|EXPORT_SYMBOL
c_func
(paren
id|comx_lineup_func
)paren
suffix:semicolon
DECL|variable|comx_status
id|EXPORT_SYMBOL
c_func
(paren
id|comx_status
)paren
suffix:semicolon
DECL|variable|comx_rx
id|EXPORT_SYMBOL
c_func
(paren
id|comx_rx
)paren
suffix:semicolon
DECL|variable|comx_strcasecmp
id|EXPORT_SYMBOL
c_func
(paren
id|comx_strcasecmp
)paren
suffix:semicolon
DECL|variable|comx_root_dir
id|EXPORT_SYMBOL
c_func
(paren
id|comx_root_dir
)paren
suffix:semicolon
eof
