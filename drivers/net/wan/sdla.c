multiline_comment|/*&n; * SDLA&t;&t;An implementation of a driver for the Sangoma S502/S508 series&n; *&t;&t;multi-protocol PC interface card.  Initial offering is with &n; *&t;&t;the DLCI driver, providing Frame Relay support for linux.&n; *&n; *&t;&t;Global definitions for the Frame relay interface.&n; *&n; * Version:&t;@(#)sdla.c   0.30&t;12 Sep 1996&n; *&n; * Credits:&t;Sangoma Technologies, for the use of 2 cards for an extended&n; *&t;&t;&t;period of time.&n; *&t;&t;David Mandelstam &lt;dm@sangoma.com&gt; for getting me started on &n; *&t;&t;&t;this project, and incentive to complete it.&n; *&t;&t;Gene Kozen &lt;74604.152@compuserve.com&gt; for providing me with&n; *&t;&t;&t;important information about the cards.&n; *&n; * Author:&t;Mike McLagan &lt;mike.mclagan@linux.org&gt;&n; *&n; * Changes:&n; *&t;&t;0.15&t;Mike McLagan&t;Improved error handling, packet dropping&n; *&t;&t;0.20&t;Mike McLagan&t;New transmit/receive flags for config&n; *&t;&t;&t;&t;&t;If in FR mode, don&squot;t accept packets from&n; *&t;&t;&t;&t;&t;non DLCI devices.&n; *&t;&t;0.25&t;Mike McLagan&t;Fixed problem with rejecting packets&n; *&t;&t;&t;&t;&t;from non DLCI devices.&n; *&t;&t;0.30&t;Mike McLagan&t;Fixed kernel panic when used with modified&n; *&t;&t;&t;&t;&t;ifconfig&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt; /* for CONFIG_DLCI_MAX */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/if_frad.h&gt;
macro_line|#include &lt;linux/sdla.h&gt;
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;SDLA driver v0.30, 12 Sep 1996, mike.mclagan@linux.org&quot;
suffix:semicolon
DECL|variable|devname
r_static
r_const
r_char
op_star
id|devname
op_assign
l_string|&quot;sdla&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_int
id|valid_port
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x250
comma
l_int|0x270
comma
l_int|0x280
comma
l_int|0x300
comma
l_int|0x350
comma
l_int|0x360
comma
l_int|0x380
comma
l_int|0x390
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_int
id|valid_mem
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0xA0000
comma
l_int|0xA2000
comma
l_int|0xA4000
comma
l_int|0xA6000
comma
l_int|0xA8000
comma
l_int|0xAA000
comma
l_int|0xAC000
comma
l_int|0xAE000
comma
l_int|0xB0000
comma
l_int|0xB2000
comma
l_int|0xB4000
comma
l_int|0xB6000
comma
l_int|0xB8000
comma
l_int|0xBA000
comma
l_int|0xBC000
comma
l_int|0xBE000
comma
l_int|0xC0000
comma
l_int|0xC2000
comma
l_int|0xC4000
comma
l_int|0xC6000
comma
l_int|0xC8000
comma
l_int|0xCA000
comma
l_int|0xCC000
comma
l_int|0xCE000
comma
l_int|0xD0000
comma
l_int|0xD2000
comma
l_int|0xD4000
comma
l_int|0xD6000
comma
l_int|0xD8000
comma
l_int|0xDA000
comma
l_int|0xDC000
comma
l_int|0xDE000
comma
l_int|0xE0000
comma
l_int|0xE2000
comma
l_int|0xE4000
comma
l_int|0xE6000
comma
l_int|0xE8000
comma
l_int|0xEA000
comma
l_int|0xEC000
comma
l_int|0xEE000
)brace
suffix:semicolon
multiline_comment|/*********************************************************&n; *&n; * these are the core routines that access the card itself &n; *&n; *********************************************************/
DECL|macro|SDLA_WINDOW
mdefine_line|#define SDLA_WINDOW(dev,addr) outb((((addr) &gt;&gt; 13) &amp; 0x1F), (dev)-&gt;base_addr + SDLA_REG_Z80_WINDOW)
DECL|function|sdla_read
r_static
r_void
id|sdla_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|addr
comma
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_char
op_star
id|temp
comma
op_star
id|base
suffix:semicolon
r_int
id|offset
comma
id|bytes
suffix:semicolon
id|temp
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
id|offset
op_assign
id|addr
op_amp
id|SDLA_ADDR_MASK
suffix:semicolon
id|bytes
op_assign
id|offset
op_plus
id|len
OG
id|SDLA_WINDOW_SIZE
ques
c_cond
id|SDLA_WINDOW_SIZE
op_minus
id|offset
suffix:colon
id|len
suffix:semicolon
id|base
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
id|offset
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|temp
comma
id|base
comma
id|bytes
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|addr
op_add_assign
id|bytes
suffix:semicolon
id|temp
op_add_assign
id|bytes
suffix:semicolon
id|len
op_sub_assign
id|bytes
suffix:semicolon
)brace
)brace
DECL|function|sdla_write
r_static
r_void
id|sdla_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|addr
comma
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_char
op_star
id|temp
comma
op_star
id|base
suffix:semicolon
r_int
id|offset
comma
id|bytes
suffix:semicolon
id|temp
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
id|offset
op_assign
id|addr
op_amp
id|SDLA_ADDR_MASK
suffix:semicolon
id|bytes
op_assign
id|offset
op_plus
id|len
OG
id|SDLA_WINDOW_SIZE
ques
c_cond
id|SDLA_WINDOW_SIZE
op_minus
id|offset
suffix:colon
id|len
suffix:semicolon
id|base
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
id|offset
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|base
comma
id|temp
comma
id|bytes
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|addr
op_add_assign
id|bytes
suffix:semicolon
id|temp
op_add_assign
id|bytes
suffix:semicolon
id|len
op_sub_assign
id|bytes
suffix:semicolon
)brace
)brace
DECL|function|sdla_clear
r_static
r_void
id|sdla_clear
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_char
op_star
id|base
suffix:semicolon
r_int
id|len
comma
id|addr
comma
id|bytes
suffix:semicolon
id|len
op_assign
l_int|65536
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
id|bytes
op_assign
id|SDLA_WINDOW_SIZE
suffix:semicolon
id|base
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|memset
c_func
(paren
id|base
comma
l_int|0
comma
id|bytes
)paren
suffix:semicolon
id|addr
op_add_assign
id|bytes
suffix:semicolon
id|len
op_sub_assign
id|bytes
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sdla_byte
r_static
r_char
id|sdla_byte
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_char
id|byte
comma
op_star
id|temp
suffix:semicolon
id|temp
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
(paren
id|addr
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|byte
op_assign
op_star
id|temp
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|byte
suffix:semicolon
)brace
DECL|function|sdla_stop
r_void
id|sdla_stop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
id|outb
c_func
(paren
id|SDLA_S502A_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_assign
id|SDLA_HALT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S502E
suffix:colon
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_Z80_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SDLA_S502E_ENABLE
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_assign
id|SDLA_S502E_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
id|flp-&gt;state
op_and_assign
op_complement
id|SDLA_CPUEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|flp-&gt;state
op_and_assign
op_complement
id|SDLA_CPUEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|sdla_start
r_void
id|sdla_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
id|outb
c_func
(paren
id|SDLA_S502A_NMI
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SDLA_S502A_START
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_assign
id|SDLA_S502A_START
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S502E
suffix:colon
id|outb
c_func
(paren
id|SDLA_S502E_CPUEN
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_Z80_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
id|flp-&gt;state
op_or_assign
id|SDLA_CPUEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|flp-&gt;state
op_or_assign
id|SDLA_CPUEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/****************************************************&n; *&n; * this is used for the S502A/E cards to determine&n; * the speed of the onboard CPU.  Calibration is&n; * necessary for the Frame Relay code uploaded &n; * later.  Incorrect results cause timing problems&n; * with link checks &amp; status messages&n; *&n; ***************************************************/
DECL|function|sdla_z80_poll
r_int
id|sdla_z80_poll
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|z80_addr
comma
r_int
id|jiffs
comma
r_char
id|resp1
comma
r_char
id|resp2
)paren
(brace
r_int
r_int
id|start
comma
id|done
comma
id|now
suffix:semicolon
r_char
id|resp
comma
op_star
id|temp
suffix:semicolon
id|start
op_assign
id|now
op_assign
id|jiffies
suffix:semicolon
id|done
op_assign
id|jiffies
op_plus
id|jiffs
suffix:semicolon
id|temp
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
id|temp
op_add_assign
id|z80_addr
op_amp
id|SDLA_ADDR_MASK
suffix:semicolon
id|resp
op_assign
op_complement
id|resp1
suffix:semicolon
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|done
)paren
op_logical_and
(paren
id|resp
op_ne
id|resp1
)paren
op_logical_and
(paren
op_logical_neg
id|resp2
op_logical_or
(paren
id|resp
op_ne
id|resp2
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_ne
id|now
)paren
(brace
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|z80_addr
)paren
suffix:semicolon
id|now
op_assign
id|jiffies
suffix:semicolon
id|resp
op_assign
op_star
id|temp
suffix:semicolon
)brace
)brace
r_return
id|time_before
c_func
(paren
id|jiffies
comma
id|done
)paren
ques
c_cond
id|jiffies
op_minus
id|start
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* constants for Z80 CPU speed */
DECL|macro|Z80_READY
mdefine_line|#define Z80_READY &t;&t;&squot;1&squot;&t;/* Z80 is ready to begin */
DECL|macro|LOADER_READY
mdefine_line|#define LOADER_READY &t;&t;&squot;2&squot;&t;/* driver is ready to begin */
DECL|macro|Z80_SCC_OK
mdefine_line|#define Z80_SCC_OK &t;&t;&squot;3&squot;&t;/* SCC is on board */
DECL|macro|Z80_SCC_BAD
mdefine_line|#define Z80_SCC_BAD&t; &t;&squot;4&squot;&t;/* SCC was not found */
DECL|function|sdla_cpuspeed
r_static
r_int
id|sdla_cpuspeed
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
)paren
(brace
r_int
id|jiffs
suffix:semicolon
r_char
id|data
suffix:semicolon
id|sdla_start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdla_z80_poll
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|3
op_star
id|HZ
comma
id|Z80_READY
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|data
op_assign
id|LOADER_READY
suffix:semicolon
id|sdla_write
c_func
(paren
id|dev
comma
l_int|0
comma
op_amp
id|data
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffs
op_assign
id|sdla_z80_poll
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|8
op_star
id|HZ
comma
id|Z80_SCC_OK
comma
id|Z80_SCC_BAD
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|sdla_stop
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sdla_read
c_func
(paren
id|dev
comma
l_int|0
comma
op_amp
id|data
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
id|Z80_SCC_BAD
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SCC bad&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
op_ne
id|Z80_SCC_OK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|jiffs
OL
l_int|165
)paren
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_16M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|jiffs
OL
l_int|220
)paren
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_10M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|jiffs
OL
l_int|258
)paren
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_8M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|jiffs
OL
l_int|357
)paren
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_7M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|jiffs
OL
l_int|467
)paren
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_5M
suffix:semicolon
r_else
id|ifr-&gt;ifr_mtu
op_assign
id|SDLA_CPU_3M
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/************************************************&n; *&n; *  Direct interaction with the Frame Relay code &n; *  starts here.&n; *&n; ************************************************/
DECL|struct|_dlci_stat
r_struct
id|_dlci_stat
(brace
DECL|member|dlci
r_int
id|dlci
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|flags
r_char
id|flags
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|_frad_stat
r_struct
id|_frad_stat
(brace
DECL|member|flags
r_char
id|flags
suffix:semicolon
DECL|member|dlcis
r_struct
id|_dlci_stat
id|dlcis
(braket
id|SDLA_MAX_DLCI
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|sdla_errors
r_static
r_void
id|sdla_errors
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|cmd
comma
r_int
id|dlci
comma
r_int
id|ret
comma
r_int
id|len
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|_dlci_stat
op_star
id|pstatus
suffix:semicolon
r_int
op_star
id|pdlci
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|state
comma
id|line
(braket
l_int|30
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
id|SDLA_RET_MODEM
suffix:colon
id|state
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
op_star
id|state
op_amp
id|SDLA_MODEM_DCD_LOW
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Modem DCD unexpectedly low!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|state
op_amp
id|SDLA_MODEM_CTS_LOW
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Modem CTS unexpectedly low!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* I should probably do something about this! */
r_break
suffix:semicolon
r_case
id|SDLA_RET_CHANNEL_OFF
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Channel became inoperative!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* same here */
r_break
suffix:semicolon
r_case
id|SDLA_RET_CHANNEL_ON
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Channel became operative!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* same here */
r_break
suffix:semicolon
r_case
id|SDLA_RET_DLCI_STATUS
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Status change reported by Access Node.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
r_struct
id|_dlci_stat
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pstatus
op_assign
id|data
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
comma
id|pstatus
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pstatus-&gt;flags
op_amp
id|SDLA_DLCI_NEW
)paren
id|state
op_assign
l_string|&quot;new&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pstatus-&gt;flags
op_amp
id|SDLA_DLCI_DELETED
)paren
id|state
op_assign
l_string|&quot;deleted&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pstatus-&gt;flags
op_amp
id|SDLA_DLCI_ACTIVE
)paren
id|state
op_assign
l_string|&quot;active&quot;
suffix:semicolon
r_else
(brace
id|sprintf
c_func
(paren
id|line
comma
l_string|&quot;unknown status: %02X&quot;
comma
id|pstatus-&gt;flags
)paren
suffix:semicolon
id|state
op_assign
id|line
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: DLCI %i: %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pstatus-&gt;dlci
comma
id|state
)paren
suffix:semicolon
multiline_comment|/* same here */
)brace
r_break
suffix:semicolon
r_case
id|SDLA_RET_DLCI_UNKNOWN
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Received unknown DLCIs:&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pdlci
op_assign
id|data
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
comma
id|pdlci
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %i&quot;
comma
op_star
id|pdlci
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_RET_TIMEOUT
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Command timed out!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_RET_BUF_OVERSIZE
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Bc/CIR overflow, acceptable size is %i&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_RET_BUF_TOO_BIG
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Buffer size over specified max of %i&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_RET_CHANNEL_INACTIVE
suffix:colon
r_case
id|SDLA_RET_DLCI_INACTIVE
suffix:colon
r_case
id|SDLA_RET_CIR_OVERFLOW
suffix:colon
r_case
id|SDLA_RET_NO_BUFS
suffix:colon
r_if
c_cond
(paren
id|cmd
op_eq
id|SDLA_INFORMATION_WRITE
)paren
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Cmd 0x%2.2X generated return code 0x%2.2X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cmd
comma
id|ret
)paren
suffix:semicolon
multiline_comment|/* Further processing could be done here */
r_break
suffix:semicolon
)brace
)brace
DECL|function|sdla_cmd
r_static
r_int
id|sdla_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|cmd
comma
r_int
id|dlci
comma
r_int
id|flags
comma
r_void
op_star
id|inbuf
comma
r_int
id|inlen
comma
r_void
op_star
id|outbuf
comma
r_int
op_star
id|outlen
)paren
(brace
r_static
r_struct
id|_frad_stat
id|status
suffix:semicolon
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|sdla_cmd
op_star
id|cmd_buf
suffix:semicolon
r_int
r_int
id|pflags
suffix:semicolon
r_int
id|jiffs
comma
id|ret
comma
id|waiting
comma
id|len
suffix:semicolon
r_int
id|window
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|window
op_assign
id|flp-&gt;type
op_eq
id|SDLA_S508
ques
c_cond
id|SDLA_508_CMD_BUF
suffix:colon
id|SDLA_502_CMD_BUF
suffix:semicolon
id|cmd_buf
op_assign
(paren
r_struct
id|sdla_cmd
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
(paren
id|window
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|jiffs
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
multiline_comment|/* 1 second is plenty */
id|save_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|window
)paren
suffix:semicolon
id|cmd_buf-&gt;cmd
op_assign
id|cmd
suffix:semicolon
id|cmd_buf-&gt;dlci
op_assign
id|dlci
suffix:semicolon
id|cmd_buf-&gt;flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|inbuf
)paren
id|memcpy
c_func
(paren
id|cmd_buf-&gt;data
comma
id|inbuf
comma
id|inlen
)paren
suffix:semicolon
id|cmd_buf-&gt;length
op_assign
id|inlen
suffix:semicolon
id|cmd_buf-&gt;opp_flag
op_assign
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
id|waiting
op_assign
l_int|1
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|waiting
op_logical_and
id|time_before_eq
c_func
(paren
id|jiffies
comma
id|jiffs
)paren
)paren
(brace
r_if
c_cond
(paren
id|waiting
op_increment
op_mod
l_int|3
)paren
(brace
id|save_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|window
)paren
suffix:semicolon
id|waiting
op_assign
(paren
(paren
r_volatile
r_int
)paren
(paren
id|cmd_buf-&gt;opp_flag
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|waiting
)paren
(brace
id|save_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|window
)paren
suffix:semicolon
id|ret
op_assign
id|cmd_buf-&gt;retval
suffix:semicolon
id|len
op_assign
id|cmd_buf-&gt;length
suffix:semicolon
r_if
c_cond
(paren
id|outbuf
op_logical_and
id|outlen
)paren
(brace
op_star
id|outlen
op_assign
op_star
id|outlen
op_ge
id|len
ques
c_cond
id|len
suffix:colon
op_star
id|outlen
suffix:semicolon
r_if
c_cond
(paren
op_star
id|outlen
)paren
id|memcpy
c_func
(paren
id|outbuf
comma
id|cmd_buf-&gt;data
comma
op_star
id|outlen
)paren
suffix:semicolon
)brace
multiline_comment|/* This is a local copy that&squot;s used for error handling */
r_if
c_cond
(paren
id|ret
)paren
id|memcpy
c_func
(paren
op_amp
id|status
comma
id|cmd_buf-&gt;data
comma
id|len
OG
r_sizeof
(paren
id|status
)paren
ques
c_cond
r_sizeof
(paren
id|status
)paren
suffix:colon
id|len
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|pflags
)paren
suffix:semicolon
)brace
r_else
id|ret
op_assign
id|SDLA_RET_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|SDLA_RET_OK
)paren
id|sdla_errors
c_func
(paren
id|dev
comma
id|cmd
comma
id|dlci
comma
id|ret
comma
id|len
comma
op_amp
id|status
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/***********************************************&n; *&n; * these functions are called by the DLCI driver &n; *&n; ***********************************************/
r_static
r_int
id|sdla_reconfig
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|sdla_activate
r_int
id|sdla_activate
c_func
(paren
r_struct
id|net_device
op_star
id|slave
comma
r_struct
id|net_device
op_star
id|master
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|flp
op_assign
id|slave-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
op_eq
id|master
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|flp-&gt;dlci
(braket
id|i
)braket
op_assign
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|slave
)paren
op_logical_and
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_NODE
)paren
)paren
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_ACTIVATE_DLCI
comma
l_int|0
comma
l_int|0
comma
op_amp
id|flp-&gt;dlci
(braket
id|i
)braket
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_deactivate
r_int
id|sdla_deactivate
c_func
(paren
r_struct
id|net_device
op_star
id|slave
comma
r_struct
id|net_device
op_star
id|master
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|flp
op_assign
id|slave-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
op_eq
id|master
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|flp-&gt;dlci
(braket
id|i
)braket
op_assign
op_minus
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|slave
)paren
op_logical_and
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_NODE
)paren
)paren
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_DEACTIVATE_DLCI
comma
l_int|0
comma
l_int|0
comma
op_amp
id|flp-&gt;dlci
(braket
id|i
)braket
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_assoc
r_int
id|sdla_assoc
c_func
(paren
r_struct
id|net_device
op_star
id|slave
comma
r_struct
id|net_device
op_star
id|master
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;type
op_ne
id|ARPHRD_DLCI
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|flp
op_assign
id|slave-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;master
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
op_eq
op_star
(paren
r_int
op_star
)paren
(paren
id|master-&gt;dev_addr
)paren
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
r_return
op_minus
id|EMLINK
suffix:semicolon
multiline_comment|/* #### Alan: Comments on this ?? */
id|MOD_INC_USE_COUNT
suffix:semicolon
id|flp-&gt;master
(braket
id|i
)braket
op_assign
id|master
suffix:semicolon
id|flp-&gt;dlci
(braket
id|i
)braket
op_assign
op_minus
op_star
(paren
r_int
op_star
)paren
(paren
id|master-&gt;dev_addr
)paren
suffix:semicolon
id|master-&gt;mtu
op_assign
id|slave-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|slave
)paren
)paren
(brace
r_if
c_cond
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_CPE
)paren
id|sdla_reconfig
c_func
(paren
id|slave
)paren
suffix:semicolon
r_else
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_ADD_DLCI
comma
l_int|0
comma
l_int|0
comma
id|master-&gt;dev_addr
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_deassoc
r_int
id|sdla_deassoc
c_func
(paren
r_struct
id|net_device
op_star
id|slave
comma
r_struct
id|net_device
op_star
id|master
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|flp
op_assign
id|slave-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
op_eq
id|master
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|flp-&gt;master
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|flp-&gt;dlci
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|slave
)paren
)paren
(brace
r_if
c_cond
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_CPE
)paren
id|sdla_reconfig
c_func
(paren
id|slave
)paren
suffix:semicolon
r_else
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_DELETE_DLCI
comma
l_int|0
comma
l_int|0
comma
id|master-&gt;dev_addr
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_dlci_conf
r_int
id|sdla_dlci_conf
c_func
(paren
r_struct
id|net_device
op_star
id|slave
comma
r_struct
id|net_device
op_star
id|master
comma
r_int
id|get
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|dlci_local
op_star
id|dlp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|len
comma
id|ret
suffix:semicolon
id|flp
op_assign
id|slave-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
op_eq
id|master
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dlp
op_assign
id|master-&gt;priv
suffix:semicolon
id|ret
op_assign
id|SDLA_RET_OK
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|dlci_conf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|slave
)paren
)paren
(brace
r_if
c_cond
(paren
id|get
)paren
id|ret
op_assign
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_READ_DLCI_CONFIGURATION
comma
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|dlp-&gt;config
comma
op_amp
id|len
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|sdla_cmd
c_func
(paren
id|slave
comma
id|SDLA_SET_DLCI_CONFIGURATION
comma
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
comma
l_int|0
comma
op_amp
id|dlp-&gt;config
comma
r_sizeof
(paren
r_struct
id|dlci_conf
)paren
op_minus
l_int|4
op_star
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
id|ret
op_eq
id|SDLA_RET_OK
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/**************************&n; *&n; * now for the Linux driver &n; *&n; **************************/
multiline_comment|/* NOTE: the DLCI driver deals with freeing the SKB!! */
DECL|function|sdla_transmit
r_static
r_int
id|sdla_transmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|ret
comma
id|addr
comma
id|accept
comma
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|buf_entry
op_star
id|pbuf
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|accept
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * stupid GateD insists on setting up the multicast router thru us&n;&t; * and we&squot;re ill equipped to handle a non Frame Relay packet at this&n;&t; * time!&n;&t; */
id|accept
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;type
)paren
(brace
r_case
id|ARPHRD_FRAD
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;dev-&gt;type
op_ne
id|ARPHRD_DLCI
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Non DLCI device, type %i, tried to send on FRAD module.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;dev-&gt;type
)paren
suffix:semicolon
id|accept
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: unknown firmware type 0x%4.4X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;type
)paren
suffix:semicolon
id|accept
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|accept
)paren
(brace
multiline_comment|/* this is frame specific, but till there&squot;s a PPP module, it&squot;s the default */
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
r_case
id|SDLA_S502E
suffix:colon
id|ret
op_assign
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_INFORMATION_WRITE
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|skb-&gt;dev-&gt;dev_addr
)paren
comma
l_int|0
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|size
op_assign
r_sizeof
(paren
id|addr
)paren
suffix:semicolon
id|ret
op_assign
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_INFORMATION_WRITE
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|skb-&gt;dev-&gt;dev_addr
)paren
comma
l_int|0
comma
l_int|NULL
comma
id|skb-&gt;len
comma
op_amp
id|addr
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|SDLA_RET_OK
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|pbuf
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
)paren
id|dev-&gt;mem_start
)paren
op_plus
(paren
id|addr
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|sdla_write
c_func
(paren
id|dev
comma
id|pbuf-&gt;buf_addr
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|pbuf-&gt;opp_flag
op_assign
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
id|SDLA_RET_OK
suffix:colon
id|flp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ret
op_assign
id|DLCI_RET_OK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_RET_CIR_OVERFLOW
suffix:colon
r_case
id|SDLA_RET_BUF_OVERSIZE
suffix:colon
r_case
id|SDLA_RET_NO_BUFS
suffix:colon
id|flp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|ret
op_assign
id|DLCI_RET_DROP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|flp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|ret
op_assign
id|DLCI_RET_ERR
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|flp-&gt;master
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sdla_receive
r_static
r_void
id|sdla_receive
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device
op_star
id|master
suffix:semicolon
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|dlci_local
op_star
id|dlp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sdla_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|buf_info
op_star
id|pbufi
suffix:semicolon
r_struct
id|buf_entry
op_star
id|pbuf
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|received
comma
id|success
comma
id|addr
comma
id|buf_base
comma
id|buf_top
suffix:semicolon
r_int
id|dlci
comma
id|len
comma
id|len2
comma
id|split
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|success
op_assign
l_int|1
suffix:semicolon
id|received
op_assign
id|addr
op_assign
id|buf_top
op_assign
id|buf_base
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|dlci
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|master
op_assign
l_int|NULL
suffix:semicolon
id|cmd
op_assign
l_int|NULL
suffix:semicolon
id|pbufi
op_assign
l_int|NULL
suffix:semicolon
id|pbuf
op_assign
l_int|NULL
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
r_case
id|SDLA_S502E
suffix:colon
id|cmd
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
(paren
id|SDLA_502_RCV_BUF
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|SDLA_502_RCV_BUF
)paren
suffix:semicolon
id|success
op_assign
id|cmd-&gt;opp_flag
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|success
)paren
r_break
suffix:semicolon
id|dlci
op_assign
id|cmd-&gt;dlci
suffix:semicolon
id|len
op_assign
id|cmd-&gt;length
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|pbufi
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
(paren
id|SDLA_508_RXBUF_INFO
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|SDLA_508_RXBUF_INFO
)paren
suffix:semicolon
id|pbuf
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
op_plus
(paren
(paren
id|pbufi-&gt;rse_base
op_plus
id|flp-&gt;buffer
op_star
r_sizeof
(paren
r_struct
id|buf_entry
)paren
)paren
op_amp
id|SDLA_ADDR_MASK
)paren
)paren
suffix:semicolon
id|success
op_assign
id|pbuf-&gt;opp_flag
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|success
)paren
r_break
suffix:semicolon
id|buf_top
op_assign
id|pbufi-&gt;buf_top
suffix:semicolon
id|buf_base
op_assign
id|pbufi-&gt;buf_base
suffix:semicolon
id|dlci
op_assign
id|pbuf-&gt;dlci
suffix:semicolon
id|len
op_assign
id|pbuf-&gt;length
suffix:semicolon
id|addr
op_assign
id|pbuf-&gt;buf_addr
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* common code, find the DLCI and get the SKB */
r_if
c_cond
(paren
id|success
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
op_eq
id|dlci
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CONFIG_DLCI_MAX
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Received packet from invalid DLCI %i, ignoring.&quot;
comma
id|dev-&gt;name
comma
id|dlci
)paren
suffix:semicolon
id|flp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|success
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|success
)paren
(brace
id|master
op_assign
id|flp-&gt;master
(braket
id|i
)braket
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
r_sizeof
(paren
r_struct
id|frhdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|flp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|success
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|skb_reserve
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|frhdr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* pick up the data */
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
r_case
id|SDLA_S502E
suffix:colon
r_if
c_cond
(paren
id|success
)paren
id|sdla_read
c_func
(paren
id|dev
comma
id|SDLA_502_RCV_BUF
op_plus
id|SDLA_502_DATA_OFS
comma
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|len
)paren
suffix:semicolon
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|SDLA_502_RCV_BUF
)paren
suffix:semicolon
id|cmd-&gt;opp_flag
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
r_if
c_cond
(paren
id|success
)paren
(brace
multiline_comment|/* is this buffer split off the end of the internal ring buffer */
id|split
op_assign
id|addr
op_plus
id|len
OG
id|buf_top
op_plus
l_int|1
ques
c_cond
id|len
op_minus
(paren
id|buf_top
op_minus
id|addr
op_plus
l_int|1
)paren
suffix:colon
l_int|0
suffix:semicolon
id|len2
op_assign
id|len
op_minus
id|split
suffix:semicolon
id|sdla_read
c_func
(paren
id|dev
comma
id|addr
comma
id|skb_put
c_func
(paren
id|skb
comma
id|len2
)paren
comma
id|len2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|split
)paren
id|sdla_read
c_func
(paren
id|dev
comma
id|buf_base
comma
id|skb_put
c_func
(paren
id|skb
comma
id|split
)paren
comma
id|split
)paren
suffix:semicolon
)brace
multiline_comment|/* increment the buffer we&squot;re looking at */
id|SDLA_WINDOW
c_func
(paren
id|dev
comma
id|SDLA_508_RXBUF_INFO
)paren
suffix:semicolon
id|flp-&gt;buffer
op_assign
(paren
id|flp-&gt;buffer
op_plus
l_int|1
)paren
op_mod
id|pbufi-&gt;rse_num
suffix:semicolon
id|pbuf-&gt;opp_flag
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|success
)paren
(brace
id|flp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|dlp
op_assign
id|master-&gt;priv
suffix:semicolon
(paren
op_star
id|dlp-&gt;receive
)paren
(paren
id|skb
comma
id|master
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sdla_isr
r_static
r_void
id|sdla_isr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_char
id|byte
suffix:semicolon
id|dev
op_assign
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sdla_isr(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;initialized
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: irq %d for uninitialized device.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|byte
op_assign
id|sdla_byte
c_func
(paren
id|dev
comma
id|flp-&gt;type
op_eq
id|SDLA_S508
ques
c_cond
id|SDLA_508_IRQ_INTERFACE
suffix:colon
id|SDLA_502_IRQ_INTERFACE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|byte
)paren
(brace
r_case
id|SDLA_INTR_RX
suffix:colon
id|sdla_receive
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* the command will get an error return, which is processed above */
r_case
id|SDLA_INTR_MODEM
suffix:colon
r_case
id|SDLA_INTR_STATUS
suffix:colon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_READ_DLC_STATUS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_INTR_TX
suffix:colon
r_case
id|SDLA_INTR_COMPLETE
suffix:colon
r_case
id|SDLA_INTR_TIMER
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: invalid irq flag 0x%02X.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|byte
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* the S502E requires a manual acknowledgement of the interrupt */
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_S502E
)paren
(brace
id|flp-&gt;state
op_and_assign
op_complement
id|SDLA_S502E_INTACK
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_or_assign
id|SDLA_S502E_INTACK
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
)brace
multiline_comment|/* this clears the byte, informing the Z80 we&squot;re done */
id|byte
op_assign
l_int|0
suffix:semicolon
id|sdla_write
c_func
(paren
id|dev
comma
id|flp-&gt;type
op_eq
id|SDLA_S508
ques
c_cond
id|SDLA_508_IRQ_INTERFACE
suffix:colon
id|SDLA_502_IRQ_INTERFACE
comma
op_amp
id|byte
comma
r_sizeof
(paren
id|byte
)paren
)paren
suffix:semicolon
)brace
DECL|function|sdla_poll
r_static
r_void
id|sdla_poll
c_func
(paren
r_int
r_int
id|device
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|device
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|sdla_byte
c_func
(paren
id|dev
comma
id|SDLA_502_RCV_BUF
)paren
)paren
id|sdla_receive
c_func
(paren
id|dev
)paren
suffix:semicolon
id|flp-&gt;timer.expires
op_assign
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|flp-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|sdla_close
r_static
r_int
id|sdla_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|intr_info
id|intr
suffix:semicolon
r_int
id|len
comma
id|i
suffix:semicolon
r_int
id|dlcis
(braket
id|CONFIG_DLCI_MAX
)braket
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
id|dlcis
(braket
id|len
op_increment
)braket
op_assign
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
suffix:semicolon
id|len
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_NODE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
OG
l_int|0
)paren
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_DEACTIVATE_DLCI
comma
l_int|0
comma
l_int|0
comma
id|dlcis
comma
id|len
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_DELETE_DLCI
comma
l_int|0
comma
l_int|0
comma
op_amp
id|flp-&gt;dlci
(braket
id|i
)braket
comma
r_sizeof
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|intr
comma
l_int|0
comma
r_sizeof
(paren
id|intr
)paren
)paren
suffix:semicolon
multiline_comment|/* let&squot;s start up the reception */
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|flp-&gt;timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S502E
suffix:colon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_IRQ_TRIGGER
comma
l_int|0
comma
l_int|0
comma
op_amp
id|intr
comma
r_sizeof
(paren
r_char
)paren
op_plus
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|flp-&gt;state
op_and_assign
op_complement
id|SDLA_S502E_INTACK
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_IRQ_TRIGGER
comma
l_int|0
comma
l_int|0
comma
op_amp
id|intr
comma
r_sizeof
(paren
r_struct
id|intr_info
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|flp-&gt;state
op_and_assign
op_complement
id|SDLA_S508_INTEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_DISABLE_COMMUNICATIONS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|conf_data
r_struct
id|conf_data
(brace
DECL|member|config
r_struct
id|frad_conf
id|config
suffix:semicolon
DECL|member|dlci
r_int
id|dlci
(braket
id|CONFIG_DLCI_MAX
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|sdla_open
r_static
r_int
id|sdla_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|dlci_local
op_star
id|dlp
suffix:semicolon
r_struct
id|conf_data
id|data
suffix:semicolon
r_struct
id|intr_info
id|intr
suffix:semicolon
r_int
id|len
comma
id|i
suffix:semicolon
r_char
id|byte
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;initialized
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;configured
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* time to send in the configuration */
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
id|data.dlci
(braket
id|len
op_increment
)braket
op_assign
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
suffix:semicolon
id|len
op_mul_assign
l_int|2
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|data.config
comma
op_amp
id|flp-&gt;config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
id|len
op_add_assign
r_sizeof
(paren
r_struct
id|frad_conf
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_DISABLE_COMMUNICATIONS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_DLCI_CONFIGURATION
comma
l_int|0
comma
l_int|0
comma
op_amp
id|data
comma
id|len
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_S508
)paren
id|flp-&gt;buffer
op_assign
l_int|0
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_ENABLE_COMMUNICATIONS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* let&squot;s start up the reception */
id|memset
c_func
(paren
op_amp
id|intr
comma
l_int|0
comma
r_sizeof
(paren
id|intr
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
id|flp-&gt;timer.expires
op_assign
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|flp-&gt;timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S502E
suffix:colon
id|flp-&gt;state
op_or_assign
id|SDLA_S502E_ENABLE
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;state
op_or_assign
id|SDLA_S502E_INTACK
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|byte
op_assign
l_int|0
suffix:semicolon
id|sdla_write
c_func
(paren
id|dev
comma
id|SDLA_502_IRQ_INTERFACE
comma
op_amp
id|byte
comma
r_sizeof
(paren
id|byte
)paren
)paren
suffix:semicolon
id|intr.flags
op_assign
id|SDLA_INTR_RX
op_or
id|SDLA_INTR_STATUS
op_or
id|SDLA_INTR_MODEM
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_IRQ_TRIGGER
comma
l_int|0
comma
l_int|0
comma
op_amp
id|intr
comma
r_sizeof
(paren
r_char
)paren
op_plus
r_sizeof
(paren
r_int
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|flp-&gt;state
op_or_assign
id|SDLA_S508_INTEN
suffix:semicolon
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|byte
op_assign
l_int|0
suffix:semicolon
id|sdla_write
c_func
(paren
id|dev
comma
id|SDLA_508_IRQ_INTERFACE
comma
op_amp
id|byte
comma
r_sizeof
(paren
id|byte
)paren
)paren
suffix:semicolon
id|intr.flags
op_assign
id|SDLA_INTR_RX
op_or
id|SDLA_INTR_STATUS
op_or
id|SDLA_INTR_MODEM
suffix:semicolon
id|intr.irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_IRQ_TRIGGER
comma
l_int|0
comma
l_int|0
comma
op_amp
id|intr
comma
r_sizeof
(paren
r_struct
id|intr_info
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flp-&gt;config.station
op_eq
id|FRAD_STATION_CPE
)paren
(brace
id|byte
op_assign
id|SDLA_ICS_STATUS_ENQ
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_ISSUE_IN_CHANNEL_SIGNAL
comma
l_int|0
comma
l_int|0
comma
op_amp
id|byte
comma
r_sizeof
(paren
id|byte
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_ADD_DLCI
comma
l_int|0
comma
l_int|0
comma
id|data.dlci
comma
id|len
op_minus
r_sizeof
(paren
r_struct
id|frad_conf
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
OG
l_int|0
)paren
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_ACTIVATE_DLCI
comma
l_int|0
comma
l_int|0
comma
op_amp
id|flp-&gt;dlci
(braket
id|i
)braket
comma
l_int|2
op_star
r_sizeof
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* configure any specific DLCI settings */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
(brace
id|dlp
op_assign
id|flp-&gt;master
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|dlp-&gt;configured
)paren
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_DLCI_CONFIGURATION
comma
id|abs
c_func
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
comma
l_int|0
comma
op_amp
id|dlp-&gt;config
comma
r_sizeof
(paren
r_struct
id|dlci_conf
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_config
r_static
r_int
id|sdla_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|frad_conf
op_star
id|conf
comma
r_int
id|get
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|conf_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
l_int|0xFFFF
)paren
r_return
op_minus
id|EUNATCH
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get
)paren
(brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|data.config
comma
id|conf
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data.config.station
op_amp
op_complement
id|FRAD_STATION_NODE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|data.config.flags
op_amp
op_complement
id|FRAD_VALID_FLAGS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.kbaud
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|data.config.kbaud
OG
l_int|128
)paren
op_logical_and
(paren
id|flp-&gt;type
op_ne
id|SDLA_S508
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|data.config.clocking
op_amp
op_complement
(paren
id|FRAD_CLOCK_INT
op_or
id|SDLA_S508_PORT_RS232
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.mtu
OL
l_int|0
)paren
op_logical_or
(paren
id|data.config.mtu
OG
id|SDLA_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.T391
OL
l_int|5
)paren
op_logical_or
(paren
id|data.config.T391
OG
l_int|30
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.T392
OL
l_int|5
)paren
op_logical_or
(paren
id|data.config.T392
OG
l_int|30
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.N391
OL
l_int|1
)paren
op_logical_or
(paren
id|data.config.N391
OG
l_int|255
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.N392
OL
l_int|1
)paren
op_logical_or
(paren
id|data.config.N392
OG
l_int|10
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data.config.N393
OL
l_int|1
)paren
op_logical_or
(paren
id|data.config.N393
OG
l_int|10
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|flp-&gt;config
comma
op_amp
id|data.config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
id|flp-&gt;config.flags
op_or_assign
id|SDLA_DIRECT_RECV
suffix:semicolon
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_S508
)paren
id|flp-&gt;config.flags
op_or_assign
id|SDLA_TX70_RX30
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mtu
op_ne
id|flp-&gt;config.mtu
)paren
(brace
multiline_comment|/* this is required to change the MTU */
id|dev-&gt;mtu
op_assign
id|flp-&gt;config.mtu
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;master
(braket
id|i
)braket
)paren
id|flp-&gt;master
(braket
id|i
)braket
op_member_access_from_pointer
id|mtu
op_assign
id|flp-&gt;config.mtu
suffix:semicolon
)brace
id|flp-&gt;config.mtu
op_add_assign
r_sizeof
(paren
r_struct
id|frhdr
)paren
suffix:semicolon
multiline_comment|/* off to the races! */
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;configured
)paren
id|sdla_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|flp-&gt;configured
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* no sense reading if the CPU isn&squot;t started */
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|size
op_assign
r_sizeof
(paren
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_READ_DLCI_CONFIGURATION
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|data
comma
op_amp
id|size
)paren
op_ne
id|SDLA_RET_OK
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|flp-&gt;configured
)paren
id|memcpy
c_func
(paren
op_amp
id|data.config
comma
op_amp
id|flp-&gt;config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
r_else
id|memset
c_func
(paren
op_amp
id|data.config
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|flp-&gt;config
comma
op_amp
id|data.config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
id|data.config.flags
op_and_assign
id|FRAD_VALID_FLAGS
suffix:semicolon
id|data.config.mtu
op_sub_assign
id|data.config.mtu
OG
r_sizeof
(paren
r_struct
id|frhdr
)paren
ques
c_cond
r_sizeof
(paren
r_struct
id|frhdr
)paren
suffix:colon
id|data.config.mtu
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|conf
comma
op_amp
id|data.config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
ques
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_xfer
r_static
r_int
id|sdla_xfer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sdla_mem
op_star
id|info
comma
r_int
id|read
)paren
(brace
r_struct
id|sdla_mem
id|mem
suffix:semicolon
r_char
op_star
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mem
comma
id|info
comma
r_sizeof
(paren
id|mem
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|read
)paren
(brace
id|temp
op_assign
id|kmalloc
c_func
(paren
id|mem.len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sdla_read
c_func
(paren
id|dev
comma
id|mem.addr
comma
id|temp
comma
id|mem.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|mem.data
comma
id|temp
comma
id|mem.len
)paren
)paren
(brace
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|kmalloc
c_func
(paren
id|mem.len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|temp
comma
id|mem.data
comma
id|mem.len
)paren
)paren
(brace
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sdla_write
c_func
(paren
id|dev
comma
id|mem.addr
comma
id|temp
comma
id|mem.len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|temp
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_reconfig
r_static
r_int
id|sdla_reconfig
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_struct
id|conf_data
id|data
suffix:semicolon
r_int
id|i
comma
id|len
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_DLCI_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|flp-&gt;dlci
(braket
id|i
)braket
)paren
id|data.dlci
(braket
id|len
op_increment
)braket
op_assign
id|flp-&gt;dlci
(braket
id|i
)braket
suffix:semicolon
id|len
op_mul_assign
l_int|2
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|data
comma
op_amp
id|flp-&gt;config
comma
r_sizeof
(paren
r_struct
id|frad_conf
)paren
)paren
suffix:semicolon
id|len
op_add_assign
r_sizeof
(paren
r_struct
id|frad_conf
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_DISABLE_COMMUNICATIONS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_SET_DLCI_CONFIGURATION
comma
l_int|0
comma
l_int|0
comma
op_amp
id|data
comma
id|len
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sdla_cmd
c_func
(paren
id|dev
comma
id|SDLA_ENABLE_COMMUNICATIONS
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_ioctl
r_static
r_int
id|sdla_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flp-&gt;initialized
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FRAD_GET_CONF
suffix:colon
r_case
id|FRAD_SET_CONF
suffix:colon
r_return
id|sdla_config
c_func
(paren
id|dev
comma
(paren
r_struct
id|frad_conf
op_star
)paren
id|ifr-&gt;ifr_data
comma
id|cmd
op_eq
id|FRAD_GET_CONF
)paren
suffix:semicolon
r_case
id|SDLA_IDENTIFY
suffix:colon
id|ifr-&gt;ifr_flags
op_assign
id|flp-&gt;type
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_CPUSPEED
suffix:colon
r_return
id|sdla_cpuspeed
c_func
(paren
id|dev
comma
id|ifr
)paren
suffix:semicolon
multiline_comment|/* ==========================================================&n;NOTE:  This is rather a useless action right now, as the&n;       current driver does not support protocols other than&n;       FR.  However, Sangoma has modules for a number of&n;       other protocols in the works.&n;============================================================*/
r_case
id|SDLA_PROTOCOL
suffix:colon
r_if
c_cond
(paren
id|flp-&gt;configured
)paren
r_return
op_minus
id|EALREADY
suffix:semicolon
r_switch
c_cond
(paren
id|ifr-&gt;ifr_flags
)paren
(brace
r_case
id|ARPHRD_FRAD
suffix:colon
id|dev-&gt;type
op_assign
id|ifr-&gt;ifr_flags
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SDLA_CLEARMEM
suffix:colon
id|sdla_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_WRITEMEM
suffix:colon
r_case
id|SDLA_READMEM
suffix:colon
r_return
id|sdla_xfer
c_func
(paren
id|dev
comma
(paren
r_struct
id|sdla_mem
op_star
)paren
id|ifr-&gt;ifr_data
comma
id|cmd
op_eq
id|SDLA_READMEM
)paren
suffix:semicolon
r_case
id|SDLA_START
suffix:colon
id|sdla_start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_STOP
suffix:colon
id|sdla_stop
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_change_mtu
r_int
id|sdla_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* for now, you can&squot;t change the MTU! */
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sdla_set_config
r_int
id|sdla_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|byte
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|flp-&gt;initialized
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|valid_port
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|valid_port
(braket
id|i
)braket
op_eq
id|map-&gt;base_addr
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
r_sizeof
(paren
id|valid_port
)paren
op_div
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|map-&gt;base_addr
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|SDLA_IO_EXTENTS
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* test for card types, S502A, S502E, S507, S508                 */
multiline_comment|/* these tests shut down the card completely, so clear the state */
id|flp-&gt;type
op_assign
id|SDLA_UNKNOWN
suffix:semicolon
id|flp-&gt;state
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|SDLA_IO_EXTENTS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|i
)paren
op_ne
l_int|0xFF
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|SDLA_IO_EXTENTS
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_Z80_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_amp
l_int|0x0F
)paren
op_eq
l_int|0x08
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S502E_INTACK
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_amp
l_int|0x0F
)paren
op_eq
l_int|0x0C
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;type
op_assign
id|SDLA_S502E
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_UNKNOWN
)paren
(brace
r_for
c_loop
(paren
id|byte
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
)paren
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SDLA_IO_EXTENTS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|i
)paren
op_ne
id|byte
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|SDLA_IO_EXTENTS
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_amp
l_int|0x7E
)paren
op_eq
l_int|0x30
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S507_ENABLE
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_amp
l_int|0x7E
)paren
op_eq
l_int|0x32
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;type
op_assign
id|SDLA_S507
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_UNKNOWN
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S508_STS
)paren
op_amp
l_int|0x3F
)paren
op_eq
l_int|0x00
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S508_INTEN
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S508_STS
)paren
op_amp
l_int|0x3F
)paren
op_eq
l_int|0x10
)paren
(brace
id|outb
c_func
(paren
id|SDLA_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;type
op_assign
id|SDLA_S508
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_UNKNOWN
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S502A_HALT
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_eq
l_int|0x40
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S502A_START
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_eq
l_int|0x40
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S502A_INTEN
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|SDLA_S502_STS
)paren
op_eq
l_int|0x44
)paren
(brace
id|outb
c_func
(paren
id|SDLA_S502A_START
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;type
op_assign
id|SDLA_S502A
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_UNKNOWN
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Unknown card type&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|dev-&gt;base_addr
)paren
(brace
r_case
l_int|0x270
suffix:colon
r_case
l_int|0x280
suffix:colon
r_case
l_int|0x380
suffix:colon
r_case
l_int|0x390
suffix:colon
r_if
c_cond
(paren
(paren
id|flp-&gt;type
op_ne
id|SDLA_S508
)paren
op_logical_and
(paren
id|flp-&gt;type
op_ne
id|SDLA_S507
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|map-&gt;irq
)paren
(brace
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|flp-&gt;type
op_ne
id|SDLA_S502E
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
r_case
l_int|11
suffix:colon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
(paren
id|flp-&gt;type
op_ne
id|SDLA_S508
)paren
op_logical_and
(paren
id|flp-&gt;type
op_ne
id|SDLA_S507
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
l_int|3
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|7
suffix:colon
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_S502A
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev-&gt;irq
op_assign
id|map-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|sdla_isr
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|flp-&gt;type
op_eq
id|SDLA_S507
)paren
(brace
r_switch
c_cond
(paren
id|dev-&gt;irq
)paren
(brace
r_case
l_int|3
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ11
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S507_IRQ15
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|valid_mem
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|valid_mem
(braket
id|i
)braket
op_eq
id|map-&gt;mem_start
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
r_sizeof
(paren
id|valid_mem
)paren
op_div
r_sizeof
(paren
r_int
)paren
)paren
multiline_comment|/*&n;&t; *&t;FIXME:&n;&t; *&t;BUG BUG BUG: MUST RELEASE THE IRQ WE ALLOCATED IN&n;&t; *&t;ALL THESE CASES&n;&t; *&n;&t; */
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flp-&gt;type
op_eq
id|SDLA_S502A
)paren
op_logical_and
(paren
(paren
(paren
id|map-&gt;mem_start
op_amp
l_int|0xF000
)paren
op_rshift
l_int|12
)paren
op_eq
l_int|0x0E
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flp-&gt;type
op_ne
id|SDLA_S507
)paren
op_logical_and
(paren
(paren
id|map-&gt;mem_start
op_rshift
l_int|16
)paren
op_eq
l_int|0x0B
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flp-&gt;type
op_eq
id|SDLA_S507
)paren
op_logical_and
(paren
(paren
id|map-&gt;mem_start
op_rshift
l_int|16
)paren
op_eq
l_int|0x0D
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|map-&gt;mem_start
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|dev-&gt;mem_start
op_plus
l_int|0x2000
suffix:semicolon
id|byte
op_assign
id|flp-&gt;type
op_ne
id|SDLA_S508
ques
c_cond
id|SDLA_8K_WINDOW
suffix:colon
l_int|0
suffix:semicolon
id|byte
op_or_assign
(paren
id|map-&gt;mem_start
op_amp
l_int|0xF000
)paren
op_rshift
(paren
l_int|12
op_plus
(paren
id|flp-&gt;type
op_eq
id|SDLA_S508
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502A
suffix:colon
r_case
id|SDLA_S502E
suffix:colon
r_switch
c_cond
(paren
id|map-&gt;mem_start
op_rshift
l_int|16
)paren
(brace
r_case
l_int|0x0A
suffix:colon
id|byte
op_or_assign
id|SDLA_S502_SEG_A
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0C
suffix:colon
id|byte
op_or_assign
id|SDLA_S502_SEG_C
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0D
suffix:colon
id|byte
op_or_assign
id|SDLA_S502_SEG_D
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0E
suffix:colon
id|byte
op_or_assign
id|SDLA_S502_SEG_E
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
r_switch
c_cond
(paren
id|map-&gt;mem_start
op_rshift
l_int|16
)paren
(brace
r_case
l_int|0x0A
suffix:colon
id|byte
op_or_assign
id|SDLA_S507_SEG_A
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0B
suffix:colon
id|byte
op_or_assign
id|SDLA_S507_SEG_B
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0C
suffix:colon
id|byte
op_or_assign
id|SDLA_S507_SEG_C
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0E
suffix:colon
id|byte
op_or_assign
id|SDLA_S507_SEG_E
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
r_switch
c_cond
(paren
id|map-&gt;mem_start
op_rshift
l_int|16
)paren
(brace
r_case
l_int|0x0A
suffix:colon
id|byte
op_or_assign
id|SDLA_S508_SEG_A
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0C
suffix:colon
id|byte
op_or_assign
id|SDLA_S508_SEG_C
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0D
suffix:colon
id|byte
op_or_assign
id|SDLA_S508_SEG_D
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0E
suffix:colon
id|byte
op_or_assign
id|SDLA_S508_SEG_E
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* set the memory bits, and enable access */
id|outb
c_func
(paren
id|byte
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_PC_WINDOW
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flp-&gt;type
)paren
(brace
r_case
id|SDLA_S502E
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_S502E_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S507
suffix:colon
id|flp-&gt;state
op_or_assign
id|SDLA_MEMEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SDLA_S508
suffix:colon
id|flp-&gt;state
op_assign
id|SDLA_MEMEN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outb
c_func
(paren
id|flp-&gt;state
comma
id|dev-&gt;base_addr
op_plus
id|SDLA_REG_CONTROL
)paren
suffix:semicolon
id|flp-&gt;initialized
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_stats
r_static
r_struct
id|net_device_stats
op_star
id|sdla_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
id|flp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|flp-&gt;stats
suffix:semicolon
)brace
DECL|function|sdla_init
r_int
id|__init
id|sdla_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|frad_local
op_star
id|flp
suffix:semicolon
multiline_comment|/* allocate the private data structure */
id|flp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|frad_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|flp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|frad_local
)paren
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|flp
suffix:semicolon
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;open
op_assign
id|sdla_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|sdla_close
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|sdla_ioctl
suffix:semicolon
id|dev-&gt;set_config
op_assign
id|sdla_set_config
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|sdla_stats
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|sdla_transmit
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|sdla_change_mtu
suffix:semicolon
id|dev-&gt;type
op_assign
l_int|0xFFFF
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|SDLA_MAX_MTU
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|flp-&gt;activate
op_assign
id|sdla_activate
suffix:semicolon
id|flp-&gt;deactivate
op_assign
id|sdla_deactivate
suffix:semicolon
id|flp-&gt;assoc
op_assign
id|sdla_assoc
suffix:semicolon
id|flp-&gt;deassoc
op_assign
id|sdla_deassoc
suffix:semicolon
id|flp-&gt;dlci_conf
op_assign
id|sdla_dlci_conf
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|flp-&gt;timer
)paren
suffix:semicolon
id|flp-&gt;timer.expires
op_assign
l_int|1
suffix:semicolon
id|flp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|flp-&gt;timer.function
op_assign
id|sdla_poll
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdla_c_setup
r_int
id|__init
id|sdla_c_setup
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s.&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|register_frad
c_func
(paren
id|devname
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|sdla0
r_static
r_struct
id|net_device
id|sdla0
op_assign
(brace
l_string|&quot;sdla0&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sdla_init
)brace
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|result
suffix:semicolon
id|sdla_c_setup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|register_netdev
c_func
(paren
op_amp
id|sdla0
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|result
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|sdla0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdla0.priv
)paren
id|kfree
c_func
(paren
id|sdla0.priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdla0.irq
)paren
id|free_irq
c_func
(paren
id|sdla0.irq
comma
op_amp
id|sdla0
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
