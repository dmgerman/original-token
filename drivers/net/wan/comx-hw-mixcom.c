multiline_comment|/* &n; * Hardware driver for the MixCom synchronous serial board &n; *&n; * Author: Gergely Madarasz &lt;gorgo@itc.hu&gt;&n; *&n; * based on skeleton driver code and a preliminary hscx driver by &n; * Tivadar Szemethy &lt;tiv@itc.hu&gt;&n; *&n; * Copyright (C) 1998-1999 ITConsult-Pro Co. &lt;info@itc.hu&gt;&n; *&n; * Contributors:&n; * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; (0.65)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; *&n; * Version 0.60 (99/06/11):&n; *&t;&t;- ported to the kernel, now works as builtin code&n; *&n; * Version 0.61 (99/06/11):&n; *&t;&t;- recognize the one-channel MixCOM card (id byte = 0x13)&n; *&t;&t;- printk fixes&n; * &n; * Version 0.62 (99/07/15):&n; *&t;&t;- fixes according to the new hw docs &n; *&t;&t;- report line status when open&n; *&n; * Version 0.63 (99/09/21):&n; *&t;&t;- line status report fixes&n; *&n; * Version 0.64 (99/12/01):&n; *&t;&t;- some more cosmetical fixes&n; *&n; * Version 0.65 (00/08/15)&n; *&t;&t;- resource release on failure at MIXCOM_init&n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;0.65&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/types.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;comx.h&quot;
macro_line|#include &quot;mixcom.h&quot;
macro_line|#include &quot;hscx.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gergely Madarasz &lt;gorgo@itc.hu&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Hardware-level driver for the serial port of the MixCom board&quot;
)paren
suffix:semicolon
DECL|macro|MIXCOM_DATA
mdefine_line|#define MIXCOM_DATA(d) ((struct mixcom_privdata *)(COMX_CHANNEL(d)-&gt; &bslash;&n;&t;HW_privdata))
DECL|macro|MIXCOM_BOARD_BASE
mdefine_line|#define MIXCOM_BOARD_BASE(d) (d-&gt;base_addr - MIXCOM_SERIAL_OFFSET - &bslash;&n;&t;(1 - MIXCOM_DATA(d)-&gt;channel) * MIXCOM_CHANNEL_OFFSET)
DECL|macro|MIXCOM_DEV_BASE
mdefine_line|#define MIXCOM_DEV_BASE(port,channel) (port + MIXCOM_SERIAL_OFFSET + &bslash;&n;&t;(1 - channel) * MIXCOM_CHANNEL_OFFSET)
multiline_comment|/* Values used to set the IRQ line */
DECL|variable|mixcom_set_irq
r_static
r_int
r_char
id|mixcom_set_irq
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|variable|hscx_versions
r_static
r_int
r_char
op_star
id|hscx_versions
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|struct|mixcom_privdata
r_struct
id|mixcom_privdata
(brace
DECL|member|clock
id|u16
id|clock
suffix:semicolon
DECL|member|channel
r_char
id|channel
suffix:semicolon
DECL|member|txbusy
r_int
id|txbusy
suffix:semicolon
DECL|member|sending
r_struct
id|sk_buff
op_star
id|sending
suffix:semicolon
DECL|member|tx_ptr
r_int
id|tx_ptr
suffix:semicolon
DECL|member|recving
r_struct
id|sk_buff
op_star
id|recving
suffix:semicolon
DECL|member|rx_ptr
r_int
id|rx_ptr
suffix:semicolon
DECL|member|status
r_int
r_char
id|status
suffix:semicolon
DECL|member|card_has_status
r_char
id|card_has_status
suffix:semicolon
)brace
suffix:semicolon
DECL|function|wr_hscx
r_static
r_inline
r_void
id|wr_hscx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|reg
comma
r_int
r_char
id|val
)paren
(brace
id|outb
c_func
(paren
id|val
comma
id|dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|rd_hscx
r_static
r_inline
r_int
r_char
id|rd_hscx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|reg
)paren
(brace
r_return
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|hscx_cmd
r_static
r_inline
r_void
id|hscx_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|cmd
)paren
(brace
r_int
r_int
id|jiffs
op_assign
id|jiffies
suffix:semicolon
r_int
r_char
id|cec
suffix:semicolon
r_int
id|delay
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cec
op_assign
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_STAR
)paren
op_amp
id|HSCX_CEC
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|jiffs
op_plus
id|HZ
OG
id|jiffies
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|delay
OG
(paren
l_int|100000
op_div
id|HZ
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cec
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: CEC stuck, probably no clock!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_CMDR
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
DECL|function|hscx_fill_fifo
r_static
r_inline
r_void
id|hscx_fill_fifo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_register
id|word
id|to_send
op_assign
id|hw-&gt;sending-&gt;len
op_minus
id|hw-&gt;tx_ptr
suffix:semicolon
id|outsb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|HSCX_FIFO
comma
op_amp
(paren
id|hw-&gt;sending-&gt;data
(braket
id|hw-&gt;tx_ptr
)braket
)paren
comma
id|min
c_func
(paren
id|to_send
comma
l_int|32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|to_send
op_le
l_int|32
)paren
(brace
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_XTF
op_or
id|HSCX_XME
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|hw-&gt;sending
)paren
suffix:semicolon
id|hw-&gt;sending
op_assign
l_int|NULL
suffix:semicolon
id|hw-&gt;tx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_XTF
)paren
suffix:semicolon
id|hw-&gt;tx_ptr
op_add_assign
l_int|32
suffix:semicolon
)brace
)brace
DECL|function|hscx_empty_fifo
r_static
r_inline
r_void
id|hscx_empty_fifo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|cnt
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;recving
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|hw-&gt;recving
op_assign
id|dev_alloc_skb
c_func
(paren
id|HSCX_MTU
op_plus
l_int|16
)paren
)paren
)paren
(brace
id|ch-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_RHR
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_reserve
c_func
(paren
id|hw-&gt;recving
comma
l_int|16
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|hw-&gt;recving
comma
id|HSCX_MTU
)paren
suffix:semicolon
)brace
id|hw-&gt;rx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
OG
l_int|32
op_logical_or
op_logical_neg
id|cnt
op_logical_or
id|hw-&gt;recving
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hscx_empty_fifo: cnt is %d, hw-&gt;recving %p&bslash;n&quot;
comma
id|cnt
comma
(paren
r_void
op_star
)paren
id|hw-&gt;recving
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|insb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|HSCX_FIFO
comma
op_amp
(paren
id|hw-&gt;recving-&gt;data
(braket
id|hw-&gt;rx_ptr
)braket
)paren
comma
id|cnt
)paren
suffix:semicolon
id|hw-&gt;rx_ptr
op_add_assign
id|cnt
suffix:semicolon
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_RMC
)paren
suffix:semicolon
)brace
DECL|function|MIXCOM_txe
r_static
r_int
id|MIXCOM_txe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_return
op_logical_neg
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|hw-&gt;txbusy
)paren
suffix:semicolon
)brace
DECL|function|mixcom_probe
r_static
r_int
id|mixcom_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|id
comma
id|vstr
comma
id|ret
op_assign
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|id
op_assign
id|inb_p
c_func
(paren
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
op_plus
id|MIXCOM_ID_OFFSET
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
id|MIXCOM_ID
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no MixCOM board found at 0x%04lx&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|vstr
op_assign
id|inb_p
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|HSCX_VSTR
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|vstr
op_ge
r_sizeof
(paren
id|hscx_versions
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
op_logical_or
id|hscx_versions
(braket
id|vstr
)braket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: board found but no HSCX chip detected at 0x%4lx (vstr = 0x%1x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|vstr
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: HSCX chip version %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|hscx_versions
(braket
id|vstr
)braket
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
id|out
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|MIXCOM_set_clock
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;clock
)paren
(brace
suffix:semicolon
)brace
r_else
(brace
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|mixcom_board_on
r_static
r_void
id|mixcom_board_on
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
id|MIXCOM_OFF
comma
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
op_plus
id|MIXCOM_IT_OFFSET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|mixcom_set_irq
(braket
id|dev-&gt;irq
)braket
op_or
id|MIXCOM_ON
comma
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
op_plus
id|MIXCOM_IT_OFFSET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
DECL|function|mixcom_board_off
r_static
r_void
id|mixcom_board_off
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
id|MIXCOM_OFF
comma
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
op_plus
id|MIXCOM_IT_OFFSET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
DECL|function|mixcom_off
r_static
r_void
id|mixcom_off
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_CCR1
comma
l_int|0x0
)paren
suffix:semicolon
)brace
DECL|function|mixcom_on
r_static
r_void
id|mixcom_on
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_CCR1
comma
id|HSCX_PU
op_or
id|HSCX_ODS
op_or
id|HSCX_ITF
)paren
suffix:semicolon
singleline_comment|// power up, push-pull
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_CCR2
comma
id|HSCX_CIE
multiline_comment|/* | HSCX_RIE */
)paren
suffix:semicolon
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_MODE
comma
id|HSCX_TRANS
op_or
id|HSCX_ADM8
op_or
id|HSCX_RAC
op_or
id|HSCX_RTS
)paren
suffix:semicolon
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_RLCR
comma
id|HSCX_RC
op_or
l_int|47
)paren
suffix:semicolon
singleline_comment|// 1504 bytes
id|wr_hscx
c_func
(paren
id|dev
comma
id|HSCX_MASK
comma
id|HSCX_RSC
op_or
id|HSCX_TIN
)paren
suffix:semicolon
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_XRES
op_or
id|HSCX_RHR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;HW_set_clock
)paren
id|ch
op_member_access_from_pointer
id|HW_set_clock
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|MIXCOM_send_packet
r_static
r_int
id|MIXCOM_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_HW_TX
)paren
(brace
id|comx_debug_bytes
c_func
(paren
id|dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_string|&quot;MIXCOM_send_packet&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
)paren
(brace
r_return
id|FRAME_DROPPED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|HSCX_MTU
)paren
(brace
id|ch-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_return
id|FRAME_ERROR
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|hw-&gt;txbusy
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: transmitter called while busy... dropping frame (length %d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|FRAME_DROPPED
suffix:semicolon
)brace
id|hw-&gt;sending
op_assign
id|skb
suffix:semicolon
id|hw-&gt;tx_ptr
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;txbusy
op_assign
l_int|1
suffix:semicolon
singleline_comment|//&t;atomic_inc(&amp;skb-&gt;users);&t;// save it
id|hscx_fill_fifo
c_func
(paren
id|dev
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ch-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ch-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_HW_TX
)paren
(brace
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;MIXCOM_send_packet was successful&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|FRAME_ACCEPTED
suffix:semicolon
)brace
DECL|function|mixcom_receive_frame
r_static
r_inline
r_void
id|mixcom_receive_frame
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_register
id|byte
id|rsta
suffix:semicolon
r_register
id|word
id|length
suffix:semicolon
id|rsta
op_assign
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_RSTA
)paren
op_amp
(paren
id|HSCX_VFR
op_or
id|HSCX_RDO
op_or
id|HSCX_CRC
op_or
id|HSCX_RAB
)paren
suffix:semicolon
id|length
op_assign
(paren
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_RBCH
)paren
op_amp
l_int|0x0f
)paren
op_lshift
l_int|8
)paren
op_or
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_RBCL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|hw-&gt;rx_ptr
)paren
(brace
id|hscx_empty_fifo
c_func
(paren
id|dev
comma
id|length
op_minus
id|hw-&gt;rx_ptr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rsta
op_amp
id|HSCX_VFR
)paren
)paren
(brace
id|ch-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rsta
op_amp
id|HSCX_RDO
)paren
(brace
id|ch-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rsta
op_amp
id|HSCX_CRC
)paren
)paren
(brace
id|ch-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rsta
op_amp
id|HSCX_RAB
)paren
(brace
id|ch-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
)brace
id|ch-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|ch-&gt;stats.rx_bytes
op_add_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|rsta
op_eq
(paren
id|HSCX_VFR
op_or
id|HSCX_CRC
)paren
op_logical_and
id|hw-&gt;recving
)paren
(brace
id|skb_trim
c_func
(paren
id|hw-&gt;recving
comma
id|hw-&gt;rx_ptr
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_HW_RX
)paren
(brace
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|hw-&gt;recving
comma
l_string|&quot;MIXCOM_interrupt receiving&quot;
)paren
suffix:semicolon
)brace
id|hw-&gt;recving-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_rx
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_rx
c_func
(paren
id|dev
comma
id|hw-&gt;recving
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|hw-&gt;recving
)paren
(brace
id|kfree_skb
c_func
(paren
id|hw-&gt;recving
)paren
suffix:semicolon
)brace
id|hw-&gt;recving
op_assign
l_int|NULL
suffix:semicolon
id|hw-&gt;rx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|mixcom_extended_interrupt
r_static
r_inline
r_void
id|mixcom_extended_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_register
id|byte
id|exir
suffix:semicolon
id|exir
op_assign
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_EXIR
)paren
op_amp
(paren
id|HSCX_XDU
op_or
id|HSCX_RFO
op_or
id|HSCX_CSC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exir
op_amp
id|HSCX_RFO
)paren
(brace
id|ch-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;rx_ptr
)paren
(brace
id|kfree_skb
c_func
(paren
id|hw-&gt;recving
)paren
suffix:semicolon
id|hw-&gt;recving
op_assign
l_int|NULL
suffix:semicolon
id|hw-&gt;rx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: rx overrun&bslash;n&quot;
)paren
suffix:semicolon
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_RHR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exir
op_amp
id|HSCX_XDU
)paren
(brace
singleline_comment|// xmit underrun
id|ch-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|ch-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;tx_ptr
)paren
(brace
id|kfree_skb
c_func
(paren
id|hw-&gt;sending
)paren
suffix:semicolon
id|hw-&gt;sending
op_assign
l_int|NULL
suffix:semicolon
id|hw-&gt;tx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_XRES
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|hw-&gt;txbusy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_tx
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: tx underrun&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exir
op_amp
id|HSCX_CSC
)paren
(brace
id|ch-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_STAR
)paren
op_amp
id|HSCX_CTS
)paren
op_eq
l_int|0
)paren
(brace
singleline_comment|// Vonal le
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
(brace
id|ch-&gt;line_status
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_status
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
op_logical_and
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_STAR
)paren
op_amp
id|HSCX_CTS
)paren
)paren
(brace
singleline_comment|// Vonal fol
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
)paren
(brace
id|ch-&gt;lineup_timer.function
op_assign
id|comx_lineup_func
suffix:semicolon
id|ch-&gt;lineup_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ch-&gt;lineup_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;lineup_delay
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
id|hscx_cmd
c_func
(paren
id|dev
comma
id|HSCX_XRES
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|hw-&gt;txbusy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;sending
)paren
(brace
id|kfree_skb
c_func
(paren
id|hw-&gt;sending
)paren
suffix:semicolon
)brace
id|hw-&gt;sending
op_assign
l_int|NULL
suffix:semicolon
id|hw-&gt;tx_ptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|MIXCOM_interrupt
r_static
r_void
id|MIXCOM_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
comma
op_star
id|twin_ch
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
comma
op_star
id|twin_hw
suffix:semicolon
r_register
r_int
r_char
id|ista
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comx_interrupt: irq %d for unknown device&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ista
op_assign
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_ISTA
)paren
op_amp
(paren
id|HSCX_RME
op_or
id|HSCX_RPF
op_or
id|HSCX_XPR
op_or
id|HSCX_EXB
op_or
id|HSCX_EXA
op_or
id|HSCX_ICA
)paren
)paren
)paren
)paren
(brace
r_register
id|byte
id|ista2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ista
op_amp
id|HSCX_RME
)paren
(brace
id|mixcom_receive_frame
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ista
op_amp
id|HSCX_RPF
)paren
(brace
id|hscx_empty_fifo
c_func
(paren
id|dev
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ista
op_amp
id|HSCX_XPR
)paren
(brace
r_if
c_cond
(paren
id|hw-&gt;tx_ptr
)paren
(brace
id|hscx_fill_fifo
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|hw-&gt;txbusy
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|LINE_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ista
op_amp
id|HSCX_EXB
)paren
(brace
id|mixcom_extended_interrupt
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ista
op_amp
id|HSCX_EXA
)paren
op_logical_and
id|ch-&gt;twin
)paren
(brace
id|mixcom_extended_interrupt
c_func
(paren
id|ch-&gt;twin
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ista
op_amp
id|HSCX_ICA
)paren
op_logical_and
id|ch-&gt;twin
op_logical_and
(paren
id|ista2
op_assign
id|rd_hscx
c_func
(paren
id|ch-&gt;twin
comma
id|HSCX_ISTA
)paren
op_amp
(paren
id|HSCX_RME
op_or
id|HSCX_RPF
op_or
id|HSCX_XPR
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ista2
op_amp
id|HSCX_RME
)paren
(brace
id|mixcom_receive_frame
c_func
(paren
id|ch-&gt;twin
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ista2
op_amp
id|HSCX_RPF
)paren
(brace
id|hscx_empty_fifo
c_func
(paren
id|ch-&gt;twin
comma
l_int|32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ista2
op_amp
id|HSCX_XPR
)paren
(brace
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_hw
op_assign
id|twin_ch-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|twin_hw-&gt;tx_ptr
)paren
(brace
id|hscx_fill_fifo
c_func
(paren
id|ch-&gt;twin
)paren
suffix:semicolon
)brace
r_else
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|twin_hw-&gt;txbusy
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|LINE_tx
c_func
(paren
id|ch-&gt;twin
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|MIXCOM_open
r_static
r_int
id|MIXCOM_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_addr
op_logical_or
op_logical_neg
id|dev-&gt;irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|TWIN
c_func
(paren
id|dev
)paren
op_logical_or
op_logical_neg
(paren
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|IRQ_ALLOCATED
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: channel 0 not yet initialized&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
multiline_comment|/* Is our hw present at all ? Not checking for channel 0 if it is already &n;&t;   open */
r_if
c_cond
(paren
id|hw-&gt;channel
op_ne
l_int|0
op_logical_or
op_logical_neg
(paren
id|ch-&gt;init_status
op_amp
id|IRQ_ALLOCATED
)paren
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|MIXCOM_IO_EXTENT
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mixcom_probe
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
)paren
(brace
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|MIXCOM_IO_EXTENT
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|0
op_logical_and
op_logical_neg
(paren
id|ch-&gt;init_status
op_amp
id|IRQ_ALLOCATED
)paren
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|MIXCOM_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
(paren
r_void
op_star
)paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: unable to obtain irq %d&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|IRQ_ALLOCATED
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|MIXCOM_IO_EXTENT
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|mixcom_board_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|mixcom_on
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hw-&gt;status
op_assign
id|inb
c_func
(paren
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
op_plus
id|MIXCOM_STATUS_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;status
op_ne
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: board has status register, good&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|hw-&gt;card_has_status
op_assign
l_int|1
suffix:semicolon
)brace
id|hw-&gt;txbusy
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;init_status
op_or_assign
id|HW_OPEN
suffix:semicolon
r_if
c_cond
(paren
id|rd_hscx
c_func
(paren
id|dev
comma
id|HSCX_STAR
)paren
op_amp
id|HSCX_CTS
)paren
(brace
id|ch-&gt;line_status
op_or_assign
id|LINE_UP
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;line_status
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|procfile-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0444
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|MIXCOM_close
r_static
r_int
id|MIXCOM_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|mixcom_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* This is channel 0, twin is not open, we can safely turn off everything */
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|0
op_logical_and
(paren
op_logical_neg
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|HW_OPEN
)paren
)paren
)paren
(brace
id|mixcom_board_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|MIXCOM_IO_EXTENT
)paren
suffix:semicolon
id|ch-&gt;init_status
op_and_assign
op_complement
id|IRQ_ALLOCATED
suffix:semicolon
)brace
multiline_comment|/* This is channel 1, channel 0 has already been shutdown, we can release&n;&t;   this one too */
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
op_logical_and
op_logical_neg
(paren
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
r_if
c_cond
(paren
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|IRQ_ALLOCATED
)paren
(brace
id|mixcom_board_off
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|irq
comma
id|TWIN
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|base_addr
comma
id|MIXCOM_IO_EXTENT
)paren
suffix:semicolon
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_and_assign
op_complement
id|IRQ_ALLOCATED
suffix:semicolon
)brace
)brace
multiline_comment|/* the ioports for channel 1 can be safely released */
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
)paren
(brace
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|MIXCOM_IO_EXTENT
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* If we don&squot;t hold any hardware open */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;init_status
op_amp
id|IRQ_ALLOCATED
)paren
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|procfile-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0644
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* channel 0 was only waiting for us to close channel 1 &n;&t;   close it completely */
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
op_logical_and
op_logical_neg
(paren
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
r_for
c_loop
(paren
id|procfile
op_assign
id|COMX_CHANNEL
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|procdir-&gt;subdir
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|procfile-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0644
suffix:semicolon
)brace
)brace
)brace
id|ch-&gt;init_status
op_and_assign
op_complement
id|HW_OPEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|MIXCOM_statistics
r_static
r_int
id|MIXCOM_statistics
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
singleline_comment|// struct mixcom_privdata *hw = ch-&gt;HW_privdata;
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;init_status
op_logical_and
id|IRQ_ALLOCATED
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Mixcom board: hardware open&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|MIXCOM_dump
r_static
r_int
id|MIXCOM_dump
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixcom_read_proc
r_static
r_int
id|mixcom_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|file
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|file-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|MIXCOM_BOARD_BASE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%d&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|hw-&gt;clock
)paren
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|hw-&gt;clock
)paren
suffix:semicolon
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;external&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%01d&bslash;n&quot;
comma
id|hw-&gt;channel
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_TWIN
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;twin
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|ch-&gt;twin-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mixcom_read_proc: internal error, filename %s&bslash;n&quot;
comma
id|file-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|len
op_minus
id|off
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
(paren
id|min
c_func
(paren
id|count
comma
id|len
op_minus
id|off
)paren
)paren
suffix:semicolon
)brace
DECL|function|mixcom_twin_check
r_static
r_struct
id|net_device
op_star
id|mixcom_twin_check
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|net_device
op_star
id|twin
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch_twin
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw_twin
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|procfile-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|twin
op_assign
id|procfile-&gt;data
suffix:semicolon
id|ch_twin
op_assign
id|twin-&gt;priv
suffix:semicolon
id|hw_twin
op_assign
id|ch_twin-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|twin
op_ne
id|dev
op_logical_and
id|dev-&gt;irq
op_logical_and
id|dev-&gt;base_addr
op_logical_and
id|dev-&gt;irq
op_eq
id|twin-&gt;irq
op_logical_and
id|ch-&gt;hardware
op_eq
id|ch_twin-&gt;hardware
op_logical_and
id|dev-&gt;base_addr
op_eq
id|twin-&gt;base_addr
op_plus
(paren
l_int|1
op_minus
l_int|2
op_star
id|hw-&gt;channel
)paren
op_star
id|MIXCOM_CHANNEL_OFFSET
op_logical_and
id|hw-&gt;channel
op_eq
(paren
l_int|1
op_minus
id|hw_twin-&gt;channel
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|TWIN
c_func
(paren
id|twin
)paren
op_logical_or
id|TWIN
c_func
(paren
id|twin
)paren
op_eq
id|dev
)paren
(brace
r_return
id|twin
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|setup_twin
r_static
r_void
id|setup_twin
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|TWIN
c_func
(paren
id|dev
)paren
op_logical_and
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|TWIN
c_func
(paren
id|dev
)paren
op_assign
id|mixcom_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_logical_and
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_ne
id|dev
)paren
(brace
id|TWIN
c_func
(paren
id|dev
)paren
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_assign
id|dev
suffix:semicolon
)brace
)brace
)brace
DECL|function|mixcom_write_proc
r_static
r_int
id|mixcom_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
id|u_long
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|entry-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_char
op_star
id|page
suffix:semicolon
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|copy_from_user
c_func
(paren
id|page
comma
id|buffer
comma
id|count
op_assign
id|min
c_func
(paren
id|count
comma
id|PAGE_SIZE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
)paren
(brace
id|value
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0x180
op_logical_and
id|value
op_ne
l_int|0x280
op_logical_and
id|value
op_ne
l_int|0x380
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: incorrect io address!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;base_addr
op_assign
id|MIXCOM_DEV_BASE
c_func
(paren
id|value
comma
id|hw-&gt;channel
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|value
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
template_param
l_int|15
op_logical_or
id|mixcom_set_irq
(braket
id|value
)braket
op_eq
l_int|0xFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: incorrect irq value!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;irq
op_assign
id|value
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;ext&quot;
comma
id|page
comma
l_int|3
)paren
op_eq
l_int|0
)paren
(brace
id|hw-&gt;clock
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|kbps
suffix:semicolon
id|kbps
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kbps
)paren
(brace
id|hw-&gt;clock
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|hw-&gt;clock
op_assign
id|kbps
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;clock
template_param
l_int|2000
)paren
(brace
id|hw-&gt;clock
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MIXCOM: invalid clock rate!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
op_logical_and
id|ch-&gt;HW_set_clock
)paren
(brace
id|ch
op_member_access_from_pointer
id|HW_set_clock
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
)paren
(brace
id|value
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid channel number&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;base_addr
op_add_assign
(paren
id|hw-&gt;channel
op_minus
id|value
)paren
op_star
id|MIXCOM_CHANNEL_OFFSET
suffix:semicolon
id|hw-&gt;channel
op_assign
id|value
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hw_read_proc: internal error, filename %s&bslash;n&quot;
comma
id|entry-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
id|setup_twin
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|MIXCOM_init
r_static
r_int
id|MIXCOM_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;HW_privdata
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mixcom_privdata
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hw
op_assign
id|ch-&gt;HW_privdata
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|mixcom_privdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_HW_privdata
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|mixcom_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|mixcom_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_io
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|mixcom_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|mixcom_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_CLOCK
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|mixcom_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|mixcom_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_irq
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|mixcom_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|mixcom_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_TWIN
comma
id|S_IFREG
op_or
l_int|0444
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_channel
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|mixcom_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|mixcom_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|setup_twin
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Fill in ch_struct hw specific pointers */
id|ch-&gt;HW_access_board
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;HW_release_board
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;HW_txe
op_assign
id|MIXCOM_txe
suffix:semicolon
id|ch-&gt;HW_open
op_assign
id|MIXCOM_open
suffix:semicolon
id|ch-&gt;HW_close
op_assign
id|MIXCOM_close
suffix:semicolon
id|ch-&gt;HW_send_packet
op_assign
id|MIXCOM_send_packet
suffix:semicolon
id|ch-&gt;HW_statistics
op_assign
id|MIXCOM_statistics
suffix:semicolon
id|ch-&gt;HW_set_clock
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|MIXCOM_DEV_BASE
c_func
(paren
id|MIXCOM_DEFAULT_IO
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|MIXCOM_DEFAULT_IRQ
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_filename_channel
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_irq
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_io
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_HW_privdata
suffix:colon
id|kfree
c_func
(paren
id|ch-&gt;HW_privdata
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|MIXCOM_exit
r_static
r_int
id|MIXCOM_exit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mixcom_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|0
op_logical_and
id|TWIN
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;channel
op_eq
l_int|1
op_logical_and
id|TWIN
c_func
(paren
id|dev
)paren
)paren
(brace
id|TWIN
c_func
(paren
id|TWIN
c_func
(paren
id|dev
)paren
)paren
op_assign
l_int|NULL
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ch-&gt;HW_privdata
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
macro_line|#if 0
id|remove_proc_entry
c_func
(paren
id|FILENAME_CLOCK
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
macro_line|#endif
id|remove_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_TWIN
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|mixcomhw
r_static
r_struct
id|comx_hardware
id|mixcomhw
op_assign
(brace
l_string|&quot;mixcom&quot;
comma
id|VERSION
comma
id|MIXCOM_init
comma
id|MIXCOM_exit
comma
id|MIXCOM_dump
comma
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/* Module management */
macro_line|#ifdef MODULE
DECL|macro|comx_hw_mixcom_init
mdefine_line|#define comx_hw_mixcom_init init_module
macro_line|#endif
DECL|function|comx_hw_mixcom_init
r_int
id|__init
id|comx_hw_mixcom_init
c_func
(paren
r_void
)paren
(brace
r_return
id|comx_register_hardware
c_func
(paren
op_amp
id|mixcomhw
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|comx_unregister_hardware
c_func
(paren
l_string|&quot;mixcom&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
