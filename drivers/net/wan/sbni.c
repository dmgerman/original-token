multiline_comment|/*&n; * Driver for Granch SBNI-12 leased line network adapters.&n; * &n; * Copyright 1997 - 1999, Granch ltd.&n; * Written 1999 by Yaroslav Polyakov (xenon@granch.ru).&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU Public License, incorporated herein by reference.&n; * &n; *   // Whole developers team:&n; *   //   Yaroslav Polyakov (xenon@granch.ru)&n; *   //      - main developer of this version&n; *   //   Alexey Zverev (zverev@granch.ru)&n; *   //      - previous SBNI driver for linux&n; *   //   Alexey Chirkov (chirkov@granch.ru)&n; *   //      - all the hardware work and consulting&n; *   //   Max Khon (max@iclub.nsu.ru)&n; *   //      - first SBNI driver for linux&n; *   // --------------------------------------------&n; *   // also I thank: &n; *   //   Max Krasnyansky (max@uznet.net)&n; *   //      - for bug hunting and many ideas&n; *   //   Alan Cox (Alan.Cox@linux.org)&n; *   //&t;     - for consulting in some hardcore questions&n; *   //   Donald Becker (becker@cesdis.gsfc.nasa.gov)&n; *   //      - for pretty nice skeleton &n; * &n; *   More info and useful utilities to work w/ SBNI you can find at &n; *   http://www.granch.ru.&n; *&n; *  3.0.0 = Initial Revision, Yaroslav Polyakov (24 Feb 1999)&n; *        - added pre-calculation for CRC, fixed bug with &quot;len-2&quot; frames, &n; *        - removed outbound fragmentation (MTU=1000), written CRC-calculation &n; *        - on asm, added work with hard_headers and now we have our own cache &n; *        - for them, optionally supported word-interchange on some chipsets,&n; *        - something else I cant remember ;) &n; * &n; *  3.0.1 = just fixed some bugs (14 apr 1999).&n; * &t;  - fixed statistical tx bug &n; *        - fixed wrong creation dates (1998 -&gt; 1999) in driver source code ;)&n; * &t;  - fixed source address bug.&n; *        - fixed permanent nirvana bug &n; * &n; *  3.1.0 = (Katyusha) (26 apr 1999)&n; *        - Added balancing feature&n; * &n; *  3.1.1 = (Medea) (5 aug 1999)&n; *        - Fixed mac.raw bug&n; *&t;  - Thanks to tolix@olviko.ru and &n; *        - to Barnaul Brewery, producers of my favorite beer &quot;Medea&quot;.&n; *&n; *&n; */
DECL|macro|GOODBUS16
macro_line|#undef GOODBUS16
DECL|macro|CRCASM
mdefine_line|#define CRCASM
DECL|macro|KATYUSHA
mdefine_line|#define KATYUSHA
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/types.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/config.h&gt;&t;/* for CONFIG_INET. do we need this?*/
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;sbni.h&quot;
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;sbni.c: ver. 3.1.1 Medea 5 Aug 1999 Yaroslav Polyakov (xenon@granch.ru)&bslash;n&quot;
suffix:semicolon
r_int
id|sbni_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sbni_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|sbni_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sbni_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sbni_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|sbni_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sbni_drop_tx_queue
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|sbni_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|card_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_inline
r_int
r_int
id|sbni_recv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_void
id|change_level
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_inline
r_void
id|sbni_xmit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_inline
r_void
id|sbni_get_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sbni_watchdog
c_func
(paren
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sbni_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|sbni_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
suffix:semicolon
r_int
r_int
id|calc_crc
c_func
(paren
r_char
op_star
id|mem
comma
r_int
id|len
comma
r_int
id|initial
)paren
suffix:semicolon
r_void
id|sbni_nirvana
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sbni_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|sbni_rebuild_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|sbni_header_cache
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|hh_cache
op_star
id|hh
)paren
suffix:semicolon
r_static
r_inline
r_void
id|sbni_outs
c_func
(paren
r_int
id|port
comma
r_void
op_star
id|data
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_inline
r_void
id|sbni_ins
c_func
(paren
r_int
id|port
comma
r_void
op_star
id|data
comma
r_int
id|len
)paren
suffix:semicolon
DECL|macro|SIZE_OF_TIMEOUT_RXL_TAB
mdefine_line|#define SIZE_OF_TIMEOUT_RXL_TAB 4
DECL|variable|timeout_rxl_tab
r_static
id|u_char
id|timeout_rxl_tab
(braket
)braket
op_assign
(brace
l_int|0x03
comma
l_int|0x05
comma
l_int|0x08
comma
l_int|0x0b
)brace
suffix:semicolon
DECL|variable|rxl_tab
r_static
id|u_char
id|rxl_tab
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x08
comma
l_int|0x0a
comma
l_int|0x0c
comma
l_int|0x0f
comma
l_int|0x16
comma
l_int|0x18
comma
l_int|0x1a
comma
l_int|0x1c
comma
l_int|0x1f
)brace
suffix:semicolon
multiline_comment|/* A zero-terminated list of I/O addresses to be probed */
DECL|variable|netcard_portlist
r_static
r_int
r_int
id|netcard_portlist
(braket
)braket
op_assign
(brace
l_int|0x210
comma
l_int|0x2c0
comma
l_int|0x2d0
comma
l_int|0x2f0
comma
l_int|0x220
comma
l_int|0x230
comma
l_int|0x240
comma
l_int|0x250
comma
l_int|0x260
comma
l_int|0x290
comma
l_int|0x2a0
comma
l_int|0x2b0
comma
l_int|0x224
comma
l_int|0x234
comma
l_int|0x244
comma
l_int|0x254
comma
l_int|0x264
comma
l_int|0x294
comma
l_int|0x2a4
comma
l_int|0x2b4
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|magic_reply
r_static
r_int
r_char
id|magic_reply
(braket
)braket
op_assign
(brace
l_int|0x5a
comma
l_int|0x06
comma
l_int|0x30
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x50
comma
l_int|0x65
comma
l_int|0x44
comma
l_int|0x20
)brace
suffix:semicolon
DECL|variable|def_baud
r_static
r_int
id|def_baud
op_assign
id|DEF_RATE
suffix:semicolon
DECL|variable|def_rxl
r_static
r_int
id|def_rxl
op_assign
id|DEF_RXL_DELTA
suffix:semicolon
DECL|variable|def_mac
r_static
r_int
id|def_mac
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; * CRC-32 stuff&n; */
DECL|macro|CRC32
mdefine_line|#define CRC32(c,crc) (crc32tab[((size_t)(crc) ^ (c)) &amp; 0xff] ^ (((crc) &gt;&gt; 8) &amp; 0x00FFFFFF))
multiline_comment|/* CRC generator 0xEDB88320 */
multiline_comment|/* CRC remainder 0x2144DF1C */
multiline_comment|/* CRC initial value 0x00000000 */
DECL|macro|CRC32_REMAINDER
mdefine_line|#define CRC32_REMAINDER 0x2144DF1C
DECL|macro|CRC32_INITIAL
mdefine_line|#define CRC32_INITIAL 0x00000000
DECL|variable|crc32tab
r_static
r_int
r_int
id|crc32tab
(braket
)braket
op_assign
(brace
l_int|0xD202EF8D
comma
l_int|0xA505DF1B
comma
l_int|0x3C0C8EA1
comma
l_int|0x4B0BBE37
comma
l_int|0xD56F2B94
comma
l_int|0xA2681B02
comma
l_int|0x3B614AB8
comma
l_int|0x4C667A2E
comma
l_int|0xDCD967BF
comma
l_int|0xABDE5729
comma
l_int|0x32D70693
comma
l_int|0x45D03605
comma
l_int|0xDBB4A3A6
comma
l_int|0xACB39330
comma
l_int|0x35BAC28A
comma
l_int|0x42BDF21C
comma
l_int|0xCFB5FFE9
comma
l_int|0xB8B2CF7F
comma
l_int|0x21BB9EC5
comma
l_int|0x56BCAE53
comma
l_int|0xC8D83BF0
comma
l_int|0xBFDF0B66
comma
l_int|0x26D65ADC
comma
l_int|0x51D16A4A
comma
l_int|0xC16E77DB
comma
l_int|0xB669474D
comma
l_int|0x2F6016F7
comma
l_int|0x58672661
comma
l_int|0xC603B3C2
comma
l_int|0xB1048354
comma
l_int|0x280DD2EE
comma
l_int|0x5F0AE278
comma
l_int|0xE96CCF45
comma
l_int|0x9E6BFFD3
comma
l_int|0x0762AE69
comma
l_int|0x70659EFF
comma
l_int|0xEE010B5C
comma
l_int|0x99063BCA
comma
l_int|0x000F6A70
comma
l_int|0x77085AE6
comma
l_int|0xE7B74777
comma
l_int|0x90B077E1
comma
l_int|0x09B9265B
comma
l_int|0x7EBE16CD
comma
l_int|0xE0DA836E
comma
l_int|0x97DDB3F8
comma
l_int|0x0ED4E242
comma
l_int|0x79D3D2D4
comma
l_int|0xF4DBDF21
comma
l_int|0x83DCEFB7
comma
l_int|0x1AD5BE0D
comma
l_int|0x6DD28E9B
comma
l_int|0xF3B61B38
comma
l_int|0x84B12BAE
comma
l_int|0x1DB87A14
comma
l_int|0x6ABF4A82
comma
l_int|0xFA005713
comma
l_int|0x8D076785
comma
l_int|0x140E363F
comma
l_int|0x630906A9
comma
l_int|0xFD6D930A
comma
l_int|0x8A6AA39C
comma
l_int|0x1363F226
comma
l_int|0x6464C2B0
comma
l_int|0xA4DEAE1D
comma
l_int|0xD3D99E8B
comma
l_int|0x4AD0CF31
comma
l_int|0x3DD7FFA7
comma
l_int|0xA3B36A04
comma
l_int|0xD4B45A92
comma
l_int|0x4DBD0B28
comma
l_int|0x3ABA3BBE
comma
l_int|0xAA05262F
comma
l_int|0xDD0216B9
comma
l_int|0x440B4703
comma
l_int|0x330C7795
comma
l_int|0xAD68E236
comma
l_int|0xDA6FD2A0
comma
l_int|0x4366831A
comma
l_int|0x3461B38C
comma
l_int|0xB969BE79
comma
l_int|0xCE6E8EEF
comma
l_int|0x5767DF55
comma
l_int|0x2060EFC3
comma
l_int|0xBE047A60
comma
l_int|0xC9034AF6
comma
l_int|0x500A1B4C
comma
l_int|0x270D2BDA
comma
l_int|0xB7B2364B
comma
l_int|0xC0B506DD
comma
l_int|0x59BC5767
comma
l_int|0x2EBB67F1
comma
l_int|0xB0DFF252
comma
l_int|0xC7D8C2C4
comma
l_int|0x5ED1937E
comma
l_int|0x29D6A3E8
comma
l_int|0x9FB08ED5
comma
l_int|0xE8B7BE43
comma
l_int|0x71BEEFF9
comma
l_int|0x06B9DF6F
comma
l_int|0x98DD4ACC
comma
l_int|0xEFDA7A5A
comma
l_int|0x76D32BE0
comma
l_int|0x01D41B76
comma
l_int|0x916B06E7
comma
l_int|0xE66C3671
comma
l_int|0x7F6567CB
comma
l_int|0x0862575D
comma
l_int|0x9606C2FE
comma
l_int|0xE101F268
comma
l_int|0x7808A3D2
comma
l_int|0x0F0F9344
comma
l_int|0x82079EB1
comma
l_int|0xF500AE27
comma
l_int|0x6C09FF9D
comma
l_int|0x1B0ECF0B
comma
l_int|0x856A5AA8
comma
l_int|0xF26D6A3E
comma
l_int|0x6B643B84
comma
l_int|0x1C630B12
comma
l_int|0x8CDC1683
comma
l_int|0xFBDB2615
comma
l_int|0x62D277AF
comma
l_int|0x15D54739
comma
l_int|0x8BB1D29A
comma
l_int|0xFCB6E20C
comma
l_int|0x65BFB3B6
comma
l_int|0x12B88320
comma
l_int|0x3FBA6CAD
comma
l_int|0x48BD5C3B
comma
l_int|0xD1B40D81
comma
l_int|0xA6B33D17
comma
l_int|0x38D7A8B4
comma
l_int|0x4FD09822
comma
l_int|0xD6D9C998
comma
l_int|0xA1DEF90E
comma
l_int|0x3161E49F
comma
l_int|0x4666D409
comma
l_int|0xDF6F85B3
comma
l_int|0xA868B525
comma
l_int|0x360C2086
comma
l_int|0x410B1010
comma
l_int|0xD80241AA
comma
l_int|0xAF05713C
comma
l_int|0x220D7CC9
comma
l_int|0x550A4C5F
comma
l_int|0xCC031DE5
comma
l_int|0xBB042D73
comma
l_int|0x2560B8D0
comma
l_int|0x52678846
comma
l_int|0xCB6ED9FC
comma
l_int|0xBC69E96A
comma
l_int|0x2CD6F4FB
comma
l_int|0x5BD1C46D
comma
l_int|0xC2D895D7
comma
l_int|0xB5DFA541
comma
l_int|0x2BBB30E2
comma
l_int|0x5CBC0074
comma
l_int|0xC5B551CE
comma
l_int|0xB2B26158
comma
l_int|0x04D44C65
comma
l_int|0x73D37CF3
comma
l_int|0xEADA2D49
comma
l_int|0x9DDD1DDF
comma
l_int|0x03B9887C
comma
l_int|0x74BEB8EA
comma
l_int|0xEDB7E950
comma
l_int|0x9AB0D9C6
comma
l_int|0x0A0FC457
comma
l_int|0x7D08F4C1
comma
l_int|0xE401A57B
comma
l_int|0x930695ED
comma
l_int|0x0D62004E
comma
l_int|0x7A6530D8
comma
l_int|0xE36C6162
comma
l_int|0x946B51F4
comma
l_int|0x19635C01
comma
l_int|0x6E646C97
comma
l_int|0xF76D3D2D
comma
l_int|0x806A0DBB
comma
l_int|0x1E0E9818
comma
l_int|0x6909A88E
comma
l_int|0xF000F934
comma
l_int|0x8707C9A2
comma
l_int|0x17B8D433
comma
l_int|0x60BFE4A5
comma
l_int|0xF9B6B51F
comma
l_int|0x8EB18589
comma
l_int|0x10D5102A
comma
l_int|0x67D220BC
comma
l_int|0xFEDB7106
comma
l_int|0x89DC4190
comma
l_int|0x49662D3D
comma
l_int|0x3E611DAB
comma
l_int|0xA7684C11
comma
l_int|0xD06F7C87
comma
l_int|0x4E0BE924
comma
l_int|0x390CD9B2
comma
l_int|0xA0058808
comma
l_int|0xD702B89E
comma
l_int|0x47BDA50F
comma
l_int|0x30BA9599
comma
l_int|0xA9B3C423
comma
l_int|0xDEB4F4B5
comma
l_int|0x40D06116
comma
l_int|0x37D75180
comma
l_int|0xAEDE003A
comma
l_int|0xD9D930AC
comma
l_int|0x54D13D59
comma
l_int|0x23D60DCF
comma
l_int|0xBADF5C75
comma
l_int|0xCDD86CE3
comma
l_int|0x53BCF940
comma
l_int|0x24BBC9D6
comma
l_int|0xBDB2986C
comma
l_int|0xCAB5A8FA
comma
l_int|0x5A0AB56B
comma
l_int|0x2D0D85FD
comma
l_int|0xB404D447
comma
l_int|0xC303E4D1
comma
l_int|0x5D677172
comma
l_int|0x2A6041E4
comma
l_int|0xB369105E
comma
l_int|0xC46E20C8
comma
l_int|0x72080DF5
comma
l_int|0x050F3D63
comma
l_int|0x9C066CD9
comma
l_int|0xEB015C4F
comma
l_int|0x7565C9EC
comma
l_int|0x0262F97A
comma
l_int|0x9B6BA8C0
comma
l_int|0xEC6C9856
comma
l_int|0x7CD385C7
comma
l_int|0x0BD4B551
comma
l_int|0x92DDE4EB
comma
l_int|0xE5DAD47D
comma
l_int|0x7BBE41DE
comma
l_int|0x0CB97148
comma
l_int|0x95B020F2
comma
l_int|0xE2B71064
comma
l_int|0x6FBF1D91
comma
l_int|0x18B82D07
comma
l_int|0x81B17CBD
comma
l_int|0xF6B64C2B
comma
l_int|0x68D2D988
comma
l_int|0x1FD5E91E
comma
l_int|0x86DCB8A4
comma
l_int|0xF1DB8832
comma
l_int|0x616495A3
comma
l_int|0x1663A535
comma
l_int|0x8F6AF48F
comma
l_int|0xF86DC419
comma
l_int|0x660951BA
comma
l_int|0x110E612C
comma
l_int|0x88073096
comma
l_int|0xFF000000
)brace
suffix:semicolon
DECL|function|sbni_outs
r_static
r_inline
r_void
id|sbni_outs
c_func
(paren
r_int
id|port
comma
r_void
op_star
id|data
comma
r_int
id|len
)paren
(brace
macro_line|#ifdef GOODBUS16
id|outsw
c_func
(paren
id|port
comma
id|data
comma
id|len
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_amp
l_int|1
)paren
(brace
id|outb
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|data
)paren
(braket
id|len
op_minus
l_int|1
)braket
comma
id|port
)paren
suffix:semicolon
)brace
macro_line|#else
id|outsb
c_func
(paren
id|port
comma
id|data
comma
id|len
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|sbni_ins
r_static
r_inline
r_void
id|sbni_ins
c_func
(paren
r_int
id|port
comma
r_void
op_star
id|data
comma
r_int
id|len
)paren
(brace
macro_line|#ifdef GOODBUS16
id|insw
c_func
(paren
id|port
comma
id|data
comma
id|len
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_amp
l_int|1
)paren
(brace
(paren
(paren
r_char
op_star
)paren
id|data
)paren
(braket
id|len
op_minus
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
macro_line|#else
id|insb
c_func
(paren
id|port
comma
id|data
comma
id|len
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|sbni_header
r_static
r_int
id|sbni_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_struct
id|sbni_hard_header
op_star
id|hh
op_assign
(paren
r_struct
id|sbni_hard_header
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|ETH_P_802_3
)paren
(brace
id|hh-&gt;h_proto
op_assign
id|htons
c_func
(paren
id|type
)paren
suffix:semicolon
)brace
r_else
id|hh-&gt;h_proto
op_assign
id|htons
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saddr
)paren
(brace
id|memcpy
c_func
(paren
id|hh-&gt;h_source
comma
id|saddr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|hh-&gt;h_source
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|daddr
)paren
(brace
id|memcpy
c_func
(paren
id|hh-&gt;h_dest
comma
id|daddr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
id|dev-&gt;hard_header_len
suffix:semicolon
)brace
r_return
op_minus
id|dev-&gt;hard_header_len
suffix:semicolon
)brace
DECL|function|sbni_header_cache
r_int
id|sbni_header_cache
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|hh_cache
op_star
id|hh
)paren
(brace
r_int
r_int
id|type
op_assign
id|hh-&gt;hh_type
suffix:semicolon
r_struct
id|sbni_hard_header
op_star
id|sbni
op_assign
(paren
r_struct
id|sbni_hard_header
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|hh-&gt;hh_data
)paren
op_minus
l_int|8
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_802_3
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|sbni-&gt;h_proto
op_assign
id|type
suffix:semicolon
id|memcpy
c_func
(paren
id|sbni-&gt;h_source
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|sbni-&gt;h_dest
comma
id|neigh-&gt;ha
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sbni_rebuild_header
r_static
r_int
id|sbni_rebuild_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sbni_hard_header
op_star
id|hh
op_assign
(paren
r_struct
id|sbni_hard_header
op_star
)paren
id|skb
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Only ARP/IP is currently supported&n;&t; */
multiline_comment|/*&n;&t; *&t;Try to get ARP to resolve the header.&n;&t; */
macro_line|#ifdef CONFIG_INET
r_return
id|arp_find
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|hh-&gt;h_dest
comma
id|skb
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif&t;
)brace
DECL|function|sbni_header_cache_update
r_static
r_void
id|sbni_header_cache_update
c_func
(paren
r_struct
id|hh_cache
op_star
id|hh
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_char
op_star
id|haddr
)paren
(brace
id|memcpy
c_func
(paren
(paren
(paren
id|u8
op_star
)paren
id|hh-&gt;hh_data
)paren
op_plus
l_int|2
comma
id|haddr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
macro_line|#ifdef HAVE_DEVLIST
DECL|variable|sbni_drv
r_struct
id|netdev_entry
id|sbni_drv
op_assign
(brace
l_string|&quot;sbni&quot;
comma
id|sbni_probe1
comma
id|SBNI_IO_EXTENT
comma
id|netcard_portlist
)brace
suffix:semicolon
macro_line|#else
DECL|function|sbni_probe
r_int
id|__init
id|sbni_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|base_addr
op_assign
id|dev
ques
c_cond
id|dev-&gt;base_addr
suffix:colon
l_int|0
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_probe&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
r_if
c_cond
(paren
id|base_addr
OG
l_int|0x1ff
)paren
(brace
multiline_comment|/* Check a single specified location. */
r_return
id|sbni_probe1
c_func
(paren
id|dev
comma
id|base_addr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|base_addr
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Don&squot;t probe at all. */
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|base_addr
op_assign
id|netcard_portlist
(braket
id|i
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|check_region
c_func
(paren
id|base_addr
comma
id|SBNI_IO_EXTENT
)paren
op_logical_and
id|base_addr
op_ne
l_int|1
)paren
(brace
multiline_comment|/* Lock this address, or later we&squot;ll try it again */
id|netcard_portlist
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sbni_probe1
c_func
(paren
id|dev
comma
id|base_addr
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif /* have devlist*/
multiline_comment|/*&n; *&t;The actual probe. &n; */
multiline_comment|/*&n;&t;Valid combinations in CSR0 (for probing):&n;&n;&t;VALID_DECODER&t;0000,0011,1011,1010&n;&n;&t;&t;&t;&t;    &t;; 0   ; -&n;&t;&t;&t;&t;TR_REQ&t;; 1   ; +&n;&t;&t;&t;TR_RDY&t;    &t;; 2   ; -&n;&t;&t;&t;TR_RDY&t;TR_REQ&t;; 3   ; +&n;&t;&t;BU_EMP&t;&t;    &t;; 4   ; +&n;&t;&t;BU_EMP&t;     &t;TR_REQ&t;; 5   ; +&n;&t;&t;BU_EMP&t;TR_RDY&t;    &t;; 6   ; -&n;&t;&t;BU_EMP&t;TR_RDY&t;TR_REQ&t;; 7   ; +&n;&t;RC_RDY &t;&t;     &t;&t;; 8   ; +&n;&t;RC_RDY&t;&t;&t;TR_REQ&t;; 9   ; +&n;&t;RC_RDY&t;&t;TR_RDY&t;&t;; 10  ; -&n;&t;RC_RDY&t;&t;TR_RDY&t;TR_REQ&t;; 11  ; -&n;&t;RC_RDY&t;BU_EMP&t;&t;&t;; 12  ; -&n;&t;RC_RDY&t;BU_EMP&t;&t;TR_REQ&t;; 13  ; -&n;&t;RC_RDY&t;BU_EMP&t;TR_RDY&t;&t;; 14  ; -&n;&t;RC_RDY&t;BU_EMP&t;TR_RDY&t;TR_REQ&t;; 15  ; -&n;*/
DECL|macro|VALID_DECODER
mdefine_line|#define VALID_DECODER (2 + 8 + 0x10 + 0x20 + 0x80 + 0x100 + 0x200)
DECL|function|sbni_probe1
r_static
r_int
id|__init
id|sbni_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
(brace
r_int
id|autoirq
op_assign
l_int|0
suffix:semicolon
r_int
id|bad_card
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|csr0
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
suffix:semicolon
r_static
r_int
id|version_printed
op_assign
l_int|0
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_probe1 ioaddr=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
)paren
suffix:semicolon
)paren
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|SBNI_IO_EXTENT
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|version_printed
op_increment
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
)brace
multiline_comment|/* check for valid combination in CSR0 */
id|csr0
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_eq
l_int|0xff
op_logical_or
id|csr0
op_eq
l_int|0
)paren
(brace
id|bad_card
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|csr0
op_and_assign
op_complement
id|EN_INT
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_amp
id|BU_EMP
)paren
(brace
id|csr0
op_or_assign
id|EN_INT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|VALID_DECODER
op_amp
(paren
l_int|1
op_lshift
(paren
id|csr0
op_rshift
l_int|4
)paren
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|bad_card
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bad_card
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|outb
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
OL
l_int|2
)paren
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: autoprobing&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
suffix:semicolon
id|autoirq_setup
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|outb
c_func
(paren
id|EN_INT
op_or
id|TR_REQ
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|outb
c_func
(paren
id|PR_RES
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
id|autoirq
op_assign
id|autoirq_report
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|autoirq
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sbni probe at %#x failed to detect IRQ line&bslash;n&quot;
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
multiline_comment|/* clear FIFO buffer */
id|outb
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|autoirq
)paren
(brace
id|dev-&gt;irq
op_assign
id|autoirq
suffix:semicolon
)brace
(brace
r_int
id|irqval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|sbni_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irqval
)paren
(brace
id|printk
(paren
l_string|&quot; unable to get IRQ %d (irqval=%d).&bslash;n&quot;
comma
id|dev-&gt;irq
comma
id|irqval
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
multiline_comment|/* &n;&t; *&t;Initialize the device structure. &n;&t; */
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: cannot allocate memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|request_region
c_func
(paren
id|ioaddr
comma
id|SBNI_IO_EXTENT
comma
l_string|&quot;sbni&quot;
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * generate Ethernet address (0x00ff01xxxxxx)&n;&t; */
op_star
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
op_assign
id|htons
c_func
(paren
l_int|0x00ff
)paren
suffix:semicolon
op_star
(paren
id|u32
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|2
)paren
op_assign
id|htonl
c_func
(paren
(paren
(paren
id|def_mac
ques
c_cond
id|def_mac
suffix:colon
(paren
id|u32
)paren
id|dev-&gt;priv
)paren
op_amp
l_int|0x00ffffff
)paren
op_or
l_int|0x01000000
)paren
suffix:semicolon
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|def_rxl
OL
l_int|0
)paren
(brace
multiline_comment|/* autodetect receive level */
id|lp-&gt;rxl_curr
op_assign
l_int|0xf
suffix:semicolon
id|lp-&gt;rxl_delta
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* fixed receive level */
id|lp-&gt;rxl_curr
op_assign
id|def_rxl
op_amp
l_int|0xf
suffix:semicolon
id|lp-&gt;rxl_delta
op_assign
l_int|0
suffix:semicolon
)brace
id|lp-&gt;csr1.rxl
op_assign
id|rxl_tab
(braket
id|lp-&gt;rxl_curr
)braket
suffix:semicolon
id|lp-&gt;csr1.rate
op_assign
id|def_baud
op_amp
l_int|3
suffix:semicolon
id|lp-&gt;frame_len
op_assign
id|DEF_FRAME_LEN
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: sbni adapter at %#lx, using %sIRQ %d, MAC: 00:ff:01:%x:%x:%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|autoirq
ques
c_cond
l_string|&quot;auto&quot;
suffix:colon
l_string|&quot;assigned &quot;
comma
id|dev-&gt;irq
comma
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|3
)paren
comma
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
comma
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|5
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: receive level: &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;rxl_delta
op_eq
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;%#1x (fixed)&quot;
comma
id|lp-&gt;rxl_curr
)paren
suffix:semicolon
)brace
r_else
id|printk
(paren
l_string|&quot;autodetect&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, baud rate: %u&bslash;n&quot;
comma
(paren
r_int
)paren
id|lp-&gt;csr1.rate
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The SBNI-specific entries in the device structure. &n;&t; */
id|dev-&gt;open
op_assign
op_amp
id|sbni_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|sbni_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|sbni_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|sbni_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast_list
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|sbni_set_mac_address
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|sbni_ioctl
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Setup the generic properties &n;&t; */
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|sbni_header
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|sbni_rebuild_header
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|DEF_FRAME_LEN
suffix:semicolon
id|dev-&gt;hard_header_cache
op_assign
id|sbni_header_cache
suffix:semicolon
id|dev-&gt;header_cache_update
op_assign
id|sbni_header_cache_update
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|lp-&gt;m
op_assign
id|dev
suffix:semicolon
id|lp-&gt;me
op_assign
id|dev
suffix:semicolon
id|lp-&gt;next_lp
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Open/initialize the board. &n; */
DECL|function|sbni_open
r_static
r_int
id|sbni_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|watchdog
op_assign
op_amp
id|lp-&gt;watchdog
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_open&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;currframe
op_assign
l_int|NULL
suffix:semicolon
id|card_start
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set timer  watchdog */
id|init_timer
c_func
(paren
id|watchdog
)paren
suffix:semicolon
id|watchdog-&gt;expires
op_assign
id|jiffies
op_plus
id|SBNI_TIMEOUT
suffix:semicolon
id|watchdog-&gt;data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|watchdog-&gt;function
op_assign
id|sbni_watchdog
suffix:semicolon
id|add_timer
c_func
(paren
id|watchdog
)paren
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni timer watchdog initialized&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sbni_close
r_static
r_int
id|sbni_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|watchdog
op_assign
op_amp
id|lp-&gt;watchdog
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_close&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sbni_drop_tx_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|del_timer
c_func
(paren
id|watchdog
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sbni_start_xmit
r_static
r_int
id|sbni_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sbni_hard_header
op_star
id|hh
op_assign
(paren
r_struct
id|sbni_hard_header
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef KATYUSHA   
r_struct
id|net_local
op_star
id|nl
suffix:semicolon
r_int
id|stop
suffix:semicolon
macro_line|#endif
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_start_xmit In &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;me
op_ne
id|dev
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;sbni: lp-&gt;me != dev !!!&bslash;nMail to developer (xenon@granch.ru) if you noticed this error&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|hh-&gt;number
op_assign
l_int|1
suffix:semicolon
id|hh-&gt;reserv
op_assign
l_int|0
suffix:semicolon
id|hh-&gt;packetlen
op_assign
(paren
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_int
r_int
)paren
op_minus
(paren
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
op_minus
id|SBNI_HH_SZ
)paren
)paren
op_or
id|PACKET_SEND_OK
op_or
id|PACKET_FIRST_FRAME
suffix:semicolon
multiline_comment|/* we should use hairy method to calculate crc because of extra bytes are &n;&t;  livin between hard header and data*/
id|hh-&gt;crc
op_assign
id|calc_crc
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|hh-&gt;packetlen
comma
id|SBNI_HH_SZ
op_minus
r_sizeof
(paren
r_int
)paren
comma
id|CRC32_INITIAL
)paren
suffix:semicolon
id|hh-&gt;crc
op_assign
id|calc_crc
c_func
(paren
id|skb-&gt;data
op_plus
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
comma
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
comma
id|hh-&gt;crc
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#ifdef KATYUSHA
multiline_comment|/* looking for first idle device */
r_for
c_loop
(paren
id|stop
op_assign
l_int|0
comma
id|nl
op_assign
id|lp
suffix:semicolon
id|nl
op_logical_and
op_logical_neg
id|stop
suffix:semicolon
id|nl
op_assign
id|nl-&gt;next_lp
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|nl-&gt;currframe
)paren
op_logical_and
(paren
id|nl-&gt;carrier
)paren
)paren
multiline_comment|/* if idle */
(brace
id|skb-&gt;dev
op_assign
id|lp-&gt;me
suffix:semicolon
id|nl-&gt;currframe
op_assign
id|skb
suffix:semicolon
multiline_comment|/* set request for transmit */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|nl-&gt;me-&gt;base_addr
op_plus
id|CSR0
)paren
op_or
id|TR_REQ
comma
id|nl-&gt;me-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|stop
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|stop
)paren
multiline_comment|/* we havent found any idle.*/
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|lp-&gt;queue
comma
id|skb
)paren
suffix:semicolon
id|outb
c_func
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
op_or
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
)brace
macro_line|#else 
r_if
c_cond
(paren
id|lp-&gt;currframe
op_logical_or
l_int|1
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|lp-&gt;queue
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;currframe
op_assign
id|skb
suffix:semicolon
)brace
multiline_comment|/* set request for transmit */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
op_or
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
macro_line|#endif
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|card_start
r_static
r_void
id|card_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: card_start&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|lp-&gt;wait_frame_number
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;inppos
op_assign
id|lp-&gt;outpos
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;eth_trans_buffer_len
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tr_err
op_assign
id|TR_ERROR_COUNT
suffix:semicolon
id|lp-&gt;last_receive_OK
op_assign
id|FALSE
suffix:semicolon
id|lp-&gt;tr_resend
op_assign
id|FALSE
suffix:semicolon
id|lp-&gt;timer_ticks
op_assign
id|CHANGE_LEVEL_START_TICKS
suffix:semicolon
id|lp-&gt;timeout_rxl
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;waitack
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|lp-&gt;queue
)paren
suffix:semicolon
id|sbni_drop_tx_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Reset the card and set start parameters */
id|outb
c_func
(paren
id|PR_RES
op_or
op_star
(paren
r_char
op_star
)paren
op_amp
id|lp-&gt;csr1
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|outb
c_func
(paren
id|EN_INT
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
)brace
DECL|function|sbni_nirvana
r_void
id|sbni_nirvana
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|sbni_outs
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
comma
id|magic_reply
comma
l_int|9
)paren
suffix:semicolon
)brace
DECL|function|sbni_recv
r_static
r_inline
r_int
r_int
id|sbni_recv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|crc
suffix:semicolon
r_int
r_int
id|packetlen
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|packetinf
comma
id|packetfirst
comma
id|receiveframeresend
suffix:semicolon
r_int
r_char
id|current_frame
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|delme
comma
id|rcv_res
op_assign
id|RCV_WR
suffix:semicolon
id|lp-&gt;in_stats.all_rx_number
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|delme
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
)paren
op_eq
id|SBNI_SIG
)paren
(brace
id|crc
op_assign
id|CRC32_INITIAL
suffix:semicolon
op_star
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|packetlen
)paren
op_plus
l_int|0
)paren
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
suffix:semicolon
id|crc
op_assign
id|CRC32
c_func
(paren
op_star
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|packetlen
)paren
op_plus
l_int|0
)paren
comma
id|crc
)paren
suffix:semicolon
op_star
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|packetlen
)paren
op_plus
l_int|1
)paren
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
suffix:semicolon
id|crc
op_assign
id|CRC32
c_func
(paren
op_star
(paren
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|packetlen
)paren
op_plus
l_int|1
)paren
comma
id|crc
)paren
suffix:semicolon
id|packetinf
op_assign
id|packetlen
op_amp
id|PACKET_INF_MASK
suffix:semicolon
id|packetfirst
op_assign
id|packetlen
op_amp
id|PACKET_FIRST_FRAME
suffix:semicolon
id|receiveframeresend
op_assign
id|packetlen
op_amp
id|RECEIVE_FRAME_RESEND
suffix:semicolon
id|packetlen
op_assign
id|packetlen
op_amp
id|PACKET_LEN_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|packetlen
op_le
id|SB_MAX_BUFFER_ARRAY
op_minus
l_int|3
)paren
op_logical_and
(paren
id|packetlen
op_ge
l_int|6
)paren
)paren
(brace
multiline_comment|/* read frame number */
id|current_frame
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
suffix:semicolon
id|crc
op_assign
id|CRC32
c_func
(paren
id|current_frame
comma
id|crc
)paren
suffix:semicolon
multiline_comment|/* read HandShake counter */
id|lp-&gt;HSCounter
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
suffix:semicolon
id|crc
op_assign
id|CRC32
c_func
(paren
id|lp-&gt;HSCounter
comma
id|crc
)paren
suffix:semicolon
id|packetlen
op_sub_assign
l_int|2
suffix:semicolon
id|sbni_ins
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
comma
id|lp-&gt;eth_rcv_buffer
op_plus
id|lp-&gt;inppos
comma
id|packetlen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|lp-&gt;inppos
suffix:semicolon
id|i
OL
(paren
id|packetlen
op_plus
id|lp-&gt;inppos
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crc
op_assign
id|CRC32
c_func
(paren
id|lp-&gt;eth_rcv_buffer
(braket
id|i
)braket
comma
id|crc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|crc
op_eq
id|CRC32_REMAINDER
)paren
(brace
r_if
c_cond
(paren
id|packetlen
OG
l_int|4
)paren
(brace
id|rcv_res
op_assign
id|RCV_OK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|packetlen
op_eq
l_int|4
)paren
(brace
id|rcv_res
op_assign
id|RCV_NO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;waitack
op_logical_and
id|packetinf
op_eq
id|PACKET_RESEND
)paren
(brace
id|lp-&gt;in_stats.resend_tx_number
op_increment
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|packetinf
)paren
(brace
r_case
id|PACKET_SEND_OK
suffix:colon
(brace
id|lp-&gt;tr_err
op_assign
id|TR_ERROR_COUNT
suffix:semicolon
id|lp-&gt;tr_resend
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* if(lp-&gt;trans_frame_number){ */
id|lp-&gt;outpos
op_add_assign
id|lp-&gt;realframelen
suffix:semicolon
multiline_comment|/* SendComplete&n;&t;&t;&t;&t;&t; * not supported&n;&t;&t;&t;&t;&t; */
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_recv SendComplete&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; *&t;We sucessfully sent current packet&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|lp-&gt;waitack
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;currframe
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
macro_line|#ifdef KATYUSHA
id|lp-&gt;currframe
op_assign
id|skb_dequeue
c_func
(paren
op_amp
(paren
(paren
(paren
r_struct
id|net_local
op_star
)paren
(paren
id|lp-&gt;m-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|queue
)paren
)paren
suffix:semicolon
macro_line|#else
id|lp-&gt;currframe
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|lp-&gt;queue
)paren
suffix:semicolon
macro_line|#endif&t;&t;       
id|lp-&gt;in_stats.all_tx_number
op_increment
suffix:semicolon
id|lp-&gt;waitack
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;      &t;&t;&t;&t; * reset output active flags&n;&t;&t;&t;&t;&t; */
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/*} if */
)brace
r_case
id|PACKET_RESEND
suffix:colon
(brace
r_if
c_cond
(paren
id|lp-&gt;tr_err
)paren
(brace
multiline_comment|/**/
id|lp-&gt;tr_err
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;ok_curr
OL
l_int|0xffffffff
)paren
(brace
id|lp-&gt;ok_curr
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|packetlen
OG
l_int|4
op_logical_and
op_logical_neg
(paren
id|lp-&gt;last_receive_OK
op_logical_and
id|receiveframeresend
)paren
)paren
(brace
r_if
c_cond
(paren
id|packetfirst
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;wait_frame_number
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|lp-&gt;inppos
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|lp-&gt;inppos
op_plus
id|packetlen
op_minus
l_int|4
)paren
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|lp-&gt;eth_rcv_buffer
(braket
id|j
)braket
op_assign
id|lp-&gt;eth_rcv_buffer
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
id|lp-&gt;wait_frame_number
op_assign
id|current_frame
suffix:semicolon
id|lp-&gt;inppos
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_frame
op_eq
id|lp-&gt;wait_frame_number
)paren
(brace
id|lp-&gt;inppos
op_add_assign
(paren
id|packetlen
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;wait_frame_number
op_eq
l_int|1
)paren
(brace
id|sbni_get_packet
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;inppos
op_assign
l_int|0
suffix:semicolon
)brace
id|lp-&gt;wait_frame_number
op_decrement
suffix:semicolon
)brace
)brace
id|lp-&gt;last_receive_OK
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: bad CRC32&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|change_level
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: bad len&bslash;n &quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|change_level
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: bad sig&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|change_level
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
op_xor
id|CT_ZER
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
r_return
(paren
id|rcv_res
)paren
suffix:semicolon
)brace
DECL|function|change_level
r_void
id|change_level
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;in_stats.bad_rx_number
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;rxl_delta
op_eq
l_int|0
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * set new rxl_delta value&n;&t; */
r_if
c_cond
(paren
id|lp-&gt;rxl_curr
op_eq
l_int|0
)paren
(brace
id|lp-&gt;rxl_delta
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lp-&gt;rxl_curr
op_eq
l_int|0xf
)paren
(brace
id|lp-&gt;rxl_delta
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lp-&gt;ok_curr
OL
id|lp-&gt;ok_prev
)paren
(brace
id|lp-&gt;rxl_delta
op_assign
op_minus
id|lp-&gt;rxl_delta
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * set new rxl_curr value&n;&t; */
id|lp-&gt;csr1.rxl
op_assign
id|rxl_tab
(braket
id|lp-&gt;rxl_curr
op_add_assign
id|lp-&gt;rxl_delta
)braket
suffix:semicolon
id|outb
c_func
(paren
op_star
(paren
r_char
op_star
)paren
op_amp
id|lp-&gt;csr1
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * update ok_prev/ok_curr counters&n;&t; */
id|lp-&gt;ok_prev
op_assign
id|lp-&gt;ok_curr
suffix:semicolon
id|lp-&gt;ok_curr
op_assign
l_int|0
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: receive error, rxl_curr = %d, rxl_delta = %d&bslash;n&quot;
comma
"&bslash;"
id|dev-&gt;name
comma
id|lp-&gt;rxl_curr
comma
id|lp-&gt;rxl_delta
)paren
suffix:semicolon
)paren
)brace
DECL|function|sbni_xmit
r_static
r_inline
r_void
id|sbni_xmit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|lp-&gt;currframe
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: sbni_xmit CSR0=%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_char
)paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
)paren
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* push signature*/
id|outb
c_func
(paren
id|SBNI_SIG
comma
id|dev-&gt;base_addr
op_plus
id|DAT
)paren
suffix:semicolon
multiline_comment|/* push frame w/o crc [HAiRY]*/
id|sbni_outs
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
comma
op_amp
(paren
(paren
r_struct
id|sbni_hard_header
op_star
)paren
(paren
id|skb-&gt;data
)paren
)paren
op_member_access_from_pointer
id|packetlen
comma
id|SBNI_HH_SZ
op_minus
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|sbni_outs
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
comma
id|skb-&gt;data
op_plus
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
comma
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
)paren
suffix:semicolon
multiline_comment|/* &#xfffd;&#xfffd;&#xfffd;&#xfffd;&#xfffd;&#xfffd; &#xfffd;&#xfffd;&#xfffd; */
multiline_comment|/* push crc */
id|sbni_outs
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|DAT
comma
id|skb-&gt;data
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|lp-&gt;waitack
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The typical workload of the driver:&n; *&t;Handle the ether interface interrupts. &n; */
DECL|function|sbni_interrupt
r_static
r_void
id|sbni_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
suffix:semicolon
id|u_char
id|csr0
suffix:semicolon
r_int
r_int
id|rcv_res
op_assign
id|RCV_NO
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|dev-&gt;irq
op_ne
id|irq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sbni: irq %d for unknown device&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: entering interrupt handler, CSR0 = %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr0
)paren
suffix:semicolon
)paren
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;carrier
)paren
(brace
id|lp-&gt;carrier
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Disable adapter interrupts&n;&t; */
id|outb
c_func
(paren
(paren
id|csr0
op_amp
op_complement
id|EN_INT
)paren
op_or
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|lp-&gt;timer_ticks
op_assign
id|CHANGE_LEVEL_START_TICKS
suffix:semicolon
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_amp
(paren
id|TR_RDY
op_or
id|RC_RDY
)paren
)paren
(brace
r_if
c_cond
(paren
id|csr0
op_amp
id|RC_RDY
)paren
(brace
id|rcv_res
op_assign
id|sbni_recv
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lp-&gt;currframe
)paren
op_logical_and
(paren
id|rcv_res
op_ne
id|RCV_WR
)paren
)paren
(brace
id|sbni_xmit
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rcv_res
op_eq
id|RCV_OK
)paren
id|sbni_nirvana
c_func
(paren
id|dev
)paren
suffix:semicolon
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: CSR0 = %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|u_int
)paren
id|csr0
)paren
suffix:semicolon
)paren
suffix:semicolon
)brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: leaving interrupt handler, CSR0 = %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr0
op_or
id|EN_INT
)paren
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* here we should send pong */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
op_amp
op_complement
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;currframe
)paren
(brace
id|outb
c_func
(paren
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
op_or
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
)brace
r_else
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable adapter interrupts&n;&t; */
id|outb
c_func
(paren
id|csr0
op_or
id|EN_INT
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|sbni_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|sbni_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
DECL|function|sbni_get_packet
r_static
r_inline
r_void
id|sbni_get_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|rawp
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|lp-&gt;inppos
op_minus
id|ETH_HLEN
op_plus
r_sizeof
(paren
r_struct
id|sbni_hard_header
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef KATYUSHA
id|skb-&gt;dev
op_assign
id|lp-&gt;m
suffix:semicolon
macro_line|#else
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
macro_line|#endif      
id|memcpy
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|lp-&gt;inppos
op_plus
l_int|8
)paren
op_plus
l_int|8
comma
id|lp-&gt;eth_rcv_buffer
comma
id|lp-&gt;inppos
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
op_plus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
(paren
r_char
op_star
)paren
id|lp-&gt;eth_rcv_buffer
)paren
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|lp-&gt;eth_rcv_buffer
comma
id|dev-&gt;broadcast
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_BROADCAST
suffix:semicolon
)brace
r_else
id|skb-&gt;pkt_type
op_assign
id|PACKET_MULTICAST
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_PROMISC
op_or
id|IFF_ALLMULTI
)paren
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|lp-&gt;eth_rcv_buffer
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
)paren
(brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_OTHERHOST
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|htons
c_func
(paren
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|lp-&gt;eth_rcv_buffer
(braket
l_int|2
op_star
id|ETH_ALEN
)braket
)paren
)paren
)paren
op_ge
l_int|1536
)paren
(brace
id|skb-&gt;protocol
op_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|lp-&gt;eth_rcv_buffer
(braket
l_int|2
op_star
id|ETH_ALEN
)braket
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|rawp
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
op_amp
id|lp-&gt;eth_rcv_buffer
(braket
l_int|2
op_star
id|ETH_ALEN
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|rawp
op_eq
l_int|0xFFFF
)paren
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
r_else
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
id|skb_pull
c_func
(paren
id|skb
comma
id|SBNI_HH_SZ
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|sbni_watchdog
r_static
r_void
id|sbni_watchdog
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u_char
id|csr0
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: watchdog start&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
multiline_comment|/*&n;&t; * if no pong received and transmission is not in progress&n;&t; * then assume error&n;&t; */
id|cli
c_func
(paren
)paren
suffix:semicolon
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_amp
(paren
id|RC_CHK
op_or
id|TR_REQ
)paren
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;timer_ticks
)paren
(brace
r_if
c_cond
(paren
id|csr0
op_amp
(paren
id|RC_RDY
op_or
id|BU_EMP
)paren
)paren
(brace
id|lp-&gt;timer_ticks
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|lp-&gt;rxl_delta
)paren
(brace
id|lp-&gt;ok_prev
op_assign
id|lp-&gt;ok_curr
suffix:semicolon
id|lp-&gt;ok_curr
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;rxl_curr
op_assign
id|timeout_rxl_tab
(braket
id|lp-&gt;timeout_rxl
)braket
suffix:semicolon
id|lp-&gt;timeout_rxl
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;timeout_rxl
OG
id|SIZE_OF_TIMEOUT_RXL_TAB
op_minus
l_int|1
)paren
(brace
id|lp-&gt;timeout_rxl
op_assign
l_int|0
suffix:semicolon
)brace
id|lp-&gt;csr1.rxl
op_assign
id|rxl_tab
(braket
id|lp-&gt;rxl_curr
)braket
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * update ok_prev/ok_curr counters&n;&t;&t;&t;&t; */
id|lp-&gt;ok_prev
op_assign
id|lp-&gt;ok_curr
suffix:semicolon
id|lp-&gt;ok_curr
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;tr_err
)paren
(brace
id|lp-&gt;tr_err
op_decrement
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Drop the queue of tx packets */
id|sbni_drop_tx_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;carrier
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * send pong&n;&t;&t;&t; */
id|csr0
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|outb
c_func
(paren
id|csr0
op_amp
op_complement
id|TR_REQ
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|outb
c_func
(paren
op_star
(paren
r_char
op_star
)paren
(paren
op_amp
id|lp-&gt;csr1
)paren
op_or
id|PR_RES
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|lp-&gt;in_stats.timeout_number
op_increment
suffix:semicolon
)brace
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|csr0
op_or
id|RC_CHK
comma
id|dev-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_struct
id|timer_list
op_star
id|watchdog
op_assign
op_amp
id|lp-&gt;watchdog
suffix:semicolon
id|init_timer
c_func
(paren
id|watchdog
)paren
suffix:semicolon
id|watchdog-&gt;expires
op_assign
id|jiffies
op_plus
id|SBNI_TIMEOUT
suffix:semicolon
id|watchdog-&gt;data
op_assign
id|arg
suffix:semicolon
id|watchdog-&gt;function
op_assign
id|sbni_watchdog
suffix:semicolon
id|add_timer
c_func
(paren
id|watchdog
)paren
suffix:semicolon
)brace
)brace
DECL|function|sbni_drop_tx_queue
r_static
r_void
id|sbni_drop_tx_queue
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
comma
op_star
id|nl
suffix:semicolon
r_struct
id|sk_buff
op_star
id|tmp
suffix:semicolon
multiline_comment|/* first of all, we should try to gift our packets to another interface */
id|nl
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|lp-&gt;m-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|nl
op_eq
id|lp
)paren
(brace
id|nl
op_assign
id|lp-&gt;next_lp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nl
)paren
(brace
multiline_comment|/* we found device*/
r_if
c_cond
(paren
id|lp-&gt;currframe
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|nl-&gt;currframe
)paren
(brace
id|nl-&gt;currframe
op_assign
id|lp-&gt;currframe
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_head
c_func
(paren
op_amp
(paren
(paren
r_struct
id|net_local
op_star
)paren
(paren
id|lp-&gt;m-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|queue
comma
id|lp-&gt;currframe
)paren
suffix:semicolon
)brace
)brace
id|lp-&gt;currframe
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nl-&gt;currframe
)paren
(brace
id|nl-&gt;currframe
op_assign
id|skb_dequeue
c_func
(paren
op_amp
(paren
(paren
(paren
r_struct
id|net_local
op_star
)paren
(paren
id|lp-&gt;m-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|queue
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* set request for transmit */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|nl-&gt;me-&gt;base_addr
op_plus
id|CSR0
)paren
op_or
id|TR_REQ
comma
id|nl-&gt;me-&gt;base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* *sigh*, we should forget this packets */
id|nl
op_assign
id|lp-&gt;m-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tmp
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|nl-&gt;queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;currframe
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;currframe
)paren
suffix:semicolon
id|lp-&gt;currframe
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
)brace
id|lp-&gt;waitack
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: queue dropping stoped&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set or clear the multicast filter for this adaptor.&n; * num_addrs == -1&t;Promiscuous mode, receive all packets&n; * num_addrs == 0&t;Normal mode, clear multicast list&n; * num_addrs &gt; 0&t;Multicast mode, receive normal and MC packets,&n; *&t;&t;&t;and do best-effort filtering.&n; */
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
multiline_comment|/*&n;&t; * always enabled promiscuous mode.&n;&t;*/
r_return
suffix:semicolon
)brace
DECL|function|sbni_set_mac_address
r_static
r_int
id|sbni_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
multiline_comment|/* struct net_local *lp = (struct net_local *)dev-&gt;priv; */
r_struct
id|sockaddr
op_star
id|saddr
op_assign
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* Only possible while card isn&squot;t started */
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|saddr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sbni_ioctl
r_static
r_int
id|sbni_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
comma
op_star
id|tlp
suffix:semicolon
r_struct
id|net_device
op_star
id|slave
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_char
id|tmpstr
(braket
l_int|6
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVGETINSTATS
suffix:colon
(brace
r_struct
id|sbni_in_stats
op_star
id|in_stats
op_assign
(paren
r_struct
id|sbni_in_stats
op_star
)paren
id|ifr-&gt;ifr_data
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: SIOCDEVGETINSTATS %08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|in_stats
)paren
suffix:semicolon
)paren
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|in_stats
comma
(paren
r_void
op_star
)paren
(paren
op_amp
(paren
id|lp-&gt;in_stats
)paren
)paren
comma
r_sizeof
(paren
r_struct
id|sbni_in_stats
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|SIOCDEVRESINSTATS
suffix:colon
(brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: SIOCDEVRESINSTATS&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)paren
id|lp-&gt;in_stats.all_rx_number
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;in_stats.bad_rx_number
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;in_stats.timeout_number
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;in_stats.all_tx_number
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;in_stats.resend_tx_number
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SIOCDEVGHWSTATE
suffix:colon
(brace
r_struct
id|sbni_flags
id|flags
suffix:semicolon
id|flags.rxl
op_assign
id|lp-&gt;rxl_curr
suffix:semicolon
id|flags.rate
op_assign
id|lp-&gt;csr1.rate
suffix:semicolon
id|flags.fixed_rxl
op_assign
(paren
id|lp-&gt;rxl_delta
op_eq
l_int|0
)paren
suffix:semicolon
id|flags.fixed_rate
op_assign
l_int|1
suffix:semicolon
id|ifr-&gt;ifr_data
op_assign
op_star
(paren
id|caddr_t
op_star
)paren
op_amp
id|flags
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: get flags (0x%02x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_char
)paren
id|ifr-&gt;ifr_data
)paren
suffix:semicolon
)paren
r_break
suffix:semicolon
)brace
r_case
id|SIOCDEVSHWSTATE
suffix:colon
(brace
r_struct
id|sbni_flags
id|flags
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: SIOCDEVSHWSTATE flags=0x%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_char
)paren
id|ifr-&gt;ifr_data
)paren
suffix:semicolon
)paren
multiline_comment|/* root only */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|flags
op_assign
op_star
(paren
r_struct
id|sbni_flags
op_star
)paren
op_amp
id|ifr-&gt;ifr_data
suffix:semicolon
r_if
c_cond
(paren
id|flags.fixed_rxl
)paren
(brace
id|lp-&gt;rxl_delta
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;rxl_curr
op_assign
id|flags.rxl
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;rxl_delta
op_assign
id|DEF_RXL_DELTA
suffix:semicolon
id|lp-&gt;rxl_curr
op_assign
id|DEF_RXL
suffix:semicolon
)brace
id|lp-&gt;csr1.rxl
op_assign
id|rxl_tab
(braket
id|lp-&gt;rxl_curr
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flags.fixed_rate
)paren
(brace
id|lp-&gt;csr1.rate
op_assign
id|flags.rate
suffix:semicolon
)brace
r_else
id|lp-&gt;csr1.rate
op_assign
id|DEF_RATE
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Don&squot;t be afraid...&n;&t;&t;&t; */
id|outb
c_func
(paren
op_star
(paren
r_char
op_star
)paren
(paren
op_amp
id|lp-&gt;csr1
)paren
op_or
id|PR_RES
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: set flags (0x%02x)&bslash;n receive level: %u, baud rate: %u&bslash;n&quot;
comma
"&bslash;"
id|dev-&gt;name
comma
(paren
r_int
r_char
)paren
id|ifr-&gt;ifr_data
comma
(paren
r_int
)paren
id|lp-&gt;rxl_curr
comma
(paren
r_int
)paren
id|lp-&gt;csr1.rate
)paren
suffix:semicolon
)paren
r_break
suffix:semicolon
)brace
r_case
id|SIOCDEVENSLAVE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|tmpstr
comma
id|ifr-&gt;ifr_data
comma
l_int|6
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|slave
op_assign
id|dev_get_by_name
c_func
(paren
id|tmpstr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|slave
op_logical_and
id|slave-&gt;flags
op_amp
id|IFF_UP
op_logical_and
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Both devices should be UP to enslave!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slave
)paren
id|dev_put
c_func
(paren
id|slave
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slave
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_SLAVE
)paren
op_logical_or
(paren
id|slave-&gt;flags
op_amp
id|IFF_SLAVE
)paren
)paren
)paren
(brace
multiline_comment|/* drop queue*/
id|sbni_drop_tx_queue
c_func
(paren
id|slave
)paren
suffix:semicolon
id|slave-&gt;flags
op_or_assign
id|IFF_SLAVE
suffix:semicolon
(paren
(paren
r_struct
id|net_local
op_star
)paren
(paren
id|slave-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|m
op_assign
id|dev
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;next_lp
)paren
(brace
singleline_comment|//tail it after last slave
id|lp
op_assign
id|lp-&gt;next_lp
suffix:semicolon
)brace
id|lp-&gt;next_lp
op_assign
id|slave-&gt;priv
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_MASTER
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: one of devices is already slave!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev_put
c_func
(paren
id|slave
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t find device %s to enslave&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ifr-&gt;ifr_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCDEVEMANSIPATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_SLAVE
)paren
(brace
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_SLAVE
suffix:semicolon
multiline_comment|/* exclude us from masters slavelist*/
r_for
c_loop
(paren
id|tlp
op_assign
id|lp-&gt;m-&gt;priv
suffix:semicolon
id|tlp-&gt;next_lp
op_ne
id|lp
op_logical_and
id|tlp-&gt;next_lp
suffix:semicolon
id|tlp
op_assign
id|tlp-&gt;next_lp
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tlp-&gt;next_lp
)paren
(brace
id|tlp-&gt;next_lp
op_assign
id|lp-&gt;next_lp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
r_struct
id|net_local
op_star
)paren
id|lp-&gt;m-&gt;priv
)paren
op_member_access_from_pointer
id|next_lp
)paren
(brace
id|lp-&gt;m-&gt;flags
op_and_assign
op_complement
id|IFF_MASTER
suffix:semicolon
)brace
id|lp-&gt;next_lp
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;m
op_assign
id|dev
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Ooops. drivers structure is mangled!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: isn&squot;t slave device!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|DP
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;%s: invalid ioctl: 0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cmd
)paren
suffix:semicolon
)paren
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
macro_line|#ifdef CRCASM
DECL|function|calc_crc
r_int
r_int
id|calc_crc
c_func
(paren
r_char
op_star
id|mem
comma
r_int
id|len
comma
r_int
id|initial
)paren
(brace
r_int
id|crc
comma
id|dummy_len
suffix:semicolon
id|__asm__
(paren
l_string|&quot;xorl %%eax,%%eax&bslash;n&bslash;t&quot;
l_string|&quot;1:&bslash;n&bslash;t&quot;
l_string|&quot;lodsb&bslash;n&bslash;t&quot;
l_string|&quot;xorb %%dl,%%al&bslash;n&bslash;t&quot;
l_string|&quot;shrl $8,%%edx&bslash;n&bslash;t&quot;
l_string|&quot;xorl (%%edi,%%eax,4),%%edx&bslash;n&bslash;t&quot;
l_string|&quot;loop 1b&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|crc
)paren
comma
l_string|&quot;=c&quot;
(paren
id|dummy_len
)paren
suffix:colon
l_string|&quot;S&quot;
(paren
id|mem
)paren
comma
l_string|&quot;D&quot;
(paren
op_amp
id|crc32tab
(braket
l_int|0
)braket
)paren
comma
l_string|&quot;1&quot;
(paren
id|len
)paren
comma
l_string|&quot;0&quot;
(paren
id|initial
)paren
suffix:colon
l_string|&quot;eax&quot;
)paren
suffix:semicolon
r_return
id|crc
suffix:semicolon
)brace
macro_line|#else
DECL|function|calc_crc
r_int
r_int
id|calc_crc
c_func
(paren
r_char
op_star
id|mem
comma
r_int
id|len
comma
r_int
id|initial
)paren
(brace
r_int
id|crc
suffix:semicolon
id|crc
op_assign
id|initial
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|len
suffix:semicolon
id|mem
op_increment
comma
id|len
op_decrement
)paren
(brace
id|crc
op_assign
id|CRC32
c_func
(paren
op_star
id|mem
comma
id|crc
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
macro_line|#endif /* CRCASM */
macro_line|#ifdef MODULE
DECL|variable|io
r_static
r_int
id|io
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|rxl
r_static
r_int
id|rxl
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|baud
r_static
r_int
id|baud
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|mac
r_static
r_int
id|mac
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SBNI_MAX_NUM_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SBNI_MAX_NUM_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rxl
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SBNI_MAX_NUM_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|baud
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SBNI_MAX_NUM_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mac
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SBNI_MAX_NUM_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|variable|sbniautodetect
r_static
r_int
id|sbniautodetect
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dev_sbni
r_static
r_struct
id|net_device
id|dev_sbni
(braket
id|SBNI_MAX_NUM_CARDS
)braket
op_assign
(brace
(brace
l_string|&quot;sbni0&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni1&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni2&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni3&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni4&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni5&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni6&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
comma
(brace
l_string|&quot;sbni7&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0
comma
l_int|0
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|sbni_probe
)brace
)brace
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|devices
op_assign
l_int|0
suffix:semicolon
r_int
id|installed
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* My simple plug for this huge init_module. &quot;XenON */
r_if
c_cond
(paren
id|sbniautodetect
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Autodetect mode */
id|printk
c_func
(paren
l_string|&quot;sbni: Autodetect mode (not recommended!) ...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbniautodetect
)paren
(brace
id|sbniautodetect
op_assign
id|SBNI_MAX_NUM_CARDS
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Trying to find %d SBNI cards...&bslash;n&quot;
comma
id|sbniautodetect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbniautodetect
OG
id|SBNI_MAX_NUM_CARDS
)paren
(brace
id|sbniautodetect
op_assign
id|SBNI_MAX_NUM_CARDS
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sbni: You want to detect too many cards. Truncated to %d&bslash;n&quot;
comma
id|SBNI_MAX_NUM_CARDS
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sbniautodetect
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|register_netdev
c_func
(paren
op_amp
id|dev_sbni
(braket
id|i
)braket
)paren
)paren
(brace
id|installed
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|installed
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Manual mode */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SBNI_MAX_NUM_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|io
(braket
id|i
)braket
op_ne
l_int|0
)paren
op_logical_or
(paren
id|irq
(braket
id|i
)braket
op_ne
l_int|0
)paren
)paren
(brace
id|devices
op_increment
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|devices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_sbni
(braket
id|i
)braket
dot
id|irq
op_assign
id|irq
(braket
id|i
)braket
suffix:semicolon
id|dev_sbni
(braket
id|i
)braket
dot
id|base_addr
op_assign
id|io
(braket
id|i
)braket
suffix:semicolon
id|def_rxl
op_assign
id|rxl
(braket
id|i
)braket
suffix:semicolon
id|def_baud
op_assign
id|baud
(braket
id|i
)braket
suffix:semicolon
id|def_mac
op_assign
id|mac
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_sbni
(braket
id|i
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sbni: card not found!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|installed
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|installed
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev_sbni
(braket
id|i
)braket
dot
id|priv
)paren
(brace
id|free_irq
c_func
(paren
id|dev_sbni
(braket
id|i
)braket
dot
id|irq
comma
op_amp
id|dev_sbni
(braket
id|i
)braket
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_sbni
(braket
id|i
)braket
dot
id|base_addr
comma
id|SBNI_IO_EXTENT
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
op_amp
id|dev_sbni
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_sbni
(braket
id|i
)braket
dot
id|priv
)paren
suffix:semicolon
id|dev_sbni
(braket
id|i
)braket
dot
id|priv
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* MODULE */
eof
